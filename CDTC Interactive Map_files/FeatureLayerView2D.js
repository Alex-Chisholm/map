// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define("./chunks/tslib.es6 ./Graphic ./core/accessorSupport/decorators/property ./core/has ./core/Logger ./core/RandomLCG ./core/accessorSupport/decorators/subclass".split(" "),function(k,n,q,m,t,c,u){n=class extends n{constructor(){super(...arguments);this.isAggregate=!0}getEffectivePopupTemplate(y){return this.popupTemplate?this.popupTemplate:(y=this.sourceLayer?.featureReduction)&&"popupTemplate"in y&&y.popupEnabled?y.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};
k.__decorate([q.property({type:Boolean})],n.prototype,"isAggregate",void 0);return n=k.__decorate([u.subclass("esri.AggregateGraphic")],n)})},"esri/layers/effects/FeatureEffectView":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/accessorSupport/decorators/property ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./EffectView".split(" "),function(k,n,q,m,t,c,u,y){n=class extends n{constructor(p){super(p);this._filter=null;
this.duration=q("mapview-transitions-duration");this._excludedEffectView=new y.EffectView(p);this._includedEffectView=new y.EffectView(p)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(p){this._get("featureEffect")!==p&&this._transitionTo(p)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(p){this._set("scale",
p);this._excludedEffectView.scale=p;this._includedEffectView.scale=p}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}transitionStep(p,l){this._set("scale",l);this.transitioning?(this._includedEffectView.transitionStep(p,l),this._excludedEffectView.transitionStep(p,l),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=l,this._includedEffectView.scale=l)}endTransitions(){this._includedEffectView.endTransitions();this._excludedEffectView.endTransitions();
this._filter=null}_transitionTo(p){const l=this._get("featureEffect"),b=p?.includedEffect,v=p?.excludedEffect,a=this._includedEffectView.canTransitionTo(b)&&this._excludedEffectView.canTransitionTo(v);this._includedEffectView.effect=b;this._excludedEffectView.effect=v;this._set("featureEffect",p);this._filter=p?.filter||l?.filter||null;a||this.endTransitions()}};k.__decorate([m.property()],n.prototype,"_filter",void 0);k.__decorate([m.property()],n.prototype,"_excludedEffectView",void 0);k.__decorate([m.property()],
n.prototype,"_includedEffectView",void 0);k.__decorate([m.property()],n.prototype,"duration",void 0);k.__decorate([m.property()],n.prototype,"excludedEffects",null);k.__decorate([m.property()],n.prototype,"featureEffect",null);k.__decorate([m.property()],n.prototype,"filter",null);k.__decorate([m.property()],n.prototype,"hasEffects",null);k.__decorate([m.property()],n.prototype,"includedEffects",null);k.__decorate([m.property({value:0})],n.prototype,"scale",null);k.__decorate([m.property()],n.prototype,
"transitioning",null);return n=k.__decorate([u.subclass("esri.layers.effects.FeatureEffectView")],n)})},"esri/rest/support/AggregateFeatureSet":function(){define("../../chunks/tslib.es6 ../../AggregateGraphic ../../geometry ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ./FeatureSet ../../geometry/SpatialReference".split(" "),function(k,n,q,m,t,c,u,y,p,
l,b){q=class extends l{constructor(){super(...arguments);this.features=[]}readFeatures(v,a){a=b.fromJSON(a.spatialReference);const d=[];for(let C=0;C<v.length;C++){var e=v[C];const x=n.fromJSON(e);var r=e.geometry?.spatialReference;null==x.geometry||r||(x.geometry.spatialReference=a);e=e.aggregateGeometries;r=x.aggregateGeometries;if(e&&null!=r)for(const h in r){const w=r[h],D=e[h]?.spatialReference;null==w||D||(w.spatialReference=a)}d.push(x)}return d}};k.__decorate([m.property({type:[n],json:{write:!0}})],
q.prototype,"features",void 0);k.__decorate([y.reader("features")],q.prototype,"readFeatures",null);return q=k.__decorate([p.subclass("esri.rest.support.AggregateFeatureSet")],q)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a,d,e,r,C){const x=q.ofType({key:"type",base:null,typeMap:{rect:e,path:C,geometry:r}});k.LayerView2DMixin=h=>{h=class extends h{constructor(){super(...arguments);this.attached=!1;this.clips=new x;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const w=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&w&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new t("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new a.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([c.watch(()=>this.suspended,D=>{this.container&&(this.container.visible=!D)},c.syncAndInitial),c.watch(()=>this.updateSuspended,D=>{this.view&&!D&&this.updateRequested&&this.view.requestUpdate()},c.syncAndInitial),c.watch(()=>this.layer?.opacity??
1,D=>{this.container&&(this.container.opacity=D)},c.syncAndInitial),c.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",D=>{this.container&&(this.container.blendMode=D)},c.syncAndInitial),c.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,D=>{this.container&&(this.container.effect=D)},c.syncAndInitial),c.watch(()=>this.highlightOptions,D=>this.container.highlightOptions=D,c.syncAndInitial),c.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},c.syncAndInitial),c.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:D})=>{D=null!=D?this.isVisibleAtScale(D):!1;D!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",D)},c.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(D=>{D===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const w=this.view?.spatialReference;return null==w||this.supportsSpatialReference(w)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(w){const D=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!D)return!0;const {minScale:I,maxScale:g}=D;return v.isInScaleRange(w,I,g)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(w){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
w),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(w)))}hitTest(w,D){return Promise.resolve(null)}supportsSpatialReference(w){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const w=super.getSuspendInfo(),D=!this.spatialReferenceSupported,I=this.visibleAtCurrentScale;D&&(w.spatialReferenceNotSupported=D);I&&(w.outsideScaleRange=I);return w}addAttachHandles(w){this.addHandles(w,"attach")}};
n.__decorate([u.property()],h.prototype,"attached",void 0);n.__decorate([u.property({type:x,set(w){w=m.referenceSetter(w,this._get("clips"),x);this._set("clips",w)}})],h.prototype,"clips",void 0);n.__decorate([u.property()],h.prototype,"container",void 0);n.__decorate([u.property()],h.prototype,"moving",void 0);n.__decorate([u.property({readOnly:!0})],h.prototype,"spatialReferenceSupported",null);n.__decorate([u.property({readOnly:!0})],h.prototype,"updateParameters",void 0);n.__decorate([u.property()],
h.prototype,"updateRequested",void 0);n.__decorate([u.property()],h.prototype,"updateSuspended",null);n.__decorate([u.property()],h.prototype,"updating",null);n.__decorate([u.property()],h.prototype,"view",void 0);n.__decorate([u.property({readOnly:!0})],h.prototype,"visibleAtCurrentScale",void 0);n.__decorate([u.property({type:d})],h.prototype,"highlightOptions",void 0);return h=n.__decorate([b.subclass("esri.views.2d.layers.LayerView2D")],h)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(k,n,q){function m(t,c){c=q.getMetersPerUnitForSR(c);return t/(c*q.inchesPerMeter*96)}k.getExtentForScale=function(t,c){const u=t.extent;t=t.width-(t.padding?t.padding.left+t.padding.right:0);c=m(c,u.spatialReference);return u.clone().expand(c*t/u.width)};k.getResolutionForScale=m;k.getResolutionInMetersForScale=function(t){return t/(96*q.inchesPerMeter)};k.getScale=function(t,c){c=
c||t.extent;t=t.width;const u=q.getMetersPerUnitForSR(c?.spatialReference);return c&&t?c.width/t*u*q.inchesPerMeter*96:0};k.getScaleForResolution=function(t,c){c=q.getMetersPerUnitForSR(c);return t*c*q.inchesPerMeter*96};k.isInScaleRange=function(t,c,u){if(c=0===c||n.floatEqualAbsolute(t,c)||t<c)c=0===u||n.floatEqualAbsolute(t,u)||t>u;return c};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(k,n,q,m,t,c,u){var y;q=y=class extends u{constructor(p){super(p);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new y({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};k.__decorate([n.property({type:[Number,String],json:{write:!0}})],q.prototype,"left",void 0);k.__decorate([n.property({type:[Number,String],
json:{write:!0}})],q.prototype,"right",void 0);k.__decorate([n.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);k.__decorate([n.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);return q=y=k.__decorate([c.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(k,n,q,m,t,c,u){n=class extends n.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};k.__decorate([q.property({readOnly:!0})],n.prototype,"version",null);return n=k.__decorate([u.subclass("esri.views.layers.support.ClipArea")],n)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v){var a;n={base:y,key:"type",typeMap:{extent:b,polygon:v}};l=a=class extends l{constructor(d){super(d);this.type="geometry";this.geometry=null}clone(){return new a({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};k.__decorate([q.property({types:n,json:{read:p.fromJSON,write:!0}})],l.prototype,"geometry",void 0);return l=a=k.__decorate([u.subclass("esri.views.layers.support.Geometry")],l)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(k,n,q,m,t,c,u){q=class extends u{constructor(y){super(y);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};k.__decorate([n.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);return q=k.__decorate([c.subclass("esri.views.layers.support.Path")],q)})},"esri/views/2d/layers/features/FeatureContainer":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/support/UpdatingHandles ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/InstanceStore ./RenderState ../support/util".split(" "),
function(k,n,q,m,t,c,u,y,p,l){class b{constructor(a,d){this.id=a;this.version=d;this._resolver=m.createResolver();this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve();this._done=!0}destroy(){this._resolver.reject()}}class v extends c.AFeatureContainer{constructor(a){super(a.view.featuresTilingScheme);this.updatingHandles=new t.UpdatingHandles;this._hitTestsRequests=[];this._store=new y;this._visibleTiles=new Set;this._subscriptions=
new Map;this._updateStatisticsRequests=[];this._lockStatisticUpdates=!1;this._layerView=a}renderChildren(a){this.attributeView.update();if(this._renderState){const d=Array.from(this._renderState.tiles()).filter(e=>e.needsUpload);d.length&&(d[Math.floor(Math.random()*d.length)].upload(),2<=d.length&&this.requestRender());for(const e of this._renderState.tiles())e.tryReady(this.attributeView.currentEpoch)&&(this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),
this.requestRender())}for(const d of this.children)d.setTransform(a.state);this.hasAnimation&&a.painter.effects.integrate.draw(a,a.attributeView);super.renderChildren(a);switch(a.drawPhase){case u.WGLDrawPhase.MAP:return this._renderMapPhase(a);case u.WGLDrawPhase.HIGHLIGHT:return this._renderHighlightPhase(a);case u.WGLDrawPhase.LABEL:return this._renderLabelPhase(a)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return 0<
this._layerView.labelingCollisionInfos.length}get hasHighlight(){return this._layerView.hasHighlight()}get _layer(){return this._layerView.layer}_getExclusivePostprocessingInstance({drawPhase:a}){if(null==this._instanceStore)return null;let d=0,e=null;for(const r of this._instanceStore.values())r.techniqueRef.drawPhase&a&&(d++,r.techniqueRef.postProcessingEnabled&&(e=r));return 1<d?null:e}_getOverrideStencilRef({drawPhase:a}){if(null==this._instanceStore)return null;let d=null;for(const e of this._instanceStore.values()){if(!(e.techniqueRef.drawPhase&
a))continue;const {overrideStencilRef:r}=e.techniqueRef;if(null==d)d=r;else if(d!==r){d=null;break}}return d}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(a=>this._visibleTiles.has(a.key.id)):[]}async updateAttributeView(a){this.requestRender();await this.updatingHandles.addPromise(this.attributeView.requestUpdate(a));this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}updateSubscriptions(a){for(const {tileId:d,version:e}of a.subscribe)if(this._subscriptions.has(d))this._subscriptions.get(d).version=
e;else{const r=new b(d,e);this._subscriptions.set(d,r);this.updatingHandles.addPromise(r.promise)}for(const d of a.unsubscribe)this._subscriptions.get(d)?.destroy(),this._subscriptions.delete(d),this.removeTile(d)}isDone(a){return this._renderState?this._renderState.isTileDone(a):!1}async updateRenderState(a){n("esri-2d-update-debug")&&console.debug(`Version[${a}] FeatureContainer.updateRenderState`);this._renderStateNext=new p.RenderState(()=>this._stage,a,this._tileInfoView)}getDisplayStatistics(a,
d){return(a=this._statisticsByLevel.get(a))?a.get(d):null}updateStatistics(a,d){if(this._lockStatisticUpdates)this._updateStatisticsRequests.push({level:a,statistics:d});else{var e=this._statisticsByLevel.get(a);e||(e=new Map,this._statisticsByLevel.set(a,e));for(const r of d)e.set(r.fieldName,{minValue:r.minValue,maxValue:r.maxValue})}}editStart(){this._renderState?.lockUploads();this.attributeView.lockTextureUploads();this._lockStatisticUpdates=!0}editEnd(){this._renderState?.unlockUploads();this.attributeView.unlockTextureUploads();
this._lockStatisticUpdates=!1;for(const a of this._updateStatisticsRequests)this.updateStatistics(a.level,a.statistics);this._updateStatisticsRequests=[];this.requestRender()}swapRenderState(){this._renderStateNext&&(n("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`),this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null);if(this._renderState)for(const a of this._renderState.tiles())a.upload();
this.requestRender()}setVisibleTiles(a){this._visibleTiles=a}async onMessage(a,d){m.throwIfAborted(d);if(this._subscriptions.has(a.id))if(d=this._subscriptions.get(a.id),d.version!==a.subscriptionVesrion)n("esri-2d-update-debug")&&console.debug(`Version[${`${a.subscriptionVesrion} != ${d.version}`}] Tile[${a.id}] FeatureContainer - Dropping message, outdated version]`,a);else{d=this._renderStateNext??this._renderState;if(!d)throw Error("InternalError: No renderState defined");d.version!==a.version&&
console.error(`InternalError: Version mismatch. [renderState: ${d.version}, message: ${a.version}]`);d.updateTile(a);a.end&&this._subscriptions.get(a.id).end();this.requestRender();this._layerView.view.labelManager.requestUpdate();this._layerView.requestUpdate()}}removeTile(a){if(this._renderState||this._renderStateNext)this._renderState&&this._renderState.removeTile(a),this._renderStateNext&&this._renderStateNext.removeTile(a)}hitTest(a){let d=this._hitTestsRequests.find(({x:r,y:C})=>r===a.x&&C===
a.y);const e=m.createResolver();d?d.resolvers.push(e):(d={x:a.x,y:a.y,resolvers:[e]},this._hitTestsRequests.push(d));this.requestRender();return e.promise}getSortKeys(a){a=new Set(a);const d=new Map;for(const e of this.children)if(e.getSortKeys(a).forEach((r,C)=>d.set(C,r)),d.size===a.size)break;return d}get hasAnimation(){return this.hasLabels}updateTransitionProperties(a,d){super.updateTransitionProperties(a,d);this._layerView.featureEffectView.transitionStep(a,d);this._layerView.featureEffectView.transitioning&&
this.requestRender()}doRender(a){const {minScale:d,maxScale:e}=this._layer.effectiveScaleRange,r=a.state.scale;r<=(d||Infinity)&&r>=e&&super.doRender(a)}afterRender(a){super.afterRender(a);this._hitTestsRequests.length&&this.requestRender()}setStencilReference(a){const d=this._getOverrideStencilRef(a);if(null!=d)for(const e of this.children)e.stencilRef=d(e);else super.setStencilReference(a)}_renderMapPhase(a){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(a),this._renderInsideEffect(a)):
this._renderFeatures(a,u.FeatureSelection.All);0<this._hitTestsRequests.length&&this._renderHittest(a)}_renderHighlightPhase(a){this.hasHighlight&&l.renderHighlight(a,!1,d=>{this._renderFeatures(d,u.FeatureSelection.Highlight)})}_renderLabelPhase(a){this._renderFeatures(a,u.FeatureSelection.All)}_renderInsideEffect(a){const d=a.painter.effects.insideEffect;d.bind(a);this._renderFeatures(a,u.FeatureSelection.InsideEffect);d.draw(a,this._layerView.featureEffectView.includedEffects);d.unbind()}_renderOutsideEffect(a){const d=
a.painter.effects.outsideEffect;d.bind(a);this._renderFeatures(a,u.FeatureSelection.OutsideEffect);d.draw(a,this._layerView.featureEffectView.excludedEffects);d.unbind()}_renderHittest(a){const {context:d}=a,e=a.painter.effects.hittest,r=d.getBoundFramebufferObject(),C=d.getViewport(),x=a.passOptions;e.bind(a);a.passOptions=e.createOptions(a,this._hitTestsRequests);this._renderFeatures(a,u.FeatureSelection.All);e.draw(a);e.unbind();d.bindFramebuffer(r);d.restoreViewport(C);a.passOptions=x}_renderFeatures(a,
d){for(const r of this.children)if(r.visible){var e=n("featurelayer-force-marker-text-draw-order")?u.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT:u.FeatureBatchingStrategy.BATCHING;e=r.getDisplayList(a.drawPhase,this._instanceStore,e);a.selection=d;e?.render(a)}d=this._getExclusivePostprocessingInstance(a);null!=d&&d.techniqueRef.postProcess(a,d)}}k.FeatureContainer=v;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/InstanceStore":function(){define(["../../../../../../core/string",
"./TechniqueInstance","./mesh/instanceIdUtils"],function(k,n,q){class m{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}updateStart(){this._instanceByIdNext=new Map}updateEnd(){if(!this._instanceByIdNext)throw Error("InternalError: Found updateEnd call without corresponding updateStart");for(var t of this._instanceById.keys())this._instanceByIdNext.has(t)||this._instanceById.delete(t);for(const [c,u]of this._instanceByIdNext.entries())(t=
this._instanceById.get(c))?t.setInput(u.getInput()):this._instanceById.set(c,u);this._instanceByIdNext=null}values(){return this._instanceById.values()}ensureInstance(t,c,u){var y=`${t.registryName}`;for(const p in c){const l=c[p];if("object"===typeof l&&"geometry"===p)for(const b in l)y+=`.${p}.${b}.${null!=l[b]}`;else y+=`.${p}.${null!=c[p]}`}if(null!=u)for(const p in u)u[p]&&(y+=`-${p}`);y=k.numericHash(y);if(this._instanceByIdNext)return t=new n.TechniqueInstance(q.castInstanceId(y),t,t.meshWriter.name,
c,u),this._instanceByIdNext.set(y,t),t;this._instanceById.has(y)||(t=new n.TechniqueInstance(q.castInstanceId(y),t,t.meshWriter.name,c,u),this._instanceById.set(y,t));return this._instanceById.get(y)}getInstance(t){return this._instanceById.get(t)}}return m})},"esri/views/2d/layers/features/RenderState":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../geometry/support/aaBoundingRect ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/FeatureTile ./support/tileUtils".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b){class v{constructor(a,d,e){this.getStage=a;this.version=d;this._tileInfoView=e;this._tiles=new Map;this._pendingUpdates=[];this._locked=!1}destroy(){}tiles(){return this._tiles.values()}size(){return this._tiles.size}setTiles(a){this._tiles.clear();for(const d of a)this._tiles.set(d.key.id,d)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1;for(const a of this._pendingUpdates)this.updateTile(a);this._pendingUpdates=[]}updateTile(a){if(this._locked)this._pendingUpdates.push(a);
else{q("esri-2d-update-debug")&&console.debug(`Version[${a.version}] Tile[${a.id}] Chunk[${a.debugInfo?.chunkId??"\x3cEnsureEnd\x3e"}] RenderState.updateTile [${a.type}]`,a);var d=this._ensureTile(a.id);if("update"===a.type){const [x,...h]=a.modify;d.onMessage({type:"update",modify:x,remove:a.remove,end:a.end,attributeEpoch:a.attributeEpoch});for(const w of h){var e=this._tiles.get(w.tileId);if(e)e.onMessage({type:"update",modify:w,remove:a.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}else if(null==
a.append)d.onMessage({type:"append",clear:a.clear,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch});else{var [r,...C]=a.append;d.onMessage({type:"append",clear:a.clear,append:r,debugInfo:a.debugInfo,end:a.end,attributeEpoch:a.attributeEpoch});for(e of C)if(a=this._tiles.get(e.tileId))a.onMessage({type:"update",modify:e,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}}removeTile(a){const d=this._tiles.get(a);q("esri-2d-update-debug")&&console.debug(`Tile[${a}] RenderState.removeTile`);
d?.destroy();this._tiles.delete(a)}isTileDone(a){return(a=this._tiles.get(a.id))?a.isReady:!1}_ensureTile(a){if(!this._tiles.has(a)){const d=this._createTile(a);this._copyPixelBufferedEntitiesInto(d);this._tiles.set(a,d)}return this._tiles.get(a)}_createTile(a){q("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${a}] RenderState.createTile`);a=new u(a);var d=this._tileInfoView.getTileBounds(t.create(),a);const e=this._tileInfoView.getTileResolution(a.level);a=new l.FeatureTile(a,
e,d[0],d[3],!0);a.stage=this.getStage();a.stage||(d=new n("featurelayerview:webgl","Cannot create tile with empty stage"),m.getLogger("esri.views.2d.layers.features.RenderState").error(d));return a}_copyPixelBufferedEntitiesInto(a){let d=7;for(let r=-1;1>=r;r++)for(let C=-1;1>=C;C++)if(0!==r||0!==C){var e=b.getPow2NeighborKey(a.key,C,r,this._tileInfoView.tileInfo.isWrappable).id;e=this._tiles.get(e);null!=e&&a.copyPixelBufferedEntitesFrom(e,1<<d,C,r);d--}}}k.RenderState=v;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/tileUtils":function(){define(["exports"],function(k){k.getPow2NeighborKey=function(n,q,m,t){n=n.clone();const c=1<<n.level;q=n.col+q;m=n.row+m;t&&0>q?(n.col=q+c,--n.world):q>=c?(n.col=q-c,n.world+=1):n.col=q;n.row=m;return n};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports","../../../../core/workers/workers"],function(k,
n){class q{constructor(m){this._connection=m;this.pipeline=this._connection.createInvokeProxy();this.features=this._connection.createInvokeProxy("features");this.aggregates=this._connection.createInvokeProxy("aggregates");this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}k.FeaturePipelineWorkerProxy=q;k.createFeaturePipelineWorkerProxy=async function(m){m=await n.open("FeaturePipelineWorker",
{client:m,strategy:"dedicated"});return new q(m)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/ReactiveMap ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(k,
n,q,m,t,c,u,y,p,l){k.FeatureSourceEventLog=class extends q{constructor(){super(...arguments);this.events=new m;this._updatingStrategy=!0;this._tileToEvent=new t;this._fetchStatus={outstanding:0,done:0}}get hasAllFeatures(){return this._hasAllData()&&(this._strategyInfo?.willQueryAllFeatures??!1)}get hasAllFeaturesInView(){return this._hasAllData()}get hasFullGeometries(){return this._hasAllData()&&(this._strategyInfo?.willQueryFullResolutionGeometry??!1)}onEvent(b){switch(b.type){case "subscribe":case "unsubscribe":case "loaded":case "error":this._handleTileEvent(b);
break;case "updateStrategyStart":this._updatingStrategy=!0;this._fetchStatus={done:0,outstanding:0};this._strategyInfo=b.about;break;case "updateStrategyEnd":this._updatingStrategy=!1;break;case "updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case "updateFieldsError":this.events.emit("error",b);break;case "fetchStart":this._fetchStatus.outstanding+=1;this.events.emit("status",this._fetchStatus);break;case "fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),
b.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}_hasAllTileData(){for(const b of this._tileToEvent.values())if("loaded"!==b[b.length-1].type)return!1;return!0}_handleTileEvent(b){switch(b.type){case "subscribe":this._tileToEvent.set(b.tile,[b]);break;case "unsubscribe":this._tileToEvent.delete(b.tile);break;case "loaded":var v=this._tileToEvent.get(b.tile);if(!v)break;v.push(b);this._tileToEvent.set(b.tile,v);break;case "error":if(v=
this._tileToEvent.get(b.tile))v.push(b),this._tileToEvent.set(b.tile,v),this.events.emit("error",b)}}};n.__decorate([c.property({readOnly:!0})],k.FeatureSourceEventLog.prototype,"hasAllFeatures",null);n.__decorate([c.property({readOnly:!0})],k.FeatureSourceEventLog.prototype,"hasAllFeaturesInView",null);n.__decorate([c.property({readOnly:!0})],k.FeatureSourceEventLog.prototype,"hasFullGeometries",null);n.__decorate([c.property()],k.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0);n.__decorate([c.property()],
k.FeatureSourceEventLog.prototype,"_strategyInfo",void 0);n.__decorate([c.property()],k.FeatureSourceEventLog.prototype,"_tileToEvent",void 0);k.FeatureSourceEventLog=n.__decorate([l.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],k.FeatureSourceEventLog);Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y,p){class l{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){b=this.layer;const v=c.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:c.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:v}]}async createServiceOptions(b){var v=this.layer,a=v.parent;b=m.getEffectiveLayerCapabilities(a);const {capabilities:d,editingInfo:e,objectIdField:r,globalIdField:C,datesInUnknownTimezone:x,orderBy:h,subtypeField:w,parsedUrl:D}=a,I=a.fieldsIndex.toJSON(),g=t.getEffectiveGeometryType(v);
a=a.timeInfo?.toJSON();v=v.spatialReference.toJSON();const A=n.clone(D);let B=r;if(h?.length){var E=!h[0].valueExpression&&h[0].field;E&&(B=E)}E=q.isHostedAgolService(A.path);return{type:"feature-service",source:A,isSourceHosted:E,orderByFields:B,metadata:{timeReferenceUnknownClient:x,subtypeField:w,globalIdField:C,fieldsIndex:I,geometryType:g,objectIdField:r,timeInfo:a,spatialReference:v,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:d,effectiveCapabilities:b,lastEditDate:e?.lastEditDate?.getTime(),
snapshotInfo:null}}}createSourceSchema(b,v,a){const {definitionExpression:d,customParameters:e,timeExtent:r,apiKey:C}=this.layer.parent;return u.createFeatureSourceSchema(b,{definitionExpression:d,customParameters:e,timeExtent:r},v,a,C)}createProcessorSchema(b,v,a){const {parent:{fields:d,geometryType:e,orderBy:r,objectIdField:C},renderer:x,labelingInfo:h,labelsVisible:w}=this.layer,D={featureReduction:null,fields:d.map(I=>I.toJSON()),geometryType:e,labelingInfo:h,labelsVisible:w,objectIdField:C,
orderBy:r??"default",renderer:x?.clone()};return y.createSimpleProcessorSchema(b,v,D,a)}get hasRequiredSupport(){return p.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(b){const {parent:v,parent:{definitionExpression:a,apiKey:d},renderer:e}=this.layer;b=this.layer.labelsVisible?this.layer.labelingInfo:null;const r=JSON.stringify(v.customParameters),C=JSON.stringify(v.orderBy);return{apiKey:d,customParameters:r,definitionExpression:a,labelingInfo:b,orderBy:C,renderer:e}}setGraphicOrigin(b){b.origin=
{type:"catalog",layer:this.layer}}}k.CatalogFootprintLayerAdapter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],function(k){k.getEffectiveGeometryType=function(n){switch(n.geometryType){case "point":return"esriGeometryPoint";case "polyline":return"esriGeometryPolyline";case "polygon":return"esriGeometryPolygon";case "multipatch":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";
default:return null}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils","./featureReductionUtils","../../support/visualVariableSimpleUtils"],function(k,n,q,m){function t(c){return u=>n.pt2px(m.getSizeForValueSimple(u,c))}k.createLabelVVEvaluator=function(c){c=null!=c&&"visualVariables"in c&&c.visualVariables;if(!c)return null;for(const u of c)if("size"===u.type)return t(u);
return null};k.getFeatureReductionDeconflictionEnabled=function(c,u){c=q.getEffectiveFeatureReduction(c,u);if(c?.labelsVisible&&c.labelingInfo?.length)return c.labelingInfo.every(y=>"none"!==y.deconflictionStrategy)};k.getLayerDeconflictionEnabled=function(c){return(c.labelsVisible&&c.labelingInfo?.every(u=>"none"!==u.deconflictionStrategy))??!1};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],
function(k){k.getEffectiveFeatureReduction=function(n,q){return(n=n.featureReduction)&&"selection"!==n.type?!("maxScale"in n&&n.maxScale)||n.maxScale<q.scale?n:null:null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils","../../../../renderers/visualVariables/support/sizeVariableUtils"],function(k,n,q,m){function t(p,l){switch(l.transformationType){case m.TransformationType.Additive:var b=
c(l.minSize,p);return p+(b||l.minDataValue);case m.TransformationType.Constant:return b=l.stops,b=b?.length&&b[0].size,null==b&&(b=l.minSize),c(b,p);case m.TransformationType.ClampedLinear:b=l.minDataValue;var v=l.maxDataValue,a=(p-b)/(v-b),d=c(l.minSize,p);l=c(l.maxSize,p);p=p<=b?d:p>=v?l:d+a*(l-d);return p;case m.TransformationType.Proportional:return b=p/l.minDataValue,v=c(l.minSize,p),p=c(l.maxSize,p),n.clamp(b*v,v,p);case m.TransformationType.Stops:{const [e,r,C]=u(p,l.cache.ipData);e===r?p=
c(l.stops[e].size,p):(b=c(l.stops[e].size,p),p=c(l.stops[r].size,p),p=b+(p-b)*C)}return p;case m.TransformationType.RealWorldSize:return b=q.meterIn[l.valueUnit],v=c(l.minSize,p),a=c(l.maxSize,p),{valueRepresentation:l}=l,d=null,d="area"===l?2*Math.sqrt(p/y)/b:"radius"===l||"distance"===l?2*p/b:p/b,n.clamp(d,v,a);case m.TransformationType.Identity:return p;case m.TransformationType.Unknown:return null}}function c(p,l){return"number"===typeof p?p:t(l,p)}function u(p,l){if(l){var b=0,v=l.length-1;l.some((a,
d)=>{if(p<a)return v=d,!0;b=d;return!1});return[b,v,(p-l[b])/(l[v]-l[b])]}}const y=Math.PI;k.getSizeForValueSimple=t;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports","../../../../../core/sql"],function(k,n){k.createFeatureSourceSchema=function(q,m,t,c,u){const y=n.sqlAnd(m.definitionExpression,null!=m.subtypeCode?`${m.subtypeField} = ${m.subtypeCode}`:null),p=m.customParameters??{};u&&(p.token=u);return{type:"feature",
mutable:{sourceRefreshVersion:c,availableFields:t.availableFields,dataFilter:{definitionExpression:y,gdbVersion:m.gdbVersion,historicMoment:m.historicMoment?.getTime(),outSpatialReference:t.outSpatialReference.toJSON(),timeExtent:m.timeExtent?.toJSON(),customParameters:p}},service:q,tileInfoJSON:t.tileInfoJSON}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define("exports ../../../../../../core/screenUtils ../../../../../../layers/support/OrderByInfo ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema".split(" "),
function(k,n,q,m,t,c,u){async function y(a,d){var e=d.renderer;const r=u.createVisualVariableUniforms(e);e=await t.createMatcherSchema(a,e);a=await m.createLabelMatcherSchema(a,d,r);return{symbology:e,labels:a}}function p(a,d){return a.fields.map(e=>({...e.toJSON(),type:l(e,d)}))}function l(a,d){const {onStatisticExpression:e,onStatisticField:r,statisticType:C}=a;switch(C){case "min":case "max":case "avg":case "avg_angle":case "sum":case "count":return"esriFieldTypeDouble";case "mode":return e?({returnType:a}=
e,a?"string"===a?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"):(a=d.find(x=>x.name===r))?a.type:"esriFieldTypeString"}}async function b(a,d,e,r,C){r=p(a,r.fields);var x=a.renderer;const h=await t.createMatcherSchema(d,x),w=c.createStorageSchema(x,[null,null]);x=u.createVisualVariableUniforms(x);d=await m.createLabelMatcherSchema(d,{geometryType:"polygon",labelingInfo:a.labelingInfo,labelsVisible:a.labelsVisible},x);return{storage:w,mesh:{displayRefreshVersion:C,strategy:{type:"binning",
fields:r,fixedBinLevel:a.fixedBinLevel,featureFilter:e.filters[0]},factory:{labels:d,symbology:h},sortKey:null,timeZone:e.timeZone}}}async function v(a,d,e,r,C){const x=p(a,r.fields),h={type:"cluster",feature:await t.createMatcherSchema(d,a.effectiveFeatureRenderer),cluster:await t.createMatcherSchema(d,a.effectiveClusterRenderer)},w=u.createVisualVariableUniforms(a.effectiveFeatureRenderer);d={type:"cluster",feature:await m.createLabelMatcherSchema(d,r,w),cluster:await m.createLabelMatcherSchema(d,
{geometryType:"point",labelingInfo:a.labelingInfo,labelsVisible:a.labelsVisible},w)};return{storage:c.createStorageSchema(a.effectiveFeatureRenderer,[null,null]),mesh:{displayRefreshVersion:C,strategy:{type:"cluster",fields:x,featureFilter:e.filters[0],clusterRadius:n.pt2px(a.clusterRadius/2)},factory:{labels:d,symbology:h},sortKey:null,timeZone:e.timeZone}}}k.createSimpleProcessorSchema=async function(a,d,e,r){var C=e.featureReduction;if(C)switch(C.type){case "binning":return b(C,a,d,e,r);case "cluster":return v(C,
a,d,e,r)}C=e.orderBy;var x=e.renderer;x=null!=x&&"unique-value"===x.type&&x.orderByClassesEnabled;"default"!==C||x||(C=[new q({field:e.objectIdField,order:"descending"})]);"default"!==C&&C.length?(C=C[0],x="ascending"===C.order?"asc":"desc",C=C.field?{field:C.field,order:x}:C.valueExpression?{expression:C.valueExpression,order:x}:null):C=x?{byRenderer:!0,order:"asc"}:null;x=c.createStorageSchema(e.renderer,d.filters);a=await y(a,e);return{storage:x,mesh:{displayRefreshVersion:r,strategy:{type:"feature"},
factory:a,sortKey:C,timeZone:d.timeZone}}};k.getAggregateFields=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],function(k,n,q,m){async function t(c,u,y,p){c=await m.createSymbolMeshSchemas(u,{path:`${y}`,schemaOptions:c,uniforms:p});return{maxScale:u.maxScale,minScale:u.minScale,
expression:u.labelExpressionInfo?.expression??u.labelExpression,where:u.where,meshes:c}}k.createLabelMatcherSchema=async function(c,u,y){var p=u.labelsVisible&&u.labelingInfo||[];u=q.getEffectiveGeometryType(u);p=n.validateLabelingInfo(p,u);return{type:"label",classes:await Promise.all(p.map((l,b)=>t(c,l,b,y)))}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define("exports ../../../../../../../symbols ../../../../../../../core/screenUtils ../../../../../../../renderers/support/heatmapUtils ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/SDFHelper ../../../../../engine/webgl/alignmentUtils ../../../../../engine/webgl/color ../../../../../engine/webgl/definitions ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../schemaUtils ../VisualVariablesSchema ./ComplexSymbolSchema ./utils ../../../../../../../symbols/SimpleFillSymbol".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a,d,e,r){async function C(g,A){if(!g)return[];switch(g.type){case "simple-fill":return D(g,A);case "picture-fill":{var {outline:B}=g;const {uniforms:R,schemaOptions:Z}=A;var {store:E}=Z,H=[];const ba=t.CIMSymbolHelper.createPictureFillRasterizationParam(g);if(ba){var {width:G,height:J,xoffset:P,yoffset:T,xscale:S,yscale:O}=g;g={color:[255,255,255,255],sprite:ba,height:J,aspectRatio:G/J,offsetX:P,offsetY:T,scaleX:S,scaleY:O,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,
scaleProportionally:!1,effects:null,scaleInfo:null};"solid"===B?.style?g=[E.ensureInstance(b.Techniques.complexOutlineFill,{geometry:{visualVariableColor:R.visualVariableColor,visualVariableOpacity:R.visualVariableOpacity,visualVariableSizeScaleStops:R.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{...g,...w(B,!!R.visualVariableSizeOutlineScaleStops)}})]:(E=E.ensureInstance(b.Techniques.complexFill,
{geometry:{visualVariableColor:R.visualVariableColor,visualVariableOpacity:R.visualVariableOpacity}},{zoomRange:!1}),H.push(E.createMeshInfo({params:g})),B&&H.push(...I(B,A,!0)),g=H)}else g=[]}return g;case "simple-marker":return h(g,A);case "picture-marker":{const {uniforms:R,schemaOptions:Z}=A;({store:A}=Z);A=A.ensureInstance(b.Techniques.marker,{geometry:{visualVariableColor:R.visualVariableColor,visualVariableOpacity:R.visualVariableOpacity,visualVariableSizeMinMaxValue:R.visualVariableSizeMinMaxValue,
visualVariableSizeScaleStops:R.visualVariableSizeScaleStops,visualVariableSizeStops:R.visualVariableSizeStops,visualVariableSizeUnitValue:R.visualVariableSizeUnitValue,visualVariableRotation:R.visualVariableRotation}},{zoomRange:!1});g=(B=t.CIMSymbolHelper.createPictureMarkerRasterizationParam(g))?[A.createMeshInfo({params:{type:"picture",color:[255,255,255,255],height:g.height,width:g.width,offsetX:g.xoffset,offsetY:g.yoffset,angle:g.angle,alignment:e.hasRotationVVUniform(R)?c.Alignment.MAP:c.Alignment.SCREEN,
outlineColor:null,outlineSize:0,referenceSize:g.height,sprite:B,overrideOutlineColor:!1,hasSizeVV:e.hasSizeVVUniform(R),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(R)}})]:[]}return g;case "simple-line":return I(g,A,!1);case "text":const {uniforms:M,schemaOptions:U}=A;({store:A}=U);return[A.ensureInstance(b.Techniques.text,{geometry:{visualVariableColor:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity,visualVariableRotation:M.visualVariableRotation,
visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue}},{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}).createMeshInfo({params:{boxBackgroundColor:g.backgroundColor?.toArray(),boxBorderLineColor:g.borderLineColor?.toArray(),boxBorderLineSize:g.borderLineSize??0,color:g.color?.toArray()??[0,0,0,0],offsetX:g.xoffset,offsetY:g.yoffset,
postAngle:g.angle,fontSize:g.font.size,decoration:g.font.decoration,haloColor:g.haloColor?.toArray()??[0,0,0,0],haloFontSize:g.haloSize??0,lineWidth:g.lineWidth,lineHeightRatio:g.lineHeight,horizontalAlignment:g.horizontalAlignment,verticalAlignment:g.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:g.font.toJSON(),textString:g.text,symbol:t.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(g)},overrides:[]},referenceSize:null,effects:null,
placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:a.getMaxSizeVVSize(M),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1}})];case "label":const {schemaOptions:V,uniforms:W}=A;({store:H}=V);A=g.symbol;const {allowOverrun:Y,repeatLabel:ca,repeatLabelDistance:Q}=g;B={maxScale:g.maxScale??0,minScale:g.minScale??0};H=H.ensureInstance(b.Techniques.label,{geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:W.visualVariableRotation,
visualVariableSizeMinMaxValue:W.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:W.visualVariableSizeScaleStops,visualVariableSizeStops:W.visualVariableSizeStops,visualVariableSizeUnitValue:W.visualVariableSizeUnitValue}},{zoomRange:!0,clipAngle:!0,referenceSymbol:!0});const [da,ea]=y.getAlignmentFromPlacement(g.labelPlacement);return[H.createMeshInfo({params:{boxBackgroundColor:A.backgroundColor?.toArray(),boxBorderLineColor:A.borderLineColor?.toArray(),boxBorderLineSize:A.borderLineSize??
0,color:A.color?.toArray()??[0,0,0,0],offsetX:A.xoffset,offsetY:A.yoffset,postAngle:A.angle,fontSize:A.font.size,decoration:A.font.decoration,haloColor:A.haloColor?.toArray()??[0,0,0,0],haloFontSize:A.haloSize??0,lineWidth:A.lineWidth,lineHeightRatio:A.lineHeight,horizontalAlignment:da,verticalAlignment:ea,repeatLabel:ca,repeatLabelDistance:q.pt2px(Q),allowOverrun:Y,labelPosition:g.labelPosition,scaleInfo:B,minPixelBuffer:a.getMaxSizeVVSize(W),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",
resource:{type:"text",font:A.font.toJSON(),textString:A.text,symbol:t.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(A),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==g.labelExpressionInfo?.expression,overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:g.labelExpressionInfo?.expression??g.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,
placement:null,transforms:null,scaleFactor:1,isLineLabel:!1}})];case "cim":return d.createComplexSymbolInstances(g.data,A);case "web-style":return g=await g.fetchCIMSymbol(),d.createComplexSymbolInstances(g.data,A);default:throw Error(`symbol not supported ${g.type}`);}}function x(g){if("path"===g.style){if(null==g.path)throw Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:g.path,asFill:!0}}}const A=t.CIMSymbolHelper.fromSimpleMarker(g);
if("outline"in g&&g.outline&&"none"!==g.outline.style&&"solid"!==g.outline.style){if(!A||!A.symbolLayers)throw Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:A.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:u.getSDFInfo(A),overrides:[]}}async function h(g,A){const {uniforms:B,schemaOptions:E}=A;var {store:H}=E;if("path"===g.style||g.outline&&"solid"!==g.outline.style&&"none"!==g.outline.style){H=t.CIMSymbolHelper.fromSimpleMarker(g);
if(!H||!H.symbolLayers)throw Error("Error handling marker! ");B.visualVariableRotation&&(H.angleAlignment="Map");if("path"!==g.style){var G=H.symbolLayers[0];if(e.hasSizeVVUniform(A.uniforms)){var J=a.getMaxSizeVVSize(A.uniforms,0,1);J>G.size&&(g=J/G.size,G.size=J,G=G.markerGraphics?.[0].symbol,(G.symbolLayers&&G.symbolLayers[0]).width*=g)}}return d.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:H},A)}A=H.ensureInstance(b.Techniques.marker,{geometry:{visualVariableColor:B.visualVariableColor,
visualVariableOpacity:B.visualVariableOpacity,visualVariableSizeMinMaxValue:B.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:B.visualVariableSizeScaleStops,visualVariableSizeStops:B.visualVariableSizeStops,visualVariableSizeUnitValue:B.visualVariableSizeUnitValue,visualVariableRotation:B.visualVariableRotation}},{zoomRange:!1});H=x(g);G=g.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===H.resource.type&&(G=[255,255,255,255]);J=g.size;const P=null!=B.visualVariableColor&&("cross"===g.style||
"x"===g.style);return[A.createMeshInfo({params:{type:"simple",color:G,height:J,width:J*("triangle"===g.style?124/116:1),offsetX:g.xoffset,offsetY:g.yoffset,angle:g.angle,alignment:e.hasRotationVVUniform(B)?c.Alignment.MAP:c.Alignment.SCREEN,outlineColor:g.outline?.color?.toArray()??[0,0,0,0],outlineSize:g.outline?.width??1,referenceSize:J,sprite:H,overrideOutlineColor:P,hasSizeVV:e.hasSizeVVUniform(B),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(B)}})]}
function w(g,A){const B=g.width;return{outlineColor:g.color?.toArray()||[0,0,0,1],width:B,referenceWidth:B,capType:g.cap??"round",joinType:g.join??"round",miterLimit:g.miterLimit,hasSizeVV:A}}function D(g,A){var {style:B}=g;if(B&&"none"!==B&&"solid"!==B){{const {uniforms:G,schemaOptions:J}=A;var {store:E}=J;B=g.color?.toArray()??[0,0,0,0];var H={type:"sprite-rasterization-param",resource:{type:"fill-style",style:g.style},overrides:[]};"solid"===g.outline?.style?g=[E.ensureInstance(b.Techniques.patternOutlineFill,
{geometry:{visualVariableColor:G.visualVariableColor,visualVariableOpacity:G.visualVariableOpacity,visualVariableSizeScaleStops:G.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:B,...w(g.outline,!!G.visualVariableSizeOutlineScaleStops),sprite:H,scaleInfo:null,effects:null}})]:(B=[],E=E.ensureInstance(b.Techniques.patternFill,{geometry:{visualVariableColor:G.visualVariableColor,
visualVariableOpacity:G.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:g.color?.toArray()??[0,0,0,0],sprite:H,scaleInfo:null,effects:null}}),B.push(E),g.outline&&B.push(...I(g.outline,A,!0)),g=B)}return g}{const {uniforms:G,schemaOptions:J}=A;({store:E}=J);H=g.color?.toArray()??[0,0,0,0];"none"!==g.style&&"solid"===g.outline?.style?g=[E.ensureInstance(b.Techniques.outlineFill,{geometry:{visualVariableColor:G.visualVariableColor,visualVariableOpacity:G.visualVariableOpacity,
visualVariableSizeScaleStops:G.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null}},{zoomRange:!1}).createMeshInfo({params:{color:H,...w(g.outline,!!G.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null}})]:(B=[],"none"!==g.style&&(E=E.ensureInstance(b.Techniques.fill,{geometry:{visualVariableColor:G.visualVariableColor,visualVariableOpacity:G.visualVariableOpacity}},{zoomRange:!1}).createMeshInfo({params:{color:H,
scaleInfo:null,effects:null}}),B.push(E)),g.outline&&B.push(...I(g.outline,A,!0)),g=B)}return g}function I(g,A,B){const {color:E,style:H,width:G,cap:J,join:P}=g;var {schemaOptions:T}=A,{store:S}=T;T=[];var O=B?{...a.noVisualVariables,visualVariableSizeScaleStops:A.uniforms.visualVariableSizeOutlineScaleStops}:A.uniforms;B={geometry:{visualVariableColor:O.visualVariableColor,visualVariableOpacity:O.visualVariableOpacity,visualVariableSizeMinMaxValue:O.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:O.visualVariableSizeScaleStops,
visualVariableSizeStops:O.visualVariableSizeStops,visualVariableSizeUnitValue:O.visualVariableSizeUnitValue}};O={color:E?.toArray()??[0,0,0,0],width:G,referenceWidth:G,capType:J,joinType:P,miterLimit:g.miterLimit,hasSizeVV:e.hasSizeVVUniform(O),effects:null,scaleInfo:null};null==H||"solid"===H?(S=S.ensureInstance(b.Techniques.line,B,{zoomRange:!1}).createMeshInfo({params:O}),T.push(S)):"none"!==H&&(S=S.ensureInstance(b.Techniques.texturedLine,B,{zoomRange:!1}).createMeshInfo({params:{...O,shouldScaleDash:!0,
shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:t.slsDashToTemplateArray(H,J),capStyle:t.capTypeToEnum(J)},overrides:[]}}}),T.push(S));if(null!=g.marker){S=T.push;B=g.marker;const {uniforms:M,schemaOptions:U}=A;({store:A}=U);A=A.ensureInstance(b.Techniques.marker,{geometry:{visualVariableColor:M.visualVariableColor,visualVariableOpacity:M.visualVariableOpacity,visualVariableSizeMinMaxValue:M.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:M.visualVariableSizeScaleStops,
visualVariableSizeStops:M.visualVariableSizeStops,visualVariableSizeUnitValue:M.visualVariableSizeUnitValue,visualVariableRotation:M.visualVariableRotation}},{zoomRange:!1});O=x(B);const V=6*g.width,W=B.color?.toArray()??g.color?.toArray()??[0,0,0,0],Y="cross"===B.style||"x"===B.style;switch(B.placement){case "begin-end":B=c.ExtremityPlacement.Both;break;case "begin":B=c.ExtremityPlacement.JustBegin;break;case "end":B=c.ExtremityPlacement.JustEnd;break;default:B=c.ExtremityPlacement.None}B={type:"cim-marker-placement-info",
placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:B,offsetAlongLine:0},overrides:[]};g=[A.createMeshInfo({params:{type:"simple",color:W,height:V,width:V,offsetX:0,offsetY:0,angle:0,alignment:e.hasRotationVVUniform(M)?c.Alignment.MAP:c.Alignment.SCREEN,outlineColor:W,outlineSize:Y?g.width:0,referenceSize:V/6,sprite:O,overrideOutlineColor:Y&&null!=M.visualVariableColor,hasSizeVV:e.hasSizeVVUniform(M),placement:B,transforms:null,effects:null,scaleInfo:null,
minPixelBuffer:a.getMaxSizeVVSize(M)}})];S.call(T,...g)}return T}k.createDotDensityMeshSchemas=async function(g,A){var {schemaOptions:B}=A;({store:B}=B);var E=Array(l.dotDensityMaxFields),H=Array(l.dotDensityMaxFields/4);for(var G=0;G<l.dotDensityMaxFields;G++){const J=G<g.attributes.length?g.attributes[G].color:null;E[G]=[0,0,0,0];p.writeColor(E[G],J)}for(G=0;G<l.dotDensityMaxFields/4;G++)H[G]=[0,0,0,0],H[G][0]=4*G<g.attributes.length?1:0,H[G][1]=4*G+1<g.attributes.length?1:0,H[G][2]=4*G+2<g.attributes.length?
1:0,H[G][3]=4*G+3<g.attributes.length?1:0;E=B.ensureInstance(b.Techniques.dotDensity,{isActive:H,colors:E,dotValue:g.dotValue,dotScale:g.referenceScale,blending:g.dotBlendingEnabled,dotSize:g.dotSize,seed:g.seed},{}).createMeshInfo({params:{effects:null}});B=[];g.backgroundColor&&(H=new r({color:g.backgroundColor,outline:null}),H=await C(H,A),B.push(...H));B.push(E);g.outline&&(g=I(g.outline,A,!0),B.push(...g));return B};k.createHeatmapMeshSchemas=async function(g,A){({store:A}=A);const {radius:B,
minDensity:E,maxDensity:H,referenceScale:G,field:J,valueExpression:P,colorStops:T}=g;g=m.generateGradient(T);return[A.ensureInstance(b.Techniques.heatmap,{radius:q.pt2px(B),minDensity:E,maxDensity:H,referenceScale:G,isFieldActive:!(!J&&!P),gradient:g,gradientHash:g.join(",")},{}).createMeshInfo({params:{effects:null}})]};k.createLineInstance=I;k.createPieChartMeshSchemas=function(g,A){var {store:B}=A;const E=g.outline?.width||0,H=a.createVisualVariableUniforms(g);B=B.ensureInstance(b.Techniques.pieChart,
{geometry:{outlineWidth:Math.round(q.pt2px(E)),defaultColor:v.premultiplyColor(g.defaultColor),outlineColor:v.premultiplyColor(g.outline?.color),othersColor:v.premultiplyColor(g.othersCategory?.color),donutRatio:g.holePercentage,sectorThreshold:g.othersCategory?.threshold||0,colors:g.attributes.map(G=>v.premultiplyColor(G.color)),visualVariableOpacity:H.visualVariableOpacity,visualVariableSizeMinMaxValue:H.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:H.visualVariableSizeScaleStops,visualVariableSizeStops:H.visualVariableSizeStops,
visualVariableSizeUnitValue:H.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:g.attributes.length},{}).createMeshInfo({params:{size:g.size,outlineWidth:E,effects:null,scaleInfo:null,minPixelBuffer:a.getMaxSizeVVSize(H)}});return[...(g.backgroundFillSymbol?D(g.backgroundFillSymbol,{schemaOptions:A,path:"",uniforms:a.noVisualVariables}):[]),B]};k.createSymbolMeshSchemas=C;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports",
"./VisualVariablesSchema","./symbols/SymbolSchema"],function(k,n,q){async function m(l,b){var v=b.getSymbols();v=v.length?v[0]:null;b=n.createVisualVariableUniforms(b);return{type:"simple",meshes:await q.createSymbolMeshSchemas(v,{schemaOptions:l,uniforms:b,path:"renderer.symbol"})}}async function t(l,b){const v=n.createVisualVariableUniforms(b);return{type:"dot-density",meshes:await q.createDotDensityMeshSchemas(b,{schemaOptions:l,uniforms:v,path:"renderer.symbol"})}}async function c(l,b){const v=
n.createVisualVariableUniforms(b);var a=b.backgroundFillSymbol,d=b.normalizationType;d="log"===d?"esriNormalizeByLog":"percent-of-total"===d?"esriNormalizeByPercentOfTotal":"field"===d?"esriNormalizeByField":null;var e=b.classBreakInfos.map(async C=>({meshes:await q.createSymbolMeshSchemas(C.symbol,{path:`renderer-stop-${C.minValue}-${C.maxValue}`,schemaOptions:l,uniforms:v}),min:C.minValue,max:C.maxValue}));e=(await Promise.all(e)).sort((C,x)=>C.min-x.min);a=await q.createSymbolMeshSchemas(a,{schemaOptions:l,
path:"renderer.backgroundFill",uniforms:{...n.noVisualVariables,visualVariableSizeOutlineScaleStops:v.visualVariableSizeOutlineScaleStops}});const r=await q.createSymbolMeshSchemas(b.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:v});return{type:"interval",field:b.field,expression:b.valueExpression,backgroundFill:a,defaultSymbol:r,intervals:e,normalizationField:b.normalizationField,normalizationTotal:b.normalizationTotal,normalizationType:d,isMaxInclusive:b.isMaxInclusive}}
async function u(l,b){const v=[],a=n.createVisualVariableUniforms(b),d=await q.createSymbolMeshSchemas(b.backgroundFillSymbol,{schemaOptions:l,path:"renderer.backgroundFill",uniforms:{...n.noVisualVariables,visualVariableSizeOutlineScaleStops:a.visualVariableSizeOutlineScaleStops}}),e=await q.createSymbolMeshSchemas(b.defaultSymbol,{schemaOptions:l,path:"renderer.defaultSymbol",uniforms:a});for(const r of b.uniqueValueInfos??[]){const C=await q.createSymbolMeshSchemas(r.symbol,{path:`renderer-unique-value-${r.value}`,
schemaOptions:l,uniforms:a});v.push({value:""+r.value,symbol:C})}return{type:"map",field:b.field,expression:b.valueExpression,field2:b.field2,field3:b.field3,fieldDelimiter:b.fieldDelimiter,backgroundFill:d,defaultSymbol:e,map:v}}async function y(l,b){return{type:"heatmap",meshes:await q.createHeatmapMeshSchemas(b,l)}}async function p(l,b){return{type:"pie-chart",meshes:q.createPieChartMeshSchemas(b,l)}}k.createMatcherSchema=async function(l,b){if(!b)return{type:"simple",meshes:[]};switch(b.type){case "simple":return m(l,
b);case "dot-density":return t(l,b);case "class-breaks":return c(l,b);case "unique-value":return u(l,b);case "dictionary":l=n.createVisualVariableUniforms(b);const v=b.scaleExpression;return{type:"dictionary",fieldMap:b.fieldMap,scaleExpression:null!=v&&"1"!==v?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:b.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0,visualVariableUniforms:l};case "heatmap":return y(l,b);case "pie-chart":return p(l,b)}};k.createSimpleMatcherSchemaFromSymbol=
async function(l,b,v){return{type:"simple",meshes:await q.createSymbolMeshSchemas(b,{schemaOptions:l,path:v,uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null}})}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a){class d{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const r=this.layer;e=l.getFeatureReductionDeconflictionEnabled(r,e)??l.getLayerDeconflictionEnabled(r);return[{vvEvaluators:{0:l.createLabelVVEvaluator(r.renderer)},deconflictionEnabled:e}]}async createServiceOptions(e){var r=this.layer;const C=t.getEffectiveLayerCapabilities(r),{capabilities:x,editingInfo:h,objectIdField:w,typeIdField:D,globalIdField:I,datesInUnknownTimezone:g,orderBy:A,subtypeField:B,
refreshInterval:E}=r,H=r.fieldsIndex.toJSON(),G=H.fields,J=p.getEffectiveGeometryType(r),P=r.timeInfo?.toJSON(),T=r.spatialReference.toJSON(),S=r.types?.map(V=>V.toJSON()),O=q.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(O.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let M=this.layer.objectIdField;if(A?.length){var U=!A[0].valueExpression&&A[0].field;U&&(M=U)}U=null==h?.lastEditDate&&0<E;e=(U=n("featurelayer-snapshot-enabled")&&"point"===r.geometryType&&x?.query.supportsPagination&&
!x?.operations.supportsEditing&&!U)&&u.exceedsMinimumSnapshotCoverage(e,r.fullExtent);r=m.isHostedAgolService(O.path);return{type:"feature-service",source:O,isSourceHosted:r,orderByFields:M,metadata:{typeIdField:D??void 0,types:S,timeReferenceUnknownClient:g,subtypeField:B,globalIdField:I,fields:G,fieldsIndex:H,geometryType:J,objectIdField:w,timeInfo:P,spatialReference:T,subtypes:this.layer.subtypes?.map(V=>V.toJSON())},queryMetadata:{capabilities:x,effectiveCapabilities:C,lastEditDate:h?.lastEditDate?.getTime(),
snapshotInfo:{supportsSnapshotMinThreshold:U,supportsSnapshotMaxThreshold:e,snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(e,r,C){const {definitionExpression:x,customParameters:h,gdbVersion:w,historicMoment:D,subtypeCode:I,subtypeField:g,timeExtent:A,apiKey:B}=this.layer;return b.createFeatureSourceSchema(e,{definitionExpression:x,customParameters:h,gdbVersion:w,historicMoment:D,subtypeCode:I,subtypeField:g,
timeExtent:A},r,C,B)}createProcessorSchema(e,r,C){const {fields:x,renderer:h,geometryType:w,labelingInfo:D,labelsVisible:I,orderBy:g,objectIdField:A}=this.layer,B={fields:x.map(E=>E.toJSON()),renderer:h?.clone(),featureReduction:c.getEffectiveFeatureReduction(this.layer,r),geometryType:w,labelingInfo:D,labelsVisible:I,objectIdField:A,orderBy:g??"default"};return v.createSimpleProcessorSchema(e,r,B,C)}get hasRequiredSupport(){return a.isRendererSupported(this.layer.renderer)}hasFilters(e){return y.hasFloorFilter(this.layer,
e)}addFilters(e,r){return y.addFloorFilter(this.layer,e,r)}getUpdateHashProperties(e){var r=this.layer;const {definitionExpression:C,renderer:x,gdbVersion:h,apiKey:w,subtypeCode:D}=r,I=this.layer.labelsVisible?this.layer.labelingInfo:null,g=r.historicMoment?.getTime()??void 0,A=JSON.stringify(r.customParameters),B=c.getEffectiveFeatureReduction(r,e)?.toJSON();r=JSON.stringify(r.orderBy);e=y.hasFloorFilter(this.layer,e)?e.floors:null;return{apiKey:w,customParameters:A,definitionExpression:C,featureReduction:B,
floors:e,gdbVersion:h,historicMoment:g,labelingInfo:I,orderBy:r,renderer:x,subtypeCode:D}}}k.FeatureLayerAdapter=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],function(k,n){k.exceedsMinimumSnapshotCoverage=function(q,m){q=q.extent;q=m?.clone().intersection(q);q=null!=q?q.width*q.height:0;m=m?m.width*m.height:0;m=0===m?0:q/m;q=n("featurelayer-snapshot-point-coverage");
return!isNaN(m)&&m>=q};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports","../../../../../core/sql","../../../../../layers/support/FeatureFilter"],function(k,n,q){function m(t,c,u){if(null==t.floorInfo||!u.floors?.length)return c;u=u.floors;const {floorField:y,viewAllLevelIds:p}=t.floorInfo;p.length&&(u=p);t=u.filter(l=>""!==l).map(l=>"'"+l+"'");t.push("''");c?.includes(y)&&(u=new RegExp("AND \\("+
y+".*NULL\\)","g"),c=c.replace(u,""),u=new RegExp("\\("+y+".*NULL\\)","g"),c=c.replace(u,""),c=c.replaceAll(/\s+/g," ").trim());t=("("+y+" IN ({ids}) OR "+y+" IS NULL)").replace("{ids}",t.join(", "));return n.sqlAnd(c,t)}k.addFloorFilter=function(t,c,u){t=m(t,c?.where,u);if(!t)return c;c??=new q;c.where=t;return c};k.hasFloorFilter=function(t,c){return null!=t.floorInfo&&(0<t.floorInfo.viewAllLevelIds.length||0<c.floors.length)};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define("exports ../../../../../core/Error ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y,p){class l{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const v=this.layer;b=c.getFeatureReductionDeconflictionEnabled(v,b)??c.getLayerDeconflictionEnabled(v);return[{vvEvaluators:{0:c.createLabelVVEvaluator(v.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){b=this.layer;const v=q.getEffectiveLayerCapabilities(b),{capabilities:a,objectIdField:d}=b,e=b.fieldsIndex.toJSON(),r=t.getEffectiveGeometryType(b),C=b.timeInfo?.toJSON(),x=b.spatialReference.toJSON();
if(!("openPorts"in b.source))throw new n("source-not-supported");return{type:"memory",source:await b.source.openPorts(),orderByFields:d,metadata:{fieldsIndex:e,geometryType:r,objectIdField:d,timeInfo:C,spatialReference:x,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},queryMetadata:{capabilities:a,effectiveCapabilities:v,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(b,v,a){const {definitionExpression:d,timeExtent:e}=this.layer;
return u.createFeatureSourceSchema(b,{definitionExpression:d,timeExtent:e,customParameters:null},v,a,null)}createProcessorSchema(b,v,a){const {fields:d,renderer:e,geometryType:r,labelingInfo:C,labelsVisible:x,orderBy:h,objectIdField:w}=this.layer,D={fields:d.map(I=>I.toJSON()),renderer:e?.clone(),featureReduction:m.getEffectiveFeatureReduction(this.layer,v),geometryType:r,labelingInfo:C,labelsVisible:x,objectIdField:w,orderBy:h??"default"};return y.createSimpleProcessorSchema(b,v,D,a)}get hasRequiredSupport(){return p.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(b){const v=
this.layer,{definitionExpression:a,renderer:d}=v,e=this.layer.labelsVisible?this.layer.labelingInfo:null;b=m.getEffectiveFeatureReduction(v,b)?.toJSON();return{orderBy:JSON.stringify(v.orderBy),definitionExpression:a,renderer:d,labelingInfo:e,featureReduction:b}}}k.InMemoryLayerAdapter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define("exports ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y){class p{constructor(l){this.layer=l}getLabelingDeconflictionInfo(l){const b=this.layer;l=t.getFeatureReductionDeconflictionEnabled(b,l)??t.getLayerDeconflictionEnabled(b);return[{vvEvaluators:{0:t.createLabelVVEvaluator(b.renderer)},deconflictionEnabled:l}]}async createServiceOptions(l){l=this.layer;const b=n.getEffectiveLayerCapabilities(l),{capabilities:v,objectIdField:a}=l,d=l.fieldsIndex.toJSON(),e=m.getEffectiveGeometryType(l),r=l.spatialReference.toJSON();return{type:"memory",
source:await l.source.openPorts(),orderByFields:a,metadata:{fieldsIndex:d,geometryType:e,objectIdField:a,spatialReference:r,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:v,effectiveCapabilities:b,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(l,b,v){const {definitionExpression:a}=this.layer;return c.createFeatureSourceSchema(l,{definitionExpression:a,customParameters:null},b,v,null)}createProcessorSchema(l,
b,v){const {fields:a,renderer:d,geometryType:e,labelingInfo:r,labelsVisible:C,objectIdField:x}=this.layer,h={fields:a.map(w=>w.toJSON()),renderer:d?.clone(),featureReduction:q.getEffectiveFeatureReduction(this.layer,b),geometryType:e,labelingInfo:r,labelsVisible:C,objectIdField:x,orderBy:"default"};return u.createSimpleProcessorSchema(l,b,h,v)}get hasRequiredSupport(){return y.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(l){const b=this.layer,{definitionExpression:v,renderer:a}=
b,d=this.layer.labelsVisible?this.layer.labelingInfo:null;l=q.getEffectiveFeatureReduction(b,l)?.toJSON();return{definitionExpression:v,renderer:a,labelingInfo:d,featureReduction:l}}}k.KnowledgeGraphSublayerAdapter=p;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define("exports ../../../../../core/lang ../../../../../layers/support/layerUtils ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y,p){class l{constructor(b){this.layer=b}getLabelingDeconflictionInfo(b){const v=this.layer;b=c.getFeatureReductionDeconflictionEnabled(v,b)??c.getLayerDeconflictionEnabled(v);return[{vvEvaluators:{0:c.createLabelVVEvaluator(v.renderer)},deconflictionEnabled:b}]}async createServiceOptions(b){var v=this.layer;b=q.getEffectiveLayerCapabilities(v);const {capabilities:a,objectIdField:d}=v,e=v.fieldsIndex.toJSON(),r=t.getEffectiveGeometryType(v),C=v.timeInfo?.toJSON(),x=v.spatialReference.toJSON();
v=v.source.getSource();const h=this.layer.objectIdField,w=n.clone(a);w.query.maxRecordCount=v.maxRecordCount;return{type:"ogc",source:v,orderByFields:h,metadata:{fieldsIndex:e,geometryType:r,objectIdField:d,timeInfo:C,spatialReference:x,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{capabilities:w,effectiveCapabilities:b,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(b,v,a){const {customParameters:d,timeExtent:e,
apiKey:r}=this.layer;return u.createFeatureSourceSchema(b,{customParameters:d,timeExtent:e},v,a,r)}createProcessorSchema(b,v,a){const {fields:d,renderer:e,geometryType:r,labelingInfo:C,labelsVisible:x,orderBy:h,objectIdField:w}=this.layer,D={fields:d.map(I=>I.toJSON()),renderer:e?.clone(),featureReduction:m.getEffectiveFeatureReduction(this.layer,v),geometryType:r,labelingInfo:C,labelsVisible:x,objectIdField:w,orderBy:h??"default"};return y.createSimpleProcessorSchema(b,v,D,a)}get hasRequiredSupport(){return p.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(b){var v=
this.layer;const {renderer:a,apiKey:d}=v,e=this.layer.labelsVisible?this.layer.labelingInfo:null,r=JSON.stringify(v.customParameters);b=m.getEffectiveFeatureReduction(v,b)?.toJSON();v=JSON.stringify(v.orderBy);return{apiKey:d,customParameters:r,featureReduction:b,labelingInfo:e,orderBy:v,renderer:a}}}k.OGCFeatureLayerAdapter=l;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/layerUtils ./featureReductionUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a){class d{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const r=this.layer;e=l.getFeatureReductionDeconflictionEnabled(r,e)??l.getLayerDeconflictionEnabled(r);return[{vvEvaluators:{0:l.createLabelVVEvaluator(r.renderer)},deconflictionEnabled:e}]}async createServiceOptions(e){var r=this.layer;const C=t.getEffectiveLayerCapabilities(r),{capabilities:x,objectIdField:h,globalIdField:w,orderBy:D,refreshInterval:I}=r,g=r.fieldsIndex.toJSON(),A=g.fields,B=
p.getEffectiveGeometryType(r),E=r.timeInfo?.toJSON(),H=r.spatialReference.toJSON(),G=q.clone(this.layer.parsedUrl);let J=this.layer.objectIdField;if(D?.length){var P=!D[0].valueExpression&&D[0].field;P&&(J=P)}P=0<I;e=(P=n("featurelayer-snapshot-enabled")&&"point"===r.geometryType&&x?.query.supportsPagination&&!x?.operations.supportsEditing&&!P)&&u.exceedsMinimumSnapshotCoverage(e,r.fullExtent);r=m.isHostedAgolService(G.path);return{type:"feature-service",source:G,isSourceHosted:r,orderByFields:J,
metadata:{globalIdField:w,fields:A,fieldsIndex:g,geometryType:B,objectIdField:h,timeInfo:E,spatialReference:H,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{capabilities:x,effectiveCapabilities:C,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:P,supportsSnapshotMaxThreshold:e,snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(e,
r,C){const {definitionExpression:x,customParameters:h,timeExtent:w}=this.layer;return b.createFeatureSourceSchema(e,{definitionExpression:x,customParameters:h,timeExtent:w},r,C,null)}createProcessorSchema(e,r,C){const {fields:x,renderer:h,geometryType:w,labelingInfo:D,labelsVisible:I,orderBy:g,objectIdField:A}=this.layer,B={fields:x.map(E=>E.toJSON()),renderer:h?.clone(),featureReduction:c.getEffectiveFeatureReduction(this.layer,r),geometryType:w,labelingInfo:D,labelsVisible:I,objectIdField:A,orderBy:g??
"default"};return v.createSimpleProcessorSchema(e,r,B,C)}get hasRequiredSupport(){return a.isRendererSupported(this.layer.renderer)}hasFilters(e){return y.hasFloorFilter(this.layer,e)}addFilters(e,r){return y.addFloorFilter(this.layer,e,r)}getUpdateHashProperties(e){var r=this.layer;const {definitionExpression:C,renderer:x}=r,h=this.layer.labelsVisible?this.layer.labelingInfo:null,w=JSON.stringify(r.customParameters),D=c.getEffectiveFeatureReduction(r,e)?.toJSON();r=JSON.stringify(r.orderBy);e=y.hasFloorFilter(this.layer,
e)?e.floors:null;return{orderBy:r,definitionExpression:C,renderer:x,labelingInfo:h,featureReduction:D,customParameters:w,floors:e}}}k.OrientedImageryLayerAdapter=d;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define("exports ./featureReductionUtils ./geometryUtils ./labelingUtils ../schema/processor/SimpleProcessorSchema ../support/rendererUtils".split(" "),function(k,n,q,m,t,c){class u{constructor(y){this.layer=
y}getLabelingDeconflictionInfo(y){const p=this.layer;y=m.getFeatureReductionDeconflictionEnabled(p,y)??m.getLayerDeconflictionEnabled(p);return[{vvEvaluators:{0:m.createLabelVVEvaluator(p.renderer)},deconflictionEnabled:y}]}async createServiceOptions(y){var p=this.layer;({objectIdField:y}=p);const l=q.getEffectiveGeometryType(p),b=p.timeInfo?.toJSON()||null;p=p.spatialReference?p.spatialReference.toJSON():null;return{source:this.layer.parsedUrl,metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),
geometryType:l,objectIdField:y,timeInfo:b,timeReferenceUnknownClient:null,spatialReference:p,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(y,p,l){const {definitionExpression:b,geometryDefinition:v,customParameters:a}=this.layer;return{type:"stream",service:y,tileInfoJSON:p.tileInfoJSON,mutable:{sourceRefreshVersion:l,availableFields:p.availableFields,dataFilter:{geometryDefinition:v?.toJSON(),definitionExpression:b,outSpatialReference:p.outSpatialReference.toJSON(),
customParameters:a??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(y,p,l){const {fields:b,renderer:v,geometryType:a,labelingInfo:d,labelsVisible:e,objectIdField:r}=this.layer,C={fields:b.map(x=>x.toJSON()),renderer:v?.clone(),featureReduction:n.getEffectiveFeatureReduction(this.layer,p),geometryType:a,labelingInfo:d,labelsVisible:e,objectIdField:r,orderBy:"default"};
return t.createSimpleProcessorSchema(y,p,C,l)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}getUpdateHashProperties(y){var p=this.layer;const {definitionExpression:l,renderer:b}=p,v=this.layer.labelsVisible?this.layer.labelingInfo:null,a=JSON.stringify(p.customParameters);y=n.getEffectiveFeatureReduction(p,y)?.toJSON();p=`${JSON.stringify(p.geometryDefinition)}${p.definitionExpression}`;return{definitionExpression:l,renderer:b,labelingInfo:v,featureReduction:y,customParameters:a,
streamFilter:p}}}k.StreamLayerAdapter=u;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define("exports ../../../../../core/has ../../../../../core/lang ../../../../../core/mathUtils ../../../../../core/sql ../../../../../layers/support/arcgisLayerUrl ../../../../../layers/support/FeatureFilter ../../../../../layers/support/layerUtils ./featureServiceUtils ./floorFilterUtils ./geometryUtils ./labelingUtils ../schema/SourceSchema ../schema/processor/SubtypeProcessorSchema".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a,d){function e(x,h){return x.sublayers.some(w=>!r(w,h))}function r(x,h){return x.visible&&(0===x.minScale||m.floatEqualAbsolute(h.scale,x.minScale)||h.scale<x.minScale)&&(0===x.maxScale||m.floatEqualAbsolute(h.scale,x.maxScale)||h.scale>x.maxScale)}class C{constructor(x){this.layer=x}getLabelingDeconflictionInfo(x){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every(h=>v.getLayerDeconflictionEnabled(h))}]}async createServiceOptions(x){var h=this.layer;
const w=y.getEffectiveLayerCapabilities(h),{capabilities:D,datesInUnknownTimezone:I,editingInfo:g,globalIdField:A,objectIdField:B,refreshInterval:E,subtypeField:H}=h,G=h.fieldsIndex.toJSON(),J=b.getEffectiveGeometryType(h),P=h.timeInfo?.toJSON(),T=h.spatialReference.toJSON(),S=q.clone(this.layer.parsedUrl);var O=null==g?.lastEditDate&&0<E;x=(O=n("featurelayer-snapshot-enabled")&&"point"===h.geometryType&&D?.query.supportsPagination&&!D?.operations.supportsEditing&&!O)&&p.exceedsMinimumSnapshotCoverage(x,
h.fullExtent);h=c.isHostedAgolService(S.path);return{type:"feature-service",source:S,isSourceHosted:h,orderByFields:B,metadata:{timeReferenceUnknownClient:I,subtypeField:H,globalIdField:A,fieldsIndex:G,geometryType:J,objectIdField:B,timeInfo:P,spatialReference:T,subtypes:this.layer.subtypes?.map(M=>M.toJSON()),typeIdField:null,types:null},queryMetadata:{capabilities:D,effectiveCapabilities:w,lastEditDate:g?.lastEditDate?.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:O,supportsSnapshotMaxThreshold:x,
snapshotCountThresholds:{min:n("featurelayer-snapshot-point-min-threshold"),max:n("featurelayer-snapshot-point-max-threshold")}}}}}createSourceSchema(x,h,w){const {definitionExpression:D,customParameters:I,gdbVersion:g,historicMoment:A,subtypeField:B,timeExtent:E,apiKey:H}=this.layer;var G=this.layer.sublayers.map(J=>J.subtypeCode).join(",");G={definitionExpression:t.sqlAnd(D,this.layer.sublayers.length?`${this.layer.subtypeField} IN (${G})`:"1\x3d2"),customParameters:I,gdbVersion:g,historicMoment:A,
subtypeField:B,timeExtent:E};return a.createFeatureSourceSchema(x,G,h,w,H)}createProcessorSchema(x,h,w){const D={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,I=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:I.labelingInfo,labelsVisible:I.labelsVisible,renderer:I.renderer,subtypeCode:I.subtypeCode,orderBy:null}))};return d.createSubtypeProcessorSchema(x,h,D,w)}hasFilters(x){return l.hasFloorFilter(this.layer,x)||e(this.layer,x)}addFilters(x,
h){x=l.addFloorFilter(this.layer,x,h);var w=this.layer.sublayers.filter(D=>!r(D,h)).map(D=>D.subtypeCode);if(!w.length)return x;x??=new u;w=`NOT ${this.layer.subtypeField} IN (${w.join(",")})`;x.where=t.sqlAnd(x.where,w);return x}get hasRequiredSupport(){return!0}getUpdateHashProperties(x){var h=this.layer;const {definitionExpression:w,gdbVersion:D,apiKey:I}=h,g=h.historicMoment?.getTime()??void 0;h=JSON.stringify(h.customParameters);x=l.hasFloorFilter(this.layer,x)?x.floors:null;const A="sublayers"in
this.layer&&this.layer.sublayers.items.reduce((B,E)=>B+`${E.visible?1:0}.${JSON.stringify(E.renderer)}.${E.labelsVisible}\n.${JSON.stringify(E.labelingInfo)}`,"");return{gdbVersion:D,definitionExpression:w,historicMoment:g,customParameters:h,apiKey:I,sublayerHash:A,floors:x}}setGraphicOrigin(x){var h=this.layer.fieldsIndex.get(this.layer.subtypeField);const w=x.attributes[h.name];h=this.layer.sublayers.find(D=>D.subtypeCode===w);x.layer=x.sourceLayer=h}}k.SubtypeGroupLayerAdapter=C;Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define("exports ./LabelMatcherSchema ./MatcherSchema ./StorageSchema ./VisualVariablesSchema ../../../../../webgl/capabilities".split(" "),function(k,n,q,m,t,c){async function u(l,{subtypeField:b,sublayers:v}){const a=await Promise.all(v.map(({renderer:d})=>q.createMatcherSchema(l,d)));return{type:"subtype",subtypeField:b,renderers:v.reduce((d,{subtypeCode:e},r)=>({...d,[e]:a[r]}),
{})}}function y(l,b){const v=c.getWebGLCapabilities();return{type:"subtype",filters:l.filters,capabilities:{maxTextureSize:v.maxTextureSize},subtypeField:b.subtypeField,target:"feature",bindings:b.sublayers.reduce((a,{renderer:d,subtypeCode:e})=>{d=m.createVVBindings(d);return{...a,[e]:d}},{})}}async function p(l,{subtypeField:b,sublayers:v}){const a=await Promise.all(v.map(d=>{const e=t.createVisualVariableUniforms(d.renderer);return n.createLabelMatcherSchema(l,{...d,geometryType:d.geometryType??
null},e)}));return{type:"subtype",subtypeField:b,renderers:v.reduce((d,{subtypeCode:e},r)=>({...d,[e]:a[r]}),{})}}k.createSubtypeProcessorSchema=async function(l,b,v,a){return{storage:y(b,v),mesh:{displayRefreshVersion:a,strategy:{type:"feature"},factory:{symbology:await u(l,v),labels:await p(l,v)},sortKey:null,timeZone:b.timeZone}}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/handleNoEngineError":function(){define(["exports"],function(k){k.handleNoEngineError=
async function(n,q){try{return await n}catch(m){if("no-queryEngine"!==m.name)throw m;return q}};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../engine/highlightReasons"],function(k,n){class q{constructor(){this._idToCounters=new Map}get empty(){return 0===this._idToCounters.size}addReason(m,t){for(const c of m)m=this._idToCounters.get(c),m||(m=new Map,this._idToCounters.set(c,m)),m.set(t,(m.get(t)||
0)+1)}deleteReason(m,t){for(const c of m){m=this._idToCounters.get(c);if(!m)continue;let u=m.get(t);if(null==u)break;u--;0<u?m.set(t,u):m.delete(t);0===m.size&&this._idToCounters.delete(c)}}getHighestReason(m){m=this._idToCounters.get(m);if(!m)return null;let t=null;for(const c of n.highlightReasons)m.get(c)&&(t=c);return t?t:null}ids(){return this._idToCounters.keys()}}k.HighlightCounter=q;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports",
"./TileKey"],function(k,n){function q(c,u){const y=new Set;for(const p of c instanceof Set?c.values():c.keys())u.has(p)||y.add(p);return y}class m{constructor(c){this.version=c}}class t{constructor(c){this._subscriptions=new Map;this._visible=new Set;this._paused=new Set;this._version=0;this._config=c}destroy(){}get _coverageSet(){const c=this._coverage?Array.from(this._coverage.keys()).map(u=>u.id):[];return new Set(c)}suspend(){this._suspendedOverage=this._coverage;this._coverage=null;this._updateSubscriptions()}resume(){null==
this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}update(c){this._version+=1%Number.MAX_SAFE_INTEGER;this._updateCoverage(c);this._updateSubscriptions();return new Set(this._visible)}_updateCoverage(c){this._coverage=this._config.tileInfoView.getTileCoverage(c.state,0,!0,"closest")}_updateSubscriptions(){var c=this._coverageSet;const u=this._updateVisibility();var y=q(u,c);const p=q(this._subscriptions,u),l=q(c,this._subscriptions);c=q(p,
c);y=q(y,c);y=q(y,this._paused);this._visible=u;for(const b of l.values())this._subscriptions.set(b,new m(this._version));for(const b of y.values())this._paused.add(b);for(const b of c.values())this._subscriptions.delete(b),this._paused.delete(b);(l.size||c.size||y.size)&&this._sendUpdateSubscriptions(l,c,y)}_sendUpdateSubscriptions(c,u,y){c=Array.from(c.values()).map(p=>({tileId:p,version:this._subscriptions.get(p).version}));this._config.updateSubscriptions({subscribe:c,unsubscribe:Array.from(u.values()),
pause:Array.from(y.values()),tileInfoJSON:this._config.tileInfoView.tileInfo.toJSON()})}_updateVisibility(){const c=new Set;if(!this._coverage)return c;for(const u of this._coverage.keys())this._config.isDone(u)?c.add(u.id):this._addVisibleParent(c,u)||this._addVisibleChildren(c,u)||c.add(u.id);return c}_addVisibleParent(c,u){let y=!1;for(const p of this._visible.values())(new n(p)).containsChild(u)&&(c.add(p),y=!0);return y}_addVisibleChildren(c,u){let y=!1;for(const p of this._visible.values()){const l=
new n(p);u.containsChild(l)&&(c.add(p),y=!0)}return y}}k.FeatureTileSubscriptionManager=t;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(k,n,q,m,t,c,u,y,p,l,b,v,a,d,e,r,C){return x=>{x=class extends x{constructor(...h){super(...h);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([t.watch(()=>{const h=this.layer;return[h&&"elevationInfo"in h?h.elevationInfo?.featureExpressionInfo:null,h&&"displayField"in h?h.displayField:null,h&&"timeInfo"in h&&h.timeInfo,h&&"renderer"in h&&h.renderer,h&&"labelingInfo"in
h&&h.labelingInfo,h&&"floorInfo"in h&&h.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),t.syncAndInitial),t.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),t.on(()=>{const h=this.layer;return h&&"sublayers"in h?h.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:h,layer:{fieldsIndex:w},requiredFields:D}=this;return"outFields"in h&&h.outFields?a.fixFields(w,
[...a.unpackFieldNames(w,h.outFields),...D]):a.fixFields(w,D)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(h){this._override("featureEffect",h)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(h){q.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(h){throw Error("missing implementation");}createQuery(){var h=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};h=null!=this.filter?this.filter.createQuery(h):new e(h);if("floorInfo"in this.layer&&this.layer.floorInfo){const w=d.getFloorFilterClause(this);null!=w&&(h.where=h.where?`(${h.where}) AND (${w})`:w)}null!=this.timeExtent&&(h.timeExtent=null!=h.timeExtent?h.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return h}createAggregateQuery(){return new e({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(h,
w){throw Error("missing implementation");}queryObjectIds(h,w){throw Error("missing implementation");}queryFeatureCount(h,w){throw Error("missing implementation");}queryExtent(h,w){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(h,w){this._validateFetchPopupFeatures(h,w);return this._fetchPopupFeatures(h,w)}_loadArcadeModules(h){return h.expressionInfos?.length||Array.isArray(h.content)&&h.content.some(w=>"expression"===w.type)?r.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const h=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",h);h.then(()=>{this._updatingRequiredFieldsPromise===h&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var h="3d"===this.view.type,{layer:w,layer:{fieldsIndex:D,objectIdField:I}}=this,g="renderer"in w&&w.renderer,A="orderBy"in w&&w.orderBy,B="featureReduction"in w?w.featureReduction:null,E=new Set;g=await Promise.allSettled([g?g.collectRequiredFields(E,D):null,a.collectLabelingFields(E,
w),h&&"elevationInfo"in w?a.collectElevationFields(E,w):null,null!=this.filter?a.collectFilterFields(E,w,this.filter):null,h||null==this.featureEffect?null:a.collectFilterFields(E,w,this.featureEffect.filter),!h&&B?a.collectFeatureReductionFields(E,w,B):null,!h&&A?a.collectOrderByInfos(E,w,A):null]);"timeInfo"in w&&w.timeInfo&&this.timeExtent&&a.collectFields(E,w.fieldsIndex,[w.timeInfo.startField,w.timeInfo.endField]);"floorInfo"in w&&w.floorInfo&&a.collectFields(E,w.fieldsIndex,[w.floorInfo.floorField]);
"feature"===w.type&&h&&null!=w.infoFor3D&&(null==w.globalIdField&&q.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),a.collectFields(E,w.fieldsIndex,[w.globalIdField]));"subtype-group"===w.type&&(a.collectField(E,D,w.subtypeField),A=w.sublayers.map(H=>Promise.all([H.renderer?.collectRequiredFields(E,D),a.collectLabelingFields(E,H)])),await Promise.allSettled(A));"catalog-footprint"===w.type&&a.collectFields(E,D,[w.parent.itemSourceField,w.parent.itemTypeField]);for(const H of g)"rejected"===
H.status&&q.getLogger(this).error(H.reason);a.collectField(E,D,I);h&&"displayField"in w&&w.displayField&&a.collectField(E,D,w.displayField);h=Array.from(E).sort();this._set("requiredFields",h)}}_validateFetchPopupFeatures(h,w){if(null!=w)for(const D of h){h=D.origin&&"layer"in D.origin?D.origin.layer:D.layer;if("popupEnabled"in h&&!h.popupEnabled)throw new n("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:h});if(D.isAggregate){const I="featureReduction"in h?h.featureReduction:null;
if(!(I&&"popupTemplate"in I&&I.popupEnabled&&I.popupTemplate))throw new n("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:h});}else if("popupTemplate"in h&&!C.getFetchPopupTemplate(h,w))throw new n("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:h});}}_popupFeatureHasRequiredFields(h,w){return a.featureHasFields(w,h)}async _fetchPopupFeatures(h,w){const D=Array(h.length),I=new Map,g=await this._createPopupQuery(h.map(B=>B.origin?.layer??B.layer),
w);for(let B=0;B<h.length;B++){const E=h[B];if(E.isAggregate){D[B]=E;continue}var A=E.origin?.layer??E.layer;if(!(A&&"popupEnabled"in A))continue;const H=a.unpackFieldNames(this.layer.fieldsIndex,g.outFields);A=C.getFetchPopupTemplate(A,w);if(null==A)continue;const G=await this._loadArcadeModules(A);m.throwIfAborted(w);G&&G.arcadeUtils.hasGeometryOperations(A)||!this._popupFeatureHasRequiredFields(E,H)?I.set(E.getObjectId(),{graphic:E,index:B}):D[B]=E}if("stream"===this.layer.type||0===I.size)return D.filter(Boolean);
g.objectIds=Array.from(I.keys());try{const B=await this.layer.queryFeatures(g,w);for(const E of B.features){const {graphic:{geometry:H,origin:G},index:J}=I.get(E.getObjectId());let P;(P=E).geometry||(P.geometry=H);E.origin=G;D[J]=E}}catch{}return D.filter(Boolean)}async _createPopupQuery(h,w){const D=this.layer.createQuery(),I=new Set;var g=!1;h=h??[this.layer];for(const A of h)if("popupEnabled"in A&&(h=C.getFetchPopupTemplate(A,w),null!=h)){g=await this._loadArcadeModules(h);m.throwIfAborted(w);
g=g&&g.arcadeUtils.hasGeometryOperations(h);g=!("point"!==this.layer.geometryType&&!g);h=await C.getRequiredFields(this.layer,h);m.throwIfAborted(w);for(const B of h)I.add(B)}D.returnGeometry=g;D.returnZ=g;D.returnM=g;D.outFields=Array.from(I);D.outSpatialReference=this.view.spatialReference;"floorInfo"in this.layer&&this.layer.floorInfo&&(w=d.getFloorFilterClause(this),null!=w&&(D.where=D.where?`(${D.where}) AND (${w})`:w));return D}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?
!1:!0}getTest(){return{createPopupQuery:h=>this._createPopupQuery(void 0,h)}}get test(){return this.getTest()}};k.__decorate([c.property()],x.prototype,"_updatingRequiredFieldsPromise",void 0);k.__decorate([c.property({readOnly:!0})],x.prototype,"availableFields",null);k.__decorate([c.property({readOnly:!0})],x.prototype,"dataUpdating",void 0);k.__decorate([c.property({type:b})],x.prototype,"featureEffect",null);k.__decorate([c.property({type:v})],x.prototype,"filter",void 0);k.__decorate([c.property(l.combinedViewLayerTimeExtentProperty)],
x.prototype,"timeExtent",void 0);k.__decorate([c.property()],x.prototype,"layer",void 0);k.__decorate([c.property({type:Number})],x.prototype,"maximumNumberOfFeatures",null);k.__decorate([c.property({readOnly:!0,type:Boolean})],x.prototype,"maximumNumberOfFeaturesExceeded",null);k.__decorate([c.property({readOnly:!0})],x.prototype,"requiredFields",void 0);k.__decorate([c.property()],x.prototype,"suspended",void 0);k.__decorate([c.property()],x.prototype,"view",void 0);return x=k.__decorate([p.subclass("esri.views.layers.FeatureLayerView")],
x)}})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(k){function n(q,m){if(!q?.length)return null;q=q.filter(t=>""!==t).map(t=>`'${t}'`);q.push("''");return`${m} IN (${q.join(",")}) OR ${m} IS NULL`}k.getFloorFilterClause=function(q){const m=q.layer;return"floorInfo"in m&&m.floorInfo?.floorField&&"floors"in q.view?n(q.view.floors,m.floorInfo.floorField):null};k.getLayerFloorFilterClause=function(q,m){return"floorInfo"in m&&m.floorInfo?.floorField?n(q,m.floorInfo.floorField):
null};Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(k,n){function q(m,t){return m.popupTemplate?m.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=m.defaultPopupTemplate?m.defaultPopupTemplate:null}k.getFetchPopupTemplate=q;k.getRequiredFields=async function(m,t=m.popupTemplate){if(null==t)return[];const c=await t.getRequiredFields(m.fieldsIndex);({lastEditInfoEnabled:t}=
t);const {objectIdField:u,typeIdField:y,globalIdField:p,relationships:l}=m;if(c.includes("*"))return["*"];t=t?n.getFeatureEditFields(m):[];const b=n.fixFields(m.fieldsIndex,[...c,...t]);y&&b.push(y);b&&u&&m.fieldsIndex?.has(u)&&!b.includes(u)&&b.push(u);b&&p&&m.fieldsIndex?.has(p)&&!b.includes(p)&&b.push(p);l&&l.forEach(v=>{({keyField:v}=v);b&&v&&m.fieldsIndex?.has(v)&&!b.includes(v)&&b.push(v)});return b};k.hasPopupTemplate=function(m,t){return null!=q(m,{defaultPopupTemplateEnabled:t})};Object.defineProperty(k,
Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(k,n,q,m,t,c,u,y){return p=>{p=class extends p{initialize(){this.addHandles(m.on(()=>this.layer,"refresh",l=>{this.doRefresh(l.dataChanged).catch(b=>{q.isAbortError(b)||n.getLogger(this).error(b)})}),
"RefreshableLayerView")}};return p=k.__decorate([y.subclass("esri.layers.mixins.RefreshableLayerView")],p)}})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../AggregateGraphic ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../layers/effects/FeatureEffectView ../../../layers/support/FeatureFilter ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../rest/support/AggregateFeatureSet ../../../rest/support/FeatureSet ../../../rest/support/Query ../engine/highlightReasons ./LayerView2D ./features/FeatureContainer ./features/FeaturePipelineWorkerProxy ./features/FeatureSourceEventLog ./features/layerAdapters/CatalogFootprintLayerAdapter ./features/layerAdapters/FeatureLayerAdapter ./features/layerAdapters/InMemoryLayerAdapter ./features/layerAdapters/KnowledgeGraphSublayerAdapter ./features/layerAdapters/OGCFeatureLayerAdapter ./features/layerAdapters/OrientedImageryLayerAdapter ./features/layerAdapters/StreamLayerAdapter ./features/layerAdapters/SubtypeGroupLayerAdapter ./features/schema/processor/symbols/ComplexSymbolSchema ./support/FeatureCommandQueue ./support/handleNoEngineError ./support/HighlightCounter ../tiling/FeatureTileSubscriptionManager ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView ../../../geometry/Extent".split(" "),function(k,
n,q,m,t,c,u,y,p,l,b,v,a,d,e,r,C,x,h,w,D,I,g,A,B,E,H,G,J,P,T,S,O,M,U,V,W,Y,ca,Q,da,ea,R,Z,ba,ha){function ia(f,z){const F=new Set;f&&f.forEach(K=>F.add(K));z&&z.forEach(K=>F.add(K));return F.has("*")?["*"]:Array.from(F)}q=class extends R(ba(E.LayerView2DMixin(Z))){constructor(){super(...arguments);this._commandsQueue=new ca({process:f=>{switch(f.type){case "processed-edit":return this._doEdit(f);case "update":return this._doUpdate()}}});this._visibilityOverrides=new Set;this._highlightCounter=new da.HighlightCounter;
this._updateHighlight=a.debounce(async()=>{const f=[];for(const F of this._highlightCounter.ids()){var z=this._highlightCounter.getHighestReason(F);z=B.getHighlightBits(z);f.push({objectId:F,highlightFlags:z})}this._worker.pipeline.updateHighlight({highlights:f})});this._lastAvailableFields=[];this.eventLog=new J.FeatureSourceEventLog;this._displayRefreshVersion=this._sourceRefreshVersion=1;this._pipelineUpdating=!1;this._fields=null;this.featureEffectView=new x}destroy(){this._worker?.destroy();
this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(this._initProxy());this.featureEffectView.featureEffect=this.featureEffect;this.featureEffectView.endTransitions()}async _initProxy(){var f=this.layer;if("isTable"in f&&f.isTable)throw new y("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:f});if("mesh"===f.geometryType)throw new y("featurelayerview:geometry-type-not-supported",`Geometry type of ${f.geometryType} is not supported`,{layer:f});
if(("feature"===f.type||"subtype-group"===f.type)&&!1===D.getEffectiveLayerCapabilities(f)?.operations.supportsQuery)throw new y("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:f});this._worker&&this._worker.destroy();f=this._createClientOptions();this._worker=await G.createFeaturePipelineWorkerProxy(f)}get hasAllFeatures(){return this.layer.visible&&this.eventLog.hasAllFeatures}get hasAllFeaturesInView(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}get hasFullGeometries(){return this.layer.visible&&
this.eventLog.hasFullGeometries}get labelingCollisionInfos(){const f=this.layerAdapter.getLabelingDeconflictionInfo(this.view),z=this.layer.geometryType,F=!this.suspended;return f.map(({vvEvaluators:K,deconflictionEnabled:L})=>({container:this.featureContainer,vvEvaluators:K,deconflictionEnabled:L,geometryType:z,visible:F}))}get layerAdapter(){switch(this.layer.type){case "feature":return"memory"===this.layer.source.type?new S.InMemoryLayerAdapter(this.layer):new T.FeatureLayerAdapter(this.layer);
case "geojson":case "csv":case "wfs":return new S.InMemoryLayerAdapter(this.layer);case "subtype-group":return new W.SubtypeGroupLayerAdapter(this.layer);case "ogc-feature":return new M.OGCFeatureLayerAdapter(this.layer);case "stream":return new V.StreamLayerAdapter(this.layer);case "oriented-imagery":return new U.OrientedImageryLayerAdapter(this.layer);case "knowledge-graph-sublayer":return new O.KnowledgeGraphSublayerAdapter(this.layer);case "catalog-footprint":return new P.CatalogFootprintLayerAdapter(this.layer);
default:u.neverReached(this.layer)}return null}get updateHash(){if(!this.layerAdapter)return null;const {availableFields:f,_displayRefreshVersion:z,timeExtent:F,clips:K,filter:L,featureEffect:N,_sourceRefreshVersion:X,view:{timeZone:aa}}=this,fa=JSON.stringify(K),ja=N?.toJSON(),ka=L?.toJSON();return JSON.stringify({availableFields:f,clipsHash:fa,displayRefreshVersion:z,effectHash:ja,filterHash:ka,sourceRefreshVersion:X,timeExtent:F,timeZone:aa,...this.layerAdapter.getUpdateHashProperties(this.view)})}getDisplayStatistics(f,
z){return this.featureContainer?.getDisplayStatistics(f,z)}async queryHeatmapStatistics(f){return this._worker.pipeline.queryHeatmapStatistics(f)}highlight(f,z="highlight"){let F;f instanceof m?F=[f.getObjectId()]:"number"===typeof f||"string"===typeof f?F=[f]:c.isCollection(f)&&0<f.length?F=f.map(L=>L?.getObjectId()).toArray():Array.isArray(f)&&0<f.length&&(F="number"===typeof f[0]||"string"===typeof f[0]?f:f.map(L=>L?.getObjectId()));const K=F?.filter(t.isSome);if(!K?.length)return p.makeHandle();
this._addHighlight(K,z);return p.makeHandle(()=>this._removeHighlight(K,z))}getHighlightIds(){return Array.from(this._highlightCounter.ids())}hasHighlight(){return!this._highlightCounter.empty}async hitTest(f,z){z=await this.featureContainer.hitTest(z);if(0===z.length)return null;const {features:F,aggregates:K}=await this._worker.pipeline.getDisplayFeatures(z),L=this.featureContainer.getSortKeys(z);z=({displayId:N},{displayId:X})=>L.has(N)&&L.has(X)?L.get(N)-L.get(X):N-X;F.sort(z).reverse();K.sort(z).reverse();
return[...K.map(N=>this._createGraphicHit(f,n.fromJSON(N))),...F.map(N=>this._createGraphicHit(f,m.fromJSON(N)))]}queryStatistics(){return Q.handleNoEngineError(this._worker.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}querySummaryStatistics(f,z,F){z={...z,scale:this.view.scale};f=this._worker.features.executeQueryForSummaryStatistics(this._cleanUpQuery(f),z,F);return Q.handleNoEngineError(f,{})}async queryAggregateSummaryStatistics(f,z,F){z={...z,scale:this.view.scale};
f=this._worker.aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(f),z,F);return Q.handleNoEngineError(f,{})}async queryUniqueValues(f,z,F){z={...z,scale:this.view.scale};f=this._worker.features.executeQueryForUniqueValues(this._cleanUpQuery(f),z,F);return Q.handleNoEngineError(f,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(f,z,F){z={...z,scale:this.view.scale};f=this._worker.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(f),z,F);return Q.handleNoEngineError(f,
{uniqueValueInfos:[]})}async queryClassBreaks(f,z,F){z={...z,scale:this.view.scale};f=this._worker.features.executeQueryForClassBreaks(this._cleanUpQuery(f),z,F);return Q.handleNoEngineError(f,{classBreakInfos:[]})}async queryAggregateClassBreaks(f,z,F){z={...z,scale:this.view.scale};f=this._worker.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(f),z,F);return Q.handleNoEngineError(f,{classBreakInfos:[]})}async queryHistogram(f,z,F){z={...z,scale:this.view.scale};f=this._worker.features.executeQueryForHistogram(this._cleanUpQuery(f),
z,F);return Q.handleNoEngineError(f,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(f,z,F){z={...z,scale:this.view.scale};f=this._worker.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(f),z,F);return Q.handleNoEngineError(f,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(f,z){return this.queryFeaturesJSON(f,z).then(F=>{F=g.fromJSON(F);F.features.forEach(K=>this._setLayersForFeature(K));return F})}async queryVisibleFeatures(f,
z){f=this._worker.pipeline.queryVisibleFeatures(this._cleanUpQuery(f),z);f=await Q.handleNoEngineError(f,{features:[]});f=g.fromJSON(f);f.features.forEach(F=>this._setLayersForFeature(F));return f}async queryAggregates(f,z){f=this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(f),z);f=await Q.handleNoEngineError(f,{features:[]});f=I.fromJSON(f);f.features.forEach(F=>this._setLayersForFeature(F));return f}queryAggregateIds(f,z){f=this._worker.aggregates.executeQueryForIds(this._cleanUpAggregateQuery(f),
z);return Q.handleNoEngineError(f,[])}queryAggregateCount(f,z){f=this._worker.aggregates.executeQueryForCount(this._cleanUpAggregateQuery(f),z);return Q.handleNoEngineError(f,0)}queryAggregateJSON(f,z){f=this._worker.aggregates.executeQuery(this._cleanUpAggregateQuery(f),z);return Q.handleNoEngineError(f,{features:[]})}async queryFeaturesJSON(f,z){f=this._worker.features.executeQuery(this._cleanUpQuery(f),z);return Q.handleNoEngineError(f,{features:[]})}queryObjectIds(f,z){f=this._worker.features.executeQueryForIds(this._cleanUpQuery(f),
z);return Q.handleNoEngineError(f,[])}queryFeatureCount(f,z){f=this._worker.features.executeQueryForCount(this._cleanUpQuery(f),z);return Q.handleNoEngineError(f,0)}async queryExtent(f,z){f=this._worker.features.executeQueryForExtent(this._cleanUpQuery(f),z);f=await Q.handleNoEngineError(f,{count:0,extent:null});return{count:f.count,extent:ha.fromJSON(f.extent)}}async getSampleFeatures(f){return this._worker.pipeline.getSampleFeatures(f)}setVisibility(f,z){z?this._visibilityOverrides.delete(f):this._visibilityOverrides.add(f);
this._update()}update(f){this._subscriptionManager&&(f=this._subscriptionManager.update(f),this.featureContainer.setVisibleTiles(f))}attach(){l("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach");this.featureContainer=new H.FeatureContainer(this);this.container.addChild(this.featureContainer);this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`);this._subscriptionManager=new ea.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:f=>
{this.featureContainer.updateSubscriptions(f);this._worker.pipeline.updateSubscriptions(f)},isDone:f=>this.featureContainer.isDone(f)});this.requestUpdate();this.addAttachHandles([d.watch(()=>this.updateHash,()=>this._update(),d.initial),d.watch(()=>this.updateSuspended,f=>{f||this._subscriptionManager.resume()})]);"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",f=>this._edit(f)))}detach(){l("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach");
this._fields=null;this.featureContainer.destroy();this._commandsQueue.clear();this.container.removeAllChildren();this._subscriptionManager=v.destroyMaybe(this._subscriptionManager);this._worker.pipeline.onDetach()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){const f="renderer"in this.layer&&null!=this.layer.renderer,z=this._commandsQueue.updateTracking.updating,F=null!=this._updatingRequiredFieldsPromise,K=this.featureContainer.updatingHandles.updating,
L=f&&(z||F)||K||this._pipelineUpdating||this.dataUpdating;if(l("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${L}\n  -> hasRenderer ${f}\n  -> updatingRequiredFields ${F}\n  -> hasPendingCommand ${z}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${K}\n`);for(const N of this.featureContainer.subscriptions())console.log(`    -> Tile[${N.id}] Done: ${N.done}`)}return L}_createClientOptions(){const f=this;return{get container(){return f.featureContainer},
setUpdating:z=>{this._set("_pipelineUpdating",z.pipeline);this._set("dataUpdating",z.data)},emitEvent:z=>{this.emit(z.name,z.event)},get eventLog(){return f.eventLog},fetch:z=>Promise.all(z.map(F=>f.view.stage.painter.textureManager.rasterizeItem(F))),fetchDictionary:z=>Promise.all(z.map(F=>this._fetchDictionaryRequest(F)))}}async _fetchDictionaryRequest(f){try{if("subtype-group"===this.layer.type)throw Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const z=this.layer.renderer;
if(!z||"dictionary"!==z.type)throw Error("InternalError: Expected layer to have a DictionaryRenderer");const F=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==F.type)throw Error("InternalError: Expected schema to be of type 'dictionary'");const K={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:F.scaleExpression};this._fields||(this._fields=this.layer.fields.map(X=>
X.toJSON()));const L=F.visualVariableUniforms,N=await z.getSymbolAsync(f.feature,{fields:this._fields});return N&&N.data?{type:"dictionary-response",meshes:await Y.createComplexSymbolInstances(N.data,{uniforms:L,path:"renderer",schemaOptions:K})}:{type:"dictionary-response",meshes:[]}}catch(z){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(f){f=A.from(f)||this.createQuery();f.outSpatialReference||(f.outSpatialReference=this.view.spatialReference);return f.toJSON()}_cleanUpAggregateQuery(f){f=
A.from(f)||this.createAggregateQuery();f.outSpatialReference||(f.outSpatialReference=this.view.spatialReference);const z=f.objectIds??[];for(const F of f.aggregateIds??[])z.push(F);f.objectIds=z;f.aggregateIds=[];return f.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(f){if(this.updateSuspended)this._subscriptionManager.suspend();else if(this._validateEdit(f))return this._commandsQueue.push({type:"edit",edits:f}).catch(a.throwIfNotAbortError)}async doRefresh(f){this.attached&&
(this.updateSuspended&&f||(f?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%4294967294+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%4294967294+1}_validateEdit(f){const z="globalIdField"in this.layer&&this.layer.globalIdField,F=f.deletedFeatures.some(L=>-1===L.objectId||!L.objectId),K=z&&this.availableFields.includes(z);return F&&
!K?(b.getLogger(this).error(new y("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${z} to be included the layer's outFields for updates to be reflected on the map`)),null):f}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{if(await this._updateRequiredFields(),
!this.destroyed&&this.layerAdapter?.hasRequiredSupport&&this._subscriptionManager){var f=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads();f.updateStart();var z=this.featureEffect,F={store:f,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},K=await this.layerAdapter.createServiceOptions(this.view),L=this._createViewSchemaConfig(),N={source:this.layerAdapter.createSourceSchema(K,
L,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(F,L,this._displayRefreshVersion)},X=!!C.diff(this._lastSchema?.source.mutable,N.source.mutable)||!!C.diff(this._lastSchema?.processor,N.processor);if(X){this._lastSchema=N;this._fields=null;var aa=Math.round(performance.now());l("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${aa}] FeatureLayerView2D._doUpdate`,{changes:X});F=[];Array.isArray(K.source)&&(F=K.source);await this._worker.pipeline.updateSchema(N,
aa,{transferList:F});f.updateEnd();this.featureEffectView.featureEffect=z;this.featureEffectView.endTransitions();this.featureContainer.attributeView.unlockTextureUploads();this.featureContainer.swapRenderState();this.featureContainer.requestRender();l("esri-2d-update-debug")&&console.debug(`Version[${aa}] FeatureLayerView2D.updateEnd`);this.requestUpdate()}else this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),f.updateEnd(),this.featureEffectView.featureEffect=
z}}catch(fa){l("esri-2d-update-debug")&&console.error("Encountered an error during update",fa)}}async _doEdit(f){try{this.featureContainer.editStart(),await this._worker.pipeline.onEdits(f),this.featureContainer.editEnd()}catch(z){a.isAbortError(z)}}get hasFilter(){const f=this.layerAdapter.hasFilters?.(this.view)??!1;return null!=this.filter||null!=this.timeExtent||0<this._visibilityOverrides.size||f}_getEffectiveAvailableFields(f){this._lastAvailableFields=f=ia(this._lastAvailableFields,f);return w.packFields(this.layer.fieldsIndex,
f)}_createViewSchemaConfig(){var f=this.view,z=this.layerAdapter,F=this.timeExtent,K=this._visibilityOverrides,L=this.filter;L&&=L.clone();const N=null!=L?L.timeExtent:null;if(F=null!=F&&null!=N?F.intersection(N):F||N)L??=new h,L.timeExtent=F;L=z.addFilters?.(L,f)??L;f=L?.toJSON()??null;K.size&&(f??=(new h).toJSON(),f.hiddenIds=Array.from(K));K=this.featureEffect?.filter?.toJSON()??null;K=[f,K];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:K,outSpatialReference:this.view.spatialReference,
tileInfoJSON:this.view.featuresTilingScheme.tileInfo.toJSON(),scale:this.view.scale,timeZone:this.view.timeZone}}_addHighlight(f,z){this._highlightCounter.addReason(f,z);this._updateHighlight().catch(F=>{a.isAbortError(F)||b.getLogger(this).error(F)})}_removeHighlight(f,z){this._highlightCounter.deleteReason(f,z);this._updateHighlight().catch(F=>{a.isAbortError(F)||b.getLogger(this).error(F)})}_setLayersForFeature(f){f.layer=f.sourceLayer=this.layer;this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(f)}_createGraphicHit(f,
z){this._setLayersForFeature(z);null!=z.geometry&&(z.geometry.spatialReference=this.view.spatialReference);return{type:"graphic",graphic:z,layer:this.layer,mapPoint:f}}};k.__decorate([e.property()],q.prototype,"_worker",void 0);k.__decorate([e.property()],q.prototype,"_commandsQueue",void 0);k.__decorate([e.property()],q.prototype,"_sourceRefreshVersion",void 0);k.__decorate([e.property()],q.prototype,"_displayRefreshVersion",void 0);k.__decorate([e.property({readOnly:!0})],q.prototype,"_pipelineUpdating",
void 0);k.__decorate([e.property({readOnly:!0})],q.prototype,"hasAllFeatures",null);k.__decorate([e.property({readOnly:!0})],q.prototype,"hasAllFeaturesInView",null);k.__decorate([e.property({readOnly:!0})],q.prototype,"hasFullGeometries",null);k.__decorate([e.property()],q.prototype,"featureEffectView",void 0);k.__decorate([e.property()],q.prototype,"labelingCollisionInfos",null);k.__decorate([e.property()],q.prototype,"layerAdapter",null);k.__decorate([e.property()],q.prototype,"updateHash",null);
k.__decorate([e.property()],q.prototype,"updating",void 0);return q=k.__decorate([r.subclass("esri.views.2d.layers.FeatureLayerView2D")],q)});