// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define("exports ../../../core/Error ../../../core/has ../../../core/maybe ../../../core/scheduling ../../../core/signal ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../symbols/cim/cimAnalyzer ./Container ./ManagedCanvas ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/PooledUint32Array ./webgl/Profiler ./webgl/TileReshuffleManager ./webgl/shaderGraph/techniques/TechniqueRegistry ../support/Timeline ../../support/screenshotUtils ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/RenderbufferDescriptor ../../webgl/RenderingContext ../../webgl/TextureDescriptor ../../../core/imageUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A,z,C,D){class F extends a.Container{constructor(G,B){super();this._trash=new Set;this._lastFrameRenderTime=this._renderRemainingTime=0;this._renderRequested=n.signal(!1);this.stage=this;this._stationary=!0;this._reshuffleManager=new u.TileReshuffleManager;this._canvas=new c.ManagedCanvas(G);this.context=new z.RenderingContext(this._canvas.gl,B.contextOptions??{});this.painter=new t(this.context,this);this._cimAnalyzer=new b.CIMAnalyzer(this.painter.textureManager.resourceManager);
p("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),G.appendChild(this._debugOutput));const I=()=>this._highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:B.timeline||new r.Timeline,renderingOptions:B.renderingOptions,
requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new l.Profiler(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return I()},reshuffleManager:this._reshuffleManager,backgroundColor:B.backgroundColor};this._taskHandle=k.addFrameTask({render:H=>this.renderFrame(H)});this._taskHandle.pause();this._lostWebGLContextHandle=this._canvas.events.on("webgl-context-lost",H=>this.emit("webgl-error",{error:new g("webgl-context-lost",H.statusMessage)}));
this._bufferPool=new m.ArrayBufferPool;v.startup()}destroy(){v.shutdown(this.context);this.removeAllChildren();this._emptyTrash();this._taskHandle=h.removeMaybe(this._taskHandle);this._lostWebGLContextHandle=h.removeMaybe(this._lostWebGLContextHandle);this._canvas.destroy();this._debugOutput?.parentNode?.removeChild(this._debugOutput);this._bufferPool.destroy();this.painter.dispose();this.context.dispose();this._canvas=null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(G){this._renderParameters.backgroundColor=
G;this.requestRender()}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(G){this._renderingOptions=G;this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(G){this._state=G;this.requestRender()}get stationary(){return this._stationary}set stationary(G){this._stationary!==G&&(this._stationary=G,this.requestRender())}trashDisplayObject(G){this._trash.add(G);
this.requestRender()}untrashDisplayObject(G){return this._trash.delete(G)}requestRender(){this._renderRemainingTime=2E3;this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(G){this._renderRemainingTime-=this._lastFrameRenderTime?G.time-this._lastFrameRenderTime:0;0>=this._renderRemainingTime&&this._taskHandle.pause();this._lastFrameRenderTime=G.time;this._renderRequested.value=!1;this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;
this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this._renderParameters.time=G.time;this._renderParameters.deltaTime=G.deltaTime;this._renderParameters.effects=null;this.processRender(this._renderParameters);this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:d.create()}}renderChildren(G){for(const B of this.children)B.beforeRender(G);this._reshuffleManager.reshuffle(q.MAX_TILE_RESHUFFLES_PER_FRAME);this._canvas.render(G,()=>this._renderChildren(this.children,
G));for(const B of this.children)B.afterRender(G)}_renderChildren(G,B){const I=this.context;this.painter.textureUploadManager.upload();I.resetInfo();B.profiler.recordStart("drawLayers");B.dataUploadCounter=0;this.painter.beforeRenderPhases(B,B.backgroundColor,this.state.padding);B.drawPhase=f.WGLDrawPhase.MAP;for(const H of G)H.processRender(B);if(this.children.some(H=>H.hasHighlight)){B.drawPhase=f.WGLDrawPhase.HIGHLIGHT;for(const H of G)H.processRender(B)}if(this.children.some(H=>H.hasLabels)){B.drawPhase=
f.WGLDrawPhase.LABEL;for(const H of G)H.processRender(B)}if(p("esri-tiles-debug")){B.drawPhase=f.WGLDrawPhase.DEBUG;for(const H of G)H.processRender(B)}this.painter.afterRenderPhases(B);B.profiler.recordEnd("drawLayers");I.logInfo()}doRender(G){const B=this.context,{state:I,pixelRatio:H}=G;this._canvas.resize(G);B.setViewport(0,0,H*I.size[0],H*I.size[1]);B.setDepthWriteEnabled(!0);B.setStencilWriteMask(255);this.renderChildren(G)}async takeScreenshot(G,B,I,H){const K=Math.round(this.state.size[0]*
G.resolutionScale),O=Math.round(this.state.size[1]*G.resolutionScale);var R=G.resolutionScale,E=this.context,J=this._state.clone();if(null!=H){const Q=J.viewpoint;J.viewpoint.rotation=H;J.viewpoint=Q}H={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:J,pixelRatio:R,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:I};I=new C.TextureDescriptor(K,O);I.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;I.internalFormat=x.SizedPixelFormat.RGBA8;
I.isImmutable=!0;I=new w.FramebufferObject(E,I,new A.RenderbufferDescriptor(x.RenderbufferFormat.DEPTH_STENCIL,K,O));R=E.getBoundFramebufferObject();J=E.getViewport();E.bindFramebuffer(I);E.setViewport(0,0,K,O);this._renderChildren(B??this.children,H);B=this._readbackScreenshot(I,{...G.cropArea,y:O-(G.cropArea.y+G.cropArea.height)});E.bindFramebuffer(R);E.setViewport(J.x,J.y,J.width,J.height);this.requestRender();E=await B;1===G.outputScale?G=E:(G=new ImageData(Math.round(E.width*G.outputScale),Math.round(E.height*
G.outputScale)),y.resampleHermite(E,G,!0));I.dispose();return G}async _readbackScreenshot(G,B){const I=D.createEmptyImageData(B.width,B.height,document.createElement("canvas"));await G.readPixelsAsync(B.x,B.y,B.width,B.height,x.PixelFormat.RGBA,x.PixelType.UNSIGNED_BYTE,new Uint8Array(I.data.buffer));return I}_emptyTrash(){for(;0<this._trash.size;){const G=Array.from(this._trash);this._trash.clear();for(const B of G)B.processDetach()}}}e.Stage=F;e.extraRenderTime=2E3;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/cimAnalyzer":function(){define("exports ../../core/colorUtils ../../core/fontUtils ../../core/lang ../../core/Logger ../../core/screenUtils ../../core/string ./CIMSymbolHelper ./defaultCIMValues ./enums ./OverrideHelper ./SDFHelper ./utils ./effects/CIMEffectHelper ../../views/2d/engine/webgl/definitions".split(" "),function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){function u(x){return x&&0===x.indexOf("Level_")&&(x=parseInt(x.substr(6),10),!isNaN(x))?x:0}function v(x){var w=
x.symbolLayers;if(!w||2!==w.length)return!1;x=w.find(A=>A.effects?.find(z=>"CIMGeometricEffectDashes"===z.type&&null!=z.dashTemplate));w=w.find(A=>A.effects?.find(z=>"CIMGeometricEffectAddControlPoints"===z.type));return!!x||!!w}function r(x){return h.clone(x).map(w=>({...w,propertyName:t.uncapitalize(w.propertyName)}))}class y{constructor(x){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[];x&&(this._resourceManager=x)}analyzeSymbolReference(x,w,A){this._cimLayers=A??[];if(!x)return this._cimLayers;
this._reset();if(x.primitiveOverrides){this._primitiveOverrides=x.primitiveOverrides;for(const z of this._primitiveOverrides)(A=z.valueExpressionInfo)?this._setPoMap(z.primitiveName,z.propertyName,A):null!=z.value&&(A=z.value,z.propertyName.includes("Color")&&(g.isRGB(A)&&(A=t.colorToArray(A)),A=t.normalizeAlpha(A)),this._setPoMap(z.primitiveName,z.propertyName,A))}this._analyzeSymbol(x.symbol,w);return this._cimLayers}_reset(){this._cimLayers=[];this._poMap={};this._primitiveOverrides=[]}_analyzeSymbol(x,
w){switch(x?.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this._analyzeMultiLayerSymbol(x,w)}}_analyzeMultiLayerSymbol(x,w){const A=x?.symbolLayers;if(A){var z=x.effects,C=c.Alignment.SCREEN,D=t.getSize(x)??0;"CIMPointSymbol"===x.type&&"Map"===x.angleAlignment&&(C=c.Alignment.MAP);for(var F="CIMPolygonSymbol"===x.type,G=A.length;G--;){const K=A[G];if(!K||!1===K.enable)continue;let O;z?.length&&(O=[...z]);var B=K.effects;B?.length&&(z?O.push(...B):O=[...B]);B=null;if(O){B=
[];for(const R of O){var I=q.OverrideHelper.findEffectOverrides(R,this._primitiveOverrides);I&&B.push(I)}}q.OverrideHelper.findApplicableOverrides(K,this._primitiveOverrides,[]);switch(K.type){case "CIMSolidFill":this._analyzeSolidFill(K,B);break;case "CIMPictureFill":this._analyzePictureFill(K,B);break;case "CIMHatchFill":this._analyzeHatchFill(K,B);break;case "CIMGradientFill":this._analyzeGradientFill(K,B);break;case "CIMSolidStroke":this._analyzeSolidStroke(K,B,F,D);break;case "CIMPictureStroke":this._analyzePictureStroke(K,
B,F,D);break;case "CIMGradientStroke":this._analyzeGradientStroke(K,B,F,D);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":if("CIMLineSymbol"===x.type||"CIMPolygonSymbol"===x.type)C=(C=K.markerPlacement)&&C.angleToLine?c.Alignment.MAP:c.Alignment.SCREEN;I=[];var H=K.primitiveName;H&&I.push(H);H=F&&t.isCIMMarkerStrokePlacement(K.markerPlacement);this._analyzeMarker(K,B,null,I,C,D,w,[],!1,H);break;default:k.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",
K.type)}}}}_analyzeSolidFill(x,w){const {primitiveName:A,type:z}=x,C=t.normalizeAlpha(x.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!x.colorLocked,color:this._getValueOrOverrideExpression(z,A,"Color",C),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:w,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}_analyzePictureFill(x,w){const {primitiveName:A,type:z}=x,C=t.getTintColor(x),D=t.getValue(x.height,a.defaultCIMValues.CIMPictureFill.height);
let F=t.getValue(x.scaleX,1);if("width"in x&&"number"===typeof x.width){var G=x.width;let B=1;const I=this._resourceManager.getResource(x.url);null!=I&&(B=I.width/I.height);F/=D/G*B}G={type:"sprite-rasterization-param",resource:x,overrides:this._getPrimitiveMaterialOverrides(A,z)};this._cimLayers.push({type:"fill",spriteRasterizationParam:G,colorLocked:!!x.colorLocked,effects:w,color:this._getValueOrOverrideExpression(z,A,"TintColor",C),height:this._getValueOrOverrideExpression(z,A,"Height",D),scaleX:this._getValueOrOverrideExpression(z,
A,"ScaleX",F),angle:this._getValueOrOverrideExpression(z,A,"Rotation",t.getValue(x.rotation)),offsetX:this._getValueOrOverrideExpression(z,A,"OffsetX",t.getValue(x.offsetX)),offsetY:this._getValueOrOverrideExpression(z,A,"OffsetY",t.getValue(x.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeHatchFill(x,w){const {primitiveName:A,type:z}=x;var C=this._analyzeMaterialOverrides(A,["Rotation","OffsetX","OffsetY"]);C=this._normalizePrimitiveOverrideProps(C);
let D=[255,255,255,1],F=!1;if(x.lineSymbol?.symbolLayers)for(const B of x.lineSymbol.symbolLayers){if("CIMSolidStroke"!==B.type)continue;const I=B.primitiveName??A;F||!I||B.colorLocked||null==this._poMap[I]?.Color&&null==this._poMap[I]?.StrokeColor||(D=t.normalizeAlpha(B.color),D=this._maybeGetValueOrOverrideExpression(I,"StrokeColor")??this._getValueOrOverrideExpression(z,I,"Color",D),F=!0);var G=this._maybeGetValueOrOverrideExpression(I,"StrokeWidth");if(G){let H=null,K=null;"number"===typeof G?
H=G:K=G.valueExpressionInfo;(G=C.find(O=>"strokeWidth"===O.propertyName))?G.propertyName="width":(G={type:"CIMPrimitiveOverride",primitiveName:I,propertyName:"width",valueExpressionInfo:K,value:H,defaultValue:t.getDefaultCIMValue(z,"width")},C.push(G))}}this._cimLayers.push({type:"fill",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:x,overrides:C},colorLocked:!!x.colorLocked,effects:w,color:D,height:this._getValueOrOverrideExpression(z,A,"Separation",t.getValue(x.separation,
a.defaultCIMValues.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(z,A,"Rotation",t.getValue(x.rotation)),offsetX:this._getValueOrOverrideExpression(z,A,"OffsetX",t.getValue(x.offsetX)),offsetY:this._getValueOrOverrideExpression(z,A,"OffsetY",t.getValue(x.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!F})}_analyzeGradientFill(x,w){this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!x.colorLocked,effects:w,color:[128,
128,128,1],height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}_analyzeSolidStroke(x,w,A,z){const {primitiveName:C,type:D}=x,F=t.normalizeAlpha(x.color),G=t.getValue(x.width,a.defaultCIMValues.CIMSolidStroke.width),B=t.getEnum(x.capStyle,a.defaultCIMValues.CIMSolidStroke.capstyle),I=t.getEnum(x.joinStyle,a.defaultCIMValues.CIMSolidStroke.joinstyle),H=x.miterLimit;let K=[];this._analyzePrimitiveOverrides(C,w,null,null)&&(K=this._getPrimitiveMaterialOverrides(C,
D));let O,R;if(w&&w instanceof Array&&0<w.length){const E=w[w.length-1].effect;E&&"CIMGeometricEffectDashes"===E.type&&"NoConstraint"===E.lineDashEnding&&null===E.offsetAlongLine&&(O=E.dashTemplate,R=E.scaleDash,w=[...w],w.pop())}this._cimLayers.push({type:"line",spriteRasterizationParam:void 0!==O?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:O,capStyle:B},overrides:K}:null,isOutline:A,colorLocked:!!x.colorLocked,effects:w,color:this._getValueOrOverrideExpression(D,C,"Color",
F),width:this._getValueOrOverrideExpression(D,C,"Width",G),cap:this._getValueOrOverrideExpression(D,C,"CapStyle",B),join:this._getValueOrOverrideExpression(D,C,"JoinStyle",I),miterLimit:H&&this._getValueOrOverrideExpression(D,C,"MiterLimit",H),referenceWidth:z,zOrder:u(x.name),dashTemplate:O,scaleDash:R,sampleAlphaOnly:!0})}_analyzePictureStroke(x,w,A,z){const {primitiveName:C,type:D}=x,F=t.getTintColor(x),G=t.getValue(x.width,a.defaultCIMValues.CIMPictureStroke.width),B=t.getEnum(x.capStyle,a.defaultCIMValues.CIMPictureStroke.capstyle),
I=t.getEnum(x.joinStyle,a.defaultCIMValues.CIMPictureStroke.joinstyle),H=x.miterLimit,K={type:"sprite-rasterization-param",resource:x,overrides:this._getPrimitiveMaterialOverrides(C,D)};this._cimLayers.push({type:"line",spriteRasterizationParam:K,isOutline:A,colorLocked:!!x.colorLocked,effects:w,color:this._getValueOrOverrideExpression(D,C,"TintColor",F),width:this._getValueOrOverrideExpression(D,C,"Width",G),cap:this._getValueOrOverrideExpression(D,C,"CapStyle",B),join:this._getValueOrOverrideExpression(D,
C,"JoinStyle",I),miterLimit:H&&this._getValueOrOverrideExpression(D,C,"MiterLimit",H),referenceWidth:z,zOrder:u(x.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeGradientStroke(x,w,A,z){const {primitiveName:C,type:D}=x,F=t.getValue(x.width,a.defaultCIMValues.CIMSolidStroke.width),G=t.getEnum(x.capStyle,a.defaultCIMValues.CIMGradientStroke.capstyle),B=t.getEnum(x.joinStyle,a.defaultCIMValues.CIMGradientStroke.joinstyle),I=x.miterLimit;this._cimLayers.push({type:"line",spriteRasterizationParam:null,
isOutline:A,colorLocked:!!x.colorLocked,effects:w,color:[128,128,128,1],width:this._getValueOrOverrideExpression(D,C,"Width",F),cap:this._getValueOrOverrideExpression(D,C,"CapStyle",G),join:this._getValueOrOverrideExpression(D,C,"JoinStyle",B),miterLimit:I&&this._getValueOrOverrideExpression(D,C,"MiterLimit",I),referenceWidth:z,zOrder:u(x.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}_analyzeMarker(x,w,A,z,C,D,F,G,B=!1,I=!1){B||=!!x.colorLocked;if(!this._analyzeMarkerInsidePolygon(x,w,
B)){var H=t.getValue(x.size,a.defaultCIMValues.CIMVectorMarker.size),K=t.getValue(x.rotation),O=t.getValue(x.offsetX),R=t.getValue(x.offsetY),{primitiveName:E,type:J}=x;H=this._getValueOrOverrideExpression(J,E,"Size",H);K=this._getValueOrOverrideExpression(J,E,"Rotation",K);O=this._getValueOrOverrideExpression(J,E,"OffsetX",O);R=this._getValueOrOverrideExpression(J,E,"OffsetY",R);switch(x.type){case "CIMPictureMarker":this._analyzePictureMarker(x,w,A,z,C,D,H,K,O,R,G,B,I);break;case "CIMVectorMarker":this._analyzeVectorMarker(x,
w,A,z,C,D,H,K,O,R,G,F,B,I)}}}_analyzeMarkerInsidePolygon(x,w,A){const {markerPlacement:z,type:C}=x;if(!z||"CIMMarkerPlacementInsidePolygon"!==z.type)return!1;if("CIMVectorMarker"===C||"CIMPictureMarker"===C){var D=x.primitiveName;if(D&&this._analyzePrimitiveOverrides([D],w,null,null)||(D=z.primitiveName)&&this._analyzePrimitiveOverrides([D],w,null,null))return!1;if("CIMVectorMarker"===C){if({markerGraphics:D}=x,D)for(var F of D)if({symbol:D}=F,"CIMPolygonSymbol"===D?.type&&D.symbolLayers){({symbolLayers:D}=
D);for(var G of D)if("CIMSolidStroke"===G.type)return!1}}else if({animatedSymbolProperties:F}=x,F)return!1}G=Math.abs(z.stepX);D=Math.abs(z.stepY);if(0===G||0===D)return!0;if("Random"===z.gridType){F=n.px2pt(l.randomInsidePolygonTextureSize);const B=Math.max(Math.floor(F/G),1);F=D*Math.max(Math.floor(F/D),1);G=B*G/F}else z.shiftOddRows?(F=2*D,G=G/D*.5):(F=D,G/=D);D=t.getTintColor(x);this._cimLayers.push({type:"fill",spriteRasterizationParam:"CIMCharacterMarker"===x.type?null:{type:"sprite-rasterization-param",
resource:x,overrides:[]},colorLocked:A,effects:w,color:D,height:F,scaleX:G,angle:z.gridAngle,offsetX:t.getValue(z.offsetX),offsetY:t.getValue(z.offsetY),applyRandomOffset:"Random"===z.gridType,sampleAlphaOnly:"CIMPictureMarker"!==x.type,hasUnresolvedReplacementColor:!0});return!0}_analyzePictureMarker(x,w,A,z,C,D,F,G,B,I,H,K,O){const {primitiveName:R,type:E}=x;let J=t.getValue(x.scaleX,1);const Q=t.getTintColor(x);A||=this._createMarkerPlacementOverrideExpression(x.markerPlacement);const N=this._createAnimatedSymbolPropertiesOverrideExpression(x.animatedSymbolProperties),
S=x.anchorPoint??{x:0,y:0};if("width"in x&&"number"===typeof x.width){var W=x.width;let M=1;var U=this._resourceManager.getResource(x.url);null!=U&&(M=U.width/U.height);U=t.getValue(x.size);J/=U/W*M}z=[...z];x.primitiveName&&z.push(x.primitiveName);x.animatedSymbolProperties||N?W={type:"animated",url:x.url,urlHash:"H"+d.numericHash(x.url),playAnimation:x.animatedSymbolProperties?.playAnimation,reverseAnimation:x.animatedSymbolProperties?.reverseAnimation,randomizeStartTime:x.animatedSymbolProperties?.randomizeStartTime,
randomizeStartSeed:x.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:x.animatedSymbolProperties?.startTimeOffset,duration:x.animatedSymbolProperties?.duration,repeatType:x.animatedSymbolProperties?.repeatType,repeatDelay:x.animatedSymbolProperties?.repeatDelay}:(W=h.clone(x),W.markerPlacement=null);z={type:"sprite-rasterization-param",resource:W,overrides:this._getMaterialOverrides(z,E)};N&&z.overrides.push(...N.overrides);this._cimLayers.push({type:"marker",spriteRasterizationParam:z,
colorLocked:K,effects:w,scaleSymbolsProportionally:!1,alignment:C,size:F,scaleX:this._getValueOrOverrideExpression(E,R,"ScaleX",J),rotation:G,offsetX:B,offsetY:I,transform:{type:"cim-marker-transform-param",params:H},color:this._getValueOrOverrideExpression(E,R,"TintColor",Q),anchorPoint:{x:S.x,y:S.y},isAbsoluteAnchorPoint:"Relative"!==x.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!x.rotateClockwise,referenceSize:D,sizeRatio:1,isOutline:O,markerPlacement:A,
animatedSymbolProperties:N})}_analyzeVectorMarker(x,w,A,z,C,D,F,G,B,I,H,K,O,R){var E=x.markerGraphics;if(E){var J=x.frame,Q=0;if(Q=J?J.ymax-J.ymin:D)F={offsetX:B,offsetY:I,rotation:G,size:F,frameHeight:Q,rotateClockWise:!!x.rotateClockwise},H=[...H,F];A||=this._createMarkerPlacementOverrideExpression(x.markerPlacement);for(const S of E)if(S&&(E=S.symbol)){(F=S.primitiveName)&&z.push(F);var N=void 0;if(("CIMPointSymbol"===E.type||"CIMTextSymbol"===E.type)&&J){G=N=0;B=S.geometry;"x"in B&&"y"in B&&(N+=
B.x-.5*(J.xmin+J.xmax),G+=B.y-.5*(J.ymin+J.ymax));if(B=x.anchorPoint)"Absolute"===x.anchorPointUnits?(N-=B.x,G-=B.y):J&&(N-=(J.xmax-J.xmin)*B.x,G-=(J.ymax-J.ymin)*B.y);N={offsetX:N,offsetY:G,rotation:0,size:0,frameHeight:0,rotateClockWise:!1};N=[...H,N]}switch(E.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":K||v(E)?this._analyzeMultiLayerGraphicNonSDF(x,w,A,null,S,z,C,D,N??H,Q,O,R):this._analyzeMultiLayerGraphic(x,w,A,null,S,z,C,D,N??H,Q,O,R);break;case "CIMTextSymbol":this._analyzeTextGraphic(w,
A,S,z,C,D,N??H,O)}F&&z.pop()}}}_analyzeMultiLayerGraphic(x,w,A,z,C,D,F,G,B,I,H,K){var O=C.symbol;const R=O.symbolLayers;if(R){var E=R.length;if(R&&2===R.length&&R[0].enable&&R[1].enable&&"CIMSolidStroke"===R[0].type&&"CIMSolidFill"===R[1].type&&null==R[0].path&&null==R[1].path&&!R[0].effects&&!R[1].effects)this._analyzeCompositeMarkerGraphic(x,w,A,z,C,R,F,G,B,I,H,K);else{var J=this._resourceManager.geometryEngine;if(O=m.CIMEffectHelper.applyEffects(O.effects,C.geometry,J))for(;E--;){const M=R[E];
if(!M||!1===M.enable)continue;const P=M.primitiveName;P&&D.push(P);switch(M.type){case "CIMSolidFill":case "CIMSolidStroke":var Q=m.CIMEffectHelper.applyEffects(M.effects,O,J),N=f.getExtent(Q);if(!N)continue;const T="Relative"!==x.anchorPointUnits,[X,Y,Z,ba]=f.getSDFMetrics(N,x.frame,x.size,x.anchorPoint,T);N="CIMSolidFill"===M.type;Q={type:"sdf",geom:Q,asFill:N};const {path:aa}=M;var S=N?t.normalizeAlpha(t.getFillColor(M)):null==aa?t.normalizeAlpha(t.getStrokeColor(M)):[0,0,0,0],W=N?[0,0,0,0]:t.normalizeAlpha(t.getStrokeColor(M)),
U=t.getStrokeWidth(M)??0;if(!N&&!U)break;const da=C.primitiveName;let fa=null;N&&!M.colorLocked&&(fa=this._maybeGetValueOrOverrideExpression(da,"FillColor"));let ia=null;N||M.colorLocked||(ia=this._maybeGetValueOrOverrideExpression(da,"StrokeColor"));S=fa??this._getValueOrOverrideExpression(M.type,P,"Color",S);W=ia??this._getValueOrOverrideExpression(M.type,P,"Color",W);U=this._maybeGetValueOrOverrideExpression(da,"StrokeWidth")??this._getValueOrOverrideExpression(M.type,P,"Width",U);this._cimLayers.push({type:"marker",
spriteRasterizationParam:aa?{type:"sprite-rasterization-param",resource:{type:"path",path:aa,asFill:N},overrides:[]}:{type:"sprite-rasterization-param",resource:Q,overrides:[]},colorLocked:!!M.colorLocked||!!H,effects:w,scaleSymbolsProportionally:!!x.scaleSymbolsProportionally,alignment:F,anchorPoint:{x:Y,y:Z},isAbsoluteAnchorPoint:T,size:I,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:B},frameHeight:I,widthRatio:ba,rotateClockwise:!1,referenceSize:G,
sizeRatio:X,color:S,outlineColor:W,outlineWidth:U,isOutline:K,markerPlacement:A,animatedSymbolProperties:z});break;case "CIMPictureMarker":case "CIMVectorMarker":M.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(x,w,A,z,C,D,F,G,B,I,!!M.colorLocked||!!H,K):this._analyzeMarker(M,w,A,D,F,G,!1,B,H,K);break;default:this._analyzeMultiLayerGraphicNonSDF(x,w,A,z,C,D,F,G,B,I,!!M.colorLocked||!!H,K)}P&&D.pop()}}}}_analyzeTextGraphic(x,w,A,z,C,D,F,G){q.OverrideHelper.findApplicableOverrides(A,this._primitiveOverrides,
[]);var B=A.geometry;if("x"in B&&"y"in B){B=A.symbol;var I=t.fromCIMFontDecoration(B),H=t.fromCIMFontStyle(B.fontStyleName),K=p.getFontFamily(B.fontFamilyName);B.font={family:K,decoration:I,...H};var O=t.getValue(B.height,a.defaultCIMValues.CIMTextSymbol.height),R=t.getValue(B.angle),E=t.getValue(B.offsetX),J=t.getValue(B.offsetY),Q=t.normalizeAlpha(t.getFillColor(B)),N=t.normalizeAlpha(t.getStrokeColor(B)),S=t.getStrokeWidth(B)??0;S||(N=t.normalizeAlpha(t.getFillColor(B.haloSymbol)),S=t.getValue(B.haloSize));
var W=!1;if(B.symbol?.symbolLayers)for(var U of B.symbol.symbolLayers)null!=t.normalizeAlpha(t.getFillColor(U))&&(W=!!U.colorLocked);var M=A.primitiveName;U=null;W||(U=this._maybeGetValueOrOverrideExpression(M,"FillColor"));var P=this._maybeGetValueOrOverrideExpression(M,"TextSize"),T=this._maybeGetValueOrOverrideExpression(M,"TextAngle"),X=this._maybeGetValueOrOverrideExpression(M,"TextOffsetX");M=this._maybeGetValueOrOverrideExpression(M,"TextOffsetY");var Y=null,Z=null,ba=0;if(B.callout&&"CIMBackgroundCallout"===
B.callout.type){var aa=B.callout;if(aa.backgroundSymbol&&(aa=aa.backgroundSymbol.symbolLayers))for(var da of aa)"CIMSolidFill"===da.type?Y=t.normalizeAlpha(da.color):"CIMSolidStroke"===da.type&&(Z=t.normalizeAlpha(da.color),ba=t.getValue(da.width,a.defaultCIMValues.CIMSolidStroke.width))}da=this._getValueOrOverrideExpression(B.type,A.primitiveName,"TextString",A.textString??"");null!=da&&({fontStyleName:aa}=B,K+=aa?"-"+aa.toLowerCase():"-regular",z=this._getMaterialOverrides(z,B.type),z.push(...this._getPrimitiveMaterialOverrides(A.primitiveName,
B.type)),this._cimLayers.push({type:"text",lineWidth:null,textRasterizationParam:{type:"text-rasterization-param",resource:{type:"text",textString:A.textString??"",font:B.font,symbol:B,primitiveName:A.primitiveName},overrides:z},colorLocked:!!G||!!W,effects:x,alignment:C,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:K,decoration:I,weight:H.weight,style:H.style,size:P??O,angle:T??R,offsetX:X??E,offsetY:M??J,transform:{type:"cim-marker-transform-param",params:F},horizontalAlignment:t.fromCIMHorizontalAlignment(B.horizontalAlignment),
verticalAlignment:t.fromCIMVerticalAlignment(B.verticalAlignment),text:da,color:U??this._getValueOrOverrideExpression(B.type,A.primitiveName,"Color",Q),outlineColor:N,outlineSize:S,backgroundColor:Y,borderLineColor:Z,borderLineWidth:ba,referenceSize:D,sizeRatio:1,markerPlacement:w}))}}_analyzeMultiLayerGraphicNonSDF(x,w,A,z,C,D,F,G,B,I,H,K){C=this._buildSimpleMarker(x,C);var O=this._analyzeMaterialOverrides(x.primitiveName,["Rotation","OffsetX","OffsetY"]);O=this._normalizePrimitiveOverrideProps(O);
const [R,E,J]=b.CIMSymbolHelper.getTextureAnchor(C,this._resourceManager);D=this._getMaterialOverrides(D,x.type);D.push(...O);this._cimLayers.push({type:"marker",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:{...C,avoidSDFRasterization:!0},overrides:D},colorLocked:H,effects:w,scaleSymbolsProportionally:!!x.scaleSymbolsProportionally,alignment:F,anchorPoint:{x:R,y:E},isAbsoluteAnchorPoint:!1,size:I,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:B},
color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:I,widthRatio:1,rotateClockwise:!!x.rotateClockwise,referenceSize:G,sizeRatio:J/n.pt2px(x.size),isOutline:K,markerPlacement:A,animatedSymbolProperties:z})}_createMarkerPlacementOverrideExpression(x){if(!x)return null;const w=[];q.OverrideHelper.findApplicableOverrides(x,this._primitiveOverrides,w);return{type:"cim-marker-placement-info",placement:x,overrides:r(w)}}_createAnimatedSymbolPropertiesOverrideExpression(x){if(!x)return null;
const w=[];q.OverrideHelper.findApplicableOverrides(x,this._primitiveOverrides,w);return{type:"cim-animation-info",animation:x,overrides:r(w)}}_buildSimpleMarker(x,w){return{type:x.type,enable:!0,name:x.name,colorLocked:x.colorLocked,primitiveName:x.primitiveName,anchorPoint:x.anchorPoint,anchorPointUnits:x.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:x.rotateClockwise,rotation:0,size:x.size,billboardMode3D:x.billboardMode3D,depth3D:x.depth3D,frame:x.frame,markerGraphics:[w],scaleSymbolsProportionally:x.scaleSymbolsProportionally,
respectFrame:x.respectFrame,clippingPath:x.clippingPath}}_analyzeCompositeMarkerGraphic(x,w,A,z,C,D,F,G,B,I,H,K){const O=C.geometry;var R=D[0],E=D[1],J=f.getExtent(O);if(J){D="Relative"!==x.anchorPointUnits;var [Q,N,S,W]=f.getSDFMetrics(J,x.frame,x.size,x.anchorPoint,D);({path:J}=E);var U=E.primitiveName,M=R.primitiveName;C=C.primitiveName;var P=null;E.colorLocked||H||(P=this._maybeGetValueOrOverrideExpression(C,"FillColor"));E=P??this._getValueOrOverrideExpression(E.type,U,"Color",t.normalizeAlpha(E.color));
U=null;R.colorLocked||H||(U=this._maybeGetValueOrOverrideExpression(C,"StrokeColor"));U=U??this._getValueOrOverrideExpression(R.type,M,"Color",t.normalizeAlpha(R.color));R=this._maybeGetValueOrOverrideExpression(C,"StrokeWidth")??this._getValueOrOverrideExpression(R.type,M,"Width",t.getValue(R.width,a.defaultCIMValues.CIMSolidStroke.width));this._cimLayers.push({type:"marker",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:J?{type:"path",path:J,asFill:!0}:{type:"sdf",geom:O,asFill:!0},
overrides:[]},colorLocked:H,effects:w,scaleSymbolsProportionally:!!x.scaleSymbolsProportionally,alignment:F,anchorPoint:{x:N,y:S},isAbsoluteAnchorPoint:D,size:I,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:B},frameHeight:I,widthRatio:W,rotateClockwise:!1,referenceSize:G,sizeRatio:Q,color:E,outlineColor:U,outlineWidth:R,isOutline:K,markerPlacement:A,animatedSymbolProperties:z})}}_setPoMap(x,w,A){let z;this._poMap[x]?z=this._poMap[x]:(z={},this._poMap[x]=
z);z[w]=A}_maybeGetValueOrOverrideExpression(x,w,A){return this._getValueOrOverrideExpression("",x,w,A,!1)}_getValueOrOverrideExpression(x,w,A,z,C=!0){C&&!t.isValidCIMValue(z)&&(z=t.getDefaultCIMValue(x,A.toLowerCase()));if(null==w)return z;x=this._poMap[w];if(null==x)return z;A=x[A];return"string"===typeof A||"number"===typeof A||Array.isArray(A)?A:A?{valueExpressionInfo:A,defaultValue:z}:z}_analyzePrimitiveOverrides(x,w,A,z){if(null==x)return!1;"string"===typeof x&&(x=[x]);for(const C of this._primitiveOverrides)if(x.includes(C.primitiveName)&&
C.valueExpressionInfo)return!0;if(null!=w)for(const C of w)if(0<C?.overrides.length)return!0;if(null!=A)for(const C of A)if(0<C?.overrides.length)return!0;if(null!=z)for(const C of z)if(0<C?.overrides.length)return!0;return!1}_getMaterialOverrides(x,w){if(!x)return[];const A=[];for(const z of x)A.push(...this._getPrimitiveMaterialOverrides(z,w));return A}_getPrimitiveMaterialOverrides(x,w){if(!x)return[];const A=this._normalizePrimitiveOverrideProps(this._primitiveOverrides.filter(z=>z.primitiveName===
x));A.forEach(z=>z.defaultValue=t.getDefaultCIMValue(w,z.propertyName.toLowerCase()));return A}_analyzeMaterialOverrides(x,w){return this._primitiveOverrides.filter(A=>A.primitiveName!==x||!w.includes(A.propertyName))}_normalizePrimitiveOverrideProps(x){return x.map(w=>({...w,propertyName:t.uncapitalize(w.propertyName)}))}}e.CIMAnalyzer=y;e.analyzeCIMResource=function(x,w){if(!w||0===w.length)return x;x=h.clone(x);q.OverrideHelper.applyOverrides(x,w);return x};Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(e,g){function p(b){if(!b)return"arial-unicode-ms";b=b.toLowerCase().split(" ").join("-");switch(b){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return b}}function h(b){a:{if(b.weight)switch(b.weight.toLowerCase()){case "bold":case "bolder":var a="-bold";break a}a=
""}a:{if(b.style)switch(b.style.toLowerCase()){case "italic":case "oblique":var c="-italic";break a}c=""}a+=c;return p(b.family)+(0<a.length?a:"-regular")}const k=new Map,n=new Set;class d{constructor(b,a){this.fontFace=b;this.promise=a}}e.clearFonts=function(){const b=document.fonts;k.forEach(a=>{b.delete(a.fontFace)});k.clear();n.clear()};e.defaultFontFamily="arial-unicode-ms";e.getFontFamily=p;e.getFullyQualifiedFontName=h;e.isCachedFontFace=function(b){return n.has(b)};e.loadFont=async function(b){const a=
h(b),c=k.get(a);if(c)return c.promise;const q=new FontFace(b.family,`url('${g.fontsUrl}/woff2/${a}.${"woff2"}') format('${"woff2"}')`,{style:b.style,weight:b.weight}),f=document.fonts;if(f.has(q)&&"loading"===q.status)return q.loaded;b=q.load().then(()=>{f.add(q);return q});k.set(a,new d(q,b));n.add(q);return b};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y){function x(M,P,T){switch(P.type){case "CIMSymbolReference":return x(M,P.symbol,T);case "CIMPointSymbol":null==T&&(T={x:0,y:0});M.drawSymbol(P,T);break;case "CIMLineSymbol":null==T&&(T={paths:[[[0,0],[10,0]]]});M.drawSymbol(P,T);break;case "CIMPolygonSymbol":null==T&&(T={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});M.drawSymbol(P,T);break;case "CIMTextSymbol":M.drawSymbol(P,{x:0,y:0});break;case "CIMVectorMarker":T=new q.Placement,M.drawMarker(P,T)}return M.envelope()}
function w(M){if(!M)return 0;switch(M.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(M.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(M.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(M.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(M.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(M.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(M.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(M.offset);
case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function A(M){if(!M)return 0;switch(M.type){case "CIMGeometricEffectArrow":return Math.abs(.5*M.width);case "CIMGeometricEffectBuffer":return Math.abs(M.size);case "CIMGeometricEffectExtension":return Math.abs(M.length);case "CIMGeometricEffectJog":return Math.abs(.5*M.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(l.getValue(M.offsetX)),Math.abs(l.getValue(M.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(M.offset);
case "CIMGeometricEffectOffsetTangent":return Math.abs(M.offset);case "CIMGeometricEffectRadial":return Math.abs(M.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(M.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(M.fromWidth),Math.abs(M.toWidth));case "CIMGeometricEffectWave":return Math.abs(M.amplitude);case "CIMGeometricEffectDonut":return Math.abs(M.width);default:return 0}}
function z(M){if(!M)return 0;let P=0;for(const T of M)P+=A(T);return P}function C(M,P){if(M)switch(M.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(M=M.symbolLayers)for(const T of M)switch(P(T),T.type){case "CIMVectorMarker":if(M=T.markerGraphics)for(const X of M)X&&(M=X.symbol)&&C(M,P)}}}function D(M,P,T){M.effects&&null==P.geometryEngine&&(P.geometryEnginePromise?T.push(P.geometryEnginePromise):l.isGeometryEngineRequired(M.effects)&&(P.geometryEnginePromise=l.importGeometryEngine(),
T.push(P.geometryEnginePromise),P.geometryEnginePromise.then(X=>P.geometryEngine=X)))}function F(M){if(!M)return null;let P=null;const {cap:T,color:X,join:Y,miterLimit:Z,style:ba,width:aa}=M;"solid"!==ba&&"none"!==ba&&"esriSLSSolid"!==ba&&"esriSLSNull"!==ba&&(P=[{type:"CIMGeometricEffectDashes",dashTemplate:W(ba,T),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==ba&&"none"!==ba?S(X):[0,0,0,0],capStyle:E(T),joinStyle:J(Y),miterLimit:Z,
width:aa,effects:P}}const G=Math.PI,B=G/2,I=Math.PI/180,H=96/72,K=()=>k.getLogger("esri.symbols.cim.CIMSymbolHelper");class O{static getSymbolInflateSize(M,P,T,X,Y){M||=[0,0,0,0];return P?this._getInflateSize(M,P,T,X,Y):M}static safeSize(M){const P=Math.max(Math.abs(M[0]),Math.abs(M[2]));M=Math.max(Math.abs(M[1]),Math.abs(M[3]));return Math.sqrt(P*P+M*M)}static _vectorMarkerBounds(M,P,T,X){let Y=!0;const Z=b.create();if(P?.markerGraphics)for(const ba of P.markerGraphics)P=[0,0,0,0],ba.geometry&&(a.getBoundsXY(Z,
ba.geometry),P[0]=0,P[1]=0,P[2]=0,P[3]=0,this.getSymbolInflateSize(P,ba.symbol,T,0,X),Z[0]+=P[0],Z[1]+=P[1],Z[2]+=P[2],Z[3]+=P[3],Y?(M[0]=Z[0],M[1]=Z[1],M[2]=Z[2],M[3]=Z[3],Y=!1):(M[0]=Math.min(M[0],Z[0]),M[1]=Math.min(M[1],Z[1]),M[2]=Math.max(M[2],Z[2]),M[3]=Math.max(M[3],Z[3])));return M}static _getInflateSize(M,P,T,X,Y){return void 0!==P.symbolLayers?(M=this._getLayersInflateSize(M,P.symbolLayers,T,X,Y),P=z(P.effects),0<P&&(M[0]-=P,M[1]-=P,M[2]+=P,M[3]+=P),M):this._getTextInflatedSize(M,P,Y)}static _getLayersInflateSize(M,
P,T,X,Y){let Z=!0;if(!P)return M;for(const ha of P)if(ha){P=[0,0,0,0];switch(ha.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var ba=ha,aa=ba.width;null!=aa&&(aa=ba.capStyle===m.LineCapStyle.Square||ba.joinStyle===m.LineJoinStyle.Miter?aa/1.4142135623730951:aa/2,P[0]=-aa,P[1]=-aa,P[2]=aa,P[3]=aa);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":ba=ha;if("CIMVectorMarker"===ha.type){if(aa=ha,P=this._vectorMarkerBounds(P,aa,T,Y),aa.frame){var da=
(aa.frame.xmin+aa.frame.xmax)/2,fa=(aa.frame.ymin+aa.frame.ymax)/2;P[0]-=da;P[1]-=fa;P[2]-=da;P[3]-=fa;null!=aa.size&&(aa=aa.size/(aa.frame.ymax-aa.frame.ymin),P[0]*=aa,P[1]*=aa,P[2]*=aa,P[3]*=aa)}}else"CIMPictureMarker"===ha.type?(aa=ha,fa=T.getResource(aa.url),da=1,null!=fa&&fa.height&&(da=fa.width/fa.height),null!=ba.size&&(P=ba.size/2,aa=ba.size*da*aa.scaleX/2,P=[-aa,-P,aa,P])):null!=ba.size&&(P=ba.size/2,P=[-P,-P,P,P]);ba.anchorPoint&&("Absolute"===ba.anchorPointUnits?(aa=ba.anchorPoint.x,da=
ba.anchorPoint.y):(aa=ba.anchorPoint.x*(P[2]-P[0]),da=ba.anchorPoint.y*(P[3]-P[1])),P[0]-=aa,P[1]-=da,P[2]-=aa,P[3]-=da);aa=l.getValue(ba.rotation);ba.rotateClockwise&&(aa=-aa);X&&(aa-=X);aa&&(da=I*aa,aa=Math.cos(da),da=Math.sin(da),fa=b.create([v.cInfinity,v.cInfinity,-v.cInfinity,-v.cInfinity]),b.expandPointInPlace(fa,[P[0]*aa-P[1]*da,P[0]*da+P[1]*aa]),b.expandPointInPlace(fa,[P[0]*aa-P[3]*da,P[0]*da+P[3]*aa]),b.expandPointInPlace(fa,[P[2]*aa-P[1]*da,P[2]*da+P[1]*aa]),b.expandPointInPlace(fa,[P[2]*
aa-P[3]*da,P[2]*da+P[3]*aa]),P=fa);aa=l.getValue(ba.offsetX);da=l.getValue(ba.offsetY);if(X){var ia=I*X;fa=Math.cos(ia);ia=Math.sin(ia);const ja=aa*ia+da*fa;aa=aa*fa-da*ia;da=ja}P[0]+=aa;P[1]+=da;P[2]+=aa;P[3]+=da;ba=w(ba.markerPlacement);0<ba&&(P[0]-=ba,P[1]-=ba,P[2]+=ba,P[3]+=ba)}ba=z(ha.effects);0<ba&&(P[0]-=ba,P[1]-=ba,P[2]+=ba,P[3]+=ba);Z?(M[0]=P[0],M[1]=P[1],M[2]=P[2],M[3]=P[3],Z=!1):(M[0]=Math.min(M[0],P[0]),M[1]=Math.min(M[1],P[1]),M[2]=Math.max(M[2],P[2]),M[3]=Math.max(M[3],P[3]))}return M}static _getTextInflatedSize(M,
P,T){const X=P.height??t.defaultCIMValues.CIMTextSymbol.height;M[0]=-X/2;M[1]=-X/2;M[2]=X/2;M[3]=X/2;if(!T)return M;T=T.get(P);if(!T||!T.glyphMosaicItems.glyphs.length)return M;const {lineGapType:Y,lineGap:Z}=P,ba=Y?f.lineGapType2LineHeight(Y,Z??0,X):0,aa="CIMBackgroundCallout"===P.callout?.type;P=y.shapeGlyphs(T.glyphMosaicItems,{scale:X/r.glyphSize,angle:l.getValue(P.angle),xOffset:l.getValue(P.offsetX),yOffset:l.getValue(P.offsetY),horizontalAlignment:P.horizontalAlignment,verticalAlignment:P.verticalAlignment,
maxLineWidth:512,lineHeight:r.magicLabelLineHeight*Math.max(.25,Math.min(ba||1,4)),decoration:P.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:aa}).boundsT;M[0]=P.x-P.halfWidth;M[1]=-P.y-P.halfHeight;M[2]=P.x+P.halfWidth;M[3]=-P.y+P.halfHeight;return M}}class R{static getEnvelope(M,P,T){if(!M)return null;T=new f.EnvDrawHelper(T);if(Array.isArray(M)){let X;for(const Y of M)X?X.union(x(T,Y,P)):X=x(T,Y,P);return X}return x(T,M,P)}static getTextureAnchor(M,P){M=this.getEnvelope(M,null,P);
if(!M)return[0,0,0];P=M.height*H+2;return[-((M.x+.5*M.width)*H)/(M.width*H+2),-((M.y+.5*M.height)*H)/P,P]}static rasterize(M,P,T,X,Y=!0){var Z=T||this.getEnvelope(P,null,X);if(!Z)return[null,0,0,0,0];const ba=(Z.x+.5*Z.width)*H,aa=(Z.y+.5*Z.height)*H;M.width=Z.width*H;M.height=Z.height*H;T||(M.width+=2,M.height+=2);T=M.getContext("2d",{willReadFrequently:!0});Z=f.Transformation.createScale(H,-H);Z.translate(.5*M.width-ba,.5*M.height+aa);X=new f.CanvasDrawHelper(T,X,Z);switch(P.type){case "CIMPointSymbol":X.drawSymbol(P,
{type:"point",x:0,y:0});break;case "CIMVectorMarker":Z=new q.Placement,X.drawMarker(P,Z)}P=T.getImageData(0,0,M.width,M.height);P=new Uint8Array(P.data);if(Y)for(X=0;X<P.length;X+=4)Y=P[X+3]/255,P[X]*=Y,P[X+1]*=Y,P[X+2]*=Y;return[P,M.width,M.height,-ba/M.width,-aa/M.height]}static fromTextSymbol(M){const {text:P}=M;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,
xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:R.createCIMTextSymbolfromTextSymbol(M),textString:P}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(M){const {height:P,outline:T,width:X,xoffset:Y,xscale:Z,yoffset:ba,yscale:aa}=M,da=[],fa={type:"CIMPolygonSymbol",symbolLayers:da};if(T){var ia=F(T);ia&&da.push(ia)}ia=M.url;"esriPFS"===M.type&&M.imageData&&(ia=M.imageData);M="angle"in M?M.angle??0:0;da.push({type:"CIMPictureFill",
invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:ia,height:(P??0)*(aa||1),width:(X??0)*(Z||1),offsetX:l.getValue(Y),offsetY:l.getValue(ba),rotation:l.getValue(-M),colorSubstitutions:null});return fa}static fromSimpleFillSymbol(M){const {color:P,style:T,outline:X}=M;M=[];const Y={type:"CIMPolygonSymbol",symbolLayers:M};if(X){var Z=F(X);Z&&M.push(Z)}if(T&&"solid"!==T&&"none"!==T&&"esriSFSSolid"!==T&&"esriSFSNull"!==T){Z={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",
color:S(P),capStyle:m.LineCapStyle.Butt,joinStyle:m.LineJoinStyle.Miter,width:.75}]};let ba=0;const aa=d.px2pt("vertical"===T||"horizontal"===T||"cross"===T||"esriSFSCross"===T||"esriSFSVertical"===T||"esriSFSHorizontal"===T?8:10);switch(T){case "vertical":case "esriSFSVertical":ba=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":ba=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":ba=45;break;case "cross":case "esriSFSCross":ba=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":ba=
-45}M.push({type:"CIMHatchFill",lineSymbol:Z,offsetX:0,offsetY:0,rotation:ba,separation:aa});"cross"===T||"esriSFSCross"===T?M.push({type:"CIMHatchFill",lineSymbol:h.clone(Z),offsetX:0,offsetY:0,rotation:90,separation:aa}):("diagonal-cross"===T||"esriSFSDiagonalCross"===T)&&M.push({type:"CIMHatchFill",lineSymbol:h.clone(Z),offsetX:0,offsetY:0,rotation:45,separation:aa})}else!T||"solid"!==T&&"esriSFSSolid"!==T||M.push({type:"CIMSolidFill",enable:!0,color:S(P)});return Y}static fromSimpleLineSymbol(M){const {cap:P,
color:T,join:X,marker:Y,miterLimit:Z,style:ba,width:aa}=M;M=null;"solid"!==ba&&"none"!==ba&&"esriSLSSolid"!==ba&&"esriSLSNull"!==ba&&(M=[{type:"CIMGeometricEffectDashes",dashTemplate:W(ba,P),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const da=[];if(Y){let fa;switch(Y.placement){case "begin-end":fa=m.ExtremityPlacement.Both;break;case "begin":fa=m.ExtremityPlacement.JustBegin;break;case "end":fa=m.ExtremityPlacement.JustEnd;break;default:fa=m.ExtremityPlacement.None}const ia=
R.fromSimpleMarker(Y,aa,T).symbolLayers[0];ia.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:fa,offsetAlongLine:0};da.push(ia)}da.push({type:"CIMSolidStroke",color:"none"!==ba&&"esriSLSNull"!==ba?S(T):[0,0,0,0],capStyle:E(P),joinStyle:J(X),miterLimit:Z,width:aa,effects:M});return{type:"CIMLineSymbol",symbolLayers:da}}static fromPictureMarker(M){const {angle:P,height:T,width:X,xoffset:Y,yoffset:Z}=M;let ba=M.url;"esriPMS"===M.type&&M.imageData&&(ba=
M.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:ba,size:T,width:X,offsetX:l.getValue(Y),offsetY:l.getValue(Z),rotation:l.getValue(-P)}]}}static createCIMTextSymbolfromTextSymbol(M){const {angle:P,color:T,font:X,haloColor:Y,haloSize:Z,horizontalAlignment:ba,kerning:aa,text:da,verticalAlignment:fa,xoffset:ia,yoffset:ha,backgroundColor:ja,borderLineColor:ma,borderLineSize:na}=M;
let oa,pa,ta;if(X){var sa=X.family;var L=X.style;var V=X.weight;oa=X.size;pa=X.decoration}M=!1;da&&(M=g.bidiText(da)[1]);if(ja||na)ta={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:S(ja)},{type:"CIMSolidStroke",color:S(ma),width:na}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var ca=m.BlockProgression.BTT,ea=m.FontEffects.Normal,ka=m.FontEncoding.Unicode;sa=sa||"Arial";b:{if(V)switch(V.toLowerCase()){case "bold":case "bolder":V=
"bold";break b}V=""}b:{if(L)switch(L.toLowerCase()){case "italic":case "oblique":L="italic";break b}L=""}V=V&&L?`${V}-${L}`:`${V}${L}`;return{type:"CIMTextSymbol",angle:P,blockProgression:ca,depth3D:1,extrapolateBaselines:!0,fontEffects:ea,fontEncoding:ka,fontFamilyName:sa,fontStyleName:V,fontType:m.FontType.Unspecified,haloSize:Z,height:oa,hinting:m.GlyphHinting.Default,horizontalAlignment:Q(ba??"center"),kerning:aa,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:l.getValue(ia),offsetY:l.getValue(ha),
strikethrough:"line-through"===pa,underline:"underline"===pa,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:S(T)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:S(Y)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?m.TextReadingDirection.RTL:m.TextReadingDirection.LTR,verticalAlignment:N(fa??"baseline"),verticalGlyphOrientation:m.VerticalGlyphOrientation.Right,wordSpacing:100,
billboardMode3D:m.BillBoardMode.FaceNearPlane,callout:ta}}static createPictureMarkerRasterizationParam(M){const {angle:P,height:T,width:X,xoffset:Y,yoffset:Z}=M;return(M=M.url??M.source?.url??M.source?.imageData)?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:M,size:T,width:X,offsetX:l.getValue(Y),offsetY:l.getValue(Z),rotation:l.getValue(-P)}}:null}static createPictureFillRasterizationParam(M){const {width:P,
height:T,xoffset:X,yoffset:Y,url:Z}=M;return Z?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:m.TextureFilter.Picture,tintColor:null,url:Z,width:P,height:T,offsetX:l.getValue(X),offsetY:l.getValue(Y),rotation:0}}:null}static fromSimpleMarker(M,P,T){var {style:X}=M;T=M.color??T;if("path"===X||"esriSMSPath"===X){P=[];if("outline"in M&&M.outline){var Y=M.outline;P.push({type:"CIMSolidStroke",enable:!0,width:Y.width,color:S(Y.color),path:M.path})}P.push({type:"CIMSolidFill",
enable:!0,color:S(T),path:M.path});const [fa,ia]=U("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-l.getValue(M.angle),size:l.getValue(M.size||6),offsetX:l.getValue(M.xoffset),offsetY:l.getValue(M.yoffset),scaleSymbolsProportionally:!1,frame:fa,markerGraphics:[{type:"CIMMarkerGraphic",geometry:ia,symbol:{type:"CIMPolygonSymbol",symbolLayers:P}}]}]}}const Z=[];Y=M.size;let ba;if("outline"in M&&M.outline&&"none"!==M.outline.style&&"esriSLSNull"!==M.outline.style){const fa=
M.outline,ia="solid"!==fa.style&&"esriSLSSolid"!==fa.style;[X,ba]=ia?U(X,M.size):U(X);const ha=fa.width??u.defaultPolylineSymbol2D.width;if(ia){var aa=ha/M.size,da=(X.xmax-X.xmin)*aa/2;aa=(X.ymax-X.ymin)*aa/2;X.xmin-=da;X.xmax+=da;X.ymin-=aa;X.ymax+=aa;Y&&(Y+=ha)}da="cross"!==M.style&&"x"!==M.style||"dot"===M?.outline.style||"short-dot"===M?.outline.style?m.LineDashEnding.HalfGap:m.LineDashEnding.FullPattern;da=ia?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:W(fa.style,
null).map(ja=>fa.width&&0<fa.width?ja*fa.width:ja),lineDashEnding:da,controlPointEnding:m.LineDashEnding.FullPattern}]:void 0;Z.push({type:"CIMSolidStroke",capStyle:ia?m.LineCapStyle.Round:m.LineCapStyle.Butt,enable:!0,width:ha,color:S(fa.color),effects:da})}else!P||"line-marker"!==M.type||"cross"!==M.style&&"x"!==M.style?[X,ba]=U(X):([X,ba]=U(X),Z.push({type:"CIMSolidStroke",enable:!0,width:P,color:S(T)}));Z.push({type:"CIMSolidFill",enable:!0,color:S(T)});T={type:"CIMPolygonSymbol",symbolLayers:Z};
return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:l.getValue(-M.angle),size:l.getValue(Y||6*P),offsetX:l.getValue(M.xoffset),offsetY:l.getValue(M.yoffset),scaleSymbolsProportionally:!1,frame:X,markerGraphics:[{type:"CIMMarkerGraphic",geometry:ba,symbol:T}]}]}}static fromCIMHatchFill(M,P){const T=P*(M.separation??t.defaultCIMValues.CIMHatchFill.separation),X=T/2;M=h.clone(M.lineSymbol);M.symbolLayers?.forEach(Z=>{switch(Z.type){case "CIMSolidStroke":null!=Z.width&&
(Z.width*=P);Z.effects?.forEach(ba=>{"CIMGeometricEffectDashes"===ba.type&&(ba.dashTemplate=ba.dashTemplate.map(aa=>aa*P))});break;case "CIMVectorMarker":null!=Z.size&&(Z.size*=P),Z=Z.markerPlacement,null!=Z&&"placementTemplate"in Z&&(Z.placementTemplate=Z.placementTemplate.map(ba=>ba*P))}});for(var Y=this._getLineSymbolPeriod(M)||4;4>Y;)Y*=2;Y/=2;return{type:"CIMVectorMarker",frame:{xmin:-Y,xmax:Y,ymin:-X,ymax:X},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-Y,0],[Y,0]]]},symbol:M}],
size:T}}static fetchResources(M,P,T,X=null){if(!M||!P)return T;C(M,Y=>{D(Y,P,T);"url"in Y&&Y.url&&T.push(P.fetchResource(Y.url,{signal:X}))});return T}static fetchFonts(M,P,T){if(M&&P)if("symbolLayers"in M&&M.symbolLayers)for(const Z of M.symbolLayers){if("CIMVectorMarker"===Z.type&&Z.markerGraphics)for(const ba of Z.markerGraphics)ba?.symbol&&R.fetchFonts(ba.symbol,P,T)}else if("CIMTextSymbol"===M.type){const {fontFamilyName:Z,fontStyleName:ba}=M;if(Z&&"calcitewebcoreicons"!==Z.toLowerCase()){var {style:X,
weight:Y}=l.fromCIMFontStyle(ba);M=l.fromCIMFontDecoration(M);M=new c({family:Z,style:X,weight:Y,decoration:M});T.push(P.loadFont(M).catch(()=>{K().error(`Unsupported font ${Z} in CIM symbol`)}))}}}static _getLineSymbolPeriod(M){if(M){const P=this._getEffectsRepeat(M.effects);if(P)return P;if(M.symbolLayers)for(const T of M.symbolLayers)if(T){if(M=this._getEffectsRepeat(T.effects))return M;switch(T.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(M=
this._getPlacementRepeat(T.markerPlacement))return M}}}return 0}static _getEffectsRepeat(M){if(M)for(var P of M)if(P)switch(P.type){case "CIMGeometricEffectDashes":if((M=P.dashTemplate)&&M.length){P=0;for(const T of M)P+=T;M.length&1&&(P*=2);return P}break;case "CIMGeometricEffectWave":return P.period;default:K().error(`unsupported geometric effect type ${P.type}`)}return 0}static _getPlacementRepeat(M){if(M)switch(M.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((M=
M.placementTemplate)&&M.length){let P=0;for(const T of M)P+=+T;M.length&1&&(P*=2);return P}}return 0}static fromCIMInsidePolygon(M){var P=M.markerPlacement;const T={...M,markerPlacement:null,anchorPoint:null};M=Math.abs(P.stepX);const X=Math.abs(P.stepY);var Y=(P.randomness??100)/100;let Z,ba;if("Random"===P.gridType){var aa=d.px2pt(r.randomInsidePolygonTextureSize);const da=Math.max(Math.floor(aa/M),1),fa=Math.max(Math.floor(aa/X),1);aa=da*M/2;Z=fa*X/2;ba=2*Z;P=new n(P.seed);const ia=Y*M/1.5,ha=
Y*X/1.5;Y=[];for(let ja=0;ja<da;ja++)for(let ma=0;ma<fa;ma++){const na=ja*M-aa+ia*(.5-P.getFloat()),oa=ma*X-Z+ha*(.5-P.getFloat());Y.push({x:na,y:oa});0===ja&&Y.push({x:na+2*aa,y:oa});0===ma&&Y.push({x:na,y:oa+2*Z})}}else!0===P.shiftOddRows?(aa=M/2,Z=X,ba=2*X,Y=[{x:-aa,y:0},{x:aa,y:0},{x:0,y:Z},{x:0,y:-Z}]):(aa=M/2,Z=X/2,ba=X,Y=[{x:-M,y:0},{x:0,y:-X},{x:-M,y:-X},{x:0,y:0},{x:M,y:0},{x:0,y:X},{x:M,y:X},{x:-M,y:X},{x:M,y:-X}]);M=Y.map(da=>({type:"CIMMarkerGraphic",geometry:da,symbol:{type:"CIMPointSymbol",
symbolLayers:[T]}}));return{type:"CIMVectorMarker",frame:{xmin:-aa,xmax:aa,ymin:-Z,ymax:Z},markerGraphics:M,size:ba}}}const E=M=>{if(!M)return m.LineCapStyle.Butt;switch(M){case "butt":return m.LineCapStyle.Butt;case "square":return m.LineCapStyle.Square;case "round":return m.LineCapStyle.Round}},J=M=>{if(!M)return m.LineJoinStyle.Miter;switch(M){case "miter":return m.LineJoinStyle.Miter;case "round":return m.LineJoinStyle.Round;case "bevel":return m.LineJoinStyle.Bevel}},Q=M=>{if(null==M)return"Center";
switch(M){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},N=M=>{if(null==M)return"Center";switch(M){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},S=M=>{if(!M)return[0,0,0,0];const {r:P,g:T,b:X,a:Y}=M;return[P,T,X,255*Y]},W=(M,P)=>{const T=p("safari")?.001:0;P="butt"===P;switch(M){case "dash":case "esriSLSDash":return P?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return P?[4,3,1,3]:[3,4,T,
4];case "dot":case "esriSLSDot":return P?[1,3]:[T,4];case "long-dash":case "esriSLSLongDash":return P?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return P?[8,3,1,3]:[7,4,T,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return P?[8,3,1,3,1,3]:[7,4,T,4,T,4];case "short-dash":case "esriSLSShortDash":return P?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return P?[4,1,1,1]:[3,2,T,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return P?[4,1,1,1,1,1]:[3,2,
T,2,T,2];case "short-dot":case "esriSLSShortDot":return P?[1,1]:[T,2];case "solid":case "esriSLSSolid":case "none":return K().error("Unexpected: style does not require rasterization"),[0,0];default:return K().error(`Tried to rasterize SLS, but found an unexpected style: ${M}!`),[0,0]}},U=(M,P=100)=>{var T=P/2,X;if("circle"===M||"esriSMSCircle"===M){var Y=Math.acos(1-.25/T);P=Math.ceil(G/Y/4);0===P&&(P=1);Y=B/P;P*=4;M=[];M.push([T,0]);for(X=1;X<P;X++)M.push([T*Math.cos(X*Y),-T*Math.sin(X*Y)]);M.push([T,
0]);Y={rings:[M]};X={xmin:-T,ymin:-T,xmax:T,ymax:T}}else"cross"===M||"esriSMSCross"===M?(Y={paths:[[[0,T],[0,-T]],[[T,0],[-T,0]]]},X={xmin:-T,ymin:-T,xmax:T,ymax:T}):"diamond"===M||"esriSMSDiamond"===M?(Y={rings:[[[-T,0],[0,T],[T,0],[0,-T],[-T,0]]]},X={xmin:-T,ymin:-T,xmax:T,ymax:T}):"square"===M||"esriSMSSquare"===M?(Y={rings:[[[-T,-T],[-T,T],[T,T],[T,-T],[-T,-T]]]},X={xmin:-T,ymin:-T,xmax:T,ymax:T}):"x"===M||"esriSMSX"===M?(Y={paths:[[[T,T],[-T,-T]],[[T,-T],[-T,T]]]},X={xmin:-T,ymin:-T,xmax:T,ymax:T}):
"triangle"===M||"esriSMSTriangle"===M?(T=.5773502691896257*P,M=-T,X=2/3*P,P=X-P,Y={rings:[[[M,P],[0,X],[T,P],[M,P]]]},X={xmin:M,ymin:P,xmax:T,ymax:X}):"arrow"===M&&(Y={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},X={xmin:-T,ymin:-T,xmax:T,ymax:T});return[X,Y]};e.CIMSymbolHelper=R;e.CIMSymbolInflatedSizeHelper=O;e.capTypeToEnum=E;e.getEffectsInflateSize=z;e.slsDashToTemplateArray=W;e.symbolToCIM=function(M){let P;switch(M.type){case "cim":return M.data;case "web-style":return M;
case "simple-marker":M=R.fromSimpleMarker(M);if(!M)throw Error("InternalError: Cannot convert symbol to CIM");P=M;break;case "picture-marker":P=R.fromPictureMarker(M);break;case "simple-line":P=R.fromSimpleLineSymbol(M);break;case "simple-fill":P=R.fromSimpleFillSymbol(M);break;case "picture-fill":P=R.fromPictureFillSymbol(M);break;case "text":P=R.fromTextSymbol(M)}return{type:"CIMSymbolReference",symbol:P}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports",
"./BidiEngine"],function(e,g){const p=new g;e.bidiText=function(h){if(null==h)return["",!1];if(!p.hasBidiChar(h))return[h,!1];let k;k="rtl"===p.checkContextual(h)?"IDNNN":"ICNNN";return[p.bidiTransform(h,k,"VLYSN"),!0]};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(e){function g(z,C,D,F,G){var B=z;void 0===C&&(C=G.defInFormat);void 0===D&&(D=G.defOutFormat);void 0===F&&(F=G.defSwap);if(C!==D){var I=C.substring(0,
1),H=D.substring(0,1);var K=C.substring(1,4);var O=D.substring(1,4);"C"===K.charAt(0)&&(K=p(B),K="ltr"===K||"rtl"===K?K.toUpperCase():"L"===C.charAt(2)?"LTR":"RTL",C=I+K);"C"===O.charAt(0)&&(K=p(B),"rtl"===K?O="RTL":"ltr"===K?(B=B.split(""),B.reverse(),K=p(B.join("")),O=K.toUpperCase()):O="L"===D.charAt(2)?"LTR":"RTL",D=H+O)}if(C===D)return z;H=C.substring(0,1);B=C.substring(1,4);I=D.substring(0,1);O=D.substring(1,4);G.inFormat=C;G.outFormat=D;G.swap=F;if("L"===H&&"VLTR"===D){if("LTR"===B)return G.dir=
0,h(z,G);if("RTL"===B)return G.dir=1,h(z,G)}if("V"===H&&"V"===I)return G.dir="RTL"===B?1:0,n(z,G);if("L"===H&&"VRTL"===D)return G.dir="LTR"===B?0:1,z=h(z,G),n(z);if("VLTR"===C&&"LLTR"===D)return G.dir=0,h(z,G);if("V"===H&&"L"===I&&B!==O)return z=n(z),"RTL"===B?g(z,"LLTR","VLTR",F,G):g(z,"LRTL","VRTL",F,G);if("VRTL"===C&&"LRTL"===D)return g(z,"LRTL","VRTL",F,G);"L"===H&&"L"===I&&(C=G.swap,G.swap=C.substr(0,1)+"N","RTL"===B?(G.dir=1,z=h(z,G),G.swap="N"+C.substr(1,2),G.dir=0,z=h(z,G)):(G.dir=0,z=h(z,
G),G.swap="N"+C.substr(1,2),z=g(z,"VLTR","LRTL",G.swap,G)));return z}function p(z){return(z=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(z))?"z">=z[0]?"ltr":"rtl":""}function h(z,C){z=z.split("");const D=[];k(z,D,C);if(0!==C.hiLevel&&C.swap.substr(0,1)!==C.swap.substr(1,2))for(let B=0;B<z.length;B++)if(1===D[B]){var F=B;b:{let I=void 0;var G=z[B];let H=0,K=e.swapTable.length-1;for(;H<=K;)if(I=Math.floor((H+K)/2),G<e.swapTable[I][0])K=I-1;else if(G>e.swapTable[I][0])H=
I+1;else{G=e.swapTable[I][1];break b}}z[F]=G}a(2,z,D,C);a(1,z,D,C);y=D;return z.join("")}function k(z,C,D){const F=z.length;var G=D.dir?e.impTabRtl:e.impTabLtr,B=0,I=-1;const H=[],K=[];D.hiLevel=D.dir;D.lastArabic=!1;D.hasUbatAl=!1;D.hasUbatB=!1;D.hasUbatS=!1;for(var O=0;O<F;O++){var R=O,E=z[O].charCodeAt(0);const J=e.primaryTable[E>>8];H[R]=J<e.tbbase?J:e.unicodeTable[J-e.tbbase][E&255]}for(R=0;R<F;R++){O=c(z,H,K,R,D);K[R]=O;B=G[B][O];E=B&240;B&=15;O=G[B][5];C[R]=O;if(0<E){if(16===E)for(;I<R;I++)C[I]=
1;I=-1}if(G[B][6])-1===I&&(I=R);else if(-1<I){for(;I<R;I++)C[I]=O;I=-1}H[R]===e.ubatB&&(C[R]=0);D.hiLevel|=O}if(D.hasUbatS)for(z=0;z<F;z++)if(H[z]===e.ubatS)for(C[z]=D.dir,G=z-1;0<=G;G--)if(H[G]===e.ubatWs)C[G]=D.dir;else break}function n(z,C){z=z.split("");if(C){const D=[];k(z,D,C);y=D}z.reverse();v.reverse();return z.join("")}function d(z){for(let C=0;C<e.arabicAlefBetIntervalsBegine.length;C++)if(z>=e.arabicAlefBetIntervalsBegine[C]&&z<=e.arabicAlefBetIntervalsEnd[C])return!0;return!1}function b(z,
C,D,F){for(;C*D<F&&f(z[C]);)C+=D;return C*D<F&&d(z[C])?!0:!1}function a(z,C,D,F){if(!(F.hiLevel<z))if(1!==z||1!==F.dir||F.hasUbatB){F=C.length;for(var G=0,B,I,H;G<F;){if(D[G]>=z){for(B=G+1;B<F&&D[B]>=z;)B++;for(I=B-1;G<I;G++,I--)H=C[G],C[G]=C[I],C[I]=H,H=v[G],v[G]=v[I],v[I]=H;G=B}G++}}else C.reverse(),v.reverse()}function c(z,C,D,F,G){return{UBAT_L:()=>{G.lastArabic=!1;return e.ubatL},UBAT_R:()=>{G.lastArabic=!1;return e.ubatR},UBAT_ON:()=>e.ubatOn,UBAT_AN:()=>e.ubatAn,UBAT_EN:()=>G.lastArabic?e.ubatAn:
e.ubatEn,UBAT_AL:()=>{G.lastArabic=!0;G.hasUbatAl=!0;return e.ubatR},UBAT_WS:()=>e.ubatOn,UBAT_CS:()=>{let B,I;if(1>F||F+1>=C.length||(B=D[F-1])!==e.ubatEn&&B!==e.ubatAn||(I=C[F+1])!==e.ubatEn&&I!==e.ubatAn)return e.ubatOn;G.lastArabic&&(I=e.ubatAn);return I===B?I:e.ubatOn},UBAT_ES:()=>(0<F?D[F-1]:e.ubatB)===e.ubatEn&&F+1<C.length&&C[F+1]===e.ubatEn?e.ubatEn:e.ubatOn,UBAT_ET:()=>{if(0<F&&D[F-1]===e.ubatEn)return e.ubatEn;if(G.lastArabic)return e.ubatOn;let B=F+1;const I=C.length;for(;B<I&&C[B]===
e.ubatEt;)B++;return B<I&&C[B]===e.ubatEn?e.ubatEn:e.ubatOn},UBAT_NSM:()=>{if("VLTR"===G.inFormat){for(var B=C.length,I=F+1;I<B&&C[I]===e.ubatNsm;)I++;if(I<B&&(B=z[F].charCodeAt(0),I=C[I],(1425<=B&&2303>=B||64286===B)&&(I===e.ubatR||I===e.ubatAl)))return e.ubatR}return 1>F||C[F-1]===e.ubatB?e.ubatOn:D[F-1]},UBAT_B:()=>{G.lastArabic=!0;G.hasUbatB=!0;return G.dir},UBAT_S:()=>{G.hasUbatS=!0;return e.ubatOn},UBAT_LRE:()=>{G.lastArabic=!1;return e.ubatOn},UBAT_RLE:()=>{G.lastArabic=!1;return e.ubatOn},
UBAT_LRO:()=>{G.lastArabic=!1;return e.ubatOn},UBAT_RLO:()=>{G.lastArabic=!1;return e.ubatOn},UBAT_PDF:()=>{G.lastArabic=!1;return e.ubatOn},UBAT_BN:()=>e.ubatOn}[e.typesNames[C[F]]]()}function q(z,C){for(let D=0;D<e.baseForm.length;D++)if(z===e.baseForm[D])return C[D];return z}function f(z){return"\u064b"<=z&&"\u0655">=z}function t(z){return"L"===z?"LTR":"R"===z?"RTL":"C"===z?"CLR":"D"===z?"CRL":""}function m(z,C){for(let D=0;D<e.aLefTable.length;D++)if(z===e.aLefTable[D])return C[D];return z}function l(z,
C,D,F){for(let G=0;G<z.length;G++)if(z[G]>C||!D&&z[G]===C)z[G]+=F}class u{constructor(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}bidiTransform(z,C,D){this.sourceToTarget=[];this.targetToSource=[];if(!z)return"";var F=this.sourceToTarget,G=this.targetToSource,B=z.length;v=[];y=[];for(var I=0;I<B;I++)F[I]=I,G[I]=I,v[I]=I;if(!this.checkParameters(C,D))return z;C=this.inputFormat;D=this.outputFormat;F=z;F=x;I=t(C.charAt(1));G=t(D.charAt(1));
var H="I"===C.charAt(0)?"L":C.charAt(0);B="I"===D.charAt(0)?"L":D.charAt(0);I=H+I;G=B+G;B=C.charAt(2)+D.charAt(2);F.defInFormat=I;F.defOutFormat=G;F.defSwap=B;z=g(z,I,G,B,F);F=!1;if("R"===D.charAt(1))F=!0;else if("C"===D.charAt(1)||"D"===D.charAt(1))F="rtl"===this.checkContextual(z);G=this.sourceToTarget=v;B=Array(G.length);for(I=0;I<G.length;I++)B[G[I]]=I;r=this.targetToSource=B;if(C.charAt(3)===D.charAt(3))F=z;else if("S"===D.charAt(3))if(C=F,D=!0,0===z.length)F="";else{void 0===C&&(C=!0);void 0===
D&&(D=!0);z=String(z);z=z.split("");B=0;F=1;G=z.length;C||(B=z.length-1,F=-1,G=1);var K=B;B=D;var O=0;I=[];for(H=0;K*F<G;K+=F)if(d(z[K])||f(z[K])){var R;if(R="\u0644"===z[K])b:{for(var E=z,J=K+F,Q=F,N=G;J*Q<N&&f(E[J]);)J+=Q;R=" ";if(J*Q<N)for(R=E[J],E=0;E<e.aLefTable.length;E++)if(e.aLefTable[E]===R){R=!0;break b}R=!1}if(R){z[K]=0===O?m(z[K+F],e.lamAlefInialTableFE):m(z[K+F],e.lamAlefMedialTableFE);K+=F;O=z;R=K;E=F;for(J=G;R*E<J&&f(O[R]);)R+=E;R*E<J&&(O[R]=" ");B&&(I[H]=K,H++);O=0}else{R=z[K];if(1===
O){E=K;if(b(z,K+F,F,G))b:for(J=z[K],Q=0;Q<e.baseForm.length;Q++){if(J===e.baseForm[Q]){J=e.medialForm[Q];break b}}else J=q(z[K],e.finalForm);z[E]=J}else!0===b(z,K+F,F,G)?z[K]=q(z[K],e.initialForm):z[K]=q(z[K],e.isolatedForm);f(R)||(O=1);b:{for(E=0;E<e.standAlonForm.length;E++)if(e.standAlonForm[E]===R){R=!0;break b}R=!1}!0===R&&(O=0)}}else O=0;F=I;G="";for(B=0;B<z.length;B++){if(I=D){b:{for(I=0;I<F.length;I++)if(F[I]===B)break b;I=-1}I=-1<I}I?(l(r,B,!C,-1),v.splice(B,1)):G+=z[B]}F=G}else if(C=z,D=
F,z=!0,0===C.length)F="";else for(void 0===z&&(z=!0),void 0===D&&(D=!0),C=String(C),F="",G=C.split(""),B=0;B<C.length;B++)I=!1,"\ufe70"<=G[B]&&"\ufeff">G[B]?(H=C.charCodeAt(B),"\ufef5"<=G[B]&&"\ufefc">=G[B]?(D?(0<B&&z&&" "===G[B-1]?F=F.substring(0,F.length-1)+"\u0644":(F+="\u0644",I=!0),F+=e.aLefTable[(H-65269)/2]):(F+=e.aLefTable[(H-65269)/2],F+="\u0644",B+1<C.length&&z&&" "===G[B+1]?B++:I=!0),I&&(l(r,B,!0,1),v.splice(B,0,v[B]))):F+=e.feTo06Table[H-65136]):F+=G[B];this.sourceToTarget=v;this.targetToSource=
r;this.levels=y;return F}_inputFormatSetter(z){if(!w.test(z))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=z}_outputFormatSetter(z){if(!w.test(z))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=z}checkParameters(z,C){z?this._inputFormatSetter(z):z=this.inputFormat;C?this._outputFormatSetter(C):C=this.outputFormat;return z===C?!1:!0}checkContextual(z){z=p(z);if("ltr"!==z&&"rtl"!==z){try{z=document.dir.toLowerCase()}catch(C){}"ltr"!==
z&&"rtl"!==z&&(z="ltr")}return z}hasBidiChar(z){return A.test(z)}}let v=[],r=[],y=[];const x={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},w=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,A=/[\u0591-\u06ff\ufb1d-\ufefc]/;return u})},"esri/core/bidiEngineTables":function(){define(["exports"],function(e){e.aLefTable=["\u0622","\u0623","\u0625","\u0627"];e.arabicAlefBetIntervalsBegine=
["\u0621","\u0641"];e.arabicAlefBetIntervalsEnd=["\u063a","\u064a"];e.baseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");e.feTo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
e.finalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");e.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];e.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];e.initialForm=
"\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");e.isolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
e.lamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];e.lamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];e.medialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");e.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];e.standAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");
e.swapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];
e.tbbase=100;e.typesNames="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");e.ubatAl=7;e.ubatAn=3;e.ubatB=5;e.ubatBn=18;e.ubatCs=9;e.ubatEn=2;e.ubatEs=10;e.ubatEt=11;e.ubatL=0;e.ubatLre=13;e.ubatLro=16;e.ubatNsm=12;e.ubatOn=4;e.ubatPdf=15;e.ubatR=1;e.ubatRle=14;e.ubatRlo=17;e.ubatS=6;e.ubatWs=8;e.unicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,
18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,
0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,
12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,
10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,
4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],
function(e){class g{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(h,k){this.tx=h;this.ty=k}setTranslateZ(h){this.tz=h}setRotateCS(h,k){this.rz=void 0;this.rzCos=h;this.rzSin=k}setRotate(h){this.rz=h;this.rzSin=this.rzCos=void 0}setRotateY(h){this.ry=h}setScale(h){this.s=
h}setMeasure(h){this.m=h}}class p{next(){return null}}e.EmptyPlacementCursor=p;e.Placement=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A,z,C){function D(E,J=1){const Q=A.fromCIMFontDecoration(E);var N=A.fromCIMFontStyle(E.fontStyleName);const S=E.fontFamilyName??g.defaultFontFamily,{weight:W,style:U}=N;N=J*(E.height||5);const M=A.fromCIMHorizontalAlignment(E.horizontalAlignment),P=A.fromCIMVerticalAlignment(E.verticalAlignment),T=A.getFillColor(E),X=A.getFillColor(E.haloSymbol);J=null!=X?J*(E.haloSize??0):0;var Y="CIMBackgroundCallout"===E.callout?.type?E.callout.backgroundSymbol:
null;E=A.getFillColor(Y);const Z=A.getStrokeWidth(Y);Y=A.getStrokeColor(Y);return{color:T,size:N,horizontalAlignment:M,verticalAlignment:P,font:{family:S,style:A.getFontStyle(U),weight:A.getFontWeight(W),decoration:Q},halo:{size:J||0,color:X,style:U},backgroundColor:E,borderLine:null!=Z&&null!=Y?{size:Z,color:Y}:null,pixelRatio:1,premultiplyColors:!0}}const F=Math.PI/180;class G{constructor(E){this._t=E}static createIdentity(){return new G([1,0,0,0,1,0])}clone(){return new G(this._t.slice())}transform(E){const J=
this._t;return[J[0]*E[0]+J[1]*E[1]+J[2],J[3]*E[0]+J[4]*E[1]+J[5]]}static createScale(E,J){return new G([E,0,0,0,J,0])}scale(E,J){const Q=this._t;Q[0]*=E;Q[1]*=E;Q[2]*=E;Q[3]*=J;Q[4]*=J;Q[5]*=J;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(E,J){return new G([0,0,E,0,0,J])}translate(E,J){const Q=this._t;Q[2]+=E;Q[5]+=J;return this}static createRotate(E){const J=Math.cos(E);E=Math.sin(E);return new G([J,-E,0,E,J,0])}rotate(E){return G.multiply(this,
G.createRotate(E),this)}angle(){const E=this._t[0],J=this._t[3],Q=Math.sqrt(E*E+J*J);return[E/Q,J/Q]}static multiply(E,J,Q){E=E._t;J=J._t;const N=E[1]*J[0]+E[4]*J[1],S=E[2]*J[0]+E[5]*J[1]+J[2],W=E[0]*J[3]+E[3]*J[4],U=E[1]*J[3]+E[4]*J[4],M=E[2]*J[3]+E[5]*J[4]+J[5],P=Q._t;P[0]=E[0]*J[0]+E[3]*J[1];P[1]=N;P[2]=S;P[3]=W;P[4]=U;P[5]=M;return Q}invert(){const E=this._t;let J=E[0]*E[4]-E[1]*E[3];if(0===J)return new G([0,0,0,0,0,0]);J=1/J;return new G([E[4]*J,-E[1]*J,(E[1]*E[5]-E[2]*E[4])*J,-E[3]*J,E[0]*J,
(E[2]*E[3]-E[0]*E[5])*J])}}class B{constructor(E,J){this._resourceManager=E;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new n(u.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(J||G.createIdentity());this._sizeTransfos.push(J?J.scaleRatio():1)}setTransform(E,J){this._transfos=[E||G.createIdentity()];this._sizeTransfos=[J||(E?E.scaleRatio():1)]}setGeomUnitsPerPoint(E){this._geomUnitsPerPoint=E}transformPt(E){return this._transfos[this._transfos.length-
1].transform(E)}transformSize(E){return E*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(E){return this._transfos[this._transfos.length-1].invert().transform(E)}reverseTransformSize(E){return E/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(E){return E/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<
this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(E,J){J=J?E.scaleRatio():1;G.multiply(E,this.back(),E);this._transfos.push(E);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*J)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(E,J,Q){if(E)switch(E.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(E,
J);break;case "CIMTextSymbol":this.drawTextSymbol(E,J,Q)}}drawMultiLayerSymbol(E,J){if(E&&J){var Q=E.symbolLayers;if(Q)if((E=E.effects)&&0<E.length){if(J=this.executeEffects(E,J))for(E=J.next();E;)this.drawSymbolLayers(Q,E.asJSON()),E=J.next()}else this.drawSymbolLayers(Q,J)}}executeEffects(E,J){const Q=this._resourceManager.geometryEngine;J=new t.SimpleEffectCursor(b.GeometryCursor.fromJSONCIM(J));for(const N of E)(E=l.getEffectOperator(N))&&(J=E.execute(J,N,this.geomUnitsPerPoint(),null,Q));return J}drawSymbolLayers(E,
J){let Q=E.length;for(;Q--;){const S=E[Q];if(S&&!1!==S.enable){var N=S.effects;if(N&&0<N.length){if(N=this.executeEffects(N,J)){let W=null;for(;(W=N.next())&&(this.drawSymbolLayer(S,W.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(S,J);if(this._earlyReturn)break}}}drawSymbolLayer(E,J){switch(E.type){case "CIMSolidFill":this.drawSolidFill(J,E.color);break;case "CIMHatchFill":this.drawHatchFill(J,E);break;case "CIMPictureFill":this.drawPictureFill(J,E);break;case "CIMGradientFill":this.drawGradientFill(J,
E);break;case "CIMSolidStroke":this.drawSolidStroke(J,E.color,E.width,E.capStyle,E.joinStyle,E.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(J,E);break;case "CIMGradientStroke":this.drawGradientStroke(J,E);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(E,J)}}drawHatchFill(E,J){const Q=this._buildHatchPolyline(J,E,this.geomUnitsPerPoint());Q&&(this.pushClipPath(E),this.drawMultiLayerSymbol(J.lineSymbol,Q),this.popClipPath())}drawPictureFill(E,
J){}drawGradientFill(E,J){}drawPictureStroke(E,J){}drawGradientStroke(E,J){}drawMarkerLayer(E,J){var Q=E.markerPlacement;if(Q){var N=l.getPlacementOperator(Q);if(N){var S="CIMMarkerPlacementInsidePolygon"===Q.type||"CIMMarkerPlacementPolygonCenter"===Q.type&&Q.clipAtBoundary;S&&this.pushClipPath(J);if(J=N.execute(b.GeometryCursor.fromJSONCIM(J),Q,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(Q=null;(Q=J.next())&&(this.drawMarker(E,Q),!this._earlyReturn););S&&this.popClipPath()}}else{S=
this._placementPool.acquire();if(f.isPoint(J))S.tx=J.x,S.ty=J.y,this.drawMarker(E,S);else if(f.isPolygon(J)){if(J=q.polygonCentroid(J))[S.tx,S.ty]=J,this.drawMarker(E,S)}else for(N of J.points)if(S.tx=N[0],S.ty=N[1],this.drawMarker(E,S),this._earlyReturn)break;this._placementPool.release(S)}}drawMarker(E,J){switch(E.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(E,J);break;case "CIMVectorMarker":this.drawVectorMarker(E,J)}}drawPictureMarker(E,J){if(E){var Q=this._resourceManager.getResource(E.url),
N=A.getValue(E.size,v.defaultCIMValues.CIMPictureMarker.size);if(!(null==Q||0>=N)){var S=Q.width;Q=Q.height;if(S&&Q){Q=S/Q;var W=A.getValue(E.scaleX,1);S=G.createIdentity();var U=E.anchorPoint;if(U){var M=U.x;U=U.y;"Absolute"!==E.anchorPointUnits&&(M*=N*Q*W,U*=N);S.translate(-M,-U)}Q=A.getValue(E.rotation);E.rotateClockwise&&(Q=-Q);this._mapRotation&&(Q+=this._mapRotation);Q&&S.rotate(Q*F);Q=A.getValue(E.offsetX);W=A.getValue(E.offsetY);if(Q||W){if(this._mapRotation){U=F*this._mapRotation;M=Math.cos(U);
U=Math.sin(U);const P=Q*U+W*M;Q=Q*M-W*U;W=P}S.translate(Q,W)}Q=this.geomUnitsPerPoint();1!==Q&&S.scale(Q,Q);(Q=J.getAngle())&&S.rotate(Q);S.translate(J.tx,J.ty);this.push(S,!1);this.drawImage(E,N);this.pop()}}}}drawVectorMarker(E,J){if(E){var Q=E.markerGraphics;if(Q){var N=A.getValue(E.size,v.defaultCIMValues.CIMVectorMarker.size),S=E.frame,W=S?S.ymax-S.ymin:0;W=N&&W?N/W:1;N=G.createIdentity();S&&N.translate(.5*-(S.xmax+S.xmin),.5*-(S.ymax+S.ymin));var U=E.anchorPoint;if(U){var M=U.x;U=U.y;"Absolute"!==
E.anchorPointUnits?S&&(M*=S.xmax-S.xmin,U*=S.ymax-S.ymin):(M/=W,U/=W);N.translate(-M,-U)}1!==W&&N.scale(W,W);S=A.getValue(E.rotation);E.rotateClockwise&&(S=-S);this._mapRotation&&(S+=this._mapRotation);S&&N.rotate(S*F);S=A.getValue(E.offsetX);W=A.getValue(E.offsetY);if(S||W){if(this._mapRotation){U=F*this._mapRotation;M=Math.cos(U);U=Math.sin(U);const P=S*U+W*M;S=S*M-W*U;W=P}N.translate(S,W)}S=this.geomUnitsPerPoint();1!==S&&N.scale(S,S);(S=J.getAngle())&&N.rotate(S);N.translate(J.tx,J.ty);this.push(N,
E.scaleSymbolsProportionally);for(const P of Q)if(P?.symbol&&P.geometry||k.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",P),E=P.textString,"number"===typeof E&&(E=E.toString()),this.drawSymbol(P.symbol,P.geometry,E),this._earlyReturn)break;this.pop()}}}drawTextSymbol(E,J,Q){if(E&&f.isPoint(J)&&!(0>=A.getValue(E.height,v.defaultCIMValues.CIMTextSymbol.height))){var N=G.createIdentity(),S=A.getValue(E.angle);(S=-S)&&N.rotate(S*F);S=A.getValue(E.offsetX);var W=A.getValue(E.offsetY);
(S||W)&&N.translate(S,W);S=this.geomUnitsPerPoint();1!==S&&N.scale(S,S);N.translate(J.x,J.y);this.push(N,!1);this.drawText(E,Q);this.pop()}}_buildHatchPolyline(E,J,Q){var N=A.getValue(E.separation,v.defaultCIMValues.CIMHatchFill.separation)*Q,S=A.getValue(E.rotation);if(0===N)return null;0>N&&(N=-N);for(var W=0,U=.5*N;W>U;)W-=N;for(;W<-U;)W+=N;W=a.create();c.getBoundsXY(W,J);W[0]-=U;W[1]-=U;W[2]+=U;W[3]+=U;for(var M=[[W[0],W[1]],[W[0],W[3]],[W[2],W[3]],[W[2],W[1]]];180<S;)S-=180;for(;0>S;)S+=180;
U=Math.cos(S*F);var P=Math.sin(S*F);S=-N*P;J=N*U;W=A.getValue(E.offsetX)*Q;E=A.getValue(E.offsetY)*Q;W=W*P-E*U;let T;var X=E=Number.MAX_VALUE;T=Q=-Number.MAX_VALUE;for(var Y of M){var Z=Y[0];const ba=Y[1];M=U*Z+P*ba;Z=-P*Z+U*ba;X=Math.min(X,M);E=Math.min(E,Z);T=Math.max(T,M);Q=Math.max(Q,Z)}E=Math.floor(E/N)*N;Y=U*X-P*E-S*W/N;M=P*X+U*E-J*W/N;X=U*T-P*E-S*W/N;W=P*T+U*E-J*W/N;N=1+Math.round((Q-E)/N);U=[];for(P=0;P<N;P++)Y+=S,M+=J,X+=S,W+=J,U.push([[Y,M],[X,W]]);return{paths:U}}}class I extends B{constructor(E,
J){super(E,J);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new x(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return a.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(E){!E||0<this._clipCount||(f.isPolygon(E)?this._processPath(E.rings,0):f.isPolyline(E)?this._processPath(E.paths,0):f.isExtent(E)?(E=O(E))&&this._processPath(E.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(E,
J,Q){!E||0<this._clipCount||null==Q||0>=Q||(J=Math.max(.5*this.transformSize(A.getValue(Q,v.defaultCIMValues.CIMSolidStroke.width)),.25),f.isPolygon(E)?this._processPath(E.rings,J):f.isPolyline(E)?this._processPath(E.paths,J):f.isExtent(E)?(E=O(E))&&this._processPath(E.rings,J):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(E,J){f.isPolygon(J)&&E.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===E.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===E.markerPlacement.type&&
E.markerPlacement.clipAtBoundary)?this._processPath(J.rings,0):super.drawMarkerLayer(E,J)}drawHatchFill(E,J){this.drawSolidFill(E)}drawPictureFill(E,J){this.drawSolidFill(E)}drawGradientFill(E,J){this.drawSolidFill(E)}drawPictureStroke(E,J){this.drawSolidStroke(E,null,J.width)}drawGradientStroke(E,J){this.drawSolidStroke(E,null,J.width)}pushClipPath(E){this.drawSolidFill(E);this._clipCount++}popClipPath(){this._clipCount--}drawImage(E,J){var {url:Q}=E;E=A.getValue(E.scaleX,1);let N=E*J;var S=J;Q=
this._resourceManager.getResource(Q);null!=Q&&(S=Q.height/Q.width,N=E*(J?1<S?J:J/S:Q.width),S=J?1<S?J*S:J:Q.height);this._merge(this.transformPt([-N/2,-S/2]),0);this._merge(this.transformPt([-N/2,S/2]),0);this._merge(this.transformPt([N/2,-S/2]),0);this._merge(this.transformPt([N/2,S/2]),0)}drawText(E,J){if(J&&0!==J.length){this._textRasterizer||(this._textRasterizer=new w);var Q=D(E),[N,S]=this._textRasterizer.computeTextSize(J,Q);N=d.px2pt(N);S=d.px2pt(S);J=0;switch(E.horizontalAlignment){case "Left":J=
N/2;break;case "Right":J=-N/2}Q=0;switch(E.verticalAlignment){case "Bottom":Q=S/2;break;case "Top":Q=-S/2;break;case "Baseline":Q=S/6}this._merge(this.transformPt([-N/2+J,-S/2+Q]),0);this._merge(this.transformPt([-N/2+J,S/2+Q]),0);this._merge(this.transformPt([N/2+J,-S/2+Q]),0);this._merge(this.transformPt([N/2+J,S/2+Q]),0)}}_processPath(E,J){if(E)for(const Q of E)if(E=Q?Q.length:0,1<E){this._merge(this.transformPt(Q[0]),J);for(let N=1;N<E;N++)this._merge(this.transformPt(Q[N]),J)}}_merge(E,J){E[0]-
J<this._xmin&&(this._xmin=E[0]-J);E[0]+J>this._xmax&&(this._xmax=E[0]+J);E[1]-J<this._ymin&&(this._ymin=E[1]-J);E[1]+J>this._ymax&&(this._ymax=E[1]+J)}}class H extends B{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(E,J,Q,N,S,W){W*=d.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(W);this._searchPoint=[(E[0]+E[2])/2,(E[1]+E[3])/2];this._searchDistPoint=(E[2]-E[0])/2/W;this._textInfo=N;this._mapRotation=J&&("CIMPointSymbol"===J.type&&
"Map"!==J.angleAlignment||"CIMTextSymbol"===J.type)?S:0;p("esri-mobile")||(E=d.px2pt(p("hittest-2d-small-symbol-tolerance")*window.devicePixelRatio),N=d.px2pt(p("hittest-2d-small-symbol-tolerance-threshold")),("CIMLineSymbol"!==J?.type&&"CIMPolygonSymbol"!==J?.type||!J.symbolLayers?.some(A.isCIMFill))&&"CIMMeshSymbol"!==J?.type&&(A.getSize(J)??0)<N&&(this._searchDistPoint=E));this._earlyReturn=!1;this.drawSymbol(J,Q);return this._earlyReturn}drawSolidFill(E,J){this._hitTestFill(E)}drawHatchFill(E,
J){this._hitTestFill(E)}drawPictureFill(E,J){this._hitTestFill(E)}drawGradientFill(E,J){this._hitTestFill(E)}drawSolidStroke(E,J,Q,N,S,W){this._hitTestStroke(E,Q)}drawPictureStroke(E,J){this._hitTestStroke(E,J.width)}drawGradientStroke(E,J){this._hitTestStroke(E,J.width)}drawMarkerLayer(E,J){E.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===E.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===E.markerPlacement.type&&E.markerPlacement.clipAtBoundary)?this._hitTestFill(J):super.drawMarkerLayer(E,
J)}pushClipPath(E){}popClipPath(){}drawImage(E,J){var {url:Q}=E;E=A.getValue(E.scaleX,1);Q=this._resourceManager.getResource(Q);if(null!=Q&&0!==Q.height&&0!==J){J*=this.geomUnitsPerPoint();E=Q.width/Q.height*E*J;Q=this.reverseTransformPt(this._searchPoint);var N=this._searchDistPoint;Math.abs(Q[0])<E/2+N&&Math.abs(Q[1])<J/2+N&&(this._earlyReturn=!0)}}drawText(E,J){if((J=this._textInfo)&&(J=J.get(E))&&J.glyphMosaicItems.glyphs.length){var Q=A.getValue(E.height,v.defaultCIMValues.CIMTextSymbol.height),
{lineGapType:N,lineGap:S}=E,W=N?R(N,A.getValue(S),Q):0;E=C.shapeGlyphs(J.glyphMosaicItems,{scale:Q/z.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:E.horizontalAlignment,verticalAlignment:E.verticalAlignment,maxLineWidth:512,lineHeight:z.magicLabelLineHeight*Math.max(.25,Math.min(W||1,4)),decoration:E.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:"CIMBackgroundCallout"===E.callout?.type});Q=this.reverseTransformPt(this._searchPoint);J=Q[0];Q=Q[1];for(const U of E.glyphs)if(J>
U.xTopLeft&&J<U.xBottomRight&&Q>-U.yBottomRight&&Q<-U.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(E){let J=null;if(f.isExtent(E))J=[[[E.xmin,E.ymin],[E.xmin,E.ymax],[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]];else if(f.isPolygon(E))J=E.rings;else if(f.isPolyline(E))J=E.paths;else return;E=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(E,J)&&(this._earlyReturn=!0);if(!this._earlyReturn){const Q=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();
this._nearLine(E,J,Q)&&(this._earlyReturn=!0)}}_hitTestStroke(E,J){let Q=null;if(f.isExtent(E))Q=[[[E.xmin,E.ymin],[E.xmin,E.ymax],[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]];else if(f.isPolygon(E))Q=E.rings;else if(f.isPolyline(E))Q=E.paths;else return;E=this.reverseTransformPt(this._searchPoint);J=A.getValue(J,v.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const N=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();this._nearLine(E,Q,J/2+N)&&
(this._earlyReturn=!0)}_pointInPolygon(E,J){let Q=0;for(const N of J){J=N.length;for(let S=1;S<J;S++){const W=N[S-1],U=N[S];W[1]>E[1]!==U[1]>E[1]&&(0<(U[0]-W[0])*(E[1]-W[1])-(U[1]-W[1])*(E[0]-W[0])?Q++:Q--)}}return 0!==Q}_nearLine(E,J,Q){for(const S of J){J=S.length;for(let W=1;W<J;W++){var N=S[W-1];const U=S[W];let M=(U[0]-N[0])*(U[0]-N[0])+(U[1]-N[1])*(U[1]-N[1]);if(0!==M&&(M=Math.sqrt(M),Math.abs(((U[0]-N[0])*(E[1]-N[1])-(U[1]-N[1])*(E[0]-N[0]))/M)<Q&&(N=((U[0]-N[0])*(E[0]-N[0])+(U[1]-N[1])*(E[1]-
N[1]))/M,N>-Q&&N<M+Q)))return!0}}return!1}}class K extends B{constructor(E,J,Q,N){super(J,Q);this._applyAdditionalRenderProps=N;this._colorSubstitutionHelper=new m;this._ctx=E}drawSolidFill(E,J){if(E){if(f.isPolygon(E))this._buildPath(E.rings,!0);else if(f.isPolyline(E))this._buildPath(E.paths,!0);else if(f.isExtent(E))this._buildPath(O(E).rings,!0);else if(f.isMultipoint(E))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;E=this._ctx;E.fillStyle="string"===typeof J?
J:"rgba("+Math.round(J[0])+","+Math.round(J[1])+","+Math.round(J[2])+","+(J[3]??255)/255+")";E.fill("evenodd")}}drawSolidStroke(E,J,Q,N,S,W){if(E&&J&&0!==Q){if(f.isPolygon(E))this._buildPath(E.rings,!0);else if(f.isPolyline(E))this._buildPath(E.paths,!1);else if(f.isExtent(E))this._buildPath(O(E).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}E=this._ctx;E.strokeStyle="string"===typeof J?J:"rgba("+Math.round(J[0])+","+Math.round(J[1])+","+Math.round(J[2])+
","+(J[3]??255)/255+")";E.lineWidth=Math.max(this.transformSize(Q),.5);this._setCapStyle(N);this._setJoinStyle(S);E.miterLimit=W;E.stroke()}}pushClipPath(E){this._ctx.save();if(f.isPolygon(E))this._buildPath(E.rings,!0);else if(f.isPolyline(E))this._buildPath(E.paths,!0);else if(f.isExtent(E))this._buildPath(O(E).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(E,J){const {colorSubstitutions:Q,url:N,tintColor:S}=E;E=A.getValue(E.scaleX,1);var W=this._resourceManager.getResource(N);
if(null!=W){var U=W.width/W.height*J,M=J;J||(U=W.width,M=W.height);var P=A.isSVGImage(N)||"src"in W&&A.isSVGImage(W.src);J="getFrame"in W?y.getFirstFrame(W):W;Q&&(J=this._colorSubstitutionHelper.applyColorSubstituition(J,Q));this._applyAdditionalRenderProps&&!P&&S&&(J=this._colorSubstitutionHelper.tintImageData(J,S));W=this.transformPt([0,0]);var [T,X]=this.getTransformAngle();P=this.transformSize(1);var Y=this._ctx;Y.save();Y.setTransform({m11:E*P*T,m12:E*P*X,m21:-P*X,m22:P*T,m41:W[0],m42:W[1]});
Y.drawImage(J,-U/2,-M/2,U,M);Y.restore()}}drawText(E,J){if(J&&0!==J.length&&(this._textRasterizer||(this._textRasterizer=new w),E=D(E),E.size*=this.transformSize(d.px2pt(1)),J=this._textRasterizer.rasterizeText(J,E))){var {size:Q,anchorX:N,anchorY:S,canvas:W}=J;J=Q[0]*(N+.5);E=Q[1]*(S-.5);var U=this._ctx,M=this.transformPt([0,0]),[P,T]=this.getTransformAngle();U.save();U.setTransform({m11:1*P,m12:1*T,m21:-1*T,m22:1*P,m41:M[0]-1*J,m42:M[1]+1*E});U.drawImage(W,0,0);U.restore()}}drawPictureFill(E,J){if(E){var {colorSubstitutions:Q,
height:N,offsetX:S,offsetY:W,rotation:U,scaleX:M,tintColor:P,url:T}=J;J=this._resourceManager.getResource(T);if(null!=J){if(f.isPolygon(E))this._buildPath(E.rings,!0);else if(f.isPolyline(E))this._buildPath(E.paths,!0);else if(f.isExtent(E))this._buildPath(O(E).rings,!0);else if(f.isMultipoint(E))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;E=this._ctx;var X=A.isSVGImage(T)||"src"in J&&A.isSVGImage(J.src),Y="getFrame"in J?y.getFirstFrame(J):J;Q&&(Y=this._colorSubstitutionHelper.applyColorSubstituition(Y,
Q));if(this._applyAdditionalRenderProps){if(X||P&&(Y=this._colorSubstitutionHelper.tintImageData(Y,P)),X=E.createPattern(Y,"repeat"),Y=this.transformSize(1),U||=0,S=S?Y*S:0,W=W?Y*W:0,N&&=Y*N,Y=N?N/J.height:1,J=M&&N?M*N/J.width:1,0!==U||1!==Y||1!==J||0!==S||0!==W){const Z=new DOMMatrix;Z.rotateSelf(0,0,-U).translateSelf(S,W).scaleSelf(J,Y,1);X.setTransform(Z)}}else X=E.createPattern(Y,"repeat");E.save();E.fillStyle=X;E.fill("evenodd");E.restore()}}}drawPictureStroke(E,J){if(E){var {colorSubstitutions:Q,
capStyle:N,joinStyle:S,miterLimit:W,tintColor:U,url:M,width:P}=J;J=this._resourceManager.getResource(M);if(null!=J){if(f.isPolygon(E))var T=E.rings;else if(f.isPolyline(E))T=E.paths;else if(f.isExtent(E))T=O(E).rings;else{f.isMultipoint(E)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}P||(P=J.width);E=A.isSVGImage(M)||"src"in J&&A.isSVGImage(J.src);var X="getFrame"in J?y.getFirstFrame(J):J;Q&&(X=this._colorSubstitutionHelper.applyColorSubstituition(X,Q));this._applyAdditionalRenderProps&&
(E||U&&(X=this._colorSubstitutionHelper.tintImageData(X,U)));J=Math.max(this.transformSize(d.pt2px(P)),.5);E=J/X.width;var Y=this._ctx;X=Y.createPattern(X,"repeat-y");Y.save();this._setCapStyle(N);this._setJoinStyle(S);void 0!==W&&(Y.miterLimit=W);Y.lineWidth=J;var Z;for(let ia of T){ia=h.clone(ia);var ba=Z=void 0,aa=void 0;let ha=ba=void 0;T=ia;for(var da=T[0],fa=1;fa<T.length;)ha=T[fa][0]-da[0],ba=T[fa][1]-da[1],ba=0!==ha?ba/ha:Math.PI/2,void 0!==aa&&1E-4>=ba-aa?(T.splice(fa-1,1),da=Z):(Z=da,da=
T[fa],fa++),aa=ba;if(ia&&!(1>=ia.length))for(T=this.transformPt(ia[0]),aa=1;aa<ia.length;aa++)Z=this.transformPt(ia[aa]),da=180/Math.PI*Math.atan2(Z[1]-T[1],Z[0]-T[0]),fa=new DOMMatrix,fa.translateSelf(0,T[1]-J/2).scaleSelf(E,E,1).rotateSelf(0,0,90-da),X.setTransform(fa),Y.strokeStyle=X,Y.beginPath(),Y.moveTo(T[0],T[1]),Y.lineTo(Z[0],Z[1]),Y.stroke(),T=Z}Y.restore()}}}_buildPath(E,J){const Q=this._ctx;Q.beginPath();if(E)for(const N of E)if(E=N?N.length:0,1<E){let S=this.transformPt(N[0]);Q.moveTo(S[0],
S[1]);for(let W=1;W<E;W++)S=this.transformPt(N[W]),Q.lineTo(S[0],S[1]);J&&Q.closePath()}}_setCapStyle(E){switch(E){case r.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case r.LineCapStyle.Round:this._ctx.lineCap="round";break;case r.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(E){switch(E){case r.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case r.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case r.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const O=E=>E?{spatialReference:E.spatialReference,
rings:[[[E.xmin,E.ymin],[E.xmin,E.ymax],[E.xmax,E.ymax],[E.xmax,E.ymin],[E.xmin,E.ymin]]]}:null,R=(E,J,Q)=>{switch(E){case "ExtraLeading":return 1+J/Q;case "Multiple":return J;case "Exact":return J/Q}};e.CIMSymbolDrawHelper=B;e.CanvasDrawHelper=K;e.EnvDrawHelper=I;e.HittestDrawHelper=H;e.Transformation=G;e.cDegToRad=F;e.lineGapType2LineHeight=R;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils",
"./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(e,g,p,h,k){function n(f){if(h.isPolygon(f))f=[f.rings,"esriGeometryPolygon"];else if(h.isPolyline(f))f=[f.paths,"esriGeometryPolyline"];else if(h.isMultipoint(f))f=[[f.points],"esriGeometryMultipoint"];else if(h.isExtent(f))f=[[[[f.xmin,f.ymin],[f.xmin,f.ymax],[f.xmax,f.ymax],[f.xmax,f.ymin],[f.xmin,f.ymin]]],"esriGeometryEnvelope"];else if(h.isPoint(f)){const t=[f.x,f.y];f.z&&t.push(f.z);f.m&&t.push(f.m);f=[[[t]],"esriGeometryPoint"]}else f=
[[],"esriGeometryPolyline"];return f}class d{static fromOptimized(f,t,m=!1,l=!1,u=1){return(new b).initialize(f,t,m,l,u)}static fromJSON(f,t=!1,m=!1){const [l,u]=n(f);return(new a).initialize(l,u,t,m,1)}static fromOptimizedCIM(f,t,m=!1,l=!1,u=1){return(new c).initialize(f,t,m,l,u)}static fromJSONCIM(f,t=!1,m=!1,l=1){const [u,v]=n(f);return(new q).initialize(u,v,t,m,l)}static fromFeatureSetReader(f){const t=f.readGeometryForDisplay();f=f.geometryType;return t&&f?this.fromOptimized(t,f):null}static fromFeatureSetReaderCIM(f){const t=
f.readGeometryForDisplay();f=f.geometryType;return t&&f?this.fromOptimizedCIM(t,f):null}static createEmptyOptimized(f,t=!1,m=!1,l=1){return(new b).initialize(new k,f,t,m,l)}static createEmptyJSON(f,t=!1,m=!1){return(new a).initialize([],f,t,m,1)}static createEmptyOptimizedCIM(f,t=!1,m=!1,l=1){return(new c).initialize(new k,f,t,m,l)}static createEmptyJSONCIM(f,t=!1,m=!1,l=1){return(new q).initialize([],f,t,m,l)}asJSON(){const f=p.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?
{xmin:f[0][0][0],ymin:f[0][0][1],xmax:f[0][2][0],ymax:f[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:f.flat()}:"esriGeometryPoint"===this.geometryType?{x:f[0][0][0],y:f[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:f}:{paths:f}}getCurrentRingArea(){if(3>this.pathSize)return 0;let f=0,t,m;this.seekPathStart();if(!this.nextPoint())return 0;t=this.x;m=this.y;const l=t,u=m;for(;this.nextPoint();)f+=(t-this.x)*(m+this.y),t=this.x,m=this.y;return-.5*(f+(t-l)*(m+u))}invertY(){this.yFactor*=
-1}}class b extends d{constructor(){super(...arguments);this._end=-1}initialize(f,t,m,l,u){this.hasZ=m;this.hasM=l;this.geometryType=t;this._stride=2+Number(m)+Number(l);this._geometry=f;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=u;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(f){if(0<=f&&f<this.totalSize){if(this._pathIndex<f)for(;this._pathIndex<f&&this.nextPath(););else if(this._pathIndex>
f)for(;this._pathIndex>f&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(f){f=this._pathOffset+f*this._stride;return 0<=f&&f<this._end?(this._pointOffset=f,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*
this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}pathLength(){const f=this._end,t=this._stride,m=this._geometry.coords;let l=0;for(let u=this._pathOffset+t;u<f;u+=t){const v=m[u]-m[u-t],r=m[u+1]-m[u-t+1];
l+=Math.sqrt(v*v+r*r)}return l}startPath(){this._geometry.lengths.push(0)}pushPath(f){this.startPath();this.pushPoints(f)}pushPoint(f){for(let t=0;t<this._stride;++t)this._geometry.coords.push(f[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(f,t){this._geometry.coords.push(f,t);this._geometry.lengths[this.totalSize-1]++}pushPoints(f){for(const t of f)for(let m=0;m<this._stride;++m)this._geometry.coords.push(t[m]);this._geometry.lengths[this.totalSize-1]+=f.length}pushCursor(f){f=f.asOptimized();
this._geometry.coords.push(...f.coords);this._geometry.lengths.push(...f.lengths)}asOptimized(){const f=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<f.coords.length;t+=this._stride)f.coords[t]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(f.lengths.length=0);return f}isClosed(){const f=this._geometry.coords,t=this._pathOffset,m=this._end-this._stride;for(let l=0;l<this._stride;l++)if(f[t+l]!==f[m+l])return!1;return!0}clone(){return(new b).initialize(this._geometry.clone(),this.geometryType,
this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((f,t)=>f+t)}get pathSize(){const {lengths:f}=this._geometry;return 0>this._pathIndex||this._pathIndex>f.length-1?0:this._geometry.isPoint?1:f[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(f){this._geometry.coords[this._pointOffset]=f}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+
1]}set y(f){this._geometry.coords[this._pointOffset+1]=this.yFactor*f}get z(){return this._geometry.coords[this._pointOffset+2]}set z(f){this._geometry.coords[this._pointOffset+2]=f}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(f){this._geometry.coords[this._pointOffset+3]=f}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class a extends d{initialize(f,t,m,l,u){this._paths=f;this.geometryType=t;this.hasZ=m;this.hasM=l;
this._pathIndex=this._pointIndex=-1;this.yFactor=u;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(f){this._pathIndex=f;this._pointIndex=-1;return 0<=f&&f<this.totalSize?(this._currentPath=this._paths[f],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(f){return 0<=f&&f<this._currentPath.length?(this._pointIndex=f,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=
this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const f=this._currentPath.length,t=this._currentPath;let m=
0;for(let u=1;u<f;u++){var l=t[u-1];const v=t[u],r=v[0]-l[0];l=v[1]-l[1];m+=Math.sqrt(r*r+l*l)}return m}startPath(){this._paths.push([])}pushPath(f){this._paths.push(f)}pushPoint(f){this._paths[this.totalSize-1].push(f)}pushXY(f,t){this._paths[this.totalSize-1].push([f,t])}pushPoints(f){this._paths[this.totalSize-1].push(...f)}pushCursor(f){f=p.collectMultipath(f);for(const t of f)this.pushPath(t)}asOptimized(){const f=new k;if("esriGeometryPoint"===this.geometryType)f.coords.push(...this._paths[0][0]),
f.lengths.length=0;else for(const t of this._paths){for(const m of t)f.coords.push(m[0]),f.coords.push(m[1]*this.yFactor),this.hasZ&&f.coords.push(m[2]),this.hasM&&f.coords.push(m[this._mIndex]);f.lengths.push(t.length)}return f}isClosed(){const f=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let m=0;m<f.length;m++)if(f[m]!==t[m])return!1;return!0}clone(){return(new a).initialize(g.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(f=>
f.length).reduce((f,t)=>f+t)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(f){this._currentPoint[0]=f}get y(){return this.yFactor*this._currentPoint[1]}set y(f){this._currentPoint[1]=this.yFactor*f}get z(){return this._currentPoint[2]}set z(f){this._currentPoint[2]=f}get m(){return this._currentPoint[this._mIndex]}set m(f){this._currentPoint[this._mIndex]=
f}get pathIndex(){return this._pathIndex}}class c extends b{initialize(f,t,m,l,u){super.initialize(f,t,m,l,u);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(v=>new Set));return this}startPath(){super.startPath();this._controlPoints.push(new Set)}clone(){const f=(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);f._controlPoints=this._controlPoints;return f}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(f){this._controlPoints[this.pathIndex].add(f)}getControlPointAt(f){return this._controlPoints[this.pathIndex].has(f)}}
class q extends a{initialize(f,t,m,l,u){return super.initialize(f,t,m,l,u)}clone(){return(new q).initialize(g.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(f){this._paths[this.pathIndex][f][4]=1}getControlPointAt(f){return 1===this._paths[this.pathIndex][f][4]}}e.GeometryCursor=d;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(e,g,p){let h;class k{constructor(n){this._geometry=n}next(){const n=this._geometry;this._geometry=null;return n}}e.SimpleEffectCursor=k;e.clipCursorToTileExtent=function(n,d){h||=new p.TileClipper(0,0,0,1);var b="esriGeometryPolygon"===n.geometryType;const a=b?3:2;h.reset(b?p.GeometryType.Polygon:p.GeometryType.LineString);h.setPixelMargin(d+
1);h.setExtent(512);let c;for(;n.nextPath();)if(!(n.pathSize<a)){n.nextPoint();d=n.x;c=-n.y;for(h.moveTo(d,c);n.nextPoint();)d=n.x,c=-n.y,h.lineTo(d,c);b&&h.close()}if(b=h.result(!1)){n=g.GeometryCursor.createEmptyOptimizedCIM(n.geometryType);for(const q of b){n.startPath();for(const f of q)n.pushXY(f.x,-f.y)}n.reset();return n}return null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(e){e.GeometryType=void 0;
(function(a){a[a.Unknown=0]="Unknown";a[a.Point=1]="Point";a[a.LineString=2]="LineString";a[a.Polygon=3]="Polygon"})(e.GeometryType||(e.GeometryType={}));class g{constructor(a,c){this.x=a;this.y=c}clone(){return new g(this.x,this.y)}equals(a,c){return a===this.x&&c===this.y}isEqual(a){return a.x===this.x&&a.y===this.y}setCoords(a,c){this.x=a;this.y=c;return this}normalize(){var a=this.x;const c=this.y;a=Math.sqrt(a*a+c*c);this.x/=a;this.y/=a;return this}rightPerpendicular(){const a=this.x;this.x=
this.y;this.y=-a;return this}leftPerpendicular(){const a=this.x;this.x=-this.y;this.y=a;return this}move(a,c){this.x+=a;this.y+=c;return this}assign(a){this.x=a.x;this.y=a.y;return this}assignAdd(a,c){this.x=a.x+c.x;this.y=a.y+c.y;return this}assignSub(a,c){this.x=a.x-c.x;this.y=a.y-c.y;return this}rotate(a,c){const q=this.x,f=this.y;this.x=q*a-f*c;this.y=q*c+f*a;return this}scale(a){this.x*=a;this.y*=a;return this}length(){const a=this.x,c=this.y;return Math.sqrt(a*a+c*c)}sub(a){this.x-=a.x;this.y-=
a.y;return this}add(a){this.x+=a.x;this.y+=a.y;return this}static distance(a,c){const q=c.x-a.x;a=c.y-a.y;return Math.sqrt(q*q+a*a)}static add(a,c){return new g(a.x+c.x,a.y+c.y)}static sub(a,c){return new g(a.x-c.x,a.y-c.y)}}class p{constructor(a,c,q){this.ratio=a;this.x=c;this.y=q}}class h{constructor(a,c,q,f=8,t=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=f;this._pixelMargin=t;this._tileSize=512*f;this._dz=a;this._yPos=c;this._xPos=q}setPixelMargin(a){a!==this._pixelMargin&&
(this._pixelMargin=a,this.setExtent(this._extent))}setExtent(a){this._extent=a;this._finalRatio=this._tileSize/a*(1<<this._dz);let c=this._pixelRatio*this._pixelMargin;c/=this._finalRatio;a>>=this._dz;c>a&&(c=a);this._margin=c;this._xmin=a*this._xPos-c;this._ymin=a*this._yPos-c;this._xmax=this._xmin+a+2*c;this._ymax=this._ymin+a+2*c}reset(a){this._type=a;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(a,c){this._pushLine();this._prevIsIn=this._isIn(a,c);this._moveTo(a,c,this._prevIsIn);
this._prevPt=new g(a,c);this._firstPt=new g(a,c);this._dist=0}lineTo(a,c){const q=this._isIn(a,c),f=new g(a,c),t=g.distance(this._prevPt,f);if(q)if(this._prevIsIn)this._lineTo(a,c,!0);else{var m=this._prevPt;var l=f;a=this._intersect(l,m);this._start=this._dist+t*(1-this._r);this._lineTo(a.x,a.y,!0);this._lineTo(l.x,l.y,!0)}else if(this._prevIsIn)l=this._prevPt,m=f,a=this._intersect(l,m),this._lineTo(a.x,a.y,!0),this._lineTo(m.x,m.y,!1);else{const v=this._prevPt;if(!(v.x<=this._xmin&&f.x<=this._xmin||
v.x>=this._xmax&&f.x>=this._xmax||v.y<=this._ymin&&f.y<=this._ymin||v.y>=this._ymax&&f.y>=this._ymax)){a=[];if(v.x<this._xmin&&f.x>this._xmin||v.x>this._xmin&&f.x<this._xmin){c=(this._xmin-v.x)/(f.x-v.x);var u=v.y+c*(f.y-v.y);u<=this._ymin?l=!1:u>=this._ymax?l=!0:a.push(new p(c,this._xmin,u))}if(v.x<this._xmax&&f.x>this._xmax||v.x>this._xmax&&f.x<this._xmax)c=(this._xmax-v.x)/(f.x-v.x),u=v.y+c*(f.y-v.y),u<=this._ymin?l=!1:u>=this._ymax?l=!0:a.push(new p(c,this._xmax,u));if(v.y<this._ymin&&f.y>this._ymin||
v.y>this._ymin&&f.y<this._ymin)c=(this._ymin-v.y)/(f.y-v.y),u=v.x+c*(f.x-v.x),u<=this._xmin?m=!1:u>=this._xmax?m=!0:a.push(new p(c,u,this._ymin));if(v.y<this._ymax&&f.y>this._ymax||v.y>this._ymax&&f.y<this._ymax)c=(this._ymax-v.y)/(f.y-v.y),u=v.x+c*(f.x-v.x),u<=this._xmin?m=!1:u>=this._xmax?m=!0:a.push(new p(c,u,this._ymax));if(0===a.length)m?l?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):l?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,
!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this._start=this._dist+t*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this._start=this._dist+t*a[0].ratio,m=0;m<a.length;m++)this._lineTo(a[m].x,a[m].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=t;this._prevIsIn=q;this._prevPt=f}close(){if(2<this._line.length){var a=this._firstPt,c=this._prevPt;a.x===c.x&&a.y===c.y||this.lineTo(a.x,a.y);a=this._line;for(c=a.length;4<=c;)if(a[0].x===a[1].x&&a[0].x===a[c-2].x||a[0].y===
a[1].y&&a[0].y===a[c-2].y)a.pop(),a[0].x=a[c-2].x,a[0].y=a[c-2].y,--c;else break}}result(a=!0){this._pushLine();if(0===this._lines.length)return null;this._type===e.GeometryType.Polygon&&a&&d.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==e.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const a=this._lines,c=a.length;if(0===c)return null;const q=[];for(let f=0;f<c;f++)q.push({line:a[f],start:this._starts[f]||
0});return q}_isIn(a,c){return a>=this._xmin&&a<=this._xmax&&c>=this._ymin&&c<=this._ymax}_intersect(a,c){let q,f,t;if(c.x>=this._xmin&&c.x<=this._xmax)f=c.y<=this._ymin?this._ymin:this._ymax,t=(f-a.y)/(c.y-a.y),q=a.x+t*(c.x-a.x);else if(c.y>=this._ymin&&c.y<=this._ymax)q=c.x<=this._xmin?this._xmin:this._xmax,t=(q-a.x)/(c.x-a.x),f=a.y+t*(c.y-a.y);else{f=c.y<=this._ymin?this._ymin:this._ymax;q=c.x<=this._xmin?this._xmin:this._xmax;const m=(q-a.x)/(c.x-a.x),l=(f-a.y)/(c.y-a.y);m<l?(t=m,f=a.y+m*(c.y-
a.y)):(t=l,q=a.x+l*(c.x-a.x))}this._r=t;return new g(q,f)}_pushLine(){this._line&&(this._type===e.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===e.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===e.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(a,c,q){this._type!==e.GeometryType.Polygon?
q&&(a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(a,c))):(q||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new g(a,c)),this._isV=this._isH=!1)}_lineTo(a,c,q){if(this._type!==e.GeometryType.Polygon)if(q){a=
Math.round((a-(this._xmin+this._margin))*this._finalRatio);c=Math.round((c-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(q=this._line[this._line.length-1],q.equals(a,c)))return;this._line.push(new g(a,c))}else this._line&&0<this._line.length&&this._pushLine();else if(q||(a<this._xmin&&(a=this._xmin),a>this._xmax&&(a=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),a=Math.round((a-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+
this._margin))*this._finalRatio),this._line&&0<this._line.length){q=this._line[this._line.length-1];const f=q.x===a,t=q.y===c;f&&t||(this._isH&&f?(q.x=a,q.y=c,q=this._line[this._line.length-2],q.x===a&&q.y===c?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(q=this._line[this._line.length-2],this._isH=q.x===a,this._isV=q.y===c)):(this._isH=q.x===a,this._isV=q.y===c)):this._isV&&t?(q.x=a,q.y=c,q=this._line[this._line.length-2],q.x===a&&q.y===c?(this._line.pop(),1>=this._line.length?this._isV=
this._isH=!1:(q=this._line[this._line.length-2],this._isH=q.x===a,this._isV=q.y===c)):(this._isH=q.x===a,this._isV=q.y===c)):(this._line.push(new g(a,c)),this._isH=f,this._isV=t))}else this._line.push(new g(a,c))}}class k{setExtent(a){this._ratio=4096===a?1:4096/a}get validateTessellation(){return 1>this._ratio}reset(a){this._lines=[];this._line=null}moveTo(a,c){this._line&&this._lines.push(this._line);this._line=[];const q=this._ratio;this._line.push(new g(a*q,c*q))}lineTo(a,c){const q=this._ratio;
this._line.push(new g(a*q,c*q))}close(){const a=this._line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var n;(function(a){a[a.sideLeft=0]="sideLeft";a[a.sideRight=1]="sideRight";a[a.sideTop=2]="sideTop";a[a.sideBottom=3]="sideBottom"})(n||={});class d{static simplify(a,c,q){if(q){var f=-c,t=a+c,m=-c,l=a+c;a=[];c=[];var u=q.length;for(let v=0;v<u;++v){const r=q[v];if(!r||2>r.length)continue;let y=r[0],
x;const w=r.length;for(let A=1;A<w;++A)x=r[A],y.x===x.x&&(y.x<=f&&(y.y>x.y?(a.push(v),a.push(A),a.push(n.sideLeft),a.push(-1)):(c.push(v),c.push(A),c.push(n.sideLeft),c.push(-1))),y.x>=t&&(y.y<x.y?(a.push(v),a.push(A),a.push(n.sideRight),a.push(-1)):(c.push(v),c.push(A),c.push(n.sideRight),c.push(-1)))),y.y===x.y&&(y.y<=m&&(y.x<x.x?(a.push(v),a.push(A),a.push(n.sideTop),a.push(-1)):(c.push(v),c.push(A),c.push(n.sideTop),c.push(-1))),y.y>=l&&(y.x>x.x?(a.push(v),a.push(A),a.push(n.sideBottom),a.push(-1)):
(c.push(v),c.push(A),c.push(n.sideBottom),c.push(-1)))),y=x}0!==a.length&&0!==c.length&&(d.fillParent(q,c,a),d.fillParent(q,a,c),f=[],d.calcDeltas(f,c,a),d.calcDeltas(f,a,c),d.addDeltas(f,q))}}static fillParent(a,c,q){const f=q.length,t=c.length;for(let r=0;r<t;r+=4){var m=c[r],l=c[r+1];const y=c[r+2],x=a[m][l-1];m=a[m][l];l=8092;let w=-1;for(let A=0;A<f;A+=4){if(q[A+2]!==y)continue;var u=q[A];const z=q[A+1];var v=a[u][z-1];u=a[u][z];switch(y){case n.sideLeft:case n.sideRight:b(x.y,v.y,u.y)&&b(m.y,
v.y,u.y)&&(v=Math.abs(u.y-v.y),v<l&&(l=v,w=A));break;case n.sideTop:case n.sideBottom:b(x.x,v.x,u.x)&&b(m.x,v.x,u.x)&&(v=Math.abs(u.x-v.x),v<l&&(l=v,w=A))}}c[r+3]=w}}static calcDeltas(a,c,q){const f=c.length;for(let t=0;t<f;t+=4){const m=d.calcDelta(t,c,q,[]);a.push(c[t]);a.push(c[t+1]);a.push(c[t+2]);a.push(m)}}static calcDelta(a,c,q,f){a=c[a+3];if(-1===a)return 0;const t=f.length;if(1<t&&f[t-2]===a)return 0;f.push(a);return d.calcDelta(a,q,c,f)+1}static addDeltas(a,c){const q=a.length;let f=0;for(var t=
0;t<q;t+=4){var m=a[t+3];m>f&&(f=m)}for(t=0;t<q;t+=4){m=c[a[t]];const l=a[t+1],u=f-a[t+3];switch(a[t+2]){case n.sideLeft:m[l-1].x-=u;m[l].x-=u;1===l&&(m[m.length-1].x-=u);l===m.length-1&&(m[0].x-=u);break;case n.sideRight:m[l-1].x+=u;m[l].x+=u;1===l&&(m[m.length-1].x+=u);l===m.length-1&&(m[0].x+=u);break;case n.sideTop:m[l-1].y-=u;m[l].y-=u;1===l&&(m[m.length-1].y-=u);l===m.length-1&&(m[0].y-=u);break;case n.sideBottom:m[l-1].y+=u,m[l].y+=u,1===l&&(m[m.length-1].y+=u),l===m.length-1&&(m[0].y+=u)}}}}
const b=(a,c,q)=>a>=c&&a<=q||a>=q&&a<=c;e.Point=g;e.SimpleBuilder=k;e.TileClipper=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class e{applyColorSubstituition(g,p){if(!p)return g;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:h,height:k}=g,n=this._rasterizationCanvas,d=n.getContext("2d",{willReadFrequently:!0});g!==n&&(n.width=h,n.height=k,d.drawImage(g,
0,0,h,k));g=d.getImageData(0,0,h,k).data;if(p)for(var b of p)if(b&&b.oldColor&&4===b.oldColor.length&&b.newColor&&4===b.newColor.length){const [a,c,q,f]=b.oldColor,[t,m,l,u]=b.newColor;if(a!==t||c!==m||q!==l||f!==u)for(p=0;p<g.length;p+=4)a===g[p]&&c===g[p+1]&&q===g[p+2]&&f===g[p+3]&&(g[p]=t,g[p+1]=m,g[p+2]=l,g[p+3]=u)}b=new ImageData(g,h,k);d.putImageData(b,0,0);return n}tintImageData(g,p){if(!p||4>p.length)return g;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));
const {width:h,height:k}=g,n=this._rasterizationCanvas,d=n.getContext("2d",{willReadFrequently:!0});g!==n&&(n.width=h,n.height=k,d.drawImage(g,0,0,h,k));g=d.getImageData(0,0,h,k);g=new Uint8Array(g.data);p=[p[0]/255,p[1]/255,p[2]/255,p[3]/255];for(let b=0;b<g.length;b+=4)g[b]*=p[0],g[b+1]*=p[1],g[b+2]*=p[2],g[b+3]*=p[3];p=new ImageData(new Uint8ClampedArray(g.buffer),h,k);d.putImageData(p,0,0);return n}}return e})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A){e.getEffectOperator=function(z){if(!z)return null;switch(z.type){case "CIMGeometricEffectAddControlPoints":return g.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return p.EffectArrow.local();case "CIMGeometricEffectBuffer":return h.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return k.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return n.EffectCut.local();case "CIMGeometricEffectDashes":return d.EffectDashes.local();
case "CIMGeometricEffectDonut":return b.EffectDonut.local();case "CIMGeometricEffectJog":return a.EffectJog.local();case "CIMGeometricEffectMove":return c.EffectMove.local();case "CIMGeometricEffectOffset":return q.EffectOffset.local();case "CIMGeometricEffectReverse":return f.EffectReverse.local();case "CIMGeometricEffectRotate":return t.EffectRotate.local();case "CIMGeometricEffectScale":return m.EffectScale.local();case "CIMGeometricEffectWave":return l.EffectWave.local()}return null};e.getPlacementOperator=
function(z){if(!z)return null;switch(z.type){case "CIMMarkerPlacementAlongLineSameSize":return u.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return v.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return r.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return y.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return x.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return w.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return A.PlacementPolygonCenter.local()}return null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(e){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(h,k,n,d,b){return new p(h,k,n)}}g.instance=null;class p{constructor(h,k,n){this._inputGeometries=h;this._angleTolerance=void 0!==k.angleTolerance?k.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let h=this._inputGeometries.next();for(;h;){if("esriGeometryPolygon"===h.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===h.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===h.geometryType){if(this._maxCosAngle)return h;this._isClosed=!0}else{h=this._inputGeometries.next();continue}for(;h.nextPath();)this._processPath(h);h.reset();return h}return null}_processPath(h){if(h.nextPoint()){const k=
h.x,n=h.y;let d=k,b=n,a=h.pathSize,c=0,q=0,f=0,t=0,m=0,l=0;this._isClosed&&++a;for(let u=1;h.nextPoint()||u<a;++u){let v,r;this._isClosed&&u===a-1?(v=k,r=n):(v=h.x,r=h.y);const y=v-d,x=r-b,w=Math.sqrt(y*y+x*x);1<u&&0<w&&0<f&&(c*y+q*x)/w/f<=this._maxCosAngle&&h.setControlPointAt(u-1);1===u&&(t=y,m=x,l=w);0<w&&(d=v,b=r,c=y,q=x,f=w)}this._isClosed&&0<f&&0<l&&(c*t+q*m)/l/f<=this._maxCosAngle&&h.setControlPointAt(0)}}}e.EffectAddControlPoints=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(e,g,p,h,k,n){const d=n.GeometricEffectArrowType.OpenEnded;class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(c,q,f,t,m){return new a(c,q,f)}}b.instance=null;class a extends h.PathEffectCursor{constructor(c,q,f){super(c,!1,!0);this._curveHelper=new k.CurveHelper;this._width=
(void 0!==q.width?q.width:5)*f;this._arrowType=void 0!==q.geometricEffectArrowType?q.geometricEffectArrowType:void 0!==q.arrowType?q.arrowType:d;this._offsetFlattenError=k.pixelTolerance*f}processPath(c){const q=g.GeometryCursor.createEmptyOptimizedCIM(c.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(q,c,!0);break;case n.GeometricEffectArrowType.Block:this._constructSimpleArrow(q,c,!1);break;case n.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(q,c)}return q}_constructSimpleArrow(c,
q,f){var t=q.pathLength(),m=this._width;t<2*m&&(m=t/2);var l=this._curveHelper.getSubCurve(q,0,t-m);if(l&&l.nextPath()&&(l.seekPathStart(),t=m/2,!this._curveHelper.isEmpty(l)&&(l=p.collectPath(l),m=this._constructOffset(l,-t)))&&(l=this._constructOffset(l,t))){var u=this._constructArrowBasePoint(m,-t/2);u&&(t=this._constructArrowBasePoint(l,t/2))&&(q.seekInPath(q.pathSize-1),q=[q.x,q.y],c.pushPath(l),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(t),c.nextPoint(),c.setControlPoint(),c.pushPoint(q),
c.nextPoint(),c.setControlPoint(),c.pushPoint(u),c.nextPoint(),c.setControlPoint(),c.pushPoints(m.reverse()),c.setControlPoint(),f||(c.setControlPointAt(0),c.setControlPointAt(c.pathSize-1),c.pushPoint(l[0])),c.reset())}}_constructCrossedArrow(c,q){var f=q.pathLength(),t=this._width;f<3.732050807568877*t&&(t=f/3.732050807568877);q.seekPathStart();var m=this._curveHelper.getSubCurve(q,0,f-2.732050807568877*t);if(m){m.nextPath();var l=t/2;if(!this._curveHelper.isEmpty(m)){var u=p.collectPath(m);if(m=
this._constructOffset(u,l))if(u=this._constructOffset(u,-l))if(f=this._curveHelper.getSubCurve(q,0,f-t))if(f.nextPath(),!this._curveHelper.isEmpty(f)&&(f=p.collectPath(f),t=this._constructOffset(f,l))){var v=this._constructOffset(f,-l);if(v&&(f=t[t.length-1],t=this._constructArrowBasePoint(t,l/2))){var r=v[v.length-1];if(l=this._constructArrowBasePoint(v,-l/2))q.seekInPath(q.pathSize-1),q=[q.x,q.y],c.pushPath(m),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(r),c.nextPoint(),c.setControlPoint(),
c.pushPoint(l),c.nextPoint(),c.setControlPoint(),c.pushPoint(q),c.nextPoint(),c.setControlPoint(),c.pushPoint(t),c.nextPoint(),c.setControlPoint(),c.pushPoint(f),c.nextPoint(),c.setControlPoint(),c.pushPoints(u.reverse()),c.nextPoint(),c.setControlPoint(),c.reset()}}}}}_constructOffset(c,q){return this._curveHelper.offset(c,q,n.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(c,q){if(!c||2>c.length)return null;var f=c[c.length-2];c=c[c.length-1];f=[c[0]-f[0],
c[1]-f[1]];this._curveHelper.normalize(f);return[c[0]+f[1]*q,c[1]-f[0]*q]}}e.EffectArrow=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(e,g){class p{constructor(k,n=!0,d=!0,b=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!n&&"esriGeometryPolygon"===k.geometryType||!d&&"esriGeometryPolyline"===k.geometryType?null:k;this.geomUnitsPerPoint=b;this.iteratePath=!1;this.internalPlacement=
new g.Placement}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const k=this.processPath(this.geometryCursor);if(k)return k}return this.geometryCursor=null}}class h{constructor(k,n,d,b=0){this.isClosed=!1;this.inputGeometries=k;this.acceptPolygon=n;this.acceptPolyline=d;this.geomUnitsPerPoint=b;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var k=
this.inputGeometries.next();k&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===k.geometryType||"esriGeometryEnvelope"===k.geometryType,this.multiPathCursor=k);)k=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),k=this.processPath(this.multiPathCursor))return k;this.multiPathCursor=null}}}e.PathEffectCursor=h;e.PathTransformationCursor=p;e.getId=function(k){return k[4]};e.setId=
function(k,n){k[4]=n};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(e,g,p){class h{constructor(k,n){}isEmpty(k){if(!k.nextPoint())return!0;let n,d,b,a;n=k.x;for(d=k.y;k.nextPoint();n=d,d=a)if(b=k.x,a=k.y,b!==n||a!==d)return k.seekPathStart(),!1;k.seekPathStart();return!0}normalize(k){const n=Math.sqrt(k[0]*k[0]+k[1]*k[1]);0!==n&&(k[0]/=n,k[1]/=n)}getLength(k,n,d,b){k=d-
k;n=b-n;return Math.sqrt(k*k+n*n)}getSegLength(k){const [[n,d],[b,a]]=k;return this.getLength(n,d,b,a)}getCoord2D(k,n,d,b,a){return[k+(d-k)*a,n+(b-n)*a]}getSegCoord2D(k,n){const [[d,b],[a,c]]=k;return this.getCoord2D(d,b,a,c,n)}getAngle(k,n,d,b,a){return Math.atan2(b-n,d-k)}getAngleCS(k,n,d,b,a){k=d-k;n=b-n;b=Math.sqrt(k*k+n*n);return 0<b?[k/b,n/b]:[1,0]}getSegAngleCS(k,n){const [[d,b],[a,c]]=k;return this.getAngleCS(d,b,a,c,n)}cut(k,n,d,b,a,c){a=0>=a?[k,n]:this.getCoord2D(k,n,d,b,a);k=1<=c?[d,b]:
this.getCoord2D(k,n,d,b,c);return[a,k]}getSubCurve(k,n,d){const b=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(b,k,n,d)?b:null}appendSubCurve(k,n,d,b){k.startPath();n.seekPathStart();let a=0;var c=!0;if(!n.nextPoint())return!1;var q=n.x;let f=n.y;for(;n.nextPoint();){const t=this.getLength(q,f,n.x,n.y);if(0!==t){if(c){if(a+t>d){const m=(d-a)/t;let l=1;c=!1;a+t>=b&&(l=(b-a)/t,c=!0);(q=this.cut(q,f,n.x,n.y,m,l))&&k.pushPoints(q);if(c)break;c=!1}}else{if(a+
t>b){(n=this.cut(q,f,n.x,n.y,0,(b-a)/t))&&k.pushPoint(n[1]);break}k.pushXY(n.x,n.y)}a+=t}q=n.x;f=n.y}return!0}getCIMPointAlong(k,n){if(!k.nextPoint())return null;let d=0,b,a,c,q;b=k.x;for(a=k.y;k.nextPoint();b=c,a=q){c=k.x;q=k.y;const f=this.getLength(b,a,c,q);if(0!==f){if(d+f>n)return this.getCoord2D(b,a,c,q,(n-d)/f);d+=f}}return null}offset(k,n,d,b,a){if(!k||2>k.length)return null;var c=0,q=k[c++];for(a=c;c<k.length;){var f=k[c];if(f[0]!==q[0]||f[1]!==q[1])c!==a&&(k[a]=k[c]),q=k[a++];c++}(c=k[0][0]===
k[a-1][0]&&k[0][1]===k[a-1][1])&&--a;if(a<(c?3:2))return null;f=[];q=c?k[a-1]:null;let t=k[0];for(let r=0;r<a;r++){const y=r===a-1?c?k[0]:null:k[r+1];if(q)if(y){var m=[y[0]-t[0],y[1]-t[1]];this.normalize(m);var l=[t[0]-q[0],t[1]-q[1]];this.normalize(l);var u=l[0]*m[1]-l[1]*m[0],v=l[0]*m[0]+l[1]*m[1];if(0===u&&1===v){t=y;continue}if(0<=u===0>=n)1>v&&(m=[m[0]-l[0],m[1]-l[1]],this.normalize(m),l=Math.sqrt((1+v)/2),l>1/b&&(l=-Math.abs(n)/l,f.push([t[0]-m[0]*l,t[1]-m[1]*l])));else switch(d){case p.GeometricEffectOffsetMethod.Mitered:if(q=
Math.sqrt((1+v)/2),0<q&&1/q<b){m=[m[0]-l[0],m[1]-l[1]];this.normalize(m);l=Math.abs(n)/q;f.push([t[0]-m[0]*l,t[1]-m[1]*l]);break}case p.GeometricEffectOffsetMethod.Bevelled:f.push([t[0]+l[1]*n,t[1]-l[0]*n]);f.push([t[0]+m[1]*n,t[1]-m[0]*n]);break;case p.GeometricEffectOffsetMethod.Rounded:if(1>v){f.push([t[0]+l[1]*n,t[1]-l[0]*n]);q=Math.floor(2.5*(1-v));if(0<q){u=v=1/q;for(let x=1;x<q;x++,u+=v){const w=[l[1]*(1-u)+m[1]*u,-l[0]*(1-u)-m[0]*u];this.normalize(w);f.push([t[0]+w[0]*n,t[1]+w[1]*n])}}f.push([t[0]+
m[1]*n,t[1]-m[0]*n])}break;default:0>u?(f.push([t[0]+(l[1]+l[0])*n,t[1]+(l[1]-l[0])*n]),f.push([t[0]+(m[1]-m[0])*n,t[1]-(m[0]+m[1])*n])):(q=Math.sqrt((1+Math.abs(v))/2),m=[m[0]-l[0],m[1]-l[1]],this.normalize(m),l=n/q,f.push([t[0]-m[0]*l,t[1]-m[1]*l]))}}else m=[t[0]-q[0],t[1]-q[1]],this.normalize(m),f.push([t[0]+m[1]*n,t[1]-m[0]*n]);else m=[y[0]-t[0],y[1]-t[1]],this.normalize(m),f.push([t[0]+m[1]*n,t[1]-m[0]*n]);q=t;t=y}if(f.length<(c?3:2))return null;c&&f.push([f[0][0],f[0][1]]);return f}}e.CurveHelper=
h;e.pixelTolerance=.03;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(e){e.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.ROUND=1]="ROUND";g[g.SQUARE=2]="SQUARE";g[g.UNKNOWN=4]="UNKNOWN"})(e.CapType||(e.CapType={}));e.JoinType=void 0;(function(g){g[g.BEVEL=0]="BEVEL";g[g.ROUND=1]="ROUND";g[g.MITER=2]="MITER";g[g.UNKNOWN=4]="UNKNOWN"})(e.JoinType||(e.JoinType={}));e.Alignment=void 0;(function(g){g[g.SCREEN=0]="SCREEN";
g[g.MAP=1]="MAP"})(e.Alignment||(e.Alignment={}));e.ExternalColorMixMode=void 0;(function(g){g[g.Tint=0]="Tint";g[g.Ignore=1]="Ignore";g[g.Multiply=99]="Multiply"})(e.ExternalColorMixMode||(e.ExternalColorMixMode={}));e.ExtremityPlacement=void 0;(function(g){g.Both="Both";g.JustBegin="JustBegin";g.JustEnd="JustEnd";g.None="None"})(e.ExtremityPlacement||(e.ExtremityPlacement={}));e.FillMode=void 0;(function(g){g[g.Mosaic=0]="Mosaic";g[g.Centered=1]="Centered"})(e.FillMode||(e.FillMode={}));e.FontEffects=
void 0;(function(g){g[g.Normal=0]="Normal";g[g.Superscript=1]="Superscript";g[g.Subscript=2]="Subscript"})(e.FontEffects||(e.FontEffects={}));e.FontEncoding=void 0;(function(g){g[g.MSSymbol=0]="MSSymbol";g[g.Unicode=1]="Unicode"})(e.FontEncoding||(e.FontEncoding={}));e.FontType=void 0;(function(g){g[g.Unspecified=0]="Unspecified";g[g.TrueType=1]="TrueType";g[g.PSOpenType=2]="PSOpenType";g[g.TTOpenType=3]="TTOpenType";g[g.Type1=4]="Type1"})(e.FontType||(e.FontType={}));e.AngleAlignment=void 0;(function(g){g[g.Display=
0]="Display";g[g.Map=1]="Map"})(e.AngleAlignment||(e.AngleAlignment={}));e.AnimatedSymbolRepeatType=void 0;(function(g){g.None="None";g.Loop="Loop";g.Oscillate="Oscillate"})(e.AnimatedSymbolRepeatType||(e.AnimatedSymbolRepeatType={}));e.DominantSizeAxis=void 0;(function(g){g[g.Z=0]="Z";g[g.X=1]="X";g[g.Y=2]="Y"})(e.DominantSizeAxis||(e.DominantSizeAxis={}));e.RotationOrder=void 0;(function(g){g[g.XYZ=0]="XYZ";g[g.ZXY=1]="ZXY";g[g.YXZ=2]="YXZ"})(e.RotationOrder||(e.RotationOrder={}));e.BalloonCalloutStyle=
void 0;(function(g){g[g.Rectangle=0]="Rectangle";g[g.RoundedRectangle=1]="RoundedRectangle";g[g.Oval=2]="Oval"})(e.BalloonCalloutStyle||(e.BalloonCalloutStyle={}));e.BlendingMode=void 0;(function(g){g[g.None=0]="None";g[g.Alpha=1]="Alpha";g[g.Screen=2]="Screen";g[g.Multiply=3]="Multiply";g[g.Add=4]="Add"})(e.BlendingMode||(e.BlendingMode={}));e.BlockProgression=void 0;(function(g){g[g.TTB=0]="TTB";g[g.RTL=1]="RTL";g[g.BTT=2]="BTT"})(e.BlockProgression||(e.BlockProgression={}));e.BillBoardMode=void 0;
(function(g){g[g.None=0]="None";g[g.SignPost=1]="SignPost";g[g.FaceNearPlane=2]="FaceNearPlane"})(e.BillBoardMode||(e.BillBoardMode={}));e.CGAAttributeType=void 0;(function(g){g[g.Float=0]="Float";g[g.String=1]="String";g[g.Boolean=2]="Boolean"})(e.CGAAttributeType||(e.CGAAttributeType={}));e.ClippingType=void 0;(function(g){g[g.Intersect=0]="Intersect";g[g.Subtract=1]="Subtract"})(e.ClippingType||(e.ClippingType={}));e.GeometricEffectArrowType=void 0;(function(g){g.OpenEnded="OpenEnded";g.Block=
"Block";g.Crossed="Crossed"})(e.GeometricEffectArrowType||(e.GeometricEffectArrowType={}));e.GeometricEffectControlMeasureLineRule=void 0;(function(g){g.FullGeometry="FullGeometry";g.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";g.ReversedFirstSegment="ReversedFirstSegment";g.PerpendicularToSecondSegment="PerpendicularToSecondSegment";g.SecondSegmentWithTicks="SecondSegmentWithTicks";g.DoublePerpendicular="DoublePerpendicular";g.OppositeToFirstSegment="OppositeToFirstSegment";g.TriplePerpendicular=
"TriplePerpendicular";g.HalfCircleFirstSegment="HalfCircleFirstSegment";g.HalfCircleSecondSegment="HalfCircleSecondSegment";g.HalfCircleExtended="HalfCircleExtended";g.OpenCircle="OpenCircle";g.CoverageEdgesWithTicks="CoverageEdgesWithTicks";g.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";g.GapExtentMidline="GapExtentMidline";g.Chevron="Chevron";g.PerpendicularWithArc="PerpendicularWithArc";g.ClosedHalfCircle="ClosedHalfCircle";g.TripleParallelExtended="TripleParallelExtended";g.ParallelWithTicks=
"ParallelWithTicks";g.Parallel="Parallel";g.PerpendicularToFirstSegment="PerpendicularToFirstSegment";g.ParallelOffset="ParallelOffset";g.OffsetOpposite="OffsetOpposite";g.OffsetSame="OffsetSame";g.CircleWithArc="CircleWithArc";g.DoubleJog="DoubleJog";g.PerpendicularOffset="PerpendicularOffset";g.LineExcludingLastSegment="LineExcludingLastSegment";g.MultivertexArrow="MultivertexArrow";g.CrossedArrow="CrossedArrow";g.ChevronArrow="ChevronArrow";g.ChevronArrowOffset="ChevronArrowOffset";g.PartialFirstSegment=
"PartialFirstSegment";g.Arch="Arch";g.CurvedParallelTicks="CurvedParallelTicks";g.Arc90Degrees="Arc90Degrees"})(e.GeometricEffectControlMeasureLineRule||(e.GeometricEffectControlMeasureLineRule={}));e.GeometricEffectDonutMethod=void 0;(function(g){g.Mitered="Mitered";g.Bevelled="Bevelled";g.Rounded="Rounded";g.Square="Square";g.TrueBuffer="TrueBuffer"})(e.GeometricEffectDonutMethod||(e.GeometricEffectDonutMethod={}));e.GeometricEffectEnclosingPolygonMethod=void 0;(function(g){g.ClosePath="ClosePath";
g.ConvexHull="ConvexHull";g.RectangularBox="RectangularBox"})(e.GeometricEffectEnclosingPolygonMethod||(e.GeometricEffectEnclosingPolygonMethod={}));e.GeometricEffectExtensionOrigin=void 0;(function(g){g.BeginningOfLine="BeginningOfLine";g.EndOfLine="EndOfLine"})(e.GeometricEffectExtensionOrigin||(e.GeometricEffectExtensionOrigin={}));e.GeometricEffectOffsetMethod=void 0;(function(g){g.Mitered="Mitered";g.Bevelled="Bevelled";g.Rounded="Rounded";g.Square="Square"})(e.GeometricEffectOffsetMethod||(e.GeometricEffectOffsetMethod=
{}));e.GeometricEffectOffsetOption=void 0;(function(g){g.Fast="Fast";g.Accurate="Accurate"})(e.GeometricEffectOffsetOption||(e.GeometricEffectOffsetOption={}));e.GeometricEffectOffsetTangentMethod=void 0;(function(g){g.BeginningOfLine="BeginningOfLine";g.EndOfLine="EndOfLine"})(e.GeometricEffectOffsetTangentMethod||(e.GeometricEffectOffsetTangentMethod={}));e.GeometricEffectWaveform=void 0;(function(g){g.Sinus="Sinus";g.Square="Square";g.Triangle="Triangle";g.Random="Random"})(e.GeometricEffectWaveform||
(e.GeometricEffectWaveform={}));e.GlyphHinting=void 0;(function(g){g[g.None=0]="None";g[g.Default=1]="Default";g[g.Force=2]="Force"})(e.GlyphHinting||(e.GlyphHinting={}));e.GradientAlignment=void 0;(function(g){g[g.Buffered=0]="Buffered";g[g.Left=1]="Left";g[g.Right=2]="Right";g[g.AlongLine=3]="AlongLine"})(e.GradientAlignment||(e.GradientAlignment={}));e.GradientFillMethod=void 0;(function(g){g[g.Linear=0]="Linear";g[g.Rectangular=1]="Rectangular";g[g.Circular=2]="Circular";g[g.Buffered=3]="Buffered"})(e.GradientFillMethod||
(e.GradientFillMethod={}));e.GradientStrokeType=void 0;(function(g){g[g.Discrete=0]="Discrete";g[g.Continuous=1]="Continuous"})(e.GradientStrokeType||(e.GradientStrokeType={}));e.GradientStrokeMethod=void 0;(function(g){g[g.AcrossLine=0]="AcrossLine";g[g.AloneLine=1]="AloneLine"})(e.GradientStrokeMethod||(e.GradientStrokeMethod={}));e.HorizontalAlignment=void 0;(function(g){g[g.Left=0]="Left";g[g.Right=1]="Right";g[g.Center=2]="Center";g[g.Justify=3]="Justify"})(e.HorizontalAlignment||(e.HorizontalAlignment=
{}));e.LeaderLineStyle=void 0;(function(g){g[g.Base=0]="Base";g[g.MidPoint=1]="MidPoint";g[g.ThreePoint=2]="ThreePoint";g[g.FourPoint=3]="FourPoint";g[g.Underline=4]="Underline";g[g.CircularCW=5]="CircularCW";g[g.CircularCCW=6]="CircularCCW"})(e.LeaderLineStyle||(e.LeaderLineStyle={}));e.LineCapStyle=void 0;(function(g){g.Butt="Butt";g.Round="Round";g.Square="Square"})(e.LineCapStyle||(e.LineCapStyle={}));e.LineDashEnding=void 0;(function(g){g.NoConstraint="NoConstraint";g.HalfPattern="HalfPattern";
g.HalfGap="HalfGap";g.FullPattern="FullPattern";g.FullGap="FullGap";g.Custom="Custom"})(e.LineDashEnding||(e.LineDashEnding={}));e.LineDecorationStyle=void 0;(function(g){g[g.None=-1]="None";g[g.Custom=0]="Custom";g[g.Circle=1]="Circle";g[g.OpenArrow=2]="OpenArrow";g[g.ClosedArrow=3]="ClosedArrow";g[g.Diamond=4]="Diamond"})(e.LineDecorationStyle||(e.LineDecorationStyle={}));e.LineGapType=void 0;(function(g){g[g.ExtraLeading=0]="ExtraLeading";g[g.Multiple=1]="Multiple";g[g.Exact=2]="Exact"})(e.LineGapType||
(e.LineGapType={}));e.LineJoinStyle=void 0;(function(g){g.Bevel="Bevel";g.Round="Round";g.Miter="Miter"})(e.LineJoinStyle||(e.LineJoinStyle={}));e.ExpressionReturnType=void 0;(function(g){g[g.Default=0]="Default";g[g.String=1]="String";g[g.Numeric=2]="Numeric"})(e.ExpressionReturnType||(e.ExpressionReturnType={}));e.MarkerPlacementType=void 0;(function(g){g[g.InsidePolygon=0]="InsidePolygon";g[g.PolygonCenter=1]="PolygonCenter";g[g.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(e.MarkerPlacementType||
(e.MarkerPlacementType={}));e.MaterialMode=void 0;(function(g){g[g.Tint=0]="Tint";g[g.Replace=1]="Replace";g[g.Multiply=2]="Multiply"})(e.MaterialMode||(e.MaterialMode={}));e.PlacementClip=void 0;(function(g){g[g.ClipAtBoundary=0]="ClipAtBoundary";g[g.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";g[g.DoNotTouchBoundary=2]="DoNotTouchBoundary";g[g.DoNotClip=3]="DoNotClip"})(e.PlacementClip||(e.PlacementClip={}));e.PlacementEndings=void 0;(function(g){g.NoConstraint="NoConstraint";
g.WithMarkers="WithMarkers";g.WithFullGap="WithFullGap";g.WithHalfGap="WithHalfGap";g.Custom="Custom"})(e.PlacementEndings||(e.PlacementEndings={}));e.PlacementGridType=void 0;(function(g){g.Fixed="Fixed";g.Random="Random";g.RandomFixedQuantity="RandomFixedQuantity"})(e.PlacementGridType||(e.PlacementGridType={}));e.PlacementOnLineRelativeTo=void 0;(function(g){g.LineMiddle="LineMiddle";g.LineBeginning="LineBeginning";g.LineEnd="LineEnd";g.SegmentMidpoint="SegmentMidpoint"})(e.PlacementOnLineRelativeTo||
(e.PlacementOnLineRelativeTo={}));e.PlacementPolygonCenterMethod=void 0;(function(g){g.OnPolygon="OnPolygon";g.CenterOfMass="CenterOfMass";g.BoundingBoxCenter="BoundingBoxCenter"})(e.PlacementPolygonCenterMethod||(e.PlacementPolygonCenterMethod={}));e.PlacementRandomlyAlongLineRandomization=void 0;(function(g){g[g.Low=0]="Low";g[g.Medium=1]="Medium";g[g.High=2]="High"})(e.PlacementRandomlyAlongLineRandomization||(e.PlacementRandomlyAlongLineRandomization={}));e.PlacementStepPosition=void 0;(function(g){g[g.MarkerCenter=
0]="MarkerCenter";g[g.MarkerBounds=1]="MarkerBounds"})(e.PlacementStepPosition||(e.PlacementStepPosition={}));e.PointSymbolCalloutScale=void 0;(function(g){g[g.None=0]="None";g[g.PropUniform=1]="PropUniform";g[g.PropNonuniform=2]="PropNonuniform";g[g.DifUniform=3]="DifUniform";g[g.DifNonuniform=4]="DifNonuniform"})(e.PointSymbolCalloutScale||(e.PointSymbolCalloutScale={}));e.Simple3DLineStyle=void 0;(function(g){g.Tube="Tube";g.Strip="Strip";g.Wall="Wall"})(e.Simple3DLineStyle||(e.Simple3DLineStyle=
{}));e.SizeVariationMethod=void 0;(function(g){g[g.Random=0]="Random";g[g.Increasing=1]="Increasing";g[g.Decreasing=2]="Decreasing";g[g.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(e.SizeVariationMethod||(e.SizeVariationMethod={}));e.SymbolUnits=void 0;(function(g){g[g.Relative=0]="Relative";g[g.Absolute=1]="Absolute"})(e.SymbolUnits||(e.SymbolUnits={}));e.TextCase=void 0;(function(g){g[g.Normal=0]="Normal";g[g.LowerCase=1]="LowerCase";g[g.Allcaps=2]="Allcaps"})(e.TextCase||(e.TextCase=
{}));e.TextReadingDirection=void 0;(function(g){g[g.LTR=0]="LTR";g[g.RTL=1]="RTL"})(e.TextReadingDirection||(e.TextReadingDirection={}));e.TextureFilter=void 0;(function(g){g.Draft="Draft";g.Picture="Picture";g.Text="Text"})(e.TextureFilter||(e.TextureFilter={}));e.VerticalAlignment=void 0;(function(g){g[g.Top=0]="Top";g[g.Center=1]="Center";g[g.Baseline=2]="Baseline";g[g.Bottom=3]="Bottom"})(e.VerticalAlignment||(e.VerticalAlignment={}));e.VerticalGlyphOrientation=void 0;(function(g){g[g.Right=0]=
"Right";g[g.Upright=1]="Upright"})(e.VerticalGlyphOrientation||(e.VerticalGlyphOrientation={}));e.WaterbodySize=void 0;(function(g){g[g.Small=0]="Small";g[g.Medium=1]="Medium";g[g.Large=2]="Large"})(e.WaterbodySize||(e.WaterbodySize={}));e.WaveStrength=void 0;(function(g){g[g.Calm=0]="Calm";g[g.Rippled=1]="Rippled";g[g.Slight=2]="Slight";g[g.Moderate=3]="Moderate"})(e.WaveStrength||(e.WaveStrength={}));Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(e,g,p,h,k,n,d,b){class a{static local(){null===a.instance&&(a.instance=new a);return a.instance}execute(q,f,t,m,l,u){return new c(q,f,t,m,l,u)}}a.instance=null;class c{constructor(q,f,t,m,l,u){this._inputGeometries=q;this._tileKey=m;this._geometryEngine=l;this._curveHelper=new n.CurveHelper;this._size=(void 0!==f.size?f.size:1)*t;this._maxInflateSize=u*t;this._offsetFlattenError=n.pixelTolerance*t}next(){for(var q;q=this._inputGeometries.next();){if(0===this._size)return q;if("esriGeometryEnvelope"===
q.geometryType)if(0<this._size){var f=p.GeometryCursor.createEmptyOptimizedCIM(q.geometryType),t=h.collectMultipath(q)[0];if(t=this._curveHelper.offset(t,this._size,d.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return f.pushPath(t),f}else if(0>this._size&&(f=q.asJSON(),0<Math.min(f.xmax-f.xmin,f.ymax-f.ymin)+2*this._size))return p.GeometryCursor.fromJSONCIM({xmin:f.xmin-this._size,xmax:f.xmax+this._size,ymin:f.ymin-this._size,ymax:f.ymax+this._size});f=this._geometryEngine;if(null==
f)break;if(q=this._tileKey?k.clipCursorToTileExtent(q,this._maxInflateSize):q)return(q=f.buffer(b.WebMercator,q.asJSON(),this._size,1))?p.GeometryCursor.fromJSONCIM(q):null}return null}}e.EffectBuffer=a;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(e,g,p,h,k){class n{static local(){null===
n.instance&&(n.instance=new n);return n.instance}execute(b,a,c,q,f){return new d(b,a,c)}}n.instance=null;class d{constructor(b,a,c){this._defaultPointSize=20;this._inputGeometries=b;this._geomUnitsPerPoint=c;this._rule=a.rule??k.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*c}next(){for(var b;b=this._inputGeometries.next();)if((b=this._processGeom(p.collectMultipath(b)))&&b.length)return g.GeometryCursor.fromJSONCIM({paths:b});return null}_clone(b){return[b[0],
b[1]]}_mid(b,a){return[(b[0]+a[0])/2,(b[1]+a[1])/2]}_mix(b,a,c,q){return[b[0]*a+c[0]*q,b[1]*a+c[1]*q]}_add(b,a){return[b[0]+a[0],b[1]+a[1]]}_add2(b,a,c){return[b[0]+a,b[1]+c]}_sub(b,a){return[b[0]-a[0],b[1]-a[1]]}_dist(b,a){return Math.sqrt((b[0]-a[0])*(b[0]-a[0])+(b[1]-a[1])*(b[1]-a[1]))}_norm(b){return Math.sqrt(b[0]*b[0]+b[1]*b[1])}_normalize(b,a=1){a/=this._norm(b);b[0]*=a;b[1]*=a}_leftPerpendicular(b){const a=b[0];b[0]=-b[1];b[1]=a}_leftPerp(b){return[-b[1],b[0]]}_rightPerpendicular(b){const a=
-b[0];b[0]=b[1];b[1]=a}_rightPerp(b){return[b[1],-b[0]]}_dotProduct(b,a){return b[0]*a[0]+b[1]*a[1]}_crossProduct(b,a){return b[0]*a[1]-b[1]*a[0]}_rotateDirect(b,a,c){const q=b[0]*c+b[1]*a;b[0]=b[0]*a-b[1]*c;b[1]=q}_makeCtrlPt(b){b=[b[0],b[1]];h.setId(b,1);return b}_addAngledTicks(b,a,c,q){const f=this._sub(c,a);this._normalize(f);var t=this._crossProduct(f,this._sub(q,a));q=0<t?this._rightPerp(f):this._leftPerp(f);t=Math.abs(t)/2;const m=[];m.push([a[0]+(q[0]-f[0])*t,a[1]+(q[1]-f[1])*t]);m.push(a);
m.push(c);m.push([c[0]+(q[0]+f[0])*t,c[1]+(q[1]+f[1])*t]);b.push(m)}_addBezier2(b,a,c,q,f){if(0===f--)b.push(q);else{var t=this._mid(a,c);c=this._mid(c,q);var m=this._mid(t,c);this._addBezier2(b,a,t,m,f);this._addBezier2(b,m,c,q,f)}}_addBezier3(b,a,c,q,f,t){if(0===t--)b.push(f);else{var m=this._mid(a,c),l=this._mid(c,q);q=this._mid(q,f);c=this._mid(m,l);l=this._mid(l,q);var u=this._mid(c,l);this._addBezier3(b,a,m,c,u,t);this._addBezier3(b,u,l,q,f,t)}}_add90DegArc(b,a,c,q,f){q=f??0<this._crossProduct(this._sub(c,
a),this._sub(q,a));f=this._mid(a,c);const t=this._sub(f,a);q?this._leftPerpendicular(t):this._rightPerpendicular(t);f[0]+=t[0];f[1]+=t[1];this._addBezier3(b,a,this._mix(a,.33333,f,.66667),this._mix(c,.33333,f,.66667),c,4)}_addArrow(b,a,c){var q=a[0],f=a[1],t=a[a.length-1],m=this._sub(q,f);this._normalize(m);const l=this._crossProduct(m,this._sub(t,f));f=.5*l;var u=this._leftPerp(m);const v=[t[0]-u[0]*l,t[1]-u[1]*l];var r=a.length-1;t=[];t.push(c?[-u[0],-u[1]]:u);var y=[-m[0],-m[1]];for(c=1;c<r-1;c++){m=
this._sub(a[c+1],a[c]);this._normalize(m);var x=this._dotProduct(m,y);u=this._crossProduct(m,y);x=Math.sqrt((1+x)/2);y=this._sub(m,y);this._normalize(y);y[0]/=x;y[1]/=x;t.push(0>u?[-y[0],-y[1]]:y);y=m}t.push(this._rightPerp(y));for(r=t.length-1;0<r;r--)b.push([a[r][0]+t[r][0]*f,a[r][1]+t[r][1]*f]);b.push([v[0]+t[0][0]*f,v[1]+t[0][1]*f]);b.push([v[0]+t[0][0]*l,v[1]+t[0][1]*l]);b.push(q);b.push([v[0]-t[0][0]*l,v[1]-t[0][1]*l]);b.push([v[0]-t[0][0]*f,v[1]-t[0][1]*f]);for(q=1;q<t.length;q++)b.push([a[q][0]-
t[q][0]*f,a[q][1]-t[q][1]*f])}_cp2(b,a,c){return 2<=b.length?b[1]:this._add2(b[0],a*this._defaultSize,c*this._defaultSize)}_cp3(b,a,c,q){if(3<=b.length)return b[2];c=this._mix(b[0],1-c,a,c);b=this._sub(a,b[0]);this._normalize(b);this._rightPerpendicular(b);return[c[0]+b[0]*q*this._defaultSize,c[1]+b[1]*q*this._defaultSize]}_arrowPath(b){if(2<b.length)return b;const a=b[0];b=this._cp2(b,-4,0);const c=this._sub(a,b);this._normalize(c);const q=this._rightPerp(c);return[a,b,[a[0]+(q[0]-c[0])*this._defaultSize,
a[1]+(q[1]-c[1])*this._defaultSize]]}_arrowLastSeg(b){var a=b[0];const c=this._cp2(b,-4,0);if(3<=b.length)a=b[b.length-1];else{b=this._sub(a,c);this._normalize(b);const q=this._rightPerp(b);a=[a[0]+(q[0]-b[0])*this._defaultSize,a[1]+(q[1]-b[1])*this._defaultSize]}return[c,a]}_processGeom(b){if(!b)return null;const a=[];for(const c of b){if(!c||0===c.length)continue;const q=c.length;let f=c[0];switch(this._rule){case k.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const t=this._cp2(c,
0,-1),m=this._cp3(c,t,.5,4),l=[];l.push(m);l.push(this._mid(f,t));a.push(l);break;case k.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const u=this._cp2(c,0,-1);a.push([u,f]);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const v=this._cp2(c,-4,1),r=this._cp3(c,v,.882353,-1.94),y=[];y.push(this._mid(v,r));y.push(f);a.push(y);break;case k.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const x=this._cp2(c,-4,1),w=this._cp3(c,x,.882353,-1.94),
A=this._sub(w,x);let z;z=0<this._crossProduct(A,this._sub(f,x))?this._rightPerp(z):this._leftPerp(A);const C=[];C.push([x[0]+(z[0]-A[0])/3,x[1]+(z[1]-A[1])/3]);C.push(x);C.push(w);C.push([w[0]+(z[0]+A[0])/3,w[1]+(z[1]+A[1])/3]);a.push(C);break;case k.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const D=this._cp2(c,0,-1),F=this._cp3(c,D,.5,3),G=this._mid(f,D),B=this._sub(G,F);this._normalize(B);const I=this._crossProduct(B,this._sub(f,F));this._leftPerpendicular(B);const H=[];H.push(f);
H.push([F[0]+B[0]*I,F[1]+B[1]*I]);a.push(H);const K=[];K.push([F[0]-B[0]*I,F[1]-B[1]*I]);K.push(D);a.push(K);break;case k.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const O=this._cp2(c,0,-1),R=this._cp3(c,O,.5,3),E=this._mid(f,O),J=this._sub(E,R);this._normalize(J);const Q=this._crossProduct(J,this._sub(f,R));this._leftPerpendicular(J);const N=[];N.push([R[0]+J[0]*Q,R[1]+J[1]*Q]);N.push([R[0]-J[0]*Q,R[1]-J[1]*Q]);a.push(N);break;case k.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const S=
this._cp2(c,0,-1),W=this._cp3(c,S,.5,4),U=this._mid(f,S),M=this._sub(U,W);this._normalize(M);const P=this._crossProduct(M,this._sub(f,W));this._leftPerpendicular(M);const T=[];T.push([W[0]+M[0]*P*.8,W[1]+M[1]*P*.8]);T.push([U[0]+.8*(f[0]-U[0]),U[1]+.8*(f[1]-U[1])]);a.push(T);a.push([W,U]);const X=[];X.push([W[0]-M[0]*P*.8,W[1]-M[1]*P*.8]);X.push([U[0]+.8*(S[0]-U[0]),U[1]+.8*(S[1]-U[1])]);a.push(X);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const Y=this._cp2(c,0,-1),
Z=this._cp3(c,Y,.5,4),ba=this._mid(f,Y);let aa=this._sub(Y,f);const da=Math.cos(Math.PI/18),fa=Math.sin(Math.PI/18),ia=Math.sqrt((1+da)/2),ha=Math.sqrt((1-da)/2),ja=[];let ma;0<this._crossProduct(aa,this._sub(Z,f))?(ja.push(f),aa=this._sub(f,ba),ma=Y):(ja.push(Y),aa=this._sub(Y,ba),ma=f);this._rotateDirect(aa,ia,ha);aa[0]/=ia;aa[1]/=ia;for(let la=1;18>=la;la++)ja.push(this._add(ba,aa)),this._rotateDirect(aa,da,fa);ja.push(ma);a.push(ja);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const na=
this._cp2(c,0,-1),oa=this._cp3(c,na,1,-1);let pa=this._sub(f,na);this._normalize(pa);const ta=this._crossProduct(pa,this._sub(oa,na))/2;this._leftPerpendicular(pa);const sa=[na[0]+pa[0]*ta,na[1]+pa[1]*ta];pa=this._sub(na,sa);const L=Math.cos(Math.PI/18);let V=Math.sin(Math.PI/18);0<ta&&(V=-V);const ca=[na];for(let la=1;18>=la;la++)this._rotateDirect(pa,L,V),ca.push(this._add(sa,pa));a.push(ca);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const ea=this._cp2(c,0,-2),ka=this._cp3(c,
ea,1,-1);let ua;if(4<=q)ua=c[3];else{const la=this._sub(f,ea);ua=this._add(ka,la)}const Ca=this._dist(ea,ka)/2/.75,Xa=this._sub(ea,f);this._normalize(Xa,Ca);const Ya=this._sub(ka,ua);this._normalize(Ya,Ca);a.push([ua,ka]);const hb=[this._clone(ka)];this._addBezier3(hb,ka,this._add(ka,Ya),this._add(ea,Xa),ea,4);hb.push(f);a.push(hb);break;case k.GeometricEffectControlMeasureLineRule.OpenCircle:const sb=this._cp2(c,-2,0),tb=this._sub(sb,f),Pb=Math.cos(Math.PI/18),Qb=-Math.sin(Math.PI/18),ub=[sb];for(let la=
1;33>=la;la++)this._rotateDirect(tb,Pb,Qb),ub.push(this._add(f,tb));a.push(ub);break;case k.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const za=this._cp2(c,0,-1);let Na;if(3<=q)Na=c[2];else{const la=this._sub(za,f),qa=this._leftPerp(la);Na=[f[0]+qa[0]-.25*la[0],f[1]+qa[1]-.25*la[1]]}let vb;if(4<=q)vb=c[3];else{const la=this._mid(f,za),qa=this._sub(f,za);this._normalize(qa);this._leftPerpendicular(qa);const va=this._crossProduct(qa,this._sub(Na,la));this._rightPerpendicular(qa);vb=
[Na[0]+qa[0]*va*2,Na[1]+qa[1]*va*2]}const Da=this._sub(za,f);let Oa,Aa;Oa=0<this._crossProduct(Da,this._sub(Na,f))?this._rightPerp(Da):this._leftPerp(Da);Aa=[];Aa.push(Na);Aa.push(f);Aa.push([f[0]+(Oa[0]-Da[0])/3,f[1]+(Oa[1]-Da[1])/3]);a.push(Aa);Oa=0<this._crossProduct(Da,this._sub(vb,za))?this._rightPerp(Oa):this._leftPerp(Da);Aa=[];Aa.push([za[0]+(Oa[0]+Da[0])/3,za[1]+(Oa[1]+Da[1])/3]);Aa.push(za);Aa.push(vb);a.push(Aa);break;case k.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const wb=
this._cp2(c,0,2),Rb=this._cp3(c,wb,0,1);let xb;if(4<=q)xb=c[3];else{const la=this._sub(wb,f);xb=this._add(Rb,la)}this._addAngledTicks(a,f,wb,this._mid(Rb,xb));this._addAngledTicks(a,Rb,xb,this._mid(f,wb));break;case k.GeometricEffectControlMeasureLineRule.GapExtentMidline:const Sb=this._cp2(c,2,0),oc=this._cp3(c,Sb,0,1);let Tb;if(4<=q)Tb=c[3];else{const la=this._sub(Sb,f);Tb=this._add(oc,la)}const Ub=[];Ub.push(this._mid(f,oc));Ub.push(this._mid(Sb,Tb));a.push(Ub);break;case k.GeometricEffectControlMeasureLineRule.Chevron:const pc=
this._cp2(c,-1,-1);let Vb;if(3<=q)Vb=c[2];else{const la=this._sub(pc,f);this._leftPerpendicular(la);Vb=this._add(f,la)}a.push([pc,this._makeCtrlPt(f),Vb]);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Za=this._cp2(c,0,-2),qc=this._cp3(c,Za,.5,-1);let ra=this._sub(Za,f);const $a=this._norm(ra);ra[0]/=$a;ra[1]/=$a;const Pa=this._crossProduct(ra,this._sub(qc,f));let ab=this._dotProduct(ra,this._sub(qc,f));ab<.05*$a?ab=.05*$a:ab>.95*$a&&(ab=.95*$a);const yb=[f[0]+ra[0]*
ab,f[1]+ra[1]*ab];this._leftPerpendicular(ra);let bb=[];bb.push([yb[0]-ra[0]*Pa,yb[1]-ra[1]*Pa]);bb.push([yb[0]+ra[0]*Pa,yb[1]+ra[1]*Pa]);a.push(bb);const rc=[Za[0]+ra[0]*Pa,Za[1]+ra[1]*Pa];ra=this._sub(Za,rc);const Qc=Math.cos(Math.PI/18);let Wb=Math.sin(Math.PI/18);0>Pa&&(Wb=-Wb);bb=[f,Za];for(let la=1;9>=la;la++)this._rotateDirect(ra,Qc,Wb),bb.push(this._add(rc,ra));a.push(bb);break;case k.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const Xb=this._cp2(c,2,0),sc=this._mid(f,Xb),tc=this._sub(Xb,
sc),Rc=Math.cos(Math.PI/18),Sc=Math.sin(Math.PI/18),uc=[f,Xb];for(let la=1;18>=la;la++)this._rotateDirect(tc,Rc,Sc),uc.push(this._add(sc,tc));a.push(uc);break;case k.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const Qa=this._cp2(c,0,-2),Yb=this._cp3(c,Qa,1,-2),Ra=this._mid(f,Qa),Ba=this._sub(Yb,Qa);this._normalize(Ba);const vc=Math.abs(this._crossProduct(Ba,this._sub(Ra,Qa)))/2,cb=this._dist(Qa,Yb),wc=[Qa,f];wc.push([f[0]+Ba[0]*cb*.5,f[1]+Ba[1]*cb*.5]);a.push(wc);const db=[];db.push([Ra[0]-
Ba[0]*vc,Ra[1]-Ba[1]*vc]);db.push([Ra[0]+Ba[0]*cb*.375,Ra[1]+Ba[1]*cb*.375]);h.setId(db[db.length-1],1);db.push([Ra[0]+Ba[0]*cb*.75,Ra[1]+Ba[1]*cb*.75]);a.push(db);a.push([Qa,Yb]);break;case k.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const ib=this._cp2(c,3,0),Zb=this._cp3(c,ib,.5,-1),jb=this._sub(Zb,ib);this._normalize(jb);const xc=this._crossProduct(jb,this._sub(Zb,f));this._leftPerpendicular(jb);this._addAngledTicks(a,f,ib,Zb);this._addAngledTicks(a,this._mix(f,1,jb,xc),this._mix(ib,
1,jb,xc),this._mid(f,ib));break;case k.GeometricEffectControlMeasureLineRule.Parallel:const kb=this._cp2(c,3,0),Tc=this._cp3(c,kb,.5,-1),$b=this._sub(kb,f);this._normalize($b);const zb=this._leftPerp($b),Ab=this._crossProduct($b,this._sub(Tc,f));let lb=[f,kb];a.push(lb);lb=[];lb.push([f[0]+zb[0]*Ab,f[1]+zb[1]*Ab]);lb.push([kb[0]+zb[0]*Ab,kb[1]+zb[1]*Ab]);a.push(lb);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const ac=this._cp2(c,3,0),Uc=this._cp3(c,ac,.5,-1),Bb=
this._mid(f,ac),Sa=this._sub(ac,f);this._normalize(Sa);const Cb=this._crossProduct(Sa,this._sub(Uc,f));this._leftPerpendicular(Sa);const bc=[];bc.push([Bb[0]-Sa[0]*Cb*.25,Bb[1]-Sa[1]*Cb*.25]);bc.push([Bb[0]+Sa[0]*Cb*1.25,Bb[1]+Sa[1]*Cb*1.25]);a.push(bc);break;case k.GeometricEffectControlMeasureLineRule.ParallelOffset:const eb=this._cp2(c,3,0),Vc=this._cp3(c,eb,.5,-1),xa=this._sub(eb,f);this._normalize(xa);const Ga=this._crossProduct(xa,this._sub(Vc,f));this._leftPerpendicular(xa);const cc=[];cc.push([f[0]-
xa[0]*Ga,f[1]-xa[1]*Ga]);cc.push([eb[0]-xa[0]*Ga,eb[1]-xa[1]*Ga]);a.push(cc);const dc=[];dc.push([f[0]+xa[0]*Ga,f[1]+xa[1]*Ga]);dc.push([eb[0]+xa[0]*Ga,eb[1]+xa[1]*Ga]);a.push(dc);break;case k.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Db=this._cp2(c,3,0),Wc=this._cp3(c,Db,.5,-1),Ta=this._sub(Db,f);this._normalize(Ta);const Eb=this._crossProduct(Ta,this._sub(Wc,f));this._leftPerpendicular(Ta);const ec=[];ec.push([f[0]-Ta[0]*Eb,f[1]-Ta[1]*Eb]);ec.push([Db[0]-Ta[0]*Eb,Db[1]-Ta[1]*Eb]);
a.push(ec);break;case k.GeometricEffectControlMeasureLineRule.OffsetSame:const Fb=this._cp2(c,3,0),Xc=this._cp3(c,Fb,.5,-1),Ua=this._sub(Fb,f);this._normalize(Ua);const Gb=this._crossProduct(Ua,this._sub(Xc,f));this._leftPerpendicular(Ua);const fc=[];fc.push([f[0]+Ua[0]*Gb,f[1]+Ua[1]*Gb]);fc.push([Fb[0]+Ua[0]*Gb,Fb[1]+Ua[1]*Gb]);a.push(fc);break;case k.GeometricEffectControlMeasureLineRule.CircleWithArc:let Ha=this._cp2(c,3,0);const gc=this._cp3(c,Ha,.5,-1);let fb,Hb;if(4<=q)fb=c[3],Hb=0<this._crossProduct(this._sub(fb,
Ha),this._sub(gc,Ha));else{fb=Ha;Hb=0<this._crossProduct(this._sub(fb,f),this._sub(gc,f));const la=24*this._geomUnitsPerPoint,qa=this._sub(fb,f);this._normalize(qa,la);const va=Math.sqrt(2)/2;this._rotateDirect(qa,va,Hb?va:-va);Ha=this._add(f,qa)}const yc=this._sub(Ha,f),Yc=Math.cos(Math.PI/18),Zc=Math.sin(Math.PI/18),mb=[Ha];for(let la=1;36>=la;la++)this._rotateDirect(yc,Yc,Zc),mb.push(this._add(f,yc));this._add90DegArc(mb,Ha,fb,gc,Hb);h.setId(mb[mb.length-8],1);a.push(mb);break;case k.GeometricEffectControlMeasureLineRule.DoubleJog:let Ia=
this._cp2(c,-3,1),Ja;Ja=3<=q?c[2]:this._add(f,this._sub(f,Ia));let Ea;if(4<=q)Ea=c[3];else{const la=f;f=Ia;Ea=Ja;const qa=this._dist(f,la),va=this._dist(Ea,la);let Ka=30*this._geomUnitsPerPoint;.5*qa<Ka&&(Ka=.5*qa);.5*va<Ka&&(Ka=.5*va);Ia=this._mix(f,Ka/qa,la,(qa-Ka)/qa);Ja=this._mix(Ea,Ka/va,la,(va-Ka)/va)}const zc=this._mid(f,Ia),Ac=this._mid(Ea,Ja),$c=this._dist(f,Ia),ad=this._dist(Ja,Ea);let Ib=Math.min($c,ad)/8;Ib=Math.min(Ib,24*this._geomUnitsPerPoint);const La=Math.cos(Math.PI/4);let wa=this._sub(f,
Ia);this._normalize(wa,Ib);0<this._crossProduct(wa,this._sub(Ea,Ia))?this._rotateDirect(wa,La,-La):this._rotateDirect(wa,La,La);let ya=[];ya.push(Ia);ya.push(this._add(zc,wa));ya.push(this._sub(zc,wa));ya.push(f);a.push(ya);wa=this._sub(Ea,Ja);this._normalize(wa,Ib);0>this._crossProduct(wa,this._sub(f,Ja))?this._rotateDirect(wa,La,La):this._rotateDirect(wa,La,-La);ya=[];ya.push(Ja);ya.push(this._add(Ac,wa));ya.push(this._sub(Ac,wa));ya.push(Ea);a.push(ya);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const Jb=
this._cp2(c,-4,1),Bc=this._cp3(c,Jb,.882353,-1.94),nb=this._sub(Bc,Jb);0<this._crossProduct(nb,this._sub(f,Jb))?this._rightPerpendicular(nb):this._leftPerpendicular(nb);const bd=[nb[0]/8,nb[1]/8],cd=this._sub(this._mid(Jb,Bc),bd);a.push([cd,f]);break;case k.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const Cc=this._arrowPath(c),Dc=[];let Ec=Cc.length-2;for(;Ec--;)Dc.push(Cc[Ec]);a.push(Dc);break;case k.GeometricEffectControlMeasureLineRule.MultivertexArrow:const dd=this._arrowPath(c),
Fc=[];this._addArrow(Fc,dd,!1);a.push(Fc);break;case k.GeometricEffectControlMeasureLineRule.CrossedArrow:const ed=this._arrowPath(c),Gc=[];this._addArrow(Gc,ed,!0);a.push(Gc);break;case k.GeometricEffectControlMeasureLineRule.ChevronArrow:const [Hc,ob]=this._arrowLastSeg(c),Kb=10*this._geomUnitsPerPoint,Va=this._sub(f,Hc);this._normalize(Va);const Ic=this._crossProduct(Va,this._sub(ob,Hc)),Jc=this._leftPerp(Va),Kc=[ob[0]-Jc[0]*Ic*2,ob[1]-Jc[1]*Ic*2],Lb=[];Lb.push([ob[0]+Va[0]*Kb,ob[1]+Va[1]*Kb]);
Lb.push(f);Lb.push([Kc[0]+Va[0]*Kb,Kc[1]+Va[1]*Kb]);a.push(Lb);break;case k.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [Lc,hc]=this._arrowLastSeg(c),Fa=this._sub(f,Lc);this._normalize(Fa);const gb=this._crossProduct(Fa,this._sub(hc,Lc));this._leftPerpendicular(Fa);const pb=[hc[0]-Fa[0]*gb,hc[1]-Fa[1]*gb],Mb=[];Mb.push([pb[0]+Fa[0]*gb*.5,pb[1]+Fa[1]*gb*.5]);Mb.push(this._mid(pb,f));Mb.push([pb[0]-Fa[0]*gb*.5,pb[1]-Fa[1]*gb*.5]);a.push(Mb);break;case k.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [ic,
jc]=this._arrowLastSeg(c),qb=this._sub(f,ic);this._normalize(qb);const Mc=this._crossProduct(qb,this._sub(jc,ic));this._leftPerpendicular(qb);a.push([ic,[jc[0]-qb[0]*Mc,jc[1]-qb[1]*Mc]]);break;case k.GeometricEffectControlMeasureLineRule.Arch:const kc=this._cp2(c,0,-1),Nb=this._cp3(c,kc,.5,1),Nc=this._sub(f,kc),fd=this._mix(Nb,1,Nc,.55),gd=this._mix(Nb,1,Nc,-.55),lc=[f];this._addBezier2(lc,f,fd,Nb,4);this._addBezier2(lc,Nb,gd,kc,4);a.push(lc);break;case k.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Ma=
this._cp2(c,-4,1),rb=this._cp3(c,Ma,.882353,-1.94),Wa=this._sub(rb,Ma);0<this._crossProduct(Wa,this._sub(f,Ma))?this._rightPerpendicular(Wa):this._leftPerpendicular(Wa);const mc=[Wa[0]/8,Wa[1]/8],Oc=this._sub(this._mid(Ma,rb),mc),hd=this._sub(this._mix(Ma,.75,rb,.25),mc),id=this._sub(this._mix(Ma,.25,rb,.75),mc),Ob=[Ma];this._addBezier2(Ob,Ma,hd,Oc,3);this._addBezier2(Ob,Oc,id,rb,3);a.push(Ob);for(let la=0;8>la;la++){const qa=Ob[2*la+1],va=[this._clone(qa)];va.push(this._add(qa,[Wa[0]/4,Wa[1]/4]));
a.push(va)}break;case k.GeometricEffectControlMeasureLineRule.Arc90Degrees:const nc=this._cp2(c,0,-1),jd=this._cp3(c,nc,.5,1),Pc=[nc];this._add90DegArc(Pc,nc,f,jd);a.push(Pc);break;default:a.push(c)}}return a}}e.EffectControlMeasureLine=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=
new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends p.PathEffectCursor{constructor(d,b,a){super(d,!0,!0);this._curveHelper=new h.CurveHelper;this._beginCut=(void 0!==b.beginCut?b.beginCut:1)*a;this._endCut=(void 0!==b.endCut?b.endCut:1)*a;this._middleCut=(void 0!==b.middleCut?b.middleCut:0)*a;this._invert=void 0!==b.invert?b.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(d){const {_beginCut:b,
_endCut:a,_middleCut:c}=this,q=d.pathLength(),f=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===b&&0===a&&0===c)for(f.startPath();d.nextPoint();)f.pushXY(d.x,d.y);else b+a+c<q&&(0===c?this._curveHelper.appendSubCurve(f,d,b,q-a):(this._curveHelper.appendSubCurve(f,d,b,.5*(q-c)),this._curveHelper.appendSubCurve(f,d,.5*(q+c),q-a)));else if(0!==b||0!==a||0!==c)if(b+a+c>=q)for(f.startPath();d.nextPoint();)f.pushXY(d.x,d.y);else this._curveHelper.appendSubCurve(f,
d,0,b),this._curveHelper.appendSubCurve(f,d,.5*(q-c),.5*(q+c)),this._curveHelper.appendSubCurve(f,d,q-a,a);return 0===f.totalSize?null:f}}e.EffectCut=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),function(e,g,p,h,k,n,d){class b{static local(){null===b.instance&&(b.instance=new b);
return b.instance}execute(c,q,f,t,m){return new a(c,q,f)}}b.instance=null;class a extends h.PathEffectCursor{constructor(c,q,f){super(c,!0,!0);this._firstCurve=null;this._walker=new n.GeometryWalker;this._walker.updateTolerance(f);this._endings=q.lineDashEnding;this._customDashPos=-(q.offsetAlongLine??0)*f;this._offsetAtEnd=(q.customEndingOffset??0)*f;this._pattern=new n.DashPattern;this._pattern.init(d.normalizeDashTemplate(q).dashTemplate,!0);this._pattern.scale(f)}processPath(c){if(0===this._pattern.length())return this.iteratePath=
!1,c=p.collectPath(c),g.GeometryCursor.fromJSONCIM({paths:[c]});if(!this.iteratePath){var q=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case k.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case k.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case k.LineDashEnding.NoConstraint:this.isClosed||(q=!1);break;case k.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=
.5*this._offsetAtEnd)}var f=c.pathLength();if(this._pattern.isEmpty()||f<.1*this._pattern.length()||!this._walker.init(c,this._pattern,q))return c=p.collectPath(c),g.GeometryCursor.fromJSONCIM({paths:[c]})}if(this.iteratePath)c=this._pattern.nextValue();else{switch(this._endings){default:q=.5*this._pattern.firstValue();break;case k.LineDashEnding.HalfGap:q=.5*-this._pattern.lastValue();break;case k.LineDashEnding.FullGap:q=-this._pattern.lastValue();break;case k.LineDashEnding.FullPattern:q=0;break;
case k.LineDashEnding.NoConstraint:case k.LineDashEnding.Custom:q=-this._customDashPos}c=q/this._pattern.length();c-=Math.floor(c);q=c*this._pattern.length();this._pattern.reset();c=this._pattern.nextValue();for(f=!1;q>=c;)q-=c,c=this._pattern.nextValue(),f=!f;c-=q;f?(this._walker.nextPosition(c),c=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(c),c=this._pattern.nextValue(),this._walker.nextPosition(c),c=this._pattern.nextValue())}if(q=this._walker.nextCurve(c))if(this._walker.isPathEnd()){if(this.iteratePath=
!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)q.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else c=this._pattern.nextValue(),!this._walker.nextPosition(c)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(q.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,q=this._firstCurve,this._firstCurve=null;q?.reset();return q}}e.EffectDashes=b;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(e,g,p){class h{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(b,a,c=!0){this._setEmpty();if(!b||0===b.length)return!1;for(let q=0;q<b.length;q++){let f=Math.abs(b[q]);c&&1E-7>f&&(f=1E-7);this._values.push(f);this._length+=f}a&&b.length&
1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(b){const a=this._values?this._values.length:0;for(let c=0;c<a;++c)this._values[c]*=b;this._length*=b;this.extPtGap*=b;this.ctrlPtGap*=b}addValue(b){this._length+=b;this._values.push(b)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=
-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0}}class k{constructor(){this.pt=null;this.sa=this.ca=0}}e.EndType=void 0;(function(b){b[b.FAIL=0]="FAIL";b[b.END=1]="END";b[b.CONTINUE=2]="CONTINUE"})(e.EndType||(e.EndType={}));class n{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(b){b.segment=this.segment;
b.segmentLength=this.segmentLength;b.abscissa=this.abscissa;b.isPathEnd=this.isPathEnd;b.isPartEnd=this.isPartEnd}}class d extends p.CurveHelper{constructor(b=0,a=!1){super(b,a);this._tolerance=p.pixelTolerance;this._currentPosition=new n}updateTolerance(b){this._tolerance=p.pixelTolerance*b}init(b,a,c=!0){c?(this._patternLength=a.length(),this._partExtPtGap=a.extPtGap,this._partCtrlPtGap=a.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=
0;this._pathCursor=b;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(b,a=e.EndType.FAIL){const c=new n;if(!this._nextPosition(b,c,null,a))return!1;c.copyTo(this._currentPosition);return!0}curPointAndAngle(b){b.pt=this._getPoint(this._currentPosition);const [a,c]=this._getAngleCS(this._currentPosition);b.ca=a;b.sa=c}nextPointAndAngle(b,a,c=e.EndType.FAIL){const q=new n;if(!this._nextPosition(b,q,null,c))return!1;q.copyTo(this._currentPosition);
a.pt=this._getPoint(q);const [f,t]=this._getAngleCS(q);a.ca=f;a.sa=t;return!0}nextCurve(b){if(0===b)return null;const a=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");a.startPath();a.nextPath();const c=new n;if(!this._nextPosition(b,c,a,e.EndType.END))return null;c.copyTo(this._currentPosition);return a}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(b){this._pathCursor.seekInPath(b);return[this._pathCursor.x,this._pathCursor.y]}getSeg(b){const a=
this.getPt(b);b=this.getPt(b+1);return[a,b]}_nextPosition(b,a,c,q){if(this._currentPosition.isPathEnd)return!1;var f=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(f/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(a);a.abscissa+b*this._partLengthRatio>a.segmentLength+this._tolerance;)if(c&&(0===c.pathSize&&(0===f?(f=a.segment[0],c.pushXY(f[0],f[1])):c.pushPoint(this.getSegCoord2D(a.segment,f))),f=a.segment[1],c.pushXY(f[0],f[1])),f=0,b-=(a.segmentLength-
a.abscissa)/this._partLengthRatio,this._partSegCount)a.segment=this._nextSegment(),a.segmentLength=this.getSegLength(a.segment),a.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(q===e.EndType.FAIL)return!1;a.segmentLength=this.getSegLength(a.segment);a.isPartEnd=!0;q===e.EndType.END?(a.abscissa=a.segmentLength,a.isPathEnd=!0):a.abscissa=a.segmentLength+b;return!0}this._currentPosition.copyTo(a)}a.abscissa+=b*this._partLengthRatio;c&&(0===c.pathSize&&(0===f?c.pushPoint(a.segment[0]):
c.pushPoint(this.getSegCoord2D(a.segment,f))),b=a.abscissa/a.segmentLength,1===b?c.pushPoint(a.segment[1]):c.pushPoint(this.getSegCoord2D(a.segment,b)));!this._partSegCount&&Math.abs(a.abscissa-a.segmentLength)<this._tolerance&&(a.isPathEnd=this._partIsLast,a.isPartEnd=!0);return!0}_getPoint(b){return this.getSegCoord2D(this._currentPosition.segment,0>=b.segmentLength?0:b.abscissa/b.segmentLength)}_getAngleCS(b){return this.getSegAngleCS(this._currentPosition.segment,0>=b.segmentLength?0:b.abscissa/
b.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var b=this._partSegCount;b;)this._previousSegment(),--b;
this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;b=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(b);b=b+this._partSegCount+1;b>=this._pathCursor.pathSize&&(b=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(b);if(0<this._patternLength){b=this._ctrlPtBegin?
this._partCtrlPtGap:this._partExtPtGap;const a=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let c=Math.round((this._partLength-(b+a))/this._patternLength);0>=c&&(c=0<b+a?0:1);this._partLengthRatio=this._partLength/(b+a+c*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+
1}}e.DashPattern=h;e.GeometryWalker=d;e.Pos=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),function(e,g,p,h,k,n){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(a,c,q,f,t,m){return new b(a,c,q,f,t,m)}}d.instance=null;class b{constructor(a,c,q,f,t,m){this._inputGeometries=
a;this._tileKey=f;this._geometryEngine=t;this._maxInflateSize=m*q;this._width=(void 0!==c.width?c.width:2)*q;this._option=c.option}next(){for(var a;a=this._inputGeometries.next();){if("esriGeometryEnvelope"===a.geometryType&&0<this._width){var c=a.asJSON();return 0>Math.min(c.xmax-c.xmin,c.ymax-c.ymin)-2*this._width?a:p.GeometryCursor.fromJSONCIM({paths:[[[c.xmin+this._width,c.ymin+this._width],[c.xmax-this._width,c.ymin+this._width],[c.xmax-this._width,c.ymax-this._width],[c.xmin+this._width,c.ymax-
this._width],[c.xmin+this._width,c.ymin+this._width]],[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]})}if("esriGeometryPolygon"===a.geometryType){if(0===this._width)return a.clone();var q=this._geometryEngine;if(null==q)break;if(a=this._tileKey?h.clipCursorToTileExtent(a,this._maxInflateSize):a.clone()){if(q=q.buffer(n.WebMercator,a.asJSON(),-this._width,1))for(c of q.rings)if(c){a.startPath();for(const f of c.reverse())a.pushXY(f[0],a.yFactor*f[1])}return a}}}return null}}
e.EffectDonut=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends p.PathEffectCursor{constructor(d,b,a){super(d,!1,!0);this._curveHelper=new h.CurveHelper;this._length=(void 0!==b.length?
b.length:20)*a;this._angle=void 0!==b.angle?b.angle:225;this._position=void 0!==b.position?b.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(d){const b=g.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(d))return null;d.seekInPath(0);const a=d.x,c=d.y;d.seekInPath(d.pathSize-1);const q=d.x;d=d.y;this._curveHelper.normalize([q-a,d-c]);const f=
a+(q-a)*this._position/100,t=c+(d-c)*this._position/100,m=Math.cos((90-this._angle)/180*Math.PI);let l=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(l=-l);this._mirror=!this._mirror;b.pushPath([[a,c],[f-this._length/2*m,t-this._length/2*l],[f+this._length/2*m,t+this._length/2*l],[q,d]]);return b}}e.EffectJog=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(e){class g{static local(){null===g.instance&&
(g.instance=new g);return g.instance}execute(h,k,n,d,b){return new p(h,k,n)}}g.instance=null;class p{constructor(h,k,n){this._inputGeometries=h;this._offsetX=void 0!==k.offsetX?k.offsetX*n:0;this._offsetY=void 0!==k.offsetY?k.offsetY*n:0}next(){let h=this._inputGeometries.next();for(;h;){if(0<h.totalSize)return this._move(h.clone(),this._offsetX,this._offsetY);h=this._inputGeometries.next()}return null}_move(h,k,n){for(;h.nextPath();)for(;h.nextPoint();)h.x+=k,h.y+=n;h.reset();return h}}e.EffectMove=
g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(e,g,p,h,k,n,d,b,a){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(f,t,m,l,u,v){return new q(f,t,m,l,u,
v)}}c.instance=null;class q{constructor(f,t,m,l,u,v){this._inputGeometries=f;this._tileKey=l;this._geometryEngine=u;this._curveHelper=new d.CurveHelper;this._offset=(t.offset??1)*m;this._method=t.method;this._maxInflateSize=Math.max(Math.abs(v*m),10);this._option=t.option;this._offsetFlattenError=d.pixelTolerance*m}next(){for(var f;f=this._inputGeometries.next();){if(0===this._offset)return f.clone();if("esriGeometryEnvelope"===f.geometryType){if(this._method===b.GeometricEffectOffsetMethod.Rounded&&
0<this._offset){var t=h.collectPath(f);if(t=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError))return f=p.GeometryCursor.createEmptyOptimizedCIM(f.geometryType),f.pushPath(t),f;break}t=f.asJSON();if(k.isExtent(t)&&0<Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset)return p.GeometryCursor.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}t=this._geometryEngine;if(null!=t&&(f=this._tileKey?n.clipCursorToTileExtent(f,
this._maxInflateSize):f.clone()))return(f=t.offset(a.WebMercator,f.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?p.GeometryCursor.fromJSONCIM(f):null}return null}}e.EffectOffset=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(e){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(h,k,n,d,b){return new p(h,k,n)}}g.instance=null;class p{constructor(h,
k,n){this._inputGeometries=h;this._reverse=void 0!==k.reverse?k.reverse:!0}next(){for(var h=this._inputGeometries.next();h;){if(!this._reverse)return h;if("esriGeometryPolyline"===h.geometryType){for(h=h.clone();h.nextPath();)for(let k=0;k<h.pathSize/2;k++){h.seekInPath(k);const n=h.x,d=h.y;h.seekInPath(h.pathSize-k-1);const b=h.x,a=h.y;h.x=n;h.y=d;h.seekInPath(k);h.x=b;h.y=a}h.reset();return h}h=this._inputGeometries.next()}return null}}e.EffectReverse=g;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(k,n,d,b,a){return new h(k,n,d)}}p.instance=null;class h{constructor(k,n,d){this._inputGeometries=k;this._rotateAngle=void 0!==n.angle?n.angle*Math.PI/180:0}next(){let k=this._inputGeometries.next();for(;k;){if(0===this._rotateAngle||"esriGeometryPoint"===k.geometryType)return k;
if(0<k.totalSize){var n=g.getCursorBoundsXY(k);const d=(n[2]+n[0])/2;n=(n[3]+n[1])/2;k.reset();return this._rotate(k.clone(),d,n)}k=this._inputGeometries.next()}return null}_rotate(k,n,d){const b=Math.cos(this._rotateAngle),a=Math.sin(this._rotateAngle);for(;k.nextPath();)for(;k.nextPoint();){const c=k.x-n,q=k.y-d;k.x=n+c*b-q*a;k.y=d+c*a+q*b}k.reset();return k}}e.EffectRotate=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports",
"../../../geometry/support/boundsUtils"],function(e,g){class p{static local(){null===p.instance&&(p.instance=new p);return p.instance}execute(k,n,d,b,a){return new h(k,n,d)}}p.instance=null;class h{constructor(k,n,d){this._inputGeometries=k;this._xFactor=void 0!==n.XScaleFactor?n.XScaleFactor:1.15;this._yFactor=void 0!==n.YScaleFactor?n.YScaleFactor:1.15}next(){const k=this._inputGeometries.next();if(k){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===k.geometryType)return k;if(0<k.totalSize){var n=
g.getCursorBoundsXY(k);const d=(n[2]+n[0])/2;n=(n[3]+n[1])/2;k.reset();return this._scaleCursor(k.clone(),d,n)}}return null}_scaleCursor(k,n,d){for(;k.nextPath();)for(;k.nextPoint();)k.x=n+(k.x-n)*this._xFactor,k.y=d+(k.y-d)*this._yFactor;k.reset();return k}}e.EffectScale=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(e,g,p,h){class k{static local(){null===
k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n{constructor(d,b,a){this._inputGeometries=d;this._height=(void 0!==b.amplitude?b.amplitude:2)*a;this._period=(void 0!==b.period?b.period:3)*a;this._style=b.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));this._pattern=new h.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=
new h.GeometryWalker;this._walker.updateTolerance(a)}next(){for(var d=this._inputGeometries.next();d;){if(0===this._height||0===this._period||(d=this._processGeom(d)))return d;d=this._inputGeometries.next()}return null}_processGeom(d){const b=g.GeometryCursor.createEmptyOptimizedCIM(d.geometryType);for(;d.nextPath();){b.startPath();const a=d.pathLength();if(this._walker.init(d,this._pattern))switch(this._style){default:this._constructCurve(b,a,!1);break;case p.GeometricEffectWaveform.Square:this._constructSquare(b,
a);break;case p.GeometricEffectWaveform.Triangle:this._constructTriangle(b,a);break;case p.GeometricEffectWaveform.Random:this._constructCurve(b,a,!0)}else for(;d.nextPoint();)b.pushXY(d.x,d.y)}return b}_constructCurve(d,b,a){var c=Math.round(b/this._period);0===c&&(c=1);const q=this._period/16,f=1/(16*c+1);b=2*Math.PI*b/(b/c);c=2*Math.PI*Math.random();const t=2*Math.PI*Math.random(),m=2*Math.PI*Math.random(),l=.75-Math.random()/2,u=.75-Math.random()/2,v=new h.Pos;this._walker.curPointAndAngle(v);
d.pushPoint(v.pt);let r=0;for(;;)if(this._walker.nextPointAndAngle(q,v)){const y=r;r+=f;let x;if(a){const w=this._height/2*(1+.3*Math.sin(l*b*y+c));x=w*Math.sin(b*y+t);x+=w*Math.sin(u*b*y+m);x/=2}else x=.5*this._height*Math.sin(.5*b*y);d.pushXY(v.pt[0]-x*v.sa,v.pt[1]+x*v.ca)}else{d.pushPoint(this._walker.getPathEnd());break}}_constructSquare(d,b){Math.round(b/this._period);for(b=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const c=new h.Pos;this._walker.curPointAndAngle(c);const q=new h.Pos;
if(this._walker.nextPointAndAngle(this._period,q)){const f=new h.Pos;this._walker.nextPointAndAngle(this._period,f)&&(b?(d.pushPoint(c.pt),b=!1):d.pushPoint(c.pt),d.pushXY(c.pt[0]-this._height/2*c.sa,c.pt[1]+this._height/2*c.ca),d.pushXY(q.pt[0]-this._height/2*q.sa,q.pt[1]+this._height/2*q.ca),d.pushXY(q.pt[0]+this._height/2*q.sa,q.pt[1]-this._height/2*q.ca),d.pushXY(f.pt[0]+this._height/2*f.sa,f.pt[1]-this._height/2*f.ca),a=!0)}}if(!a){d.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(d,
b){Math.round(b/this._period);for(b=!0;;){let a=!1;if(this._walker.curPositionIsValid()){const c=new h.Pos;this._walker.curPointAndAngle(c);const q=new h.Pos;if(this._walker.nextPointAndAngle(this._period/2,q)){const f=new h.Pos;this._walker.nextPointAndAngle(this._period,f)&&(this._walker.nextPosition(this._period/2)&&(b?(d.pushPoint(c.pt),b=!1):d.pushPoint(c.pt),d.pushXY(q.pt[0]-this._height/2*q.sa,q.pt[1]+this._height/2*q.ca),d.pushXY(f.pt[0]+this._height/2*f.sa,f.pt[1]-this._height/2*f.ca)),a=
!0)}}if(!a){d.pushPoint(this._walker.getPathEnd());break}}}}e.EffectWave=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends g.PathTransformationCursor{constructor(d,b,a){super(d);this._geometryWalker=
new h.GeometryWalker;this._geometryWalker.updateTolerance(a);this._angleToLine=b.angleToLine??!0;this._offset=(b.offset?b.offset:0)*a;this._originalEndings=b.endings;this._offsetAtEnd=(b.customEndingOffset?b.customEndingOffset:0)*a;this._position=-(b.offsetAlongLine?b.offsetAlongLine:0)*a;this._pattern=new h.DashPattern;this._pattern.init(b.placementTemplate,!1);this._pattern.scale(a);this._endings=this._originalEndings}processPath(d){if(this._pattern.isEmpty())return null;if(this.iteratePath)var b=
this._pattern.nextValue();else{this._endings=this._originalEndings===p.PlacementEndings.WithFullGap&&this.isClosed?p.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let a=!0;switch(this._endings){case p.PlacementEndings.NoConstraint:b=-this._position;b=this._adjustPosition(b);a=!1;break;default:b=-this._pattern.lastValue()/2;break;case p.PlacementEndings.WithFullGap:b=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();break;case p.PlacementEndings.WithMarkers:b=
0;break;case p.PlacementEndings.Custom:b=-this._position,b=this._adjustPosition(b),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(d,this._pattern,a))return null;this._pattern.reset();for(d=0;b>d;)b-=d,d=this._pattern.nextValue();b=d-b;this.iteratePath=!0}d=new h.Pos;if(!this._geometryWalker.nextPointAndAngle(b,d)||this._endings===p.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===p.PlacementEndings.WithMarkers&&
this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(d.pt[0]-this._offset*d.sa,d.pt[1]+this._offset*d.ca);this._angleToLine&&this.internalPlacement.setRotateCS(d.ca,d.sa);return this.internalPlacement}_adjustPosition(d){d/=this._pattern.length();d-=Math.floor(d);return d*this._pattern.length()}}e.PlacementAlongLineSameSize=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends g.PathTransformationCursor{constructor(d,b,a){super(d,!1,!0);this._curveHelper=new p.CurveHelper;this._angleToLine=void 0!==b.angleToLine?b.angleToLine:!0;this._offset=void 0!==b.offset?b.offset*a:0;this._type=b.extremityPlacement;this._position=void 0!==b.offsetAlongLine?b.offsetAlongLine*
a:0;this._beginProcessed=!1}processPath(d){let b;switch(this._type){default:this._beginProcessed?(b=this._atExtremities(d,this._position,!1),this.iteratePath=this._beginProcessed=!1):(b=this._atExtremities(d,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case h.ExtremityPlacement.JustBegin:b=this._atExtremities(d,this._position,!0);break;case h.ExtremityPlacement.JustEnd:b=this._atExtremities(d,this._position,!1);case h.ExtremityPlacement.None:}return b}_atExtremities(d,b,a){a||
d.seekPathEnd();if(a?d.nextPoint():d.prevPoint()){let c=0,[q,f]=[0,0],[t,m]=[d.x,d.y];for(;a?d.nextPoint():d.prevPoint();){q=t;f=m;t=d.x;m=d.y;const l=this._curveHelper.getLength(q,f,t,m);if(c+l>b){d=(b-c)/l;const [u,v]=this._curveHelper.getAngleCS(q,f,t,m,d);d=this._curveHelper.getCoord2D(q,f,t,m,d);this.internalPlacement.setTranslate(d[0]-this._offset*v,d[1]+this._offset*u);this._angleToLine&&this.internalPlacement.setRotateCS(-u,-v);return this.internalPlacement}c+=l}}return null}}e.PlacementAtExtremities=
k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,g,p){class h{static local(){null===h.instance&&(h.instance=new h);return h.instance}execute(n,d,b,a,c){return new k(n,d,b)}}h.instance=null;class k extends g.PathTransformationCursor{constructor(n,d,b){super(n);this._walker=new p.GeometryWalker;this._walker.updateTolerance(b);this._angleToLine=void 0!==
d.angleToLine?d.angleToLine:!0;this._offset=void 0!==d.offset?d.offset*b:0;this._beginGap=void 0!==d.beginPosition?d.beginPosition*b:0;this._endGap=void 0!==d.endPosition?d.endPosition*b:0;this._flipFirst=void 0!==d.flipFirst?d.flipFirst:!0;this._pattern=new p.DashPattern;this._pattern.init(d.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(n){if(this._pattern.isEmpty())return null;if(this.iteratePath){n=this._pattern.nextValue()*
this._subPathLen;var d=this._beginGap+n;n=d-this._prevPos;this._prevPos=d}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=n.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(n,this._pattern,!1))return null;this._pattern.reset();n=this._pattern.nextValue()*this._subPathLen;d=this._beginGap+n;n=d-this._prevPos;this._prevPos=d;this.iteratePath=!0}d=new p.Pos;if(!this._walker.nextPointAndAngle(n,
d,p.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(d.pt[0]-this._offset*d.sa,d.pt[1]+this._offset*d.ca);n=this._isFirst&&this._flipFirst;let b;this._angleToLine?(b=d.ca,d=d.sa):(b=1,d=0);n&&(b=-b,d=-d);this.internalPlacement.setRotateCS(b,d);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}e.PlacementAtRatioPositions=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports",
"../../../core/RandomLCG","../CIMPlacements","../enums"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a,c,q)}}k.instance=null;class n{constructor(d,b,a,c,q){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(b.stepX??16)*a;this._stepY=Math.abs(b.stepY??16)*a;this._stepX=Math.round(128*
this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=b.gridType??h.PlacementGridType.Fixed;if(this._gridType===h.PlacementGridType.Random)this._randomLCG=new g(1*(b.seed??13)),this._randomness=(b.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=b.gridAngle??0;this._shiftOddRows=b.shiftOddRows??!1;this._offsetX=
(b.offsetX??0)*a;this._offsetY=(b.offsetY??0)*a;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=
this._graphicOriginX=0;if(null!=c){const [f,t,m,l]=c.split("/");b=parseFloat(f);a=parseFloat(t);c=parseFloat(m);this._graphicOriginX=512*-(parseFloat(l)*2**b+c);this._graphicOriginY=512*a;this._testInsidePolygon=!0}this._internalPlacement=new p.Placement;this._calculateMinMax(d);this._geometryCursor=d}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!n._randValues){n._randValues=[];for(let d=0;24>d;d++)for(let b=0;24>b;b++)n._randValues.push(this._randomLCG.getFloat()),
n._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(d){this._yMax=this._yMin=this._xMax=this._xMin=0;let b,a,c,q,f,t,m,l;b=a=m=f=Number.MAX_VALUE;c=q=l=t=-Number.MAX_VALUE;var u=1!==this._cosAngle;for(d.reset();d.nextPath();)for(;d.nextPoint();){var v=d.x;var r=d.y;var y=v-this._graphicOriginX-this._offsetX;var x=r-this._graphicOriginY-this._offsetY;if(u){var w=this._cosAngle*y-this._sinAngle*x;y=this._sinAngle*y+this._cosAngle*x}else w=y,y=x;b=Math.min(b,w);c=Math.max(c,w);a=Math.min(a,
y);q=Math.max(q,y);f=Math.min(f,r);t=Math.max(t,r);m=Math.min(m,v);l=Math.max(l,v)}f=f!==Number.MAX_VALUE?f:-512-this._stepY;t=t!==-Number.MAX_VALUE?t:this._stepY;m=m!==Number.MAX_VALUE?m:-this._stepX;l=l!==-Number.MAX_VALUE?l:512+this._stepX;this._polygonMin=(this._verticalSubdivision=t-f>=l-m)?f:m;if(this._testInsidePolygon){w=0-this._graphicOriginX-this._offsetX-this._stepX;r=512-this._graphicOriginX-this._offsetX+this._stepX;v=-512-this._graphicOriginY-this._offsetY-this._stepY;y=0-this._graphicOriginY-
this._offsetY+this._stepY;if(u){u=[[w,v],[w,y],[r,v],[r,y]];w=v=Number.MAX_VALUE;r=y=-Number.MAX_VALUE;for(const A of u)u=this._cosAngle*A[0]-this._sinAngle*A[1],x=this._sinAngle*A[0]+this._cosAngle*A[1],w=Math.min(w,u),r=Math.max(r,u),v=Math.min(v,x),y=Math.max(y,x)}b=b!==Number.MAX_VALUE?Math.max(b,w):w;a=a!==Number.MAX_VALUE?Math.max(a,v):v;c=c!==-Number.MAX_VALUE?Math.min(c,r):r;q=q!==-Number.MAX_VALUE?Math.min(q,y):y}this._xMin=Math.round(b/this._stepX);this._xMax=Math.round(c/this._stepX);this._yMin=
Math.round(a/this._stepY);this._yMax=Math.round(q/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(d,m,l,f,t)}_buildAccelerationMap(d,b,a,c,q){d.reset();const f=new Map,t=this._verticalSubdivision;a=t?q-c:a-b;q=Math.ceil(a/10);if(!(1>=q)){a=Math.floor(a/q);q++;this._delta=a;var m,l;if(t){q=-512-2*this._stepY;var u=2*this._stepY;var v=c}else q=-2*this._stepX,u=512+2*this._stepX,v=b;for(;d.nextPath();)if(!(2>d.pathSize)&&d.nextPoint()){var r=d.x;for(m=
d.y;d.nextPoint();r=b,m=c){b=d.x;c=d.y;if(t){if(m===c||m<q&&c<q||m>u&&c>u)continue;var y=Math.min(m,c);var x=Math.max(m,c)}else{if(r===b||r<q&&b<q||r>u&&b>u)continue;y=Math.min(r,b);x=Math.max(r,b)}for(;y<x;){var w=l=Math.floor((y-v)/a),A=r,z=m,C=b,D=c,F=f;let G=F.get(w);G||(G=[],F.set(w,G));G.push([[A,z],[C,D]]);y+=a}y=Math.floor((x-v)/a);y>l&&(x=b,w=c,A=f,z=A.get(y),z||(z=[],A.set(y,z)),z.push([[r,m],[x,w]]))}}this._accelerationMap=f}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;
if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var d=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(d+=.5*this._stepX);const b=this._currentY*this._stepY+this._offsetY;this._currentX++;let a;if(this._gridType===h.PlacementGridType.Random){const c=(this._currentX%24+24)%24,q=(this._currentY%24+24)%24;a=this._graphicOriginX+d+this._stepX*this._randomness*(.5-n._randValues[24*q+c])*2/3;d=this._graphicOriginY+
b+this._stepY*this._randomness*(.5-n._randValues[24*q+c+1])*2/3}else a=this._graphicOriginX+this._cosAngle*d+this._sinAngle*b,d=this._graphicOriginY-this._sinAngle*d+this._cosAngle*b;if(!this._testInsidePolygon||this._isInsidePolygon(a,d,this._geometryCursor))return this._internalPlacement.setTranslate(a,d),this._internalPlacement}}_isInsidePolygon(d,b,a){if(null==this._accelerationMap){var c=0,q;let m;d+=1E-6;b+=1E-6;for(a.reset();a.nextPath();)if(a.nextPoint()){var f=a.x;for(q=a.y;a.nextPoint();f=
t,q=m){var t=a.x;m=a.y;q>b!==m>b&&(0<(t-f)*(b-q)-(m-q)*(d-f)?c++:c--)}}return 0!==c}d+=1E-6;b+=1E-6;a=this._verticalSubdivision;q=this._accelerationMap.get(Math.floor(((a?b:d)-this._polygonMin)/this._delta));if(!q)return!1;f=0;for(c of q){q=c[0];t=c[1];if(a){if(q[1]>b===t[1]>b)continue;q=(t[0]-q[0])*(b-q[1])-(t[1]-q[1])*(d-q[0])}else{if(q[0]>d===t[0]>d)continue;q=(t[1]-q[1])*(d-q[0])-(t[0]-q[0])*(b-q[1])}0<q?f++:f--}return 0!==f}}e.PlacementInsidePolygon=k;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(e,g,p,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends g.PathTransformationCursor{constructor(d,b,a){super(d);this._curveHelper=new p.CurveHelper;this._angleToLine=void 0!==b.angleToLine?b.angleToLine:!0;this._offset=void 0!==b.offset?b.offset*a:0;
this._relativeTo=b.relativeTo;this._position=void 0!==b.startPointOffset?b.startPointOffset*a:0;this._epsilon=.001*a}processPath(d){var b=this._position;if(this._relativeTo===h.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(d.nextPoint()){let [a,c]=[d.x,d.y],[q,f]=[0,0];for(;d.nextPoint();){q=d.x;f=d.y;b=this._curveHelper.getLength(a,c,q,f);if(b<this._epsilon){a=q;c=f;continue}d=.5+this._position/b;const [t,m]=this._curveHelper.getAngleCS(a,c,q,f,d);d=this._curveHelper.getCoord2D(a,
c,q,f,d);this.internalPlacement.setTranslate(d[0]-this._offset*m,d[1]+this._offset*t);this._angleToLine&&this.internalPlacement.setRotateCS(t,m);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(d,b,this._relativeTo===h.PlacementOnLineRelativeTo.LineEnd)}onLine(d,b,a){let c=!1;switch(this._relativeTo){default:d.seekPathStart();b=d.pathLength()/2+b;break;case h.PlacementOnLineRelativeTo.LineBeginning:break;case h.PlacementOnLineRelativeTo.LineEnd:c=!0}a?d.seekPathEnd():
d.seekPathStart();let q=0;if(a?d.prevPoint():d.nextPoint()){let [f,t]=[d.x,d.y],[m,l]=[0,0];for(;a?d.prevPoint():d.nextPoint();){m=d.x;l=d.y;const u=this._curveHelper.getLength(f,t,m,l);if(q+u>b){d=(b-q)/u;const [v,r]=this._curveHelper.getAngleCS(f,t,m,l,d);d=this._curveHelper.getCoord2D(f,t,m,l,d);a=c?-this._offset:this._offset;this.internalPlacement.setTranslate(d[0]-a*r,d[1]+a*v);this._angleToLine&&(c?this.internalPlacement.setRotateCS(-v,-r):this.internalPlacement.setRotateCS(v,r));return this.internalPlacement}f=
m;t=l;q+=u}}return null}}e.PlacementOnLine=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,g,p){function h(d,b){const a=Math.PI;for(;Math.abs(b-d)>a+2E-15;)b=b-d>a?b-2*a:b+2*a;return(d+b)/2}class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(d,b,a,c,q){return new n(d,b,a)}}k.instance=null;class n extends g.PathTransformationCursor{constructor(d,
b,a){super(d);this._curveHelper=new p.CurveHelper;this._angleToLine=void 0!==b.angleToLine?b.angleToLine:!0;this._offset=void 0!==b.offset?b.offset*a:0;this._endPoints=void 0!==b.placeOnEndPoints?b.placeOnEndPoints:!0;this._controlPoints=void 0!==b.placeOnControlPoints?b.placeOnControlPoints:!0;this._regularVertices=void 0!==b.placeOnRegularVertices?b.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(d){this.iteratePath||(this._preparePath(d),this.iteratePath=!0);if(this._tagIterator>=
this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;d=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(d[2]);let b=d[0],a=d[1];if(0!==this._offset){const c=Math.cos(d[2]);b-=this._offset*Math.sin(d[2]);a+=this._offset*c}this.internalPlacement.setTranslate(b,a);this._tagIterator++;return this.internalPlacement}_preparePath(d){this._tagIterator=this._tags.length=0;d.seekPathStart();const b=d.isClosed();let a=0,c=!1,q=0,f=0;d.seekPathStart();
if(d.nextPoint()){let t=d.x,m=d.y,l=d.getControlPoint(),u=!0,v=d.nextPoint();for(;v;){const r=d.x,y=d.y,x=d.getControlPoint();if(this._angleToLine||0!==this._offset)q=this._curveHelper.getAngle(t,m,r,y,0);u?(u=!1,b?(a=q,c=l):(this._endPoints||this._controlPoints&&l)&&this._tags.push([t,m,q])):l?this._controlPoints&&this._tags.push([t,m,h(f,q)]):this._regularVertices&&this._tags.push([t,m,h(f,q)]);if(this._angleToLine||0!==this._offset)f=this._curveHelper.getAngle(t,m,r,y,1);(v=d.nextPoint())||(b?
x||c?this._controlPoints&&this._tags.push([r,y,h(f,a)]):this._regularVertices&&this._tags.push([r,y,h(f,a)]):(this._endPoints||this._controlPoints&&x)&&this._tags.push([r,y,f]));t=r;m=y;l=x}}this._tagIterator=0}}e.PlacementOnVertices=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(e,g,p,h,k,n){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(a,c,q,f,t){return new b(a,c,q)}}d.instance=null;class b{constructor(a,c,q){this._geometryCursor=a;this._offsetX=void 0!==c.offsetX?c.offsetX*q:0;this._offsetY=void 0!==c.offsetY?c.offsetY*q:0;this._method=void 0!==c.method?c.method:n.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new k.Placement}next(){const a=this._geometryCursor;this._geometryCursor=null;return a?this._polygonCenter(a):
null}_polygonCenter(a){let c=!1;switch(this._method){case n.PlacementPolygonCenterMethod.CenterOfMass:if(a=p.weightedAreaCentroid(a))this._internalPlacement.setTranslate(a[0]+this._offsetX,a[1]+this._offsetY),c=!0;break;case n.PlacementPolygonCenterMethod.BoundingBoxCenter:if(a=g.getCursorBoundsXY(a))this._internalPlacement.setTranslate((a[2]+a[0])/2+this._offsetX,(a[3]+a[1])/2+this._offsetY),c=!0;break;default:a=h.getLabelPoint(a),null!==a&&(this._internalPlacement.setTranslate(a[0]+this._offsetX,
a[1]+this._offsetY),c=!0)}return c?this._internalPlacement:null}}e.PlacementPolygonCenter=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(e,g,p,h,k,n,d){function b(l,u){let v=0,r,y,x,w;for(u.reset();u.nextPath()&&u.nextPoint();)for(r=u.x,y=u.y;u.nextPoint();r=x,y=w)x=u.x,w=u.y,y>l[1]!==w>l[1]&&(0<(x-r)*
(l[1]-y)-(w-y)*(l[0]-r)?v++:v--);return 0!==v}function a(l,u,v){if(v&&b(l,u))return{coord:l,distance:0};v=Infinity;let r=0,y=0;var x=[0,0];let w=[0,0];const A=[0,0];for(u.reset();u.nextPath()&&u.nextPoint();)if(!(2>u.pathSize))for(x[0]=u.x,x[1]=u.y;u.nextPoint();x=w)w=[u.x,u.y],n.projectPointOnLineSeg(A,l,x,w),x=f(l,A),x<v&&(v=x,r=A[0],y=A[1]);return{coord:[r,y],distance:Math.sqrt(v)}}function c(l,u,v,r){v=[u,0];let y=Infinity,x=Infinity,w=!1,A=!1;u=[[u,r[1]-1],[u,r[3]+1]];r=[0,0];const z=[0,0],C=
[0,0],D=[[0,0],[0,0]],F=p.create();for(l.reset();l.nextPath()&&l.nextPoint();)if(!(2>l.pathSize))for(D[0][0]=l.x,D[0][1]=l.y;l.nextPoint();D[0][0]=D[1][0],D[0][1]=D[1][1]){D[1][0]=l.x;D[1][1]=l.y;a:{var G=F;var B=D;if(2>B.length){G=null;break a}G||=p.create();const [H,K]=B[0],[O,R]=B[1];G[0]=Math.min(H,O);G[1]=Math.min(K,R);G[2]=Math.max(H,O);G[3]=Math.max(K,R)}if(null!==G){z[0]=u[0][0];z[1]=u[0][1];C[0]=u[1][0];C[1]=u[1][1];a:{G=F;B=z;var I=C;let H=q(B,G),K=q(I,G);const O=G[0],R=G[1],E=G[2],J=G[3];
if(H&K){G=0;break a}if(!(H|K)){G=4;break a}const Q=(H?1:0)|(K?2:0);do{const N=I[0]-B[0],S=I[1]-B[1];if(N>S)H&3?(H&1?(B[1]+=S*(O-B[0])/N,B[0]=O):(B[1]+=S*(E-B[0])/N,B[0]=E),H=q(B,G)):K&3?(K&1?(I[1]+=S*(O-I[0])/N,I[0]=O):(I[1]+=S*(E-I[0])/N,I[0]=E),K=q(I,G)):H?(H&4?(B[0]+=N*(R-B[1])/S,B[1]=R):(B[0]+=N*(J-B[1])/S,B[1]=J),H=q(B,G)):(K&4?(I[0]+=N*(R-I[1])/S,I[1]=R):(I[0]+=N*(J-I[1])/S,I[1]=J),K=q(I,G));else if(H&12?(H&4?(B[0]+=N*(R-B[1])/S,B[1]=R):(B[0]+=N*(J-B[1])/S,B[1]=J),H=q(B,G)):K&12?(K&4?(I[0]+=
N*(R-I[1])/S,I[1]=R):(I[0]+=N*(J-I[1])/S,I[1]=J),K=q(I,G)):H?(H&1?(B[1]+=S*(O-B[0])/N,B[0]=O):(B[1]+=S*(E-B[0])/N,B[0]=E),H=q(B,G)):(K&1?(I[1]+=S*(O-I[0])/N,I[0]=O):(I[1]+=S*(E-I[0])/N,I[0]=E),K=q(I,G)),H&K){G=0;break a}}while(H|K);G=Q}0!==G&&d.segmentIntersects(u[0],u[1],D[0],D[1],r)&&(G=r[1],y>x?G<y&&(y=G,w=!0):G<x&&(x=G,A=!0))}}w&&A?v[1]=(y+x)/2:v[0]=v[1]=NaN;return v}function q(l,u){return(l[0]<u[0]?1:0)|(l[0]>u[2]?1:0)<<1|(l[1]<u[1]?1:0)<<2|(l[1]>u[3]?1:0)<<3}function f(l,u){return(l[0]-u[0])*
(l[0]-u[0])+(l[1]-u[1])*(l[1]-u[1])}function t(l,u){if(l<u)return-1;if(l>u)return 1;if(l===u)return 0;l=isNaN(l);u=isNaN(u);return l<u?-1:l>u?1:0}class m{constructor(l,u,v,r){this.x=l;this.y=u;this.cellSize=v;this.distancefromCellCenter=n.distanceFromPointToPolygon(l,u,r);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}e.getLabelPoint=function(l){if(0===l.totalSize)return null;var u=h.getCursorBoundsXY(l);if(!u)return null;var v=8.8818E-14*(Math.abs(u[0])+Math.abs(u[2])+
Math.abs(u[1])+Math.abs(u[3])+1),r=0,y=0;l.reset();for(var x=0;l.nextPath();x++){var w=l.getCurrentRingArea();w>y&&(y=w,r=x)}l.seekPath(r);if(0===l.pathSize)return null;l.seekPathStart();w=h.getCursorPathBounds(l);if(Math.abs(y)<=2*v*v)return[(w[0]+w[2])/2,(w[1]+w[3])/2];l.seekPathStart();var A=k.ringCentroidCursorXY(l,p.create());if(null===A)return null;if(4>l.totalPoints)return A;y=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];r=[NaN,NaN,NaN,NaN];x=[NaN,NaN,NaN,NaN];var z=!1,C=a(A,l,!0);0===C.distance&&
(z=!0,y[0][0]=A[0],y[0][1]=A[1],C=a(A,l,!1));r[0]=C.distance;x[0]=0;var D=[NaN,NaN];let F=!1,G=.25,B=-1;C=NaN;do{C=NaN;var I=w[0];y[1]=c(l,I+(w[2]-I)*G,v,u);isNaN(y[1][0])||isNaN(y[1][1])||(C=a(y[1],l,!1),C=C.distance);if(!isNaN(C)&&C>v&&b(y[1],l))F=!0,r[1]=C,x[1]=f(y[1],A);else if(!isNaN(C)&&C>B&&(B=C,D[0]=y[1][0],D[1]=y[1][1]),G-=.01,.1>G)if(0<=B)F=!0,r[1]=B,y[1][0]=D[0],y[1][1]=D[1],x[1]=f(y[1],A);else break}while(!F);F=!1;G=.5;B=-1;I=.01;let H=1;do{C=NaN;var K=w[0];y[2]=c(l,K+(w[2]-K)*G,v,u);
isNaN(y[2][0])||isNaN(y[2][1])||(C=a(y[2],l,!1),C=C.distance);if(!isNaN(C)&&C>v&&b(y[2],l))F=!0,r[2]=C,x[2]=f(y[2],A);else if(!isNaN(C)&&C>B)B=C,D[0]=y[2][0],D[1]=y[2][1];else if(C>B&&(B=C,D[0]=y[2][0],D[1]=y[2][1]),G=.5+I*H,I+=.01,H*=-1,.3>G||.7<G)if(0<=B)F=!0,r[2]=B,y[2][0]=D[0],y[2][1]=D[1],x[2]=f(y[2],A);else break}while(!F);F=!1;G=.75;B=-1;do if(C=NaN,I=w[0],y[3]=c(l,I+(w[2]-I)*G,v,u),isNaN(y[3][0])||isNaN(y[3][1])||(C=a(y[3],l,!1),C=C.distance),!isNaN(C)&&C>v&&b(y[3],l))F=!0,r[3]=C,x[3]=f(y[3],
A);else if(C>B&&(B=C,D[0]=y[3][0],D[1]=y[3][1]),G+=.01,.9<G)if(0<=B)F=!0,r[3]=B,y[3][0]=D[0],y[3][1]=D[1],x[3]=f(y[3],A);else break;while(!F);l=[0,1,2,3];u=z?0:1;for(w=u;4>w;w++)for(z=u;3>z;z++)A=x[z],D=x[z+1],0<t(A,D)&&(v=l[z],l[z]=l[z+1],l[z+1]=v,x[z]=D,x[z+1]=A);x=u;for(w=v=0;4>u;u++){switch(u){case 0:w=2*r[l[u]];break;case 1:w=1.66666666*r[l[u]];break;case 2:w=1.33333333*r[l[u]];break;case 3:w=r[l[u]]}w>v&&(v=w,x=l[u])}return y[x]};e.getPolylabelPoint=function(l){if(!l.nextPath()||!l.pathSize)return null;
var u=h.getCursorPathBounds(l),v=u[2]-u[0],r=u[3]-u[1];if(0===v||0===r)return[u[0]+v/2,u[1]+r/2];const y=Math.max(Math.min(v,r)/100,1),x=new g((z,C)=>C.maxDistanceToPolygon-z.maxDistanceToPolygon);r=Math.min(v,r);v=r/2;let w=0,A=0;for(w=u[0];w<u[2];w+=r)for(A=u[1];A<u[3];A+=r)x.enqueue(new m(w+v,A+v,v,l));l.reset();l.nextPath();u=k.ringsCentroidCursor(l);if(null===u)return null;for(u=new m(u[0],u[1],0,l);0<x.size;)r=x.dequeue(),r.distancefromCellCenter>u.distancefromCellCenter&&(u=r),r.maxDistanceToPolygon-
u.distancefromCellCenter<=y||(v=r.cellSize/2,x.enqueue(new m(r.x-v,r.y-v,v,l)),x.enqueue(new m(r.x+v,r.y-v,v,l)),x.enqueue(new m(r.x-v,r.y+v,v,l)),x.enqueue(new m(r.x+v,r.y+v,v,l)));return[u.x,u.y]};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class e{constructor(p=g){this._data=[];this._compare=p}get size(){return this._data.length}enqueue(p){if(null!=p){var {_data:h,_compare:k}=this;h.push(p);p=h.length-1>>>0;for(var n=h[p];0<
p;){const d=p-1>>1,b=h[d];if(0>=k(b,n))h[d]=n,h[p]=b,p=d;else break}}}dequeue(){const {_data:p,_compare:h}=this,k=p[0];var n=p.pop();if(0===p.length)return k;p[0]=n;n=0;const d=p.length,b=p[0];let a;let c=null;for(;;){var q=2*n+1;const f=2*n+2;c=null;q<d&&(a=p[q],0<h(a,b)&&(c=q));f<d&&(q=p[f],null===c&&0>=h(q,b)||null!==c&&0>=h(q,a))&&(c=f);if(null===c)break;p[n]=p[c];p[c]=b;n=c}return k}}const g=(p,h)=>p<h?-1:p>h?1:0;return e})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(e){e.getFirstFrame=
function(g){const p=g.getFrame(0);if(p instanceof HTMLImageElement||p instanceof HTMLCanvasElement)return p;const h=document.createElement("canvas");h.width=g.width;h.height=g.height;g=h.getContext("2d");p instanceof ImageData?g.putImageData(p,0,0):g.drawImage(p,0,0);return h};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class e{constructor(g=0,p=0,h=0,k=0){this.x=g;this.y=p;this.width=h;this.height=k}static fromExtent(g){return new e(g.xmin,
-g.ymax,g.xmax-g.xmin,g.ymax-g.ymin)}get isEmpty(){return 0>=this.width||0>=this.height}union(g){this.x=Math.min(this.x,g.x);this.y=Math.min(this.y,g.y);this.width=Math.max(this.width,g.width);this.height=Math.max(this.height,g.height)}}return e})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(e,g){function p(k){return`rgba(${k.slice(0,3).toString()},${k[3]})`}class h{constructor(k){k&&(this._textRasterizationCanvas=k)}rasterizeText(k,
n){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const d=this._textRasterizationCanvas;var b=d.getContext("2d",{willReadFrequently:!0});this._setFontProperties(b,n);this._parameters=n;this._textLines=k.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:a,weight:c}=n.font;this._lineThroughWidthOffset=a&&"line-through"===a?.1*this._lineHeight:0;var q=(k=null!=n.backgroundColor||null!=n.borderLine)?g.backgroundPadding:0,f=this._computeTextWidth(b,
n)+2*q,t=this._lineHeight*this._textLines.length+2*q;d.width=f+2*this._lineThroughWidthOffset;d.height=t;if(0===d.width||0===d.height)return d.width=d.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:d};this._renderedLineHeight=Math.round(this._lineHeight*n.pixelRatio);this._renderedHaloSize=e.pt2px(n.halo.size)*n.pixelRatio;this._renderedWidth=f*n.pixelRatio;this._renderedHeight=t*n.pixelRatio;this._lineThroughWidthOffset*=n.pixelRatio;f=n.halo&&n.halo.color?
n.halo.color:[0,0,0,0];this._fillStyle=p(n.color??[0,0,0,0]);this._haloStyle=`rgb(${f.slice(0,3).toString()})`;f=this._renderedLineHeight;var m=this._renderedHaloSize;b.save();b.clearRect(0,0,d.width,d.height);this._setFontProperties(b,n);t=q*n.pixelRatio;q=b.textAlign;var l=this._renderedWidth-2*t;q=("center"===q?.5*l:"right"===q?l:0)+m+t;t=m+t;m=0<m;l=this._lineThroughWidthOffset;let u=0;if(k){b.save();k=n.backgroundColor??[0,0,0,0];const r=n.borderLine?.color??[0,0,0,0],y=2*e.pt2px(n.borderLine?.size??
0);b.fillStyle=p(k);b.strokeStyle=p(r);b.lineWidth=y;b.fillRect(0,0,d.width,d.height);b.strokeRect(0,0,d.width,d.height);b.restore()}m&&this._renderHalo(b,q,t,l,u,n);u+=t;l+=q;for(var v of this._textLines)m&&(b.globalCompositeOperation="destination-out",b.fillStyle="rgb(0, 0, 0)",b.fillText(v,l,u),b.globalCompositeOperation="source-over"),b.fillStyle=this._fillStyle,b.fillText(v,l,u),a&&"none"!==a&&this._renderDecoration(b,l,u,a,c),u+=f;b.restore();v=this._renderedWidth+2*this._lineThroughWidthOffset;
k=this._renderedHeight;b=b.getImageData(0,0,v,k);b=new Uint8Array(b.data);if(n.premultiplyColors)for(q=0;q<b.length;q+=4)f=b[q+3]/255,b[q]*=f,b[q+1]*=f,b[q+2]*=f;switch(n.horizontalAlignment){case "left":f=-.5;break;case "right":f=.5;break;default:f=0}switch(n.verticalAlignment){case "bottom":n=-.5;break;case "top":n=.5;break;case "baseline":n=-1/6;break;default:n=0}return{size:[v,k],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1,anchorX:f,anchorY:n,canvas:d}}_renderHalo(k,n,d,b,a,c){const q=
this._renderedWidth,f=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=q;this._haloRasterizationCanvas.height=f;const t=this._haloRasterizationCanvas,m=t.getContext("2d");m.clearRect(0,0,q,f);this._setFontProperties(m,c);const {decoration:l,weight:u}=c.font;m.fillStyle=this._haloStyle;m.strokeStyle=this._haloStyle;m.lineJoin="round";this._renderHaloNative(m,n,d,l,u);k.globalAlpha=this._parameters.halo.color[3];
k.drawImage(t,0,0,q,f,b,a,q,f);k.globalAlpha=1}_renderHaloNative(k,n,d,b,a){const c=this._renderedLineHeight,q=this._renderedHaloSize;for(const f of this._textLines){const t=2*q;for(let m=0;5>m;m++){const l=(.6+.1*m)*t;k.lineWidth=l;k.strokeText(f,n,d);b&&"none"!==b&&this._renderDecoration(k,n,d,b,a,l)}d+=c}}_setFontProperties(k,n){var d=n.font;d=`${d.style} ${d.weight} ${e.pt2px(Math.max(n.size,.5)*n.pixelRatio).toFixed(1)}px ${d.family}, sans-serif`;k.font=d;k.textBaseline="top";switch(n.horizontalAlignment){case "left":n=
"left";break;case "right":n="right";break;case "center":n="center";break;default:n="left"}k.textAlign=n}computeTextSize(k,n){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const d=this._textRasterizationCanvas;var b=d.getContext("2d");this._setFontProperties(b,n);this._parameters=n;this._textLines=k.split(/\r?\n/);this._lineHeight=this._computeLineHeight();k=this._computeTextWidth(b,n);b=this._lineHeight*this._textLines.length;d.width=k;d.height=b;
return[k*n.pixelRatio,b*n.pixelRatio]}_computeTextWidth(k,n){let d=0;for(const b of this._textLines)d=Math.max(d,k.measureText(b).width);n=n.font;if("italic"===n.style||"oblique"===n.style||"string"===typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"===typeof n.weight&&600<n.weight)d+=.3*k.measureText("w").width;d+=2*e.pt2px(this._parameters.halo.size);return Math.round(d)}_computeLineHeight(){let k=1.275*this._parameters.size;const n=this._parameters.font.decoration;n&&"underline"===
n&&(k*=1.3);return Math.round(k+2*e.pt2px(this._parameters.halo.size))}_renderDecoration(k,n,d,b,a,c){const q=.9*this._lineHeight;switch(k.textAlign){case "center":n-=this._renderedWidth/2;break;case "right":n-=this._renderedWidth}const f=k.textBaseline;if("underline"===b)switch(f){case "top":d+=q;break;case "middle":d+=q/2}else if("line-through"===b)switch(f){case "top":d+=q/1.5;break;case "middle":d+=q/3}b=c?1.5*c:Math.ceil(q*("bold"===a?.06:"bolder"===a?.09:.04));k.save();k.beginPath();k.strokeStyle=
k.fillStyle;k.lineWidth=b;k.moveTo(n-this._lineThroughWidthOffset,d);k.lineTo(n+this._renderedWidth+2*this._lineThroughWidthOffset,d);k.stroke();k.restore()}}return h})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(e){e.AttributeDataType=void 0;var g=e.AttributeDataType||(e.AttributeDataType={});g[g.FilterFlags=0]="FilterFlags";g[g.Animation=1]="Animation";g[g.GPGPU=2]="GPGPU";g[g.VV=3]="VV";g[g.DD0=4]="DD0";g[g.DD1=5]="DD1";g[g.DD2=6]="DD2";e.MAX_TILE_RESHUFFLES_PER_FRAME=
1;e.RESHUFFLING_EXEMPT_DRAW_CALLS=10;e.RESHUFFLING_EXEMPT_MEMORY_BYTES=1048576;e.RESHUFFLING_TARGET_DRAW_EFFICIENCY=.75;e.RESHUFFLING_TARGET_MEMORY_EFFICIENCY=.75;e.angleFactor256=256/360;e.animationUnit=2;e.attributeStoreInitialSize=256;e.attributeStoreTextureSize=1024;e.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}};e.bitsetFillHasPatternHeightPrecisionFactor=32;e.bitsetFillHasPatternWidthPrecisionFactor=64;e.bitsetFillHasUnresolvedReplacementColor=8;e.bitsetFillRandomPatternOffset=
4;e.bitsetGenericConsiderAlphaOnly=16;e.bitsetGenericLockColor=2;e.bitsetLineScaleDash=4;e.bitsetMarkerAlignmentMap=1;e.bitsetMarkerAlignmentScreen=0;e.bitsetMarkerOutlineAllowColorOverride=4;e.bitsetMarkerScaleSymbolsProportionally=8;e.bitsetTypeFillOutline=1;e.bufferDataMinimumSize=128;e.bufferDataPoolSize=4;e.chartMaxFields=10;e.collisionBoxPadding=16;e.collisionBucketSize=128;e.collisionEarlyRejectBucketSize=16;e.collisionMaxZoomDelta=1;e.collisionPlacementPadding=8;e.collisionTileBoxSize=4;e.compressionFactorForU16=
128;e.dataDrivenUnit0=4;e.dataDrivenUnit1=5;e.dataDrivenUnit2=6;e.debugLabels=!1;e.displayRecordIntPerElement=8;e.dotDensityMaxFields=8;e.effectFlag0=16;e.enableEarlyLabelDiscard=!1;e.extrudeScale=64;e.filterFlag0=8;e.filterFlagsUnit=1;e.glyphSize=24;e.gpgpuUnit=12;e.heuristicGlyphsPerFeature=10;e.heuristicGlyphsPerLine=50;e.highlightReasonsCount=3;e.hittestRadius=1;e.labelPlacementOffsetPadding=4;e.magicLabelLineHeight=29;e.maxGeohashLevel=12;e.maxGpuUploadsPerFrame=2;e.maxRepresentableInt=16777216;
e.maxSizeForU16Compression=511;e.minMaxZoomPrecisionFactor=10;e.nanMagicNumber=1E-30;e.patchPixelBufferAllocSize=500;e.patternFillRasterizationScale=2;e.pictureFillColor=4294967295;e.randomInsidePolygonTextureSize=1024;e.rasterTileSize=256;e.sdfTextureSize=124;e.spritePadding=2;e.textureBindingBitmap=0;e.textureBindingGlyphAtlas=0;e.textureBindingHighlight0=5;e.textureBindingHighlight1=6;e.textureBindingRenderer0=5;e.textureBindingRenderer1=6;e.textureBindingSpriteAtlas=0;e.textureUploadManagerBudget=
4;e.textureUploadManagerChunkSize=128;e.thinLineHalfWidthThreshold=1.05;e.tileSize=512;e.visualVariableUnit=3;e.vtlHighResCutoff=1.15;e.vtlTextureBindingUnitGlyphs=6;e.vtlTextureBindingUnitSprites=5;e.webglMaxInnerStops=6;e.webglMaxStops=8;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),
function(e,g,p,h,k,n,d,b){function a(m,l){m.forEach(u=>h.transformMat2d(u,u,l));return{topLeft:m[0],topRight:m[1],bottomLeft:m[2],bottomRight:m[3]}}const c=Math.PI/180;class q{constructor(m,l,u,v){this._rotationT=p.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const r=u.rect,y=new Float32Array(8);m*=v;l*=v;const x=u.code?r.width*v:u.metrics.width,w=u.code?r.height*v:u.metrics.height;this.width=x;this.height=w;y[0]=m;y[1]=l;y[2]=m+x;y[3]=l;y[4]=m;y[5]=l+w;y[6]=
m+x;y[7]=l+w;this._data=y;this._setTextureCoords(r);this._scale=v;this._mosaic=u;this.x=m;this.y=l;this.maxOffset=Math.max(m+x,l+w)}get mosaic(){return this._mosaic}set angle(m){this._angle=m;g.fromRotation(this._rotationT,-m);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:r,width:y}=this._mosaic.metrics;var m=y*this._scale,l=Math.abs(r)*this._scale,u=new Float32Array(8);u[0]=this.x;u[1]=this.y;u[2]=this.x+m;u[3]=this.y;u[4]=this.x;u[5]=this.y+l;u[6]=this.x+m;u[7]=this.y+l;m=g.multiply(p.create(),this._rotationT,this._transform);p.transformMany(u,u,m);l=m=Infinity;let x=0;var v=0;for(let w=
0;4>w;w++){const A=u[2*w],z=u[2*w+1];m=Math.min(m,A);l=Math.min(l,z);x=Math.max(x,A);v=Math.max(v,z)}u=x-m;v-=l;this._bounds=new b(m+u/2,l+v/2,u,v)}return this._bounds}setTransform(m){this._transform=m;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const m=g.multiply(p.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];
this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=this._data[7];h.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,m);h.transformMat2d(this._offsets.topRight,this._offsets.topRight,m);h.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,m);h.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,m)}_setTextureCoords({x:m,
y:l,width:u,height:v}){this._texcoords={topLeft:[m,l],topRight:[m+u,l],bottomLeft:[m,l+v],bottomRight:[m+u,l+v]}}}class f{constructor(m,l,u){this._rotation=0;this._decorate(m,l,u);this.glyphs=m;this.bounds=this._createBounds(m);this.isMultiline=1<l.length;this._hasRotation=0!==u.angle;this._transform=this._createGlyphTransform(this.bounds,u);if((this._borderLineSizePx=u.borderLineSizePx)||u.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const v of m)v.setTransform(this._transform)}setRotation(m){if(0!==
m||0!==this._rotation){this._rotation=m;var l=this._transform;m=g.fromRotation(p.create(),m);g.multiply(l,m,l);for(const u of this.glyphs)u.setTransform(this._transform)}}_decorate(m,l,u){if(u.decoration&&"none"!==u.decoration&&m.length){var v=u.scale;u="underline"===u.decoration?26:16;var r=m[0].textureBinding;for(const A of l){const z=A.startX*v,C=A.startY*v;l=m;var y=l.push;var x=(A.width+A.glyphWidthEnd)*v;var w=r;x={code:0,page:0,sdf:!0,rect:new d(0,0,11,8),textureBinding:w,metrics:{advance:0,
height:4,width:x,left:0,top:0}};y.call(l,new q(z,C+u*v,x,1))}}}shapeBackground(m){const l=(1.5+(this._borderLineSizePx||0))/2;var u=this._borderLineSizePx?l:0;const {xmin:v,ymin:r,xmax:y,ymax:x,x:w,y:A,width:z,height:C}=this.bounds,D=[v-8,r-8],F=[y+8,r-8],G=[v-8,x+8],B=[y+8,x+8],I=a([[D[0]-l,D[1]-l],[F[0]+l,F[1]-l],[D[0]+u,D[1]+u],[F[0]-u,F[1]+u]],m),H=a([[G[0]+u,G[1]-u],[B[0]-u,B[1]-u],[G[0]-l,G[1]+l],[B[0]+l,B[1]+l]],m),K=a([[D[0]-l,D[1]-l],[D[0]+u,D[1]+u],[G[0]-l,G[1]+l],[G[0]+u,G[1]-u]],m);u=
a([[F[0]-u,F[1]+u],[F[0]+l,F[1]-l],[B[0]-u,B[1]-u],[B[0]+l,B[1]+l]],m);m={main:a([D,F,G,B],m),top:I,bot:H,left:K,right:u};return[new b(w,A,z+2*l,C+2*l),m]}get boundsT(){var m=this.bounds;const l=h.set(k.create(),m.x,m.y);h.transformMat2d(l,l,this._transform);return this._hasRotation?(m=Math.max(m.width,m.height),new b(l[0],l[1],m,m)):new b(l[0],l[1],m.width,m.height)}_createBounds(m){let l=Infinity,u=Infinity,v=0;var r=0;for(const y of m)l=Math.min(l,y.xTopLeft),u=Math.min(u,y.yTopLeft),v=Math.max(v,
y.xBottomRight),r=Math.max(r,y.yBottomRight);m=v-l;r-=u;return new b(l+m/2,u+r/2,m,r)}_createGlyphTransform(m,l){const u=c*l.angle,v=p.create(),r=k.create();g.translate(v,v,h.set(r,l.xOffset,-l.yOffset));l.useCIMAngleBehavior?g.rotate(v,v,u):(g.translate(v,v,h.set(r,m.x,m.y)),g.rotate(v,v,u),g.translate(v,v,h.set(r,-m.x,-m.y)));return v}}class t{constructor(m,l,u,v,r,y){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(l,u));this.end=Math.max(0,Math.max(l,u));this.end<m.length&&
(this.glyphWidthEnd=m[this.end].metrics.width);this.width=v;this.yMin=r;this.yMax=y}}e.ShapedGlyph=q;e.ShapingInfo=f;e.shapeGlyphs=function(m,l){const u=l.scale,v=[],{glyphs:r,isRightToLeft:y}=m;m=[];var x=1/l.scale*l.maxLineWidth;var w=y?r.length-1:0;var A=y?-1:r.length,z=y?-1:1,C=w,D=0,F=0,G=C;let B=G,I=0,H=Infinity,K=0;for(;C!==A;){const {code:R,metrics:E}=r[C];var O=Math.abs(E.top);10!==R&&32!==R&&(H=Math.min(H,O),K=Math.max(K,O+E.height));10===R?(C!==w&&(m.push(new t(r,G,C-z,D,H,K)),H=Infinity,
K=0),D=0,G=C+z,B=C+z,F=0):32===R?(B=C+z,F=0,I=E.advance,D+=E.advance):(D>x&&(B!==G?(O=B-2*z,D-=I,m.push(new t(r,G,O,D-F,H,K)),H=Infinity,K=0,G=B,D=F):(m.push(new t(r,G,C-z,D,H,K)),H=Infinity,K=0,B=G=C,D=0)),D+=E.advance,F+=E.advance);C+=z}x=new t(r,G,C-z,D,H,K);0<=x.start&&x.end<r.length&&m.push(x);for(x=0;x<m.length;x++);A=m[0].yMin;w=m[m.length-1].yMax+l.lineHeight*(m.length-1)+("underline"===l.decoration?4:0)-A;x=n.getXAnchorDirection(l.horizontalAlignment);z=n.getYAnchorDirection(l.verticalAlignment);
C=z===n.VAlign.Baseline?1:0;w=(1-C)*-A+w/2*(C?0:z-1)+-22*(C?1:0);for(A=0;A<m.length;A++){const {start:R,end:E,width:J}=m[A];z=J/2*(x+1)*-1-3;C=A*l.lineHeight+w-3;m[A].startX=z;m[A].startY=C;for(D=R;D<=E;D++)F=r[D],10!==F.code&&(G=new q(z+F.metrics.left,C-F.metrics.top,F,u),z+=F.metrics.advance,v.push(G))}return new f(v,m,l)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(e,
g){e.HAlign=void 0;(function(p){p[p.Left=-1]="Left";p[p.Center=0]="Center";p[p.Right=1]="Right"})(e.HAlign||(e.HAlign={}));e.VAlign=void 0;(function(p){p[p.Top=1]="Top";p[p.Center=0]="Center";p[p.Bottom=-1]="Bottom";p[p.Baseline=2]="Baseline"})(e.VAlign||(e.VAlign={}));e.getAlignmentFromPlacement=function(p){switch(p){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center",
"bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center","middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right",
"top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];default:return console.debug(`Found invalid placement type ${p}`),["center","middle"]}};e.getJustification=function(p){switch(p){case "left":return e.HAlign.Left;
case "right":return e.HAlign.Right;case "center":return e.HAlign.Center}};e.getXAnchorDirection=function(p){if(!p)return e.HAlign.Center;switch(p){case "Left":case "left":return e.HAlign.Left;case "Right":case "right":return e.HAlign.Right;case "Justify":return g.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),e.HAlign.Center;case "Center":case "center":return e.HAlign.Center}};e.getXDirection=function(p){switch(p){case e.HAlign.Right:case "right":return-1;
case e.HAlign.Center:case "center":return 0;case e.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${p}`),0}};e.getYAnchorDirection=function(p){if(!p)return e.VAlign.Center;switch(p){case "Top":case "top":return e.VAlign.Top;case "Center":case "middle":return e.VAlign.Center;case "Baseline":case "baseline":return e.VAlign.Baseline;case "Bottom":case "bottom":return e.VAlign.Bottom}};e.getYDirection=function(p){switch(p){case e.VAlign.Top:case "top":return 1;
case e.VAlign.Center:case "middle":return 0;case e.VAlign.Bottom:case e.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${p}`),0}};e.isMapAligned=function(p){switch(p){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;default:return!1}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/Rect":function(){define(function(){class e{constructor(g=0,p=0,h=0,k=0){this.x=g;this.y=p;this.width=h;this.height=k}get isEmpty(){return 0>=this.width||0>=this.height}union(g){this.x=Math.min(this.x,g.x);this.y=Math.min(this.y,g.y);this.width=Math.max(this.width,g.width);this.height=Math.max(this.height,g.height)}}return e})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(e){class g{constructor(p,
h,k,n){this.computedY=this.computedX=0;this.center=e.fromValues(p,h);this.centerT=e.create();this.halfWidth=k/2;this.halfHeight=n/2;this.width=k;this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-
this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(p){this.center[0]=p}set y(p){this.center[1]=p}clone(){return new g(this.x,this.y,this.width,this.height)}serialize(p){p.writeF32(this.center[0]);p.writeF32(this.center[1]);p.push(this.width);p.push(this.height);return p}findCollisionDelta(p,h=4){return Math.log2(Math.min((p.halfWidth+this.halfWidth+h)/Math.abs(p.centerT[0]-this.centerT[0]),(p.halfHeight+this.halfHeight+h)/Math.abs(p.centerT[1]-this.centerT[1])))}extend(p){const h=Math.min(this.xmin,
p.xmin),k=Math.min(this.ymin,p.ymin),n=Math.max(this.xmax,p.xmax)-h;p=Math.max(this.ymax,p.ymax)-k;this.width=n;this.height=p;this.halfWidth=n/2;this.halfHeight=p/2;this.x=h+n/2;this.y=k+p/2}static deserialize(p){const h=p.readF32(),k=p.readF32(),n=p.readInt32();p=p.readInt32();return new g(h,k,n,p)}}return g})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports","../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(e,g,p){function h(c,
q){c%=q;return 0<=c?c:c+q}const k=Number.POSITIVE_INFINITY,n=Math.PI,d=128/n,b=256/360,a=1/Math.LN2;e.between=function(c,q,f){return c>=q&&c<=f||c>=f&&c<=q};e.c2pi=2*n;e.cDegTo256=b;e.cDegToRad=n/180;e.cInfinity=k;e.cPi=n;e.cRadTo256=d;e.degToByte=function(c){return h(c*b,256)};e.distanceFromToPolylineWithinThreshold=function(c,q,f,t){let m,l,u;t*=t;for(const v of f){const r=v.length;if(!(2>r)){f=v[0].x;m=v[0].y;for(let y=1;y<r;++y){l=v[y].x;u=v[y].y;if(g.distanceToSegmentSquared(c,q,f,m,l,u)<t)return!0;
f=l;m=u}}}return!1};e.getTileMargins=function(c){return 8+Math.max(16*(c-14),0)};e.interpolate=function(c,q,f){return c*(1-f)+q*f};e.isCircleOverlapingRect=function(c,q,f,t,m,l,u){q=Math.max(t,Math.min(q,l))-q;f=Math.max(m,Math.min(f,u))-f;return q*q+f*f<=c*c};e.log2=function(c){return Math.log(c)*a};e.offsetLine=function(c,q){if(0===q||Number.isNaN(q))return c;const f=[],t=new p.Point(0,0),m=new p.Point(0,0),l=new p.Point(0,0);for(let v=0;v<c.length;v++){const r=c[v],y=[];for(let x=0;x<r.length;x++){var u=
r[x-1];const w=r[x],A=r[x+1];0===x?t.setCoords(0,0):t.assignSub(w,u).normalize().rightPerpendicular();x===r.length-1?m.setCoords(0,0):m.assignSub(A,w).normalize().rightPerpendicular();l.assignAdd(t,m).normalize();u=l.x*m.x+l.y*m.y;0!==u&&l.scale(1/u);y.push(p.Point.add(w,l.scale(q)))}f.push(y)}return f};e.pointInPolygon=function(c,q,f){let t=0,m,l;for(const u of f){f=u.length;for(let v=1;v<f;++v)m=u[v-1],l=u[v],m.y>q!==l.y>q&&(0<(l.x-m.x)*(q-m.y)-(l.y-m.y)*(c-m.x)?t++:t--)}return 0!==t};e.positiveMod=
h;e.radToByte=function(c){return h(c*d,256)};e.sqr=function(c){return c*c};e.translateAnchor=function(c,q,f,t){c=new p.Point(c[0],c[1]);c.scale(t);"viewport"===q&&(q=Math.PI/180*-f,c.rotate(Math.cos(q),Math.sin(q)));return c};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(e,g,p,h,k){function n(b){switch(b.type){case "CIMPointSymbol":b=
b.symbolLayers;if(!b||1!==b.length)return null;b=b[0];return"CIMVectorMarker"!==b.type?null:n(b);case "CIMVectorMarker":b=b.markerGraphics;if(!b||1!==b.length)return null;var a=b[0];if(!a)return null;b=a.geometry;if(!b)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type||a.symbolLayers?.some(c=>!!c.effects)?null:{type:"sdf",geom:b,asFill:"CIMPolygonSymbol"===a.type}}}function d(b){let a=Infinity,c=-Infinity,q=Infinity,f=-Infinity;for(const t of b)for(const m of t)m[0]<
a&&(a=m[0]),m[0]>c&&(c=m[0]),m[1]<q&&(q=m[1]),m[1]>f&&(f=m[1]);return[a,q,c,f]}e.buildSDF=function(b){var a=b.geom;var c=a?a.rings?a.rings:a.paths?a.paths:void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax?[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]:null:null;a=Infinity;var q=-Infinity;var f=Infinity;var t=-Infinity;for(var m of c)for(var l of m)l[0]<a&&(a=l[0]),l[0]>q&&(q=l[0]),l[1]<f&&(f=l[1]),l[1]>t&&(t=l[1]);f=new h(a,f,q-a,t-f);m=k.spritePadding;
a=Math.floor(.5*(64-m));t=(128-2*(a+m))/Math.max(f.width,f.height);m=Math.round(f.width*t)+2*a;l=Math.round(f.height*t)+2*a;q=[];for(var u of c)if(u&&1<u.length){c=[];for(var v of u){let [B,I]=v;B-=f.x;I-=f.y;B*=t;I*=t;B+=a-.5;I+=a-.5;b.asFill?c.push([B,I]):c.push([Math.round(B),Math.round(I)])}if(b.asFill){var r=c.length-1;c[0][0]===c[r][0]&&c[0][1]===c[r][1]||c.push(c[0])}q.push(c)}v=m*l;u=Array(v);c=a*a+1;for(f=0;f<v;++f)u[f]=c;for(var y of q)for(c=y.length,f=1;f<c;++f){t=y[f-1];r=y[f];var x=void 0,
w=void 0;t[0]<r[0]?(x=t[0],w=r[0]):(x=r[0],w=t[0]);var A=void 0,z=void 0;t[1]<r[1]?(A=t[1],z=r[1]):(A=r[1],z=t[1]);var C=Math.floor(x)-a;w=Math.floor(w)+a;A=Math.floor(A)-a;z=Math.floor(z)+a;0>C&&(C=0);w>m&&(w=m);0>A&&(A=0);z>l&&(z=l);x=r[0]-t[0];const B=r[1]-t[1],I=x*x+B*B;for(;C<w;C++)for(let H=A;H<z;H++){var D=(C-t[0])*x+(H-t[1])*B,F=void 0;0>D?(F=t[0],D=t[1]):D>I?(F=r[0],D=r[1]):(D/=I,F=t[0]+D*x,D=t[1]+D*B);F=(C-F)*(C-F)+(H-D)*(H-D);D=(l-H-1)*m+C;F<u[D]&&(u[D]=F)}}for(y=0;y<v;++y)u[y]=Math.sqrt(u[y]);
if(b.asFill)for(var G of q)for(b=G.length,y=1;y<b;++y)for(q=G[y-1],v=G[y],q[0]<v[0]?(c=q[0],f=v[0]):(c=v[0],f=q[0]),q[1]<v[1]?(r=q[1],t=v[1]):(r=v[1],t=q[1]),c=Math.floor(c),f=Math.floor(f)+1,r=Math.floor(r),t=Math.floor(t)+1,c<a&&(c=a),f>m-a&&(f=m-a),r<a&&(r=a),t>l-a&&(t=l-a);r<t;++r)if(q[1]>r!==v[1]>r){w=(l-r-1)*m;for(A=c;A<f;++A)A<(v[0]-q[0])*(r-q[1])/(v[1]-q[1])+q[0]&&(u[w+A]=-u[w+A]);for(A=a;A<c;++A)u[w+A]=-u[w+A]}G=2*a;a=u.length;b=new Uint8Array(4*a);for(y=0;y<a;++y)g.packFloatRGBA(.5-u[y]/
G,b,4*y);return[b,m,l]};e.getExtent=function(b){return b?b.rings?d(b.rings):b.paths?d(b.paths):p.isExtent(b)?[b.xmin,b.ymin,b.xmax,b.ymax]:null:null};e.getSDFInfo=n;e.getSDFMetrics=function(b,a,c,q,f){const [t,m,l,u]=b;if(l<t||u<m)return[0,0,0,1];var v=l-t,r=u-m,y=k.spritePadding;b=Math.floor(.5*(64-y));y=(128-2*(b+y))/Math.max(v,r);const x=Math.round(v*y),w=Math.round(r*y)+2*b;r=1;a&&(r=w/y/(a.ymax-a.ymin));let A=0,z=0;v=1;q&&(f?a&&c&&0<a.ymax-a.ymin&&(v=(a.xmax-a.xmin)/(a.ymax-a.ymin),A=q.x/(c*
v),z=q.y/c):(A=q.x,z=q.y));a&&(A=.5*(a.xmax+a.xmin)+A*(a.xmax-a.xmin),z=.5*(a.ymax+a.ymin)+z*(a.ymax-a.ymin));A=(A-t)*y+b;z=(z-m)*y+b;a=A/(x+2*b)-.5;q=z/w-.5;f&&c&&(a*=c*v,q*=c);return[r,a,q,v]};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(e,g){function p(d,b=0){let a=0;for(let c=0;4>c;c++)a+=d[b+c]*k[c];return a}const h=[1,256,65536,16777216],k=[1/256,1/65536,1/16777216,1/4294967296],n=p(new Uint8ClampedArray([255,
255,255,255]));e.packFloatRGBA=function(d,b,a=0){d=g.clamp(d,0,n);for(let f=0;4>f;f++){var c=Math,q=d*h[f];b[a+f]=c.floor.call(c,256*(q-Math.floor(q)))}};e.unpackFloatRGBA=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CIMOperators ../CIMSymbolHelper".split(" "),function(e,g,p,h,k,n){const d=96/72;class b{static executeEffects(a,
c,q,f){const t=n.getEffectsInflateSize(a);c=new h.SimpleEffectCursor(c);for(const m of a)(a=k.getEffectOperator(m))&&(c=a.execute(c,m,d,q,f,t));return c}static applyEffects(a,c,q){if(!a)return c;var f=n.getEffectsInflateSize(a);c=new h.SimpleEffectCursor(g.GeometryCursor.fromJSONCIM(c));for(var t of a)(a=k.getEffectOperator(t))&&(c=a.execute(c,t,1,null,q,f));f=[];for(t=null;q=c.next();)f.push(...p.collectMultipath(q)),t=q.geometryType;return 0===f.length||null===t?null:"esriGeometryPolygon"===t?{rings:f}:
{paths:f}}}e.CIMEffectHelper=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Container":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../layers/effects/EffectView","./DisplayObject","../layers/support/util"],function(e,g,p,h,k){class n extends h.DisplayObject{constructor(){super(...arguments);this._childrenSet=new Set;this._needsSort=!1;this._children=[];this._highlightGradient=this._highlightOptions=this._effectView=
null}get blendMode(){return this._blendMode}set blendMode(d){this._blendMode=d;this.requestRender()}get children(){return this._children}get clips(){return this._clips}set clips(d){this._clips=d;this.children.forEach(b=>b.clips=d)}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(d){if(this._effectView||d)this._effectView||(this._effectView=new p.EffectView),this._effectView.effect=d,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(d){d?
this._highlightOptions&&this._highlightOptions.equals(d)||(this._highlightOptions=d,this._highlightGradient=k.createOrReuseHighlightGradient(this._highlightGradient,d),this.requestRender()):(this._highlightOptions=null,this._highlightGradient&&(this._highlightGradient.destroy(),this._highlightGradient=null,this.requestRender()))}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some(d=>d.hasHighlight)}get hasLabels(){return this.children.some(d=>d.hasLabels)}get requiresDedicatedFBO(){return this.children.some(d=>
"blendMode"in d&&d.blendMode&&"normal"!==d.blendMode)}updateTransitionProperties(d,b){super.updateTransitionProperties(d,b);this._effectView&&(this._effectView.transitionStep(d,b),this._effectView.transitioning&&this.requestRender())}doRender(d){d=this.createRenderParams(d);const {painter:b}=d;b.beforeRenderLayer(d,this._clips?.length?255:0,this.computedOpacity);this.renderChildren(d);b.afterRenderLayer(d,this.computedOpacity)}addChild(d){return this.addChildAt(d,this.children.length)}addChildAt(d,
b=this.children.length){if(!d||this.contains(d))return d;this._needsSort=!0;const a=d.parent;a&&a!==this&&a.removeChild(d);b>=this.children.length?this.children.push(d):this.children.splice(b,0,d);this._childrenSet.add(d);d.parent=this;d.stage=this.stage;this!==this.stage&&(d.clips=this.clips);this.requestRender();return d}contains(d){return this._childrenSet.has(d)}endTransitions(){super.endTransitions();this._effectView&&(this._effectView.endTransitions(),this.requestRender())}removeAllChildren(){this._childrenSet.clear();
this._needsSort=!0;for(const d of this.children)this!==this.stage&&(d.clips=null),d.stage=null,d.parent=null;this.children.length=0}removeChild(d){return this.contains(d)?this.removeChildAt(this.children.indexOf(d)):d}removeChildAt(d){if(0>d||d>=this.children.length)return null;this._needsSort=!0;d=this.children.splice(d,1)[0];this._childrenSet.delete(d);this!==this.stage&&(d.clips=null);d.stage=null;d.parent=null;return d}sortChildren(d){this._needsSort&&(this.children.sort(d),this._needsSort=!1)}beforeRender(d){super.beforeRender(d);
for(const b of this.children)b.beforeRender(d)}afterRender(d){super.afterRender(d);for(const b of this.children)b.afterRender(d)}_createTransforms(){return{displayViewScreenMat3:g.create()}}onAttach(){super.onAttach();const d=this.stage;for(const b of this.children)b.stage=d}onDetach(){super.onDetach();for(const d of this.children)d.stage=null}renderChildren(d){for(const b of this.children)b.processRender(d)}createRenderParams(d){return{...d,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,
effects:this.computedEffects,globalOpacity:d.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||d.highlightGradient}}}e.Container=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ./parser ./utils".split(" "),
function(e,g,p,h,k,n,d,b,a,c){function q(m){m=a.parse(m)||[];var l=(l=m[0])?"type"in l:!1;return l?[{scale:-1,effects:m}]:m}function f(m,l,u){return m[0]?.effects&&l[0]?.effects?(-1===m[0]?.scale||-1===l[0]?.scale)&&(1<m.length||1<l.length)&&0>=u?!1:c.canInterpolateEffects(m[0].effects,l[0].effects):!0}function t(m,l,u){const v=m.length>l.length?m:l;m=m.length>l.length?l:m;var r=m[m.length-1];l=r?.scale??u;r=r?.effects??[];for(let y=m.length;y<v.length;y++)m.push({scale:l,effects:[...r]});for(l=0;l<
v.length;l++)m[l].scale=-1===m[l].scale?u:m[l].scale,v[l].scale=-1===v[l].scale?u:v[l].scale,c.normalizeEffects(m[l].effects,v[l].effects)}e.EffectView=class extends p{constructor(m){super(m);this._final=this._to=this._from=null;this._current=[];this._time=0;this.duration=h("mapview-transitions-duration");this.effects=[]}set effect(m){const l=this._get("effect");m=m||"";if(l!==m){this._set("effect",m);try{this._transitionTo(q(m))}catch(u){this._transitionTo([]),n.getLogger(this).warn("Invalid Effect",
{effect:m,error:u})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(m){this._updateForScale(m)}get transitioning(){return null!==this._to}canTransitionTo(m){try{return 0<this.scale&&f(this._current,q(m),this.scale)}catch{return!1}}transitionStep(m,l){this._applyTimeTransition(m);this._updateForScale(l)}endTransitions(){this._applyTimeTransition(this.duration)}_transitionTo(m){0<this.scale&&f(this._current,m,this.scale)?(this._final=m,this._to=k.clone(m),t(this._current,
this._to,this.scale),this._from=k.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=m);this._set("effects",this._current[0]?k.clone(this._current[0].effects):[])}_applyTimeTransition(m){if(this._to&&this._from&&this._current&&this._final){this._time+=m;m=Math.min(1,this._time/this.duration);for(let u=0;u<this._current.length;u++){const v=this._current[u],r=this._from[u],y=this._to[u];var l=r.scale;v.scale=l+(y.scale-l)*m;for(l=0;l<v.effects.length;l++)v.effects[l].interpolate(r.effects[l],
y.effects[l],m)}1===m&&(this._current=this._final,this._set("effects",this._current[0]?k.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}}_updateForScale(m){this._set("scale",m);if(0!==this._current.length){var l=this._current,u=this._current.length-1,v,r=1;if(1===l.length||m>=l[0].scale)var y=v=l[0].effects;else if(m<=l[u].scale)y=v=l[u].effects;else for(let x=0;x<u;x++){const w=l[x],A=l[x+1];if(w.scale>=m&&A.scale<=m){r=(m-w.scale)/(A.scale-w.scale);v=w.effects;y=A.effects;
break}}for(m=0;m<this.effects.length;m++)this.effects[m].interpolate(v[m],y[m],r)}}};g.__decorate([d.property()],e.EffectView.prototype,"_to",void 0);g.__decorate([d.property()],e.EffectView.prototype,"duration",void 0);g.__decorate([d.property({value:""})],e.EffectView.prototype,"effect",null);g.__decorate([d.property({readOnly:!0})],e.EffectView.prototype,"effects",void 0);g.__decorate([d.property({readOnly:!0})],e.EffectView.prototype,"hasEffects",null);g.__decorate([d.property({value:0})],e.EffectView.prototype,
"scale",null);g.__decorate([d.property({readOnly:!0})],e.EffectView.prototype,"transitioning",null);e.EffectView=g.__decorate([b.subclass("esri.layers.effects.EffectView")],e.EffectView);e.canInterpolateEffectStops=f;e.convertEffectToStops=q;e.normalizeEffectStops=t;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(e,g,p,h){const k=0===
p("mapview-transitions-duration")?0:1/p("mapview-transitions-duration");class n extends g{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(d){this._clips=d;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(d){this._opacity!==
d&&(this._opacity=Math.min(1,Math.max(d,0)),this.requestRender())}get stage(){return this._stage}set stage(d){if(this._stage!==d){var b=this._stage;(this._stage=d)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):b?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(d){this._visible!==d&&(this._visible=
d,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=h.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;
this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=h.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(d){this.updateTransitionProperties(d.deltaTime,d.state.scale);this.setTransform(d.state)}afterRender(d){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(d){}processRender(d){this.stage&&this.computedVisible&&this.doRender(d)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(d,b){if(this.fadeTransitionEnabled&&0!==k){b=this._fadeOutResolver||!this.visible?0:this.opacity;const a=this.computedOpacity;a===b?this.computedVisible=this.visible:(d*=k,this.computedOpacity=a>b?Math.max(b,a-d):Math.min(b,a+d),this.computedVisible=0<this.computedOpacity,d=b===this.computedOpacity,this.inFadeTransition=!d,d||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=
this.visible}onAttach(){}onDetach(){}doRender(d){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}e.DisplayObject=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/util":function(){define(["exports","../../../../core/jsonMap","../../engine/webgl/effects/highlight/HighlightGradient","../../engine/webgl/effects/highlight/MultiHighlightGradient","../../engine/webgl/shaderGraph/techniques/featureTechniqueUtils"],function(e,
g,p,h,k){const n=new g.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});e.analyzeRings=function(d,b,a){const c=[],q=[];let f=0,t=0;for(const m of d){d=t;let l=m[0][0],u=m[0][1];c[t++]=l;c[t++]=u;let v=0;for(let r=1;r<m.length;++r){const y=l,x=u;l=m[r][0];u=m[r][1];v+=u*y-l*x;c[t++]=l;c[t++]=u}b(v/2);0<v?(0<d-f&&(a(f,d,c,q),f=d),q.length=0):0>v?0<d-f?q.push(.5*(d-f)):
t=d:t=d}0<t-f&&a(f,t,c,q)};e.canUseMajorityInterpolationOnDataSource=function(d){const {bandCount:b,attributeTable:a,colormap:c,pixelType:q}=d.raster.rasterInfo;return 1===b&&(null!=a||null!=c||"u8"===q||"s8"===q)};e.createOrReuseHighlightGradient=function(d,b){"single"===d?.type&&b.multiHighlightEnabled&&(d.destroy(),d=null);"multi"!==d?.type||b.multiHighlightEnabled||(d.destroy(),d=null);d||=b.multiHighlightEnabled?new h.MultiHighlightGradient:new p;d.setHighlightOptions(b);return d};e.renderHighlight=
function(d,b,a){const {painter:c,highlightGradient:q}=d,{highlight:f}=c.effects;if(q){var t=d.passOptions,m=q.getReasonsWithGradients();for(let u=0;u<m.length;u++){var l={...d,passOptions:{type:"highlight",activeGradient:m[u].activeGradient,activeReasons:m[u].activeReasons,stepType:"burn",highlightAll:b}};f.bind(l);a(l);if(u<m.length-1){l=0;for(let v=u+1;v<m.length;v++)l|=m[v].activeReasons;a({...d,passOptions:{type:"highlight",activeGradient:m[u].activeGradient,activeReasons:l,stepType:"clear",highlightAll:b}})}l=
{...d,passOptions:{type:"highlight",activeGradient:m[u].activeGradient,activeReasons:m[u].activeReasons,stepType:"draw",highlightAll:b}};c.setPipelineState(k.getFeaturePipelineState(d));c.updatePipelineState(d.context);f.draw(l);f.unbind()}d.passOptions=t}};e.toJSONGeometryType=function(d){return n.toJSON(d)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("../../../../../../core/Logger ../../../highlightReasons ../../definitions ./parameters ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d){function b(f,t){t.fillColor[0]=f.color.r/255;t.fillColor[1]=f.color.g/255;t.fillColor[2]=f.color.b/255;t.fillColor[3]=f.color.a;f.haloColor?(t.outlineColor[0]=f.haloColor.r/255,t.outlineColor[1]=f.haloColor.g/255,t.outlineColor[2]=f.haloColor.b/255,t.outlineColor[3]=f.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]);t.fillColor[3]*=f.fillOpacity;t.outlineColor[3]*=f.haloOpacity;
t.fillColor[0]*=t.fillColor[3];t.fillColor[1]*=t.fillColor[3];t.fillColor[2]*=t.fillColor[3];t.outlineColor[0]*=t.outlineColor[3];t.outlineColor[1]*=t.outlineColor[3];t.outlineColor[2]*=t.outlineColor[3];t.outlineWidth=h.highlightSizing.outlineWidth;t.outerHaloWidth=h.highlightSizing.outerHaloWidth;t.innerHaloWidth=h.highlightSizing.innerHaloWidth;t.outlinePosition=h.highlightSizing.outlinePosition}const a=()=>e.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),c=[0,0,0,
0];class q{constructor(){this.type="single";this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:h.highlightSizing.outlinePosition,outlineWidth:h.highlightSizing.outlineWidth,innerHaloWidth:h.highlightSizing.innerHaloWidth,outerHaloWidth:h.highlightSizing.outerHaloWidth};this._shadeTexChanged=!0;this._texelData=new Uint8Array(4*h.shadeTextureSize);this._minMaxDistance=[0,0]}setHighlightOptions(f){function t(w,A,z){x[0]=(1-z)*w[0]+z*A[0];
x[1]=(1-z)*w[1]+z*A[1];x[2]=(1-z)*w[2]+z*A[2];x[3]=(1-z)*w[3]+z*A[3]}const m=this._convertedHighlightOptions;b(f,m);f=m.outlinePosition-m.outlineWidth/2-m.outerHaloWidth;const l=m.outlinePosition-m.outlineWidth/2,u=m.outlinePosition+m.outlineWidth/2,v=m.outlinePosition+m.outlineWidth/2+m.innerHaloWidth;var r=Math.sqrt(Math.PI/2)*h.sigma,y=Math.abs(f)>r?Math.round(10*(Math.abs(f)-r))/10:0;r=Math.abs(v)>r?Math.round(10*(Math.abs(v)-r))/10:0;y&&!r?a().error("The outer rim of the highlight is "+y+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):
!y&&r?a().error("The inner rim of the highlight is "+r+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):y&&r&&a().error("The highlight is "+Math.max(y,r)+"px away from the edge of the feature; consider reducing some width values.");const x=[void 0,void 0,void 0,void 0];({_texelData:r}=this);for(let w=0;w<h.shadeTextureSize;++w)y=f+w/(h.shadeTextureSize-1)*(v-f),y<f?(x[0]=0,x[1]=0,x[2]=0,x[3]=0):y<l?t(c,
m.outlineColor,(y-f)/(l-f)):y<u?[x[0],x[1],x[2],x[3]]=m.outlineColor:y<v?t(m.outlineColor,m.fillColor,(y-u)/(v-u)):[x[0],x[1],x[2],x[3]]=m.fillColor,r[4*w]=255*x[0],r[4*w+1]=255*x[1],r[4*w+2]=255*x[2],r[4*w+3]=255*x[3];this._minMaxDistance[0]=f;this._minMaxDistance[1]=v;this._shadeTexChanged=!0}applyHighlightOptions(f,t){if(!this._shadeTex){const m=new d.TextureDescriptor;m.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;m.width=h.shadeTextureSize;m.height=1;this._shadeTex=new n.Texture(f,m)}this._shadeTexChanged&&
(this._shadeTex.updateData(0,0,0,h.shadeTextureSize,1,this._texelData),this._shadeTexChanged=!1);f.bindTexture(this._shadeTex,p.textureBindingHighlight1);t.setUniform2fv("u_minMaxDistance",this._minMaxDistance)}destroy(){this._shadeTex?.dispose();this._shadeTex=null}getReasonsWithGradients(){return[{activeReasons:(1<<g.highlightReasons.length)-1,activeGradient:this}]}}return q})},"esri/views/2d/engine/highlightReasons":function(){define(["exports","../../../Color","../support/HighlightOptions"],function(e,
g,p){const h={selection(n){return new p({color:new g([n.color.r/2,n.color.g/2,n.color.b/2,n.color.a])})},highlight(n){return n},popup(n){return new p({color:new g([n.color.g,n.color.b,n.color.r,n.color.a])})}},k=Object.keys(h);e.getHighlightBits=function(n){if(!n)return 0;let d=1;for(const b in h){if(b===n)break;d<<=1}return d};e.highlightConfigurator=h;e.highlightReasons=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["exports"],
function(e){e.alphaToRgbaChannelSelectorMatrix=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];e.highlightSizing={outlineWidth:1.3,outerHaloWidth:.4,innerHaloWidth:.4,outlinePosition:0};e.rgbaToRgbaChannelSelectorMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.shadeTextureSize=256;e.sigma=1;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/MultiHighlightGradient":function(){define(["exports","../../../highlightReasons","./HighlightGradient"],function(e,g,p){class h{constructor(){this.type=
"multi";const k={};for(const n in g.highlightConfigurator)k[n]=new p;this.gradients=k}setHighlightOptions(k){for(const n in g.highlightConfigurator){const d=g.highlightConfigurator[n](k);this.gradients[n].setHighlightOptions(d)}}applyHighlightOptions(k,n,d){this.gradients[d].applyHighlightOptions(k,n)}destroy(){for(const k in g.highlightConfigurator)this.gradients[k].destroy()}getReasonsWithGradients(){let k=1;const n=[];for(const d in this.gradients)n.push({activeReasons:k,activeGradient:this.gradients[d]}),
k<<=1;return n}}e.MultiHighlightGradient=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/featureTechniqueUtils":function(){define("exports ../../../../../../core/has ../../../../../../core/unitUtils ../../definitions ../../enums ../../../../../webgl/enums".split(" "),function(e,g,p,h,k,n){function d({pixelRatio:t,state:m,displayLevel:l,requiredLevel:u},v){const r=1/2**(l-v.key.level);u=1/2**(u-v.key.level);return{displayMat3:Array.from(m.displayMat3),
displayViewMat3:Array.from(m.displayViewMat3),displayViewScreenMat3:Array.from(v.transforms.displayViewScreenMat3),viewMat3:Array.from(m.viewMat3),tileMat3:Array.from(v.transforms.tileMat3),displayZoomFactor:r,requiredZoomFactor:u,tileOffset:[v.x,v.y],currentScale:m.scale,currentZoom:l,metersPerSRUnit:p.getMetersPerUnitForSR(m.spatialReference),rotation:m.rotation,pixelRatio:t}}function b(t){return"highlight"===t.passOptions?.type}function a(t){return"hittest"===t.passOptions?.type}const c={color:{write:[!0,
!0,!0,!0],blendMode:"composite"},depth:!1,stencil:{write:!1,test:{ref:t=>t.stencilRef,compare:n.CompareFunction.EQUAL,mask:255,op:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.REPLACE}}}},q={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:!1},f={...c,color:{write:[!0,!0,!0,!0],blendMode:"delete"}};e.getFeaturePipelineState=function(t){return a(t)?q:b(t)&&"clear"===t.passOptions.stepType?f:c};e.getFeatureUniforms=function(t,m){const {attributeView:l,
context:u}=t;var v=l.getUniforms(u);m=d(t,m);if(a(t)){({position:w}=t.passOptions);var r=t.pixelRatio,y=g("esri-mobile"),x=(y?g("hittest-2d-mobile-tolerance"):g("hittest-2d-desktop-tolerance"))*r;r*=y?g("hittest-2d-mobile-tolerance"):g("hittest-2d-small-symbol-tolerance");y=g("hittest-2d-small-symbol-tolerance-threshold");var w={position:w,distance:x,smallSymbolDistance:r,smallSymbolSizeThreshold:y}}else w=null;if(b(t)){var {activeReasons:A,highlightAll:z}=t.passOptions;t={activeReasons:A,highlightAll:z?
1:0}}else t=null;return{storage:v,view:m,hittestRequest:w,highlight:t}};e.getLocalTileOffset=function(t){const {row:m,col:l}=t.key;t=l*h.tileSize;const u=m*h.tileSize;return{tileOffsetFromLocalOrigin:[t%h.maxRepresentableInt,u%h.maxRepresentableInt],maxIntsToLocalOrigin:[Math.floor(t/h.maxRepresentableInt),Math.floor(u/h.maxRepresentableInt)]}};e.getSelectionDefines=function(t){return{inside:t.selection===k.FeatureSelection.InsideEffect,outside:t.selection===k.FeatureSelection.OutsideEffect}};e.getViewUniforms=
d;e.isHighlight=b;e.isHittest=a;e.resolveDynamicUniforms=function(t,m,l){const u={};for(const v in l)u[v]=l[v]instanceof Function?l[v](t,m):l[v];return u};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(["exports"],function(e){e.WGLGeometryType=void 0;(function(g){g[g.FILL=0]="FILL";g[g.LINE=1]="LINE";g[g.MARKER=2]="MARKER";g[g.TEXT=3]="TEXT";g[g.LABEL=4]="LABEL"})(e.WGLGeometryType||(e.WGLGeometryType={}));e.WGLDrawPhase=void 0;
(function(g){g[g.NONE=0]="NONE";g[g.MAP=1]="MAP";g[g.LABEL=2]="LABEL";g[g.LABEL_ALPHA=4]="LABEL_ALPHA";g[g.HITTEST=8]="HITTEST";g[g.HIGHLIGHT=16]="HIGHLIGHT";g[g.CLIP=32]="CLIP";g[g.DEBUG=64]="DEBUG";g[g.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(e.WGLDrawPhase||(e.WGLDrawPhase={}));e.VVBinding=void 0;(function(g){g[g.SIZE=0]="SIZE";g[g.COLOR=1]="COLOR";g[g.OPACITY=2]="OPACITY";g[g.ROTATION=3]="ROTATION"})(e.VVBinding||(e.VVBinding={}));e.WGLVVTarget=void 0;(function(g){g[g.MINMAX_TARGETS_OUTLINE=128]=
"MINMAX_TARGETS_OUTLINE";g[g.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";g[g.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";g[g.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(e.WGLVVTarget||(e.WGLVVTarget={}));e.MosaicType=void 0;(function(g){g[g.SPRITE=0]="SPRITE";g[g.GLYPH=1]="GLYPH"})(e.MosaicType||(e.MosaicType={}));e.WGLSymbologyType=void 0;(function(g){g[g.DEFAULT=0]="DEFAULT";g[g.SIMPLE=1]="SIMPLE";g[g.DOT_DENSITY=2]="DOT_DENSITY";g[g.OUTLINE_FILL=3]="OUTLINE_FILL";g[g.OUTLINE_FILL_SIMPLE=
4]="OUTLINE_FILL_SIMPLE";g[g.HEATMAP=5]="HEATMAP";g[g.PIE_CHART=6]="PIE_CHART"})(e.WGLSymbologyType||(e.WGLSymbologyType={}));e.FeatureSelection=void 0;(function(g){g[g.All=0]="All";g[g.Highlight=1]="Highlight";g[g.InsideEffect=2]="InsideEffect";g[g.OutsideEffect=3]="OutsideEffect"})(e.FeatureSelection||(e.FeatureSelection={}));e.FeatureBatchingStrategy=void 0;(function(g){g[g.BATCHING=0]="BATCHING";g[g.STRICT_ORDER=1]="STRICT_ORDER";g[g.STRICT_MARKERS_AND_TEXT=2]="STRICT_MARKERS_AND_TEXT"})(e.FeatureBatchingStrategy||
(e.FeatureBatchingStrategy={}));e.FeatureSymbologyDrawOrder=void 0;(function(g){g[g.FILL=0]="FILL";g[g.LINE=1]="LINE";g[g.MARKER=2]="MARKER";g[g.TEXT=3]="TEXT"})(e.FeatureSymbologyDrawOrder||(e.FeatureSymbologyDrawOrder={}));Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ManagedCanvas":function(){define("exports ../../../core/Evented ../../../core/events ../../../core/handleUtils ../../../core/has ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat2d ../../../core/libs/gl-matrix-2/factories/mat2df64 ../../webgl/contextUtils".split(" "),
function(e,g,p,h,k,n,d,b,a){class c{constructor(q){this.events=new g;this._hasMajorPerformanceCaveat=!1;this._lastRenderFrameCounter=0;this._canvas=document.createElement("canvas");this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");const f={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};q.appendChild(this._canvas);q=a.createContext(this._canvas,f);q||(q=a.createContext(this._canvas,{...f,failIfMajorPerformanceCaveat:!1}),
this._hasMajorPerformanceCaveat=!0);this._gl=q;this._handles=h.handlesGroup([p.on(this._canvas,"webglcontextlost",t=>this.events.emit("webgl-context-lost",t))])}destroy(){this._canvas.parentNode?.removeChild(this._canvas);this._canvas=null;this._handles.remove();this._gl=null}get gl(){return this._gl}render(q,f){if(this._hasMajorPerformanceCaveat||k("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=k("esri-performance-mode-frames-between-render")&&(f(),this._lastRenderViewState=q.state.clone(),
this._lastRenderFrameCounter=0),this._lastRenderViewState){const [t,m,l,u,v,r]=this._computeViewTransform(this._lastRenderViewState,q.state);this._canvas.style.transform=`matrix(${t}, ${m}, ${l}, ${u}, ${v}, ${r})`}}else f()}resize(q){const f=this._canvas,t=f.style,{state:{size:m},pixelRatio:l}=q;q=m[0];const u=m[1],v=Math.round(q*l),r=Math.round(u*l);if(f.width!==v||f.height!==r)f.width=v,f.height=r;t.width=q+"px";t.height=u+"px"}_computeViewTransform(q,f){const [t,m]=q.center,[l,u]=f.center,[v,
r]=q.toScreen([0,0],l,u),[y,x]=q.toScreen([0,0],t,m),w=y-v,A=x-r,z=q.scale/f.scale;q=f.rotation-q.rotation;f=b.create();d.identity(f);d.scale(f,f,[z,z]);d.rotate(f,f,n.deg2rad(q));d.translate(f,f,[w,A]);return f}}e.ManagedCanvas=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define("../../../../core/has ../../../../core/maybe ../brushes ../vectorTiles/shaders/VTLMaterialManager ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./TextureUploadManager ./VertexStream ./WorldExtentClipRenderer ./effects/AnimationEffect ./effects/BlendEffect ./effects/FeatureEffect ./effects/HighlightEffect ./effects/HittestEffect ./effects/HittestEffectVTL ./effects/post-processing/EffectManager ./painter/RenderPass ./shaderGraph/techniques/TechniqueProgramCache ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A,z,C,D){function F(B,I,H,K){return B!==n.WGLDrawPhase.LABEL_ALPHA&&B!==n.WGLDrawPhase.LABEL&&B!==n.WGLDrawPhase.HIGHLIGHT&&(1!==K||null!=I&&"normal"!==I||null!=H&&0<H.length)}class G{constructor(B,I){this.context=B;this._currentPipelineStateNeedsUpdate=!1;this._blitRenderer=new k.BitBlitRenderer;this._worldExtentRenderer=new q.WorldExtentRenderer;this._brushCache=new Map;this._lastHeight=this._lastWidth=null;this._vtlMaterialManager=new h;this._blendEffect=
new t.BlendEffect;this._stencilBuf=null;this._prevBeforeLayerFBOStack=[];this._fboPool=[];this.effects={highlight:new l,hittest:new u.HittestEffect,hittestVTL:new v.HittestEffectVTL,integrate:new f.AnimationEffect,insideEffect:new m.FeatureEffect("inside"),outsideEffect:new m.FeatureEffect("outside")};this._programCache=new x.TechniqueProgramCache;this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1};this.materialManager=new d(B);this.textureManager=
new b(I);this.textureUploadManager=new a.TextureUploadManager(I);this._effectsManager=new r.EffectManager;this._quadMesh=new c(B,[0,0,1,0,0,1,1,1])}dispose(){this._programCache.destroy();this.materialManager.dispose();this.textureManager.dispose();this.textureUploadManager.destroy();this._blitRenderer=g.disposeMaybe(this._blitRenderer);this._worldExtentRenderer=g.disposeMaybe(this._worldExtentRenderer);this._quadMesh.dispose();this._brushCache&&(this._brushCache.forEach(B=>B.dispose()),this._brushCache.clear(),
this._brushCache=null);if(this._fbos){let B;for(B in this._fbos)this._fbos[B]&&this._fbos[B].dispose()}for(const B of this._fboPool)B.dispose();this._fboPool.length=0;if(this.effects){let B;for(B in this.effects)this.effects[B]&&this.effects[B].dispose()}this._effectsManager.dispose();this._blendEffect.dispose(this.context);this._vtlMaterialManager=g.disposeMaybe(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy();this._programCache=new x.TechniqueProgramCache}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getFbos(){if(!this._fbos)throw Error("InternalError: Painter FBOs not initialized");
return this._fbos}acquireFbo(B,I){if(0<this._fboPool.length)var H=this._fboPool.pop();else H=new D.TextureDescriptor(B,I),H.samplingMode=w.TextureSamplingMode.NEAREST,H.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE,H=new A.FramebufferObject(this.context,H,this._stencilBuf);H.width===B&&H.height===I||H.resize(B,I);return H}releaseFbo(B){this._fboPool.push(B)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(B,I,H){const {context:K}=B;this._worldExtentRenderer.render(B,I,H);const {width:O,
height:R}=K.getViewport();this.updateFBOs(O,R);this._prevFBO=K.getBoundFramebufferObject();K.bindFramebuffer(this.getFbos().output);K.setColorMask(!0,!0,!0,!0);if(null!=I){const {r:E,g:J,b:Q,a:N}=I;K.setClearColor(N*E/255,N*J/255,N*Q/255,N)}else K.setClearColor(0,0,0,0);K.setDepthWriteEnabled(!0);K.setClearDepth(1);K.clear(K.gl.COLOR_BUFFER_BIT|K.gl.DEPTH_BUFFER_BIT);K.setDepthWriteEnabled(!1)}afterRenderPhases(B){({context:B}=B);B.bindFramebuffer(this._prevFBO);B.setStencilFunction(w.CompareFunction.EQUAL,
1,255);B.setStencilTestEnabled(!0);B.setDepthTestEnabled(!1);this.blitTexture(B,this.getFbos().output.colorTexture,w.TextureSamplingMode.NEAREST)}beforeRenderLayer(B,I,H){const {context:K,blendMode:O,effects:R,drawPhase:E,requireFBO:J}=B;if(J||F(E,O,R,H)){B=K.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(B);const {width:Q,height:N}=K.getViewport();B=this.acquireFbo(Q,N);K.bindFramebuffer(B);K.setColorMask(!0,!0,!0,!0);K.setClearColor(0,0,0,0);K.setDepthWriteEnabled(!0);K.setClearDepth(1);
K.clear(K.gl.COLOR_BUFFER_BIT|K.gl.DEPTH_BUFFER_BIT);K.setDepthWriteEnabled(!1)}K.setDepthWriteEnabled(!1);K.setDepthTestEnabled(!1);K.setStencilTestEnabled(!0);K.setClearStencil(I);K.setStencilWriteMask(255);K.clear(K.gl.STENCIL_BUFFER_BIT)}afterRenderLayer(B,I){const {context:H,blendMode:K,effects:O,requireFBO:R,drawPhase:E}=B;if(R||F(E,K,O,I)){const J=H.getBoundFramebufferObject();null!=O&&0<O.length&&E===n.WGLDrawPhase.MAP&&(H.setColorMask(!0,!0,!0,!0),this._applyEffects(B,O,J));H.bindFramebuffer(this._prevBeforeLayerFBOStack.pop());
H.setStencilTestEnabled(!1);H.setStencilWriteMask(0);H.setBlendingEnabled(!0);H.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);H.setColorMask(!0,!0,!0,!0);this._blendEffect.draw(B,J.colorTexture,w.TextureSamplingMode.NEAREST,null==K||E===n.WGLDrawPhase.HIGHLIGHT?"normal":K,I);this.releaseFbo(J)}}renderObject(B,I,H,K){if(H=p.brushes[H]){var O=this._brushCache.get(H);void 0===O&&(O=new H,this._brushCache.set(H,O));O.prepareState(B);
O.draw(B,I,K)}}renderObjects(B,I,H,K){if(H=p.brushes[H]){var O=this._brushCache.get(H);void 0===O&&(O=new H,this._brushCache.set(H,O));O.drawMany(B,I,K)}}registerRenderPass(B){const I=B.brushes.map(H=>{this._brushCache.has(H)||this._brushCache.set(H,new H);return this._brushCache.get(H)});return new y(I,B)}blitTexture(B,I,H,K=1){B.setBlendingEnabled(!0);B.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);B.setColorMask(!0,
!0,!0,!0);this._blitRenderer.render(B,I,H,K);this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(B){return this._effectsManager.getPostProcessingEffects(B)}updateFBOs(B,I){if(B!==this._lastWidth||I!==this._lastHeight)if(this._lastWidth=B,this._lastHeight=I,this._fbos)for(var H in this._fbos)this._fbos[H].resize(B,I);else H=new D.TextureDescriptor(B,I),H.samplingMode=w.TextureSamplingMode.NEAREST,H.wrapMode=w.TextureWrapMode.CLAMP_TO_EDGE,B=new C.RenderbufferDescriptor(w.RenderbufferFormat.DEPTH_STENCIL,
B,I),this._stencilBuf=new z.Renderbuffer(this.context,B),this._fbos={output:new A.FramebufferObject(this.context,H,this._stencilBuf),effect0:new A.FramebufferObject(this.context,H,this._stencilBuf)}}_applyEffects(B,I,H){const {context:K}=B;I=this._effectsManager.getPostProcessingEffects(I);for(const {postProcessingEffect:O,effect:R}of I)K.bindFramebuffer(H),O.draw(B,H,R);this._currentPipelineStateNeedsUpdate=!0}setShader(B){this._shaderState.shader=B.shader;this._shaderState.uniforms=B.uniforms;this._shaderState.defines=
B.defines;this._shaderState.optionalAttributes=B.optionalAttributes;this._shaderState.useComputeBuffer=B.useComputeBuffer??!1}setPipelineState(B){B!==this._currentPipelineState&&(this._currentPipelineState=B,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(B,I){var {instance:H}=I;H=H.instanceId;const {shader:K,uniforms:O,defines:R,optionalAttributes:E,useComputeBuffer:J}=this._shaderState;H=I.target.getMesh(H);const Q={useComputeBuffer:J,locationInfo:K.locationInfo,computeAttributeMap:K.computeAttributes};
var N=H.getLayout(Q);if(null==N)return null;const {primitive:S,count:W,offset:U}=H.getDrawArgs(w.PrimitiveType.TRIANGLES,I.count,I.start*Uint32Array.BYTES_PER_ELEMENT,J);N=this._programCache.getProgram(K,N,O,R??{},E??{});N.setUniforms(O);N.bind(B);this.updatePipelineState(B);this._updateStencilRef(B,I.target);I=H.getVAO(B,K.locationInfo,Q);B.bindVAO(I);B.drawElements(S,W,w.DataType.UNSIGNED_INT,U);B.bindVAO(null);N.cleanupTemporaryTextures();return{vertexShader:N.vertexShader,fragmentShader:N.fragmentShader}}submitDrawQuad(B){const {shader:I,
uniforms:H,defines:K,optionalAttributes:O}=this._shaderState,R=this._programCache.getProgram(I,this._quadMesh.layout,H,K??{},O??{});R.setUniforms(H);R.bind(B);this.updatePipelineState(B);this._updateStencilRef(B,null);this._quadMesh.draw();B.bindVAO(null);R.cleanupTemporaryTextures()}submitDrawMesh(B,I,H){const {shader:K,uniforms:O,defines:R,optionalAttributes:E}=this._shaderState,J=this._programCache.getProgram(K,I.layout,O,R??{},E??{});J.setUniforms(O);J.bind(B);this.updatePipelineState(B);this._updateStencilRef(B,
null);if(H)for(const Q of H)I.bind(B,Q),I.draw(B);else for(H=0;H<I.parts.length;H++)I.bind(B,H),I.draw(B);I.unbind(B);J.cleanupTemporaryTextures()}updatePipelineState(B){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(B))}_updatePipelineState(B){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const {color:I,depth:H,stencil:K}=this._currentPipelineState;if(I){const {blendMode:R,
write:E}=I;B.setColorMask(...E);B.setBlendingEnabled(!0);B.setBlendEquation(w.BlendOperation.ADD);switch(R){case "composite":B.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);break;case "additive":B.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE,w.BlendFactor.ONE,w.BlendFactor.ONE);break;case "custom":var {blendParameters:O}=I;const {dstAlpha:J,dstRGB:Q,srcAlpha:N,srcRGB:S}=O;B.setBlendFunctionSeparate(S,
Q,N,J);break;case "delete":B.setBlendEquation(w.BlendOperation.REVERSE_SUBTRACT),B.setBlendFunctionSeparate(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA,w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA)}}if(H){const {test:R,write:E}=H;E?(B.setDepthWriteEnabled(!0),B.setDepthRange(E.zNear,E.zFar)):B.setDepthWriteEnabled(!1);R?(B.setDepthTestEnabled(!0),B.setDepthFunction(R)):B.setDepthTestEnabled(!1)}else B.setDepthTestEnabled(!1),B.setDepthWriteEnabled(!1);if(K){const {test:R,write:E}=K;
if(R){const {compare:J,mask:Q,op:N,ref:S}=R;B.setStencilTestEnabled(!0);"function"!==typeof S&&B.setStencilFunctionSeparate(w.Face.FRONT_AND_BACK,J,S,Q);B.setStencilOpSeparate(w.Face.FRONT_AND_BACK,N.fail,N.zFail,N.zPass)}else B.setStencilTestEnabled(!1);E?({mask:O}=E,B.setStencilWriteMask(O)):B.setStencilWriteMask(0)}else B.setStencilTestEnabled(!1),B.setStencilWriteMask(0)}_updateStencilRef(B,I){if(null==this._currentPipelineState)throw Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");
var {stencil:H}=this._currentPipelineState;if(H&&({test:H}=H,H)){const {compare:K,mask:O,ref:R}=H;"function"===typeof R&&B.setStencilFunctionSeparate(w.Face.FRONT_AND_BACK,K,R(I),O)}}}return G})},"esri/views/2d/engine/brushes":function(){define("exports ./webgl/brushes/BrushBitmap ./webgl/brushes/BrushClip ./webgl/brushes/BrushOverlay ./webgl/brushes/WGLBrushStencil ./webgl/brushes/WGLBrushTileDebugInfo ./webgl/brushes/WGLBrushVTLBackground ./webgl/brushes/WGLBrushVTLCircle ./webgl/brushes/WGLBrushVTLFill ./webgl/brushes/WGLBrushVTLLine ./webgl/brushes/WGLBrushVTLSymbol".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){e.brushes={clip:p,stencil:k,bitmap:g,overlay:h,tileDebugInfo:n,vtlBackground:d.WGLBrushVTLBackground,vtlFill:a.WGLBrushVTLFill,vtlLine:c.WGLBrushVTLLine,vtlCircle:b.WGLBrushVTLCircle,vtlSymbol:q.WGLBrushVTLSymbol};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define(["../definitions","../VertexStream","./WGLBrush","../../../../webgl/enums"],function(e,g,p,h){const k={nearest:{defines:[],samplingMode:h.TextureSamplingMode.NEAREST,
mips:!1},bilinear:{defines:[],samplingMode:h.TextureSamplingMode.LINEAR,mips:!1},bicubic:{defines:["bicubic"],samplingMode:h.TextureSamplingMode.LINEAR,mips:!1},trilinear:{defines:[],samplingMode:h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,mips:!0}};class n extends p{constructor(){super(...arguments);this._desc={vsPath:"raster/bitmap",fsPath:"raster/bitmap",attributes:new Map([["a_pos",0]])}}dispose(){this._quad&&this._quad.dispose()}prepareState({context:d}){d.setBlendingEnabled(!0);d.setColorMask(!0,
!0,!0,!0);d.setStencilWriteMask(0);d.setStencilTestEnabled(!0)}draw(d,b){const {context:a,renderingOptions:c,painter:q,requestRender:f,allowDelayedRender:t}=d;if(b.source&&b.isReady){if("dynamic"===c.samplingMode){({state:l}=d);var m=b.resolution/b.pixelRatio/l.resolution;const y=Math.round(d.pixelRatio)!==d.pixelRatio;var l=l.rotation||1.05<m||.95>m||y||b.isSourceScaled||b.rotation?k.bilinear:k.nearest}else l=k[c.samplingMode];m=q.materialManager.getProgram(this._desc,l.defines);if(t&&null!=f&&!m.compiled)f();
else{d.timeline.begin(this.name);"additive"===b.blendFunction?a.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE):a.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);a.setStencilFunction(h.CompareFunction.EQUAL,b.stencilRef,255);this._quad||(this._quad=new g(a,[0,0,1,0,0,1,1,1]));var {coordScale:u,computedOpacity:v,transforms:r}=b;b.setSamplingProfile(l);b.bind(d.context,
e.textureBindingBitmap);a.useProgram(m);m.setUniformMatrix3fv("u_dvsMat3",r.displayViewScreenMat3);m.setUniform1i("u_texture",e.textureBindingBitmap);m.setUniform2fv("u_coordScale",u);m.setUniform1f("u_opacity",v);this._quad.draw();d.timeline.end(this.name)}}}}return n})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["./shaderGraph/techniques/mesh/utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexElementDescriptor"],
function(e,g,p,h,k){class n{constructor(d,b){this._rctx=d;this._attributes=[{name:"position",offset:0,type:p.DataType.SHORT,count:2}];this.layout={hash:e.vertexLayoutHash(this._attributes),attributes:this._attributes,stride:4};this._vertexBuffer=g.BufferObject.createVertex(d,p.Usage.STATIC_DRAW,new Uint16Array(b));this._vao=new h.VertexArrayObject(d,new Map([["a_position",0]]),{geometry:[new k.VertexElementDescriptor("a_position",2,p.DataType.SHORT,0,4)]},{geometry:this._vertexBuffer});this._count=
b.length/2}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao);this._rctx.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,this._count)}}return n})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(e,g){function p(h,k,n,d,b,a,c){if(h.primitiveName===k)for(const q in h)if(q===n){k=d?.readWithDefault(b,a,h[q]&&c);"text"===h.type&&(k=
k.toString());h[q]=k;return}if("type"in h&&null!=h.type)switch(h.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(h.symbolLayers)for(const q of h.symbolLayers)p(q,k,n,d,b,a,c);break;case "CIMHatchFill":h.lineSymbol&&p(h.lineSymbol,k,n,d,b,a,c);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if("CIMVectorMarker"===h.type&&h.markerGraphics)for(const q of h.markerGraphics)p(q,k,n,d,b,a,c),p(q.symbol,k,n,d,b,a,c)}}e.applyComputedValue=p;e.getLineClippingMargin=
function(h){const k=h.width;return null!=h.effects?256:Math.max(1.25*k,8)};e.vertexLayoutHash=function(h){h=h.map(({name:k,count:n,type:d})=>`${k}.${n}.${d}`).join(",");return g.numericHash(h)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(e){class g{constructor(p,h,k,n,d,b=!1,a=0){this.name=p;this.count=h;this.type=k;this.offset=n;this.stride=d;this.normalized=b;this.divisor=a}}e.VertexElementDescriptor=
g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){class e{constructor(){this.name=this.constructor.name||"UnnamedBrush";this.brushEffect=null}prepareState(g,p){}draw(g,p,h){}drawMany(g,p,h){for(const k of p)k.visible&&this.draw(g,k,h)}}return e})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/enums ../../../../webgl/ProgramTemplate".split(" "),
function(e,g,p,h,k,n){class d extends p{constructor(){super(...arguments);this._color=e.fromValues(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:b}){b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);b.setFaceCullingEnabled(!1);b.setColorMask(!1,!1,!1,!1);b.setStencilOp(k.StencilOperation.KEEP,k.StencilOperation.KEEP,k.StencilOperation.REPLACE);b.setStencilWriteMask(255);b.setStencilFunction(k.CompareFunction.ALWAYS,0,255)}draw(b,a){const {context:c,state:q,requestRender:f,
allowDelayedRender:t}=b;b=g.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:k.DataType.SHORT}]});a=a.getVAO(c,q,b.attributes,b.bufferLayouts);null!=a.indexBuffer&&(this._program||(this._program=n.createProgram(c,h.background)),t&&null!=f&&!this._program.compiled?f():(c.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",q.displayMat3),c.bindVAO(a),
c.drawElements(k.PrimitiveType.TRIANGLES,a.indexBuffer.size,k.DataType.UNSIGNED_INT,0),c.bindVAO()))}}return d})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(e){function g(){return new Float32Array(4)}function p(y){const x=new Float32Array(4);x[0]=y[0];x[1]=y[1];x[2]=y[2];x[3]=y[3];return x}function h(y,x,w,A){const z=new Float32Array(4);z[0]=y;z[1]=x;z[2]=w;z[3]=A;return z}function k(y,x){return new Float32Array(y,x,4)}function n(){return g()}function d(){return h(1,
1,1,1)}function b(){return h(1,0,0,0)}function a(){return h(0,1,0,0)}function c(){return h(0,0,1,0)}function q(){return h(0,0,0,1)}const f=g(),t=d(),m=b(),l=a(),u=c(),v=q(),r=Object.freeze(Object.defineProperty({__proto__:null,ONES:t,UNIT_W:v,UNIT_X:m,UNIT_Y:l,UNIT_Z:u,ZEROS:f,clone:p,create:g,createView:k,fromValues:h,ones:d,unitW:q,unitX:b,unitY:a,unitZ:c,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=t;e.UNIT_W=v;e.UNIT_X=m;e.UNIT_Y=l;e.UNIT_Z=u;e.ZEROS=f;e.clone=p;e.create=g;e.createView=
k;e.fromValues=h;e.ones=d;e.unitW=q;e.unitX=b;e.unitY=a;e.unitZ=c;e.vec4f32=r;e.zeros=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../symbols/cim/enums ../../../../core/RandomLCG ../../../../core/has ../../../webgl/checkWebGLError ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../chunks/builtins ../../../webgl/GLObjectType ../../../webgl/getDataTypeBytes ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/VertexElementDescriptor".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){function u(y){const x={};for(const w in y){let A=0;x[w]=y[w].map(z=>{const C=new l.VertexElementDescriptor(z.name,z.count,z.type,A,0,z.normalized||!1);A+=z.count*f.getDataTypeBytes(z.type);return C});x[w]?.forEach(z=>z.stride=A)}return x}const v=()=>p.getLogger("esri.views.2d.engine.webgl.Utils"),r=new Map;e.charCodes=function(y){const x=[];for(let w=0;w<y.length;w++)x.push(y.charCodeAt(w));return x};e.createAttributeLayout=u;e.createProgramDescriptor=(y,x)=>
{if(!r.has(y)){const z=u(x);var w=z;var A={};for(const C in w){const D=w[C];A[C]=D?.length?D[0].stride:0}w=A;A=new Map;for(const C in x)for(const D of x[C])A.set(D.name,D.location);r.set(y,{strides:w,bufferLayouts:z,attributes:A})}return r.get(y)};e.createTexture=function(y,x,w){const A=new m.TextureDescriptor(x.width,x.height);A.dataType=x.dataType;x.depth&&(A.depth=x.depth);x.flipped&&(A.flipped=x.flipped);x.hasMipmap&&(A.hasMipmap=x.hasMipmap);A.internalFormat=x.internalFormat;x.isImmutable&&(A.isImmutable=
x.isImmutable);x.isOpaque&&(A.isOpaque=x.isOpaque);x.maxAnisotropy&&(A.maxAnisotropy=x.maxAnisotropy);A.pixelFormat=x.pixelFormat;x.preMultiplyAlpha&&(A.preMultiplyAlpha=x.preMultiplyAlpha);x.samplingMode&&(A.samplingMode=x.samplingMode);x.target&&(A.target=x.target);A.uniform=x.uniform;x.unpackAlignment&&(A.unpackAlignment=x.unpackAlignment);x.wrapMode&&(A.wrapMode=x.wrapMode);return new t.Texture(y,A,w)};e.discardUrlIfHasUrlHash=function(y){return"url"in y&&"urlHash"in y?{...y,url:""}:y};e.getCapType=
function(y){switch(y){case "butt":return h.CapType.BUTT;case "round":return h.CapType.ROUND;case "square":return h.CapType.SQUARE;default:return v().error(new g("mapview-invalid-type",`Cap type ${y} is not a valid option. Defaulting to round`)),h.CapType.ROUND}};e.getJoinType=function(y){switch(y){case "miter":return h.JoinType.MITER;case "bevel":return h.JoinType.BEVEL;case "round":return h.JoinType.ROUND;default:return v().error(new g("mapview-invalid-type",`Join type ${y} is not a valid option. Defaulting to round`)),
h.JoinType.ROUND}};e.getPixelArrayCtor=function(y){switch(y){case b.PixelType.UNSIGNED_BYTE:return Uint8Array;case b.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case b.PixelType.FLOAT:return Float32Array;default:v().error(new g("webgl-utils",`Unable to handle type ${y}`))}};e.getPixelBytes=function(y){switch(y){case b.PixelType.UNSIGNED_BYTE:return 1;case b.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case b.PixelType.FLOAT:return 4;default:v().error(new g("webgl-utils",`Unable to handle type ${y}`))}};
e.isSVGImage=y=>y.includes("data:image/svg+xml");e.isValidSVG=y=>{if(!y)return!1;y=y.trim();return/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(y)&&/[\dz]$/i.test(y)&&4<y.length?!0:!1};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(e,g){g={shaders:{vertexShader:g.resolveIncludes("background/background.vert"),fragmentShader:g.resolveIncludes("background/background.frag")},
attributes:new Map([["a_pos",0]])};e.background=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(e,g,p){const h=new p.ShaderCompiler(function(k){return function(n){let d=k;n.split("/").forEach(b=>{d&&=d[b]});return d}}(g));e.resolveIncludes=function(k){return h.resolveIncludes(k)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color \x3d texture2D(u_tex, v_uv);\ngl_FragColor \x3d color * u_opacity;\n}",
"bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_pos , 0.0, 1.0);\nv_uv \x3d a_tex;\n}"},blend:{"blend.frag":"precision mediump float;\nuniform sampler2D u_layerTexture;\nuniform lowp float u_opacity;\nuniform lowp float u_inFadeOpacity;\n#ifndef NORMAL\nuniform sampler2D u_backbufferTexture;\n#endif\nvarying mediump vec2 v_uv;\nfloat rgb2v(in vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}\nvec3 rgb2hsv(in vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(in vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec3 tint(in vec3 Cb, in vec3 Cs) {\nfloat vIn \x3d rgb2v(Cb);\nvec3 hsvTint \x3d rgb2hsv(Cs);\nvec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\nreturn hsv2rgb(hsvOut);\n}\nfloat overlay(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (1.0 - 2.0 * (1.0 - Cs ) * (1.0 - Cb)) + step(0.5, Cs) * (2.0 * Cs * Cb);\n}\nfloat colorDodge(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 0.0) ? 0.0 : (Cs \x3d\x3d 1.0) ? 1.0 : min(1.0, Cb / (1.0 - Cs));\n}\nfloat colorBurn(in float Cb, in float Cs) {\nreturn (Cb \x3d\x3d 1.0) ? 1.0 : (Cs \x3d\x3d 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - Cb) / Cs);\n}\nfloat hardLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * (2.0 * Cs * Cb) + step(0.5, Cs) * (1.0 - 2.0 * (1.0 - Cs) * (1.0 - Cb));\n}\nfloat reflectBlend(in float Cb, in float Cs) {\nreturn (Cs \x3d\x3d 1.0) ? Cs : min(Cb * Cb / (1.0 - Cs), 1.0);\n}\nfloat softLight(in float Cb, in float Cs) {\nif (Cs \x3c\x3d 0.5) {\nreturn Cb - (1.0 - 2.0 * Cs) * Cb * (1.0 - Cb);\n}\nif (Cb \x3c\x3d 0.25) {\nreturn Cb + (2.0 * Cs - 1.0) * Cb * ((16.0 * Cb - 12.0) * Cb + 3.0);\n}\nreturn Cb + (2.0 * Cs - 1.0) * (sqrt(Cb) - Cb);\n}\nfloat vividLight(in float Cb, in float Cs) {\nreturn (1.0 - step(0.5, Cs)) * colorBurn(Cb, 2.0 * Cs) + step(0.5, Cs) * colorDodge(Cb, (2.0 * (Cs - 0.5)));\n}\nfloat minv3(in vec3 c) {\nreturn min(min(c.r, c.g), c.b);\n}\nfloat maxv3(in vec3 c) {\nreturn max(max(c.r, c.g), c.b);\n}\nfloat lumv3(in vec3 c) {\nreturn dot(c, vec3(0.3, 0.59, 0.11));\n}\nfloat satv3(vec3 c) {\nreturn maxv3(c) - minv3(c);\n}\nvec3 clipColor(vec3 color) {\nfloat lum \x3d lumv3(color);\nfloat mincol \x3d minv3(color);\nfloat maxcol \x3d maxv3(color);\nif (mincol \x3c 0.0) {\ncolor \x3d lum + ((color - lum) * lum) / (lum - mincol);\n}\nif (maxcol \x3e 1.0) {\ncolor \x3d lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);\n}\nreturn color;\n}\nvec3 setLum(vec3 cbase, vec3 clum) {\nfloat lbase \x3d lumv3(cbase);\nfloat llum \x3d lumv3(clum);\nfloat ldiff \x3d llum - lbase;\nvec3 color \x3d cbase + vec3(ldiff);\nreturn clipColor(color);\n}\nvec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)\n{\nfloat minbase \x3d minv3(cbase);\nfloat sbase \x3d satv3(cbase);\nfloat ssat \x3d satv3(csat);\nvec3 color;\nif (sbase \x3e 0.0) {\ncolor \x3d (cbase - minbase) * ssat / sbase;\n} else {\ncolor \x3d vec3(0.0);\n}\nreturn setLum(color, clum);\n}\nvoid main() {\nvec4 src \x3d texture2D(u_layerTexture, v_uv);\n#ifdef NORMAL\ngl_FragColor \x3d src *  u_opacity;\n#else\nvec4 dst \x3d texture2D(u_backbufferTexture, v_uv);\nvec3 Cs \x3d src.a \x3d\x3d 0.0 ? src.rgb : vec3(src.rgb / src.a);\nvec3 Cb \x3d dst.a \x3d\x3d 0.0 ? dst.rgb : vec3(dst.rgb / dst.a);\nfloat as \x3d u_opacity * src.a;\nfloat ab \x3d dst.a;\n#ifdef DESTINATION_OVER\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb, as + ab - as * ab);\n#endif\n#ifdef SOURCE_IN\nvec4 color \x3d vec4(as * Cs * ab, as * ab);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef DESTINATION_IN\nvec4 color \x3d vec4(ab * Cb * as, ab * as);\nvec4 fadeColor \x3d (1.0 - u_opacity) * u_inFadeOpacity * vec4(ab * Cb, ab);\ngl_FragColor \x3d color + fadeColor;\n#endif\n#ifdef SOURCE_OUT\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab), as * (1.0 - ab));\n#endif\n#ifdef DESTINATION_OUT\ngl_FragColor \x3d vec4(ab * Cb * (1.0 - as), ab * (1.0 - as));\n#endif\n#ifdef SOURCE_ATOP\ngl_FragColor \x3d vec4(as * Cs * ab + ab * Cb * (1.0 - as), ab);\n#endif\n#ifdef DESTINATION_ATOP\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * as, as);\n#endif\n#ifdef XOR\ngl_FragColor \x3d vec4(as * Cs * (1.0 - ab) + ab * Cb * (1.0 - as),\nas * (1.0 - ab) + ab * (1.0 - as));\n#endif\n#ifdef MULTIPLY\ngl_FragColor \x3d vec4(as * Cs * ab * Cb + (1.0 - ab) * as * Cs + (1.0 - as) * ab * Cb,\nas + ab * (1.0 - as));\n#endif\n#ifdef SCREEN\ngl_FragColor \x3d vec4((Cs + Cb - Cs * Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef OVERLAY\nvec3 f \x3d vec3(overlay(Cb.r, Cs.r), overlay(Cb.g, Cs.g), overlay(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DARKEN\ngl_FragColor \x3d vec4(min(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LIGHTER\ngl_FragColor \x3d vec4(as * Cs + ab * Cb, as + ab);\n#endif\n#ifdef LIGHTEN\ngl_FragColor \x3d vec4(max(Cs, Cb) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_DODGE\nvec3 f \x3d clamp(vec3(colorDodge(Cb.r, Cs.r), colorDodge(Cb.g, Cs.g), colorDodge(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR_BURN\nvec3 f \x3d vec3(colorBurn(Cb.r, Cs.r), colorBurn(Cb.g, Cs.g), colorBurn(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HARD_LIGHT\nvec3 f \x3d vec3(hardLight(Cb.r, Cs.r), hardLight(Cb.g, Cs.g), hardLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SOFT_LIGHT\nvec3 f \x3d vec3(softLight(Cb.r, Cs.r), softLight(Cb.g, Cs.g), softLight(Cb.b, Cs.b));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef DIFFERENCE\ngl_FragColor \x3d vec4(abs(Cb - Cs) * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef EXCLUSION\nvec3 f \x3d Cs + Cb - 2.0 * Cs * Cb;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef INVERT\ngl_FragColor \x3d vec4((1.0 - Cb) * as * ab + Cb * ab * (1.0 - as), ab);\n#endif\n#ifdef VIVID_LIGHT\nvec3 f \x3d vec3(clamp(vividLight(Cb.r, Cs.r), 0.0, 1.0),\nclamp(vividLight(Cb.g, Cs.g), 0.0, 1.0),\nclamp(vividLight(Cb.b, Cs.b), 0.0, 1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef HUE\nvec3 f \x3d setLumSat(Cs,Cb,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef SATURATION\nvec3 f \x3d setLumSat(Cb,Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef COLOR\nvec3 f \x3d setLum(Cs,Cb);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef LUMINOSITY\nvec3 f \x3d setLum(Cb,Cs);\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef PLUS\ngl_FragColor \x3d clamp(vec4(src.r + Cb.r, src.g + Cb.g, src.b + Cb.b, as + ab), 0.0, 1.0);\n#endif\n#ifdef MINUS\ngl_FragColor \x3d vec4(clamp(vec3(Cb.r - src.r, Cb.g - src.g, Cb.b - src.b), 0.0, 1.0), ab * as);\n#endif\n#ifdef AVERAGE\nvec3 f \x3d (Cb + Cs) / 2.0;\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#ifdef REFLECT\nvec3 f \x3d clamp(vec3(reflectBlend(Cb.r, Cs.r),\nreflectBlend(Cb.g, Cs.g),\nreflectBlend(Cb.b, Cs.b)), vec3(0.0), vec3(1.0));\ngl_FragColor \x3d vec4(f * as * ab + Cs * as * (1.0 - ab) + Cb * ab *(1.0 - as),\nas + ab * (1.0 - as));\n#endif\n#endif\n}",
"blend.vert":"attribute vec2 a_position;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position \x3d vec4(a_position , 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor \x3d v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position \x3d a_PositionAndFlags.xy;\nfloat flags \x3d a_PositionAndFlags.z;\nint colorIndex \x3d int(mod(flags, 4.0));\nvec4 color;\nfor (int i \x3d 0; i \x3c 4; i++) {\ncolor \x3d u_colors[i];\nif (i \x3d\x3d colorIndex) {\nbreak;\n}\n}\nint opacityIndex \x3d int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i \x3d 0; i \x3c 4; i++) {\nopacity \x3d u_opacities[i];\nif (i \x3d\x3d opacityIndex) {\nbreak;\n}\n}\nv_color \x3d color * opacity;\ngl_Position \x3d vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},
dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist \x3d length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha \x3d smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor \x3d v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON \x3d 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture \x3d mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords \x3d tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color \x3d texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth \x3d max(u_dotSize / 2., 1.) ;\nfloat z \x3d 0.;\nz +\x3d 2.0 * step(v_color.a, EPSILON);\ngl_PointSize \x3d (smoothEdgeWidth + u_dotSize);\ngl_Position \x3d vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio \x3d u_dotSize / gl_PointSize;\nv_invEdgeRatio \x3d -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *\x3d (u_pixelRatio * u_tileZoomFactor);\n}"}},
filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b \x3d 1.0 / 6.0;\nfloat v2 \x3d v * v;\nfloat v3 \x3d v2 * v;\nfloat w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 \x3d b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w \x3d computeWeights(v);\nfloat g0 \x3d w.x + w.y;\nfloat g1 \x3d w.z + w.w;\nfloat h0 \x3d 1.0 - (w.y / g0) + v;\nfloat h1 \x3d 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\nvec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\nvec2 texel \x3d coords * texSize - 0.5;\nvec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 \x3d coords + hgX.x * eX;\nvec2 coords00 \x3d coords - hgX.y * eX;\nvec2 coords11 \x3d coords10 + hgY.x * eY;\nvec2 coords01 \x3d coords00 + hgY.x * eY;\ncoords10 \x3d coords10 - hgY.y * eY;\ncoords00 \x3d coords00 - hgY.y * eY;\nvec4 color00 \x3d texture2D(sampler, coords00);\nvec4 color10 \x3d texture2D(sampler, coords10);\nvec4 color01 \x3d texture2D(sampler, coords01);\nvec4 color11 \x3d texture2D(sampler, coords11);\ncolor00 \x3d mix(color00, color01, hgY.z);\ncolor10 \x3d mix(color10, color11, hgY.z);\ncolor00 \x3d mix(color00, color10, hgX.z);\nreturn color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart \x3d floor(coords * texSize);\nvec2 coord0 \x3d texelStart / texSize;\nvec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 \x3d texture2D(sampler, coord0);\nvec4 color1 \x3d texture2D(sampler, coord1);\nvec4 color2 \x3d texture2D(sampler, coord2);\nvec4 color3 \x3d texture2D(sampler, coord3);\nvec2 blend \x3d fract(coords * texSize);\nvec4 color01 \x3d mix(color0, color1, blend.x);\nvec4 color23 \x3d mix(color2, color3, blend.x);\nvec4 color \x3d mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha \x3d floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor \x3d color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize \x3d 1.0 / texSize;\nvec2 texel \x3d coords * texSize;\nvec2 texel_i \x3d floor(texel);\nvec2 texel_frac \x3d fract(texel);\nvec4 colorP \x3d texture2D(sampler, texel_i * invSize);\nvec4 colorP1 \x3d vec4(colorP);\nvec4 colorP2 \x3d vec4(colorP);\nvec4 colorP3 \x3d vec4(colorP);\nvec4 colorP4 \x3d vec4(colorP);\nvec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\ncolorP1 \x3d colorA;\n}\nif (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\ncolorP2 \x3d colorB;\n}\nif (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\ncolorP3 \x3d colorC;\n}\nif (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\ncolorP4 \x3d colorD;\n}\nvec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\nvec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\nfloat flags \x3d data0.r * 255.0;\nfloat groupMinZoom \x3d data0.g * 255.0;\nfloat wouldClip \x3d float(groupMinZoom \x3d\x3d 0.);\nfloat direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\nfloat dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\nvec4 nextState \x3d vec4(texel + direction * dt);\ngl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\nvec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\ngl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data \x3d texture2D(u_texture, v_uv);\nfloat density \x3d data.r * COMPRESSION_FACTOR;\ndensity *\x3d u_densityNormalization;\ndensity \x3d (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color \x3d texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}",
"heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv \x3d a_pos;\ngl_Position \x3d vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w \x3d gauss1(i * u_direction.xy);\ntot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight +\x3d w;\n}\nvoid main(void) {\nmediump float tot \x3d 0.0;\nmediump float weight \x3d 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y \x3d texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 \x3d 0.5;\nmediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d \x3d (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d \x3d estimateDistance();\ngl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlayTexture;\nuniform bool u_maskEnabled;\nuniform bool u_overlayEnabled;\nvarying mediump vec2 v_texCoord;\nconst lowp float barrelFactor \x3d 1.1;\nlowp vec2 barrel(lowp vec2 uv) {\nlowp vec2 uvn \x3d uv * 2.0 - 1.0;\nif (uvn.x \x3d\x3d 0.0 \x26\x26 uvn.y \x3d\x3d 0.0) {\nreturn vec2(0.5, 0.5);\n}\nlowp float theta \x3d atan(uvn.y, uvn.x);\nlowp float r \x3d pow(length(uvn), barrelFactor);\nreturn r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;\n}\nvoid main(void)\n{\nlowp vec4 color \x3d texture2D(u_readbackTexture, barrel(v_texCoord));\ncolor \x3d (color + (1.0 - color.a) * u_background);\nlowp float mask \x3d u_maskEnabled ? texture2D(u_maskTexture, v_texCoord).a : 1.0;\ncolor *\x3d mask;\nlowp vec4 overlayColor \x3d u_overlayEnabled ? texture2D(u_overlayTexture, v_texCoord) : vec4(0);\ngl_FragColor \x3d overlayColor + (1.0 - overlayColor.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec4 u_drawPos;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\nv_texCoord \x3d a_pos;\ngl_Position \x3d vec4(u_drawPos.xy + vec2(a_pos - 0.5) * u_drawPos.zw, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel \x3d unpackDisplayIdTexel(id);\nhighp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col \x3d mod(u32, size);\nhighp float row \x3d (u32 - col) / size;\nhighp float u \x3d col / size;\nhighp float v \x3d row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords \x3d getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}",
"barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary \x3d abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 \x3d mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 \x3d v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG \x3d 180.0 / 3.141592654;\nconst float POSITION_PRECISION \x3d 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION \x3d 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.00001;\nconst float EPSILON_HITTEST \x3d 0.05;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR \x3d 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY \x3d 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP \x3d 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE \x3d 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY \x3d 3;\nconst int BITSET_TYPE_FILL_OUTLINE \x3d 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET \x3d 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR \x3d 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR \x3d 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR \x3d 6;\nconst int BITSET_LINE_SCALE_DASH \x3d 2;",
fill:{"common.glsl":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\nlowp vec4 drawLine() {\nfloat v_lineWidth \x3d v_aux1.x;\nvec2  v_normal    \x3d v_aux1.yz;\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color \x3d vec4(0.);\n#ifdef HITTEST\nout_color \x3d v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr \x3d v_aux1;\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\nout_color \x3d v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY \x26\x26 !defined(HIGHLIGHT)\nvec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 \x3d step(0.0, difference0);\nvec4 isPositive1 \x3d step(0.0, difference1);\nfloat weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero \x3d step(weightSum, 0.0);\nfloat greaterThanZero \x3d 1.0 - lessThanEqZero ;\nfloat divisor \x3d (weightSum + lessThanEqZero);\nvec4 weights0 \x3d difference0 * isPositive0 / divisor;\nvec4 weights1 \x3d difference1 * isPositive1 / divisor;\nvec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax \x3d max(max4(difference0), max4(difference1));\nfloat lessThanZero \x3d step(diffMax, 0.0);\nfloat greaterOrEqZero \x3d 1.0 - lessThanZero;\nvec4 isMax0 \x3d step(diffMax, difference0);\nvec4 isMax1 \x3d step(diffMax, difference1);\nvec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color \x3d preEffectColor;\n#else\nout_color \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a \x3d 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline \x3e 0.5) {\ngl_FragColor \x3d drawLine();\n} else {\ngl_FragColor \x3d drawFill();\n}\n#else\ngl_FragColor \x3d drawFill();\n#endif\n}",
"fill.vert":"#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#include \x3cmaterials/fill/hittest.glsl\x3e\nconst float INV_SCALE_COMPRESSION_FACTOR \x3d 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT \x3d 16777216.0;\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs \x3d buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      \x3d outputs.id;\nv_opacity \x3d outputs.opacity;\nv_aux1    \x3d vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color \x3d outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet \x3d a_bitset;\nout_color \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized \x3d mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   \x3d tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   \x3d u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   \x3d a_aux1;\nfloat a_width  \x3d a_aux2.x;\nfloat a_height \x3d a_aux2.y;\nvec2  a_offset \x3d a_aux2.zw;\nvec2  a_scale  \x3d a_aux3.xy;\nfloat a_angle  \x3d a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) \x3e 0.5) {\na_width *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) \x3e 0.5) {\na_height *\x3d INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale \x3d INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width \x3d u_zoomFactor * a_width * scale.x;\nfloat height \x3d u_zoomFactor * a_height * scale.y;\nfloat angle \x3d C_256_TO_RAD * a_angle;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nfloat dx \x3d 0.0;\nfloat dy \x3d 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) \x3e 0.5) {\nfloat id \x3d rgba2float(vec4(a_id, 0.0));\ndx \x3d rand(vec2(id, 0.0));\ndy \x3d rand(vec2(0.0, id));\n}\nmat3 patternMatrix \x3d mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize \x3d vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt \x3d vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection \x3d patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset \x3d u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset \x3d vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset \x3d mod(tileOffset, patternSize);\nvec2 symbolOffset \x3d u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord \x3d (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 \x3d a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly \x3d getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) \x3e 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *\x3d (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly \x3d 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords \x3d (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) \x3e 0.5) {\nout_pos \x3d vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize \x3d 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline \x3d getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline \x3e 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  \x3d vec3(0.);\nhighp vec4 color  \x3d vec4(0.);\ndraw(color, pos);\nv_color \x3d color;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}",
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist \x3d u_hittestDist;\nfloat dist \x3d distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3c 0. || dist \x3e\x3d hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3d\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif"},
hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L \x3d p2 - p1;\nvec2 A \x3d p0 - p1;\nfloat projAL \x3d projectScalar(A, L);\nfloat t \x3d clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist \x3d distance(pos, vec3(hittestPos, 1.));\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) \x3e hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, (dist - size) \x3c 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba \x3d b - a;\nvec2 ca \x3d c - a;\nfloat crossProduct \x3d ba.x * ca.y - ca.x * ba.y;\nbool isParallel \x3d crossProduct \x3c EPSILON_HITTEST \x26\x26 crossProduct \x3e -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) \x3d\x3d 1.) {\nreturn 0.;\n}\nfloat distAB \x3d distPointSegment(p, a, b);\nfloat distBC \x3d distPointSegment(p, b, c);\nfloat distCA \x3d distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},
icon:{"common.glsl":"#include \x3cutil/encoding.glsl\x3e\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor \x3d vec4(1.0);\n#else\nlowp vec4 fillPixelColor \x3d v_color;\n#endif\nfloat d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth \x3d v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize \x3d min(outlineWidth, size);\noutlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",
heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor \x3d v_hittestResult;\n#else\nfloat radius \x3d length(v_offsetFromCenter);\nfloat shapeWeight \x3d step(radius, 1.0);\nfloat oneMinusRadiusSquared \x3d 1.0 - radius * radius;\nfloat kernelWeight \x3d oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor \x3d vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}",
"heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color \x3d vec4(0.0);\nvec2 a_zoomRange \x3d vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\n#include \x3cmaterials/icon/heatmapAccumulate/common.glsl\x3e\nvoid main() {\nfloat filterFlags \x3d getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult \x3d vec4(0.);\nhighp vec3 out_pos \x3d vec3(0.);\nvec3 pos \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult \x3d out_hittestResult;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter \x3d sign(a_vertexOffset);\nv_fieldValue \x3d getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos \x3d u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos \x3d centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position \x3d vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
"hittest.glsl":"#ifdef HITTEST\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase \x3d u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 \x3d scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 \x3d scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    \x3d (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 \x3d xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 \x3d xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 \x3d xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 \x3d xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 \x3d xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 \x3d a_texCoords  / u_mosaicSize;\nvec2 tex1 \x3d a_texCoords1 / u_mosaicSize;\nvec2 tex2 \x3d a_texCoords2 / u_mosaicSize;\nfloat alphaSum \x3d 0.;\nalphaSum +\x3d inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum +\x3d inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z +\x3d step(alphaSum, .05) * 2.0;\nout_color \x3d vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif",
"icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvoid main()\n{\n#ifdef HITTEST\nvec4 color \x3d v_color;\n#else\nvec4 color \x3d getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\n#include \x3cmaterials/icon/hittest.glsl\x3e\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f \x3d getSize(size.y) / size.y;\nfloat sizeFactor \x3d size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet \x3d a_bitSetAndDistRatio.x;\nvec3  pos           \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        \x3d vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize \x3d a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally \x3d getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               \x3d getMarkerScaleFactor(size, referenceSize);\nsize.xy     *\x3d scaleFactor;\noffset.xy   *\x3d scaleFactor;\noutlineSize *\x3d scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   \x3d a_texCoords / u_mosaicSize;\nfloat filterFlags \x3d getFilterFlags();\nv_color    \x3d getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  \x3d getOpacity();\nv_id       \x3d norm(a_id);\nv_pos      \x3d u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  \x3d vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   \x3d getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor \x3d v_isThin;\n#else\nv_overridingOutlineColor \x3d 0.0;\n#endif\nv_outlineWidth \x3d min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor \x3d a_outlineColor;\nv_distRatio \x3d a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color \x3d vec4(0.);\nhighp vec3 out_pos   \x3d vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color \x3d out_color;\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle \x3d angle * 360.0 / 254.0;\nfloat mapAngle \x3d u_mapRotation * 360.0 / 254.0;\nfloat diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z \x3d 0.0;\nz +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\nz +\x3d 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    \x3d getMinZoom();\nfloat glyphMinZoom    \x3d a_glyphData.x;\nfloat glyphMaxZoom    \x3d a_glyphData.y;\nfloat glyphAngle      \x3d a_glyphData.z;\nfloat a_isBackground  \x3d a_glyphData.w;\nfloat a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\nfloat fontSize           \x3d a_texAndSize.z;\nfloat haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    \x3d fontSize / SDF_FONT_SIZE;\nfloat halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\nfloat animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor \x3d (isBackground + isText) * a_color;\nv_color     \x3d animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   \x3d 1.0;\nv_tex       \x3d a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset \x3d u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\ngl_Position \x3d vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       \x3d u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist \x3d min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos \x3d vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist \x3e\x3d u_hittestDist) {\nout_pos.z +\x3d 2.0;\n}\nout_color \x3d vec4(1. / 255., 0, 0, dist \x3c\x3d 0. ? (1. / 255.) : 0.);\n}\n#endif",
"line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.frag\x3e\n#ifdef HITTEST\nvoid main() {\ngl_FragColor \x3d v_color;\n}\n#else\nvoid main() {\nLineData inputs \x3d LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor \x3d shadeLine(inputs);\n}\n#endif",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/symbologyTypeUtils.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\n#include \x3cmaterials/line/hittest.glsl\x3e\n#include \x3cmaterials/shared/line/common.glsl\x3e\n#include \x3cmaterials/shared/line/line.vert\x3e\n#ifdef HITTEST\nvoid draw() {\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat a_halfWidth \x3d a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth \x3d a_aux.x / 16. ;\nvec2  a_offset \x3d a_offsetAndNormal.xy / 16.;\nfloat baseWidth \x3d getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos \x3d vec3(0.);\nLineData outputs \x3d buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              \x3d outputs.id;\nv_color           \x3d outputs.color;\nv_normal          \x3d outputs.normal;\nv_lineHalfWidth   \x3d outputs.lineHalfWidth;\nv_opacity         \x3d outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          \x3d outputs.tlbr;\nv_patternSize   \x3d outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio \x3d outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position \x3d vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},
pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include \x3cutil/atan2.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex \x3d int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID \x3d 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize \x3d length(v_offset) * v_size;\nfloat donutSize \x3d donutRatio * v_size;\nfloat alpha \x3d step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle \x3d 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle \x3c 0.0) {\nangle +\x3d 360.0;\n} else if (angle \x3e 360.0) {\nangle \x3d mod(angle, 360.0);\n}\nint numOfEntries \x3d int(v_numOfEntries);\nfloat maxSectorAngle \x3d v_maxSectorAngle;\nlowp vec4 fillColor \x3d (maxSectorAngle \x3e 0.0 || sectorThreshold \x3e 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor \x3d vec4(0.0);\nlowp vec4 nextColor \x3d vec4(0.0);\nfloat startSectorAngle \x3d 0.0;\nfloat endSectorAngle \x3d 0.0;\nif (angle \x3c maxSectorAngle) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nstartSectorAngle \x3d endSectorAngle;\nendSectorAngle \x3d v_filteredSectorToColorId[index].x;\nif (endSectorAngle \x3e angle) {\nfillColor \x3d getSectorColor(index, v_filteredSectorToColorId);\nprevColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 index \x3d\x3d 0 \x26\x26 abs(360.0 - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3e 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d sectorThreshold !\x3d 0.0 \x26\x26 abs(endSectorAngle - maxSectorAngle) \x3c EPSILON ? othersColor :\ngetSectorColor(index \x3c numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index \x3d\x3d numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor \x3d getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor \x3d getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle \x3d maxSectorAngle;\nendSectorAngle \x3d 360.0;\n}\nlowp vec4 outlineColor \x3d outlineColor;\nfloat offset \x3d length(v_offset);\nfloat distanceSize \x3d offset * v_size;\nif (startSectorAngle !\x3d 0.0 || endSectorAngle !\x3d 360.0) {\nfloat distanceToStartSector \x3d (angle - startSectorAngle);\nfloat distanceToEndSector \x3d (endSectorAngle - angle);\nfloat sectorThreshold \x3d 0.6;\nfloat beginSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha \x3d smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha \x3e 0.0) {\nfillColor \x3d mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize \x3d donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut \x3d donutSize - v_outlineWidth;\nfloat aaThreshold \x3d 0.75;\nfloat innerCircleAlpha \x3d endOfDonut - aaThreshold \x3e 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha \x3d 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha \x3d innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline \x3d v_size - v_outlineWidth;\nif (startOfOutline \x3e 0.0 \x26\x26 v_outlineWidth \x3e 0.25) {\nfloat outlineFactor \x3d smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor \x3d donutSize - aaThreshold \x3e 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor \x3d mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d getColor();\n#ifdef highlight\ncolor.a \x3d step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor \x3d color;\n}",
"pie.vert":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/pie/pie.common.glsl\x3e\n#include \x3cmaterials/hittest/common.glsl\x3e\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle \x3e sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle +\x3d sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] \x3d vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index \x3d 0; index \x3c numberOfFields; ++index) {\nfloat sectorValue \x3d sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize \x3d baseSize;\n#ifdef VV_SIZE\nfloat r \x3d getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *\x3d r;\noffset.xy *\x3d r;\nfloat scaleSymbolProportionally \x3d getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned \x3d getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       \x3d vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value !\x3d NAN_MAGIC_NUMBER \x26\x26 value \x3e 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   \x3d a_size;\nvec2  a_offset \x3d a_offset / 16.0;\nfloat outlineSize \x3d outlineWidth;\nfloat a_bitSet \x3d a_bitSet;\nfloat a_referenceSize \x3d a_referenceSize;\nvec2 a_texCoords \x3d a_texCoords / 4.0;\nvec2 markerSize \x3d getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags \x3d getFilterFlags();\nvec3  pos         \x3d vec3(a_pos / 10.0, 1.0);\nv_opacity      \x3d getOpacity();\nv_id           \x3d norm(a_id);\nv_pos          \x3d displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       \x3d sign(a_texCoords - 0.5);\nv_size         \x3d max(markerSize.x, markerSize.y);\nv_outlineWidth \x3d outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 \x3d getDataDriven0(a_id);\nattributeData[0] \x3d filterNaNValues(attributeData3.x);\nattributeData[1] \x3d filterNaNValues(attributeData3.y);\nattributeData[2] \x3d filterNaNValues(attributeData3.z);\nattributeData[3] \x3d filterNaNValues(attributeData3.w);\n#if (numberOfFields \x3e 4)\nvec4 attributeData4 \x3d getDataDriven1(a_id);\nattributeData[4] \x3d filterNaNValues(attributeData4.x);\nattributeData[5] \x3d filterNaNValues(attributeData4.y);\nattributeData[6] \x3d filterNaNValues(attributeData4.z);\nattributeData[7] \x3d filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields \x3e 8)\nvec4 attributeData5 \x3d getDataDriven2(a_id);\nattributeData[8] \x3d filterNaNValues(attributeData5.x);\nattributeData[9] \x3d filterNaNValues(attributeData5.y);\n#endif\nfloat sum \x3d 0.0;\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsum +\x3d attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i \x3d 0; i \x3c numberOfFields; ++i) {\nsectorAngles[i] \x3d 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo \x3d FilteredChartInfo(0.0, 0);\nint numOfEntries \x3d filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries \x3d float(numOfEntries);\nv_maxSectorAngle \x3d filteredInfo.endSectorAngle;\nv_filteredSectorToColorId \x3d filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos \x3d vec3(0.0);\nv_color            \x3d vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize \x3d 1.0;\ngl_Position \x3d vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position \x3d vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},
shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};",
"line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth \x3d line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX \x3d fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY \x3d 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT) \x26\x26 !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth \x3d line.lineHalfWidth;\nmediump float adjustedPatternHeight \x3d line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY \x3d fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX \x3d 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord \x3d mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly \x3e 0.5) {\ncolor.rgb \x3d vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist \x3d length(line.normal) * line.lineHalfWidth;\nlowp float alpha \x3d clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color \x3d getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a \x3d step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a \x3c 1.0 / 255.0) {\ndiscard;\n}\nout_color \x3d vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}",
"line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth \x3d 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth \x3d max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        \x3d 0.5 * u_antialiasing;\nfloat baseWidth \x3d getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth \x3d getLineHalfWidth(baseWidth, aa);\nfloat z         \x3d 2.0 * step(baseWidth, 0.0);\nvec2  dist      \x3d getDist(in_offset, halfWidth);\nvec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       \x3d u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     \x3d in_color;\nfloat opacity   \x3d 1.0;\n#else\nvec4  color     \x3d getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   \x3d getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH \x3d 15.5;\nfloat scaleDash \x3d getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio \x3d (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) \x26\x26 defined(PATTERN)\nv_sampleAlphaOnly \x3d getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos \x3d vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},
"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE \x3d\x3d SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;",
"hittest.glsl":"#include \x3cmaterials/hittest/common.glsl\x3e","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF \x3d (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /\x3d 2.0;\n#endif\nlowp float aa \x3d v_antialiasingWidth;\nlowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\n#include \x3cmaterials/text/hittest.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r \x3d getSize(referenceSize) / referenceSize;\nbaseSize *\x3d r;\noffset.xy *\x3d r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  \x3d a_aux.y;\nfloat a_referenceSize \x3d a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        \x3d a_aux.w;\nfloat a_fontSize      \x3d a_texFontSize.z;\nvec2  a_offset        \x3d a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        \x3d vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      \x3d getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     \x3d fontSize / SDF_FONT_SIZE;\nvec3  offset        \x3d getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix \x3d getBit(a_bitSet, 0) \x3d\x3d 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText \x3d 1.0 - a_isBackground;\nfloat isBackground \x3d u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  \x3d (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   \x3d u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity \x3d getOpacity();\nv_id      \x3d norm(a_id);\nv_tex     \x3d a_texCoords / u_mosaicSize;\nv_pos     \x3d u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden \x3d u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z +\x3d 2.0 * isHidden;\nv_edgeDistanceOffset \x3d u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  \x3d vec3(0.);\nv_color \x3d vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize \x3d 1.;\ngl_Position \x3d vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position \x3d  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset \x3d pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int highlightReasonsLength \x3d 3;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + highlightReasonsLength);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate \x3d getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r \x3d mod(rshift(u32, 0), 255.0);\nfloat g \x3d mod(rshift(u32, 8), 255.0);\nfloat b \x3d mod(rshift(u32, 16), 255.0);\nfloat a \x3d mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /\x3d 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a \x3d 12.9898;\nhighp float b \x3d 78.233;\nhighp float c \x3d 43758.5453;\nhighp float dt \x3d dot(co, vec2(a,b));\nhighp float sn \x3d mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/barycentric.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba \x3d getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   \x3d getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 \x3d getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result \x3d checkHighlightBit(filterFlags, 0);\nfor (int i \x3d 1; i \x3c highlightReasonsLength; i++) {\nresult \x3d result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z +\x3d 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\n#if !defined(highlight_all)\npos.z +\x3d 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\n#endif\npos.z +\x3d 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio \x3d (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale \x3c\x3d values[0]) {\noutSize \x3d sizes[0];\n} else {\nif (currentScale \x3e\x3d values[7]) {\noutSize \x3d sizes[7];\n} else {\nint index;\nindex \x3d -1;\nfor (int i \x3d 0; i \x3c 8; i++) {\nif (values[i] \x3e currentScale) {\nindex \x3d i;\nbreak;\n}\n}\nint prevIndex \x3d index - 1;\nfloat a \x3d currentScale - values[prevIndex];\nfloat b \x3d values[index] - values[prevIndex];\noutSize \x3d mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue \x3c\x3d values[0]) {\nreturn sizes[0];\n}\nfor (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\nif (values[i] \x3e\x3d sizeValue) {\nfloat f \x3d (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue \x3c\x3d opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\nif (opacityValues[i] \x3e\x3d opacityValue) {\nfloat f \x3d (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation \x3d rotationValue;\nif (rotationType \x3d\x3d 1.0) {\nrotation \x3d 90.0 - rotation;\n}\nfloat angle \x3d C_DEG_TO_RAD * -rotation;\nfloat sinA \x3d sin(angle);\nfloat cosA \x3d cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\nreturn fallback;\n}\nif (colorValue \x3c\x3d colorValues[0]) {\nreturn colors[0];\n}\nfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\nif (colorValues[i] \x3e\x3d colorValue) {\nfloat f \x3d (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize \x3d getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize \x3d getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},
overlay:{overlay:{"overlay.frag":"precision lowp float;\nuniform lowp sampler2D u_texture;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_texture, v_uv);\ngl_FragColor \x3d color *  u_opacity;\n}","overlay.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_perspective;\nvarying mediump vec2 v_uv;\nvoid main(void) {\nv_uv \x3d a_uv;\nfloat w \x3d 1.0 + dot(a_uv, u_perspective);\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0);\ngl_Position \x3d vec4(w * pos.xy, 0.0, w);\n}"}},
"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor \x3d texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor \x3d 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color \x3d u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor \x3d clamp(color, 0.0, 1.0);\n}"},
gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d float(SIGMA);\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel \x3d texture2D(u_texture, v_uv);\nvec3 luma \x3d vec3(0.299, 0.587, 0.114);\nfloat v \x3d dot(texel.xyz, luma);\nvec4 outputColor \x3d vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha \x3d smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor \x3d mix(outputColor, texel, alpha);\n}"}},
blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize \x3d 1.0 / u_texSize;\nfloat fSigma \x3d u_sigma;\nfloat weightSum \x3d gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum \x3d texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i \x3d 1; i \x3c KERNEL_RADIUS; i ++) {\nfloat x \x3d float(i);\nfloat w \x3d gaussianPdf(x, fSigma);\nvec2 uvOffset \x3d u_direction * invSize * x;\nvec4 sample1 \x3d texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 \x3d texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum +\x3d (sample1 + sample2) * w;\nweightSum +\x3d 2.0 * w;\n}\ngl_FragColor \x3d pixelColorSum /weightSum;\n}"},
"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist \x3d 1.0;\nconst float sampleStrength \x3d 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] \x3d -0.08;\nsamples[1] \x3d -0.05;\nsamples[2] \x3d -0.03;\nsamples[3] \x3d -0.02;\nsamples[4] \x3d -0.01;\nsamples[5] \x3d  0.01;\nsamples[6] \x3d  0.02;\nsamples[7] \x3d  0.03;\nsamples[8] \x3d  0.05;\nsamples[9] \x3d  0.08;\nvec2 dir \x3d 0.5 - v_uv;\nfloat dist \x3d sqrt(dir.x * dir.x + dir.y * dir.y);\ndir \x3d dir / dist;\nvec4 color \x3d texture2D(u_colorTexture,v_uv);\nvec4 sum \x3d color;\nfor (int i \x3d 0; i \x3c 10; i++) {\nsum +\x3d texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *\x3d 1.0 / 11.0;\nfloat t \x3d dist * sampleStrength;\nt \x3d clamp(t, 0.0, 1.0);\ngl_FragColor \x3d mix(color, sum, t);\n}"}},
dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor \x3d texture2D(u_minColor, vec2(0.5));\nvec4 maxColor \x3d texture2D(u_maxColor, vec2(0.5));\nvec4 color \x3d texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply \x3d minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply \x3d maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply \x3d color.rgb / color.a;\nvec3 range \x3d maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor \x3d vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}",
"min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel \x3d floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel \x3d vec2(1.0) / u_srcResolution;\nvec2 uv \x3d (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor \x3d vec4(1.0);\nvec4 maxColor \x3d vec4(0.0);\nfor (int y \x3d 0; y \x3c CELL_SIZE; ++y) {\nfor (int x \x3d 0; x \x3c CELL_SIZE; ++x) {\nvec2 offset \x3d uv + vec2(x, y) * onePixel;\nminColor \x3d min(minColor, texture2D(u_minTexture, offset));\nmaxColor \x3d max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] \x3d minColor;\ngl_FragData[1] \x3d maxColor;\n}"}},
"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset \x3d u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor \x3d texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor \x3d texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor \x3d ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},
"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 \x3d mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 \x3d mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 \x3d mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 \x3d mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 \x3d mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 \x3d mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 \x3d mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 \x3d mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 \x3d mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] \x3d g0,\nG[1] \x3d g1,\nG[2] \x3d g2,\nG[3] \x3d g3,\nG[4] \x3d g4,\nG[5] \x3d g5,\nG[6] \x3d g6,\nG[7] \x3d g7,\nG[8] \x3d g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 9; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nfloat M \x3d (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S \x3d (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor \x3d vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},
sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\ngl_FragColor \x3d vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},
"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel \x3d vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 \x3d mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 \x3d mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] \x3d g0;\nG[1] \x3d g1;\nfor (float i \x3d 0.0; i \x3c 3.0; i++) {\nfor (float j \x3d 0.0; j \x3c 3.0; j++) {\nsample \x3d texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] \x3d length(sample);\n}\n}\nfor (int i \x3d 0; i \x3c 2; i++) {\nfloat dp3 \x3d dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] \x3d dp3 * dp3;\n}\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\ngl_FragColor \x3d vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},
filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color \x3d texture2D(u_colorTexture, v_uv);\nvec4 rgbw \x3d u_coefficients * vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a \x3d color.a;\ngl_FragColor \x3d vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position \x3d vec4(a_position, 0.0, 1.0);\nv_uv \x3d (a_position + 1.0) / 2.0;\n}"}},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\nuniform lowp float u_opacity;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\nvec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\ngl_FragColor \x3d vec4(color.rgb * u_opacity, color.a * u_opacity);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include \x3craster/common/projection.glsl\x3e\n#endif\n#ifdef BICUBIC\n#include \x3cfiltering/bicubic.glsl\x3e\n#endif\n#ifdef BILINEAR\n#include \x3cfiltering/bilinear.glsl\x3e\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation \x3d projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color \x3d sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color \x3d sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color \x3d texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}",
"common.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform highp float u_scale;\nuniform highp vec2 u_offset;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos * u_scale + u_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}","contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\nvec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0;\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a);\n}\nvec3 rgb \x3d clamp(v.rgb / 255.0, 0.0, 1.0);\nreturn vec4(rgb, currentPixel.a);\n}",
"getSurfaceValues.glsl":"#include \x3craster/common/mirror.glsl\x3e\nvoid getSurfaceValues(sampler2D imageTexture, vec2 texCoord, vec2 srcImageSize, inout float values[10]) {\nvec2 onePixel \x3d 1.0 / srcImageSize;\nvec4 va \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, -1.0)));\nvec4 vb \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, -1.0)));\nvec4 vc \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, -1.0)));\nvec4 vd \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 0.0)));\nvec4 ve \x3d texture2D(imageTexture, mirror(texCoord));\nvec4 vf \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 0.0)));\nvec4 vg \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(-1.0, 1.0)));\nvec4 vh \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(0.0, 1.0)));\nvec4 vi \x3d texture2D(imageTexture, mirror(texCoord + onePixel * vec2(1.0, 1.0)));\nfloat alpha \x3d va.a * vb.a * vc.a * vd.a * ve.a * vf.a * vg.a * vh.a * vi.a;\nvalues[0] \x3d va.r;\nvalues[1] \x3d vb.r;\nvalues[2] \x3d vc.r;\nvalues[3] \x3d vd.r;\nvalues[4] \x3d ve.r;\nvalues[5] \x3d vf.r;\nvalues[6] \x3d vg.r;\nvalues[7] \x3d vh.r;\nvalues[8] \x3d vi.r;\nvalues[9] \x3d alpha;\n}",
"inverse.glsl":"float invertValue(float value) {\nfloat s \x3d sign(value);\nreturn (s * s) / (value + abs(s) - 1.0);\n}","mirror.glsl":"vec2 mirror(vec2 pos) {\nvec2 pos1 \x3d abs(pos);\nreturn step(pos1, vec2(1.0, 1.0)) * pos1 + step(1.0, pos1) * (2.0 - pos1);\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv \x3d texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},
flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff \x3d mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart \x3d clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist \x3e featheringStart) {\ncolor *\x3d 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",
imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled \x3d texture2D(u_texture, v_texcoord);\nfloat intensity \x3d getIntensity(sampled.r);\ngl_FragColor \x3d getColor(intensity);\ngl_FragColor.a *\x3d getOpacity(sampled.r);\ngl_FragColor.a *\x3d sampled.a;\ngl_FragColor.rgb *\x3d gl_FragColor.a;\n}",
"imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy \x3d (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_texcoord \x3d a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\nvoid main(void) {\ngl_FragColor \x3d getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}",
"particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/vv.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nvec2 position0 \x3d a_xyts0.xy;\nfloat t0 \x3d a_xyts0.z;\nfloat speed0 \x3d a_xyts0.w;\nvec2 position1 \x3d a_xyts1.xy;\nfloat t1 \x3d a_xyts1.z;\nfloat speed1 \x3d a_xyts1.w;\nfloat type \x3d a_typeIdDurationSeed.x;\nfloat id \x3d a_typeIdDurationSeed.y;\nfloat duration \x3d a_typeIdDurationSeed.z;\nfloat seed \x3d a_typeIdDurationSeed.w;\nvec2 e0 \x3d a_extrudeInfo.xy;\nvec2 e1 \x3d a_extrudeInfo.zw;\nfloat animationPeriod \x3d duration + u_trailLength;\nfloat scaledTime \x3d u_time * u_flowSpeed;\nfloat randomizedTime \x3d scaledTime + seed * animationPeriod;\nfloat t \x3d mod(randomizedTime, animationPeriod);\nfloat fUnclamped \x3d (t - t0) / (t1 - t0);\nfloat f \x3d clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime \x3d mix(t0, t1, f);\nfloat speed \x3d mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type \x3d\x3d 2.0) {\nif (fUnclamped \x3c 0.0 || (fUnclamped \x3e 1.0 \x26\x26 t1 !\x3d duration)) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho \x3d mix(e0, e1, f);\nvec2 parallel;\nparallel \x3d normalize(position1 - position0) * 0.5;\nif (id \x3d\x3d 1.0) {\nextrude \x3d ortho;\nv_texcoord \x3d vec2(0.5, 0.0);\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -ortho;\nv_texcoord \x3d vec2(0.5, 1.0);\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d ortho + parallel;\nv_texcoord \x3d vec2(1.0, 0.0);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -ortho + parallel;\nv_texcoord \x3d vec2(1.0, 1.0);\n}\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else {\nif (fUnclamped \x3c 0.0) {\ngl_Position \x3d vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id \x3d\x3d 1.0) {\nextrude \x3d e0;\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 2.0) {\nextrude \x3d -e0;\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-t0);\nv_size \x3d getSize(speed0);\nv_color \x3d getColor(speed0);\nv_color.a *\x3d getOpacity(speed0);\nposition \x3d position0;\n} else if (id \x3d\x3d 3.0) {\nextrude \x3d mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 0.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n} else if (id \x3d\x3d 4.0) {\nextrude \x3d -mix(e0, e1, f);\nv_texcoord \x3d vec2(0.5, 1.0);\nfadeOpacity \x3d getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity \x3d 1.0 - exp(-clampedTime);\nv_size \x3d getSize(speed);\nv_color \x3d getColor(speed);\nv_color.a *\x3d getOpacity(speed);\nposition \x3d mix(position0, position1, f);\n}\n}\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_color.a *\x3d fadeOpacity;\nv_color.a *\x3d mix(1.0, introOpacity, u_introFade);\nv_color.rgb *\x3d v_color.a;\n}"},
streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include \x3craster/flow/getFragmentColor.glsl\x3e\n#include \x3craster/flow/getFadeOpacity.glsl\x3e\nvoid main(void) {\nfloat t \x3d mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color \x3d v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *\x3d mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor \x3d getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}",
"streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include \x3craster/flow/vv.glsl\x3e\nvoid main(void) {\nvec4 lineColor \x3d getColor(a_speed);\nfloat lineOpacity \x3d getOpacity(a_speed);\nfloat lineSize \x3d getSize(a_speed);\nvec2 position \x3d a_positionAndSide.xy;\nv_side \x3d a_positionAndSide.z;\nvec2 xy \x3d (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position \x3d vec4(xy, 0.0, 1.0);\nv_time \x3d a_timeInfo.x;\nv_totalTime \x3d a_timeInfo.y;\nv_timeSeed \x3d a_timeInfo.z;\nv_color \x3d lineColor;\nv_color.a *\x3d lineOpacity;\nv_color.rgb *\x3d v_color.a;\nv_size \x3d lineSize;\n}"},
"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x) {\n#ifdef VV_COLOR\nvec4 color \x3d u_color_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_color_count) {\nbreak;\n}\nfloat x1 \x3d u_color_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_color_stops[i];\nvec4 y2 \x3d u_color_values[i];\nif (x \x3c x2) {\nvec4 y1 \x3d u_color_values[i - 1];\ncolor \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor \x3d y2;\n}\n}\n}\n#else\nvec4 color \x3d u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity \x3d u_opacity_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_opacity_count) {\nbreak;\n}\nfloat x1 \x3d u_opacity_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_opacity_stops[i];\nfloat y2 \x3d u_opacity_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_opacity_values[i - 1];\nopacity \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity \x3d y2;\n}\n}\n}\n#else\nfloat opacity \x3d u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size \x3d u_size_values[0];\n{\nfor (int i \x3d 1; i \x3c MAX_STOPS; i++) {\nif (i \x3e\x3d u_size_count) {\nbreak;\n}\nfloat x1 \x3d u_size_stops[i - 1];\nif (x \x3c x1) {\nbreak;\n}\nfloat x2 \x3d u_size_stops[i];\nfloat y2 \x3d u_size_values[i];\nif (x \x3c x2) {\nfloat y1 \x3d u_size_values[i - 1];\nsize \x3d y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize \x3d y2;\n}\n}\n}\n#else\nfloat size \x3d u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},
hillshade:{"hillshade.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform int u_hillshadeType;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform vec2 u_factor;\nuniform float u_minValue;\nuniform float u_maxValue;\n#include \x3craster/lut/colorize.glsl\x3e\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade) {\nval \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d colorize(vec4(val, val, val, 1.0), 255.0);\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv), 1.0) * rgb.a;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat pv[10];\ngetSurfaceValues(u_image, pixelLocation, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * u_factor.s;\nfloat dzy \x3d (pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * u_factor.t;\nfloat dzd \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;\nfloat z \x3d (u_cosZs[0] + cosDelta) / dzd;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n} else {\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / dzd;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d 5) break;\n}\n}\n#ifdef APPLY_COLORMAP\ngl_FragColor \x3d overlay(pv[4], u_minValue, u_maxValue, hillshade) * alpha * u_opacity;\n#else\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, 1.0) * alpha * u_opacity;\n#endif\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, float scaleFactor) {\nfloat clrIndex \x3d clamp(currentPixel.r * scaleFactor - u_colormapOffset, 0.0, u_colormapMaxIndex);\nvec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\nvec4 color \x3d texture2D(u_colormap, clrPosition);\nvec4 result \x3d vec4(color.rgb, color.a * currentPixel.a);\nreturn result;\n}","lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\nvec4 result \x3d colorize(currentPixel, 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * u_opacity;\n}"},
magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor \x3d v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle \x3d a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle \x3d 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset \x3d vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos \x3d a_pos + offset * sizePercentage * u_symbolSize;\nv_color \x3d u_colors[int(a_vv.x)];\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_position;\ngl_Position \x3d vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},
rfx:{aspect:{"aspect.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nconst float pi \x3d 3.14159265359;\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) / (8.0 * u_cellSize[0]);\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) / (8.0 * u_cellSize[1]);\nalpha *\x3d sign(abs(dzx) + abs(dzy));\nfloat aspect_rad \x3d (dzx \x3d\x3d 0.0) ? (step(0.0, dzy) * 0.5 * pi + step(dzy, 0.0) * 1.5 * pi) : mod((2.5 * pi + atan(dzy, -dzx)), 2.0 * pi);\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, 1.0) * alpha;\n}"},
bandarithmetic:{"bandarithmetic.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nuniform float u_adjustments[3];\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index;\n#ifdef NDXI\nindex \x3d (nir - red) * invertValue(nir + red);\n#elif defined(SR)\nindex \x3d nir * invertValue(red);\n#elif defined(CI)\nindex \x3d nir * invertValue(red) - 1.0;\n#elif defined(SAVI)\nindex \x3d (nir - red) * invertValue(nir + red + u_adjustments[0]) * (1.0 + u_adjustments[0]);\n#elif defined(TSAVI)\nfloat s \x3d u_adjustments[0];\nfloat a \x3d u_adjustments[1];\nfloat x \x3d u_adjustments[2];\nfloat y \x3d -a * s + x * (1.0 + s * s);\nindex \x3d (s * (nir - s * red - a)) * invertValue(a * nir + red + y);\n#elif defined(MSAVI)\nfloat nir2 \x3d 2.0 * nir + 1.0;\nindex \x3d 0.5 * (nir2 - sqrt(nir2 * nir2 - 8.0 * (nir - red)));\n#elif defined(GEMI)\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) * invertValue(nir + red + 0.5);\nindex \x3d eta * (1.0 - 0.25 * eta) - (red - 0.125) * invertValue(1.0 - red);\n#elif defined(PVI)\nfloat a \x3d u_adjustments[0];\nfloat b \x3d u_adjustments[1];\nfloat y \x3d sqrt(1.0 + a * a);\nindex \x3d (nir - a * red - b) * invertValue(y);\n#elif defined(VARI)\nindex \x3d (pv2.g - pv2.r) * invertValue(pv2.g + pv2.r - pv2.b);\n#elif defined(MTVI)\nfloat green \x3d pv2.b;\nfloat v \x3d sqrt(pow((2.0 * nir + 1.0), 2.0) - (6.0 * nir - 5.0 * sqrt(red)) - 0.5);\nindex \x3d 1.5 * (1.2 * (nir - green) - 2.5 * (red - green)) * invertValue(v);\n#elif defined(RTVICORE)\nfloat green \x3d pv2.b;\nindex \x3d 100.0 * (nir - red) - 10.0 * (nir - green);\n#elif defined(EVI)\nfloat blue \x3d pv2.b;\nfloat denom \x3d nir + 6.0 * red - 7.5 * blue + 1.0;\nindex \x3d  (2.5 * (nir - red)) * invertValue(denom);\n#elif defined(WNDWI)\nfloat g \x3d pv2.r;\nfloat n \x3d pv2.g;\nfloat s \x3d pv2.s;\nfloat a \x3d u_adjustments[0];\nfloat denom \x3d g + a * n + (1.0 - a) * s;\nindex \x3d (g - a * n - (1 - a) * s) * invertValue(denom);\n#elif defined(BAI)\nindex \x3d invertValue(pow((0.1 - red), 2.0) + pow((0.06 - nir), 2.0));\n#else\ngl_FragColor \x3d pv;\nreturn;\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
compositeband:{"compositeband.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\nfloat alpha \x3d pv0.a;\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\nalpha *\x3d pv1.a;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\nalpha \x3d alpha * pv1.a * pv2.a;\n#endif\ngl_FragColor \x3d vec4(a, b, c, alpha);\n}"},
contrast:{"contrast.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#include \x3craster/common/contrastBrightness.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec4 result \x3d adjustContrastBrightness(pv, false) ;\ngl_FragColor \x3d vec4(result.rgb * 255.0, result.a);\n}"},convolution:{"convolution.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\nuniform float u_kernel[25];\n#include \x3craster/common/mirror.glsl\x3e\nvoid main() {\nvec3 rgb \x3d vec3(0.0, 0.0, 0.0);\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat alpha \x3d 1.0;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\nrgb +\x3d pv.rgb * u_kernel[row * KERNEL_SIZE_COLS + col];\nalpha *\x3d pv.a;\n}\n}\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
curvature:{"curvature.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform float u_zlFactor;\nuniform vec2 u_srcImageSize;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat d \x3d ((pv[3] + pv[5]) * 0.5 - pv[4]);\nfloat e \x3d ((pv[1] + pv[7]) * 0.5 - pv[4]);\nfloat curvature \x3d 0.0;\n#ifdef STANDARD\ncurvature \x3d -u_zlFactor * (d + e);\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n#else\nfloat f \x3d (-pv[0] + pv[2] + pv[6] - pv[8]) / 4.0;\nfloat g \x3d (-pv[3] + pv[5]) / 2.0;\nfloat h \x3d (pv[1] - pv[7]) / 2.0;\nfloat g2 \x3d g * g;\nfloat h2 \x3d h * h;\n#ifdef PROFILE\ncurvature \x3d (u_zlFactor * (d * g2 + e * h2 + f * g * h)) / (g2 + h2);\n#else\ncurvature \x3d (-u_zlFactor * (d * h2 + e * g2 - f * g * h)) / (g2 + h2);\n#endif\n#endif\ngl_FragColor \x3d vec4(curvature, curvature, curvature, alpha);\n}"},
extractband:{"extractband.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\ngl_FragColor \x3d vec4(pv2, pv.a);\n}"},focalstatistics:{"focalstatistics.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_srcImageSize;\n#define KERNEL_SIZE_ROWS ROWS\n#define KERNEL_SIZE_COLS COLS\nuniform vec2 u_clampRange;\n#include \x3craster/common/mirror.glsl\x3e\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec2 resolution \x3d 1.0 / u_srcImageSize;\nfloat rowOffset \x3d -float(floor(float(KERNEL_SIZE_ROWS) / 2.0));\nfloat colOffset \x3d -float(floor(float(KERNEL_SIZE_COLS) / 2.0));\nfloat count \x3d 0.0;\n#ifdef STDDEV\nvec3 sum \x3d vec3(0.0, 0.0, 0.0);\nvec3 sum2 \x3d vec3(0.0, 0.0, 0.0);\n#endif\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nvec3 rgb \x3d currentPixel.rgb;\nfor (int row \x3d 0; row \x3c KERNEL_SIZE_ROWS; row++) {\nfloat pos_row \x3d rowOffset + float(row);\nfor (int col \x3d 0; col \x3c KERNEL_SIZE_COLS; col++) {\nvec2 pos \x3d v_texcoord + vec2(colOffset + float(col), pos_row) * resolution;\nvec4 pv \x3d texture2D(u_image, mirror(pos));\ncount +\x3d pv.a;\n#ifdef MIN\nrgb \x3d min(rgb, pv.rgb);\n#elif defined(MAX)\nrgb \x3d max(rgb, pv.rgb);\n#elif defined(MEAN)\nrgb +\x3d pv.rgb;\n#elif defined(STDDEV)\nsum +\x3d pv.rgb;\nsum2 +\x3d (pv.rgb * pv.rgb);\n#endif\n}\n}\n#ifdef MEAN\nrgb *\x3d invertValue(count);\n#elif defined(STDDEV)\nrgb \x3d sqrt((sum2 - sum * sum * invertValue(count)) * invertValue(count));\n#endif\nfloat alpha \x3d step(0.9999, count);\nrgb \x3d clamp(rgb, u_clampRange.s, u_clampRange.t);\n#ifdef FILL\nrgb \x3d (1.0 - currentPixel.a) * rgb + currentPixel.a * currentPixel.rgb;\n#endif\ngl_FragColor \x3d vec4(rgb * alpha, alpha);\n}"},
grayscale:{"grayscale.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec3 u_weights;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat value \x3d dot(u_weights, pv.rgb);\ngl_FragColor \x3d vec4(value, value, value, pv.a);\n}"},local:{"local.frag":"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\n#ifdef ONE_CONSTANT\nuniform float u_image1Const;\n#ifdef TWO_CONSTANT\nuniform float u_image2Const;\n#endif\nuniform mat3 u_imageSwap;\n#endif\nvarying vec2 v_texcoord;\nuniform vec2 u_domainRange;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv0 \x3d texture2D(u_image, v_texcoord);\nfloat a \x3d pv0.r;\n#ifdef TWO_IMAGES\n#ifdef ONE_CONSTANT\nfloat b \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, 0);\na \x3d abc.s;\nb \x3d abc.t;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\n#endif\n#elif defined(CONDITIONAL)\n#ifdef TWO_CONSTANT\nfloat b \x3d u_image1Const;\nfloat c \x3d u_image2Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#elif defined(ONE_CONSTANT)\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d u_image1Const;\nvec3 abc \x3d u_imageSwap * vec3(a, b, c);\na \x3d abc.s;\nb \x3d abc.t;\nc \x3d abc.p;\n#else\nvec4 pv1 \x3d texture2D(u_image1, v_texcoord);\nvec4 pv2 \x3d texture2D(u_image2, v_texcoord);\nfloat b \x3d pv1.r;\nfloat c \x3d pv2.r;\n#endif\n#endif\nfloat result \x3d a;\nfloat alpha \x3d pv0.a;\n#ifdef PLUS\nresult \x3d a + b;\n#elif defined(MINUS)\nresult \x3d a - b;\n#elif defined(TIMES)\nresult \x3d a * b;\n#elif defined(DIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOATDIVIDE)\nresult \x3d a * invertValue(b);\nalpha *\x3d float(abs(sign(b)));\n#elif defined(FLOORDIVIDE)\nresult \x3d floor(a * invertValue(b));\nalpha *\x3d float(abs(sign(b)));\n#elif defined(SQUARE)\nresult \x3d a * a;\n#elif defined(SQRT)\nresult \x3d sqrt(a);\n#elif defined(POWER)\nresult \x3d pow(a, b);\n#elif defined(LN)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_1_0)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a) * invertValue(log2(10.0));\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(LOG_2)\nresult \x3d a \x3c\x3d 0.0 ? 0.0: log2(a);\nalpha *\x3d float(a \x3e 0.0);\n#elif defined(EXP)\nresult \x3d exp(a);\n#elif defined(EXP_1_0)\nresult \x3d pow(10.0, a);\n#elif defined(EXP_2)\nresult \x3d pow(2.0, a);\n#elif defined(ROUNDDOWN)\nresult \x3d floor(a);\n#elif defined(ROUNDUP)\nresult \x3d ceil(a);\n#elif defined(INT)\nresult \x3d float(sign(a)) * floor(abs(a));\n#elif defined(MOD)\nresult \x3d mod(a, b);\n#elif defined(NEGATE)\nresult \x3d -a;\n#elif defined(ABS)\nresult \x3d abs(a);\n#elif defined(ACOS)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: acos(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ACOSH)\nresult \x3d acosh(a);\n#elif defined(ASIN)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: asin(a);\nalpha *\x3d step(abs(a), 1.00001);\n#elif defined(ASINH)\nresult \x3d asinh(a);\n#elif defined(ATAN)\nresult \x3d atan(a);\n#elif defined(ATANH)\nresult \x3d abs(a) \x3e 1.0 ? 0.0: atanh(a);\nalpha *\x3d step(abs(a), 1.0);\n#elif defined(ATAN_2)\nresult \x3d atan(a, b);\n#elif defined(COS)\nresult \x3d cos(a);\n#elif defined(COSH)\nresult \x3d cosh(a);\n#elif defined(SIN)\nresult \x3d sin(a);\n#elif defined(SINH)\nresult \x3d sinh(a);\n#elif defined(TAN)\nresult \x3d tan(a);\n#elif defined(TANH)\nresult \x3d tanh(a);\n#elif defined(BITWISEAND)\nresult \x3d a \x26 b;\n#elif defined(BITWISEOR)\nresult \x3d a | b;\n#elif defined(BITWISELEFTSHIFT)\nresult \x3d a \x3c\x3c b;\n#elif defined(BITWISERIGHTSHIFT)\nresult \x3d a \x3e\x3e b;\n#elif defined(BITWISENOT)\nresult \x3d ~a;\n#elif defined(BITWISEXOR)\nresult \x3d a ^ b;\n#elif defined(BOOLEANAND)\nresult \x3d float((a !\x3d 0.0) \x26\x26 (b !\x3d 0.0));\n#elif defined(BOOLEANNOT)\nresult \x3d float(a \x3d\x3d 0.0);\n#elif defined(BOOLEANOR)\nresult \x3d float((a !\x3d 0.0) || (b !\x3d 0.0));\n#elif defined(BOOLEANXOR)\nresult \x3d float((a !\x3d 0.0) ^^ (b !\x3d 0.0));\n#elif defined(GREATERTHAN)\nresult \x3d float(a \x3e b);\n#elif defined(GREATERTHANEQUAL)\nresult \x3d float(a \x3e\x3d b);\n#elif defined(LESSTHAN)\nresult \x3d float(a \x3c b);\n#elif defined(LESSTHANEQUAL)\nresult \x3d float(a \x3c\x3d b);\n#elif defined(EQUALTO)\nresult \x3d float(a \x3d\x3d b);\n#elif defined(NOTEQUAL)\nresult \x3d float(a !\x3d b);\n#elif defined(ISNULL)\nresult \x3d float(alpha \x3d\x3d 0.0);\nalpha \x3d 1.0;\n#elif defined(SETNULL)\nfloat maskValue \x3d float(a \x3d\x3d 0.0);\nresult \x3d maskValue * b;\nalpha *\x3d maskValue;\n#elif defined(CONDITIONAL)\nfloat weight \x3d float(abs(sign(a)));\nresult \x3d weight * b + (1.0 - weight) * c;\n#endif\nbool isInvalid \x3d result \x3c u_domainRange.s || result \x3e u_domainRange.t;\nresult \x3d isInvalid ? 0.0 : result;\nalpha *\x3d float(!isInvalid);\n#ifdef ROUND_OUTPUT\nresult \x3d floor(result + 0.5);\n#endif\ngl_FragColor \x3d vec4(result, result, result, alpha);\n}"},
mask:{"mask.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_INCLUDED_RANGES 6\n#define LEN_NODATA_VALUES 6\nuniform highp float u_includedRanges[6];\nuniform highp float u_noDataValues[6];\nfloat maskFactor(float bandValue, float fromValue, float to) {\nfloat factor \x3d 1.0;\nfor (int i \x3d 0; i \x3c LEN_NODATA_VALUES; i++) {\nfactor *\x3d float(u_noDataValues[i] !\x3d bandValue);\n}\nfactor *\x3d step(fromValue, bandValue) * step(bandValue, to);\nreturn factor;\n}\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat redFactor \x3d maskFactor(pv.r, u_includedRanges[0], u_includedRanges[1]);\n#ifdef MULTI_BAND\nfloat greenFactor \x3d maskFactor(pv.g, u_includedRanges[2], u_includedRanges[3]);\nfloat blueFactor \x3d maskFactor(pv.b, u_includedRanges[4], u_includedRanges[5]);\nfloat maskFactor \x3d redFactor * greenFactor * blueFactor;\ngl_FragColor \x3d pv * maskFactor;\n#else\ngl_FragColor \x3d pv * redFactor;\n#endif\n}"},
ndvi:{"ndvi.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform mediump mat3 u_bandIndexMat3;\n#include \x3craster/common/inverse.glsl\x3e\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nvec3 pv2 \x3d u_bandIndexMat3 * pv.rgb;\nfloat nir \x3d pv2.r;\nfloat red \x3d pv2.g;\nfloat index \x3d (nir - red) * invertValue(nir + red);\n#ifdef SCALED\nindex \x3d floor((index + 1.0) * 100.0 + 0.5);\n#endif\ngl_FragColor \x3d vec4(index, index, index, pv.a);\n}"},
remap:{"remap.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\n#define LEN_REMAP_RANGES 18\n#define LEN_NODATA_RANGES 12\nuniform highp float u_rangeMaps[18];\nuniform highp float u_noDataRanges[12];\nuniform highp float u_unmatchMask;\nuniform vec2 u_clampRange;\nvoid main() {\nvec4 pv \x3d texture2D(u_image, v_texcoord);\nfloat factor \x3d 1.0;\nfloat bandValue \x3d pv.r;\nfor (int i \x3d 0; i \x3c LEN_NODATA_RANGES; i+\x3d2) {\nfloat inside \x3d 1.0 - step(u_noDataRanges[i], bandValue) * step(bandValue, u_noDataRanges[i+1]);\nfactor *\x3d inside;\n}\nfloat mapValue \x3d 0.0;\nfloat includeMask \x3d 0.0;\nfor (int i \x3d 0; i \x3c LEN_REMAP_RANGES; i+\x3d3) {\nfloat stepMask \x3d step(u_rangeMaps[i], bandValue) * step(bandValue, u_rangeMaps[i+1]);\nincludeMask \x3d (1.0 - stepMask) * includeMask + stepMask;\nmapValue \x3d (1.0 - stepMask) * mapValue + stepMask * u_rangeMaps[i+2];\n}\nbandValue \x3d factor * (mapValue + (1.0 - includeMask) * u_unmatchMask * pv.r);\nfloat bandMask \x3d factor * max(u_unmatchMask, includeMask);\nbandValue \x3d clamp(bandValue, u_clampRange.s, u_clampRange.t);\ngl_FragColor \x3d vec4(bandValue, bandValue, bandValue, bandMask * pv.a);\n}"},
slope:{"slope.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texcoord;\nuniform vec2 u_cellSize;\nuniform float u_zFactor;\nuniform vec2 u_srcImageSize;\nuniform float u_pixelSizePower;\nuniform float u_pixelSizeFactor;\n#include \x3craster/common/getSurfaceValues.glsl\x3e\nvoid main() {\nfloat pv[10];\ngetSurfaceValues(u_image, v_texcoord, u_srcImageSize, pv);\nfloat alpha \x3d pv[9];\nfloat xf \x3d (u_zFactor + pow(u_cellSize[0], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[0]);\nfloat yf \x3d (u_zFactor + pow(u_cellSize[1], u_pixelSizePower) * u_pixelSizeFactor) / (8.0 * u_cellSize[1]);\nfloat dzx \x3d (pv[2] + 2.0 * pv[5] + pv[8] - pv[0] - 2.0 * pv[3] - pv[6]) * xf;\nfloat dzy \x3d -(pv[6] + 2.0 * pv[7] + pv[8] - pv[0] - 2.0 * pv[1] - pv[2]) * yf;\nfloat rise2run \x3d sqrt(dzx * dzx + dzy * dzy);\n#ifdef PERCENT_RISE\nfloat percentRise \x3d rise2run * 100.0;\ngl_FragColor \x3d vec4(percentRise, percentRise, percentRise, alpha);\n#else\nfloat degree \x3d atan(rise2run) * 57.2957795;\ngl_FragColor \x3d vec4(degree, degree, degree, alpha);\n#endif\n}"},
stretch:{"stretch.frag":"precision mediump float;\nuniform sampler2D u_image;\nvarying highp vec2 v_texcoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection) {\nval \x3d clamp(val, minCutOff, maxCutOff);\nfloat stretchedVal;\n#ifdef USE_GAMMA\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\ntempf -\x3d step(1.0, gamma) * sign(gamma - 1.0) * pow(1.0 / outRange, relativeVal * gammaCorrection);\nstretchedVal \x3d tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput;\nstretchedVal \x3d clamp(stretchedVal, minOutput, maxOutput);\n#else\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n#endif\n#ifdef ROUND_OUTPUT\nstretchedVal \x3d floor(stretchedVal + 0.5);\n#endif\nreturn stretchedVal;\n}\nvoid main() {\nvec4 currentPixel \x3d texture2D(u_image, v_texcoord);\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_gamma[0], u_gammaCorrection[0]);\n#ifdef MULTI_BAND\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n#else\ngl_FragColor \x3d vec4(redVal, redVal, redVal, currentPixel.a);\n#endif\n}"},
vs:{"vs.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord \x3d a_pos;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor \x3d vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize \x3d 0.02;\nconst float innerRadius \x3d 0.25;\nconst float outerRadius \x3d 0.42;\nconst float innerSquareLength \x3d 0.15;\nvoid main() {\nmediump float dist \x3d length(v_pos);\nmediump float fillalpha1 \x3d smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *\x3d (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 \x3d smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *\x3d (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 \x3d (abs(v_pos.x) \x3c innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) \x3c innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor \x3d (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}",
"scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage \x3d clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio \x3d u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage \x3d clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage \x3d (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size \x3d u_symbolSize * sizePercentage;\nvec2 pos \x3d a_pos + a_offset * size;\nv_pos \x3d a_offset;\ngl_Position \x3d vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\nif (val \x3e\x3d maxCutOff) {\nreturn maxOutput;\n} else if (val \x3c\x3d minCutOff) {\nreturn minOutput;\n}\nfloat stretchedVal;\nif (useGamma) {\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;\n} else {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n}\nreturn stretchedVal;\n}\nvoid main() {\nvec2 pixelLocation \x3d getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel \x3d getPixel(pixelLocation);\n#ifdef NOOP\ngl_FragColor \x3d vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\nreturn;\n#endif\nif (u_bandCount \x3d\x3d 1) {\nfloat grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n#ifdef APPLY_COLORMAP\nvec4 result \x3d colorize(vec4(grayVal, grayVal, grayVal, 1.0), u_useGamma ? 255.0 : 1.0);\ngl_FragColor \x3d vec4(result.xyz, 1.0) * result.a * currentPixel.a * u_opacity;\n#else\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;\n#endif\n} else {\nfloat redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\nfloat greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\nfloat blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;\n}\n}"}},
stencil:{"stencil.frag":"void main() {\ngl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position \x3d vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include \x3ctest/TestShader.common.glsl\x3e\nvoid main() {\nif (v_offset.x \x3e -.5 \x26\x26 v_offset.y \x3e -.5 \x26\x26 v_offset.x \x3c .5 \x26\x26 v_offset.y \x3c .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor \x3d vec4(1., 0., 0., 1.);\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"TestShader.vert":"const float POS_PRECISION_FACTOR \x3d 10.;\nconst float OFFSET_PRECISION_FACTOR \x3d 10.;\nconst float SIZE_PRECISION_FACTOR \x3d 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] \x3d float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include \x3ctest/TestShader.common.glsl\x3e\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index \x3d -1;\nfor (int i \x3d 0; i \x3c 4; i++) {\nif (u_dataDrivenColor_validValues[i] \x3d\x3d value) {\nindex \x3d i;\nbreak;\n}\n}\nif (index \x3d\x3d -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos \x3d a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset \x3d a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size \x3d a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color \x3d vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor \x3d getColor(1.);\n#endif\nvec2 offsetScaled \x3d a_offset * a_size;\nvec4 pos \x3d vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position \x3d pos;\n#ifndef RETURN_RED\nv_color \x3d color;\n#endif\nv_offset \x3d a_offset;\n}"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color \x3d texture2D(u_texture, v_tex);\ncolor.rgb *\x3d color.a;\ngl_FragColor \x3d color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\ngl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\nv_tex \x3d a_pos;\n}"},
util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 \x3d abs(x);\nt1 \x3d abs(y);\nt0 \x3d max(t3, t1);\nt1 \x3d min(t3, t1);\nt3 \x3d 1.0 / t0;\nt3 \x3d t1 * t3;\nt4 \x3d t3 * t3;\nt0 \x3d         - 0.013480470;\nt0 \x3d t0 * t4 + 0.057477314;\nt0 \x3d t0 * t4 - 0.121239071;\nt0 \x3d t0 * t4 + 0.195635925;\nt0 \x3d t0 * t4 - 0.332994597;\nt0 \x3d t0 * t4 + 0.999995630;\nt3 \x3d t0 * t3;\nt3 \x3d (abs(y) \x3e abs(x)) ? 1.570796327 - t3 : t3;\nt3 \x3d x \x3c 0.0 ?  3.141592654 - t3 : t3;\nt3 \x3d y \x3c 0.0 ? -t3 : t3;\nreturn t3;\n}",
"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/BrushOverlay":function(){define(["../definitions","../Utils","./WGLBrush","../../../../webgl/enums"],function(e,g,p,h){class k extends p{constructor(){super(...arguments);this._desc={vsPath:"overlay/overlay",
fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])}}dispose(){}prepareState({context:n}){n.setBlendingEnabled(!0);n.setColorMask(!0,!0,!0,!0);n.setBlendFunctionSeparate(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);n.setStencilWriteMask(0);n.setStencilTestEnabled(!0);n.setStencilFunction(h.CompareFunction.GREATER,255,255)}draw(n,d){const {context:b,painter:a,requestRender:c,allowDelayedRender:q}=n;if(d.isReady){var {computedOpacity:f,
dvsMat3:t,isWrapAround:m,perspectiveTransform:l,texture:u}=d;n.timeline.begin(this.name);var v=a.materialManager.getProgram(this._desc);if(q&&null!=c&&!v.compiled)c();else{var r=g.createProgramDescriptor("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:h.DataType.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:h.DataType.UNSIGNED_SHORT}]});if(d=d.getVAO(b,r.bufferLayouts,r.attributes))b.bindVAO(d),b.useProgram(v),b.bindTexture(u,e.textureBindingBitmap),v.setUniformMatrix3fv("u_dvsMat3",
t),v.setUniform1i("u_texture",e.textureBindingBitmap),v.setUniform1f("u_opacity",f),v.setUniform2fv("u_perspective",l),b.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,m?10:4),b.bindVAO(),n.timeline.end(this.name)}}}}return k})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b){class a extends p{constructor(){super(...arguments);this._color=e.fromValues(1,0,0,1);this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:c}){c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(n.StencilOperation.KEEP,
n.StencilOperation.KEEP,n.StencilOperation.REPLACE);c.setStencilWriteMask(255)}draw(c,q){const {context:f,requestRender:t,allowDelayedRender:m}=c;this._initialized||this._initialize(f);m&&null!=t&&!this._solidProgram.compiled?t():(f.setStencilFunctionSeparate(n.Face.FRONT_AND_BACK,n.CompareFunction.GREATER,q.stencilRef,255),f.bindVAO(this._solidVertexArrayObject),f.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",q.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",
[q.rangeX,q.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),f.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4),f.bindVAO())}_initialize(c){if(this._initialized)return!0;const q=d.createProgram(c,h.background);if(!q)return!1;var f=new Int8Array([0,0,1,0,0,1,1,1]);f=k.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,f);c=new b.VertexArrayObject(c,h.background.attributes,g.Pos2b,{geometry:f});this._solidProgram=q;this._solidVertexArrayObject=
c;return this._initialized=!0}}return a})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(e,g,p){const h={geometry:[new p.VertexElementDescriptor("a_pos",2,g.DataType.BYTE,0,2)]},k={geometry:[new p.VertexElementDescriptor("a_pos",2,g.DataType.BYTE,0,4),new p.VertexElementDescriptor("a_tex",2,g.DataType.BYTE,2,4)]};g={geometry:[new p.VertexElementDescriptor("a_pos",2,g.DataType.UNSIGNED_SHORT,
0,4)]};e.Pos2b=h;e.Pos2us=g;e.PosTex2b=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushTileDebugInfo":function(){define("../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../DefaultVertexAttributeLayouts ../FeatureTile ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/ProgramTemplate ../../../../webgl/Texture ../../../../webgl/TextureDescriptor ../../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f){class t extends h{constructor(){super(...arguments);this._color=e.fromValues(1,0,0,1)}dispose(){this._outlineProgram?.dispose();this._outlineProgram=null;this._tileInfoProgram?.dispose();this._tileInfoProgram=null;this._outlineVertexArrayObject?.dispose();this._outlineVertexArrayObject=null;this._tileInfoVertexArrayObject?.dispose();this._ctx=this._tileInfoVertexArrayObject=null}prepareState({context:m}){m.setBlendingEnabled(!0);m.setBlendFunctionSeparate(b.BlendFactor.ONE,
b.BlendFactor.ONE_MINUS_SRC_ALPHA,b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA);m.setColorMask(!0,!0,!0,!0);m.setStencilWriteMask(0);m.setStencilTestEnabled(!1)}draw(m,l){const {context:u,requestRender:v,allowDelayedRender:r}=m;if(!(!l.isReady&&l instanceof p.FeatureTile&&l.hasData))if(this._loadWGLResources(u),!r||null==v||this._outlineProgram.compiled&&this._tileInfoProgram.compiled){u.bindVAO(this._outlineVertexArrayObject);u.useProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",
l.transforms.displayViewScreenMat3);this._outlineProgram.setUniform2f("u_coord_range",l.rangeX,l.rangeY);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);u.drawArrays(b.PrimitiveType.LINE_STRIP,0,4);if(m=this._getTexture(u,l))u.bindVAO(this._tileInfoVertexArrayObject),u.useProgram(this._tileInfoProgram),u.bindTexture(m,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",l.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",
0),this._tileInfoProgram.setUniform2f("u_coord_ratio",l.rangeX/l.width,l.rangeY/l.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",m.descriptor.width,m.descriptor.height),u.drawArrays(b.PrimitiveType.TRIANGLE_STRIP,0,4);u.bindVAO()}else v()}_loadWGLResources(m){if(!this._outlineProgram||!this._tileInfoProgram){var l=a.createProgram(m,k.background),u=a.createProgram(m,n.tileInfo),v=new Int8Array([0,0,1,0,1,1,0,1]);v=d.BufferObject.createVertex(m,
b.Usage.STATIC_DRAW,v);v=new f.VertexArrayObject(m,k.background.attributes,g.Pos2b,{geometry:v});var r=new Int8Array([0,0,1,0,0,1,1,1]);r=d.BufferObject.createVertex(m,b.Usage.STATIC_DRAW,r);m=new f.VertexArrayObject(m,n.tileInfo.attributes,g.Pos2b,{geometry:r});this._outlineProgram=l;this._tileInfoProgram=u;this._outlineVertexArrayObject=v;this._tileInfoVertexArrayObject=m}}_getTexture(m,l){if(!this._ctx){var u=document.createElement("canvas");u.width=512;u.height=512;this._ctx=u.getContext("2d")}l.tileDebugInfoTexture||
(u=new q.TextureDescriptor,u.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE,u.samplingMode=b.TextureSamplingMode.LINEAR,u.isImmutable=!0,u.width=512,u.height=512,l.tileDebugInfoTexture=new c.Texture(m,u));m=this._ctx;m.clearRect(0,0,m.canvas.width,m.canvas.height);m.textAlign="left";m.textBaseline="top";m.font="14px sans-serif";m.lineWidth=2;m.fillStyle="white";m.strokeStyle="black";var {debugSlot:v}=l;u=8+99.2*v;v=`${v}) ${l.key.id} (${l.constructor.name})`;m.strokeText(v,8,u);m.fillText(v,8,u);u+=16;
({debugInfo:v}=l);if(v){const {length:y,minOrderedLength:x,minUnorderedLength:w,triangleCount:A}=v.display;if(0<y){var r=`Length: ${y}`;m.strokeText(r,8,u);m.fillText(r,8,u);u+=16}x&&(r=`Min ordered length: ${x}`,m.strokeText(r,8,u),m.fillText(r,8,u),u+=16);w&&(r=`Min unordered length: ${w}`,m.strokeText(r,8,u),m.fillText(r,8,u),u+=16);0<A&&(1E5<A&&(m.fillStyle="red",m.strokeStyle="white"),r=`Triangle count: ${A}`,m.strokeText(r,8,u),m.fillText(r,8,u),u+=16);const {bytesUsed:z,bytesReserved:C}=v.memory;
m.fillStyle="white";m.strokeStyle="black";if(0<z||0<C)v=`Memory usage: ${z} of ${C} bytes`,m.strokeText(v,8,u),m.fillText(v,8,u),u+=16}l.tileDebugInfoTexture.setData(m.canvas);return l.tileDebugInfoTexture}}return t})},"esri/views/2d/engine/webgl/FeatureTile":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/mat2df32 ./AFeatureTile ./definitions ./DisplayEntity ./enums ./FeatureDisplayList ./ReshufflePlan ./collisions/LabelMetric ./cpuMapped/MappedMesh ./mesh/meshDebugUtils ./util/Reader ./util/serializationUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){let u=0;class v extends k.AFeatureTile{constructor(r,y,x,w,A=!1){super(r,y,x,w);this._meshes=new Map;this._entities=[];this._nextUploadAllowed=this._invalidated=!1;this.tileAge=u++;this._metrics=[];this._entityIds=new Set;this._entityIdsFromBuffer=new Set;this._attributeEpoch=0;this._encounteredEnd=!1;this.visible=!0;this.transforms.labelMat2d=h.create();this.enableDeferredUploads=A}destroy(){super.destroy();this.clear()}clear(){for(const r of this._meshes.values())r.destroy();
this._meshes.clear();this._entities=[];this._metrics=[];this._displayList=null;this._invalidated=!0;this._entityIds.clear();this._nextUploadAllowed=!0}beforeRender(r){super.beforeRender(r);this._needsReshuffle&&r.reshuffleManager.schedule(this)}tryReady(r){const y=this._invalidated&&!this._uploadAllowed;return!this._isReady&&!y&&this._encounteredEnd&&r>=this._attributeEpoch?(g("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${r}]`),this.ready(),this.requestRender(),
!0):!1}get labelMetrics(){return this._metrics}get hasData(){return!!this._meshes.size}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}upload(){this._nextUploadAllowed=!0}getDisplayList(r,y,x=b.FeatureBatchingStrategy.BATCHING){if(this._uploadAllowed&&this._invalidated){this._entities.sort((w,A)=>{const z=A.sortKey,C=w.sortKey;return C===z?w.id-A.id:C-z});x===b.FeatureBatchingStrategy.BATCHING&&this.reshuffle(!0);this._displayList=
a.DisplayList.fromDisplayEntities(this._entities,this,y,x);for(const w of this._meshes.values())w.upload();this.debugInfo.display.length=this._displayList.length;this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength;this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength;this.requestRender();this._nextUploadAllowed=this._invalidated=!1}return this._displayList}getMesh(r){if(!this._meshes.has(r))throw Error(`InternalError: Unable to find VAO for instance: ${r}`);
return this._meshes.get(r)}getSortKeys(r){const y=new Map;for(const {id:x,sortKey:w}of this._entities)if(r.has(x)&&y.set(x,w),y.size===r.size)break;return y}onMessage(r){switch(r.type){case "append":this._onAppendMessage(r);break;case "update":this._onUpdateMessage(r)}this._aggregateMemoryStats();this.requestRender();if(r.end){g("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${r.attributeEpoch}]`);if(!r.attributeEpoch)throw Error("InternalError: Attribute epoch not defined.");
this._attributeEpoch=r.attributeEpoch;this._encounteredEnd=!0}}_onAppendMessage(r){g("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:t.debugMeshDataInfo(r?.append)});r.clear&&this.clear();if(r.append){var y=l.deserializeList(new m(r.append.entities),d);this._insert(y,r.append.data,!1)}}_onUpdateMessage(r){g("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:r.isPixelBuffer,modify:t.debugMeshDataInfo(r.modify),remove:r.remove});
const y=l.deserializeList(new m(r.modify.entities),d);var x=y.map(A=>A.id);const w=r.isPixelBuffer??!1;x=[...r.remove,...x];w?this._removeByIdsFromBuffer(x):this._removeByIds(x);this._insert(y,r.modify.data,w)}reshuffle(r=!1){if(!this.destroyed){var y=new Map;for(const x of this._entities)for(const w of x.records){const A=this._meshes.get(w.instanceId);let z=y.get(A);z||(z=new c.ReshufflePlan(r),y.set(A,z));z.copyRecord(w)}for(const [x,w]of y)x.reshuffle(w);this._invalidated=!0;this._aggregateMemoryStats();
g("esri-2d-update-debug")&&p.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}}copyPixelBufferedEntitesFrom(r,y,x,w){x*=n.tileSize;w*=n.tileSize;for(const z of r._entities){let C=null;for(const D of z.records)if(D.overlaps&y){var A=this._ensureMesh(D.instanceId);const F=r.getMesh(D.instanceId);A=A.copyRecordFrom(F,D,x,w);C||(C=new d(z.id,z.sortKey),this._entityIdsFromBuffer.add(z.id),this._entities.push(C));C.records.push(A)}}this._invalidated=!0}_ensureMesh(r){this._meshes.has(r)||
this._meshes.set(r,new f.MappedMesh(this._stage.bufferPool));return this._meshes.get(r)}_insert(r,y,x){if(r.length){this._removeDuplicatedBufferedEntites(r);y=this._insertVertexData(y);for(const w of r){for(const A of w.records)A.updateBaseOffsets(y.get(A.instanceId));x?this._tryInsertBufferedEntity(w):this._insertEntity(w)}this._invalidated=!0}}_insertVertexData(r){const y=new Map;for(const x of r){({instanceId:r}=x);const w=this._ensureMesh(r).append(x);if(x.metrics){const A=l.deserializeList(new m(x.metrics),
q.LabelMetric)??[];this._metrics.push(...A)}y.set(r,w)}return y}_insertEntity(r){g("esri-2d-update-debug")&&this._entityIds.has(r.id)&&console.error(`Tile ${this.key.id} insertEnitty: Already have entityId ${r.id}`);this._entityIds.add(r.id);this._entities.push(r)}_tryInsertBufferedEntity(r){this._entityIds.has(r.id)?this._removeRecordsFromMesh(r.records):(this._entityIdsFromBuffer.add(r.id),this._entities.push(r))}_removeDuplicatedBufferedEntites(r){if(this._entityIdsFromBuffer.size){var y=[];for(const x of r)this._entityIdsFromBuffer.has(x.id)&&
y.push(x.id);this._removeByIds(y)}}_removeByIdsFromBuffer(r){this._removeByIds(r.filter(y=>this._entityIdsFromBuffer.has(y)))}_removeByIds(r){if(0!==r.length){r=new Set(r);var y=[];for(const x of this._entities)r.has(x.id)?this._remove(x):y.push(x);this._entities=y;this._invalidated=!0}}_remove(r){this._removeRecordsFromMesh(r.records);this._entityIds.delete(r.id);this._entityIdsFromBuffer.delete(r.id)}_removeRecordsFromMesh(r){for(const y of r){const {instanceId:x,indexStart:w,indexCount:A,vertexStart:z,
vertexCount:C}=y;this._meshes.get(x)?.remove(w,A,z,C)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0;this.debugInfo.memory.bytesReserved=0;for(const [,r]of this._meshes)this.debugInfo.memory.bytesUsed+=r.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=r.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const {bytesUsed:r,bytesReserved:y}=this.debugInfo.memory,{minOrderedLength:x,length:w}=this.debugInfo.display;return y>n.RESHUFFLING_EXEMPT_MEMORY_BYTES&&
r/y<n.RESHUFFLING_TARGET_MEMORY_EFFICIENCY||w>n.RESHUFFLING_EXEMPT_DRAW_CALLS&&x/w<n.RESHUFFLING_TARGET_DRAW_EFFICIENCY?!0:!1}}e.FeatureTile=v;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AFeatureTile":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat2d ../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./definitions ./TiledDisplayObject".split(" "),
function(e,g,p,h,k,n,d){class b extends d.TiledDisplayObject{constructor(a,c,q,f){super(a,c,q,f,n.tileSize,n.tileSize)}destroy(){super.destroy()}setTransform(a){var c=this.resolution/a.resolution,q=this.transforms.tileMat3;const [f,t]=a.toScreenNoRotation([0,0],[this.x,this.y]);var m=this.width/this.rangeX*c;c*=this.height/this.rangeY;h.set(q,m,0,0,0,c,0,f,t,1);h.multiply(this.transforms.displayViewScreenMat3,a.displayViewMat3,q);q=this.transforms.labelMat2d;const l=window.devicePixelRatio;m=g.set(p.create(),
m*l,0,0,c*l,f*l,t*l);g.multiply(q,a.viewMat2d,m)}_createTransforms(){return{labelMat2d:p.create(),tileMat3:k.create(),displayViewScreenMat3:k.create()}}}e.AFeatureTile=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject","../../tiling/TileKey"],function(e,g,p,h){class k extends p.DisplayObject{constructor(n,d,b,a,c,q,f=c,t=q){super();this.tileDebugInfoTexture=
null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}};this._destroyed=!1;this.key=new h(n);this.resolution=d;this.x=b;this.y=a;this.width=c;this.height=q;this.rangeX=f;this.rangeY=t}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null);this._destroyed=!0}get debugSlot(){let n=this;for(;n.parent!==this._stage;){if(!n.parent)return 0;n=n.parent}return this._stage.children.indexOf(n)}setTransform(n){const d=
this.resolution/(n.resolution*n.pixelRatio),b=this.transforms.tileMat3,[a,c]=n.toScreenNoRotation([0,0],[this.x,this.y]);g.set(b,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,a,c,1);g.multiply(this.transforms.displayViewScreenMat3,n.displayViewMat3,b)}get destroyed(){return this._destroyed}}e.TiledDisplayObject=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],
function(e,g){class p{constructor(h,k){this.id=h;this.sortKey=k;this.records=[]}serialize(h){h.push(this.id);h.writeF32(this.sortKey);g.serializeList(h,this.records);return h}static deserialize(h){var k=h.readInt32();const n=h.readF32();k=new p(k,n);k.records=g.deserializeList(h,e)??[];return k}}p.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+e.byteSizeHint;return p})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){class e{constructor(g,p,h,k,n,d,b){this.instanceId=g;this.textureKey=
p;this.indexStart=h;this.indexCount=k;this.vertexStart=n;this.vertexCount=d;this.overlaps=b}updateBaseOffsets(g){this.vertexStart+=g.vertexFrom;this.indexStart+=g.indexFrom}clone(){return new e(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(g,p,h,k,n,d,b,a){g.push(p);g.push(h);g.push(k);g.push(n);g.push(d);g.push(b);g.push(a)}serialize(g){g.push(this.instanceId);g.push(this.textureKey);g.push(this.indexStart);g.push(this.indexCount);
g.push(this.vertexStart);g.push(this.vertexCount);g.push(this.overlaps);return g}static deserialize(g){const p=g.readInt32(),h=g.readInt32(),k=g.readInt32(),n=g.readInt32(),d=g.readInt32(),b=g.readInt32();g=g.readInt32();return new e(p,h,k,n,d,b,g)}}e.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT;return e})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(e){e.deserializeList=function(g,p,h){var k=g.readInt32();k=Array(k);for(let n=0;n<k.length;n++)k[n]=
p.deserialize(g,h);return k};e.serializeList=function(g,p){if(null===p)g.push(0);else{g.push(p.length);for(const h of p)h.serialize(g);return g}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../core/has","./enums","./cpuMapped/FreeList"],function(e,g,p,h){class k{constructor(d,b,a,c,q){this.instance=d;this.materialKey=b;this.target=a;this.start=c;this.count=q}get textureKey(){return this.materialKey&
255}get indexEnd(){return this.start+this.count}extend(d){this.count+=d}render(d){this.instance.techniqueRef.render(d,this)}}class n{constructor(){this._minOrderedLength=this._length=0;this._materialKeys=new Set}static fromDisplayEntities(d,b,a,c){const q=new n;for(const f of d.values())for(const t of f.records)d=a.getInstance(t.instanceId),q.addRecord(d,d.instanceId<<16|t.textureKey&255,t.indexStart,t.indexCount,t.vertexStart,t.vertexCount,b,c);return q}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(d){const {drawPhase:b}=
d;for(const a of this.infos())a.instance.techniqueRef.drawPhase&b&&a.render(d)}addRecord(d,b,a,c,q,f,t,m){c||(a=q,c=f);if(c)if(null==this._head)d=new k(d,b,t,a,c),this._tail=this._head=new h.List(d),this._length++,this._minOrderedLength++;else{if(m===p.FeatureBatchingStrategy.STRICT_ORDER)return this._insert(d,b,t,a,c,this._tail,null);q=null;f=this._head;var l=d.instanceId,u=d.techniqueRef.symbologyPlane;if(m===p.FeatureBatchingStrategy.STRICT_MARKERS_AND_TEXT&&(u===p.FeatureSymbologyDrawOrder.MARKER||
u===p.FeatureSymbologyDrawOrder.TEXT))return this._insert(d,b,t,a,c,this._tail,null);for(;f;){m=f.data.instance;const v=m.instanceId,r=q?.data.instance.instanceId;if(u<m.techniqueRef.symbologyPlane||l===r&&l!==v)return this._insert(d,b,t,a,c,q,f);q=f;f=f.next}this._insert(d,b,t,a,c,q,null)}}*infos(){if(null!=this._head)for(const d of this._head.values())yield d}_insert(d,b,a,c,q,f,t){if(null==f&&null==t)d=new k(d,b,a,c,q),this._tail=this._head=new h.List(d),this._length++,this._minOrderedLength++;
else{b!==this._tail.data.materialKey&&this._minOrderedLength++;this._materialKeys.add(b);if(null==f&&null!=t)return this._insertAtHead(d,b,a,c,q,t);if(null!=f&&null==t)return this._insertAtEnd(d,b,a,c,q,f);if(null!=f&&null!=t)return this._insertAtMiddle(d,b,a,c,q,f,t)}}_insertAtHead(d,b,a,c,q,f){b===f.data.materialKey&&a===f.data.target&&c+q===f.data.start?(f.data.start=c,f.data.count+=q):(d=new k(d,b,a,c,q),this._head=new h.List(d),this._head.next=f,this._length++)}_insertAtEnd(d,b,a,c,q,f){f.data.materialKey===
b&&f.data.indexEnd===c?f.data.count+=q:(d=new k(d,b,a,c,q),this._tail=new h.List(d),f.next=this._tail,this._length++)}_insertAtMiddle(d,b,a,c,q,f,t){f.data.materialKey===b&&f.data.target===a&&f.data.indexEnd===c?(f.data.count+=q,f.data.materialKey===t.data.materialKey&&f.data.target===t.data.target&&f.data.indexEnd===t.data.start&&(f.data.count+=t.data.count,f.next=t.next,this._length--)):b===t.data.materialKey&&a===t.data.target&&c+q===t.data.start?(t.data.start=c,t.data.count+=q):(d=new k(d,b,a,
c,q),d=new h.List(d),f.next=d,d.next=t,this._length++)}}e.DisplayList=n;e.DisplayListInfo=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports"],function(e){class g{constructor(h){this.next=null;if(Array.isArray(h)){this.data=h[0];var k=this;for(let n=1;n<h.length;n++)k.next=new g([h[n]]),k=k.next}else this.data=h}*values(){let h=this;for(;h;)yield h.data,h=h.next}forEach(h){let k=this;for(;k;)h(k.data),k=k.next}find(h){return h(this.data)?
this:this.next?.find(h)}max(h,k=this){k=h(this.data)>h(k.data)?this:k;return this.next?this.next.max(h,k):k}remove(h,k=null){return this===h?k?(k.next=this.next,k):this.next:this.next?.remove(h,this)??null}get last(){return this.next?this.next.last:this}}class p{constructor(h){this._head=null;null!=h&&(this._head=new g(h))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;const h=this._head.max(k=>k.end-k.start);return h.data.end-h.data.start}firstFit(h){if(null==this._head)return null;
var k=null;let n=this._head;for(;n;){const d=n.data.end-n.data.start;if(d===h)return k?k.next=n.next:this._head=n.next,n.data.start;if(d>h)return k=n.data.start,n.data.start+=h,k;k=n;n=n.next}return null}free(h,k){const n=h+k;if(null==this._head)this._head=new g({start:h,end:n});else if(n<=this._head.data.start)if(n===this._head.data.start)this._head.data.start-=k;else{var d=new g({start:h,end:n});d.next=this._head;this._head=d}else{d=this._head;for(var b=d.next;b;){if(b.data.start>=n){if(d.data.end===
h){d.data.end+=k;d.data.end===b.data.start&&(d.data.end+=b.data.end-b.data.start,d.next=b.next);return}if(b.data.start===n){b.data.start-=k;return}h=new g({start:h,end:n});h.next=d.next;d.next=h;return}d=b;b=b.next}h===d.data.end?d.data.end+=k:(h=new g({start:h,end:n}),d.next=h)}}clear(){this._head=null}}e.FreeList=p;e.List=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/ReshufflePlan":function(){define(["exports"],function(e){class g{constructor(p){this._indexOnly=
p;this.vertex={count:0,operations:[]};this.index={count:0,operations:[]}}copyRecord(p){let h=0;this._indexOnly||(h=this.vertex.count-p.vertexStart,this.vertex.operations.push({srcFrom:p.vertexStart,dstFrom:this.vertex.count,count:p.vertexCount,mutate:0}),p.vertexStart=this.vertex.count,this.vertex.count+=p.vertexCount);let k=!1;if(this._indexOnly&&1<=this.index.operations.length){const n=this.index.operations[this.index.operations.length-1];n.srcFrom+n.count===p.indexStart&&(n.count+=p.indexCount,
k=!0)}k||this.index.operations.push({srcFrom:p.indexStart,dstFrom:this.index.count,count:p.indexCount,mutate:h});p.indexStart=this.index.count;this.index.count+=p.indexCount}}e.ReshufflePlan=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","./BoundingBox","../util/serializationUtils"],function(e,g,p){class h{constructor(k,n,d,b,a,c,q,f,t=[]){this.entityTexel=k;this.anchorX=n;this.anchorY=d;this.directionX=
b;this.directionY=a;this.maxScale=c;this.minScale=q;this.referenceBounds=f;this.bounds=t}serialize(k){k.push(this.entityTexel);k.writeF32(this.anchorX);k.writeF32(this.anchorY);k.writeF32(this.directionX);k.writeF32(this.directionY);k.writeF32(this.maxScale);k.writeF32(this.minScale);null===this.referenceBounds?(k.writeF32(0),k.writeF32(0),k.writeF32(0)):(k.writeF32(this.referenceBounds.size),k.writeF32(this.referenceBounds.offsetX),k.writeF32(this.referenceBounds.offsetY));p.serializeList(k,this.bounds)}static deserialize(k){const n=
k.readInt32(),d=k.readF32(),b=k.readF32(),a=k.readF32(),c=k.readF32(),q=k.readF32(),f=k.readF32(),t=k.readF32(),m=k.readF32(),l=k.readF32();k=p.deserializeList(k,g)??[];return new h(n,d,b,a,c,q,f,{size:t,offsetX:m,offsetY:l},k)}}e.LabelMetric=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/MappedMesh":function(){define("exports ../../../../../core/maybe ../number ./Buffer ../shaderGraph/techniques/mesh/dataViewUtils ../shaderGraph/techniques/mesh/utils ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b){class a{constructor(c){this._bufferPool=c;this._computeLayouts=new Map;this._vaos=new Map;this._invalidated=!1}destroy(){for(const [,c]of this._vaos)c?.disposeVAOOnly();this._indexBuffer=g.destroyMaybe(this._indexBuffer);this._vertexBuffer=g.destroyMaybe(this._vertexBuffer)}_getVertexAttributeLayout(c){if(!c)return null;const q=[];for(const f of c.attributes)q.push({name:f.name,type:f.type,count:f.count,divisor:0,normalized:f.normalized??!1,offset:f.offset,stride:c.stride});
return{geometry:q}}getLayout(c){if(!this._layout)return null;const {locationInfo:q,useComputeBuffer:f,computeAttributeMap:t}=c;var m=this._layout.attributes.filter(u=>q.locations.has(u.name));if(!f)return{attributes:m,hash:this._layout.hash,stride:this._layout.stride};c=Object.values(t).flat().join("-");if(this._computeLayouts.has(c))return this._computeLayouts.get(c);const l=this._layout.stride;for(const {name:u,count:v,type:r,normalized:y,offset:x,packPrecisionFactor:w}of this._layout.attributes){const A=
t[u];null!=A&&2===A.length&&(m.push({name:A[0],count:v,type:r,normalized:y,offset:x+l,packPrecisionFactor:w}),m.push({name:A[1],count:v,type:r,normalized:y,offset:x+2*l,packPrecisionFactor:w}))}m={attributes:m,stride:l,hash:n.vertexLayoutHash(m)};this._computeLayouts.set(c,m);return m}getDrawArgs(c,q,f,t){return t?{primitive:d.PrimitiveType.POINTS,count:q/3,offset:f/3}:{primitive:c,count:q,offset:f}}getDebugVertexInfo(c){if(!this._vertexBuffer)return null;const q=this.getLayout(c);if(null==q)return null;
const f=q.stride;var t=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize);const m=new DataView(t.slice().buffer);t=t.byteLength/f;c.useComputeBuffer&&(t=this._indexBuffer.fillPointer/3);const l=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let u=0;const v=[];for(let r=0;r<t;r++){c.useComputeBuffer&&(u=l[3*r]*f);const y={};for(const x of q.attributes){let w=`${x.offset} ${x.name}`,A=k.unpackDataView(m,x,u);if(x.packPrecisionFactor)if(w+=` (precision: ${x.packPrecisionFactor})`,"number"===
typeof A)A/=x.packPrecisionFactor;else for(let z=0;z<A.length;z++)A[z]/=x.packPrecisionFactor;y[w]=A}u+=f;v.push(y)}return{vertices:v,layout:q}}_ensure(c,q,f){if(this._vertexBuffer&&this._indexBuffer){if(this._layout?.hash!==c.hash)throw Error("InternalError: Expected vertex layouts to match");this._indexBuffer.ensure(Math.max(q,1E3));this._vertexBuffer.ensure(Math.max(f,1E3))}else{const t=c.stride/Uint32Array.BYTES_PER_ELEMENT;this._layout=c;this._position=c.attributes.find(m=>"pos"===m.name||"position"===
m.name);if(!this._position)throw Error("InternalError: Unable to find position attribute");this._indexBuffer=new h.MappedBuffer("index",Math.max(q,1E3),1,this._bufferPool);this._vertexBuffer=new h.MappedBuffer("vertex",Math.max(f,1E3),t,this._bufferPool)}}append(c){var q=c.layout.stride;this._ensure(c.layout,c.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,c.vertices.byteLength/q);const {vertices:f,indices:t}=c;c=this._vertexBuffer.insert(f,0,f.byteLength/q,0);q=this._indexBuffer.insert(t,0,t.byteLength/
4,c);return{vertexFrom:c,indexFrom:q}}copyRecordFrom(c,q,f,t){const {indexStart:m,indexCount:l,vertexStart:u,vertexCount:v}=q;this._ensure(c._layout,l,v);const r=c._position;var y=r.offset;f=p.i1616to32(f*(r.packPrecisionFactor??1),t*(r.packPrecisionFactor??1));y=this._vertexBuffer.copyFrom(c._vertexBuffer,u,v,f,y);c=this._indexBuffer.copyFrom(c._indexBuffer,m,l,y-u,0);q=q.clone();q.vertexStart=y;q.indexStart=c;q.overlaps=0;return q}remove(c,q,f,t){this._indexBuffer.free(c,q);this._vertexBuffer.free(f,
t)}upload(){this._invalidated=!0}getVAO(c,q,f){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;const t=f?.useComputeBuffer?1:0;let m=this._vaos.get(t);if(this._invalidated||f?.useComputeBuffer){if(this._vertexBuffer.invalidated||this._indexBuffer.invalidated||f?.useComputeBuffer&&this._indexBuffer.invalidatedComputeBuffer)this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),m?.disposeVAOOnly(),m=null;this._vertexBuffer.upload();this._indexBuffer.upload();
const l=this._indexBuffer.getGPUBuffer(c,1===t),u=this._vertexBuffer.getGPUBuffer(c);m||(m=new b.VertexArrayObject(c,q.locations,this._getVertexAttributeLayout(this.getLayout(f)),{geometry:u},l),this._vaos.set(t,m));this._invalidated=!1}return m}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,
index:this._indexBuffer.memoryStats}}reshuffle(c){this._vertexBuffer&&this._vertexBuffer.reshuffle(c.vertex.count,c.vertex.operations);this._indexBuffer&&this._indexBuffer.reshuffle(c.index.count,c.index.operations)}}e.MappedMesh=a;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(e){function g(k,n,d){return Math.round(Math.max(Math.min(k,d),n))}const p=new Float32Array(1),h=new Uint32Array(p.buffer);e.i16=function(k){return g(k,
-32768,32767)};e.i1616to32=function(k,n){return 65535&k|n<<16};e.i32=function(k){return g(k,-2147483648,2147483647)};e.i8=function(k){return g(k,-128,127)};e.i8816to32=function(k,n,d){return k&255|(n&255)<<8|d<<16};e.i8888to32=function(k,n,d,b){return k&255|(n&255)<<8|(d&255)<<16|b<<24};e.numTo32=function(k){return k|0};e.toFloat32=function(k){h[0]=k;return p[0]};e.toUint32=function(k){p[0]=k;return h[0]};e.u16=function(k){return g(k,0,65535)};e.u32=function(k){return g(k,0,4294967295)};e.u32to4Xu8=
function(k){return[k&255,(k&65280)>>>8,(k&16711680)>>>16,(k&4278190080)>>>24]};e.u4u4to8=function(k,n){return 15&k|(15&n)<<4};e.u8=function(k){return g(k,0,255)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define("exports ../../../../../core/has ../../../../../core/maybe ../PooledUint32Array ./FreeList ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(e,g,p,h,k,n,d){class b{constructor(a,c,q,f){this._pool=
f;f=h.PooledUint32Array.create(c*q*Uint32Array.BYTES_PER_ELEMENT,this._pool);this.size=c;this.strideInt=q;this.bufferType=a;this.dirty={start:Infinity,end:0};this.memoryStats={bytesUsed:0,bytesReserved:c*q*Uint32Array.BYTES_PER_ELEMENT};this._gpu=null;this._cpu=f;this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return 0<this.bufferSize&&!this._gpu}get invalidatedComputeBuffer(){return 0<
this.bufferSize&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer();this._gpu?.dispose();this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose();this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose();this._gpuComputeTriangles?.dispose();this._cpu?.destroy()}clear(){this.dirty.start=Infinity;this.dirty.end=0;this.freeList=new k.FreeList({start:0,end:this._cpu.length/this.strideInt});this.fillPointer=0}ensure(a){if(!(this.maxAvailableSpace()>=a)&&
a*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const c=this._cpu.length/this.strideInt;a=Math.round(1.25*(c+a));this._cpu.expand(a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT);this.freeList.free(c,a-c);this.memoryStats.bytesReserved+=(a-c)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}set(a,c){this._cpu.array[a]!==c&&(this._cpu.array[a]=c,this.dirty.start=Math.min(a,this.dirty.start),this.dirty.end=Math.max(a+1,this.dirty.end))}getGPUBuffer(a,c=!1){if(!this.bufferSize)return null;
if(c){if("index"!==this.bufferType)throw Error("Tired to get triangle buffer, but target is not an index buffer");null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(a));return this._gpuComputeTriangles}null==this._gpu&&(this._gpu=this._createBuffer(a));return this._gpu}getView(a,c){return this._cpu.getUint32View(a,c/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(a,
c,q,f){const t=q*this.strideInt;if(!t)return 0;a=new Uint32Array(a,c*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,t);c=this.freeList.firstFit(q);p.assertIsSome(c,"First fit region must be defined");const m=c*this.strideInt;this._cpu.array.set(a,m);if(0!==f)for(let l=0;l<a.length;l++)this._cpu.array[l+m]+=f;this.dirty.start=Math.min(this.dirty.start,m);this.dirty.end=Math.max(this.dirty.end,m+t);this.fillPointer=Math.max(this.fillPointer,m+t);this.memoryStats.bytesUsed+=q*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;
return c}copyFrom(a,c,q,f,t){const m=q*this.strideInt;if(!m)return 0;var l=a._cpu.getUint32View(c*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,m);a=this.freeList.firstFit(q);p.assertIsSome(a,"First fit region must be defined");c=a*this.strideInt;this._cpu.array.set(l,c);if(0!==f)for(l=0;l<m;l++)this._cpu.array[c+l*this.strideInt+t]+=f;this.dirty.start=Math.min(this.dirty.start,c);this.dirty.end=Math.max(this.dirty.end,c+m);this.fillPointer=Math.max(this.fillPointer,c+m);this.memoryStats.bytesUsed+=
q*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;return a}free(a,c,q){const f=a*this.strideInt,t=(a+c)*this.strideInt;if(!0===q)for(q=a;q!==a+c;q++)this._cpu.array[q*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,f);this.dirty.end=Math.max(this.dirty.end,t);this.freeList.free(a,c);this.memoryStats.bytesUsed-=c*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){this.dirty.end&&(this._invalidateTriangleBuffer(),null!=this._gpu&&this._gpu.setSubData(this._cpu.array,this.dirty.start,
this.dirty.start,this.dirty.end),this.dirty.start=Infinity,this.dirty.end=0)}reshuffle(a,c){if(0!==c.length){a=a*this.strideInt*Uint32Array.BYTES_PER_ELEMENT;var q=this.byteSize>a,f=this._cpu,t=h.PooledUint32Array.create(a,this._pool);q||t.array.set(this._cpu.getUint32View(0,this.intSize));for(const m of c)if(q||m.srcFrom!==m.dstFrom||0!==m.mutate)for(this.dirty.start=Math.min(this.dirty.start,m.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(m.dstFrom+m.count)*this.strideInt),c=0;c<
m.count;c++){const l=(m.dstFrom+c)*this.strideInt,u=(m.srcFrom+c)*this.strideInt;for(let v=0;v<this.strideInt;v++)t.array[l+v]=f.array[u+v]+m.mutate}this._cpu.destroy();this._cpu=t;q&&this.invalidate();this.freeList.clear();this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=a}}_createBuffer(a){const c=d.Usage.DYNAMIC_DRAW;return"index"===this.bufferType?n.BufferObject.createIndex(a,c,this._cpu.array):n.BufferObject.createVertex(a,c,this._cpu.array)}_createComputeBuffer(a){const c=d.Usage.DYNAMIC_DRAW,
q=new Uint32Array(this.fillPointer/3);for(let f=0;f<this.fillPointer;f+=3)q[f/3]=this._cpu.array[f];return n.BufferObject.createIndex(a,c,q)}}e.MappedBuffer=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/PooledUint32Array":function(){define(["exports","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(e,g,p,h){const k=g("esri-2d-log-allocations");class n{static create(a,c){a=c.acquireUint32Array(a);return new n(a,c)}constructor(a,
c){this._array=a;this._pool=c}get array(){return this._array}get length(){return this._array.length}getUint32View(a,c){return new Uint32Array(this._array.buffer,a+this._array.byteOffset,c)}expand(a){a<=this._array.byteLength||(a=this._pool.acquireUint32Array(a),a.set(this._array),this._pool.releaseUint32Array(this._array),this._array=a)}destroy(){this._pool.releaseUint32Array(this._array)}}class d{constructor(){this._data=new ArrayBuffer(d.BYTE_LENGTH);this._freeList=new h.FreeList({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16E6}get buffer(){return this._data}acquireUint32Array(a){const c=
this._freeList.firstFit(a);return null==c?null:new Uint32Array(this._data,c,a/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(a){this._freeList.free(a.byteOffset,a.byteLength)}}class b{constructor(){this._pages=[];this._pagesByBuffer=new Map;this._bytesAllocated=0}destroy(){this._pages=[];this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*d.BYTE_LENGTH}acquireUint32Array(a){this._bytesAllocated+=a;k&&console.log(`Allocating ${a}, (${this._bytesAllocated} / ${this._bytesTotal})`);
if(a>=d.BYTE_LENGTH)return new Uint32Array(a/Uint32Array.BYTES_PER_ELEMENT);for(const c of this._pages){const q=c.acquireUint32Array(a);if(null!=q)return q}a=this._addPage().acquireUint32Array(a);p.assertIsSome(a,"Expected to allocate page");return a}releaseUint32Array(a){this._bytesAllocated-=a.byteLength;k&&console.log(`Freeing ${a.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const c=this._pagesByBuffer.get(a.buffer);c&&c.releaseUint32Array(a)}_addPage(){const a=new d;this._pages.push(a);
this._pagesByBuffer.set(a.buffer,a);return a}}e.ArrayBufferPool=b;e.PooledUint32Array=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../../../../webgl/enums"],function(e,g){e.packDataView=function(p,h,k,n){const d=k.packPrecisionFactor??1;switch(k.type){case g.DataType.BYTE:if(1===k.count)p.setInt8(n+k.offset,h*d);else for(var b=0;b<k.count;b++)p.setInt8(n+k.offset+b*Int8Array.BYTES_PER_ELEMENT,
h[b]*d);break;case g.DataType.UNSIGNED_BYTE:if(1===k.count)p.setUint8(n+k.offset,h*d);else for(b=0;b<k.count;b++)p.setUint8(n+k.offset+b*Uint8Array.BYTES_PER_ELEMENT,h[b]*d);break;case g.DataType.SHORT:if(1===k.count)p.setInt16(n+k.offset,h*d,!0);else for(b=0;b<k.count;b++)p.setInt16(n+k.offset+b*Int16Array.BYTES_PER_ELEMENT,h[b]*d,!0);break;case g.DataType.UNSIGNED_SHORT:if(1===k.count)p.setUint16(n+k.offset,h*d,!0);else for(b=0;b<k.count;b++)p.setUint16(n+k.offset+b*Uint16Array.BYTES_PER_ELEMENT,
h[b]*d,!0);break;case g.DataType.INT:if(1===k.count)p.setInt32(n+k.offset,h*d,!0);else for(b=0;b<k.count;b++)p.setInt32(n+k.offset+b*Int32Array.BYTES_PER_ELEMENT,h[b]*d,!0);break;case g.DataType.UNSIGNED_INT:if(1===k.count)p.setUint32(n+k.offset,h*d,!0);else for(b=0;b<k.count;b++)p.setUint32(n+k.offset+b*Uint32Array.BYTES_PER_ELEMENT,h[b]*d,!0);break;case g.DataType.FLOAT:if(1===k.count)p.setFloat32(n+k.offset,h*d,!0);else for(b=0;b<k.count;b++)p.setFloat32(n+k.offset+b*Float32Array.BYTES_PER_ELEMENT,
h[b]*d,!0)}};e.unpackDataView=function(p,h,k){switch(h.type){case g.DataType.BYTE:if(1===h.count)return p.getInt8(k+h.offset);var n=[];for(var d=0;d<h.count;d++)n.push(p.getInt8(k+h.offset+d*Int8Array.BYTES_PER_ELEMENT));return n;case g.DataType.UNSIGNED_BYTE:if(1===h.count)return p.getUint8(k+h.offset);n=[];for(d=0;d<h.count;d++)n.push(p.getUint8(k+h.offset+d*Uint8Array.BYTES_PER_ELEMENT));return n;case g.DataType.SHORT:if(1===h.count)return p.getInt16(k+h.offset,!0);n=[];for(d=0;d<h.count;d++)n.push(p.getInt16(k+
h.offset+d*Int16Array.BYTES_PER_ELEMENT,!0));return n;case g.DataType.UNSIGNED_SHORT:if(1===h.count)return p.getUint16(k+h.offset,!0);n=[];for(d=0;d<h.count;d++)n.push(p.getUint16(k+h.offset+d*Uint16Array.BYTES_PER_ELEMENT,!0));return n;case g.DataType.INT:if(1===h.count)return p.getInt32(k+h.offset,!0);n=[];for(d=0;d<h.count;d++)n.push(p.getInt32(k+h.offset+d*Int32Array.BYTES_PER_ELEMENT,!0));return n;case g.DataType.UNSIGNED_INT:if(1===h.count)return p.getUint32(k+h.offset,!0);n=[];for(d=0;d<h.count;d++)n.push(p.getUint32(k+
h.offset+d*Uint32Array.BYTES_PER_ELEMENT,!0));return n;case g.DataType.FLOAT:if(1===h.count)return p.getFloat32(k+h.offset,!0);n=[];for(d=0;d<h.count;d++)n.push(p.getFloat32(k+h.offset+d*Float32Array.BYTES_PER_ELEMENT,!0));return n}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/meshDebugUtils":function(){define(["exports","../DisplayEntity","../shaderGraph/techniques/mesh/dataViewUtils","../util/Reader","../util/serializationUtils"],function(e,g,
p,h,k){function n(d){const b=d.layout.stride,a=new DataView(d.vertices),c=[],q=d.vertices.byteLength/b;let f=0;for(let t=0;t<q;t++){const m={};for(const l of d.layout.attributes){let u=`${l.offset} ${l.name}`,v=p.unpackDataView(a,l,f);if(l.packPrecisionFactor)if(u+=` (precision: ${l.packPrecisionFactor})`,"number"===typeof v)v/=l.packPrecisionFactor;else for(let r=0;r<v.length;r++)v[r]/=l.packPrecisionFactor;m[u]=v}f+=b;c.push(m)}return{vertices:c,layout:d.layout}}e.debugMeshDataInfo=function(d){if(!d)return null;
const b=k.deserializeList(new h(d.entities),g);d=d.data.map(n);return{entities:b,vertexData:d}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Reader":function(){define(function(){class e{constructor(g){this._pos=0;this._buffer=g;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}return e})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports",
"./sources/resolver"],function(e,g){g={shaders:{vertexShader:g.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:g.resolveIncludes("tileInfo/tileInfo.frag")},attributes:new Map([["a_pos",0]])};e.tileInfo=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("exports ../../../../../core/mathUtils ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../core/libs/gl-matrix-2/factories/vec4f32 ../definitions ./WGLBrush ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b,a){class c extends n{constructor(){super(...arguments);this._color=h.fromValues(1,0,0,1);this._patternMatrix=p.create();this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(q,f){const {context:t,painter:m,requestRender:l,allowDelayedRender:u}=q;this._loadWGLResources(q);const v=q.displayLevel;var r=q.styleLayer,y=r.backgroundMaterial;const x=m.vectorTilesMaterialManager;var w=r.getPaintValue("background-color",v),A=r.getPaintValue("background-opacity",
v);const z=r.getPaintValue("background-pattern",v),C=void 0!==z,D=q.spriteMosaic;let F,G;q=(window.devicePixelRatio|1)>k.vtlHighResCutoff?2:1;const B=this._programOptions;B.pattern=C;y=x.getMaterialProgram(t,y,B);if(u&&null!=l&&!y.compiled)l();else{t.bindVAO(this._vao);t.useProgram(y);if(C){w=D.getMosaicItemPosition(z,!0);if(null!=w){const {tl:I,br:H,page:K}=w;F=H[0]-I[0];G=H[1]-I[1];w=D.getPageSize(K);null!=w&&(D.bind(t,b.TextureSamplingMode.LINEAR,K,k.vtlTextureBindingUnitSprites),y.setUniform4f("u_tlbr",
I[0],I[1],H[0],H[1]),y.setUniform2fv("u_mosaicSize",w),y.setUniform1i("u_texture",k.vtlTextureBindingUnitSprites))}y.setUniform1f("u_opacity",A)}else A*=w[3],this._color[0]=A*w[0],this._color[1]=A*w[1],this._color[2]=A*w[2],this._color[3]=A,y.setUniform4fv("u_color",this._color);y.setUniform1f("u_depth",r.z||0);for(const I of f)y.setUniform1f("u_coord_range",I.rangeX),y.setUniformMatrix3fv("u_dvsMat3",I.transforms.displayViewScreenMat3),C&&(r=q*I.width*Math.max(2**(Math.round(v)-I.key.level),1),f=
r/g.nextPowerOfTwo(F),r/=g.nextPowerOfTwo(G),this._patternMatrix[0]=f,this._patternMatrix[4]=r,y.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),t.setStencilFunction(b.CompareFunction.EQUAL,0,255),t.drawArrays(b.PrimitiveType.TRIANGLE_STRIP,0,4)}}_loadWGLResources(q){if(!this._vao){var {context:f,styleLayer:t}=q;q=t.backgroundMaterial;var m=new Int8Array([0,0,1,0,0,1,1,1]);m=d.BufferObject.createVertex(f,b.Usage.STATIC_DRAW,m);this._vao=new a.VertexArrayObject(f,q.getAttributeLocations(),
q.getLayoutInfo(),{geometry:m})}}}e.WGLBrushVTLBackground=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","../../vectorTiles/style/StyleDefinition","./WGLBrush","../../../../webgl/enums"],function(e,g,p,h){class k extends p{constructor(){super(...arguments);this._programOptions={id:!1}}dispose(){}drawMany(n,d){const {context:b,displayLevel:a,requiredLevel:c,state:q,painter:f,spriteMosaic:t,styleLayerUID:m,
requestRender:l,allowDelayedRender:u}=n;if(d.some(w=>w.layerData.get(m)?.circleIndexCount??!1)){n=n.styleLayer;var v=n.circleMaterial,r=f.vectorTilesMaterialManager,y=n.getPaintValue("circle-translate",a),x=n.getPaintValue("circle-translate-anchor",a);r=r.getMaterialProgram(b,v,this._programOptions);if(u&&null!=l&&!r.compiled)l();else{b.useProgram(r);r.setUniformMatrix3fv("u_displayMat3",x===g.TranslateAnchor.VIEWPORT?q.displayMat3:q.displayViewMat3);r.setUniform2fv("u_circleTranslation",y);r.setUniform1f("u_depth",
n.z);r.setUniform1f("u_antialiasingWidth",1.2);y=-1;for(const w of d)w.layerData.has(m)&&(w.key.level!==y&&(y=w.key.level,v.setDataUniforms(r,a,n,y,t)),d=w.layerData.get(m),d.circleIndexCount&&(d.prepareForRendering(b),x=d.vao,null!=x&&(b.bindVAO(x),r.setUniformMatrix3fv("u_dvsMat3",w.transforms.displayViewScreenMat3),c!==w.key.level?b.setStencilFunction(h.CompareFunction.EQUAL,w.stencilRef,255):b.setStencilFunction(h.CompareFunction.GREATER,255,255),b.drawElements(h.PrimitiveType.TRIANGLES,d.circleIndexCount,
h.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*d.circleIndexStart),w.triangleCount+=d.circleIndexCount/3)))}}}}e.WGLBrushVTLCircle=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(e,g){e.StyleLayerType=void 0;(function(h){h[h.BACKGROUND=0]="BACKGROUND";h[h.FILL=1]="FILL";h[h.LINE=2]="LINE";h[h.SYMBOL=3]="SYMBOL";h[h.CIRCLE=4]="CIRCLE"})(e.StyleLayerType||
(e.StyleLayerType={}));e.Visibility=void 0;(function(h){h[h.VISIBLE=0]="VISIBLE";h[h.NONE=1]="NONE"})(e.Visibility||(e.Visibility={}));e.SymbolPlacement=void 0;(function(h){h[h.POINT=0]="POINT";h[h.LINE=1]="LINE";h[h.LINE_CENTER=2]="LINE_CENTER"})(e.SymbolPlacement||(e.SymbolPlacement={}));e.RotationAlignment=void 0;(function(h){h[h.MAP=0]="MAP";h[h.VIEWPORT=1]="VIEWPORT";h[h.AUTO=2]="AUTO"})(e.RotationAlignment||(e.RotationAlignment={}));e.TextJustification=void 0;(function(h){h[h.AUTO=0]="AUTO";
h[h.LEFT=1]="LEFT";h[h.CENTER=2]="CENTER";h[h.RIGHT=3]="RIGHT"})(e.TextJustification||(e.TextJustification={}));e.SymbolAnchor=void 0;(function(h){h[h.CENTER=0]="CENTER";h[h.LEFT=1]="LEFT";h[h.RIGHT=2]="RIGHT";h[h.TOP=3]="TOP";h[h.BOTTOM=4]="BOTTOM";h[h.TOP_LEFT=5]="TOP_LEFT";h[h.TOP_RIGHT=6]="TOP_RIGHT";h[h.BOTTOM_LEFT=7]="BOTTOM_LEFT";h[h.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(e.SymbolAnchor||(e.SymbolAnchor={}));e.TextTransform=void 0;(function(h){h[h.NONE=0]="NONE";h[h.UPPERCASE=1]="UPPERCASE";h[h.LOWERCASE=
2]="LOWERCASE"})(e.TextTransform||(e.TextTransform={}));e.TranslateAnchor=void 0;(function(h){h[h.MAP=0]="MAP";h[h.VIEWPORT=1]="VIEWPORT"})(e.TranslateAnchor||(e.TranslateAnchor={}));e.TextWritingMode=void 0;(function(h){h[h.HORIZONTAL=0]="HORIZONTAL";h[h.VERTICAL=1]="VERTICAL"})(e.TextWritingMode||(e.TextWritingMode={}));class p{}p.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:e.Visibility.VISIBLE}};p.fillLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:e.Visibility.VISIBLE}};p.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:e.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:g.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:g.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};p.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:e.Visibility.VISIBLE},
"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:e.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:e.SymbolAnchor.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},
"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:e.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",
values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:e.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:e.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},
"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:e.RotationAlignment.AUTO},"text-size":{type:"number",minimum:0,default:16},
"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:e.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[e.TextWritingMode.HORIZONTAL]}};p.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:e.Visibility.VISIBLE}};p.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};
p.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:e.TranslateAnchor.MAP}};p.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",
default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:e.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};p.symbolPaintDefinition={"icon-color":{type:"color",
default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:e.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},
"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:e.TranslateAnchor.MAP}};p.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};p.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:e.TranslateAnchor.MAP}};e.StyleDefinition=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,g,p,h,k){const n=1/65536;class d extends h{constructor(){super(...arguments);this._fillProgramOptions={id:!1,pattern:!1};this._outlineProgramOptions={id:!1}}dispose(){}drawMany(b,a){const {displayLevel:c,renderPass:q,spriteMosaic:f,styleLayerUID:t}=b;var m=!1;for(var l of a)if(l.layerData.has(t)){var u=l.layerData.get(t);if(0<u.fillIndexCount||0<u.outlineIndexCount){m=!0;break}}if(m){m=b.styleLayer;
var v=m.getPaintProperty("fill-pattern");u=(l=void 0!==v)&&v.isDataDriven;if(l&&!u){var r=v.getValue(c);r=f.getMosaicItemPosition(r,!0)}v=!l&&m.getPaintValue("fill-antialias",c);var y=!0,x=1;if(!l){var w=m.getPaintProperty("fill-color"),A=m.getPaintProperty("fill-opacity");w?.isDataDriven||A?.isDataDriven||(x=m.getPaintValue("fill-color",c),x=m.getPaintValue("fill-opacity",c)*x[3],1<=x&&(y=!1))}y&&"opaque"===q||(w=m.getPaintValue("fill-translate",c),A=m.getPaintValue("fill-translate-anchor",c),(y||
"translucent"!==q)&&this._drawFill(b,t,m,a,w,A,l,r,u),r=!m.hasDataDrivenOutlineColor&&m.outlineUsesFillColor&&1>x,v&&"opaque"!==q&&!r&&this._drawOutline(b,t,m,a,w,A))}}_drawFill(b,a,c,q,f,t,m,l,u){if(!m||u||null!=l){var {context:v,displayLevel:r,state:y,painter:x,pixelRatio:w,spriteMosaic:A,requestRender:z,allowDelayedRender:C}=b;b=c.fillMaterial;var D=x.vectorTilesMaterialManager,F=w>p.vtlHighResCutoff?2:1,G=this._fillProgramOptions;G.pattern=m;D=D.getMaterialProgram(v,b,G);if(C&&null!=z&&!D.compiled)z();
else{v.useProgram(D);null!=l&&({page:l}=l,G=A.getPageSize(l),null!=G&&(A.bind(v,k.TextureSamplingMode.LINEAR,l,p.vtlTextureBindingUnitSprites),D.setUniform2fv("u_mosaicSize",G),D.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites)));D.setUniformMatrix3fv("u_displayMat3",t===g.TranslateAnchor.VIEWPORT?y.displayMat3:y.displayViewMat3);D.setUniform2fv("u_fillTranslation",f);D.setUniform1f("u_depth",c.z+n);f=-1;for(const B of q)if(B.layerData.has(a)&&(B.key.level!==f&&(f=B.key.level,b.setDataUniforms(D,
r,c,f,A)),q=B.layerData.get(a),q.fillIndexCount&&(q.prepareForRendering(v),t=q.fillVAO,null!=t))){v.bindVAO(t);D.setUniformMatrix3fv("u_dvsMat3",B.transforms.displayViewScreenMat3);v.setStencilFunction(k.CompareFunction.EQUAL,B.stencilRef,255);m&&D.setUniform1f("u_patternFactor",B.rangeX/(F*B.width*Math.max(2**(Math.round(r)-B.key.level),1)));if(u){t=q.patternMap;if(!t)continue;for(const [I,H]of t)t=A.getPageSize(I),null!=t&&(A.bind(v,k.TextureSamplingMode.LINEAR,I,p.vtlTextureBindingUnitSprites),
D.setUniform2fv("u_mosaicSize",t),D.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites),v.drawElements(k.PrimitiveType.TRIANGLES,H[1],k.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*H[0]))}else v.drawElements(k.PrimitiveType.TRIANGLES,q.fillIndexCount,k.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q.fillIndexStart);B.triangleCount+=q.fillIndexCount/3}}}}_drawOutline(b,a,c,q,f,t){const {context:m,displayLevel:l,state:u,painter:v,pixelRatio:r,spriteMosaic:y,requestRender:x,allowDelayedRender:w}=
b;b=c.outlineMaterial;const A=.75/r,z=v.vectorTilesMaterialManager.getMaterialProgram(m,b,this._outlineProgramOptions);if(w&&null!=x&&!z.compiled)x();else{m.useProgram(z);z.setUniformMatrix3fv("u_displayMat3",t===g.TranslateAnchor.VIEWPORT?u.displayMat3:u.displayViewMat3);z.setUniform2fv("u_fillTranslation",f);z.setUniform1f("u_depth",c.z+n);z.setUniform1f("u_outline_width",A);f=-1;for(const C of q)C.layerData.has(a)&&(C.key.level!==f&&(f=C.key.level,b.setDataUniforms(z,l,c,f,y)),q=C.layerData.get(a),
q.prepareForRendering(m),q.outlineIndexCount&&(t=q.outlineVAO,null!=t&&(m.bindVAO(t),z.setUniformMatrix3fv("u_dvsMat3",C.transforms.displayViewScreenMat3),m.setStencilFunction(k.CompareFunction.EQUAL,C.stencilRef,255),m.drawElements(k.PrimitiveType.TRIANGLES,q.outlineIndexCount,k.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*q.outlineIndexStart),C.triangleCount+=q.outlineIndexCount/3)))}}}e.WGLBrushVTLFill=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports",
"../../vectorTiles/style/StyleDefinition","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,g,p,h,k){class n extends h{constructor(){super(...arguments);this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(d,b){const {context:a,displayLevel:c,state:q,painter:f,pixelRatio:t,spriteMosaic:m,styleLayerUID:l,requestRender:u,allowDelayedRender:v}=d;if(b.some(I=>I.layerData.get(l)?.lineIndexCount??!1)){d=d.styleLayer;var r=d.lineMaterial,y=f.vectorTilesMaterialManager,x=d.getPaintValue("line-translate",
c),w=d.getPaintValue("line-translate-anchor",c),A=d.getPaintProperty("line-pattern"),z=void 0!==A,C=z&&A.isDataDriven;if(z&&!C){A=A.getValue(c);var D=m.getMosaicItemPosition(A)}var F;A=!1;if(!z){var G=d.getPaintProperty("line-dasharray");A=(F=void 0!==G)&&G.isDataDriven;F&&!A&&(D=G.getValue(c),D=d.getDashKey(D,d.getLayoutValue("line-cap",c)),D=m.getMosaicItemPosition(D))}G=1/t;var B=this._programOptions;B.pattern=z;B.sdf=F;F=y.getMaterialProgram(a,r,B);if(v&&null!=u&&!F.compiled)u();else{a.useProgram(F);
F.setUniformMatrix3fv("u_displayViewMat3",q.displayViewMat3);F.setUniformMatrix3fv("u_displayMat3",w===g.TranslateAnchor.VIEWPORT?q.displayMat3:q.displayViewMat3);F.setUniform2fv("u_lineTranslation",x);F.setUniform1f("u_depth",d.z);F.setUniform1f("u_antialiasing",G);D&&null!=D&&({page:x}=D,w=m.getPageSize(x),null!=w&&(m.bind(a,k.TextureSamplingMode.LINEAR,x,p.vtlTextureBindingUnitSprites),F.setUniform2fv("u_mosaicSize",w),F.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites)));x=-1;for(const I of b)if(I.layerData.has(l)&&
(I.key.level!==x&&(x=I.key.level,r.setDataUniforms(F,c,d,x,m)),F.setUniform1f("u_zoomFactor",2**(c-x)/t),b=I.layerData.get(l),b.lineIndexCount&&(b.prepareForRendering(a),w=b.vao,null!=w))){a.bindVAO(w);F.setUniformMatrix3fv("u_dvsMat3",I.transforms.displayViewScreenMat3);a.setStencilFunction(k.CompareFunction.EQUAL,I.stencilRef,255);if(C||A){w=b.patternMap;if(!w)continue;for(const [H,K]of w)w=m.getPageSize(H),null!=w&&(m.bind(a,k.TextureSamplingMode.LINEAR,H,p.vtlTextureBindingUnitSprites),F.setUniform2fv("u_mosaicSize",
w),F.setUniform1i("u_texture",p.vtlTextureBindingUnitSprites),a.drawElements(k.PrimitiveType.TRIANGLES,K[1],k.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*K[0]))}else a.drawElements(k.PrimitiveType.TRIANGLES,b.lineIndexCount,k.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*b.lineIndexStart);I.triangleCount+=b.lineIndexCount/3}}}}}e.WGLBrushVTLLine=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../vectorTiles/decluttering/config ../../vectorTiles/style/StyleDefinition ../definitions ../GeometryUtils ./WGLBrush ../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b){const a=1/65536;class c extends d{constructor(){super(...arguments);this._iconProgramOptions={id:!1,sdf:!1};this._sdfProgramOptions={id:!1};this._spritesTextureSize=g.create()}dispose(){}drawMany(q,f){const t=q.styleLayer;this._drawIcons(q,t,f);this._drawText(q,t,f)}_drawIcons(q,f,t){const {context:m,displayLevel:l,painter:u,spriteMosaic:v,state:r,styleLayerUID:y,requestRender:x,allowDelayedRender:w}=q,A=f.iconMaterial;var z=u.vectorTilesMaterialManager;let C;var D=!1;for(var F of t)if(F.layerData.has(y)&&
(C=F.layerData.get(y),0<C.iconPerPageElementsMap.size)){D=!0;break}if(D){D=f.getPaintValue("icon-translate",l);F=f.getPaintValue("icon-translate-anchor",l);var G=f.getLayoutValue("icon-rotation-alignment",l);G===h.RotationAlignment.AUTO&&(G=f.getLayoutValue("symbol-placement",l)===h.SymbolPlacement.POINT?h.RotationAlignment.VIEWPORT:h.RotationAlignment.MAP);var B=G===h.RotationAlignment.MAP;B=f.getLayoutValue("icon-keep-upright",l)&&B;var I=this._iconProgramOptions;I.sdf=C.isIconSDF;z=z.getMaterialProgram(m,
A,I);if(w&&null!=x&&!z.compiled)x();else{m.useProgram(z);z.setUniformMatrix3fv("u_displayViewMat3",G===h.RotationAlignment.MAP?r.displayViewMat3:r.displayMat3);z.setUniformMatrix3fv("u_displayMat3",F===h.TranslateAnchor.VIEWPORT?r.displayMat3:r.displayViewMat3);z.setUniform2fv("u_iconTranslation",D);z.setUniform1f("u_depth",f.z);z.setUniform1f("u_mapRotation",n.degToByte(r.rotation));z.setUniform1f("u_keepUpright",B?1:0);z.setUniform1f("u_level",10*l);z.setUniform1i("u_texture",k.vtlTextureBindingUnitSprites);
z.setUniform1f("u_fadeDuration",p.fadeDuration/1E3);D=-1;for(const H of t)if(H.layerData.has(y)&&(H.key.level!==D&&(D=H.key.level,A.setDataUniforms(z,l,f,D,v)),C=H.layerData.get(y),0!==C.iconPerPageElementsMap.size&&(C.prepareForRendering(m),C.updateOpacityInfo(),t=C.iconVAO,null!=t))){m.bindVAO(t);z.setUniformMatrix3fv("u_dvsMat3",H.transforms.displayViewScreenMat3);z.setUniform1f("u_time",(performance.now()-C.lastOpacityUpdate)/1E3);for(const [K,O]of C.iconPerPageElementsMap)this._renderIconRange(q,
z,O,K,H)}}}}_renderIconRange(q,f,t,m,l){const {context:u,spriteMosaic:v}=q;this._spritesTextureSize[0]=v.getWidth(m)/4;this._spritesTextureSize[1]=v.getHeight(m)/4;f.setUniform2fv("u_mosaicSize",this._spritesTextureSize);v.bind(u,b.TextureSamplingMode.LINEAR,m,k.vtlTextureBindingUnitSprites);this._setStencilState(q,l);u.drawElements(b.PrimitiveType.TRIANGLES,t[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]);l.triangleCount+=t[1]/3}_drawText(q,f,t){const {context:m,displayLevel:l,glyphMosaic:u,
painter:v,pixelRatio:r,spriteMosaic:y,state:x,styleLayerUID:w,requestRender:A,allowDelayedRender:z}=q,C=f.textMaterial;var D=v.vectorTilesMaterialManager,F=!1;for(var G of t)if(G.layerData.has(w)){var B=G.layerData.get(w);if(0<B.glyphPerPageElementsMap.size){F=!0;break}}if(F&&(B=f.getPaintProperty("text-opacity"),!B||B.isDataDriven||0!==B.getValue(l))){B=f.getPaintProperty("text-color");var I=!B||B.isDataDriven||0<B.getValue(l)[3];B=f.getPaintProperty("text-halo-width");F=f.getPaintProperty("text-halo-color");
var H=(!B||B.isDataDriven||0<B.getValue(l))&&(!F||F.isDataDriven||0<F.getValue(l)[3]);if(I||H){B=f.getLayoutValue("text-rotation-alignment",l);B===h.RotationAlignment.AUTO&&(B=f.getLayoutValue("symbol-placement",l)===h.SymbolPlacement.POINT?h.RotationAlignment.VIEWPORT:h.RotationAlignment.MAP);F=B===h.RotationAlignment.MAP;F=f.getLayoutValue("text-keep-upright",l)&&F;G=.8*3/r;this._glyphTextureSize||(this._glyphTextureSize=g.fromValues(u.width/4,u.height/4));var K=f.getPaintValue("text-translate",
l),O=f.getPaintValue("text-translate-anchor",l),R=D.getMaterialProgram(m,C,this._sdfProgramOptions);if(z&&null!=A&&!R.compiled)A();else{m.useProgram(R);R.setUniformMatrix3fv("u_displayViewMat3",B===h.RotationAlignment.MAP?x.displayViewMat3:x.displayMat3);R.setUniformMatrix3fv("u_displayMat3",O===h.TranslateAnchor.VIEWPORT?x.displayMat3:x.displayViewMat3);R.setUniform2fv("u_textTranslation",K);R.setUniform1f("u_depth",f.z+a);R.setUniform2fv("u_mosaicSize",this._glyphTextureSize);R.setUniform1f("u_mapRotation",
n.degToByte(x.rotation));R.setUniform1f("u_keepUpright",F?1:0);R.setUniform1f("u_level",10*l);R.setUniform1i("u_texture",k.vtlTextureBindingUnitGlyphs);R.setUniform1f("u_antialiasingWidth",G);R.setUniform1f("u_fadeDuration",p.fadeDuration/1E3);D=-1;for(const E of t)E.layerData.has(w)&&(E.key.level!==D&&(D=E.key.level,C.setDataUniforms(R,l,f,D,y)),B=E.layerData.get(w),0!==B.glyphPerPageElementsMap.size&&(B.prepareForRendering(m),B.updateOpacityInfo(),t=B.textVAO,null!=t&&(m.bindVAO(t),R.setUniformMatrix3fv("u_dvsMat3",
E.transforms.displayViewScreenMat3),this._setStencilState(q,E),t=(performance.now()-B.lastOpacityUpdate)/1E3,R.setUniform1f("u_time",t),B.glyphPerPageElementsMap.forEach((J,Q)=>{this._renderGlyphRange(m,J,Q,u,R,H,I,E)}))))}}}}_renderGlyphRange(q,f,t,m,l,u,v,r){m.bind(q,b.TextureSamplingMode.LINEAR,t,k.vtlTextureBindingUnitGlyphs);u&&(l.setUniform1f("u_halo",1),q.drawElements(b.PrimitiveType.TRIANGLES,f[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*f[0]),r.triangleCount+=f[1]/3);v&&(l.setUniform1f("u_halo",
0),q.drawElements(b.PrimitiveType.TRIANGLES,f[1],b.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*f[0]),r.triangleCount+=f[1]/3)}_setStencilState(q,f){const {context:t,is3D:m,stencilSymbols:l}=q;t.setStencilTestEnabled(!0);l?(t.setStencilWriteMask(255),t.setStencilFunction(b.CompareFunction.ALWAYS,f.stencilRef,255)):(t.setStencilWriteMask(0),m?t.setStencilFunction(b.CompareFunction.EQUAL,f.stencilRef,255):t.setStencilFunction(b.CompareFunction.GREATER,255,255))}}e.WGLBrushVTLSymbol=c;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(e){e.collisionGridCellSize=32;e.declutterBudget=1.5;e.declutterTiles=!0;e.fadeDuration=200;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(e){function g(n,d){n%=d;return 0<=n?n:n+d}const p=128/Math.PI,h=256/360,k=1/Math.LN2;e.between=function(n,d,b){return n>=d&&n<=b||
n>=b&&n<=d};e.degToByte=function(n){return g(n*h,256)};e.interpolate=function(n,d,b){return n*(1-b)+d*b};e.log2=function(n){return Math.log(n)*k};e.positiveMod=g;e.radToByte=function(n){return g(n*p,256)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["../enums","./Programs"],function(e,g){class p{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(h=>h.dispose());this._programByKey.clear()}getMaterialProgram(h,
k,n){const d=k.key<<3|this._getMaterialOptionsValue(k.type,n);if(this._programByKey.has(d))return this._programByKey.get(d);var b=this._getProgramTemplate(k.type);({shaders:b}=b);const {vertexShader:a,fragmentShader:c}=b(n);n=k.getShaderHeader();b=k.getShaderMain();n=a.replace("#pragma header",n).replace("#pragma main",b);h=h.programCache.acquire(n,c,k.getAttributeLocations());this._programByKey.set(d,h);return h}_getMaterialOptionsValue(h,k){switch(h){case e.ShaderProgramType.BACKGROUND:return(k.pattern?
1:0)<<1;case e.ShaderProgramType.FILL:return(k.pattern?1:0)<<1;case e.ShaderProgramType.OUTLINE:return 0;case e.ShaderProgramType.LINE:return(k.sdf?1:0)<<2|(k.pattern?1:0)<<1;case e.ShaderProgramType.ICON:return(k.sdf?1:0)<<1;case e.ShaderProgramType.CIRCLE:return 0;case e.ShaderProgramType.TEXT:return 0;default:return 0}}_getProgramTemplate(h){switch(h){case e.ShaderProgramType.BACKGROUND:return g.background;case e.ShaderProgramType.CIRCLE:return g.circle;case e.ShaderProgramType.FILL:return g.fill;
case e.ShaderProgramType.ICON:return g.icon;case e.ShaderProgramType.LINE:return g.line;case e.ShaderProgramType.OUTLINE:return g.outline;case e.ShaderProgramType.TEXT:return g.text;default:return null}}}return p})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(e){e.BucketType=void 0;(function(g){g[g.FILL=1]="FILL";g[g.LINE=2]="LINE";g[g.SYMBOL=3]="SYMBOL";g[g.CIRCLE=4]="CIRCLE"})(e.BucketType||(e.BucketType={}));e.ShaderProgramType=void 0;(function(g){g[g.BACKGROUND=
0]="BACKGROUND";g[g.FILL=1]="FILL";g[g.OUTLINE=2]="OUTLINE";g[g.LINE=3]="LINE";g[g.ICON=4]="ICON";g[g.CIRCLE=5]="CIRCLE";g[g.TEXT=6]="TEXT";g[g.TILEINFO=7]="TILEINFO"})(e.ShaderProgramType||(e.ShaderProgramType={}));e.StyleUpdateType=void 0;(function(g){g[g.PAINTER_CHANGED=0]="PAINTER_CHANGED";g[g.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";g[g.LAYER_CHANGED=2]="LAYER_CHANGED";g[g.LAYER_REMOVED=3]="LAYER_REMOVED";g[g.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(e.StyleUpdateType||(e.StyleUpdateType={}));Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(e,g,p){e.background={shaders:h=>({vertexShader:p.glslifyDefineMap({PATTERN:h.pattern})+g.resolveIncludes("background/background.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:h.pattern})+g.resolveIncludes("background/background.frag")})};e.circle={shaders:h=>({vertexShader:g.resolveIncludes("circle/circle.vert"),
fragmentShader:g.resolveIncludes("circle/circle.frag")})};e.fill={shaders:h=>({vertexShader:p.glslifyDefineMap({PATTERN:h.pattern})+g.resolveIncludes("fill/fill.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:h.pattern})+g.resolveIncludes("fill/fill.frag")})};e.icon={shaders:h=>({vertexShader:p.glslifyDefineMap({SDF:h.sdf})+g.resolveIncludes("icon/icon.vert"),fragmentShader:p.glslifyDefineMap({SDF:h.sdf})+g.resolveIncludes("icon/icon.frag")})};e.line={shaders:h=>({vertexShader:p.glslifyDefineMap({PATTERN:h.pattern,
SDF:h.sdf})+g.resolveIncludes("line/line.vert"),fragmentShader:p.glslifyDefineMap({PATTERN:h.pattern,SDF:h.sdf})+g.resolveIncludes("line/line.frag")})};e.outline={shaders:h=>({vertexShader:g.resolveIncludes("outline/outline.vert"),fragmentShader:g.resolveIncludes("outline/outline.frag")})};e.text={shaders:h=>({vertexShader:g.resolveIncludes("text/text.vert"),fragmentShader:g.resolveIncludes("text/text.frag")})};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports",
"./shaderRepository","../../../../../webgl/ShaderCompiler"],function(e,g,p){const h=new p.ShaderCompiler(function(k){let n=g;k.split("/").forEach(d=>{n&&=n[d]});return n});e.resolveIncludes=function(k){return h.resolveIncludes(k)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d u_opacity * color;\n#else\ngl_FragColor \x3d u_color;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist \x3d length(v_offset);\nmediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_stroke_color \x3d stroke_color * stroke_opacity;\nv_stroke_width \x3d stroke_width;\nv_radius \x3d radius;\nv_blur \x3d max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset \x3d offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\nmediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color \x3d texture2D(u_texture, samplePos);\ngl_FragColor \x3d v_color[3] * color;\n#else\ngl_FragColor \x3d v_color;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include \x3cutil/util.glsl\x3e\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\n#ifdef PATTERN\nfloat patternWidth \x3d nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight \x3d nextPOT(tlbr.w - tlbr.y);\nfloat scaleX \x3d 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY \x3d 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat \x3d mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord \x3d (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             \x3d tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor \x3d v_color;\nfloat d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio \x3d 0.248062016;\nfloat size \x3d max(v_size.x, v_size.y);\nfloat dist \x3d d * softEdgeRatio * size;\nfillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width \x3e 0.25) {\nlowp vec4 outlinePixelColor \x3d u_outlineColor;\nconst float outlineLimitRatio \x3d (16.0 / 86.0);\nfloat clampedOutlineSize \x3d softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor \x3d v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor \x3d v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor \x3d texture2D(u_texture, v_tex);\ngl_FragColor \x3d v_opacity * texColor;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color \x3d color;\nv_opacity \x3d opacity;\n#ifdef SDF\nv_halo_width \x3d halo_width;\n#endif\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *\x3d interpolatedOpacity;\nmediump float a_angle         \x3d a_levelInfo[1];\nmediump float a_minLevel      \x3d a_levelInfo[2];\nmediump float a_maxLevel      \x3d a_levelInfo[3];\nmediump vec2 a_tex            \x3d a_texAngleRange.xy;\nmediump float delta_z \x3d 0.0;\nmediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_opacity, 0.0);\nvec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\nv_size \x3d abs(offset);\n#ifdef SDF\noffset \x3d (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\n}"},
line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include \x3cutil/encoding.glsl\x3e\n#endif\nvoid main()\n{\nmediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\nlowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX \x3d fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color \x3d texture2D(u_texture, texCoord);\ngl_FragColor \x3d alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX \x3d fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY \x3d  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist \x3d d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor \x3d alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor \x3d alpha * v_color;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\nconst mediump float tileCoordRatio \x3d 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth \x3d 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_blur \x3d blur + u_antialiasing;\nv_normal \x3d a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          \x3d tlbr / u_mosaicSize.xyxy;\nv_patternSize   \x3d vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio \x3d width / v_patternSize.y;\n#else\nv_widthRatio \x3d width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth \x3d (width + u_antialiasing) * 0.5;\nmediump vec2 dir \x3d a_dir_normal.xy * scale;\nmediump vec2 offset_ \x3d a_extrude_offset.zw * scale * offset;\nmediump vec2 dist \x3d v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance \x3d a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist \x3d abs(v_normal.y);\nlowp float alpha \x3d smoothstep(1.0, 0.0, dist);\ngl_FragColor \x3d alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color \x3d color * opacity;\nv_normal \x3d a_xnormal;\nmediump vec2 dist \x3d u_outline_width * scale * a_offset;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist \x3d texture2D(u_texture, v_tex).a;\nmediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor \x3d alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nconst float sdfPixel \x3d 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo \x3e 0.5)\n{\nv_color \x3d halo_color * opacity;\nhalo_width *\x3d sdfPixel;\nhalo_blur *\x3d sdfPixel;\n}\nelse\n{\nv_color \x3d color * opacity;\nhalo_width \x3d 0.0;\nhalo_blur \x3d 0.0;\n}\nfloat modded \x3d mod(a_opacityInfo, 128.0);\nfloat targetOpacity \x3d (a_opacityInfo - modded) / 128.0;\nfloat startOpacity \x3d modded / 127.0;\nfloat interpolatedOpacity \x3d clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *\x3d interpolatedOpacity;\nmediump float a_angle       \x3d a_levelInfo[1];\nmediump float a_minLevel    \x3d a_levelInfo[2];\nmediump float a_maxLevel    \x3d a_levelInfo[3];\nmediump vec2 a_tex          \x3d a_texAngleRange.xy;\nmediump float a_visMinAngle    \x3d a_texAngleRange.z;\nmediump float a_visMaxAngle    \x3d a_texAngleRange.w;\nmediump float delta_z \x3d 0.0;\nmediump float angle \x3d mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle \x3c a_visMaxAngle)\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z +\x3d 1.0 - step(a_minLevel, u_level);\ndelta_z +\x3d step(a_maxLevel, u_level);\ndelta_z +\x3d step(v_color[3], 0.0);\nv_tex \x3d a_tex.xy / u_mosaicSize;\nv_edgeDistance \x3d edgePos - halo_width / size;\nv_edgeWidth \x3d (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("exports ../../../../core/maybe ./DefaultVertexAttributeLayouts ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/ProgramTemplate ../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b){class a{constructor(){this._initialized=!1}dispose(){this._program=g.disposeMaybe(this._program);this._vertexArrayObject=g.disposeMaybe(this._vertexArrayObject)}render(c,q,f,t){c&&(this._initialized||this._initialize(c),c.setBlendFunctionSeparate(n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA),c.bindVAO(this._vertexArrayObject),c.useProgram(this._program),q.setSamplingMode(f),c.bindTexture(q,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",t),c.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4),c.bindTexture(null,0),c.bindVAO())}_initialize(c){if(this._initialized)return!0;const q=d.createProgram(c,h.bitBlit);if(!q)return!1;const f=new Int8Array(16);f[0]=-1;f[1]=-1;f[2]=0;f[3]=0;f[4]=1;f[5]=-1;f[6]=1;f[7]=0;f[8]=-1;f[9]=1;f[10]=0;f[11]=1;f[12]=1;f[13]=1;f[14]=1;f[15]=1;c=new b.VertexArrayObject(c,h.bitBlit.attributes,p.PosTex2b,{geometry:k.BufferObject.createVertex(c,n.Usage.STATIC_DRAW,f)});this._program=
q;this._vertexArrayObject=c;return this._initialized=!0}}e.BitBlitRenderer=a;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(e,g){g={shaders:{vertexShader:g.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:g.resolveIncludes("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};e.bitBlit=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/MaterialManager":function(){define(["./shaders/MaterialPrograms"],function(e){class g{constructor(p){this._rctx=p;this._programByKey=new Map}dispose(){this._programByKey.forEach(p=>p.dispose());this._programByKey.clear()}getProgram(p,h=[]){const k=p.vsPath+"."+p.fsPath+JSON.stringify(h);if(this._programByKey.has(k))return this._programByKey.get(k);h={...h.map(a=>"string"===typeof a?{name:a,value:!0}:a).reduce((a,c)=>({...a,[c.name]:c.value}),{})};const {vsPath:n,fsPath:d,
attributes:b}=p;p=e.createProgramTemplate(n,d,b,h);p=this._rctx.programCache.acquire(p.shaders.vertexShader,p.shaders.fragmentShader,p.attributes);if(!p)throw Error("Unable to get program for key: ${key}");this._programByKey.set(k,p);return p}}return g})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(e,g,p){e.createProgramTemplate=(h,k,n,d)=>{h+=h.substring(h.lastIndexOf("/"));k+=k.substring(k.lastIndexOf("/"));
const b={};for(const c in d){let q=void 0;var a=c;q=""+a[0].toUpperCase();for(let f=1;f<a.length;f++){const t=a[f];t===t.toUpperCase()?(q+="_",q+=t):q+=t.toUpperCase()}b[q]=d[c]}d=p.glslifyDefineMap(b);return{attributes:n,shaders:{vertexShader:d+g.resolveIncludes(`${h}.vert`),fragmentShader:d+g.resolveIncludes(`${k}.frag`)}}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define("../../../../config ../../../../request ../../../../core/BidiText ../../../../core/Error ../../../../core/fontUtils ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/string ../../../../symbols/cim/CIMResourceManager ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/Rasterizer ./definitions ./enums ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./Utils ./animatedFormats/AnimatableTextureResource ../../../support/QueueProcessor ../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A,z){function C(B){switch(B.type){case "CIMVectorMarker":case "CIMPictureMarker":return B&&"markerPlacement"in B&&B.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===B.markerPlacement.type;default:return!0}}const D=(B,I,H)=>d.getLogger("esri.views.2d.engine.webgl.TextureManager").error(new h(B,I,H));class F{static fromMosaic(B,I){return new F(B,I.page,I.sdf)}constructor(B,I,H){this.mosaicType=B;this.page=I;this.sdf=H}}class G{constructor(B){this._requestRender=
B;this._resourceManager=new q;this._invalidFontsMap=new Map;this._sdfConverter=new r(m.sdfTextureSize);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._ongoingRasterizations=new Map;this._imageRequestQueue=new A.QueueProcessor({concurrency:10,process:async(I,H)=>{b.throwIfAborted(H);try{return await g(I,{responseType:"image",signal:H})}catch(K){if(!b.isAbortError(K))throw new h("mapview-invalid-resource",`Could not fetch requested resource at ${I}`,K);throw K;}}});this._spriteMosaic=new y(2048,
2048,500);this._glyphSource=new v(`${e.fontsUrl}/{fontstack}/{range}.pbf`);this._glyphMosaic=new u(1024,1024,this._glyphSource);this._rasterizer=new t(this.resourceManager)}dispose(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._sdfConverter.dispose();this._sdfConverter=this._glyphMosaic=this._spriteMosaic=null;this._hashToBindingIndex.clear();this._bindingInfos=this._hashToBindingIndex=null;this._ongoingRasterizations.clear();this._ongoingRasterizations=
null;this._imageRequestQueue.clear();this._imageRequestQueue=null;this._resourceManager.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(B,I){if(null==B)return D("mapview-null-resource","Unable to rasterize null resource"),null;if("cim-rasterization-info"!==B.type)return D("mapview-unexpected-resource","Unable to rasterize resource"),null;({resource:B}=B);if("text"===B.type){I=await this._rasterizeText(B,
I);for(var H of I.glyphs)this._setTextureBinding(l.MosaicType.GLYPH,H);return I}(H=await this._rasterizeSprite(B,I))&&this._setTextureBinding(l.MosaicType.SPRITE,H);return H}getMosaicInfo(B,I,H=!1){B=this._getTextureBindingInfo(B,I,H);return B?{size:B.size,texture:{texture:B.texture,unit:"sprite"===B.type?m.textureBindingSpriteAtlas:m.textureBindingGlyphAtlas}}:(D("mapview-invalid-resource",`Unable to find resource for ${I}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(B,I,
H){var K=this._bindingInfos[I-1];I=K.page;H=H?z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:z.TextureSamplingMode.LINEAR;switch(K.mosaicType){case l.MosaicType.SPRITE:K=this.sprites.getWidth(I);var O=this.sprites.getHeight(I);K=[K,O];B=this._spriteMosaic.getTexture(B,I);B.setSamplingMode(H);return{type:"sprite",texture:B,size:K};case l.MosaicType.GLYPH:return K=[this.glyphs.width,this.glyphs.height],O=this._glyphMosaic.getTexture(B,I),this._glyphMosaic.bind(B,H,I,m.textureBindingGlyphAtlas),O.setSamplingMode(H),
{type:"glyph",texture:O,size:K};default:return D("mapview-texture-manager",`Cannot handle unknown type ${K.mosaicType}`),null}}_hashMosaic(B,I){return 1|B<<1|(I.sdf?1:0)<<2|I.page<<3}_setTextureBinding(B,I){const H=this._hashMosaic(B,I);this._hashToBindingIndex.has(H)||(B=F.fromMosaic(B,I),this._hashToBindingIndex.set(H,this._bindingInfos.length+1),this._bindingInfos.push(B));I.textureBinding=this._hashToBindingIndex.get(H)}async _rasterizeText(B,I){const {font:H,textString:K}=B;B=k.getFullyQualifiedFontName(H);
var O=this._invalidFontsMap.has(B);const [R,E]=p.bidiText(K),J=x.charCodes(R);try{return O=O?"arial-unicode-ms-regular":B,n("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(O),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(O,J,I),isRightToLeft:E}}catch(Q){return D("mapview-invalid-resource",`Couldn't find font ${B}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(B,!0),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",
J,I),isRightToLeft:E}}}_hashSpriteResource(B){switch(B.type){case "path":return`path:${B.path}.${B.asFill?1:0}`;case "CIMPictureMarker":return`${B.type}:${B.url}:${B.size}`;case "CIMPictureFill":return`${B.type}:${B.url}:${B.height}`;case "CIMPictureStroke":return`${B.type}:${B.url}:${B.width}`;case "dash":return`dash:${B.capStyle}.${B.dashTemplate.join("")}`;case "sdf":return`sdf:${JSON.stringify(B.geom)}.${B.asFill?1:0}`;case "fill-style":return`fill_style:${B.style}`;case "animated":return JSON.stringify(x.discardUrlIfHasUrlHash(B));
case "CIMHatchFill":return JSON.stringify(B);case "CIMVectorMarker":return JSON.stringify(B)}}async _rasterizeSprite(B,I){if(!B)return null;const H=c.numericHash(this._hashSpriteResource(B));if(this._spriteMosaic.has(H))return this._spriteMosaic.getSpriteItem(H);if("url"in B&&B.url||"CIMPictureFill"===B.type||"CIMPictureStroke"===B.type||"CIMPictureMarker"===B.type||"CIMVectorMarker"===B.type){const K=[];f.CIMSymbolHelper.fetchResources({type:"CIMPointSymbol",symbolLayers:[B]},this._resourceManager,
K);0<K.length&&await Promise.all(K)}switch(B.type){case "CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===B.markerPlacement?.type?this._rasterizeJSONResource(H,B):this._handleAsyncResource(H,B,I);case "animated":return this._handleAsyncResource(H,B,I);case "CIMPictureFill":case "CIMPictureStroke":case "path":return this._handleAsyncResource(H,B,I);case "sdf":case "dash":case "fill-style":case "CIMVectorMarker":case "CIMHatchFill":return this._rasterizeJSONResource(H,B)}}_rasterizeJSONResource(B,
I){var H=this._rasterizer,K=H.rasterizeJSONResource;a:{switch(I.type){case "fill-style":case "CIMHatchFill":var O=m.patternFillRasterizationScale;break a}O=1}if(H=K.call(H,I,O)){const {size:R,image:E,sdf:J,simplePattern:Q,rasterizationScale:N}=H;return this._addItemToMosaic(B,R,{type:"static",data:E},C(I),J,Q,N)}return null}async _handleAsyncResource(B,I,H){if(this._ongoingRasterizations.has(B))return this._ongoingRasterizations.get(B);I="path"===I.type?this._handleSVG(I,B,H):this._handleImage(I,
B,H);this._ongoingRasterizations.set(B,I);I.finally(()=>this._ongoingRasterizations.delete(B));return I}async _handleSVG(B,I,H){const K=[m.sdfTextureSize,m.sdfTextureSize],{asFill:O}=B;B=await this._sdfConverter.draw(B.path,O,H);return this._addItemToMosaic(I,K,{type:"static",data:new Uint32Array(B.buffer)},!1,!0,!0)}async _handleGIFOrPNG(B,I,H){const K=this.resourceManager.getResource(B.url);if(null==K)return null;const {width:O,height:R}=K;if(K instanceof HTMLImageElement){if("animated"===B.type)return D("mapview-unexpected-resource",
"Attempt to configure animations for a non-animated image."),null;const {size:J,sdf:Q,image:N}=this._rasterizer.rasterizeImageResource(O,R,K,"colorSubstitutions"in B?B.colorSubstitutions:void 0);return this._addItemToMosaic(I,J,{type:"static",data:N},C(B),Q,!1)}let E;"animated"===B.type?(H=!1,E={playAnimation:B.playAnimation,reverseAnimation:B.reverseAnimation,randomizeStartTime:B.randomizeStartTime,randomizeStartSeed:B.randomizeStartSeed,startTimeOffset:B.startTimeOffset,duration:B.duration,repeatType:B.repeatType,
repeatDelay:B.repeatDelay},B=B.startGroup||0):(H=C(B),E={},B=0);B=new w.AnimatableTextureResource(K,this._requestRender,E,B);return this._addItemToMosaic(I,[B.width,B.height],{type:"animated",data:B},H,!1,!1)}async _handleImage(B,I,H){const K=B.url;var O;(O=K&&(K.includes(".gif")||null!=K&&K.startsWith("data:image/gif")))||(O=K&&(K.includes(".png")||null!=K&&K.startsWith("data:image/png")));if(O)return this._handleGIFOrPNG(B,I,H);if("animated"===B.type)return D("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),
null;try{let R;const E=this.resourceManager.getResource(K);if(null!=E&&E instanceof HTMLImageElement)R=E;else{const {data:S}=await this._imageRequestQueue.push(K,{...H});R=S}x.isSVGImage(K)&&("width"in B&&"height"in B?(R.width=a.pt2px(B.width),R.height=a.pt2px(B.height)):"cim"in B&&(R.width=a.pt2px(B.width??B.scaleX*B.size),R.height=a.pt2px(B.size)));if(!R.width||!R.height)return null;const {size:J,sdf:Q,image:N}=this._rasterizer.rasterizeImageResource(R.width,R.height,R,"colorSubstitutions"in B?
B.colorSubstitutions:void 0);return this._addItemToMosaic(I,J,{type:"static",data:N},C(B),Q,!1)}catch(R){if(!b.isAbortError(R))throw new h("mapview-invalid-resource",`Could not fetch requested resource at ${K}. ${R.message}`);throw R;}}_addItemToMosaic(B,I,H,K,O,R,E){return this._spriteMosaic.addSpriteItem(B,I,H,K,O,R,E)}}return G})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(e,g){class p{constructor(){this._resourceMap=new Map;
this._inFlightResourceMap=new Map;this.geometryEnginePromise=this.geometryEngine=null}destroy(){this._inFlightResourceMap.clear();this._resourceMap.clear()}getResource(h){return this._resourceMap.get(h)??null}async fetchResource(h,k){var n=this._resourceMap.get(h);if(n)return{width:n.width,height:n.height};if(n=this._inFlightResourceMap.get(h))return n.then(d=>({width:d.width,height:d.height}));n=g.getImageData(h,k);this._inFlightResourceMap.set(h,n);return n.then(d=>{this._inFlightResourceMap.delete(h);
this._resourceMap.set(h,d);return{width:d.width,height:d.height}},()=>({width:0,height:0}))}deleteResource(h){this._inFlightResourceMap.delete(h);this._resourceMap.delete(h)}loadFont(h){return e.loadFont(h)}}return p})},"esri/symbols/cim/Rasterizer":function(){define(["./CIMSymbolHelper","./rasterizingUtils","./Rect","./SDFHelper","./utils"],function(e,g,p,h,k){class n{constructor(d){this._resourceManager=d;this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){this._cachedRasterizationCanvas||
(this._cachedRasterizationCanvas=document.createElement("canvas"));return this._cachedRasterizationCanvas}rasterizeJSONResource(d,b){switch(d.type){case "dash":const [a,c,q]=g.rasterizeDash(d.dashTemplate,d.capStyle);return{size:[c,q],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};case "fill-style":const [f,t,m,l]=g.rasterizeFillStyle(this._canvas,d,b);return{size:[t,m],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:l};
case "sdf":return this._rasterizeSDFInfo(d);case "CIMHatchFill":case "CIMVectorMarker":case "CIMPictureMarker":return this._rasterizeCIMJSONResource(d,b)}}_rasterizeCIMJSONResource(d,b){switch(d.type){case "CIMHatchFill":return d=e.CIMSymbolHelper.fromCIMHatchFill(d,b),this._rasterizeCIMVectorMarker(d);case "CIMPictureMarker":return d=e.CIMSymbolHelper.fromCIMInsidePolygon(d),this._rasterizeCIMVectorMarker(d);case "CIMVectorMarker":return"CIMMarkerPlacementInsidePolygon"===d.markerPlacement?.type?
(d=e.CIMSymbolHelper.fromCIMInsidePolygon(d),this._rasterizeCIMVectorMarker(d)):(b=h.getSDFInfo(d))&&!d.avoidSDFRasterization?this._rasterizeSDFInfo(b):this._rasterizeCIMVectorMarker(d,!1)}}_rasterizeSDFInfo(d){if(!d)return null;const [b,a,c]=h.buildSDF(d);return b?{size:[a,c],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}_rasterizeCIMVectorMarker(d,b=!0){b=b?p.fromExtent(d.frame):null;const [a,c,q,f,t]=e.CIMSymbolHelper.rasterize(this._canvas,d,b,this._resourceManager);
return a?{size:[c,q],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1,anchorX:f,anchorY:t}:null}rasterizeImageResource(d,b,a,c){this._canvas.width=d;this._canvas.height=b;var q=this._canvas.getContext("2d",{willReadFrequently:!0});a instanceof ImageData?q.putImageData(a,0,0):(a.setAttribute("width",`${d}px`),a.setAttribute("height",`${b}px`),q.drawImage(a,0,0,d,b));a=q.getImageData(0,0,d,b);a=new Uint8Array(a.data);if(c)for(var f of c)if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===
f.newColor.length){const [t,m,l,u]=f.oldColor,[v,r,y,x]=f.newColor;if(t!==v||m!==r||l!==y||u!==x)for(c=0;c<a.length;c+=4)t===a[c]&&m===a[c+1]&&l===a[c+2]&&u===a[c+3]&&(a[c]=v,a[c+1]=r,a[c+2]=y,a[c+3]=x)}for(c=0;c<a.length;c+=4)f=a[c+3]/255,a[c]*=f,a[c+1]*=f,a[c+2]*=f;q=a;f=d;c=b;if(512<=f||512<=c){q=f/c;1<q?(f=512,c=Math.round(512/q)):(c=512,f=Math.round(512*q));q=new Uint8Array(4*f*c);const t=new Uint8ClampedArray(q.buffer);k.resampleHermite(a,d,b,t,f,c,!1)}return{size:[f,c],image:new Uint32Array(q.buffer),
sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}return n})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/mathUtils","./constants"],function(e,g,p,h){e.rasterizeDash=function(k,n){var d="Butt"===n,b="Square"===n;n=!d&&!b;1===k.length%2&&(k=[...k,...k]);const a=h.dashRadius,c=2*a;var q=0;for(var f of k)q+=f;f=Math.round(q*a);q=new Float32Array(f*c);const t=.5*a;let m=0,l=0,u=.5,v=!0;for(var r of k){m=l;for(l+=r*a;u<=l;){for(k=.5;k<c;){const y=n?(k-
a)*(k-a):Math.abs(k-a);q[(k-.5)*f+u-.5]=v?d?Math.max(Math.max(m+t-u,y),Math.max(u-l+t,y)):y:n?Math.min((u-m)*(u-m)+y,(u-l)*(u-l)+y):b?Math.min(Math.max(u-m,y),Math.max(l-u,y)):Math.min(Math.max(u-m+t,y),Math.max(l+t-u,y));k++}u++}v=!v}d=q.length;r=new Uint8Array(4*d);for(b=0;b<d;++b)g.packFloatRGBA((n?Math.sqrt(q[b]):q[b])/a,r,4*b);return[r,f,c]};e.rasterizeFillStyle=function(k,n,d){n=n.style;d=p.nextPowerOfTwo(Math.ceil(d));var b="vertical"===n||"horizontal"===n||"cross"===n||"esriSFSCross"===n||
"esriSFSVertical"===n||"esriSFSHorizontal"===n?8*d:16*d,a=2*d;k.width=b;k.height=b;const c=k.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=d;c.beginPath();if("vertical"===n||"cross"===n||"esriSFSCross"===n||"esriSFSVertical"===n)c.moveTo(b/2,-a),c.lineTo(b/2,b+a);if("horizontal"===n||"cross"===n||"esriSFSCross"===n||"esriSFSHorizontal"===n)c.moveTo(-a,b/2),c.lineTo(b+a,b/2);if("backward-diagonal"===n||"diagonal-cross"===n||"esriSFSDiagonalCross"===n||"esriSFSBackwardDiagonal"===n)c.moveTo(-a,
-a),c.lineTo(b+a,b+a),c.moveTo(b-a,-a),c.lineTo(b+a,a),c.moveTo(-a,b-a),c.lineTo(a,b+a);if("forward-diagonal"===n||"diagonal-cross"===n||"esriSFSForwardDiagonal"===n||"esriSFSDiagonalCross"===n)c.moveTo(b+a,-a),c.lineTo(-a,b+a),c.moveTo(a,-a),c.lineTo(-a,a),c.moveTo(b+a,b-a),c.lineTo(b-a,b+a);c.stroke();n=c.getImageData(0,0,k.width,k.height);n=new Uint8Array(n.data);for(a=0;a<n.length;a+=4)b=n[a+3]/255,n[a]*=b,n[a+1]*=b,n[a+2]*=b;return[n,k.width,k.height,d]};Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports"],function(e){e.dashRadius=15.5;e.maxTileCoordValue=1024;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(e,g,p,h,k,n,d){function b(q){const f=new Set;for(const t of q)f.add(Math.floor(t/
256));return f}function a(q,f,t){q.has(f)||q.set(f,t().then(()=>{q.delete(f)}).catch(m=>{q.delete(f);g.throwIfNotAbortError(m)}));return q.get(f)}class c{constructor(q,f,t){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;this._preloadCache={};this.width=q;this.height=f;this._glyphSource=t;this._binPack=new h(q-4,f-4);this._glyphData.push(new Uint8Array(q*f));this._dirties.push(!0);this._textures.push(null);
this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const q of this._textures)q&&q.dispose();this._textures.length=0;this._glyphData.length=0}_initDecorationGlyphs(){var q=[117,149,181,207,207,181,149,117];const f=[];var t=[];for(let m=0;m<q.length;m++){const l=q[m];for(let u=0;11>u;u++){const v=3<=m&&5>m&&3<=u&&8>u?255:0;f.push(l);t.push(v)}}q={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(f)};t={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};
this._recordGlyph(q);this._recordGlyph(t)}getTexture(q,f){if(!this._textures[f]){const t=new d.TextureDescriptor;t.pixelFormat=k.PixelFormat.ALPHA;t.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE;t.width=this.width;t.height=this.height;this._textures[f]=new n.Texture(q,t,new Uint8Array(this.width*this.height))}this._dirties[f]&&(this._textures[f].setData(this._glyphData[f]),this._dirties[f]=!1);return this._textures[f]}async getGlyphItems(q,f,t){const m=this._getGlyphCache(q);await this._fetchRanges(q,
f,t);return f.map(l=>this._getMosaicItem(m,q,l))}bind(q,f,t,m){t=this.getTexture(q,t);t.setSamplingMode(f);q.bindTexture(t,m)}preloadASCIIGlyphCache(q){var f=this._preloadCache[q];if(null!=f)return f;f=this._glyphSource.preloadASCIIRange(q).then(()=>{const t=this._getGlyphCache(q);for(let m=0;256>m;m++)this._getMosaicItem(t,q,m)});return this._preloadCache[q]=f}_getGlyphCache(q){this._glyphCache[q]||(this._glyphCache[q]={});return this._glyphCache[q]}_invalidate(){this._dirties[this._currentPage]=
!0}async _fetchRanges(q,f,t){const m=[];b(f).forEach(l=>{m.push(this._fetchRange(q,l,t))});await Promise.all(m)}async _fetchRange(q,f,t){if(!(256<f))return a(this._rangePromises,q+f,()=>this._glyphSource.getRange(q,f,t))}_getMosaicItem(q,f,t){if(!q[t]){f=this._glyphSource.getGlyph(f,t);if(!f?.metrics)return{rect:new p(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0};const m=this._recordGlyph(f);q[t]={rect:m,page:this._currentPage,metrics:f.metrics,code:t,sdf:!0};this._invalidate()}return q[t]}_recordGlyph(q){var f=
q.metrics;if(0===f.width)f=new p(0,0,0,0);else{const t=f.width+6,m=f.height+6;f=this._binPack.allocate(t,m);f.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new h(this.width-4,this.height-4),f=this._binPack.allocate(t,m));const l=this._glyphData[this._currentPage];q=q.bitmap;
let u,v;if(q)for(let r=0;r<m;r++){u=t*r;v=this.width*(f.y+r)+f.x;for(let y=0;y<t;y++)l[v+y]=q[u+y]}e("esri-glyph-debug")&&this._showDebugPage(l)}return f}_showDebugPage(q){const f=document.createElement("canvas"),t=f.getContext("2d"),m=new ImageData(this.width,this.height),l=m.data;f.width=this.width;f.height=this.height;f.style.border="1px solid black";for(let u=0;u<q.length;++u)l[4*u]=q[u],l[4*u+1]=0,l[4*u+2]=0,l[4*u+3]=255;t.putImageData(m,0,0);document.body.appendChild(f)}}return c})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["./Rect"],
function(e){class g{constructor(p,h){this._height=this._width=0;this._free=[];this._width=p;this._height=h;this._free.push(new e(0,0,p,h))}get width(){return this._width}get height(){return this._height}allocate(p,h){if(p>this._width||h>this._height)return new e;let k=null,n=-1;for(let d=0;d<this._free.length;++d){const b=this._free[d];p<=b.width&&h<=b.height&&(null===k||b.y<=k.y&&b.x<=k.x)&&(k=b,n=d)}if(null===k)return new e;this._free.splice(n,1);k.width<k.height?(k.width>p&&this._free.push(new e(k.x+
p,k.y,k.width-p,h)),k.height>h&&this._free.push(new e(k.x,k.y+h,k.width,k.height-h))):(k.width>p&&this._free.push(new e(k.x+p,k.y,k.width-p,k.height)),k.height>h&&this._free.push(new e(k.x,k.y+h,p,k.height-h)));return new e(k.x,k.y,p,h)}release(p){for(let h=0;h<this._free.length;++h){const k=this._free[h];if(k.y===p.y&&k.height===p.height&&k.x+k.width===p.x)k.width+=p.width;else if(k.x===p.x&&k.width===p.width&&k.y+k.height===p.y)k.height+=p.height;else if(p.y===k.y&&p.height===k.height&&p.x+p.width===
k.x)k.x=p.x,k.width+=p.width;else if(p.x===k.x&&p.width===k.width&&p.y+p.height===k.y)k.y=p.y,k.height+=p.height;else continue;this._free.splice(h,1);this.release(p)}this._free.push(p)}}return g})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(e,g){class p{constructor(n){this._metrics=[];for(this._bitmaps=[];n.next();)switch(n.tag()){case 1:const d=n.getMessage();for(;d.next();)switch(d.tag()){case 3:const b=d.getMessage();let a,
c,q,f,t,m,l;for(;b.next();)switch(b.tag()){case 1:a=b.getUInt32();break;case 2:c=b.getBytes();break;case 3:q=b.getUInt32();break;case 4:f=b.getUInt32();break;case 5:t=b.getSInt32();break;case 6:m=b.getSInt32();break;case 7:l=b.getUInt32();break;default:b.skip()}b.release();a&&(this._metrics[a]={width:q,height:f,left:t,top:m,advance:l},this._bitmaps[a]=c);break;default:d.skip()}d.release();break;default:n.skip()}}getMetrics(n){return this._metrics[n]}getBitmap(n){return this._bitmaps[n]}}class h{constructor(){this._ranges=
[]}getRange(n){return this._ranges[n]}addRange(n,d){this._ranges[n]=d}}class k{constructor(n){this._glyphInfo={};this._baseURL=n}getRange(n,d,b){const a=this._getFontStack(n);if(a.getRange(d))return Promise.resolve();const c=256*d,q=c+255;n=this._baseURL.replace("{fontstack}",n).replace("{range}",c+"-"+q);return e(n,{responseType:"array-buffer",...b}).then(f=>{a.addRange(d,new p(new g(new Uint8Array(f.data),new DataView(f.data))))})}async preloadASCIIRange(n){const d=this._getFontStack(n);n=this._baseURL.replace("{fontstack}",
n).replace("{range}","0-255");n=await e(n,{responseType:"array-buffer"});n=new p(new g(new Uint8Array(n.data),new DataView(n.data)));for(let b=0;255>=b;b++)d.getRange(b)||d.addRange(b,n)}getGlyph(n,d){if(n=this._getFontStack(n))if(n=n.getRange(Math.floor(d/256)))return{metrics:n.getMetrics(d),bitmap:n.getBitmap(d)}}_getFontStack(n){let d=this._glyphInfo[n];d||=this._glyphInfo[n]=new h;return d}}return k})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../core/floatRGBA","../../../../core/promiseUtils"],
function(e,g){class p{constructor(h){this._svg=null;this.size=h;const k=document.createElement("canvas");k.width=k.height=h;this._context=k.getContext("2d",{willReadFrequently:!1});this._gridOuter=new Float64Array(h*h);this._gridInner=new Float64Array(h*h);this._f=new Float64Array(h);this._d=new Float64Array(h);this._z=new Float64Array(h+1);this._v=new Int16Array(h)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null;this._svg&&(document.body.removeChild(this._svg),
this._svg=null)}draw(h,k,n,d=31){this._initSVG();const b=this.createSVGString(h,k);return new Promise((a,c)=>{const q=new Image;q.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(b);q.onload=()=>{q.onload=null;this._context.clearRect(0,0,this.size,this.size);this._context.drawImage(q,0,0,this.size,this.size);var t=this._context.getImageData(0,0,this.size,this.size);const m=new Uint8Array(this.size*this.size*4);for(let l=0;l<this.size*this.size;l++){const u=t.data[4*l+3]/255;this._gridOuter[l]=
1===u?0:0===u?1E20:Math.max(0,.5-u)**2;this._gridInner[l]=1===u?1E20:0===u?0:Math.max(0,u-.5)**2}this._edt(this._gridOuter,this.size,this.size);this._edt(this._gridInner,this.size,this.size);for(t=0;t<this.size*this.size;t++)e.packFloatRGBA(.5-(this._gridOuter[t]-this._gridInner[t])/(2*d),m,4*t);a(m)};const f=n?.signal;if(f)g.onAbort(f,()=>c(g.createAbortError()))})}_initSVG(){if(!this._svg){const h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("style","position: absolute;");
h.setAttribute("width","0");h.setAttribute("height","0");h.setAttribute("aria-hidden","true");h.setAttribute("role","presentation");document.body.appendChild(h);this._svg=h}return this._svg}createSVGString(h,k){const n=this._initSVG(),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",h);n.appendChild(d);h=d.getBBox();var b=h.width/h.height;const a=this.size/2;let c,q;1<b?(c=a/h.width,q=this.size/4,b=a-1/b*a/2):(c=a/h.height,q=a-a*b/2,b=this.size/4);d.setAttribute("style",
`transform: matrix(${c}, 0, 0, ${c}, ${-h.x*c+q}, ${-h.y*c+b})`);d.setAttribute("stroke-width",`${.5/c}`);k=`<svg style="fill:${k?"red":"none"}; stroke:${k?"none":"red"}" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${n.innerHTML}</svg>`;n.removeChild(d);return k}_edt(h,k,n){const d=this._f,b=this._d,a=this._v,c=this._z;for(var q=0;q<k;q++){for(var f=0;f<n;f++)d[f]=h[f*k+q];this._edt1d(d,b,a,c,n);for(f=0;f<n;f++)h[f*k+q]=b[f]}for(q=0;q<n;q++){for(f=0;f<k;f++)d[f]=
h[q*k+f];this._edt1d(d,b,a,c,k);for(f=0;f<k;f++)h[q*k+f]=Math.sqrt(b[f])}}_edt1d(h,k,n,d,b){n[0]=0;d[0]=-1E20;d[1]=1E20;for(let a=1,c=0;a<b;a++){let q=(h[a]+a*a-(h[n[c]]+n[c]*n[c]))/(2*a-2*n[c]);for(;q<=d[c];)c--,q=(h[a]+a*a-(h[n[c]]+n[c]*n[c]))/(2*a-2*n[c]);c++;n[c]=a;d[c]=q;d[c+1]=1E20}for(let a=0,c=0;a<b;a++){for(;d[c+1]<a;)c++;k[a]=(a-n[c])*(a-n[c])+h[n[c]]}}}return p})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("../../../../core/Error ../../../../core/has ./definitions ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d,b,a){function c(m){return m&&"static"===m.type}function q(m,l){const u=new a.TextureDescriptor;u.width=l[0];u.height=l[1];u.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;return new b.Texture(m,u,null)}class f{constructor(m,l,u=0){this._mosaicPages=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=m||0>=l)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");
this._pageWidth=m;this._pageHeight=l;0<u&&(this._maxItemSize=u);this.pixelRatio=window.devicePixelRatio||1;this._binPack=new n(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(m){return m>=this._mosaicPages.length?-1:this._mosaicPages[m].size[0]}getHeight(m){return m>=this._mosaicPages.length?-1:this._mosaicPages[m].size[1]}getPageTexture(m){return m<
this._mosaicPages.length?this._mosaicPages[m].texture:null}has(m){return this._mosaicRects.has(m)}get itemCount(){return this._mosaicRects.size}getSpriteItem(m){return this._mosaicRects.get(m)}addSpriteItem(m,l,u,v,r,y,x=1){if(this._mosaicRects.has(m))return this._mosaicRects.get(m);let w,A,z;c(u)?[w,A,z]=this._allocateImage(l[0],l[1]):(w=new k(0,0,l[0],l[1]),A=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:u,size:[l[0]+2*p.spritePadding,l[1]+2*p.spritePadding],dirty:!0,texture:void 0}));
if(0>=w.width||0>=w.height)return null;y={type:"sprite",rect:w,width:l[0],height:l[1],sdf:r,simplePattern:y,rasterizationScale:x,page:A};this._mosaicRects.set(m,y);c(u)&&(g("esri-mosaic-debug")&&this._showDebugSprite(l,u.data),this._copy({rect:w,spriteSize:l,spriteData:u.data,page:A,pageSize:z,repeat:v,sdf:r}));return y}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const m=this._spriteCopyQueue.pop();m&&this._copy(m)}getMosaicItemPosition(m){m=this.getSpriteItem(m);
const l=m?.rect;if(!l)return null;l.width=m.width;l.height=m.height;const u=p.spritePadding,v=this._mosaicPages[m.page].size;return{size:[m.width,m.height],tl:[(l.x+u)/v[0],(l.y+u)/v[1]],br:[(l.x+u+m.width)/v[0],(l.y+u+m.height)/v[1]],page:m.page}}bind(m,l,u=0,v=0){const r=this._mosaicPages[u],y=r.mosaicsData;let x=r.texture;x||(x=q(m,r.size),r.texture=x);x.setSamplingMode(l);c(y)?(m.bindTexture(x,v),r.dirty&&(x.setData(new Uint8Array(y.data.buffer)),x.generateMipmap(),g("esri-mosaic-debug")&&this._showDebugPage(u))):
(y.data.loadFrame(x),m.bindTexture(x,v),x.generateMipmap());r.dirty=!1}getTexture(m,l=0){const u=this._mosaicPages[l],v=u.mosaicsData;let r=u.texture;r||(r=q(m,u.size),u.texture=r);c(v)?u.dirty&&(r.setData(new Uint8Array(v.data.buffer)),r.generateMipmap(),g("esri-mosaic-debug")&&this._showDebugPage(l)):(v.data.loadFrame(r),r.generateMipmap());u.dirty=!1;return r}dispose(){this._binPack=null;for(const l of this._mosaicPages){var m=l.texture;m&&m.dispose();m=l.mosaicsData;c(m)||m.data.destroy()}this._mosaicPages=
null;this._mosaicRects.clear()}static _copyBits(m,l,u,v,r,y,x,w,A,z,C){let D=v*l+u;x=w*y+x;if(C)for(x-=y,C=-1;C<=z;C++,D=((C+z)%z+v)*l+u,x+=y)for(w=-1;w<=A;w++)r[x+w]=m[D+(w+A)%A];else for(u=0;u<z;u++){for(v=0;v<A;v++)r[x+v]=m[D+v];D+=l;x+=y}}_copy(m){if(!(m.page>=this._mosaicPages.length)){var l=this._mosaicPages[m.page],u=l.mosaicsData;if(!c(l.mosaicsData))throw new e("mapview-invalid-resource","unsuitable data type!");var v=m.spriteData;(u=u.data)&&v||console.error("Source or target images are uninitialized!");
f._copyBits(v,m.spriteSize[0],0,0,u,m.pageSize[0],m.rect.x+p.spritePadding,m.rect.y+p.spritePadding,m.spriteSize[0],m.spriteSize[1],m.repeat);l.dirty=!0}}_allocateImage(m,l){m+=2*p.spritePadding;l+=2*p.spritePadding;var u=Math.max(m,l);if(this._maxItemSize&&this._maxItemSize<u){u=2**Math.ceil(h.log2(m));const v=2**Math.ceil(h.log2(l));m=new k(0,0,m,l);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(u*v)},size:[u,v],dirty:!0,texture:void 0});return[m,this._mosaicPages.length-
1,[u,v]]}u=this._binPack.allocate(m,l);return 0>=u.width?(u=this._mosaicPages[this._currentPage],!u.dirty&&c(u.mosaicsData)&&(u.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new n(this._pageWidth,this._pageHeight),this._allocateImage(m,l)):[u,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([m,
l],u){const v=document.createElement("canvas");v.width=m;v.height=l;v.setAttribute("style",`position: absolute; top: ${4+204*t++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const r=v.getContext("2d");m=new ImageData(m,l);m.data.set(new Uint8Array(u.buffer));r.putImageData(m,0,0);document.body.appendChild(v)}_showDebugPage(m){const {size:[l,u],mosaicsData:v}=this._mosaicPages[m];if(c(v)){var r=`mosaicDebugPage${m}`,y=document.getElementById(r)??document.createElement("canvas");
y.id=r;y.width=l;y.height=u;y.setAttribute("style",`position: absolute; top: ${4+204*m}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);m=y.getContext("2d");r=new ImageData(l,u);r.data.set(new Uint8Array(v.data.buffer));m.putImageData(r,0,0);document.body.appendChild(y)}else console.error("Could not show sprite mosaic debug for non-static resource")}}let t=0;return f})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports","../definitions",
"./utils"],function(e,g,p){class h{constructor(k,n,d,b){this._animation=k;this._frameData=null;this.frameCount=this._animation.frameDurations.length;this.width=this._animation.width;this.height=this._animation.height;this._playHandle=p.play(this._animation,d,b,a=>{this._frameData=a;n.requestRender()})}destroy(){this._playHandle.remove()}loadFrame(k){const n=this._frameData;null!=n&&(k.updateData(0,g.spritePadding,g.spritePadding,"width"in n?n.width:n.codedWidth,"height"in n?n.height:n.codedHeight,
n),this._frameData=null)}}e.AnimatableTextureResource=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define("exports ../../../../../core/handleUtils ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ../../../../../symbols/cim/enums ../grouping".split(" "),function(e,g,p,h,k,n){function d(u){return p.Milliseconds(u.frameDurations.reduce((v,r)=>v+r,0))}function b(u){const {width:v,
height:r}=u,y=u.frameDurations.reverse();return{frameCount:u.frameCount,duration:u.duration,frameDurations:y,getFrame:x=>u.getFrame(u.frameDurations.length-1-x),width:v,height:r}}function a(u,v){const {width:r,height:y,getFrame:x}=u,w=v/u.duration;v=u.frameDurations.map(A=>p.Milliseconds(A*w));return{frameCount:u.frameCount,duration:u.duration,frameDurations:v,getFrame:x,width:r,height:y}}function c(u,v){const {width:r,height:y,getFrame:x}=u,w=u.frameDurations.slice(),A=w.shift();w.unshift(p.Milliseconds(A+
v));return{frameCount:u.frameCount,duration:u.duration+v,frameDurations:w,getFrame:x,width:r,height:y}}function q(u,v){const {width:r,height:y,getFrame:x}=u,w=u.frameDurations.slice(),A=w.pop();w.push(p.Milliseconds(A+v));return{frameCount:u.frameCount,duration:u.duration+v,frameDurations:w,getFrame:x,width:r,height:y}}function f(u,v,r,y){let {repeatType:x}=v;null==x&&(x=k.AnimatedSymbolRepeatType.Loop);!0===v.reverseAnimation&&(u=b(u));null!=v.duration&&(u=a(u,p.Milliseconds(1E3*v.duration)));if(null!=
v.repeatDelay){const w=1E3*v.repeatDelay;x===k.AnimatedSymbolRepeatType.Loop?u=q(u,p.Milliseconds(w)):x===k.AnimatedSymbolRepeatType.Oscillate&&(u=c(q(u,p.Milliseconds(w/2)),p.Milliseconds(w/2)))}null!=v.startTimeOffset?v=p.Milliseconds(1E3*v.startTimeOffset):null!=v.randomizeStartTime?(v=n.getRandomValue(r,null!=v.randomizeStartSeed?v.randomizeStartSeed:82749913),v=p.Milliseconds(v*d(u))):v=p.Milliseconds(0);return new t(u,v,x,y)}class t{constructor(u,v,r,y){this._animation=u;this._repeatType=r;
this._onFrameData=y;this._direction=1;this._currentFrame=0;this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(u=0;v>u;)u+=this.timeToFrame,this.nextFrame();v=this._animation.getFrame(this._currentFrame);this._onFrameData(v)}nextFrame(){this._currentFrame+=this._direction;if(0<this._direction){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case k.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case k.AnimatedSymbolRepeatType.Loop:this._currentFrame=
0;break;case k.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case k.AnimatedSymbolRepeatType.None:this._currentFrame-=this._direction;break;case k.AnimatedSymbolRepeatType.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case k.AnimatedSymbolRepeatType.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];
const u=this._animation.getFrame(this._currentFrame);this._onFrameData(u)}}let m,l;e.Player=t;e.adjustDuration=a;e.appendDelay=q;e.createPlayer=f;e.getDuration=d;e.play=function(u,v,r,y){function x(){C=w?setTimeout(()=>{A.nextFrame();z=A.timeToFrame;x()},z):void 0}const w=null!=v.playAnimation?v.playAnimation:!0,A=f(u,v,r,y);let z=A.timeToFrame,C;x();return g.makeHandle(()=>w&&clearTimeout(C))};e.prependDelay=c;e.resize=function(u,v,r){m??=document.createElement("canvas");l??=m.getContext("2d");const {canvas:y,
ctx:x}={canvas:m,ctx:l};y.width=v;y.height=r;const w=[],A=u.frameDurations.length;for(let z=0;z<A;z++){const C=u.getFrame(z);x.clearRect(0,0,v,r);C instanceof ImageData?x.drawImage(h.imageTypeToCanvas(C),0,0,v,r):x.drawImage(C,0,0,v,r);w.push(x.getImageData(0,0,v,r))}return{width:v,height:r,frameDurations:u.frameDurations,getFrame:z=>w[z],frameCount:u.frameCount,duration:u.duration}};e.reverse=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/exporters/gltf/imageutils":function(){define(["exports",
"../../../../../core/has","../../../../../core/Error","../../../../../core/urlUtils"],function(e,g,p,h){async function k(d){if(!(d instanceof HTMLImageElement))return"image/png";d=d.src;return h.isDataProtocol(d)?(d=h.dataComponents(d),"image/jpeg"===d?.mediaType?d.mediaType:"image/png"):/\.png$/i.test(d)?"image/png":/\.(jpg|jpeg)$/i.test(d)?"image/jpeg":"image/png"}function n(d){if(d instanceof HTMLCanvasElement)return d;if(d instanceof HTMLVideoElement)return null;const b=document.createElement("canvas");
b.width=d.width;b.height=d.height;const a=b.getContext("2d");d instanceof HTMLImageElement?a.drawImage(d,0,0,d.width,d.height):d instanceof ImageData&&a.putImageData(d,0,0);return b}e.encodeBase64DataUri=function(d){const b=[];d=new Uint8Array(d);for(let a=0;a<d.length;a++)b.push(String.fromCharCode(d[a]));return"data:application/octet-stream;base64,"+btoa(b.join(""))};e.imageToArrayBuffer=async function(d){const b=n(d);if(null==b)throw new p("imageToArrayBuffer","Unsupported image type");const a=
await k(d);d=await new Promise(c=>b.toBlob(c,a));if(!d)throw new p("imageToArrayBuffer","Failed to encode image");return{data:await d.arrayBuffer(),type:a}};e.imageToDataURI=function(d){d=n(d);return null!=d?d.toDataURL():""};e.imageTypeToCanvas=n;e.isArrayBufferPNG=function(d){if(8>d.byteLength)return!1;d=new Uint8Array(d);return 137===d[0]&&80===d[1]&&78===d[2]&&71===d[3]&&13===d[4]&&10===d[5]&&26===d[6]&&10===d[7]};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports",
"../../../../core/string"],function(e,g){function p(h,k){if("string"===typeof h)h=g.numericHash(h+`-seed(${k})`);else{let n=12;h^=k;do h=107*(h>>8^h)+n|0;while(0!==--n)}return(1+h/-2147483648)/2}e.getRandomValue=p;e.getStartGroup=function(h){return Math.floor(10*p(h,53290320))};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../core/promiseUtils","./definitions"],function(e,g,p){class h{constructor(k){this._queue=
[];this._refreshable=k}destroy(){this._queue=[]}enqueueTextureUpdate(k,n){const d=g.createResolver(),b=p.textureUploadManagerChunkSize,a=Math.ceil(k.height/b);g.throwIfAborted(n);for(let c=0;c<a;c++){const q=c===a-1;this._queue.push({type:"chunk",request:k,resolver:d,chunk:c,chunkOffset:c*b,destHeight:q?k.height-b*c:b,chunkIsLast:q,options:n})}g.onAbortOrThrow(n,c=>d.reject(c));return d.promise}upload(){let k=0;for(;this._queue.length;){var n=performance.now();const d=this._queue.shift();if(d&&(null==
d.options.signal||!d.options.signal.aborted)){switch(d.type){case "chunk":this._uploadChunk(d);break;case "no-chunk":this._uploadNoChunk(d)}n=performance.now()-n;k+=n;if(k+n>=p.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(k){const {request:n,resolver:d,chunkOffset:b,chunkIsLast:a,destHeight:c}=k,{data:q,texture:f,width:t}=n;null!=q&&(f.updateData(0,0,b,t,c,q,b),a&&d.resolve())}_uploadNoChunk(k){const {request:n,resolver:d}=k,{data:b,texture:a}=
n;a.setData(b);d.resolve()}}e.TextureUploadManager=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define("exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/common ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./VertexStream ./shaders/StencilPrograms ../../../webgl/enums ../../../webgl/ProgramTemplate".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f){const t=n.fromValues(-.5,-.5);class m{constructor(){this._centerNdc=b.create();this._pxToNdc=b.create();this._worldDimensionsPx=b.create();this._mat3=k.create();this._initialized=!1}dispose(){this._program=g.disposeMaybe(this._program);this._quad=g.disposeMaybe(this._quad)}render(l,u,v){const {context:r}=l;l=this._updateGeometry(l,v);if(null!=u){const {r:y,g:x,b:w,a:A}=u;r.setClearColor(A*y/255,A*x/255,A*w/255,A)}else r.setClearColor(0,0,0,0);r.setStencilFunction(q.CompareFunction.ALWAYS,
0,255);r.setStencilWriteMask(255);l?(r.setClearStencil(0),r.clear(r.gl.STENCIL_BUFFER_BIT|r.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(r),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setColorMask(!1,!1,!1,!1),r.setBlendingEnabled(!1),r.setStencilOp(q.StencilOperation.KEEP,q.StencilOperation.KEEP,q.StencilOperation.REPLACE),r.setStencilFunction(q.CompareFunction.ALWAYS,1,255),r.setStencilTestEnabled(!0),r.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",
this._mat3),this._quad.draw(),this._quad.unbind()):(r.setClearStencil(1),r.clear(r.gl.STENCIL_BUFFER_BIT|r.gl.COLOR_BUFFER_BIT))}_initialize(l){if(!this._initialized){var u=f.createProgram(l,c.stencil);u&&(this._program=u,this._quad=new a(l,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}_updateGeometry(l,u){const {state:v,pixelRatio:r}=l,{size:y,rotation:x}=v,w=Math.round(y[0]*r),A=Math.round(y[1]*r);if(!v.spatialReference.isWrappable)return!1;l=p.toRadian(x);const z=Math.abs(Math.cos(l)),C=Math.abs(Math.sin(l)),
D=Math.round(v.worldScreenWidth);if(Math.round(w*z+A*C)<=D)return!1;const F=(u.left-u.right)*r/w;u=(u.bottom-u.top)*r/A;d.set(this._worldDimensionsPx,D*r,w*C+A*z,1);d.set(this._pxToNdc,2/w,-2/A,1);d.set(this._centerNdc,F,u,1);u=this._mat3;h.fromTranslation(u,this._centerNdc);h.scale(u,u,this._pxToNdc);0!==x&&h.rotate(u,u,l);h.scale(u,u,this._worldDimensionsPx);h.translate(u,u,t);return!0}}e.WorldExtentRenderer=m;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports",
"./sources/resolver"],function(e,g){g={shaders:{vertexShader:g.resolveIncludes("stencil/stencil.vert"),fragmentShader:g.resolveIncludes("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};e.stencil=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define(["exports","../../../../../core/has","../definitions","../VertexStream","./Effect"],function(e,g,p,h,k){class n extends k.Effect{constructor(){super(...arguments);
this.defines=[];this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(d,b){if(b?.size){var {context:a,renderingOptions:c}=d;this._quad||(this._quad=new h(a,[0,0,1,0,0,1,1,1]));var q=a.getBoundFramebufferObject(),{x:f,y:t,width:m,height:l}=a.getViewport(),u=b.getBlock(p.AttributeDataType.Animation);if(null!=u){var v=b.getUniforms(a);a.setViewport(0,0,b.size,b.size);b=v.filterFlags;var r=v.animation,
y=g("featurelayer-animation-enabled")?c.labelsAnimationTime:1;v=u.getFBO(a,1);a.unbindTexture(v.colorTexture);this._computeDelta(d,v,r,b,y);u=u.getFBO(a);a.unbindTexture(u.colorTexture);this._updateAnimationState(d,v,u);a.bindFramebuffer(q);a.setViewport(f,t,m,l)}}}_computeDelta(d,b,a,c,q){const {context:f,painter:t,displayLevel:m}=d,l=t.materialManager.getProgram(this._desc,["delta"]);f.bindFramebuffer(b);f.setColorMask(!0,!0,!0,!0);f.setClearColor(0,0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT);f.useProgram(l);
if(!("type"in c.texture&&"type"in a.texture))throw Error("InternalError: Expected to find texture");f.bindTexture(c.texture,c.unit);f.bindTexture(a.texture,a.unit);l.setUniform1i("u_maskTexture",c.unit);l.setUniform1i("u_sourceTexture",a.unit);l.setUniform1f("u_timeDelta",d.deltaTime);l.setUniform1f("u_animationTime",q);l.setUniform1f("u_zoomLevel",Math.round(10*m));this._quad.draw()}_updateAnimationState(d,b,a){const {context:c,painter:q}=d;d=q.materialManager.getProgram(this._desc,["update"]);c.bindTexture(b.colorTexture,
1);c.useProgram(d);d.setUniform1i("u_sourceTexture",1);c.bindFramebuffer(a);c.setColorMask(!0,!0,!0,!0);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT);this._quad.draw()}}e.AnimationEffect=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports"],function(e){class g{constructor(){this.name=this.constructor.name}createOptions(p,h){return null}}e.Effect=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../enums ../VertexStream ../shaders/BlendPrograms ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),function(e,g,p,h,k,n,d,b,a,c){const q=()=>p.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class f{constructor(){this._size=[0,0]}dispose(t){this._backBufferTexture=h.disposeMaybe(this._backBufferTexture);
this._quad=h.disposeMaybe(this._quad)}draw(t,m,l,u,v){const {context:r,drawPhase:y}=t;this._setupShader(r);u&&"normal"!==u&&y!==k.WGLDrawPhase.LABEL?this._drawBlended(t,m,l,u,v):(t=d.createProgramTemplate("normal"),(t=r.programCache.acquire(t.shaders.vertexShader,t.shaders.fragmentShader,t.attributes))?(r.useProgram(t),m.setSamplingMode(l),r.bindTexture(m,0),t.setUniform1i("u_layerTexture",0),t.setUniform1f("u_opacity",v),r.setBlendingEnabled(!0),r.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA),
m=this._quad,m.draw(),m.unbind(),t.dispose()):q().error(new g("mapview-BlendEffect",'Error creating shader program for blend mode "normal"')))}_drawBlended(t,m,l,u,v){const {context:r,state:y,pixelRatio:x,inFadeTransition:w}=t;var {size:A}=y,z=r.getBoundFramebufferObject();let C;null!=z?(C=z.width,A=z.height):(C=Math.round(x*A[0]),A=Math.round(x*A[1]));this._createOrResizeTexture(t,C,A);t=this._backBufferTexture;z.copyToTexture(0,0,C,A,0,0,t);r.setStencilTestEnabled(!1);r.setStencilWriteMask(0);r.setBlendingEnabled(!0);
r.setDepthTestEnabled(!1);r.setDepthWriteEnabled(!1);z=d.createProgramTemplate(u);(z=r.programCache.acquire(z.shaders.vertexShader,z.shaders.fragmentShader,z.attributes))?(r.useProgram(z),t.setSamplingMode(l),r.bindTexture(t,0),z.setUniform1i("u_backbufferTexture",0),m.setSamplingMode(l),r.bindTexture(m,1),z.setUniform1i("u_layerTexture",1),z.setUniform1f("u_opacity",v),z.setUniform1f("u_inFadeOpacity",w?1:0),r.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ZERO),m=this._quad,m.draw(),m.unbind(),
z.dispose(),r.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA)):q().error(new g("mapview-BlendEffect",`Error creating shader program for blend mode ${u}`))}_setupShader(t){this._quad||(this._quad=new n(t,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(t,m,l){({context:t}=t);if(null===this._backBufferTexture||m!==this._size[0]||l!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(m,l);else{const u=new c.TextureDescriptor;u.internalFormat=b.PixelFormat.RGBA;
u.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;u.width=m;u.height=l;this._backBufferTexture=new a.Texture(t,u)}this._size[0]=m;this._size[1]=l}}}e.BlendEffect=f;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BlendPrograms":function(){define(["exports","./sources/resolver"],function(e,g){e.createProgramTemplate=function(p){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:`#define ${p.replace("-","_").toUpperCase()}\n`+g.resolveIncludes("blend/blend.vert"),
fragmentShader:`#define ${p.replace("-","_").toUpperCase()}\n`+g.resolveIncludes("blend/blend.frag")}}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports","./Effect","../../../../webgl/enums"],function(e,g,p){class h extends g.Effect{constructor(k){super();this.name=this.constructor.name;this.defines=[k]}dispose(){}bind({context:k,painter:n}){this._prev=k.getBoundFramebufferObject();n=n.getFbos().effect0;
k.bindFramebuffer(n);k.setColorMask(!0,!0,!0,!0);k.setClearColor(0,0,0,0);k.clear(k.gl.COLOR_BUFFER_BIT)}unbind(){}draw(k,n){const {context:d,painter:b}=k;n=b.getPostProcessingEffects(n);const a=d.getBoundFramebufferObject();for(const {postProcessingEffect:c,effect:q}of n)c.draw(k,a,q);d.bindFramebuffer(this._prev);d.setStencilTestEnabled(!1);b.blitTexture(d,a.colorTexture,p.TextureSamplingMode.NEAREST);d.setStencilTestEnabled(!0)}}e.FeatureEffect=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("../../../../../core/has ../BitBlitRenderer ./Effect ./highlight/HighlightRenderer ./highlight/HighlightSurfaces ../../../../webgl/enums".split(" "),function(e,g,p,h,k,n){class d extends p.Effect{constructor(){super(...arguments);this.defines=["highlight"];this._hlRenderer=new h;this._height=this._width=void 0;this._boundFBO=null;this._hlSurfaces=new k;this._adjustedHeight=this._adjustedWidth=void 0;this._blitRenderer=new g.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose();
this._hlRenderer?.dispose();this._boundFBO=null}bind(b){const {context:a,painter:c}=b,{width:q,height:f}=a.getViewport(),t=c.getFbos().effect0;this.setup(b,q,f);a.bindFramebuffer(t);a.setColorMask(!0,!0,!0,!0);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:b},a,c){this._width=a;this._height=c;const q=a%4,f=c%4;a+=2>q?-q:4-q;c+=2>f?-f:4-f;this._adjustedWidth=a;this._adjustedHeight=c;this._boundFBO=b.getBoundFramebufferObject();a=Math.round(1*a);c=Math.round(1*c);this._hlRenderer.setup(b,
a,c);this._hlSurfaces.setup(b,a,c)}draw(b){const {context:a,passOptions:c}=b;b=c.activeGradient;const q=a.getBoundFramebufferObject();a.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,q.colorTexture,n.TextureSamplingMode.NEAREST,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!0);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);
a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setColorMask(!0,!0,!0,!0);a.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,b);this._boundFBO=
null}}return d})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("../../definitions ./parameters ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/enums ../../../../../webgl/ProgramTemplate ../../../../../webgl/VertexArrayObject ../../../../../webgl/VertexElementDescriptor".split(" "),function(e,g,p,h,k,n,d,b){class a{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),
this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(c,q){c.bindTexture(q,e.textureBindingHighlight0);c.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",g.alphaToRgbaChannelSelectorMatrix);c.bindVAO(this._resources.quadVAO);c.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);
c.bindVAO()}finalBlur(c,q){c.bindTexture(q,e.textureBindingHighlight0);c.useProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",g.rgbaToRgbaChannelSelectorMatrix);c.bindVAO(this._resources.quadVAO);c.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);c.bindVAO()}renderHighlight(c,q,f){c.bindTexture(q,e.textureBindingHighlight0);c.useProgram(this._resources.highlightProgram);
f.applyHighlightOptions(c,this._resources.highlightProgram);c.bindVAO(this._resources.quadVAO);c.setBlendingEnabled(!0);c.setBlendFunction(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);c.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4);c.bindVAO()}_initialize(c,q,f){this._width=q;this._height=f;q=h.BufferObject.createVertex(c,k.Usage.STATIC_DRAW,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);f=new d.VertexArrayObject(c,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new b.VertexElementDescriptor("a_position",
2,k.DataType.BYTE,0,4),new b.VertexElementDescriptor("a_texcoord",2,k.DataType.UNSIGNED_BYTE,2,4)]},{geometry:q});const t=n.createProgram(c,p.highlight),m=n.createProgram(c,p.blur);c.useProgram(t);t.setUniform1i("u_texture",e.textureBindingHighlight0);t.setUniform1i("u_shade",e.textureBindingHighlight1);t.setUniform1f("u_sigma",g.sigma);c.useProgram(m);m.setUniform1i("u_texture",e.textureBindingHighlight0);m.setUniform1f("u_sigma",g.sigma);this._resources={quadGeometry:q,quadVAO:f,highlightProgram:t,
blurProgram:m}}setup(c,q,f){this._resources?(this._width=q,this._height=f):this._initialize(c,q,f)}}return a})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],function(e,g){const p={shaders:{vertexShader:g.resolveIncludes("highlight/textured.vert"),fragmentShader:g.resolveIncludes("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};g={shaders:{vertexShader:g.resolveIncludes("highlight/textured.vert"),fragmentShader:g.resolveIncludes("highlight/blur.frag")},
attributes:new Map([["a_position",0],["a_texcoord",1]])};e.blur=g;e.highlight=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["../../../../../webgl/enums","../../../../../webgl/FramebufferObject","../../../../../webgl/RenderbufferDescriptor","../../../../../webgl/TextureDescriptor"],function(e,g,p,h){function k(d,b,a){const c=new h.TextureDescriptor(b,a);c.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;
return new g.FramebufferObject(d,c,new p.RenderbufferDescriptor(e.RenderbufferFormat.STENCIL_INDEX8,b,a))}class n{constructor(){this._height=this._width=void 0;this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(d,b,a){this._width=b;this._height=a;const c=k(d,b,a);d=k(d,b,a);this._resources={sharedBlur1Fbo:c,sharedBlur2Fbo:d}}setup(d,b,a){!this._resources||this._width===b&&this._height===
a||this.dispose();this._resources||this._initialize(d,b,a)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}return n})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports","../definitions","./Effect","../../../../webgl/enums"],function(e,g,p,h){class k extends p.Effect{constructor(){super(...arguments);
this.name=this.constructor.name;this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:n},d,b=g.hittestRadius){if(!d.length)return null;d=d.shift();const a=d.x,c=d.y;this._outstanding=d;return{type:"hittest",distance:b*n,smallSymbolDistance:0,smallSymbolSizeThreshold:3,position:[a,c]}}bind(n){const {context:d,attributeView:b}=n;b.size&&(n=b.getBlock(g.AttributeDataType.GPGPU),null!=n&&(n=n.getFBO(d),d.setViewport(0,0,b.size,b.size),d.bindFramebuffer(n),d.setColorMask(!0,
!0,!0,!0),d.setClearColor(0,0,0,0),d.clear(d.gl.COLOR_BUFFER_BIT|d.gl.DEPTH_BUFFER_BIT)))}unbind(){}draw(n){if(null!=this._outstanding){var d=this._outstanding;this._outstanding=null;this._resolve(n,d.resolvers)}}async _resolve(n,d){const {context:b,attributeView:a}=n;n=a.getBlock(g.AttributeDataType.GPGPU);if(null==n)d.forEach(f=>f.resolve([]));else{var c=n.getFBO(b);n=new Uint8Array(c.width*c.height*4);try{await c.readPixelsAsync(0,0,c.width,c.height,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,
n)}catch(f){d.forEach(t=>t.resolve([]));return}var q=[];for(c=0;c<n.length;c+=4){const f=c/4;n[c]&&q.push(f)}d.forEach(f=>f.resolve(q))}}}e.HittestEffect=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HittestEffectVTL":function(){define(["exports","../definitions","./Effect","../../../../webgl/enums"],function(e,g,p,h){class k extends p.Effect{constructor(){super(...arguments);this.name=this.constructor.name;this.defines=["id"];this._lastSize=
0;this._boundFBO=null}dispose(){null!=this._fbo&&this._fbo.dispose()}bind({context:n,painter:d}){this._boundFBO=n.getBoundFramebufferObject();d=d.getFbos().effect0;n.bindFramebuffer(d);n.setColorMask(!0,!0,!0,!0);n.setClearColor(0,0,0,0);n.clear(n.gl.COLOR_BUFFER_BIT)}unbind({context:n}){n.bindFramebuffer(this._boundFBO);this._boundFBO=null}draw(n,d,b=2*g.hittestRadius){this._resolve(n,d,b)}async _resolve({context:n,state:d,pixelRatio:b},a,c){const q=n.getBoundFramebufferObject(),f=d.size[1]*b,t=
Math.round(c*b),m=t/2,l=t/2;this._ensureBuffer(t);a.forEach(async(u,v)=>{var r=new Map;await q.readPixelsAsync(Math.floor(v.x*b-t/2),Math.floor(f-v.y*b-t/2),t,t,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,this._buf);for(let w=0;w<this._buf32.length;w++){const A=this._buf32[w];if(4294967295!==A&&0!==A){var y=w%t,x=t-Math.floor(w/t);y=(m-y)*(m-y)+(l-x)*(l-x);x=r.has(A)?r.get(A):4294967295;r.set(A,Math.min(y,x))}}r=Array.from(r).sort((w,A)=>w[1]-A[1]).map(w=>w[0]);u.resolve(r);a.delete(v)})}_ensureBuffer(n){this._lastSize!==
n&&(this._lastSize=n,this._buf=new Uint8Array(4*n*n),this._buf32=new Uint32Array(this._buf.buffer))}}e.HittestEffectVTL=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define("exports ./Bloom ./Blur ./Colorize ./DropShadow ./Opacity".split(" "),function(e,g,p,h,k,n){const d={colorize:()=>new h.Colorize,blur:()=>new p.Blur,bloom:()=>new g.Bloom,opacity:()=>new n.Opacity,"drop-shadow":()=>new k.DropShadow};
class b{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach(a=>a.dispose());this._effectMap.clear()}getPostProcessingEffects(a){if(!a||0===a.length)return[];const c=[];for(const q of a){a:switch(a=q.type,a){case "bloom":case "blur":case "opacity":case "drop-shadow":break a;default:a="colorize"}let f=this._effectMap.get(a);f||(f=d[a](),this._effectMap.set(a,f));c.push({postProcessingEffect:f,effect:q})}return c}}e.EffectManager=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/TextureDescriptor".split(" "),function(e,g,p,h,k,n){const d=[1,0],b=[0,1],a=[1,.8,.6,.4,.2],c=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class q{constructor(){this._compositeFBO=this._intensityFBO=null;this._mipsFBOs=Array(5);this._nMips=5;this._kernelSizeArray=[3,5,7,9,11];this._size=[0,0];
this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",
0]])}}}dispose(){this._quad=g.disposeMaybe(this._quad);this._intensityFBO=g.disposeMaybe(this._intensityFBO);this._compositeFBO=g.disposeMaybe(this._compositeFBO);if(this._mipsFBOs){for(let f=0;f<this._nMips;f++)this._mipsFBOs[f]&&(this._mipsFBOs[f].horizontal.dispose(),this._mipsFBOs[f].vertical.dispose());this._mipsFBOs=null}}draw(f,t,m){const {width:l,height:u}=t,{context:v,painter:r}=f,{materialManager:y}=r;var x=v.gl;const w=this._programDesc,{strength:A,radius:z,threshold:C}=m;this._quad||(this._quad=
new p(v,[-1,-1,1,-1,-1,1,1,1]));this._createOrResizeResources(f,l,u);v.setStencilTestEnabled(!1);v.setBlendingEnabled(!0);v.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setStencilWriteMask(0);f=this._quad;f.bind();v.bindFramebuffer(this._intensityFBO);m=y.getProgram(w.luminosityHighPass);v.useProgram(m);v.bindTexture(t.colorTexture,0);m.setUniform1i("u_texture",0);m.setUniform3fv("u_defaultColor",[0,0,0]);m.setUniform1f("u_defaultOpacity",0);m.setUniform1f("u_luminosityThreshold",
C);m.setUniform1f("u_smoothWidth",.01);m=[Math.round(l/2),Math.round(u/2)];v.setViewport(0,0,m[0],m[1]);v.setClearColor(0,0,0,0);v.clear(x.COLOR_BUFFER_BIT);f.draw();v.setBlendingEnabled(!1);x=this._intensityFBO.colorTexture;for(let D=0;D<this._nMips;D++){const F=y.getProgram(w.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[D]}]);v.useProgram(F);v.bindTexture(x,D+1);F.setUniform1i("u_colorTexture",D+1);F.setUniform2fv("u_texSize",m);F.setUniform2fv("u_direction",d);v.setViewport(0,0,m[0],
m[1]);const G=this._mipsFBOs[D];v.bindFramebuffer(G.horizontal);f.draw();x=G.horizontal.colorTexture;v.bindFramebuffer(G.vertical);v.bindTexture(x,D+1);F.setUniform2fv("u_direction",b);f.draw();x=G.vertical.colorTexture;m[0]=Math.round(m[0]/2);m[1]=Math.round(m[1]/2)}v.setViewport(0,0,l,u);m=y.getProgram(w.composite,[{name:"nummips",value:5}]);v.bindFramebuffer(this._compositeFBO);v.useProgram(m);m.setUniform1f("u_bloomStrength",A);m.setUniform1f("u_bloomRadius",z);m.setUniform1fv("u_bloomFactors",
a);m.setUniform3fv("u_bloomTintColors",c);v.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1);m.setUniform1i("u_blurTexture1",1);v.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2);m.setUniform1i("u_blurTexture2",2);v.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3);m.setUniform1i("u_blurTexture3",3);v.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4);m.setUniform1i("u_blurTexture4",4);v.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5);m.setUniform1i("u_blurTexture5",5);
f.draw();v.bindFramebuffer(t);v.setBlendingEnabled(!0);t=y.getProgram(w.blit);v.useProgram(t);v.bindTexture(this._compositeFBO.colorTexture,6);t.setUniform1i("u_texture",6);v.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE);f.draw();f.unbind();v.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setStencilTestEnabled(!0)}_createOrResizeResources(f,t,m){({context:f}=f);if(!this._compositeFBO||this._size[0]!==t||this._size[1]!==m){this._size[0]=t;this._size[1]=m;var l=[Math.round(t/
2),Math.round(m/2)];this._compositeFBO?this._compositeFBO.resize(t,m):(t=new n.TextureDescriptor(t,m),t.internalFormat=h.PixelFormat.RGBA,t.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE,this._compositeFBO=new k.FramebufferObject(f,t));this._intensityFBO?this._intensityFBO.resize(l[0],l[1]):(t=new n.TextureDescriptor(l[0],l[1]),t.internalFormat=h.PixelFormat.RGBA,t.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE,this._intensityFBO=new k.FramebufferObject(f,t));for(t=0;t<this._nMips;t++)this._mipsFBOs[t]?(this._mipsFBOs[t].horizontal.resize(l[0],
l[1]),this._mipsFBOs[t].vertical.resize(l[0],l[1])):(m=new n.TextureDescriptor(l[0],l[1]),m.internalFormat=h.PixelFormat.RGBA,m.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE,this._mipsFBOs[t]={horizontal:new k.FramebufferObject(f,m),vertical:new k.FramebufferObject(f,m)}),l[0]=Math.round(l[0]/2),l[1]=Math.round(l[1]/2)}}}e.Bloom=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define(["exports","../../VertexStream","../../../../../webgl/enums",
"../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(e,g,p,h,k){const n=[1,0],d=[0,1];class b{constructor(){this._blurFBO=null;this._size=[0,0];this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(a,c,q){const {context:f}=a,{type:t,radius:m}=q;0!==m&&(this._createOrResizeResources(a),this._quad||(this._quad=new g(f,[-1,-1,1,-1,-1,1,1,1])),q=this._quad,q.bind(),"blur"===t?this._gaussianBlur(a,c,m):this._radialBlur(a,c),q.unbind())}_gaussianBlur(a,c,q){const {context:f,state:t,painter:m,pixelRatio:l}=a;var {size:u}=t,{materialManager:v}=m;a=this._quad;u=[Math.round(l*u[0]),Math.round(l*
u[1])];const r=this._blurFBO;v=v.getProgram(this._programDesc.gaussianBlur,[{name:"radius",value:Math.ceil(q)}]);f.useProgram(v);f.setBlendingEnabled(!1);f.bindFramebuffer(r);f.bindTexture(c.colorTexture,4);v.setUniform1i("u_colorTexture",4);v.setUniform2fv("u_texSize",u);v.setUniform2fv("u_direction",n);v.setUniform1f("u_sigma",q);a.draw();f.bindFramebuffer(c);f.setStencilWriteMask(0);f.setStencilTestEnabled(!1);f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);f.bindTexture(r?.colorTexture,5);
v.setUniform1i("u_colorTexture",5);v.setUniform2fv("u_direction",d);a.draw();f.setBlendingEnabled(!0);f.setBlendFunction(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);f.setStencilTestEnabled(!0)}_radialBlur(a,c){const {context:q,painter:f}=a,{materialManager:t}=f,m=this._programDesc;a=this._quad;const l=this._blurFBO;q.bindFramebuffer(l);const u=t.getProgram(m.radialBlur);q.useProgram(u);q.setBlendingEnabled(!1);q.bindTexture(c.colorTexture,4);u.setUniform1i("u_colorTexture",4);a.draw();q.bindFramebuffer(c);
q.setStencilWriteMask(0);q.setStencilTestEnabled(!1);q.setDepthWriteEnabled(!1);q.setDepthTestEnabled(!1);q.setBlendingEnabled(!0);c=t.getProgram(m.blit);q.useProgram(c);q.bindTexture(l?.colorTexture,5);c.setUniform1i("u_texture",5);q.setBlendFunction(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);a.draw()}_createOrResizeResources(a){const {context:c,state:q,pixelRatio:f}=a;var {size:t}=q;a=Math.round(f*t[0]);t=Math.round(f*t[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===t||(this._size[0]=
a,this._size[1]=t,this._blurFBO?this._blurFBO.resize(a,t):(a=new k.TextureDescriptor(a,t),a.internalFormat=p.PixelFormat.RGBA,a.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE,this._blurFBO=new h.FramebufferObject(c,a)))}}e.Blur=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define("exports ../../../../../../core/maybe ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n){class d{constructor(){this._layerFBOTexture=null;this._size=[0,0];this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture)}draw(b,a,c){const {width:q,height:f}=a;this._createOrResizeResources(b,q,f);const {context:t,painter:m}=b,{materialManager:l}=m,u=this._programDesc;b=this._quad;c=c.colorMatrix;b.bind();const v=this._layerFBOTexture;t.bindFramebuffer(a);
a.copyToTexture(0,0,q,f,0,0,v);t.setBlendingEnabled(!1);t.setStencilTestEnabled(!1);a=l.getProgram(u);t.useProgram(a);t.bindTexture(v,2);a.setUniformMatrix4fv("u_coefficients",c);a.setUniform1i("u_colorTexture",2);b.draw();t.setBlendingEnabled(!0);t.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);t.setStencilTestEnabled(!0);b.unbind()}_createOrResizeResources(b,a,c){({context:b}=b);if(!this._layerFBOTexture||this._size[0]!==a||this._size[1]!==c){this._size[0]=a;this._size[1]=
c;if(this._layerFBOTexture)this._layerFBOTexture.resize(a,c);else{const q=new n.TextureDescriptor;q.internalFormat=h.PixelFormat.RGBA;q.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;q.width=a;q.height=c;this._layerFBOTexture=new k.Texture(b,q)}this._quad||(this._quad=new p(b,[-1,-1,1,-1,-1,1,1,1]))}}}e.Colorize=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define("exports ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture ../../../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d,b){const a=[1,0],c=[0,1];class q{constructor(){this._verticalBlurFBO=this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",
attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture);this._horizontalBlurFBO=g.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=g.disposeMaybe(this._verticalBlurFBO)}draw(f,t,m){const {context:l,state:u,painter:v}=f,{materialManager:r}=v,y=this._programDesc,x=t.width,w=t.height,A=[Math.round(x),Math.round(w)],{blurRadius:z,offsetX:C,offsetY:D,color:F}=m;m=[p.pt2px(C),p.pt2px(D)];this._createOrResizeResources(f,x,w,A);const G=this._horizontalBlurFBO;
f=this._verticalBlurFBO;l.setStencilWriteMask(0);l.setStencilTestEnabled(!1);l.setDepthWriteEnabled(!1);l.setDepthTestEnabled(!1);const B=this._layerFBOTexture;t.copyToTexture(0,0,x,w,0,0,B);this._quad||(this._quad=new h(l,[-1,-1,1,-1,-1,1,1,1]));l.setViewport(0,0,A[0],A[1]);const I=this._quad;I.bind();l.setBlendingEnabled(!1);const H=r.getProgram(y.blur,[{name:"radius",value:Math.ceil(z)}]);l.useProgram(H);l.bindFramebuffer(G);l.bindTexture(t.colorTexture,4);H.setUniform1i("u_colorTexture",4);H.setUniform2fv("u_texSize",
A);H.setUniform2fv("u_direction",a);H.setUniform1f("u_sigma",z);I.draw();l.bindFramebuffer(f);l.bindTexture(G?.colorTexture,5);H.setUniform1i("u_colorTexture",5);H.setUniform2fv("u_direction",c);I.draw();l.bindFramebuffer(t);l.setViewport(0,0,x,w);t=r.getProgram(y.composite);l.useProgram(t);l.bindTexture(f?.colorTexture,2);t.setUniform1i("u_blurTexture",2);l.bindTexture(B,3);t.setUniform1i("u_layerFBOTexture",3);t.setUniform4fv("u_shadowColor",[F[0]/255*F[3],F[1]/255*F[3],F[2]/255*F[3],F[3]]);t.setUniformMatrix3fv("u_displayViewMat3",
u.displayMat3);t.setUniform2fv("u_shadowOffset",m);I.draw();l.setBlendingEnabled(!0);l.setStencilTestEnabled(!0);l.setBlendFunction(k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA);I.unbind()}_createOrResizeResources(f,t,m,l){({context:f}=f);if(!this._horizontalBlurFBO||this._size[0]!==t||this._size[1]!==m){this._size[0]=t;this._size[1]=m;if(this._horizontalBlurFBO)this._horizontalBlurFBO.resize(l[0],l[1]);else{const u=new b.TextureDescriptor(l[0],l[1]);u.internalFormat=k.PixelFormat.RGBA;u.wrapMode=
k.TextureWrapMode.CLAMP_TO_EDGE;this._horizontalBlurFBO=new n.FramebufferObject(f,u)}this._verticalBlurFBO?this._verticalBlurFBO.resize(l[0],l[1]):(l=new b.TextureDescriptor(l[0],l[1]),l.internalFormat=k.PixelFormat.RGBA,l.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE,this._verticalBlurFBO=new n.FramebufferObject(f,l));this._layerFBOTexture?this._layerFBOTexture.resize(t,m):(l=new b.TextureDescriptor,l.internalFormat=k.PixelFormat.RGBA,l.wrapMode=k.TextureWrapMode.CLAMP_TO_EDGE,l.width=t,l.height=m,this._layerFBOTexture=
new d.Texture(f,l))}}}e.DropShadow=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define(["exports","../../../../../../core/maybe","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(e,g,p,h,k){class n{constructor(){this._size=[0,0];this._layerFBOTexture=null}dispose(){this._layerFBOTexture=g.disposeMaybe(this._layerFBOTexture)}draw(d,b,a){const {width:c,
height:q}=b;this._createOrResizeResources(d,c,q);const {context:f,painter:t}=d;({amount:d}=a);a=f.gl;const m=this._layerFBOTexture;f.bindFramebuffer(b);b.copyToTexture(0,0,c,q,0,0,m);f.setBlendingEnabled(!0);f.setStencilTestEnabled(!1);f.setDepthTestEnabled(!1);f.setClearColor(0,0,0,0);f.clear(a.COLOR_BUFFER_BIT);t.blitTexture(f,m,p.TextureSamplingMode.NEAREST,d)}_createOrResizeResources(d,b,a){({context:d}=d);if(!this._layerFBOTexture||this._size[0]!==b||this._size[1]!==a)if(this._size[0]=b,this._size[1]=
a,this._layerFBOTexture)this._layerFBOTexture.resize(b,a);else{const c=new k.TextureDescriptor;c.internalFormat=p.PixelFormat.RGBA;c.wrapMode=p.TextureWrapMode.CLAMP_TO_EDGE;c.samplingMode=p.TextureSamplingMode.NEAREST;c.width=b;c.height=a;this._layerFBOTexture=new h.Texture(d,c)}}}e.Opacity=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../core/arrayUtils","../enums"],function(e,g){class p{constructor(h,
k){this.brushes=h;this.name=k.name;this.drawPhase=k.drawPhase||g.WGLDrawPhase.MAP;this._targetFn=k.target;this.effects=k.effects||[];this.enableDefaultDraw=k.enableDefaultDraw??(()=>!0);this.forceDrawByDisplayOrder=!!k.forceDrawByDisplayOrder}render(h){const {context:k,profiler:n}=h,d=this._targetFn();var b=this.drawPhase&h.drawPhase;n.recordPassStart(this.name);if(b){this.enableDefaultDraw()&&this._doRender(h,d);n.recordPassEnd();for(const a of this.effects){if(!a.enable())continue;b=a.apply;const c=
a.args?.(),q=k.getViewport(),f=k.getBoundFramebufferObject(),t=h.passOptions;this._bindEffect(h,b,c);this._doRender(h,d,b.defines);this._drawAndUnbindEffect(h,b,q,f,t,c)}}}_doRender(h,k,n){if(null!=k){var {profiler:d,context:b}=h;for(const a of this.brushes){d.recordBrushStart(a.name);if(null!=a.brushEffect){const c=b.getViewport(),q=b.getBoundFramebufferObject(),f=h.passOptions;this._bindEffect(h,a.brushEffect);this._drawWithBrush(a,h,k,n);this._drawAndUnbindEffect(h,a.brushEffect,c,q,f)}else this._drawWithBrush(a,
h,k,n);d.recordBrushEnd()}}}_drawWithBrush(h,k,n,d){e.isArrayLike(n)?(h.prepareState(k,d),h.drawMany(k,n,d)):n.visible&&(h.prepareState(k,d),h.draw(k,n,d))}_bindEffect(h,k,n){const {profiler:d}=h;d.recordPassStart(this.name+"."+k.name);k.bind(h,n);k=k.createOptions(h,n);h.passOptions=k}_drawAndUnbindEffect(h,k,n,d,b,a){const {profiler:c,context:q}=h;h.passOptions=b;c.recordBrushStart(k.name);k.draw(h,a);k.unbind(h,a);q.bindFramebuffer(d);const {x:f,y:t,width:m,height:l}=n;q.setViewport(f,t,m,l);c.recordBrushEnd();
c.recordPassEnd()}}return p})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueProgramCache":function(){define(["exports"],function(e){class g{constructor(){this._programCache=new Map}destroy(){for(const p of this._programCache.values())p.destroy();this._programCache.clear()}getProgram(p,h,k,n,d){const b=p.getShaderKey(h,k,n,d);let a=this._programCache.get(b);a||(a=p.getProgram(h,k,n,d),this._programCache.set(b,a));return a}}e.TechniqueProgramCache=g;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/Profiler":function(){define(["exports","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],function(e,g,p,h,k){const n=h("esri-2d-profiler");class d{constructor(b,a){this._events=new p;this._entries=new Map;this._timings=new g(10);this._currentSummary=this._currentBrush=this._currentPass=this._currentContainer=null;if(n){this._ext=k.createDisjointTimerQuery(b.gl,{});this._debugOutput=
a;var c=b.gl;if(this.enableCommandLogging)for(var q in c)if("function"===typeof c[q]){const f=c[q],t=q.includes("draw");c[q]=(...m)=>{this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:q,args:m,isDrawCommand:t});this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++);return f.apply(c,m)}}}}get enableCommandLogging(){return!("object"===typeof n&&n.disableCommands)}recordContainerStart(b){n&&(this._currentContainer=
b)}recordContainerEnd(){n&&(this._currentContainer=null)}recordPassStart(b){n&&(this._currentPass=b,this._initSummary())}recordPassEnd(){n&&(this._currentPass=null,this._emitSummary())}recordBrushStart(b){n&&(this._currentBrush=b)}recordBrushEnd(){n&&(this._currentBrush=null)}recordStart(b){if(n&&null!=this._ext){if(this._entries.has(b)){const t=this._entries.get(b);var a=this._ext.resultAvailable(t.query),c=this._ext.disjoint();if(a&&!c){a=this._ext.getResult(t.query)/1E6;c=0;if(null!=this._timings.enqueue(a)){c=
this._timings.entries;const m=c.length;let l=0;for(var q of c)l+=q;c=l/m}q=a.toFixed(2);a=c?c.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${b}, ${q} ms (${a} last 10 avg)\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log(`Frame report for ${b}, ${q} ms (${a} last 10 avg)`);this._debugOutput.innerHTML=`${q} (${a})`}for(const m of t.handles)m.remove();
this._ext.deleteQuery(t.query);this._entries.delete(b)}const f={name:b,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(f.handles.push(this._events.on("command",t=>{f.commandsLen++;f.commands.push(t);t.isDrawCommand&&f.drawCommands++})),f.handles.push(this._events.on("summary",t=>{f.summaries.push(t)})));this._ext.beginTimeElapsed(f.query);this._entries.set(b,f)}}recordEnd(b){n&&null!=this._ext&&this._entries.has(b)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&
(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}e.Profiler=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){class e{constructor(g){this._start=this.size=0;this.maxSize=g;this._buffer=Array(g)}get entries(){return this._buffer}enqueue(g){if(this.size===this.maxSize){const p=
this._buffer[this._start];this._buffer[this._start]=g;this._start=(this._start+1)%this.maxSize;return p}this._buffer[(this._start+this.size++)%this.maxSize]=g;return null}dequeue(){if(0===this.size)return null;const g=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return g}peek(){return 0===this.size?null:this._buffer[this._start]}find(g){if(0===this.size)return null;for(const p of this._buffer)if(null!=p&&g(p))return p;return null}clear(g){let p=
this.dequeue();for(;null!=p;)g&&g(p),p=this.dequeue()}}return e})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],function(e){class g{constructor(p,h,k,n,d,b,a,c,q){this.createQuery=p;this.deleteQuery=h;this.resultAvailable=k;this.getResult=n;this.disjoint=d;this.beginTimeElapsed=b;this.endTimeElapsed=a;this.createTimestamp=c;this.timestampBits=q}}e.hasRunningElapsedTimer=!1;e.DisjointTimerQuery=g;e.createDisjointTimerQuery=function(p,h){if(h.disjointTimerQuery)return null;
let k=p.getExtension("EXT_disjoint_timer_query_webgl2");return k?new g(()=>p.createQuery(),n=>{p.deleteQuery(n);e.hasRunningElapsedTimer=!1},n=>p.getQueryParameter(n,p.QUERY_RESULT_AVAILABLE),n=>p.getQueryParameter(n,p.QUERY_RESULT),()=>p.getParameter(k.GPU_DISJOINT_EXT),n=>{e.hasRunningElapsedTimer||(e.hasRunningElapsedTimer=!0,p.beginQuery(k.TIME_ELAPSED_EXT,n))},()=>{p.endQuery(k.TIME_ELAPSED_EXT);e.hasRunningElapsedTimer=!1},n=>k.queryCounterEXT(n,k.TIMESTAMP_EXT),()=>p.getQuery(k.TIMESTAMP_EXT,
k.QUERY_COUNTER_BITS_EXT)):(k=p.getExtension("EXT_disjoint_timer_query"))?new g(()=>k.createQueryEXT(),n=>{k.deleteQueryEXT(n);e.hasRunningElapsedTimer=!1},n=>k.getQueryObjectEXT(n,k.QUERY_RESULT_AVAILABLE_EXT),n=>k.getQueryObjectEXT(n,k.QUERY_RESULT_EXT),()=>p.getParameter(k.GPU_DISJOINT_EXT),n=>{e.hasRunningElapsedTimer||(e.hasRunningElapsedTimer=!0,k.beginQueryEXT(k.TIME_ELAPSED_EXT,n))},()=>{k.endQueryEXT(k.TIME_ELAPSED_EXT);e.hasRunningElapsedTimer=!1},n=>k.queryCounterEXT(n,k.TIMESTAMP_EXT),
()=>k.getQueryEXT(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(e){class g{constructor(){this._candidateTiles=[]}schedule(p){this._candidateTiles.includes(p)||this._candidateTiles.push(p)}reshuffle(p){const h=[];for(const k of this._candidateTiles)0<p?(k.reshuffle(),p--):h.push(k);this._candidateTiles=h}}e.TileReshuffleManager=g;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry":function(){define("exports ./dotDensity/DotDensityTechnique ./fill/ComplexFillTechnique ./fill/ComplexOutlineFillTechnique ./fill/FillTechnique ./fill/OutlineFillTechnique ./fill/PatternFillTechnique ./fill/PatternOutlineFillTechnique ./heatmap/HeatmapTechnique ./labels/LabelTechnique ./line/LineTechnique ./line/TexturedLineTechnique ./markers/MarkerTechnique ./pieChart/PieChartTechnique ./text/TextTechnique".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){const u={fill:new k.FillTechnique("fill"),patternFill:new d.PatternFillTechnique("patternFill"),complexFill:new p.ComplexFillTechnique("complexFill"),outlineFill:new n.OutlineFillTechnique("outlineFill"),patternOutlineFill:new b.PatternOutlineFillTechnique("patternOutlineFill"),complexOutlineFill:new h.ComplexOutlineFillTechnique("complexOutlineFill"),marker:new t.MarkerTechnique("marker"),pieChart:new m.PieChartTechnique("pieChart"),line:new q.LineTechnique("line"),
texturedLine:new f.TexturedLineTechnique("texturedLine"),text:new l.TextTechnique("text"),label:new c.LabelTechnique("label"),heatmap:new a.HeatmapTechnique("heatmap"),dotDensity:new g.DotDensityTechnique("dotDensity")};e.Techniques=u;e.shutdown=function(v){for(const r in u)u[r].shutdown(v)};e.startup=function(){for(const v in u)u[v].startup()};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityTechnique":function(){define("exports ../../../definitions ../featureTechniqueUtils ../Technique ./DotDensityPointShader ./DotDensityPolygonShader ./DotDensityResources ../mesh/MeshWriterRegistry ../shaders/FillShader ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c){class q extends h.Technique{constructor(){super(...arguments);this.shaders={polygon:new n.DotDensityPolygonShader,point:new k.DotDensityPointShader,fill:new a.FillShader};this.meshWriter=b.meshWriterRegistry.DotDensityMeshWriter;this._resources=new Map}render(f,t){p.isHighlight(f)||p.isHittest(f)?this._renderPolygons(f,t):this._renderDotDensity(f,t)}_renderPolygons(f,t){const {context:m,painter:l}=f;l.setShader({shader:this.shaders.fill,uniforms:{...p.getFeatureUniforms(f,
t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...p.getSelectionDefines(f)},optionalAttributes:{zoomRange:!1},useComputeBuffer:p.isHittest(f)});l.setPipelineState(p.getFeaturePipelineState(f));l.submitDraw(m,t)}_renderDotDensity(f,t){const {context:m,painter:l,requiredLevel:u}=f,v=t.instance.getInput(),r=this._getOrCreateResourcesRecord(m);var y=r.getDotDensityTextures(m,g.tileSize,v.seed),x=1/2**(u-t.target.key.level),w=g.tileSize;w=w*window.devicePixelRatio*w*window.devicePixelRatio;
const A=1/x*(v.dotScale?f.state.scale/v.dotScale:1)*v.dotValue*(1/x);l.setShader({shader:this.shaders.polygon,uniforms:{...p.getFeatureUniforms(f,t.target),instance:{isActive:v.isActive,colors:v.colors,dotValue:Math.max(1,A)},draw:{dotTexture0:{unit:g.textureBindingRenderer0,texture:y[0]},dotTexture1:{unit:g.textureBindingRenderer1,texture:y[1]},tileZoomFactor:x,pixelRatio:window.devicePixelRatio,tileDotsOverArea:w/(g.tileSize*window.devicePixelRatio*g.tileSize*window.devicePixelRatio)}},defines:{...p.getSelectionDefines(f),
blending:v.blending},optionalAttributes:{},useComputeBuffer:!1});l.setPipelineState(p.getFeaturePipelineState(f));y=m.getViewport();m.setViewport(0,0,g.tileSize,g.tileSize);x=m.getBoundFramebufferObject();w=r.getFBO(m);m.bindFramebuffer(w);m.setClearColor(0,0,0,0);l.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1});l.updatePipelineState(m);m.clear(c.ClearBufferBit.COLOR_BUFFER_BIT);l.submitDraw(m,t);m.bindFramebuffer(x);m.setViewport(y.x,y.y,y.width,y.height);
y=r.getFBO(m).colorTexture;l.setShader({shader:this.shaders.point,uniforms:{view:p.getViewUniforms(f,t.target),instance:{dotSize:v.dotSize},draw:{locations:{unit:g.textureBindingRenderer0,texture:y},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...p.getSelectionDefines(f)},optionalAttributes:{},useComputeBuffer:!1});l.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1});l.submitDrawMesh(m,r.getDotDensityMesh(m))}shutdown(f){super.shutdown(f);this._resources.get(f)?.destroy();
this._resources.delete(f)}_getOrCreateResourcesRecord(f){let t=this._resources.get(f);null==t&&(t=new d.DotDensityResources,this._resources.set(f,t));return t}}e.DotDensityTechnique=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/Technique":function(){define(["exports","../../enums"],function(e,g){class p{constructor(h){this.registryName=h;this.postProcessingEnabled=!1;this.overrideStencilRef=null;this.drawPhase=g.WGLDrawPhase.MAP|
g.WGLDrawPhase.HITTEST|g.WGLDrawPhase.HIGHLIGHT|g.WGLDrawPhase.DEBUG;this.symbologyPlane=g.FeatureSymbologyDrawOrder.FILL}startup(){}shutdown(h){}postProcess(h,k){}}e.Technique=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPointShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/ViewInfo".split(" "),
function(e,g,p,h,k,n,d){class b extends h.VertexInput{}g.__decorate([h.location(0,k.Vec2)],b.prototype,"pos",void 0);class a extends n.FeatureFragmentInput{}class c extends h.UniformGroup{}g.__decorate([h.uniform(k.Float)],c.prototype,"dotSize",void 0);class q extends h.UniformGroup{}g.__decorate([h.uniform(k.Sampler2D)],q.prototype,"locations",void 0);g.__decorate([h.uniform(k.Float)],q.prototype,"pixelRatio",void 0);g.__decorate([h.uniform(k.Float)],q.prototype,"tileZoomFactor",void 0);class f extends h.GraphShaderModule{vertex(t){var m=
(new k.Mat3(1,0,0,0,-1,0,0,1,1)).multiply(new k.Vec3(t.pos.xy.divide(p.tileSize),1));m=k.texture2D(this.draw.locations,m.xy);var l=k.max(this.instance.dotSize.divide(2),new k.Float(1)),u=new k.Float(0);u=u.add(k.step(m.a,new k.Float(1E-6)).multiply(2));let v=l.add(this.instance.dotSize);t=this.view.displayViewScreenMat3.multiply(new k.Vec3(t.pos.add(.5),1));t=new k.Vec4(t.xy,u,1);u=this.instance.dotSize.divide(v);l=(new k.Float(-1)).divide(l.divide(v));v=v.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor));
return{glPosition:t,glPointSize:v,color:m,ratio:u,invEdgeRatio:l}}fragment(t){var m=k.length(t.glPointCoord.subtract(.5)).multiply(2);m=k.smoothstep(new k.Float(0),new k.Float(1),t.invEdgeRatio.multiply(m.subtract(t.ratio)).add(1));const l=new h.FragmentOutput;l.glFragColor=t.color.multiply(m);return l}}g.__decorate([h.uniform(c)],f.prototype,"instance",void 0);g.__decorate([h.uniform(q)],f.prototype,"draw",void 0);g.__decorate([h.uniform(d.ViewInfo)],f.prototype,"view",void 0);g.__decorate([g.__param(0,
h.input(b))],f.prototype,"vertex",null);g.__decorate([g.__param(0,h.input(a))],f.prototype,"fragment",null);e.DotDensityPointDrawUniforms=q;e.DotDensityPointFragmentInput=a;e.DotDensityPointInstanceUniforms=c;e.DotDensityPointShader=f;e.DotDensityPointVertexInput=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/string ./ShaderBuilder2D ./graph/glsl ./graph/GlslGraphWriter ./graph/ShaderGraphContext ./graph/ShaderGraphNode ./typed/TypedShaderProgram".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){function f(w,A,z){const C=w.constructor[A]??[];w.constructor.hasOwnProperty(A)||Object.defineProperty(w.constructor,A,{value:C.slice()});w.constructor[A].push(z)}const t=w=>(A,z)=>{f(A,"builtins",{builtin:w,propertyKey:z})},m=(w,A)=>(z,C)=>{z.constructor.builtins.push({builtin:w,propertyKey:C,typeCtor:A})};class l{}l.builtins=[];g.__decorate([m("gl_VertexID",d.Int)],l.prototype,"glVertexID",void 0);class u{}class v{}v.builtins=[];g.__decorate([m("gl_FragCoord",d.Vec4)],
v.prototype,"glFragCoord",void 0);g.__decorate([m("gl_PointCoord",d.Vec2)],v.prototype,"glPointCoord",void 0);class r{}g.__decorate([t("gl_FragColor")],r.prototype,"glFragColor",void 0);class y{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class x{constructor(){this.logShader=!1;this.computeAttributes={}}get vertexInput(){const w=p.findLast(this._shaderModuleClass.inputs,A=>"vertex"===A.propertyKey&&0===A.parameterIndex);if(!w)throw Error("Unable to find vertex input parameter");
return w}get computeInput(){return p.findLast(this._shaderModuleClass.inputs,w=>"vertex"===w.propertyKey&&1===w.parameterIndex)}get fragmentInput(){const w=p.findLast(this._shaderModuleClass.inputs,A=>"fragment"===A.propertyKey);if(!w)throw Error("Unable to find fragment input parameter");return w}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...(this.computeInput?.inputCtor.locations??
[])]}get locationsMap(){const w=new Map,A=new Set;for(const z of this.locations)A.has(z.index)?h.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${z.propertyKey} to ${z.index}. Index already in use`,{locationsMap:w}):(w.set(z.propertyKey,z.index),A.add(z.index));return w}get locationInfo(){if(!this._locationInfo){const w=this.locationsMap,A=Array.from(w.entries()).map(([z,C])=>`${z}.${C}`).join(".");this._locationInfo=
{hash:k.numericHash(A),locations:w}}return this._locationInfo}get renamedLocationsMap(){const w=new Map;for(const A of this.locations)w.set("a_"+A.propertyKey,A.index);return w}get optionPropertyKeys(){if(!this._optionPropertyKeys){const w=new Set;for(const A of this._options)w.add(A.propertyKey);this._optionPropertyKeys=w}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??
[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(w,A,z,C){try{const {vertex:D,fragment:F,uniformBindings:G}=this._generateShaders(w,A,z,C);return new q.TypedShaderProgram(D,F,this.renamedLocationsMap,this.locationInfo,G,this.transformFeedbackBindings)}catch(D){return console.error("Failed to create program",{error:D}),new q.TypedShaderProgram("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(w){var A=this._options.find(z=>
z.propertyKey===w);if(A)return{type:"option",className:A.typeCtor};A=this._uniforms.find(z=>z.propertyKey===w);if(!A)throw Error(`Unable to find uniform class type for property: ${w}`);return{type:"required",className:A.typeCtor}}getShaderKey(w,A,z,C){const D=Object.keys(z).map(B=>`${B}.${z[B]}`).join("."),F=Object.keys(C).map(B=>`${B}.${C[B]}`).join("."),G=Object.keys(A).filter(B=>this.optionPropertyKeys.has(B)&&A[B]).join(".");return`${this.constructor.name}.${w.hash}.${D}.${F}.${G}`}_generateShaders(w,
A,z,C){const D=[];this._setDefines(z);this._setOptionalUniforms(D,A);this._setRequiredUniforms(D);A=this._hydrateVertexInput(C);C=this._injectPackPrecisionFactor(A,w);w=(z=this._hydrateComputeInput())&&this._injectPackPrecisionFactor(z,w);const F=this.vertex(C,w);w=this._hydrateFragmentInput(F);C=this.fragment(w);const G=new Set;for(var B in C)c.setReachableUids(G,C[B]);B=this._getVertexInputBuiltins();B=a.ShaderGraphContext.createVertex({...A,...z},F,B,D,this.transformFeedbackBindings,G);(new b.GlslShaderWriter).write(B);
A=this._getFragmentInputBuiltins(C);A.set("glPointCoord","gl_PointCoord");A=a.ShaderGraphContext.createFragment(w,C,A,D,B,this.transformFeedbackBindings);(new b.GlslShaderWriter).write(A);A=this._createShaderBuilder(B,A);B=A.generate("vertex",!1);A=A.generate("fragment",!1);this.logShader&&(console.log(B),console.log(A));return{vertex:B,fragment:A,uniformBindings:D}}_setDefines(w){for(const A in w)this[A]=w[A]}_setOptionalUniforms(w,A){for(const z of this._options)this[z.propertyKey]=A[z.propertyKey]?
this._hydrateUniformGroup(w,z):null}_setRequiredUniforms(w){for(const A of this._uniforms)this[A.propertyKey]=this._hydrateUniformGroup(w,A)}_hydrateUniformGroup(w,A){const z=new A.typeCtor;for(const C of z._uniforms??[]){const D=new C.typeCtor,F=`u_${A.propertyKey}_${C.propertyKey}`,G=D.type,B=[A.propertyKey,C.propertyKey].join(".");if("type"in C.typeCtor&&"array"===C.typeCtor.type){const I=D;w.push({shaderModulePath:B,uniformName:F,uniformType:G,uniformArrayLength:I.size,uniformArrayElementType:I.elementType.type,
uniformHydrated:D})}else w.push({shaderModulePath:B,uniformName:F,uniformType:G,uniformHydrated:D});z[C.propertyKey]=D}return z}_hydrateVertexInput(w){var A=this.vertexInput.inputCtor;const z=A.locations.reduce((C,D)=>!1===w[D.propertyKey]?C:{...C,[D.propertyKey]:new D.typeCtor},{});for(const {propertyKey:C,typeCtor:D}of A.builtins)A=new D,z[C]=A;return z}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((w,A)=>({...w,[A.propertyKey]:new A.typeCtor}),
{})}_injectPackPrecisionFactor(w,A){const z={};for(const C in w){const D=w[C],F=A.attributes.find(G=>G.name===C);if(F?.packPrecisionFactor){if("float"!==D.type&&"vec2"!==D.type&&"vec3"!==D.type&&"vec4"!==D.type)throw Error(`InternalError: packPrecisionFactor requires GenType, but found ${D.type}`);z[C]=D.divide(new d.Float(F.packPrecisionFactor))}else z[C]=D}return z}_hydrateFragmentInput(w){const A={};for(const z in w)A[z]=w[z];for(const {propertyKey:z,typeCtor:C}of v.builtins)w=new C,A[z]=w;return A}_getVertexInputBuiltins(){const w=
this.vertexInput.inputCtor,A=new Map;for(const {builtin:z,propertyKey:C}of w.builtins)A.set(C,z);return A}_getFragmentInputBuiltins(w){w=w.constructor;const A=new Map;for(const z of w.builtins??[])A.set(z.propertyKey,z.builtin);return A}_createShaderBuilder(w,A){const z=new n.ShaderBuilder2D;this._insertDebugInfo(z);w.insertVertexShader(z);A.insertFragmentShader(z);return z}_insertDebugInfo(w){w.vertex.code.add("// DEFINES: ");w.vertex.code.add("// --------------------------------------------------------- ");
for(const A of this._defines)this[A.propertyKey]?w.vertex.code.add(`//   ${A.propertyKey}: true`):w.vertex.code.add(`//   ${A.propertyKey}: false`);w.vertex.code.add("");w.vertex.code.add("// OPTIONS: ");w.vertex.code.add("// --------------------------------------------------------- ");for(const A of this._options)this[A.propertyKey]?w.vertex.code.add(`//   ${A.propertyKey}: true`):w.vertex.code.add(`//   ${A.propertyKey}: false`)}}e.ComputeVertexInput=u;e.FragmentInput=v;e.FragmentOutput=r;e.GraphShaderModule=
x;e.UniformGroup=y;e.VertexInput=l;e.builtin=t;e.define=(w,A)=>{f(w,"defines",{propertyKey:A})};e.input=w=>(A,z,C)=>{f(A,"inputs",{inputCtor:w,propertyKey:z,parameterIndex:C})};e.location=function(w,A){return(z,C)=>{f(z,"locations",{typeCtor:A,propertyKey:C,parameterIndex:null,index:w})}};e.option=w=>(A,z)=>{f(A,"options",{typeCtor:w,propertyKey:z})};e.transformFeedback=function(w){return(A,z)=>{f(A,"transformFeedbackBindings",{propertyKey:z,parameterIndex:null,index:w})}};e.uniform=w=>(A,z)=>{f(A,
"uniforms",{typeCtor:w,propertyKey:z})};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/ShaderBuilder2D":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../3d/webgl-engine/core/shaderTechnique/BindType","../../../../3d/webgl-engine/lib/Util"],function(e,g,p,h,k){function n(v=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${v?
"out vec4 fragColor;":""}\n`}const d=()=>p.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class b{constructor(){this._includedModules=new Map}include(v,r){if(this._includedModules.has(v)){const y=this._includedModules.get(v);if(y!==r){d().error("Trying to include shader module multiple times with different sets of options.");r=new Set;for(const x of Object.keys(y))y[x]!==v[x]&&r.add(x);for(const x of Object.keys(v))y[x]!==v[x]&&r.add(x);r.forEach(x=>console.error(`  ${x}: current ${y[x]} new ${v[x]}`))}}else this._includedModules.set(v,
r),v(this.builder,r)}}class a extends b{constructor(){super(...arguments);this.vertex=new f;this.fragment=new f;this.attributes=new t;this.varyings=new m;this.extensions=new l;this.constants=new u}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(v,r=!0){const y=this.extensions.generateSource(v),x=this.attributes.generateSource(v),w=this.varyings.generateSource(v);var A="vertex"===v?this.vertex:this.fragment;const z=A.uniforms.generateSource(),C=A.code.generateSource();
v="vertex"===v?"precision highp float;\nprecision highp sampler2D;":n(r);A=this.constants.generateSource().concat(A.constants.generateSource());return`${r?"#version 300 es":""}\n${y.join("\n")}\n${v}\n${A.join("\n")}\n${z.join("\n")}\n${x.join("\n")}\n${w.join("\n")}\n${C.join("\n")}`}generateBindPass(v){const r=new Map;this.vertex.uniforms.entries.forEach(w=>{const A=w.bind[h.BindType.Pass];A&&r.set(w.name,A)});this.fragment.uniforms.entries.forEach(w=>{const A=w.bind[h.BindType.Pass];A&&r.set(w.name,
A)});const y=Array.from(r.values()),x=y.length;return(w,A)=>{for(let z=0;z<x;++z)y[z](v,w,A)}}generateBindDraw(v){const r=new Map;this.vertex.uniforms.entries.forEach(w=>{const A=w.bind[h.BindType.Draw];A&&r.set(w.name,A)});this.fragment.uniforms.entries.forEach(w=>{const A=w.bind[h.BindType.Draw];A&&r.set(w.name,A)});const y=Array.from(r.values()),x=y.length;return(w,A,z)=>{for(let C=0;C<x;++C)y[C](v,w,A,z)}}}class c{constructor(){this._entries=new Map}add(...v){for(const r of v)this._add(r)}get(v){return this._entries.get(v)}_add(v){if(null==
v)d().error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(v.name)&&!this._entries.get(v.name).equals(v))throw new g(`Duplicate uniform name ${v.name} for different uniform type`);this._entries.set(v.name,v)}}generateSource(){return Array.from(this._entries.values()).map(v=>null!=v.arraySize?`uniform ${v.type} ${v.name}[${v.arraySize}];`:`uniform ${v.type} ${v.name};`)}get entries(){return Array.from(this._entries.values())}}class q{constructor(){this._entries=[]}add(v){this._entries.push(v)}generateSource(){return this._entries}}
class f extends b{constructor(){super(...arguments);this.uniforms=new c;this.code=new q;this.constants=new u}get builder(){return this}}class t{constructor(){this._entries=[]}add(v,r){this._entries.push([v,r])}generateSource(v){return"fragment"===v?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}}class m{constructor(){this._entries=new Map}add(v,r){this._entries.has(v)&&k.assert(this._entries.get(v)===r);this._entries.set(v,r)}generateSource(v){const r=[];this._entries.forEach((y,x)=>r.push("vertex"===
v?`out ${y} ${x};`:`in ${y} ${x};`));return r}}class l{constructor(){this._entries=new Set}add(v){this._entries.add(v)}generateSource(v){const r="vertex"===v?l.ALLOWLIST_VERTEX:l.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(y=>r.includes(y)).map(y=>`#extension ${y} : enable`)}}l.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];l.ALLOWLIST_VERTEX=[];class u{constructor(){this._entries=new Set}add(v,r,y){let x="ERROR_CONSTRUCTOR_STRING";switch(r){case "float":x=
u._numberToFloatStr(y);break;case "int":x=u._numberToIntStr(y);break;case "bool":x=y.toString();break;case "vec2":x=`vec2(${u._numberToFloatStr(y[0])},                            ${u._numberToFloatStr(y[1])})`;break;case "vec3":x=`vec3(${u._numberToFloatStr(y[0])},                            ${u._numberToFloatStr(y[1])},                            ${u._numberToFloatStr(y[2])})`;break;case "vec4":x=`vec4(${u._numberToFloatStr(y[0])},                            ${u._numberToFloatStr(y[1])},                            ${u._numberToFloatStr(y[2])},                            ${u._numberToFloatStr(y[3])})`;
break;case "ivec2":x=`ivec2(${u._numberToIntStr(y[0])},                             ${u._numberToIntStr(y[1])})`;break;case "ivec3":x=`ivec3(${u._numberToIntStr(y[0])},                             ${u._numberToIntStr(y[1])},                             ${u._numberToIntStr(y[2])})`;break;case "ivec4":x=`ivec4(${u._numberToIntStr(y[0])},                             ${u._numberToIntStr(y[1])},                             ${u._numberToIntStr(y[2])},                             ${u._numberToIntStr(y[3])})`;
break;case "mat2":case "mat3":case "mat4":x=`${r}(${Array.prototype.map.call(y,w=>u._numberToFloatStr(w)).join(", ")})`}this._entries.add(`const ${r} ${v} = ${x};`);return this}static _numberToIntStr(v){return v.toFixed(0)}static _numberToFloatStr(v){return Number.isInteger(v)?v.toFixed(1):v.toString()}generateSource(){return Array.from(this._entries)}}e.Code=q;e.Includes=b;e.ShaderBuilder2D=a;e.Stage=f;e.Uniforms=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(e){e.BindType=void 0;var g=e.BindType||(e.BindType={});g[g.Pass=0]="Pass";g[g.Draw=1]="Draw";Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,g,p,h){function k(b,a){if(!b)throw a=a||"Assertion",new d(`${a} at ${Error(a).stack}`);}const n=h.create();class d{constructor(b){this.message=
b}toString(){return`AssertException: ${this.message}`}}e.assert=k;e.isTranslationMatrix=function(b){return 1===b[0]&&0===b[1]&&0===b[2]&&0===b[3]&&0===b[4]&&1===b[5]&&0===b[6]&&0===b[7]&&0===b[8]&&0===b[9]&&1===b[10]&&0===b[11]&&1===b[15]};e.logWithBase=function(b,a){return Math.log(b)/Math.log(a)};e.project=function(b,a,c,q,f){n[0]=b[0];n[1]=b[1];n[2]=b[2];n[3]=1;p.transformMat4(n,n,a);2<f.length&&(f[2]=-n[2]);p.transformMat4(n,n,c);k(0!==n[3]);f[0]=n[0]/n[3];f[1]=n[1]/n[3];f[2]=n[2]/n[3];f[0]=(.5*
f[0]+.5)*q[2]+q[0];f[1]=(.5*f[1]+.5)*q[3]+q[1]};e.rayBoxTest=function(b,a,c,q){let f,t=(c[0]-b[0])/a[0],m=(q[0]-b[0])/a[0];t>m&&(f=t,t=m,m=f);let l=(c[1]-b[1])/a[1],u=(q[1]-b[1])/a[1];l>u&&(f=l,l=u,u=f);if(t>u||l>m)return!1;l>t&&(t=l);u<m&&(m=u);c=(c[2]-b[2])/a[2];b=(q[2]-b[2])/a[2];c>b&&(f=c,c=b,b=f);if(t>b||c>m)return!1;b<m&&(m=b);return 0>m?!1:!0};e.rayRay2D=function(b,a,c,q,f,t=g.create()){const m=(q[f]-c[f])*(a[0]-b[0])-(q[0]-c[0])*(a[f]-b[f]);if(0===m)return!1;c=((q[0]-c[0])*(b[f]-c[f])-(q[f]-
c[f])*(b[0]-c[0]))/m;t[0]=b[0]+c*(a[0]-b[0]);t[1]=b[f]+c*(a[f]-b[f]);return!0};e.setMatrixTranslation3=function(b,a,c,q){b[12]=a;b[13]=c;b[14]=q};e.verify=function(b,a){b||console.warn("Verify failed: "+(a||"")+"\n"+Error("verify").stack)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(e,g,p){function h(L){switch(L.type){case "uint":return ha;
case "uvec2":return e.Vec2;case "uvec3":return e.Vec3;case "uvec4":return e.Vec4;default:throw Error("Found unexpected type");}}function k(L){switch(L.type){case "float":return e.UInt;case "vec2":return e.UVec2;case "vec3":return e.UVec3;case "vec4":return e.UVec4;default:throw Error("Found unexpected type");}}function n(L){switch(L.type){case "int":return ha;case "ivec2":return e.Vec2;case "ivec3":return e.Vec3;case "ivec4":return e.Vec4;default:throw Error("Found unexpected type");}}function d(L){switch(L.type){case "float":return ma;
case "vec2":return e.IVec2;case "vec3":return e.IVec3;case "vec4":return e.IVec4;default:throw Error("Found unexpected type");}}function b(L){switch(L.type){case "bool":case "float":case "int":case "uint":return ja;case "bvec2":case "vec2":case "ivec2":case "uvec2":return e.BVec2;case "bvec3":case "vec3":case "ivec3":case "uvec3":return e.BVec3;case "bvec4":case "vec4":case "ivec4":case "uvec4":return e.BVec4;default:throw Error("Unable to handle type");}}function a(L){switch(L.type){case "float":case "int":case "uint":case "bool":case "sampler2D":return 1;
case "vec2":case "ivec2":case "uvec2":case "bvec2":return 2;case "vec3":case "ivec3":case "uvec3":case "bvec3":return 3;case "vec4":case "ivec4":case "uvec4":case "bvec4":return 4;case "mat2":return 4;case "mat3":return 9;case "mat4":return 16;case "array":return L.size*a(L.elementType)}}function c(L){const V=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const ca of V)if(ca.includes(L))return ca.map(ea=>ta[ea]);
throw Error("Unable to find type family");}function q(L){return new Proxy(L,{get(V,ca){if("constructor"===ca)return new Proxy(V.constructor,{construct(ea,ka,ua){ea=new ea(...ka);return q(ea)}});if(ca in V)return V[ca];if("string"===typeof ca)return V=c(L.type),l(L,ca,V[ca.length-1])}})}function f(L){return new Proxy(L,{construct(V,ca,ea){V=new V(...ca);return q(V)}})}function t(L){return new Proxy(L,{get(V,ca){if(ca in V)return V[ca];if("string"===typeof ca&&(V=parseInt(ca,10),!isNaN(V)))return l(L,
`[${V}]`,L.elementType.constructor)}})}function m(L,V){return"number"===typeof L?new V(L):L}function l(L,V,ca){L=new ca(new p.ShaderPropertyAccessNode(V,L,ca));L.isImplicit=!0;return L}function u(L,V,ca,ea=null){if(ea){const ka=new ea;L=new ea(new p.ShaderFunctionNode(L,[V,ca],!0,!1,ka));L.isImplicit=!0;return L}if("float"===V.type||"int"===V.type||("mat2"===V.type||"mat3"===V.type||"mat4"===V.type)&&"float"!==ca.type)return L=new ca.constructor(new p.ShaderFunctionNode(L,[V,ca],!0,!1,ca.constructor)),
L.isImplicit=!0,L;L=new V.constructor(new p.ShaderFunctionNode(L,[V,ca],!0,!1,V.constructor));L.isImplicit=!0;return L}function v(L,V,ca=V.constructor){L=new ca(new p.ShaderFunctionNode(L,[V],!1,!1,ca));L.isImplicit=!0;return L}function r(L,V,ca,ea=V.constructor){L=new ea(new p.ShaderFunctionNode(L,[V,ca],!1,!1,ea));L.isImplicit=!0;return L}function y(L,V,ca,ea,ka=V.constructor){L=new ka(new p.ShaderFunctionNode(L,[V,ca,ea],!1,!1,ka));L.isImplicit=!0;return L}function x(L){return D(L,sa(-1))}function w(L,
V,ca,ea){return new V(new p.ShaderBlockNode(L,V,ca,ea))}function A(L,V,ca=0,ea=L.size){ca=(new ma(ca)).setMutable().setDebugName("FindIndexIterator");L=L.get(ca);V=V(L).setDebugName("FindIndexPredicate");return w({iter:ca},ma,V,({out:ka,iter:ua,subgraph:Ca})=>`\n${ka} = -1;\n\nfor (; ${ua} < ${ea}; ${ua}++) {\n\n${Ca.body}\n\n  if (${Ca.varName}) {\n    ${ka} = ${ua};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock")}function z(L,V,ca=0,ea=L.size){return w({array:L},ma,null,({out:ka,array:ua})=>
`\n${ka} = -1;\nfor (int i = ${ca}; i < ${ea}; i++) {\n  bool condition;\n  ${V({array:ua,i:"i",out:"condition"})}\n  if (condition) {\n    ${ka} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock")}function C(L,V,ca){V="function"===typeof V?V():V;ca="function"===typeof ca?ca():ca;L=new V.constructor(new p.ShaderConditionNode(L,V,ca));L.isImplicit=!0;return L}function D(L,V){return u("*",L,V)}function F(L,V){return u("/",L,V)}function G(L,V){return u("+",L,V)}function B(L,V){return u("-",
L,V)}function I(...L){return 1>=L.length?L[0]:L.slice(1).reduce((V,ca)=>H(V,ca),L[0])}function H(L,V){return u("||",L,V,ja)}function K(...L){return 1>=L.length?L[0]:L.slice(1).reduce((V,ca)=>u("\x26\x26",V,ca,ja),L[0])}function O(L){return v("all",L,ja)}function R(L){return v("any",L,ja)}function E(L){return v("cos",L)}function J(L){return v("sin",L)}var Q,N,S,W,U,M,P,T,X,Y,Z,ba,aa,da;class fa extends Error{}e.FixedArray=Q=class extends p.ShaderPrimitiveNode{constructor(L,V){super();this.elementType=
L;this.size=V;this.children=[];this.type="array"}clone(){const L=new Q(this.elementType,this.size);super.cloneInto(L);return L}get(L){return"number"===typeof L?(L=new ma(L),L.isImplicit=!0,l(this,L,this.elementType.constructor)):l(this,L,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(L,V,ca){return A(this,L,V,ca)}glslFindIndex(L,V,ca){return z(this,L,V,ca)}static ofType(L,V){return new Proxy(Q,{construct(ca,ea){return new Q(new L,V)}})}};e.FixedArray.type=
"array";e.FixedArray=Q=g.__decorate([function(L){return new Proxy(L,{construct(V,ca,ea){V=new V(...ca);return t(V)}})}],e.FixedArray);class ia extends p.ShaderPrimitiveNode{constructor(){super(...arguments);this.type="sampler2D";this.children=[]}clone(){const L=new ia;L.children=this.children.map(p.cloneShaderNode);super.cloneInto(L);return L}}ia.type="sampler2D";class ha extends p.ShaderPrimitiveNode{constructor(L){super();this.type="float";this.children=[L]}clone(){const L=new ha(p.cloneShaderNode(this.children[0]));
super.cloneInto(L);return L}multiply(L){return"number"===typeof L?D(this,m(L,ha)):D(this,L)}divide(L){return"number"===typeof L?F(this,m(L,ha)):F(this,L)}add(L){return"number"===typeof L?G(this,m(L,ha)):G(this,L)}subtract(L){return"number"===typeof L?B(this,m(L,ha)):B(this,L)}}ha.type="float";e.Vec2=N=class extends p.ShaderPrimitiveNode{constructor(L,V){super();this.type="vec2";this.children=[L,V].filter(ca=>null!=ca)}clone(){const L=new N(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));
super.cloneInto(L);return L}get 0(){return l(this,"[0]",ha)}get 1(){return l(this,"[1]",ha)}get 2(){throw new fa;}get 3(){throw new fa;}multiply(L){return D(this,"number"===typeof L?m(L,ha):L)}divide(L){return F(this,"number"===typeof L?m(L,ha):L)}add(L){return G(this,"number"===typeof L?m(L,ha):L)}subtract(L){return B(this,"number"===typeof L?m(L,ha):L)}};e.Vec2.type="vec2";e.Vec2=N=g.__decorate([f],e.Vec2);e.Vec3=S=class extends p.ShaderPrimitiveNode{constructor(L,V,ca){super();this.type="vec3";
this.children=[L,V,ca].filter(ea=>null!=ea)}get 0(){return l(this,"[0]",ha)}get 1(){return l(this,"[1]",ha)}get 2(){return l(this,"[2]",ha)}get 3(){throw new fa;}clone(){const L=new S(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(L);return L}multiply(L){return D(this,"number"===typeof L?m(L,ha):L)}divide(L){return F(this,"number"===typeof L?m(L,ha):L)}add(L){return G(this,"number"===typeof L?m(L,ha):L)}subtract(L){return B(this,
"number"===typeof L?m(L,ha):L)}};e.Vec3.type="vec3";e.Vec3=S=g.__decorate([f],e.Vec3);e.Vec4=W=class extends p.ShaderPrimitiveNode{constructor(L,V,ca,ea){super();this.type="vec4";this.children=[L,V,ca,ea].filter(ka=>null!=ka)}clone(){const L=new W(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(L);return L}get 0(){return l(this,"[0]",ha)}get 1(){return l(this,"[1]",ha)}get 2(){return l(this,
"[2]",ha)}get 3(){return l(this,"[3]",ha)}multiply(L){return D(this,"number"===typeof L?m(L,ha):L)}divide(L){return F(this,"number"===typeof L?m(L,ha):L)}add(L){return G(this,"number"===typeof L?m(L,ha):L)}subtract(L){return B(this,"number"===typeof L?m(L,ha):L)}};e.Vec4.type="vec4";e.Vec4=W=g.__decorate([f],e.Vec4);e.UInt=U=class extends p.ShaderPrimitiveNode{constructor(L){super();this.type="uint";this.children=[L]}clone(){const L=new U(p.cloneShaderNode(this.children[0]));super.cloneInto(L);return L}};
e.UInt.type="uint";e.UInt=U=g.__decorate([f],e.UInt);e.UVec2=M=class extends p.ShaderPrimitiveNode{constructor(L,V){super();this.type="uvec2";this.children=[L,V].filter(ca=>null!=ca)}clone(){const L=new M(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(L);return L}};e.UVec2.type="uvec2";e.UVec2=M=g.__decorate([f],e.UVec2);e.UVec3=P=class extends p.ShaderPrimitiveNode{constructor(L,V,ca){super();this.type="uvec3";this.children=[L,V,ca].filter(ea=>null!=ea)}clone(){const L=
new P(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(L);return L}};e.UVec3.type="uvec3";e.UVec3=P=g.__decorate([f],e.UVec3);e.UVec4=T=class extends p.ShaderPrimitiveNode{constructor(L,V,ca,ea){super();this.type="uvec4";this.children=[L,V,ca,ea].filter(ka=>null!=ka)}clone(){const L=new T(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));
super.cloneInto(L);return L}};e.UVec4.type="uvec4";e.UVec4=T=g.__decorate([f],e.UVec4);class ja extends p.ShaderPrimitiveNode{constructor(L){super();this.type="bool";this.children=[L]}and(L){return K(this,L)}or(L){return I(this,L)}clone(){const L=new ja(p.cloneShaderNode(this.children[0]));super.cloneInto(L);return L}}ja.type="bool";e.BVec2=X=class extends p.ShaderPrimitiveNode{constructor(L,V){super();this.type="bvec2";this.children=[L,V].filter(ca=>null!=ca)}all(){return O(this)}any(){return R(this)}clone(){const L=
new X(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(L);return L}};e.BVec2.type="bvec2";e.BVec2=X=g.__decorate([f],e.BVec2);e.BVec3=Y=class extends p.ShaderPrimitiveNode{constructor(L,V,ca){super();this.type="bvec3";this.children=[L,V,ca].filter(ea=>null!=ea)}all(){return O(this)}any(){return R(this)}clone(){const L=new Y(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(L);return L}};
e.BVec3.type="bvec3";e.BVec3=Y=g.__decorate([f],e.BVec3);e.BVec4=Z=class extends p.ShaderPrimitiveNode{constructor(L,V,ca,ea){super();this.type="bvec4";this.children=[L,V,ca,ea].filter(ka=>null!=ka)}all(){return O(this)}any(){return R(this)}clone(){const L=new Z(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(L);return L}};e.BVec4.type="bvec4";e.BVec4=Z=g.__decorate([f],e.BVec4);class ma extends p.ShaderPrimitiveNode{constructor(L){super();
this.type="int";this.children=[L]}multiply(L){return D(this,m(L,ma))}add(L){return G(this,m(L,ma))}subtract(L){return B(this,m(L,ma))}divide(L){return F(this,m(L,ma))}clone(){const L=new ma(p.cloneShaderNode(this.children[0]));super.cloneInto(L);return L}}ma.type="int";e.IVec2=ba=class extends p.ShaderPrimitiveNode{constructor(L,V){super();this.type="ivec2";this.children=[L,V].filter(ca=>null!=ca)}clone(){const L=new ba(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]));super.cloneInto(L);
return L}};e.IVec2.type="ivec2";e.IVec2=ba=g.__decorate([f],e.IVec2);e.IVec3=aa=class extends p.ShaderPrimitiveNode{constructor(L,V,ca){super();this.type="ivec3";this.children=[L,V,ca].filter(ea=>null!=ea)}clone(){const L=new aa(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]));super.cloneInto(L);return L}};e.IVec3.type="ivec3";e.IVec3=aa=g.__decorate([f],e.IVec3);e.IVec4=da=class extends p.ShaderPrimitiveNode{constructor(L,V,ca,ea){super();
this.type="ivec4";this.children=[L,V,ca,ea].filter(ka=>null!=ka)}clone(){const L=new da(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(L);return L}};e.IVec4.type="ivec4";e.IVec4=da=g.__decorate([f],e.IVec4);class na extends p.ShaderPrimitiveNode{constructor(L,V,ca,ea){super();this.type="mat2";this.children=[L,V,ca,ea]}clone(){const L=new na(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),
p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]));super.cloneInto(L);return L}}na.type="mat2";class oa extends p.ShaderPrimitiveNode{static identity(){return new oa(1,0,0,0,1,0,0,0,1)}static fromRotation(L){const V=J(L);L=E(L);return new oa(L,V,0,x(V),L,0,0,0,1)}constructor(L,V,ca,ea,ka,ua,Ca,Xa,Ya){super();this.type="mat3";this.children=[L,V,ca,ea,ka,ua,Ca,Xa,Ya]}add(L){return G(this,L)}multiply(L){return D(this,L)}clone(){const L=new oa(p.cloneShaderNode(this.children[0]),
p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]),p.cloneShaderNode(this.children[4]),p.cloneShaderNode(this.children[5]),p.cloneShaderNode(this.children[6]),p.cloneShaderNode(this.children[7]),p.cloneShaderNode(this.children[8]));super.cloneInto(L);return L}}oa.type="mat3";class pa extends p.ShaderPrimitiveNode{static identity(){return new pa(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(L,V,ca,ea,ka,ua,Ca,Xa,Ya,hb,sb,tb,Pb,Qb,ub,za){super();
this.type="mat4";this.children=[L,V,ca,ea,ka,ua,Ca,Xa,Ya,hb,sb,tb,Pb,Qb,ub,za]}static fromColumns(L,V,ca,ea){return new pa(L.x,L.y,L.z,L.w,V.x,V.y,V.z,V.w,ca.x,ca.y,ca.z,ca.w,ea.x,ea.y,ea.z,ea.w)}multiply(L){return D(this,L)}clone(){const L=new pa(p.cloneShaderNode(this.children[0]),p.cloneShaderNode(this.children[1]),p.cloneShaderNode(this.children[2]),p.cloneShaderNode(this.children[3]),p.cloneShaderNode(this.children[4]),p.cloneShaderNode(this.children[5]),p.cloneShaderNode(this.children[6]),p.cloneShaderNode(this.children[7]),
p.cloneShaderNode(this.children[8]),p.cloneShaderNode(this.children[9]),p.cloneShaderNode(this.children[10]),p.cloneShaderNode(this.children[11]),p.cloneShaderNode(this.children[12]),p.cloneShaderNode(this.children[13]),p.cloneShaderNode(this.children[14]),p.cloneShaderNode(this.children[15]));super.cloneInto(L);return L}}pa.type="mat4";const ta={float:ha,vec2:e.Vec2,vec3:e.Vec3,vec4:e.Vec4,int:ma,ivec2:e.IVec2,ivec3:e.IVec3,ivec4:e.IVec4,uint:e.UInt,uvec2:e.UVec2,uvec3:e.UVec3,uvec4:e.UVec4,bool:ja,
bvec2:e.BVec2,bvec3:e.BVec3,bvec4:e.BVec4},sa=(...L)=>new ha(...L);e.Bool=ja;e.Float=ha;e.Int=ma;e.Mat2=na;e.Mat3=oa;e.Mat4=pa;e.Sampler2D=ia;e._or=H;e.abs=function(L){return v("abs",L)};e.acos=function(L){return v("acos",L)};e.acosh=function(L){return v("acosh",L)};e.add=G;e.all=O;e.and=K;e.any=R;e.asin=function(L){return v("asin",L)};e.asinh=function(L){return v("asinh",L)};e.atan=function(L,V){return null==V?v("atan",L):r("atan",L,V,L.constructor)};e.atanh=function(L){return v("atanh",L)};e.bitAnd=
function(L,V){return u("\x26",L,V)};e.bitOr=function(L,V){return u("|",L,V)};e.bitRShift=function(L,V){return u("\x3e\x3e",L,V)};e.bitShift=function(L,V){return u("\x3c\x3c",L,V)};e.bitXor=function(L,V){return u("^",L,V)};e.block=w;e.ceil=function(L){return v("ceil",L)};e.clamp=function(L,V,ca){return y("clamp",L,V,ca,L.constructor)};e.cond=function(...L){var V=L.map(([ea,ka])=>"function"===typeof ka?[ea,ka()]:[ea,ka]);L=V[0][1].constructor;const ca=V.findIndex(ea=>!0===ea[0]);if(-1===ca)throw Error("A cond must have a fallthrough case with `true`/; ");
V=V.slice(0,ca).reduceRight((ea,ka)=>C(ka[0],ka[1],ea),V[ca][1]);L=new L(V);L.isImplicit=!0;return L};e.cos=E;e.cosh=function(L){return v("cosh",L)};e.cross=function(L,V){return r("cross",L,V,L.constructor)};e.dFdx=function(L){return v("dFdX",L)};e.dFdy=function(L){return v("dFdY",L)};e.definePropertyAccess=l;e.degrees=function(L){return v("degrees",L)};e.determinant=function(L){return v("determinant",L,ha)};e.distance=function(L,V){return r("distance",L,V,ha)};e.divide=F;e.dot=function(L,V){return r("dot",
L,V,ha)};e.equal=function(L,V){return u("\x3d\x3d",L,V,ja)};e.equalComponent=function(L,V){return r("equal",L,V,b(L))};e.exp=function(L){return v("exp",L)};e.exp2=function(L){return v("exp2",L)};e.faceforward=function(L,V,ca){return y("faceforward",L,V,ca)};e.findIndex=A;e.float=sa;e.floatBitsToInt=function(L){return v("floatBitsToInt",L,d(L))};e.floatBitsToUint=function(L){return v("floatBitsToUint",L,k(L))};e.floor=function(L){return v("floor",L)};e.fract=function(L){return v("fract",L)};e.fwidth=
function(L){return v("fwidth",L)};e.getTypeElementLengthForType=a;e.glslFindIndex=z;e.greaterThan=function(L,V){return u("\x3e",L,V,ja)};e.greaterThanComponent=function(L,V){return r("greaterThan",L,V,b(L))};e.greaterThanEqual=function(L,V){return u("\x3e\x3d",L,V,ja)};e.greaterThanEqualComponent=function(L,V){return r("greaterThanEqual",L,V,b(L))};e.ifElse=C;e.int=(...L)=>new ma(...L);e.intBitsToFloat=function(L){return v("intBitsToFloat",L,n(L))};e.inverse=function(L){return v("inverse",L,ha)};
e.inversesqrt=function(L){return v("inversesqrt",L)};e.isinf=function(L){return v("isinf",L,b(L))};e.isnan=function(L){return v("isnan",L,b(L))};e.length=function(L){return v("length",L,ha)};e.lessThan=function(L,V){return u("\x3c",L,V,ja)};e.lessThanComponent=function(L,V){return r("lessThan",L,V,b(L))};e.lessThanEqual=function(L,V){return u("\x3c\x3d",L,V,ja)};e.lessThanEqualComponent=function(L,V){return r("lessThanEqual",L,V,b(L))};e.log=function(L){return v("log",L)};e.log2=function(L){return v("log2",
L)};e.mat2=(...L)=>new na(...L);e.mat3=(...L)=>new oa(...L);e.mat4=(...L)=>new pa(...L);e.matrixCompMult=function(L,V){return r("matrixCompMult",L,V)};e.max=function(L,V){return r("max",L,V)};e.min=function(L,V){return r("min",L,V)};e.mix=function(L,V,ca){return y("mix",L,V,ca)};e.mod=function(L,V){return r("mod",L,V)};e.modf=function(L,V){throw Error("modf not implemented");};e.multiply=D;e.namedScope=function(L,V){L="function"===typeof L?L():L;V=new L.constructor((new p.ShaderScopeNode(L)).setDebugName(V));
V.isImplicit=!0;return V};e.negate=x;e.normalize=function(L){return v("normalize",L)};e.not=function(L){return"bool"===L.type?v("!",L):v("not",L)};e.notEqual=function(L,V){return u("!\x3d",L,V,ja)};e.notEqualComponent=function(L,V){return r("notEqual",L,V,b(L))};e.or=I;e.outerProduct=function(L,V){throw Error("Impl type?");};e.packHalf2x16=function(L){return v("packHalf2x16",L,e.UInt)};e.packSnorm2x16=function(L){return v("packSnorm2x16",L,e.UInt)};e.packUnorm2x16=function(L){return v("packUnorm2x16",
L,e.UInt)};e.pow=function(L,V){return r("pow",L,V)};e.radians=function(L){return v("radians",L)};e.reflect=function(L,V){return r("reflect",L,V)};e.refract=function(L,V,ca){return y("refract",L,V,ca)};e.round=function(L){return v("round",L)};e.roundEven=function(L){return v("roundEven",L)};e.sign=function(L){return v("sign",L)};e.sin=J;e.sinh=function(L){return v("sinh",L)};e.smoothstep=function(L,V,ca){return y("smoothstep",L,V,ca)};e.sqrt=function(L){return v("sqrt",L)};e.step=function(L,V){return r("step",
L,V,V.constructor)};e.subtract=B;e.tan=function(L){return v("tan",L)};e.tanh=function(L){return v("tanh",L)};e.texelFetch=function(L,V,ca){throw Error("Impl type");};e.texelFetchOffset=function(L,V,ca,ea){throw Error("Impl type");};e.texture=function(L,V,ca){throw Error("Impl type");};e.texture2D=function(L,V){return r("texture2D",L,V,e.Vec4)};e.textureGrad=function(L,V,ca,ea){throw Error("Impl type");};e.textureGradOffset=function(L,V,ca,ea,ka){throw Error("Impl type");};e.textureLod=function(L,
V,ca){throw Error("Impl type");};e.textureLodOffset=function(L,V,ca,ea){throw Error("Impl type");};e.textureOffset=function(L,V,ca,ea){throw Error("Impl type");};e.textureProj=function(L,V,ca){throw Error("Impl type");};e.textureProjGrad=function(L,V,ca,ea){throw Error("Impl type");};e.textureProjGradOffset=function(L,V,ca,ea,ka){throw Error("Impl type");};e.textureProjLod=function(L,V,ca){throw Error("Impl type");};e.textureProjLodOffset=function(L,V,ca,ea){throw Error("Impl type");};e.textureProjOffset=
function(L,V,ca,ea){throw Error("Impl type");};e.textureSize=function(L,V){throw Error("Impl type");};e.transformFloatToInt=d;e.transformFloatToUInt=k;e.transformIntToFloat=n;e.transformTypeToBooleanType=b;e.transformUIntToFloat=h;e.transpose=function(L){return v("transpose",L)};e.trunc=function(L){return v("trunc",L)};e.uintBitsToFloat=function(L){return v("uintBitsToFloat",L,h(L))};e.unpackHalf2x16=function(L){return v("unpackHalf2x16",L,e.Vec2)};e.unpackSnorm2x16=function(L){return v("unpackSnorm2x16",
L,e.Vec2)};e.unpackUnorm2x16=function(L){return v("unpackUnorm2x16",L,e.Vec2)};e.vec2=(...L)=>new e.Vec2(...L);e.vec3=(...L)=>new e.Vec3(...L);e.vec4=(...L)=>new e.Vec4(...L);e.when=function(L,V){L=new V.constructor(new p.ShaderConditionNode(L,V,null));L.isImplicit=!0;return L};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],function(e){function g(f){return f.split(" ").map((t,m)=>0<m?t.charAt(0).toUpperCase()+
t.slice(1):t).join("")}function p(f){return"object"===typeof f?f.clone():f}class h{constructor(){this.uid=h.NodeCount++;this._debugName=null;this.isImplicit=this._isMutable=!1}get isMutable(){return this._isMutable}setMutable(){this._isMutable=!0;return this}setDebugName(f){this._debugName=f=g(f);this.isImplicit&&this.children[0]instanceof h&&this.children[0].setDebugName(f);return this}get debugInfo(){return{name:this._debugName??""}}cloneInto(f){f._debugName=this._debugName;f._isMutable=this._isMutable;
f.isImplicit=this.isImplicit;f.uid=this.uid}}h.NodeCount=0;class k extends h{constructor(){super(...arguments);this.shaderType="primitive-node"}}class n extends h{constructor(f){super();this.child=f;this.shaderType="scope-node"}get children(){return[this.child]}clone(){const f=new n(p(this.child));this.cloneInto(f);return f}}class d extends h{constructor(f){super();this.text=f;this.shaderType="text-node"}get children(){return[]}clone(){const f=new d(this.text);this.cloneInto(f);return f}}class b extends h{constructor(f,
t,m){super();this.property=f;this.target=t;this.returnType=m;this.shaderType="property-access-node"}get children(){const f=[this.target];"string"!==typeof this.property&&f.push(this.property);return f}clone(){const f=new b(this.property,p(this.target),this.returnType);this.cloneInto(f);return f}}class a extends h{constructor(f,t,m){super();this.condition=f;this.ifTrue=t;this.ifFalse=m;this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){var f=p(this.ifTrue);
const t=this.ifFalse?p(this.ifFalse):null;f=new a(this.condition,f,t);this.cloneInto(f);return f}}class c extends h{constructor(f,t,m,l){super();this.captureList=f;this.returnType=t;this.generator=l;this.shaderType="block-node";m&&(this.subgraph=new n(m))}get children(){return Object.keys(this.captureList).map(f=>this.captureList[f]).concat(this.subgraph??[])}clone(){var f={};for(const t in this.captureList)f[t]=p(this.captureList[t]);f=new c(f,this.returnType,this.subgraph?p(this.subgraph.child):
this.subgraph,this.generator);this.cloneInto(f);return f}}class q extends h{constructor(f,t,m,l,u,v=!1){super();this.token=f;this._children=t;this.isInfix=m;this.isPropertyAccess=l;this.returnType=u;this.isTernary=v;this.shaderType="function-node"}get children(){return this._children}clone(){const f=new q(this.token,this._children.map(p),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);this.cloneInto(f);return f}}e.ShaderBlockNode=c;e.ShaderConditionNode=a;e.ShaderFunctionNode=q;
e.ShaderNode=h;e.ShaderPrimitiveNode=k;e.ShaderPropertyAccessNode=b;e.ShaderScopeNode=n;e.ShaderTextNode=d;e.cloneShaderNode=p;e.setReachableUids=function(f,t){const m=[];for(m.push(t);m.length;)if(t=m.pop(),"object"===typeof t&&!f.has(t.uid)){f.add(t.uid);for(const l of t.children)m.push(l)}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],function(e){function g(h,k,n){k=k.split("\n");for(const d of k)if(d.trim().length){k=
"";const b=n??"000";null!=n&&(k+=`/*id:${b}*/   `);h.body+=k.padEnd(14);h.body+=" ".repeat(h.indent)+d+"\n"}}class p{write(h){for(const k of h.rootOutputNodes())h.shouldPruneOutputNode(k)||(k.variableName=this._write(h,k.node));return h}_createVarName(h,k){let n="";"boolean"!==typeof k&&"number"!==typeof k&&k.debugInfo.name&&(n=`${k.debugInfo.name}_`);return`${n}v${h.varCount++}`}_write(h,k,n=!1){if("number"===typeof k||"boolean"===typeof k)return k.toString();let d=h.getEmit(k);if(d)return d;switch(k.shaderType){case "scope-node":d=
this._writeScopeNode(h,k);break;case "primitive-node":d=this._writePrimitveNode(h,k,n);break;case "function-node":d=this._writeFunctionNode(h,k);break;case "property-access-node":d=this._writePropertyAccessNode(h,k);break;case "text-node":d=k.text;break;case "block-node":d=this._writeBlockNode(h,k);break;case "condition-node":d=this._writeConditionNode(h,k)}h.setEmit(k,d);return d}_writeScopeNode(h,k){var n=new k.child.constructor;n.setDebugName(k.debugInfo.name);n=this._write(h,n,!0);g(h,`{ /*ScopeStart: ${k.uid} ${k.debugInfo.name}*/`);
h.indent+=2;const d=this._write(h,k.child);g(h,`${n} = ${d};`);h.indent-=2;g(h,`} /*ScopeEnd: ${k.uid} ${k.debugInfo.name}*/`);return n}_writeConditionNode(h,k){var n=new k.ifTrue.constructor;n=this._write(h,n,!0);var d=this._write(h,k.condition);g(h,`if (${d}) {`);h.indent+=2;d=h.createSubgraphContext();const b=this._write(d,k.ifTrue);h.body+=d.body;b&&g(h,`${n} = ${b};`);h.indent-=2;g(h,"}");k.ifFalse&&(g(h,"else {"),h.indent+=2,d=h.createSubgraphContext(),k=this._write(d,k.ifFalse),h.body+=d.body,
k&&g(h,`${n} = ${k};`),h.indent-=2,g(h,"}"));return n}_writeBlockNode(h,k){const {captureList:n,generator:d,returnType:b}=k;var a={};for(var c in n)if(n[c]){var q=this._write(h,n[c]);a[c]=q}c=new b;c=this._write(h,c,!0);a.out=c;k.subgraph&&(q=h.createSubgraphContext(),k=this._write(q,k.subgraph.child),a.subgraph={varName:k,body:q.body});a=d(a);g(h,"{\n");h.indent+=2;g(h,a);h.indent-=2;g(h,"}\n");return c}_writePropertyAccessNode(h,k){const n=this._write(h,k.target);return"string"===typeof k.property&&
k.property.includes("[")?`${n}${k.property}`:"string"!==typeof k.property?(h=this._write(h,k.property),`${n}[${h}]`):`${n}.${k.property}`}_writeFunctionNode(h,k){const n=k.returnType.type;if(k.isInfix){const [a,c]=k.children.map(q=>this._write(h,q));var d=this._createVarName(h,k);g(h,`${n.padEnd(5)} ${d} = ${a} ${k.token} ${c};`,k.uid);return d}d=k.children.map(a=>this._write(h,a)).join(", ");const b=this._createVarName(h,k);g(h,`${n.padEnd(5)} ${b} = ${k.token}(${d});`,k.uid);return b}_writePrimitveNode(h,
k,n=!1){var d=h.getInput(k);if(d)return d.isUsed=!0,d.variableName;d=1===k.children.length&&k.children[0]?.type===k.type;if(k.isImplicit||d)return this._write(h,k.children[0]);d=this._createVarName(h,k);if(n)return g(h,`${k.type.padEnd(5)} ${d};`,k.uid),d;if((n=!k.debugInfo.name&&!k.isMutable)&&"float"===k.type&&"number"===typeof k.children[0])return Number.isInteger(k.children[0])?k.children[0].toFixed(1):k.children[0].toString();if(n&&"int"===k.type&&"number"===typeof k.children[0]&&Number.isInteger(k.children[0]))return k.children[0].toString();
const b=k.children.map(a=>this._write(h,a)).join(", ");if("array"===k.type)return g(h,`${k.type.padEnd(5)} ${d} = [${b}];`,k.uid),d;if(n)return`${k.type}(${b})`;g(h,`${k.type.padEnd(5)} ${d} = ${k.type}(${b});`,k.uid);return d}}e.GlslShaderWriter=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports","./ShaderGraphNode"],function(e,g){class p{constructor(n,d,b){this.variableName=n;this.variableInputType=
d;this.node=b;this.type="shader-input";this.isUsed=!1}clone(){return new p(this.variableName,this.variableInputType,g.cloneShaderNode(this.node))}}class h{constructor(n,d,b){this.outVariableName=n;this.outVariableType=d;this.node=b;this.type="shader-output"}clone(){const n=new h(this.outVariableName,this.outVariableType,g.cloneShaderNode(this.node));n.variableName=this.variableName;return n}}class k{static createVertex(n,d,b,a,c,q){const f=[];for(const t in n){const m=n[t],l=b.get(t);l?f.push(new p(l,
"builtin",m)):f.push(new p("a_"+t,"attribute",m))}for(const t of a)f.push(new p(t.uniformName,"uniform",t.uniformHydrated));n=[];for(const t in d)b=d[t],"glPosition"===t?n.push(new h("gl_Position","builtin",b)):"glPointSize"===t?n.push(new h("gl_PointSize","builtin",b)):n.push(new h("v_"+t,"varying",b));return new k(f,n,c,q)}static createFragment(n,d,b,a,c,q){const f=[];c=Array.from(c.rootOutputNodes());for(var t in n){const l=n[t];var m=b.get(t);m?f.push(new p(m,"builtin",l)):(m=c.find(u=>u.node===
l))&&f.push(new p(m.outVariableName,m.outVariableType,l))}for(const l of a)f.push(new p(l.uniformName,"uniform",l.uniformHydrated));n=[];for(const l in d)if(a=d[l],t=b.get(l),"discard"===l)n.push(new h(null,"discard",a));else if(t)n.push(new h(t,"builtin",a));else throw Error(`Member ${l} in shader fragment output shoule be tagged as builtin`);return new k(f,n,q)}constructor(n,d,b,a){this.type="shader-graph-context";this.indent=0;this.body="";this.varCount=0;this._inputShaderTypesByNodeUid=new Map;
this._nodeEmitMap=new Map;for(const c of n)this._inputShaderTypesByNodeUid.set(c.node.uid,c);this._outputShaderTypes=d;this._transformFeedbackBindings=b;this._transformFeedbackNames=new Set(b.map(c=>"v_"+c.propertyKey));this._usedInFragmentShader=a}shouldPruneOutputNode(n){return!this._usedInFragmentShader||"builtin"===n.outVariableType||this._transformFeedbackNames.has(n.outVariableName)?!1:!this._usedInFragmentShader.has(n.node.uid)}setEmit(n,d){this._nodeEmitMap.set(n.uid,d)}getEmit(n){return this._nodeEmitMap.get(n.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(n){return this._inputShaderTypesByNodeUid.get(n.uid)}*rootOutputNodes(){for(const n of this._outputShaderTypes)yield n}*nodes(){const n=
[];for(var d of this._outputShaderTypes.values())n.push(d.node);for(;n.length;)d=n.pop(),"number"!==typeof d&&"boolean"!==typeof d&&n.push(...d.children.filter(Boolean)),yield d}*nodesOfTypeOrFunction(){for(const n of this.nodes())"number"!==typeof n&&"boolean"!==typeof n&&(yield n)}createSubgraphContext(){const n=this.clone();n.body="";n.indent=this.indent+2;n._nodeEmitMap=new Map(this._nodeEmitMap);return n}clone(){const n=new k([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);
n._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid;n.indent=this.indent;n.body=this.body;n.varCount=this.varCount;n._nodeEmitMap=this._nodeEmitMap;return n}insertVertexShader(n){n.vertex.code.add("");this._insertInputs(n,"vertex");n.vertex.code.add("");n.vertex.code.add("// OUTPUTS: ");n.vertex.code.add("// --------------------------------------------------------- ");for(const d of this.rootOutputNodes()){const b="builtin"===d.outVariableType;this.shouldPruneOutputNode(d)||(b?n.vertex.code.add(`// ${d.outVariableType.padEnd(7)} ${d.node.type.padEnd(9)} ${d.outVariableName};`):
n.vertex.code.add(`${d.outVariableType.padEnd(10)} ${d.node.type.padEnd(9)} ${d.outVariableName};`))}n.vertex.code.add("");n.vertex.code.add("void main() {");n.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const d of this.rootOutputNodes())this.shouldPruneOutputNode(d)||n.vertex.code.add("  "+`${d.outVariableName} = ${d.variableName};`);n.vertex.code.add("}")}insertFragmentShader(n){this._insertInputs(n,"fragment");n.fragment.code.add("");n.fragment.code.add("void main() {");n.fragment.code.add("  "+
this.body.split("\n").join("\n  "));for(const d of this.rootOutputNodes())"discard"===d.outVariableType?(n.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),n.fragment.code.add("  "+`if (${d.variableName}) {`),n.fragment.code.add("    discard;"),n.fragment.code.add("  }"),n.fragment.code.add("  ")):n.fragment.code.add("  "+`${d.outVariableName} = ${d.variableName};`);n.fragment.code.add("}")}_insertInputs(n,d){n[d].code.add("// INPUTS: ");n[d].code.add("// --------------------------------------------------------- ");
for(const b of this.inputs())b.isUsed&&"builtin"!==b.variableInputType&&("array"===b.node.type?n[d].code.add(`${b.variableInputType.padEnd(10)} ${b.node.elementType.type.padEnd(9)} ${b.variableName}[${b.node.size}];`):n[d].code.add(`${b.variableInputType.padEnd(10)} ${b.node.type.padEnd(9)} ${b.variableName};`))}}e.ShaderGraphContext=k;e.ShaderInput=p;e.ShaderOutput=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define("exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/object ../../../../../../core/RandomLCG ../../../../../../core/has ../../../../../webgl/checkWebGLError ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Program ../../../../../webgl/GLObjectType ../../../../../webgl/Texture ../../Utils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t){function m(u,v,r){const y=v.length;y!==r&&(u=new g("Invalid Uniform",`Invalid length, expected ${r} but got ${y}`,{uniformName:u,values:v}),p.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(u))}class l{constructor(u,v,r,y,x,w){this._vao=this._program=null;this._temporaryTextures=[];this.vertexShader=u;this.fragmentShader=v;this._locations=r;this._locationInfo=y;this._uniformBindings=x;this._transformFeedbackBindings=w}destroy(){this._program&&
this._program.dispose();this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(u){this._uniforms=u}cleanupTemporaryTextures(){for(const u of this._temporaryTextures)u.dispose();this._temporaryTextures=[]}bind(u){const v=this._uniforms;if(!this._program){var r=new Map;for(const [x,w]of this._locations)r.set(x,w);var y=[];for(const x of this._transformFeedbackBindings??[]){const {index:w,propertyKey:A}=x;y[w]=`v_${A}`}this._program=
new c.Program(u,this.vertexShader,this.fragmentShader,r,new Map,y)}r=this._program;u.useProgram(r);for(const x of this._uniformBindings){const {shaderModulePath:w,uniformName:A,uniformType:z,uniformArrayLength:C}=x;y=h.getDeepValue(w,v);if(null==y){if("sampler2D"===z)continue;throw Error(`Failed to find uniform value for ${w}`);}switch("array"===z?x.uniformArrayElementType:z){case "sampler2D":const {unit:D,texture:F}=y;r.setUniform1i(A,D);"type"in F?u.bindTexture(F,D):(y=t.createTexture(u,F.descriptor,
F.data),u.bindTexture(y,D));break;case "int":if(!C){r.setUniform1i(A,y);break}m(x.uniformName,y,C);r.setUniform1iv(A,y);break;case "float":if(!C){r.setUniform1f(A,y);break}m(x.uniformName,y,C);r.setUniform1fv(A,y);break;case "vec2":if(!C){r.setUniform2f(A,y[0],y[1]);break}m(x.uniformName,y,C);r.setUniform2fv(A,y.flat());break;case "vec3":if(!C){r.setUniform3f(A,y[0],y[1],y[2]);break}m(x.uniformName,y,C);r.setUniform3fv(A,y.flat());break;case "vec4":if(!C){r.setUniform4f(A,y[0],y[1],y[2],y[3]);break}m(x.uniformName,
y,C);r.setUniform4fv(A,y.flat());break;case "mat3":r.setUniformMatrix3fv(A,y.flat());break;case "mat4":r.setUniformMatrix4fv(A,y.flat());break;default:throw Error(`Unable to set uniform for type ${z}`);}}}}e.TypedShaderProgram=l;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../highlightReasons ../../GraphShaderModule ../../graph/glsl ./EntityStorage ./ShaderHighlight ./ShaderHittest ./utils ./ViewInfo".split(" "),
function(e,g,p,h,k,n,d,b,a,c){class q extends h.VertexInput{}g.__decorate([h.location(0,k.Vec3)],q.prototype,"id",void 0);g.__decorate([h.location(1,k.Float)],q.prototype,"bitset",void 0);g.__decorate([h.location(2,k.Vec2)],q.prototype,"pos",void 0);class f extends h.ComputeVertexInput{}g.__decorate([h.location(14,k.Vec2)],f.prototype,"nextPos1",void 0);g.__decorate([h.location(15,k.Vec2)],f.prototype,"nextPos2",void 0);class t extends h.FragmentInput{}class m extends h.GraphShaderModule{clip(l,u){let v=
new k.Float(0);l=this.storage.getFilterFlags(l);v=v.add(k.float(2).multiply(k.float(1).subtract(a.getFilterBit(l,0))));this.inside?v=v.add(k.float(2).multiply(k.float(1).subtract(a.getFilterBit(l,1)))):this.outside?v=v.add(k.float(2).multiply(a.getFilterBit(l,1))):this.highlight&&(v=v.add(k.float(2).multiply(k.float(1).subtract(this._checkHighlight(l)))));null!=u&&(l=(new k.Float(1)).subtract(k.step(u.x,this.view.currentZoom)),u=k.step(u.y,this.view.currentZoom),v=v.add((new k.Float(2)).multiply(l.add(u))));
return v}getFragmentOutput(l,u,v=new k.Float(1/255)){const r=new h.FragmentOutput;r.glFragColor=this._maybeWriteHittest(u)??this._maybeHighlight(l,v)??l;return r}_maybeHighlight(l,u){return this.highlight?new k.Vec4(l.rgb,k.step(u,l.a)):null}_checkHighlight(l){let u=this._checkHighlightBit(l,0);for(let v=1;v<p.highlightReasons.length;v++)u=u.add(this._checkHighlightBit(l,v));return k.step(new k.Float(.1),u.add(this.highlight.highlightAll))}_checkHighlightBit(l,u){return a.getHighlightBit(l,u).multiply(a.getBit(this.highlight.activeReasons,
u))}maybeRunHittest(l,u,v){if(null==this.hittestRequest)return null;u=this.hittest(l,u,v);u=k.ifElse(k.greaterThan(u,this.hittestRequest.distance),new k.Float(2),new k.Float(0));v=this.storage.getAttributeDataCoords(l.id);v=a.uvToClip(v);u=u.add(this.clip(l.id,l.zoomRange));l=new k.Vec4(new k.Float(1/255),0,0,0);return{glPointSize:new k.Float(1),glPosition:new k.Vec4(v,u,1),color:l}}_maybeWriteHittest(l){return null!=this.hittestRequest?l.color:null}}g.__decorate([h.define],m.prototype,"inside",void 0);
g.__decorate([h.define],m.prototype,"outside",void 0);g.__decorate([h.option(d.ShaderHighlight)],m.prototype,"highlight",void 0);g.__decorate([h.uniform(n.EntityStorage)],m.prototype,"storage",void 0);g.__decorate([h.uniform(c.ViewInfo)],m.prototype,"view",void 0);g.__decorate([h.option(b.ShaderHittest)],m.prototype,"hittestRequest",void 0);e.AFeatureShader=m;e.BaseHittestVertexInput=f;e.FeatureFragmentInput=t;e.FeatureVertexInput=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../core/has ../../GraphShaderModule ../../graph/glsl ./utils".split(" "),function(e,g,p,h,k,n){class d extends h.UniformGroup{getVisualVariableData(b){this._vvData||(b=this.getAttributeDataCoords(b),this._vvData=k.texture2D(this.visualVariableData,b).setDebugName("storage2"));return this._vvData}getAttributeDataCoords(b){if(!this._uv){var a=n.unpackDisplayIdTexel(b);
b=this.size;var c=k.int(a.x),q=k.int(a.y).multiply(k.int(256));a=k.int(a.z).multiply(k.int(256)).multiply(k.int(256));q=k.float(c.add(q).add(a));c=k.mod(q,b);q=q.subtract(c).divide(b);this._uv=(new k.Vec2(c,q)).add(.5).divide(b)}return this._uv}getFilterData(b){b=this.getAttributeDataCoords(b);return k.texture2D(this.filterFlags,b).setDebugName("storage0")}getAnimationData(b){b=this.getAttributeDataCoords(b);return k.texture2D(this.animation,b).setDebugName("storage1")}getVVData(b){return this.getVisualVariableData(b)}getDataDrivenData0(b){b=
this.getAttributeDataCoords(b);return k.texture2D(this.dataDriven0,b).setDebugName("storage30")}getDataDrivenData1(b){b=this.getAttributeDataCoords(b);return k.texture2D(this.dataDriven1,b).setDebugName("storage31")}getDataDrivenData2(b){b=this.getAttributeDataCoords(b);return k.texture2D(this.dataDriven2,b).setDebugName("storage32")}getGPGPUData(b){b=this.getAttributeDataCoords(b);return k.texture2D(this.gpgpu,b).setDebugName("storage4")}getFilterFlags(b){return p("webgl-ignores-sampler-precision")?
k.ceil(this.getFilterData(b).x.multiply(k.float(255))):this.getFilterData(b).x.multiply(k.float(255))}getAnimationValue(b){return this.getAnimationData(b).x}getSizeValue(b){return this.getVisualVariableData(b).x}getColorValue(b){return this.getVisualVariableData(b).y}getOpacityValue(b){return this.getVisualVariableData(b).z}getRotationValue(b){return this.getVisualVariableData(b).w}}g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"filterFlags",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,
"animation",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"gpgpu",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"visualVariableData",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"dataDriven0",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"dataDriven1",void 0);g.__decorate([h.uniform(k.Sampler2D)],d.prototype,"dataDriven2",void 0);g.__decorate([h.uniform(k.Float)],d.prototype,"size",void 0);e.EntityStorage=d;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../../highlightReasons","../../graph/glsl","./constants"],function(e,g,p,h){function k(n,d){d=p.float(2**d);return p.mod(p.floor(n.divide(d)),p.float(2))}e.cross2=function(n,d){return n.x.multiply(d.y).subtract(d.x.multiply(n.y))};e.getBit=k;e.getBitBool=function(n,d){return p.greaterThan(k(n,d),p.float(.5))};e.getFilterBit=function(n,d){return k(n,d+g.highlightReasons.length)};
e.getHighlightBit=function(n,d){return k(n,d)};e.isNan=function(n){return p.equal(n,p.float(h.nanMagicNumber))};e.max4=function(n){return p.max(p.max(p.max(n.x,n.y),n.z),n.w)};e.norm=function(n){return p.divide(n,p.float(255))};e.rand=function(n){const d=p.float(12.9898),b=p.float(78.233),a=p.float(43758.5453);n=p.dot(n,p.vec2(d,b));n=p.mod(n,p.float(3.14));return p.fract(p.sin(n).multiply(a))};e.rgba2float=function(n){const d=p.vec4(.99609375,255/65536,255/16777216,255/4294967296);return p.dot(n,
d)};e.unpackDisplayIdTexel=function(n){const d=k(n.z,7),b=p.float(1).subtract(d),a=n.xyz.subtract(p.vec3(0,0,p.float(128)));return b.multiply(n).add(d.multiply(a))};e.uvToClip=function(n){return n.multiply(2).subtract(1)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(e){e.RotationType=void 0;var g=e.RotationType||(e.RotationType={});g[g.Geographic=0]="Geographic";g[g.Arithmatic=
1]="Arithmatic";e.attrVvColor=1;e.attrVvOpacity=2;e.attrVvRotation=3;e.attrVvSize=0;e.bitsetFillPatternHeightIsCompressed=5;e.bitsetFillPatternWidthIsCompressed=6;e.bitsetFillRandomPatternOffset=2;e.bitsetGenericConsiderAlphaOnly=4;e.bitsetGenericLockColor=1;e.bitsetLineIsSdf=3;e.bitsetLineScaleDash=2;e.bitsetMarkerAlignmentMap=0;e.bitsetMarkerOutlineAllowColorOverride=2;e.bitsetMarkerScaleSymbolsProportionally=3;e.bitsetTextIsBackground=0;e.bitsetTextIsMapAligned=3;e.bitsetTypeFillOutline=0;e.c256ToRad=
3.14159265359/128;e.cDegToRad=3.14159265359/180;e.cRadToDeg=57.29577950560105;e.epsilon=1E-5;e.epsilonHitTest=.05;e.extrudeScalePlacementPadding=.25;e.fillPositionPrecision=1;e.maxFilterCount=2;e.maxRepresentableInt=16777216;e.maxSdfDistance=8;e.nanMagicNumber=1E-30;e.offsetPrecision=.125;e.outlineScale=.2;e.placementPadding=8;e.positionPrecision=.125;e.sdfFontSize=24;e.softEdgeRatio=1;e.thinLineHalfWidth=1;e.thinLineWidthFactor=1.1;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,g,p,h){class k extends p.UniformGroup{}g.__decorate([p.uniform(h.Float)],k.prototype,"activeReasons",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"highlightAll",void 0);e.ShaderHighlight=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,g,p,h){class k extends p.UniformGroup{}g.__decorate([p.uniform(h.Vec2)],k.prototype,"position",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"distance",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"smallSymbolDistance",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"smallSymbolSizeThreshold",void 0);e.ShaderHittest=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,g,p,h){class k extends p.UniformGroup{}g.__decorate([p.uniform(h.Mat3)],k.prototype,"displayViewScreenMat3",void 0);g.__decorate([p.uniform(h.Mat3)],k.prototype,"displayViewMat3",void 0);g.__decorate([p.uniform(h.Mat3)],k.prototype,"displayMat3",void 0);g.__decorate([p.uniform(h.Mat3)],k.prototype,"viewMat3",
void 0);g.__decorate([p.uniform(h.Mat3)],k.prototype,"tileMat3",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"displayZoomFactor",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"requiredZoomFactor",void 0);g.__decorate([p.uniform(h.Vec2)],k.prototype,"tileOffset",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"currentScale",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"currentZoom",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"metersPerSRUnit",void 0);g.__decorate([p.uniform(h.Float)],
k.prototype,"rotation",void 0);g.__decorate([p.uniform(h.Float)],k.prototype,"pixelRatio",void 0);e.ViewInfo=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPolygonShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/hittestUtils ../shaders/utils".split(" "),function(e,g,p,h,k,n,d,b){class a extends n.FeatureVertexInput{}
g.__decorate([h.location(3,k.Float)],a.prototype,"inverseArea",void 0);class c extends n.FeatureFragmentInput{}class q extends h.UniformGroup{}g.__decorate([h.uniform(k.FixedArray.ofType(k.Vec4,2))],q.prototype,"isActive",void 0);g.__decorate([h.uniform(k.FixedArray.ofType(k.Vec4,8))],q.prototype,"colors",void 0);g.__decorate([h.uniform(k.Float)],q.prototype,"dotValue",void 0);class f extends h.UniformGroup{}g.__decorate([h.uniform(k.Sampler2D)],f.prototype,"dotTexture0",void 0);g.__decorate([h.uniform(k.Sampler2D)],
f.prototype,"dotTexture1",void 0);g.__decorate([h.uniform(k.Float)],f.prototype,"tileZoomFactor",void 0);g.__decorate([h.uniform(k.Float)],f.prototype,"pixelRatio",void 0);g.__decorate([h.uniform(k.Float)],f.prototype,"tileDotsOverArea",void 0);class t extends n.AFeatureShader{_dotThreshold(m,l,u){return m.divide(l).divide(u)}vertex(m){var l=(new k.Mat3(2/p.tileSize,0,0,0,-2/p.tileSize,0,-1,1,1)).multiply(new k.Vec3(m.pos,1)),u=this.clip(m.id);l=new k.Vec4(l.xy,u,1);var v=this.storage.getVVData(m.id).multiply(this.instance.isActive.get(0)).multiply(m.inverseArea),
r=this.storage.getDataDrivenData0(m.id).multiply(this.instance.isActive.get(1)).multiply(m.inverseArea);u=this.draw.tileZoomFactor.multiply(p.tileSize).divide(this.draw.pixelRatio);v=this._dotThreshold(v,this.instance.dotValue,this.draw.tileDotsOverArea);r=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea);m=m.pos.add(.5).divide(u);return{glPosition:l,color:new k.Vec4(0,0,0,0),textureCoords:m,thresholds0:v,thresholds1:r}}fragment(m){const l=new h.FragmentOutput;var u=k.texture2D(this.draw.dotTexture0,
m.textureCoords),v=k.texture2D(this.draw.dotTexture1,m.textureCoords);u=m.thresholds0.subtract(u);var r=m.thresholds1.subtract(v);m=k.Mat4.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]);v=k.Mat4.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const A=k.step(new k.Float(0),u);var y=k.step(new k.Float(0),r),x=k.dot(A,u).add(k.dot(y,r));const z=k.step(x,new k.Float(0));
var w=(new k.Float(1)).subtract(z);x=x.add(z);u=u.multiply(A).divide(x);r=r.multiply(y).divide(x);m=m.multiply(u).add(v.multiply(r));m=w.multiply(m)}else y=k.max(b.max4(u),b.max4(r)),w=k.step(y,new k.Float(0)),w=(new k.Float(1)).subtract(w),u=k.step(y,u),r=k.step(y,r),m=m.multiply(u).add(v.multiply(r)),m=w.multiply(m);l.glFragColor=m;return l}hittest(m){return d.failHittest(this.hittestRequest)}}g.__decorate([h.define],t.prototype,"blending",void 0);g.__decorate([h.uniform(q)],t.prototype,"instance",
void 0);g.__decorate([h.uniform(f)],t.prototype,"draw",void 0);g.__decorate([g.__param(0,h.input(a))],t.prototype,"vertex",null);g.__decorate([g.__param(0,h.input(n.FeatureFragmentInput))],t.prototype,"fragment",null);e.DotDensityPolygonDrawUniforms=f;e.DotDensityPolygonFragmentInput=c;e.DotDensityPolygonInstanceUniforms=q;e.DotDensityPolygonShader=t;e.DotDensityPolygonVertexInput=a;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports",
"../../graph/glsl","./constants","./utils"],function(e,g,p,h){function k(c,q){return g.dot(c,g.normalize(q))}function n(c,q,f){var t=f.subtract(q),m=c.subtract(q);m=k(m,t);t=g.clamp(m.divide(g.length(t)),new g.Float(0),new g.Float(1));return g.distance(c,q.add(t.multiply(f.subtract(q))))}function d(c){c=g.abs(c);return g.step(c.x.add(c.y).add(c.z),new g.Float(1.05))}function b(c,q,f,t){const m=new g.Mat3(f.x.multiply(t.y).subtract(t.x.multiply(f.y)),t.x.multiply(q.y).subtract(q.x.multiply(t.y)),q.x.multiply(f.y).subtract(f.x.multiply(q.y)),
f.y.subtract(t.y),t.y.subtract(q.y),q.y.subtract(f.y),t.x.subtract(f.x),q.x.subtract(t.x),f.x.subtract(q.x));var l=q.x.multiply(f.y.subtract(t.y));const u=f.x.multiply(t.y.subtract(q.y));q=t.x.multiply(q.y.subtract(f.y));l=l.add(u).add(q);return(new g.Float(1)).divide(l).multiply(m.multiply(new g.Vec3(1,c)))}function a(c,q,f,t){var m=f.subtract(q);const l=t.subtract(q);m=h.cross2(m,l);m=g.and(g.lessThan(m,new g.Float(p.epsilonHitTest)),g.greaterThan(m,new g.Float(-p.epsilonHitTest)));return g.cond([g.and(g.not(m),
g.equal(d(b(c.xy,q,f,t)),new g.Float(1))),new g.Float(-1)],[!0,()=>{const u=n(c,q,f),v=n(c,f,t),r=n(c,t,q);return g.min(g.min(u,v),r)}])}e.distPointSegment=n;e.distPointTriangle=a;e.failHittest=function(c){return c.distance.add(1)};e.hittestFill=function(c,q,f){const {viewMat3:t,tileMat3:m}=c.view,l=t.multiply(m);q=l.multiply(new g.Vec3(q.pos,1));const u=l.multiply(new g.Vec3(f.nextPos1,1));f=l.multiply(new g.Vec3(f.nextPos2,1));return a(c.hittestRequest.position,q.xy,u.xy,f.xy)};e.hittestMarker=
function(c,q,f){return g.distance(c,f).subtract(q)};e.inTriangle=d;e.projectScalar=k;e.xyToBarycentric=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityResources":function(){define("exports ../../../../../../../core/RandomLCG ../../../definitions ../../../meshing/SimpleMesh ../mesh/utils ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/Renderbuffer ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){class f{constructor(){this._dotTextureSize=0;this._dotMesh=this._dotTextures=null}destroy(){this._disposeTextures();this._dotFBO&&this._dotFBO.dispose();this._dotMesh&&this._dotMesh.destroy()}getFBO(t){if(null==this._dotFBO){var m=p.tileSize;const l=p.tileSize,u=new q.TextureDescriptor(m,l);u.samplingMode=n.TextureSamplingMode.NEAREST;u.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;m=new b.Renderbuffer(t,new a.RenderbufferDescriptor(n.RenderbufferFormat.DEPTH_STENCIL,m,
l));this._dotFBO=new d.FramebufferObject(t,u,m)}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){var m=p.tileSize;const l=m*m,u=new Int16Array(2*l);for(let v=0;v<m;v++)for(let r=0;r<m;r++)u[2*(r+v*m)]=r,u[2*(r+v*m)+1]=v;m=[{count:2,type:n.DataType.UNSIGNED_SHORT,name:"a_position",offset:0}];m={hash:k.vertexLayoutHash(m),attributes:m,stride:4};this._dotMesh=h.SimpleMesh.create(t,{primitive:n.PrimitiveType.POINTS,vertex:u,count:l,layout:m})}return this._dotMesh}getDotDensityTextures(t,
m,l){if(this._dotTextureSize!==m||this._seed!==l)this._disposeTextures(),this._dotTextureSize=m,this._seed=l;null===this._dotTextures&&(l=new g(l),this._dotTextures=[this._allocDotDensityTexture(t,m,l),this._allocDotDensityTexture(t,m,l)]);return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_allocDotDensityTexture(t,m,l){const u=new Float32Array(m*m*4);for(let v=0;v<u.length;v++)u[v]=l.getFloat();
l=new q.TextureDescriptor;l.dataType=n.PixelType.FLOAT;l.samplingMode=n.TextureSamplingMode.NEAREST;l.width=m;l.height=m;return new c.Texture(t,l,u)}}e.DotDensityResources=f;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/SimpleMesh":function(){define(["exports","./definitions","./Mesh","../shaderGraph/techniques/mesh/utils"],function(e,g,p,h){class k extends p.Mesh{static create(n,d){const b=[];let {stride:a,hash:c}=d.layout;if(null==a){a=0;for(const {count:t,
type:m,offset:l}of d.layout.attributes){if(null!=l)throw Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");a+=t*g.dataSizeInBytes[m]}}var q=0,f=0;for(const {count:t,name:m,offset:l,type:u,normalized:v}of d.layout.attributes)null!=l&&(f=l),b.push({name:m,location:q,vertex:0,count:t,type:u,offset:f,stride:a,divisor:0,normalized:null!=v?v:!1}),q++,f+=t*g.dataSizeInBytes[u];q={attributes:b,primitive:d.primitive};null!=d.index&&(q.index=0);({count:f}=d);if(null==
f&&(f=d.index?d.index.length:d.vertex.byteLength/a,Math.floor(f)!==f))throw Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${a}.`);q={vertex:[d.vertex],parts:[{start:0,count:f,group:0,primitive:d.primitive}],groups:[q]};null!=d.index&&(q.index=[d.index]);null==c&&(c=h.vertexLayoutHash(b));return new k(n,q,{hash:c,attributes:b,stride:a})}constructor(n,d,b){super(n,d);this.layout=b}bind(n,d=0){super.bind(n,d)}}e.SimpleMesh=k;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/definitions":function(){define(["exports","../../../../webgl/enums"],function(e,g){e.dataSizeInBytes={[g.DataType.BYTE]:1,[g.DataType.UNSIGNED_BYTE]:1,[g.DataType.SHORT]:2,[g.DataType.UNSIGNED_SHORT]:2,[g.DataType.INT]:4,[g.DataType.UNSIGNED_INT]:4,[g.DataType.FLOAT]:4};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/Mesh":function(){define("exports ./definitions ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(e,g,p,h,k,n){class d{constructor(b,a){this._boundPart=null;const c=[];for(var q of a.vertex){var f=p.BufferObject.createVertex(b,h.Usage.STATIC_DRAW,q);c.push(f)}q=[];for(var t of a.index||[])f=p.BufferObject.createIndex(b,h.Usage.STATIC_DRAW,t),q.push(f);this.groups=[];for(const l of a.groups){let u;if(null!=l.index){if(!a.index)throw Error("No index data.");({BYTES_PER_ELEMENT:t}=a.index[l.index]);2===t?u=h.DataType.UNSIGNED_SHORT:4===t&&(u=h.DataType.UNSIGNED_INT)}var m=null!=l.index?
q[l.index]:null;t=new Map;f={};const v={};for(const r of l.attributes){const {name:y,count:x,type:w,offset:A,normalized:z,divisor:C,stride:D,vertex:F,location:G}=r,B=`vertex-buffer-${F}`;let I=f[B];I||=f[B]=[];const H=new n.VertexElementDescriptor(y,x,w,A,D,z,C);I.push(H);t.set(y,G);v[B]=c[F]}m=new k.VertexArrayObject(b,t,f,v,m);this.groups.push({...l,vertexArray:m,locations:t,layout:f,indexing:u})}this.parts=a.parts}bind(b,a){this._boundPart=a;({group:a}=this.parts[this._boundPart]);({vertexArray:a}=
this.groups[a]);b.bindVAO(a)}draw(b){if(null==this._boundPart)throw Error("Mesh.bind() has not been called.");const {start:a,count:c}=this.parts[this._boundPart],{group:q}=this.parts[this._boundPart],{indexing:f,primitive:t}=this.groups[q];f?b.drawElements(t,c,f,a*g.dataSizeInBytes[f]):b.drawArrays(t,a,c)}unbind(b){this._boundPart=null;b.bindVAO(null)}destroy(){for(const {vertexArray:b}of this.groups)b.dispose()}}e.Mesh=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define("exports ../dotDensity/DotDensityMeshWriter ../fill/ComplexFillMeshWriter ../fill/ComplexOutlineFillMeshWriter ../fill/FillMeshWriter ../fill/OutlineFillMeshWriter ../fill/PatternFillMeshWriter ../fill/PatternOutlineFillMeshWriter ../heatmap/HeatmapMeshWriter ../labels/LabelMeshWriter ../line/LineMeshWriter ../line/TexturedLineMeshWriter ../markers/MarkerMeshWriter ../pieChart/PieChartMeshWriter ../text/TextMeshWriter".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){g={FillMeshWriter:k.FillMeshWriter,DotDensityMeshWriter:g.DotDensityMeshWriter,ComplexFillMeshWriter:p.ComplexFillMeshWriter,PatternFillMeshWriter:d.PatternFillMeshWriter,OutlineFillMeshWriter:n.OutlineFillMeshWriter,PatternOutlineFillMeshWriter:b.PatternOutlineFillMeshWriter,ComplexOutlineFillMeshWriter:h.ComplexOutlineFillMeshWriter,MarkerMeshWriter:t.MarkerMeshWriter,PieChartMeshWriter:m.PieChartMeshWriter,TextMeshWriter:l.TextMeshWriter,LineMeshWriter:q.LineMeshWriter,
TexturedLineMeshWriter:f.TexturedLineMeshWriter,HeatmapMeshWriter:a.HeatmapMeshWriter,LabelMeshWriter:c.LabelMeshWriter};p={};for(const u in g)p[u]={name:u,constructor:g[u]};e.meshWriterRegistry=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(e,g,p){const h={createComputedParams:n=>n,attributes:{id:{type:p.DataType.UNSIGNED_BYTE,
count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1},pos:{type:p.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:p.DataType.FLOAT,count:1,packTessellation:({inverseArea:n})=>n}}};class k extends g.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=h}createTesselationParams(n){return{inverseArea:1/n.readGeometryArea()}}}e.DotDensityMeshWriter=k;e.dotDensityVertexSpec=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports",
"../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(e,g,p,h,k){const n=g("featurelayer-fast-triangulation-enabled");class d extends k.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),p.loadLibtess()])}_write(b,a,c){c=c?.asOptimized()??a.readGeometryForDisplay();if(c=this._clip(c))b.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(b,a,c),b.recordEnd()}_clip(b){return b?
h.clipMarshall(b,this.hasEffects?256:8):null}_writeGeometry(b,a,c){const q=100<c.maxLength,f=[],t=this.createTesselationParams(a);!q&&n&&h.triangulate(f,c)?f.length&&this._writeVertices(b,a,c.coords,t,f):(c=h.triangulateLibtess(c),this._writeVertices(b,a,c,t))}_writeVertices(b,a,c,q,f){const t=a.getDisplayId();a=b.vertexCount();const m=this.hasEffects;let l=0;if(f)for(var u of f){f=c[2*u];var v=c[2*u+1];m&&b.recordBounds(f,v,0,0);this._writeVertex(b,t,f,v,q);l++}else for(u=0;u<c.length;u+=2)f=Math.round(c[u]),
v=Math.round(c[u+1]),m&&b.recordBounds(f,v,0,0),this._writeVertex(b,t,f,v,q),l++;b.indexEnsureSize(l);for(c=0;c<l;c++)b.indexWrite(c+a)}}e.AFillMeshWriter=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(e,g,p,h){async function k(){d=await (h("esri-csp-restrictions")?await (new Promise((b,a)=>e(["../chunks/libtess-asm"],b,a))).then(b=>b.libtessAsm):await (new Promise((b,a)=>e(["../chunks/libtess"],
b,a))).then(b=>b.libtess)).default({locateFile:b=>p.getAssetUrl(`esri/core/libs/libtess/${b}`)})}let n=null,d=null;g.loadLibtess=async function(){n||=k();return n};g.triangulate=function(b,a){return d.triangulate(b,a,Math.max(b.length,128E3))};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define("exports ../../../../../../chunks/earcut ../../../../../../geometry/libtess ../../../../../../geometry/support/TileClipper ../../../../../../layers/graphics/OptimizedGeometry ../../definitions ../bufcut".split(" "),
function(e,g,p,h,k,n,d){function b(f,t,m){let l=0;for(let u=1;u<m;u++)l+=(f[2*(t+u)]-f[2*(t+u-1)])*(f[2*(t+u)+1]+f[2*(t+u-1)+1]);return l}function a(f,t,m,l,u){let v=0;for(;m<l;m+=3){const r=2*(f[m]-u),y=2*(f[m+1]-u),x=2*(f[m+2]-u);v+=Math.abs((t[r]-t[x])*(t[y+1]-t[r+1])-(t[r]-t[y])*(t[x+1]-t[r+1]))}return v}const c=new h.TileClipper(0,0,0,1,0),q=new h.TileClipper(0,0,0,1,0);c.setExtent(n.tileSize);q.setExtent(n.tileSize);e.area=b;e.clipLinesMarshall=function(f,t){q.setPixelMargin(t);const m=-t;t=
n.tileSize+t;let l=[];var u=!1;if(!f.nextPath())return null;let v=!0;for(;v;){f.seekPathStart();const r=[];if(!f.pathSize)return null;q.reset(h.GeometryType.LineString);f.nextPoint();let y=f.x,x=f.y;if(u)q.moveTo(y,x);else{if(y<m||y>t||x<m||x>t){u=!0;continue}r.push({x:y,y:x})}let w=!1;for(;f.nextPoint();)if(y=f.x,x=f.y,u)q.lineTo(y,x);else{if(y<m||y>t||x<m||x>t){w=!0;break}r.push({x:y,y:x})}if(w)u=!0;else{if(u){if(u=q.resultWithStarts())for(const A of u)l.push(A)}else l.push({line:r,start:0});v=
f.nextPath();u=!1}}l=l.filter(r=>1<r.line.length);return 0===l.length?null:l};e.clipMarshall=function(f,t){if(null==f)return null;a:{var m=n.tileSize+128;var l=0;for(var u=0;u<f.lengths.length;u++){var v=f.lengths[u];for(var r=0;r<v;r++){const y=f.coords[2*(r+l)],x=f.coords[2*(r+l)+1];if(-128>y||y>m||-128>x||x>m){m=!0;break a}}l+=v}m=!1}if(!m)return f;c.setPixelMargin(t);c.reset(h.GeometryType.Polygon);t=0;for(m=0;m<f.lengths.length;m++){l=f.lengths[m];u=f.coords[2*(0+t)];v=f.coords[2*(0+t)+1];c.moveTo(u,
v);for(r=1;r<l;r++)u=f.coords[2*(r+t)],v=f.coords[2*(r+t)+1],c.lineTo(u,v);c.close();t+=l}m=c.result(!1);if(!m)return null;f=[];t=[];for(const y of m){m=0;for(const x of y)t.push(x.x),t.push(x.y),m++;f.push(m)}return new k(f,t)};e.triangleAreaArray=a;e.triangulate=function(f,t){const {coords:m,lengths:l,hasIndeterminateRingOrder:u}=t;if(u)return!1;t=0;for(var v=0;v<l.length;){let x=v,w=l[v];v=b(m,t,w);for(var r=[];++x<l.length;){var y=l[x];const A=b(m,t+w,y);if(!(0<A))break;v+=A;r.push(t+w);w+=y}y=
f.length;d.bufcut(f,m,t,t+w,r,2,0);r=a(f,m,y,f.length,0);v=Math.abs(v);if(1E-5<Math.abs((r-v)/Math.max(1E-7,v)))return f.length=0,!1;v=x;t+=w}return!0};e.triangulateEarcut=function(f,t,m){const {coords:l,lengths:u,hasIndeterminateRingOrder:v}=t;if(v)return!1;let r=0;for(var y=0;y<u.length;){let w=y,A=u[y];for(y=[];++w<u.length;){var x=u[w];if(!(0<b(l,r+A,x)))break;y.push(r+A-r);A+=x}x=t.coords.slice(2*r,2*(r+A));y=g.earcut(x,y,2);for(const z of y)f.push(z+m+r);y=w;r+=A}return!0};e.triangulateLibtess=
function(f){const {coords:t,lengths:m}=f;({buffer:f}=p.triangulate(t,m));return f};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(e,g){var p={exports:{}};(function(h){(function(k){k=k();void 0!==k&&(h.exports=k)})(function(){function k(F,G,B){B=B||2;var I=G&&G.length,H=I?G[0]*B:F.length,K=n(F,0,H,B,!0),O=[];if(!K||K.next===K.prev)return O;var R;if(I){var E=K;var J=B;K=[];var Q;I=0;for(Q=G.length;I<Q;I++){var N=
G[I]*J;var S=I<Q-1?G[I+1]*J:F.length;N=n(F,N,S,J,!1);N===N.next&&(N.steiner=!0);S=K;var W=S.push,U=N,M=N;do{if(U.x<M.x||U.x===M.x&&U.y<M.y)M=U;U=U.next}while(U!==N);W.call(S,M)}K.sort(c);for(I=0;I<K.length;I++)J=K[I],G=E,(E=f(J,G))?(Q=w(E,J),J=d(E,E.next),Q=q(Q),d(Q,Q.next),J=q(J),E=q(G===E?J:G)):E=G,E=d(E,E.next);K=E}if(F.length>80*B){var P=R=F[0];var T=I=F[1];for(J=B;J<H;J+=B)G=F[J],E=F[J+1],G<P&&(P=G),E<T&&(T=E),G>R&&(R=G),E>I&&(I=E);R=Math.max(R-P,I-T);R=0!==R?1/R:0}b(K,O,B,P,T,R);return O}function n(F,
G,B,I,H){if(H===0<D(F,G,B,I))for(H=G;H<B;H+=I)var K=A(H,F[H],F[H+1],K);else for(H=B-I;H>=G;H-=I)K=A(H,F[H],F[H+1],K);K&&u(K,K.next)&&(F=K.next,z(K),K=F);return K}function d(F,G){if(!F)return F;G||=F;do{var B=!1;if(F.steiner||!u(F,F.next)&&0!==l(F.prev,F,F.next))F=F.next;else{G=F.prev;z(F);F=G;if(F===F.next)break;B=!0}}while(B||F!==G);return G}function b(F,G,B,I,H,K,O){if(F){if(!O&&K){var R=F,E=R;do null===E.z&&(E.z=t(E.x,E.y,I,H,K)),E.prevZ=E.prev,E=E.nextZ=E.next;while(E!==R);E.prevZ.nextZ=null;
E.prevZ=null;R=E;var J,Q,N,S,W=1;do{E=R;var U=R=null;for(Q=0;E;){Q++;var M=E;for(J=N=0;J<W&&(N++,M=M.nextZ,M);J++);for(S=W;0<N||0<S&&M;)0!==N&&(0===S||!M||E.z<=M.z)?(J=E,E=E.nextZ,N--):(J=M,M=M.nextZ,S--),U?U.nextZ=J:R=J,J.prevZ=U,U=J;E=M}U.nextZ=null;W*=2}while(1<Q)}for(R=F;F.prev!==F.next;){E=F.prev;M=F.next;if(K)U=a(F,I,H,K);else a:if(U=F,Q=U.prev,N=U,W=U.next,0<=l(Q,N,W))U=!1;else{for(J=U.next.next;J!==U.prev;){if(m(Q.x,Q.y,N.x,N.y,W.x,W.y,J.x,J.y)&&0<=l(J.prev,J,J.next)){U=!1;break a}J=J.next}U=
!0}if(U)G.push(E.i/B),G.push(F.i/B),G.push(M.i/B),z(F),R=F=M.next;else if(F=M,F===R){if(!O)b(d(F),G,B,I,H,K,1);else if(1===O){F=d(F);O=G;R=B;E=F;do M=E.prev,U=E.next.next,!u(M,U)&&v(M,E,E.next,U)&&x(M,U)&&x(U,M)&&(O.push(M.i/R),O.push(E.i/R),O.push(U.i/R),z(E),z(E.next),E=F=U),E=E.next;while(E!==F);F=d(E);b(F,G,B,I,H,K,2)}else if(2===O)a:{O=F;do{for(R=O.next.next;R!==O.prev;){if(E=O.i!==R.i){U=U=U=U=void 0;E=O;M=R;if(U=E.next.i!==M.i&&E.prev.i!==M.i){b:{U=E;do{if(U.i!==E.i&&U.next.i!==E.i&&U.i!==
M.i&&U.next.i!==M.i&&v(U,U.next,E,M)){U=!0;break b}U=U.next}while(U!==E);U=!1}U=!U}if(U){if(U=x(E,M)&&x(M,E)){U=E;Q=!1;N=(E.x+M.x)/2;W=(E.y+M.y)/2;do U.y>W!==U.next.y>W&&U.next.y!==U.y&&N<(U.next.x-U.x)*(W-U.y)/(U.next.y-U.y)+U.x&&(Q=!Q),U=U.next;while(U!==E);U=Q}U=U&&(l(E.prev,E,M.prev)||l(E,M.prev,M))||u(E,M)&&0<l(E.prev,E,E.next)&&0<l(M.prev,M,M.next)}E=U}if(E){F=w(O,R);O=d(O,O.next);F=d(F,F.next);b(O,G,B,I,H,K);b(F,G,B,I,H,K);break a}R=R.next}O=O.next}while(O!==F)}break}}}}function a(F,G,B,I){var H=
F.prev,K=F.next;if(0<=l(H,F,K))return!1;var O=H.x>F.x?H.x>K.x?H.x:K.x:F.x>K.x?F.x:K.x,R=H.y>F.y?H.y>K.y?H.y:K.y:F.y>K.y?F.y:K.y,E=t(H.x<F.x?H.x<K.x?H.x:K.x:F.x<K.x?F.x:K.x,H.y<F.y?H.y<K.y?H.y:K.y:F.y<K.y?F.y:K.y,G,B,I);G=t(O,R,G,B,I);B=F.prevZ;for(I=F.nextZ;B&&B.z>=E&&I&&I.z<=G;){if(B!==F.prev&&B!==F.next&&m(H.x,H.y,F.x,F.y,K.x,K.y,B.x,B.y)&&0<=l(B.prev,B,B.next))return!1;B=B.prevZ;if(I!==F.prev&&I!==F.next&&m(H.x,H.y,F.x,F.y,K.x,K.y,I.x,I.y)&&0<=l(I.prev,I,I.next))return!1;I=I.nextZ}for(;B&&B.z>=
E;){if(B!==F.prev&&B!==F.next&&m(H.x,H.y,F.x,F.y,K.x,K.y,B.x,B.y)&&0<=l(B.prev,B,B.next))return!1;B=B.prevZ}for(;I&&I.z<=G;){if(I!==F.prev&&I!==F.next&&m(H.x,H.y,F.x,F.y,K.x,K.y,I.x,I.y)&&0<=l(I.prev,I,I.next))return!1;I=I.nextZ}return!0}function c(F,G){return F.x-G.x}function q(F){if(F.next.prev===F)return F;let G=F;do{const B=G.next;if(B.prev===G||B===G||B===F)break;G=B}while(1);return G}function f(F,G){var B=G,I=F.x,H=F.y,K=-Infinity;do{if(H<=B.y&&H>=B.next.y&&B.next.y!==B.y){var O=B.x+(H-B.y)*
(B.next.x-B.x)/(B.next.y-B.y);if(O<=I&&O>K){K=O;if(O===I){if(H===B.y)return B;if(H===B.next.y)return B.next}var R=B.x<B.next.x?B:B.next}}B=B.next}while(B!==G);if(!R)return null;if(I===K)return R;G=R;O=R.x;var E=R.y,J=Infinity;B=R;do{if(I>=B.x&&B.x>=O&&I!==B.x&&m(H<E?I:K,H,O,E,H<E?K:I,H,B.x,B.y)){var Q=Math.abs(H-B.y)/(I-B.x);var N;if((N=x(B,F))&&!(N=Q<J)&&(N=Q===J)&&!(N=B.x>R.x)&&(N=B.x===R.x)){N=R;var S=B;N=0>l(N.prev,N,S.prev)&&0>l(S.next,N,N.next)}N&&(R=B,J=Q)}B=B.next}while(B!==G);return R}function t(F,
G,B,I,H){F=32767*(F-B)*H;G=32767*(G-I)*H;F=(F|F<<8)&16711935;F=(F|F<<4)&252645135;F=(F|F<<2)&858993459;G=(G|G<<8)&16711935;G=(G|G<<4)&252645135;G=(G|G<<2)&858993459;return(F|F<<1)&1431655765|((G|G<<1)&1431655765)<<1}function m(F,G,B,I,H,K,O,R){return 0<=(H-O)*(G-R)-(F-O)*(K-R)&&0<=(F-O)*(I-R)-(B-O)*(G-R)&&0<=(B-O)*(K-R)-(H-O)*(I-R)}function l(F,G,B){return(G.y-F.y)*(B.x-G.x)-(G.x-F.x)*(B.y-G.y)}function u(F,G){return F.x===G.x&&F.y===G.y}function v(F,G,B,I){var H=y(l(F,G,B)),K=y(l(F,G,I)),O=y(l(B,
I,F)),R=y(l(B,I,G));return H!==K&&O!==R||0===H&&r(F,B,G)||0===K&&r(F,I,G)||0===O&&r(B,F,I)||0===R&&r(B,G,I)?!0:!1}function r(F,G,B){return G.x<=Math.max(F.x,B.x)&&G.x>=Math.min(F.x,B.x)&&G.y<=Math.max(F.y,B.y)&&G.y>=Math.min(F.y,B.y)}function y(F){return 0<F?1:0>F?-1:0}function x(F,G){return 0>l(F.prev,F,F.next)?0<=l(F,G,F.next)&&0<=l(F,F.prev,G):0>l(F,G,F.prev)||0>l(F,F.next,G)}function w(F,G){var B=new C(F.i,F.x,F.y),I=new C(G.i,G.x,G.y),H=F.next,K=G.prev;F.next=G;G.prev=F;B.next=H;H.prev=B;I.next=
B;B.prev=I;K.next=I;I.prev=K;return I}function A(F,G,B,I){F=new C(F,G,B);I?(F.next=I.next,F.prev=I,I.next.prev=F,I.next=F):(F.prev=F,F.next=F);return F}function z(F){F.next.prev=F.prev;F.prev.next=F.next;F.prevZ&&(F.prevZ.nextZ=F.nextZ);F.nextZ&&(F.nextZ.prevZ=F.prevZ)}function C(F,G,B){this.i=F;this.x=G;this.y=B;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function D(F,G,B,I){for(var H=0,K=B-I;G<B;G+=I)H+=(F[K]-F[G])*(F[G+1]+F[K+1]),K=G;return H}k.deviation=function(F,G,
B,I){var H=G&&G.length,K=Math.abs(D(F,0,H?G[0]*B:F.length,B));if(H){H=0;for(var O=G.length;H<O;H++)K-=Math.abs(D(F,G[H]*B,H<O-1?G[H+1]*B:F.length,B))}for(H=G=0;H<I.length;H+=3){O=I[H]*B;var R=I[H+1]*B,E=I[H+2]*B;G+=Math.abs((F[O]-F[E])*(F[R+1]-F[O+1])-(F[O]-F[R])*(F[E+1]-F[O+1]))}return 0===K&&0===G?0:Math.abs((G-K)/K)};k.flatten=function(F){for(var G=F[0][0].length,B={vertices:[],holes:[],dimensions:G},I=0,H=0;H<F.length;H++){for(var K=0;K<F[H].length;K++)for(var O=0;O<G;O++)B.vertices.push(F[H][K][O]);
0<H&&(I+=F[H-1].length,B.holes.push(I))}return B};return k})})(p);g=g.getDefaultExportFromCjs(p.exports);e.earcut=g})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports"],function(e){function g(w,A,z,C,D,F,G){let B;z=0;for(let I=C,H=D-F;I<D;I+=F)z+=(w[H+A*F]-w[I+A*F])*(w[I+1+A*F]+w[H+1+A*F]),H=I;if(G===0<z)for(;C<D;C+=F)B=n(C+A*F,w[C+A*F],w[C+1+A*F],B);else for(D-=F;D>=C;D-=F)B=n(D+A*F,w[D+A*F],w[D+1+A*F],B);B&&l(B,B.next)&&(d(B),B=B.next);return B}function p(w,A=w){if(!w)return w;
let z;do if(z=!1,w.steiner||!l(w,w.next)&&0!==c(w.prev,w,w.next))w=w.next;else{d(w);w=A=w.prev;if(w===w.next)break;z=!0}while(z||w!==A);return A}function h(w,A,z,C,D,F,G,B){if(w){!B&&F&&(w=a(w,C,D,F));for(var I=w;w.prev!==w.next;){var H=w.prev,K=w.next;if(F)var O=k(w,C,D,F);else a:{O=w;var R=O.prev,E=O;const J=O.next;if(0<=c(R,E,J)){O=!1;break a}let Q=O.next.next;const N=Q;let S=0;for(;Q!==O.prev&&(0===S||Q!==N);){S++;if(f(R.x,R.y,E.x,E.y,J.x,J.y,Q.x,Q.y)&&0<=c(Q.prev,Q,Q.next)){O=!1;break a}Q=Q.next}O=
!0}if(O)A.push(H.index/z+G),A.push(w.index/z+G),A.push(K.index/z+G),d(w),I=w=K.next;else if(w=K,w===I){if(!B)h(p(w),A,z,C,D,F,G,1);else if(1===B){B=A;I=z;H=G;K=w;do O=K.prev,R=K.next.next,!l(O,R)&&q(O,K,K.next,R)&&t(O,R)&&t(R,O)&&(B.push(O.index/I+H),B.push(K.index/I+H),B.push(R.index/I+H),d(K),d(K.next),K=w=R),K=K.next;while(K!==w);w=K;h(w,A,z,C,D,F,G,2)}else if(2===B)a:{B=w;do{for(I=B.next.next;I!==B.prev;){if(H=B.index!==I.index){O=O=O=void 0;H=B;K=I;if(O=H.next.index!==K.index&&H.prev.index!==
K.index){b:{O=H;do{if(O.index!==H.index&&O.next.index!==H.index&&O.index!==K.index&&O.next.index!==K.index&&q(O,O.next,H,K)){O=!0;break b}O=O.next}while(O!==H);O=!1}O=!O}if(O=O&&t(H,K)&&t(K,H)){O=H;R=!1;E=(H.x+K.x)/2;K=(H.y+K.y)/2;do O.y>K!==O.next.y>K&&O.next.y!==O.y&&E<(O.next.x-O.x)*(K-O.y)/(O.next.y-O.y)+O.x&&(R=!R),O=O.next;while(O!==H);O=R}H=O}if(H){w=v(B,I);B=p(B,B.next);w=p(w,w.next);h(B,A,z,C,D,F,G,0);h(w,A,z,C,D,F,G,0);break a}I=I.next}B=B.next}while(B!==w)}break}}}}function k(w,A,z,C){const D=
w.prev,F=w.next;if(0<=c(D,w,F))return!1;const G=D.x>w.x?D.x>F.x?D.x:F.x:w.x>F.x?w.x:F.x,B=D.y>w.y?D.y>F.y?D.y:F.y:w.y>F.y?w.y:F.y,I=m(D.x<w.x?D.x<F.x?D.x:F.x:w.x<F.x?w.x:F.x,D.y<w.y?D.y<F.y?D.y:F.y:w.y<F.y?w.y:F.y,A,z,C);A=m(G,B,A,z,C);z=w.prevZ;for(C=w.nextZ;z&&z.z>=I&&C&&C.z<=A;){if(z!==w.prev&&z!==w.next&&f(D.x,D.y,w.x,w.y,F.x,F.y,z.x,z.y)&&0<=c(z.prev,z,z.next))return!1;z=z.prevZ;if(C!==w.prev&&C!==w.next&&f(D.x,D.y,w.x,w.y,F.x,F.y,C.x,C.y)&&0<=c(C.prev,C,C.next))return!1;C=C.nextZ}for(;z&&z.z>=
I;){if(z!==w.prev&&z!==w.next&&f(D.x,D.y,w.x,w.y,F.x,F.y,z.x,z.y)&&0<=c(z.prev,z,z.next))return!1;z=z.prevZ}for(;C&&C.z<=A;){if(C!==w.prev&&C!==w.next&&f(D.x,D.y,w.x,w.y,F.x,F.y,C.x,C.y)&&0<=c(C.prev,C,C.next))return!1;C=C.nextZ}return!0}function n(w,A,z,C){w=r.create(w,A,z);C?(w.next=C.next,w.prev=C,C.next.prev=w,C.next=w):(w.prev=w,w.next=w);return w}function d(w){w.next.prev=w.prev;w.prev.next=w.next;w.prevZ&&(w.prevZ.nextZ=w.nextZ);w.nextZ&&(w.nextZ.prevZ=w.prevZ)}function b(w,A){let z=A;const C=
w.x,D=w.y;let F=-Infinity,G;do{if(D<=z.y&&D>=z.next.y&&z.next.y!==z.y){var B=z.x+(D-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(B<=C&&B>F){F=B;if(B===C){if(D===z.y)return z;if(D===z.next.y)return z.next}G=z.x<z.next.x?z:z.next}}z=z.next}while(z!==A);if(!G)return null;if(C===F)return G.prev;A=G;B=G.x;const I=G.y;let H=Infinity,K;for(z=G.next;z!==A;)C>=z.x&&z.x>=B&&C!==z.x&&f(D<I?C:F,D,B,I,D<I?F:C,D,z.x,z.y)&&(K=Math.abs(D-z.y)/(C-z.x),(K<H||K===H&&z.x>G.x)&&t(z,w)&&(G=z,H=K)),z=z.next;return G}function a(w,
A,z,C){for(var D;D!==w;D=D.next){D=D||w;null===D.z&&(D.z=m(D.x,D.y,A,z,C));if(D.prev.next!==D||D.next.prev!==D)return D.prev.next=D,D.next.prev=D,a(w,A,z,C);D.prevZ=D.prev;D.nextZ=D.next}w.prevZ.nextZ=null;w.prevZ=null;a:for(z=1;;){C=w;A=w=null;let F=0;for(;C;){F++;D=C;let G=0;for(;G<z&&D;G++)D=D.nextZ;let B=z;for(;0<G||0<B&&D;){let I;0===G?(I=D,D=D.nextZ,B--):0!==B&&D?C.z<=D.z?(I=C,C=C.nextZ,G--):(I=D,D=D.nextZ,B--):(I=C,C=C.nextZ,G--);A?A.nextZ=I:w=I;I.prevZ=A;A=I}C=D}A.nextZ=null;z*=2;if(2>F)break a}return w}
function c(w,A,z){return(A.y-w.y)*(z.x-A.x)-(A.x-w.x)*(z.y-A.y)}function q(w,A,z,C){return l(w,A)&&l(z,C)||l(w,C)&&l(z,A)?!0:0<c(w,A,z)!==0<c(w,A,C)&&0<c(z,C,w)!==0<c(z,C,A)}function f(w,A,z,C,D,F,G,B){return 0<=(D-G)*(A-B)-(w-G)*(F-B)&&0<=(w-G)*(C-B)-(z-G)*(A-B)&&0<=(z-G)*(F-B)-(D-G)*(C-B)}function t(w,A){return 0>c(w.prev,w,w.next)?0<=c(w,A,w.next)&&0<=c(w,w.prev,A):0>c(w,A,w.prev)||0>c(w,w.next,A)}function m(w,A,z,C,D){w=32767*(w-z)*D;A=32767*(A-C)*D;w=(w|w<<8)&16711935;w=(w|w<<4)&252645135;w=
(w|w<<2)&858993459;A=(A|A<<8)&16711935;A=(A|A<<4)&252645135;A=(A|A<<2)&858993459;return(w|w<<1)&1431655765|((A|A<<1)&1431655765)<<1}function l(w,A){return w.x===A.x&&w.y===A.y}function u(w,A){return w.x-A.x}function v(w,A){const z=r.create(w.index,w.x,w.y),C=r.create(A.index,A.x,A.y),D=w.next,F=A.prev;w.next=A;A.prev=w;z.next=D;D.prev=z;C.next=z;z.prev=C;F.next=C;C.prev=F;return C}class r{constructor(){this.y=this.x=this.index=0;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}static create(w,
A,z){const C=x<y.length?y[x++]:new r;C.index=w;C.x=A;C.y=z;C.prev=null;C.next=null;C.z=null;C.prevZ=null;C.nextZ=null;C.steiner=!1;return C}}const y=[];let x=0;for(let w=0;8096>w;w++)y.push(new r);e.bufcut=function(w,A,z,C,D,F,G){x=0;var B=(C-z)*F,I=D&&D.length;const H=I?(D[0]-z)*F:B;var K=g(A,z,C,0,H,F,!0);if(K&&K.next!==K.prev){var O;if(I){const N=[];for(let S=0,W=D.length;S<W;S++){const U=g(A,z,C,D[S]*F,S<W-1?D[S+1]*F:C*F,F,!1);U===U.next&&(U.steiner=!0);I=N;var R=I.push;let M=U,P=U;do{if(M.x<
P.x||M.x===P.x&&M.y<P.y)P=M;M=M.next}while(M!==U);R.call(I,P)}N.sort(u);for(var E of N)if(C=E,D=b(C,K))C=v(D,C),p(C,C.next),K=p(D,D.next)}if(B>80*F){var J=B=A[z*F];var Q=O=A[1+z*F];for(E=F;E<H;E+=F)C=A[E+z*F],D=A[E+1+z*F],J=Math.min(J,C),Q=Math.min(Q,D),B=Math.max(B,C),O=Math.max(O,D);O=Math.max(B-J,O-Q);O=0!==O?1/O:0}h(K,w,F,J,Q,O,G,0)}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports",
"../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/effects/CIMEffectHelper","./loadGeometryEngine","./MeshWriterVertexPack"],function(e,g,p,h,k){class n{constructor(d,b,a,c){this._instanceId=d;this._evaluator=b;this._viewParams=a;this._optionalAttributes=c;this._evaluator.evaluator=q=>this.vertexSpec.createComputedParams(q)}get _vertexPack(){if(!this._cachedVertexPack){const d=k.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||
d.pack(this._evaluator.evaluatedMeshParams,this._viewParams);this._cachedVertexPack=d}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(d){this._references=d}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){var d;a:{if(d=this._evaluator.inputMeshParams.params.effects?.effectInfos)for(const b of d)switch(b.effect.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":d=
!0;break a}d=!1}d&&await h.loadGeometryEngine()}enqueueRequest(d,b,a){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(d,b,a)}write(d,b,a,c,q){this.ensurePacked(b,a,c);if((b=this.evaluatedMeshParams.effects)&&0!==b.length){if(c=a.readGeometryForDisplay()?.clone()){c=g.GeometryCursor.fromOptimizedCIM(c,a.geometryType);var f=h.getGeometryEngine();c.invertY();for(b=p.CIMEffectHelper.executeEffects(b,c,d.id||"",f);c=b.next();)c.invertY(),this._write(d,a,c,q)}}else this._write(d,a,
void 0,q)}ensurePacked(d,b,a){this._evaluator.hasDynamicProperties&&(d=this._evaluator.evaluateMeshParams(d,b,a),this._vertexPack.pack(d,this._viewParams))}_writeVertex(d,b,a,c,q){this._vertexPack.writeVertex(d,b,a,c,this.evaluatedMeshParams,q)}}e.MeshWriter=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/loadGeometryEngine":function(){define(["require","exports"],function(e,g){let p=null;g.getGeometryEngine=function(){return p};
g.loadGeometryEngine=async function(){p=await new Promise((h,k)=>e(["../../../../../../../geometry/geometryEngineJSON"],h,k))};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports","../../../number","./AlignedVertexSpec","./dataViewUtils"],function(e,g,p,h){class k{static fromVertexSpec(n,d){n=p.AlignedVertexSpec.fromVertexSpec(n,d);return new k(n)}constructor(n){this._spec=n;this._packed=
new Uint8Array(this._spec.stride*this._spec.packVertexCount);this._packedU32View=new Uint32Array(this._packed.buffer);this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(n,d,b,a,c,q){for(let m=0;m<this._spec.packVertexCount;m++){const l=m*this._spec.stride;this._packPosition(b,a,l);this._packId(d,l);var f=this._spec.bitset;if(q){if(f.packTessellation){var t=f.packTessellation(q,c);this._pack(t,f,
l)}for(const u of this._spec.standardAttributes)if(null!=u.packTessellation)f=u.packTessellation(q,c),this._pack(f,u,l);else if(u.packAlternating?.packTessellation)for(f=u.packAlternating.packTessellation(q,c),t=0;t<this._spec.packVertexCount;t++)this._pack(f[t],u,t*this._spec.stride)}}n.vertexWriteRegion(this._packedU32View)}pack(n,d){for(const c of this._spec.standardAttributes)if(c.pack&&"string"!==typeof c.pack){var b=c.pack(n,d);for(var a=0;a<this._spec.packVertexCount;a++)this._pack(b,c,a*this._spec.stride)}else if(c.packAlternating?.pack)for(b=
c.packAlternating.pack(n,d),a=0;a<this._spec.packVertexCount;a++)this._pack(b[a],c,a*this._spec.stride)}_packPosition(n,d,b){const {offset:a}=this._spec.position,c=this._spec.position.packPrecisionFactor??1;n=g.i1616to32(n*c,d*c);this._dataView.setUint32(b+a,n,!0)}_packId(n,d){n*=this._spec.id.packPrecisionFactor??1;const b=this._dataView.getUint32(d+this._spec.id.offset,!0)&4278190080;this._dataView.setUint32(d+this._spec.id.offset,n|b,!0)}_pack(n,d,b){h.packDataView(this._dataView,n,d,b)}}e.MeshWriterVertexPack=
k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(e,g,p,h){function k(b){switch(b){case h.DataType.BYTE:case h.DataType.UNSIGNED_BYTE:return 1;case h.DataType.SHORT:case h.DataType.UNSIGNED_SHORT:return 2;case h.DataType.FLOAT:case h.DataType.INT:case h.DataType.UNSIGNED_INT:return 4}}function n(b){const a=
[],c=[],q=[];for(const f of b)switch(b=k(f.type)*f.count,b%2||b%4||4){case 4:a.push(f);continue;case 2:c.push(f);continue;case 1:q.push(f);continue;default:throw Error("Found unexpected dataType byte count");}a.push(...c);a.push(...q);return a}class d{static fromVertexSpec({attributes:b},a){let c,q,f;var t=[];for(var m in b){const u=b[m];!1!==a?.[m]&&("position"===u.pack?c={...u,name:m,offset:0}:"id"===u.pack?q={...u,name:m,offset:4}:"bitset"===m?f={...u,name:m,offset:7}:t.push({...u,name:m}))}m=
n(t);b=[];a=8;t=1;for(var l of m)b.push({...l,offset:a}),a+=k(l.type)*l.count,l.packAlternating&&(t=Math.max(l.packAlternating.count,t));l=Uint32Array.BYTES_PER_ELEMENT;m=a%l;return new d(c,q,f,b,a+(m?l-m:0),t)}constructor(b,a,c,q,f,t){this.position=b;this.id=a;this.bitset=c;this.standardAttributes=q;this.stride=f;this.packVertexCount=t;q.push(c);this._attributes=[b,a,c,...q]}get attributeLayout(){if(!this._attributeLayout){const b=p.vertexLayoutHash(this._attributes);this._attributeLayout={attributes:this._attributes.map(a=>
({name:a.name,count:a.count,offset:a.offset,type:a.type,packPrecisionFactor:a.packPrecisionFactor,normalized:a.normalized??!1})),hash:b,stride:this.stride}}return this._attributeLayout}}e.AlignedVertexSpec=d;e.sortByAlignment=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../vectorTiles/GeometryUtils ../../../definitions ./meshWriterUtils ./PatternFillMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b){function a(l){const {sprite:u,aspectRatio:v,scaleProportionally:r}=l;var y=g.pt2px(l.height);l=0<y?y:u.height;y*=v;0>=y?y=u.width:r&&(y*=u.width/u.height);return{width:y,height:l}}function c(l){const {applyRandomOffset:u,sampleAlphaOnly:v}=l,{width:r,height:y}=a(l);return k.packBitset([[d.bitsetFillRandomPatternOffset,u],[d.bitsetGenericConsiderAlphaOnly,v],[d.bitsetFillPatternWidthIsCompressed,r<h.maxSizeForU16Compression],[d.bitsetFillPatternHeightIsCompressed,y<h.maxSizeForU16Compression]])}
function q(l){({width:l}=a(l));return Math.round(l<h.maxSizeForU16Compression?l*h.compressionFactorForU16:l)}function f(l){({height:l}=a(l));return Math.round(l<h.maxSizeForU16Compression?l*h.compressionFactorForU16:l)}const t={createComputedParams:l=>l,attributes:{...n.patternFillVertexSpec.attributes,bitset:{count:1,type:b.DataType.UNSIGNED_BYTE,pack:c},width:{count:1,type:b.DataType.UNSIGNED_SHORT,pack:q},height:{count:1,type:b.DataType.UNSIGNED_SHORT,pack:f},offset:{count:2,type:b.DataType.SHORT,
pack:({offsetX:l,offsetY:u})=>[g.pt2px(l),-g.pt2px(u)]},scale:{count:2,type:b.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:l,scaleY:u})=>[l,u]},angle:{count:1,type:b.DataType.UNSIGNED_BYTE,pack:({angle:l})=>p.degToByte(l)}}};class m extends n.PatternFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=t}}e.ComplexFillMeshWriter=m;e.complexFillVertexSpec=t;e.packComplexFillBitset=c;e.packComplexFillHeight=f;e.packComplexFillWidth=q;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger","../../../../../../../symbols/cim/enums"],function(e,g,p,h,k){e.getBitMask=function(n){return 1<<n};e.getMinMaxZoom=function(n,d){const b=!!n?.minScale&&d.scaleToZoom(n.minScale)||0;n=!!n?.maxScale&&d.scaleToZoom(n.maxScale)||100;return[b,n]};e.packBitset=function(n){let d=0;for(const [b,
a]of n)a&&(d|=1<<b);return d};e.packByteSqrt=function(n,d){return Math.round(Math.min(Math.sqrt(n*d),255))};e.packCeil=function(n,d){return Math.ceil(n*d)/d};e.packRounded=function(n,d){return Math.round(n*d)/d};e.processColorInput=function(n){if(!n)return[0,0,0,0];if("string"===typeof n){const q=g.fromString(n);if(!q)return h.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new p("mapview:mesh-processing","Unable to parse string into color",{color:n})),[0,
0,0,0];n=q.toArray()}const [d,b,a,c]=n;return[c/255*d,c/255*b,c/255*a,c]};e.processLineCapInput=function(n){switch(n){case "butt":case k.LineCapStyle.Butt:return k.CapType.BUTT;case "round":case k.LineCapStyle.Round:return k.CapType.ROUND;case "square":case k.LineCapStyle.Square:return k.CapType.SQUARE}};e.processLineJoinInput=function(n){switch(n){case "bevel":case k.LineJoinStyle.Bevel:return k.JoinType.BEVEL;case "miter":case k.LineJoinStyle.Miter:return k.JoinType.MITER;case "round":case k.LineJoinStyle.Round:return k.JoinType.ROUND}};
Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(e,g,p,h){const k={createComputedParams:d=>d,attributes:{...p.fillVertexSpec.attributes,tlbr:{count:4,type:h.DataType.UNSIGNED_SHORT,pack:({sprite:d})=>{const {rect:b,width:a,height:c}=d;d=b.x+g.spritePadding;const q=b.y+g.spritePadding;return[d,
q,d+a,q+c]}},inverseRasterizationScale:{count:1,type:h.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:d})=>1/d.rasterizationScale}}};class n extends p.FillMeshWriter{constructor(){super(...arguments);this.vertexSpec=k}_write(d,b,a){a=a?.asOptimized()??b.readGeometryForDisplay();if(a=this._clip(a))d.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(d,b,a),d.recordEnd()}}e.PatternFillMeshWriter=n;e.patternFillVertexSpec=k;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(e,g,p,h,k){const n={createComputedParams:b=>b,attributes:{id:{type:k.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.DataType.UNSIGNED_BYTE,count:1},pos:{type:k.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:k.DataType.SHORT,
count:2,packPrecisionFactor:g.minMaxZoomPrecisionFactor,pack:({scaleInfo:b},{tileInfo:a})=>h.getMinMaxZoom(b,a)},color:{type:k.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:b})=>h.processColorInput(b)}}};class d extends p.AFillMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}createTesselationParams(b){return null}}e.FillMeshWriter=d;e.fillVertexSpec=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ./ComplexFillMeshWriter ./meshWriterUtils ./OutlineFillMeshWriter ../shaders/ComplexOutlineFillShader ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a){const c=h.complexFillVertexSpec.attributes,q={createComputedParams:l=>l,attributes:{id:c.id,pos:c.pos,zoomRange:c.zoomRange,tlbr:c.tlbr,angle:c.angle,color:c.color,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:l=>h.packComplexFillBitset(l)},aux1:{count:1,type:a.DataType.UNSIGNED_SHORT,pack:l=>h.packComplexFillWidth(l)},aux2:{count:1,type:a.DataType.UNSIGNED_SHORT,pack:l=>h.packComplexFillHeight(l)},aux3:{count:2,type:a.DataType.SHORT,pack:({offsetX:l,offsetY:u})=>
[g.pt2px(l),g.pt2px(u)]},aux4:{count:2,type:a.DataType.UNSIGNED_BYTE,pack:({scaleX:l,scaleY:u})=>[l*d.packPrecision,u*d.packPrecision]}}},f={createComputedParams:l=>l,attributes:{id:c.id,pos:c.pos,zoomRange:c.zoomRange,tlbr:c.tlbr,angle:c.angle,color:n.outlineFillVertexSpec_Outline.attributes.color,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:l=>k.packBitset([[b.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:a.DataType.UNSIGNED_SHORT,pack:l=>g.pt2px(.5*l.width)*d.packPrecision},aux2:{count:1,
type:a.DataType.UNSIGNED_SHORT,pack:l=>g.pt2px(.5*l.referenceWidth)*d.packPrecision},aux3:{count:2,type:a.DataType.SHORT,packTessellation:({extrusionOffsetX:l,extrusionOffsetY:u})=>[l*d.packPrecision,u*d.packPrecision]},aux4:{count:2,type:a.DataType.UNSIGNED_BYTE,packTessellation:({normalX:l,normalY:u})=>[l*d.packPrecision+d.signedToUnsignedByte,u*d.packPrecision+d.signedToUnsignedByte]}}};class t extends n.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=f}}class m extends n.OutlineFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=q}_createOutlineWriter(l,u,v,r){return new t(l,u,v,r)}_write(l,u,v){v=v?.asOptimized()??u.readGeometryForDisplay();if(v=this._clip(v))l.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(l,u,v),this._lineMeshWriter.writeLineVertices(l,p.GeometryCursor.fromOptimizedCIM(v,"esriGeometryPolyline"),u),l.recordEnd()}ensurePacked(l,u,v){super.ensurePacked(l,u,v);this._lineMeshWriter.ensurePacked(l,u,v)}enqueueRequest(l,u,
v){super.enqueueRequest(l,u,v);this._lineMeshWriter.enqueueRequest(l,u,v)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.ComplexOutlineFillMeshWriter=m;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../mesh/templates/templateUtils ./FillMeshWriter ./meshWriterUtils ../line/LineMeshWriter ../mesh/utils ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a){const c={createComputedParams:m=>m,attributes:{...n.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:m=>0},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:m})=>k.processColorInput(m)}}},q={createComputedParams:m=>m,attributes:{...n.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:m=>k.packBitset([[b.bitsetTypeFillOutline,!0]])},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:m})=>
k.processColorInput(m)}}};class f extends n.LineMeshWriter{constructor(){super(...arguments);this.vertexSpec=q}}class t extends h.FillMeshWriter{constructor(m,l,u,v){super(m,l,u,v);this.vertexSpec=c;this._lineMeshWriter=this._createOutlineWriter(m,l,u,v)}_createOutlineWriter(m,l,u,v){return new f(m,l,u,v)}_write(m,l,u){u=u?.asOptimized()??l.readGeometryForDisplay();if(u=this._clip(u))m.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(m,l,u),this._lineMeshWriter.writeLineVertices(m,
g.GeometryCursor.fromOptimizedCIM(u,"esriGeometryPolyline"),l),m.recordEnd()}_clip(m){return m?p.clipMarshall(m,d.getLineClippingMargin(this.evaluatedMeshParams)):null}ensurePacked(m,l,u){super.ensurePacked(m,l,u);this._lineMeshWriter.ensurePacked(m,l,u)}enqueueRequest(m,l,u){super.enqueueRequest(m,l,u);this._lineMeshWriter.enqueueRequest(m,l,u)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.OutlineFillMeshWriter=t;e.OutlineFillOutlineMeshWriter=
f;e.outlineFillVertexSpec_Fill=c;e.outlineFillVertexSpec_Outline=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../definitions ../../../TurboLine ../../../mesh/templates/templateUtils ../fill/meshWriterUtils ../mesh/MeshWriter ../mesh/utils ../../../../../../webgl/enums".split(" "),function(e,
g,p,h,k,n,d,b,a,c){class q{constructor(){this.distance=this.directionY=this.directionX=this.normalY=this.normalX=this.extrusionOffsetY=this.extrusionOffsetX=0}}const f={createComputedParams:l=>l,attributes:{id:{type:c.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:c.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:c.DataType.UNSIGNED_BYTE,count:1},zoomRange:{type:c.DataType.SHORT,count:2,packPrecisionFactor:h.minMaxZoomPrecisionFactor,pack:({scaleInfo:l},{tileInfo:u})=>
d.getMinMaxZoom(l,u)},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:l})=>d.processColorInput(l)},offset:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:l,extrusionOffsetY:u})=>[d.packRounded(l,16),d.packRounded(u,16)]},normal:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:l,normalY:u})=>[d.packRounded(l,16),d.packRounded(u,16)]},halfWidth:{type:c.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,
pack:({width:l})=>d.packCeil(g.pt2px(.5*l),16)},referenceHalfWidth:{type:c.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({referenceWidth:l})=>d.packCeil(g.pt2px(.5*l),16)}}};class t{constructor(){this.vertexBounds=this.vertexFrom=this.vertexCount=this.indexCount=this.bitset=this.id=0}}class m extends b.MeshWriter{constructor(l,u,v,r){super(l,u,v,r);this.vertexSpec=f;this._currentWrite=new t;this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1};
this._tessParams=new q;this._initializeTessellator()}writeLineVertices(l,u,v){u=this._getLines(u);null!=u&&this._writeVertices(l,v,u)}_initializeTessellator(){this._lineTessellator=new k.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(l,u,v){(v=v??p.GeometryCursor.fromFeatureSetReaderCIM(u))&&this._writeGeometry(l,u,v)}_writeGeometry(l,u,v,r){l.recordStart(this.instanceId,this.attributeLayout,r);this.writeLineVertices(l,v,u);l.recordEnd()}_getLines(l){return n.clipLinesMarshall(l,
a.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(l,u,v){const {_currentWrite:r,_tessellationOptions:y,evaluatedMeshParams:x}=this,{width:w,capType:A,joinType:z,miterLimit:C,hasSizeVV:D}=x,F=g.pt2px(.5*w);y.halfWidth=F;y.capType=d.processLineCapInput(A);y.joinType=d.processLineJoinInput(z);y.miterLimit=C;const G=!D;r.out=l;r.id=u.getDisplayId();r.vertexCount=0;r.indexCount=0;r.vertexFrom=l.vertexCount();r.vertexBounds=G&&F<h.thinLineHalfWidthThreshold?0:1;for(const {line:B,start:I}of v)y.initialDistance=
I%65535,this._lineTessellator.tessellate(B,y,G)}_writeTesselatedVertex(l,u,v,r,y,x,w,A,z,C,D){const {out:F,id:G,vertexBounds:B}=this._currentWrite;this.hasEffects&&F.recordBounds(l,u,B,B);this._tessParams.extrusionOffsetX=w;this._tessParams.extrusionOffsetY=A;this._tessParams.normalX=z;this._tessParams.normalY=C;this._tessParams.directionX=y;this._tessParams.directionY=x;this._tessParams.distance=D;this._writeVertex(F,G,l,u,this._tessParams);return this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(l,
u,v){const {out:r}=this._currentWrite;r.indexEnsureSize(3);r.indexWrite(l);r.indexWrite(u);r.indexWrite(v);this._currentWrite.indexCount+=3}}e.LineMeshWriter=m;e.LineTessellationParams=q;e.LineVertexSpec=f;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","../../../../symbols/cim/enums","./definitions"],function(e,g,p){function h(f,t){return f.x===t.x&&f.y===t.y}function k(f,t){f.x=t.y;f.y=-t.x;return f}function n(f,
t){f.x=-t.y;f.y=t.x;return f}function d(f,t){f.x=t.x;f.y=t.y;return f}function b(f,t){f.x=-t.x;f.y=-t.y;return f}function a(f){return Math.sqrt(f.x*f.x+f.y*f.y)}function c(f,t,m,l){f.x=t.x*m+t.y*l;f.y=t.x*l-t.y*m;return f}class q{constructor(f,t,m){this._writeVertex=f;this._writeTriangle=t;this._canUseThinTessellation=m;this._prevNormal={x:void 0,y:void 0};this._nextNormal={x:void 0,y:void 0};this._textureNormalLeft={x:0,y:1};this._textureNormalRight={x:0,y:-1};this._textureNormal={x:void 0,y:void 0};
this._joinNormal={x:void 0,y:void 0};this._inner={x:void 0,y:void 0};this._outer={x:void 0,y:void 0};this._roundStart={x:void 0,y:void 0};this._roundEnd={x:void 0,y:void 0};this._startBreak={x:void 0,y:void 0};this._endBreak={x:void 0,y:void 0};this._innerPrev={x:void 0,y:void 0};this._innerNext={x:void 0,y:void 0};this._bevelStart={x:void 0,y:void 0};this._bevelEnd={x:void 0,y:void 0};this._bevelMiddle={x:void 0,y:void 0}}tessellate(f,t,m=this._canUseThinTessellation){if(f){var l=f.length;if(!(1>=
l)){var u=0;for(let v=1;v<l;v++)h(f[v],f[u])||++u===v||(f[u]=f[v]);f.length=u+1}}m&&t.halfWidth<p.thinLineHalfWidthThreshold&&!t.offset?this._tessellateThin(f,t):this._tessellate(f,t)}_tessellateThin(f,t){if(!(2>f.length)){var m=t.wrapDistance||65535;t=t.initialDistance||0;var l=!1,u=f[0].x,v=f[0].y,r=f.length;for(let A=1;A<r;++A){l&&(l=!1,t=0);let z=f[A].x,C=f[A].y;var y=z-u;let D=C-v;var x=Math.sqrt(y*y+D*D);y/=x;D/=x;if(t+x>m){l=!0;var w=(m-t)/x;x=m-t;z=(1-w)*u+w*z;C=(1-w)*v+w*C;--A}w=this._writeVertex(u,
v,0,0,y,D,D,-y,0,-1,t);u=this._writeVertex(u,v,0,0,y,D,-D,y,0,1,t);t+=x;x=this._writeVertex(z,C,0,0,y,D,D,-y,0,-1,t);y=this._writeVertex(z,C,0,0,y,D,-D,y,0,1,t);this._writeTriangle(w,u,x);this._writeTriangle(u,x,y);u=z;v=C}}}_tessellate(f,t){var m=f[f.length-1];const l=h(f[0],m);if(!(f.length<(l?3:2))){var u=t.pixelCoordRatio,v=null!=t.capType?t.capType:g.CapType.BUTT,r=null!=t.joinType?t.joinType:g.JoinType.MITER,y=null!=t.miterLimit?Math.min(t.miterLimit,4):2,x=null!=t.roundLimit?Math.min(t.roundLimit,
1.05):1.05,w=null!=t.halfWidth?t.halfWidth:2,A=!!t.textured,z=null,C=this._prevNormal,D=this._nextNormal,F=-1,G=-1,B=this._joinNormal,I=this._textureNormalLeft,H=this._textureNormalRight,K=this._textureNormal,O=-1,R=-1,E=t.wrapDistance||65535,J=t.initialDistance||0,Q=this._writeVertex,N=this._writeTriangle;t=(ma,na,oa,pa,ta,sa)=>{ma=Q(W,U,T,X,oa,pa,ma,na,ta,sa,J);0<=O&&0<=R&&0<=ma&&N(O,R,ma);O=R;return R=ma};if(l){var S=f[f.length-2];D.x=m.x-S.x;D.y=m.y-S.y;G=a(D);D.x/=G;D.y/=G}m=!1;for(let ma=0;ma<
f.length;++ma){m&&(m=!1,J=0);S&&(C.x=-D.x,C.y=-D.y,F=G,J+F>E&&(m=!0));m?(z=(E-J)/F,F=E-J,S={x:(1-z)*S.x+z*f[ma].x,y:(1-z)*S.y+z*f[ma].y},--ma):S=f[ma];var W=S.x;var U=S.y;var M=0>=ma&&!m,P=ma===f.length-1;M||(J+=F);(z=P?l?f[1]:null:f[ma+1])?(D.x=z.x-W,D.y=z.y-U,G=a(D),D.x/=G,D.y/=G):(D.x=void 0,D.y=void 0);if(!l){if(M){n(B,D);var T=B.x;var X=B.y;v===g.CapType.SQUARE&&(t(-D.y-D.x,D.x-D.y,D.x,D.y,0,-1),t(D.y-D.x,-D.x-D.y,D.x,D.y,0,1));v===g.CapType.ROUND&&(t(-D.y-D.x,D.x-D.y,D.x,D.y,-1,-1),t(D.y-D.x,
-D.x-D.y,D.x,D.y,-1,1));if(v===g.CapType.ROUND||v===g.CapType.BUTT)t(-D.y,D.x,D.x,D.y,0,-1),t(D.y,-D.x,D.x,D.y,0,1);continue}if(P){k(B,C);T=B.x;X=B.y;if(v===g.CapType.ROUND||v===g.CapType.BUTT)t(C.y,-C.x,-C.x,-C.y,0,-1),t(-C.y,C.x,-C.x,-C.y,0,1);v===g.CapType.SQUARE&&(t(C.y-C.x,-C.x-C.y,-C.x,-C.y,0,-1),t(-C.y-C.x,C.x-C.y,-C.x,-C.y,0,1));v===g.CapType.ROUND&&(t(C.y-C.x,-C.x-C.y,-C.x,-C.y,1,-1),t(-C.y-C.x,C.x-C.y,-C.x,-C.y,1,1));continue}}var Y=void 0;M=-(C.x*D.y-C.y*D.x);.01>Math.abs(M)?0<C.x*D.x+
C.y*D.y?(B.x=C.x,B.y=C.y,M=1,Y=Number.MAX_VALUE,z=!0):(n(B,D),Y=M=1,z=!1):(B.x=(C.x+D.x)/M,B.y=(C.y+D.y)/M,Y=a(B),z=(Y-1)*w*u,z=4<Y||z>F&&z>G);T=B.x;X=B.y;var Z=r;switch(r){case g.JoinType.BEVEL:1.05>Y&&(Z=g.JoinType.MITER);break;case g.JoinType.ROUND:Y<x&&(Z=g.JoinType.MITER);break;case g.JoinType.MITER:Y>y&&(Z=g.JoinType.BEVEL)}switch(Z){case g.JoinType.MITER:t(B.x,B.y,-C.x,-C.y,0,-1);t(-B.x,-B.y,-C.x,-C.y,0,1);if(P)break;A&&(z=m?0:J,O=this._writeVertex(W,U,T,X,D.x,D.y,B.x,B.y,0,-1,z),R=this._writeVertex(W,
U,T,X,D.x,D.y,-B.x,-B.y,0,1,z));break;case g.JoinType.BEVEL:M=0>M;var ba=void 0;M?(Z=O,O=R,R=Z,ba=I,Z=H):(ba=H,Z=I);var aa=void 0,da=void 0;z?(aa=M?n(this._innerPrev,C):k(this._innerPrev,C),da=M?k(this._innerNext,D):n(this._innerNext,D)):aa=da=M?b(this._inner,B):d(this._inner,B);Y=M?k(this._bevelStart,C):n(this._bevelStart,C);t(aa.x,aa.y,-C.x,-C.y,ba.x,ba.y);aa=t(Y.x,Y.y,-C.x,-C.y,Z.x,Z.y);if(P)break;P=M?n(this._bevelEnd,D):k(this._bevelEnd,D);z?(z=this._writeVertex(W,U,T,X,-C.x,-C.y,0,0,0,0,J),O=
this._writeVertex(W,U,T,X,D.x,D.y,da.x,da.y,ba.x,ba.y,J),R=this._writeVertex(W,U,T,X,D.x,D.y,P.x,P.y,Z.x,Z.y,J),this._writeTriangle(aa,z,R)):(A?(z=this._bevelMiddle,z.x=(Y.x+P.x)/2,z.y=(Y.y+P.y)/2,c(K,z,-C.x,-C.y),t(z.x,z.y,-C.x,-C.y,K.x,K.y),c(K,z,D.x,D.y),O=this._writeVertex(W,U,T,X,D.x,D.y,z.x,z.y,K.x,K.y,J),R=this._writeVertex(W,U,T,X,D.x,D.y,da.x,da.y,ba.x,ba.y,J)):(z=O,O=R,R=z),t(P.x,P.y,D.x,D.y,Z.x,Z.y));M&&(z=O,O=R,R=z);break;case g.JoinType.ROUND:M=0>M;var fa=void 0;M?(Z=O,O=R,R=Z,Z=I,fa=
H):(Z=H,fa=I);var ia=M?b(this._inner,B):d(this._inner,B);z?(da=M?n(this._innerPrev,C):k(this._innerPrev,C),ba=M?k(this._innerNext,D):n(this._innerNext,D)):ba=da=ia;aa=M?k(this._roundStart,C):n(this._roundStart,C);var ha=M?n(this._roundEnd,D):k(this._roundEnd,D);da=t(da.x,da.y,-C.x,-C.y,Z.x,Z.y);aa=t(aa.x,aa.y,-C.x,-C.y,fa.x,fa.y);if(P)break;P=this._writeVertex(W,U,T,X,-C.x,-C.y,0,0,0,0,J);z||this._writeTriangle(O,R,P);ia=b(this._outer,ia);fa=this._writeVertex(W,U,T,X,D.x,D.y,ha.x,ha.y,fa.x,fa.y,J);
let na,oa;if(ha=2<Y){var ja=void 0;Y!==Number.MAX_VALUE?(ia.x/=Y,ia.y/=Y,ja=C.x*ia.x+C.y*ia.y,ja=(Y*(ja*ja-1)+1)/ja):ja=-1;na=M?k(this._startBreak,C):n(this._startBreak,C);na.x+=C.x*ja;na.y+=C.y*ja;oa=M?n(this._endBreak,D):k(this._endBreak,D);oa.x+=D.x*ja;oa.y+=D.y*ja}c(K,ia,-C.x,-C.y);Y=this._writeVertex(W,U,T,X,-C.x,-C.y,ia.x,ia.y,K.x,K.y,J);c(K,ia,D.x,D.y);ia=A?this._writeVertex(W,U,T,X,D.x,D.y,ia.x,ia.y,K.x,K.y,J):Y;ja=P;const pa=A?this._writeVertex(W,U,T,X,D.x,D.y,0,0,0,0,J):P;let ta=-1,sa=-1;
ha&&(c(K,na,-C.x,-C.y),ta=this._writeVertex(W,U,T,X,-C.x,-C.y,na.x,na.y,K.x,K.y,J),c(K,oa,D.x,D.y),sa=this._writeVertex(W,U,T,X,D.x,D.y,oa.x,oa.y,K.x,K.y,J));A?ha?(this._writeTriangle(ja,aa,ta),this._writeTriangle(ja,ta,Y),this._writeTriangle(pa,ia,sa),this._writeTriangle(pa,sa,fa)):(this._writeTriangle(ja,aa,Y),this._writeTriangle(pa,ia,fa)):ha?(this._writeTriangle(P,aa,ta),this._writeTriangle(P,ta,sa),this._writeTriangle(P,sa,fa)):(this._writeTriangle(P,aa,Y),this._writeTriangle(P,ia,fa));z?O=this._writeVertex(W,
U,T,X,D.x,D.y,ba.x,ba.y,Z.x,Z.y,J):(O=A?this._writeVertex(W,U,T,X,D.x,D.y,ba.x,ba.y,Z.x,Z.y,J):da,this._writeTriangle(O,pa,fa));R=fa;M&&(z=O,O=R,R=z)}}}}}e.LineTessellation=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./ComplexFillShader ./hittestUtils ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternOutlineFillShader".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f){class t extends k.FeatureVertexInput{}g.__decorate([p.location(3,h.Vec4)],t.prototype,"color",void 0);g.__decorate([p.location(4,h.Vec4)],t.prototype,"tlbr",void 0);g.__decorate([p.location(5,h.Float)],t.prototype,"angle",void 0);g.__decorate([p.location(6,h.Float)],t.prototype,"aux1",void 0);g.__decorate([p.location(7,h.Float)],t.prototype,"aux2",void 0);g.__decorate([p.location(8,h.Vec2)],t.prototype,"aux3",void 0);g.__decorate([p.location(9,h.Vec2)],t.prototype,
"aux4",void 0);g.__decorate([p.location(10,h.Vec2)],t.prototype,"zoomRange",void 0);class m extends f.PatternOutlineFillFragmentInput{}class l extends q.AOutlineFillShader{vertex(u,v){const {aux1:r,aux2:y,aux3:x,aux4:w}=u;var A={...u,width:r,height:y,offset:x,scale:w.multiply(.0625)},z={...u,halfWidth:r.multiply(.0625),referenceHalfWidth:y.multiply(.0625),offset:x.multiply(.0625),normal:w.subtract(128).multiply(.0625)};z=q.getOutlineFillVertexData(this,z);A=n.getComplexFillVertexData(this,A);const C=
h.greaterThan(z.isOutline,new h.Float(.5));return{...z,...A,...this.maybeRunHittest(u,v,C)}}fragment(u){var {isOutline:v}=u;v=h.greaterThan(v,new h.Float(.5));var r=b.getLineFragmentColor(u,this.antialiasingControls.blur);const y=n.getComplexFillFragmentColor(this,u);r=h.ifElse(v,r,y);v=h.ifElse(v,new h.Float(1/255),new h.Float(0));return this.getFragmentOutput(r,u,v)}hittest(u,v,r){return h.ifElse(r,d.failHittest(this.hittestRequest),d.hittestFill(this,u,v))}}g.__decorate([p.uniform(c.MosaicInfo)],
l.prototype,"mosaicInfo",void 0);g.__decorate([p.uniform(a.LocalTileOffset)],l.prototype,"localTileOffset",void 0);g.__decorate([g.__param(0,p.input(t)),g.__param(1,p.input(k.BaseHittestVertexInput))],l.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(m))],l.prototype,"fragment",null);e.ComplexOutlineFillShader=l;e.ComplexOutlineFillVertexInput=t;e.packPrecision=16;e.signedToUnsignedByte=128;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./FillShader ./LocalTileOffset ./MosaicInfo ./utils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){function f(v,r){var y=k.mix(new k.Vec2(1),new k.Vec2(1/p.compressionFactorForU16),new k.Vec2(q.getBit(r.bitset,d.bitsetFillPatternWidthIsCompressed),q.getBit(r.bitset,d.bitsetFillPatternHeightIsCompressed))),x=v.view.requiredZoomFactor,w=(new k.Vec2(r.width,r.height)).multiply(y);y=w.multiply(r.scale).multiply(x);var A=r.angle.multiply(d.c256ToRad);const z=k.sin(A);A=k.cos(A);var C=r.id;var D=k.equal(q.getBit(r.bitset,d.bitsetFillRandomPatternOffset),k.float(1));C=
q.rgba2float(new k.Vec4(C,0));D=k.ifElse(D,k.mat3(A.divide(y.x),z.divide(y.y),0,k.negate(z.divide(y.x)),A.divide(y.y),0,q.rand(k.vec2(C,0)),q.rand(k.vec2(0,C)),1),k.mat3(A.divide(y.x),z.divide(y.y),0,k.negate(z.divide(y.x)),A.divide(y.y),0,0,0,1));w=v.localTileOffset.getPatternOffsetAtTileOrigin(w,z,A);x=x.multiply(r.scale).multiply(r.offset.subtract(w)).divide(y);y=new k.Vec3(r.pos,1);x=D.multiply(y).xy.subtract(x);y=r.tlbr.divide(v.mosaicInfo.size.xyxy);w=q.getBit(r.bitset,d.bitsetGenericConsiderAlphaOnly);
null!=v.visualVariableColor&&(w=k.ifElse(q.isNan(v.storage.getColorValue(r.id)),new k.Float(0),w));return{tileTextureCoord:x,tlbr:y,sampleAlphaOnly:w}}function t(v,r){var y=k.mod(r.tileTextureCoord,new k.Float(1));y=k.mix(r.tlbr.xy,r.tlbr.zw,y);v=k.texture2D(v.mosaicInfo.texture,y);v=k.ifElse(k.greaterThan(r.sampleAlphaOnly,new k.Float(.5)),v.aaaa,v);return r.color.multiply(v)}class m extends b.FillVertexInput{}g.__decorate([h.location(5,k.Vec4)],m.prototype,"tlbr",void 0);g.__decorate([h.location(6,
k.Float)],m.prototype,"width",void 0);g.__decorate([h.location(7,k.Float)],m.prototype,"height",void 0);g.__decorate([h.location(8,k.Vec2)],m.prototype,"offset",void 0);g.__decorate([h.location(9,k.Vec2)],m.prototype,"scale",void 0);g.__decorate([h.location(10,k.Float)],m.prototype,"angle",void 0);class l extends n.FeatureFragmentInput{}class u extends b.FillShader{vertex(v,r){return{...super.vertex(v,r),...f(this,v)}}fragment(v){const r=t(this,v);return this.getFragmentOutput(r,v,new k.Float(0))}}
g.__decorate([h.uniform(c.MosaicInfo)],u.prototype,"mosaicInfo",void 0);g.__decorate([h.uniform(a.LocalTileOffset)],u.prototype,"localTileOffset",void 0);g.__decorate([g.__param(0,h.input(m)),g.__param(1,h.input(n.BaseHittestVertexInput))],u.prototype,"vertex",null);g.__decorate([g.__param(0,h.input(l))],u.prototype,"fragment",null);e.ComplexFillFragmentInput=l;e.ComplexFillShader=u;e.ComplexFillVertexInput=m;e.getComplexFillFragmentColor=t;e.getComplexFillVertexData=f;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./vvUtils".split(" "),function(e,g,p,h,k,n,d,b,a){class c extends k.FeatureVertexInput{}g.__decorate([p.location(3,h.Vec4)],c.prototype,"color",void 0);g.__decorate([p.location(4,h.Vec2)],c.prototype,"zoomRange",void 0);class q extends k.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(f,t){var m=a.getVisualVariableOpacity(this,f.id);m=a.getVisualVariableColor(this,f.id,f.color).multiply(m);const l=this.view.displayViewScreenMat3.multiply(new h.Vec3(f.pos.xy,1)),u=this.clip(f.id,f.zoomRange);return{glPosition:new h.Vec4(l.xy,u,1),color:m,...this.maybeRunHittest(f,t,null)}}fragment(f){return this.getFragmentOutput(f.color,f,new h.Float(0))}hittest(f,t){return n.hittestFill(this,f,t)}}g.__decorate([p.option(d.VisualVariableColor)],
q.prototype,"visualVariableColor",void 0);g.__decorate([p.option(b.VisualVariableOpacity)],q.prototype,"visualVariableOpacity",void 0);g.__decorate([g.__param(0,p.input(c)),g.__param(1,p.input(k.BaseHittestVertexInput))],q.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(k.FeatureFragmentInput))],q.prototype,"fragment",null);e.FillShader=q;e.FillVertexInput=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,g,p,h,k){class n extends p.UniformGroup{getColor(d,b,a){return h.cond([h.or(k.isNan(d),a),b],[h.lessThanEqual(d,this.values.first()),this.colors.first()],[h.greaterThanEqual(d,this.values.last()),this.colors.last()],[!0,()=>{const c=this.values.findIndex(m=>h.greaterThan(m,d));var q=this.values.get(c);const f=c.subtract(1),t=this.values.get(f);q=d.subtract(t).divide(q.subtract(t));return h.mix(this.colors.get(f),
this.colors.get(c),q)}])}}g.__decorate([p.uniform(h.FixedArray.ofType(h.Vec4,8))],n.prototype,"colors",void 0);g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,8))],n.prototype,"values",void 0);e.VisualVariableColor=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,
g,p,h,k){class n extends p.UniformGroup{getOpacity(d){return h.cond([k.isNan(d),new h.Float(1)],[h.lessThanEqual(d,this.opacityValues.first()),this.opacities.first()],[h.greaterThanEqual(d,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const b=this.opacityValues.findIndex(f=>h.greaterThan(f,d));var a=this.opacityValues.get(b);const c=b.subtract(1),q=this.opacityValues.get(c);a=d.subtract(q).divide(a.subtract(q));return h.mix(this.opacities.get(c),this.opacities.get(b),a)}])}}g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,
8))],n.prototype,"opacities",void 0);g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,8))],n.prototype,"opacityValues",void 0);e.VisualVariableOpacity=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(e,g){function p(h){return null!=h.visualVariableSizeMinMaxValue||null!=h.visualVariableSizeScaleStops||null!=h.visualVariableSizeStops||null!=h.visualVariableSizeUnitValue}
e.getVisualVariableColor=function(h,k,n,d=new g.Bool(!1)){if(null==h.visualVariableColor)return n;k=h.storage.getColorValue(k);return h.visualVariableColor.getColor(k,n,d)};e.getVisualVariableOpacity=function(h,k){if(null==h.visualVariableOpacity)return new g.Float(1);k=h.storage.getOpacityValue(k);return h.visualVariableOpacity.getOpacity(k)};e.getVisualVariableRotation=function(h,k){if(null==h.visualVariableRotation)return g.Mat3.identity();k=h.storage.getRotationValue(k);return h.visualVariableRotation.getVVRotationMat3(k)};
e.getVisualVariableSize=function(h,k,n){return p(h)?(k=h.storage.getSizeValue(k),h.visualVariableSizeMinMaxValue?.getSize(k,n)??h.visualVariableSizeScaleStops?.getSizeForViewScale(h.view.currentScale)??h.visualVariableSizeStops?.getSize(k,n)??h.visualVariableSizeUnitValue?.getSize(k,n)):n};e.hasVisualVariableSize=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl","./constants"],function(e,g,p,h,k){class n extends p.UniformGroup{getPatternOffsetAtTileOrigin(d,b=new h.Float(0),a=new h.Float(1)){var c=(new h.Vec2(k.maxRepresentableInt)).divide(d);c=d.multiply(h.fract(this.maxIntsToLocalOrigin.multiply(c))).add(this.tileOffsetFromLocalOrigin).subtract((new h.Float(.5)).multiply(d));c=new h.Vec2(c.x.multiply(a).subtract(c.y.multiply(b)),c.x.multiply(b).add(c.y.multiply(a)));return h.mod(c,d)}}g.__decorate([p.uniform(h.Vec2)],
n.prototype,"tileOffsetFromLocalOrigin",void 0);g.__decorate([p.uniform(h.Vec2)],n.prototype,"maxIntsToLocalOrigin",void 0);e.LocalTileOffset=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,g,p,h){class k extends p.UniformGroup{}g.__decorate([p.uniform(h.Vec2)],k.prototype,"size",void 0);
g.__decorate([p.uniform(h.Sampler2D)],k.prototype,"texture",void 0);e.MosaicInfo=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m){function l(z){return h.max((new h.Float(n.thinLineWidthFactor)).multiply(h.step(z,new h.Float(n.thinLineHalfWidth))),new h.Float(1))}function u(z,C){const {halfWidth:D,normal:F}=z;z=l(D);const G=h.length(F).multiply(D);return h.clamp(z.multiply(D.subtract(G)).divide(C.add(z).subtract(new h.Float(1))),new h.Float(0),new h.Float(1))}function v(z,C){const {id:D,offset:F,pos:G,normal:B,zoomRange:I}=C,{displayViewScreenMat3:H,displayViewMat3:K}=z.view,O=m.getVisualVariableColor(z,
D,C.color),R=m.getVisualVariableOpacity(z,D);{const {id:N,halfWidth:S,referenceHalfWidth:W}=C;m.hasVisualVariableSize(z)?(C=(new h.Float(2)).multiply(W),C=m.getVisualVariableSize(z,N,C),C=(new h.Float(.5)).multiply(S.divide(h.max(W,new h.Float(n.epsilon)))).multiply(C)):C=S}var E=(new h.Float(.5)).multiply(z.antialiasingControls.antialiasing);E=h.max(C.add(E),new h.Float(.45)).add((new h.Float(.1)).multiply(E));const J=l(E).multiply(E).multiply(F);var Q=K.multiply(new h.Vec3(J,new h.Float(0)));Q=
H.multiply(new h.Vec3(G,new h.Float(1))).add(Q);z=(new h.Float(2)).multiply(h.step(C,new h.Float(0))).add(z.clip(D,I));Q=new h.Vec4(Q.xy,z,1);z=new h.Vec4(Q.xy,z,1);return{color:O,opacity:R,halfWidth:E,normal:B,scaledOffset:J,scaledHalfWidth:C,glPosition:z}}function r(z,C){const {opacity:D,color:F}=z;z=u(z,C);return D.multiply(F).multiply(z)}class y extends k.FeatureVertexInput{}g.__decorate([p.location(3,h.Vec4)],y.prototype,"color",void 0);g.__decorate([p.location(4,h.Vec2)],y.prototype,"offset",
void 0);g.__decorate([p.location(5,h.Vec2)],y.prototype,"normal",void 0);g.__decorate([p.location(6,h.Float)],y.prototype,"halfWidth",void 0);g.__decorate([p.location(7,h.Float)],y.prototype,"referenceHalfWidth",void 0);g.__decorate([p.location(8,h.Vec2)],y.prototype,"zoomRange",void 0);class x extends k.FeatureFragmentInput{}class w extends p.UniformGroup{}g.__decorate([p.uniform(h.Float)],w.prototype,"antialiasing",void 0);g.__decorate([p.uniform(h.Float)],w.prototype,"blur",void 0);class A extends k.AFeatureShader{constructor(){super(...arguments);
this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(z,C){const D=v(this,z);return{...D,...this.maybeRunHittest(z,C,D.halfWidth)}}fragment(z){const C=r(z,this.antialiasingControls.blur);return this.getFragmentOutput(C,z)}hittest(z,C,D){const {viewMat3:F,tileMat3:G}=this.view;var B=F.multiply(G);z=B.multiply(new h.Vec3(z.pos,1));const I=B.multiply(new h.Vec3(C.nextPos1,1));C=B.multiply(new h.Vec3(C.nextPos2,1));const {distance:H,smallSymbolDistance:K,smallSymbolSizeThreshold:O}=this.hittestRequest;
B=h.step(D,O.multiply(.5)).multiply(H.subtract(K));const R=this.hittestRequest.position;return h.min(d.distPointSegment(R,z.xy,I.xy),d.distPointSegment(R,z.xy,C.xy)).subtract(D).add(B)}}g.__decorate([p.uniform(w)],A.prototype,"antialiasingControls",void 0);g.__decorate([p.option(b.VisualVariableColor)],A.prototype,"visualVariableColor",void 0);g.__decorate([p.option(a.VisualVariableOpacity)],A.prototype,"visualVariableOpacity",void 0);g.__decorate([p.option(c.VisualVariableSizeMinMaxValue)],A.prototype,
"visualVariableSizeMinMaxValue",void 0);g.__decorate([p.option(q.VisualVariableSizeScaleStops)],A.prototype,"visualVariableSizeScaleStops",void 0);g.__decorate([p.option(f.VisualVariableSizeStops)],A.prototype,"visualVariableSizeStops",void 0);g.__decorate([p.option(t.VisualVariableSizeUnitValue)],A.prototype,"visualVariableSizeUnitValue",void 0);g.__decorate([g.__param(0,p.input(y)),g.__param(1,p.input(k.BaseHittestVertexInput))],A.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(x))],
A.prototype,"fragment",null);e.AntialiasingControls=w;e.LineFragmentInput=x;e.LineShader=A;e.LineVertexInput=y;e.getLineAntialiasing=u;e.getLineFragmentColor=r;e.getLineVertexData=v;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,g,p,h,k){class n extends p.UniformGroup{getSize(d,
b){const a=this.minMaxValueAndSize.xy,c=this.minMaxValueAndSize.zw;return h.ifElse(k.isNan(d),b,()=>{var q=d.subtract(a.x).divide(a.y.subtract(a.x));q=h.clamp(q,new h.Float(0),new h.Float(1));return c.x.add(q.multiply(c.y.subtract(c.x)))})}}g.__decorate([p.uniform(h.Vec4)],n.prototype,"minMaxValueAndSize",void 0);e.VisualVariableSizeMinMaxValue=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports",
"../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,g,p,h){class k extends p.UniformGroup{getSizeForViewScale(n){return h.cond([h.lessThanEqual(n,this.values.first()),this.sizes.first()],[h.greaterThanEqual(n,this.values.last()),this.sizes.last()],[!0,()=>{const d=this.values.findIndex(q=>h.greaterThan(q,n));var b=this.values.get(d);const a=d.subtract(1),c=this.values.get(a);b=n.subtract(c).divide(b.subtract(c));return h.mix(this.sizes.get(a),this.sizes.get(d),
b)}])}}g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,8))],k.prototype,"sizes",void 0);g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,8))],k.prototype,"values",void 0);e.VisualVariableSizeScaleStops=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,g,p,h,
k){class n extends p.UniformGroup{getSize(d,b){const a=h.cond([k.isNan(d),b],[h.lessThanEqual(d,this.values.first()),this.sizes.first()],[h.greaterThanEqual(d,this.values.last()),this.sizes.last()],[!0,()=>{const c=this.values.findIndex(m=>h.greaterThan(m,d));var q=this.values.get(c);const f=c.subtract(1),t=this.values.get(f);q=d.subtract(t).divide(q.subtract(t));return h.mix(this.sizes.get(f),this.sizes.get(c),q)}]);return h.ifElse(k.isNan(a),b,a)}}g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,
8))],n.prototype,"sizes",void 0);g.__decorate([p.uniform(h.FixedArray.ofType(h.Float,8))],n.prototype,"values",void 0);e.VisualVariableSizeStops=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,g,p,h,k){class n extends p.UniformGroup{getSize(d,b){return h.ifElse(k.isNan(d),
b,d.multiply(this.unitValueToPixelsRatio))}}g.__decorate([p.uniform(h.Float)],n.prototype,"unitValueToPixelsRatio",void 0);e.VisualVariableSizeUnitValue=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./hittestUtils ./LineShader ./utils ./VisualVariableColor ./VisualVariableOpacity ./VisualVariableSizeMinMaxValue ./VisualVariableSizeScaleStops ./VisualVariableSizeStops ./VisualVariableSizeUnitValue ./vvUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u){function v(A,z,C){const {id:D,bitset:F}=z,G=a.getBit(F,n.bitsetTypeFillOutline),B=h.greaterThan(G,new h.Float(.5)),I=b.getLineVertexData(A,z),H=h.ifElse(B,I.halfWidth,new h.Float(0));var K=u.getVisualVariableOpacity(A,D),O=u.getVisualVariableColor(A,D,z.color);K=h.ifElse(B,z.color,O.multiply(K));O=A.view.displayViewScreenMat3.multiply(new h.Vec3(z.pos.xy,1));const R=A.clip(z.id);O=new h.Vec4(O.xy,R,1);O=h.ifElse(B,I.glPosition,O);A=C&&A.maybeRunHittest(z,
C,B);return{isOutline:G,color:K,opacity:new h.Float(1),halfWidth:H,normal:I.normal,glPosition:O,...A}}class r extends k.FeatureVertexInput{}g.__decorate([p.location(3,h.Vec2)],r.prototype,"offset",void 0);g.__decorate([p.location(4,h.Vec4)],r.prototype,"color",void 0);g.__decorate([p.location(5,h.Vec2)],r.prototype,"normal",void 0);g.__decorate([p.location(6,h.Float)],r.prototype,"halfWidth",void 0);g.__decorate([p.location(7,h.Float)],r.prototype,"referenceHalfWidth",void 0);g.__decorate([p.location(8,
h.Vec2)],r.prototype,"zoomRange",void 0);class y extends b.LineFragmentInput{}class x extends k.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={pos:["nextPos1","nextPos2"]}}}g.__decorate([p.uniform(b.AntialiasingControls)],x.prototype,"antialiasingControls",void 0);g.__decorate([p.option(c.VisualVariableColor)],x.prototype,"visualVariableColor",void 0);g.__decorate([p.option(q.VisualVariableOpacity)],x.prototype,"visualVariableOpacity",void 0);g.__decorate([p.option(f.VisualVariableSizeMinMaxValue)],
x.prototype,"visualVariableSizeMinMaxValue",void 0);g.__decorate([p.option(t.VisualVariableSizeScaleStops)],x.prototype,"visualVariableSizeScaleStops",void 0);g.__decorate([p.option(m.VisualVariableSizeStops)],x.prototype,"visualVariableSizeStops",void 0);g.__decorate([p.option(l.VisualVariableSizeUnitValue)],x.prototype,"visualVariableSizeUnitValue",void 0);class w extends x{vertex(A,z){return v(this,A,z)}fragment(A){const {color:z,isOutline:C}=A;var D=h.greaterThan(C,new h.Float(.5)),F=b.getLineFragmentColor(A,
this.antialiasingControls.blur);F=h.ifElse(D,F,z);D=h.ifElse(D,new h.Float(1/255),new h.Float(0));return this.getFragmentOutput(F,A,D)}hittest(A,z,C){return h.ifElse(C,d.failHittest(this.hittestRequest),d.hittestFill(this,A,z))}}g.__decorate([g.__param(0,p.input(r)),g.__param(1,p.input(k.BaseHittestVertexInput))],w.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(y))],w.prototype,"fragment",null);e.AOutlineFillShader=x;e.OutlineFillFragmentInput=y;e.OutlineFillShader=w;e.OutlineFillVertexInput=
r;e.getOutlineFillVertexData=v;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./LineShader ./LocalTileOffset ./MosaicInfo ./OutlineFillShader ./PatternFillShader".split(" "),function(e,g,p,h,k,n,d,b,a,c){class q extends a.OutlineFillVertexInput{}g.__decorate([p.location(9,h.Vec4)],
q.prototype,"tlbr",void 0);g.__decorate([p.location(10,h.Float)],q.prototype,"inverseRasterizationScale",void 0);class f extends a.OutlineFillFragmentInput{}class t extends a.OutlineFillShader{vertex(m,l){return{...a.getOutlineFillVertexData(this,m,l),...c.getPatternFillVertexData(this,m)}}fragment(m){var {isOutline:l}=m;l=h.greaterThan(l,new h.Float(.5));var u=n.getLineFragmentColor(m,this.antialiasingControls.blur);const v=c.getPatternFillFragmentColor(m,this.mosaicInfo);u=h.ifElse(l,u,v);l=h.ifElse(l,
new h.Float(1/255),new h.Float(0));return this.getFragmentOutput(u,m,l)}}g.__decorate([p.uniform(b.MosaicInfo)],t.prototype,"mosaicInfo",void 0);g.__decorate([p.uniform(d.LocalTileOffset)],t.prototype,"localTileOffset",void 0);g.__decorate([g.__param(0,p.input(q)),g.__param(1,p.input(k.BaseHittestVertexInput))],t.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(f))],t.prototype,"fragment",null);e.PatternOutlineFillFragmentInput=f;e.PatternOutlineFillShader=t;e.PatternOutlineFillVertexInput=
q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./FillShader ./LocalTileOffset ./MosaicInfo".split(" "),function(e,g,p,h,k,n,d,b){function a(m,l){var u=l.tlbr.xy,v=l.tlbr.zw,r=v.x.subtract(u.x);u=u.y.subtract(v.y);r=(new h.Vec2(r,u)).multiply(l.inverseRasterizationScale);u=r.multiply(m.view.requiredZoomFactor);
v=new h.Float(1);const y=new h.Float(0);v=new h.Mat3(v.divide(u.x),y.divide(u.y),0,h.negate(y.divide(u.x)),v.divide(u.y),0,0,0,1);r=m.localTileOffset.getPatternOffsetAtTileOrigin(r).divide(u);u=new h.Vec3(l.pos,1);r=v.multiply(u).xy.subtract(r);m=l.tlbr.divide(m.mosaicInfo.size.xyxy);return{tileTextureCoord:r,tlbr:m}}function c(m,l){var u=h.mod(m.tileTextureCoord,new h.Float(1));u=h.mix(m.tlbr.xy,m.tlbr.zw,u);l=h.texture2D(l.texture,u);return m.color.multiply(l)}class q extends n.FillVertexInput{}
g.__decorate([p.location(5,h.Vec4)],q.prototype,"tlbr",void 0);g.__decorate([p.location(6,h.Float)],q.prototype,"inverseRasterizationScale",void 0);class f extends k.FeatureFragmentInput{}class t extends n.FillShader{vertex(m,l){return{...super.vertex(m,l),...a(this,m)}}fragment(m){const l=c(m,this.mosaicInfo);return this.getFragmentOutput(l,m,new h.Float(0))}}g.__decorate([p.uniform(b.MosaicInfo)],t.prototype,"mosaicInfo",void 0);g.__decorate([p.uniform(d.LocalTileOffset)],t.prototype,"localTileOffset",
void 0);g.__decorate([g.__param(0,p.input(q)),g.__param(1,p.input(k.BaseHittestVertexInput))],t.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(f))],t.prototype,"fragment",null);e.PatternFillFragmentInput=f;e.PatternFillShader=t;e.PatternFillVertexInput=q;e.getPatternFillFragmentColor=c;e.getPatternFillVertexData=a;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports",
"../../../../../../../geometry/GeometryCursor","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(e,g,p,h){const k={createComputedParams:a=>a,attributes:{...h.patternFillVertexSpec.attributes,...p.outlineFillVertexSpec_Fill.attributes}},n={createComputedParams:a=>a,attributes:{...h.patternFillVertexSpec.attributes,...p.outlineFillVertexSpec_Outline.attributes}};class d extends p.OutlineFillOutlineMeshWriter{constructor(){super(...arguments);this.vertexSpec=n}}class b extends p.OutlineFillMeshWriter{constructor(){super(...arguments);
this.vertexSpec=k}_createOutlineWriter(a,c,q,f){return new d(a,c,q,f)}_write(a,c,q){q=q?.asOptimized()??c.readGeometryForDisplay();if(q=this._clip(q))a.recordStart(this.instanceId,this.attributeLayout,this.evaluatedMeshParams.sprite?.textureBinding),this._writeGeometry(a,c,q),this._lineMeshWriter.writeLineVertices(a,g.GeometryCursor.fromOptimizedCIM(q,"esriGeometryPolyline"),c),a.recordEnd()}ensurePacked(a,c,q){super.ensurePacked(a,c,q);this._lineMeshWriter.ensurePacked(a,c,q)}enqueueRequest(a,c,
q){super.enqueueRequest(a,c,q);this._lineMeshWriter.enqueueRequest(a,c,q)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.PatternOutlineFillMeshWriter=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,g,p){const h={createComputedParams:n=>n,attributes:{pos:{type:p.DataType.SHORT,
count:2,pack:"position",packPrecisionFactor:10},id:{type:p.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1},offset:{type:p.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class k extends g.MeshWriter{constructor(){super(...arguments);this.vertexSpec=h}_write(n,d){n.recordStart(this.instanceId,this.attributeLayout);const b=d.getDisplayId();if("esriGeometryPoint"===d.geometryType){const a=d.readXForDisplay();d=d.readYForDisplay();
this._writeQuad(n,b,a,d)}else"esriGeometryMultipoint"===d.geometryType&&d.readGeometryForDisplay()?.forEachVertex((a,c)=>{0<=a&&512>=a&&0<=c&&512>=c&&this._writeQuad(n,b,a,c)});n.recordEnd()}_writeQuad(n,d,b,a){const c=n.vertexCount();this._writeVertex(n,d,b,a);n.indexWrite(c+0);n.indexWrite(c+1);n.indexWrite(c+2);n.indexWrite(c+1);n.indexWrite(c+3);n.indexWrite(c+2)}}e.HeatmapMeshWriter=k;e.heatmapVertexSpec=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define("exports ../../../../../../../core/MapUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../alignmentUtils ../../../DisplayId ../../../collisions/BoundingBox ../../../collisions/LabelMetric ../../../mesh/templates/segmentUtils ../fill/meshWriterUtils ../text/TextMeshWriter".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){const f=g.memoize(m=>{let l=0;if(0===m)return Infinity;for(;!(m%2);)l++,m/=2;return l});class t extends q.TextMeshWriter{constructor(){super(...arguments);this._zoomLevel=0}_write(m,l,u,v){this._zoomLevel=v||0;if(null!=u)throw Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(l.geometryType){case "esriGeometryPoint":return u=l.readXForDisplay(),v=l.readYForDisplay(),this._writePoint(m,u,v,l);case "esriGeometryEnvelope":case "esriGeometryPolygon":case "esriGeometryMultipoint":u=
l.readCentroidForDisplay();if(!u)break;const [r,y]=u.coords;return this._writePoint(m,r,y,l);case "esriGeometryPolyline":u=l.readLegacyGeometryForDisplay(),this._writeLines(m,l,u)}}_writePoint(m,l,u,v){const r=this._getShaping();if(r){var y=this._getPointReferenceBounds();y||={offsetX:0,offsetY:0,size:0};var x=r.boundsT,w=k.getXAnchorDirection(this.evaluatedMeshParams.horizontalAlignment),A=k.getYAnchorDirection(this.evaluatedMeshParams.verticalAlignment),z=this.evaluatedMeshParams.scaleInfo?.maxScale??
0,C=this.evaluatedMeshParams.scaleInfo?.minScale??0,D=n.getDisplayIdTexel(v.getDisplayId());m.metricStart(new b.LabelMetric(D,l,u,w,A,z,C,y));m.metricBoxWrite(x);this._writeGlyphs(m,v.getDisplayId(),l,u,r,0,y);m.metricEnd()}}_getPointReferenceBounds(){if(!this._references)return null;for(const m of this._references){const l=m.getBoundsInfo();if(l)return l}return null}_writeLines(m,l,u){const {repeatLabel:v,scaleInfo:r}=this.evaluatedMeshParams;var y=this.evaluatedMeshParams.repeatLabelDistance||128;
const x=this._getShaping();if(x){this._current={out:m,id:l.getDisplayId(),shaping:x,zoomRange:c.getMinMaxZoom(r,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};m=a.smoothPaths(u.paths,x.bounds.width);l=this._placeSubdivGlyphs.bind(this);y=(x.bounds.width+y)/2;for(const w of m)a.pathDivide(w,y,l,!!v)}}_placeSubdivGlyphs(m,l,u,v){const {allowOverrun:r,labelPosition:y,repeatLabelDistance:x}=this.evaluatedMeshParams,w=this._current.zoomRange[0];var A=
f(l),z=this._current.shaping.bounds.width/2,C=Math.sqrt(x||128)/2;u=Math.min(u,v-u);z=this._current.shaping.isMultiline?q.maxLabelZoom:Math.log2(u/(C+z/2));A=Math.max(w,this._zoomLevel+1-(0===l?z:Math.min(A,z)));z=this._zoomLevel-A;C=this._current.shaping.bounds.width/2*2**z;this._current.shaping.isMultiline?0===l&&this._placeStraight(m,A):r&&0>z?this._placeStraightAlong(m,w):"parallel"===y?this._placeStraightAlong(m,A):"curved"===y&&this._placeCurved(m,A,C)}_placeStraight(m,l){const {out:u,id:v,
shaping:r,referenceBounds:y}=this._current,{x,y:w}=m;var A=n.getDisplayIdTexel(v);u.metricStart(new b.LabelMetric(A,m.x,m.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));u.metricBoxWrite(r.boundsT);A=(180/Math.PI*m.angle+180)%360;this._writeGlyphs(u,v,x,w,r,0,y,{clipAngle:180/Math.PI*m.angle%360,mapAligned:!0,isLineLabel:!0,minZoom:l});this._writeGlyphs(u,v,x,w,r,0,y,{clipAngle:A,mapAligned:!0,isLineLabel:!0,minZoom:l});u.metricEnd()}_placeCurved(m,
l,u){const {out:v,id:r}=this._current,y=m.clone(),x=180/Math.PI*m.angle%360,w=(180/Math.PI*m.angle+180)%360,A=n.getDisplayIdTexel(r);v.metricStart(new b.LabelMetric(A,m.x,m.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));this._placeFirst(y,l,1,x);this._placeBack(m,y,l,u,1,x);this._placeForward(m,y,l,u,1,x);this._placeFirst(y,l,0,w);this._placeBack(m,y,l,u,0,w);this._placeForward(m,y,l,u,0,w);v.metricEnd()}_placeStraightAlong(m,l){const {out:u,
id:v,shaping:r,zoomRange:y,referenceBounds:x}=this._current,{boxBorderLineColor:w,boxBackgroundColor:A}=this.evaluatedMeshParams,z=m.clone(),C=180/Math.PI*m.angle%360,D=(180/Math.PI*m.angle+180)%360;if(0<r.glyphs.length&&(w||A)){var F=Math.max(l,y[0],0);const B=Math.min(q.maxLabelZoom,y[1]);var G=p.fromRotation(h.create(),-m.angle);[,G]=r.shapeBackground(G);F={minZoom:F,maxZoom:B,clipAngle:C,mapAligned:!0,isLineLabel:!0};u.recordStart(this.instanceId,this.attributeLayout,r.glyphs[0].textureBinding);
this._writeTextBox(u,v,m.x,m.y,G,x,F);u.recordEnd();F.clipAngle=D;u.recordStart(this.instanceId,this.attributeLayout,r.glyphs[0].textureBinding);this._writeTextBox(u,v,m.x,m.y,G,x,F);u.recordEnd()}F=n.getDisplayIdTexel(v);u.metricStart(new b.LabelMetric(F,m.x,m.y,0,0,this.evaluatedMeshParams.scaleInfo?.maxScale??0,this.evaluatedMeshParams.scaleInfo?.minScale??0,null));this._placeFirst(z,l,1,C,!0);this._placeFirst(z,l,0,D,!0);u.metricEnd()}_placeBack(m,l,u,v,r,y){const x=m.clone();for(m=m.backwardLength+
0;x.prev()&&!(m>=v);)this._placeOnSegment(x,l,m,u,-1,r,y),m+=x.length+0}_placeForward(m,l,u,v,r,y){const x=m.clone();for(m=m.remainingLength+0;x.next()&&!(m>=v);)this._placeOnSegment(x,l,m,u,1,r,y),m+=x.length+0}_placeFirst(m,l,u,v,r=!1){const {out:y,id:x,shaping:w,zoomRange:A,referenceBounds:z}=this._current;var C=w.glyphs;for(const D of C)C=D.x>w.bounds.x?u:1-u,C=Math.max(0,this._zoomLevel+Math.log2(Math.abs(D.x+D.width/2-w.bounds.x)/(C*m.remainingLength+(1-C)*m.backwardLength))),C=Math.max(l,r?
0:C),D.maxZoom=Math.min(A[1],q.maxLabelZoom),D.angle=m.angle+(1-u)*Math.PI,D.minZoom=Math.max(A[0],C),this._writeLineGlyph(y,x,m.x,m.y,w.bounds,D,v,z,!0),u&&this._isVisible(D.minZoom,D.maxZoom)&&y.metricBoxWrite(D.bounds)}_placeOnSegment(m,l,u,v,r,y,x){const {out:w,id:A,shaping:z,referenceBounds:C}=this._current;var D=z.glyphs,F=m.x+m.dx/m.length*-r*u,G=m.y+m.dy/m.length*-r*u;for(const I of D)if((D=I.x>z.bounds.x?y:1-y)&&1===r||!D&&-1===r){var B=Math.abs(I.x+I.width/2-z.bounds.x);D=Math.max(0,this._zoomLevel+
Math.log2(B/u)-.1);B=Math.max(v,this._zoomLevel+Math.log2(B/(u+m.length+0)));0!==D&&(I.angle=m.angle+(1-y)*Math.PI,I.minZoom=B,I.maxZoom=D,this._writeLineGlyph(w,A,F,G,z.bounds,I,x,C,!0),y&&this._isVisible(I.minZoom,I.maxZoom)&&(D=I.bounds,D=new d(D.center[0]+(m.x-l.x),D.center[1]+(m.y-l.y),D.width,D.height),w.metricBoxWrite(D)))}}_writeLineGlyph(m,l,u,v,r,y,x,w,A){const z=u+r.x,C=v+r.y;r=2*Math.max(r.width,r.height)*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/
this._textMeshTransformProps.fontSize:1);m.recordStart(this.instanceId,this.attributeLayout,y.textureBinding);m.recordBounds(z,C,r,r);const {texcoords:D,offsets:F}=y;this._writeQuad(m,l,u,v,{texcoords:D,offsets:F,fontSize:this._textMeshTransformProps.fontSize,color:c.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:w,minZoom:Math.max(this._current.zoomRange[0],y.minZoom),maxZoom:Math.min(this._current.zoomRange[1],y.maxZoom),clipAngle:x,mapAligned:A,isLineLabel:!0});
m.recordEnd()}_isVisible(m,l){const u=this._zoomLevel;return m<=u&&u<=l}}e.LabelMeshWriter=t;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(e){e.aggregateValidFiltersMask=254;e.createDisplayId=function(g,p){return((p?8388608:0)|g)>>>0};e.displayIdTexelMask=8388607;e.displayIdTypeAggregate=1;e.displayIdTypeFeature=0;e.displayIdTypeMask=8388608;e.getDisplayIdFilterMask=g=>1===(g&8388608)>>>23?254:255;e.getDisplayIdTexel=
g=>g&8388607;e.getDisplayIdType=g=>(g&8388608)>>>23;e.isAggregateId=function(g){return 1===(g&8388608)>>>23};e.nonAggregateValidFiltersMask=255;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../../../../../symbols/cim/constants"],function(e,g){function p(c,q,f){c[0]=q[0]-f[0];c[1]=q[1]-f[1];return c}function h(c){var q=c[0];var f=c[1];q=Math.sqrt(q*q+f*f);c[0]/=q;c[1]/=q}function k(c){return c.length-
1}function n(c){let q=0;for(let f=0;f<k(c);f++)q+=d(c,f);return q}function d(c,q,f=1){let [t,m]=c[q+1];[t,m]=[Math.round(t),Math.round(m)];return Math.sqrt(t*t+m*m)*f}function b(c,q,f,t,m){if(!(f<q)){var l=t.clone().seek(f/2);null!=l&&(c(l.clone(),f,m),f=(f-q)/2,l=l.seek(q/2),b(c,q,f,t,m+1),b(c,q,f,l,m+1))}}class a{constructor(c,q,f,t,m){this._segments=c;this._index=q;this._distance=f;this._xStart=t;this._yStart=m;this._done=!1}static create(c){return new a(c,0,0,c[0][0],c[0][1])}clone(){return new a(this._segments,
this._index,this._distance,this.xStart,this.yStart)}equals(c){return this._index===c._index||c._index===this._index-1&&(0===this._distance||1===c._distance)||c._index===this._index+1&&(1===this._distance||0===c._distance)}leq(c){return this._index<c._index||this._index===c._index&&this._distance<=c._distance}geq(c){return this._index>c._index||this._index===c._index&&this._distance>=c._distance}get _segment(){return this._segments[this._index+1]}get angle(){const c=this.dy;let q=Math.acos((0*c+-1*
-this.dx)/(1*this.length));0<c&&(q=2*Math.PI-q);return q}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const {dx:c,dy:q}=this;return Math.sqrt(c*
c+q*q)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return 0<=this._index-1}hasNext(){return this._index+1<k(this._segments)}next(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this}prev(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;
this._distance=1;return this}_seekBackwards(c,q){var f=this.backwardLength;if(c<=f)return this._distance=(f-c)/this.length,this;for(f=this.backwardLength;this.prev();){if(f+this.length>c)return this._seekBackwards(c-f);f+=this.length}this._distance=0;return q?this:null}seek(c,q=!1){if(0>c)return this._seekBackwards(Math.abs(c),q);if(c<=this.remainingLength)return this._distance=(this.backwardLength+c)/this.length,this;let f=this.remainingLength;for(;this.next();){if(f+this.length>c)return this.seek(c-
f,q);f+=this.length}this._distance=1;return q?this:null}}e.SegmentCursor=a;e.pathDivide=function(c,q,f,t=!0){const m=n(c);c=a.create(c);const l=m/2;if(t){t=Math.floor(Math.max((m-q)/2,0)/q);c.seek(l-t*q);for(let u=-t;u<=t;u++)Math.abs(c.x)<g.maxTileCoordValue&&Math.abs(c.y)<g.maxTileCoordValue&&f(c.clone(),u,l+u*q,m),c.seek(q)}else c.seek(l),Math.abs(c.x)<g.maxTileCoordValue&&Math.abs(c.y)<g.maxTileCoordValue&&f(c.clone(),0,l+0*q,m)};e.pathLength=n;e.pathSubdivide=function(c,q,f){b(f,q,n(c),a.create(c),
0)};e.segmentAt=function(c,q){return c[q+1]};e.segmentCount=k;e.segmentLength=d;e.smoothPaths=function(c,q){for(let I=0;I<c.length;I++){let H=c[I];a:{var f=H,t=q;if(0>=t)break a;const K=f.length;if(3>K)break a;const O=[];var m=0;O.push(0);for(var l=1;l<K;l++){var u=f[l],v=f[l-1],r=u[0]-v[0];u=u[1]-v[1];m+=Math.sqrt(r*r+u*u);O.push(m)}t=Math.min(t,.2*m);l=[];l.push(f[0][0]);l.push(f[0][1]);m=f[K-1][0];r=f[K-1][1];u=p([0,0],f[0],f[1]);h(u);f[0][0]+=t*u[0];f[0][1]+=t*u[1];p(u,f[K-1],f[K-2]);h(u);f[K-
1][0]+=t*u[0];f[K-1][1]+=t*u[1];for(u=1;u<K;u++)O[u]+=t;O[K-1]+=t;u=.5*t;for(v=1;v<K-1;v++){let R=0,E=0,J=0;for(var y=v-1;0<=y&&!(O[y+1]<O[v]-u);y--){var x=u+O[y+1]-O[v],w=O[y+1]-O[y],A=O[v]-O[y]<u?1:x/w;if(1E-6>Math.abs(A))break;var z=A*A,C=A*x-.5*z*w,D=A*w/t,F=f[y+1],G=f[y][0]-F[0],B=f[y][1]-F[1];R+=D/C*(F[0]*A*x+.5*z*(x*G-w*F[0])-z*A*w*G/3);E+=D/C*(F[1]*A*x+.5*z*(x*B-w*F[1])-z*A*w*B/3);J+=D}for(y=v+1;y<K&&!(O[y-1]>O[v]+u);y++){x=u-O[y-1]+O[v];w=O[y]-O[y-1];A=O[y]-O[v]<u?1:x/w;if(1E-6>Math.abs(A))break;
z=A*A;C=A*x-.5*z*w;D=A*w/t;F=f[y-1];G=f[y][0]-F[0];B=f[y][1]-F[1];R+=D/C*(F[0]*A*x+.5*z*(x*G-w*F[0])-z*A*w*G/3);E+=D/C*(F[1]*A*x+.5*z*(x*B-w*F[1])-z*A*w*B/3);J+=D}l.push(R/J);l.push(E/J)}l.push(m);l.push(r);for(let R=0,E=0;R<K;R++)f[R][0]=l[E++],f[R][1]=l[E++]}f=[];f.push(H[0]);for(t=1;t<H.length;t++){const [K,O]=H[t-1],[R,E]=H[t];f.push([R-K,E-O])}H=c[I]=f}return c};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define("exports ../../../../../../../core/mathUtils ../../../../../../../core/screenUtils ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../alignmentUtils ../../../definitions ../../../mesh/templates/shapingUtils ../fill/meshWriterUtils ../mesh/loadGeometryEngine ../mesh/MeshWriter ../shaders/constants ./TextParams ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m){const l=[4,4];var u=[16,4];const v={topLeft:u,topRight:u,bottomLeft:u,bottomRight:u};u=[4,2];const r=[4,6],y={topLeft:u,topRight:u,bottomLeft:r,bottomRight:r},x={topLeft:u,topRight:r,bottomLeft:u,bottomRight:r},w={topLeft:r,topRight:r,bottomLeft:l,bottomRight:l},A={topLeft:l,topRight:l,bottomLeft:r,bottomRight:r},z={topLeft:r,topRight:l,bottomLeft:r,bottomRight:l},C={topLeft:l,topRight:r,bottomLeft:l,bottomRight:r},D={createComputedParams:G=>G,attributes:{pos:{type:m.DataType.SHORT,
count:2,pack:"position",packPrecisionFactor:10},id:{type:m.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:m.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:G,mapAligned:B})=>a.packBitset([[f.bitsetTextIsBackground,G],[f.bitsetTextIsMapAligned,!!B]])},zoomRange:{type:m.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:d.minMaxZoomPrecisionFactor,packTessellation:({minZoom:G,maxZoom:B})=>[G||0,B||28]},offset:{type:m.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,
packTessellation:({offsets:G})=>{const {bottomLeft:B,bottomRight:I,topLeft:H,topRight:K}=G;return[H,K,B,I]}}},textureUV:{type:m.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:G})=>{const {bottomLeft:B,bottomRight:I,topLeft:H,topRight:K}=G;return[H,K,B,I]}}},color:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:G})=>G},fontSize:{type:m.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:G})=>
p.pt2px(G)},referenceSize:{type:m.DataType.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:G},{referenceSize:B})=>p.pt2px(B??G)},haloColor:{type:m.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:G})=>a.processColorInput(G)},haloFontSize:{type:m.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:G})=>p.pt2px(G)},clipAngle:{type:m.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:G})=>Math.round(254/360*(G||0))},referenceSymbol:{type:m.DataType.BYTE,
count:4,packPrecisionFactor:1,packTessellation:(G,B)=>{if(!G.referenceBounds)return[0,0,0,0];const I=n.getXDirection(B.horizontalAlignment);B=n.getYDirection(B.verticalAlignment);const {offsetX:H,offsetY:K,size:O}=G.referenceBounds;return[p.pt2px(H),-p.pt2px(K),p.pt2px(O),I+1<<2|B+1]}}}};class F extends q.MeshWriter{constructor(){super(...arguments);this.vertexSpec=D;this._textMeshParamsPropsInitialized=!1}ensurePacked(G,B,I){super.ensurePacked(G,B,I);if(!this._textMeshParamsPropsInitialized||this._evaluator.hasDynamicProperties)this._textMeshTransformProps=
new t.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0}_write(G,B,I){const H=this._getShaping();if(H){var K=B.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(G,B,H,I);if(I&&I.nextPath())return I.nextPoint(),this._writeGlyphs(G,K,I.x,I.y,H,0);if("esriGeometryPolygon"===B.geometryType){B=B.readCentroidForDisplay();if(!B)return;const [O,R]=B.coords;return this._writeGlyphs(G,K,O,R,H,0)}if("esriGeometryMultipoint"===
B.geometryType)B.readGeometryForDisplay()?.forEachVertex((O,R)=>this._writeGlyphs(G,K,O,R,H,0));else return I=B.readXForDisplay(),B=B.readYForDisplay(),this._writeGlyphs(G,K,I,B,H,0)}}_writePlacedTextMarkers(G,B,I,H){if(H=H??h.GeometryCursor.fromFeatureSetReaderCIM(B))if(H=k.CIMMarkerPlacementHelper.getPlacement(H,-1,this.evaluatedMeshParams.placement,p.pt2px(1),G.id,c.getGeometryEngine())){B=B.getDisplayId();for(var K=H.next();null!=K;){const O=K.tx,R=-K.ty;K=-K.getAngle();this._writeGlyphs(G,B,
O,R,I,K);K=H.next()}}}_getShaping(){const G=this._textMeshTransformProps,B=this.evaluatedMeshParams;if(!B.glyphs?.glyphs.length)return null;const I=Math.round(p.pt2px(G.fontSize)),H=p.pt2px(G.offsetX),K=p.pt2px(G.offsetY),O=g.clamp(p.pt2px(B.lineWidth),32,512),R=d.magicLabelLineHeight*g.clamp(B.lineHeightRatio,.25,4);return b.shapeGlyphs(B.glyphs,{scale:I/d.glyphSize,angle:G.postAngle,xOffset:H,yOffset:K,horizontalAlignment:B.horizontalAlignment,verticalAlignment:B.verticalAlignment,maxLineWidth:O,
lineHeight:R,decoration:B.decoration,borderLineSizePx:p.pt2px(B.boxBorderLineSize),hasBackground:!!B.boxBackgroundColor,useCIMAngleBehavior:B.useCIMAngleBehavior})}_writeGlyphs(G,B,I,H,K,O,R,E){const J=this.evaluatedMeshParams;var Q=this._textMeshTransformProps;const N=Q.fontSize;var S=p.pt2px(Q.offsetX),W=p.pt2px(Q.offsetY);const [U,M]=a.getMinMaxZoom(J.scaleInfo,this.getTileInfo());0!==O&&K.setRotation(O);Q=K.bounds;S=I+Q.x+S;W=H+Q.y-W;Q=2*Math.max(Q.width,Q.height)*(J.minPixelBuffer?J.minPixelBuffer/
N:1);K.textBox&&(G.recordStart(this.instanceId,this.attributeLayout,K.glyphs[0].textureBinding),G.recordBounds(S,W,Q,Q),this._writeTextBox(G,B,I,H,K.textBox,R,E),G.recordEnd());for(const P of K.glyphs){G.recordStart(this.instanceId,this.attributeLayout,P.textureBinding);G.recordBounds(S,W,Q,Q);const {texcoords:T,offsets:X}=P;this._writeQuad(G,B,I,H,{texcoords:T,offsets:X,fontSize:N,color:a.processColorInput(J.color),isBackground:!1,referenceBounds:R,minZoom:U,maxZoom:M,...E});G.recordEnd()}0!==O&&
K.setRotation(-O)}_writeTextBox(G,B,I,H,K,O,R){const E=this.evaluatedMeshParams,{fontSize:J}=this._textMeshTransformProps,{boxBackgroundColor:Q,boxBorderLineColor:N}=E;O={isBackground:!0,fontSize:J,referenceBounds:O,...R};Q&&(this._writeQuad(G,B,I,H,{texcoords:v,offsets:K.main,color:a.processColorInput(Q),...O}),N||(this._writeQuad(G,B,I,H,{texcoords:w,offsets:K.top,color:a.processColorInput(Q),...O}),this._writeQuad(G,B,I,H,{texcoords:A,offsets:K.bot,color:a.processColorInput(Q),...O}),this._writeQuad(G,
B,I,H,{texcoords:z,offsets:K.left,color:a.processColorInput(Q),...O}),this._writeQuad(G,B,I,H,{texcoords:C,offsets:K.right,color:a.processColorInput(Q),...O})));N&&(this._writeQuad(G,B,I,H,{texcoords:y,offsets:K.top,color:a.processColorInput(N),...O}),this._writeQuad(G,B,I,H,{texcoords:y,offsets:K.bot,color:a.processColorInput(N),...O}),this._writeQuad(G,B,I,H,{texcoords:x,offsets:K.left,color:a.processColorInput(N),...O}),this._writeQuad(G,B,I,H,{texcoords:x,offsets:K.right,color:a.processColorInput(N),
...O}))}_writeQuad(G,B,I,H,K){const O=G.vertexCount();this._writeVertex(G,B,I,H,K);G.indexWrite(O+0);G.indexWrite(O+1);G.indexWrite(O+2);G.indexWrite(O+1);G.indexWrite(O+3);G.indexWrite(O+2)}}e.TextMeshWriter=F;e.TextVertexSpec=D;e.maxLabelZoom=28;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(e,g){class p{static getPlacement(h,k,n,d,b,a){const c=g.getPlacementOperator(n);
if(!c)return null;-1===k&&h.invertY();return c.execute(h,n,d,b,a)}}e.CIMMarkerPlacementHelper=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(e,g){class p{constructor(h){const {offsetX:k,offsetY:n,postAngle:d,fontSize:b,scaleFactor:a,transforms:c}=h;this.offsetX=k;this.offsetY=n;this.postAngle=d;this.fontSize=Math.min(b,96);(this.transforms=
c)&&1<c.infos.length&&(h=g.applyParentTransform(b,d,!1,k,n,c),this.fontSize=Math.min(h.size,96),this.postAngle=h.rotation,this.offsetX=h.offsetX,this.offsetY=h.offsetY);a&&(this.fontSize*=a,this.offsetX*=a,this.offsetY*=a)}}e.TextMeshTransformProps=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define("exports ../../../../../../../geometry/GeometryCursor ../../../definitions ../fill/meshWriterUtils ./LineMeshWriter ../shaders/constants ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d){const b={createComputedParams:c=>c,attributes:{...k.LineVertexSpec.attributes,bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:c,shouldScaleDash:q,isSDF:f})=>h.packBitset([[n.bitsetGenericConsiderAlphaOnly,c],[n.bitsetLineScaleDash,q],[n.bitsetLineIsSdf,f]])},tlbr:{type:d.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:c})=>{const {rect:q,width:f,height:t}=c;c=q.x+p.spritePadding;const m=q.y+p.spritePadding;return[c,m,c+f,m+t]}},accumulatedDistance:{type:d.DataType.UNSIGNED_SHORT,
count:1,packTessellation:({distance:c})=>c},segmentDirection:{type:d.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:c,directionY:q})=>[c,q]}}};class a extends k.LineMeshWriter{constructor(c,q,f,t){super(c,q,f,t);this.vertexSpec=b;this._tessellationOptions.textured=!0}_write(c,q,f){if(f=f??g.GeometryCursor.fromFeatureSetReaderCIM(q)){var {sprite:t}=this.evaluatedMeshParams;this._writeGeometry(c,q,f,t?.textureBinding)}}}e.TexturedLineMeshWriter=a;e.texturedLineVertexSpec=
b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define("exports ../../../../../../../core/screenUtils ../../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../../geometry/GeometryCursor ../../../../../../../symbols/cim/constants ../../../../../../../symbols/cim/enums ../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../../definitions ../fill/meshWriterUtils ./ComputedMarkerParams ./markerConstants ../mesh/loadGeometryEngine ../mesh/MeshWriter ../../../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u){function v(A,z,C,D,F=!1){const G=h.create();F=F?1:-1;A?p.fromRotation(G,F*r*A):p.identity(G);(z||C)&&p.translate(G,G,[z,-C]);D&&p.rotate(G,G,F*r*-D);return G}const r=3.14159265359/180,y=128/Math.PI,x={createComputedParams:A=>f.ComputedMarkerParams.from(A),attributes:{pos:{type:u.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:u.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:u.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:A,alignment:z,
scaleSymbolsProportionally:C,overrideOutlineColor:D,colorLocked:F})=>{let G=0;A.sdf&&(G|=q.getBitMask(t.MarkerConstants.bitset.isSDF));z===b.Alignment.MAP&&(G|=q.getBitMask(t.MarkerConstants.bitset.isMapAligned));C&&(G|=q.getBitMask(t.MarkerConstants.bitset.scaleSymbolsProportionally));D&&(G|=q.getBitMask(t.MarkerConstants.bitset.overrideOutlineColor));F&&(G|=q.getBitMask(t.MarkerConstants.bitset.colorLocked));return G}},zoomRange:{type:u.DataType.SHORT,count:2,packPrecisionFactor:c.minMaxZoomPrecisionFactor,
pack:({scaleInfo:A},{tileInfo:z})=>q.getMinMaxZoom(A,z)},offset:{type:u.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:A,computedWidth:z,computedHeight:C,anchorX:D,anchorY:F,offsetX:G,offsetY:B,rotateClockwise:I})=>{A=v(0,G,B,-A,I);D=-(.5+D)*z;I=-(.5-F)*C;F=[D,I];G=[D+z,I];B=[D,I+C];z=[D+z,I+C];k.transformMat2d(F,F,A);k.transformMat2d(G,G,A);k.transformMat2d(B,B,A);k.transformMat2d(z,z,A);return[F,G,B,z]}}},textureUV:{type:u.DataType.SHORT,count:2,packPrecisionFactor:4,
packAlternating:{count:4,pack:({texXmax:A,texXmin:z,texYmax:C,texYmin:D})=>[[z,D],[A,D],[z,C],[A,C]]}},color:{type:u.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:A})=>q.processColorInput(A)},outlineColor:{type:u.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:A})=>q.processColorInput(A)},sizing:{type:u.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:A,rawHeight:z,outlineSize:C,referenceSize:D})=>[q.packByteSqrt(Math.max(A,z),128),q.packByteSqrt(C,128),q.packByteSqrt(D,
128),0]},placementAngle:{type:u.DataType.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:A})=>{A*=y;A%=256;return Math.abs(0<=A?A:A+256)}},sizeRatio:{type:u.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:A})=>A}}};class w extends l.MeshWriter{constructor(){super(...arguments);this.vertexSpec=x}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(A,z,C){var D=this.evaluatedMeshParams.sprite?.textureBinding;const F=z.getDisplayId();A.recordStart(this.instanceId,
this.attributeLayout,D);D=this.evaluatedMeshParams.minPixelBuffer;const G=Math.max(this.evaluatedMeshParams.computedWidth,D),B=Math.max(this.evaluatedMeshParams.computedHeight,D),I=this.evaluatedMeshParams.offsetX,H=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(A,z,C,G,B);else if(C&&C.nextPath())C.nextPoint(),z=C.x,C=C.y,A.recordBounds(z+I,C+H,G,B),this._writeQuad(A,F,z,C);else if("esriGeometryPolygon"===z.geometryType){z=z.readCentroidForDisplay();
if(!z)return;const [K,O]=z.coords;A.recordBounds(K+I,O+H,G,B);this._writeQuad(A,F,K,O)}else"esriGeometryPoint"===z.geometryType?(C=z.readXForDisplay(),z=z.readYForDisplay(),A.recordBounds(C+I,z+H,G,B),this._writeQuad(A,F,C,z)):z.readGeometryForDisplay()?.forEachVertex((K,O)=>{A.recordBounds(K+I,O+H,G,B);Math.abs(K)>d.maxTileCoordValue||Math.abs(O)>d.maxTileCoordValue||this._writeQuad(A,F,K,O)});A.recordEnd()}_writePlacedMarkers(A,z,C,D,F){if(C=C??n.GeometryCursor.fromFeatureSetReaderCIM(z)?.clone())if(C=
a.CIMMarkerPlacementHelper.getPlacement(C,-1,this.evaluatedMeshParams.placement,g.pt2px(1),A.id,m.getGeometryEngine())){z=z.getDisplayId();for(var G=C.next(),B=this.evaluatedMeshParams.offsetX,I=-this.evaluatedMeshParams.offsetY;null!=G;){const H=G.tx,K=-G.ty;Math.abs(H)>d.maxTileCoordValue||Math.abs(K)>d.maxTileCoordValue?G=C.next():(G=-G.getAngle(),A.recordBounds(H+B,K+I,D,F),this._writeQuad(A,z,H,K,G),G=C.next())}}}_writeQuad(A,z,C,D,F){const G=A.vertexCount();this._writeVertex(A,z,C,D,null==F?
null:{placementAngle:F});A.indexWrite(G+0);A.indexWrite(G+1);A.indexWrite(G+2);A.indexWrite(G+1);A.indexWrite(G+3);A.indexWrite(G+2)}}e.MarkerMeshWriter=w;e.MarkerVertexSpec=x;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/enums","../../../../../../../symbols/cim/utils","../../../definitions"],function(e,
g,p,h,k){class n{static from(d){return"width"in d?this.fromSimpleMeshParams(d):this.fromComplexMeshParams(d)}static fromSimpleMeshParams(d){const b=new n(d.sprite,d.color,d.outlineColor,d.minPixelBuffer,d.placement,d.scaleInfo,d.effects),{type:a,width:c,height:q,angle:f,alignment:t,outlineSize:m,referenceSize:l,sprite:u,overrideOutlineColor:v}=d;b.rawWidth=g.pt2px(c);b.rawHeight=g.pt2px(q);b.angle=f;b.alignment=t;b.outlineSize=g.pt2px(m);b.referenceSize=g.pt2px(l);b.overrideOutlineColor=v;b.offsetX=
g.pt2px(d.offsetX);b.offsetY=g.pt2px(d.offsetY);"simple"!==a||u.sdf||(b.rawWidth=u.width,b.rawHeight=u.height);b.sizeRatio=u.sdf?2:1;b._computeSize(d,!1);return b}static fromComplexMeshParams(d){const b=new n(d.sprite,d.color,d.outlineColor,d.minPixelBuffer,d.placement,d.scaleInfo,d.effects);let {alignment:a,transforms:c,size:q,scaleX:f,anchorX:t,anchorY:m,angle:l,colorLocked:u,frameHeight:v,widthRatio:r,offsetX:y,offsetY:x,outlineSize:w,referenceSize:A,scaleFactor:z,sizeRatio:C,isAbsoluteAnchorPoint:D,
rotateClockwise:F,scaleSymbolsProportionally:G,sprite:B}=d;if(c&&0<c.infos.length){var I=h.applyParentTransform(q,l,F,y,x,c);q=I.size;l=I.rotation;y=I.offsetX;x=I.offsetY;F=!1}z&&(q*=z,y*=z,x*=z);I=B.width/B.height*f;b.alignment=a;b.rawHeight=g.pt2px(q);b.rawWidth=b.rawHeight*I;b.referenceSize=g.pt2px(A);b.sizeRatio=C;b.angle=l;b.rotateClockwise=F;b.anchorX=t;b.anchorY=m;b.offsetX=g.pt2px(y);b.offsetY=g.pt2px(x);D&&q&&(b.anchorX=B.sdf?t/(q*r):t/(q*I),b.anchorY=m/q);I=G&&v?q/v:1;b.outlineSize=0===
w||isNaN(w)?0:g.pt2px(w)*I;b.scaleSymbolsProportionally=G;b.colorLocked=u;b._computeSize(d,!0);return b}constructor(d,b,a,c,q,f,t){this.sprite=d;this.color=b;this.outlineColor=a;this.minPixelBuffer=c;this.placement=q;this.scaleInfo=f;this.effects=t;this.referenceSize=this.outlineSize=this.angle=this.rawHeight=this.rawWidth=0;this.sizeRatio=1;this.alignment=p.Alignment.SCREEN;this.colorLocked=this.overrideOutlineColor=this.scaleSymbolsProportionally=!1;this.offsetY=this.offsetX=this.texYmax=this.texXmax=
this.texYmin=this.texXmin=this.computedHeight=this.computedWidth=this.anchorY=this.anchorX=0;this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(d,b){const {sprite:a,hasSizeVV:c}=d;var q=!!a.sdf;const {rawWidth:f,rawHeight:t,sizeRatio:m,outlineSize:l}=this;d=f*m;const u=t*m;if(q&&!c){var v=l+2;this.computedWidth=Math.min((b&&f>t?d:f)+v,d);this.computedHeight=Math.min(t+v,u)}else this.computedWidth=
d,this.computedHeight=u;b=q?k.sdfTextureSize/Math.max(d,u):1;v=.5*(d-this.computedWidth)*b;var r=.5*(u-this.computedHeight)*b;b=a.rect.x+k.spritePadding+v;q=a.rect.y+k.spritePadding+r;v=b+a.width-2*v;r=q+a.height-2*r;this.texXmin=Math.floor(b);this.texYmin=Math.floor(q);this.texXmax=Math.ceil(v);this.texYmax=Math.ceil(r);this.computedWidth*=(this.texXmax-this.texXmin)/(v-b);this.computedHeight*=(this.texYmax-this.texYmin)/(r-q);this.anchorX*=d/this.computedWidth;this.anchorY*=u/this.computedHeight}}
e.ComputedMarkerParams=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(e){e.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils",
"../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,g,p,h,k){const n={createComputedParams:b=>b,attributes:{pos:{type:k.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:k.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:k.DataType.UNSIGNED_BYTE,count:1,pack:b=>0},offset:{type:k.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:b})=>{b=g.pt2px(b);const a=-b/2,c=-b/2;return[[a,c],[a+b,c],[a,c+b],[a+
b,c+b]]}}},texCoords:{type:k.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:k.DataType.UNSIGNED_BYTE,count:2,pack:({size:b})=>[b,b]},referenceSize:{type:k.DataType.UNSIGNED_BYTE,count:1,pack:({size:b})=>g.pt2px(b)},zoomRange:{type:k.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:b},{tileInfo:a})=>p.getMinMaxZoom(b,a)}}};class d extends h.MeshWriter{constructor(){super(...arguments);this.vertexSpec=n}_write(b,a){const c=a.getDisplayId();
var q=this.evaluatedMeshParams.minPixelBuffer,f=Math.max(g.pt2px(this.evaluatedMeshParams.size),q);if("esriGeometryPoint"===a.geometryType)q=a.readXForDisplay(),a=a.readYForDisplay();else{a=a.readCentroidForDisplay();if(!a)return;q=a?.coords[0];a=a?.coords[1]}b.recordStart(this.instanceId,this.attributeLayout);b.recordBounds(q,a,f,f);f=b.vertexCount();this._writeVertex(b,c,q,a);b.indexWrite(f+0);b.indexWrite(f+1);b.indexWrite(f+2);b.indexWrite(f+1);b.indexWrite(f+3);b.indexWrite(f+2);b.recordEnd()}}
e.PieChartMeshWriter=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillTechnique":function(){define(["exports","../featureTechniqueUtils","../Technique","../mesh/MeshWriterRegistry","../shaders/ComplexFillShader"],function(e,g,p,h,k){class n extends p.Technique{constructor(){super(...arguments);this.meshWriter=h.meshWriterRegistry.ComplexFillMeshWriter;this.shaders={geometry:new k.ComplexFillShader}}render(d,b){const {context:a,
painter:c}=d;c.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(d,b.target,b.instance.getInput().geometry),...g.getFeatureUniforms(d,b.target),mosaicInfo:c.textureManager.getMosaicInfo(a,b.textureKey),localTileOffset:g.getLocalTileOffset(b.target)},defines:{...g.getSelectionDefines(d)},optionalAttributes:b.instance.optionalAttributes,useComputeBuffer:g.isHittest(d)});c.setPipelineState(g.getFeaturePipelineState(d));c.submitDraw(a,b)}}e.ComplexFillTechnique=n;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillTechnique":function(){define("exports ../featureTechniqueUtils ../Technique ../line/utils ../mesh/MeshWriterRegistry ../shaders/ComplexOutlineFillShader".split(" "),function(e,g,p,h,k,n){class d extends p.Technique{constructor(){super(...arguments);this.meshWriter=k.meshWriterRegistry.ComplexOutlineFillMeshWriter;this.shaders={geometry:new n.ComplexOutlineFillShader}}render(b,a){const {context:c,
painter:q,pixelRatio:f}=b;q.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...g.getFeatureUniforms(b,a.target),antialiasingControls:h.getAntialiasingControls(f),mosaicInfo:q.textureManager.getMosaicInfo(c,a.textureKey),localTileOffset:g.getLocalTileOffset(a.target)},defines:{...g.getSelectionDefines(b)},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:g.isHittest(b)});q.setPipelineState(g.getFeaturePipelineState(b));
q.submitDraw(c,a)}}e.ComplexOutlineFillTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/utils":function(){define(["exports"],function(e){e.getAntialiasingControls=function(g){g=1/g;return{antialiasing:g,blur:0+g}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillTechnique":function(){define(["exports","../featureTechniqueUtils","../Technique",
"../mesh/MeshWriterRegistry","../shaders/FillShader"],function(e,g,p,h,k){class n extends p.Technique{constructor(){super(...arguments);this.meshWriter=h.meshWriterRegistry.FillMeshWriter;this.shaders={geometry:new k.FillShader}}render(d,b){const {context:a,painter:c}=d;c.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(d,b.target,b.instance.getInput().geometry),...g.getFeatureUniforms(d,b.target)},defines:g.getSelectionDefines(d),optionalAttributes:b.instance.optionalAttributes,
useComputeBuffer:g.isHittest(d)});c.setPipelineState(g.getFeaturePipelineState(d));c.submitDraw(a,b)}}e.FillTechnique=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillTechnique":function(){define("exports ../featureTechniqueUtils ../Technique ../line/utils ../mesh/MeshWriterRegistry ../shaders/OutlineFillShader".split(" "),function(e,g,p,h,k,n){class d extends p.Technique{constructor(){super(...arguments);this.meshWriter=
k.meshWriterRegistry.OutlineFillMeshWriter;this.shaders={geometry:new n.OutlineFillShader}}render(b,a){const {context:c,painter:q,pixelRatio:f}=b;q.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...g.getFeatureUniforms(b,a.target),antialiasingControls:h.getAntialiasingControls(f)},defines:{...g.getSelectionDefines(b)},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:g.isHittest(b)});q.setPipelineState(g.getFeaturePipelineState(b));
q.submitDraw(c,a)}}e.OutlineFillTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillTechnique":function(){define(["exports","../featureTechniqueUtils","../Technique","../mesh/MeshWriterRegistry","../shaders/PatternFillShader"],function(e,g,p,h,k){class n extends p.Technique{constructor(){super(...arguments);this.meshWriter=h.meshWriterRegistry.PatternFillMeshWriter;this.shaders={geometry:new k.PatternFillShader}}render(d,
b){const {context:a,painter:c}=d;c.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(d,b.target,b.instance.getInput().geometry),...g.getFeatureUniforms(d,b.target),mosaicInfo:c.textureManager.getMosaicInfo(a,b.textureKey),localTileOffset:g.getLocalTileOffset(b.target)},defines:{...g.getSelectionDefines(d)},optionalAttributes:b.instance.optionalAttributes,useComputeBuffer:g.isHittest(d)});c.setPipelineState(g.getFeaturePipelineState(d));c.submitDraw(a,b)}}e.PatternFillTechnique=
n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillTechnique":function(){define("exports ../featureTechniqueUtils ../Technique ../line/utils ../mesh/MeshWriterRegistry ../shaders/PatternOutlineFillShader".split(" "),function(e,g,p,h,k,n){class d extends p.Technique{constructor(){super(...arguments);this.meshWriter=k.meshWriterRegistry.PatternOutlineFillMeshWriter;this.shaders={geometry:new n.PatternOutlineFillShader}}render(b,
a){const {context:c,painter:q,pixelRatio:f}=b;q.setShader({shader:this.shaders.geometry,uniforms:{...g.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...g.getFeatureUniforms(b,a.target),antialiasingControls:h.getAntialiasingControls(f),mosaicInfo:q.textureManager.getMosaicInfo(c,a.textureKey),localTileOffset:g.getLocalTileOffset(a.target)},defines:{...g.getSelectionDefines(b)},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:g.isHittest(b)});q.setPipelineState(g.getFeaturePipelineState(b));
q.submitDraw(c,a)}}e.PatternOutlineFillTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapTechnique":function(){define("exports ../featureTechniqueUtils ../Technique ./HeatmapResources ../mesh/MeshWriterRegistry ../shaders/HeatmapAccumulateShader ../shaders/HeatmapResolveShader ../../../../../../webgl/enums".split(" "),function(e,g,p,h,k,n,d,b){function a(l){return l.key.level+1}function c(l,u){const {referenceScale:v,
radius:r}=l;return r*(0!==v?v/u.scale:1)}class q extends p.Technique{constructor(){super(...arguments);this.meshWriter=k.meshWriterRegistry.HeatmapMeshWriter;this.shaders={accumulate:new n.HeatmapAccumulateShader,resolve:new d.HeatmapResolveShader};this.postProcessingEnabled=!0;this._isBound=!1;this._resources=new Map;this.overrideStencilRef=a}shutdown(l){super.shutdown(l);this._resources.get(l)?.destroy();this._resources.delete(l);this._prevFBO=null;this._unbind()}render(l,u){const {context:v,painter:r,
state:y}=l,x=u.instance.getInput(),{isFieldActive:w}=x,A=this._getOrCreateResourcesRecord(v),z=A.loadQualityProfile(v);g.isHighlight(l)||(g.isHittest(l)||this._bind(l,A,x),r.setShader({shader:this.shaders.accumulate,uniforms:{...g.getFeatureUniforms(l,u.target),kernelControls:{radius:c(x,y),isFieldActive:w?1:0}},defines:{...g.getSelectionDefines(l),...z.defines},optionalAttributes:u.instance.optionalAttributes,useComputeBuffer:g.isHittest(l)}),l=g.isHittest(l)?t:f,r.setPipelineState(l),r.submitDraw(v,
u))}postProcess(l,u){if(!g.isHittest(l)&&!g.isHighlight(l)){var {context:v,painter:r}=l,y=this._resources.get(v);if(null!=this._prevFBO&&null!=this._prevViewport&&y?.initialized){({defines:l}=y.loadQualityProfile(v));var {minDensity:x,maxDensity:w,radius:A}=u.getInput();u=y.accumulateFramebuffer;y=y.resolveGradientTexture;r.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:u.colorTexture},minAndInvRange:[x,1/(w-x)],normalization:3/(A*A*Math.PI)},gradient:{texture:{unit:9,
texture:y}}},defines:l,optionalAttributes:{},useComputeBuffer:!1});v.bindFramebuffer(this._prevFBO);v.setViewport(0,0,this._prevViewport.width,this._prevViewport.height);v.bindTexture(u.colorTexture,8);v.bindTexture(y,9);r.setPipelineState(m);r.submitDrawQuad(v);this._unbind()}}}_getOrCreateResourcesRecord(l){let u=this._resources.get(l);null==u&&(u=new h.HeatmapResources,this._resources.set(l,u));return u}_unbind(){this._prevViewport=this._prevFBO=null;this._isBound=!1}_bind(l,u,v){if(!this._isBound){var {context:r,
state:y,pixelRatio:x}=l;l=r.getBoundFramebufferObject();var w=r.getViewport();this._prevFBO=l;this._prevViewport=w;var {gradient:A,gradientHash:z}=v;u.ensureResolveGradientTexture(r,z,A);var {width:C,height:D}=w;v=c(v,y);w=1.5<x?.25:.5;v=v<1/(2*w)?1:w;u=u.ensureAccumulateFBO(r,C*v,D*v);r.blitFramebuffer(l,u,0,0,l.width,l.height,0,0,u.width,u.height,b.ClearBufferBit.STENCIL_BUFFER_BIT,b.TextureSamplingMode.NEAREST);r.bindFramebuffer(u);r.setViewport(0,0,u.width,u.height);r.setColorMask(!0,!0,!0,!0);
r.setClearColor(0,0,0,0);r.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);this._isBound=!0}}}const f={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:a,compare:b.CompareFunction.GEQUAL,mask:255,op:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.REPLACE}}}},t={...f,stencil:!1},m={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};e.HeatmapTechnique=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapResources":function(){define("exports ../../../../../../../core/Logger ../../../../../../../core/maybe ../../../../../../webgl/enums ../../../../../../webgl/FramebufferObject ../../../../../../webgl/heatmapTextureUtils ../../../../../../webgl/RenderbufferDescriptor ../../../../../../webgl/Texture ../../../../../../webgl/TextureDescriptor".split(" "),function(e,g,p,h,k,n,d,b,a){class c{destroy(){this._accumulateFramebuffer=p.disposeMaybe(this._accumulateFramebuffer);
this._resolveGradientTexture=p.disposeMaybe(this._resolveGradientTexture);this._qualityProfile=this._prevGradientHash=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(q){null==this._qualityProfile&&(q=n.loadHeatmapTextureConfiguration(q,g.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources")),
this._qualityProfile={...q,defines:{usesHalfFloatPrecision:q.dataType!==h.PixelType.FLOAT}});return this._qualityProfile}ensureAccumulateFBO(q,f,t){if(null==this._accumulateFramebuffer){const {dataType:m,samplingMode:l,pixelFormat:u,internalFormat:v}=this.loadQualityProfile(q),r=new a.TextureDescriptor(f,t);r.pixelFormat=u;r.internalFormat=v;r.dataType=m;r.samplingMode=l;r.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;f=new d.RenderbufferDescriptor(h.RenderbufferFormat.DEPTH_STENCIL,f,t);this._accumulateFramebuffer=
new k.FramebufferObject(q,r,f)}else{const {width:m,height:l}=this._accumulateFramebuffer;m===f&&l===t||this._accumulateFramebuffer.resize(f,t)}return this._accumulateFramebuffer}ensureResolveGradientTexture(q,f,t){null==this._resolveGradientTexture?(f=new a.TextureDescriptor,f.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE,this._resolveGradientTexture=new b.Texture(q,f)):this._prevGradientHash!==f&&(this._resolveGradientTexture.resize(t.length/4,1),this._resolveGradientTexture.setData(t),this._prevGradientHash=
f);return this._resolveGradientTexture}}e.HeatmapResources=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(e,g,p){class h{constructor(k,n,d,b){this.dataType=k;this.samplingMode=n;this.pixelFormat=d;this.internalFormat=b}}e.HeatmapTextureConfiguration=h;e.loadHeatmapTextureConfiguration=function(k,n){const {textureFloat:d,colorBufferFloat:b}=k.capabilities,a=d?.textureFloatLinear,
c=b?.textureFloat,q=b?.textureHalfFloat,f=b?.floatBlend;k=k.driverTest.floatBufferBlend.result;if(!c&&!q)throw new g("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(f&&k||q))throw new g("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${k?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);
const t=!!b?.R32F,m=!!b?.R16F;if(c&&f&&k&&a)return a||n.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new h(p.PixelType.FLOAT,a?p.TextureSamplingMode.LINEAR:p.TextureSamplingMode.NEAREST,t?p.PixelFormat.RED:p.PixelFormat.RGBA,t?p.SizedPixelFormat.R32F:p.PixelFormat.RGBA);if(q)return new h(p.PixelType.HALF_FLOAT,p.TextureSamplingMode.LINEAR,m?p.PixelFormat.RED:p.PixelFormat.RGBA,m?p.SizedPixelFormat.R16F:p.PixelFormat.RGBA);throw new g("heatmap:missing-hardware-support",
"HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapAccumulateShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./heatmapUtils ./hittestUtils".split(" "),function(e,g,p,h,k,n,d){class b extends k.FeatureVertexInput{}g.__decorate([p.location(5,
h.Vec2)],b.prototype,"offset",void 0);class a extends k.FeatureFragmentInput{}class c extends p.UniformGroup{}g.__decorate([p.uniform(h.Float)],c.prototype,"radius",void 0);g.__decorate([p.uniform(h.Float)],c.prototype,"isFieldActive",void 0);class q extends k.AFeatureShader{constructor(){super(...arguments);this.usesHalfFloatPrecision=!1}vertex(f){const {radius:t,isFieldActive:m}=this.kernelControls,l=f.offset,u=m.multiply(this.storage.getVVData(f.id).x).add((new h.Float(1)).subtract(m)),v=this.view.displayViewScreenMat3.multiply(new h.Vec3(f.pos,
1)).add(this.view.displayViewMat3.multiply(new h.Vec3(l,0)).multiply(t)),r=this.clip(f.id);return{glPosition:new h.Vec4(v.xy,r,1),offset:l,fieldValue:u,color:new h.Vec4(0),...this.maybeRunHittest(f,{},null)}}fragment(f){const {offset:t,fieldValue:m}=f;var l=h.length(t),u=h.step(l,new h.Float(1));l=(new h.Float(1)).subtract(l.multiply(l));l=l.multiply(l);u=u.multiply(l).multiply(m).multiply(new h.Float(n.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new h.Vec4(u),
f)}hittest(f){const {viewMat3:t,tileMat3:m}=this.view;f=t.multiply(m).multiply(new h.Vec3(f.pos,1));return d.hittestMarker(f.xy,this.kernelControls.radius,this.hittestRequest.position)}}g.__decorate([p.define],q.prototype,"usesHalfFloatPrecision",void 0);g.__decorate([p.uniform(c)],q.prototype,"kernelControls",void 0);g.__decorate([g.__param(0,p.input(b))],q.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(a))],q.prototype,"fragment",null);e.HeatmapAccumulateFragmentInput=a;e.HeatmapAccumulateShader=
q;e.HeatmapAccumulateVertexInput=b;e.KernelControls=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/heatmapUtils":function(){define(["exports"],function(e){e.getHeatmapCompressionFactor=function(g){return g?.25:1};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapResolveShader":function(){define(["exports","../../../../../../../chunks/tslib.es6",
"../../GraphShaderModule","../../graph/glsl","./heatmapUtils"],function(e,g,p,h,k){class n extends p.VertexInput{}g.__decorate([p.location(0,h.Vec2)],n.prototype,"pos",void 0);class d extends p.FragmentInput{}class b extends p.UniformGroup{}g.__decorate([p.uniform(h.Sampler2D)],b.prototype,"texture",void 0);g.__decorate([p.uniform(h.Vec2)],b.prototype,"minAndInvRange",void 0);g.__decorate([p.uniform(h.Float)],b.prototype,"normalization",void 0);class a extends p.UniformGroup{}g.__decorate([p.uniform(h.Sampler2D)],
a.prototype,"texture",void 0);class c extends p.GraphShaderModule{constructor(){super(...arguments);this.usesHalfFloatPrecision=!1}vertex(q){return{glPosition:new h.Vec4(q.pos.multiply(2).subtract(1),1,1),uv:q.pos}}fragment(q){const {accumulatedDensity:f,gradient:t}=this;q=h.texture2D(f.texture,q.uv).r.multiply(new h.Float(k.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));q=q.multiply(f.normalization);q=q.subtract(f.minAndInvRange.x).multiply(f.minAndInvRange.y);q=h.texture2D(t.texture,
new h.Vec2(q,.5));const m=new p.FragmentOutput;m.glFragColor=new h.Vec4(q.rgb.multiply(q.a),q.a);return m}}g.__decorate([p.define],c.prototype,"usesHalfFloatPrecision",void 0);g.__decorate([p.uniform(b)],c.prototype,"accumulatedDensity",void 0);g.__decorate([p.uniform(a)],c.prototype,"gradient",void 0);g.__decorate([g.__param(0,p.input(n))],c.prototype,"vertex",null);g.__decorate([g.__param(0,p.input(d))],c.prototype,"fragment",null);e.AccumulatedDensity=b;e.Gradient=a;e.HeatmapResolveFragmentInput=
d;e.HeatmapResolveShader=c;e.HeatmapResolveVertexInput=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ../mesh/MeshWriterRegistry ../text/TextShader".split(" "),function(e,g,p,h,k,n){class d extends h.Technique{constructor(){super(...arguments);this.meshWriter=k.meshWriterRegistry.LabelMeshWriter;this.shaders={geometry:new n.TextShader};
this.drawPhase=g.WGLDrawPhase.LABEL|g.WGLDrawPhase.LABEL_ALPHA;this.symbologyPlane=g.FeatureSymbologyDrawOrder.TEXT}render(b,a){const {context:c,painter:q}=b,f=p.getSelectionDefines(b),t={...p.getFeaturePipelineState(b)};b={shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...p.getFeatureUniforms(b,a.target),mosaicInfo:q.textureManager.getMosaicInfo(c,a.textureKey)},defines:{...f,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:a.instance.optionalAttributes,
useComputeBuffer:!1};q.setShader(b);q.setPipelineState(t);q.submitDraw(c,a);q.setShader({...b,defines:{...f,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}});q.setPipelineState(t);q.submitDraw(c,a);q.setShader({...b,defines:{...f,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}});q.setPipelineState(t);q.submitDraw(c,a)}}e.LabelTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../definitions ../../GraphShaderModule ../../graph/glsl ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r){const y=360/254;class x extends n.FeatureVertexInput{}g.__decorate([h.location(3,k.Vec4)],x.prototype,"color",void 0);g.__decorate([h.location(4,k.Vec2)],x.prototype,"offset",void 0);g.__decorate([h.location(5,k.Vec2)],x.prototype,"textureUV",void 0);g.__decorate([h.location(6,k.Float)],x.prototype,"fontSize",void 0);g.__decorate([h.location(7,k.Float)],x.prototype,"referenceSize",void 0);g.__decorate([h.location(8,k.Float)],x.prototype,"haloFontSize",
void 0);g.__decorate([h.location(9,k.Vec4)],x.prototype,"haloColor",void 0);g.__decorate([h.location(10,k.Vec2)],x.prototype,"zoomRange",void 0);g.__decorate([h.location(11,k.Float)],x.prototype,"clipAngle",void 0);g.__decorate([h.location(12,k.Vec4)],x.prototype,"referenceSymbol",void 0);class w extends h.ComputeVertexInput{}g.__decorate([h.location(13,k.Vec2)],w.prototype,"offsetNextVertex1",void 0);g.__decorate([h.location(14,k.Vec2)],w.prototype,"offsetNextVertex2",void 0);class A extends n.FeatureFragmentInput{}
class z extends n.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]};this.isLabel=this.isBackgroundPass=this.isHaloPass=!1}clipLabel(C,D,F){D=D.multiply(y);D=k.abs(this.view.rotation.subtract(D));var G=k.min((new k.Float(360)).subtract(D),D);D=new k.Float(0);const B=k.floor(this.view.currentZoom.multiply(p.minMaxZoomPrecisionFactor)).divide(p.minMaxZoomPrecisionFactor);var I=C.x;C=C.y;I=(new k.Float(1)).subtract(k.step(I,B)).multiply(2);
G=k.step(new k.Float(90),G).multiply(2);C=(new k.Float(2)).multiply((new k.Float(1)).subtract(k.step(B,C)));D=D.add(F.multiply(I));D=D.add(F.multiply(G));return D=D.add(C)}vertex(C,D){var F=c.getBit(C.bitset,d.bitsetTextIsBackground),G=(new k.Float(1)).subtract(F),B=C.fontSize;let I=B.divide(d.sdfFontSize);var H=this.isHaloPass?C.haloColor:this._getVertexColor(C);H=this.isLabel?H.multiply(this.storage.getAnimationValue(C.id)):H;var K=this.view.displayViewScreenMat3.multiply(new k.Vec3(C.pos,1)),O=
C.offset;let R=new k.Float(1),E=k.Mat3.identity();if(this.isLabel){if(!C.referenceSymbol)throw Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");var J=C.referenceSymbol,Q=J.xy,N=J.z;J=this._unpackDirection(J.w);N=r.getVisualVariableSize(this,C.id,N).divide(2);N=J.multiply(N.add(p.labelPlacementOffsetPadding));O=O.add(Q).add(N)}else R=r.getVisualVariableSize(this,C.id,C.referenceSize).divide(C.referenceSize),B=B.multiply(R),I=I.multiply(R),O=O.multiply(R),E=r.getVisualVariableRotation(this,
C.id),O=E.multiply(new k.Vec3(O,0)).xy;Q=c.getBit(C.bitset,d.bitsetTextIsMapAligned);O=this._getViewRotationMatrix(Q).multiply(new k.Vec3(O,0));Q=this.isLabel?this.clipLabel(C.zoomRange,C.clipAngle,Q):this.clip(C.id,C.zoomRange);Q=this.isBackgroundPass?Q.add(G.multiply(2)):Q.add(F.multiply(2));F=new k.Vec4(K.xy.add(O.xy),Q,1);G=C.textureUV.divide(this.mosaicInfo.size);K=new k.Float(0);this.isHaloPass&&(K=C.haloFontSize.divide(I).divide(d.maxSdfDistance));B=(new k.Float(.105*d.sdfFontSize)).divide(B).divide(this.view.pixelRatio);
return{glPosition:F,color:H,size:I,textureUV:G,antialiasingWidth:B,haloDistanceOffset:K,...this.maybeRunHittest(C,D,{vvSizeAdjustment:R,vvRotation:E})}}_getViewRotationMatrix(C){const D=this.view.displayViewMat3,F=this.view.displayMat3,G=(new k.Float(1)).subtract(C);return D.multiply(C).add(F.multiply(G))}fragment(C){var D=new k.Float(.25),F=(new k.Float(1)).subtract(D);D=k.texture2D(this.mosaicInfo.texture,C.textureUV).a;F=F.subtract(C.haloDistanceOffset);this.highlight&&(F=F.divide(2));const G=
C.antialiasingWidth;D=k.smoothstep(F.subtract(G),F.add(G),D);return this.getFragmentOutput(C.color.multiply(D),C)}hittest(C,D,{vvSizeAdjustment:F,vvRotation:G}){var B=G.multiply(new k.Vec3(C.offset.multiply(F),0)),I=G.multiply(new k.Vec3(D.offsetNextVertex1.multiply(F),0));D=G.multiply(new k.Vec3(D.offsetNextVertex2.multiply(F),0));const {viewMat3:H,tileMat3:K}=this.view;C=H.multiply(K).multiply(new k.Vec3(C.pos,1));B=C.add(K.multiply(B)).xy;I=C.add(K.multiply(I)).xy;C=C.add(K.multiply(D)).xy;return b.distPointTriangle(this.hittestRequest.position,
B.xy,I.xy,C.xy)}_unpackDirection(C){var D=new k.Int(C);C=k.bitRShift(D,new k.Int(2));D=k.bitAnd(D,new k.Int(3));return new k.Vec2((new k.Float(C)).subtract(1),(new k.Float(D)).subtract(1))}_getVertexColor(C){var D=C.color;this.visualVariableColor&&(D=this.storage.getColorValue(C.id),D=this.visualVariableColor.getColor(D,C.color,new k.Bool(!1)));this.visualVariableOpacity&&(C=this.storage.getOpacityValue(C.id),C=this.visualVariableOpacity.getOpacity(C),D=D.multiply(C));return D}}g.__decorate([h.option(q.VisualVariableColor)],
z.prototype,"visualVariableColor",void 0);g.__decorate([h.option(f.VisualVariableOpacity)],z.prototype,"visualVariableOpacity",void 0);g.__decorate([h.option(t.VisualVariableRotation)],z.prototype,"visualVariableRotation",void 0);g.__decorate([h.option(m.VisualVariableSizeMinMaxValue)],z.prototype,"visualVariableSizeMinMaxValue",void 0);g.__decorate([h.option(l.VisualVariableSizeScaleStops)],z.prototype,"visualVariableSizeScaleStops",void 0);g.__decorate([h.option(u.VisualVariableSizeStops)],z.prototype,
"visualVariableSizeStops",void 0);g.__decorate([h.option(v.VisualVariableSizeUnitValue)],z.prototype,"visualVariableSizeUnitValue",void 0);g.__decorate([h.uniform(a.MosaicInfo)],z.prototype,"mosaicInfo",void 0);g.__decorate([h.define],z.prototype,"isHaloPass",void 0);g.__decorate([h.define],z.prototype,"isBackgroundPass",void 0);g.__decorate([h.define],z.prototype,"isLabel",void 0);g.__decorate([g.__param(0,h.input(x)),g.__param(1,h.input(w))],z.prototype,"vertex",null);g.__decorate([g.__param(0,
h.input(A))],z.prototype,"fragment",null);e.TextFragmentInput=A;e.TextShader=z;e.TextVertexInput=x;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableRotation":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./constants ./utils".split(" "),function(e,g,p,h,k,n){class d extends p.UniformGroup{getVVRotationMat4(b){return h.ifElse(n.isNan(b),h.Mat4.identity(),
()=>{var a=this._getNormalizedAngle(b).multiply(k.cDegToRad);const c=h.sin(a);a=h.cos(a);return new h.Mat4(a,c,0,0,c.multiply(new h.Float(-1)),a,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(b){return h.ifElse(n.isNan(b),h.Mat3.identity(),()=>{var a=this._getNormalizedAngle(b).multiply(k.cDegToRad);const c=h.sin(a);a=h.cos(a);return new h.Mat3(a,c,0,c.multiply(new h.Float(-1)),a,0,0,0,1)})}_getNormalizedAngle(b){const a=h.equal(this.rotationType,new h.Float(k.RotationType.Arithmatic));return h.ifElse(a,
(new h.Float(90)).subtract(b),b)}}g.__decorate([p.uniform(h.Float)],d.prototype,"rotationType",void 0);e.VisualVariableRotation=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ./utils ../mesh/MeshWriterRegistry ../shaders/LineShader".split(" "),function(e,g,p,h,k,n,d){class b extends h.Technique{constructor(){super(...arguments);this.meshWriter=
n.meshWriterRegistry.LineMeshWriter;this.shaders={geometry:new d.LineShader};this.symbologyPlane=g.FeatureSymbologyDrawOrder.LINE}render(a,c){const {context:q,painter:f,pixelRatio:t}=a;f.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(a,c.target,c.instance.getInput().geometry),...p.getFeatureUniforms(a,c.target),antialiasingControls:k.getAntialiasingControls(t)},defines:{...p.getSelectionDefines(a)},optionalAttributes:c.instance.optionalAttributes,useComputeBuffer:p.isHittest(a)});
f.setPipelineState(p.getFeaturePipelineState(a));f.submitDraw(q,c)}}e.LineTechnique=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ./utils ../mesh/MeshWriterRegistry ../shaders/TexturedLineShader".split(" "),function(e,g,p,h,k,n,d){class b extends h.Technique{constructor(){super(...arguments);this.meshWriter=n.meshWriterRegistry.TexturedLineMeshWriter;
this.shaders={geometry:new d.TexturedLineShader};this.symbologyPlane=g.FeatureSymbologyDrawOrder.LINE}render(a,c){const {context:q,painter:f,pixelRatio:t}=a;f.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(a,c.target,c.instance.getInput().geometry),...p.getFeatureUniforms(a,c.target),antialiasingControls:k.getAntialiasingControls(t),mosaicInfo:f.textureManager.getMosaicInfo(q,c.textureKey)},defines:{...p.getSelectionDefines(a)},optionalAttributes:c.instance.optionalAttributes,
useComputeBuffer:p.isHittest(a)});f.setPipelineState(p.getFeaturePipelineState(a));f.submitDraw(q,c)}}e.TexturedLineTechnique=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/TexturedLineShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../../../../../../symbols/cim/constants ../../GraphShaderModule ../../graph/glsl ./AFeatureShader ./constants ./LineShader ./MosaicInfo ./utils".split(" "),function(e,
g,p,h,k,n,d,b,a,c){class q extends b.LineVertexInput{}g.__decorate([h.location(9,k.Float)],q.prototype,"accumulatedDistance",void 0);g.__decorate([h.location(10,k.Vec2)],q.prototype,"segmentDirection",void 0);g.__decorate([h.location(11,k.Vec4)],q.prototype,"tlbr",void 0);class f extends b.LineFragmentInput{}class t extends b.LineShader{_getLineWidthRatio(m,l){const u=new k.Float(p.dashRadius);m=c.getBit(m.bitset,d.bitsetLineScaleDash);return m.multiply(k.max(l,new k.Float(.25))).add((new k.Float(1)).subtract(m)).divide(u)}_getSDFAlpha(m){const {halfWidth:l,
normal:u,tlbr:v,patternSize:r,accumulatedDistance:y,lineWidthRatio:x}=m;m=r.x.multiply(new k.Float(2)).multiply(x);m=k.fract(y.divide(m));const w=(new k.Float(.25)).multiply(u.y).add(new k.Float(.5));m=k.mix(v.xy,v.zw,new k.Vec2(m,w));m=c.rgba2float(k.texture2D(this.mosaicInfo.texture,m)).subtract(new k.Float(.5)).multiply(l);m=k.clamp((new k.Float(.5)).subtract(m),new k.Float(0),new k.Float(1));return new k.Vec4(m)}_getPatternColor(m){const {halfWidth:l,normal:u,color:v,accumulatedDistance:r,patternSize:y,
sampleAlphaOnly:x,tlbr:w}=m;m=y.y.multiply((new k.Float(2)).multiply(l).divide(y.x));m=k.fract(r.divide(m));const A=(new k.Float(.5)).multiply(u.y).add(new k.Float(.5));m=k.mix(w.xy,w.zw,new k.Vec2(A,m));m=k.texture2D(this.mosaicInfo.texture,m);null!=this.visualVariableColor&&(m=k.ifElse(k.greaterThan(x,new k.Float(.5)),new k.Vec4(v.a),v));return m}vertex(m,l){const {segmentDirection:u,tlbr:v,bitset:r}=m,y=b.getLineVertexData(this,m),x=m.accumulatedDistance.divide(this.view.displayZoomFactor).add(k.dot(u,
y.scaledOffset)),w=new k.Vec2(v.z.subtract(v.x),v.w.subtract(v.y)),A=v.divide(this.mosaicInfo.size.xyxy),z=c.getBit(r,d.bitsetLineIsSdf),C=c.getBit(r,d.bitsetGenericConsiderAlphaOnly),D=k.ifElse(k.greaterThan(z,new k.Float(.5)),this._getLineWidthRatio(m,y.scaledHalfWidth),new k.Float(1));return{...y,tlbr:A,patternSize:w,accumulatedDistance:x,isSDF:z,sampleAlphaOnly:C,lineWidthRatio:D,...this.maybeRunHittest(m,l,y.halfWidth)}}fragment(m){const {color:l,opacity:u,isSDF:v}=m;var r=b.getLineAntialiasing(m,
this.antialiasingControls.blur);const y=k.ifElse(k.greaterThan(v,new k.Float(.5)),this._getSDFAlpha(m),this._getPatternColor(m));r=l.multiply(u).multiply(r).multiply(y);return this.getFragmentOutput(r,m)}}g.__decorate([h.uniform(a.MosaicInfo)],t.prototype,"mosaicInfo",void 0);g.__decorate([g.__param(0,h.input(q)),g.__param(1,h.input(n.BaseHittestVertexInput))],t.prototype,"vertex",null);e.TexturedLineFragmentInput=f;e.TexturedLineShader=t;e.TexturedLineVertexInput=q;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ./MarkerShader ../mesh/MeshWriterRegistry".split(" "),function(e,g,p,h,k,n){class d extends h.Technique{constructor(){super(...arguments);this.meshWriter=n.meshWriterRegistry.MarkerMeshWriter;this.shaders={geometry:new k.MarkerShader};this.symbologyPlane=g.FeatureSymbologyDrawOrder.MARKER}render(b,a){const {context:c,painter:q}=
b;q.setShader({shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...p.getFeatureUniforms(b,a.target),mosaicInfo:q.textureManager.getMosaicInfo(c,a.textureKey,!0)},defines:{...p.getSelectionDefines(b)},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:p.isHittest(b)});q.setPipelineState(p.getFeaturePipelineState(b));q.submitDraw(c,a)}}e.MarkerTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerShader":function(){define("exports ../../../../../../../chunks/tslib.es6 ../../GraphShaderModule ../../graph/glsl ./markerConstants ../shaders/AFeatureShader ../shaders/constants ../shaders/hittestUtils ../shaders/MosaicInfo ../shaders/utils ../shaders/VisualVariableColor ../shaders/VisualVariableOpacity ../shaders/VisualVariableRotation ../shaders/VisualVariableSizeMinMaxValue ../shaders/VisualVariableSizeScaleStops ../shaders/VisualVariableSizeStops ../shaders/VisualVariableSizeUnitValue ../shaders/vvUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r){function y(D,F,G,B){return F.multiply(D.x).add(G.multiply(D.y)).add(B.multiply(D.z))}function x(D){return D.multiply(D).divide(128)}class w extends n.FeatureVertexInput{}g.__decorate([p.location(3,h.Vec4)],w.prototype,"color",void 0);g.__decorate([p.location(4,h.Vec4)],w.prototype,"outlineColor",void 0);g.__decorate([p.location(5,h.Vec2)],w.prototype,"offset",void 0);g.__decorate([p.location(6,h.Vec2)],w.prototype,"textureUV",void 0);g.__decorate([p.location(7,
h.Vec4)],w.prototype,"sizing",void 0);g.__decorate([p.location(8,h.Float)],w.prototype,"placementAngle",void 0);g.__decorate([p.location(9,h.Float)],w.prototype,"sizeRatio",void 0);g.__decorate([p.location(10,h.Vec2)],w.prototype,"zoomRange",void 0);class A extends p.ComputeVertexInput{}g.__decorate([p.location(12,h.Vec2)],A.prototype,"offsetNextVertex1",void 0);g.__decorate([p.location(13,h.Vec2)],A.prototype,"offsetNextVertex2",void 0);g.__decorate([p.location(14,h.Vec2)],A.prototype,"textureUVNextVertex1",
void 0);g.__decorate([p.location(15,h.Vec2)],A.prototype,"textureUVNextVertex2",void 0);class z extends n.FeatureFragmentInput{}class C extends n.AFeatureShader{constructor(){super(...arguments);this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(D,F){var G=x(D.sizing.x),B=x(D.sizing.y),I=x(D.sizing.z),H=D.placementAngle;const K=c.getBit(D.bitset,k.MarkerConstants.bitset.isSDF),O=c.getBit(D.bitset,k.MarkerConstants.bitset.isMapAligned);
var R=c.getBit(D.bitset,k.MarkerConstants.bitset.scaleSymbolsProportionally),E=c.getBitBool(D.bitset,k.MarkerConstants.bitset.colorLocked),J=r.getVisualVariableOpacity(this,D.id);E=r.getVisualVariableColor(this,D.id,D.color,E).multiply(J);J=this.view.displayViewScreenMat3.multiply(new h.Vec3(D.pos.xy,1));I=r.getVisualVariableSize(this,D.id,I).divide(I);G=G.multiply(I);var Q=D.offset.xy.multiply(I);R=B.multiply(R.multiply(I.subtract(1)).add(1));R=h.min(R,h.max(G.subtract(.99),new h.Float(0)));B=h.max(R,
new h.Float(1));R=h.min(R,new h.Float(1));H=h.Mat3.fromRotation(H.multiply(d.c256ToRad));var N=r.getVisualVariableRotation(this,D.id);H=this._getViewRotationMatrix(O).multiply(N).multiply(H).multiply(new h.Vec3(Q.xy,0));Q=this.clip(D.id,D.zoomRange);J=new h.Vec4(J.xy.add(H.xy),Q,1);H=D.textureUV.divide(this.mosaicInfo.size);R=D.outlineColor.multiply(R);Q=c.getBit(D.bitset,k.MarkerConstants.bitset.overrideOutlineColor);N=D.sizeRatio.multiply(G).multiply(.5);return{glPosition:J,color:E,textureUV:H,
outlineColor:R,outlineSize:B,distanceToPx:N,isSDF:K,overrideOutlineColor:Q,...this.maybeRunHittest(D,F,{pos:D.pos,size:G,sizeCorrection:I,isMapAligned:O,outlineSize:B,distanceToPx:N,isSDF:K})}}fragment(D){const F=this._getColor(D.textureUV,D);return this.getFragmentOutput(F,D)}hittest(D,F,G){return h.ifElse(h.lessThan(G.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(D,F,G),this._hittestMarker(D,F,G))}_getViewRotationMatrix(D){const F=this.view.displayViewMat3,G=this.view.displayMat3,
B=(new h.Float(1)).subtract(D);return F.multiply(D).add(G.multiply(B))}_getViewScreenMatrix(D){const F=this.view.viewMat3.multiply(this.view.tileMat3),G=this.view.tileMat3,B=(new h.Float(1)).subtract(D);return F.multiply(D).add(G.multiply(B))}_getColor(D,F){return h.ifElse(h.equal(F.isSDF,new h.Float(1)),this._getSDFColor(D,F),this._getSpriteColor(D,F))}_getSpriteColor(D,F){return h.texture2D(this.mosaicInfo.texture,D).multiply(F.color)}_getSDFColor(D,F){D=h.texture2D(this.mosaicInfo.texture,D);var G=
(new h.Float(.5)).subtract(c.rgba2float(D)).multiply(F.distanceToPx).multiply(d.softEdgeRatio);D=h.clamp((new h.Float(.5)).subtract(G),new h.Float(0),new h.Float(1));D=F.color.multiply(D);var B=F.outlineSize;this.highlight&&(B=h.max(B,F.overrideOutlineColor.multiply(4)));B=B.multiply(.5);G=h.abs(G).subtract(B);G=h.clamp((new h.Float(.5)).subtract(G),new h.Float(0),new h.Float(1));F=h.mix(F.outlineColor,F.color,F.overrideOutlineColor).multiply(G);return(new h.Float(1)).subtract(F.a).multiply(D).add(F)}_hittestSmallMarker(D,
F,G){const {position:B,distance:I,smallSymbolDistance:H}=this.hittestRequest;D=I.subtract(H);const {viewMat3:K,tileMat3:O}=this.view;F=K.multiply(O).multiply(new h.Vec3(G.pos,1)).xy;G=G.size.multiply(.5);return h.distance(F,B).subtract(G).add(D)}_hittestMarker(D,F,G){const {pos:B,sizeCorrection:I,isMapAligned:H,outlineSize:K,isSDF:O,distanceToPx:R}=G;var E=new h.Vec3(D.offset.multiply(I),0),J=new h.Vec3(F.offsetNextVertex1.multiply(I),0);G=new h.Vec3(F.offsetNextVertex2.multiply(I),0);const {viewMat3:Q,
tileMat3:N}=this.view;var S=Q.multiply(N).multiply(new h.Vec3(B,1)),W=this._getViewScreenMatrix(H),U=S.add(W.multiply(E)).xy,M=S.add(W.multiply(J)).xy,P=S.add(W.multiply(G)).xy,T=this.hittestRequest.position;const X=this.hittestRequest.distance;G=b.xyToBarycentric(T.add(new h.Vec2(h.negate(X),h.negate(X))),U,M,P);S=b.xyToBarycentric(T.add(new h.Vec2(0,h.negate(X))),U,M,P);W=b.xyToBarycentric(T.add(new h.Vec2(X,h.negate(X))),U,M,P);J=b.xyToBarycentric(T.add(new h.Vec2(h.negate(X),0)),U,M,P);E=b.xyToBarycentric(T,
U,M,P);const Y=b.xyToBarycentric(T.add(new h.Vec2(X,0)),U,M,P),Z=b.xyToBarycentric(T.add(new h.Vec2(h.negate(X),X)),U,M,P),ba=b.xyToBarycentric(T.add(new h.Vec2(0,X)),U,M,P);U=b.xyToBarycentric(T.add(new h.Vec2(X,X)),U,M,P);D=D.textureUV.divide(this.mosaicInfo.size);M=F.textureUVNextVertex1.divide(this.mosaicInfo.size);F=F.textureUVNextVertex2.divide(this.mosaicInfo.size);P={color:new h.Vec4(1),outlineColor:new h.Vec4(1),overrideOutlineColor:new h.Float(1),outlineSize:K,distanceToPx:R,isSDF:O};T=
new h.Float(0);T=T.add(b.inTriangle(G).multiply(this._getColor(y(G,D,M,F),P).a));T=T.add(b.inTriangle(S).multiply(this._getColor(y(S,D,M,F),P).a));T=T.add(b.inTriangle(W).multiply(this._getColor(y(W,D,M,F),P).a));T=T.add(b.inTriangle(J).multiply(this._getColor(y(J,D,M,F),P).a));T=T.add(b.inTriangle(E).multiply(this._getColor(y(E,D,M,F),P).a));T=T.add(b.inTriangle(Y).multiply(this._getColor(y(Y,D,M,F),P).a));T=T.add(b.inTriangle(Z).multiply(this._getColor(y(Z,D,M,F),P).a));T=T.add(b.inTriangle(ba).multiply(this._getColor(y(ba,
D,M,F),P).a));T=T.add(b.inTriangle(U).multiply(this._getColor(y(U,D,M,F),P).a));return h.step(T,new h.Float(.05)).multiply(b.failHittest(this.hittestRequest))}}g.__decorate([p.option(q.VisualVariableColor)],C.prototype,"visualVariableColor",void 0);g.__decorate([p.option(f.VisualVariableOpacity)],C.prototype,"visualVariableOpacity",void 0);g.__decorate([p.option(t.VisualVariableRotation)],C.prototype,"visualVariableRotation",void 0);g.__decorate([p.option(m.VisualVariableSizeMinMaxValue)],C.prototype,
"visualVariableSizeMinMaxValue",void 0);g.__decorate([p.option(l.VisualVariableSizeScaleStops)],C.prototype,"visualVariableSizeScaleStops",void 0);g.__decorate([p.option(u.VisualVariableSizeStops)],C.prototype,"visualVariableSizeStops",void 0);g.__decorate([p.option(v.VisualVariableSizeUnitValue)],C.prototype,"visualVariableSizeUnitValue",void 0);g.__decorate([p.uniform(a.MosaicInfo)],C.prototype,"mosaicInfo",void 0);g.__decorate([g.__param(0,p.input(w)),g.__param(1,p.input(A))],C.prototype,"vertex",
null);g.__decorate([g.__param(0,p.input(z))],C.prototype,"fragment",null);e.MarkerFragmentInput=z;e.MarkerShader=C;e.MarkerVertexInput=w;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ../mesh/MeshWriterRegistry ./PieChartShader".split(" "),function(e,g,p,h,k,n){class d extends h.Technique{constructor(){super(...arguments);this.meshWriter=
k.meshWriterRegistry.PieChartMeshWriter;this.shaders={geometry:new n.PieChartShader};this.symbologyPlane=g.FeatureSymbologyDrawOrder.MARKER}render(b,a){const {context:c,painter:q}=b,{instance:f,target:t}=a,m=this.shaders.geometry,l=f.getInput(),u=l.numberOfFields,v=p.isHittest(b),r=p.getFeatureUniforms(b,t),y=p.getSelectionDefines(b);m.setNumberOfFields(u);q.setShader({shader:m,uniforms:{...p.resolveDynamicUniforms(b,a.target,l.geometry),...r.storage,...r.view,hittestUniforms:r.hittestRequest?{hittestDist:r.hittestRequest?.distance,
hittestPos:r.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!l.geometry.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!l.geometry.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!l.geometry.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!l.geometry.visualVariableSizeUnitValue,VV_OPACITY:!!l.geometry.visualVariableOpacity,HITTEST:v,highlight:r.highlight?1:0,...y,numberOfFields:u},optionalAttributes:{},useComputeBuffer:v});q.setPipelineState(p.getFeaturePipelineState(b));q.submitDraw(c,
a)}}e.PieChartTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartShader":function(){define(["exports","../../GLSLShaderModule","../../graph/glsl","../../../shaders/sources/resolver"],function(e,g,p,h){const k={hittestDist:p.Float,hittestPos:p.Vec2},n={filterFlags:p.Sampler2D,animation:p.Sampler2D,visualVariableData:p.Sampler2D,dataDriven0:p.Sampler2D,dataDriven1:p.Sampler2D,dataDriven2:p.Sampler2D,gpgpu:p.Sampler2D,
size:p.Float},d={displayViewScreenMat3:p.Mat3,displayViewMat3:p.Mat3,displayMat3:p.Mat3,viewMat3:p.Mat3,tileMat3:p.Mat3,displayZoomFactor:p.Float,requiredZoomFactor:p.Float,tileOffset:p.Vec2,currentScale:p.Float,currentZoom:p.Float,metersPerSRUnit:p.Float};class b extends g.GLSLShaderModule{constructor(){super(...arguments);this.vertexShader=h.resolveIncludes("materials/pie/pie.vert");this.fragmentShader=h.resolveIncludes("materials/pie/pie.frag");this.required={...n,...d,outlineWidth:p.Float,colors:p.FixedArray,
defaultColor:p.Vec4,othersColor:p.Vec4,outlineColor:p.Vec4,donutRatio:p.Float,sectorThreshold:p.Float};this.options={hittestUniforms:k,visualVariableSizeMinMaxValue:{minMaxValueAndSize:p.Vec4},visualVariableSizeScaleStops:{sizes:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},values:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8}},visualVariableSizeStops:{sizes:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},values:{...p.FixedArray.ofType(p.Float,
8),type:"array",elementType:p.Float,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:p.Float},visualVariableOpacity:{opacities:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8},opacityValues:{...p.FixedArray.ofType(p.Float,8),type:"array",elementType:p.Float,size:8}}};this.locations={pos:{index:0,type:p.Vec2},id:{index:1,type:p.Vec3},bitset:{index:2,type:p.Float},offset:{index:3,type:p.Vec2},texCoords:{index:4,type:p.Vec2},size:{index:5,type:p.Vec2},referenceSize:{index:6,
type:p.Float},zoomRange:{index:7,type:p.Vec2}};this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(a){this.required.colors={...p.FixedArray.ofType(p.Vec4,a),type:"array",elementType:p.Vec4,size:a}}}e.PieChartShader=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/webgl/shaderGraph/GLSLShaderModule":function(){define(["exports","../../../../../core/string","./typed/TypedShaderProgram"],function(e,g,p){class h{constructor(){this.computeAttributes={}}get locationsMap(){const k=new Map;for(const n in this.locations)k.set(n,this.locations[n].index);return k}get optionPropertyKeys(){this._optionPropertyKeys||(this._optionPropertyKeys=new Set(Object.keys(this.options)));return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const k=
this.locationsMap,n=Array.from(k.entries()).map(([d,b])=>`${d}.${b}`).join(".");this._locationInfo={hash:g.numericHash(n),locations:k}}return this._locationInfo}get renamedLocationsMap(){const k=new Map;for(const [n,d]of this.locationsMap.entries())k.set("a_"+n,d);return k}getShaderKey(k,n,d){const b=Object.keys(d).filter(a=>d[a]).map(a=>`${a}_${d[a].toString()}`).join(".");n=Object.keys(n).filter(a=>this.optionPropertyKeys.has(a)).join(".");return`${k.hash}.${b}.${n}`}getProgram(k,n,d,b){b=k="";
for(const a in d)if(d[a]){const c="boolean"===typeof d[a]?`#define ${a}\n`:`#define ${a} ${d[a]}\n`;k+=c;b+=c}k+=this.vertexShader;b+=this.fragmentShader;return new p.TypedShaderProgram(k,b,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(n),this._transformFeedbackBindings)}_getUniformBindings(k){const n=[];for(var d in this.required){var b=this.required[d];n.push({uniformHydrated:null,shaderModulePath:d,uniformName:d,uniformType:b.type,uniformArrayElementType:"array"===b.type?
b.elementType?.type:void 0,uniformArrayLength:"array"===b.type?b.size:void 0})}for(const a in k)if(d=this.options[a],k[a])for(const c in d)b=d[c],n.push({uniformHydrated:null,shaderModulePath:`${a}.${c}`,uniformName:c,uniformType:b.type,uniformArrayElementType:"array"===b.type?b.elementType?.type:void 0,uniformArrayLength:"array"===b.type?b.size:void 0});return n}}e.GLSLShaderModule=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextTechnique":function(){define("exports ../../../enums ../featureTechniqueUtils ../Technique ../mesh/MeshWriterRegistry ./TextShader".split(" "),
function(e,g,p,h,k,n){class d extends h.Technique{constructor(){super(...arguments);this.meshWriter=k.meshWriterRegistry.TextMeshWriter;this.shaders={geometry:new n.TextShader};this.symbologyPlane=g.FeatureSymbologyDrawOrder.TEXT}render(b,a){const {context:c,painter:q}=b,f=p.getSelectionDefines(b),t={shader:this.shaders.geometry,uniforms:{...p.resolveDynamicUniforms(b,a.target,a.instance.getInput().geometry),...p.getFeatureUniforms(b,a.target),mosaicInfo:q.textureManager.getMosaicInfo(c,a.textureKey)},
defines:{...f,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:a.instance.optionalAttributes,useComputeBuffer:p.isHittest(b)};q.setShader(t);q.setPipelineState(p.getFeaturePipelineState(b));q.submitDraw(c,a);q.setShader({...t,defines:{...f,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}});q.submitDraw(c,a);q.setShader({...t,defines:{...f,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}});q.submitDraw(c,a)}}e.TextTechnique=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){function u(r,y,x,w){y?w!==y&&r.bindBuffer(x,y.glName):r.bindBuffer(x,null);return y}function v(r,y){switch(r){case d.PrimitiveType.POINTS:return 2*y;case d.PrimitiveType.TRIANGLES:return y/
3;case d.PrimitiveType.TRIANGLE_STRIP:return y-2;case d.PrimitiveType.TRIANGLE_FAN:return y-2;default:return 0}}e.RenderingContext=class{constructor(r,y){this.gl=r;this.instanceCounter=new b.InstanceCounter;this.programCache=new c.ProgramCache(this);this._transformFeedbackRequestInfo=null;this._state=new n.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this._loadExtensions();this.configure(y)}configure(r){this._capabilities=new l.Capabilities(this.gl,r);this._parameters=new a.Parameters(this.gl,
this._capabilities,r);f.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new n.ContextState;this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]};this._stateTracker=new q.StateTracker({setBlending:y=>{y?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(y.opRgb,y.opAlpha),this.setBlendFunctionSeparate(y.srcRgb,y.dstRgb,y.srcAlpha,y.dstAlpha),y=y.color,this.setBlendColor(y.r,y.g,y.b,y.a)):this.setBlendingEnabled(!1)},
setCulling:y=>{y?(this.setFaceCullingEnabled(!0),this.setCullFace(y.face),this.setFrontFace(y.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:y=>{y?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(y.factor,y.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:y=>{y?(this.setDepthTestEnabled(!0),this.setDepthFunction(y.func)):this.setDepthTestEnabled(!1)},setStencilTest:y=>{if(y){this.setStencilTestEnabled(!0);const x=y.function;this.setStencilFunction(x.func,x.ref,x.mask);
y=y.operation;this.setStencilOp(y.fail,y.zFail,y.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:y=>{y?(this.setDepthWriteEnabled(!0),this.setDepthRange(y.zNear,y.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:y=>{y?this.setColorMask(y.r,y.g,y.b,y.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:y=>{y?this.setStencilWriteMask(y.mask):this.setStencilWriteMask(0)},setDrawBuffers:y=>{const {gl:x}=this;y?x.drawBuffers(y.buffers):({drawFramebuffer:y}=this._state,null===y||0===y.colorAttachments.length?
x.drawBuffers([d.SpecialDrawBuffers.BACK]):x.drawBuffers([d.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();g.disposeMaybe(this._driverTest);this._driverTest=new m.WebGLDriverTest(this)}dispose(){g.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);
this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;k.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(r){this._stateTracker.setPipeline(r)}setBlendingEnabled(r){this._state.blend!==
r&&(!0===r?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=r,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(r,y){for(let x=0;x<r.length;++x)this._state.textureUnitMap[r[x]]=null;0<=y&&(this._state.activeTexture=y)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null);this._state.vertexArrayObject=null;this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=
null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(r,y,x,w){if(r!==this._state.blendColor.r||y!==this._state.blendColor.g||x!==this._state.blendColor.b||w!==this._state.blendColor.a)this.gl.blendColor(r,y,x,w),this._state.blendColor.r=r,this._state.blendColor.g=y,this._state.blendColor.b=x,this._state.blendColor.a=w,this._stateTracker.invalidateBlending()}setBlendFunction(r,y){if(r!==this._state.blendFunction.srcRGB||y!==this._state.blendFunction.dstRGB)this.gl.blendFunc(r,
y),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(r,y,x,w){if(this._state.blendFunction.srcRGB!==r||this._state.blendFunction.srcAlpha!==x||this._state.blendFunction.dstRGB!==y||this._state.blendFunction.dstAlpha!==w)this.gl.blendFuncSeparate(r,y,x,w),this._state.blendFunction.srcRGB=r,this._state.blendFunction.srcAlpha=x,this._state.blendFunction.dstRGB=
y,this._state.blendFunction.dstAlpha=w,this._stateTracker.invalidateBlending()}setBlendEquation(r){this._state.blendEquation.mode!==r&&(this.gl.blendEquation(r),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(r,y){if(this._state.blendEquation.mode!==r||this._state.blendEquation.modeAlpha!==y)this.gl.blendEquationSeparate(r,y),this._state.blendEquation.mode=r,this._state.blendEquation.modeAlpha=y,this._stateTracker.invalidateBlending()}setColorMask(r,
y,x,w){if(this._state.colorMask.r!==r||this._state.colorMask.g!==y||this._state.colorMask.b!==x||this._state.colorMask.a!==w)this.gl.colorMask(r,y,x,w),this._state.colorMask.r=r,this._state.colorMask.g=y,this._state.colorMask.b=x,this._state.colorMask.a=w,this._stateTracker.invalidateColorWrite()}setClearColor(r,y,x,w){if(this._state.clearColor.r!==r||this._state.clearColor.g!==y||this._state.clearColor.b!==x||this._state.clearColor.a!==w)this.gl.clearColor(r,y,x,w),this._state.clearColor.r=r,this._state.clearColor.g=
y,this._state.clearColor.b=x,this._state.clearColor.a=w}setFaceCullingEnabled(r){this._state.faceCulling!==r&&(!0===r?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=r,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(r){this._state.polygonOffsetFill!==r&&(!0===r?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=r,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(r,
y){if(this._state.polygonOffset[0]!==r||this._state.polygonOffset[1]!==y)this._state.polygonOffset[0]=r,this._state.polygonOffset[1]=y,this.gl.polygonOffset(r,y),this._stateTracker.invalidatePolygonOffset()}setCullFace(r){this._state.cullFace!==r&&(this.gl.cullFace(r),this._state.cullFace=r,this._stateTracker.invalidateCulling())}setFrontFace(r){this._state.frontFace!==r&&(this.gl.frontFace(r),this._state.frontFace=r,this._stateTracker.invalidateCulling())}setScissorTestEnabled(r){this._state.scissorTest!==
r&&(!0===r?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=r)}setScissorRect(r,y,x,w){if(this._state.scissorRect.x!==r||this._state.scissorRect.y!==y||this._state.scissorRect.width!==x||this._state.scissorRect.height!==w)this.gl.scissor(r,y,x,w),this._state.scissorRect.x=r,this._state.scissorRect.y=y,this._state.scissorRect.width=x,this._state.scissorRect.height=w}setDepthTestEnabled(r){this._state.depthTest!==r&&(!0===r?this.gl.enable(this.gl.DEPTH_TEST):
this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=r,this._stateTracker.invalidateDepthTest())}setClearDepth(r){this._state.clearDepth!==r&&(this.gl.clearDepth(r),this._state.clearDepth=r)}setDepthFunction(r){this._state.depthFunction!==r&&(this.gl.depthFunc(r),this._state.depthFunction=r,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(r){this._state.depthWrite!==r&&(this.gl.depthMask(r),this._state.depthWrite=r,this._stateTracker.invalidateDepthWrite())}setDepthRange(r,y){if(this._state.depthRange.zNear!==
r||this._state.depthRange.zFar!==y)this.gl.depthRange(r,y),this._state.depthRange.zNear=r,this._state.depthRange.zFar=y,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(r){this._state.stencilTest!==r&&(!0===r?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=r,this._stateTracker.invalidateStencilTest())}setClearStencil(r){r!==this._state.clearStencil&&(this.gl.clearStencil(r),this._state.clearStencil=r)}setStencilFunction(r,y,x){if(this._state.stencilFunction.func!==
r||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==x)this.gl.stencilFunc(r,y,x),this._state.stencilFunction.face=d.Face.FRONT_AND_BACK,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=x,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(r,y,x,w){if(this._state.stencilFunction.face!==r||this._state.stencilFunction.func!==y||this._state.stencilFunction.ref!==x||this._state.stencilFunction.mask!==w)this.gl.stencilFuncSeparate(r,
y,x,w),this._state.stencilFunction.face=r,this._state.stencilFunction.func=y,this._state.stencilFunction.ref=x,this._state.stencilFunction.mask=w,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(r){this._state.stencilWriteMask!==r&&(this.gl.stencilMask(r),this._state.stencilWriteMask=r,this._stateTracker.invalidateStencilWrite())}setStencilOp(r,y,x){if(this._state.stencilOperation.face!==d.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==r||this._state.stencilOperation.zFail!==
y||this._state.stencilOperation.zPass!==x)this.gl.stencilOp(r,y,x),this._state.stencilOperation.face=d.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=x,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(r,y,x,w){if(this._state.stencilOperation.face!==r||this._state.stencilOperation.fail!==y||this._state.stencilOperation.zFail!==x||this._state.stencilOperation.zPass!==w)this.gl.stencilOpSeparate(r,y,x,w),
this._state.stencilOperation.face=r,this._state.stencilOperation.fail=y,this._state.stencilOperation.zFail=x,this._state.stencilOperation.zPass=w,this._stateTracker.invalidateStencilTest()}setActiveTexture(r,y=!1){const x=this._state.activeTexture;0<=r&&(y||r!==this._state.activeTexture)&&(this.gl.activeTexture(d.baseTextureUnit+r),this._state.activeTexture=r);return x}clear(r){r&&this.gl.clear(r)}clearSafe(r,y=255){r&&(r&d.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),r&d.ClearBufferBit.DEPTH_BUFFER_BIT&&
this.setDepthWriteEnabled(!0),r&d.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(y),this.gl.clear(r))}clearFramebuffer(r,y=!1,x=!1){let w=0;r&&(this.setClearColor(r[0],r[1],r[2],Math.max(1E-13,r[3])),w|=d.ClearBufferBit.COLOR_BUFFER_BIT);y&&(w|=d.ClearBufferBit.DEPTH_BUFFER_BIT);!1===x?x=0:(!0===x&&(x=255),w|=d.ClearBufferBit.STENCIL_BUFFER_BIT);w&&this.clearSafe(w,x)}drawArrays(r,y,x){if(this._transformFeedbackRequestInfo){if(r!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");
if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(k.webglDebugEnabled()){this._numOfDrawCalls++;this._numOfTriangles+=v(r,x);const w=this._state.textureUnitMap;for(let A=0;A<w.length;A++){const z=w[A];if(null!=z&&z===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${A}`);}}this.gl.drawArrays(r,y,x);
k.checkWebGLError(this.gl)}drawArraysInstanced(r,y,x,w){this.gl.drawArraysInstanced(r,y,x,w);k.checkWebGLError(this.gl)}drawElements(r,y,x,w){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");k.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=v(r,y));this.gl.drawElements(r,y,x,w);if(k.webglDebugEnabled()){const A=t.getErrorString(this);if(A){const z=this.getBoundVAO(),C=z?.indexBuffer,D=C?.size??0,F=w+y;console.error(`drawElements: ${A}${D<
F?`. Buffer is too small. Attempted to draw index ${F} of ${D}`:""}`,{args:{mode:r,count:y,type:x,offset:w},vao:{indexBuffer:C,vertexBuffers:z?.vertexBuffers}})}}}logInfo(){k.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){k.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(r,y,x,w){x=Math.max(Math.round(x),1);w=Math.max(Math.round(w),1);const A=this._state.viewport;
if(A.x!==r||A.y!==y||A.width!==x||A.height!==w)A.x=r,A.y=y,A.width=x,A.height=w,this.gl.viewport(r,y,x,w)}setViewport4fv(r){this.setViewport(r[0],r[1],r[2],r[3])}restoreViewport({x:r,y,width:x,height:w}){this.setViewport(r,y,x,w)}getViewport(){const r=this._state.viewport;return{x:r.x,y:r.y,width:r.width,height:r.height}}useProgram(r){this._state.program!==r&&(this._state.program?.stop(),this._state.program=r,this.gl.useProgram(r?.glName??null))}bindTexture(r,y,x=!1){(y>=this.parameters.maxTextureImageUnits||
0>y)&&console.error("Input texture unit is out of range of available units!");const w=this._state.textureUnitMap[y];if(null==r?.glName)return null!=w&&(this.setActiveTexture(y,x),this.gl.bindTexture(w.descriptor.target,null)),this._state.textureUnitMap[y]=null,w;if(!x&&w===r)return r.isDirty&&(this.setActiveTexture(y,x),r.applyChanges()),w;this.setActiveTexture(y,x);this.gl.bindTexture(r.descriptor.target,r.glName);r.applyChanges();this._state.textureUnitMap[y]=r;return w}unbindTexture(r){if(null!=
r)for(let y=0;y<this.parameters.maxTextureImageUnits;y++)this._state.textureUnitMap[y]===r&&(this.bindTexture(null,y),this._state.textureUnitMap[y]=null)}bindFramebuffer(r,y=!1){if(y||this._state.readFramebuffer!==r||this._state.drawFramebuffer!==r)this._stateTracker.invalidateDrawBuffers(),null==r?(this.gl.bindFramebuffer(d.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=null):(r.initializeAndBind(d.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=
r,this._state.drawFramebuffer=r)}bindFramebufferSeparate(r,y,x=!1){const w=y===d.FramebufferTarget.READ_FRAMEBUFFER,A=w?this._state.readFramebuffer:this._state.drawFramebuffer;if(x||A!==r)null==r?this.gl.bindFramebuffer(y,null):r.initializeAndBind(y),w?this._state.readFramebuffer=r??null:this._state.drawFramebuffer=r??null}blitFramebuffer(r,y,x=0,w=0,A=r.width,z=r.height,C=0,D=0,F=y.width,G=y.height,B=d.ClearBufferBit.COLOR_BUFFER_BIT,I=d.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(r,
d.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(y,d.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(x,w,A,z,C,D,F,G,B,I)}bindBuffer(r,y){if(r)switch(y??=r.bufferType,y){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=u(this.gl,r,y,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=u(this.gl,r,y,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=u(this.gl,r,y,this._state.uniformBuffer);
break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=u(this.gl,r,y,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=u(this.gl,r,y,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=u(this.gl,r,y,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=u(this.gl,r,y,this._state.copyWriteBuffer);break;case d.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=
u(this.gl,r,y,this._state.transformFeedbackBuffer)}}bindRenderbuffer(r){const y=this.gl;r||(y.bindRenderbuffer(y.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==r&&(y.bindRenderbuffer(y.RENDERBUFFER,r.glName),this._state.renderbuffer=r)}_getBufferBinding(r,y){if(y>=this.parameters.maxUniformBufferBindings||0>y)return console.error("Uniform buffer binding point is out of range!"),null;r=r===d.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;
let x=r[y];null==x&&(x={buffer:null,offset:0,size:0},r[y]=x);return x}bindBufferBase(r,y,x){const w=this._getBufferBinding(r,y);null==w||w.buffer===x&&0===w.offset&&0===w.size||(this.gl.bindBufferBase(r,y,x?x.glName:null),w.buffer=x,w.offset=0,w.size=0)}bindBufferRange(r,y,x,w,A){const z=this._getBufferBinding(r,y);null==z||z.buffer===x&&z.offset===w&&z.size===A||(0!==w%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):
(this.gl.bindBufferRange(r,y,x.glName,w,A),z.buffer=x,z.offset=w,z.size=A))}bindUBO(r,y,x,w){null==y?this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,r,null):(k.webglDebugEnabled()&&(w??y.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),y.initialize(),void 0!==x&&void 0!==w?this.bindBufferRange(d.BufferType.UNIFORM_BUFFER,r,y.buffer,x,w):this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,r,y.buffer))}unbindUBO(r){for(let y=
0,x=this._state.uniformBufferBindingPoints.length;y<x;y++){const w=this._state.uniformBufferBindingPoints[y];null!=w&&w.buffer===r.buffer&&this.bindBufferBase(d.BufferType.UNIFORM_BUFFER,y,null)}}unbindBuffer(r){switch(r){case d.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=u(this.gl,null,r,this._state.vertexBuffer);break;case d.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=u(this.gl,null,r,this._state.indexBuffer);break;case d.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=u(this.gl,
null,r,this._state.uniformBuffer);break;case d.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=u(this.gl,null,r,this._state.pixelPackBuffer);break;case d.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=u(this.gl,null,r,this._state.pixelUnpackBuffer);break;case d.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=u(this.gl,null,r,this._state.copyReadBuffer);break;case d.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=u(this.gl,null,r,this._state.copyWriteBuffer)}}bindVAO(r=
null){null==r?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==r&&(r.bind(),this._state.vertexArrayObject=r)}bindTransformFeedback(r){const {gl:y}=this;y.bindTransformFeedback(y.TRANSFORM_FEEDBACK,r.glName)}beginTransformFeedback(r,y){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:x}=this;x.bindTransformFeedback(x.TRANSFORM_FEEDBACK,r.glName);x.beginTransformFeedback(y);
this._transformFeedbackRequestInfo={primitiveType:y}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:r}=this;r.endTransformFeedback();r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=null}async clientWaitAsync(r=h.Milliseconds(10)){const {gl:y}=this,x=y.fenceSync(d.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!x)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(d.ResourceType.Sync,
x);y.flush();let w;do await p.after(r),w=y.clientWaitSync(x,0,0);while(w===d.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(d.ResourceType.Sync,x);y.deleteSync(x);if(w===d.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(r=d.FramebufferTarget.FRAMEBUFFER){return r===d.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);
this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(d.BufferType.ARRAY_BUFFER);this.unbindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(d.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(d.BufferType.COPY_READ_BUFFER);this.unbindBuffer(d.BufferType.COPY_WRITE_BUFFER);for(let r=0;r<this.parameters.maxTextureImageUnits;++r)this.bindTexture(null,
r);this.setBlendingEnabled(!1);this.setBlendFunction(d.BlendFactor.ONE,d.BlendFactor.ZERO);this.setBlendEquation(d.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(d.Face.BACK);this.setFrontFace(d.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(d.CompareFunction.LESS);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(d.CompareFunction.ALWAYS,0,0);this.setStencilOp(d.StencilOperation.KEEP,d.StencilOperation.KEEP,d.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const {gl:r}=this;r.bindVertexArray(null);for(var y=0;y<this.parameters.maxVertexAttributes;y++)r.disableVertexAttribArray(y);
this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(d.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(d.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(d.BufferType.UNIFORM_BUFFER,null);for(y=0;y<this._parameters.maxUniformBufferBindings;y++){var x=
this._state.uniformBufferBindingPoints[y];if(null!=x){const {buffer:w,offset:A,size:z}=x;null!==w?0===A&&0===z?r.bindBufferBase(d.BufferType.UNIFORM_BUFFER,y,w.glName):r.bindBufferRange(d.BufferType.UNIFORM_BUFFER,y,w.glName,A,z):r.bindBufferBase(d.BufferType.UNIFORM_BUFFER,y,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(d.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):r.bindBuffer(d.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(d.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(d.BufferType.COPY_WRITE_BUFFER,null);r.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,null);r.readBuffer(r.BACK);this._state.readFramebuffer&&
(r.bindFramebuffer(d.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(d.ColorAttachment.COLOR_ATTACHMENT0));r.bindFramebuffer(d.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(this._state.vertexArrayObject){if(y=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(y)}r.useProgram(this._state.program?.glName??null);r.blendColor(this._state.blendColor.r,this._state.blendColor.g,
this._state.blendColor.b,this._state.blendColor.a);r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?.glName??null);!0===this._state.blend?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND);r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);r.clearColor(this._state.clearColor.r,this._state.clearColor.g,
this._state.clearColor.b,this._state.clearColor.a);r.clearDepth(this._state.clearDepth);r.clearStencil(this._state.clearStencil);r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);r.cullFace(this._state.cullFace);r.depthFunc(this._state.depthFunction);r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);r.depthMask(this._state.depthWrite);r.frontFace(this._state.frontFace);
r.lineWidth(1);!0===this._state.faceCulling?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE);r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL);r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST);r.stencilFunc(this._state.stencilFunction.func,
this._state.stencilFunction.ref,this._state.stencilFunction.mask);r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST);r.stencilMask(this._state.stencilWriteMask);for(y=0;y<this.parameters.maxTextureImageUnits;y++)r.activeTexture(d.baseTextureUnit+y),r.bindTexture(d.TextureType.TEXTURE_2D,null),r.bindTexture(d.TextureType.TEXTURE_CUBE_MAP,
null),r.bindTexture(d.TextureType.TEXTURE_3D,null),r.bindTexture(d.TextureType.TEXTURE_2D_ARRAY,null),x=this._state.textureUnitMap[y],null!=x&&r.bindTexture(x.descriptor.target,x.glName);r.activeTexture(d.baseTextureUnit+this._state.activeTexture);y=this._state.viewport;r.viewport(y.x,y.y,y.width,y.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports",
"./enums"],function(e,g){class p{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:g.BlendFactor.ONE,dstRGB:g.BlendFactor.ZERO,srcAlpha:g.BlendFactor.ONE,dstAlpha:g.BlendFactor.ZERO};this.blendEquation={mode:g.BlendOperation.ADD,modeAlpha:g.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=g.Face.BACK;this.frontFace=g.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=
g.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:g.Face.FRONT_AND_BACK,func:g.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:g.Face.FRONT_AND_BACK,fail:g.StencilOperation.KEEP,zFail:g.StencilOperation.KEEP,zPass:g.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=
this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}e.ContextState=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"./AllocationTracer","./enums"],function(e,g,p){const h={RECORD_ALLOCATIONS:!1};class k{constructor(){this._current=[];for(this._allocations=h.RECORD_ALLOCATIONS?new g.AllocationTracer("WebGLObject"):null;this._current.length<p.ResourceType.COUNT;)this._current.push(0)}increment(n,d,b=1){this._current[n]+=b;this._allocations?.add(d)}decrement(n,d,b=1){this._current[n]-=b;this._allocations?.remove(d)}get current(){return this._current}get total(){return this.current.reduce((n,d,b)=>n+(b<p.ResourceType.UNCOUNTED?
d:0),0)}get resourceInformation(){let n="";if(0<this.total){n+="Live objects:\n";for(let d=0;d<p.ResourceType.COUNT;++d){const b=this._current[d];0<b&&(n+=`${p.ResourceType[d]}: ${b}\n`)}}return n+=this._allocations?.resetLog()}}e.InstanceCounter=k;e.test=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(e){class g{constructor(p){this._objectType=p;this._active=new Map}add(p){const h=Error().stack.split("\n");
h.shift();h.shift();this._active.set(p,h.join("\n"))}remove(p){this._active.delete(p)}resetLog(){const p=new Map;this._active.forEach((n,{usedMemory:d})=>{p.has(n)||p.set(n,new Map);n=p.get(n);n.set(d??0,n.get(d??0)??1)});this._active.clear();let h=0;const k=[];p.forEach((n,d)=>{let b=0;n.forEach((a,c)=>b+=a*c);n.set(-1,b);h+=b;k.push([d,n])});p.clear();k.sort((n,d)=>d[1].get(-1)-n[1].get(-1));return k.reduce((n,[d,b])=>{const a=Math.round(b.get(-1)/1024);b.delete(-1);b=Array.from(b.values()).reduce((c,
q)=>c+q,0);return n+=`  ${a}KB from ${b} allocations at ${d}\n`},`Total unestimated ${this._objectType} memory: ${Math.round(h/1024)}KB\n`)}}e.AllocationTracer=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(e){class g{constructor(p,h,k){h=h.textureFilterAnisotropic;k=k.maxAnisotropy??Infinity;this.versionString=p.getParameter(p.VERSION);this.maxVertexTextureImageUnits=p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=p.getParameter(p.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=h?Math.min(p.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY),k):1;this.maxTextureImageUnits=p.getParameter(p.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=p.getParameter(p.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=p.getParameter(p.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=p.getParameter(p.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=p.getParameter(p.MAX_VERTEX_UNIFORM_BLOCKS);
this.maxFragmentUniformBlocks=p.getParameter(p.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=p.getParameter(p.MAX_UNIFORM_BLOCK_SIZE);this.uniformBufferOffsetAlignment=p.getParameter(p.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=p.getParameter(p.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=p.getParameter(p.MAX_SAMPLES)}}e.Parameters=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces",
"./enums"],function(e,g,p){function h(N){return F.intern(N)}function k(N){return G.intern(N)}function n(N){return B.intern(N)}function d(N){return I.intern(N)}function b(N){return H.intern(N)}function a(N){return K.intern(N)}function c(N){return O.intern(N)}function q(N){return R.intern(N)}function f(N){return E.intern(N)}function t(N){return"["+N.join(",")+"]"}function m(N){return N?t([N.srcRgb,N.srcAlpha,N.dstRgb,N.dstAlpha,N.opRgb,N.opAlpha,N.color.r,N.color.g,N.color.b,N.color.a]):null}function l(N){return N?
t([N.face,N.mode]):null}function u(N){return N?t([N.factor,N.units]):null}function v(N){return N?t([N.func]):null}function r(N){return N?t([N.function.func,N.function.ref,N.function.mask,N.operation.fail,N.operation.zFail,N.operation.zPass]):null}function y(N){return N?t([N.zNear,N.zFar]):null}function x(N){return N?t([N.r,N.g,N.b,N.a]):null}function w(N){return N?t([N.mask]):null}function A(N){return N?t(N.buffers):null}const z={face:p.Face.BACK,mode:p.CullMode.CCW},C={face:p.Face.FRONT,mode:p.CullMode.CCW};
class D{constructor(N,S){this._makeKey=N;this._makeRef=S;this._interns=new Map}intern(N){if(!N)return null;const S=this._makeKey(N),W=this._interns;W.has(S)||W.set(S,this._makeRef(N));return W.get(S)??null}}const F=new D(m,N=>({__tag:"Blending",...N})),G=new D(l,N=>({__tag:"Culling",...N})),B=new D(u,N=>({__tag:"PolygonOffset",...N})),I=new D(v,N=>({__tag:"DepthTest",...N})),H=new D(r,N=>({__tag:"StencilTest",...N})),K=new D(y,N=>({__tag:"DepthWrite",...N})),O=new D(x,N=>({__tag:"ColorWrite",...N})),
R=new D(w,N=>({__tag:"StencilWrite",...N})),E=new D(A,N=>({__tag:"DrawBuffers",...N})),J=new D(function(N){return N?t([m(N.blending),l(N.culling),u(N.polygonOffset),v(N.depthTest),r(N.stencilTest),y(N.depthWrite),x(N.colorWrite),w(N.stencilWrite),A(N.drawBuffers)]):null},N=>({blending:h(N.blending),culling:k(N.culling),polygonOffset:n(N.polygonOffset),depthTest:d(N.depthTest),stencilTest:b(N.stencilTest),depthWrite:a(N.depthWrite),colorWrite:c(N.colorWrite),stencilWrite:q(N.stencilWrite),drawBuffers:f(N.drawBuffers)}));
class Q{constructor(N){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=N}setPipeline(N){if(this._pipelineInvalid||N!==this._pipeline)this._setBlending(N.blending),this._setCulling(N.culling),this._setPolygonOffset(N.polygonOffset),this._setDepthTest(N.depthTest),this._setStencilTest(N.stencilTest),
this._setDepthWrite(N.depthWrite),this._setColorWrite(N.colorWrite),this._setStencilWrite(N.stencilWrite),this._setDrawBuffers(N.drawBuffers),this._pipeline=N;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=
this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(N){this._blending=this._setSubState(N,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1}_setCulling(N){this._culling=this._setSubState(N,
this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(N){this._polygonOffset=this._setSubState(N,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(N){this._depthTest=this._setSubState(N,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(N){this._stencilTest=this._setSubState(N,this._stencilTest,this._stencilTestInvalid,
this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(N){this._depthWrite=this._setSubState(N,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(N){this._colorWrite=this._setSubState(N,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(N){this._stencilWrite=this._setSubState(N,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);
this._stencilTestInvalid=!1}_setDrawBuffers(N){this._drawBuffers=this._setSubState(N,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(N,S,W,U){if(W||N!==S)U(N),this._pipelineInvalid=!0;return N}}e.StateTracker=Q;e.backFaceCullingParams=z;e.cullingParams=N=>N===g.CullFaceOptions.Back?z:N===g.CullFaceOptions.Front?C:null;e.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};e.defaultDepthWriteParams={zNear:0,zFar:1};e.frontFaceCullingParams=
C;e.makeBlending=h;e.makeColorWrite=c;e.makeCulling=k;e.makeDepthTest=d;e.makeDepthWrite=a;e.makeDrawBuffers=f;e.makePipelineState=function(N){return J.intern(N)};e.makePolygonOffset=n;e.makeStencilTest=b;e.makeStencilWrite=q;e.separateBlendingParams=function(N,S,W,U,M=p.BlendOperation.ADD,P=p.BlendOperation.ADD,T=[0,0,0,0]){return{srcRgb:N,srcAlpha:S,dstRgb:W,dstAlpha:U,opRgb:M,opAlpha:P,color:{r:T[0],g:T[1],b:T[2],a:T[3]}}};e.simpleBlendingParams=function(N,S,W=p.BlendOperation.ADD,U=[0,0,0,0]){return{srcRgb:N,
srcAlpha:N,dstRgb:S,dstAlpha:S,opRgb:W,opAlpha:W,color:{r:U[0],g:U[1],b:U[2],a:U[3]}}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(e){e.CullFaceOptions=void 0;(function(g){g[g.None=0]="None";g[g.Front=1]="Front";g[g.Back=2]="Back";g[g.COUNT=3]="COUNT"})(e.CullFaceOptions||(e.CullFaceOptions={}));e.DepthTestFunction=void 0;(function(g){g[g.Less=0]="Less";g[g.Lequal=1]="Lequal";g[g.COUNT=2]="COUNT"})(e.DepthTestFunction||
(e.DepthTestFunction={}));e.RenderRequestType=void 0;(function(g){g[g.BACKGROUND=0]="BACKGROUND";g[g.UPDATE=1]="UPDATE"})(e.RenderRequestType||(e.RenderRequestType={}));e.ResourceState=void 0;(function(g){g[g.NOT_LOADED=0]="NOT_LOADED";g[g.LOADING=1]="LOADING";g[g.LOADED=2]="LOADED"})(e.ResourceState||(e.ResourceState={}));e.StencilBits=void 0;(function(g){g[g.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";g[g.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(e.StencilBits||(e.StencilBits=
{}));e.Object3DState=void 0;(function(g){g[g.Highlight=0]="Highlight";g[g.MaskOccludee=1]="MaskOccludee";g[g.COUNT=2]="COUNT"})(e.Object3DState||(e.Object3DState={}));e.AlphaDiscardMode=void 0;(function(g){g[g.Blend=0]="Blend";g[g.Opaque=1]="Opaque";g[g.Mask=2]="Mask";g[g.MaskBlend=3]="MaskBlend";g[g.COUNT=4]="COUNT"})(e.AlphaDiscardMode||(e.AlphaDiscardMode={}));e.Decorations=void 0;(function(g){g[g.OFF=0]="OFF";g[g.ON=1]="ON"})(e.Decorations||(e.Decorations={}));e.TextureEncodingMimeType=void 0;
(function(g){g.DDS_ENCODING="image/vnd-ms.dds";g.KTX2_ENCODING="image/ktx2";g.BASIS_ENCODING="image/x.basis"})(e.TextureEncodingMimeType||(e.TextureEncodingMimeType={}));Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(e,g,p,h,k,n){class d{constructor(b){this.rctx=b;this.floatBufferBlend=
new h.FloatBufferBlend(b);this.svgPremultipliesAlpha=new n.SVGPremultipliedAlpha(b);this.doublePrecisionRequiresObfuscation=new p.DoublePrecisionRequiresObfuscation(b);this.ignoresSamplerPrecision=new k.IgnoresSamplerPrecision(b);this.drawArraysRequiresIndicesTypeReset=new g.DrawArraysRequiresIndicesTypeReset(b)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}
e.WebGLDriverTest=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),function(e,g,p,h,k,n,d,b,a){class c extends a.WebGLDriverTestModule{constructor(q){super();this._rctx=q;this._helperProgram=null;g("mac")&&g("chrome")&&(this._program=
this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(q){const f=this._rctx,t=f.getBoundFramebufferObject(),{x:m,y:l,width:u,height:v}=f.getViewport();f.resetState();var r=new b.TextureDescriptor(1);r.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;r.samplingMode=n.TextureSamplingMode.NEAREST;r=new d.FramebufferObject(f,r);const y=k.BufferObject.createIndex(this._rctx,n.Usage.STATIC_DRAW,new Uint8Array([0]));
f.bindFramebuffer(r);f.setViewport(0,0,1,1);f.useProgram(this._helperProgram);f.bindBuffer(y,n.BufferType.ELEMENT_ARRAY_BUFFER);f.drawElements(n.PrimitiveType.POINTS,1,n.DataType.UNSIGNED_BYTE,0);f.useProgram(q);f.bindVAO(null);f.drawArrays(n.PrimitiveType.TRIANGLES,0,258);q=new Uint8Array(4);r.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,q);f.setViewport(m,l,u,v);f.bindFramebuffer(t);r.dispose();y.dispose();return 255===q[0]}_prepareProgram(){const q=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${p.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
f=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${p.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(q,f,new Map([]))}_prepareHelperProgram(){const q=h.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(q.vertex,q.fragment,new Map([]))}}e.DrawArraysRequiresIndicesTypeReset=c;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(e){function g(k,...n){let d="";for(let b=0;b<n.length;b++)d+=k[b]+n[b];return d+=k[k.length-1]}class p{}const h=p;(function(k){k.int=function(n){return Math.round(n).toString()};k.float=function(n){return n.toPrecision(8)}})(g||={});e.NoParameters=h;e.glsl=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports",
"./BufferObject","./enums"],function(e,g,p){class h{constructor(k){this._rctx=k;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const k=
h.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))}_createIndexbuffer(){return g.BufferObject.createIndex(this._rctx,p.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,p.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(p.PrimitiveType.POINTS,1,p.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}e.AppleAmdDriverHelper=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(e,g){class p{constructor(){this._result=!1}dispose(){this._program=g.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}e.WebGLDriverTestModule=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t){function m(u,v){return u.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${v?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class l extends t.WebGLDriverTestModule{constructor(u){super();this._rctx=u;this._program=m(this._rctx,!1);this._obfuscated=m(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=h.disposeMaybe(this._obfuscated)}_test(u){if(p("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const v=this._rctx,r=v.getBoundFramebufferObject(),
{x:y,y:x,width:w,height:A}=v.getViewport();u=this._runProgram(u);const z=this._runProgram(this._obfuscated);v.setViewport(y,x,w,A);v.bindFramebuffer(r);return 0!==u&&(0===z||5<u/z)}_runProgram(u){var v=this._rctx;v.resetState();var r=new c.TextureDescriptor(1);r.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;r.samplingMode=b.TextureSamplingMode.NEAREST;r=new a.FramebufferObject(v,r);var y=n.BufferObject.createVertex(v,b.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));y=new q.VertexArrayObject(v,new Map([["position",
0]]),{geometry:[new f.VertexElementDescriptor("position",2,b.DataType.UNSIGNED_SHORT,0,4)]},{geometry:y});const x=k.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),w=k.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),A=new Float32Array(6);d.encodeDoubleArray(x,A,3);const z=new Float32Array(6);d.encodeDoubleArray(w,z,3);v.useProgram(u);u.setUniform3f("u_highA",A[0],A[2],A[4]);u.setUniform3f("u_lowA",A[1],A[3],A[5]);u.setUniform3f("u_highB",z[0],z[2],z[4]);u.setUniform3f("u_lowB",
z[1],z[3],z[5]);v.bindFramebuffer(r);v.setViewport(0,0,1,1);v.bindVAO(y);v.drawArrays(b.PrimitiveType.TRIANGLE_STRIP,0,4);u=new Uint8Array(4);r.readPixels(0,0,1,1,b.PixelFormat.RGBA,b.PixelType.UNSIGNED_BYTE,u);y.dispose();r.dispose();v=(x[2]-w[2])/25;u=g.unpackFloatRGBA(u);return Math.abs(v-u)}}e.DoublePrecisionRequiresObfuscation=l;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(e){const g=new Float32Array(2);
e.decodeDoubleArray=function(p,h,k){for(let n=0;n<k;++n)h[n]=p[2*n]+p[2*n+1]};e.encodeDoubleArray=function(p,h,k){for(let n=0;n<k;++n)h[2*n]=p[n],h[2*n+1]=p[n]-h[2*n]};e.encodeDoubleHi=function(p,h){const k=p.length;for(let n=0;n<k;++n)g[0]=p[n],h[n]=g[0];return h};e.encodeDoubleLo=function(p,h){const k=p.length;for(let n=0;n<k;++n)g[0]=p[n],g[1]=p[n]-g[0],h[n]=g[1];return h};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(e,g,p,h,k,n,d,b,a,c){class q extends c.WebGLDriverTestModule{constructor(f){super();this._rctx=f;f.gl&&f.capabilities.colorBufferFloat?.textureFloat&&f.capabilities.colorBufferFloat?.floatBlend&&(this._program=f.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(f){const t=this._rctx;var m=new d.TextureDescriptor(1);m.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;m.dataType=h.PixelType.FLOAT;m.internalFormat=h.SizedPixelFormat.RGBA32F;m.samplingMode=h.TextureSamplingMode.NEAREST;m=new k.FramebufferObject(t,m);var l=p.BufferObject.createVertex(t,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));l=new b.VertexArrayObject(t,new Map([["a_pos",0]]),{geometry:[new a.VertexElementDescriptor("a_pos",2,h.DataType.UNSIGNED_SHORT,0,4)]},
{geometry:l});t.useProgram(f);f=t.getBoundFramebufferObject();const {x:u,y:v,width:r,height:y}=t.getViewport();t.bindFramebuffer(m);t.setViewport(0,0,1,1);t.bindVAO(l);t.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);var x=n.makePipelineState({blending:g.blendingAlpha});t.setPipelineState(x);t.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);x=t.gl.getError();t.setViewport(u,v,r,y);t.bindFramebuffer(f);l.dispose();m.dispose();return 1282===x?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),
!1):!0}}e.FloatBufferBlend=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(e,g,p,h){const k=h.separateBlendingParams(p.BlendFactor.SRC_ALPHA,p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA,p.BlendFactor.ONE_MINUS_SRC_ALPHA),n=h.simpleBlendingParams(p.BlendFactor.ONE,p.BlendFactor.ONE),d=h.simpleBlendingParams(p.BlendFactor.ZERO,
p.BlendFactor.ONE_MINUS_SRC_ALPHA),b={factor:-1,units:-2};e.OITPolygonOffset=b;e.OITPolygonOffsetLimit=5E5;e.blendingAlpha=d;e.blendingColor=n;e.blendingDefault=k;e.getOITPolygonOffset=function(a){return a?b:null};e.oitBlending=function(a){return a===g.TransparencyPassType.FrontFace?null:a===g.TransparencyPassType.Alpha?d:n};e.oitDepthTest=function(a,c=p.CompareFunction.LESS){return a===g.TransparencyPassType.NONE||a===g.TransparencyPassType.FrontFace?c:p.CompareFunction.LEQUAL};e.oitDepthWrite=function(a){return a===
g.TransparencyPassType.FrontFace?h.defaultDepthWriteParams:null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(e){e.TransparencyPassType=void 0;var g=e.TransparencyPassType||(e.TransparencyPassType={});g[g.Color=0]="Color";g[g.Alpha=1]="Alpha";g[g.FrontFace=2]="FrontFace";g[g.NONE=3]="NONE";g[g.COUNT=4]="COUNT";Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(e,g,p,h,k,n,d,b,a,c){class q extends c.WebGLDriverTestModule{constructor(f){super();this._rctx=f;this._program=f.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(f){const t=this._rctx;var m=new d.TextureDescriptor(1);m.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;m.samplingMode=h.TextureSamplingMode.NEAREST;const l=new k.FramebufferObject(t,m),u=new Uint8Array(4);var v=p.BufferObject.createVertex(t,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));v=new b.VertexArrayObject(t,new Map([["a_position",
0]]),{geometry:[new a.VertexElementDescriptor("a_position",2,h.DataType.SHORT,0,4)]},{geometry:v});t.useProgram(f);m=new n.Texture(t,m,new Uint8Array([2,255,0,0]));f.setUniform1i("u_texture",0);t.bindTexture(m,0);m=t.getBoundFramebufferObject();t.bindFramebuffer(l);t.useProgram(f);const {x:r,y,width:x,height:w}=t.getViewport();t.setViewport(0,0,1,1);t.bindVAO(v);t.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);t.setViewport(r,y,x,w);l.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,
u);v.dispose();l.dispose();(f=255!==u[0]||255!==u[1]||255!==u[2]||255!==u[3])&&g.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${u[0]}.${u[1]}.${u[2]}.${u[3]}]`);t.bindFramebuffer(m);return f}}
e.IgnoresSamplerPrecision=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(e,g,p,h,k,n,d,b,a){class c extends a.WebGLDriverTestModule{constructor(f){super();this._rctx=f;this._program=f.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(f){const t=this._rctx;if(!t.gl)return f.dispose(),!0;var m=new d.TextureDescriptor(1);m.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;m.samplingMode=h.TextureSamplingMode.NEAREST;m=new k.FramebufferObject(t,m);var l=p.BufferObject.createVertex(t,h.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));l=new b.VertexArrayObject(t,new Map([["a_pos",0]]),g.Pos2us,{geometry:l});var u=new d.TextureDescriptor;u.samplingMode=h.TextureSamplingMode.LINEAR;u.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;u=new n.Texture(t,u,q);t.useProgram(f);t.bindTexture(u,0);f.setUniform1i("u_texture",0);f=t.getBoundFramebufferObject();const {x:v,y:r,width:y,height:x}=t.getViewport();t.bindFramebuffer(m);t.setViewport(0,0,1,1);t.setClearColor(0,0,0,0);t.setBlendingEnabled(!1);t.clearSafe(h.ClearBufferBit.COLOR_BUFFER_BIT);
t.bindVAO(l);t.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);const w=new Uint8Array(4);m.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,w);l.dispose();m.dispose();u.dispose();t.setViewport(v,r,y,x);t.bindFramebuffer(f);return 255!==w[0]}}const q=new Image;q.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
q.width=5;q.height=5;q.decode();e.SVGPremultipliedAlpha=c;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports","./DisjointTimerQuery","./load","./LoseContext"],function(e,g,p,h){class k{constructor(n,d){this._gl=n;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._loseContext=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=
null;this._disabledExtensions=d.disabledExtensions||{};this._debugWebGLExtensions=d.debugWebGLExtensions||{}}get compressedTextureETC(){this._compressedTextureETC||(this._compressedTextureETC=p.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=p.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||
(this._textureFilterAnisotropic=p.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||(this._disjointTimerQuery=g.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const {textureFloatLinear:n}=this._disabledExtensions;this._textureFloat={textureFloatLinear:!n&&!!this._gl.getExtension("OES_texture_float_linear")}}return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||
(this._colorBufferFloat=p.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get depthTexture(){null===this._depthTexture&&(this._depthTexture=p.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=h.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16||
(this._textureNorm16=p.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=p.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(n){return this[n]}}e.Capabilities=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],
function(e){e.loadBooleanExtension=function(g,p,h,k,n){if(k)return!0;if(p[h])return!1;for(const d of n)if(g.getExtension(d))return!0;return!1};e.loadColorBufferFloat=function(g,p){const h=!p.colorBufferHalfFloat&&g.getExtension("EXT_color_buffer_half_float")||!p.colorBufferFloat&&g.getExtension("EXT_color_buffer_float"),k=!p.colorBufferFloat&&g.getExtension("EXT_color_buffer_float");p=!p.floatBlend&&!p.colorBufferFloat&&g.getExtension("EXT_float_blend");return h||k||p?{textureFloat:!!k,textureHalfFloat:!!h,
floatBlend:!!p,R16F:g.R16F,RG16F:g.RG16F,RGBA16F:g.RGBA16F,R32F:g.R32F,RG32F:g.RG32F,RGBA32F:g.RGBA32F,R11F_G11F_B10F:g.R11F_G11F_B10F,RGB16F:g.RGB16F}:null};e.loadCompressedTextureETC=function(g,p){return p.compressedTextureETC?null:(g=g.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:g.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:g.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:g.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:g.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:g.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:g.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:g.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:g.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};e.loadCompressedTextureS3TC=function(g,p){return p.compressedTextureS3TC?null:(g=g.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:g.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:g.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:g.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:g.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};e.loadTextureFilterAnisotropicCapability=function(g,p){return p.textureFilterAnisotropic?null:(g=g.getExtension("EXT_texture_filter_anisotropic")||g.getExtension("MOZ_EXT_texture_filter_anisotropic")||g.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:g.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:g.TEXTURE_MAX_ANISOTROPY_EXT}:
null};e.loadTextureNorm16=function(g,p){return p.textureNorm16?null:(g=g.getExtension("EXT_texture_norm16"))?{R16:g.R16_EXT,RG16:g.RG16_EXT,RGB16:g.RGB16_EXT,RGBA16:g.RGBA16_EXT,R16_SNORM:g.R16_SNORM_EXT,RG16_SNORM:g.RG16_SNORM_EXT,RGB16_SNORM:g.RGB16_SNORM_EXT,RGBA16_SNORM:g.RGBA16_SNORM_EXT}:null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(e){e.load=function(g,p){const h=p.loseContext&&g.getExtension("WEBGL_lose_context");
return h?{loseRenderingContext:()=>h.loseContext()}:null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define("exports ../../chunks/tslib.es6 ../../core/Accessor ../../core/Error ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./engine/webgl/collisions/CollisionEngine".split(" "),function(e,g,p,h,k,n,d,b,a,c){e.LabelManager=class extends p{constructor(q){super(q);
this._lastUpdate=0;this.collisionEngine=new c.CollisionEngine;this.lastUpdateId=-1;this.updateRequested=!1;this.view=null}get updating(){k("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`);return this.updateRequested}update(q){const f=performance.now();32<=f-this._lastUpdate?(this._lastUpdate=f,this.doUpdate(q)):this.requestUpdate()}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=
!0,this.view?.requestUpdate())}processUpdate(q){this.updateRequested&&(this.updateRequested=!1,this.update(q))}doUpdate(q){const f=this.view;if(f)try{const t=q.state.scale,m=f.featuresTilingScheme.getClosestInfoForScale(t).level;this.collisionEngine.run(f.allLayerViews.items,q,t,m)}catch(t){}}};g.__decorate([d.property()],e.LabelManager.prototype,"updateRequested",void 0);g.__decorate([d.property()],e.LabelManager.prototype,"updating",null);g.__decorate([d.property()],e.LabelManager.prototype,"view",
void 0);e.LabelManager=g.__decorate([a.subclass("esri.views.2d.LabelManager")],e.LabelManager);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define(["exports","../../../../../core/has","../definitions","./CollisionGrid"],function(e,g,p,h){function k(b,a){b=b.children.slice();b.sort((c,q)=>c.tileAge-q.tileAge);b.forEach(c=>{null!=c.labelMetrics&&c.isReady&&a(c,c.labelMetrics)})}function n(b,a){return(!b.minScale||
b.minScale>=a)&&(!b.maxScale||b.maxScale<=a)}class d{run(b,a,c,q){const f=[];for(let t=b.length-1;0<=t;t--){const m=b[t];m.labelingCollisionInfos?.length&&f.push(...m.labelingCollisionInfos)}g("esri-2d-update-debug")&&f.length&&console.debug("CollisionEngine.run");this._transformMetrics(f);this._runCollision(f,a,c,q);for(const t of f)t.container.requestRender()}_runCollision(b,a,c,q){const [f,t]=a.state.size,m=new h.CollisionBitsetGrid(f,t,a.pixelRatio);for(const {container:l,deconflictionEnabled:u,
visible:v}of b){const r=l.attributeView;u?v?(this._prepare(l),this._collideVisible(m,l,c,q),this._collideInvisible(m,l)):k(l,(y,x)=>{for(const w of x)r.setLabelMinZoom(w.entityTexel,255)}):k(l,(y,x)=>{for(const w of x)n(w,c)?(r.setLabelMinZoom(w.entityTexel,0),v&&m.insertMetrics(w)):r.setLabelMinZoom(w.entityTexel,254)})}}_isFiltered(b,a,c){b=a.getFilterFlags(b);a=null==c.featureEffect||c.featureEffect.excludedLabelsVisible||!!(b&p.effectFlag0);return!((!c.hasFilter||b&p.filterFlag0)&&a)}_prepare(b){const a=
b.attributeView,c=new Set;k(b,(q,f)=>{for(const t of f)q=t.entityTexel,c.has(q)||(c.add(q),this._isFiltered(q,a,b.layerView)?a.setLabelMinZoom(q,254):0!==a.getLabelMinZoom(q)?a.setLabelMinZoom(q,255):a.setLabelMinZoom(q,0))})}_collideVisible(b,a,c,q){const f=a.attributeView,t=new Set;k(a,(m,l)=>{for(var u=0;u<l.length;u++){const r=l[u].entityTexel;if(t.has(r))continue;if(m.key.level!==q){f.setLabelMinZoom(r,254);t.add(r);continue}if(!n(l[u],c)){f.setLabelMinZoom(r,254);t.add(r);continue}if(0!==f.getLabelMinZoom(r)){t.add(r);
continue}let y=!1,x=!0;for(var v=u;u<l.length;u++){const w=l[u];if(w.entityTexel!==r)break;if(!y)switch(b.hasCollision(w)){case h.hasCollision:y=!0;x=!1;break;case h.none:x=!1}}if(!y)for(;v<u;v++)b.insertMetrics(l[v]);--u;x||(t.add(r),f.setLabelMinZoom(r,y?254:0))}})}_collideInvisible(b,a){const c=a.attributeView,q=new Set;k(a,(f,t)=>{for(var m=0;m<t.length;m++){f=t[m].entityTexel;if(q.has(f))continue;if(255!==c.getLabelMinZoom(f)){q.add(f);continue}let u=!1,v=!0;for(var l=m;m<t.length;m++){const r=
t[m];if(r.entityTexel!==f)break;if(!u)switch(b.hasCollision(r)){case h.hasCollision:u=!0;v=!1;break;case h.none:v=!1}}if(!u)for(;l<m;l++)b.insertMetrics(t[l]);--m;v||(q.add(f),c.setLabelMinZoom(f,u?255:0))}})}_transformMetrics(b){for(const {container:a,geometryType:c,vvEvaluators:q}of b)k(a,(f,t)=>{const m=a.attributeView;f=f.transforms.labelMat2d;f[4]=Math.round(f[4]);f[5]=Math.round(f[5]);const l="polyline"===c;for(const y of t){const {entityTexel:x,anchorX:w,anchorY:A}=y;var u=y.referenceBounds?.size??
0;t=q[0];if(null!=t){var v=m.getVVSize(x);t=t(v);u=isNaN(t)||null==t||Infinity===t?u:t}t=u/2*y.directionX;u=u/2*y.directionY;for(const z of y.bounds){v=w;var r=A;l?(v=v+z.x+t,r=r+z.y+u,v=f[0]*v+f[2]*r+f[4],r=f[1]*v+f[3]*r+f[5],z.computedX=Math.floor(v),z.computedY=Math.floor(r)):(v=f[0]*w+f[2]*A+f[4],r=f[1]*w+f[3]*A+f[5],r=r+z.y+u,z.computedX=v+z.x+t,z.computedY=r)}}})}}e.CollisionEngine=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["exports",
"../../../../../core/mathUtils","../definitions","../../../layers/features/support/StaticBitSet"],function(e,g,p,h){class k{constructor(n,d,b){this._debugMap=new Map;this._width=n*b;this._height=d*b;this._pixelRatio=b;n=Math.ceil(this._width/1);d=Math.ceil(this._height/1);this._cols=n;this._rows=d;this._cells=h.StaticBitSet.create(n*d)}insertMetrics(n){this._markMetrics(n)}hasCollision(n){let d=0;for(const {computedX:b,computedY:a,width:c,height:q}of n.bounds)switch(this._collide(b,a,(c+p.labelPlacementOffsetPadding)*
this._pixelRatio,(q+p.labelPlacementOffsetPadding)*this._pixelRatio)){case 2:return 2;case 1:d++}return d===n.bounds.length?1:0}getCellId(n,d){return n+d*this._cols}has(n){return this._cells.has(n)}hasRange(n,d){return this._cells.hasRange(n,d)}set(n){this._cells.set(n)}setRange(n,d){this._cells.setRange(n,d)}_collide(n,d,b,a){n-=b/2;d-=a/2;b=n+b;var c=d+a;if(0>b||0>c||n>this._width||d>this._height)return 1;a=g.clamp(Math.floor(n/1),0,this._cols);var q=g.clamp(Math.floor(d/1),0,this._rows);n=g.clamp(Math.ceil(b/
1),0,this._cols);d=g.clamp(Math.ceil(c/1),0,this._rows);for(b=q;b<=d;b++)for(c=a;c<=n;c++)if(q=this.getCellId(c,b),this.has(q))return 2;return 0}_mark(n,d,b,a,c){n-=b/2;d-=a/2;b=n+b;var q=d+a;a=g.clamp(Math.floor(n/1),0,this._cols);var f=g.clamp(Math.floor(d/1),0,this._rows);n=g.clamp(Math.ceil(b/1),0,this._cols);d=g.clamp(Math.ceil(q/1),0,this._rows);for(b=f;b<=d;b++)for(q=a;q<=n;q++)f=this.getCellId(q,b),this._debugMap.set(f,c),this.set(f);return!1}_markMetrics(n){for(const {computedX:d,computedY:b,
width:a,height:c}of n.bounds)this._mark(d,b,(a+p.labelPlacementOffsetPadding)*this._pixelRatio,(c+p.labelPlacementOffsetPadding)*this._pixelRatio,n.entityTexel)}}e.CollisionBitsetGrid=k;e.hasCollision=2;e.none=0;e.outsideExtent=1;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(e){class g{static fromBuffer(p,h){return new g(p,h)}static create(p,h=4294967295){p=new Uint32Array(Math.ceil(p/32));
return new g(p,h)}constructor(p,h){this._mask=0;this._buf=p;this._mask=h}_getIndex(p){return Math.floor(p/32)}has(p){p&=this._mask;return!!(this._buf[this._getIndex(p)]&1<<p%32)}hasRange(p,h){for(;p%32&&p!==h;){if(this.has(p))return!0;p++}for(;h%32&&p!==h;){if(this.has(p))return!0;h--}if(p===h)return!1;for(p/=32;p!==h/32;p++)if(this._buf[p])return!0;return!1}set(p){p&=this._mask;const h=this._getIndex(p);this._buf[h]|=1<<p%32}setRange(p,h){for(;p%32&&p!==h;)this.set(p++);for(;h%32&&p!==h;)this.set(h--);
if(p!==h)for(p/=32;p!==h/32;p++)this._buf[p]=4294967295}unset(p){p&=this._mask;const h=this._getIndex(p);this._buf[h]&=4294967295^1<<p%32}resize(p){const h=this._buf;p=new Uint32Array(Math.ceil(p/32));p.set(h);this._buf=p}or(p){for(let h=0;h<this._buf.length;h++)this._buf[h]|=p._buf[h];return this}and(p){for(let h=0;h<this._buf.length;h++)this._buf[h]&=p._buf[h];return this}xor(p){for(let h=0;h<this._buf.length;h++)this._buf[h]^=p._buf[h];return this}ior(p){for(let h=0;h<this._buf.length;h++)this._buf[h]|=
~p._buf[h];return this}iand(p){for(let h=0;h<this._buf.length;h++)this._buf[h]&=~p._buf[h];return this}ixor(p){for(let h=0;h<this._buf.length;h++)this._buf[h]^=~p._buf[h];return this}any(){for(let p=0;p<this._buf.length;p++)if(this._buf[p])return!0;return!1}copy(p){for(let h=0;h<this._buf.length;h++)this._buf[h]=p._buf[h];return this}clone(){return new g(this._buf.slice(),this._mask)}clear(){for(let p=0;p<this._buf.length;p++)this._buf[p]=0;return this}forEachSet(p){for(let h=0;h<this._buf.length;h++){let k=
this._buf[h],n=32*h;if(k)for(;k;)k&1&&p(n),k>>>=1,n++}}countSet(){let p=0;this.forEachSet(h=>{p++});return p}}e.StaticBitSet=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Identifiable ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../layers/support/FieldsIndex ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/OverrideHelper ../../../../symbols/support/defaults ../../engine/webgl/definitions ../../engine/webgl/FeatureTile ../../engine/webgl/mesh/MeshData ../../engine/webgl/mesh/factories/ResourceProxy ../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas ../../engine/webgl/shaderGraph/techniques/mesh/createMeshWriter ../../engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils ../features/schema/processor/StorageSchema ../features/support/AttributeStore ../features/support/ComputedAttributeStorage ../features/support/FeatureMetadata ../features/support/GraphicsReader ./GraphicStore ../support/FeatureCommandQueue ../support/UpdateTracking2D".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r,y,x,w,A,z,C,D,F,G,B,I,H,K,O){class R{static getOrCreate(E,J,Q){let N=J.get(E.id);N||(N=new R(E,Q),J.set(E.id,N));return N}static fromItems(E,J,Q){E=new R(E,Q);E.addedOrModified.push(...J);return E}constructor(E,J){this.tile=E;this.metadata=J;this.addedOrModified=[];this.removed=[]}get reader(){this._reader||(this._reader=I.GraphicsReader.from(this.addedOrModified,this.tile,this.metadata));return this._reader}}g=class extends k.IdentifiableMixin(g){constructor(E){super(E);
this._attached=!1;this._tiles=new Map;this._controller=new AbortController;this._hashToSymbolInfo=new Map;this._lastCleanup=performance.now();this._cleanupRequired=!0;this.lastUpdateId=-1;this.renderer=null;this._updateTracking=new O.UpdateTracking2D({debugName:"GraphicsView2D"});this.updateRequested=!1;this.defaultPointSymbolEnabled=!0;this._commandQueue=new K({process:J=>{switch(J.type){case "processed-edit":throw Error("InternalError: Unsupported command");case "update":return this._update()}}});
this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy();this.renderer=this.view=null;this._set("graphics",null);this._controller.abort();this._graphicStore.clear();this._attributeStore=null;this._hashToSymbolInfo.clear();this._updateTracking.destroy();this._commandQueue.destroy()}_initAttributeStore(){this._storage=new G.ComputedAttributeStorage({spatialReference:this.view.spatialReference,fields:new m});this._attributeStore=new F.AttributeStore({isLocal:!0,
update:async J=>{h("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:J});const Q=this.container.attributeView.requestUpdate(J);this.container.requestRender();await Q;h("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:J})}});const E=D.createStorageSchema(null,[]);this._attributeStore.update(E,this._storage,null);this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore();
this._metadata=B.GraphicsMetadata.create(this.view.spatialReference);this._resourceProxy=new w.ResourceProxy({fetch:E=>Promise.all(E.map(J=>this.view.stage.textureManager.rasterizeItem(J))),fetchDictionary:E=>{throw Error("InternalError: Graphics do not support Dictionary requests");}});this.addHandles([b.watch(()=>this._effectiveRenderer,()=>this._pushUpdate()),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.addHandles([this.graphics.on("change",
()=>this._pushUpdate())]);this._graphicStore=new H(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore);this._attached=!0;this.requestUpdate();this._pushUpdate()})]);this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);this._onTileUpdate({added:this.view.graphicsTileStore.tiles,removed:[]})}get _effectiveRenderer(){return"function"===typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const E=
!this._attached||this._updateTracking.updating;h("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${E}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`);return E}hitTest(E){if(!this.view||this.view.suspended)return[];const {resolution:J,rotation:Q}=this.view.state;E=this._graphicStore.hitTest(E.x,E.y,2,J,Q);const N=new Set(E),S=this.graphics.items.reduce((W,U)=>{N.has(U.uid)&&W.set(U.uid,U);return W},new Map);return E.map(W=>S.get(W)).filter(p.isSome)}requestUpdate(){this.updateRequested||
(this.updateRequested=!0,this.requestUpdateCallback());this.notifyChange("updating")}processUpdate(E){this.updateRequested&&(this.updateRequested=!1,this.update(E))}viewChange(){this.requestUpdate()}setHighlight(E){const J=[];for(const {objectId:Q,highlightFlags:N}of E){const S=this._graphicStore.getItem(Q)?.displayId;J.push({objectId:Q,highlightFlags:N,displayId:S})}this._attributeStore.setHighlight(J,E);this._pushUpdate()}graphicUpdateHandler(E){this._pushUpdate()}update(E){this.updateRequested=
!1;this._attached&&this._graphicStore.updateLevel(E.state.resolution)}_pushUpdate(){d.ignoreAbortErrors(this._commandQueue.push({type:"update"}))}async _update(){try{h("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const E=await this._graphicStore.update(this.graphics,Q=>this._getSymbolForGraphic(Q),Q=>this._ensureSymbolResource(Q));if(!E.hasAnyUpdate()){await this._attributeStore.sendUpdates();return}E.removed.length&&(this._cleanupRequired=!0);h("esri-2d-update-debug")&&
console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,E);const J=this._createTileMessages(E);await this._fetchResources(J);this._write(J);for(const Q of E.added)this._setFilterState(Q);for(const Q of E.updated)this._setFilterState(Q);h("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,E);await this._attributeStore.sendUpdates();h("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,E)}catch(E){}this._cleanupSharedResources()}_createTileMessages(E){const J=
new Map;for(var Q of E.added){var N=this.view.graphicsTileStore.getIntersectingTiles(Q.bounds);for(const S of N)R.getOrCreate(S,J,this._metadata).addedOrModified.push(Q)}for(const S of E.updated){Q=this.view.graphicsTileStore.getIntersectingTiles(S.prevBounds);N=this.view.graphicsTileStore.getIntersectingTiles(S.bounds);for(const W of Q)R.getOrCreate(W,J,this._metadata).removed.push(S.displayId);for(const W of N)R.getOrCreate(W,J,this._metadata).addedOrModified.push(S)}for(const S of E.removed){E=
this.view.graphicsTileStore.getIntersectingTiles(S.bounds);for(const W of E)R.getOrCreate(W,J,this._metadata).removed.push(S.displayId)}return Array.from(J.values())}async _fetchResources(E){for(const {tile:J,reader:Q}of E){h("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${J.id}] GraphicsView fetchResources`,E);const N=Q.getCursor();for(;N.next();)for(const S of N.getMeshWriters())S.enqueueRequest(this._resourceProxy,N,J.createArcadeEvaluationOptions(this.view.timeZone))}await this._resourceProxy.fetchEnqueuedResources()}_write(E){for(const J of E){h("esri-2d-update-debug")&&
console.debug(`Id[${this.layerId}] Tile[${J.tile.id}] GraphicsView write`,J);E=this._writeMeshes(J);let Q=this._tiles.get(J.tile.key);Q||=this._createFeatureTile(J.tile.key);h("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${J.tile.id}] GraphicsView onTileData`,J);this.container.onTileData(Q,{type:"update",modify:E,remove:J.removed,end:!1,attributeEpoch:this._attributeStore.epoch});this.container.requestRender()}}_writeMeshes(E){const J=new x.MeshData(E.tile.id),Q=E.reader.getCursor();
for(;Q.next();){J.entityStart(Q.getDisplayId(),Q.getZOrder());for(const N of Q.getMeshWriters())N.write(J,this._resourceProxy,Q,E.tile.createArcadeEvaluationOptions(this.view.timeZone),E.tile.level);J.entityEnd()}return{...J.serialize().message,tileId:E.tile.id}}_setFilterState(E){const J=E.displayId,Q=this._attributeStore.getHighlightFlags(E.objectId);this._attributeStore.setData(J,0,0,Q|(E.visible?r.filterFlag0:0))}_getSymbolForGraphic(E){return null!=E.symbol?E.symbol:null!=this._effectiveRenderer?
this._effectiveRenderer.getSymbol(E):this._getNullSymbol(E)}async _ensureSymbolResource(E){if(E.symbol){var J=await this._getSymbolInfo(E.symbol);if(J){var Q=J.linearCIM.filter(N=>"text"===N.type);0<Q.length?(Q=await this._getTextResources(E,Q),E.symbolResource={symbolInfo:J,textInfo:Q}):E.symbolResource={symbolInfo:J}}}}_getSymbolInfo(E){const J=E.hash();this._hashToSymbolInfo.has(J)||this._hashToSymbolInfo.set(J,this._createSymbolInfo(J,E).catch(Q=>null));return this._hashToSymbolInfo.get(J)}async _createSymbolInfo(E,
J){const Q=await this._convertToCIMSymbol(J),N=await this._createLinearCIM(Q);if("text"===J.type)for(const S of N)"text"===S.type&&(S.lineWidth=J.lineWidth);J=await this._createMeshWriters(Q,N);return{hash:E,cimSymbol:Q,linearCIM:N,meshWriters:J}}async _convertToCIMSymbol(E){E=l.symbolToCIM(E);return"web-style"===E.type?(await E.fetchCIMSymbol()).data:E}async _createLinearCIM(E){await Promise.all(l.CIMSymbolHelper.fetchResources(E.symbol,this._cimResourceManager,[]));return this.view.stage.cimAnalyzer.analyzeSymbolReference(E,
!1)}async _createMeshWriters(E,J){d.throwIfAborted(this._controller.signal);E=await A.createGraphicSymbolMeshSchemas(E,J,this.container.instanceStore);return Promise.all(E.map(Q=>z.createMeshWriter(this._storage,this._resourceProxy,Q.meshWriterName,C.castStrictInstanceId(Q.id),Q.options,{tileInfo:this.view.featuresTilingScheme.tileInfo},Q.optionalAttributes)))}_onTileUpdate(E){if(E.added&&0<E.added.length)for(const J of E.added)this._updateTracking.addPromise(this._addTile(J));if(E.removed&&0<E.removed.length)for(const J of E.removed)this._removeTile(J.key)}_createFeatureTile(E){var J=
this.view.featuresTilingScheme.getTileBounds(f.create(),E);const Q=this.view.featuresTilingScheme.getTileResolution(E.level);J=new y.FeatureTile(E,Q,J[0],J[3]);this._tiles.set(E,J);this.container.addChild(J);return J}async _addTile(E){if(this._attached){var J=this._graphicStore.queryItems(E);if(J.length){var Q=this._createFeatureTile(E.key);E=R.fromItems(E,J,this._metadata);await this._fetchResources([E]);E=this._writeMeshes(E);Q.onMessage({type:"append",append:E,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch})}}}_removeTile(E){if(this._tiles.has(E)){var J=
this._tiles.get(E);this.container.removeChild(J);J.destroy();this._tiles.delete(E)}}_getNullSymbol(E){E=E.geometry;return t.isPolyline(E)?v.errorPolylineSymbol2D:t.isPolygon(E)||t.isExtent(E)?v.errorPolygonSymbol2D:this.defaultPointSymbolEnabled?v.errorPointSymbol2D:null}async _getTextResources(E,J){var Q=[];const N=[];for(var S=0;S<J.length;S++){const U=J[S],{resource:M,overrides:P}=U.textRasterizationParam;if(0<P?.length){var W=u.OverrideHelper.resolveSymbolOverrides({type:"CIMSymbolReference",
primitiveOverrides:P,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:M.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:M.symbol,textString:M.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},E,this.view.spatialReference,null,t.getJsonType(E.projectedGeometry),null,null);W.then(T=>{({textString:T}=T.symbolLayers[0].markerGraphics[0]);N.push({type:"cim-rasterization-info",
resource:{type:"text",textString:T||"",font:M.font}});U.text=M.textString=T||""});Q.push(W)}else N.push({type:"cim-rasterization-info",resource:M})}0<Q.length&&await Promise.all(Q);E=N.map(U=>this.view.stage.textureManager.rasterizeItem(U));E=await Promise.all(E);n.assertIsSome(E);Q=new Map;for(S=0;S<J.length;S++)W=J[S],Q.set(W.textRasterizationParam.resource.symbol,{text:W.text,glyphMosaicItems:E[S]});return Q}_cleanupSharedResources(){if(this._cleanupRequired){var E=performance.now();if(!(5E3>E-
this._lastCleanup)){this._cleanupRequired=!1;this._lastCleanup=E;E=new Set;for(var J of this._graphicStore.items())E.add(J.symbolResource?.symbolInfo.hash);J=new Set(this._hashToSymbolInfo.keys());for(const Q of J.values())E.has(Q)||this._hashToSymbolInfo.delete(Q)}}}};e.__decorate([a.property()],g.prototype,"_effectiveRenderer",null);e.__decorate([a.property({constructOnly:!0})],g.prototype,"layerId",void 0);e.__decorate([a.property({constructOnly:!0})],g.prototype,"requestUpdateCallback",void 0);
e.__decorate([a.property()],g.prototype,"container",void 0);e.__decorate([a.property({constructOnly:!0})],g.prototype,"graphics",void 0);e.__decorate([a.property()],g.prototype,"renderer",void 0);e.__decorate([a.property()],g.prototype,"_updateTracking",void 0);e.__decorate([a.property()],g.prototype,"updating",null);e.__decorate([a.property()],g.prototype,"view",void 0);e.__decorate([a.property()],g.prototype,"updateRequested",void 0);e.__decorate([a.property()],g.prototype,"defaultPointSymbolEnabled",
void 0);return g=e.__decorate([q.subclass("esri.views.2d.layers.support.GraphicsView2D")],g)})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(e,g,p,h,k){class n{constructor(d,b=0){this._id=d;this._sizeHint=b;this._entitySortKeyIndex=this._entityIdIndex=this._entityCountOffset=this._entityRecordCountOffset=0;this._instanceIdToVertexData=new Map;this._recordVertexCount=this._recordVertexStart=
this._recordIndexCount=this._recordIndexStart=0;this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0};this._entities=new k(Uint32Array,this._sizeHint*g.byteSizeHint);this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const d=[],b=[],a=this._entities.buffer();for(const c of this._instanceIdToVertexData.values())b.push(c.serialize(d));return{message:{data:b,entities:a},transferList:d}}vertexCount(){return this._current.writer?.vertexCount??
0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(d){this._current.writer.vertexEnsureSize(d)}indexEnsureSize(d){this._current.writer.indexEnsureSize(d)}vertexWrite(d){this._current.writer.writeVertex(d)}vertexWriteRegion(d){this._current.writer.writeVertexRegion(d)}vertexWriteF32(d){this._current.writer.writeVertexF32(d)}recordBounds(d,b,a,c){}indexWrite(d){this._current.writer.writeIndex(d)}metricStart(d){this._current.metric=d}metricEnd(){this._current.metric.bounds.length&&
this._current.writer.writeMetric(this._current.metric)}metricBoxWrite(d){this._current.metric.bounds.push(d)}entityStart(d,b=d){this._entityIdIndex=this._entities.push(d);this._entitySortKeyIndex=this._entities.writeF32(b);this._entityRecordCountOffset=this._entities.push(0)}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(d,
b,a=0){this._current.writer=this._getVertexWriter(d,b);this._current.indexStart=this._current.writer.indexCount;this._current.vertexStart=this._current.writer.vertexCount;this._current.instanceId=d;this._current.layoutHash=b.hash;this._current.textureKey=a}recordEnd(d=0){const b=this._current.vertexStart,a=this._current.writer.vertexCount-b;if(!a)return!1;const c=this._current.indexStart,q=this._current.writer.indexCount-c;this._recordIndexStart=c;this._recordIndexCount=q;this._recordVertexStart=
b;this._recordVertexCount=a;this._entities.incr(this._entityRecordCountOffset);p.write(this._entities,this._current.instanceId,this._current.textureKey,c,q,b,a,d);return!0}copyLast(d,b){var a=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset);p.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,a,this._recordVertexCount,0);var c=this._current.writer.indexWriter;
const q=this._current.writer.vertexWriter;var f=this._recordIndexStart+this._recordIndexCount,t=this._recordVertexCount;for(var m=this._recordIndexStart;m!==f;m++){const l=c.getValue(m);c.push(l+t)}c=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;t=this._recordVertexStart*c;for(f=(this._recordVertexStart+this._recordVertexCount)*c;t!==f;t++)m=q.getValue(t),q.push(m);f=this._current.writer.layout.position;t=f.packPrecisionFactor??1;f=f.offset/Uint32Array.BYTES_PER_ELEMENT;d*=t;b*=
t;for(a*=c;a<=q.length;a+=c)q.i1616Add(a+f,d,b);this.recordEnd()}copyLastFrom(d,b,a){var c=d._entities.getValue(d._entityIdIndex),q=this._entities.getValue(this._entityIdIndex);c!==q&&(q=d._entities.getValueF32(d._entitySortKeyIndex),this.entityStart(c,q));this.recordStart(d._current.instanceId,d._current.writer.layout,d._current.textureKey);c=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT;var f=this._current.vertexStart,t=d._current.vertexStart-f;const m=this._current.writer.indexWriter;
q=this._current.writer.vertexWriter;const l=d._current.writer.indexWriter;var u=d._current.writer.vertexWriter;for(let v=d._current.indexStart;v!==l.length;v++){const r=l.getValue(v);m.push(r-t)}for(d=d._current.vertexStart*c;d!==u.length;d++)t=u.getValue(d),q.push(t);d=this._current.writer.layout.position;u=d.packPrecisionFactor??1;d=d.offset/Uint32Array.BYTES_PER_ELEMENT;b*=u;a*=u;for(f*=c;f<=q.length;f+=c)q.i1616Add(f+d,b,a);this.recordEnd()}_getVertexWriter(d,b){const {stride:a}=b,c=this._instanceIdToVertexData;
c.has(d)||c.set(d,new h.VertexDataWriter(d,b,a,this._sizeHint));return c.get(d)}}e.MeshData=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(e,g){class p{constructor(h,k,n,d=0){const b=6*d*Uint32Array.BYTES_PER_ELEMENT;d=4*d*n;n/=4;const a=k.attributes.find(c=>"pos"===c.name||"position"===c.name);if(!a)throw Error("InternalError: Unable to find position attribute");this.layout=
{...k,position:a};this._indices=new g(Uint32Array,b);this._vertices=new g(Uint32Array,d);this._metrics=new g(Uint32Array,0);this._metricCountOffset=this._metrics.push(0);this._strideInt=n;this._instanceId=h}serialize(h){const k=this._indices.buffer(),n=this._vertices.buffer(),d=this._metrics.length?this._metrics.buffer():null;h.push(k,n);return{instanceId:this._instanceId,layout:this.layout,indices:k,vertices:n,metrics:d}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/
this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(h){this._vertices.ensureSize(h)}indexEnsureSize(h){this._indices.ensureSize(h)}writeIndex(h){this._indices.push(h)}writeVertex(h){this._vertices.push(h)}writeVertexRegion(h){this._vertices.writeRegion(h)}writeVertexF32(h){this._vertices.writeF32(h)}writeMetric(h){this._metrics.incr(this._metricCountOffset);
h.serialize(this._metrics)}}e.VertexDataWriter=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){class e{get length(){return this._pos}constructor(g,p){this._pos=0;p=p?this._roundToNearest(p,g.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(p);this._buffer=new g(this._array);this._ctor=g;this._i16View=new Int16Array(this._array)}_roundToNearest(g,p){g=Math.round(g);return 1===p?g:g+(p-g%p)}_ensureSize(g){if(this._pos+
g>=this._buffer.length){g=this._roundToNearest(1.25*(this._array.byteLength+g*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);g=new ArrayBuffer(g);const p=new this._ctor(g);p.set(this._buffer,0);this._array=g;this._buffer=p;this._i16View=new Int16Array(this._array)}}ensureSize(g){this._ensureSize(g)}writeF32(g){this._ensureSize(1);const p=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=g;this._pos++;return p}push(g){this._ensureSize(1);const p=this._pos;this._buffer[this._pos++]=
g;return p}writeFixed(g){this._buffer[this._pos++]=g}setValue(g,p){this._buffer[g]=p}i1616Add(g,p,h){this._i16View[2*g]+=p;this._i16View[2*g+1]+=h}getValue(g){return this._buffer[g]}getValueF32(g){return(new Float32Array(this._array,4*g,1))[0]}incr(g){if(this._buffer.length<g)throw Error("Increment index overflows the target buffer");this._buffer[g]++}decr(g){this._buffer[g]--}writeRegion(g){this._ensureSize(g.length);const p=this._pos;this._buffer.set(g,this._pos);this._pos+=g.length;return p}writeManyFrom(g,
p,h){for(this._ensureSize(h-p);p!==h;p++)this.writeFixed(g._buffer[p])}buffer(){const g=this._array.slice(0,4*this._pos);this.destroy();return g}toArray(){return[...this._buffer]}seek(g){this._pos=g}destroy(){this._buffer=this._array=null}}return e})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../Utils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(e,g,p,h){class k extends h.AResourceProxy{constructor(n){super();
this._fetcher=n;this._controller=new AbortController;this._pendingIds=new Set;this._pendingRequests=[];this._resourceIdToResource=new Map}destory(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(n){var d=p.discardUrlIfHasUrlHash(n.resource);d=g.numericHash(JSON.stringify(d));if(this._pendingIds.has(d))return d;this._pendingIds.add(d);this._pendingRequests.push({...n,resourceId:d});return d}async fetchEnqueuedResources(){const n=this._pendingRequests;
this._pendingIds.clear();this._pendingRequests=[];const d=await this._fetcher.fetch(n,this._abortOptions);for(let b=0;b<d.length;b++)this._resourceIdToResource.set(n[b].resourceId,d[b])}async fetchResourceImmediate(n){n=await this._fetcher.fetch([n],this._abortOptions);if(1!==n.length)throw Error("FeaturePipelineResourceProxy: failed to fetch resources");return n[0]}async fetchDictionaryResourceImmediate(n){n=await this._fetcher.fetchDictionary([n],this._abortOptions);if(1!==n.length)throw Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");
return n[0]}getResource(n){return this._resourceIdToResource.get(n)}}e.ResourceProxy=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(e){class g{}e.AResourceProxy=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas":function(){define(["exports","../../../../layers/features/schema/processor/VisualVariablesSchema",
"../../../../layers/features/schema/processor/symbols/ComplexSymbolSchema"],function(e,g,p){e.createGraphicSymbolMeshSchemas=async function(h,k,n){const d=[];h={scaleInfo:p.getScaleInfo(h),scaleExpression:null};for(const b of k)switch(b.type){case "marker":d.push(...p.createComplexMarkerMeshInfos(n.instances.marker,b,g.noVisualVariables,h));break;case "fill":null==b.spriteRasterizationParam?d.push(...p.createComplexSimpleFillMeshInfos(n.instances.fill,b,h)):d.push(...p.createComplexFillMeshInfos(n.instances.complexFill,
b,!1,h));break;case "line":b.spriteRasterizationParam?d.push(...p.createComplexTexturedLineMeshInfos(n.instances.texturedLine,b,!1,h)):d.push(...p.createComplexSimpleLineMeshInfos(n.instances.line,b,!1,h));break;case "text":d.push(...p.createComplexTextMeshInfos(n.instances.text,b,g.noVisualVariables,h))}return d};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/VisualVariablesSchema":function(){define("exports ../../../../../../core/screenUtils ../../../../../../core/unitUtils ../../../../../../renderers/support/lengthUtils ../../../../engine/webgl/definitions ../../../../engine/webgl/shaderGraph/techniques/shaders/constants ./schemaUtils ../../support/rendererUtils".split(" "),
function(e,g,p,h,k,n,d,b){function a(r){if(!r.stops?.length)return null;r=r.stops.sort((x,w)=>x.value-w.value);var y=d.padStops(r,8);r=y.map(({value:x})=>x);y=y.map(({color:x})=>d.premultiplyColor(x));return{values:r,colors:y}}function c(r){if(!r.stops?.length)return null;r=r.stops.sort((x,w)=>x.value-w.value);var y=d.padStops(r,8);r=y.map(({value:x})=>x);y=y.map(({opacity:x})=>x);return{opacityValues:r,opacities:y}}function q(r){return{rotationType:"geographic"===r.rotationType?n.RotationType.Geographic:
n.RotationType.Arithmatic}}function f(r){if(!r.stops?.length)return null;if(r.stops.some(w=>w.useMaxValue||w.useMinValue))return(w,A)=>{const z=w.statisticsByLevel.get(A.key.level);w=r.stops.map(C=>{const D=C.useMaxValue?z?.get(r.field)?.maxValue??0:C.useMinValue?z?.get(r.field)?.minValue??0:C.value;C=C.size?g.pt2px(C.size):k.nanMagicNumber;return{value:D,size:C}}).sort((C,D)=>C.value-D.value);A=d.padStops(w,8);w=A.map(({value:C})=>C);A=A.map(({size:C})=>C);return{values:w,sizes:A}};var y=r.stops.sort((w,
A)=>w.value-A.value),x=d.padStops(y,8);y=x.map(({value:w})=>w);x=x.map(({size:w})=>g.pt2px(w));return{values:y,sizes:x}}function t(r){return y=>{({state:y}=y);return{unitValueToPixelsRatio:p.getMetersPerUnitForSR(y.spatialReference)/h.meterIn[r.valueUnit]/y.resolution}}}function m(r,y){const x=y.length;if(r<y[0].value||1===x)return y[0].size;for(let w=1;w<x;w++)if(r<y[w].value)return y[w-1].size+(r-y[w-1].value)/(y[w].value-y[w-1].value)*(y[w].size-y[w-1].size);return y[x-1].size}function l(r){const {minDataValue:y,
maxDataValue:x,minSize:w,maxSize:A}=r;if("object"===typeof w&&"object"===typeof A)return(z,C)=>{C=z.state.scale;z=g.pt2px(m(C,w.stops));C=g.pt2px(m(C,A.stops));return{minMaxValueAndSize:[y,x,z,C]}};if("object"===typeof w||"object"===typeof A)throw Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[y,x,g.pt2px(w),g.pt2px(A)]}}function u(r){if("number"===typeof r.minDataValue&&"number"===typeof r.maxDataValue&&null!=r.minSize&&null!=r.maxSize)return"min-max";
if((r.expression&&"view.scale"===r.expression||r.valueExpression&&"$view.scale"===r.valueExpression)&&Array.isArray(r.stops))return"scale-stops";if((null!=r.field||r.expression&&"view.scale"!==r.expression||r.valueExpression&&"$view.scale"!==r.valueExpression)&&(Array.isArray(r.stops)||"levels"in r&&r.levels))return"field-stops";if((null!=r.field||r.expression&&"view.scale"!==r.expression||r.valueExpression&&"$view.scale"!==r.valueExpression)&&null!=r.valueUnit)return"unit-value";throw Error("InternalError: Found unknown sizeVV type");
}const v={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};e.createVisualVariableColor=a;e.createVisualVariableOpacity=c;e.createVisualVariableRotation=q;e.createVisualVariableSizeMinMaxValue=l;e.createVisualVariableSizeScaleStops=function(r){if(!r.stops?.length)return null;r=r.stops.sort((x,w)=>
x.value-w.value);var y=d.padStops(r,8);r=y.map(({value:x})=>x);y=y.map(({size:x})=>g.pt2px(x));return{values:r,sizes:y}};e.createVisualVariableSizeStops=f;e.createVisualVariableSizeUnitValue=t;e.createVisualVariableUniforms=function(r){const y={...v};if(!(r&&"visualVariables"in r&&r.visualVariables))return y;for(const x of b.simplifyVisualVariables(r.visualVariables))switch(x.type){case "color":y.visualVariableColor=a(x);break;case "opacity":y.visualVariableOpacity=c(x);break;case "rotation":y.visualVariableRotation=
q(x);break;case "size":switch(u(x)){case "field-stops":y.visualVariableSizeStops=f(x);break;case "scale-stops":"outline"===x.target?y.visualVariableSizeOutlineScaleStops=f(x):y.visualVariableSizeScaleStops=f(x);break;case "min-max":y.visualVariableSizeMinMaxValue=l(x);break;case "unit-value":y.visualVariableSizeUnitValue=t(x)}break;default:console.error("Unable to handle VV type")}return y};e.getMaxSizeVVSize=function(r,y=128,x=1.25){if(r.visualVariableSizeMinMaxValue)return r.visualVariableSizeMinMaxValue instanceof
Function?128:Math.max(r.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*x,y);if(r.visualVariableSizeScaleStops){if(r.visualVariableSizeScaleStops instanceof Function)return 128;r=r.visualVariableSizeScaleStops.sizes;return Math.max(r[r.length-1]*x,y)}if(r.visualVariableSizeStops){if(r.visualVariableSizeStops instanceof Function)return 128;r=r.visualVariableSizeStops.sizes;return Math.max(r[r.length-1]*x,y)}return r.visualVariableSizeUnitValue?256:0};e.noVisualVariables=v;Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/schemaUtils":function(){define(["exports"],function(e){e.padStops=function(g,p){g=g.slice(0,p);p-=g.length;for(let h=0;h<p;h++)g.push(g[g.length-1]);return g};e.premultiplyColor=function(g){if(!g)return[0,0,0,0];const {r:p,g:h,b:k,a:n}=g;return[n/255*p,n/255*h,n/255*k,n]};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define(["exports",
"../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(e,g,p,h,k){function n(){const {supportsColorBufferFloat:b,supportsColorBufferFloatBlend:a,supportsColorBufferHalfFloat:c}=k.getWebGLCapabilities();return b&&a||c}const d=()=>p.getLogger("esri.views.2d.layers.features.support.rendererUtils");e.isRendererSupported=function(b){if(!b)return!0;switch(b.type){case "heatmap":if(!n()){const a=k.getWebGLCapabilities();b=["supportsColorBufferFloat",
"supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(c=>!a[c]).join(", ");d().errorOnce(new g("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${b}`));return!1}}return!0};e.simplifyVisualVariables=function(b){return b.map(a=>{if(("size"===a.type||"color"===a.type||"opacity"===a.type)&&null!=a.stops){a=a.clone();var c=a.type;var q=a.stops??[];if(8>=q.length)c=q;else if(d().warn(`Found ${q.length} Visual Variable stops, but MapView only supports ${8}. Displayed stops will be simplified.`),
16<q.length){const [A,...z]=q;var f=z.pop(),t=z[0].value,m=z[z.length-1].value,l=(m-t)/6;const C=[];for(;t<m;t+=l){for(var u=0;t>=z[u].value;)u++;var v=z[u],r=q[u-1],y=t-r.value;v=v.value===r.value?1:y/(v.value-r.value);"color"===c?(r=z[u],u=q[u-1],y=r.color.clone(),y.r=(1-v)*u.color.r+v*y.r,y.g=(1-v)*u.color.g+v*y.g,y.b=(1-v)*u.color.b+v*y.b,y.a=(1-v)*u.color.a+v*y.a,C.push({value:t,color:y,label:r.label})):"size"===c?(r=z[u],y=q[u-1],u=h.toPt(r.size),y=h.toPt(y.size),C.push({value:t,size:(1-v)*
y+v*u,label:r.label})):(r=z[u],C.push({value:t,opacity:(1-v)*q[u-1].opacity+v*r.opacity,label:r.label}))}c=[A,...C,f]}else{var [x,...w]=q;for(c=w.pop();6<w.length;){f=q=0;for(m=1;m<w.length;m++)l=Math.abs(w[m].value-w[m-1].value),l>f&&(f=l,q=m);w.splice(q,1)}c=[x,...w,c]}a.stops=c}return a})};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/ComplexSymbolSchema":function(){define("exports ../../../../../../../symbols/cim/CIMSymbolHelper ../../../../../../../symbols/cim/defaultCIMValues ../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry ../VisualVariablesSchema ./utils".split(" "),
function(e,g,p,h,k,n){function d(u){return u.minScale||u.maxScale?{minScale:u.minScale??0,maxScale:u.maxScale??0}:null}function b(u){if(null==u)return null;if(Array.isArray(u)){const [v,r,y,x]=u;return[v,r,y,255*x]}return"string"===typeof u?u:{...u,defaultValue:b(u?.defaultValue)}}function a(u,v,r,{scaleInfo:y,scaleExpression:x}){const w=n.hasSizeVVUniform(r);return[u.createMeshInfo({params:{size:v.size,scaleX:v.scaleX,anchorX:v.anchorPoint.x,anchorY:v.anchorPoint.y,angle:v.rotation,color:b(v.color)??
[0,0,0,0],colorLocked:v.colorLocked,frameHeight:v.frameHeight,widthRatio:v.widthRatio,scaleInfo:y,offsetX:v.offsetX,offsetY:v.offsetY,outlineColor:b(v.outlineColor)??[0,0,0,0],outlineSize:v.outlineWidth,referenceSize:v.referenceSize||p.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:v.rotateClockwise,scaleFactor:x??1,sizeRatio:v.sizeRatio,alignment:v.alignment,isAbsoluteAnchorPoint:v.isAbsoluteAnchorPoint,scaleSymbolsProportionally:v.scaleSymbolsProportionally,sprite:v.spriteRasterizationParam,
hasSizeVV:w,placement:v.markerPlacement,effects:v.effects?{type:"cim-effect-infos",effectInfos:v.effects}:null,transforms:v.transform,minPixelBuffer:k.getMaxSizeVVSize(r)}})]}function c(u,v,{scaleInfo:r}){return[u.createMeshInfo({params:{color:b(v.color)??[0,0,0,0],scaleInfo:r,effects:v.effects?{type:"cim-effect-infos",effectInfos:v.effects}:null}})]}function q(u,v,r,{scaleInfo:y}){if(!v.spriteRasterizationParam)throw Error("InternalError: Sprite should always be defined");r=!!v.hasUnresolvedReplacementColor&&
(!r||v.colorLocked);r=v.sampleAlphaOnly&&!r;const x=v.spriteRasterizationParam;return[u.createMeshInfo({params:{color:b(v.color)??[0,0,0,0],height:v.height,aspectRatio:v.scaleX,offsetX:v.offsetX,offsetY:v.offsetY,scaleX:1,scaleY:1,angle:v.angle,applyRandomOffset:v.applyRandomOffset,sampleAlphaOnly:r,scaleProportionally:"CIMHatchFill"===x.resource.type,sprite:x,scaleInfo:y,effects:v.effects?{type:"cim-effect-infos",effectInfos:v.effects}:null}})]}function f(u,v,{scaleInfo:r}){return{params:{color:b(u.color)??
[0,0,0,0],width:u.width,referenceWidth:u.referenceWidth,capType:u.cap,joinType:u.join,miterLimit:u.miterLimit,scaleInfo:r,hasSizeVV:v,effects:u.effects?{type:"cim-effect-infos",effectInfos:u.effects}:null}}}function t(u,v,r,y){if(v.spriteRasterizationParam)throw Error("InternalError: Sprite should not be defined");return[u.createMeshInfo({params:f(v,r,y).params})]}function m(u,v,r,y){const {spriteRasterizationParam:x,scaleDash:w,sampleAlphaOnly:A}=v;if(!x)throw Error("InternalError: Sprite should be defined");
return[u.createMeshInfo({params:{...f(v,r,y).params,shouldScaleDash:w??!1,shouldSampleAlphaOnly:A,isSDF:"CIMPictureStroke"!==x.resource.type,sprite:x}})]}function l(u,v,r,{scaleInfo:y,scaleExpression:x}){return[u.createMeshInfo({params:{boxBackgroundColor:b(v.backgroundColor),boxBorderLineColor:b(v.borderLineColor),boxBorderLineSize:v.borderLineWidth??0,color:b(v.color)??[0,0,0,0],offsetX:v.offsetX,offsetY:v.offsetY,postAngle:v.angle,fontSize:v.size,referenceSize:v.referenceSize,decoration:v.decoration,
haloColor:b(v.outlineColor)??[0,0,0,0],haloFontSize:v.outlineSize,lineWidth:v.lineWidth||512,lineHeightRatio:1,horizontalAlignment:v.horizontalAlignment??"center",verticalAlignment:v.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:v.textRasterizationParam,scaleInfo:y,effects:v.effects?{type:"cim-effect-infos",effectInfos:v.effects}:null,placement:v.markerPlacement,transforms:v.transform,scaleFactor:x??1,minPixelBuffer:k.getMaxSizeVVSize(r),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,
labelPosition:null,isLineLabel:!1}})]}e.createComplexFillMeshInfos=q;e.createComplexMarkerMeshInfos=a;e.createComplexSimpleFillMeshInfos=c;e.createComplexSimpleLineMeshInfos=t;e.createComplexSymbolInstances=async function(u,v){const {cimResourceManager:r,cimAnalyzer:y,scaleExpression:x}=v.schemaOptions;await Promise.all(g.CIMSymbolHelper.fetchResources(u.symbol,r,[]));var w=y.analyzeSymbolReference(u,!1);u={scaleInfo:d(u),scaleExpression:x};const A=[];for(const B of w)switch(B.type){case "marker":w=
A;var z=w.push;var C=B;var D=u;const {uniforms:I,schemaOptions:H}=v;var {store:F}=H;F=F.ensureInstance(h.Techniques.marker,{geometry:C.isOutline?{...k.noVisualVariables,visualVariableSizeScaleStops:I.visualVariableSizeOutlineScaleStops}:{visualVariableColor:I.visualVariableColor,visualVariableOpacity:I.visualVariableOpacity,visualVariableSizeMinMaxValue:I.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:I.visualVariableSizeScaleStops,visualVariableSizeStops:I.visualVariableSizeStops,visualVariableSizeUnitValue:I.visualVariableSizeUnitValue,
visualVariableRotation:I.visualVariableRotation}},{zoomRange:!!D.scaleInfo});C=a(F,C,I,D);z.call(w,...C);break;case "fill":w=A;z=w.push;a:{D=B;F=v;C=u;if(!D.spriteRasterizationParam){const {uniforms:J,schemaOptions:Q}=F;({store:F}=Q);F=F.ensureInstance(h.Techniques.fill,{geometry:{visualVariableColor:D.colorLocked?null:J.visualVariableColor,visualVariableOpacity:J.visualVariableOpacity}},{zoomRange:!!C.scaleInfo});C=c(F,D,C);break a}const {uniforms:R,schemaOptions:E}=F;({store:F}=E);F=F.ensureInstance(h.Techniques.complexFill,
{geometry:{visualVariableColor:D.colorLocked?null:R.visualVariableColor,visualVariableOpacity:R.visualVariableOpacity}},{zoomRange:!!C.scaleInfo});C=q(F,D,null!=R.visualVariableColor,C)}z.call(w,...C);break;case "line":w=A;z=w.push;{C=B;D=u;const {uniforms:R,schemaOptions:E}=v;var {store:G}=E;F=C.isOutline?{...k.noVisualVariables,visualVariableSizeScaleStops:R.visualVariableSizeOutlineScaleStops}:{visualVariableColor:C.colorLocked?null:R.visualVariableColor,visualVariableOpacity:R.visualVariableOpacity,
visualVariableSizeMinMaxValue:R.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:R.visualVariableSizeScaleStops,visualVariableSizeStops:R.visualVariableSizeStops,visualVariableSizeUnitValue:R.visualVariableSizeUnitValue};const J={geometry:F};F=!!(F.visualVariableSizeMinMaxValue||F.visualVariableSizeScaleStops||F.visualVariableSizeStops||F.visualVariableSizeUnitValue);C.spriteRasterizationParam?(G=G.ensureInstance(h.Techniques.texturedLine,J,{zoomRange:!!D.scaleInfo}),C=m(G,C,F,D)):(G=G.ensureInstance(h.Techniques.line,
J,{zoomRange:!!D.scaleInfo}),C=t(G,C,F,D))}z.call(w,...C);break;case "text":w=A;z=w.push;C=B;D=u;const {uniforms:K,schemaOptions:O}=v;({store:F}=O);F=F.ensureInstance(h.Techniques.text,{geometry:{visualVariableColor:C.colorLocked?null:K.visualVariableColor,visualVariableOpacity:K.visualVariableOpacity,visualVariableRotation:K.visualVariableRotation,visualVariableSizeMinMaxValue:K.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:K.visualVariableSizeScaleStops,visualVariableSizeStops:K.visualVariableSizeStops,
visualVariableSizeUnitValue:K.visualVariableSizeUnitValue}},{zoomRange:!!D.scaleInfo,referenceSymbol:!1,clipAngle:!1});C=l(F,C,K,D);z.call(w,...C)}return A};e.createComplexTextMeshInfos=l;e.createComplexTexturedLineMeshInfos=m;e.getScaleInfo=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/utils":function(){define(["exports"],function(e){e.hasRotationVVUniform=function(g){return!!g.visualVariableRotation};e.hasSizeVVUniform=
function(g){return!!(g.visualVariableSizeMinMaxValue||g.visualVariableSizeScaleStops||g.visualVariableSizeStops||g.visualVariableSizeUnitValue||g.visualVariableSizeOutlineScaleStops)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/createMeshWriter":function(){define(["exports","./instanceIdUtils","./MeshWriterInputEvaluator","./MeshWriterRegistry"],function(e,g,p,h){async function k(n,d,b,a,c,q,f){b=h.meshWriterRegistry[b];n=
await p.MeshWriterInputEvaluator.create(n,d,c);a=new b.constructor(a,n,q,f);await a.loadDependencies();return a}e.createMeshWriter=k;e.createMeshWriterDirect=async function(n,d,b,a,c,q){n=await p.MeshWriterInputEvaluator.create(n,d,c);b=new b(a,n,q,c.params.effects?.effectInfos);await b.loadDependencies();return b};e.createMeshWriterGroupFromSchema=async function(n,d,b,a){return Promise.all(b.map(c=>k(n,d,c.meshWriterName,g.castStrictInstanceId(c.id),c.options,a,c.optionalAttributes)))};Object.defineProperty(e,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils":function(){define(["exports"],function(e){e.castInstanceId=function(g){return g};e.castStrictInstanceId=function(g){return g};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define("exports ../../../../../../../core/arrayUtils ../../../../../../../core/Error ../../../../../../../core/lang ../../../../../../../core/Logger ../../../grouping ./utils ../../../../../layers/features/support/DictionaryValue".split(" "),
function(e,g,p,h,k,n,d,b){async function a(m,l,u=!1){const {defaultValue:v,valueExpressionInfo:r,value:y}=l;if(r){const {expression:x}=r;return(m=await m.createComputedField({expression:x},u))?{...l,computed:m,defaultValue:v}:null}return{...l,computed:new b.DictionaryValue(y),defaultValue:v}}async function c(m,l){const {defaultValue:u,valueExpressionInfo:v}=l,{expression:r}=v;return(m=await m.createComputedField({expression:r}))?{...l,computed:m,defaultValue:u}:null}const q=m=>"boolean"!==typeof m&&
"number"!==typeof m&&"valueExpressionInfo"in m,f=m=>m.some(l=>{for(const u in l)if(q(l[u]))return!0;return!1});class t{static async create(m,l,u){const v={},r=new Map,y=new Map,x=new Map,w=new Map,A=new Map;for(const C in u.params){const D=u.params[C];if(null==D||"object"!==typeof D)v[C]=D;else if(Array.isArray(D)){if("object"===typeof D[0])throw Error(`InternalError: Cannot handle ${C}. Nested array params are not supported`);v[C]=D}else if("valueExpressionInfo"in D)if(D.value)v[C]=D.value;else{var z=
await c(m,D);z?(r.set(C,z),v[C]=null):v[C]=D.defaultValue}else switch(D.type){case "cim-effect-infos":if(D.effectInfos.some(F=>F.overrides.length)){y.set(C,{effects:await Promise.all(D.effectInfos.map(async F=>{const G=F.overrides.map(B=>a(m,B));return{effect:F.effect,compiledOverrides:(await Promise.all(G)).filter(g.isSome)}}))});break}v[C]=D.effectInfos.map(F=>F.effect);break;case "cim-marker-placement-info":D.overrides.length&&x.set(C,{placementInfo:D,compiledOverrides:(await Promise.all(D.overrides.map(F=>
a(m,F)))).filter(g.isSome)});v[C]=D.placement;break;case "text-rasterization-param":if(D.overrides.length){z=D.overrides.map(F=>a(m,F,D.useLegacyLabelEvaluationRules));w.set(C,{compiledOverrides:(await Promise.all(z)).filter(g.isSome),rasterizationParam:D,objectIdToResourceId:new Map});continue}v[C]=await l.fetchResourceImmediate({type:"cim-rasterization-info",resource:D.resource})??null;break;case "sprite-rasterization-param":if(D.overrides.length){z=D.overrides.map(F=>a(m,F));w.set(C,{compiledOverrides:(await Promise.all(z)).filter(g.isSome),
rasterizationParam:D,objectIdToResourceId:new Map});continue}if("animated"===D.resource.type){w.set(C,{compiledOverrides:[],rasterizationParam:D,objectIdToResourceId:new Map});continue}v[C]=await l.fetchResourceImmediate({type:"cim-rasterization-info",resource:D.resource})??null;break;case "cim-marker-transform-param":({params:z}=D);if(f(z)){const F={compiledMarkerInfos:[]};await Promise.all(z.map(async G=>{const B={props:{}};for(const I in G)if(q(G[I])){const H=await c(m,G[I]);B.compiledExpressionMap||
(B.compiledExpressionMap=new Map);const K=B.compiledExpressionMap;H&&K.set(I,H)}else B.props[I]=G[I];F.compiledMarkerInfos.push(B)}));A.set(C,F)}else v[C]={type:"cim-marker-transform-info",infos:z};break;default:v[C]=D}}return new t(u,v,r,y,x,w,A)}constructor(m,l,u,v,r,y,x){this.inputMeshParams=m;this._resolvedMeshParams=l;this._dynamicProperties=u;this._dynamicEffectProperties=v;this._dynamicPlacementProperties=r;this._dynamicAsyncProperties=y;this._dynamicTransformProperties=x;this.evaluator=w=>
w}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size)}get evaluatedMeshParams(){this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams));return this._evaluatedMeshParams}enqueueRequest(m,l,u){for(const r of this._dynamicAsyncProperties.values()){var v=h.clone(r.rasterizationParam.resource);"animated"===
r.rasterizationParam.resource.type&&r.rasterizationParam.resource.randomizeStartTime&&(v.primitiveName="__RESERVED__PRIMITIVE__NAME__",v.startGroup=n.getStartGroup(l.getObjectId()||0));for(const {primitiveName:y,propertyName:x,computed:w,defaultValue:A,valueExpressionInfo:z}of r.compiledOverrides)try{d.applyComputedValue(v,"animated"===r.rasterizationParam.resource.type?v.primitiveName:y,x,w,l,u,A)}catch(C){k.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator").errorOnce(new p("invalid-arcade-expression",
`Encountered an error when evaluating the arcade expression '${z?.expression}' (primitive: '${y}', property: '${x}')`,C))}v=m.enqueueRequest({type:"cim-rasterization-info",resource:v});r.objectIdToResourceId.set(l.getObjectId(),v)}}evaluateMeshParams(m,l,u){for(const [y,x]of this._dynamicProperties.entries())this._resolvedMeshParams[y]=x.computed.readWithDefault(l,u,x.defaultValue);for(const [y,x]of this._dynamicPlacementProperties.entries())for(const {computed:w,defaultValue:A,propertyName:z}of x.compiledOverrides){var v=
w.readWithDefault(l,u,A);x.placementInfo.placement[z]=v;this._resolvedMeshParams[y]=x.placementInfo.placement}for(const [y,x]of this._dynamicEffectProperties.entries())for(var r of x.effects){for(const {computed:w,defaultValue:A,propertyName:z}of r.compiledOverrides)v=w.readWithDefault(l,u,A),r.effect[z]=v;this._resolvedMeshParams[y]=x.effects.map(w=>w.effect)}for(const [y,x]of this._dynamicTransformProperties.entries()){r={type:"cim-marker-transform-info",infos:[]};for(const w of x.compiledMarkerInfos){v=
{...w.props};if(w.compiledExpressionMap)for(const [A,z]of w.compiledExpressionMap){const C=z.computed.readWithDefault(l,u,z.defaultValue);v[A]="number"===typeof C||"boolean"===typeof C?C:z.defaultValue}r.infos.push(v)}this._resolvedMeshParams[y]=r}for(const [y,x]of this._dynamicAsyncProperties.entries())u=x.objectIdToResourceId.get(l.getObjectId()),null!=u&&(u=m.getResource(u),this._resolvedMeshParams[y]=u);this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams);return this.evaluatedMeshParams}}
e.MeshWriterInputEvaluator=t;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(e,g){class p extends g.AComputedField{constructor(h){super();this._value=h}resize(h){}read(h,k){return this._value}readWithDefault(h,k,n){return this._value}referencesScale(){return!1}referencesGeometry(){return!1}}e.DictionaryValue=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(e){class g{destroy(){}}e.AComputedField=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/StorageSchema":function(){define(["exports","../../../../../../core/arrayUtils","../../../../engine/webgl/enums","../../support/rendererUtils","../../../../../webgl/capabilities"],function(e,g,p,h,k){function n(t){switch(t){case "opacity":return p.VVBinding.OPACITY;
case "color":return p.VVBinding.COLOR;case "rotation":return p.VVBinding.ROTATION;case "size":return p.VVBinding.SIZE;default:return null}}function d(t){if(!t)return[];switch(t.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":return q(t);case "dot-density":return b(t);case "pie-chart":return a(t);case "heatmap":return c(t)}}function b(t){const m=[];for(const l of t.attributes)m.push({binding:m.length,expression:l.valueExpression,field:l.field});return m}function a(t){const m=
q(t);let l=4;for(const u of t.attributes)m.push({binding:l++,expression:u.valueExpression,field:u.field});return m}function c({valueExpression:t,field:m}){return t||m?[{binding:0,expression:t,field:m}]:[]}function q(t){return"visualVariables"in t&&t.visualVariables?.length?h.simplifyVisualVariables(t.visualVariables).map(m=>f(m)).filter(g.isSome):[]}function f(t){switch(t.type){case "size":return t="$view.scale"===t.valueExpression?null:{binding:n(t.type),field:t.field,normalizationField:t.normalizationField,
expression:t.valueExpression,valueRepresentation:t.valueRepresentation},t;case "color":return{binding:n(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression};case "opacity":return{binding:n(t.type),field:t.field,normalizationField:t.normalizationField,expression:t.valueExpression};case "rotation":return{binding:n(t.type),expression:t.valueExpression,field:t.field}}}e.createDotDensityBindings=b;e.createHeatmapBindings=c;e.createPieChartBindings=a;e.createStorageSchema=
function(t,m){const l=k.getWebGLCapabilities();return{type:"simple",filters:m,capabilities:{maxTextureSize:l.maxTextureSize},bindings:d(t)}};e.createVVBindings=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("exports ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/diffUtils ../../../engine/highlightReasons ../../../engine/webgl/definitions ../../../engine/webgl/DisplayId ../../../engine/webgl/Utils ../../../engine/webgl/shaderGraph/techniques/shaders/constants ../../../engine/webgl/util/debug ./DisplayIdGenerator ./FeatureFilter ../../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m){function l(w,A){if(!w||!A)return w;switch(A){case "radius":case "distance":return 2*w;case "area":return Math.sqrt(w)}return w}const u=()=>h.getLogger("esri.views.layers.2d.features.support.AttributeStore"),v=q.createDebugLogger(q.DEBUG_ATTR_UPDATES,u());var r=p("esri-shared-array-buffer");p("esri-atomics");class y{constructor(w,A,z){this.size=0;this.texelSize=4;this.dirtyEnd=this.dirtyStart=0;const {pixelType:C,layout:D,textureOnly:F}=A;this.textureOnly=F||!1;
this.pixelType=C;this.layout=D;this._resetRange();this.size=w;this.isLocal=z;F||(this.data=this._initData(C,w))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(w,A){const z=this.data;for(let C=0;C<this.size*this.size;C++)z[C*this.texelSize+w]&=~A;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(w,A){const z=this.data;for(let C=0;C<this.size*this.size;C++)z[C*this.texelSize+w]|=255&A;this.dirtyStart=0;this.dirtyEnd=this.size*this.size-1}setComponent(w,A,z){const C=
this.data;for(const D of z)C[D*this.texelSize+w]|=A,this.dirtyStart=Math.min(this.dirtyStart,D),this.dirtyEnd=Math.max(this.dirtyEnd,D)}setComponentTexel(w,A,z){this.data[z*this.texelSize+w]|=A;this.dirtyStart=Math.min(this.dirtyStart,z);this.dirtyEnd=Math.max(this.dirtyEnd,z)}unsetComponentTexel(w,A,z){this.data[z*this.texelSize+w]&=~A;this.dirtyStart=Math.min(this.dirtyStart,z);this.dirtyEnd=Math.max(this.dirtyEnd,z)}getData(w,A){w=b.getDisplayIdTexel(w);return this.data[w*this.texelSize+A]}setData(w,
A,z){w=b.getDisplayIdTexel(w);0===(this.layout&1<<A)?u().error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):null!=this.data&&(this.data[w*this.texelSize+A]=z,this.dirtyStart=Math.min(this.dirtyStart,w),this.dirtyEnd=Math.max(this.dirtyEnd,w))}expand(w){this.size=w;this.textureOnly||(w=this._initData(this.pixelType,w),w.set(this.data),this.data=w)}toMessage(){const w=this.dirtyStart,A=this.dirtyEnd;var z=this.texelSize;if(w>A)return null;this._resetRange();const C=
this.pixelType,D=this.layout,F=this.data;z=!this.isLocal&&F.slice(w*z,(A+1)*z)||null;return{start:w,end:A,data:z,pixelType:C,layout:D}}_initData(w,A){var z=ArrayBuffer;w=a.getPixelArrayCtor(w);A=new w(new z(A*A*4*w.BYTES_PER_ELEMENT));for(z=0;z<A.length;z+=4)A[z+1]=255;return A}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}}class x{constructor(w){this._client=w;this._filters=[];this._blocks=[];this._attributeComputeInfo=null;this._abortController=new AbortController;this._size=d.attributeStoreInitialSize;
this._idsToHighlight=new Map;this._initialized=this._referencesGeometry=this._referencesScale=!1;this.version=0;this._idGenerator=new f.DisplayIdGenerator;this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null==this._blockDescriptors){var w=m.PixelType.FLOAT;v(`Creating AttributeStore ${r?"with":"without"} shared memory`);this._blockDescriptors=[{pixelType:m.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:m.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:m.PixelType.UNSIGNED_BYTE,
layout:15,textureOnly:!0},{pixelType:w,layout:15},{pixelType:w,layout:15},{pixelType:w,layout:15},{pixelType:w,layout:15}];this._blocks=this._blockDescriptors.map(()=>null)}}get referencesScale(){return this._referencesScale}get referencesGeometry(){return this._referencesGeometry}get _signal(){return this._abortController.signal}get hasHighlight(){return 0<this._idsToHighlight.size}createDisplayIdForObjectId(w){return this._idGenerator.createIdForObjectId(w)}releaseDisplayIdForObjectId(w){return this._idGenerator.releaseIdForObjectId(w)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}releaseAllIds(){this._idGenerator.releaseAll()}async update(w,
A,z,C,D=0){const F=k.diff(this._schema,w);this.version=D;if(F&&(p("esri-2d-update-debug")&&console.debug(`Version[${D}] AttributeStore.update`,{changed:F}),this._schema=w,this._attributeComputeInfo=null,this._initialize(),null!=w))if(z&&(this._filters=await Promise.all(w.filters.map(G=>G?t.create({geometryType:z.geometryType,hasM:!1,hasZ:!1,timeInfo:z.timeInfo,fieldsIndex:z.fieldsIndex,spatialReference:C??z.spatialReference,filterJSON:G}):null))),"subtype"===w.type){this._attributeComputeInfo={isSubtype:!0,
subtypeField:w.subtypeField,map:new Map};this._referencesGeometry=this._referencesScale=!1;for(const G in w.bindings)await Promise.all(w.bindings[G].map(async B=>{B=await this._bind(A,B,parseInt(G,10));this._referencesGeometry=this._referencesGeometry||(B?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(B?.referencesScale()??!1)}))}else this._attributeComputeInfo={isSubtype:!1,map:new Map},await Promise.all(w.bindings.map(async G=>{G=await this._bind(A,G);this._referencesGeometry=
this._referencesGeometry||(G?.referencesGeometry()??!1);this._referencesScale=this._referencesScale||(G?.referencesScale()??!1)}))}setHighlight(w,A){const z=this._getBlock(0);z.unsetComponentAllTexels(0,(1<<n.highlightReasons.length)-1);for(const {displayId:C,highlightFlags:D}of w){if(null==C)continue;const F=b.getDisplayIdTexel(C);z.setComponent(0,D,[F])}this._idsToHighlight.clear();for(const {objectId:C,highlightFlags:D}of w)this._idsToHighlight.set(C,D);for(const {objectId:C,highlightFlags:D}of A)this._idsToHighlight.set(C,
D)}setData(w,A,z,C){const D=b.getDisplayIdTexel(w);this._ensureSizeForTexel(D);this._getBlock(A).setData(w,z,C)}getData(w,A,z){return this._getBlock(A).getData(w,z)}getHighlightFlags(w){return this._idsToHighlight.get(w)||0}unsetAttributeData(w){w=b.getDisplayIdTexel(w);this._getBlock(0).setData(w,0,0)}setAttributeData(w,A,z){const C=b.getDisplayIdTexel(w);this._ensureSizeForTexel(C);this._getBlock(0).setData(C,0,this.getFilterFlags(A));w=this._attributeComputeInfo;let D=null;w&&(D=w.isSubtype?w.map.get(A.readAttribute(w.subtypeField)):
w.map,D?.size&&D.forEach((F,G)=>{const B=1*G%4;G=this._getBlock(Math.floor(1*G/4)+d.AttributeDataType.VV);let I=F.field?.read(A,z);F.valueRepresentation&&(I=l(I,F.valueRepresentation));if(null===I||isNaN(I)||Infinity===I||-Infinity===I)I=c.nanMagicNumber;G.setData(C,B,I)}))}get epoch(){return this._epoch}async sendUpdates(){const w=this._blocks.map(z=>null!=z?z.toMessage():null),A=this._getInitArgs();p("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start");await this._client.update({initArgs:A,
blockData:w,version:this.version,sendUpdateEpoch:this._epoch},this._signal);this._epoch+=1;p("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(w){for(;w>=this._size*this._size&&!this._expand(););}async _bind(w,A,z){w=await w.createComputedField(A);const {valueRepresentation:C}=A,D=this._attributeComputeInfo;if(D.isSubtype){const F=D.map.get(z)??new Map;F.set(A.binding,{field:w,valueRepresentation:C});D.map.set(z,F)}else D.map.set(A.binding,{field:w,valueRepresentation:C});
return w}_getInitArgs(){if(this._initialized)return null;this._initialized=!0;this._getBlock(d.AttributeDataType.Animation);this._getBlock(d.AttributeDataType.GPGPU);return{blockSize:this._size,blockDescriptors:this._blocks.map(w=>null!=w?{textureOnly:w.textureOnly,buffer:w.buffer,pixelType:w.pixelType}:null)}}_getBlock(w){var A=this._blocks[w];if(null!=A)return A;v(`Initializing AttributeBlock at index ${w}`);A=new y(this._size,this._blockDescriptors[w],this._client.isLocal);this._blocks[w]=A;this._initialized=
!1;return A}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const w=this._size<<=1;v("Expanding block size to",w,this._blocks);for(const A of this._blocks)A?.expand(w);this._initialized=!1;this._size=w;return 0}u().error(new g("mapview-limitations","Maximum number of onscreen features exceeded."));return-1}isVisible(w){return!!(this._getBlock(0).getData(w,0)&1<<n.highlightReasons.length)}getFilterFlags(w){let A=0;for(var z=0;z<this._filters.length;z++){var C=this._filters[z];C=!(1<<
z)||null==C||C.check(w);A|=(C?1:0)<<z}z=0;this._idsToHighlight.size&&(w=w.getObjectId(),z=this.getHighlightFlags(w));return A<<n.highlightReasons.length|z}}e.AttributeStore=x;e.getVisualVariableSizeValueRepresentationRatio=l;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(e){e.DEBUG_ATTR_UPDATES=!1;e.createDebugLogger=(g,p)=>g&&((...h)=>p.warn("DEBUG:",...h))||(()=>null);Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(e,g){class p{constructor(k){this.data=k;this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){--this._referenceCount}empty(){return 0===this._referenceCount}}class h{constructor(){this._freeIdsGenerationA=[];this._freeIdsGenerationB=[];this._idCounter=1;this._freeIds=this._freeIdsGenerationA;this._objectIdToDisplayId=new Map}createIdForObjectId(k){let n=
this._objectIdToDisplayId.get(k);n?n.increment():(n=new p(g.createDisplayId(this._getFreeId(),!1)),n.increment(),this._objectIdToDisplayId.set(k,n));return n.data}releaseIdForObjectId(k){const n=this._objectIdToDisplayId.get(k);n&&(n.decrement(),n.empty()&&(this._objectIdToDisplayId.delete(k),this._freeIds.push(n.data)))}releaseAll(){for(const k of this._objectIdToDisplayId.values())this._freeIds.push(k.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?
this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}e.DisplayIdGenerator=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilter":function(){define("../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingRect ../../../../../geometry/support/boundsUtils ../../../../../layers/graphics/data/queryUtils ../../../../../layers/graphics/data/spatialQuerySupport ../../../../../layers/graphics/data/timeSupport ../../../../../rest/support/Query ../FeatureStoreQueryAdapter ./whereUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c){class q{constructor(f){this._geometryBounds=p.create();this._idToVisibility=new Map;this._serviceInfo=f}static async create(f){const t=new q(f);await t.update(f.filterJSON,f.spatialReference);return t}get hash(){return this._hash}check(f){return this._applyFilter(f)}clear(){const f=this._resetAllHiddenIds();this.update();return{show:f,hide:[]}}invalidate(){this._idToVisibility.forEach((f,t)=>{this._idToVisibility.set(t,0)})}setKnownIds(f){for(const t of f)this._idToVisibility.set(t,
1)}setTrue(f){const t=[],m=[],l=new Set(f);this._idToVisibility.forEach((u,v)=>{u=!!(this._idToVisibility.get(v)&1);const r=l.has(v);!u&&r?t.push(v):u&&!r&&m.push(v);this._idToVisibility.set(v,r?3:0)});return{show:t,hide:m}}createQuery(){const {geometry:f,spatialRel:t,where:m,timeExtent:l,objectIds:u}=this;return b.fromJSON({geometry:f,spatialRel:t,where:m,timeExtent:l,objectIds:u})}async update(f,t){this._hash=JSON.stringify(f);f=await k.normalizeQueryLike(f,null,t);await Promise.all([this._setGeometryFilter(f),
this._setIdFilter(f),this._setAttributeFilter(f),this._setTimeFilter(f)])}async _setAttributeFilter(f){f?.where?(this._clause=await c.createWhereClause(f.where,this._serviceInfo.fieldsIndex),this.where=f.where):this.where=this._clause=null}_setIdFilter(f){this._idsToShow=f?.objectIds&&new Set(f.objectIds);this._idsToHide=f?.hiddenIds&&new Set(f.hiddenIds);this.objectIds=f?.objectIds}async _setGeometryFilter(f){if(f?.geometry){var t=f.geometry;f=f.spatialRel||"esriSpatialRelIntersects";var m=await n.getSpatialQueryOperator(f,
t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);h.getBoundsXY(this._geometryBounds,t);this._spatialQueryOperator=m;this.geometry=t;this.spatialRel=f}else this.spatialRel=this.geometry=this._spatialQueryOperator=null}_setTimeFilter(f){this.timeExtent=this._timeOperator=null;f?.timeExtent&&(this._serviceInfo.timeInfo?(this.timeExtent=f.timeExtent,this._timeOperator=d.getTimeOperator(this._serviceInfo.timeInfo,f.timeExtent,a.FeatureStoreQueryAdapter.Shared)):(f=new e("feature-layer-view:time-filter-not-available",
"Unable to apply time filter, as layer doesn't have time metadata.",f.timeExtent),g.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(f)))}_applyFilter(f){return this._filterByGeometry(f)&&this._filterById(f)&&this._filterByTime(f)&&this._filterByExpression(f)}_filterByExpression(f){return this.where?this._clause(f):!0}_filterById(f){return(!this._idsToHide?.size||!this._idsToHide.has(f.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(f.getObjectId()))}_filterByGeometry(f){return this.geometry?
(f=f.readGeometryWorldSpace())?this._spatialQueryOperator(f):!1:!0}_filterByTime(f){return null==this._timeOperator?!0:this._timeOperator(f)}_resetAllHiddenIds(){const f=[];this._idToVisibility.forEach((t,m)=>{t&1||(this._idToVisibility.set(m,1),f.push(m))});return f}}return q})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),
function(e,g,p,h,k,n,d,b,a,c){async function q(v,r,y){if(!v)return null;var {where:x}=v;v.where=x=x?.trim();if(!x||/^1 *= *1$/.test(x)||r&&r===x)v.where=null;if(!v.geometry)return v;r=await t(v);v.distance=0;v.units=null;"esriSpatialRelEnvelopeIntersects"===v.spatialRel&&({spatialReference:x}=v.geometry,r=n.getGeometryExtent(r),r.spatialReference=x);if(r){await c.checkProjectionSupport(r.spatialReference,y);x=r.spatialReference;r=f(r,y)&&d.isExtent(r)?{spatialReference:x,rings:[[[r.xmin,r.ymin],[r.xmin,
r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]}:r;x=(await b.normalizeCentralMeridian(d.fromJSON(r)))[0];if(null==x)throw u;const w="quantizationParameters"in v&&v.quantizationParameters?.tolerance||"maxAllowableOffset"in v&&v.maxAllowableOffset||0;r=w&&f(r,y)?{densificationStep:8*w}:void 0;x=x.toJSON();r=c.project(x,x.spatialReference,y,r);if(!r)throw u;r.spatialReference=y;v.geometry=r}return v}function f(v,r){if(!v)return!1;const y=v.spatialReference;return(d.isExtent(v)||d.isPolygon(v)||
d.isPolyline(v))&&!a.equals(y,r)&&!k.canProjectWithoutEngine(y,r)}async function t(v){const {distance:r,units:y}=v,x=v.geometry;if(null==r||"vertexAttributes"in x)return x;var w=x.spatialReference;v=y?l.fromJSON(y):h.getUnitString(w);w=w&&(a.isGeographic(w)||a.isWebMercator(w))?x:await c.checkProjectionSupport(w,a.wgs84).then(()=>c.project(x,a.wgs84));return(await m())(w.spatialReference,w,r,v)}async function m(){return(await new Promise((v,r)=>e(["../../../geometry/geometryEngineJSON"],v,r))).geodesicBuffer}
const l=new p.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),u=Object.freeze({});g.normalizeQuery=async function(v,r,y){const {outFields:x,orderByFields:w,groupByFieldsForStatistics:A,outStatistics:z}=v;if(x)for(var C=0;C<x.length;C++)x[C]=x[C].trim();if(w)for(C=0;C<w.length;C++)w[C]=w[C].trim();if(A)for(C=0;C<A.length;C++)A[C]=A[C].trim();
if(z)for(C=0;C<z.length;C++)z[C].onStatisticField&&(z[C].onStatisticField=z[C].onStatisticField.trim());v.geometry&&!v.outSR&&(v.outSR=v.geometry.spatialReference);return q(v,r,y)};g.normalizeQueryLike=q;g.queryEngineEmptyResult=u;g.unitsKebabDict=l;Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(e,g,p,h,k,n,d){function b(u,v){if(!v)return null;if("x"in v){var r={x:0,y:0};[r.x,r.y]=u(v.x,v.y,q);null!=v.z&&(r.z=v.z);null!=v.m&&(r.m=v.m);return r}return"xmin"in v?(r={xmin:0,ymin:0,xmax:0,ymax:0},[r.xmin,r.ymin]=u(v.xmin,v.ymin,q),[r.xmax,r.ymax]=u(v.xmax,v.ymax,q),v.hasZ&&(r.zmin=v.zmin,r.zmax=v.zmax,r.hasZ=!0),v.hasM&&(r.mmin=v.mmin,r.mmax=v.mmax,r.hasM=!0),r):"rings"in v?{rings:a(v.rings,u),hasM:v.hasM,hasZ:v.hasZ}:"paths"in v?{paths:a(v.paths,u),hasM:v.hasM,hasZ:v.hasZ}:"points"in
v?{points:c(v.points,u),hasM:v.hasM,hasZ:v.hasZ}:null}function a(u,v){const r=[];for(const y of u)r.push(c(y,v));return r}function c(u,v){const r=[];for(const y of u)u=v(y[0],y[1],[0,0]),r.push(u),2<y.length&&u.push(y[2]),3<y.length&&u.push(y[3]);return r}const q=[0,0],f=b.bind(null,d.lngLatToXY),t=b.bind(null,d.xyToLngLat);class m{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(u,v,r,y){if(!u?.length||!v||!r||n.equals(v,r))return u;u={geometries:u,inSpatialReference:v,
outSpatialReference:r,geographicTransformation:y,resolve:p.createResolver()};this._jobs.push(u);this._timer??(this._timer=setTimeout(this._process,10));return u.resolve.promise}_process(){this._timer=null;const u=this._jobs.shift();if(u){var {geometries:v,inSpatialReference:r,outSpatialReference:y,resolve:x,geographicTransformation:w}=u;d.canProject(r,y)?n.isWebMercator(y)?x(v.map(f)):x(v.map(t)):x(h.projectMany(k.jsonAdapter,v,r,y,w,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,
10))}}}const l=new m;e.checkProjectionSupport=async function(u,v){u&&v&&(u=Array.isArray(u)?u.map(r=>null!=r.geometry?r.geometry.spatialReference:null).filter(g.isSome):[u],await h.initializeProjection(u.map(r=>({source:r,dest:v}))))};e.project=function(u,v,r,y){if(!u)return u;r||(r=v,v=u.spatialReference);return n.isValid(v)&&n.isValid(r)&&!n.equals(v,r)?d.canProject(v,r)?(u=n.isWebMercator(r)?f(u):t(u),u.spatialReference=r,u):h.projectMany(k.jsonAdapter,[u],v,r,null,y)[0]:u};e.projectMany=function(u,
v,r,y){return l.push(u,v,r,y)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){class g{constructor(d,b,a){this.x=d;this.y=b;this.spatialReference=a;this.m=this.z=void 0}}class p{constructor(d,b,a,c){this.rings=d;this.spatialReference=b;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);c&&(this.hasM=c)}}class h{constructor(d,b,a,c){this.paths=d;this.spatialReference=b;this.hasM=this.hasZ=void 0;a&&(this.hasZ=
a);c&&(this.hasM=c)}}class k{constructor(d,b,a,c){this.points=d;this.spatialReference=b;this.hasM=this.hasZ=void 0;a&&(this.hasZ=a);c&&(this.hasM=c)}}class n{constructor(d,b,a,c,q){this.xmin=d;this.ymin=b;this.xmax=a;this.ymax=c;this.spatialReference=q;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}e.jsonAdapter={convertToGEGeometry:function(d,b){return null==b?null:d.convertJSONToGeometry(b)},exportPoint:function(d,b,a){a=new g(d.getPointX(b),d.getPointY(b),a);const c=d.hasZ(b),q=d.hasM(b);c&&(a.z=
d.getPointZ(b));q&&(a.m=d.getPointM(b));return a},exportPolygon:function(d,b,a){return new p(d.exportPaths(b),a,d.hasZ(b),d.hasM(b))},exportPolyline:function(d,b,a){return new h(d.exportPaths(b),a,d.hasZ(b),d.hasM(b))},exportMultipoint:function(d,b,a){return new k(d.exportPoints(b),a,d.hasZ(b),d.hasM(b))},exportExtent:function(d,b,a){var c=d.hasZ(b);const q=d.hasM(b);a=new n(d.getXMin(b),d.getYMin(b),d.getXMax(b),d.getYMax(b),a);c&&(c=d.getZExtent(b),a.zmin=c.vmin,a.zmax=c.vmax);q&&(d=d.getMExtent(b),
a.mmin=d.vmin,a.mmax=d.vmax);return a}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(e,g,p,h,k,n,d,b,a,c,q,
f){function t(){return new Promise((r,y)=>e(["../../../geometry/geometryEngineJSON"],r,y))}const m={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var l={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,
esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},u={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},v={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};g.canQueryWithRBush=function(r){if(n.isExtent(r))return!0;
if(n.isPolygon(r)){for(const y of r.rings)if(5!==y.length||y[0][0]!==y[1][0]||y[0][0]!==y[4][0]||y[2][0]!==y[3][0]||y[0][1]!==y[3][1]||y[0][1]!==y[4][1]||y[1][1]!==y[2][1])return!1;return!0}return!1};g.checkSpatialQuerySupport=async function(r,y,x){const {spatialRel:w,geometry:A}=r;if(A){if(null==w||!0!==l[w])throw new p("unsupported-query","Unsupported query spatial relationship",{query:r});if(d.isValid(A.spatialReference)&&d.isValid(x)){if(null==A||!0!==u[n.getJsonType(A)])throw new p("unsupported-query",
"Unsupported query geometry type",{query:r});if(null==y||!0!==v[y])throw new p("unsupported-query","Unsupported layer geometry type",{query:r});if(r.outSR)return f.checkProjectionSupport(r.geometry?.spatialReference,r.outSR)}}};g.getSpatialQueryOperator=function(r,y,x,w,A){if(n.isPolygon(y)&&"esriGeometryPoint"===x&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r)){const z=a.convertFromPolygon(new c,y,!1,!1);return Promise.resolve(C=>b.polygonContainsPoint(z,!1,!1,C))}if(n.isPolygon(y)&&
"esriGeometryMultipoint"===x){const z=a.convertFromPolygon(new c,y,!1,!1);if("esriSpatialRelContains"===r)return Promise.resolve(C=>b.polygonContainsMultipoint(z,!1,!1,C,w,A))}if(n.isExtent(y)&&"esriGeometryPoint"===x&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))return Promise.resolve(z=>h.extentContainsPoint(y,q.getGeometry(x,w,A,z)));if(n.isExtent(y)&&"esriGeometryMultipoint"===x&&"esriSpatialRelContains"===r)return Promise.resolve(z=>h.extentContainsMultipoint(y,q.getGeometry(x,
w,A,z)));if(n.isExtent(y)&&"esriSpatialRelIntersects"===r){const z=k.getExtentIntersector(x);return Promise.resolve(C=>z(y,q.getGeometry(x,w,A,C)))}return t().then(z=>{const C=z[m[r]].bind(null,y.spatialReference,y);return D=>C(q.getGeometry(x,w,A,D))})};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,g){e.extentIntersectsExtent=g.extentIntersectsExtent;e.extentIntersectsMultipoint=g.extentIntersectsMultipoint;
e.extentIntersectsPoint=g.extentIntersectsPoint;e.extentIntersectsPolygon=g.extentIntersectsPolygon;e.extentIntersectsPolyline=g.extentIntersectsPolyline;e.getFeatureExtentIntersector=g.getFeatureExtentIntersector;e.isSelfIntersecting=g.isSelfIntersecting;e.segmentIntersects=g.segmentIntersects;e.getExtentIntersector=function(p){return"mesh"===p?g.extentIntersectsExtent:g.getFeatureExtentIntersector(p)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],
function(e){function g(p,h,k,n,d){if(!p)return!1;h=h?k?4:3:k?3:2;const {coords:b,lengths:a}=p;k=!1;p=0;for(const q of a){var c=p;for(let f=p,t=p+q*h;f<t;f+=h){c=f+h;c===t&&(c=p);const m=b[f],l=b[f+1],u=b[c];c=b[c+1];(l<d&&c>=d||c<d&&l>=d)&&m+(d-l)/(c-l)*(u-m)<n&&(k=!k)}p+=q*h}return k}e.polygonContainsCoords=g;e.polygonContainsMultipoint=function(p,h,k,n,d,b){d=d?b?4:3:b?3:2;const {coords:a,lengths:c}=n;if(!c)return!1;for(let q=0,f=0;q<c.length;q++,f+=d)if(!g(p,h,k,a[f],a[f+1]))return!1;return!0};
e.polygonContainsPoint=function(p,h,k,n){return g(p,h,k,n.coords[0],n.coords[1])};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,g,p){const h=new p,k=new p,n=new p,d={esriGeometryPoint:g.convertToPoint,esriGeometryPolyline:g.convertToPolyline,esriGeometryPolygon:g.convertToPolygon,esriGeometryMultipoint:g.convertToMultipoint},b=(a,c)=>"_geVersion"!==
a?c:void 0;e.cleanFromGeometryEngine=function(a){return a&&"_geVersion"in a?JSON.parse(JSON.stringify(a,b)):a};e.getGeometry=function(a,c,q,f,t,m,l=c,u=q){const v=c&&l,r=q&&u;f=null!=f?"coords"in f?f:f.geometry:null;if(null==f)return null;if(t)return c=g.generalizeOptimizedGeometry(k,f,c,q,a,t,l,u),m&&(c=g.quantizeOptimizedGeometry(n,c,v,r,a,m)),d[a]?.(c,v,r)??null;if(m)return m=g.quantizeOptimizedGeometry(n,f,c,q,a,m,l,u),d[a]?.(m,v,r)??null;g.removeZMValues(h,f,c,q,l,u);return d[a]?.(h,v,r)??null};
e.transformCentroid=function(a,c,q,f=a.hasZ,t=a.hasM){if(null==c)return null;const m=a.hasZ&&f,l=a.hasM&&t;return q?(a=g.quantizeOptimizedGeometry(n,c,a.hasZ,a.hasM,"esriGeometryPoint",q,f,t),g.convertToPoint(a,m,l)):g.convertToPoint(c,m,l)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(e){function g(k,n,d,b,a){if(null!=b&&null!=a)return c=>{const q=k(c,n);c=k(c,d);return(null==q||q<=a)&&(null==c||c>=
b)};if(null!=b)return c=>{c=k(c,d);return null==c||c>=b};if(null!=a)return c=>{c=k(c,n);return null==c||c<=a}}function p(k,n,d,b){if(null!=d&&null!=b&&d===b)return a=>k(a,n)===d;if(null!=d&&null!=b)return a=>{a=k(a,n);return null!=a&&a>=d&&a<=b};if(null!=d)return a=>{a=k(a,n);return null!=a&&a>=d};if(null!=b)return a=>{a=k(a,n);return null!=a&&a<=b}}function h(){return()=>!1}e.getTimeExtent=async function(k,n){if(!k)return null;const d=n.featureAdapter,{startTimeField:b,endTimeField:a}=k;let c=Number.POSITIVE_INFINITY,
q=Number.NEGATIVE_INFINITY;if(b&&a)await n.forEach(f=>{const t=d.getAttribute(f,b);f=d.getAttribute(f,a);null==t||isNaN(t)||(c=Math.min(c,t));null==f||isNaN(f)||(q=Math.max(q,f))});else{const f=b||a;await n.forEach(t=>{t=d.getAttribute(t,f);null==t||isNaN(t)||(c=Math.min(c,t),q=Math.max(q,t))})}return{start:c,end:q}};e.getTimeOperator=function(k,n,d){if(!n||!k)return null;const {startTimeField:b,endTimeField:a}=k;if(!b&&!a)return null;const {start:c,end:q}=n;if(null===c&&null===q)return null;if(void 0===
c&&void 0===q)return h();k=d.getAttributeAsTimestamp?.bind(d)??d.getAttribute.bind(d);return b&&a?g(k,b,a,c,q):p(k,b||a,c,q)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports"],function(e){class g{getObjectId(p){return p.getObjectId()}getAttributes(p){return p.readAttributes()}getAttribute(p,h){return p.readAttribute(h)}getAttributeAsTimestamp(p,h){return p.readAttributeAsTimestamp(h)}cloneWithGeometry(p,
h){return p}getGeometry(p){return p.readGeometryWorldSpace()}getCentroid(p,h){return p.readCentroidForDisplay()}}g.Shared=new g;e.FeatureStoreQueryAdapter=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(e,g,p,h){const k=()=>p.getLogger("esri.views.2d.layers.features.support.whereUtils"),n={getAttribute(d,b){return d.readAttribute(b)}};
e.createWhereClause=async function(d,b){try{const a=await h.parseWhereClause(d,b);if(!a.isStandardized){const c=new g("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a);k().error(c)}return c=>{c=c.readArcadeFeature();try{return a.testFeature(c,n)}catch(q){return k().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",d),!0}}}catch(a){return k().warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",
d),c=>!0}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define("exports ../../../../../core/Error ../../../../../core/Logger ../../../../../geometry/support/aaBoundingBox ../../../engine/webgl/DisplayId ./CachedField ./ComputedExpression ./ComputedLegacyLabelExpression ./NormalizedField ./StaticBitSet ./whereUtils".split(" "),function(e,g,p,h,k,n,d,b,a,c,q){function f(l,u,v){if(!(l.length>u))for(;l.length<=
u;)l.push(v)}const t=()=>p.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage");class m{constructor(l){this._numerics=[];this._strings=[];this._allocatedSize=256;this._bitsets=[];this._instanceIds=[];this._bounds=[];this._dirtyBitset=this.getBitset(this.createBitset());this.compilationOptions=l}createBitset(){const l=this._bitsets.length;this._bitsets.push(c.StaticBitSet.create(this._allocatedSize,k.displayIdTexelMask));return l+1}async createComputedField(l,u=!1){if(l.expression)try{if(!this.compilationOptions)throw Error("InternalError: Compilation options not defined");
return u?b.ComputedLegacyLabelExpression.create(l.expression,this.compilationOptions):await d.ComputedExpression.create(l.expression,this.compilationOptions)}catch(v){return l=new g("featurelayer","Failed to compile arcade expression",{error:v,expression:l.expression}),t().error(l),null}if(l.normalizationType||l.normalizationField)return new a.NormalizedField(l.field,l);if(l.field)return new n.CachedField(l.field);l=new g("featurelayer","Unable to create computed field. No expression or field found",
{info:l});t().error(l);return null}async createWhereClause(l){return l?q.createWhereClause(l,this.compilationOptions.fields):null}getBitset(l){return this._bitsets[l-1]}getComputedNumeric(l,u){return this.getComputedNumericAtIndex(l&k.displayIdTexelMask,0)}setComputedNumeric(l,u,v){return this.setComputedNumericAtIndex(l&k.displayIdTexelMask,v,0)}getComputedString(l,u){return this.getComputedStringAtIndex(l&k.displayIdTexelMask,0)}setComputedString(l,u,v){return this.setComputedStringAtIndex(l&k.displayIdTexelMask,
0,v)}getComputedNumericAtIndex(l,u){l&=k.displayIdTexelMask;this._ensureNumeric(u,l);return this._numerics[u][l]}setComputedNumericAtIndex(l,u,v){l&=k.displayIdTexelMask;this._ensureNumeric(u,l);this._numerics[u][l]=v}getPackedChunkId(l){l&=k.displayIdTexelMask;this._ensureInstanceId(l);return this._instanceIds[l]}setPackedChunkId(l,u){l&=k.displayIdTexelMask;this._ensureInstanceId(l);this._instanceIds[l]=u}getComputedStringAtIndex(l,u){l&=k.displayIdTexelMask;this._ensureString(u,l);return this._strings[u][l]}setComputedStringAtIndex(l,
u,v){l&=k.displayIdTexelMask;this._ensureString(u,l);this._strings[u][l]=v}getXMin(l){return this._bounds[4*(l&k.displayIdTexelMask)]}getYMin(l){return this._bounds[4*(l&k.displayIdTexelMask)+1]}getXMax(l){return this._bounds[4*(l&k.displayIdTexelMask)+2]}getYMax(l){return this._bounds[4*(l&k.displayIdTexelMask)+3]}setBounds(l,u,v=!1){const r=l&k.displayIdTexelMask;if(!v&&!this._dirtyBitset.has(l))return 4294967295!==this._bounds[4*r];this._dirtyBitset.unset(l);l=u.readGeometryWorldSpace();f(this._bounds,
4*r+4,0);if(!l||!l.coords.length)return this._bounds[4*r]=4294967295,this._bounds[4*r+1]=4294967295,this._bounds[4*r+2]=4294967295,this._bounds[4*r+3]=4294967295,!1;let y=Infinity,x=Infinity,w=-Infinity,A=-Infinity;l.forEachVertex((z,C)=>{y=Math.min(y,z);x=Math.min(x,C);w=Math.max(w,z);A=Math.max(A,C)});this._bounds[4*r]=y;this._bounds[4*r+1]=x;this._bounds[4*r+2]=w;this._bounds[4*r+3]=A;return!0}getBounds(l,u){const v=this.getXMin(u),r=this.getYMin(u),y=this.getXMax(u);u=this.getYMax(u);h.fromRectValues(l,
v,r,y,u);return 4294967295!==v}_ensureNumeric(l,u){this._numerics[l]||(this._numerics[l]=[]);f(this._numerics[l],u,0)}_ensureInstanceId(l){f(this._instanceIds,l,0)}_ensureString(l,u){this._strings[l]||(this._strings[l]=[]);f(this._strings[l],u,null)}}e.ComputedAttributeStorage=m;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(e,g){class p extends g.AComputedField{constructor(h){super();
this._field=h}resize(h){throw Error("Method not implemented.");}read(h,k){return h.readAttribute(this._field)}readWithDefault(h,k){return h.readAttribute(this._field)}referencesScale(){return!1}referencesGeometry(){return!1}}e.CachedField=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports","../../../../../core/string","../../../../../support/arcadeOnDemand","../../../arcade/callExpressionWithCursor",
"./AComputedField"],function(e,g,p,h,k){class n extends k.AComputedField{static async create(d,b){b=await p.createRendererExpression(d,b.spatialReference,b.fields);d=g.numericHash(d);return new n(b,d)}constructor(d,b){super();this._compiled=d;this._cacheKey=b}resize(d){}read(d,b){return this.referencesScale()||"system"!==b.$view.timeZone?h.callExpressionWithCursor(this._compiled,d,b):this._readCached(d,b)}readWithDefault(d,b,a){return this.referencesScale()||"system"!==b.$view.timeZone?h.callExpressionWithCursorWithDefault(this._compiled,
d,b,a):this._readWithDefaultCached(d,b,a)}referencesScale(){return this._compiled?.referencesScale()??!1}referencesGeometry(){return this._compiled?.referencesGeometry()??!1}_readCached(d,b){d.setCache(this._cacheKey);if(d.hasCachedValue())return d.getCachedValue();b=h.callExpressionWithCursor(this._compiled,d,b);d.setCachedValue(b);return b}_readWithDefaultCached(d,b,a){d.setCache(this._cacheKey);if(d.hasCachedValue())return d.getCachedValue();b=h.callExpressionWithCursorWithDefault(this._compiled,
d,b,a);d.setCachedValue(b);return b}}e.ComputedExpression=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(e,g,p){function h(k){return null==k||Infinity===k||-Infinity===k||"number"===typeof k&&isNaN(k)}e.callExpressionWithCursor=function(k,n,d){if(null==k)return null;const b=n.readArcadeFeature();n.contextTimeZone=d.$view?.timeZone;try{return k.evaluate({...d,
$feature:b},k.services)}catch(a){return p.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}};e.callExpressionWithCursorWithDefault=function(k,n,d,b){if(null==k)return null!=b?b:null;const a=n.readArcadeFeature();n.contextTimeZone=d.$view?.timeZone;k=k.evaluate({...d,$feature:a},k.services);return h(k)?null!=b?b:null:k};e.isBadArcadeResult=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports",
"../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,g,p,h,k){class n extends k.AComputedField{static async create(d,b){const a=p.sqlToTemplateString(d);return new n(c=>a.replaceAll(/{[^}]*}/g,q=>{const f=q.slice(1,-1),t=c.metadata.fieldsIndex.get(f);if(null==t)return q;q=c.readAttribute(f);return null==q?"":g.formatField(q,t)}))}constructor(d){super();this._evaluator=d}resize(d){}read(d,
b){return this._evaluator(d)}readWithDefault(d,b,a){d=this._evaluator(d);return h.isBadArcadeResult(d)?a:d}referencesScale(){return!1}referencesGeometry(){return!1}}e.ComputedLegacyLabelExpression=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(e,
g,p,h,k,n,d,b,a,c){function q(l,u){if(null==l)return"";const v=u.domain;if(v)if("codedValue"===v.type||"coded-value"===v.type)for(var r of v.codedValues){if(r.code===l)return r.name}else if("range"===v.type){const {max:y,min:x}=d.getDomainRange(u);r=+l;if(null!=x&&null!=y&&x<=r&&r<=y)return v.name}b.isDateField(u)?l=k.formatDate(l,k.convertDateFormatToIntlOptions("short-date")):b.isNumericField(u)&&(l=n.formatNumber(+l));return l||""}const f=()=>p.getLogger("esri.layers.support.labelFormatUtils"),
t={type:"simple",evaluate(){return null}},m={getAttribute(l,u){return l.field(u)}};e.createLabelFunction=async function(l,u,v){if(!l||!l.symbol||!u)return t;const r=l.where,y=a.getLabelExpression(l);if("arcade"===y.type){const x=await c.createLabelExpression(y.expression,v,u);if(null==x)return t;l={type:"arcade",evaluate(w,A){try{const z="attributes"in w?x.repurposeFeature(w):w;z.contextTimeZone=A??null;const C=x.evaluate({$view:{timeZone:A},$feature:z},x.services);if(null!=C)return C.toString()}catch(z){f().error(new g("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:z,feature:w,expression:y}))}return null},needsHydrationToEvaluate(){return null==a.getSingleFieldArcadeExpression(y.expression)}}}else l={type:"simple",evaluate(x){return y.expression.replaceAll(/{[^}]*}/g,w=>{var A=w.slice(1,-1);A=u.get(A);if(!A)return w;w=null;"attributes"in x?x&&x.attributes&&(w=x.attributes[A.name]):w=x.field(A.name);return null==w?"":q(w,A)})}};if(r){let x;try{x=await h.parseWhereClause(r,u)}catch(A){return f().error(new g("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:r,error:A})),t}const w=l.evaluate;l.evaluate=(A,z)=>{const C="attributes"in A?void 0:m;try{if(x.testFeature(A,C))return w(A,z)}catch(D){f().error(new g("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:A,error:D}))}return null}}return l};e.formatField=q;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports",
"./AComputedField"],function(e,g){class p extends g.AComputedField{constructor(h,k){super();this._field=h;this._normalizationInfo=k}resize(h){throw Error("Method not implemented.");}read(h,k){return this._readNormalized(h)}readWithDefault(h,k){return this._readNormalized(h)}referencesScale(){return!1}referencesGeometry(){return!1}_readNormalized(h){const k=h.readAttribute(this._field);if(null==k)return null;const {normalizationField:n,normalizationTotal:d,normalizationType:b}=this._normalizationInfo;
h=h.readAttribute(n);switch(b??"esriNormalizeByField"){case "esriNormalizeByField":return h?(h||void 0)&&k/h:null;case "esriNormalizeByLog":return Math.log(k)*Math.LOG10E;case "esriNormalizeByPercentOfTotal":return d?k/d*100:null}}}e.NormalizedField=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(e,g,
p){class h{constructor(n){this._options=n;this._fieldsIndex="fieldsIndex"in n?p.fromJSON(n.fieldsIndex):new p(n.fields);n.spatialReference&&(this._spatialReference=g.fromJSON(n.spatialReference));this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:this.objectIdField,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??
void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return this._options.geometryType}get timeInfo(){return this._options.timeInfo}get objectIdField(){return this._options.objectIdField}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}}
class k extends h{static create(n){return new k({fields:[],objectIdField:"uid",geometryType:null,spatialReference:n,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null})}}e.FeatureMetadata=h;e.GraphicsMetadata=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define("exports ../../../../../geometry/support/centroid ../../../../../geometry/support/jsonUtils ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedGeometry ../../../engine/webgl/definitions ./FeatureSetReader".split(" "),
function(e,g,p,h,k,n,d){class b extends d.FeatureSetReader{static from(a,c,q){return new b(a,c,q)}constructor(a,c,q){super(q);this._items=a;this._tile=c;this._index=-1;this._cachedGeometry=null;a=c.lod;a.wrap&&(this._wrappingInfo={worldSizeX:a.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(a){return null!=this._current.attributes[a]}field(a){return this.readAttribute(a)}get geometryType(){const a=
p.getJsonType(this._current.geometry);return"esriGeometryPoint"===a?"esriGeometryMultipoint":a}getCursor(){return this.copy()}copy(){const a=new b(this._items,this._tile,this.metadata);this.copyInto(a);return a}copyInto(a){super.copyInto(a);a._cachedGeometry=this._cachedGeometry;a._index=this._index}get fields(){throw Error("Fields reading not supported to graphics.");}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw Error("InternalError: exceededTransferLimit not implemented for graphics.");
}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let a="";for(const c in this._current.attributes)a+=this._current.attributes[c];return a}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(a){throw Error("InternalError: Setting displayId not supported for graphics.");}setIndex(a){this._index=a}getIndex(){return this._index}next(){for(this._cachedGeometry=
null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw Error("InternalError: readGeometryArea not supported for graphics.");}_readGeometry(){if(!this._cachedGeometry){let a=h.convertFromGeometry(this._current.projectedGeometry,this.hasZ,this.hasM);"esriGeometryPolyline"===this.geometryType&&(a=h.generalizeOptimizedGeometry(new k,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0]));this._cachedGeometry=h.quantizeOptimizedGeometry(new k,
a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);if(!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(a){if(this._wrappingInfo){var {worldSizeX:c}=this._wrappingInfo;if(a.isPoint)1===c?(a.coords.push(n.tileSize,0),a.coords.push(2*-n.tileSize,0),a.lengths.push(3)):2===c?(a.coords.push(2*n.tileSize,0),a.coords.push(4*-n.tileSize,0),a.lengths.push(3)):this._wrapVertex(a.coords,0,2,c);else if("esriGeometryMultipoint"===this.geometryType)if(1===
c){c=a.coords.slice();c[0]-=512;const q=a.coords.slice();q[0]+=512;a.coords.push(...c,...q);c=a.lengths[0];a.lengths.push(c,c)}else this._wrapVertex(a.coords,0,2,c)}}_wrapVertex(a,c,q,f){c*=q;q=a[c];q<-(n.tileSize*(f-2))?a[c]=q+n.tileSize*f:q>n.tileSize*(f-1)&&(a[c]=q-n.tileSize*f)}_readX(){const a=this._readGeometry();return null!=a?a.coords[0]:0}_readY(){const a=this._readGeometry();return null!=a?a.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case "esriGeometryPolygon":var a=g.polygonCentroid(this._current.projectedGeometry);
a=new k([],a);return h.quantizeOptimizedGeometry(new k,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform);case "esriGeometryPolyline":return a=g.ringsCentroid(this._current.projectedGeometry.paths,this.hasZ),a=new k([],a),h.quantizeOptimizedGeometry(new k,a,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}return null}_readAttribute(a,c){c=this._current.attributes[a];if(void 0!==c)return c;a=a.toLowerCase();for(const q in this._current.attributes)if(q.toLowerCase()===a)return this._current.attributes[q]}_readAttributes(){return this._current.attributes}}
e.GraphicsReader=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define("exports ../../../../../geometry ../../../../../arcade/ArcadeDate ../../../../../core/has ../../../../../core/maybe ../../../../../core/sql/DateOnly ../../../../../core/sql/TimeOnly ../../../../../geometry/GeometryCursor ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/labelPoint ../../../../../layers/graphics/centroid ../../../../../layers/graphics/featureConversionUtils ../../../../../layers/graphics/OptimizedFeature ../../../../../layers/graphics/OptimizedGeometry ../../../../../time/timeZoneUtils ./FeatureSetCache ./StaticBitSet ../../../../../geometry/support/jsonUtils".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r){function y(H,K,O){if(!(H.length>K))for(;H.length<=K;)H.push(O)}g=h("featurelayer-simplify-thresholds")??[.5,.5,.5,.5];const x=g[0],w=g[1],A=g[2],z=g[3];g=h("featurelayer-simplify-payload-size-factors")??[1,2,4];const C=g[0],D=g[1],F=g[2],G=h("featurelayer-simplify-mobile-factor")??2,B=h("esri-mobile");class I{constructor(H){this.metadata=H;this.type="FeatureSetReader";this._deleted=null;this._joined=[];this._objectIdToIndex=null;this._boundsBuffer=[];
this._caches=new Map;this.arcadeDeclaredClass="esri.arcade.Feature";this._contextTimeZone=null}get isEmpty(){return null!=this._deleted&&this._deleted.countSet()===this.getSize()}getAreaSimplificationThreshold(H,K){let O=1;const R=B?G:1;4E6<K?O=F*R:1E6<K?O=D*R:5E5<K?O=C*R:1E5<K&&(O=R);K=0;4E3<H?K=z*O:2E3<H?K=A*O:100<H?K=w:15<H&&(K=x);return K}parseTimestampOffset(H){return H}getBounds(H){y(this._boundsBuffer,4*this.getIndex()+4,0);if(4294967295===this.getBoundsXMin())return!1;if(0===this.getBoundsXMin()){var K=
this.readGeometryWorldSpace();if(!K)return this.setBoundsXMin(4294967295),!1;let J=Infinity,Q=Infinity,N=-Infinity,S=-Infinity;K.forEachVertex((W,U)=>{J=Math.min(J,W);Q=Math.min(Q,U);N=Math.max(N,W);S=Math.max(S,U)});this.setBoundsXMin(J);this.setBoundsYMin(Q);this.setBoundsXMax(N);this.setBoundsYMax(S);a.fromRectValues(H,J,Q,N,S);return!0}K=this.getBoundsXMin();const O=this.getBoundsYMin(),R=this.getBoundsXMax(),E=this.getBoundsYMax();a.fromRectValues(H,K,O,R,E);return!0}getBoundsXMin(){return this._boundsBuffer[4*
this.getIndex()]}setBoundsXMin(H){this._boundsBuffer[4*this.getIndex()]=H}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(H){this._boundsBuffer[4*this.getIndex()+1]=H}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(H){this._boundsBuffer[4*this.getIndex()+2]=H}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(H){this._boundsBuffer[4*this.getIndex()+3]=H}readAttributeAsTimestamp(H){H=this.readAttribute(H);return"string"===
typeof H?(new Date(H)).getTime():"number"===typeof H||null==H?H:null}readAttribute(H,K=!1){var O=this._readAttribute(H,K);if(void 0!==O)return O;for(const R of this._joined)if(R.setIndex(this.getIndex()),O=R._readAttribute(H,K),void 0!==O)return O}readAttributes(){const H=this._readAttributes();for(const K of this._joined){K.setIndex(this.getIndex());const O=K._readAttributes();for(const R of Object.keys(O))H[R]=O[R]}return H}joinAttributes(H){this._joined.push(H)}removeIds(H){if(null==this._objectIdToIndex){var K=
new Map;const O=this.getCursor();for(;O.next();){const R=O.getObjectId();k.assertIsSome(R);K.set(R,O.getIndex())}this._objectIdToIndex=K}K=this._objectIdToIndex;for(const O of H.values())K.has(O)&&this._removeAtIndex(K.get(O))}readOptimizedFeatureWorldSpace(){var H=this.readGeometryWorldSpace();const K=this.readAttributes(),O=this.readCentroidWorldSpace();H=new t.OptimizedFeature(H,K,O);H.objectId=this.getObjectId();H.displayId=this.getDisplayId();return H}readLegacyFeatureForDisplay(){const H=this.readCentroidForDisplay();
return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(H&&{x:H.coords[0],y:H.coords[1]})??null}}readLegacyFeatureWorldSpace(){const H=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(H&&{x:H.coords[0],y:H.coords[1]})??null}}readLegacyGeometryForDisplay(){const H=this.readGeometryForDisplay();return f.convertToGeometry(H,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const H=
this._readX(),K=this.getInTransform();return null==K?H:H*K.scale[0]+K.translate[0]}readYWorldSpace(){const H=this._readY(),K=this.getInTransform();return null==K?H:K.translate[1]-H*K.scale[1]}readGeometryForDisplay(){var H=this._readGeometryDeltaDecoded(!0);return H?H:(H=this._createGeometryFromServerCentroid())?H.deltaDecode():null}readGeometryWorldSpace(){var H=this._readGeometry();H||=this._createGeometryFromServerCentroid();if(!H)return null;H=H.clone();const K=this.getInTransform();null!=K&&
f.unquantizeOptimizedGeometry(H,H,this.hasZ,this.hasM,K);return H}readCentroidForDisplay(){const H=this.readGeometryForDisplay();return H?this._computeDisplayCentroid(H):this._readServerCentroid()}readCentroidWorldSpace(){var H=this.readGeometryForDisplay();H=H?this._computeDisplayCentroid(H):this._readServerCentroid();if(!H)return null;H=H.clone();const K=this.getInTransform();null!=K&&f.unquantizeOptimizedGeometry(H,H,this.hasZ,this.hasM,K);return H}setCache(H){let K=this._caches.get(H);null==K&&
(K=new u.FeatureSetCache(this.getSize()),this._caches.set(H,K));this._activeCache=K}setCachedValue(H){this._activeCache.set(this.getIndex(),H)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(H){H=this._readGeometry(H);return"esriGeometryPoint"!==this.geometryType&&H&&this.getInTransform()?H.deltaDecode():H}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(H){this._contextTimeZone=
H}readArcadeFeature(){return this}hasField(H){return this.fields.has(H)||this._joined.some(K=>K.hasField(H))}geometry(){var H=this.readGeometryWorldSpace();H=f.convertToGeometry(H,this.geometryType,this.hasZ,this.hasM);if(H=r.fromJSON(H)){if(!this.metadata.spatialReference)throw Error("InternalError: Expected spatial reference to be defined");H.spatialReference=this.metadata.spatialReference}return H}autocastArcadeDate(H,K){return K&&K instanceof Date?this.isUnknownDateTimeField(H)?p.ArcadeDate.unknownDateJSToArcadeDate(K):
p.ArcadeDate.dateJSAndZoneToArcadeDate(K,this.contextTimeZone??l.system):K}isUnknownDateTimeField(H){return this.metadata.fieldsIndex.getTimeZone(H)===l.unknown}field(H){let K=this.fields.get(H);if(K)switch(K.type){case "date-only":case "esriFieldTypeDateOnly":return n.DateOnly.fromReader(this.readAttribute(H,!1));case "time-only":case "esriFieldTypeTimeOnly":return d.TimeOnly.fromReader(this.readAttribute(H,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return p.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(H,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(H,this.readAttribute(H,!0));default:return this.readAttribute(H,!1)}for(const O of this._joined)if(O.setIndex(this.getIndex()),K=O.fields.get(H))switch(K.type){case "date-only":case "esriFieldTypeDateOnly":return n.DateOnly.fromReader(O._readAttribute(H,!1));case "time-only":case "esriFieldTypeTimeOnly":return d.TimeOnly.fromReader(O._readAttribute(H,!1));case "esriFieldTypeTimestampOffset":case "timestamp-offset":return p.ArcadeDate.fromReaderAsTimeStampOffset(O._readAttribute(H,
!1));case "date":case "esriFieldTypeDate":return this.autocastArcadeDate(H,O._readAttribute(H,!0));default:return this.readAttribute(H,!1)}throw Error(`Field ${H} does not exist`);}setField(H,K){throw Error("Unable to update feature attribute values, feature is readonly");}keys(){return this.fields.fields.map(H=>H.name)}castToText(H=!1){if(!H)return JSON.stringify(this.readLegacyFeatureForDisplay());H=this.readLegacyFeatureForDisplay();if(!H)return JSON.stringify(null);H={geometry:H.geometry,attributes:{...(H.attributes??
{})}};for(const K in H.attributes){const O=H.attributes[K];O instanceof Date&&(H.attributes[K]=O.getTime())}return JSON.stringify(H)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(H=null){return{attributes:this._readAttributes(),geometry:!0===H?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(H,K=null){return Promise.resolve(this.castAsJson(K))}_getExists(){return null==this._deleted||!this._deleted.has(this.getIndex())}_computeDisplayCentroid(H){if(null==
this.getInTransform())return q.getCentroidOptimizedGeometry(new m,H,this.hasM,this.hasZ);H=b.GeometryCursor.fromOptimized(H,this.geometryType);H.yFactor*=-1;return(H=c.getLabelPoint(H))?(H[1]*=-1,new m([],H)):null}copyInto(H){H._joined=this._joined;H._deleted=this._deleted;H._objectIdToIndex=this._objectIdToIndex;H._boundsBuffer=this._boundsBuffer;H._activeCache=this._activeCache;H._caches=this._caches;H._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const H=this.readGeometryWorldSpace();
return f.convertToGeometry(H,this.geometryType,!1,!1)}_createGeometryFromServerCentroid(){const H=this._readServerCentroid();if(!H)return null;const [K,O]=H.coords;return this._createQuantizedExtrudedGeometry(K,O)}_createQuantizedExtrudedGeometry(H,K){return"esriGeometryPolyline"===this.geometryType?this._createQuantizedExtrudedLine(H,K):this._createQuantizedExtrudedQuad(H,K)}_createQuantizedExtrudedQuad(H,K){return new m([5],[H-1,K,1,-1,1,1,-1,1,-1,-1])}_createQuantizedExtrudedLine(H,K){return new m([2],
[H-1,K+1,1,-1])}_removeAtIndex(H){null==this._deleted&&(this._deleted=v.StaticBitSet.create(this.getSize()));this._deleted.set(H)}}e.FeatureSetReader=I;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(e,g,p,h){function k(c,q,f){return c<q?c-q:c>f?c-f:0}function n(c,q=!0){if(c instanceof h.Zone)return c;if("system"===c.toLowerCase())return"system";if("utc"===
c.toLowerCase())return"UTC";if("unknown"===c.toLowerCase())return p.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(c)){const f=h.FixedOffsetZone.parseSpecifier("UTC"+(c.startsWith("+")||c.startsWith("-")?"":"+")+c);if(f)return f}c=h.IANAZone.create(c);if(!c.isValid){if(q)throw new b(e.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return c}e.ArcadeDateErrorCodes=void 0;(e.ArcadeDateErrorCodes||(e.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const d={[e.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class b extends Error{constructor(c,q){super(g.replace(d[c],q));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,b)}}class a{constructor(c){this._date=c;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(c=0,q=1,f=1,t=0,m=0,l=0,u=0,v){if(isNaN(c)||isNaN(q)||isNaN(f)||isNaN(t)||isNaN(m)||isNaN(l)||isNaN(u))return null;const r=
h.DateTime.local(c,q).daysInMonth;c=h.DateTime.fromObject({day:1>f?1:f>r?r:f,year:c,month:1>q?1:12<q?12:q,hour:0>t?0:23<t?23:t,minute:0>m?0:59<m?59:m,second:0>l?0:59<l?59:l,millisecond:0>u?0:999<u?999:u},{zone:n(v)});c=c.plus({months:k(q,1,12),days:k(f,1,r),hours:k(t,0,23),minutes:k(m,0,59),seconds:k(l,0,59),milliseconds:k(u,0,999)});return new a(c)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(c,q){q=
n(q);return c.isUnknownTimeZone||q===p.UnknownTimeZone.instance?a.fromParts(c.year,c.monthJS+1,c.day,c.hour,c.minute,c.second,c.millisecond,q):new a(c._date.setZone(q))}static dateJSToArcadeDate(c){return new a(h.DateTime.fromJSDate(c,{zone:"system"}))}static dateJSAndZoneToArcadeDate(c,q="system"){q=n(q);return new a(h.DateTime.fromJSDate(c,{zone:q}))}static unknownEpochToArcadeDate(c){return new a(h.DateTime.fromMillis(c,{zone:p.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(c){return new a(h.DateTime.fromMillis(c.getTime(),
{zone:p.UnknownTimeZone.instance}))}static epochToArcadeDate(c,q="system"){q=n(q);return new a(h.DateTime.fromMillis(c,{zone:q}))}static dateTimeToArcadeDate(c){return new a(c)}clone(){return new a(this._date)}changeTimeZone(c){c=n(c);return a.dateTimeToArcadeDate(this._date.setZone(c))}static dateTimeAndZoneToArcadeDate(c,q){q=n(q);return c.zone===p.UnknownTimeZone.instance||q===p.UnknownTimeZone.instance?a.fromParts(c.year,c.month,c.day,c.hour,c.minute,c.second,c.millisecond,q):new a(c.setZone(q))}static nowToArcadeDate(c){c=
n(c);return new a(h.DateTime.fromJSDate(new Date,{zone:c}))}static nowUTCToArcadeDate(){return new a(h.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===a.systemTimeZoneCanonicalName}equals(c){return this.isSystem&&c.isSystem?this.toNumber()===c.toNumber():this.isUnknownTimeZone!==c.isUnknownTimeZone?!1:this._date.equals(c._date)}get isUnknownTimeZone(){return this._date.zone===p.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let c=
this._date.weekday;6<c&&(c=0);return c}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const c=this.zone;return"fixed"===c.type?0===c.fixed?"UTC":c.formatOffset(0,"short"):c.name}stringify(){return JSON.stringify(this.toJSDate())}plus(c){return new a(this._date.plus(c))}diff(c,q="milliseconds"){return this._date.diff(c._date,q)[q]}toISODate(){return this._date.toISODate()}toISOString(c){return c?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(c,q){return this._date.toISOTime({suppressMilliseconds:c,
includeOffset:q&&!this.isUnknownTimeZone})}toFormat(c,q){this.isUnknownTimeZone&&(c=c.replaceAll("Z",""));return this._date.toFormat(c,q)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new a(this._date.toUTC())}toLocal(){return new a(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(c){if(!c)return null;
c=h.DateTime.fromISO(c,{setZone:!0});return new a(c)}}e.ArcadeDate=a;e.ArcadeDateError=b;e.arcadeDateErrorMessages=d;e.createDateTimeZone=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(e,g,p,h){function k(d){d=d.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let b="";const a=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const c of d.match(a)||[])switch(c){case "D":b+="d";break;case "DD":b+="dd";break;case "DDD":b+="o";break;case "d":b+="c";break;case "ddd":b+="ccc";break;case "dddd":b+="cccc";break;case "M":b+="L";break;case "MM":b+="LL";break;case "MMM":b+="LLL";break;case "MMMM":b+="LLLL";break;case "YY":b+="yy";break;case "Y":case "YYYY":b+="yyyy";break;case "Q":b+="q";break;case "X":case "x":b+=c;break;default:b=2<=c.length&&"["===c.slice(0,1)&&"]"===c.slice(-1)?b+`'${c.slice(1,-1)}'`:b+`'${c}'`}return b}
class n{constructor(d,b,a){this._year=d;this._month=b;this._day=a;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(d){return d instanceof n&&d.day===this.day&&d.month===this.month&&d.year===this.year}clone(){return new n(this._year,this._month,this._day)}toDateTime(d){return h.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:g.createDateTimeZone(d)})}toDateTimeLuxon(d){return h.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:g.createDateTimeZone(d)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(d=null,b=!0){if(null===d||""===d)return this.toString();b&&(d=k(d));if(!d)return"";b=this.toDateTime("unknown");return g.ArcadeDate.dateTimeToArcadeDate(b).toFormat(d,{locale:p.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const d=this.toDateTime("unknown");return g.ArcadeDate.dateTimeToArcadeDate(d)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(d,b){return n.fromDateTime(this.toUTCDateTime().plus({[d]:b}))}toUTCDateTime(){return h.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(d,b){switch(b.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(d.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===b?this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(d.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(d.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(d.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(d.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(d){d=h.DateTime.fromMillis(d,{zone:h.FixedOffsetZone.utcInstance});
return d.isValid?n.fromParts(d.year,d.month,d.day):null}static fromSeconds(d){d=h.DateTime.fromSeconds(d,{zone:h.FixedOffsetZone.utcInstance});return d.isValid?n.fromParts(d.year,d.month,d.day):null}static fromReader(d){if(!d)return null;d=d.split("-");return 3!==d.length?null:new n(parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10))}static fromParts(d,b,a){d=new n(d,b,a);return!1===d.isValid?null:d}static fromDateJS(d){return n.fromParts(d.getFullYear(),d.getMonth()+1,d.getDay())}static fromDateTime(d){return n.fromParts(d.year,
d.month,d.day)}static fromSqlTimeStampOffset(d){return this.fromDateTime(d.toDateTime())}static fromString(d,b=null){if(""===d||null===d)return null;var a=[];if(b)(b=k(b))&&a.push(b);else if(null===b||""===b)return d=h.DateTime.fromISO(d,{setZone:!0}),d.isValid?n.fromParts(d.year,d.month,d.day):null;for(const c of a)if(a=h.DateTime.fromFormat(d,b??c),a.isValid)return new n(a.year,a.month,a.day);return null}static fromNow(d="system"){d=h.DateTime.fromJSDate(new Date).setZone(g.createDateTimeZone(d));
return new n(d.year,d.month,d.day)}}e.DateOnly=n;e.standardizeDateOnlyFormat=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(e,g,p,h){function k(d){if(!d)return"";const b=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let a="";for(const c of d.match(b)||[])switch(c){case "SSS":a+=c;break;case "A":case "a":a+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":a+=
c;break;default:a+=`'${c}'`}return a}class n{constructor(d,b,a,c){this._hour=d;this._minute=b;this._second=a;this._millisecond=c;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(d){return d instanceof n&&d.hour===this.hour&&d.minute===this.minute&&d.second===this.second&&d.millisecond===this.millisecond}clone(){return new n(this.hour,this.minute,this.second,
this.millisecond)}isValid(){return g.isInteger(this.hour)&&g.isInteger(this.minute)&&g.isInteger(this.second)&&g.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,
"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}`}toFormat(d=null){return null===d||""===d?this.toString():(d=k(d))?h.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(d,{locale:p.getLocale(),numberingSystem:"latn"}):
""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(d,b,a,c){d=new n(d,b,a,c);return d.isValid()?d:null}static fromReader(d){if(!d)return null;d=d.split(":");return 3!==d.length?null:new n(parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),0)}static fromMilliseconds(d){return 864E5<d||0>d?null:new n(Math.floor(d/36E5%24),Math.floor(d/6E4%60),Math.floor(d/1E3%60),Math.floor(d%1E3))}static fromDateJS(d){return new n(d.getHours(),d.getMinutes(),d.getSeconds(),
d.getMilliseconds())}static fromDateTime(d){return new n(d.hour,d.minute,d.second,d.millisecond)}static fromSqlTimeStampOffset(d){return this.fromDateTime(d.toDateTime())}static fromString(d,b=null){if(""===d||null===d)return null;const a=[];if(b)(b=k(b))&&a.push(b);else if(null===b||""===b)a.push("HH:mm:ss"),a.push("HH:mm:ss.SSS"),a.push("hh:mm:ss a"),a.push("hh:mm:ss.SSS a"),a.push("HH:mm"),a.push("hh:mm a"),a.push("H:mm"),a.push("h:mm a"),a.push("H:mm:ss"),a.push("h:mm:ss a"),a.push("H:mm:ss.SSS"),
a.push("h:mm:ss.SSS a");for(const c of a)if(b=h.DateTime.fromFormat(d,c),b.isValid)return new n(b.hour,b.minute,b.second,b.millisecond);return null}plus(d,b){switch(d){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return n.fromDateTime(this.toUTCDateTime().plus({[d]:b}))}return null}toUTCDateTime(){return h.DateTime.utc(1970,1,1,this.hour,this.minute,this.second,this.millisecond)}difference(d,b){switch(b.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(d.toUTCDateTime(),
"days").days;case "months":case "month":return this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===b?this.toUTCDateTime().diff(d.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(d.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(d.toUTCDateTime(),"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds;
case "hours":case "hour":case "h":return this.toUTCDateTime().diff(d.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(d.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(d.toUTCDateTime(),"milliseconds").milliseconds}}}e.TimeOnly=n;e.standardizeTimeFormat=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(e,g){e.cloneGeometry=function(p){if(null==
p)return null;const h=p.clone();void 0!==p.cache._geVersion&&(h.cache._geVersion=p.cache._geVersion);return h};e.convertLinearUnitsToCode=function(p){if(null==p)return null;if("number"===typeof p)return p;p=p.toLowerCase();p=p.replaceAll(/\s/g,"");p=p.replaceAll("-","");switch(p){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};e.convertSquareUnitsToCode=function(p){if(null==p)return null;if("number"===typeof p)return p;p=p.toLowerCase();p=p.replaceAll(/\s/g,"");p=p.replaceAll("-","");switch(p){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;
case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};
e.isInteger=function(p){return"number"===typeof p&&isFinite(p)&&Math.floor(p)===p};e.sameGeomType=function(p,h){return p===h||"point"===p&&"esriGeometryPoint"===h||"polyline"===p&&"esriGeometryPolyline"===h||"polygon"===p&&"esriGeometryPolygon"===h||"extent"===p&&"esriGeometryEnvelope"===h||"multipoint"===p&&"esriGeometryMultipoint"===h||"point"===h&&"esriGeometryPoint"===p||"polyline"===h&&"esriGeometryPolyline"===p||"polygon"===h&&"esriGeometryPolygon"===p||"extent"===h&&"esriGeometryEnvelope"===
p||"multipoint"===h&&"esriGeometryMultipoint"===p?!0:!1};e.shapeExtent=function(p){if(null==p)return null;switch(p.type){case "polygon":case "multipoint":case "polyline":return p.extent;case "point":return new g({xmin:p.x,ymin:p.y,xmax:p.x,ymax:p.y,spatialReference:p.spatialReference});case "extent":return p}return null};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(e){function g(h,k,n,d,b,a){a=b?a?4:3:a?3:2;
let c=n,q=n+a,f=0,t=0,m=n=0,l=0;for(let u=0,v=d-1;u<v;u++,c+=a,q+=a){d=k[c];const r=k[c+1],y=k[c+2],x=k[q],w=k[q+1],A=k[q+2];let z=d*w-x*r;m+=z;f+=(d+x)*z;t+=(r+w)*z;b&&(z=d*A-x*y,n+=(y+A)*z,l+=z);d<h[0]&&(h[0]=d);d>h[1]&&(h[1]=d);r<h[2]&&(h[2]=r);r>h[3]&&(h[3]=r);b&&(y<h[4]&&(h[4]=y),y>h[5]&&(h[5]=y))}0<m&&(m*=-1);0<l&&(l*=-1);if(!m)return null;h=[f,t,.5*m];b&&(h[3]=n,h[4]=.5*l);return h}function p(h,k,n,d,b){b=d?b?4:3:b?3:2;let a=k,c=k+b,q=0,f=0,t=0,m=0;for(let r=0,y=n-1;r<y;r++,a+=b,c+=b){var l=
h[a];const x=h[a+1],w=h[a+2],A=h[c],z=h[c+1],C=h[c+2];if(d){var u=A-l;var v=z-x;const D=C-w;u=Math.sqrt(u*u+v*v+D*D)}else u=A-l,v=z-x,u=Math.sqrt(u*u+v*v);u&&(q+=u,d?(l=[l+.5*(A-l),x+.5*(z-x),w+.5*(C-w)],f+=u*l[0],t+=u*l[1],m+=u*l[2]):(l=[l+.5*(A-l),x+.5*(z-x)],f+=u*l[0],t+=u*l[1]))}return 0<q?d?[f/q,t/q,m/q]:[f/q,t/q]:0<n?d?[h[k],h[k+1],h[k+2]]:[h[k],h[k+1]]:null}e.getCentroidOptimizedGeometry=function(h,k,n,d){if(!k?.lengths.length)return null;h.lengths.length&&(h.lengths.length=0);h.coords.length&&
(h.coords.length=0);const b=h.coords,a=[],c=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:q,coords:f}=k;var t=n?d?4:3:d?3:2;let m=0;for(const l of q){const u=g(c,f,m,l,n,d);u&&a.push(u);m+=l*t}a.sort((l,u)=>{let v=l[2]-u[2];0===v&&n&&(v=l[4]-u[4]);return v});a.length&&(t=6*a[0][2],
b[0]=a[0][0]/t,b[1]=a[0][1]/t,n&&(t=6*a[0][4],b[2]=0!==t?a[0][3]/t:0),b[0]<c[0]||b[0]>c[1]||b[1]<c[2]||b[1]>c[3]||n&&(b[2]<c[4]||b[2]>c[5]))&&(b.length=0);if(!b.length)if(k=k.lengths[0]?p(f,0,q[0],n,d):null)b[0]=k[0],b[1]=k[1],n&&2<k.length&&(b[2]=k[2]);else return null;return h};e.lineCentroid=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(e,g){class p{constructor(h){this._valid=
g.StaticBitSet.create(h);this._data=Array(h)}has(h){return this._valid.has(h)}set(h,k){this._valid.set(h);this._data[h]=k}get(h){return this._data[h]}}e.FeatureSetCache=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("../../../../core/has ../../../../core/screenUtils ../../../../chunks/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../symbols/cim/CIMSymbolDrawHelper ../../../../symbols/cim/CIMSymbolHelper ./GraphicStoreItem ./graphicsUtils ./GraphicUpdateMessage".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f){function t(l,u){return u.zOrder-l.zOrder}class m{constructor(l,u,v,r,y){this._items=new Map;this._boundsDirty=!1;this._outSpatialReference=l;this._cimResourceManager=u;this._hittestDrawHelper=new b.HittestDrawHelper(u);this._tileInfoView=v;this._store=y;l=v.getClosestInfoForScale(r);this._resolution=this._tileInfoView.getTileResolution(l.level)}items(){return this._items.values()}getItem(l){return this._items.get(l)}async update(l,u,v){const r=[],y=[],x=[],w=new Set,
A=[];let z=0;for(const D of l.items){z++;var C=D.uid;const F=this._items.get(C);l=u(D);w.add(C);F?F.update(D,l,z)&&(y.push(F),A.push(this._updateItem(F,v))):(C=this._store.createDisplayIdForObjectId(C),l=c.GraphicStoreItem.fromGraphic(D,l,z,C),A.push(this._updateItem(l,v)),this._items.set(l.objectId,l),r.push(l))}for(const [D,F]of this._items.entries())w.has(D)||(this._store.releaseDisplayIdForObjectId(D),this._items.delete(D),x.push(F));await Promise.all(A);this._index=null;return new f.GraphicUpdateMessage(r,
y,x)}updateLevel(l){this._resolution!==l&&(this._index=null,this._boundsDirty=!0,this._resolution=l)}hitTest(l,u,v,r,y){var x=(v=e("esri-mobile"))?e("hittest-2d-mobile-tolerance"):e("hittest-2d-desktop-tolerance"),w=x+(v?0:e("hittest-2d-small-symbol-tolerance"));l=n.normalizeMapX(l,this._tileInfoView.spatialReference);var A=r*window.devicePixelRatio*w;v=h.create();v[0]=l-A;v[1]=u-A;v[2]=l+A;v[3]=u+A;A=r*window.devicePixelRatio*x;x=h.create();x[0]=l-A;x[1]=u-A;x[2]=l+A;x[3]=u+A;w=.5*r*(w+q.pixelBuffer);
u=this._searchIndex(l-w,u-w,l+w,u+w);if(!u||0===u.length)return[];l=[];w=h.create();A=h.create();for(var z of u){if(!z.visible)continue;const {projectedGeometry:C,symbolResource:D}=z;this._getSymbolBounds(w,D,C,A,y);A[3]=A[2]=A[1]=A[0]=0;h.intersects(w,v)&&l.push(z)}if(0===l.length)return[];z=this._hittestDrawHelper;v=[];for(const C of l){const {projectedGeometry:D,symbolResource:F}=C;if(!F)continue;const {textInfo:G,symbolInfo:B}=F;z.hitTest(x,B.cimSymbol.symbol,D,G,y,r)&&v.push(C)}v.sort(t);return v.map(C=>
C.objectId)}queryItems(l){return 0===this._items.size?[]:this._searchForItems(l)}clear(){this._items.clear();this._index=null}async _updateItem(l,u){await l.projectAndNormalize(this._outSpatialReference);await u(l);({size:u}=l);u[0]=u[1]=u[2]=u[3]=0;this._getSymbolBounds(l.bounds,l.symbolResource,l.projectedGeometry,l.size,0)}_searchIndex(l,u,v,r){this._boundsDirty&&(this._items.forEach(y=>this._getSymbolBounds(y.bounds,y.symbolResource,y.projectedGeometry,y.size,0)),this._boundsDirty=!1);this._index||
(this._index=p.rbush(9,y=>({minX:y.bounds[0],minY:y.bounds[1],maxX:y.bounds[2],maxY:y.bounds[3]})),this._index.load(Array.from(this._items.values())));return this._index.search({minX:l,minY:u,maxX:v,maxY:r})}_searchForItems(l){var u=this._tileInfoView.spatialReference,v=l.bounds,r=d.getInfo(u);if(r&&u.isWrappable){const [y,x]=r.valid;u=1E-5>Math.abs(v[2]-x);r=1E-5>Math.abs(v[0]-y);if(!(u&&r||!u&&!r))return l=l.resolution,l=u?h.create([y,v[1],y+l*q.pixelBuffer,v[3]]):h.create([x-l*q.pixelBuffer,v[1],
x,v[3]]),v=this._searchIndex(v[0],v[1],v[2],v[3]),l=this._searchIndex(l[0],l[1],l[2],l[3]),[...(new Set([...v,...l]))]}return this._searchIndex(v[0],v[1],v[2],v[3])}_getSymbolBounds(l,u,v,r,y){if(!u||!u.symbolInfo.linearCIM||!v)return null;l||=h.create();k.getBoundsXY(l,v);if(!r||0===r[0]&&0===r[1]&&0===r[2]&&0===r[3]){const {textInfo:x,symbolInfo:w}=u;u=w.cimSymbol;r||=[0,0,0,0];y=a.CIMSymbolInflatedSizeHelper.getSymbolInflateSize(r,u.symbol,this._cimResourceManager,y,x);r[0]=g.pt2px(y[0]);r[1]=
g.pt2px(y[1]);r[2]=g.pt2px(y[2]);r[3]=g.pt2px(y[3])}y=this._resolution;r=a.CIMSymbolInflatedSizeHelper.safeSize(r);l[0]-=r*y;l[1]-=r*y;l[2]+=r*y;l[3]+=r*y;return l}}return m})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/coordsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtilsSync ../../../../layers/graphics/data/projectionSupport ./graphicsUtils".split(" "),
function(e,g,p,h,k,n,d){class b{static fromGraphic(a,c,q,f){return new b(a.geometry,c,a.attributes,a.visible,a.uid,q,f)}constructor(a,c,q,f,t,m,l){this.geometry=a;this.symbol=c;this.attributes=q;this.visible=f;this.objectId=t;this.zOrder=m;this.displayId=l;this.bounds=g.create();this.prevBounds=g.create();this.size=[0,0,0,0]}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}update(a,c,q){if(this.geometry===a.geometry&&this.attributes===a.attributes&&this.symbol===c&&this.zOrder===q&&
this.visible===a.visible)return!1;this.prevBounds=this.bounds;this.bounds=g.create();this.zOrder=q;this.geometry=a.geometry;this.attributes=a.attributes;this.symbol=c;this.visible=a.visible;this.projectedGeometry=this.symbolResource=null;return!0}async projectAndNormalize(a){let c=this.geometry;if(c&&c.spatialReference&&"mesh"!==c.type){"extent"===c.type&&(c=d.polygonFromExtent(c));await n.checkProjectionSupport(c.spatialReference,a);var q=k.normalizeCentralMeridianForDisplay(c);q&&((a=n.project(q,
c.spatialReference,a))&&p.closeRingsAndFixWinding(a),this.projectedGeometry=h.isExtent(a)?d.polygonFromExtent(a):a)}}}e.GraphicStoreItem=b;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define("exports ../../core/JSONSupport ./aaBoundingRect ./boundsUtils ./coordsUtils ./jsonUtils ./normalizeUtilsCommon ./spatialReferenceUtils".split(" "),function(e,g,p,h,k,n,d,b){function a(x,w){if(null==x)return null;var A=x.spatialReference,
z=b.getInfo(A);x=g.isSerializable(x)?x.toJSON():x;if(!z)return x;A=b.isWebMercator(A)?102100:4326;const C=d.cutParams[A].maxX,D=d.cutParams[A].minX;if(n.isPoint(x))return q(x,C,D);if(n.isMultipoint(x))x.points=x.points.map(F=>q(F,C,D));else{if(n.isExtent(x))return c(x,z);if(n.isPolygon(x)||n.isPolyline(x)){A=h.getBoundsXY(r,x);z=A[0];A=A[2];const F=2*d.offsetMagnitude(z,D)*C;x=0===F?x:d.updatePolyGeometry(x,F);z+=F;A+=F;return A>C?u(x,C,w):z<D?u(x,D,w):x}}return x}function c(x,w){if(!w)return x;const A=
f(x,w).map(z=>z.extent);return 2>A.length?A[0]||x:2<A.length?(x.xmin=w.valid[0],x.xmax=w.valid[1],x):{rings:A.map(z=>[[z.xmin,z.ymin],[z.xmin,z.ymax],[z.xmax,z.ymax],[z.xmax,z.ymin],[z.xmin,z.ymin]])}}function q(x,w,A){if(Array.isArray(x)){var z=x[0];z>w?(A=d.offsetMagnitude(z,w),x[0]=z+-2*A*w):z<A&&(w=d.offsetMagnitude(z,A),x[0]=z+-2*w*A)}else z=x.x,z>w?(A=d.offsetMagnitude(z,w),x.x+=-2*A*w):z<A&&(w=d.offsetMagnitude(z,A),x.x+=-2*w*A);return x}function f(x,w){const A=[],{ymin:z,ymax:C,xmin:D,xmax:F}=
x;var G=x.xmax-x.xmin;const [B,I]=w.valid,{x:H,frameId:K}=t(x.xmin,w),{x:O,frameId:R}=t(x.xmax,w);x=H===O&&0<G;if(G>2*I){G={xmin:D<F?H:O,ymin:z,xmax:I,ymax:C};x={xmin:B,ymin:z,xmax:D<F?O:H,ymax:C};w={xmin:0,ymin:z,xmax:I,ymax:C};const E={xmin:B,ymin:z,xmax:0,ymax:C},J=[],Q=[];m(G,w)&&J.push(K);m(G,E)&&Q.push(K);m(x,w)&&J.push(R);m(x,E)&&Q.push(R);for(let N=K+1;N<R;N++)J.push(N),Q.push(N);A.push(new v(G,[K]),new v(x,[R]),new v(w,J),new v(E,Q))}else H>O||x?A.push(new v({xmin:H,ymin:z,xmax:I,ymax:C},
[K]),new v({xmin:B,ymin:z,xmax:O,ymax:C},[R])):A.push(new v({xmin:H,ymin:z,xmax:O,ymax:C},[K]));return A}function t(x,w){const [A,z]=w.valid;w=2*z;var C=0;x>z?(C=Math.ceil(Math.abs(x-z)/w),x-=C*w):x<A&&(C=Math.ceil(Math.abs(x-A)/w),x+=C*w,C=-C);return{x,frameId:C}}function m(x,w){const {xmin:A,ymin:z,xmax:C,ymax:D}=w;return l(x,A,z)&&l(x,A,D)&&l(x,C,D)&&l(x,C,z)}function l(x,w,A){return w>=x.xmin&&w<=x.xmax&&A>=x.ymin&&A<=x.ymax?!0:!1}function u(x,w,A=!0){const z=!n.isPolyline(x);z&&k.closeRings(x);
if(A)return(new y).cut(x,w);A=z?x.rings:x.paths;const C=z?4:2,D=A.length;w*=-2;for(let F=0;F<D;F++){const G=A[F];if(G&&G.length>=C){const B=[];for(const I of G)B.push([I[0]+w,I[1]]);A.push(B)}}z?x.rings=A:x.paths=A;return x}class v{constructor(x,w){this.extent=x;this.frameIds=w}}const r=p.create();class y{constructor(){this._linesIn=[];this._linesOut=[]}cut(x,w){this._xCut=w;if(x.rings)this._closed=!0,w=x.rings,this._minPts=4;else if(x.paths)this._closed=!1,w=x.paths,this._minPts=2;else return null;
for(var A of w)if(A&&!(A.length<this._minPts)){w=!0;for(const z of A)w?(this.moveTo(z),w=!1):this.lineTo(z);this._closed&&this.close()}this._pushLineIn();this._pushLineOut();w=[];for(const z of this._linesIn)z&&z.length>=this._minPts&&w.push(z);A=-2*this._xCut;for(const z of this._linesOut)if(z&&z.length>=this._minPts){for(const C of z)C[0]+=A;w.push(z)}this._closed?x.rings=w:x.paths=w;return x}moveTo(x){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(x[0]);this._moveTo(x[0],x[1],
this._prevSide);this._firstPt=this._prevPt=x}lineTo(x){const w=this._side(x[0]);if(-1===w*this._prevSide){const A=this._intersect(this._prevPt,x);this._lineTo(this._xCut,A,0);this._prevSide=0}this._lineTo(x[0],x[1],w);this._prevSide=w;this._prevPt=x}close(){const x=this._firstPt,w=this._prevPt;x[0]===w[0]&&x[1]===w[1]||this.lineTo(x);this._checkClosingPt(this._lineIn);this._checkClosingPt(this._lineOut)}_moveTo(x,w,A){this._closed?(this._lineIn.push([0>=A?x:this._xCut,w]),this._lineOut.push([0<=A?
x:this._xCut,w])):(0>=A&&this._lineIn.push([x,w]),0<=A&&this._lineOut.push([x,w]))}_lineTo(x,w,A){this._closed?(this._addPolyVertex(this._lineIn,0>=A?x:this._xCut,w),this._addPolyVertex(this._lineOut,0<=A?x:this._xCut,w)):0>A?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([x,w])):0<A?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([x,w])):0>this._prevSide?(this._lineIn.push([x,w]),this._lineOut.push([x,w])):0<this._prevSide&&(this._lineOut.push([x,w]),this._lineIn.push([x,w]))}_addPolyVertex(x,
w,A){const z=x.length;1<z&&x[z-1][0]===w&&x[z-2][0]===w?x[z-1][1]=A:x.push([w,A])}_checkClosingPt(x){const w=x.length;3<w&&x[0][0]===this._xCut&&x[w-2][0]===this._xCut&&x[1][0]===this._xCut&&(x[0][1]=x[w-2][1],x.pop())}_side(x){return x<this._xCut?-1:x>this._xCut?1:0}_intersect(x,w){return x[1]+(this._xCut-x[0])/(w[0]-x[0])*(w[1]-x[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn);this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=
this._minPts&&this._linesOut.push(this._lineOut);this._lineOut=[]}}e.CutVertical=y;e.normalizeCentralMeridianForDisplay=function(x){return a(x,!1)};e.normalizeCentralMeridianSync=function(x){return a(x,!0)};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("exports ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions ../../engine/webgl/mesh/templates/shapingUtils".split(" "),
function(e,g,p,h,k,n,d){e.getTextSymbolSize=function(b,a,c){if(!c.glyphs.length)return b;a=d.shapeGlyphs(c,{scale:g.pt2px(a.font.size)/n.glyphSize,angle:a.angle??0,xOffset:a.xoffset??0,yOffset:a.yoffset??0,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",maxLineWidth:Math.max(32,Math.min(a.lineWidth||512,512)),lineHeight:n.magicLabelLineHeight*Math.max(.25,Math.min(a.lineHeight||1,4)),decoration:a.font.decoration||"none",useCIMAngleBehavior:!1,
hasBackground:!!a.backgroundColor,borderLineSizePx:g.pt2px(a.borderLineSize)}).bounds;b[0]=g.pt2px(a.x-a.halfWidth);b[1]=g.pt2px(a.y-a.halfHeight);b[2]=g.pt2px(a.width);b[3]=g.pt2px(a.height);return b};e.intersectingInternationalDateline=function(b,a){a=k.getInfo(a);if(!a)return null;const [c,q]=a.valid;return b[2]>q?[h.create([b[0],b[1],q,b[3]]),h.create([c,b[1],c+b[2]-q,b[3]])]:b[0]<c?[h.create([c,b[1],b[2],b[3]]),h.create([q-(c-b[0]),b[1],q,b[3]])]:null};e.isMarkerSymbol=function(b){return"simple-marker"===
b||"picture-marker"===b||"esriSMS"===b||"esriPMS"===b};e.isTextSymbol=function(b){return"text"===b||"esriTS"===b};e.pixelBuffer=50;e.polygonFromExtent=function(b){if(!b)return null;const {xmin:a,ymin:c,xmax:q,ymax:f,spatialReference:t}=b;return new p({rings:[[[a,c],[a,f],[q,f],[q,c],[a,c]]],spatialReference:t})};e.tileSize=512;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicUpdateMessage":function(){define(["exports"],function(e){class g{constructor(p,
h,k){this.added=p;this.updated=h;this.removed=k}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}}e.GraphicUpdateMessage=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define(["./UpdateTracking2D","../../../support/QueueProcessor"],function(e,g){function p(b){return b.some(a=>a.globalId)}function h(b){return b.filter(a=>!a.error).map(a=>a.objectId??a.globalId).filter(a=>null!=a)}function k(b,
a){b=new Set(b);for(const c of a.values())b.add(c);return b}function n(b,a){b=new Set(b);for(const c of a.values())b.delete(c);return b}class d{constructor(b){this.updateTracking=new e.UpdateTracking2D({debugName:"FeatureCommandQueue"});this._hasGlobalIds=!1;this._queueProcessor=new g.QueueProcessor({concurrency:1,process:b.process})}destroy(){this.updateTracking.destroy();this._queueProcessor.destroy();this.clear()}clear(){this._queueProcessor.clear()}async push(b){return this.updateTracking.addPromise(this._doPush(b))}async _doPush(b){const a=
this._queueProcessor;var c=a.last();const q=[];switch(b.type){case "update":if(c?.type===b.type)return;q.push(a.push(b));break;case "edit":(c="processed-edit"===c?.type?c:null)&&a.popLast();b=this._mergeEdits(c,b);for(const f of b)f&&q.push(a.push(f))}await Promise.all(q)}_mergeEdits(b,a){const {addedFeatures:c,deletedFeatures:q,updatedFeatures:f}=a.edits;if(this._hasGlobalIds=this._hasGlobalIds||p(c)||p(f)||p(q))return a=[...c,...f],[b,{type:"processed-edit",edits:{addOrModified:a,removed:q}}];a=
new Set(h(b?.edits.addOrModified??[]));b=new Set(h(b?.edits.removed??[]));const t=new Set([...h(c),...h(f)]),m=new Set(h(q));a=Array.from(k(n(a,m),t)).map(l=>({objectId:l}));b=Array.from(k(n(b,t),m)).map(l=>({objectId:l}));return[{type:"processed-edit",edits:{addOrModified:a,removed:b}}]}}return d})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){e.UpdateTracking2D=class extends p{constructor(f){super(f);this.debugName="";this._updatingHandles=new q.UpdatingHandles;this._idToUpdatingState=new k}get updating(){const f=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(t=>t);if(h("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([m,l])=>`-> ${m}: ${l}`).join("\n");console.log(`${this.debugName}: Updating: ${f}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return f}addUpdateTracking(f,
t){const m=n.watch(()=>t.updating,l=>this._idToUpdatingState.set(f,l),{sync:!0});this.addHandles(m)}addPromise(f){return this._updatingHandles.addPromise(f)}};g.__decorate([d.property({constructOnly:!0})],e.UpdateTracking2D.prototype,"debugName",void 0);g.__decorate([d.property({readOnly:!0})],e.UpdateTracking2D.prototype,"updating",null);e.UpdateTracking2D=g.__decorate([c.subclass("esri.view.2d.layers.support.UpdateTracking2D")],e.UpdateTracking2D);Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["../../engine/webgl/enums","./AGraphicContainer","../support/util"],function(e,g,p){class h extends g.AGraphicContainer{renderChildren(k){for(const n of this.children)n.setTransform(k.state);super.renderChildren(k);this.attributeView.update();if(this.children.some(n=>n.hasData)){switch(k.drawPhase){case e.WGLDrawPhase.MAP:this._renderChildren(k,e.FeatureSelection.All);break;case e.WGLDrawPhase.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(k)}this._boundsRenderer&&
this._boundsRenderer.doRender(k)}}_renderHighlight(k){p.renderHighlight(k,!1,n=>{this._renderChildren(n,e.FeatureSelection.Highlight)})}}return h})},"esri/views/2d/layers/graphics/AGraphicContainer":function(){define("exports ../../../../core/maybe ../../engine/AFeatureContainer ../../engine/webgl/enums ../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore ./GraphicBoundsRenderer".split(" "),function(e,g,p,h,k,n){class d extends p.AFeatureContainer{constructor(b){super(b);this._instanceStore=
new k.GraphicInstanceStore;this.checkHighlight=()=>!0}destroy(){super.destroy();this._boundsRenderer=g.destroyMaybe(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(b){this._boundsRenderer=new n(b);this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(b,a){b.onMessage(a);this.contains(b)||this.addChild(b);this.requestRender()}_renderChildren(b,a){b.selection=a;for(const c of this.children)c.visible&&c.getDisplayList(b.drawPhase,this._instanceStore,
h.FeatureBatchingStrategy.STRICT_ORDER)?.render(b)}}e.AGraphicContainer=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/AFeatureContainer":function(){define(["exports","./webgl/AttributeStoreView","./webgl/TileContainer"],function(e,g,p){class h extends p{constructor(k){super(k);this._statisticsByLevel=new Map;this.attributeView=new g.AttributeStoreView}destroy(){this.children.forEach(k=>k.destroy());this.removeAllChildren();this.attributeView.destroy()}doRender(k){k.context.capabilities.enable("textureFloat");
super.doRender(k)}createRenderParams(k){k=super.createRenderParams(k);k.attributeView=this.attributeView;k.instanceStore=this._instanceStore;k.statisticsByLevel=this._statisticsByLevel;return k}}e.AFeatureContainer=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("exports ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ./definitions ./DisplayId ./Utils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f){class t{constructor(l,u,v){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;const {buffer:r,pixelType:y,textureOnly:x}=l;l=b.getPixelArrayCtor(y);this.blockIndex=v;this.pixelType=y;this.size=u;this.textureOnly=x;x||(this.data=new l(r));this._resetRange()}destroy(){this._texture?.dispose();for(const l in this._fbos){const u=this._fbos[l];u&&("0"===l&&u.detachColorTexture(),u.dispose());this._fbos[l]=null}this._texture=null}get _textureDesc(){const l=
new f.TextureDescriptor;l.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;l.samplingMode=a.TextureSamplingMode.NEAREST;l.dataType=this.pixelType;l.width=this.size;l.height=this.size;return l}setData(l,u,v){l=d.getDisplayIdTexel(l);const r=this.data;u=l*this.texelSize+u;!r||u>=r.length||(r[u]=v,this.dirtyStart=Math.min(this.dirtyStart,l),this.dirtyEnd=Math.max(this.dirtyEnd,l))}getData(l,u){if(null==this.data)return null;l=d.getDisplayIdTexel(l)*this.texelSize+u;return!this.data||l>=this.data.length?null:
this.data[l]}getTexture(l){return this._texture??this._initTexture(l)}getFBO(l,u=0){if(!this._fbos[u]){const v=0===u?this.getTexture(l):this._textureDesc;this._fbos[u]=new c.FramebufferObject(l,v)}return this._fbos[u]}get hasDirty(){return this.dirtyEnd>=this.dirtyStart}updateTexture(l,u){try{const F=this.dirtyStart,G=this.dirtyEnd;if(this.hasDirty){p("esri-2d-update-debug")&&console.debug(`Version[${u}] AttributeStoreView.updateTexture`,{start:F,end:G,firstBytes:new Uint8Array(this.data.buffer.slice(0,
16)),block:this});this._resetRange();var v=this.data.buffer,r=this.getTexture(l),y=(F-F%this.size)/this.size,x=(G-G%this.size)/this.size,w=y*this.size*4,A=4*(this.size+x*this.size)-w,z=b.getPixelArrayCtor(this.pixelType),C=new z(v,w*z.BYTES_PER_ELEMENT,A),D=this.size;l=x-y+1;l>this.size?h.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new g("mapview-webgl","Out-of-bounds index when updating AttributeData")):r.updateData(0,0,y,D,l,C)}}catch(F){}}update(l){const {data:u,start:v,end:r}=
l;if(null!=u&&null!=this.data){const y=this.data,x=v*this.texelSize;for(let w=0;w<u.length;w++)l.layout&1<<w%this.texelSize&&(y[x+w]=u[w])}this.dirtyStart=Math.min(this.dirtyStart,v);this.dirtyEnd=Math.max(this.dirtyEnd,r)}resize(l,u){const v=this.size;this.size=u;this.textureOnly?v!==this.size&&(this._lastTexture=this._texture,this._texture=null):(u=b.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new u(l.buffer))}_resetRange(){this.dirtyStart=2147483647;this.dirtyEnd=0}_initTexture(l){const u=
new q.Texture(l,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const y=this._lastTexture.descriptor.width,x=this._lastTexture.descriptor.height,w=this._lastTexture.descriptor.dataType,A=this._lastTexture.descriptor.pixelFormat,z=this.getFBO(l);var v=b.getPixelBytes(w),r=b.getPixelArrayCtor(w);v=new ArrayBuffer(y*x*v*this.texelSize);r=new r(v);v=l.getBoundFramebufferObject();const {x:C,y:D,width:F,height:G}=l.getViewport();l.bindFramebuffer(z);z.readPixels(0,0,y,x,
A,w,r);u.updateData(0,0,0,2*y,x/2,r);l.setViewport(C,D,F,G);l.bindFramebuffer(v)}this.destroy();return this._texture=u}}class m{constructor(){this.size=0;this._pendingAttributeUpdates=[];this._epoch=this._version=0;this._locked=!1}_initialize(l){if(!l)throw Error("InternalError: initArgs must be defined");const u=l.blockDescriptors;this.size=l.blockSize;p("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:l});if(null==this._data)this._data=u.map((v,r)=>null!=v?new t(v,
this.size,r):null);else for(l=0;l<this._data.length;l++){const v=this._data[l],r=u[l];null!=r&&(null==v?this._data[l]=new t(r,this.size,l):v.resize(r,this.size))}}destroy(){for(const l of this._data??[])l?.destroy();this._defaultTexture?.dispose();for(const {resolver:l}of this._pendingAttributeUpdates)l.reject("AttributeStore destroyed");this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(l){return null==this._data?null:this._data[l]}setLabelMinZoom(l,u){this.setData(l,0,1,
u)}getLabelMinZoom(l){return this.getData(l,0,1,255)}getFilterFlags(l){return this.getData(l,0,0,0)}getVVSize(l){return this.getData(l,n.AttributeDataType.VV,0,0)}getData(l,u,v,r){if(!this._data)return 0;u=this._data[u];if(null==u)return 0;l=u.getData(l,v);return null!=l?l:r}setData(l,u,v,r){this._data[u].setData(l,v,r)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1;this.update()}async requestUpdate(l){const u=k.createResolver();u.promise=u.promise.catch(v=>{p("esri-2d-update-debug")&&
console.error("AttributeStoreView.requestUpdate rejected",v)});this._version=l.version;this._pendingAttributeUpdates.push({inner:l,resolver:u});p("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:l})}get currentEpoch(){return this._epoch}update(){if(!this._locked){var l=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const {inner:u,resolver:v}of l){const {blockData:r,initArgs:y,sendUpdateEpoch:x,version:w}=u;p("esri-2d-update-debug")&&
console.debug(`Version[${this._version}] Epoch[${x}] AttributeStoreView.applyUpdate`);this._version=w;this._epoch=x;null!=y&&this._initialize(y);l=this._data;for(let A=0;A<r.length;A++){const z=r[A],C=l[A];null!=C&&null!=z&&(p("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${A}] AttributeStoreView.update`,{block:z}),C.update(z))}v.resolve()}}}getUniforms(l){return{filterFlags:{texture:this._getTexture(l,n.AttributeDataType.FilterFlags),unit:n.filterFlagsUnit},animation:{texture:this._getTexture(l,
n.AttributeDataType.Animation),unit:n.animationUnit},gpgpu:{texture:this._getTexture(l,n.AttributeDataType.GPGPU),unit:n.gpgpuUnit},visualVariableData:{texture:this._getTexture(l,n.AttributeDataType.VV),unit:n.visualVariableUnit},dataDriven0:{texture:this._getTexture(l,n.AttributeDataType.DD0),unit:n.dataDrivenUnit0},dataDriven1:{texture:this._getTexture(l,n.AttributeDataType.DD1),unit:n.dataDrivenUnit1},dataDriven2:{texture:this._getTexture(l,n.AttributeDataType.DD2),unit:n.dataDrivenUnit2},size:this.size}}_getTexture(l,
u){u=this._data?.[u];if(!u)return this._getDefaultTexture(l);u.updateTexture(l,this._version);return u.getTexture(l)}_getDefaultTexture(l){if(null==this._defaultTexture){const u=new f.TextureDescriptor;u.wrapMode=a.TextureWrapMode.CLAMP_TO_EDGE;u.samplingMode=a.TextureSamplingMode.NEAREST;u.width=1;u.height=1;this._defaultTexture=new q.Texture(l,u,new Uint8Array(4))}return this._defaultTexture}}e.AttributeStoreView=m;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileContainer":function(){define(["../../../../core/has",
"./enums","./WGLContainer","./brushes/WGLBrushStencil","./brushes/WGLBrushTileDebugInfo"],function(e,g,p,h,k){const n=(b,a)=>0!==b.key.level-a.key.level?b.key.level-a.key.level:0!==b.key.row-a.key.row?b.key.row-a.key.row:b.key.col-a.key.col;class d extends p{constructor(b){super();this._tileInfoView=b}renderChildren(b){this.sortChildren(n);this.setStencilReference(b);super.renderChildren(b)}createRenderParams(b){const {state:a}=b;b=super.createRenderParams(b);b.requiredLevel=this._tileInfoView.getClosestInfoForScale(a.scale).level;
b.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(a.scale);return b}prepareRenderPasses(b){const a=super.prepareRenderPasses(b);a.push(b.registerRenderPass({name:"stencil",brushes:[h],drawPhase:g.WGLDrawPhase.DEBUG|g.WGLDrawPhase.MAP|g.WGLDrawPhase.HIGHLIGHT|g.WGLDrawPhase.LABEL,target:()=>this.getStencilTarget()}));e("esri-tiles-debug")&&a.push(b.registerRenderPass({name:"tileInfo",brushes:[k],drawPhase:g.WGLDrawPhase.DEBUG,target:()=>this.children}));return a}getStencilTarget(){return this.children}setStencilReference(b){b=
1;for(const a of this.children)a.stencilRef=b++}}return d})},"esri/views/2d/engine/webgl/WGLContainer":function(){define(["../../../../core/has","../brushes","../Container","./ClippingInfo","./enums"],function(e,g,p,h,k){class n extends p.Container{set clips(d){super.clips=d;this._updateClippingInfo(d)}renderChildren(d){d.painter.setPipelineState(null);null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(d.painter));for(const b of this._renderPasses)try{b.render(d)}catch(a){}}prepareRenderPasses(d){return[d.registerRenderPass({name:"clip",
brushes:[g.brushes.clip],target:()=>this._clippingInfos,drawPhase:k.WGLDrawPhase.MAP|k.WGLDrawPhase.LABEL|k.WGLDrawPhase.LABEL_ALPHA|k.WGLDrawPhase.DEBUG|k.WGLDrawPhase.HIGHLIGHT})]}_updateClippingInfo(d){null!=this._clippingInfos&&(this._clippingInfos.forEach(b=>b.destroy()),this._clippingInfos=null);null!=d&&d.length&&(this._clippingInfos=d.items.map(b=>h.fromClipArea(this.stage,b)));this.requestRender()}}return n})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("../../../../core/Error ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d){class b extends k.DisplayObject{constructor(a,c){super();this._clip=c;this._cache={};this.stage=a;this._handle=p.watch(()=>c.version,()=>this._invalidate());this.ready()}static fromClipArea(a,c){return new b(a,c)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null);null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){this._destroyGL();this._handle.remove()}getVAO(a,c,q,f){const [t,m]=c.size;if("geometry"===this._clip.type||
this._lastWidth!==t||this._lastHeight!==m)this._lastWidth=t,this._lastHeight=m,this._destroyGL();if(null==this._cache.vao){c=this._createMesh(c,this._clip);const l=c.getIndexBuffer(a),u=c.getVertexBuffers(a);this._cache.mesh=c;this._cache.vao=new d.VertexArrayObject(a,q,f,u,l)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:h.create()}}_invalidate(){this._destroyGL();this.requestRender()}_createScreenRect(a,c){const [q,f]=a.size;a="string"===typeof c.left?parseFloat(c.left)/
100*q:c.left;const t="string"===typeof c.right?parseFloat(c.right)/100*q:c.right,m="string"===typeof c.top?parseFloat(c.top)/100*f:c.top;c="string"===typeof c.bottom?parseFloat(c.bottom)/100*f:c.bottom;return{x:a,y:m,width:Math.max(q-t-a,0),height:Math.max(f-c-m,0)}}_createMesh(a,c){switch(c.type){case "rect":return n.fromRect(this._createScreenRect(a,c));case "path":return n.fromPath(c);case "geometry":return n.fromGeometry(a,c);default:return g.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new e("mapview-bad-type",
"Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),n.fromRect({x:0,y:0,width:1,height:1})}}}return b})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("../../../../core/Error ../../../../core/Logger ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject ../../../webgl/enums".split(" "),
function(e,g,p,h,k,n,d,b,a,c){const q=({coords:t,lengths:m},l)=>{const u=[];for(let y=0,x=0;y<m.length;x+=m[y],y+=1){const w=x;for(var v=[];y<m.length-1;y+=1,x+=m[y]){var r=x+m[y];let A=0;for(let z=1;z<m[y+1];z++)A+=(t[2*(r+z)]-t[2*(r+z-1)])*(t[2*(r+z)+1]+t[2*(r+z-1)+1]);if(!(l?0<A:0>A))break;v.push(x+m[y]-w)}r=t.slice(2*w,2*(x+m[y]));v=p.earcut(r,v,2);for(const A of v)u.push(A+w)}return u};class f{constructor(t,m,l,u=!1){this._cache={};this.vertices=t;this.indices=m;this.primitiveType=l;this.isMapSpace=
u}static fromRect({x:t,y:m,width:l,height:u}){return f.fromScreenExtent({xmin:t,ymin:m,xmax:t+l,ymax:m+u})}static fromPath(t){var m=n.convertFromNestedArray(new d,t.path,!1,!1);t=m.coords;m=new Uint32Array(q(m,!0));const l=new Uint32Array(t.length/2);for(let u=0;u<l.length;u++)l[u]=b.i1616to32(Math.floor(t[2*u]),Math.floor(t[2*u+1]));return new f({geometry:l},m,c.PrimitiveType.TRIANGLES)}static fromGeometry(t,m){const l=m.geometry?.type;switch(l){case "polygon":return f.fromPolygon(t,m.geometry);
case "extent":return f.fromMapExtent(t,m.geometry);default:return g.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new e("mapview-bad-type",`Unable to create a mesh from type ${l}`,m)),f.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(t,m){var l=n.convertFromPolygon(new d,m,!1,!1);m=l.coords;l=new Uint32Array(q(l,!1));const u=new Uint32Array(m.length/2),v=k.create(),r=k.create();for(let y=0;y<u.length;y++)h.set(v,m[2*y],m[2*y+1]),t.toScreen(r,v),u[y]=b.i1616to32(Math.floor(r[0]),Math.floor(r[1]));
return new f({geometry:u},l,c.PrimitiveType.TRIANGLES,!0)}static fromScreenExtent({xmin:t,xmax:m,ymin:l,ymax:u}){t={geometry:new Uint32Array([b.i1616to32(t,l),b.i1616to32(m,l),b.i1616to32(t,u),b.i1616to32(t,u),b.i1616to32(m,l),b.i1616to32(m,u)])};m=new Uint32Array([0,1,2,3,4,5]);return new f(t,m,c.PrimitiveType.TRIANGLES)}static fromMapExtent(t,m){const [l,u]=t.toScreen([0,0],[m.xmin,m.ymin]),[v,r]=t.toScreen([0,0],[m.xmax,m.ymax]);t={geometry:new Uint32Array([b.i1616to32(l,u),b.i1616to32(v,u),b.i1616to32(l,
r),b.i1616to32(l,r),b.i1616to32(v,u),b.i1616to32(v,r)])};m=new Uint32Array([0,1,2,3,4,5]);return new f(t,m,c.PrimitiveType.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose();for(const t in this._cache.vertexBuffers)null!=this._cache.vertexBuffers[t]&&this._cache.vertexBuffers[t].dispose()}get elementType(){a:switch(this.indices.BYTES_PER_ELEMENT){case 1:var t=c.DataType.UNSIGNED_BYTE;break a;case 2:t=c.DataType.UNSIGNED_SHORT;break a;case 4:t=c.DataType.UNSIGNED_INT;
break a;default:throw new e("Cannot get DataType of array");}return t}getIndexBuffer(t,m=c.Usage.STATIC_DRAW){this._cache.indexBuffer||(this._cache.indexBuffer=a.BufferObject.createIndex(t,m,this.indices));return this._cache.indexBuffer}getVertexBuffers(t,m=c.Usage.STATIC_DRAW){this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce((l,u)=>({...l,[u]:a.BufferObject.createVertex(t,m,this.vertices[u])}),{}));return this._cache.vertexBuffers}}return f})},"esri/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore":function(){define(["exports",
"./TechniqueInstance","./TechniqueRegistry","./mesh/instanceIdUtils"],function(e,g,p,h){function k(a,c,q){return new g.TechniqueInstance(h.castInstanceId(n++),a,a.meshWriter.name,c,q)}let n=0;const d={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class b{constructor(){this.instances={fill:k(p.Techniques.fill,d,{zoomRange:!0}),
marker:k(p.Techniques.marker,d,{zoomRange:!0}),line:k(p.Techniques.line,d,{zoomRange:!0}),text:k(p.Techniques.text,d,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:k(p.Techniques.complexFill,d,{zoomRange:!0}),texturedLine:k(p.Techniques.texturedLine,d,{zoomRange:!0})};this._instancesById=Object.values(this.instances).reduce((a,c)=>{a.set(c.instanceId,c);return a},new Map)}getInstance(a){return this._instancesById.get(a)}}e.GraphicInstanceStore=b;Object.defineProperty(e,Symbol.toStringTag,
{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueInstance":function(){define(["exports","./mesh/instanceIdUtils"],function(e,g){class p{constructor(h,k,n,d,b){this._instanceId=h;this.techniqueRef=k;this._meshWriterName=n;this._input=d;this.optionalAttributes=b}get instanceId(){return g.castStrictInstanceId(this._instanceId)}createMeshInfo(h){return{id:this._instanceId,meshWriterName:this._meshWriterName,options:h,optionalAttributes:this.optionalAttributes}}getInput(){return this._input}setInput(h){this._input=
h}}e.TechniqueInstance=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define("../../../../core/maybe ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../geometry/support/normalizeUtils ../../engine/DisplayObject ../../engine/webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q){const f=Math.PI/180;class t extends d.DisplayObject{constructor(l){super();this._indexBuffer=this._vertexBuffer=this._vao=this._program=null;this._dvsMat3=p.create();this._localOrigin={x:0,y:0};this._getBounds=l}destroy(){this._vao&&(this._vao.dispose(),this._indexBuffer=this._vertexBuffer=this._vao=null);this._program=e.disposeMaybe(this._program)}doRender(l){const {context:u}=l,v=this._getBounds();1>v.length||(this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(l),
this._updateBufferData(u,v),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0),l=this._program,u.bindVAO(this._vao),u.useProgram(l),l.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(c.PrimitiveType.LINES,8*v.length,c.DataType.UNSIGNED_INT,0),u.bindVAO())}_createTransforms(){return{displayViewScreenMat3:p.create()}}_createShaderProgram(l){this._program||
(this._program=l.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos \x3d u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position \x3d vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor \x3d vec4(0.75, 0.0, 0.0, 0.75);\n      }",m().attributes))}_updateMatricesAndLocalOrigin(l){var {state:u}=l;const {displayMat3:v,size:r,resolution:y,
pixelRatio:x,rotation:w,viewpoint:A}=u;l=f*w;const {x:z,y:C}=A.targetGeometry;u=n.normalizeMapX(z,u.spatialReference);this._localOrigin.x=u;this._localOrigin.y=C;u=x*r[0];const D=x*r[1],F=y*u,G=y*D,B=g.identity(this._dvsMat3);g.multiply(B,B,v);g.translate(B,B,h.fromValues(u/2,D/2));g.scale(B,B,k.fromValues(r[0]/F,-D/G,1));g.rotate(B,B,-l)}_updateBufferData(l,u){const {x:v,y:r}=this._localOrigin,y=new Float32Array(8*u.length),x=new Uint32Array(8*u.length);let w=0,A=0;for(const z of u)z&&(y[2*w]=z[0]-
v,y[2*w+1]=z[1]-r,y[2*w+2]=z[0]-v,y[2*w+3]=z[3]-r,y[2*w+4]=z[2]-v,y[2*w+5]=z[3]-r,y[2*w+6]=z[2]-v,y[2*w+7]=z[1]-r,x[A]=w+0,x[A+1]=w+3,x[A+2]=w+3,x[A+3]=w+2,x[A+4]=w+2,x[A+5]=w+1,x[A+6]=w+1,x[A+7]=w+0,w+=4,A+=8);this._vertexBuffer?this._vertexBuffer.setData(y.buffer):this._vertexBuffer=a.BufferObject.createVertex(l,c.Usage.DYNAMIC_DRAW,y.buffer);this._indexBuffer?this._indexBuffer.setData(x):this._indexBuffer=a.BufferObject.createIndex(l,c.Usage.DYNAMIC_DRAW,x);this._vao||(u=m(),this._vao=new q.VertexArrayObject(l,
u.attributes,u.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer))}}const m=()=>b.createProgramDescriptor("bounds",{geometry:[{location:0,name:"a_position",count:2,type:c.DataType.FLOAT}]});return t})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(e){function g(){return new Float32Array(3)}function p(v){const r=new Float32Array(3);r[0]=v[0];r[1]=v[1];r[2]=v[2];return r}function h(v,r,y){const x=new Float32Array(3);x[0]=v;x[1]=r;x[2]=y;return x}function k(v,
r){return new Float32Array(v,r,3)}function n(){return g()}function d(){return h(1,1,1)}function b(){return h(1,0,0)}function a(){return h(0,1,0)}function c(){return h(0,0,1)}const q=g(),f=d(),t=b(),m=a(),l=c(),u=Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:t,UNIT_Y:m,UNIT_Z:l,ZEROS:q,clone:p,create:g,createView:k,fromValues:h,ones:d,unitX:b,unitY:a,unitZ:c,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=f;e.UNIT_X=t;e.UNIT_Y=m;e.UNIT_Z=l;e.ZEROS=q;e.clone=p;e.create=g;e.createView=
k;e.fromValues=h;e.ones=d;e.unitX=b;e.unitY=a;e.unitZ=c;e.vec3f32=u;e.zeros=n;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/MapViewNavigation":function(){define("../../../chunks/tslib.es6 ../../../Viewpoint ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l){const u=new g({targetGeometry:new c}),v=[0,0];g=class extends p{constructor(r){super(r);this.animationManager=this._lastEventTimestamp=this._endTimer=null;this.interacting=!1}initialize(){this.pan=new t({navigation:this});this.rotate=new l({navigation:this});this.pinch=new m({navigation:this});this.zoomBox=new f({view:this.view,navigation:this})}destroy(){this.pan=h.destroyMaybe(this.pan);this.rotate=h.destroyMaybe(this.rotate);this.pinch=h.destroyMaybe(this.pinch);
this.zoomBox=h.destroyMaybe(this.zoomBox);this.animationManager=null}begin(){this.stop();this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now();this._startTimer(250)}async zoom(r,y=this._getDefaultAnchor()){this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>r?this.zoomIn(y):this.zoomOut(y);this.setViewpoint(y,r,0,[0,0])}async zoomIn(r){var y=this.view;y=y.constraints.snapToNextScale(y.scale);return this._zoomToScale(y,r)}async zoomOut(r){var y=
this.view;y=y.constraints.snapToPreviousScale(y.scale);return this._zoomToScale(y,r)}setViewpoint(r,y,x,w){this.begin();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,y,x,w);this.end()}setViewpointImmediate(r,y=0,x=[0,0],w=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,w,r,y,x)}continousRotateClockwise(){const r=this.view.viewpoint;this.animationManager?.animateContinous(r,y=>
{q.rotateBy(y,y,-1)})}continousRotateCounterclockwise(){const r=this.view.viewpoint;this.animationManager?.animateContinous(r,y=>{q.rotateBy(y,y,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:r,y}){this._continuousPan([10*r,10*y])}stop(){this.pan.stopMomentumNavigation();
this.animationManager?.stop();this.end();null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(r){const y=this.view.viewpoint;this.animationManager?.animateContinous(y,x=>{q.translateBy(x,x,r);this.view.constraints.constrainByGeometry(x)})}_startTimer(r){return null!==this._endTimer?this._endTimer:this._endTimer=setTimeout(()=>{this._endTimer=null;const y=performance.now()-(this._lastEventTimestamp??0);250>y?this._endTimer=this._startTimer(y):
this._set("interacting",!1)},r)}_getDefaultAnchor(){const {size:r,padding:{left:y,right:x,top:w,bottom:A}}=this.view;v[0]=.5*(r[0]-x+y);v[1]=.5*(r[1]-A+w);return v}async _zoomToScale(r,y=this._getDefaultAnchor()){const {view:x}=this,{constraints:w,scale:A,viewpoint:z,size:C,padding:D}=x,F=w.canZoomInTo(r),G=w.canZoomOutTo(r);if(!(r<A&&!F||r>A&&!G))return q.padAndScaleAndRotateBy(u,z,r/A,0,y,C,D),w.constrainByGeometry(u),x.goTo(u,{animate:!0,pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(r,
y,x,w,A){var {view:z}=this;const {size:C,padding:D,constraints:F,scale:G,viewpoint:B}=z;var I=G*x;z=F.canZoomInTo(I);I=F.canZoomOutTo(I);if(1>x&&!z||1<x&&!I)x=1;q.translateBy(B,B,A);q.padAndScaleAndRotateBy(r,B,x,w,y,C,D);return F.constrainByGeometry(r)}};e.__decorate([k.property()],g.prototype,"animationManager",void 0);e.__decorate([k.property({type:Boolean,readOnly:!0})],g.prototype,"interacting",void 0);e.__decorate([k.property()],g.prototype,"pan",void 0);e.__decorate([k.property()],g.prototype,
"pinch",void 0);e.__decorate([k.property()],g.prototype,"rotate",void 0);e.__decorate([k.property()],g.prototype,"view",void 0);e.__decorate([k.property()],g.prototype,"zoomBox",void 0);return g=e.__decorate([a.subclass("esri.views.2d.navigation.MapViewNavigation")],g)})},"esri/views/2d/navigation/ZoomBox":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../input/InputManager".split(" "),
function(e,g,p,h,k,n,d,b,a){g=class extends g{constructor(c){super(c);this._boxShape=this._backgroundShape=this._overlay=this._container=null;this._box={x:0,y:0,width:0,height:0};this._rafId=null;this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(c){this.removeAllHandles();this._destroyOverlay();this._set("view",c);c&&this.addHandles([c.on("drag",["Shift"],q=>this._handleDrag(q,1),a.ViewEventPriorities.INTERNAL),c.on("drag",["Shift","Ctrl"],q=>this._handleDrag(q,-1),a.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer();
this._createOverlay();this.navigation.begin()}_update(c,q,f,t){this._box.x=c;this._box.y=q;this._box.width=f;this._box.height=t;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(c,q,f,t,m){const l=this.view;c=l.toMap(p.createScreenPoint(c+.5*f,q+.5*t));f=Math.max(f/l.width,t/l.height);-1===m&&(f=1/f);this._destroyOverlay();this.navigation.end();l.goTo({center:c,scale:l.scale*f})}_updateBox(c,q,f,t){const m=this._boxShape;m.setAttributeNS(null,"x",""+c);m.setAttributeNS(null,"y",
""+q);m.setAttributeNS(null,"width",""+f);m.setAttributeNS(null,"height",""+t);m.setAttributeNS(null,"class","esri-zoom-box__outline")}_updateBackground(c,q,f,t){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(c,q,f,t,this.view.width,this.view.height))}_createContainer(){const c=document.createElement("div");c.className="esri-zoom-box__container";this.view.root.appendChild(c);this._container=c}_createOverlay(){var c=this.view.width,q=this.view.height;const f=document.createElementNS("http://www.w3.org/2000/svg",
"path");f.setAttributeNS(null,"d","M 0 0 L "+c+" 0 L "+c+" "+q+" L 0 "+q+" Z");f.setAttributeNS(null,"class","esri-zoom-box__overlay-background");c=document.createElementNS("http://www.w3.org/2000/svg","rect");q=document.createElementNS("http://www.w3.org/2000/svg","svg");q.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");q.setAttributeNS(null,"class","esri-zoom-box__overlay");q.appendChild(f);q.appendChild(c);this._container.appendChild(q);this._backgroundShape=
f;this._boxShape=c;this._overlay=q}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(c,q,f,t,m,l){f=c+f;t=q+t;return"M 0 0 L "+m+" 0 L "+m+" "+l+" L 0 "+l+" ZM "+c+" "+q+" L "+c+" "+t+" L "+f+" "+t+" L "+f+" "+q+" Z"}_handleDrag(c,q){var f=c.x,t=c.y,m=c.origin.x;const l=c.origin.y;let u;f>m?(u=m,m=f-m):(u=f,m-=f);t>l?(f=l,t-=l):(f=t,t=l-t);switch(c.action){case "start":this._start();
break;case "update":this._update(u,f,m,t);break;case "end":this._end(u,f,m,t,q)}c.stopPropagation()}_redraw(){if(this._rafId&&(this._rafId=null,this._overlay)){var {x:c,y:q,width:f,height:t}=this._box;this._updateBox(c,q,f,t);this._updateBackground(c,q,f,t);this._rafId=requestAnimationFrame(this._redraw)}}};e.__decorate([h.property()],g.prototype,"navigation",void 0);e.__decorate([h.property()],g.prototype,"view",null);return g=e.__decorate([b.subclass("esri.views.2d.navigation.ZoomBox")],g)})},"esri/views/2d/navigation/actions/Pan":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator ../../../../geometry/Point".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u){g=class extends h{constructor(v){super(v);this.animationTime=0;this.momentumEstimator=new l.PanPlanarMomentumEstimator(500,6,.92);this.momentum=null;this.tmpMomentum=t.create();this.momentumFinished=!1;this.viewpoint=new p({targetGeometry:new u,scale:0,rotation:0});this._previousDrag=null;k.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(v,r){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(r);this._previousDrag=
r}update(v,r){this.addToEstimator(r);let y=r.center.x,x=r.center.y;const w=this._previousDrag;y=w?w.center.x-y:-y;x=w?x-w.center.y:x;v.viewpoint=m.translateBy(this.viewpoint,v.viewpoint,[y||0,x||0]);this._previousDrag=r}end(v,r){this.addToEstimator(r);this.momentum=v.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(v);this._previousDrag=null;this.navigation.end()}addToEstimator(v){var r=v.center.x;const y=v.center.y,
x=n.createScreenPointArray(-r,y);r=t.fromValues(-r,y,0);this.momentumEstimator.add(x,r,.001*v.timestamp)}onAnimationUpdate(v){this.navigation.animationManager?.animateContinous(v.viewpoint,(r,y)=>{const {momentum:x,animationTime:w,tmpMomentum:A}=this;var z=this.momentumFinished=!x||x.isFinished(w);y*=.001;z||(z=x.valueDelta(w,y),f.scale(A,x.direction,z),m.translateBy(r,r,A),v.constraints.constrainByGeometry(r));this.animationTime+=y})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),
this.momentum=null,this.navigation.stop())}};e.__decorate([d.property()],g.prototype,"momentumFinished",void 0);e.__decorate([d.property()],g.prototype,"viewpoint",void 0);e.__decorate([d.property()],g.prototype,"navigation",void 0);return g=e.__decorate([q.subclass("esri.views.2d.navigation.actions.Pan")],g)})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],
function(e,g,p,h,k){class n extends k.Momentum{constructor(b,a,c,q,f){super(b,a,c);this._sceneVelocity=q;this.direction=f}value(b){return super.valueFromInitialVelocity(this._sceneVelocity,b)}}class d{constructor(b=300,a=12,c=.84){this._minimumInitialVelocity=b;this._stopVelocity=a;this._friction=c;this.enabled=!0;this._time=new h.FilteredFiniteDifference(.6);this._screen=[new h.FilteredFiniteDifference(.4),new h.FilteredFiniteDifference(.4)];this._scene=[new h.FilteredFiniteDifference(.6),new h.FilteredFiniteDifference(.6),
new h.FilteredFiniteDifference(.6)];this._tmpDirection=p.create()}add(b,a,c){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(c)||(this._screen[0].update(b[0]),this._screen[1].update(b[1]),this._scene[0].update(a[0]),this._scene[1].update(a[1]),this._scene[2].update(a[2]),this._time.update(c))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||
!this._time.hasFilteredDelta())return null;var b=this._screen[0].filteredDelta,a=this._screen[1].filteredDelta;b=null==b||null==a?0:Math.sqrt(b*b+a*a);a=this._time.filteredDelta;b=null==a||null==b?0:b/a;return Math.abs(b)<this._minimumInitialVelocity?null:this.createMomentum(b,this._stopVelocity,this._friction)}createMomentum(b,a,c){g.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const q=g.length(this._tmpDirection);0<q&&g.scale(this._tmpDirection,
this._tmpDirection,1/q);const f=this._time.filteredDelta;return new n(b,a,c,null==f?0:q/f,this._tmpDirection)}}e.PanPlanarMomentum=n;e.PanPlanarMomentumEstimator=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(e){class g{constructor(p){this._gain=p;this.filteredDelta=this.lastValue=void 0}update(p){if(this.hasLastValue()){const h=this.computeDelta(p);this._updateDelta(h)}this.lastValue=p}reset(){this.filteredDelta=
this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(p){return void 0===this.lastValue?NaN:p-this.lastValue}_updateDelta(p){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*p:p}}e.FilteredFiniteDifference=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(e){class g{constructor(p,h,k){this._initialVelocity=
p;this._stopVelocity=h;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(p){return p>this.duration}get friction(){return this._friction}value(p){return this.valueFromInitialVelocity(this._initialVelocity,p)}valueDelta(p,h){const k=this.value(p);return this.value(p+h)-k}valueFromInitialVelocity(p,h){h=Math.min(h,this.duration);const k=1-this.friction;return p*(k**h-1)/Math.log(k)}}
e.Momentum=g;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator ../../../../geometry/Point".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u){g=class extends h{constructor(v){super(v);this._animationTime=0;this._momentumFinished=!1;this._previousRadius=this._previousAngle=0;this._previousCenter=null;this._rotationMomentumEstimator=new m.RotationMomentumEstimator(.6,.15,.95);this._rotationDirection=1;this._startRadius=this._startAngle=0;this._updateTimestamp=null;this._zoomDirection=1;this._zoomMomentumEstimator=new l.ZoomMomentumEstimator;this.rotateMomentum=this.zoomMomentum=this._zoomOnly=null;
this.viewpoint=new p({targetGeometry:new u,scale:0,rotation:0});this.addHandles(k.when(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(v,r){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=r.angle;this._previousRadius=this._startRadius=r.radius;this._previousCenter=r.center;this._updateTimestamp=null;v.constraints.rotationEnabled&&this.addToRotateEstimator(0,r.timestamp);this.addToZoomEstimator(r,
1)}update(v,r){null===this._updateTimestamp&&(this._updateTimestamp=r.timestamp);const y=r.angle,x=r.radius,w=r.center,A=Math.abs(180*(y-this._startAngle)/Math.PI),z=Math.abs(x-this._startRadius),C=this._startRadius/x;if(this._previousRadius&&this._previousCenter){const D=x/this._previousRadius;let F=180*(y-this._previousAngle)/Math.PI;this._rotationDirection=0<=F?1:-1;this._zoomDirection=1<=D?1:-1;v.constraints.rotationEnabled?(null===this._zoomOnly&&200<r.timestamp-this._updateTimestamp&&(this._zoomOnly=
0<z-A),null===this._zoomOnly||this._zoomOnly?F=0:this.addToRotateEstimator(y-this._startAngle,r.timestamp)):F=0;this.addToZoomEstimator(r,C);this.navigation.setViewpoint([w.x,w.y],1/D,F,[this._previousCenter.x-w.x,w.y-this._previousCenter.y])}this._previousAngle=y;this._previousRadius=x;this._previousCenter=w}end(v){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(v);
this.navigation.end()}addToRotateEstimator(v,r){this._rotationMomentumEstimator.add(v,.001*r)}addToZoomEstimator(v,r){this._zoomMomentumEstimator.add(r,.001*v.timestamp)}canZoomIn(v){const r=v.scale;v=v.constraints.effectiveMaxScale;return 0===v||r>v}canZoomOut(v){const r=v.scale;v=v.constraints.effectiveMinScale;return 0===v||r<v}onAnimationUpdate(v){this.navigation.animationManager?.animateContinous(v.viewpoint,(r,y)=>{var x=!this.canZoomIn(v)&&1<this._zoomDirection||!this.canZoomOut(v)&&1>this._zoomDirection,
w=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime);x=x||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime);y*=.001;this._momentumFinished=w&&x;if(!this._momentumFinished){w=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,y))*this._rotationDirection*180/Math.PI:0;x=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,y)):1;const z=f.create();var A=f.create();if(this._previousCenter){q.set(z,this._previousCenter.x,
this._previousCenter.y);t.getPaddingScreenTranslation(A,v.size,v.padding);q.add(z,z,A);const {constraints:C,scale:D}=v;A=D*x;1>x&&!C.canZoomInTo(A)?(x=D/C.effectiveMaxScale,this.rotateMomentum=this.zoomMomentum=null):1<x&&!C.canZoomOutTo(A)&&(x=D/C.effectiveMinScale,this.rotateMomentum=this.zoomMomentum=null);t.scaleAndRotateBy(r,v.viewpoint,x,w,z,v.size);v.constraints.constrainByGeometry(r)}}this._animationTime+=y})}stopMomentumNavigation(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&
(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()}};e.__decorate([n.property()],g.prototype,"_momentumFinished",void 0);e.__decorate([n.property()],g.prototype,"viewpoint",void 0);e.__decorate([n.property()],g.prototype,"navigation",void 0);return g=e.__decorate([c.subclass("esri.views.2d.navigation.actions.Pinch")],g)})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(e,g){class p extends g.MomentumEstimator{constructor(h=3,k=.01,n=.95,d=12){super(h,k,n,d)}add(h,k){const n=this.value.lastValue;if(null!=n){for(h-=n;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;h=n+h}super.add(h,k)}}e.RotationMomentumEstimator=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(e,g,
p,h){class k{constructor(n=2.5,d=.01,b=.95,a=12){this._minimumInitialVelocity=n;this._stopVelocity=d;this._friction=b;this._maxVelocity=a;this.enabled=!0;this.value=new p.FilteredFiniteDifference(.8);this.time=new p.FilteredFiniteDifference(.3)}add(n,d){if(this.enabled&&null!=d){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(d))return;if(this.value.hasFilteredDelta()){const b=this.value.computeDelta(n);0>this.value.filteredDelta*b&&this.value.reset()}}this.time.update(d);this.value.update(n)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let n=this.value.filteredDelta/this.time.filteredDelta;n=g.clamp(n,-this._maxVelocity,this._maxVelocity);return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(n,d,b){return new h.Momentum(n,d,b)}}e.MomentumEstimator=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(e,g,p){class h extends g.Momentum{constructor(n,d,b){super(n,d,b)}value(n){n=super.value(n);return Math.exp(n)}valueDelta(n,d){const b=super.value(n);n=super.value(n+d);return Math.exp(n-b)}}class k extends p.MomentumEstimator{constructor(n=2.5,d=.01,b=.95,a=12){super(n,d,b,a)}add(n,d){super.add(Math.log(n),d)}createMomentum(n,d,b){return new h(n,d,b)}}e.ZoomMomentum=h;e.ZoomMomentumEstimator=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/navigation/actions/Rotate":function(){define("../../../../chunks/tslib.es6 ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../viewpointUtils ../../../../geometry/Point".split(" "),function(e,
g,p,h,k,n,d,b,a,c,q,f,t){const m=q.create(),l=q.create();g=class extends h{constructor(u){super(u);this._previousCenter=q.create();this.viewpoint=new p({targetGeometry:new t,scale:0,rotation:0})}begin(u,v){this.navigation.begin();c.set(this._previousCenter,v.center.x,v.center.y)}update(u,v){const {state:{size:r,padding:y}}=u;c.set(m,v.center.x,v.center.y);f.getAnchor(l,r,y);u.viewpoint=f.rotateBy(this.viewpoint,u.state.paddedViewState.viewpoint,f.angleBetween(l,this._previousCenter,m));c.copy(this._previousCenter,
m)}end(){this.navigation.end()}};e.__decorate([k.property()],g.prototype,"viewpoint",void 0);e.__decorate([k.property()],g.prototype,"navigation",void 0);return g=e.__decorate([a.subclass("esri.views.2d.actions.Rotate")],g)})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("../../../request ../../../core/asyncUtils ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/urlUtils ../../../core/libs/gl-matrix-2/factories/mat3f32 ../engine/DisplayObject ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/enums ../engine/webgl/shaders/MagnifierPrograms ../../magnifier/resources ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/VertexArrayObject".split(" "),
function(e,g,p,h,k,n,d,b,a,c,q,f,t,m,l,u,v,r){class y extends a.DisplayObject{constructor(){super();this._handles=new p;this._resourcePixelRatio=1;this.visible=!1}destroy(){this._handles=k.destroyMaybe(this._handles);this._disposeRenderResources();this._resourcesTask=k.abortMaybe(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(x){this._backgroundColor=x;this.requestRender()}get magnifier(){return this._magnifier}set magnifier(x){this._magnifier=x;this._handles.removeAll();
this._handles.add([n.watch(()=>x.version,()=>{this.visible=x.visible&&null!=x.position&&0<x.size;this.requestRender()},n.initial),n.watch(()=>[x.maskUrl,x.overlayUrl],()=>this._reloadResources()),n.watch(()=>x.size,()=>{this._disposeRenderResources();this.requestRender()})])}_createTransforms(){return{displayViewScreenMat3:b.create()}}doRender(x){const w=x.context;if(!this._resourcesTask)this._reloadResources();else if(x.drawPhase===q.WGLDrawPhase.MAP&&this._canRender()){this._updateResources(x);
var A=this._magnifier;if(null!=A.position){var z=x.pixelRatio,C=A.size*z,D=Math.ceil(1/A.factor*C);this._readbackTexture.resize(D,D);var {size:F}=x.state;x=z*F[0];F=z*F[1];var G=.5*D,B=.5*D,I=h.clamp(z*A.position.x,G,x-G-1),H=h.clamp(F-z*A.position.y,B,F-B-1);w.setBlendingEnabled(!0);G=I-G;B=H-B;var K=this._readbackTexture;w.bindTexture(K,0);w.gl.copyTexImage2D(K.descriptor.target,0,K.descriptor.pixelFormat,G,B,D,D,0);D=(D=this.backgroundColor)?[D.a*D.r/255,D.a*D.g/255,D.a*D.b/255,D.a]:[1,1,1,1];
I=-1+(I+A.offset.x*z)/x*2;z=-1+(H-A.offset.y*z)/F*2;x=C/x*2;C=C/F*2;F=this._program;w.bindVAO(this._vertexArrayObject);w.bindTexture(this._overlayTexture,6);w.bindTexture(this._maskTexture,7);w.useProgram(F);F.setUniform4fv("u_background",D);F.setUniform1i("u_readbackTexture",0);F.setUniform1i("u_overlayTexture",6);F.setUniform1i("u_maskTexture",7);F.setUniform4f("u_drawPos",I,z,x,C);F.setUniform1i("u_maskEnabled",A.maskEnabled?1:0);F.setUniform1i("u_overlayEnabled",A.overlayEnabled?1:0);w.setStencilTestEnabled(!1);
w.setColorMask(!0,!0,!0,!0);w.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);w.bindVAO()}}}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const x=null!=this._magnifier?this._magnifier.maskUrl:null,w=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=g.createTask(async A=>{const z=null==x||null==w?t.loadMagnifierResources(A):null,C=null!=x?e(x,{responseType:"image",signal:A}).then(G=>G.data):
z.then(G=>G.mask);A=null!=w?e(w,{responseType:"image",signal:A}).then(G=>G.data):z.then(G=>G.overlay);const [D,F]=await Promise.all([C,A]);this.mask=D;this.overlay=F;this._disposeRenderResources();this.requestRender()})}_disposeRenderResources(){this._readbackTexture=k.disposeMaybe(this._readbackTexture);this._overlayTexture=k.disposeMaybe(this._overlayTexture);this._maskTexture=k.disposeMaybe(this._maskTexture);this._vertexArrayObject=k.disposeMaybe(this._vertexArrayObject);this._program=k.disposeMaybe(this._program)}_updateResources(x){x.pixelRatio!==
this._resourcePixelRatio&&this._disposeRenderResources();if(!this._readbackTexture){var w=x.context;this._resourcePixelRatio=x.pixelRatio;var A=Math.ceil(this._magnifier.size*x.pixelRatio);this._program=f.createMagnifierProgram(w);var z=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new r.VertexArrayObject(w,f.magnifierProgramTemplate.attributes,c.Pos2us,{geometry:m.BufferObject.createVertex(w,l.Usage.STATIC_DRAW,z)});this.overlay.width=A;this.overlay.height=A;z=new v.TextureDescriptor;
z.internalFormat=l.PixelFormat.RGBA;z.wrapMode=l.TextureWrapMode.CLAMP_TO_EDGE;z.samplingMode=l.TextureSamplingMode.NEAREST;z.flipped=!0;z.preMultiplyAlpha=!d.isSVG(this.overlay.src)||!x.context.driverTest.svgPremultipliesAlpha.result;this._overlayTexture=new u.Texture(w,z,this.overlay);this.mask.width=A;this.mask.height=A;z.pixelFormat=z.internalFormat=l.PixelFormat.ALPHA;this._maskTexture=new u.Texture(w,z,this.mask);x=1/this._magnifier.factor;z.pixelFormat=z.internalFormat=l.PixelFormat.RGBA;z.width=
z.height=Math.ceil(x*A);z.samplingMode=l.TextureSamplingMode.LINEAR;z.flipped=!1;this._readbackTexture=new u.Texture(w,z)}}}return y})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/ProgramTemplate"],function(e,g,p){const h={shaders:{vertexShader:g.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:g.resolveIncludes("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};e.createMagnifierProgram=function(k){return p.createProgram(k,
h)};e.magnifierProgramTemplate=h;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(e,g,p,h){const k=n=>Object.freeze(Object.defineProperty({__proto__:null,default:n},Symbol.toStringTag,{value:"Module"}));g.loadMagnifierResources=async function(n){var d=new Promise((a,c)=>e(["./mask-svg"],q=>a(k(q)),c)),b=new Promise((a,c)=>e(["./overlay-svg"],
q=>a(k(q)),c));d=h.requestImage((await d).default,{signal:n});b=h.requestImage((await b).default,{signal:n});b={mask:await d,overlay:await b};p.throwIfAborted(n);return b};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(e,g){e.requestImage=async function(p,h){({data:p}=await g(p,{responseType:"image",...h}));return p};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports",
"./math/mat4"],function(e,g){e.mat4=g.mat4;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","./factories/mat4f32"],function(e,g){e.mat4f32=g.mat4f32;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports","./factories/vec3f32"],function(e,g){e.vec3f32=g.vec3f32;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports",
"./factories/vec4f32"],function(e,g){e.vec4f32=g.vec4f32;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define("exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../core/libs/gl-matrix-2/factories/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),function(e,g,p,h,k,n,d,b,a,c){function q(m){return m&&
"render"in m}function f(m){const l=document.createElement("canvas");l.width=m.width;l.height=m.height;m.render(l.getContext("2d"));return l}class t extends n.DisplayObject{constructor(m=null,l=!1){super();this.blendFunction="standard";this._sourceHeight=this._sourceWidth=0;this._textureInvalidated=!1;this._texture=null;this.stencilRef=0;this.coordScale=[1,1];this._height=void 0;this.pixelRatio=1;this.rotation=this.resolution=0;this._source=null;this._width=void 0;this.y=this.x=0;this.immutable=l;
this.source=m;this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null);null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(m){this._height=m}get source(){return this._source}set source(m){if(null!=m||null!=this._source)this._source=
m,this.invalidateTexture(),this.requestRender()}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(m){this._width=m}beforeRender(m){super.beforeRender(m);this.updateTexture(m)}async setSourceAsync(m,l){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const u=new AbortController,v=g.createResolver();g.onAbortOrThrow(l,()=>u.abort());g.onAbortOrThrow(u,r=>v.reject(r));this._uploadStatus={controller:u,resolver:v};this.source=m;return v.promise}invalidateTexture(){this._textureInvalidated||
(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}updateTransitionProperties(m,l){64<=m&&(this.inFadeTransition=this.fadeTransitionEnabled=!1);super.updateTransitionProperties(m,l)}setTransform(m){const l=p.identity(this.transforms.displayViewScreenMat3),[u,v]=m.toScreenNoRotation([0,0],[this.x,
this.y]);var r=this.resolution/this.pixelRatio/m.resolution;const y=r*this.width;r*=this.height;const x=Math.PI*this.rotation/180;p.translate(l,l,k.fromValues(u,v));p.translate(l,l,k.fromValues(y/2,r/2));p.rotate(l,l,-x);p.translate(l,l,k.fromValues(-y/2,-r/2));p.scaleByVec2(l,l,k.fromValues(y,r));p.multiply(this.transforms.displayViewScreenMat3,m.displayViewMat3,l)}setSamplingProfile(m){this._texture&&(m.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(m.samplingMode))}bind(m,
l){this._texture&&m.bindTexture(this._texture,l)}async updateTexture({context:m,painter:l}){if(this._textureInvalidated)if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(m)),this.source){this._texture.resize(this._sourceWidth,this._sourceHeight);m=this.source;m=q(m)?m instanceof d?m.getRenderedRasterPixels()?.renderedRasterPixels:f(m):m;try{if(null!=this._uploadStatus){const {controller:u,resolver:v}=this._uploadStatus,r={signal:u.signal},{width:y,height:x}=this;await l.textureUploadManager.enqueueTextureUpdate({data:m,
texture:this._texture,width:y,height:x},r);v.resolve();this._uploadStatus=null}else this._texture.setData(m);this.ready()}catch(u){g.throwIfNotAbortError(u)}}else this._texture.setData(null)}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:h.create()}}_createTexture(m){const l=this.immutable,u=new c.TextureDescriptor;u.internalFormat=l?b.SizedPixelFormat.RGBA8:b.PixelFormat.RGBA;u.wrapMode=b.TextureWrapMode.CLAMP_TO_EDGE;u.isImmutable=l;u.width=this._sourceWidth;u.height=
this._sourceHeight;return new a.Texture(m,u)}}e.Bitmap=t;e.isImageSource=q;e.rasterize=f;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(function(){class e{constructor(g,p,h){this.pixelBlock=g;this.extent=p;this.originalPixelBlock=h}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(g){var p=this.pixelBlock;if(null!=p){var h=this.filter({extent:this.extent,
pixelBlock:this.originalPixelBlock??p});null!=h.pixelBlock&&(h.pixelBlock.maskIsAlpha&&(h.pixelBlock.premultiplyAlpha=!0),p=h.pixelBlock.getAsRGBA(),h=g.createImageData(h.pixelBlock.width,h.pixelBlock.height),h.data.set(p),g.putImageData(h,0,0))}}getRenderedRasterPixels(){const g=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});if(null==g.pixelBlock)return null;g.pixelBlock.maskIsAlpha&&(g.pixelBlock.premultiplyAlpha=!0);return{width:g.pixelBlock.width,height:g.pixelBlock.height,renderedRasterPixels:new Uint8Array(g.pixelBlock.getAsRGBA().buffer)}}}
return e})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","./brushes","./webgl/enums","./webgl/WGLContainer"],function(e,g,p,h){class k extends h{constructor(){super(...arguments);this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(n){super.beforeRender(n);this._manageFade()}prepareRenderPasses(n){const d=n.registerRenderPass({name:"bitmap",brushes:[g.brushes.bitmap],target:()=>this.children,drawPhase:p.WGLDrawPhase.MAP});
return[...super.prepareRenderPasses(n),d]}_manageFade(){2<=this.children.reduce((n,d)=>n+(d.inFadeTransition?1:0),0)?(this.children.forEach(n=>n.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(n=>n.blendFunction="standard"),this._hasCrossfade=!1)}}e.BitmapContainer=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f32","./Bitmap","./webgl/TiledDisplayObject"],
function(e,g,p,h){class k extends h.TiledDisplayObject{constructor(n,d,b,a,c,q,f=null){super(n,d,b,a,c,q);this.bitmap=new p.Bitmap(f);this.bitmap.coordScale=[c,q];this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy();this.bitmap.destroy()}beforeRender(n){this.bitmap.beforeRender(n);super.beforeRender(n)}afterRender(n){this.bitmap.afterRender(n);super.afterRender(n)}set stencilRef(n){this.bitmap.stencilRef=n}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:g.create(),
tileMat3:g.create()}}setTransform(n){super.setTransform(n);this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}e.BitmapTile=k;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define("exports ../../../geometry/support/aaBoundingRect ./BitmapTile ./brushes ./webgl/enums ./webgl/TileContainer".split(" "),function(e,
g,p,h,k,n){class d extends n{get requiresDedicatedFBO(){return this.children.some(b=>"additive"===b.bitmap.blendFunction)}createTile(b){const a=this._tileInfoView.getTileBounds(g.create(),b),c=this._tileInfoView.getTileResolution(b.level),[q,f]=this._tileInfoView.tileInfo.size;return new p.BitmapTile(b,c,a[0],a[3],q,f)}prepareRenderPasses(b){const a=b.registerRenderPass({name:"bitmap (tile)",brushes:[h.brushes.bitmap],target:()=>this.children.map(c=>c.bitmap),drawPhase:k.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(b),
a]}doRender(b){this.visible&&b.drawPhase===k.WGLDrawPhase.MAP&&super.doRender(b)}}e.BitmapTileContainer=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(e,g){e.premultiplyAlpha=function(p,h=0,k=!1){const n=p[h+3];p[h]*=n;p[h+1]*=n;p[h+2]*=n;k||(p[h+3]*=255);return p};e.premultiplyAlphaRGBA=function(p){if(!p)return 0;const {r:h,g:k,b:n,a:d}=p;return g.i8888to32(h*d,k*d,n*d,255*d)};e.premultiplyAlphaRGBAArray=
function(p){if(!p)return 0;const [h,k,n,d]=p;return g.i8888to32(d/255*h,d/255*k,d/255*n,d)};e.writeColor=function(p,h,k=0){if(null==h)p[k]=0,p[k+1]=0,p[k+2]=0,p[k+3]=0;else{var {r:n,g:d,b,a}=h;p[k]=n*a/255;p[k+1]=d*a/255;p[k+2]=b*a/255;p[k+3]=a}};Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports","../shaderGraph/techniques/mesh/createMeshWriter"],function(e,g){class p{constructor(){this._backgroundFillResult=this._defaultResult=
null}static async from(h,k,n,d){const b=new p;b.setDefault(await g.createMeshWriterGroupFromSchema(h,k,n.meshes,d));return b}size(){return 1}getDefault(){return this._defaultResult}setDefault(h){this._defaultResult=h}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(h){this._backgroundFillResult=h}match(h,k){return(h=this.doMatch(h,k)||this.getDefault())&&0<h.length&&(k=this.getBackgroundFill())?[...k,...h]:h}getSortKey(h,k){return 0}doMatch(h,k){return null}async fetchResources(h,
k){}}e.FeatureMatcher=p;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("exports ./engine/Stage ./LabelManager ./layers/graphics/GraphicsView2D ./layers/graphics/GraphicContainer ./navigation/MapViewNavigation ./magnifier/MagnifierView2D".split(" "),function(e,g,p,h,k,n,d){e.Stage=g.Stage;Object.defineProperty(e,"LabelManager",{enumerable:!0,get:()=>p.LabelManager});e.GraphicsView2D=h;e.GraphicContainer=k;e.MapViewNavigation=n;e.MagnifierView2D=d;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});