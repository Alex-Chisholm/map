// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/overrideDefaultsFrom":function(){define(["exports","../Accessor","./PropertyOrigin","./utils"],function(a,b,n,h){function k(m,g){var e=h.getProperties(m),d=h.getProperties(g);e=e.store;g=d.store;d=d.metadata;for(const f in d){var c=d[f],l=e.originOf(f);const r=g.originOf(f);c.readOnly||r===n.OriginId.DEFAULTS||(l!==n.OriginId.DEFAULTS?(c=e.get(f),l=g.get(f),c&&l&&l instanceof b&&c instanceof b&&c instanceof l.constructor&&k(c,l)):m.set(f,g.get(f)))}}a.overrideDefaultsFrom=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingRect":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","./projectBuffer","../support/aaBoundingRect","../support/spatialReferenceUtils"],function(a,b,n,h,k){const m=b.create();a.projectBoundingRect=function(g,e,d,c){if(null==g)return!1;if(k.equals(e,c))return h.copy(d,g),!0;m[0]=g[0];m[1]=g[1];m[2]=0;if(!n.projectBuffer(m,e,0,m,c,0,1))return!1;d[0]=m[0];d[1]=m[1];
m[0]=g[2];m[1]=g[3];m[2]=0;if(!n.projectBuffer(m,e,0,m,c,0,1))return!1;d[2]=m[0];d[3]=m[1];return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectBuffer"],function(a,b,n,h){function k(g,e,d,c){if(n.canProjectWithoutEngine(g.spatialReference,d))return m[0]=g.x,m[1]=g.y,m[2]=g.z??c??0,h.projectBuffer(m,g.spatialReference,0,e,d,0,1);
g=n.tryProjectWithZConversion(g,d);if(!g)return!1;e[0]=g?.x;e[1]=g?.y;e[2]=g?.z??c??0;return!0}const m=b.create();a.projectPointToVector=k;a.projectPointToVectorAsync=async function(g,e,d,c,l){await n.initializeProjection(g.spatialReference,d,null,l);return k(g,e,d,c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(Z=ba){return{plane:f.create(Z.plane),origin:d.clone(Z.origin),basis1:d.clone(Z.basis1),basis2:d.clone(Z.basis2)}}function t(Z,ja,oa){const qa=aa.get();qa.origin=Z;qa.basis1=ja;qa.basis2=oa;qa.plane=f.wrap(0,0,0,0);y(qa);return qa}function q(Z,ja=p()){return v(Z.origin,Z.basis1,Z.basis2,ja)}function u(Z,ja){e.copy(ja.origin,Z.origin);e.copy(ja.basis1,Z.basis1);e.copy(ja.basis2,Z.basis2);f.copy(ja.plane,Z.plane)}function v(Z,ja,oa,qa=p()){e.copy(qa.origin,
Z);e.copy(qa.basis1,ja);e.copy(qa.basis2,oa);y(qa);1E-6<Math.abs(e.dot(qa.basis1,qa.basis2)/(e.length(qa.basis1)*e.length(qa.basis2)))&&ca().warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(e.dot(qa.basis1,T(qa)))&&ca().warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-e.dot(T(qa),qa.origin)-qa.plane[3])&&ca().warn("fromValues()","Plane offset is not consistent with plane origin");return qa}function y(Z){f.fromVectorsAndPoint(Z.basis2,
Z.basis1,Z.origin,Z.plane)}function D(Z,ja,oa){Z!==oa&&q(Z,oa);Z=e.scale(w.sv3d.get(),T(Z),ja);e.add(oa.origin,oa.origin,Z);oa.plane[3]-=ja;return oa}function G(Z,ja,oa){A(ja,oa);D(oa,S(Z,Z.origin),oa);return oa}function A(Z,ja=p()){const oa=(Z[2]-Z[0])/2,qa=(Z[3]-Z[1])/2;e.set(ja.origin,Z[0]+oa,Z[1]+qa,0);e.set(ja.basis1,oa,0,0);e.set(ja.basis2,0,qa,0);f.fromValues(0,0,1,0,ja.plane);return ja}function C(Z,ja,oa){return f.intersectRay(Z.plane,ja,oa)?Q(Z,oa):!1}function E(Z,ja,oa){if(C(Z,ja,oa))return oa;
Z=I(Z,ja,w.sv3d.get());e.add(oa,ja.origin,e.scale(w.sv3d.get(),ja.direction,e.distance(ja.origin,Z)/e.length(ja.direction)));return oa}function I(Z,ja,oa){const qa=ia.get();var ta=ia.get();W(Z,ja,qa,ta);ta=Number.POSITIVE_INFINITY;for(const Ca of ea){var va=U(Z,Ca,fa.get());const ma=w.sv3d.get();f.intersectLineSegment(qa,va,ma)&&(va=e.direction(w.sv3d.get(),ja.origin,ma),va=Math.abs(h.acosClamped(e.dot(ja.direction,va))),va<ta&&(ta=va,e.copy(oa,ma)))}return ta===Number.POSITIVE_INFINITY?H(Z,ja,oa):
oa}function H(Z,ja,oa){if(C(Z,ja,oa))return oa;const qa=ia.get(),ta=ia.get();W(Z,ja,qa,ta);let va=Number.POSITIVE_INFINITY;for(const ma of ea){var Ca=U(Z,ma,fa.get());const wa=w.sv3d.get();f.intersectLineSegmentClamp(qa,Ca,wa)&&(Ca=r.distance2(ja,wa),f.isPointInside(ta,wa)&&Ca<va&&(va=Ca,e.copy(oa,wa)))}z(Z,ja.origin)<va&&J(Z,ja.origin,oa);return oa}function J(Z,ja,oa){var qa=f.projectPoint(Z.plane,ja,w.sv3d.get());ja=l.projectPointClamp(V(Z,Z.basis1),qa,-1,1,w.sv3d.get());qa=l.projectPointClamp(V(Z,
Z.basis2),qa,-1,1,w.sv3d.get());e.subtract(oa,e.add(w.sv3d.get(),ja,qa),Z.origin);return oa}function B(Z,ja,oa){const {origin:qa,basis1:ta,basis2:va}=Z,Ca=e.subtract(w.sv3d.get(),ja,qa);ja=x.projectPointSignedLength(ta,Ca);const ma=x.projectPointSignedLength(va,Ca);Z=x.projectPointSignedLength(T(Z),Ca);return e.set(oa,ja,ma,Z)}function z(Z,ja){ja=B(Z,ja,w.sv3d.get());const {basis1:oa,basis2:qa}=Z;Z=e.length(oa);var ta=e.length(qa);Z=Math.max(Math.abs(ja[0])-Z,0);ta=Math.max(Math.abs(ja[1])-ta,0);
ja=ja[2];return Z*Z+ta*ta+ja*ja}function K(Z,ja){return Math.sqrt(z(Z,ja))}function L(Z,ja){let oa=Number.NEGATIVE_INFINITY;for(const ta of ea){var qa=U(Z,ta,fa.get());qa=l.distance2(qa,ja);qa>oa&&(oa=qa)}return Math.sqrt(oa)}function F(Z,ja){return f.isPointInside(Z.plane,ja)&&Q(Z,ja)}function M(Z,ja,oa,qa){switch(oa){case c.Axis.X:e.copy(qa,Z.basis1);e.normalize(qa,qa);break;case c.Axis.Y:e.copy(qa,Z.basis2);e.normalize(qa,qa);break;case c.Axis.Z:e.copy(qa,T(Z))}return qa}function S(Z,ja){const oa=
-Z.plane[3];return x.projectPointSignedLength(T(Z),ja)-oa}function N(Z,ja,oa,qa){const ta=S(Z,ja);Z=e.scale(da,T(Z),oa-ta);e.add(qa,ja,Z);return qa}function P(Z,ja){return e.exactEquals(Z.basis1,ja.basis1)&&e.exactEquals(Z.basis2,ja.basis2)&&e.exactEquals(Z.origin,ja.origin)}function R(Z,ja,oa){Z!==oa&&q(Z,oa);m.invert(ha,ja);m.transpose(ha,ha);e.transformMat4(oa.basis1,Z.basis1,ha);e.transformMat4(oa.basis2,Z.basis2,ha);e.transformMat4(f.getNormal(oa.plane),f.getNormal(Z.plane),ha);e.transformMat4(oa.origin,
Z.origin,ja);f.setOffsetFromPoint(oa.plane,oa.plane,oa.origin);return oa}function O(Z,ja,oa,qa){Z!==qa&&q(Z,qa);m.fromRotation(Y,ja,oa);e.transformMat4(qa.basis1,Z.basis1,Y);e.transformMat4(qa.basis2,Z.basis2,Y);y(qa);return qa}function T(Z){return f.getNormal(Z.plane)}function Q(Z,ja){const oa=e.subtract(w.sv3d.get(),ja,Z.origin);ja=e.squaredLength(Z.basis1);const qa=e.squaredLength(Z.basis2),ta=e.dot(Z.basis1,oa);Z=e.dot(Z.basis2,oa);return 0>-ta-ja&&0>ta-ja&&0>-Z-qa&&0>Z-qa}function V(Z,ja){const oa=
fa.get();e.copy(oa.origin,Z.origin);e.copy(oa.vector,ja);return oa}function U(Z,ja,oa){const {basis1:qa,basis2:ta,origin:va}=Z;Z=e.scale(w.sv3d.get(),qa,ja.origin[0]);const Ca=e.scale(w.sv3d.get(),ta,ja.origin[1]);e.add(oa.origin,Z,Ca);e.add(oa.origin,oa.origin,va);Z=e.scale(w.sv3d.get(),qa,ja.direction[0]);ja=e.scale(w.sv3d.get(),ta,ja.direction[1]);e.scale(oa.vector,e.add(Z,Z,ja),2);return oa}function W(Z,ja,oa,qa){Z=T(Z);f.fromVectorsAndPoint(Z,ja.direction,ja.origin,oa);f.fromVectorsAndPoint(f.getNormal(oa),
Z,ja.origin,qa)}const ca=()=>n.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class X{constructor(){this.plane=f.create();this.origin=d.create();this.basis1=d.create();this.basis2=d.create()}}b=X;const ba={plane:f.create(),origin:d.fromValues(0,0,0),basis1:d.fromValues(1,0,0),basis2:d.fromValues(0,1,0)},ia=new k.ObjectStack(f.create),fa=new k.ObjectStack(l.create),da=d.create(),aa=new k.ObjectStack(()=>p()),ea=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,
1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ha=g.create(),Y=g.create();k=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,altitudeAt:S,axisAt:M,closestPoint:H,closestPointOnSilhouette:I,copy:q,copyWithoutVerify:u,create:p,distance:K,distance2:z,distanceToSilhouette:L,elevate:D,equals:P,extrusionContainsPoint:F,fromAABoundingRect:A,fromValues:v,intersectRay:C,intersectRayClosestSilhouette:E,normal:T,projectPoint:J,projectPointLocal:B,rotate:O,setAltitudeAt:N,setExtent:G,
transform:R,up:ba,updateUnboundedPlane:y,wrap:t},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.altitudeAt=S;a.axisAt=M;a.boundedPlane=k;a.closestPoint=H;a.closestPointOnSilhouette=I;a.copy=q;a.copyWithoutVerify=u;a.create=p;a.distance=K;a.distance2=z;a.distanceToSilhouette=L;a.elevate=D;a.equals=P;a.extrusionContainsPoint=F;a.fromAABoundingRect=A;a.fromValues=v;a.intersectRay=C;a.intersectRayClosestSilhouette=E;a.normal=T;a.projectPoint=J;a.projectPointLocal=B;a.rotate=O;a.setAltitudeAt=
N;a.setExtent=G;a.transform=R;a.up=ba;a.updateUnboundedPlane=y;a.wrap=t})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){class n{constructor(h){this._allocator=h;this._items=[];this._itemsPtr=0;this._grow()}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]}_reset(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);
this._itemsPtr=0}_grow(){for(let h=0;h<Math.max(8,Math.min(this._items.length,1024));h++)this._items.push(this._allocator())}}a.ObjectStack=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function h(e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){return[e,
d,c,l,f,r,x,w,p,t,q,u,v,y,D,G]}function k(e,d){return new Float64Array(e,d,16)}const m=b(),g=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:n,create:b,createView:k,fromValues:h},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.mat4f64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),
function(a,b,n,h,k,m){function g(x){return x?{origin:k.clone(x.origin),vector:k.clone(x.vector)}:{origin:k.create(),vector:k.create()}}function e(x,w){const p=r.get();p.origin=x;p.vector=w;return p}function d(x,w,p=g()){h.copy(p.origin,x);h.copy(p.vector,w);return p}function c(x,w,p,t,q){const {vector:u,origin:v}=x;w=h.subtract(m.sv3d.get(),w,v);w=h.dot(u,w)/h.squaredLength(u);h.scale(q,u,b.clamp(w,p,t));return h.add(q,q,x.origin)}function l(x,w,p,t){const q=x.origin;var u=h.add(m.sv3d.get(),q,x.vector);
x=w.origin;var v=h.add(m.sv3d.get(),x,w.vector),y=m.sv3d.get();w=m.sv3d.get();y[0]=q[0]-x[0];y[1]=q[1]-x[1];y[2]=q[2]-x[2];w[0]=v[0]-x[0];w[1]=v[1]-x[1];w[2]=v[2]-x[2];if(1E-6>Math.abs(w[0])&&1E-6>Math.abs(w[1])&&1E-6>Math.abs(w[2]))return!1;v=m.sv3d.get();v[0]=u[0]-q[0];v[1]=u[1]-q[1];v[2]=u[2]-q[2];if(1E-6>Math.abs(v[0])&&1E-6>Math.abs(v[1])&&1E-6>Math.abs(v[2]))return!1;u=y[0]*w[0]+y[1]*w[1]+y[2]*w[2];var D=w[0]*v[0]+w[1]*v[1]+w[2]*v[2];const G=w[0]*w[0]+w[1]*w[1]+w[2]*w[2],A=(v[0]*v[0]+v[1]*v[1]+
v[2]*v[2])*G-D*D;if(1E-6>Math.abs(A))return!1;y=(u*D-(y[0]*v[0]+y[1]*v[1]+y[2]*v[2])*G)/A;u=(u+D*y)/G;p&&(y=b.clamp(y,0,1),u=b.clamp(u,0,1));p=m.sv3d.get();D=m.sv3d.get();p[0]=q[0]+y*v[0];p[1]=q[1]+y*v[1];p[2]=q[2]+y*v[2];D[0]=x[0]+u*w[0];D[1]=x[1]+u*w[1];D[2]=x[2]+u*w[2];t.tA=y;t.tB=u;t.pA=p;t.pB=D;t.distance2=h.squaredDistance(p,D);return!0}const f={tA:0,tB:0,pA:k.create(),pB:k.create(),distance2:0},r=new n.ObjectStack(()=>g());a.closestLineSegmentPoint=function(x,w,p){return l(x,w,!0,f)?(h.copy(p,
f.pA),!0):!1};a.closestRayDistance2=function(x,w){if(l(x,e(w.origin,w.direction),!1,f)){const {tA:p,pB:t,distance2:q}=f;if(0<=p&&1>=p)return q;if(0>p)return h.squaredDistance(x.origin,t);if(1<p)return h.squaredDistance(h.add(m.sv3d.get(),x.origin,x.vector),t)}return null};a.copy=function(x,w=g()){return d(x.origin,x.vector,w)};a.create=g;a.distance2=function(x,w){w=h.subtract(m.sv3d.get(),w,x.origin);var p=h.dot(x.vector,w);const t=h.dot(x.vector,x.vector);p=b.clamp(p/t,0,1);x=h.subtract(m.sv3d.get(),
h.scale(m.sv3d.get(),x.vector,p),w);return h.dot(x,x)};a.fromPoints=function(x,w,p=g()){h.copy(p.origin,x);h.subtract(p.vector,w,x);return p};a.fromValues=d;a.pointAt=function(x,w,p){return h.add(p,x.origin,h.scale(p,x.vector,w))};a.projectPoint=function(x,w,p){return c(x,w,0,1,p)};a.projectPointClamp=c;a.wrap=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const n=b.VectorStack.createVec2f64(),
h=b.VectorStack.createVec3f64(),k=b.VectorStack.createVec4f64(),m=b.VectorStack.createMat3f64(),g=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=m;a.sm4d=g;a.sq4d=b;a.sv2d=n;a.sv3d=h;a.sv4d=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ./nextTick ./libs/gl-matrix-2/factories/mat3f64 ./libs/gl-matrix-2/factories/mat4f64 ./libs/gl-matrix-2/factories/quatf64 ./libs/gl-matrix-2/factories/vec2f64 ./libs/gl-matrix-2/factories/vec3f64 ./libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,n,h,k,m,g,e){class d{constructor(c){this._create=c;this._items=[];this._itemsPtr=0}get(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr>=this._items.length&&this._items.push(this._create());return this._items[this._itemsPtr++]}_reset(){const c=2*this._itemsPtr;this._items.length>c&&(this._items.length=c);this._itemsPtr=0}static createVec2f64(){return new d(m.create)}static createVec3f64(){return new d(g.create)}static createVec4f64(){return new d(e.create)}static createMat3f64(){return new d(n.create)}static createMat4f64(){return new d(h.create)}static createQuatf64(){return new d(k.create)}get test(){return{length:this._items.length}}}
a.VectorStack=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function h(e,d,c,l,f,r,x,w,p){return[e,d,c,l,f,r,x,w,p]}function k(e,d){return new Float64Array(e,d,9)}const m=b(),g=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:n,create:b,createView:k,fromValues:h},Symbol.toStringTag,
{value:"Module"}));a.IDENTITY=m;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.mat3f64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function n(e){return[e[0],e[1],e[2],e[3]]}function h(e,d,c,l){return[e,d,c,l]}function k(e,d){return new Float64Array(e,d,4)}const m=b(),g=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:n,create:b,createView:k,
fromValues:h},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.quatf64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function n(p){return[p[0],p[1]]}function h(p,t){return[p,t]}function k(p,t=[0,0]){const q=Math.min(2,p.length);for(let u=0;u<q;++u)t[u]=p[u];return t}function m(p,t){return new Float64Array(p,t,2)}
function g(){return[0,0]}function e(){return[1,1]}function d(){return[1,0]}function c(){return[0,1]}const l=[0,0],f=[1,1],r=[1,0],x=[0,1],w=Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:r,UNIT_Y:x,ZEROS:l,clone:n,create:b,createView:m,fromArray:k,fromValues:h,ones:e,unitX:d,unitY:c,zeros:g},Symbol.toStringTag,{value:"Module"}));a.ONES=f;a.UNIT_X=r;a.UNIT_Y=x;a.ZEROS=l;a.clone=n;a.create=b;a.createView=m;a.fromArray=k;a.fromValues=h;a.ones=e;a.unitX=d;a.unitY=c;a.vec2f64=w;a.zeros=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,b,n,h,k,m,g,e){function d(H=A){return[H[0],H[1],H[2],H[3]]}function c(H,J){return l(J[0],J[1],J[2],J[3],H)}function l(H,J,B,z,K=d()){K[0]=H;K[1]=J;K[2]=B;K[3]=z;return K}function f(H,J,B){var z=
J[0]*J[0]+J[1]*J[1]+J[2]*J[2];z=1E-5<Math.abs(z-1)&&1E-12<z?1/Math.sqrt(z):1;B[0]=J[0]*z;B[1]=J[1]*z;B[2]=J[2]*z;B[3]=-(B[0]*H[0]+B[1]*H[1]+B[2]*H[2]);return B}function r(H,J,B,z=d()){var K=B[0]-J[0],L=B[1]-J[1],F=B[2]-J[2];B=H[0]-J[0];const M=H[1]-J[1],S=H[2]-J[2];J=L*S-F*M;F=F*B-K*S;K=K*M-L*B;L=J*J+F*F+K*K;L=1E-5<Math.abs(L-1)&&1E-12<L?1/Math.sqrt(L):1;z[0]=J*L;z[1]=F*L;z[2]=K*L;z[3]=-(z[0]*H[0]+z[1]*H[1]+z[2]*H[2]);return z}function x(H,J,B,z=0,K=Math.floor(1/3*B),L=Math.floor(2/3*B)){if(3>B)return!1;
J(u,z);let F=K,M=!1;for(;F<B-1&&!M;)J(v,F),F++,M=!n.exactEquals(u,v);if(!M)return!1;F=Math.max(F,L);for(M=!1;F<B&&!M;)J(y,F),F++,n.subtract(D,u,v),n.normalize(D,D),n.subtract(G,v,y),n.normalize(G,G),M=!n.exactEquals(u,y)&&!n.exactEquals(v,y)&&.99619469809>Math.abs(n.dot(D,G));if(!M)return 0===z&&1===K&&2===L?!1:x(H,J,B,0,1,2);r(u,v,y,H);return!0}function w(H,J,B){H=n.scale(g.sv3d.get(),H,n.dot(H,J));n.subtract(B,J,H);return B}function p(H,J){return n.dot(H,J)+H[3]}function t(H,J,B,z,K){const L=n.dot(H,
B);if(0===L)return!1;H=-(n.dot(H,J)+H[3])/L;z&C.CLAMP&&(H=b.clamp(H,0,1));if(!(z&C.INFINITE_MIN)&&0>H||!(z&C.INFINITE_MAX)&&1<H)return!1;n.add(K,J,n.scale(K,B,H));return!0}const q=k.exactEquals;k=k.equals;const u=h.create(),v=h.create(),y=h.create(),D=h.create(),G=h.create(),A=[0,0,1,0];var C;(function(H){H[H.NONE=0]="NONE";H[H.CLAMP=1]="CLAMP";H[H.INFINITE_MIN=4]="INFINITE_MIN";H[H.INFINITE_MAX=8]="INFINITE_MAX"})(C||={});const E=C.INFINITE_MIN|C.INFINITE_MAX,I=C.INFINITE_MAX;a.clip=function(H,J){const B=
n.dot(H,J.ray.direction);H=-p(H,J.ray.origin);if(0>H&&0<=B)return!1;if(-1E-6<B&&1E-6>B)return 0<H;if((0>H||0>B)&&!(0>H&&0>B))return!0;H/=B;0<B?H<J.c1&&(J.c1=H):H>J.c0&&(J.c0=H);return J.c0<=J.c1};a.clipInfinite=function(H,J){const B=n.dot(H,J.ray.direction);H=-p(H,J.ray.origin);if(-1E-6<B&&1E-6>B)return 0<H;H/=B;0<B?H<J.c1&&(J.c1=H):H>J.c0&&(J.c0=H);return J.c0<=J.c1};a.copy=c;a.create=d;a.distance=function(H,J){return Math.abs(p(H,J))};a.equals=k;a.exactEquals=q;a.fromArray=function(H,J,B=!0){const z=
J.length/3;return x(H,(K,L)=>n.set(K,J[3*L],J[3*L+1],J[3*L+2]),B?z-1:z)};a.fromManyPoints=x;a.fromNormalAndOffset=function(H,J,B){n.copy(B,H);B[3]=J;return B};a.fromPoints=r;a.fromPositionAndNormal=f;a.fromValues=l;a.fromVectorsAndPoint=function(H,J,B,z){n.cross(y,J,H);return f(B,y,z)};a.getNormal=function(H){return H};a.intersectLine=function(H,J,B,z){B=n.subtract(g.sv3d.get(),B,J);return t(H,J,B,E,z)};a.intersectLineSegment=function(H,J,B){return t(H,J.origin,J.vector,C.NONE,B)};a.intersectLineSegmentClamp=
function(H,J,B){return t(H,J.origin,J.vector,C.CLAMP,B)};a.intersectRay=function(H,J,B){return null!=J?t(H,J.origin,J.direction,I,B):!1};a.isPointInside=function(H,J){return 0<=p(H,J)};a.negate=function(H,J){J[0]=-H[0];J[1]=-H[1];J[2]=-H[2];J[3]=-H[3];return J};a.projectPoint=function(H,J,B){const z=n.scale(g.sv3d.get(),H,-H[3]);J=n.subtract(g.sv3d.get(),J,z);H=w(H,J,g.sv3d.get());n.add(B,H,z);return B};a.projectPointLocal=function(H,J,B,z){var K=g.sv3d.get(),L=g.sv3d.get();e.tangentFrame(H,K,L);
J=n.subtract(g.sv3d.get(),B,J);K=m.projectPointSignedLength(K,J);L=m.projectPointSignedLength(L,J);H=m.projectPointSignedLength(H,J);return n.set(z,K,L,H)};a.projectVector=w;a.setOffsetFromPoint=function(H,J,B){J!==H&&c(H,J);H[3]=-n.dot(H,B);return H};a.signedDistance=p;a.up=A;a.wrap=function(H=A[0],J=A[1],B=A[2],z=A[3]){return l(H,J,B,z,g.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils",
"../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,h){const k=h.create(),m=h.create();a.angle=function(g,e){g=n.dot(g,e)/(n.length(g)*n.length(e));return-b.acosClamped(g)};a.angleAroundAxis=function(g,e,d){n.normalize(k,g);n.normalize(m,e);g=n.dot(k,m);g=b.acosClamped(g);e=n.cross(k,k,m);return 0>n.dot(e,d)?2*Math.PI-g:g};a.projectPoint=function(g,e,d){e=n.dot(g,e)/n.dot(g,g);return n.scale(d,g,e)};a.projectPointSignedLength=function(g,e){return n.dot(g,e)/n.length(g)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,h){const k=h.create(),m=h.create(),g=h.create(),e=h.create(),d=h.create();a.angle=function(c,l,f){c=n.normalize(e,c);l=n.normalize(d,l);const r=b.acosClamped(n.dot(c,l));return f&&(c=n.cross(g,c,l),0>n.dot(c,f))?-r:r};a.bilerp=function(c,l,f,r,x,w){c+=(l-c)*
x;return c+(f+(r-f)*x-c)*w};a.cosCapped=function(c,l){return c>l?Math.cos(l):Math.cos(c)};a.fovx2fovy=function(c,l,f){return 2*Math.atan(f*Math.tan(.5*c)/l)};a.fovy2fovx=function(c,l,f){return 2*Math.atan(l*Math.tan(.5*c)/f)};a.makeOrthonormal=function(c,l,f){f=f||c;const r=n.dot(c,l);n.set(f,c[0]-r*l[0],c[1]-r*l[1],c[2]-r*l[2]);n.normalize(f,f)};a.makePiecewiseLinearFunction=function(c){const l=c.length;return f=>{if(f<=c[0][0])return c[0][1];if(f>=c[l-1][0])return c[l-1][1];let r=1;for(;f>c[r][0];)r++;
const x=c[r][0];f=(x-f)/(x-c[r-1][0]);return f*c[r-1][1]+(1-f)*c[r][1]}};a.maxScale=function(c){return Math.sqrt(Math.max(c[0]*c[0]+c[4]*c[4]+c[8]*c[8],c[1]*c[1]+c[5]*c[5]+c[9]*c[9],c[2]*c[2]+c[6]*c[6]+c[10]*c[10]))};a.midpoint3d=function(c,l){n.set(l,0,0,0);if(0<c.length){for(let f=0;f<c.length;++f)n.add(l,l,c[f]);n.scale(l,l,1/c.length)}};a.planeFromPoints=function(c,l,f,r){n.subtract(k,l,c);n.subtract(m,f,c);n.cross(r,k,m);n.normalize(r,r);r[3]=-n.dot(c,r)};a.scaleFromMatrix=function(c,l){n.set(c,
Math.sqrt(l[0]*l[0]+l[4]*l[4]+l[8]*l[8]),Math.sqrt(l[1]*l[1]+l[5]*l[5]+l[9]*l[9]),Math.sqrt(l[2]*l[2]+l[6]*l[6]+l[10]*l[10]));return c};a.slerp=function(c,l,f,r=h.create()){const x=n.length(c);var w=n.length(l),p=n.dot(c,l)/(x*w);if(.9999999999999999>p){p=Math.acos(p);const t=((1-f)*x+f*w)/Math.sin(p);w=t/w*Math.sin(f*p);n.scale(e,c,t/x*Math.sin((1-f)*p));n.scale(d,l,w);return n.add(r,e,d)}return n.lerp(r,c,l,f)};a.slerpTangent=function(c,l,f,r=h.create(),x=h.create()){const w=n.length(c),p=n.length(l);
var t=n.dot(c,l)/(w*p);if(.9999999999999999>t){t=Math.acos(t);const q=Math.sin(t),u=Math.sin(f*t),v=Math.sin((1-f)*t),y=(1-f)*w+f*p,D=y/q,G=D/p*u;n.scale(e,c,D/w*v);n.scale(d,l,G);n.add(r,e,d);n.scale(e,c,1/w*(-Math.cos((1-f)*t)*t*y+v*(-w+p)));n.scale(d,l,1/p*(Math.cos(f*t)*t*y+u*(-w+p)));n.add(x,e,d);n.scale(x,x,1/q);return x}n.lerp(r,c,l,f);n.subtract(x,l,c);n.normalize(x,x);return x};a.tangentFrame=function(c,l,f){Math.abs(c[0])>Math.abs(c[1])?n.set(l,0,1,0):n.set(l,1,0,0);n.cross(f,c,l);n.cross(l,
f,c);n.normalize(f,f);n.normalize(l,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./vectorStacks".split(" "),function(a,b,n,h,k,m){function g(l){return l?e(k.clone(l.origin),k.clone(l.direction)):e(k.create(),k.create())}function e(l,f){return{origin:l,direction:f}}function d(l,f,r=g()){h.copy(r.origin,l);h.copy(r.direction,
f);return r}const c=new n.ObjectStack(()=>g());a.closestPoint=function(l,f,r){f=h.dot(l.direction,h.subtract(r,f,l.origin));h.add(r,l.origin,h.scale(r,l.direction,f));return r};a.copy=function(l,f=g()){return d(l.origin,l.direction,f)};a.create=g;a.distance2=function(l,f){l=h.cross(m.sv3d.get(),h.normalize(m.sv3d.get(),l.direction),h.subtract(m.sv3d.get(),f,l.origin));return h.dot(l,l)};a.equals=function(l,f){return b.equals(l.origin,f.origin)&&b.equals(l.direction,f.direction)};a.fromPoints=function(l,
f,r=g()){h.copy(r.origin,l);h.subtract(r.direction,f,l);return r};a.fromValues=d;a.wrap=function(l,f){const r=c.get();r.origin=l;r.direction=f;return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(t){return{operations:t,value:t.create()}}function f(t,q,u=l(t)){u.operations=t;t.copy(q,u.value);return u}function r(t,q,u,v){return t.operations.setAltitudeAt(t.value,q,u,v)}const x=2**50,w=h.create(),p=h.create();a.altitudeAt=function(t,q){return t.operations.altitudeAt(t.value,q)};a.axisAt=function(t,q,u,v){return t.operations.axisAt(t.value,q,u,v)};a.closestPoint=function(t,q,u){return t.operations.closestPoint(t.value,q,u)};a.closestPointOnSilhouette=
function(t,q,u){return t.operations.closestPointOnSilhouette(t.value,q,u)};a.coordinateSystemFromOneAxisAndNormalVector=function(t,q,u,v,y){n.copy(u,t);n.copy(p,q);n.normalize(p,p);n.cross(v,p,u);n.cross(y,v,u)};a.create=function(t){const {value:q,operations:u}=t;return{operations:u,value:u.create(q)}};a.createFromOperations=l;a.createGlobal=function(t){return f(c.sphere,c.fromValues(0,0,0,k.getReferenceEllipsoid(t).radius))};a.createLocal=function(){return f(d.boundedPlane,d.fromValues([0,0,0],[x,
0,0],[0,x,0]))};a.distanceToSilhouette=function(t,q){return t.operations.distanceToSilhouette(t.value,q)};a.elevate=function(t,q,u){return t.operations.elevate(t.value,q,u.value)};a.fromValues=f;a.intersectRay=function(t,q,u){return t.operations.intersectRay(t.value,q,u)};a.intersectRayClosestSilhouette=function(t,q,u){return t.operations.intersectRayClosestSilhouette(t.value,q,u)};a.normalAt=function(t,q,u){return t.operations.axisAt(t.value,q,e.Axis.Z,u)};a.renderSRFromViewSR=function(t,q){return t?
g.getSphericalPCPF(q):q.isGeographic?m.PlateCarree:q};a.setAltitudeAt=r;a.setAltitudeOfTransformation=function(t,q,u,v){q!==v&&b.copy(v,q);n.set(w,v[12],v[13],v[14]);r(t,w,u,w);v[12]=w[0];v[13]=w[1];v[14]=w[2];return v};a.setExtent=function(t,q,u){t.operations.setExtent(t.value,q,u.value);return u};a.vectorCoordinates=function(t,q,u,v,y){y[0]=n.dot(t,q);y[1]=n.dot(t,u);y[2]=n.dot(t,v);return y};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports",
"./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(a,b,n,h){const k=new n(b.SphericalECEFSpatialReferenceLike),m=new n(b.SphericalPCPFMarsLike),g=new n(b.SphericalPCPFMoonLike);b=new n(b.WGS84ECEFSpatialReferenceLike);const e=new Map,d=m.wkt.toUpperCase(),c=g.wkt.toUpperCase();a.SphericalECEFSpatialReference=k;a.SphericalPCPFMars=m;a.SphericalPCPFMoon=g;a.WGS84ECEFSpatialReference=b;a.getSphericalPCPF=function(l){var f=e.get(l);if(f)return f;f=k;if(l)if(l===m)f=m;
else if(l===g)f=g;else{var r=l.wkid;const x=l.latestWkid;if(null!=r||null!=x)if(h.isWKIDFromMars(r)||h.isWKIDFromMars(x))f=m;else{if(h.isWKIDFromMoon(r)||h.isWKIDFromMoon(x))f=g}else if(r=l.wkt2??l.wkt)r=r.toUpperCase(),r===d?f=m:r===c&&(f=g)}e.set(l,f);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../core/libs/gl-matrix-2/math/common ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(){return d.create()}function p(ia,fa){return e.copy(fa,ia)}function t(ia,fa){return d.fromValues(ia[0],ia[1],ia[2],fa)}function q(ia){return ia}function u(ia){ia[0]=ia[1]=ia[2]=ia[3]=0}function v(ia,fa){ia[0]=ia[1]=ia[2]=0;ia[3]=fa;return ia}function y(ia){return ia[3]}function D(ia){return ia}function G(ia,fa,da,aa){return d.fromValues(ia,fa,da,aa)}function A(ia,fa,da){ia!==da&&(da[0]=ia[0],da[1]=ia[1],da[2]=ia[2]);da[3]=ia[3]+fa;return da}function C(ia,
fa,da){n.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");ia!==da&&p(ia,da);return da}function E(ia,fa,da){if(null==fa||!H(ia,fa,V))return!1;let {t0:aa,t1:ea}=V;if(0>aa||ea<aa&&0<ea)aa=ea;if(0>aa)return!1;if(da){const {origin:ha,direction:Y}=fa;da[0]=ha[0]+Y[0]*aa;da[1]=ha[1]+Y[1]*aa;da[2]=ha[2]+Y[2]*aa}return!0}function I(ia,fa,da){fa=f.fromPoints(fa,da);if(!H(ia,fa,V))return[];const {origin:aa,direction:ea}=fa,{t0:ha,t1:Y}=V;fa=Z=>{const ja=g.create();m.scaleAndAdd(ja,
aa,ea,Z);return L(ia,ja,ja)};return Math.abs(ha-Y)<c.getEpsilon()?[fa(ha)]:[fa(ha),fa(Y)]}function H(ia,fa,da){const {origin:aa,direction:ea}=fa,ha=U;ha[0]=aa[0]-ia[0];ha[1]=aa[1]-ia[1];ha[2]=aa[2]-ia[2];fa=ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2];if(0===fa)return!1;const Y=2*(ea[0]*ha[0]+ea[1]*ha[1]+ea[2]*ha[2]);ia=Y*Y-4*fa*(ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2]-ia[3]*ia[3]);if(0>ia)return!1;ia=Math.sqrt(ia);da.t0=(-Y-ia)/(2*fa);da.t1=(-Y+ia)/(2*fa);return!0}function J(ia,fa){return E(ia,fa,null)}function B(ia,
fa,da){if(E(ia,fa,da))return da;ia=z(ia,fa,x.sv3d.get());m.add(da,fa.origin,m.scale(x.sv3d.get(),fa.direction,m.distance(fa.origin,ia)/m.length(fa.direction)));return da}function z(ia,fa,da){const aa=x.sv3d.get(),ea=x.sm4d.get();m.cross(aa,fa.origin,fa.direction);const ha=ia[3];m.cross(da,aa,fa.origin);m.scale(da,da,1/m.length(da)*ha);ia=M(ia,fa.origin);fa=r.angle(fa.origin,da);k.fromRotation(ea,fa+ia,aa);m.transformMat4(da,da,ea);return da}function K(ia,fa,da){if(E(ia,fa,da))return da;f.closestPoint(fa,
ia,da);return L(ia,da,da)}function L(ia,fa,da){fa=m.subtract(x.sv3d.get(),fa,ia);fa=m.scale(x.sv3d.get(),fa,ia[3]/m.length(fa));return m.add(da,fa,ia)}function F(ia,fa){fa=m.subtract(x.sv3d.get(),fa,ia);fa=m.squaredLength(fa);return Math.sqrt(Math.abs(fa-ia[3]*ia[3]))}function M(ia,fa){fa=m.subtract(x.sv3d.get(),fa,ia);fa=m.length(fa);ia=ia[3];return h.acosClamped(ia/(ia+Math.abs(ia-fa)))}function S(ia,fa,da,aa){ia=m.subtract(W,fa,ia);switch(da){case l.Axis.X:return da=h.cartesianToSpherical(ia,W)[2],
m.set(aa,-Math.sin(da),Math.cos(da),0);case l.Axis.Y:return ia=h.cartesianToSpherical(ia,W),da=ia[1],ia=ia[2],fa=Math.sin(da),m.set(aa,-fa*Math.cos(ia),-fa*Math.sin(ia),Math.cos(da));case l.Axis.Z:return m.normalize(aa,ia)}}function N(ia,fa){fa=m.subtract(ca,fa,ia);return m.length(fa)-ia[3]}function P(ia,fa,da,aa){const ea=N(ia,fa);ia=S(ia,fa,l.Axis.Z,ca);da=m.scale(ca,ia,da-ea);return m.add(aa,fa,da)}function R(ia,fa){fa=m.squaredDistance(ia,fa);ia=ia[3];return fa<=ia*ia}function O(ia,fa,da=d.create()){const aa=
m.distance(ia,fa),ea=ia[3],ha=fa[3];if(aa+ha<ea)return e.copy(da,ia),da;if(aa+ea<ha)return e.copy(da,fa),da;m.lerp(da,ia,fa,(aa+ha-ea)/(2*aa));da[3]=(aa+ea+ha)/2;return da}b=w();const T=e.equals,Q=e.equals,V={t0:0,t1:0},U=g.create(),W=g.create(),ca=g.create(),X=w(),ba=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:b,altitudeAt:N,angleToSilhouette:M,axisAt:S,clear:u,closestPoint:K,closestPointOnSilhouette:z,containsPoint:R,copy:p,create:w,distanceToSilhouette:F,elevate:A,equals:Q,exactEquals:T,
fromCenterAndRadius:t,fromRadius:v,fromValues:G,getCenter:D,getRadius:y,intersectLine:I,intersectRay:E,intersectRayClosestSilhouette:B,intersectsRay:J,projectPoint:L,setAltitudeAt:P,setExtent:C,tmpSphere:X,union:O,wrap:q},Symbol.toStringTag,{value:"Module"}));a.NullSphere=b;a.altitudeAt=N;a.angleToSilhouette=M;a.axisAt=S;a.clear=u;a.closestPoint=K;a.closestPointOnSilhouette=z;a.containsPoint=R;a.copy=p;a.create=w;a.distanceToSilhouette=F;a.elevate=A;a.equals=Q;a.exactEquals=T;a.fromCenterAndRadius=
t;a.fromRadius=v;a.fromValues=G;a.getCenter=D;a.getRadius=y;a.intersectLine=I;a.intersectRay=E;a.intersectRayClosestSilhouette=B;a.intersectsRay=J;a.projectPoint=L;a.setAltitudeAt=P;a.setExtent=C;a.sphere=ba;a.tmpSphere=X;a.union=O;a.wrap=q})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(a,b,n){function h(k,m){m=n.getMetersPerUnitForSR(m);return k/(m*n.inchesPerMeter*96)}a.getExtentForScale=function(k,m){const g=k.extent;k=
k.width-(k.padding?k.padding.left+k.padding.right:0);m=h(m,g.spatialReference);return g.clone().expand(m*k/g.width)};a.getResolutionForScale=h;a.getResolutionInMetersForScale=function(k){return k/(96*n.inchesPerMeter)};a.getScale=function(k,m){m=m||k.extent;k=k.width;const g=n.getMetersPerUnitForSR(m?.spatialReference);return m&&k?m.width/k*g*n.inchesPerMeter*96:0};a.getScaleForResolution=function(k,m){m=n.getMetersPerUnitForSR(m);return k*m*n.inchesPerMeter*96};a.isInScaleRange=function(k,m,g){if(m=
0===m||b.floatEqualAbsolute(k,m)||k<m)m=0===g||b.floatEqualAbsolute(k,g)||k>g;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/tslib.es6 ../core/ArrayPool ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e,d){function c(r,x){return x?l[r].valueToClassName[x].split(" "):
[]}const l={widthBreakpoint:{getValue(r){const x=r.viewSize[0];r=r.breakpoints;const w=this.values;return x<=r.xsmall?w.xsmall:x<=r.small?w.small:x<=r.medium?w.medium:x<=r.large?w.large:w.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue(r){const x=r.viewSize[1];r=r.breakpoints;const w=this.values;return x<=r.xsmall?w.xsmall:x<=r.small?w.small:x<=r.medium?w.medium:x<=r.large?w.large:w.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue(r){r=r.viewSize;const x=this.values;return r[1]>=r[0]?x.portrait:x.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},f={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=r=>{r=class extends r{constructor(...x){super(...x);this.heightBreakpoint=this.widthBreakpoint=this.orientation=null;this.breakpoints=f}initialize(){this.addHandles(h.watch(()=>
[this.breakpoints,this.size],()=>this._updateClassNames(),h.initial))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(x){var w=this._get("breakpoints");if(x!==w){w=(w=x)&&w.xsmall<w.small&&w.small<w.medium&&w.medium<w.large;if(!w){const p=JSON.stringify(f,null,2);console.warn("provided breakpoints are not valid, using defaults:"+p)}x=w?x:f;this._set("breakpoints",{...x})}}_updateClassNames(){if(this.container){var x=n.acquire(),w=n.acquire(),p=!1,t;for(t in l){const q=this[t],
u=l[t].getValue({viewSize:this.size,breakpoints:this.breakpoints});q!==u&&(p=!0,this[t]=u,c(t,q).forEach(v=>w.push(v)),c(t,u).forEach(v=>x.push(v)))}p&&(this._applyClassNameChanges(x,w),n.release(x),n.release(w))}}_applyClassNameChanges(x,w){const p=this.container;p&&(w.forEach(t=>p.classList.remove(t)),x.forEach(t=>p.classList.add(t)))}_removeActiveClassNames(){const x=this.container;if(x)for(var w in l)c(w,this[w]).forEach(p=>x.classList.remove(p))}};b.__decorate([k.property()],r.prototype,"breakpoints",
null);b.__decorate([k.property()],r.prototype,"orientation",void 0);b.__decorate([k.property()],r.prototype,"widthBreakpoint",void 0);b.__decorate([k.property()],r.prototype,"heightBreakpoint",void 0);return r=b.__decorate([d.subclass("esri.views.BreakpointsOwner")],r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/tslib.es6 ../intl ../core/domUtils ../core/events ../core/has ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../intl/locale ../intl/messages".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(u){u&&(h.empty(u),u.parentNode&&u.parentNode.removeChild(u))}const q=[0,0];a.DOMContainer=u=>{u=class extends u{constructor(...v){super(...v);this._freqInfo={freq:16,time:750};this._overlayRenderTaskHandle=null;this.height=0;this.position=this.overlay=this.messagesCommon=null;this.resizing=!1;this.surface=this.root=null;this.suspended=!0;this.userContent=this.ui=null;this.width=0;this.widthBreakpoint=null;this.addHandles([d.watch(()=>this.cursor,
y=>{const {surface:D}=this;D&&D.setAttribute("data-cursor",y)}),d.watch(()=>this.navigating,y=>{const {surface:D}=this;D&&D.setAttribute("data-navigating",y.toString())})])}initialize(){const v=m("mac"),y=async()=>{v&&(await d.whenOnce(()=>this.ready),this.messagesCommon=await p.fetchMessageBundle("esri/t9n/common").catch(()=>{}))};y();this.addHandles([d.watch(()=>this.ui,(D,G)=>this._handleUIChange(D,G),d.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),
w.onLocaleChange(y),d.watch(()=>[this.surface,this.messagesCommon],()=>{v&&this.surface?.setAttribute("aria-label",this.messagesCommon?.ariaLabels?.navigationMacVoiceOver??"")})])}destroy(){this.destroyed||(this.ui=e.destroyMaybe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(v){var y=this._get("container");const D=h.byId(v);D||"string"!==typeof v||g.getLogger(this).error("#container",`element with id '${v}' not found`);if(y!==D)if(this._stopMeasuring(),
y&&(y.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(t(this.root),this._set("root",null)),this.userContent&&(h.reparent(this.userContent,y),t(this.userContent),this._set("userContent",null))),D){D.classList.add("esri-view");v=document.createElement("div");v.className="esri-view-user-storage";h.reparent(D,v);D.appendChild(v);this._set("userContent",
v);v=document.createElement("div");v.className="esri-view-root";D.insertBefore(v,D.firstChild);this._set("root",v);y=document.createElement("div");y.className="esri-view-surface";y.setAttribute("role","application");y.tabIndex=0;v.appendChild(y);this._set("surface",y);var G=new x;v.appendChild(G.surface);this._set("overlay",G);this.addHandles(d.watch(()=>G.needsRender,A=>{this._overlayRenderTaskHandle=A&&!this._overlayRenderTaskHandle?c.addFrameTask({render:()=>this.overlay?.render()}):e.removeMaybe(this._overlayRenderTaskHandle)}));
this.forceDOMReadyCycle();this._set("container",D);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const v=document.activeElement===this.surface;return document.hasFocus()&&v}get size(){return[this.width,this.height]}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(v,y,D){const G=this.position;v-=G?G[0]:0;y-=G?G[1]:0;D?(D[0]=v,D[1]=
y):D=[v,y];return D}containerToPage(v,y,D){const G=this.position;v+=G?G[0]:0;y+=G?G[1]:0;D?(D[0]=v,D[1]=y):D=[v,y];return D}_handleUIChange(v,y){this.removeHandles("ui");y&&y!==v&&y.destroy();v&&(v.view=this,this.addHandles(d.watch(()=>this.root,D=>{if(D){const G=document.createElement("div");D.appendChild(G);D=G}else D=null;v.container=D},d.initial),"ui"));this._set("ui",v)}_stopMeasuring(){this.removeHandles("measuring");this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const v=
this._freqInfo;v.freq=16;v.time=750;this.addHandles([k.on(window,"resize",()=>{v.freq=16;v.time=750}),c.addFrameTask({prepare:y=>{const D=this._measure(),G=this._freqInfo;G.time+=y.deltaTime;D&&(G.freq=16,this._get("resizing")||this._set("resizing",!0));G.time<G.freq||(G.time=0,this._position()||D?G.freq=16:G.freq=Math.min(750,2*G.freq),!D&&512<=G.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()}_measure(){var v=this.container;const y=v?v.clientWidth:
0;v=v?v.clientHeight:0;if(0===y||0===v)return this.suspended||this._set("suspended",!0),!1;const D=this.width,G=this.height;if(y===D&&v===G)return this.suspended&&this._set("suspended",!1),!1;this._set("width",y);this._set("height",v);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:D,oldHeight:G,width:y,height:v});return!0}_position(){var v=this.container;const y=this.position;var D;if(D=v)D=(v.ownerDocument||window.document).defaultView,v=v.getBoundingClientRect(),q[0]=v.left+
(D?.pageXOffset??0),q[1]=v.top+(D?.pageYOffset??0),D=q;v=D;return v?y&&v[0]===y[0]&&v[1]===y[1]?!1:(this._set("position",[v[0],v[1]]),!0):!1}forceDOMReadyCycle(){}};b.__decorate([l.property()],u.prototype,"container",null);b.__decorate([l.property({readOnly:!0})],u.prototype,"focused",null);b.__decorate([l.property({readOnly:!0})],u.prototype,"height",void 0);b.__decorate([l.property()],u.prototype,"messagesCommon",void 0);b.__decorate([l.property({type:x})],u.prototype,"overlay",void 0);b.__decorate([l.property({readOnly:!0})],
u.prototype,"position",void 0);b.__decorate([l.property({readOnly:!0})],u.prototype,"resizing",void 0);b.__decorate([l.property({readOnly:!0})],u.prototype,"root",void 0);b.__decorate([l.property({value:null,readOnly:!0})],u.prototype,"size",null);b.__decorate([l.property({readOnly:!0})],u.prototype,"surface",void 0);b.__decorate([l.property({readOnly:!0})],u.prototype,"suspended",void 0);b.__decorate([l.property()],u.prototype,"ui",void 0);b.__decorate([l.property({readOnly:!0})],u.prototype,"userContent",
void 0);b.__decorate([l.property({readOnly:!0})],u.prototype,"width",void 0);b.__decorate([l.property()],u.prototype,"widthBreakpoint",void 0);return u=b.__decorate([r.subclass("esri.views.DOMContainer")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/support/UpdatingHandles ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){b=class extends b{constructor(){super(...arguments);this.items=new n;this._watchUpdatingTracking=new d.UpdatingHandles;this._callbacks=new Map;this._projector=l.createProjector();this._hiddenProjector=l.createProjector()}get needsRender(){return 0<this.items.length}get updating(){return this._watchUpdatingTracking?.updating??!1}initialize(){const f=document.createElement("div");f.className="esri-overlay-surface";this._set("surface",f);this._hiddenSurface=document.createElement("div");
this._hiddenSurface.setAttribute("style","visibility: hidden;");f.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const x of r.added){const w=()=>x.render();this._callbacks.set(x,w);this._projector.append(this.surface,w)}for(const x of r.removed)r=this._projector.detach(this._callbacks.get(x)),this.surface.removeChild(r.domNode),this._callbacks.delete(x)})}addItem(f){this.items.add(f)}removeItem(f){this.items.remove(f)}destroy(){this.items.removeAll();
this._callbacks.forEach(f=>this._projector.detach(f));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(f){const r=this._hiddenSurface,x=this._hiddenProjector;let w;const p=()=>w=f.render();x.append(r,p);x.renderNow();const t={left:0,top:0,right:0,bottom:0};if(w?.domNode){const q=w.domNode.getBoundingClientRect();t.left=q.left;t.top=q.top;t.right=q.right;t.bottom=q.bottom}for(x.detach(p);r.firstChild;)r.removeChild(r.firstChild);
return t}overlaps(f,r){f=this.computeBoundingRect(f);r=this.computeBoundingRect(r);return Math.max(f.left,r.left)<=Math.min(f.right,r.right)&&Math.max(f.top,r.top)<=Math.min(f.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(f=>f.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(f,r){const x=!!r?.disableDecorations;if(this.items.some(p=>p.visible&&!(x&&p.isDecoration))){var w=f.getContext("2d");w.save();w.font=this._fontString();this.items.forEach(p=>
{x&&p.isDecoration||(w.save(),p.renderCanvas(w),w.restore())});w.restore()}}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};a.__decorate([h.property({readOnly:!0})],b.prototype,"surface",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,"items",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,"needsRender",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,
"updating",null);return b=a.__decorate([e.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/views/GroundView":function(){define("../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./3d/support/cameraUtils ./support/GroundViewElevationSampler".split(" "),function(a,b,n,h,k,m,g,e,d,c,l){b=class extends b{constructor(f){super(f);this.view=
null;this.layerViews=new n}initialize(){this.addHandles(h.when(()=>this.view?.map?.ground,f=>f.load()));this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const f of this.layerViews)f.destroy();this.layerViews.length=0}get elevationSampler(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new l({view:this.view}):null}get extent(){const f=this.view;return f&&
"2d"!==f.type&&f.ready?c.toExtent(f,f.state.camera,f.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return this.suspended?!1:this.layerViews.some(f=>f.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating");this.addHandles(this.layerViews.map(f=>h.watch(()=>f.updating,()=>this._updateUpdating(),h.sync)).toArray(),"updating");this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};
a.__decorate([k.property({readOnly:!0})],b.prototype,"elevationSampler",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([k.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({constructOnly:!0})],b.prototype,"view",void 0);a.__decorate([k.property({type:n,readOnly:!0})],b.prototype,"layerViews",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"suspended",null);return b=a.__decorate([d.subclass("esri.views.GroundView")],
b)})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(da){return da.spatialReference??f.WGS84}function A(da){return"global"===da.viewingMode?u.cameraUtilsSpherical:q.cameraUtilsPlanar}function C(da,aa,ea){const ha=da.state.camera,Y=ha.width/2/ha.pixelRatio;da.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&null!=ea&&(aa*=Math.cos(k.deg2rad(ea)));aa/=da.renderCoordsHelper.unitInMeters;return Y/(96*39.37/aa)/Math.tan(ha.fovX/2)}function E(da,aa,ea){const ha=da.state.camera;aa=96*39.37/
(ha.width/2/ha.pixelRatio/(aa*Math.tan(ha.fovX/2)));da.renderCoordsHelper.viewingMode===p.ViewingMode.Global&&null!=ea&&(aa/=Math.cos(k.deg2rad(ea)));return aa*da.renderCoordsHelper.unitInMeters}async function I(da,aa,ea,ha,Y,Z){aa=await F(da,ha.heading,ha.tilt,aa,ea,Y,Z);m.throwIfAborted(Z);return V(da,aa,ha.fov,Z)}function H(da,aa,ea,ha,Y){return A(da).directionToHeadingTilt(aa,ea,ha,Y)}function J(da,aa){return!!(da.basemapTerrain&&da.renderCoordsHelper.fromRenderCoords(aa,X,da.spatialReference)&&
da.elevationProvider&&(y.getElevationAtPoint(da.elevationProvider,X)??0)>X[2]-1)}async function B(da,aa,ea){if(J(da,aa))return!0;const {elevationProvider:ha,spatialReference:Y,renderCoordsHelper:Z}=da;if(null==ha||!Z.fromRenderCoords(aa,X,Y))return!1;const [ja,oa,qa]=X;da=await ha.queryElevation(ja,oa,qa,Y,"ground",ea)??0;m.throwIfAborted(ea);return da>qa-1}async function z(da,aa,ea){const ha=e.create();if(null==aa)return g.copy(ha,da.state.camera.center);if(aa instanceof c){const {renderSpatialReference:Y,
basemapTerrain:Z,elevationProvider:ja}=da,oa=aa.spatialReference;await r.projectPointToVectorAsync(aa,ha,Y,0,{signal:ea});m.throwIfAborted(ea);null==aa.z&&null!=Z&&null!=ja&&(aa=await ja.queryElevation(aa.x,aa.y,aa.z??0,oa,"ground",ea),m.throwIfAborted(ea),null!=aa&&da.renderCoordsHelper.setAltitude(ha,aa));return ha}return g.copy(ha,aa)}function K(da,aa){const ea=e.create();if(null==aa)return g.copy(ea,da.state.camera.center);if(aa instanceof c){if(!r.projectPointToVector(aa,ea,da.renderSpatialReference))return null;
const {basemapTerrain:ha,elevationProvider:Y}=da;null==aa.z&&null!=ha&&null!=Y&&(aa=y.getElevationAtPoint(Y,aa),null!=aa&&da.renderCoordsHelper.setAltitude(ea,aa));return ea}return g.copy(ea,aa)}function L(da,aa,ea,ha,Y,Z){const ja=ha instanceof c?ha:null;ha=K(da,ha);return M(da,aa,ea,ja,ha,Y,Z)}async function F(da,aa,ea,ha,Y,Z,ja){const oa=ha instanceof c?ha:null;ha=await z(da,ha,ja);m.throwIfAborted(ja);return S(da,aa,ea,oa,ha,Y,Z,ja)}function M(da,aa,ea,ha,Y,Z,ja){if(null==Y||!ha&&(ha=new c({spatialReference:G(da)}),
!x.projectVectorToPoint(Y,da.renderSpatialReference,ha)))return null;const oa=N(da,aa,ea,Y,Z,ja);if(P(da,ea,ja)&&J(da,oa.eye)){const {tilt:qa,mode:ta}=R(da,ea,Y,Z);return M(da,aa,qa,ha,Y,Z,ta)}return{...oa,center:e.clone(Y)}}async function S(da,aa,ea,ha,Y,Z,ja,oa){ha||(ha=new c({spatialReference:G(da)}),await x.projectVectorToPointAsync(Y,da.renderSpatialReference,ha,{signal:oa})||(ha=null));m.throwIfAborted(oa);const qa=N(da,aa,ea,Y,Z,ja);if(P(da,ea,ja)&&await B(da,qa.eye,oa)){m.throwIfAborted(oa);
const {tilt:ta,mode:va}=R(da,ea,Y,Z);return S(da,aa,ta,ha,Y,Z,va,oa)}return{...qa,center:e.clone(Y)}}function N(da,aa,ea,ha,Y,Z){Y=Math.max(Y,da.state.constraints.minimumPoiDistance);var ja=ea;ea=Y;var oa=0;if(Z=Z===a.OrientationMode.ADJUST){{const ta=da.pointsOfInterest.centerOnSurfaceFrequent.distance;if(8<Math.log(ea/ta)/Math.LN2)Z=!0;else{oa=da.renderSpatialReference;var qa=G(da);Z=new c({spatialReference:qa});x.projectVectorToPoint(ha,oa,Z)?(qa=new c({spatialReference:qa}),x.projectVectorToPoint(da.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
oa,qa)?(oa=Math.tan(.5*da.state.camera.fov)*ta,Z=5<qa.distance(Z)/oa):Z=!1):Z=!1}}}Z?(aa=0,ja=A(da).eyeTiltToLookAtTilt(ja,ha,ea),da.state.constraints.tilt?(Z=da.state.constraints.tilt(ea),Z.max=Math.min(Z.max,.5*Math.PI),oa=Math.min(ja,Z.min*(1-.7)+.7*Z.max)):oa=ja):oa=A(da).eyeTiltToLookAtTilt(ja,ha,ea);ja=oa=da.state.constraints.clampTilt(ea,oa);ea=ja=A(da).lookAtTiltToEyeTilt(ja,ha,ea);da=A(da).eyeForCenterWithHeadingTilt;return da(ha,Y,aa,ea)}function P(da,aa,ea){const ha=da.map.ground.navigationConstraint;
return ea===a.OrientationMode.ADJUST&&"global"===da.viewingMode&&0<aa&&(null==ha||"stay-above"===ha.type)}function R(da,aa,ea,ha){{let Z=A(da).eyeTiltToLookAtTilt(aa,ea,ha);if(da.state.constraints.tilt){var Y=da.state.constraints.tilt(ha);Z=Math.min(Z,.5*Math.PI);Y=Y.min*(1-.7)+.7*Z}else Y=Z}da=A(da).lookAtTiltToEyeTilt(Y,ea,ha);return{tilt:da,mode:1>aa-da?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST}}function O(da,aa){const {state:ea,spatialReference:ha}=da;da=aa.spatialReference;return ea.isGlobal&&
D.isSpatialReferenceSupported(da,p.ViewingMode.Global)||ea.isLocal&&ha.equals(da)}function T(da,aa){let ea;if(da.state.isGlobal){const Z=new c(aa.xmin,aa.ymin,aa.spatialReference),ja=new c(aa.xmax,aa.ymax,aa.spatialReference),oa=aa.spatialReference.isGeographic?ia:ba;var ha=new c({x:oa.center(Z.x,ja.x),y:(ja.y+Z.y)/2,z:null!=aa.zmax&&null!=aa.zmin?(aa.zmax+aa.zmin)/2:void 0,spatialReference:aa.spatialReference});const qa=d.getReferenceEllipsoid(aa.spatialReference);var Y=v.getGreatCircleSpanAt(ha,
Z,ja);ea=Y.lon;Y=Y.lat;oa.diff(Z.x,ja.x)>oa.range/2&&(ea+=qa.halfCircumference);ea=Math.min(ea,qa.halfCircumference);Y=Math.min(Y,qa.halfCircumference)}else ha=da.renderSpatialReference??aa.spatialReference,ha.equals(aa.spatialReference)||(aa=l.project(aa,ha)),ea=aa.xmax-aa.xmin,Y=aa.ymax-aa.ymin,ha=new c({x:aa.xmin+.5*ea,y:aa.ymin+.5*Y,z:null!=aa.zmax&&null!=aa.zmin?(aa.zmax+aa.zmin)/2:void 0,spatialReference:ha});da=da.state.camera;return{center:ha,distance:Math.max(1/Math.tan(da.fovX/2)*ea*.5,
1/Math.tan(da.fovY/2)*Y*.5,1/Math.tan(da.fov/2)*(null!=aa.zmax&&null!=aa.zmin?aa.zmax-aa.zmin:0)*.5)/1}}function Q(da,aa,ea,ha){if(null==aa)return null;const Y=da.renderSpatialReference;da=new c({spatialReference:G(da)});if(!x.projectVectorToPoint(aa.eye,Y,da))return null;ha??=new b;ha.position=da;ha.heading=aa.heading;ha.tilt=aa.tilt;ha.fov=ea;return ha}async function V(da,aa,ea,ha){const Y=da.renderSpatialReference;da=new c({spatialReference:G(da)});await x.projectVectorToPointAsync(aa.eye,Y,da,
{signal:ha});m.throwIfAborted(ha);return new b(da,aa.heading,aa.tilt,ea)}const U=()=>h.getLogger("esri.views.3d.support.cameraUtils"),W=e.create(),ca={heading:0,tilt:0},X=e.create(),ba=new n.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ia=new n.Cyclical(-180,180);a.OrientationMode=void 0;(function(da){da[da.LOCKED=0]="LOCKED";da[da.ADJUST=1]="ADJUST"})(a.OrientationMode||(a.OrientationMode={}));const fa=e.create();a.computeScale=function(da,aa){w.projectVectorToVector(aa.center,da.renderSpatialReference,
W,f.WGS84);return E(da,aa.distance,W[1])};a.directionToHeadingTilt=H;a.distanceToScale=E;a.externalToInternal=function(da,aa){if(null==aa)return null;var ea=da.renderSpatialReference;const ha=A(da).headingTiltToDirectionUp,Y=e.create();if(!r.projectPointToVector(aa.position,Y,ea))return null;ea=ha(Y,aa.heading,aa.tilt);g.scale(ea.direction,ea.direction,da.state.camera.distance);g.add(ea.direction,ea.direction,Y);da=t.cameraOnContentAlongViewDirection(da,Y,ea.direction,ea.up);da.fov=k.deg2rad(aa.fov);
da.row=aa.layout.row;da.rows=aa.layout.rows;da.column=aa.layout.column;da.columns=aa.layout.columns;return da};a.fromCenterDistanceAsync=I;a.fromCenterDistanceSync=function(da,aa,ea,ha,Y,Z){aa=L(da,ha.heading,ha.tilt,aa,ea,Y);return Q(da,aa,ha.fov,Z)};a.fromCenterScale=async function(da,aa,ea,ha,Y,Z){ea=C(da,ea,aa.latitude);return I(da,aa,ea,ha,Y,Z)};a.fromExtentAsync=async function(da,aa,ea,ha,Y,Z){aa=O(da,aa)?aa:await l.projectWithZConversion(aa,da.spatialReference,{signal:Z});m.throwIfAborted(Z);
const {center:ja,distance:oa}=T(da,aa);ea=await F(da,ea,ha,ja,oa,Y,Z);m.throwIfAborted(Z);return V(da,ea,da.camera.fov,Z)};a.fromExtentSync=function(da,aa,ea,ha,Y,Z){let ja;try{ja=O(da,aa)?aa:l.project(aa,da.spatialReference)}catch(ta){return null}const {center:oa,distance:qa}=T(da,ja);aa=L(da,ea,ha,oa,qa,Y);return null==aa?null:Q(da,aa,da.camera.fov,Z)};a.getObserverForPointAtDistanceAsync=F;a.getObserverForPointAtDistanceSync=L;a.getViewSR=G;a.headingTiltToDirectionUp=function(da,aa,ea,ha,Y){return A(da).headingTiltToDirectionUp(aa,
ea,ha,Y)};a.internalToExternal=function(da,aa,ea){const ha=da.renderSpatialReference,Y=H(da,aa.eye,aa.viewForward,aa.up,ca);da=G(da);w.projectVectorToVector(aa.eye,ha,fa,da)||(da=f.WGS84,w.projectVectorToVector(aa.eye,ha,fa,da));null==ea?ea=new b(new c(fa,da),Y.heading,Y.tilt,k.rad2deg(aa.fov)):(ea.position.x=fa[0],ea.position.y=fa[1],ea.position.z=fa[2],ea.position.spatialReference=da,ea.heading=Y.heading,ea.tilt=Y.tilt,ea.fov=k.rad2deg(aa.fov));ea.layout.row=aa.row;ea.layout.rows=aa.rows;ea.layout.column=
aa.column;ea.layout.columns=aa.columns;return ea};a.scaleToDistance=C;a.scaleToZoom=function(da,aa){if(da=da.basemapTerrain?.tilingScheme)return da.levelAtScale(aa);U().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(da,aa,ea){var ha=da.renderSpatialReference;const Y=new c({spatialReference:G(da)});if(!x.projectVectorToPoint(ea,ha,Y))return null;const Z=Math.tan(aa.fovX/2);ha=Math.tan(aa.fovY/2);aa=g.dist(aa.eye,ea);ea=2*aa*Z;ha*=2*aa;return"global"===
da.viewingMode?u.toExtent(da,Y,ea,ha):q.toExtent(da,Y,ea,ha)};a.zoomToScale=function(da,aa){if(da=da.basemapTerrain?.tilingScheme)return da.scaleAtLevel(aa);U().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projection","./projectVectorToVector"],function(a,b,n,h){function k(g,
e,d){if(!h.projectVectorToVector(g,e,m,d.spatialReference))return!1;d.x=m[0];d.y=m[1];d.z=m[2];return!0}const m=b.create();a.projectVectorToPoint=k;a.projectVectorToPointAsync=async function(g,e,d,c){await n.initializeProjection(e,d.spatialReference,null,c);return k(g,e,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projection","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],
function(a,b,n,h,k){function m(e,d,c,l,f){if(null==d||null==l||2>e.length)return!1;g.x=e[0];g.y=e[1];g.z=e[2];g.spatialReference=d;return h.projectPointToVector(g,c,l,f)}const g=k.makeDehydratedPoint(0,0,0,n.WGS84);a.projectVectorToVector=m;a.projectVectorToVectorAsync=async function(e,d,c,l,f,r){await b.initializeProjection(d,l,null,r);return m(e,d,c,l,f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(a){a.makeDehydratedPoint=
function(b,n,h,k){return{x:b,y:n,z:h,hasZ:null!=h,hasM:!1,spatialReference:k,type:"point"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,n,h,k,m){function g(x,w){return x.elevationProvider?x.elevationProvider.getElevation(w[0],
w[1],w[2],x.renderCoordsHelper.spatialReference,"ground")??0:0}function e(x,w,p){if(!x.state.isGlobal||!x.stateManager.constraintsManager)return!1;const t=g(x,w);({far:x}=x.stateManager.constraintsManager.nearFarHeuristic.compute(w,p,x.renderDataExtent,t,r));x*=x;return b.squaredDistance(w,p)>x}const d={},c=n.create(),l=n.create(),f=n.create(),r={near:0,far:0};a.cameraOnContentAlongViewDirection=function(x,w,p,t){const q=x.state.camera.clone();w&&p&&t&&(q.eye=w,q.center=p,q.up=t);w=q.ray;p=d[x.viewingMode];
p||(p=m.newIntersector(x.state.viewingMode),p.options.backfacesTerrain=!x.state.isGlobal,p.options.invisibleTerrain=!0,d[x.viewingMode]=p);({isGlobal:t}=x.state);x.sceneIntersectionHelper.intersectRay(w,p,l)&&!e(x,w.origin,l)?w=!0:!x.renderCoordsHelper.intersectManifold(w,0,l)||e(x,w.origin,l)?t?(p=h.getReferenceEllipsoid(x.spatialReference).radius,p=b.dot(w.origin,w.origin)-p*p,b.scale(l,w.direction,(0<p?Math.sqrt(p)/3:1)/b.length(w.direction)),b.add(l,l,w.origin),w=!0):w=!1:w=!0;w||b.copy(l,q.center);
p=x.state.constraints;t=p.minimumPoiDistance;b.squaredDistance(q.eye,l)<t&&(w=p.collision.enabled,b.copy(f,q.viewForward),b.scale(f,f,t),w?q.eye=b.subtract(c,l,f):b.add(l,q.eye,f),x=x.renderCoordsHelper,t=x.getAltitude(q.eye),p=p.collision.elevationMargin,w&&t<p&&(b.subtract(f,l,q.eye),q.eye=x.setAltitude(c,p,q.eye),b.add(l,q.eye,f)));q.center=l;return q};a.eyeWithinExtent=function(x,w,p,t){return null!=x.renderCoordsHelper.fromRenderCoords(w.eye,c,t)&&k.containsPoint(p,c)};a.surfaceElevationBelowRenderLocation=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x{constructor(v){this.options=new c.IntersectorOptions;this._results=new w;this.transform=new r.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=e.create();this._rayEnd=k.create();this._rayBeginTransformed=k.create();this._rayEndTransformed=k.create();this.viewingMode=null==v?d.ViewingMode.Global:v}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(v,
y,D){this.resetWithRay(e.fromPoints(v,y,this._ray),D)}resetWithRay(v,y){this.camera=y;v!==this._ray&&e.copy(v,this._ray);0!==this.options.verticalOffset?this.viewingMode===d.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;h.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)}intersect(v=null,y,D,G,A){this.point=y;this.filterPredicate=G;this.tolerance=null==D?1E-5:D;y=r.getVerticalOffsetObject3D(this.verticalOffset);
if(v&&0<v.length){const C=A?E=>{A(E)&&this.intersectObject(E)}:E=>{this.intersectObject(E)};for(const E of v)v=E.getSpatialQueryAccelerator?.(),null!=v?(null!=y?v.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,C,y):v.forEachAlongRay(this._ray.origin,this._ray.direction,C),this.options.selectionMode&&this.options.hud&&v.forEachDegenerateObject(C)):E.objects.forAll(I=>C(I))}this.sortResults()}intersectObject(v){const y=v.geometries;if(y){var D=v.effectiveTransformation,G=r.getVerticalOffsetObject3D(this.verticalOffset);
for(const A of y){if(!A.visible)continue;const {material:C,id:E}=A;this.transform.setAndInvalidateLazyTransforms(D,A.transformation);h.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);h.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const I=this.transform.transform;null!=G&&(G.objectTransform=this.transform);C.intersect(A,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(H,J,B,z,K,L)=>{if(0<=H&&(null==this.filterPredicate||
this.filterPredicate(this._ray.origin,this._rayEnd,H))){var F=z?this._results.hud:this._results,M=z?S=>{const N=new l.HudTarget(v,E,B,L);S.set(c.IntersectorType.HUD,N,H,J,n.IDENTITY,K)}:S=>S.set(c.IntersectorType.OBJECT,{object:v,geometryId:E,triangleNr:B},H,J,I,K);(null==F.min.drapedLayerOrder||K>=F.min.drapedLayerOrder)&&(null==F.min.dist||H<F.min.dist)&&M(F.min);this.options.store!==c.StoreResults.MIN&&(null==F.max.drapedLayerOrder||K<F.max.drapedLayerOrder)&&(null==F.max.dist||H>F.max.dist)&&
M(F.max);this.options.store===c.StoreResults.ALL&&(z?(z=new t(this._ray),M(z),this._results.hud.all.push(z)):(z=new p(this._ray),M(z),this._results.all.push(z)))}})}}}sortResults(v=this._results.all){v.sort((y,D)=>y.dist!==D.dist?(y.dist??0)-(D.dist??0):y.drapedLayerOrder!==D.drapedLayerOrder?(D.drapedLayerOrder??-Number.MAX_VALUE)-(y.drapedLayerOrder??-Number.MAX_VALUE):(D.drapedLayerGraphicOrder??-Number.MAX_VALUE)-(y.drapedLayerGraphicOrder??-Number.MAX_VALUE))}}class w{constructor(){this.min=
new p(e.create());this.max=new p(e.create());this.hud={min:new t(e.create()),max:new t(e.create()),all:[]};this.ground=new p(e.create());this.all=[]}init(v){this.min.init(v);this.max.init(v);this.ground.init(v);this.all.length=0;this.hud.min.init(v);this.hud.max.init(v);this.hud.all.length=0}}class p{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?(h.scale(q,this.ray.direction,this.dist),h.length(q)):null}getIntersectionPoint(v){if(!f.isValidIntersectorResult(this))return!1;
h.scale(q,this.ray.direction,this.dist);h.add(v,this.ray.origin,q);return!0}getTransformedNormal(v){h.copy(u,this.normal);u[3]=0;m.transformMat4(u,u,this.transformation);h.copy(v,u);return h.normalize(v,v)}constructor(v){this.intersector=c.IntersectorType.OBJECT;this.normal=k.create();this.transformation=n.create();this._ray=e.create();this.init(v)}init(v){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=c.IntersectorType.OBJECT;e.copy(v,this._ray)}set(v,
y,D,G,A,C,E){this.intersector=v;this.dist=D;h.copy(this.normal,G??k.UNIT_Z);b.copy(this.transformation,A??n.IDENTITY);this.target=y;this.drapedLayerOrder=C;this.drapedLayerGraphicOrder=E}copy(v){e.copy(v.ray,this._ray);this.intersector=v.intersector;this.dist=v.dist;this.target=v.target;this.drapedLayerOrder=v.drapedLayerOrder;this.drapedLayerGraphicOrder=v.drapedLayerGraphicOrder;h.copy(this.normal,v.normal);b.copy(this.transformation,v.transformation)}}class t extends p{constructor(){super(...arguments);
this.intersector=c.IntersectorType.HUD}}const q=k.create(),u=g.create();a.defaultTolerance=1E-5;a.newIntersector=function(v){return new x(v)};a.newIntersectorResult=function(v){return new p(v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(n){n[n.OBJECT=0]="OBJECT";n[n.HUD=1]="HUD";n[n.TERRAIN=2]="TERRAIN";n[n.OVERLAY=3]="OVERLAY";n[n.I3S=4]="I3S";n[n.PCL=
5]="PCL";n[n.LOD=6]="LOD";n[n.VOXEL=7]="VOXEL";n[n.TILES3D=8]="TILES3D"})(a.IntersectorType||(a.IntersectorType={}));class b{constructor(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=[];this.store=a.StoreResults.ALL}}a.StoreResults=void 0;(function(n){n[n.MIN=0]="MIN";n[n.MINMAX=1]="MINMAX";n[n.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(e,d,c){this.object=e;this.geometryId=d;this.triangleNr=c}}class h extends n{constructor(e,d,c,l){super(e,d,c);this.center=null!=l?b.clone(l):null}}class k extends h{}class m{constructor(e){this.layerUid=e}}class g extends m{constructor(e,d){super(e);this.graphicUid=
d}}a.Graphic3DTarget=g;a.HudTarget=h;a.LayerTarget=m;a.ObjectTarget=n;a.ValidHudTarget=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/boundedPlane","./IntersectorInterfaces"],function(a,b,n,h,k){function m(e){return null!=e?.dist}const g=n.create();a.isHudIntersectorResult=function(e){return m(e)&&e.intersector===
k.IntersectorType.HUD&&!!e.target&&"center"in e.target&&null!=e.target.center};a.isObjectIntersectorResult=function(e){return m(e)&&e.intersector===k.IntersectorType.OBJECT&&!!e.target};a.isValidIntersectorResult=m;a.sliceFilterPredicate=function(e){return(d,c,l)=>{b.lerp(g,d,c,l);return!h.extrusionContainsPoint(e,g)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../../ViewingMode ../../support/orientedBoundingBox".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(){this._transform=k.create();this._transformInverse=new f({value:this._transform},h.invert,k.create);this._transformInverseTranspose=new f(this._transformInverse,h.transpose,k.create);this._transformTranspose=new f({value:this._transform},h.transpose,k.create);this._transformInverseRotation=new f({value:this._transform},b.normalFromMat4Legacy,n.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();
this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(A){h.copy(this._transform,A)}multiplyTransform(A){h.multiply(this._transform,this._transform,A)}set(A){h.copy(this._transform,
A);this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(A,C){this.setTransformMatrix(A);this.multiplyTransform(C);this._invalidateLazyTransforms()}}class f{constructor(A,C,E){this._original=A;this._update=C;this._dirty=!0;this._transform=E()}invalidate(){this._dirty=!0}get value(){this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1);return this._transform}}class r{constructor(A=0){this.offset=A;this.tmpVertex=g.create()}applyToVertex(A,C,E){A=m.set(u,A,C,E);
C=m.add(v,A,this.localOrigin);E=this.offset/m.length(C);m.scaleAndAdd(this.tmpVertex,A,C,E);return this.tmpVertex}applyToAabb(A){var C=y;const E=D,I=G;for(var H=0;3>H;++H)C[H]=A[0+H]+this.localOrigin[H],E[H]=A[3+H]+this.localOrigin[H],I[H]=C[H];H=this.applyToVertex(C[0],C[1],C[2]);for(var J=0;3>J;++J)A[J]=H[J],A[J+3]=H[J];H=z=>{z=this.applyToVertex(z[0],z[1],z[2]);for(let K=0;3>K;++K)A[K]=Math.min(A[K],z[K]),A[K+3]=Math.max(A[K+3],z[K])};for(J=1;8>J;++J){for(var B=0;3>B;++B)I[B]=0===(J&1<<B)?C[B]:
E[B];H(I)}J=0;for(B=0;3>B;++B)0>C[B]*E[B]&&(J|=1<<B);if(0!==J&&7!==J)for(B=0;8>B;++B)if(0===(J&B)){for(let z=0;3>z;++z)I[z]=0!==(J&1<<z)?0:0!==(B&1<<z)?C[z]:E[z];H(I)}for(C=0;3>C;++C)A[C]-=this.localOrigin[C],A[C+3]-=this.localOrigin[C];return A}}class x{constructor(A=0){this._offset=this._totalOffset=this.componentLocalOriginLength=0;this._tmpVertex=g.create();this._tmpMbs=e.create();this._tmpObb=new c.Obb;this._resetOffset(A)}_resetOffset(A){this._totalOffset=this._offset=A}set offset(A){this._resetOffset(A)}get offset(){return this._offset}set componentOffset(A){this._totalOffset=
this._offset+A}set localOrigin(A){this.componentLocalOriginLength=m.length(A)}applyToVertex(A,C,E){const I=m.set(u,A,C,E);A=m.set(v,A,C,E+this.componentLocalOriginLength);C=this._totalOffset/m.length(A);m.scaleAndAdd(this._tmpVertex,I,A,C);return this._tmpVertex}applyToAabb(A){var C=this.componentLocalOriginLength;const E=A[0],I=A[1],H=A[2]+C,J=A[3],B=A[4];C=A[5]+C;var z=Math.abs(E),K=Math.abs(I),L=Math.abs(H),F=Math.abs(J),M=Math.abs(B),S=Math.abs(C),N=.5*(1+Math.sign(E*J))*Math.min(z,F),P=.5*(1+
Math.sign(I*B))*Math.min(K,M);const R=.5*(1+Math.sign(H*C))*Math.min(L,S);var O=Math.max(z,F),T=Math.max(K,M),Q=Math.max(L,S);N=Math.sqrt(N*N+P*P+R*R);z=Math.sign(z+E);K=Math.sign(K+I);L=Math.sign(L+H);F=Math.sign(F+J);M=Math.sign(M+B);S=Math.sign(S+C);P=this._totalOffset;if(N<P)return A[0]-=(1-z)*P,A[1]-=(1-K)*P,A[2]-=(1-L)*P,A[3]+=F*P,A[4]+=M*P,A[5]+=S*P,A;O=P/Math.sqrt(O*O+T*T+Q*Q);T=P/N;Q=T-O;N=-Q;A[0]+=E*(z*N+T);A[1]+=I*(K*N+T);A[2]+=H*(L*N+T);A[3]+=J*(F*Q+O);A[4]+=B*(M*Q+O);A[5]+=C*(S*Q+O);
return A}applyToMbs(A){const C=m.length(e.getCenter(A)),E=this._totalOffset/C;m.scaleAndAdd(e.getCenter(this._tmpMbs),e.getCenter(A),e.getCenter(A),E);this._tmpMbs[3]=A[3]+A[3]*this._totalOffset/C;return this._tmpMbs}applyToObb(A){c.computeOffsetObb(A,this._totalOffset,this._totalOffset,d.ViewingMode.Global,this._tmpObb);return this._tmpObb}}class w{constructor(A=0){this.offset=A;this.sphere=e.create();this.tmpVertex=g.create()}applyToVertex(A,C,E){var I=this.objectTransform.transform;A=m.set(u,A,
C,E);I=m.transformMat4(A,A,I);A=this.offset/m.length(I);m.scaleAndAdd(I,I,I,A);m.transformMat4(this.tmpVertex,I,this.objectTransform.inverse);return this.tmpVertex}applyToMinMax(A,C){const E=this.offset/m.length(A);m.scaleAndAdd(A,A,A,E);A=this.offset/m.length(C);m.scaleAndAdd(C,C,C,A)}applyToAabb(A){var C=this.offset/Math.sqrt(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]+=A[0]*C;A[1]+=A[1]*C;A[2]+=A[2]*C;C=this.offset/Math.sqrt(A[3]*A[3]+A[4]*A[4]+A[5]*A[5]);A[3]+=A[3]*C;A[4]+=A[4]*C;A[5]+=A[5]*C;return A}applyToBoundingSphere(A){const C=
m.length(e.getCenter(A)),E=this.offset/C;m.scaleAndAdd(e.getCenter(this.sphere),e.getCenter(A),e.getCenter(A),E);this.sphere[3]=A[3]+A[3]*this.offset/C;return this.sphere}}const p=new w,t=new x,q=new r,u=g.create(),v=g.create(),y=g.create(),D=g.create(),G=g.create();a.I3SVerticalOffsetGlobalViewingMode=x;a.IntersectorTransform=l;a.Object3DVerticalOffsetGlobalViewingMode=w;a.TerrainVerticalOffsetGlobalViewingMode=r;a.getVerticalOffsetI3S=function(A){return null!=A?(t.offset=A,t):null};a.getVerticalOffsetObject3D=
function(A){return null!=A?(p.offset=A,p):null};a.getVerticalOffsetTerrain=function(A){return null!=A?(q.offset=A,q):null};a.terrainId="terrain";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(a,b){function n(F,M){F[0]=M[0];F[1]=M[1];F[2]=M[2];F[3]=M[4];F[4]=M[5];F[5]=M[6];F[6]=M[8];F[7]=M[9];F[8]=M[10];return F}function h(F,M){F[0]=M[0];F[1]=M[1];F[2]=M[2];F[3]=M[3];F[4]=M[4];F[5]=M[5];F[6]=M[6];
F[7]=M[7];F[8]=M[8];return F}function k(F,M,S,N,P,R,O,T,Q,V){F[0]=M;F[1]=S;F[2]=N;F[3]=P;F[4]=R;F[5]=O;F[6]=T;F[7]=Q;F[8]=V;return F}function m(F){F[0]=1;F[1]=0;F[2]=0;F[3]=0;F[4]=1;F[5]=0;F[6]=0;F[7]=0;F[8]=1;return F}function g(F,M){if(F===M){const S=M[1],N=M[2],P=M[5];F[1]=M[3];F[2]=M[6];F[3]=S;F[5]=M[7];F[6]=N;F[7]=P}else F[0]=M[0],F[1]=M[3],F[2]=M[6],F[3]=M[1],F[4]=M[4],F[5]=M[7],F[6]=M[2],F[7]=M[5],F[8]=M[8];return F}function e(F,M){const S=M[0],N=M[1],P=M[2],R=M[3],O=M[4],T=M[5],Q=M[6],V=M[7];
M=M[8];const U=M*O-T*V,W=-M*R+T*Q,ca=V*R-O*Q;let X=S*U+N*W+P*ca;if(!X)return null;X=1/X;F[0]=U*X;F[1]=(-M*N+P*V)*X;F[2]=(T*N-P*O)*X;F[3]=W*X;F[4]=(M*S-P*Q)*X;F[5]=(-T*S+P*R)*X;F[6]=ca*X;F[7]=(-V*S+N*Q)*X;F[8]=(O*S-N*R)*X;return F}function d(F,M){const S=M[0],N=M[1],P=M[2],R=M[3],O=M[4],T=M[5],Q=M[6],V=M[7];M=M[8];F[0]=O*M-T*V;F[1]=P*V-N*M;F[2]=N*T-P*O;F[3]=T*Q-R*M;F[4]=S*M-P*Q;F[5]=P*R-S*T;F[6]=R*V-O*Q;F[7]=N*Q-S*V;F[8]=S*O-N*R;return F}function c(F){const M=F[3],S=F[4],N=F[5],P=F[6],R=F[7],O=F[8];
return F[0]*(O*S-N*R)+F[1]*(-O*M+N*P)+F[2]*(R*M-S*P)}function l(F,M,S){const N=M[0],P=M[1],R=M[2],O=M[3],T=M[4],Q=M[5],V=M[6],U=M[7];M=M[8];const W=S[0],ca=S[1],X=S[2],ba=S[3],ia=S[4],fa=S[5],da=S[6],aa=S[7];S=S[8];F[0]=W*N+ca*O+X*V;F[1]=W*P+ca*T+X*U;F[2]=W*R+ca*Q+X*M;F[3]=ba*N+ia*O+fa*V;F[4]=ba*P+ia*T+fa*U;F[5]=ba*R+ia*Q+fa*M;F[6]=da*N+aa*O+S*V;F[7]=da*P+aa*T+S*U;F[8]=da*R+aa*Q+S*M;return F}function f(F,M,S){const N=M[0],P=M[1],R=M[2],O=M[3],T=M[4],Q=M[5],V=M[6],U=M[7];M=M[8];const W=S[0];S=S[1];
F[0]=N;F[1]=P;F[2]=R;F[3]=O;F[4]=T;F[5]=Q;F[6]=W*N+S*O+V;F[7]=W*P+S*T+U;F[8]=W*R+S*Q+M;return F}function r(F,M,S){const N=M[0],P=M[1],R=M[2],O=M[3],T=M[4],Q=M[5],V=M[6],U=M[7];M=M[8];const W=Math.sin(S);S=Math.cos(S);F[0]=S*N+W*O;F[1]=S*P+W*T;F[2]=S*R+W*Q;F[3]=S*O-W*N;F[4]=S*T-W*P;F[5]=S*Q-W*R;F[6]=V;F[7]=U;F[8]=M;return F}function x(F,M,S){const N=S[0],P=S[1];S=S[2];F[0]=N*M[0];F[1]=N*M[1];F[2]=N*M[2];F[3]=P*M[3];F[4]=P*M[4];F[5]=P*M[5];F[6]=S*M[6];F[7]=S*M[7];F[8]=S*M[8];return F}function w(F,M,
S){const N=S[0];S=S[1];F[0]=N*M[0];F[1]=N*M[1];F[2]=N*M[2];F[3]=S*M[3];F[4]=S*M[4];F[5]=S*M[5];return F}function p(F,M){F[0]=1;F[1]=0;F[2]=0;F[3]=0;F[4]=1;F[5]=0;F[6]=M[0];F[7]=M[1];F[8]=1;return F}function t(F,M){const S=Math.sin(M);M=Math.cos(M);F[0]=M;F[1]=S;F[2]=0;F[3]=-S;F[4]=M;F[5]=0;F[6]=0;F[7]=0;F[8]=1;return F}function q(F,M){F[0]=M[0];F[1]=0;F[2]=0;F[3]=0;F[4]=M[1];F[5]=0;F[6]=0;F[7]=0;F[8]=1;return F}function u(F,M){F[0]=M[0];F[1]=M[1];F[2]=0;F[3]=M[2];F[4]=M[3];F[5]=0;F[6]=M[4];F[7]=M[5];
F[8]=1;return F}function v(F,M){var S=M[0],N=M[1],P=M[2];M=M[3];var R=S+S,O=N+N;const T=P+P;S*=R;const Q=N*R;N*=O;const V=P*R,U=P*O;P*=T;R*=M;O*=M;M*=T;F[0]=1-N-P;F[3]=Q-M;F[6]=V+O;F[1]=Q+M;F[4]=1-S-P;F[7]=U-R;F[2]=V-O;F[5]=U+R;F[8]=1-S-N;return F}function y(F,M){const S=M[0],N=M[1],P=M[2],R=M[4],O=M[5],T=M[6],Q=M[8],V=M[9];M=M[10];const U=M*O-T*V,W=-M*R+T*Q,ca=V*R-O*Q;var X=S*U+N*W+P*ca;if(!X)return null;X=1/X;F[0]=U*X;F[1]=(-M*N+P*V)*X;F[2]=(T*N-P*O)*X;F[3]=W*X;F[4]=(M*S-P*Q)*X;F[5]=(-T*S+P*R)*
X;F[6]=ca*X;F[7]=(-V*S+N*Q)*X;F[8]=(O*S-N*R)*X;return F}function D(F,M){const S=M[0],N=M[1],P=M[2],R=M[3],O=M[4],T=M[5],Q=M[6],V=M[7];var U=M[8],W=M[9],ca=M[10],X=M[11];const ba=M[12],ia=M[13],fa=M[14];M=M[15];const da=S*T-N*O,aa=S*Q-P*O,ea=S*V-R*O,ha=N*Q-P*T,Y=N*V-R*T,Z=P*V-R*Q,ja=U*ia-W*ba,oa=U*fa-ca*ba;U=U*M-X*ba;const qa=W*fa-ca*ia;W=W*M-X*ia;ca=ca*M-X*fa;X=da*ca-aa*W+ea*qa+ha*U-Y*oa+Z*ja;if(!X)return null;X=1/X;F[0]=(T*ca-Q*W+V*qa)*X;F[1]=(Q*U-O*ca-V*oa)*X;F[2]=(O*W-T*U+V*ja)*X;F[3]=(P*W-N*ca-
R*qa)*X;F[4]=(S*ca-P*U+R*oa)*X;F[5]=(N*U-S*W-R*ja)*X;F[6]=(ia*Z-fa*Y+M*ha)*X;F[7]=(fa*ea-ba*Z-M*aa)*X;F[8]=(ba*Y-ia*ea+M*da)*X;return F}function G(F,M,S){F[0]=2/M;F[1]=0;F[2]=0;F[3]=0;F[4]=-2/S;F[5]=0;F[6]=-1;F[7]=1;F[8]=1;return F}function A(F){return"mat3("+F[0]+", "+F[1]+", "+F[2]+", "+F[3]+", "+F[4]+", "+F[5]+", "+F[6]+", "+F[7]+", "+F[8]+")"}function C(F){return Math.sqrt(F[0]**2+F[1]**2+F[2]**2+F[3]**2+F[4]**2+F[5]**2+F[6]**2+F[7]**2+F[8]**2)}function E(F,M,S){F[0]=M[0]+S[0];F[1]=M[1]+S[1];
F[2]=M[2]+S[2];F[3]=M[3]+S[3];F[4]=M[4]+S[4];F[5]=M[5]+S[5];F[6]=M[6]+S[6];F[7]=M[7]+S[7];F[8]=M[8]+S[8];return F}function I(F,M,S){F[0]=M[0]-S[0];F[1]=M[1]-S[1];F[2]=M[2]-S[2];F[3]=M[3]-S[3];F[4]=M[4]-S[4];F[5]=M[5]-S[5];F[6]=M[6]-S[6];F[7]=M[7]-S[7];F[8]=M[8]-S[8];return F}function H(F,M,S){F[0]=M[0]*S;F[1]=M[1]*S;F[2]=M[2]*S;F[3]=M[3]*S;F[4]=M[4]*S;F[5]=M[5]*S;F[6]=M[6]*S;F[7]=M[7]*S;F[8]=M[8]*S;return F}function J(F,M,S,N){F[0]=M[0]+S[0]*N;F[1]=M[1]+S[1]*N;F[2]=M[2]+S[2]*N;F[3]=M[3]+S[3]*N;F[4]=
M[4]+S[4]*N;F[5]=M[5]+S[5]*N;F[6]=M[6]+S[6]*N;F[7]=M[7]+S[7]*N;F[8]=M[8]+S[8]*N;return F}function B(F,M){return F[0]===M[0]&&F[1]===M[1]&&F[2]===M[2]&&F[3]===M[3]&&F[4]===M[4]&&F[5]===M[5]&&F[6]===M[6]&&F[7]===M[7]&&F[8]===M[8]}function z(F,M){const S=F[0],N=F[1],P=F[2],R=F[3],O=F[4],T=F[5],Q=F[6],V=F[7];F=F[8];const U=M[0],W=M[1],ca=M[2],X=M[3],ba=M[4],ia=M[5],fa=M[6],da=M[7];M=M[8];const aa=b.getEpsilon();return Math.abs(S-U)<=aa*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(N-W)<=aa*Math.max(1,
Math.abs(N),Math.abs(W))&&Math.abs(P-ca)<=aa*Math.max(1,Math.abs(P),Math.abs(ca))&&Math.abs(R-X)<=aa*Math.max(1,Math.abs(R),Math.abs(X))&&Math.abs(O-ba)<=aa*Math.max(1,Math.abs(O),Math.abs(ba))&&Math.abs(T-ia)<=aa*Math.max(1,Math.abs(T),Math.abs(ia))&&Math.abs(Q-fa)<=aa*Math.max(1,Math.abs(Q),Math.abs(fa))&&Math.abs(V-da)<=aa*Math.max(1,Math.abs(V),Math.abs(da))&&Math.abs(F-M)<=aa*Math.max(1,Math.abs(F),Math.abs(M))}function K(F){const M=b.getEpsilon(),S=F[0],N=F[1],P=F[2],R=F[3],O=F[4],T=F[5],Q=
F[6],V=F[7];F=F[8];return Math.abs(1-(S*S+R*R+Q*Q))<=M&&Math.abs(1-(N*N+O*O+V*V))<=M&&Math.abs(1-(P*P+T*T+F*F))<=M}const L=Object.freeze(Object.defineProperty({__proto__:null,add:E,adjoint:d,copy:h,determinant:c,equals:z,exactEquals:B,frob:C,fromMat2d:u,fromMat4:n,fromQuat:v,fromRotation:t,fromScaling:q,fromTranslation:p,identity:m,invert:e,isOrthoNormal:K,mul:l,multiply:l,multiplyScalar:H,multiplyScalarAndAdd:J,normalFromMat4:D,normalFromMat4Legacy:y,projection:G,rotate:r,scale:x,scaleByVec2:w,set:k,
str:A,sub:I,subtract:I,translate:f,transpose:g},Symbol.toStringTag,{value:"Module"}));a.add=E;a.adjoint=d;a.copy=h;a.determinant=c;a.equals=z;a.exactEquals=B;a.frob=C;a.fromMat2d=u;a.fromMat4=n;a.fromQuat=v;a.fromRotation=t;a.fromScaling=q;a.fromTranslation=p;a.identity=m;a.invert=e;a.isOrthoNormal=K;a.mat3=L;a.mul=l;a.multiply=l;a.multiplyScalar=H;a.multiplyScalarAndAdd=J;a.normalFromMat4=D;a.normalFromMat4Legacy=y;a.projection=G;a.rotate=r;a.scale=x;a.scaleByVec2=w;a.set=k;a.str=A;a.sub=I;a.subtract=
I;a.translate=f;a.transpose=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/support/plane ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/vectorStacks ../../ViewingMode ./dito ../webgl-engine/lib/Attribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){function D(ba,ia=new E){v.computeOBB(ba,ia);return ia}function G(ba,ia,fa,da,aa){var ea=ia.getQuaternion(H);ea=b.fromQuat(T,ea);ia=ia.getHalfSize(O);for(let Y=0;8>Y;++Y){for(var ha=0;3>ha;++ha)N[ha]=ia[ha]*(0!==(Y&1<<ha)?-1:1);for(ha=0;3>ha;++ha){let Z=fa[ha];for(let ja=0;3>ja;++ja)Z+=N[ja]*ea[3*ja+ha];M[3*Y+ha]=Z}}x.projectBuffer(M,ba,0,M,da,0,8);D(S,aa)}function A(ba,ia,fa,da,aa=f.getSphericalPCPF(fa),ea=w.getProjector(fa,aa)){ba.getCorners(V);
ba.getCenter(N);N[2]+=da;r.computeTranslationToOriginAndRotation(fa,N,Q,aa);ia.setCenter(Q[12],Q[13],Q[14]);fa=2*Math.sqrt(1+Q[0]+Q[5]+Q[10]);I[0]=(Q[6]-Q[9])/fa;I[1]=(Q[8]-Q[2])/fa;I[2]=(Q[1]-Q[4])/fa;I[3]=.25*fa;ba=ba.getQuaternion(H);ia.quaternion=k.multiply(I,I,ba);k.conjugate(I,I);g.set(W,0,0,0);ba=ia.getCenter(R);for(const ha of V)ha[2]+=da,ea(ha,0,ha,0),g.sub(U,ha,ba),g.transformQuat(U,U,I),g.abs(U,U),g.max(W,W,U);ia.halfSize=W}function C(ba,ia,fa,da,aa=f.getSphericalPCPF(fa)){const ea=l.getReferenceEllipsoid(fa),
ha=1+Math.max(0,da)/(ea.radius+ba.centerZ);ba.getCenter(N);N[2]+=da;x.projectBuffer(N,fa,0,N,aa,0,1);ia.center=N;fa=ba.getQuaternion(H);ia.quaternion=fa;k.conjugate(I,fa);g.set(U,0,0,1);g.transformQuat(U,U,I);ba=ba.getHalfSize(O);g.set(U,ba[0]*Math.abs(U[0]),ba[1]*Math.abs(U[1]),ba[2]*Math.abs(U[2]));g.scale(U,U,ea.inverseFlattening);g.add(U,ba,U);ia.halfSize=g.scale(U,U,ha)}class E{constructor(ba=e.ZEROS,ia=X,fa=m.IDENTITY){this._data=[ba[0],ba[1],ba[2],ia[0],ia[1],ia[2],fa[0],fa[1],fa[2],fa[3]]}clone(){const ba=
new E;ba._data=this._data.slice();return ba}invalidate(){this._data[3]=-1}get isValid(){return 0<=this._data[3]}static fromData(ba){const ia=new E;ia._data=ba.slice();return ia}static fromJSON(ba){return new E(ba.center,ba.halfSize,ba.quaternion)}copy(ba){this._data=ba.data.slice()}get center(){return g.set(q.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(ba){ba[0]=this._data[0];
ba[1]=this._data[1];ba[2]=this._data[2];return ba}set center(ba){this._data[0]=ba[0];this._data[1]=ba[1];this._data[2]=ba[2]}setCenter(ba,ia,fa){this._data[0]=ba;this._data[1]=ia;this._data[2]=fa}get halfSize(){return g.set(q.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(ba){ba[0]=this._data[3];ba[1]=this._data[4];ba[2]=this._data[5];return ba}set halfSize(ba){this._data[3]=
ba[0];this._data[4]=ba[1];this._data[5]=ba[2]}get quaternion(){return k.set(q.sq4d.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(ba){ba[0]=this._data[6];ba[1]=this._data[7];ba[2]=this._data[8];ba[3]=this._data[9];return ba}set quaternion(ba){this._data[6]=ba[0];this._data[7]=ba[1];this._data[8]=ba[2];this._data[9]=ba[3]}get data(){return this._data}getCorners(ba){const ia=I,fa=this._data;ia[0]=fa[6];ia[1]=fa[7];ia[2]=fa[8];ia[3]=fa[9];for(let da=0;8>da;++da){const aa=
ba[da];aa[0]=(da&1?-1:1)*fa[3];aa[1]=(da&2?-1:1)*fa[4];aa[2]=(da&4?-1:1)*fa[5];g.transformQuat(aa,aa,ia);aa[0]+=fa[0];aa[1]+=fa[1];aa[2]+=fa[2]}}isVisible(ba){return 0>=this.intersectPlane(ba[0])&&0>=this.intersectPlane(ba[1])&&0>=this.intersectPlane(ba[2])&&0>=this.intersectPlane(ba[3])&&0>=this.intersectPlane(ba[4])&&0>=this.intersectPlane(ba[5])}get radius(){const ba=this._data[3],ia=this._data[4],fa=this._data[5];return Math.sqrt(ba*ba+ia*ia+fa*fa)}intersectSphere(ba){B[0]=this._data[0]-ba[0];
B[1]=this._data[1]-ba[1];B[2]=this._data[2]-ba[2];const ia=this.getQuaternion(H);k.conjugate(I,ia);g.transformQuat(B,B,I);g.abs(B,B);z[0]=Math.min(B[0],this._data[3]);z[1]=Math.min(B[1],this._data[4]);z[2]=Math.min(B[2],this._data[5]);return g.sqrDist(z,B)<ba[3]*ba[3]}intersectSphereWithMBS(ba,ia=this.radius){const fa=this._data;B[0]=fa[0]-ba[0];B[1]=fa[1]-ba[1];B[2]=fa[2]-ba[2];ba=ba[3];const da=g.sqrLen(B);ia=ba+ia;if(da>ia*ia)return!1;I[0]=-fa[6];I[1]=-fa[7];I[2]=-fa[8];I[3]=fa[9];g.transformQuat(B,
B,I);g.abs(B,B);z[0]=Math.min(B[0],fa[3]);z[1]=Math.min(B[1],fa[4]);z[2]=Math.min(B[2],fa[5]);return g.sqrDist(z,B)<ba*ba}intersectPlane(ba){const ia=ba[0]*this._data[0]+ba[1]*this._data[1]+ba[2]*this._data[2]+ba[3];ba=this.projectedRadius(p.getNormal(ba));return ia>ba?1:ia<-ba?-1:0}intersectRay(ba,ia,fa=0){var da=this._data,aa=I;aa[0]=-da[6];aa[1]=-da[7];aa[2]=-da[8];aa[3]=da[9];B[0]=ba[0]-da[0];B[1]=ba[1]-da[1];B[2]=ba[2]-da[2];ba=g.transformQuat(B,B,I);ia=g.transformQuat(z,ia,I);da=-Infinity;aa=
Infinity;const ea=this.getHalfSize(O);for(let Y=0;3>Y;Y++){var ha=ba[Y];const Z=ia[Y],ja=ea[Y]+fa;if(1E-6<Math.abs(Z)){const oa=(ja-ha)/Z;ha=(-ja-ha)/Z;da=Math.max(da,Math.min(oa,ha));aa=Math.min(aa,Math.max(oa,ha))}else if(ha>ja||ha<-ja)return!1}return da<=aa}projectedArea(ba,ia,fa,da){var aa=this.getQuaternion(H);k.conjugate(I,aa);B[0]=ba[0]-this._data[0];B[1]=ba[1]-this._data[1];B[2]=ba[2]-this._data[2];g.transformQuat(B,B,I);var ea=this.getHalfSize(O),ha=B[0]<-ea[0]?-1:B[0]>ea[0]?1:0,Y=B[1]<-ea[1]?
-1:B[1]>ea[1]?1:0;const Z=B[2]<-ea[2]?-1:B[2]>ea[2]?1:0;ba=Math.abs(ha)+Math.abs(Y)+Math.abs(Z);if(0===ba)return Infinity;ba=1===ba?4:6;ha=6*(ha+3*Y+9*Z+13);b.fromQuat(T,aa);b.scale(T,T,ea);aa=this.getCenter(P);for(ea=0;ea<ba;ea++)Y=F[ha+ea],g.set(B,((Y&1)<<1)-1,(Y&2)-1,((Y&4)>>1)-1),g.transformMat3(B,B,T),g.add(K,aa,B),K[3]=1,d.transformMat4(K,K,ia),Y=1/Math.max(1E-6,K[3]),L[2*ea]=K[0]*Y,L[2*ea+1]=K[1]*Y;ia=2*ba-2;ba=L[0]*(L[3]-L[ia+1])+L[ia]*(L[1]-L[ia-1]);for(aa=2;aa<ia;aa+=2)ba+=L[aa]*(L[aa+3]-
L[aa-1]);return Math.abs(ba)*fa*da*.125}projectedRadius(ba){const ia=this.getQuaternion(H);k.conjugate(I,ia);g.transformQuat(B,ba,I);return Math.abs(B[0]*this._data[3])+Math.abs(B[1]*this._data[4])+Math.abs(B[2]*this._data[5])}minimumDistancePlane(ba){const ia=ba[0]*this._data[0]+ba[1]*this._data[1]+ba[2]*this._data[2]+ba[3];ba=this.projectedRadius(p.getNormal(ba));return ia-ba}maximumDistancePlane(ba){const ia=ba[0]*this._data[0]+ba[1]*this._data[1]+ba[2]*this._data[2]+ba[3];ba=this.projectedRadius(p.getNormal(ba));
return ia+ba}toAaBoundingBox(ba){var ia=this.getQuaternion(H),fa=b.fromQuat(T,ia);ia=this._data[3]*Math.abs(fa[0])+this._data[4]*Math.abs(fa[3])+this._data[5]*Math.abs(fa[6]);const da=this._data[3]*Math.abs(fa[1])+this._data[4]*Math.abs(fa[4])+this._data[5]*Math.abs(fa[7]);fa=this._data[3]*Math.abs(fa[2])+this._data[4]*Math.abs(fa[5])+this._data[5]*Math.abs(fa[8]);ba[0]=this._data[0]-ia;ba[1]=this._data[1]-da;ba[2]=this._data[2]-fa;ba[3]=this._data[0]+ia;ba[4]=this._data[1]+da;ba[5]=this._data[2]+
fa}transform(ba,ia,fa,da=0,aa=f.getSphericalPCPF(fa),ea=f.getSphericalPCPF(ia),ha=w.getProjector(ia,ea)){fa===aa?ia.isGeographic?C(this,ba,ia,da,ea):A(this,ba,ia,da,ea,ha):ia.isWGS84&&(fa.isWebMercator||t.isPlateCarree(fa))?(this.getCenter(P),P[2]+=da,da=f.getSphericalPCPF(fa),x.projectBuffer(P,ia,0,P,da,0,1),G(da,this,P,fa,ba)):ia.isWebMercator&&t.isPlateCarree(fa)?(this.getCenter(P),P[2]+=da,G(ia,this,P,fa,ba)):(aa=this.getCenter(P),aa[2]+=da,x.projectBuffer(aa,ia,0,aa,fa,0,1),ba.center=aa,this!==
ba&&(ba.quaternion=this.getQuaternion(H),ba.halfSize=this.getHalfSize(O)))}}const I=m.create(),H=m.create(),J=m.create(),B=e.create(),z=e.create(),K=c.create(),L=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],F=(()=>{const ba=new Int8Array(162);let ia=0;const fa=da=>{for(let aa=0;aa<da.length;aa++)ba[ia+aa]=da[aa];ia+=6};fa([6,2,3,1,5,4]);fa([0,2,3,1,5,4]);fa([0,2,3,7,5,4]);fa([0,1,3,2,6,4]);fa([0,1,3,2,0,0]);fa([0,1,5,7,3,2]);fa([0,1,3,7,6,4]);fa([0,1,3,7,6,2]);fa([0,1,5,7,6,2]);fa([0,1,5,4,6,2]);fa([0,
1,5,4,0,0]);fa([0,1,3,7,5,4]);fa([0,2,6,4,0,0]);fa([0,0,0,0,0,0]);fa([1,3,7,5,0,0]);fa([2,3,7,6,4,0]);fa([2,3,7,6,0,0]);fa([2,3,1,5,7,6]);fa([0,1,5,7,6,2]);fa([0,1,5,7,6,4]);fa([0,1,3,7,6,4]);fa([4,5,7,6,2,0]);fa([4,5,7,6,0,0]);fa([4,5,1,3,7,6]);fa([0,2,3,7,5,4]);fa([6,2,3,7,5,4]);fa([6,2,3,1,5,4]);return ba})(),M=Array(24),S=new y.Vertices(M,3),N=e.create(),P=e.create(),R=e.create(),O=e.create(),T=n.create(),Q=h.create(),V=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],U=e.create(),
W=e.create(),ca=e.create(),X=e.fromValues(-1,-1,-1);a.Obb=E;a.compute=D;a.computeOffsetObb=function(ba,ia,fa,da,aa){var ea=ba.getQuaternion(H);aa.quaternion=ea;k.conjugate(I,ea);var ha=ba.getCenter(P);ea=ba.getHalfSize(O);if(da===u.ViewingMode.Global){g.transformQuat(U,ha,I);g.abs(W,U);g.min(ca,W,ea);g.sub(ca,W,ca);da=g.length(ca);g.add(ca,W,ea);const Y=g.length(ca);da<fa?(aa.center=ha,g.set(U,fa,fa,fa),aa.halfSize=g.add(U,ea,U)):(ia=0<Y?1+ia/Y:1,ha=0<da?1+fa/da:1,fa=(ha+ia)/2,ia=(ha-ia)/2,g.scale(ca,
W,ia),aa.halfSize=g.scaleAndAdd(ca,ca,ea,fa),g.scale(ca,W,fa),g.scaleAndAdd(ca,ca,ea,ia),g.sign(U,U),g.multiply(U,ca,U),ba=ba.getQuaternion(J),aa.center=g.transformQuat(U,U,ba))}else aa.center=g.scaleAndAdd(U,ha,e.UNIT_Z,(fa+ia)/2),ba=g.transformQuat(U,e.UNIT_Z,I),g.abs(ba,ba),aa.halfSize=g.scaleAndAdd(W,ea,ba,(fa-ia)/2);return aa};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ../../../../chunks/vec32 ../../../../chunks/vec42".split(" "),
function(a,b,n,h,k,m,g){function e(Q){Q[0]=0;Q[1]=0;Q[2]=0;Q[3]=1;return Q}function d(Q,V,U){U*=.5;const W=Math.sin(U);Q[0]=W*V[0];Q[1]=W*V[1];Q[2]=W*V[2];Q[3]=Math.cos(U);return Q}function c(Q,V){const U=2*Math.acos(V[3]),W=Math.sin(U/2);W>k.getEpsilon()?(Q[0]=V[0]/W,Q[1]=V[1]/W,Q[2]=V[2]/W):(Q[0]=1,Q[1]=0,Q[2]=0);return U}function l(Q,V,U){const W=V[0],ca=V[1],X=V[2];V=V[3];const ba=U[0],ia=U[1],fa=U[2];U=U[3];Q[0]=W*U+V*ba+ca*fa-X*ia;Q[1]=ca*U+V*ia+X*ba-W*fa;Q[2]=X*U+V*fa+W*ia-ca*ba;Q[3]=V*U-W*
ba-ca*ia-X*fa;return Q}function f(Q,V,U){U*=.5;const W=V[0],ca=V[1],X=V[2];V=V[3];const ba=Math.sin(U);U=Math.cos(U);Q[0]=W*U+V*ba;Q[1]=ca*U+X*ba;Q[2]=X*U-ca*ba;Q[3]=V*U-W*ba;return Q}function r(Q,V,U){U*=.5;const W=V[0],ca=V[1],X=V[2];V=V[3];const ba=Math.sin(U);U=Math.cos(U);Q[0]=W*U-X*ba;Q[1]=ca*U+V*ba;Q[2]=X*U+W*ba;Q[3]=V*U-ca*ba;return Q}function x(Q,V,U){U*=.5;const W=V[0],ca=V[1],X=V[2];V=V[3];const ba=Math.sin(U);U=Math.cos(U);Q[0]=W*U+ca*ba;Q[1]=ca*U-W*ba;Q[2]=X*U+V*ba;Q[3]=V*U-X*ba;return Q}
function w(Q,V){const U=V[0],W=V[1];V=V[2];Q[0]=U;Q[1]=W;Q[2]=V;Q[3]=Math.sqrt(Math.abs(1-U*U-W*W-V*V));return Q}function p(Q,V,U,W){const ca=V[0],X=V[1],ba=V[2];V=V[3];let ia=U[0],fa=U[1],da=U[2];U=U[3];let aa;let ea;var ha=ca*ia+X*fa+ba*da+V*U;0>ha&&(ha=-ha,ia=-ia,fa=-fa,da=-da,U=-U);1-ha>k.getEpsilon()?(aa=Math.acos(ha),ea=Math.sin(aa),ha=Math.sin((1-W)*aa)/ea,W=Math.sin(W*aa)/ea):ha=1-W;Q[0]=ha*ca+W*ia;Q[1]=ha*X+W*fa;Q[2]=ha*ba+W*da;Q[3]=ha*V+W*U;return Q}function t(Q){var V=k.RANDOM,U=V();const W=
V();V=V();const ca=Math.sqrt(1-U);U=Math.sqrt(U);Q[0]=ca*Math.sin(2*Math.PI*W);Q[1]=ca*Math.cos(2*Math.PI*W);Q[2]=U*Math.sin(2*Math.PI*V);Q[3]=U*Math.cos(2*Math.PI*V);return Q}function q(Q,V){const U=V[0],W=V[1],ca=V[2];V=V[3];var X=U*U+W*W+ca*ca+V*V;X=X?1/X:0;Q[0]=-U*X;Q[1]=-W*X;Q[2]=-ca*X;Q[3]=V*X;return Q}function u(Q,V){Q[0]=-V[0];Q[1]=-V[1];Q[2]=-V[2];Q[3]=V[3];return Q}function v(Q,V){var U=V[0]+V[4]+V[8];if(0<U)U=Math.sqrt(U+1),Q[3]=.5*U,U=.5/U,Q[0]=(V[5]-V[7])*U,Q[1]=(V[6]-V[2])*U,Q[2]=(V[1]-
V[3])*U;else{let W=0;V[4]>V[0]&&(W=1);V[8]>V[3*W+W]&&(W=2);const ca=(W+1)%3,X=(W+2)%3;U=Math.sqrt(V[3*W+W]-V[3*ca+ca]-V[3*X+X]+1);Q[W]=.5*U;U=.5/U;Q[3]=(V[3*ca+X]-V[3*X+ca])*U;Q[ca]=(V[3*ca+W]+V[3*W+ca])*U;Q[X]=(V[3*X+W]+V[3*W+X])*U}return Q}function y(Q,V,U,W){var ca=.5*Math.PI/180;V*=ca;U*=ca;W*=ca;ca=Math.sin(V);V=Math.cos(V);const X=Math.sin(U);U=Math.cos(U);const ba=Math.sin(W);W=Math.cos(W);Q[0]=ca*U*W-V*X*ba;Q[1]=V*X*W+ca*U*ba;Q[2]=V*U*ba-ca*X*W;Q[3]=V*U*W+ca*X*ba;return Q}function D(Q){return"quat("+
Q[0]+", "+Q[1]+", "+Q[2]+", "+Q[3]+")"}function G(Q,V,U){const W=m.dot(V,U);if(-.999999>W)return m.cross(S,N,V),1E-6>m.len(S)&&m.cross(S,P,V),m.normalize(S,S),d(Q,S,Math.PI),Q;if(.999999<W)return Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q;m.cross(S,V,U);Q[0]=S[0];Q[1]=S[1];Q[2]=S[2];Q[3]=1+W;return F(Q,Q)}function A(Q,V,U,W,ca,X){p(R,V,ca,X);p(O,U,W,X);p(Q,R,O,2*X*(1-X));return Q}function C(Q,V,U,W){const ca=T;ca[0]=U[0];ca[3]=U[1];ca[6]=U[2];ca[1]=W[0];ca[4]=W[1];ca[7]=W[2];ca[2]=-V[0];ca[5]=-V[1];ca[8]=-V[2];
return F(Q,v(Q,ca))}const E=g.copy,I=g.set,H=g.add,J=g.scale,B=g.dot,z=g.lerp,K=g.length,L=g.squaredLength,F=g.normalize,M=g.exactEquals;g=g.equals;const S=h.create(),N=h.fromValues(1,0,0),P=h.fromValues(0,1,0),R=n.create(),O=n.create(),T=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,add:H,calculateW:w,conjugate:u,copy:E,dot:B,equals:g,exactEquals:M,fromEuler:y,fromMat3:v,getAxisAngle:c,identity:e,invert:q,len:K,length:K,lerp:z,mul:l,multiply:l,normalize:F,random:t,rotateX:f,rotateY:r,
rotateZ:x,rotationTo:G,scale:J,set:I,setAxes:C,setAxisAngle:d,slerp:p,sqlerp:A,sqrLen:L,squaredLength:L,str:D},Symbol.toStringTag,{value:"Module"}));a.add=H;a.calculateW=w;a.conjugate=u;a.copy=E;a.dot=B;a.equals=g;a.exactEquals=M;a.fromEuler=y;a.fromMat3=v;a.getAxisAngle=c;a.identity=e;a.invert=q;a.len=K;a.length=K;a.lerp=z;a.mul=l;a.multiply=l;a.normalize=F;a.quat=b;a.random=t;a.rotateX=f;a.rotateY=r;a.rotateZ=x;a.rotationTo=G;a.scale=J;a.set=I;a.setAxes=C;a.setAxisAngle=d;a.slerp=p;a.sqlerp=A;a.sqrLen=
L;a.squaredLength=L;a.str=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/factories/vec3f64 ./localRotationUtils ./projectors ../support/spatialReferenceUtils".split(" "),function(a,b,n,h,k,m,g){function e(f){return f===m.ProjectionID.SPHERICAL_ECEF||f===m.ProjectionID.SPHERICAL_MARS_PCPF||f===m.ProjectionID.SPHERICAL_MOON_PCPF}
const d=b.deg2rad(1),c=h.create(),l=h.create();a.computeTranslationToOriginAndRotation=function(f,r,x,w){if(null==f||null==w)return!1;var p=m.classifySpatialReference(f,m.sourceClassificationCache),t=m.classifySpatialReference(w,m.destClassificationCache);if(p===t&&!e(t)&&(p!==m.ProjectionID.UNKNOWN||g.equals(f,w)))return n.fromTranslation(x,r),!0;if(e(t)){p=m.projectionTable[p][m.ProjectionID.LON_LAT];t=m.projectionTable[m.ProjectionID.LON_LAT][t];if(null==p||null==t)return!1;p(r,0,c,0);t(c,0,l,
0);k.computeENUToSphericalPCPFLocalRotation(d*c[0],d*c[1],x);x[12]=l[0];x[13]=l[1];x[14]=l[2];return!0}if((t===m.ProjectionID.WEB_MERCATOR||t===m.ProjectionID.PLATE_CARREE||t===m.ProjectionID.WGS84)&&(p===m.ProjectionID.WGS84||p===m.ProjectionID.CGCS2000&&t===m.ProjectionID.PLATE_CARREE||p===m.ProjectionID.SPHERICAL_ECEF||p===m.ProjectionID.WEB_MERCATOR)){f=m.projectionTable[p][m.ProjectionID.LON_LAT];t=m.projectionTable[m.ProjectionID.LON_LAT][t];if(null==f||null==t)return!1;f(r,0,c,0);t(c,0,l,0);
p===m.ProjectionID.SPHERICAL_ECEF?k.computeSphericalPCPFToENULocalRotation(d*c[0],d*c[1],x):n.identity(x);x[12]=l[0];x[13]=l[1];x[14]=l[2];return!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(a,b){function n(h,k,m){const g=Math.sin(h);h=Math.cos(h);const e=Math.sin(k);k=Math.cos(k);m[0]=-g;m[4]=-e*h;m[8]=k*h;m[12]=0;m[1]=h;m[5]=-e*g;m[9]=k*g;m[13]=
0;m[2]=0;m[6]=k;m[10]=e;m[14]=0;m[3]=0;m[7]=0;m[11]=0;m[15]=1;return m}a.computeENUToSphericalPCPFLocalRotation=n;a.computeSphericalPCPFToENULocalRotation=function(h,k,m){n(h,k,m);b.transpose(m,m);return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/dito":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../webgl-engine/lib/Attribute".split(" "),
function(a,b,n,h,k,m,g){function e(aa,ea,ha,Y,Z,ja){if(!(1E-6>ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]))for(t(K,ha,ea),t(L,Y,ea),t(F,Z,ea),d(aa,ea,z),S[1]=z[0],M[1]=z[1],N[1]=M[1]-S[1],ha=[ha,Y,Z],Y=[K,L,F],Z=0;3>Z;++Z){d(aa,ha[Z],z);S[0]=z[0];M[0]=z[1];d(aa,Y[Z],z);S[2]=z[0];M[2]=z[1];N[0]=M[0]-S[0];N[2]=M[2]-S[2];const oa=f(N);oa<ja.quality&&(p(ja.b0,ha[Z]),p(ja.b1,ea),p(ja.b2,Y[Z]),ja.quality=oa)}}function d(aa,ea,ha){const {data:Y,size:Z}=aa;ha[0]=Number.POSITIVE_INFINITY;ha[1]=Number.NEGATIVE_INFINITY;
for(aa=0;aa<Y.length;aa+=Z){const ja=Y[aa]*ea[0]+Y[aa+1]*ea[1]+Y[aa+2]*ea[2];ha[0]=Math.min(ha[0],ja);ha[1]=Math.max(ha[1],ja)}}function c(aa,ea,ha,Y,Z,ja){d(aa,ea,z);Z[0]=z[0];ja[0]=z[1];d(aa,ha,z);Z[1]=z[0];ja[1]=z[1];d(aa,Y,z);Z[2]=z[0];ja[2]=z[1]}function l(aa,ea,ha,Y,Z,ja,oa){ba[0]=aa[0];ba[1]=aa[1];ba[2]=aa[2];ba[3]=ea[0];ba[4]=ea[1];ba[5]=ea[2];ba[6]=ha[0];ba[7]=ha[1];ba[8]=ha[2];var qa=ia,ta=ba,va=ta[0]+ta[4]+ta[8];if(0<va)va=Math.sqrt(va+1),qa[3]=.5*va,va=.5/va,qa[0]=(ta[5]-ta[7])*va,qa[1]=
(ta[6]-ta[2])*va,qa[2]=(ta[1]-ta[3])*va;else{va=0;ta[4]>ta[0]&&(va=1);ta[8]>ta[3*va+va]&&(va=2);const Ca=(va+1)%3,ma=(va+2)%3;let wa=Math.sqrt(ta[3*va+va]-ta[3*Ca+Ca]-ta[3*ma+ma]+1);qa[va]=.5*wa;wa=.5/wa;qa[3]=(ta[3*Ca+ma]-ta[3*ma+Ca])*wa;qa[Ca]=(ta[3*Ca+va]+ta[3*va+Ca])*wa;qa[ma]=(ta[3*ma+va]+ta[3*va+ma])*wa}oa.quaternion=qa;r(W,Y,Z);w(W,W,.5);w(ca,aa,W[0]);w(X,ea,W[1]);r(ca,ca,X);w(X,ha,W[2]);oa.center=k.add(ca,ca,X);oa.halfSize=k.scale(W,ja,.5)}function f(aa){return aa[0]*aa[1]+aa[0]*aa[2]+aa[1]*
aa[2]}function r(aa,ea,ha){aa[0]=ea[0]+ha[0];aa[1]=ea[1]+ha[1];aa[2]=ea[2]+ha[2]}function x(aa,ea,ha){aa[0]=ea[0]-ha[0];aa[1]=ea[1]-ha[1];aa[2]=ea[2]-ha[2]}function w(aa,ea,ha){aa[0]=ea[0]*ha;aa[1]=ea[1]*ha;aa[2]=ea[2]*ha}function p(aa,ea,ha=0){aa[0]=ea[ha];aa[1]=ea[ha+1];aa[2]=ea[ha+2]}function t(aa,ea,ha){const Y=ea[0],Z=ea[1];ea=ea[2];const ja=ha[0],oa=ha[1];ha=ha[2];aa[0]=Z*ha-ea*oa;aa[1]=ea*ja-Y*ha;aa[2]=Y*oa-Z*ja}function q(aa,ea){var ha=ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2];0<ha&&(ha=1/Math.sqrt(ha),
aa[0]=ea[0]*ha,aa[1]=ea[1]*ha,aa[2]=ea[2]*ha)}function u(aa,ea){const ha=ea[0]-aa[0],Y=ea[1]-aa[1];aa=ea[2]-aa[2];return ha*ha+Y*Y+aa*aa}const v=m.create(),y=m.create(),D=m.create(),G=m.create(),A=m.create(),C=m.create(),E=m.create(),I=m.create(),H=m.create(),J=m.create(),B=[0,0,0],z=h.create(),K=m.create(),L=m.create(),F=m.create(),M=m.create(),S=m.create(),N=m.create(),P=m.create(),R=m.create(),O=m.create(),T=m.create(),Q=m.create(),V=m.create(),U=m.create(),W=m.create(),ca=m.create(),X=m.create(),
ba=b.fromValues(1,0,0,0,1,0,0,0,1),ia=n.create();class fa{constructor(aa){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ea=0;this.minProj=new Float64Array(this.buffer,ea,7);ea+=56;this.maxProj=new Float64Array(this.buffer,ea,7);ea+=56;for(var ha=0;7>ha;++ha)this.minVert[ha]=new Float64Array(this.buffer,ea,3),ea+=24;for(ha=0;7>ha;++ha)this.maxVert[ha]=new Float64Array(this.buffer,ea,3),ea+=24;for(ea=0;7>ea;++ea)this.minProj[ea]=Number.POSITIVE_INFINITY,this.maxProj[ea]=
Number.NEGATIVE_INFINITY;ea=Array(7);ha=Array(7);const {data:Y,size:Z}=aa;for(aa=0;aa<Y.length;aa+=Z){var ja=Y[aa];ja<this.minProj[0]&&(this.minProj[0]=ja,ea[0]=aa);ja>this.maxProj[0]&&(this.maxProj[0]=ja,ha[0]=aa);ja=Y[aa+1];ja<this.minProj[1]&&(this.minProj[1]=ja,ea[1]=aa);ja>this.maxProj[1]&&(this.maxProj[1]=ja,ha[1]=aa);ja=Y[aa+2];ja<this.minProj[2]&&(this.minProj[2]=ja,ea[2]=aa);ja>this.maxProj[2]&&(this.maxProj[2]=ja,ha[2]=aa);ja=Y[aa]+Y[aa+1]+Y[aa+2];ja<this.minProj[3]&&(this.minProj[3]=ja,
ea[3]=aa);ja>this.maxProj[3]&&(this.maxProj[3]=ja,ha[3]=aa);ja=Y[aa]+Y[aa+1]-Y[aa+2];ja<this.minProj[4]&&(this.minProj[4]=ja,ea[4]=aa);ja>this.maxProj[4]&&(this.maxProj[4]=ja,ha[4]=aa);ja=Y[aa]-Y[aa+1]+Y[aa+2];ja<this.minProj[5]&&(this.minProj[5]=ja,ea[5]=aa);ja>this.maxProj[5]&&(this.maxProj[5]=ja,ha[5]=aa);ja=Y[aa]-Y[aa+1]-Y[aa+2];ja<this.minProj[6]&&(this.minProj[6]=ja,ea[6]=aa);ja>this.maxProj[6]&&(this.maxProj[6]=ja,ha[6]=aa)}for(aa=0;7>aa;++aa)ja=ea[aa],p(this.minVert[aa],Y,ja),ja=ha[aa],p(this.maxVert[aa],
Y,ja)}}class da{constructor(){this.b0=m.fromValues(1,0,0);this.b1=m.fromValues(0,1,0);this.b2=m.fromValues(0,0,1);this.quality=0}}a.computeOBB=function(aa,ea){const {data:ha,size:Y}=aa;var Z=ha.length/Y;if(!(0>=Z)){var ja=new fa(aa);r(v,ja.minProj,ja.maxProj);w(v,v,.5);x(y,ja.maxProj,ja.minProj);var oa=f(y),qa=new da;qa.quality=oa;14>Z&&(aa=new g.Vertices(new Float64Array(ja.buffer,112,42),3));var ta=m.create(),va=m.create(),Ca=m.create();Z=m.create();var ma=m.create(),wa=m.create(),Ba=m.create();
var pa=aa;var Aa=u(ja.maxVert[0],ja.minVert[0]),ra=0;for(var ua=1;7>ua;++ua){const Ma=u(ja.maxVert[ua],ja.minVert[ua]);Ma>Aa&&(Aa=Ma,ra=ua)}p(ta,ja.minVert[ra]);p(va,ja.maxVert[ra]);if(1E-6>u(ta,va))pa=1;else{x(Z,ta,va);q(Z,Z);const {data:Ma,size:Ua}=pa;ja=Number.NEGATIVE_INFINITY;Aa=0;for(ra=0;ra<Ma.length;ra+=Ua)B[0]=Ma[ra]-ta[0],B[1]=Ma[ra+1]-ta[1],B[2]=Ma[ra+2]-ta[2],ua=Z[0]*B[0]+Z[1]*B[1]+Z[2]*B[2],ua=B[0]*B[0]+B[1]*B[1]+B[2]*B[2]-ua*ua/(Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]),ua>ja&&(ja=ua,Aa=ra);p(Ca,
Ma,Aa);1E-6>ja?pa=2:(x(ma,va,Ca),q(ma,ma),x(wa,Ca,ta),q(wa,wa),t(Ba,ma,Z),q(Ba,Ba),e(pa,Ba,Z,ma,wa,qa),pa=0)}switch(pa){case 1:ea.center=v;ea.halfSize=k.scale(y,y,.5);ea.quaternion=n.IDENTITY;return;case 2:oa=aa;p(R,Z);Math.abs(Z[0])>Math.abs(Z[1])&&Math.abs(Z[0])>Math.abs(Z[2])?R[0]=0:Math.abs(Z[1])>Math.abs(Z[2])?R[1]=0:R[2]=0;1E-6>R[0]*R[0]+R[1]*R[1]+R[2]*R[2]&&(R[0]=R[1]=R[2]=1);t(O,Z,R);q(O,O);t(T,Z,O);q(T,T);c(oa,Z,O,T,Q,V);x(U,V,Q);l(Z,O,T,Q,V,U,ea);return}pa=aa;ja=z;const {data:Ea,size:Ka}=
pa;p(G,Ea);p(D,G);ja[0]=P[0]*Ba[0]+P[1]*Ba[1]+P[2]*Ba[2];ja[1]=ja[0];for(Aa=Ka;Aa<Ea.length;Aa+=Ka)ra=Ea[Aa]*Ba[0]+Ea[Aa+1]*Ba[1]+Ea[Aa+2]*Ba[2],ra<ja[0]&&(ja[0]=ra,p(G,Ea,Aa)),ra>ja[1]&&(ja[1]=ra,p(D,Ea,Aa));Ba=ta[0]*Ba[0]+ta[1]*Ba[1]+ta[2]*Ba[2];z[1]-1E-6<=Ba&&(D[0]=void 0);z[0]+1E-6>=Ba&&(G[0]=void 0);void 0!==D[0]&&(x(A,D,ta),q(A,A),x(C,D,va),q(C,C),x(E,D,Ca),q(E,E),t(I,C,Z),q(I,I),t(H,E,ma),q(H,H),t(J,A,wa),q(J,J),e(pa,I,Z,C,A,qa),e(pa,H,ma,E,C,qa),e(pa,J,wa,A,E,qa));void 0!==G[0]&&(x(A,G,ta),
q(A,A),x(C,G,va),q(C,C),x(E,G,Ca),q(E,E),t(I,C,Z),q(I,I),t(H,E,ma),q(H,H),t(J,A,wa),q(J,J),e(pa,I,Z,C,A,qa),e(pa,H,ma,E,C,qa),e(pa,J,wa,A,E,qa));c(aa,qa.b0,qa.b1,qa.b2,Q,V);aa=m.create();x(aa,V,Q);qa.quality=f(aa);qa.quality<oa?l(qa.b0,qa.b1,qa.b2,Q,V,aa,ea):(ea.center=v,ea.halfSize=k.scale(y,y,.5),ea.quaternion=n.IDENTITY)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(a){class b{constructor(h,k,
m=k){this.data=h;this.size=k;this.stride=m}}class n extends b{constructor(h,k,m,g=!1,e=m){super(h,m,e);this.indices=k;this.exclusive=g}}a.Attribute=n;a.Vertices=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/Extent ../geometry/projection/projectPointToVector ../geometry/projection/projectVectorToVector ../views/3d/support/cameraUtilsInternal".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(D,G,A,C=c.createDirectionUp()){const {direction:E,up:I}=C;n.fromZRotation(u,-b.deg2rad(G));n.rotateX(u,u,b.deg2rad(A));k.transformMat4(E,q,u);k.scale(E,E,-1);k.transformMat4(I,t,u);return C}function f(D,G,A,C){return c.directionToHeadingTilt(G,A,C,q,t)}function r(D,G,A,C){const E=l(D,A,C),I=m.create();k.scale(I,E.direction,-G);k.add(I,I,D);return{up:E.up,eye:I,heading:A,tilt:C}}function x(D){return b.rad2deg(D)}function w(D){return b.deg2rad(D)}function p(D,
G,A,C,E){const I=D.renderSpatialReference;D=D.map&&D.spatialReference||G.spatialReference;e.projectPointToVector(G,v,I);e.projectPointToVector(G,y,I);v[0]-=A/2;y[0]+=A/2;v[1]-=C/2;y[1]+=C/2;d.projectVectorToVector(v,I,v,D);d.projectVectorToVector(y,I,y,D);E?(E.xmin=v[0],E.ymin=v[1],E.xmax=y[0],E.ymax=y[1],E.spatialReference=D):E=new g(v[0],v[1],y[0],y[1],D);return E}const t=m.fromValues(0,1,0),q=m.fromValues(0,0,1),u=h.create(),v=m.create(),y=m.create();h=Object.freeze(Object.defineProperty({__proto__:null,
directionToHeadingTilt:f,eyeForCenterWithHeadingTilt:r,eyeTiltToLookAtTilt:w,headingTiltToDirectionUp:l,lookAtTiltToEyeTilt:x,toExtent:p},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=h;a.directionToHeadingTilt=f;a.eyeForCenterWithHeadingTilt=r;a.eyeTiltToLookAtTilt=w;a.headingTiltToDirectionUp=l;a.lookAtTiltToEyeTilt=x;a.toExtent=p})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b,n,h){const k=h.create(),m=h.create();a.createDirectionUp=function(){return{direction:h.create(),up:h.create()}};a.directionToHeadingTilt=function(g,e,d,c,l){let f=n.normalize(k,g),r=n.dot(f,c);const x=0<r;r=Math.abs(r);.99<r&&(r=Math.abs(n.dot(e,c)),.99>r?(n.copy(f,e),x&&n.scale(f,f,-1)):f=null);e=0;f&&(n.scale(m,c,n.dot(c,f)),n.subtract(f,f,m),e=n.dot(f,l)/(n.length(f)*n.length(l)),n.cross(m,f,l),e=(0<n.dot(m,c)?1:-1)*b.rad2deg(b.acosClamped(e)));g=b.rad2deg(b.acosClamped(-n.dot(c,g)/
n.length(g)));if(!d)return{heading:e,tilt:g};d.heading=e;d.tilt=g;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(H,J,B,z=f.createDirectionUp()){m.cross(E,H,D);0===m.dot(E,E)&&m.cross(E,H,G);h.fromRotation(C,-n.deg2rad(J),H);h.rotate(C,C,-n.deg2rad(B),E);const {up:K,direction:L}=z;m.cross(K,E,H);m.normalize(K,K);m.transformMat4(K,K,C);m.normalize(L,H);m.negate(L,L);m.transformMat4(L,L,C);return z}function w(H,J,B,z){const K=E,L=I;m.normalize(K,H);m.cross(I,K,D);0===m.dot(I,I)&&m.cross(I,K,G);m.cross(L,I,K);return f.directionToHeadingTilt(J,B,z,K,L)}function p(H,
J,B,z){const K={eye:g.create(),up:null,tilt:z,heading:B},L=E;L[0]=H[0];L[1]=H[2];L[2]=-H[1];B=n.deg2rad(B);var F=n.deg2rad(z);z=Math.sin(B);B=Math.cos(B);var M=Math.sin(F),S=Math.cos(F);const N=m.length(L);if(1E-8>Math.abs(F))F=J+N;else{var P=N/M,R=n.asinClamped(J/P);F=P*Math.sin(Math.PI-F-R)}S*=J;P=J*J*M*M;R=B*B*P;const O=F-S,T=O*O;var Q=R*(R+T-L[1]*L[1]);if(0>Q)return m.scale(K.eye,L,F/N),K.tilt=0,q(K,H);var V=Math.sqrt(Q);const U=L[1]*O;Q=R+T;V=0<B?-V+U:V+U;if(1E-8>Math.abs(Q))return 1E-8>N?(K.eye[0]=
0,K.eye[1]=0,K.eye[2]=J):m.scale(K.eye,L,F/N),K.tilt=0,t(K.eye),q(K,H);K.eye[1]=V/Q;J*=M;V=K.eye[1]*K.eye[1];M=1-V;Q=Math.sqrt(M);P=R*V+z*z*P-2*B*J*K.eye[1]*Q*O+M*T;if(1E-8>Math.abs(P))return m.scale(K.eye,L,F/N),K.tilt=0,t(K.eye),q(K,H);K.eye[0]=(M*(F*L[0]-S*L[0])-J*Q*(L[0]*K.eye[1]*B+L[2]*z))/P;K.eye[2]=(M*(F*L[2]-S*L[2])-J*Q*(L[2]*K.eye[1]*B-L[0]*z))/P;m.scale(K.eye,K.eye,F);t(K.eye);return q(K,H)}function t(H){const J=H[1];H[1]=-H[2];H[2]=J}function q(H,J){J=x(J,H.heading,H.tilt);H.up=J.up;return H}
function u(H,J,B){J=m.length(J);B=n.asinClamped(B/(Math.sqrt(B*B+J*J-2*B*J*Math.cos(Math.PI-H))/Math.sin(H)));return n.rad2deg(H-B)}function v(H,J,B){H=n.deg2rad(H);J=m.length(J);return n.asinClamped(B/(J/Math.sin(H)))+H}function y(H,J,B,z,K){function L(N){const P=Math.PI/2;N=b.cyclical2PI.normalize(N,-P);N>P&&(N=Math.PI-N);return N}var F=J.latitude;var M=e.getReferenceEllipsoid(H.spatialReference).radius;J=J.longitude;var S=r.getLonDeltaForDistance(F,B,M)/2;B=J-S;J+=S;F=n.deg2rad(F);F=(1+Math.sin(F))/
(1-Math.sin(F));S=(F+1)*Math.tan(z/M/2);F=1.5*Math.PI-2*Math.atan(.5*(S+Math.sqrt(4*F+S*S)));z=F+z/M;F=L(F);z=L(z);z<F&&(M=z,z=F,F=M);F=Math.max(n.rad2deg(F),-90);z=Math.min(n.rad2deg(z),90);J=A.monotonic(B,J);180<J-B&&(M=(J-B-180)/2,B+=M,J-=M);M=H.spatialReference&&H.spatialReference.isGeographic?H.spatialReference:c.WGS84;K?(K.xmin=B,K.ymin=F,K.xmax=J,K.ymax=z,K.spatialReference=M):K=new d(B,F,J,z,M);H.spatialReference&&H.spatialReference.isWebMercator&&l.geographicToWebMercator(K,!1,K);return K}
const D=g.fromValues(0,0,1),G=m.normalize(g.create(),g.fromValues(1,1,1)),A=new b.Cyclical(-180,180),C=k.create(),E=g.create(),I=g.create();k=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:w,eyeForCenterWithHeadingTilt:p,eyeTiltToLookAtTilt:v,headingTiltToDirectionUp:x,lookAtTiltToEyeTilt:u,toExtent:y},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=k;a.directionToHeadingTilt=w;a.eyeForCenterWithHeadingTilt=p;a.eyeTiltToLookAtTilt=v;a.headingTiltToDirectionUp=
x;a.lookAtTiltToEyeTilt=u;a.toExtent=y})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(a,b,n,h){function k(e,d,c){if(null==d.longitude||null==d.latitude||null==c.longitude||null==c.latitude)throw Error("Invalid points: no lon/lat");return m(e,d.longitude,d.latitude,c.longitude,c.latitude)}function m(e,d,c,l,f){c=b.deg2rad(c);f=b.deg2rad(f);d=b.deg2rad(d);const r=b.deg2rad(l);l=Math.sin((c-
f)/2);d=Math.sin((d-r)/2);c=2*b.asinClamped(Math.sqrt(l*l+Math.cos(c)*Math.cos(f)*d*d));return Math.round(c*e*1E4)/1E4}function g(e,d){e/=15;d||(e=Math.round(e));return e}a.getGreatCircleDistance=m;a.getGreatCircleDistanceFromPoints=k;a.getGreatCircleSpanAt=function(e,d,c){const l=d.spatialReference,f=n.getReferenceEllipsoid(l),r=new h(d.x,e.y,l),x=new h(c.x,e.y,l);d=new h(e.x,d.y,l);e=new h(e.x,c.y,l);return{lon:k(f.radius,r,x),lat:k(f.radius,d,e)}};a.getLonDeltaForDistance=function(e,d,c){d/=c;
e=b.deg2rad(e);d=Math.sin(d/2);e=Math.cos(e);e=2*b.asinClamped(Math.sqrt(d*d/(e*e)));return b.rad2deg(e)};a.longitudeToTimezone=g;a.positionToTimezoneInfo=function(e,d){e=e?.[0];if(null==e)return null;d||={hours:0,minutes:0,seconds:0};d.hours=g(e,!0);e=d.hours%1;d.hours-=e;d.minutes=60*e;e=d.minutes%1;d.minutes-=e;d.seconds=Math.round(60*e);return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatureUtils"],
function(a,b){function n(k){return"array"in k}class h{constructor(k,m=null,g=0){this.array=k;this.spatialReference=m;this.offset=g}}a.SamplePosition=h;a.getElevationAtPoint=function(k,m,g="ground"){if(b.isDehydratedPoint(m))return k.getElevation(m.x,m.y,m.z||0,m.spatialReference,g);if(n(m)){let e=m.offset;return k.getElevation(m.array[e++],m.array[e++],m.array[e]||0,m.spatialReference??k.spatialReference,g)}return k.getElevation(m[0],m[1],m[2]||0,k.spatialReference,g)};a.isSamplePosition=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,n){a.isSpatialReferenceSupported=function(h,k){return null==h?!1:null==k?!0:k===n.ViewingMode.Local?h.isGeographic?
h.isWGS84||h.wkid===b.SupportedGCSWkids.CGCS2000:!0:h.isWebMercator||h.isWGS84||h.wkid===b.SupportedGCSWkids.CGCS2000||h.wkid===b.SupportedGCSWkids.GCSMARS2000||h.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||h.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){b=class extends b.EventedAccessor{constructor(r){super(r);this.demResolution={min:-1,max:-1};this.noDataValue=f.elevationNodataValue}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const r=this.view.basemapTerrain;if(null==r?.extent||null==r.spatialReference)return null;const x=d.toExtent(r.extent,r.spatialReference);x.zmin=r.visibleElevationBounds.min;x.zmax=r.visibleElevationBounds.max;return x}get spatialReference(){return this.view.basemapTerrain?.spatialReference??
e.WGS84}elevationAt(r,x){if(null==this.extent||!c.extentContainsXYZ(this.extent,r,x)){const w=null!=this.extent?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;n.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${r}, ${x}) is outside of the sampler extent (${w})`);return this.noDataValue}return this.view.elevationProvider?.getElevation(r,x,0,this.spatialReference,"ground")??this.noDataValue}queryElevation(r){return l.updateGeometryElevation(r.clone(),
this)}};a.__decorate([h.property({readOnly:!0})],b.prototype,"demResolution",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,"extent",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"noDataValue",void 0);a.__decorate([h.property()],b.prototype,"spatialReference",null);a.__decorate([h.property({constructOnly:!0})],b.prototype,"view",void 0);return b=a.__decorate([g.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../geometry ../../core/has ../../core/handleUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(t,q){const u=l(t,q.spatialReference);if(!u)return null;switch(t.type){case "point":t.z=q.elevationAt(u.x,u.y);break;case "polyline":p.spatialReference=u.spatialReference;var v=t.hasM&&!t.hasZ;for(var y=0;y<t.paths.length;y++){var D=t.paths[y],G=u.paths[y];for(let A=0;A<D.length;A++){const C=D[A],E=G[A];p.x=E[0];p.y=E[1];v&&(C[3]=C[2]);C[2]=q.elevationAt(p.x,p.y)}}t.hasZ=!0;break;case "multipoint":p.spatialReference=u.spatialReference;v=t.hasM&&!t.hasZ;for(y=
0;y<t.points.length;y++)D=t.points[y],G=u.points[y],p.x=G[0],p.y=G[1],v&&(D[3]=D[2]),D[2]=q.elevationAt(p.x,p.y);t.hasZ=!0}return t}function l(t,q){if(null==t)return null;const u=t.spatialReference;if(u.equals(q))return t;(t=e.project(t,q))||f().error(`Cannot project geometry spatial reference (wkid:${u.wkid}) to elevation sampler spatial reference (wkid:${q.wkid})`);return t}const f=()=>k.getLogger("esri.layers.support.ElevationSampler");class r{queryElevation(t){return c(t.clone(),this)}on(){return h.makeHandle()}projectIfRequired(t,
q){return l(t,q)}}class x extends r{get spatialReference(){return this.extent.spatialReference}constructor(t,q,u){super();this.tile=t;this.noDataValue=u;u=t.tile.extent;this.extent=g.toExtent(u,q.spatialReference);this.extent.zmin=t.zmin;this.extent.zmax=t.zmax;this._aaExtent=u;u=m.getMetersPerUnitForSR(q.spatialReference);t=q.lodAt(t.tile.level).resolution*u;this.demResolution={min:t,max:t}}contains(t){t=this.projectIfRequired(t,this.spatialReference);return null==t?!1:this.containsAt(t.x,t.y)}containsAt(t,
q){return g.containsXY(this._aaExtent,t,q)}elevationAt(t,q){if(!this.containsAt(t,q)){var u=this.extent;u=`${u.xmin}, ${u.ymin}, ${u.xmax}, ${u.ymax}`;f().warn("#elevationAt()",`Point used to sample elevation (${t}, ${q}) is outside of the sampler extent (${u})`);return this.noDataValue}return this.tile.sample(t,q)??this.noDataValue}}class w extends r{get spatialReference(){return this.extent.spatialReference}constructor(t,q,u){super();let v;"number"===typeof q?(this.noDataValue=q,v=null):(v=q,this.noDataValue=
u);this.samplers=v?t.map(y=>new x(y,v,this.noDataValue)):t;if(t=this.samplers[0]){this.extent=t.extent.clone();const {min:y,max:D}=t.demResolution;this.demResolution={min:y,max:D};for(t=1;t<this.samplers.length;t++)q=this.samplers[t],this.extent.union(q.extent),this.demResolution.min=Math.min(this.demResolution.min,q.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,q.demResolution.max)}else this.extent=g.toExtent(g.create(),v.spatialReference),this.demResolution={min:0,max:0}}elevationAt(t,
q){let u,v=!1;for(const y of this.samplers)if(y.containsAt(t,q)&&(v=!0,u=y.elevationAt(t,q),u!==y.noDataValue))return u;if(null!=u)return u;v||f().warn("#elevationAt()",`Point used to sample elevation (${t}, ${q}) is outside of the sampler`);return this.noDataValue}}const p=new d;a.ElevationSamplerBase=r;a.MultiTileElevationSampler=w;a.TileElevationSampler=x;a.updateGeometryElevation=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports",
"../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,n,h){b=b.clampFloat32(b.numberMaxFloat32/10);const k=n.create();h.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,k);n=n.create([-180,-90,180,90]);let m=3;a.elevationNodataValue=b;a.geographicWorldExtent=n;a.getElevationDesiredResolutionLevel=function(g){return 4>g?3:m};a.maxMemoryLodBias=2.5;a.maxPatchTesselation=512;a.maxRootTiles=64;a.maxTileNeighborLevelDelta=4;a.progressiveLoadingModulo=
2;a.test={setElevationDesiredMaxUpscalingDistance(g){m=null==g?3:g}};a.tooManyRootTilesAfterChangeError="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.tooManyRootTilesForLayerError="Surface extent is too large for tile resolution at level 0.";a.webmercatorWorldExtent=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}class p{constructor(q){var u=p.checkUnsupported(q);if(null!=u)throw u;this.spatialReference=q.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=g.canProjectToWGS84ComparableLonLat(this.spatialReference)||c.isMars(this.spatialReference)||c.isMoon(this.spatialReference);this.origin=[q.origin.x,q.origin.y];this.pixelSize=q.size[0];
this.dpi=q.dpi;var v=q.lods.reduce((G,A,C)=>{A.level<G.min&&(G.min=A.level,G.minIndex=C);G.max=Math.max(G.max,A.level);return G},{min:Infinity,minIndex:0,max:-Infinity}),y=q.lods[v.minIndex];const D=2**y.level;u=y.resolution*D;y=y.scale*D;this.levels=Array(v.max+1);for(v=0;v<this.levels.length;v++)this.levels[v]={resolution:u,scale:y,tileSize:[u*q.size[0],u*q.size[1]]},u/=2,y/=2}clone(){return new p(this.toTileInfo())}toTileInfo(){return new r({dpi:this.dpi,origin:new x({x:this.origin[0],y:this.origin[1],
spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((q,u)=>new f({level:u,scale:q.scale,resolution:q.resolution}))})}getExtent(q,u,v,y){var D=this.levels[q];q=D.tileSize[0];D=D.tileSize[1];y[0]=this.origin[0]+v*q;y[2]=this.origin[0]+(v+1)*q;y[3]=this.origin[1]-u*D;y[1]=this.origin[1]-(u+1)*D}convertExtentToRadians(q,u){this._isWebMercator?(u[0]=l.x2lon(q[0]),u[1]=l.y2lat(q[1]),u[2]=l.x2lon(q[2]),u[3]=l.y2lat(q[3])):
this._isGCS&&(u[0]=h.deg2rad(q[0]),u[1]=h.deg2rad(q[1]),u[2]=h.deg2rad(q[2]),u[3]=h.deg2rad(q[3]))}getExtentGeometry(q,u,v,y=new m){this.getExtent(q,u,v,t);y.spatialReference=this.spatialReference;y.xmin=t[0];y.ymin=t[1];y.xmax=t[2];y.ymax=t[3];y.zmin=void 0;y.zmax=void 0;return y}ensureMaxLod(q){if(null==q)return!1;for(var u=!1;this.levels.length<=q;){u=this.levels[this.levels.length-1];const v=u.resolution/2;this.levels.push({resolution:v,scale:u.scale/2,tileSize:[v*this.pixelSize,v*this.pixelSize]});
u=!0}return u}capMaxLod(q){this.levels.length>q+1&&(this.levels.length=q+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(q){return this.levels[0].scale/2**q}levelAtScale(q){const u=this.levels[0].scale;return q>=u?0:Math.log(u/q)*Math.LOG2E}resolutionAtLevel(q){return this.levels[0].resolution/2**q}compatibleWith(q){if(!(q instanceof p)){if(p.checkUnsupported(q))return!1;q=new p(q)}if(!q.spatialReference.equals(this.spatialReference)||q.pixelSize!==this.pixelSize)return!1;const u=Math.min(this.levels.length,
q.levels.length)-1,v=this.levels[u].resolution;let y=.5*v;if(!h.floatEqualAbsolute(q.origin[0],this.origin[0],y)||!h.floatEqualAbsolute(q.origin[1],this.origin[1],y))return!1;y=.5*v/2**u/this.pixelSize*12;return h.floatEqualAbsolute(v,q.levels[u].resolution,y)}rootTilesInExtent(q,u=null,v=Infinity){const y=[],D=this.levels[0].tileSize;if(null==q||0===D[0]||0===D[1])return y;p.computeRowColExtent(q,D,this.origin,t);q=t[1];let G=t[3],A=t[0],C=t[2];var E=C-A;const I=G-q;E*I>v&&(v=Math.floor(Math.sqrt(v)),
I>v&&(q=q+Math.floor(.5*I)-Math.floor(.5*v),G=q+v),E>v&&(A=A+Math.floor(.5*E)-Math.floor(.5*v),C=A+v));for(v=q;v<G;v++)for(E=A;E<C;E++)y.push([0,v,E]);null!=u&&(u[0]=this.origin[0]+A*D[0],u[1]=this.origin[1]-G*D[1],u[2]=this.origin[0]+C*D[0],u[3]=this.origin[1]-q*D[1]);return y}static computeRowColExtent(q,u,v,y){const D=.001*(q[2]-q[0]+(q[3]-q[1]));y[0]=Math.max(0,Math.floor((q[0]+D-v[0])/u[0]));y[2]=Math.max(0,Math.ceil((q[2]-D-v[0])/u[0]));y[1]=Math.max(0,Math.floor((v[1]-q[3]+D)/u[1]));y[3]=Math.max(0,
Math.ceil((v[1]-q[1]-D)/u[1]))}static isPowerOfTwo(q){q=q.lods;const u=q[0].resolution*2**q[0].level;return!q.some(v=>!h.floatEqualRelative(v.resolution,u/2**v.level))}static hasGapInLevels(q){q=q.lods.map(u=>u.level);q.sort((u,v)=>u-v);for(let u=1;u<q.length;u++)if(q[u]!==q[0]+u)return!0;return!1}static tileSizeSupported(q){const u=q.size[1];return u===q.size[0]&&0===(u&u-1)&&128<=u&&512>=u}static hasOriginPerLODs(q){const u=q.origin;return q.lods.some(v=>null!=v.origin&&(v.origin[0]!==u.x||v.origin[1]!==
u.y))}static getMissingTileInfoError(){return new n("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(q){return null==q?w():1>q.lods.length?new n("tilingscheme:generic","Tiling scheme must have at least one level"):p.isPowerOfTwo(q)?p.hasGapInLevels(q)?new n("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):p.tileSizeSupported(q)?p.hasOriginPerLODs(q)?new n("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):
null:new n("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new n("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(q,u){const v=q[2]-q[0],y=q[3]-q[1],D=k.getMetersPerUnitForSR(u),G=1.2*Math.max(v,y);q=new p(new r({size:[256,256],origin:new x({x:q[0]-.5*(G-v),y:q[3]+.5*(G-y)}),lods:[new f({level:0,resolution:G/256,scale:1/(256/96*.0254/(G*D))})],spatialReference:u}));q.ensureMaxLod(20);return q}static makeWebMercatorAuxiliarySphere(q){const u=
new p(p.WebMercatorAuxiliarySphereTileInfo);u.ensureMaxLod(q);return u}static makeGCSWithTileSize(q,u=256,v=16){const y=256/u;q=new p(new r({size:[u,u],origin:new x({x:-180,y:90,spatialReference:q}),spatialReference:q,lods:[new f({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));q.ensureMaxLod(v);return q}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}p.WebMercatorAuxiliarySphereTileInfo=new r({size:[256,256],origin:new x({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:e.WebMercator}),spatialReference:e.WebMercator,lods:[new f({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});p.WebMercatorAuxiliarySphere=p.makeWebMercatorAuxiliarySphere(19);const t=d.create();a.TilingScheme=p;a.getMissingTileInfoError=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){var e;b=e=class extends b.JSONSupport{constructor(d){super(d);this.cols=null;this.level=0;this.origin=this.levelValue=null;this.resolution=0;this.rows=null;this.scale=0}clone(){return new e({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"cols",void 0);a.__decorate([n.property({type:h.Integer,
json:{write:!0}})],b.prototype,"level",void 0);a.__decorate([n.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);a.__decorate([n.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,
"rows",void 0);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=e=a.__decorate([g.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TileInfo":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){var u;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});n=u=class extends n.JSONSupport{static create(v={}){const {resolutionFactor:y=1,scales:D,size:G=256,spatialReference:A=r.WebMercator,numLODs:C=24}=v;if(!w.isValid(A)){v=[];if(D)for(var E=0;E<D.length;E++){var I=
D[E];v.push(new t({level:E,scale:I,resolution:I}))}else for(E=5E-4,I=C-1;0<=I;I--)v.unshift(new t({level:I,scale:E,resolution:E})),E*=2;return new u({dpi:96,lods:v,origin:new f(0,0,A),size:[G,G],spatialReference:A})}E=w.getInfo(A);v=v.origin?new f({x:v.origin.x,y:v.origin.y,spatialReference:A}):E?new f({x:E.origin[0],y:E.origin[1],spatialReference:A}):new f({x:0,y:0,spatialReference:A});E=1/(39.37*h.getMetersPerUnitForSR(A)*96);I=[];if(D)for(var H=0;H<D.length;H++){var J=D[H];I.push(new t({level:H,
scale:J,resolution:J*E}))}else{var B=w.isGeographic(A)?512/G*5.916575275917094E8:256/G*5.91657527591555E8;H=Math.ceil(C/y);I.push(new t({level:0,scale:B,resolution:B*E}));for(J=1;J<H;J++)B/=2**y,I.push(new t({level:J,scale:B,resolution:B*E}))}return new u({dpi:96,lods:I,origin:v,size:[G,G],spatialReference:A})}constructor(v){super(v);this.dpi=96;this.spatialReference=this.size=this.origin=this.format=null}get isWrappable(){const {spatialReference:v,origin:y}=this;if(v&&y){const D=w.getInfo(v);return v.isWrappable&&
!!D&&Math.abs(D.origin[0]-y.x)<=D.dx}return!1}readOrigin(v,y){return f.fromJSON({spatialReference:y.spatialReference,...v})}set lods(v){const y=[],D=this._levelToLOD={};v&&v.forEach(G=>{y.push(G.scale);D[G.level]=G});this._set("scales",y);this._set("lods",v);this._initializeUpsampleLevels()}readSize(v,y){return[y.cols,y.rows]}writeSize(v,y){y.cols=v[0];y.rows=v[1]}zoomToScale(v){const y=this.scales;if(0>=v)return y[0];if(v>=y.length-1)return y[y.length-1];const D=Math.floor(v);return y[D]/(y[D]/y[D+
1])**(v-D)}scaleToZoom(v){const y=this.scales,D=y.length-1;let G=0;for(;G<D;G++){const A=y[G],C=y[G+1];if(A<=v)break;if(C===v)return G+1;if(A>v&&C<v)return G+Math.log(A/v)/Math.log(A/C)}return G}snapScale(v,y=.95){v=this.scaleToZoom(v);return v%Math.floor(v)>=y?this.zoomToScale(Math.ceil(v)):this.zoomToScale(Math.floor(v))}tileAt(v,y,D,G){var A=this.lodAt(v);if(!A)return null;let C;if("number"===typeof y)C=y,y=D;else{if(w.equals(y.spatialReference,this.spatialReference))C=y.x,y=y.y;else{G=p.project(y,
this.spatialReference);if(null==G)return null;C=G.x;y=G.y}G=D}D=A.resolution*this.size[0];A=A.resolution*this.size[1];G||=new q.TileKey(null,0,0,0,x.create());G.level=v;G.row=Math.floor((this.origin.y-y)/A+.001);G.col=Math.floor((C-this.origin.x)/D+.001);this.updateTileInfo(G);return G}updateTileInfo(v,y=u.ExtrapolateOptions.NONE){var D=this.lodAt(v.level);D||y!==u.ExtrapolateOptions.POWER_OF_TWO||(y=this.lods[this.lods.length-1],y.level<v.level&&(D=y));if(D){var G=v.level-D.level;y=D.resolution*
this.size[0]/2**G;D=D.resolution*this.size[1]/2**G;v.id=`${v.level}/${v.row}/${v.col}`;v.extent||(v.extent=x.create());v.extent[0]=this.origin.x+v.col*y;v.extent[1]=this.origin.y-(v.row+1)*D;v.extent[2]=v.extent[0]+y;v.extent[3]=v.extent[1]+D}}upsampleTile(v){const y=this._upsampleLevels[v.level];if(!y||-1===y.parentLevel)return!1;v.level=y.parentLevel;v.row=Math.floor(v.row/y.factor+.001);v.col=Math.floor(v.col/y.factor+.001);this.updateTileInfo(v);return!0}getTileBounds(v,y){var D=this.lodAt(y.level);
if(null==D)return null;var {resolution:G}=D;D=G*this.size[0];G*=this.size[1];v[0]=this.origin.x+y.col*D;v[1]=this.origin.y-(y.row+1)*G;v[2]=v[0]+D;v[3]=v[1]+G;return v}lodAt(v){return this._levelToLOD?.[v]??null}clone(){return u.fromJSON(this.write({}))}getOrCreateCompatible(v,y){if(256===this.size[0]&&256===this.size[1])return 256===v?this:null;const D=[],G=this.lods.length;for(let A=0;A<G;A++){const C=this.lods[A];D.push(new t({level:C.level,scale:C.scale,resolution:C.resolution*y}))}return new u({size:[v,
v],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:D})}_initializeUpsampleLevels(){const v=this.lods;this._upsampleLevels=[];let y=null;for(let D=0;D<v.length;D++){const G=v[D];this._upsampleLevels[G.level]={parentLevel:y?y.level:-1,factor:y?y.resolution/G.resolution:0};y=G}}};a.__decorate([k.property({type:Number,json:{write:!0}})],n.prototype,"compressionQuality",void 0);a.__decorate([k.property({type:Number,
json:{write:!0}})],n.prototype,"dpi",void 0);a.__decorate([k.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],n.prototype,"format",void 0);a.__decorate([k.property({readOnly:!0})],n.prototype,"isWrappable",null);a.__decorate([k.property({type:f,json:{write:!0}})],n.prototype,"origin",void 0);a.__decorate([d.reader("origin")],n.prototype,"readOrigin",null);a.__decorate([k.property({type:[t],value:null,json:{write:!0}})],n.prototype,"lods",null);a.__decorate([k.property({readOnly:!0})],
n.prototype,"scales",void 0);a.__decorate([k.property({cast:v=>Array.isArray(v)?v:"number"===typeof v?[v,v]:[256,256]})],n.prototype,"size",void 0);a.__decorate([d.reader("size",["rows","cols"])],n.prototype,"readSize",null);a.__decorate([l.writer("size",{cols:{type:m.Integer},rows:{type:m.Integer}})],n.prototype,"writeSize",null);a.__decorate([k.property({type:r,json:{write:!0}})],n.prototype,"spatialReference",void 0);n=u=a.__decorate([c.subclass("esri.layers.support.TileInfo")],n);(function(v){v=
v.ExtrapolateOptions||(v.ExtrapolateOptions={});v[v.NONE=0]="NONE";v[v.POWER_OF_TWO=1]="POWER_OF_TWO"})(n||={});return n})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){class b{constructor(n,h,k,m,g){this.id=n;this.level=h;this.row=k;this.col=m;this.extent=g}}a.TileKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("require exports ../chunks/tslib.es6 ../core/asyncUtils ../core/deprecate ../core/Error ../core/has ../core/Logger ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./input/InputManager".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(u){return null!=u&&"open"in u&&"declaredClass"in u}function p(u){return null!=u&&"declaredClass"in u&&"dockOptions"in u}const t=u=>Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}));class q{constructor(u){this.layerView=u;this._resolver=d.createResolver();this.graphics=[]}get promise(){return this._resolver.promise}resolve(u){const {layerView:v,graphics:y,_resolver:D}=this;if(!v)return D.resolve(y),
D.promise;let G;v.fetchPopupFeaturesFromGraphics(y,u).catch(A=>{G=A;return null}).then(A=>{A?D.resolve(A):D.reject(G)});return D.promise}}b.PopupView=u=>{u=class extends u{constructor(){super(...arguments);this._popupSetupTask=null;this.popup={};this.popupEnabled=!0}initialize(){this.addHandles([c.watch(()=>[this.ui,this.popup],([v,y],D)=>{if(D){const [G,A]=D;G&&w(A)&&(A.view=null,p(A)&&G.remove(A,"popup"))}v&&w(y)&&(y.view=this,p(y)&&v.add(y,{key:"popup",position:"manual",internal:!0}))},c.initial),
this.on("click",v=>{this.popup&&this.popupEnabled&&("mouse"!==v.pointerType||0===v.button)&&(!w(this.popup)&&"autoOpenEnabled"in this.popup&&!1===this.popup.autoOpenEnabled||(w(this.popup)?this.popup.viewModel.handleViewClick(v):v.async(async()=>{await this.setupPopup();w(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(v)})))},x.ViewEventPriorities.WIDGET)]);c.whenOnce(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{new Promise((v,y)=>
a(["../widgets/Popup"],D=>v(t(D)),y))})}destroy(){this.destroyed||this.closePopup()}async openPopup(v){if(w(this.popup))return this.popup.open(v);try{await this.setupPopup(),this.popup?this.popup.open(v):e.getLogger(this).error(new m("view:null-popup","Popup is null and can't be opened"))}catch{}}closePopup(){this._popupSetupTask?.abort();w(this.popup)&&this.popup.close()}async fetchPopupFeatures(v,y){await this.when();return this._popupHitsToFeatures(await this._getPopupHits(v,y),y)}async setupPopup(){this._popupSetupTask?.abort();
if(this.popup&&!w(this.popup))return this._popupSetupTask=h.createTask(async v=>{const {default:y}=await new Promise((D,G)=>a(["../widgets/Popup"],A=>D(t(A)),G));d.throwIfAborted(v);this.popup&&!w(this.popup)&&(v=this.popup,delete v.open,delete v.close,this.popup=new y(v))}),this._popupSetupTask.promise}async _popupHitsToFeatures({location:v,hits:y},D){const G=[],A=[];let C=!1;const E=d.wrapAbortWithTimeout(D,g("popup-view-fetch-timeout")??5E3);D=I=>{const H=A.at(-1);H&&H.layerView===I&&!C?I=H:(I=
new q(I),A.push(I),G.push(I.promise));return I};for(const I of y)"graphic"in I?(D(I.layerView).graphics.push(I.graphic),C=!1):(G.push(I.layerView.fetchPopupFeaturesAtLocation(I.mapPoint,E)),C=!0);A.map(I=>I.resolve(E));y=d.allSettledValues(G).then(I=>I.filter(H=>!!H).flat());return{pendingFeatures:G,allGraphicsPromise:y,location:v}}async _getPopupHits(v,y){const {hits:D,location:G}=await this.popupHitTest(v);d.throwIfAborted(y);v=[];for(const A of D)if("graphic"in A){if(this._isValidPopupGraphic(A.graphic,
y)){const C=this._isValidPopupGraphicsLayerView(A.layerView)?A.layerView:void 0;v.push({graphic:A.graphic,layerView:C})}}else this._isValidPopupLocationLayerView(A.layerView)&&v.push({mapPoint:A.mapPoint,layerView:A.layerView});return{hits:v,location:G}}_isValidPopupGraphic(v,y){return v&&!!v.getEffectivePopupTemplate(null!=y&&y.defaultPopupTemplateEnabled)}_isValidPopupGraphicsLayerView(v){return!v||(!("layer"in v)||!v.suspended)&&"fetchPopupFeaturesFromGraphics"in v}_isValidPopupLocationLayerView(v){return(!("layer"in
v)||!v.suspended)&&"fetchPopupFeaturesAtLocation"in v}};n.__decorate([l.property({cast(v){if(!v||w(v))return v;"object"===typeof v&&(v.open=y=>{k.deprecated(e.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"});return this.openPopup(y)},v.close=()=>{k.deprecated(e.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",
{replacement:"Use view.closePopup() instead.",version:"4.27"});return this.closePopup()});return v}})],u.prototype,"popup",void 0);n.__decorate([l.property()],u.prototype,"popupEnabled",void 0);return u=n.__decorate([r.subclass("esri.views.PopupView")],u)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error"],function(a,b,n){const h=e=>Object.freeze(Object.defineProperty({__proto__:null,
default:e},Symbol.toStringTag,{value:"Module"})),k=()=>new Promise((e,d)=>a(["./layers/TileLayerView3D"],c=>e(h(c)),d)),m=()=>new Promise((e,d)=>a(["./layers/ElevationLayerView3D"],c=>e(h(c)),d)),g={"base-dynamic":()=>new Promise((e,d)=>a(["./layers/BaseDynamicLayerView3D"],c=>e(h(c)),d)),"base-elevation":m,"base-tile":k,"bing-maps":k,"building-scene":()=>new Promise((e,d)=>a(["./layers/BuildingSceneLayerView3D"],c=>e(h(c)),d)),csv:()=>new Promise((e,d)=>a(["./layers/CSVLayerView3D"],c=>e(h(c)),d)),
dimension:()=>new Promise((e,d)=>a(["./layers/DimensionLayerView3D"],c=>e(h(c)),d)),elevation:m,feature:()=>new Promise((e,d)=>a(["./layers/FeatureLayerView3D"],c=>e(h(c)),d)),geojson:()=>new Promise((e,d)=>a(["./layers/GeoJSONLayerView3D"],c=>e(h(c)),d)),graphics:()=>new Promise((e,d)=>a(["./layers/GraphicsLayerView3D"],c=>e(h(c)),d)),group:()=>new Promise((e,d)=>a(["../layers/GroupLayerView"],c=>e(h(c)),d)),imagery:()=>new Promise((e,d)=>a(["./layers/ImageryLayerView3D"],c=>e(h(c)),d)),"integrated-mesh":()=>
new Promise((e,d)=>a(["./layers/IntegratedMeshLayerView3D"],c=>e(h(c)),d)),"integrated-mesh-3dtiles":()=>new Promise((e,d)=>a(["./layers/IntegratedMesh3DTilesLayerView3D"],c=>e(h(c)),d)),"line-of-sight":()=>new Promise((e,d)=>a(["./layers/LineOfSightLayerView3D"],c=>e(h(c)),d)),"map-image":()=>new Promise((e,d)=>a(["./layers/MapImageLayerView3D"],c=>e(h(c)),d)),media:()=>new Promise((e,d)=>a(["./layers/MediaLayerView3D"],c=>e(h(c)),d)),"ogc-feature":()=>new Promise((e,d)=>a(["./layers/OGCFeatureLayerView3D"],
c=>e(h(c)),d)),"open-street-map":k,"oriented-imagery":()=>new Promise((e,d)=>a(["./layers/FeatureLayerView3D"],c=>e(h(c)),d)),"point-cloud":()=>new Promise((e,d)=>a(["./layers/PointCloudLayerView3D"],c=>e(h(c)),d)),voxel:()=>new Promise((e,d)=>a(["./layers/VoxelLayerView3D"],c=>e(h(c)),d)),route:()=>new Promise((e,d)=>a(["./layers/RouteLayerView3D"],c=>e(h(c)),d)),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?new Promise((d,c)=>a(["./layers/SceneLayerView3D"],l=>d(h(l)),c)):new Promise((d,
c)=>a(["./layers/SceneLayerGraphicsView3D"],l=>d(h(l)),c)),stream:()=>new Promise((e,d)=>a(["./layers/StreamLayerView3D"],c=>e(h(c)),d)),tile:k,"imagery-tile":()=>new Promise((e,d)=>a(["./layers/ImageryTileLayerView3D"],c=>e(h(c)),d)),"vector-tile":()=>new Promise((e,d)=>a(["./layers/VectorTileLayerView3D"],c=>e(h(c)),d)),wcs:()=>new Promise((e,d)=>a(["./layers/ImageryTileLayerView3D"],c=>e(h(c)),d)),"web-tile":k,wfs:()=>new Promise((e,d)=>a(["./layers/WFSLayerView3D"],c=>e(h(c)),d)),wms:()=>new Promise((e,
d)=>a(["./layers/WMSLayerView3D"],c=>e(h(c)),d)),wmts:()=>new Promise((e,d)=>a(["./layers/WMTSLayerView3D"],c=>e(h(c)),d)),catalog:null,"catalog-dynamic-group":null,"catalog-footprint":null,"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};b.layerView3DImporter={hasLayerViewModule:e=>null!=g[e.type],importLayerView:e=>{var d=g[e.type];if(null==d)throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+
1):"Unknown",d=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new n(`${d}:view-not-supported`,`${e} is not supported in 3D`);return d(e)}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(){const q=c.createResolver();q.promise.catch(()=>{});return q}const w=q=>Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));var p;(function(q){q[q.PENDING=0]="PENDING";q[q.CREATED=1]="CREATED"})(p||={});var t;(function(q){q[q.ADDED=0]="ADDED";q[q.REMOVED=1]="REMOVED"})(t||={});n=class extends n{constructor(q){super(q);this._allAnalysisViews=new k;this._creatingViewCount=0;this._items=new Map;this._scheduledUpdateHandle=
null;this._attachedToViewResolver=x();this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners();this._attachedToViewResolver.reject(c.createAbortError("AnalysisViewManager was destroyed"))}attach(){this._connectOwners();this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners();this._attachedToViewResolver.reject(c.createAbortError());this._attachedToViewResolver=
x()}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(q=>q.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(q){await this._attachedToViewResolver.promise;const u=this._items.get(q);if(null==u||u.state.list===t.REMOVED)throw new m("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:q});return u.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),
"analyses-owner-handles")}_disconnectOwners(){this.removeHandles("analyses-owner-handles");this._update();this._creatingViewCount=0}_connectAnalysesCollection(q){for(const y of q)this._addAnalysis(y);const u=q.on("after-add",y=>this._addAnalysis(y.item)),v=q.on("after-remove",y=>this._removeAnalysis(y.item));return g.makeHandle(()=>{u.remove();v.remove();for(const y of q)this._removeAnalysis(y)})}_addAnalysis(q){const u=this._items.get(q);if(null==u){const v={state:{view:p.PENDING,list:t.ADDED},analysis:q,
view:null,createAnalysisViewTask:null};this._items.set(q,v);v.createAnalysisViewTask=h.createTask(y=>this._createAnalysisViewPromise(v,y))}else u.state.list=t.ADDED}_removeAnalysis(q){q=this._items.get(q);null==q?e.getLogger(this).error("Trying to remove analysis which was not added"):(q.state.list=t.REMOVED,this._scheduleUpdate())}_scheduleUpdate(){null==this._scheduledUpdateHandle&&(this._scheduledUpdateHandle=l.schedule(()=>this._update()))}_update(){this._scheduledUpdateHandle=d.removeMaybe(this._scheduledUpdateHandle);
this._items.forEach(q=>{if(q.state.list===t.REMOVED)switch(this._items.delete(q.analysis),q.state.view){case p.PENDING:q.createAnalysisViewTask=d.abortMaybe(q.createAnalysisViewTask);break;case p.CREATED:null!=q.view&&(this._allAnalysisViews.remove(q.view),q.view=d.destroyMaybe(q.view),q.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(q,u){var v=q.analysis;const y=v.type,D=this._analysisModules[y];this._creatingViewCount+=1;if(null==D.module)try{D.module=await this._loadAnalysisModule(y)}catch(G){throw--this._creatingViewCount,
G;}if(c.isAborted(u))throw--this._creatingViewCount,c.createAbortError("AnalysisView creation aborted");v=new D.module.default({analysis:v,view:this.view});try{await v.when()}catch(G){throw--this._creatingViewCount,G;}if(c.isAborted(u))throw--this._creatingViewCount,v.destroy(),c.createAbortError("AnalysisView creation aborted");q.view=v;q.state.view=p.CREATED;this._allAnalysisViews.add(v);--this._creatingViewCount;return v}_loadAnalysisModule(q){switch(q){case "area-measurement":return new Promise((u,
v)=>a(["./AreaMeasurementAnalysisView3D"],y=>u(w(y)),v));case "dimension":return new Promise((u,v)=>a(["./DimensionAnalysisView3D"],y=>u(w(y)),v));case "direct-line-measurement":return new Promise((u,v)=>a(["./DirectLineMeasurementAnalysisView3D"],y=>u(w(y)),v));case "line-of-sight":return new Promise((u,v)=>a(["./LineOfSightAnalysisView3D"],y=>u(w(y)),v));case "slice":return new Promise((u,v)=>a(["./SliceAnalysisView3D"],y=>u(w(y)),v))}}};b.__decorate([f.property()],n.prototype,"updating",null);
b.__decorate([f.property({constructOnly:!0})],n.prototype,"view",void 0);b.__decorate([f.property()],n.prototype,"_allAnalysisViews",void 0);b.__decorate([f.property()],n.prototype,"_creatingViewCount",void 0);return n=b.__decorate([r.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],n)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.Constraints=class extends n.Clonable{constructor(){super(...arguments);this.tilt=new l.TiltConstraint;this.altitude=new d.AltitudeConstraint;this.clipDistance=new c.ClipDistanceConstraint}};b.__decorate([h.property({type:l.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);b.__decorate([h.property({type:d.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);b.__decorate([h.property({type:c.ClipDistanceConstraint})],a.Constraints.prototype,"clipDistance",
void 0);a.Constraints=b.__decorate([e.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),function(a,b,n,
h,k,m,g,e,d){a.AltitudeConstraint=class extends n.Clonable{constructor(){super(...arguments);this.min=d.earthAltitudeConstraint.min;this.max=d.earthAltitudeConstraint.max}};b.__decorate([h.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([h.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([e.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f){a.Constraints=class extends n{constructor(p){super(p);this.collision=
new w;this.distance=Infinity;this.minimumPoiDistance=4;this.tilt=null}get altitude(){return this.mode===l.ViewingMode.Local?null:this._get("altitude")||null}set altitude(p){this.mode===l.ViewingMode.Local?h.getLogger(this).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",p)}clampAltitude(p){return this.altitude?k.clamp(p,this.altitude.min,this.altitude.max):p}clampTilt(p,t){if(!this.tilt)return t;p=this.tilt(p);return k.clamp(t,p.min,p.max)}clampDistance(p){return Math.min(p,
this.distance)}createDefaultTilt(){return this.mode===l.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(p){return(t,q=x)=>{q.min=r.min;q.max=p;return q}}_createDefaultTiltLocal(){const p=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,r.max],[1E4,k.deg2rad(88)],[6E6,k.deg2rad(88)]]):()=>r.max;return(t,q=x)=>{q.min=r.min;q.max=p(t);return q}}_createDefaultTiltGlobal(){const p=this.collision.enabled?f.makePiecewiseLinearFunction([[4E3,
r.max],[5E4,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,r.min]]):f.makePiecewiseLinearFunction([[3E5,r.max],[3E6,k.deg2rad(88)],[6E6,k.deg2rad(88)],[2E7,r.min]]);return(t,q=x)=>{q.min=r.min;q.max=p(t);return q}}};b.__decorate([m.property()],a.Constraints.prototype,"altitude",null);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([m.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",
void 0);b.__decorate([m.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([m.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([d.subclass("esri.views.3d.state.Constraints")],a.Constraints);g={min:-2E5,max:4*c.earth.radius};const r={min:k.deg2rad(.5),max:k.deg2rad(179.5)},x={min:0,max:0};let w=class extends n{constructor(){super(...arguments);this.enabled=!0;this.elevationMargin=5}};b.__decorate([m.property({type:Boolean})],w.prototype,"enabled",
void 0);b.__decorate([m.property({type:Number})],w.prototype,"elevationMargin",void 0);w=b.__decorate([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],w);a.TiltRange=r;a.earthAltitudeConstraint=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){a.ClipDistanceConstraint=class extends n.Clonable{constructor(){super(...arguments);this.mode="auto"}get near(){return this._get("near")}set near(d){this._set("near",d);d>=this._get("far")&&(this.far=d+1E-9);this.mode="manual"}castNear(d){return Math.max(1E-8,d)}get far(){return this._get("far")}set far(d){this._set("far",d);d<=this._get("near")&&(this.near=d-1E-9);this.mode="manual"}castFar(d){return Math.max(1E-8,d)}autoUpdate(d,c){"auto"===this.mode&&(this._get("near")!==
d&&this._set("near",d),this._get("far")!==c&&this._set("far",c))}};b.__decorate([h.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([k.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([h.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([k.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([h.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,
"mode",void 0);a.ClipDistanceConstraint=b.__decorate([e.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/RandomLCG ../../../core/has ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,n,h,k,m,g,e,d,c){var l=h.rad2deg(c.TiltRange.min),f=h.rad2deg(c.TiltRange.max);a.TiltConstraint=class extends n.Clonable{constructor(r){super(r);this.mode="auto"}get max(){return this._get("max")}set max(r){this._set("max",r);this.mode="manual"}castMax(r){return h.clamp(r,l,f)}autoUpdate(r){"auto"===this.mode&&this._get("max")!==r&&this._set("max",r)}};b.__decorate([k.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([k.property({type:Number,value:f})],
a.TiltConstraint.prototype,"max",null);b.__decorate([m.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([d.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/handleUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){var p;r=p=class extends r{constructor(t){super(t);this.atmosphere=new c.SceneViewAtmosphere;this.lighting=this.castLighting();this.cachedCameraTrackingEnabled=null}destroy(){this.atmosphere.destroy()}static fromWebsceneEnvironment(t){t=t.cloneConstructProperties();return new p({...t,lighting:t.lighting?"virtual"===t.lighting.type?f.fromWebsceneLighting(t.lighting):l.fromWebsceneLighting(t.lighting):void 0})}castLighting(t){return this._convertLightingWithDestroy(t)}applyLighting(t){this.lighting=
this._convertLightingWithDestroy(t)}_convertLightingWithDestroy(t){const q=this._convertLighting(t);q!==t&&this.addHandles(n.destroyHandle(q));return q}_convertLighting(t){return t?t instanceof l||t instanceof f?t:t instanceof x?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):new l({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):t instanceof w?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t):
new f({...t.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):e.ensureOneOfType(d.lightingTypes,t):new l}clone(){return new p({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:h.clone(this.background)})}cloneWithWebsceneEnvironment(t){return new p({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,
starsEnabled:this.starsEnabled,background:h.clone(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):l.fromWebsceneLighting(t.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(t.lighting):f.fromWebsceneLighting(t.lighting);default:return b.neverReached(t.lighting),
l.fromWebsceneLighting(t.lighting)}}};a.__decorate([k.property({type:c.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],r.prototype,"atmosphere",void 0);a.__decorate([k.property({nonNullable:!0})],r.prototype,"lighting",void 0);a.__decorate([m.cast("lighting")],r.prototype,"castLighting",null);return r=p=a.__decorate([g.subclass("esri.views.3d.environment.SceneViewEnvironment")],r)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,
b,n){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:n}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),function(a,
b,n,h,k,m,g,e,d){var c;n=c=class extends n.EventedMixin(d){constructor(f){super(f);this.cameraTrackingEnabled=!0;this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};f=(new Date).getFullYear();f=new Date("March 15, "+f+" 12:00:00 UTC");this._set("defaultDate",f);this._set("date",f)}get ambientOcclusionEnabled(){b.deprecatedProperty(h.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});
return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(f){b.deprecatedProperty(h.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",f)}get waterReflectionEnabled(){b.deprecatedProperty(h.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??
!1}set waterReflectionEnabled(f){b.deprecatedProperty(h.getLogger(this),"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",f)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(f){return new c(f.cloneConstructProperties())}set defaultDate(f){const r=this._get("date")===this._get("defaultDate");f=new Date(f.getTime());this._set("defaultDate",f);
r&&this._set("date",f)}set date(f){null!=f&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(f.getTime())))}autoUpdate(f,r){const x=c.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=r.hours;this.positionTimezoneInfo.minutes=r.minutes;this.positionTimezoneInfo.seconds=r.seconds;r=null;null!=f&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(f.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),
this._set("date",new Date(f.getTime()))));const w=c.calculateTimezoneOffset(this.positionTimezoneInfo);x!==w&&(l.target=this,l.timezoneOffset=w,this.emit("timezone-will-change",l),l.target=null);if(null!=f)return isNaN(f.getTime())||r!==f.getTime()}clone(){const f=this._get("date")===this._get("defaultDate"),r=new c({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});f&&r._set("date",r._get("defaultDate"));r.positionTimezoneInfo.autoUpdated=
this.positionTimezoneInfo.autoUpdated;r.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;r.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;r.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return r}cloneWithWebsceneLighting(f){const r=this.clone();null!=f.date&&(r.date=f.date);r.directShadowsEnabled=f.directShadowsEnabled;r.displayUTCOffset=f.displayUTCOffset;return r}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};
a.__decorate([k.property({type:Boolean})],n.prototype,"cameraTrackingEnabled",void 0);a.__decorate([k.property({type:Boolean})],n.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],n.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Date})],n.prototype,"defaultDate",null);a.__decorate([k.property({type:Date})],n.prototype,"date",null);n=c=a.__decorate([e.subclass("esri.views.3d.environment.SunLighting")],n);(function(f){f.calculateTimezoneOffset=
function({hours:r,minutes:x,seconds:w}){return Math.round(r+x/60+w/3600)}})(n||={});const l={target:null,timezoneOffset:0};return n})},"esri/webscene/SunLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,b,n,h,k,m,g,e,d){var c;b=c=class extends b.JSONSupport{constructor(l){super(l);
this.type="sun";this.date=null;this.directShadowsEnabled=!1;this.displayUTCOffset=null}readDate(l,f){return null!=f.datetime&&new Date(f.datetime)||null}writeDate(l,f,r){f[r]=l.getTime()}readDirectShadowsEnabled(l,f){return!!f.directShadows}writedirectShadowsEnabled(l,f,r){l&&(f[r]=l)}writeDisplayUTCOffset(l,f){null!=l&&(f.displayUTCOffset=l)}clone(){return new c(this.cloneConstructProperties())}cloneConstructProperties(){const l={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(l.date=new Date(this.date.getTime()));return l}};a.__decorate([n.property({readOnly:!0,type:["sun"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([n.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);a.__decorate([g.reader("date",["datetime"])],b.prototype,"readDate",null);a.__decorate([d.writer("date")],b.prototype,"writeDate",null);a.__decorate([n.property({type:Boolean,json:{default:!1,
write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);a.__decorate([g.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);a.__decorate([d.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);a.__decorate([n.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);a.__decorate([d.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",null);return b=c=a.__decorate([e.subclass("esri.webscene.SunLighting")],
b)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/tslib.es6 ../../../core/deprecate ../../../core/Evented ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),function(a,b,n,h,k,m,g,e,d){var c;n=c=class extends n.EventedMixin(d){constructor(l){super(l);this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){b.deprecatedProperty(h.getLogger(this),
"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});return this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(l){b.deprecatedProperty(h.getLogger(this),"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"});this._set("ambientOcclusionEnabled",l)}get waterReflectionEnabled(){b.deprecatedProperty(h.getLogger(this),"waterReflectionEnabled",
{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});return this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(l){b.deprecatedProperty(h.getLogger(this),"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"});this._set("waterReflectionEnabled",l)}clone(){return new c({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(l){return new c(l.cloneConstructProperties())}cloneWithWebsceneLighting(l){const f=
this.clone();f.directShadowsEnabled=l.directShadowsEnabled;return f}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};a.__decorate([k.property({type:Boolean})],n.prototype,"ambientOcclusionEnabled",null);a.__decorate([k.property({type:Boolean})],n.prototype,"waterReflectionEnabled",null);a.__decorate([k.property({type:Boolean})],n.prototype,"cameraTrackingEnabled",void 0);return n=c=a.__decorate([e.subclass("esri.views.3d.environment.VirtualLighting")],
n)})},"esri/webscene/VirtualLighting":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g){var e;b=e=class extends b.JSONSupport{constructor(d){super(d);this.type="virtual";this.directShadowsEnabled=!1}clone(){return new e(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};
a.__decorate([n.property({readOnly:!0,type:["virtual"],json:{write:!0}})],b.prototype,"type",void 0);a.__decorate([n.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],b.prototype,"directShadowsEnabled",void 0);return b=e=a.__decorate([g.subclass("esri.webscene.VirtualLighting")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){var d;a.SceneViewAtmosphere=d=class extends n{set quality(c){["low","high"].includes(c)&&this._set("quality",c)}clone(){return new d({quality:this.quality})}};b.__decorate([h.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=d=b.__decorate([e.subclass("esri.views.3d.environment.SceneViewAtmosphere")],a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/has ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){var x;m=(w,p,t)=>({enabled:!t||!t.isPresentation});b=x=class extends b.JSONSupport{constructor(w){super(w);this.lighting=new l;this.background=null;this.starsEnabled=this.atmosphereEnabled=!0}set weather(w){d.validateWeatherType(w?.type,h.getLogger(this))&&this._set("weather",w)}clone(){return new x(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?f.prototype.clone.call(this.lighting):l.prototype.clone.call(this.lighting),
background:n.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};a.__decorate([k.property({types:c.lightingTypes,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0);a.__decorate([k.property(r.backgroundProperty)],b.prototype,"background",void 0);a.__decorate([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"atmosphereEnabled",void 0);a.__decorate([k.property({type:Boolean,
nonNullable:!0,json:{write:{overridePolicy:m}}})],b.prototype,"starsEnabled",void 0);a.__decorate([k.property({types:d.weatherTypes,nonNullable:!0,json:{write:!0},value:new e})],b.prototype,"weather",null);return b=x=a.__decorate([g.subclass("esri.webscene.Environment")],b)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){var d;b=d=class extends b.JSONSupport{constructor(c){super(c);this.type="sunny";this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover})}};a.__decorate([g.enumeration({sunny:"sunny"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=d=a.__decorate([e.subclass("esri.views.3d.environment.SunnyWeather")],b)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),
function(a,b,n,h,k,m){b={key:"type",base:m,typeMap:{sunny:m,cloudy:b,rainy:h,snowy:k,foggy:n}};const g=Object.keys(b.typeMap);a.cloudsHeight=1E5;a.validateWeatherType=function(e,d){return g.includes(e)?!0:(d.error(`"${e}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){var d;b=d=class extends b.JSONSupport{constructor(c){super(c);this.type="cloudy";this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover})}};a.__decorate([g.enumeration({cloudy:"cloudy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=d=a.__decorate([e.subclass("esri.views.3d.environment.CloudyWeather")],b)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){var d;b=d=class extends b.JSONSupport{constructor(c){super(c);this.type="foggy";this.fogStrength=.5}clone(){return new d({fogStrength:this.fogStrength})}};a.__decorate([g.enumeration({foggy:"foggy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"fogStrength",void 0);return b=d=a.__decorate([e.subclass("esri.views.3d.environment.FoggyWeather")],b)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){var d;b=d=class extends b.JSONSupport{constructor(c){super(c);this.type="rainy";this.precipitation=this.cloudCover=.5}clone(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation})}};a.__decorate([g.enumeration({rainy:"rainy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},
json:{write:!0}})],b.prototype,"precipitation",void 0);return b=d=a.__decorate([e.subclass("esri.views.3d.environment.RainyWeather")],b)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,
g,e){var d;b=d=class extends b.JSONSupport{constructor(c){super(c);this.type="snowy";this.precipitation=this.cloudCover=.5;this.snowCover="disabled"}clone(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};a.__decorate([g.enumeration({snowy:"snowy"})],b.prototype,"type",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,
range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",void 0);a.__decorate([n.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b.prototype,"snowCover",void 0);return b=d=a.__decorate([e.subclass("esri.views.3d.environment.SnowyWeather")],b)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,n){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:n}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,n){b={base:b,key:"type",typeMap:{color:n}};b={types:b,json:{read:function(h){return(k,m,g)=>{if(!k)return k;for(const e in h.typeMap)if(k.type===e)return m=new h.typeMap[e],m.read(k,g),m}}(b),write:{overridePolicy:(h,k,m)=>({enabled:!m||!m.isPresentation})}}};a.backgroundProperty=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){b=class extends b.JSONSupport{constructor(e){super(e)}clone(){}};a.__decorate([n.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=a.__decorate([g.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,n,h,k,m,g,e,d,c){var l;h={...d.colorAndTransparencyProperty,nonNullable:!0};c=l=class extends c{constructor(f){super(f);this.type="color";this.color=new b([0,0,0,1])}clone(){return new l(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};a.__decorate([g.enumeration({color:"color"},{readOnly:!0})],c.prototype,"type",void 0);a.__decorate([n.property(h)],c.prototype,"color",void 0);return c=l=a.__decorate([e.subclass("esri.webscene.background.ColorBackground")],
c)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/projectPointToWGS84ComparableLonLat ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){a.SceneViewEnvironmentManager=class extends n.EventedAccessor{constructor(){super();this._referencePointUpdateDelay=200;this._referencePointUpdateInterval=3E3;this._referencePointUpdateDistThreshold=1E6;this._referencePosMapCoordsRequested=this._referencePosUpdateQuery=null;this._viewHandlesKey="viewHandles";this._referencePosResetPreserveAbsoluteTime=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosMapCoords=this._referencePosUpdateTimer=
null;this._mainLight=new D.MainLight;this._ambientLight=new D.AmbientLight;this._moonLight=new D.FillLight;this._disableWeather=this.disableQueries=!1;this._referencePosWGS84Comparable=this._renderer=null;this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){return this._renderer?.view}get updating(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}get weatherEnabled(){return this._view?.environment.atmosphereEnabled&&
!this._disableWeather&&this._view?.state?.viewingMode===t.ViewingMode.Global&&p.isEarth(this._view.spatialReference)}get weatherVisible(){return this.weatherEnabled&&this._renderer?.weatherVisible}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(J){if(!this._renderer){this._renderer=new q.EnvironmentRenderer({view:J});var B=()=>this._updateRenderParameters(),z=()=>this._cameraHandler();this.addHandles([m.watch(()=>J.environment.lighting,K=>this._updateLightingHandler(K),
m.sync),m.watch(()=>"virtual"!==J.environment.lighting.type?J.environment.lighting.date:null,K=>this._lightingDateHandler(K),m.sync),m.watch(()=>J.stationary,()=>this._interactingStationaryHandler()),m.watch(()=>J.environment.lighting.directShadowsEnabled,B,m.sync),m.watch(()=>J.qualitySettings.ambientOcclusion,B,m.sync),m.watch(()=>J.qualitySettings.reflections,B,m.sync),m.watch(()=>J.spatialReference,()=>this._resetReferencePosition(!0),m.sync),m.watch(()=>J.environment.weather.type,()=>this._updateLighting(null,
y.Update.Faded),m.sync),m.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,y.Update.Faded),m.sync),m.watch(()=>J.viewingMode,()=>this._resetReferencePosition(!0),m.syncAndInitial),m.watch(()=>"virtual"!==J.environment.lighting.type?J.environment.lighting.cameraTrackingEnabled:!1,K=>this._updateCameraTracking(K),m.syncAndInitial),m.watch(()=>J.state.camera,z,m.syncAndInitial),m.watch(()=>this.disableQueries,z)],this._viewHandlesKey);this._updateRenderParameters();this._updateLighting();
this._cameraHandler();this.notifyChange("updating")}}disconnectView(){this.removeHandles(this._viewHandlesKey);this._resetReferencePosition();this._renderer=h.destroyMaybe(this._renderer)}_updateLightingHandler(J){this._updateCameraTracking("virtual"!==J.type?J.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==J.type?J.date:null);this._updateRenderParameters()}_updateCameraTracking(J){(this._trackingEnabled=J)?this._cameraHandler():(J=this._view.environment.lighting,"virtual"!==J?.type&&
(J.positionTimezoneInfo.autoUpdated=!1))}_lightingDateHandler(J){const B=this._view.environment.lighting;if("virtual"===B?.type)this._updateLighting();else if(J){if(!B.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!x.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var z=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(z)){this._requestReferencePositionUpdate(z);return}}this._preupdateTracking(J);null!=this._referencePosWGS84Comparable&&
(z=u.positionToTimezoneInfo(this._referencePosWGS84Comparable,E),null!=z&&(B.autoUpdate(null,z),this._trackingEnabled&&(B.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(J)}}_preupdateTracking(J){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(J)}_cameraHandler(J=null){var B=this._view;B.ready&&(B=B.stateManager.camera)&&(this._cameraHandlerClientSide(B,J)||this._cameraHandlerServerSide(B))}_cameraHandlerClientSide(J,
B){const z=p.isEarth(this._view.spatialReference);if(z&&!x.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;J=J.position;null==this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable=r.create());z?w.projectPointToWGS84ComparableLonLat(J,this._referencePosWGS84Comparable):f.set(this._referencePosWGS84Comparable,J.longitude??0,J.latitude??0,J.z??0);this.notifyChange("referencePositionWGS84Comparable");
this._autoUpdateTimezone(this._referencePosWGS84Comparable,B)||this._updateLighting(B);return!0}_cameraHandlerServerSide(J){J=J.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(J))&&this._requestReferencePositionUpdate(J,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(J.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&
this._executePendingReferencePositionUpdate()}_updateLighting(J,B=y.Update.Immediate){var z=this._view;J=J||("virtual"===z.environment.lighting.type?null:z.environment.lighting.date);var K=this._referencePosWGS84Comparable;const L=K?G:A;var F=this.weatherVisible?z.environment.weather.type:"disabled";null!=K?v.computeColorAndIntensity(J,K,z.state.viewingMode,F,z.state.camera,L):"virtual"===z.environment.lighting.type&&v.computeVirtualLightDirection(z.state.camera,z.state.viewingMode,L.direct.directionToLightSource);
J=this._mainLight;z=L.direct;f.scale(J.intensity,z.color,z.intensity*Math.PI);f.copy(J.direction,z.directionToLightSource);J.specularStrength=L.specularStrength;J.environmentStrength=L.environmentStrength;K=this._ambientLight;f.scale(K.intensity,L.ambient.color,L.ambient.intensity);F=this._moonLight;f.lerp(F.intensity,I,H,L.globalFactor);f.scale(F.intensity,F.intensity,(1-.5*L.globalFactor)*(1-.4*L.noonFactor*(1-L.globalFactor)));f.copy(F.direction,z.directionToLightSource);this._renderer.updateLightSources([J,
K,F],L.noonFactor,L.globalFactor,B);this._updateRenderParameters()}_autoUpdateTimezone(J,B=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||null==J)return!1;const z=C;z.setTime((B||this._view.environment.lighting.date).getTime());J=u.positionToTimezoneInfo(J,E);if(null==J)return!1;var K=this._view.environment.lighting.positionTimezoneInfo;if(!K.autoUpdated)K=J;else if(K.hours===J.hours&&K.minutes===J.minutes&&K.seconds===J.seconds)return!1;
const L=z.getUTCHours()-(J.hours-K.hours),F=z.getUTCMinutes()-(J.minutes-K.minutes);K=z.getUTCSeconds()-(J.seconds-K.seconds);z.setUTCHours(L);z.setUTCMinutes(F);z.setUTCSeconds(K);return B?!1:this._view.environment.lighting.autoUpdate(z,J)}_updateRenderParameters(){const J=this._view._stage;if(J){var B=null!=this._referencePosWGS84Comparable?v.computeShadowsEnabled(this._referencePosWGS84Comparable[2],this._view.state.viewingMode):!0;J.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
B,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}}_resetReferencePosition(J=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");J&&this._cameraHandler()}_requestReferencePositionUpdate(J,B=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?
this._referencePosMapCoordsRequested.copy(J):this._referencePosMapCoordsRequested=J.clone(),this._referencePosResetPreserveAbsoluteTime=!!B,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const z=this._referencePosUpdateQuery=k.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===z)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==z)}).catch(L=>{"mapcoordshelper:missing-geometry-service"===L.name&&
(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===z&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),K=this._referencePosUpdateTimer=k.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===K&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(J){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const B=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);J()||isNaN(B[0])||isNaN(B[1])||(J=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=B[0],this._referencePosWGS84Comparable[1]=B[1],this._referencePosWGS84Comparable[2]=J):this._referencePosWGS84Comparable=[B[0],B[1],J],this._referencePosChanged())}_executePendingReferencePositionUpdate(){const J=this._referencePosMapCoordsRequested;J&&this._requestReferencePositionUpdate(J,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(J){return this._referencePosMapCoords?(J=this._referencePosMapCoords.distance(J),this._view.mapCoordsHelper&&(J*=this._view.mapCoordsHelper.unitInMeters),J>this._referencePointUpdateDistThreshold):!0}_cancelReferencePosUpdates(){const J=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return J}get test(){const J=this;return{get renderer(){return J._renderer},
set referencePointUpdateInterval(B){J._referencePointUpdateInterval=B},set referencePointUpdateDistThreshold(B){J._referencePointUpdateDistThreshold=B},set referencePosUpdateTimer(B){J._referencePosUpdateTimer=B},set referencePointUpdateDelay(B){J._referencePointUpdateDelay=B},set disableWeather(B){J._disableWeather=B}}}};b.__decorate([g.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,
"disableQueries",void 0);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);b.__decorate([g.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);b.__decorate([g.property()],
a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=b.__decorate([l.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const G=new v.ColorAndIntensity,A=new v.ColorAndIntensity,C=new Date,E={hours:0,minutes:0,seconds:0},I=r.fromValues(.22,.22,.33),H=r.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToWGS84ComparableLonLat":function(){define(["exports",
"../../core/libs/gl-matrix-2/factories/vec3f64","./projectVectorToWGS84ComparableLonLat"],function(a,b,n){const h=b.create();a.projectPointToWGS84ComparableLonLat=function(k,m){h[0]=k.x;h[1]=k.y;const g=k.z;h[2]=void 0!==g?g:0;return n.projectVectorToWGS84ComparableLonLat(h,k.spatialReference,m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToWGS84ComparableLonLat":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64",
"./projectors"],function(a,b,n){const h=b.create();a.projectVectorToWGS84ComparableLonLat=function(k,m,g){if(null==m)return!1;m=n.getWGS84ComparableLonLatProjector(m);if(null==m)return!1;m(k,0,h,0);g!==h&&(g[0]=h[0],g[1]=h[1],2<g.length&&(g[2]=h[2]));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsParameters ./CloudsPresets ./Fog ./LocalAtmosphere ./MarsAtmosphere ./Precipitation ./Stars ./weather ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){var K;a.EnvironmentRenderer=K=class extends J.SyncRenderPlugin{constructor(N){super(N);this.produces=new Map([[B.RenderSlot.ENVIRONMENT_OPAQUE,()=>!(null===this._atmosphere&&null===this._stars)],[B.RenderSlot.ENVIRONMENT_TRANSPARENT,()=>null!==this._atmosphere]]);this._atmosphere=this._context=null;this._oldWeatherParameters=new L;this._newWeatherParameters=new L;this._fadedWeatherParameters=new L;this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){this.removeHandles();
this.uninitializeRenderContext();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return null!=this.atmosphere?this.atmosphere.type:p.AtmosphereType.None}consumes(){return this._atmosphereType===p.AtmosphereType.Realistic?J.ConsumesDepth:J.ConsumesNone}updateAnimation(N){return null!=this._precipitation?this._precipitation.update(N):!1}get updating(){return null!=this._stars&&this._stars.updating||
null!=this._clouds&&this._clouds.running}get weatherVisible(){return l.length(this.view.state.camera.eye)-r.getReferenceEllipsoid(this.view.spatialReference).radius<=H.weatherHeightLimit}get usedMemory(){return this._clouds?.usedMemory??0}get _stars(){const N=this.view,P=N.environment?.starsEnabled??!1,R=this._get("_stars");return P&&null!=this._context?null!=R?R:new I.Stars({view:N,requestRender:()=>this._setNeedsRender()}):(k.destroyMaybe(R),null)}get _precipitation(){const N=this._get("_precipitation");
if(!this._precipitationEnabled||null==this._context)return k.destroyMaybe(N),null;const P=this.view,R=this._context;if(null!=N&&N.context===R)return N;k.destroyMaybe(N);return new E.Precipitation({context:R,view:P})}get _clouds(){const N=this._get("_clouds");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(N),null;if(null!=N)return N;const P=this.view,R=this._context;k.destroyMaybe(N);return new v.CloudsGenerator({context:R,view:P,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const N=
this._get("_cloudsComposition");if(!this.weatherEnabled||null==this._context)return k.destroyMaybe(N),null;const P=this.view.state.viewingMode,R=this._context.renderContext.rctx,O=r.getReferenceEllipsoid(this.view.spatialReference).radius;if(null!=N&&N.viewingMode===P&&N.planetRadius===O)return N;k.destroyMaybe(N);return new q.CloudsComposition({rctx:R,viewingMode:P,planetRadius:O,requestRender:()=>this._setNeedsRender()})}get _fog(){const N=this._get("_fog");return this.weatherEnabled&&null!=this._context?
null!=N?N:new G.Fog({context:this._context,view:this.view,rctx:this._context.renderContext.rctx,viewingMode:this.view.state.viewingMode}):(k.destroyMaybe(N),null)}get weatherEnabled(){return!!this.view?.environmentManager?.weatherEnabled}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(N=null){this._context=N;N=()=>this._setNeedsRender();this.addHandles([m.watch(()=>({viewingMode:this.view.state.viewingMode,
enabled:this.view.environment.atmosphereEnabled}),P=>this._updateAtmosphere(P),m.syncAndInitial),m.watch(()=>this._stars,N),m.watch(()=>this._precipitation,N),m.watch(()=>this._clouds,()=>this._updateWeather(),m.initial),m.watch(()=>this._fog,()=>this._updateFogHaze(),m.initial),m.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},m.sync),m.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=
null;this._atmosphere=k.destroyMaybe(this._atmosphere);this._set("_stars",k.destroyMaybe(this._stars));this._set("_precipitation",k.destroyMaybe(this._precipitation));this._set("_clouds",k.destroyMaybe(this._clouds));this._set("_cloudsComposition",k.destroyMaybe(this._cloudsComposition));this._set("_fog",k.destroyMaybe(this._fog))}prepareRender(N){N.bindParameters.cloudsFade.data=u.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&null!=N.bindParameters.cloudsFade.data?.cubeMap&&
(this._updateWeatherFading(N.bindParameters,N.time),N.bindParameters.cloudsFade.renderingStage===u.CloudsRenderingStages.FINISHED&&null!=this._clouds&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),N.bindParameters.cloudsFade.data=null))}renderNode(N){switch(N.bindParameters.slot){case B.RenderSlot.ENVIRONMENT_OPAQUE:null!=this._stars&&this._stars.render(N);null!=this.atmosphere&&(this.atmosphere.render(N,this.view?._stage?.renderer?.fullResolutionAtmosphere),
null!=this._cloudsComposition&&null!=N.bindParameters.cloudsFade.data&&(this.weatherVisible&&null!=this._clouds&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(N)),N.bindParameters.cloudsFade.isFading&&null!=this._context&&null!=N.bindParameters.cloudsFade.data?.cubeMap&&this._context.requestRender());break;case B.RenderSlot.ENVIRONMENT_TRANSPARENT:if(null!=this.atmosphere&&(this.atmosphere.renderHaze(N,this._weatherParameters.hazeAmount,this.view?._stage?.renderer?.fullResolutionAtmosphere),
0<this._weatherParameters.fog.amount&&null!=this._fog&&this._fog.render(N,this._weatherParameters.fog),this._precipitation)){const P=this.view.environment.weather;"rainy"!==P.type&&"snowy"!==P.type||this._precipitation.render(N,P.precipitation,P.type)}}}updateLightSources(N,P,R,O){if(null!=this._context){const T=this._context.renderContext;T.bindParameters.oldLighting.copyFrom(T.bindParameters.lighting);T.bindParameters.newLighting.noonFactor=P;T.bindParameters.newLighting.globalFactor=R;T.bindParameters.newLighting.set(N);
O===z.Update.Faded||T.bindParameters.weatherFading?T.bindParameters.fadeLighting(0):T.bindParameters.fadeLighting(1);this._context.requestRender()}}get _weatherUpdateParameters(){const N=this.weatherEnabled?this.view.environment.weather:null;return null==N?null:"rainy"===N.type||"snowy"===N.type?{type:N.type,weatherAdjustment:N.cloudCover,effect:N.precipitation}:{type:N.type,weatherAdjustment:"foggy"===N.type?N.fogStrength:N.cloudCover}}_updateWeatherFading(N,P){N.cloudsFade.updateFading(N.camera,
this.view.state.mode,P,this.view.qualitySettings.fadeDuration);N.cloudsFade.updateParallax(N.camera);N.weatherFading&&(this._updateLighting(N),this._updateFogAtmoshpere(N))}_updateLighting(N){N.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||N.cloudsFade.fadeMode===y.FadeMode.FADE_IN?N.fadeLighting(N.cloudsFade.fadeFactor):N.fadeLighting(0)}_updateFogAtmoshpere(N){N.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||N.cloudsFade.fadeMode===y.FadeMode.FADE_IN?this._fadeWeather(N.cloudsFade.fadeFactor):this._fadeWeather(0)}_fadeWeather(N){const {_newWeatherParameters:P,
_oldWeatherParameters:R}=this;1<=N?this._weatherParameters=P:(this._fadedWeatherParameters.lerp(R,P,N),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const N=this._weatherUpdateParameters;null!=N&&null!=this._clouds&&(this._clouds.applyPreset(D.cloudPresets[N.type],N.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){null!=this._context&&this._context.requestRender()}_updateFogHaze(){const N=this._weatherUpdateParameters;if(null!=this._fog&&null!=N&&null!=this._context){var P=
this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(N.type){case "foggy":this._newWeatherParameters.fog.strength=h.lerp(3E-5,.005,N.weatherAdjustment**3);l.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=h.lerp(4E-6,2E-4,(N.effect??0)**3);l.copy(this._newWeatherParameters.fog.color,
F);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=h.lerp(4E-6,2E-4,(N.effect??0)**3);l.copy(this._newWeatherParameters.fog.color,M);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.hazeAmount=1;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}P.weatherFading?
this._fadeWeather(0):this._fadeWeather(1)}}_updateAtmosphere(N){N=this._selectAtmosphereType(N);if(N===p.AtmosphereType.None||!this._context)this._atmosphere=k.destroyMaybe(this._atmosphere);else if(!this._atmosphere||this._atmosphere.type!==N)if(this._atmosphere=k.destroyMaybe(this._atmosphere),N=this._getAtmosphereClass(N))this._atmosphere=new N(this.view,this._context);this._setNeedsRender()}_getAtmosphereClass(N){switch(N){case p.AtmosphereType.Realistic:return t.ChapmanAtmosphere;case p.AtmosphereType.Local:return A.LocalAtmosphere;
case p.AtmosphereType.Mars:return C;default:case p.AtmosphereType.None:return null}}_selectAtmosphereType(N){const {enabled:P,viewingMode:R}=N;return!P||x.isMoon(this.view.spatialReference)?p.AtmosphereType.None:R===w.ViewingMode.Local?p.AtmosphereType.Local:null!=this._context&&t.ChapmanAtmosphere.isSupported(this._context)&&x.isEarth(this.view.spatialReference)?p.AtmosphereType.Realistic:x.isMars(this.view.spatialReference)?p.AtmosphereType.Mars:p.AtmosphereType.None}get test(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:N=>{S=K.prototype._getAtmosphereClass;K.prototype._getAtmosphereClass=N},restoreGetAtmosphereClass:()=>{K.prototype._getAtmosphereClass=S}}}};b.__decorate([g.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"atmosphere",
null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);b.__decorate([g.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);b.__decorate([g.property()],a.EnvironmentRenderer.prototype,"_context",void 0);b.__decorate([g.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);b.__decorate([g.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_stars",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",
null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);b.__decorate([g.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=K=b.__decorate([c.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);class L{constructor(){this.fog=new G.FogParameters;this.hazeAmount=1}copyFrom(N){this.fog.amount=N.fog.amount;this.hazeAmount=N.hazeAmount;this.fog.strength=N.fog.strength;
l.copy(this.fog.color,N.fog.color)}lerp(N,P,R){this.fog.amount=h.lerp(N.fog.amount,P.fog.amount,R);this.hazeAmount=h.lerp(N.hazeAmount,P.hazeAmount,R);this.fog.strength=h.lerp(N.fog.strength,P.fog.strength,R);l.lerp(this.fog.color,N.fog.color,P.fog.color,R)}}const F=f.fromValues(.5,.5,.5),M=f.fromValues(1.5,1.5,1.5);let S;a.WeatherParameters=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=
void 0;var b=a.AtmosphereType||(a.AtmosphereType={});b[b.Realistic=0]="Realistic";b[b.Local=1]="Local";b[b.Mars=2]="Mars";b[b.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/colorUtils ../../../core/Handles ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl/formats ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/textureUtils ../../../chunks/AtmosphereCompositing.glsl ../webgl-engine/shaders/AtmosphereCompositingTechnique ../../webgl/enums ../../../webscene/background/ColorBackground".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){class G{constructor(A,C){this._view=A;this._context=C;this.type=l.AtmosphereType.Realistic;this._handles=new n;this._compositingPassParameters=new u.AtmosphereCompositingPassParameters;this._atmosphereConfiguration=new x.ChapmanAtmosphereTechniqueConfiguration;this._passParameters=new r.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=c.earth.radius;this._fadeHaze=0;this._updateRadius(c.earth.radius);A=
this._context.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([k.watch(()=>this._view?.basemapTerrain?.rootTileElevationBounds,()=>this._view?.basemapTerrain?this._updateRootTileElevationBounds():null),k.watch(()=>this._view?.basemapTerrain?.visibleElevationBounds,()=>this._view?.basemapTerrain?this._updateVisibleElevationBounds():null),k.watch(()=>this._view?.environment.background,E=>{E=E instanceof D?b.unitRGBAFromColor(E.color):d.ZEROS;g.set(this._passParameters.backgroundColor,
E[0]*E[3],E[1]*E[3],E[2]*E[3])},k.syncAndInitial)]);C=new x.ChapmanAtmosphereTechniqueConfiguration;C.haze=!1;this._atmosphereTechnique=this._context.techniqueRepository.acquire(r.ChapmanAtmosphereTechnique,C);C.haze=!0;this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(r.ChapmanAtmosphereTechnique,C);C.reduced=!0;C.haze=!1;this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(r.ChapmanAtmosphereTechnique,C);C.haze=!0;this._atmosphereHazeReducedTechnique=
this._context.techniqueRepository.acquire(r.ChapmanAtmosphereTechnique,C);this._vao=t.createQuadVAO(A,p.Pos2Tex)}destroy(){this._handles.destroy();this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();this._atmosphereReducedTechnique.release();this._atmosphereHazeReducedTechnique.release();this._vao.dispose()}render(A,C){this._render(A,C?this._atmosphereTechnique:this._atmosphereReducedTechnique,A.offscreenRenderingHelper.depthTexture,C,!1)}renderHaze(A,C,E){this._fadeHaze=C;
this._render(A,E?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,A.bindParameters.linearDepth?.getTexture(),E,!0)}_render(A,C,E,I,H){if(null!=E){var J=A.offscreenRenderingHelper;this._update(A.bindParameters.camera);this._passParameters.depthTexture=E;var B=A.rctx.bindTechnique(C,A.bindParameters,this._passParameters);if(I)J.renderDepthDetached(()=>this._renderCommon(B,A));else{C=A.rctx.getViewport();I=g.length(A.bindParameters.camera.eye)-c.earth.radius;if(I<f.atmosphereHeight){I=
Math.min(1,Math.max(0,I/f.atmosphereHeight));var z=H?h.lerp(.4,.5,I):h.lerp(.2,.3,I)}else I=Math.min(1,Math.max(0,(I-f.atmosphereHeight)/(15*f.atmosphereHeight))),z=H?h.lerp(.5,1,I):h.lerp(.3,.6,I);I=q.applyTextureResizeModulo(Math.round(z*A.bindParameters.camera.fullViewport[2]));z=q.applyTextureResizeModulo(Math.round(z*A.bindParameters.camera.fullViewport[3]));A.rctx.setViewport(0,0,I,z);I=J.renderToCachedFBO(null,"chapman",()=>this._renderCommon(B,A),[0,0,0,1],w.ColorFormat.RGBA,null,I,z);A.rctx.setViewport(C.x,
C.y,C.width,C.height);this._compositingPassParameters.color=I.getTexture();this._compositingPassParameters.depth=E;this._atmosphereConfiguration.haze=H;E=this._context.techniqueRepository.acquire(v.AtmosphereCompositingTechnique,this._atmosphereConfiguration);A.rctx.bindTechnique(E,A.bindParameters,this._compositingPassParameters);J.renderDepthDetached(()=>A.rctx.screen.draw());E.release();I.release()}}}_renderCommon(A,C){null!=this._vao&&(C.rctx.bindVAO(this._vao),A.assertCompatibleVertexAttributeLocations(this._vao),
C.rctx.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(A){return A*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const A=this._view.basemapTerrain.rootTileElevationBounds.min;A!==this._rootTileElevationMin&&(this._rootTileElevationMin=A,this._lowerBoundEarthRadius=c.earth.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const A=this._adjustRadiusForTesselation(c.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);A<
this._lowerBoundEarthRadius&&this._updateRadius(A)}_updateRadius(A){this._lowerBoundEarthRadius=A;m.set(this._passParameters.radii,A,A+f.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*A-f.innerAtmosphereDepth)*f.innerAtmosphereDepth)}_update(A){if(A){A=g.squaredLength(A.eye);var C=Math.sqrt(A),E=A-this._passParameters.radii[1]*this._passParameters.radii[1],I=h.clamp((C-this._passParameters.radii[0])/f.atmosphereHeight,0,1);e.set(this._passParameters.heightParameters,C,A,E,
I);this._passParameters.altitudeFade=f.computeInnerAltitudeFade(C-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=h.lerp(h.lerp(.6,1,h.smoothstep(9500,10500,C-c.earth.radius)),1,this._fadeHaze)}}static isSupported(A){return A.renderContext.rctx.capabilities.depthTexture}}a.ChapmanAtmosphere=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(a,b){function n(P,R){P[0]=R[0];P[1]=R[1];
return P}function h(P,R,O){P[0]=R;P[1]=O;return P}function k(P,R,O){P[0]=R[0]+O[0];P[1]=R[1]+O[1];return P}function m(P,R,O){P[0]=R[0]-O[0];P[1]=R[1]-O[1];return P}function g(P,R,O){P[0]=R[0]*O[0];P[1]=R[1]*O[1];return P}function e(P,R,O){P[0]=R[0]/O[0];P[1]=R[1]/O[1];return P}function d(P,R){P[0]=Math.ceil(R[0]);P[1]=Math.ceil(R[1]);return P}function c(P,R){P[0]=Math.floor(R[0]);P[1]=Math.floor(R[1]);return P}function l(P,R,O){P[0]=Math.min(R[0],O[0]);P[1]=Math.min(R[1],O[1]);return P}function f(P,
R,O){P[0]=Math.max(R[0],O[0]);P[1]=Math.max(R[1],O[1]);return P}function r(P,R){P[0]=Math.round(R[0]);P[1]=Math.round(R[1]);return P}function x(P,R,O){P[0]=R[0]*O;P[1]=R[1]*O;return P}function w(P,R,O,T){P[0]=R[0]+O[0]*T;P[1]=R[1]+O[1]*T;return P}function p(P,R){const O=R[0]-P[0];P=R[1]-P[1];return Math.sqrt(O*O+P*P)}function t(P,R){const O=R[0]-P[0];P=R[1]-P[1];return O*O+P*P}function q(P){const R=P[0];P=P[1];return Math.sqrt(R*R+P*P)}function u(P){const R=P[0];P=P[1];return R*R+P*P}function v(P,
R){P[0]=-R[0];P[1]=-R[1];return P}function y(P,R){P[0]=1/R[0];P[1]=1/R[1];return P}function D(P,R){var O=R[0];const T=R[1];O=O*O+T*T;0<O&&(O=1/Math.sqrt(O),P[0]=R[0]*O,P[1]=R[1]*O);return P}function G(P,R){return P[0]*R[0]+P[1]*R[1]}function A(P,R,O){R=R[0]*O[1]-R[1]*O[0];P[0]=P[1]=0;P[2]=R;return P}function C(P,R,O,T){const Q=R[0];R=R[1];P[0]=Q+T*(O[0]-Q);P[1]=R+T*(O[1]-R);return P}function E(P,R){R=R||1;const O=2*b.RANDOM()*Math.PI;P[0]=Math.cos(O)*R;P[1]=Math.sin(O)*R;return P}function I(P,R,O){const T=
R[0];R=R[1];P[0]=O[0]*T+O[2]*R;P[1]=O[1]*T+O[3]*R;return P}function H(P,R,O){const T=R[0];R=R[1];P[0]=O[0]*T+O[2]*R+O[4];P[1]=O[1]*T+O[3]*R+O[5];return P}function J(P,R,O){const T=R[0];R=R[1];P[0]=O[0]*T+O[3]*R+O[6];P[1]=O[1]*T+O[4]*R+O[7];return P}function B(P,R,O){const T=R[0];R=R[1];P[0]=O[0]*T+O[4]*R+O[12];P[1]=O[1]*T+O[5]*R+O[13];return P}function z(P,R,O,T){const Q=R[0]-O[0];R=R[1]-O[1];const V=Math.sin(T);T=Math.cos(T);P[0]=Q*T-R*V+O[0];P[1]=Q*V+R*T+O[1];return P}function K(P,R){var O=P[0];
P=P[1];const T=R[0];R=R[1];let Q=O*O+P*P;0<Q&&(Q=1/Math.sqrt(Q));let V=T*T+R*R;0<V&&(V=1/Math.sqrt(V));O=(O*T+P*R)*Q*V;return 1<O?0:-1>O?Math.PI:Math.acos(O)}function L(P){return"vec2("+P[0]+", "+P[1]+")"}function F(P,R){return P[0]===R[0]&&P[1]===R[1]}function M(P,R){const O=P[0];P=P[1];const T=R[0];R=R[1];const Q=b.getEpsilon();return Math.abs(O-T)<=Q*Math.max(1,Math.abs(O),Math.abs(T))&&Math.abs(P-R)<=Q*Math.max(1,Math.abs(P),Math.abs(R))}function S(P,R,O,T,Q){let V=R[0]-O[0];O=R[1]-O[1];Q=(T[0]*
V+T[1]*O)*(Q-1);V=T[0]*Q;O=T[1]*Q;P[0]=R[0]+V;P[1]=R[1]+O;return P}const N=Object.freeze(Object.defineProperty({__proto__:null,add:k,angle:K,ceil:d,copy:n,cross:A,dist:p,distance:p,div:e,divide:e,dot:G,equals:M,exactEquals:F,floor:c,inverse:y,len:q,length:q,lerp:C,max:f,min:l,mul:g,multiply:g,negate:v,normalize:D,projectAndScale:S,random:E,rotate:z,round:r,scale:x,scaleAndAdd:w,set:h,sqrDist:t,sqrLen:u,squaredDistance:t,squaredLength:u,str:L,sub:m,subtract:m,transformMat2:I,transformMat2d:H,transformMat3:J,
transformMat4:B},Symbol.toStringTag,{value:"Module"}));a.add=k;a.angle=K;a.ceil=d;a.copy=n;a.cross=A;a.dist=p;a.distance=p;a.div=e;a.divide=e;a.dot=G;a.equals=M;a.exactEquals=F;a.floor=c;a.inverse=y;a.len=q;a.length=q;a.lerp=C;a.max=f;a.min=l;a.mul=g;a.multiply=g;a.negate=v;a.normalize=D;a.projectAndScale=S;a.random=E;a.rotate=z;a.round=r;a.scale=x;a.scaleAndAdd=w;a.set=h;a.sqrDist=t;a.sqrLen=u;a.squaredDistance=t;a.squaredLength=u;a.str=L;a.sub=m;a.subtract=m;a.transformMat2=I;a.transformMat2d=H;
a.transformMat3=J;a.transformMat4=B;a.vec2=N;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(a,b){a.atmosphereHeight=1E5;a.computeInnerAltitudeFade=function(n){return b.clamp((n-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x extends g.NoParameters{constructor(){super(...arguments);this.heightParameters=k.create();this.radii=n.create();this.altitudeFade=this.innerFadeDistance=0;this.hazeStrength=1;this.renderScale=n.create();this.backgroundColor=h.create()}}class w extends d.ShaderTechnique{initializeProgram(p){return new l.Program(p.rctx,w.shader.get().build(this.configuration),c.Default3D)}initializePipeline(){return this.configuration.reduced?r.makePipelineState({blending:r.simpleBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.ZERO),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:r.defaultColorWriteParams}):this.configuration.haze?r.makePipelineState({blending:r.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_COLOR,f.BlendFactor.ONE),colorWrite:r.defaultColorWriteParams}):r.makePipelineState({blending:r.simpleBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:r.defaultColorWriteParams})}}
w.shader=new e.ReloadableShaderModule(m.ChapmanAtmosphere,()=>new Promise((p,t)=>a(["./ChapmanAtmosphere.glsl"],p,t)));b.ChapmanAtmospherePassParameters=x;b.ChapmanAtmosphereTechnique=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){function u(A){const C=new p.ShaderBuilder;C.attributes.add(q.VertexAttribute.POSITION,"vec2");C.include(m.TextureCoordinateAttribute,{textureCoordinateType:m.TextureCoordinateAttributeType.Default});C.varyings.add("worldRay","vec3");C.varyings.add("eyeDir","vec3");const {vertex:E,fragment:I}=C;E.uniforms.add(new w.Matrix4PassUniform("inverseProjectionMatrix",(H,J)=>J.camera.inverseProjectionMatrix),new w.Matrix4PassUniform("inverseViewMatrix",(H,J)=>b.invertOrIdentity(G,
J.camera.viewMatrix)));E.code.add(x.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);I.uniforms.add(new l.Float3PassUniform("backgroundColor",H=>H.backgroundColor),new c.Float2PassUniform("radii",H=>H.radii),new l.Float3PassUniform("cameraPosition",(H,J)=>J.camera.eye),new f.Float4PassUniform("heightParameters",H=>H.heightParameters),new r.FloatPassUniform("innerFadeDistance",H=>H.innerFadeDistance),new r.FloatPassUniform("altitudeFade",H=>H.altitudeFade),new t.Texture2DPassUniform("depthTexture",H=>H.depthTexture),new r.FloatPassUniform("hazeStrength",H=>H.hazeStrength));I.constants.add("betaRayleigh",
"vec3",v);I.constants.add("betaCombined","vec3",D);I.constants.add("betaMie","float",3.996E-6);I.constants.add("scaleHeight","float",k.rayLeighScaleHeight*k.atmosphereHeight);d.addMainLightDirection(I);C.include(e.Gamma);A.haze&&(I.include(g.ReadLinearDepth),I.uniforms.add(new c.Float2PassUniform("nearFar",(H,J)=>J.camera.nearFar)));I.code.add(x.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);I.code.add(x.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);I.code.add(x.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);I.code.add(x.glsl`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${A.haze?x.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${A.haze?"":x.glsl`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${A.haze?"":x.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${A.haze?x.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${A.haze?"":x.glsl`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${A.haze&&A.reduced?x.glsl`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${A.haze?x.glsl`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${A.reduced?x.glsl`cameraSpaceRay *= -textureBilinear(vuv0);`:x.glsl`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:x.glsl`${A.reduced?"":x.glsl`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${A.haze?x.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:x.glsl`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${A.haze?"":x.glsl`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `);return C}const v=h.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),y=h.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),D=h.fromValues(parseFloat(Number(v[0]+y[0]).toFixed(6)),parseFloat(Number(v[1]+y[1]).toFixed(6)),parseFloat(Number(v[2]+y[2]).toFixed(6))),G=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:v,
build:u},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=n;a.betaRayleigh=v;a.build=u})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,h){a.TextureCoordinateAttributeType=void 0;(function(k){k[k.None=0]="None";k[k.Default=1]="Default";k[k.Atlas=2]="Atlas";k[k.Compressed=3]="Compressed";k[k.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(k,m){switch(m.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:k.attributes.add(h.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(n.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:k.attributes.add(h.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.vertex.code.add(n.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:k.attributes.add(h.VertexAttribute.UV0,"vec2");k.varyings.add("vuv0","vec2");k.attributes.add(h.VertexAttribute.UVREGION,"vec4");k.varyings.add("vuvRegion","vec4");k.vertex.code.add(n.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:b.neverReached(m.textureCoordinateType);case a.TextureCoordinateAttributeType.None:k.vertex.code.add(n.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(k,...m){let g="";for(let e=0;e<m.length;e++)g+=k[e]+m[e];return g+=k[k.length-1]}class n{}const h=n;(function(k){k.int=
function(m){return Math.round(m).toString()};k.float=function(m){return m.toPrecision(8)}})(b||={});a.NoParameters=h;a.glsl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;(function(b){b.POSITION="position";b.NORMAL="normal";b.NORMALCOMPRESSED="normalCompressed";b.UV0="uv0";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";
b.PERSPECTIVEDIVIDE="perspectiveDivide";b.CENTEROFFSETANDDISTANCE="centerOffsetAndDistance";b.LENGTH="length";b.PREVPOSITION="prevPosition";b.NEXTPOSITION="nextPosition";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.PROFILERIGHT="profileRight";b.PROFILEUP=
"profileUp";b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.INSTANCEMODELORIGINHI="instanceModelOriginHi";b.INSTANCEMODELORIGINLO="instanceModelOriginLo";b.INSTANCEMODEL="instanceModel";b.INSTANCEMODELNORMAL="instanceModelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS=
"modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL="lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMAL2COMPRESSED="normal2Compressed";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";b.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";b.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(a.VertexAttribute||
(a.VertexAttribute={}));a.affectsGeometry=function(b){return b===a.VertexAttribute.POSITION};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl":function(){define(["exports","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,n){a.ReadDepth=function(h){h.code.add(n.glsl`float linearizeDepth(float depth, vec2 nearFar) {
float depthNdc = depth * 2.0 - 1.0;
return (2.0 * nearFar[0] * nearFar[1]) / (depthNdc * (nearFar[1] - nearFar[0]) - (nearFar[1] + nearFar[0]));
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return linearizeDepth(depth, nearFar);
}`)};a.ReadLinearDepth=function(h){h.include(b.RgbaFloatEncoding);h.code.add(n.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromRGBA(vec4 depth, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(depth), nearFar);
}
float linearDepthFromTexture(sampler2D depthTexture, vec2 uv, vec2 nearFar) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
return linearDepthFromRGBA(texelFetch(depthTexture, iuv, 0), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(n){n.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(n){n.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,n){function h(m){m.uniforms.add(new b.Float3PassUniform("mainLightDirection",(g,e)=>e.lighting.mainLight.direction))}function k(m){m.uniforms.add(new b.Float3PassUniform("mainLightIntensity",(g,e)=>e.lighting.mainLight.intensity))}a.MainLighting=
function(m){h(m.fragment);k(m.fragment);m.fragment.code.add(n.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=h;a.addMainLightIntensity=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec3",n.BindType.Pass,(g,e,d)=>g.setUniform3fv(k,m(e,d)))}}a.Float3PassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports",
"../shaderTechnique/BindType"],function(a,b){class n{constructor(h,k,m,g,e=null){this.name=h;this.type=k;this.arraySize=e;this.bind={[b.BindType.Pass]:null,[b.BindType.Draw]:null};if(g)switch(m){case b.BindType.Pass:this.bind[b.BindType.Pass]=g;break;case b.BindType.Draw:this.bind[b.BindType.Draw]=g}}equals(h){return this.type===h.type&&this.name===h.name&&this.arraySize===h.arraySize}}a.Uniform=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],
function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec2",n.BindType.Pass,(g,e,d)=>g.setUniform2fv(k,m(e,d)))}}a.Float2PassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec4",n.BindType.Pass,(g,e,d)=>g.setUniform4fv(k,m(e,d)))}}a.Float4PassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,
n){class h extends b.Uniform{constructor(k,m){super(k,"float",n.BindType.Pass,(g,e,d)=>g.setUniform1f(k,m(e,d)))}}a.FloatPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"mat4",n.BindType.Pass,(g,e,d)=>g.setUniformMatrix4fv(k,m(e,d)))}}a.Matrix4PassUniform=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../shaderTechnique/BindType","../../lib/Util"],function(a,b,n,h,k){const m=()=>n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class g{constructor(){this._includedModules=new Map}include(t,q){if(this._includedModules.has(t)){const u=this._includedModules.get(t);if(u!==q){m().error("Shader module included multiple times with different configuration.");
q=new Set;for(const v of Object.keys(u))u[v]!==t[v]&&q.add(v);for(const v of Object.keys(t))u[v]!==t[v]&&q.add(v);q.forEach(v=>console.error(`  ${v}: current ${u[v]} new ${t[v]}`))}}else this._includedModules.set(t,q),t(this.builder,q)}}class e extends g{constructor(){super(...arguments);this.vertex=new l;this.fragment=new l;this.attributes=new f;this.varyings=new r;this.extensions=new x;this.constants=new p;this.outputs=new w}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const q=
this.extensions.generateSource(t),u=this.attributes.generateSource(t),v=this.varyings.generateSource(t);var y="vertex"===t?this.vertex:this.fragment;const D=y.uniforms.generateSource(),G=y.code.generateSource(),A="vertex"===t?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";y=this.constants.generateSource().concat(y.constants.generateSource());
t=this.outputs.generateSource(t);return`#version 300 es\n${q.join("\n")}\n\n${A}\n\n${y.join("\n")}\n\n${D.join("\n")}\n\n${u.join("\n")}\n\n${v.join("\n")}\n\n${t.join("\n")}\n\n${G.join("\n")}`}generateBindPass(t){const q=new Map;this.vertex.uniforms.entries.forEach(y=>{const D=y.bind[h.BindType.Pass];D&&q.set(y.name,D)});this.fragment.uniforms.entries.forEach(y=>{const D=y.bind[h.BindType.Pass];D&&q.set(y.name,D)});const u=Array.from(q.values()),v=u.length;return(y,D)=>{for(let G=0;G<v;++G)u[G](t,
y,D)}}generateBindDraw(t){const q=new Map;this.vertex.uniforms.entries.forEach(y=>{const D=y.bind[h.BindType.Draw];D&&q.set(y.name,D)});this.fragment.uniforms.entries.forEach(y=>{const D=y.bind[h.BindType.Draw];D&&q.set(y.name,D)});const u=Array.from(q.values()),v=u.length;return(y,D,G)=>{for(let A=0;A<v;++A)u[A](t,y,D,G)}}}class d{constructor(){this._entries=new Map}add(...t){for(const q of t)this._add(q)}get(t){return this._entries.get(t)}_add(t){if(null==t)m().error(`Trying to add null Uniform from ${Error().stack}.`);
else{if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new b(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}}generateSource(){return Array.from(this._entries.values()).map(t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class c{constructor(){this._entries=[]}add(t){this._entries.push(t)}generateSource(){return this._entries}}
class l extends g{constructor(){super(...arguments);this.uniforms=new d;this.code=new c;this.constants=new p}get builder(){return this}}class f{constructor(){this._entries=[]}add(t,q){this._entries.push([t,q])}generateSource(t){return"fragment"===t?[]:this._entries.map(q=>`in ${q[1]} ${q[0]};`)}}class r{constructor(){this._entries=new Map}add(t,q){this._entries.has(t)&&k.assert(this._entries.get(t)===q);this._entries.set(t,q)}generateSource(t){const q=[];this._entries.forEach((u,v)=>q.push("vertex"===
t?`out ${u} ${v};`:`in ${u} ${v};`));return q}}class x{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const q="vertex"===t?x.ALLOWLIST_VERTEX:x.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(u=>q.includes(u)).map(u=>`#extension ${u} : enable`)}}x.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];x.ALLOWLIST_VERTEX=[];class w{constructor(){this._entries=new Map}add(t,q,u=0){const v=this._entries.get(u);v?k.assert(v.name===
t&&v.type===q,`Fragment shader output location ${u} occupied`):this._entries.set(u,{name:t,type:q})}generateSource(t){if("vertex"===t)return[];0===this._entries.size&&this._entries.set(0,{name:w.DEFAULT_NAME,type:w.DEFAULT_TYPE});const q=[];this._entries.forEach((u,v)=>q.push(`layout(location = ${v}) out ${u.type} ${u.name};`));return q}}w.DEFAULT_TYPE="vec4";w.DEFAULT_NAME="fragColor";class p{constructor(){this._entries=new Set}add(t,q,u){let v="ERROR_CONSTRUCTOR_STRING";switch(q){case "float":v=
p._numberToFloatStr(u);break;case "int":v=p._numberToIntStr(u);break;case "bool":v=u.toString();break;case "vec2":v=`vec2(${p._numberToFloatStr(u[0])},                            ${p._numberToFloatStr(u[1])})`;break;case "vec3":v=`vec3(${p._numberToFloatStr(u[0])},                            ${p._numberToFloatStr(u[1])},                            ${p._numberToFloatStr(u[2])})`;break;case "vec4":v=`vec4(${p._numberToFloatStr(u[0])},                            ${p._numberToFloatStr(u[1])},                            ${p._numberToFloatStr(u[2])},                            ${p._numberToFloatStr(u[3])})`;
break;case "ivec2":v=`ivec2(${p._numberToIntStr(u[0])},                             ${p._numberToIntStr(u[1])})`;break;case "ivec3":v=`ivec3(${p._numberToIntStr(u[0])},                             ${p._numberToIntStr(u[1])},                             ${p._numberToIntStr(u[2])})`;break;case "ivec4":v=`ivec4(${p._numberToIntStr(u[0])},                             ${p._numberToIntStr(u[1])},                             ${p._numberToIntStr(u[2])},                             ${p._numberToIntStr(u[3])})`;
break;case "mat2":case "mat3":case "mat4":v=`${q}(${Array.prototype.map.call(u,y=>p._numberToFloatStr(y)).join(", ")})`}this._entries.add(`const ${q} ${t} = ${v};`);return this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}a.Code=c;a.Includes=g;a.ShaderBuilder=e;a.Stage=l;a.Uniforms=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,n,h){function k(e,d){if(!e)throw d=d||"Assertion",new g(`${d} at ${Error(d).stack}`);}const m=h.create();class g{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}a.assert=k;a.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===
e[10]&&0===e[11]&&1===e[15]};a.logWithBase=function(e,d){return Math.log(e)/Math.log(d)};a.project=function(e,d,c,l,f){m[0]=e[0];m[1]=e[1];m[2]=e[2];m[3]=1;n.transformMat4(m,m,d);2<f.length&&(f[2]=-m[2]);n.transformMat4(m,m,c);k(0!==m[3]);f[0]=m[0]/m[3];f[1]=m[1]/m[3];f[2]=m[2]/m[3];f[0]=(.5*f[0]+.5)*l[2]+l[0];f[1]=(.5*f[1]+.5)*l[3]+l[1]};a.rayBoxTest=function(e,d,c,l){let f,r=(c[0]-e[0])/d[0],x=(l[0]-e[0])/d[0];r>x&&(f=r,r=x,x=f);let w=(c[1]-e[1])/d[1],p=(l[1]-e[1])/d[1];w>p&&(f=w,w=p,p=f);if(r>
p||w>x)return!1;w>r&&(r=w);p<x&&(x=p);c=(c[2]-e[2])/d[2];e=(l[2]-e[2])/d[2];c>e&&(f=c,c=e,e=f);if(r>e||c>x)return!1;e<x&&(x=e);return 0>x?!1:!0};a.rayRay2D=function(e,d,c,l,f,r=b.create()){const x=(l[f]-c[f])*(d[0]-e[0])-(l[0]-c[0])*(d[f]-e[f]);if(0===x)return!1;c=((l[0]-c[0])*(e[f]-c[f])-(l[f]-c[f])*(e[0]-c[0]))/x;r[0]=e[0]+c*(d[0]-e[0]);r[1]=e[f]+c*(d[f]-e[f]);return!0};a.setMatrixTranslation3=function(e,d,c,l){e[12]=d;e[13]=c;e[14]=l};a.verify=function(e,d){e||console.warn("Verify failed: "+(d||
"")+"\n"+Error("verify").stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"sampler2D",n.BindType.Pass,(g,e,d)=>g.bindTexture(k,m(e,d)))}}a.Texture2DPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],
function(a){class b{constructor(n,h){this._module=n;this._loadModule=h}get(){return this._module}async reload(){return this._module=await this._loadModule()}}a.ReloadableShaderModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,n){class h{constructor(k,m,g){this.release=g;this.initializeConfiguration(k,m);this._configuration=
m.snapshot();this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k)}destroy(){this._program=b.disposeMaybe(this._program);this._pipeline=this._configuration=null}reload(k){b.disposeMaybe(this._program);this._program=this.initializeProgram(k);this._pipeline=this.initializePipeline(k)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}ensureAttributeLocations(k){this.program.assertCompatibleVertexAttributeLocations(k)}get primitiveType(){return n.PrimitiveType.TRIANGLES}getPipeline(k,
m,g){return this._pipeline}initializeConfiguration(k,m){}}a.ShaderTechnique=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]=
"LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=
773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.MIN=32775]="MIN";b[b.MAX=32776]=
"MAX";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER";b[b.TRANSFORM_FEEDBACK_BUFFER=
35982]="TRANSFORM_FEEDBACK_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=
5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]=
"DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode=
{}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=
34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.ALPHA=
6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=
34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=
33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";
b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=
32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=
36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=
void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||
(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";
b[b.TransformFeedback=7]="TransformFeedback";b[b.Sync=8]="Sync";b[b.UNCOUNTED=9]="UNCOUNTED";b[b.LinesOfCode=9]="LinesOfCode";b[b.Uniform=10]="Uniform";b[b.COUNT=11]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=
36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=
36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.SpecialDrawBuffers=void 0;(function(b){b[b.NONE=0]="NONE";b[b.BACK=1029]="BACK"})(a.SpecialDrawBuffers||(a.SpecialDrawBuffers={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=
33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";
b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";
b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]=
"INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=
37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=
37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.DepthStencilAttachment=33306;a.baseTextureUnit=33984;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports",
"./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.NORMALCOMPRESSED,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.COLORFEATUREATTRIBUTE,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.CENTEROFFSETANDDISTANCE,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],
[b.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,7],[b.VertexAttribute.INSTANCEMODEL,8],[b.VertexAttribute.INSTANCEMODELNORMAL,12],[b.VertexAttribute.INSTANCEMODELORIGINHI,11],[b.VertexAttribute.INSTANCEMODELORIGINLO,15]]);a.Default3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/PooledArray","../../../webgl/checkWebGLError"],function(a,b,n){class h{constructor(k,
m,g){this._context=k;this._locations=g;this._textures=new Map;this._freeTextureUnits=new b({deallocator:null});this._glProgram=k.programCache.acquire(m.generate("vertex"),m.generate("fragment"),g);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=m.generateBindPass(this);this.bindDraw=m.generateBindDraw(this);this._fragmentUniforms=n.webglDebugEnabled()?m.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(k,
m){this._glProgram.setUniform1i(k,m?1:0)}setUniform1i(k,m){this._glProgram.setUniform1i(k,m)}setUniform1f(k,m){this._glProgram.setUniform1f(k,m)}setUniform2fv(k,m){this._glProgram.setUniform2fv(k,m)}setUniform3fv(k,m){this._glProgram.setUniform3fv(k,m)}setUniform4fv(k,m){this._glProgram.setUniform4fv(k,m)}setUniformMatrix3fv(k,m){this._glProgram.setUniformMatrix3fv(k,m)}setUniformMatrix4fv(k,m){this._glProgram.setUniformMatrix4fv(k,m)}setUniform1fv(k,m){this._glProgram.setUniform1fv(k,m)}setUniform1iv(k,
m){this._glProgram.setUniform1iv(k,m)}setUniform2iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform3iv(k,m){this._glProgram.setUniform3iv(k,m)}setUniform4iv(k,m){this._glProgram.setUniform4iv(k,m)}assertCompatibleVertexAttributeLocations(k){k.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear();this._freeTextureUnits.clear()}bindTexture(k,m){if(null==m?.glName){if(m=this._textures.get(k))this._context.bindTexture(null,m.unit),this._freeTextureUnit(m),
this._textures.delete(k);return null}let g=this._textures.get(k);null==g?(g=this._allocTextureUnit(m),this._textures.set(k,g)):g.texture=m;this._context.useProgram(this);this.setUniform1i(k,g.unit);this._context.bindTexture(m,g.unit);return g.unit}rebindTextures(){this._context.useProgram(this);this._textures.forEach((k,m)=>{this._context.bindTexture(k.texture,k.unit);this.setUniform1i(m,k.unit)});this._fragmentUniforms?.forEach(k=>{"sampler2D"!==k.type&&"samplerCube"!==k.type||this._textures.has(k.name)||
console.error(`Texture sampler ${k.name} has no bound texture`)})}_allocTextureUnit(k){return{texture:k,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(k){this._freeTextureUnits.push(k.unit)}}a.Program=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,b,n,h){function k(g,e){switch(e){case g.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case g.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case g.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case g.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case g.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case g.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const m=!!n("enable-feature:webgl-debug");a.checkWebGLError=function(g){if(m){var e=g.getError();e&&(g=k(g,e),e=Error().stack,h.getLogger("esri.views.webgl.checkWebGLError").error(new b("webgl-error","WebGL error occurred",{message:g,stack:e})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,n){function h(N){return E.intern(N)}function k(N){return I.intern(N)}function m(N){return H.intern(N)}function g(N){return J.intern(N)}function e(N){return B.intern(N)}function d(N){return z.intern(N)}function c(N){return K.intern(N)}function l(N){return L.intern(N)}function f(N){return F.intern(N)}function r(N){return"["+N.join(",")+"]"}function x(N){return N?r([N.srcRgb,N.srcAlpha,N.dstRgb,N.dstAlpha,N.opRgb,N.opAlpha,N.color.r,N.color.g,
N.color.b,N.color.a]):null}function w(N){return N?r([N.face,N.mode]):null}function p(N){return N?r([N.factor,N.units]):null}function t(N){return N?r([N.func]):null}function q(N){return N?r([N.function.func,N.function.ref,N.function.mask,N.operation.fail,N.operation.zFail,N.operation.zPass]):null}function u(N){return N?r([N.zNear,N.zFar]):null}function v(N){return N?r([N.r,N.g,N.b,N.a]):null}function y(N){return N?r([N.mask]):null}function D(N){return N?r(N.buffers):null}const G={face:n.Face.BACK,
mode:n.CullMode.CCW},A={face:n.Face.FRONT,mode:n.CullMode.CCW};class C{constructor(N,P){this._makeKey=N;this._makeRef=P;this._interns=new Map}intern(N){if(!N)return null;const P=this._makeKey(N),R=this._interns;R.has(P)||R.set(P,this._makeRef(N));return R.get(P)??null}}const E=new C(x,N=>({__tag:"Blending",...N})),I=new C(w,N=>({__tag:"Culling",...N})),H=new C(p,N=>({__tag:"PolygonOffset",...N})),J=new C(t,N=>({__tag:"DepthTest",...N})),B=new C(q,N=>({__tag:"StencilTest",...N})),z=new C(u,N=>({__tag:"DepthWrite",
...N})),K=new C(v,N=>({__tag:"ColorWrite",...N})),L=new C(y,N=>({__tag:"StencilWrite",...N})),F=new C(D,N=>({__tag:"DrawBuffers",...N})),M=new C(function(N){return N?r([x(N.blending),w(N.culling),p(N.polygonOffset),t(N.depthTest),q(N.stencilTest),u(N.depthWrite),v(N.colorWrite),y(N.stencilWrite),D(N.drawBuffers)]):null},N=>({blending:h(N.blending),culling:k(N.culling),polygonOffset:m(N.polygonOffset),depthTest:g(N.depthTest),stencilTest:e(N.stencilTest),depthWrite:d(N.depthWrite),colorWrite:c(N.colorWrite),
stencilWrite:l(N.stencilWrite),drawBuffers:f(N.drawBuffers)}));class S{constructor(N){this._drawBuffersInvalid=this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=N}setPipeline(N){if(this._pipelineInvalid||N!==this._pipeline)this._setBlending(N.blending),this._setCulling(N.culling),this._setPolygonOffset(N.polygonOffset),
this._setDepthTest(N.depthTest),this._setStencilTest(N.stencilTest),this._setDepthWrite(N.depthWrite),this._setColorWrite(N.colorWrite),this._setStencilWrite(N.stencilWrite),this._setDrawBuffers(N.drawBuffers),this._pipeline=N;this._pipelineInvalid=!1}invalidateBlending(){this._pipelineInvalid=this._blendingInvalid=!0}invalidateCulling(){this._pipelineInvalid=this._cullingInvalid=!0}invalidatePolygonOffset(){this._pipelineInvalid=this._polygonOffsetInvalid=!0}invalidateDepthTest(){this._pipelineInvalid=
this._depthTestInvalid=!0}invalidateStencilTest(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDepthWrite(){this._pipelineInvalid=this._depthWriteInvalid=!0}invalidateColorWrite(){this._pipelineInvalid=this._colorWriteInvalid=!0}invalidateStencilWrite(){this._pipelineInvalid=this._stencilTestInvalid=!0}invalidateDrawBuffers(){this._pipelineInvalid=this._drawBuffersInvalid=!0}_setBlending(N){this._blending=this._setSubState(N,this._blending,this._blendingInvalid,this._stateSetters.setBlending);
this._blendingInvalid=!1}_setCulling(N){this._culling=this._setSubState(N,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1}_setPolygonOffset(N){this._polygonOffset=this._setSubState(N,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1}_setDepthTest(N){this._depthTest=this._setSubState(N,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1}_setStencilTest(N){this._stencilTest=
this._setSubState(N,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1}_setDepthWrite(N){this._depthWrite=this._setSubState(N,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1}_setColorWrite(N){this._colorWrite=this._setSubState(N,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1}_setStencilWrite(N){this._stencilWrite=this._setSubState(N,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1}_setDrawBuffers(N){this._drawBuffers=this._setSubState(N,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers);this._drawBuffersInvalid=!1}_setSubState(N,P,R,O){if(R||N!==P)O(N),this._pipelineInvalid=!0;return N}}a.StateTracker=S;a.backFaceCullingParams=G;a.cullingParams=N=>N===b.CullFaceOptions.Back?G:N===b.CullFaceOptions.Front?A:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};
a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=A;a.makeBlending=h;a.makeColorWrite=c;a.makeCulling=k;a.makeDepthTest=g;a.makeDepthWrite=d;a.makeDrawBuffers=f;a.makePipelineState=function(N){return M.intern(N)};a.makePolygonOffset=m;a.makeStencilTest=e;a.makeStencilWrite=l;a.separateBlendingParams=function(N,P,R,O,T=n.BlendOperation.ADD,Q=n.BlendOperation.ADD,V=[0,0,0,0]){return{srcRgb:N,srcAlpha:P,dstRgb:R,dstAlpha:O,opRgb:T,opAlpha:Q,color:{r:V[0],g:V[1],b:V[2],a:V[3]}}};a.simpleBlendingParams=
function(N,P,R=n.BlendOperation.ADD,O=[0,0,0,0]){return{srcRgb:N,srcAlpha:N,dstRgb:P,dstAlpha:P,opRgb:R,opAlpha:R,color:{r:O[0],g:O[1],b:O[2],a:O[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=
0]="Less";b[b.Lequal=1]="Lequal";b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=
2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.Object3DState=void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||
(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(b){b.DDS_ENCODING="image/vnd-ms.dds";b.KTX2_ENCODING="image/ktx2";b.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);
this.reduced=this.haze=!1}}b.__decorate([n.parameter()],h.prototype,"haze",void 0);b.__decorate([n.parameter()],h.prototype,"reduced",void 0);a.ChapmanAtmosphereTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class n extends b.NoParameters{constructor(){super();this._key="";this._keyDirty=!1;this._parameterBits=
this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}get key(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}snapshot(){const h=this._parameterNames,k={key:this.key};for(const m of h)k[m]=this[m];return k}}a.ShaderTechniqueConfiguration=n;a.parameter=function(h={}){return(k,m)=>{k._parameterNames=k._parameterNames??[];k._parameterNames.push(m);if(null!=h.constValue)Object.defineProperty(k,
m,{get(){return h.constValue}});else{const g=k._parameterNames.length-1,e=Math.ceil(Math.log2(h.count||2)),d=k._parameterBits??[0];let c=0;for(;16<d[c]+e;)c++,c>=d.length&&d.push(0);k._parameterBits=d;const l=d[c],f=(1<<e)-1<<l;d[c]+=e;Object.defineProperty(k,m,{get(){return this[g]},set(r){if(this[g]!==r&&(this[g]=r,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~f|+r<<l&f,"number"!==typeof r&&"boolean"!==typeof r))throw Error("Configuration value for "+m+" must be boolean or number, got "+
typeof r);}})}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/formats":function(){define(["exports"],function(a){a.ColorFormat=void 0;(function(b){b[b.RED=0]="RED";b[b.RG=1]="RG";b[b.RGBA4=2]="RGBA4";b[b.RGBA=3]="RGBA";b[b.RGBA_MIPMAP=4]="RGBA_MIPMAP";b[b.R16F=5]="R16F";b[b.RGBA16F=6]="RGBA16F"})(a.ColorFormat||(a.ColorFormat={}));a.DepthFormat=void 0;(function(b){b[b.DEPTH_STENCIL_TEXTURE=0]="DEPTH_STENCIL_TEXTURE";b[b.DEPTH16_BUFFER=1]="DEPTH16_BUFFER"})(a.DepthFormat||
(a.DepthFormat={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,n,h){const k=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,3,n.DataType.FLOAT,0,12)],m=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,3,n.DataType.FLOAT,0,20),new h.VertexElementDescriptor(b.VertexAttribute.UV0,
2,n.DataType.FLOAT,12,20)],g=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,3,n.DataType.FLOAT,0,32),new h.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,n.DataType.FLOAT,12,32),new h.VertexElementDescriptor(b.VertexAttribute.UV0,2,n.DataType.FLOAT,24,32)],e=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,3,n.DataType.FLOAT,0,16),new h.VertexElementDescriptor(b.VertexAttribute.COLOR,4,n.DataType.UNSIGNED_BYTE,12,16)],d=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,
2,n.DataType.FLOAT,0,8)];b=[new h.VertexElementDescriptor(b.VertexAttribute.POSITION,2,n.DataType.FLOAT,0,16),new h.VertexElementDescriptor(b.VertexAttribute.UV0,2,n.DataType.FLOAT,8,16)];a.Pos2=d;a.Pos2Tex=b;a.Pos3=k;a.Pos3Col=e;a.Pos3NormalTex=g;a.Pos3Tex=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){class b{constructor(n,h,k,m,g,e=!1,d=0){this.name=n;this.count=h;this.type=k;this.offset=m;this.stride=
g;this.normalized=e;this.divisor=d}}a.VertexElementDescriptor=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,n,h,k,m,g,e){a.createEmptyTexture=function(d){const c=new e.TextureDescriptor(4);c.samplingMode=
m.TextureSamplingMode.NEAREST;return new g.Texture(d,c)};a.createQuadVAO=function(d,c=n.Pos2,l=b.Default3D,f=-1,r=1){let x=null;switch(c){case n.Pos2Tex:x=new Float32Array([f,f,0,0,r,f,1,0,f,r,0,1,r,r,1,1]);break;default:x=new Float32Array([f,f,r,f,f,r,r,r])}return new h.VertexArrayObject(d,l,{geometry:c},{geometry:k.BufferObject.createVertex(d,m.Usage.STATIC_DRAW,x)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports",
"../../../webgl/VertexArrayObject"],function(a,b){class n extends b.VertexArrayObject{}a.VertexArrayObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./enums ./Util".split(" "),function(a,b,n,h,k,m){const g=()=>b.getLogger("esri.views.webgl.VertexArrayObject");a.VertexArrayObject=class{constructor(e,d,c,l,f=null){this._context=e;this._locations=d;this._layout=
c;this._buffers=l;this._indexBuffer=f;this._glName=null;this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,d)=>e+this._buffers[d].usedMemory,null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+
(this._indexBuffer?1:0))*h.typedArrayStaticSize}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const e in this._buffers)this._buffers[e]?.dispose(),delete this._buffers[e];this._indexBuffer=n.disposeMaybe(this._indexBuffer);this.disposeVAOOnly()}else(this._glName||0<Object.getOwnPropertyNames(this._buffers).length)&&g().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(k.ResourceType.VertexArrayObject,
this));this._context=null}initialize(){if(!this._initialized){var {gl:e}=this._context,d=e.createVertexArray();e.bindVertexArray(d);this._bindLayout();e.bindVertexArray(null);this._glName=d;this._context.instanceCounter.increment(k.ResourceType.VertexArrayObject,this);this._initialized=!0}}bind(){this.initialize();this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const {_buffers:e,_layout:d,_indexBuffer:c}=this;e||g().error("Vertex buffer dictionary is empty!");const l=this._context.gl;
for(const f in e){const r=e[f];r||g().error("Vertex buffer is uninitialized!");const x=d[f];x||g().error("Vertex element descriptor is empty!");m.bindVertexBufferLayout(this._context,this._locations,r,x)}null!=c&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.glName)}unbind(){this.initialize();this._context.gl.bindVertexArray(null)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./getDataTypeBytes"],
function(a,b,n,h,k){function m(e){e=e.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";
case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function g(e){return e[0].stride}a.bindVertexBufferLayout=function(e,d,c,l,f=0){const r=e.gl;e.bindBuffer(c);for(const w of l)if(l=d.get(w.name),void 0===l)console.warn(`There is no location for vertex attribute '${w.name}' defined.`);else{c=f*w.stride;if(4>=w.count)r.vertexAttribPointer(l,w.count,w.type,w.normalized,w.stride,w.offset+c),r.enableVertexAttribArray(l),0<w.divisor&&e.gl.vertexAttribDivisor(l,w.divisor);else if(9===
w.count)for(var x=0;3>x;x++)r.vertexAttribPointer(l+x,3,w.type,w.normalized,w.stride,w.offset+12*x+c),r.enableVertexAttribArray(l+x),0<w.divisor&&e.gl.vertexAttribDivisor(l+x,w.divisor);else if(16===w.count)for(x=0;4>x;x++)r.vertexAttribPointer(l+x,4,w.type,w.normalized,w.stride,w.offset+16*x+c),r.enableVertexAttribArray(l+x),0<w.divisor&&e.gl?.vertexAttribDivisor(l+x,w.divisor);else console.error("Unsupported vertex attribute element count: "+w.count);if(n.webglDebugEnabled()){l=m(e);x=k.getDataTypeBytes(w.type);
const p=w.offset;x=Math.round(x/p)!==x/p?`. Offset not a multiple of stride. DataType requires ${x} bytes, but descriptor has an offset of ${p}`:"";l&&console.error(`Unable to bind vertex attribute "${w.name}" with baseInstanceOffset ${c}${x}:`,l,w)}}};a.getBytesPerElementFormat=function(e){switch(e){case h.PixelFormat.ALPHA:case h.PixelFormat.LUMINANCE:case h.PixelFormat.RED:case h.PixelFormat.RED_INTEGER:case h.SizedPixelFormat.R8:case h.SizedPixelFormat.R8I:case h.SizedPixelFormat.R8UI:case h.SizedPixelFormat.R8_SNORM:case h.RenderbufferFormat.STENCIL_INDEX8:return 1;
case h.PixelFormat.LUMINANCE_ALPHA:case h.PixelFormat.RG:case h.PixelFormat.RG_INTEGER:case h.SizedPixelFormat.RGBA4:case h.SizedPixelFormat.R16F:case h.SizedPixelFormat.R16I:case h.SizedPixelFormat.R16UI:case h.SizedPixelFormat.RG8:case h.SizedPixelFormat.RG8I:case h.SizedPixelFormat.RG8UI:case h.SizedPixelFormat.RG8_SNORM:case h.SizedPixelFormat.RGB565:case h.SizedPixelFormat.RGB5_A1:case h.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case h.PixelFormat.DEPTH_COMPONENT:case h.PixelFormat.RGB:case h.PixelFormat.RGB_INTEGER:case h.SizedPixelFormat.RGB8:case h.SizedPixelFormat.RGB8I:case h.SizedPixelFormat.RGB8UI:case h.SizedPixelFormat.RGB8_SNORM:case h.SizedPixelFormat.SRGB8:case h.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case h.PixelFormat.DEPTH_STENCIL:case h.PixelFormat.DEPTH24_STENCIL8:case h.PixelFormat.RGBA:case h.PixelFormat.RGBA_INTEGER:case h.SizedPixelFormat.RGBA8:case h.SizedPixelFormat.R32F:case h.SizedPixelFormat.R11F_G11F_B10F:case h.SizedPixelFormat.RG16F:case h.SizedPixelFormat.R32I:case h.SizedPixelFormat.R32UI:case h.SizedPixelFormat.RG16I:case h.SizedPixelFormat.RG16UI:case h.SizedPixelFormat.RGBA8I:case h.SizedPixelFormat.RGBA8UI:case h.SizedPixelFormat.RGBA8_SNORM:case h.SizedPixelFormat.SRGB8_ALPHA8:case h.SizedPixelFormat.RGB9_E5:case h.SizedPixelFormat.RGB10_A2UI:case h.SizedPixelFormat.RGB10_A2:case h.RenderbufferFormat.DEPTH_STENCIL:case h.RenderbufferFormat.DEPTH_COMPONENT32F:case h.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case h.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case h.SizedPixelFormat.RGB16F:case h.SizedPixelFormat.RGB16I:case h.SizedPixelFormat.RGB16UI:return 6;case h.SizedPixelFormat.RG32F:case h.SizedPixelFormat.RG32I:case h.SizedPixelFormat.RG32UI:case h.SizedPixelFormat.RGBA16F:case h.SizedPixelFormat.RGBA16I:case h.SizedPixelFormat.RGBA16UI:return 8;case h.SizedPixelFormat.RGB32F:case h.SizedPixelFormat.RGB32I:case h.SizedPixelFormat.RGB32UI:return 12;case h.SizedPixelFormat.RGBA32F:case h.SizedPixelFormat.RGBA32I:case h.SizedPixelFormat.RGBA32UI:return 16;
case h.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case h.CompressedTextureFormat.COMPRESSED_R11_EAC:case h.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case h.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case h.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case h.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case h.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case h.CompressedTextureFormat.COMPRESSED_RG11_EAC:case h.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case h.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case h.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0};a.getErrorString=m;a.getStride=g;a.unbindVertexBufferLayout=function(e,d,c,l){const f=e.gl;e.bindBuffer(c);for(const r of l)if(c=d.get(r.name),4>=r.count)f.disableVertexAttribArray(c),r.divisor&&0<r.divisor&&e.gl?.vertexAttribDivisor(c,0);else if(9===r.count)for(l=
0;3>l;l++)f.disableVertexAttribArray(c+l),r.divisor&&0<r.divisor&&e.gl?.vertexAttribDivisor(c+l,0);else if(16===r.count)for(l=0;4>l;l++)f.disableVertexAttribArray(c+l),r.divisor&&0<r.divisor&&e.gl?.vertexAttribDivisor(c+l,0);else console.error("Unsupported vertex attribute element count: "+r.count);e.unbindBuffer(h.BufferType.ARRAY_BUFFER)};a.vertexCount=function(e,d){return e.vertexBuffers[d].usedMemory/g(e.layout[d])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports",
"./enums"],function(a,b){a.getDataTypeBytes=function(n){switch(n){case b.DataType.BYTE:case b.DataType.UNSIGNED_BYTE:return 1;case b.DataType.SHORT:case b.DataType.UNSIGNED_SHORT:return 2;case b.DataType.FLOAT:case b.DataType.INT:case b.DataType.UNSIGNED_INT:return 4}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../core/arrayUtils ../../core/Logger ../../core/typedArrayUtil ./checkWebGLError ./enums".split(" "),function(a,
b,n,h,k,m){const g=()=>n.getLogger("esri.views.webgl.BufferObject");class e{static createIndex(d,c,l){return new e(d,m.BufferType.ELEMENT_ARRAY_BUFFER,c,l)}static createVertex(d,c,l){return new e(d,m.BufferType.ARRAY_BUFFER,c,l)}static createUniform(d,c,l){return new e(d,m.BufferType.UNIFORM_BUFFER,c,l)}static createPixelPack(d,c=m.Usage.STREAM_READ,l){d=new e(d,m.BufferType.PIXEL_PACK_BUFFER,c);l&&d.setSize(l);return d}static createPixelUnpack(d,c=m.Usage.STREAM_DRAW,l){return new e(d,m.BufferType.PIXEL_UNPACK_BUFFER,
c,l)}static createTransformFeedback(d,c=m.Usage.STATIC_DRAW,l){d=new e(d,m.BufferType.TRANSFORM_FEEDBACK_BUFFER,c);d.setSize(l);return d}constructor(d,c,l,f){this._context=d;this.bufferType=c;this.usage=l;this._glName=null;this._size=-1;this._indexType=void 0;d.instanceCounter.increment(m.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();k.checkWebGLError(this._context.gl);f&&this.setData(f)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get usedMemory(){return this.bufferType===
m.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===m.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===m.BufferType.ARRAY_BUFFER}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(m.ResourceType.BufferObject,this),this._context=null):this._glName&&g().warn("Leaked WebGL buffer object")}setSize(d,c=
null){0>=d&&g().error("Buffer size needs to be positive!");if(this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&null!=c)switch(this._indexType=c,c){case m.DataType.UNSIGNED_SHORT:d*=2;break;case m.DataType.UNSIGNED_INT:d*=4}this._setBufferData(d)}setData(d){if(d){var c=d.byteLength;this.bufferType===m.BufferType.ELEMENT_ARRAY_BUFFER&&(h.isUint16Array(d)&&(c/=2,this._indexType=m.DataType.UNSIGNED_SHORT),h.isUint32Array(d)&&(c/=4,this._indexType=m.DataType.UNSIGNED_INT));this._setBufferData(c,d)}}_setBufferData(d,
c=null){this._size=d;const l=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const f=this._context.gl;null!=c?f.bufferData(this.bufferType,c,this.usage):f.bufferData(this.bufferType,d,this.usage);k.checkWebGLError(f);this._isVAOAware&&this._context.bindVAO(l)}setSubData(d,c,l,f){if(d){(0>c||c*d.BYTES_PER_ELEMENT>=this.usedMemory)&&g().error("offset is out of range!");l>=f&&g().error("end must be bigger than start!");(c+(f-l))*d.BYTES_PER_ELEMENT>
this.usedMemory&&g().error("An attempt to write beyond the end of the buffer!");var r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var {gl:x}=this._context;x.bufferSubData(this.bufferType,c*d.BYTES_PER_ELEMENT,d,l,f-l);k.checkWebGLError(x);this._isVAOAware&&this._context.bindVAO(r)}}getSubData(d,c=0,l,f){if(0>l||0>f)g().error("Problem getting subdata: offset and length were less than zero!");else{var r=b.isArrayLike(d)?d.BYTES_PER_ELEMENT:
1;r*((l??0)+(f??0))>d.byteLength?g().error("Problem getting subdata: offset and length exceeded destination size!"):(c+r*(f??0)>this.usedMemory&&g().warn("Potential problem getting subdata: requested data exceeds buffer size!"),r=this._context.gl,this.bufferType===m.BufferType.TRANSFORM_FEEDBACK_BUFFER?(this._context.bindBuffer(this,m.BufferType.TRANSFORM_FEEDBACK_BUFFER),r.getBufferSubData(m.BufferType.TRANSFORM_FEEDBACK_BUFFER,c,d,l,f),this._context.unbindBuffer(m.BufferType.TRANSFORM_FEEDBACK_BUFFER)):
(this._context.bindBuffer(this,m.BufferType.COPY_READ_BUFFER),r.getBufferSubData(m.BufferType.COPY_READ_BUFFER,c,d,l,f),this._context.unbindBuffer(m.BufferType.COPY_READ_BUFFER)))}}async getSubDataAsync(d,c=0,l,f){await this._context.clientWaitAsync();this.getSubData(d,c,l,f)}}a.BufferObject=e;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../core/Error ../../core/has ./checkWebGLError ./enums ./GLObjectType ./TextureDescriptor ./ValidatedTextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e){function d(t){(null!=t.width&&0>t.width||null!=t.height&&0>t.height||null!=t.depth&&0>t.depth)&&console.error("Negative dimension parameters are not allowed!")}function c(t,q){let u=q.samplingMode,v=q.samplingMode;if(u===k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||u===k.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)u=k.TextureSamplingMode.LINEAR,q.hasMipmap||(v=k.TextureSamplingMode.LINEAR);else if(u===k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||u===k.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)u=
k.TextureSamplingMode.NEAREST,q.hasMipmap||(v=k.TextureSamplingMode.NEAREST);t.texParameteri(q.target,t.TEXTURE_MAG_FILTER,u);t.texParameteri(q.target,t.TEXTURE_MIN_FILTER,v)}function l(t,q){"number"===typeof q.wrapMode?(t.texParameteri(q.target,t.TEXTURE_WRAP_S,q.wrapMode),t.texParameteri(q.target,t.TEXTURE_WRAP_T,q.wrapMode)):(t.texParameteri(q.target,t.TEXTURE_WRAP_S,q.wrapMode.s),t.texParameteri(q.target,t.TEXTURE_WRAP_T,q.wrapMode.t))}function f(t,q){const u=t.capabilities.textureFilterAnisotropic;
u&&t.gl.texParameterf(q.target,u.TEXTURE_MAX_ANISOTROPY,q.maxAnisotropy??1)}function r(t){return null!=t&&"type"in t&&"compressed"===t.type}function x(t){return null!=t&&!r(t)&&!(null!=t&&"byteLength"in t)}function w(t){return t===k.TextureType.TEXTURE_3D||t===k.TextureType.TEXTURE_2D_ARRAY}function p(t,q,u,v=1){q=Math.max(q,u);t===k.TextureType.TEXTURE_3D&&(q=Math.max(q,v));return Math.round(Math.log(q)/Math.LN2)+1}n=class t{constructor(q,u=null,v=null){this.type=m.GLObjectType.Texture;this._glName=
null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;if("context"in q)this._descriptor=q,v=u;else{q=e.ValidatedTextureDescriptor.validate(q,u);if(!q)throw new b("Texture descriptor invalid");this._descriptor=q}this._descriptor.target===k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(v):this.setData(v)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return g.estimateMemory(this._descriptor)}get isDirty(){return this._samplingModeDirty||
this._wrapModeDirty}dispose(){this._glName&&this._descriptor.context.instanceCounter.decrement(k.ResourceType.Texture,this);this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null)}release(){this.dispose()}resize(q,u){const v=this._descriptor;if(v.width!==q||v.height!==u){if(this._wasImmutablyAllocated)throw new b("Immutable textures can't be resized!");v.width=q;v.height=u;this._descriptor.target===
k.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(q=null){for(let u=k.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;u<=k.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;u++)this._setData(q,u)}setData(q){this._setData(q)}_setData(q,u){if(this._descriptor.context?.gl){var v=this._descriptor.context.gl;h.checkWebGLError(v);this._glName||(this._glName=v.createTexture())&&this._descriptor.context.instanceCounter.increment(k.ResourceType.Texture,this);void 0===q&&(q=null);
var y=this._descriptor,D=u??y.target,G=w(D);null===q&&(y.width=y.width||4,y.height=y.height||4,G&&(y.depth=y.depth??1));u=this._descriptor.context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);d(y);this._configurePixelStorage();h.checkWebGLError(v);var A=this._deriveInternalFormat();if(x(q)){let C="width"in q?q.width:q.codedWidth,E="height"in q?q.height:q.codedHeight;q instanceof HTMLVideoElement&&(C=q.videoWidth,E=q.videoHeight);
y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(D,A,y.hasMipmap,C,E,1);this._texImage(D,0,A,C,E,1,q);h.checkWebGLError(v);y.hasMipmap&&this.generateMipmap();y.width||(y.width=C);y.height||(y.height=E);G&&!y.depth&&(y.depth=1)}else{const {width:C,height:E,depth:I}=y;if(null==C||null==E)throw new b("Width and height must be specified!");if(G&&null==I)throw new b("Depth must be specified!");y.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(D,A,y.hasMipmap,C,E,I);if(r(q)){const H=
q.levels;q=p(D,C,E,I);q=Math.min(q-1,H.length-1);v.texParameteri(y.target,this._descriptor.context.gl.TEXTURE_MAX_LEVEL,q);if(!(A in k.CompressedTextureFormat))throw new b("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((J,B,z,K)=>{this._compressedTexImage(D,J,A,B,z,K,H[Math.min(J,H.length-1)])},q)}else this._texImage(D,0,A,C,E,I,q),h.checkWebGLError(v),y.hasMipmap&&this.generateMipmap()}c(v,this._descriptor);l(v,this._descriptor);f(this._descriptor.context,
this._descriptor);h.checkWebGLError(v);this._descriptor.context.bindTexture(u,t.TEXTURE_UNIT_FOR_UPDATES)}}updateData(q,u,v,y,D,G,A=0){G||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var C=this._descriptor;const E=this._deriveInternalFormat(),{context:I,pixelFormat:H,dataType:J,target:B,isImmutable:z}=C;if(z&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");const K=I.bindTexture(this,
t.TEXTURE_UNIT_FOR_UPDATES,!0);(0>u||0>v||y>C.width||D>C.height||u+y>C.width||v+D>C.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:C}=I);A&&C.pixelStorei(C.UNPACK_SKIP_ROWS,A);x(G)?C.texSubImage2D(B,q,u,v,y,D,H,J,G):r(G)?C.compressedTexSubImage2D(B,q,u,v,y,D,E,G.levels[q]):C.texSubImage2D(B,q,u,v,y,D,H,J,G);A&&C.pixelStorei(C.UNPACK_SKIP_ROWS,0);I.bindTexture(K,t.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(q,u,v,y,D,G,A,C){C||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var E=this._descriptor;const I=this._deriveInternalFormat(),{context:H,pixelFormat:J,dataType:B,isImmutable:z,target:K}=E;if(z&&!this._wasImmutablyAllocated)throw new b("Cannot update immutable texture before allocation!");w(K)||console.warn("Attempting to set 3D texture data on a non-3D texture");const L=H.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);H.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);(0>u||0>v||0>y||D>E.width||
G>E.height||A>E.depth||u+D>E.width||v+G>E.height||y+A>E.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();({gl:E}=H);r(C)?(C=C.levels[q],E.compressedTexSubImage3D(K,q,u,v,y,D,G,A,I,C)):E.texSubImage3D(K,q,u,v,y,D,G,A,J,B,C);H.bindTexture(L,t.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const q=this._descriptor;if(!q.hasMipmap){if(this._wasImmutablyAllocated)throw new b("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=
q.hasMipmap=!0;d(q)}q.samplingMode===k.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,q.samplingMode=k.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):q.samplingMode===k.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,q.samplingMode=k.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const u=this._descriptor.context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.gl.generateMipmap(q.target);this._descriptor.context.bindTexture(u,
t.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(q){q!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=q,this._samplingModeDirty=!0)}setWrapMode(q){q!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=q,d(this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const q=this._descriptor,u=q.context.gl;this._samplingModeDirty&&(c(u,q),this._samplingModeDirty=!1);this._wrapModeDirty&&(l(u,q),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(null!=this._descriptor.internalFormat)return this._descriptor.internalFormat===
k.PixelFormat.DEPTH_STENCIL&&(this._descriptor.internalFormat=k.PixelFormat.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case k.PixelType.FLOAT:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=k.SizedPixelFormat.RGBA32F;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB32F;default:throw new b("Unable to derive format");}case k.PixelType.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case k.PixelFormat.RGBA:return this._descriptor.internalFormat=
k.SizedPixelFormat.RGBA8;case k.PixelFormat.RGB:return this._descriptor.internalFormat=k.SizedPixelFormat.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===k.PixelFormat.DEPTH_STENCIL?k.PixelFormat.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const q=this._descriptor.context.gl,{unpackAlignment:u,flipped:v,preMultiplyAlpha:y}=this._descriptor;q.pixelStorei(q.UNPACK_ALIGNMENT,u);q.pixelStorei(q.UNPACK_FLIP_Y_WEBGL,v?1:0);q.pixelStorei(q.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
y?1:0)}_texStorage(q,u,v,y,D,G){const {gl:A}=this._descriptor.context;if(!(u in k.SizedPixelFormat))throw new b("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){v=v?p(q,y,D,G):1;if(w(q)){if(null==G)throw new b("Missing depth dimension for 3D texture upload");A.texStorage3D(q,v,u,y,D,G)}else A.texStorage2D(q,v,u,y,D);this._wasImmutablyAllocated=!0}}_texImage(q,u,v,y,D,G,A){const C=this._descriptor.context.gl,E=w(q),{isImmutable:I,pixelFormat:H,dataType:J}=this._descriptor;
if(I){if(null!=A)if(E){if(null==G)throw new b("Missing depth dimension for 3D texture upload");C.texSubImage3D(q,u,0,0,0,y,D,G,H,J,A)}else C.texSubImage2D(q,u,0,0,y,D,H,J,A)}else if(E){if(null==G)throw new b("Missing depth dimension for 3D texture upload");C.texImage3D(q,u,v,y,D,G,0,H,J,A)}else C.texImage2D(q,u,v,y,D,0,H,J,A)}_compressedTexImage(q,u,v,y,D,G,A){const C=this._descriptor.context.gl,E=w(q);if(this._descriptor.isImmutable){if(null!=A)if(E){if(null==G)throw new b("Missing depth dimension for 3D texture upload");
C.compressedTexSubImage3D(q,u,0,0,0,y,D,G,v,A)}else C.compressedTexSubImage2D(q,u,0,0,y,D,v,A)}else if(E){if(null==G)throw new b("Missing depth dimension for 3D texture upload");C.compressedTexImage3D(q,u,v,y,D,G,0,A)}else C.compressedTexImage2D(q,u,v,y,D,0,A)}_forEachMipmapLevel(q,u=Infinity){let {width:v,height:y,depth:D,hasMipmap:G,target:A}=this._descriptor;const C=A===k.TextureType.TEXTURE_3D;if(null==v||null==y||C&&null==D)throw new b("Missing texture dimensions for mipmap calculation");for(let E=
0;;++E){q(E,v,y,D);if(!G||1===v&&1===y&&(!C||1===D)||E>=u)break;v=Math.max(1,v>>1);y=Math.max(1,y>>1);C&&(D=Math.max(1,D>>1))}}};n.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=n;a.tracer=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/GLObjectType":function(){define(["exports"],function(a){a.GLObjectType=void 0;var b=a.GLObjectType||(a.GLObjectType={});b[b.Texture=0]="Texture";b[b.RenderBuffer=1]="RenderBuffer";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(a,b,n){class h{constructor(k=0,m=k){this.width=k;this.height=m;this.target=b.TextureType.TEXTURE_2D;this.pixelFormat=b.PixelFormat.RGBA;this.dataType=b.PixelType.UNSIGNED_BYTE;this.samplingMode=b.TextureSamplingMode.LINEAR;this.wrapMode=b.TextureWrapMode.REPEAT;this.maxAnisotropy=1;this.isOpaque=this.hasMipmap=this.flipped=!1;this.unpackAlignment=4;this.preMultiplyAlpha=!1;this.depth=1;this.isImmutable=
!1}}a.TextureDescriptor=h;a.estimateMemory=function(k){return 0>=k.width||0>=k.height?0:Math.round(k.width*k.height*(k.hasMipmap?4/3:1)*(null==k.internalFormat?4:n.getBytesPerElementFormat(k.internalFormat)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(a,b,n){class h extends n.TextureDescriptor{constructor(k,m){super();this.context=k;Object.assign(this,m);switch(this.internalFormat){case b.SizedPixelFormat.R16F:case b.SizedPixelFormat.R16I:case b.SizedPixelFormat.R16UI:case b.SizedPixelFormat.R32F:case b.SizedPixelFormat.R32I:case b.SizedPixelFormat.R32UI:case b.SizedPixelFormat.R8_SNORM:case b.SizedPixelFormat.R8:case b.SizedPixelFormat.R8I:case b.SizedPixelFormat.R8UI:this.pixelFormat=
b.PixelFormat.RED}}static validate(k,m){return new h(k,m)}}a.ValidatedTextureDescriptor=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports","../../../../core/Error"],function(a,b){function n(k,m,g){if(k instanceof ImageData)return n(h(k),m,g);const e=document.createElement("canvas");e.width=m;e.height=g;e.getContext("2d").drawImage(k,0,0,e.width,e.height);return e}function h(k){const m=document.createElement("canvas");
m.width=k.width;m.height=k.height;const g=m.getContext("2d");if(null==g)throw new b("Failed to create 2d context from HTMLCanvasElement");g.putImageData(k,0,0);return m}a.applyTextureResizeFloorModulo=function(k){return 16*Math.floor(k/16)};a.applyTextureResizeModulo=function(k){return 16*Math.ceil(k/16)};a.downsampleImage=function(k,m){let g=k.width*k.height;if(4096>g)return k instanceof ImageData?h(k):k;let e=k.width,d=k.height;do e=Math.ceil(e/2),d=Math.ceil(d/2),g=e*d;while(1048576<g||null!=m&&
(e>m||d>m));return n(k,e,d)};a.ensureImageMaxSize=function(k,m){const g=Math.max(k.width,k.height);if(g<=m)return k;m/=g;return n(k,Math.round(k.width*m),Math.round(k.height*m))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/AtmosphereCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],
function(a,b,n,h,k){function m(d){const c=new h.ShaderBuilder;c.include(b.ScreenSpacePass);c.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",l=>l.color),new k.Texture2DPassUniform("depthTexture",l=>l.depth));d=d.haze;c.fragment.code.add(n.glsl`
    void main() {
      ${d?n.glsl`vec4`:n.glsl`float`} depthSample = texture(depthTexture, uv) ${d?"":n.glsl`.r`};
      if (depthSample ${d?n.glsl`== vec4(0)`:n.glsl`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `);return c}class g extends n.NoParameters{}const e=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:g,build:m},Symbol.toStringTag,{value:"Module"}));a.AtmosphereCompositing=e;a.AtmosphereCompositingPassParameters=g;a.build=m})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,n){a.ScreenSpacePass=function(h,k=!0){h.attributes.add(n.VertexAttribute.POSITION,
"vec2");k&&h.varyings.add("uv","vec2");h.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${k?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/AtmosphereCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/AtmosphereCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d){class c extends h.ShaderTechnique{initializeProgram(l){return new m.Program(l.rctx,
c.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return this.configuration.haze?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),depthTest:{func:e.CompareFunction.ALWAYS},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({blending:d.simpleBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.ALWAYS},colorWrite:d.defaultColorWriteParams})}}
c.shader=new n.ReloadableShaderModule(g.AtmosphereCompositing,()=>new Promise((l,f)=>a(["./AtmosphereCompositing.glsl"],l,f)));b.AtmosphereCompositingTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.CloudsComposition=class extends n{constructor(w){super(w);this._technique=new c.CloudsCompositionTechnique(w);this._vao=f.createQuadVAO(w.rctx)}destroy(){this._technique=h.releaseMaybe(this._technique);this._vao=h.disposeMaybe(this._vao)}render(w){if(this._technique.compiled){var p=w.bindParameters.cloudsFade;null!=this._vao&&null!=p.data&&(p=w.rctx.bindTechnique(this._technique,w.bindParameters,x),w.rctx.bindVAO(this._vao),p.assertCompatibleVertexAttributeLocations(this._vao),
w.rctx.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4))}else this.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);b.__decorate([k.property({constructOnly:!0})],a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=b.__decorate([d.subclass("esri.views.3d.environment.CloudsComposition")],
a.CloudsComposition);const x=new l.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends k.ShaderTechnique{constructor(f){super(f,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(f){return new e.Program(f.rctx,l.shader.get().build(),g.Default3D)}initializePipeline(){return c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO,d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:c.defaultColorWriteParams})}}l.shader=new h.ReloadableShaderModule(n.CloudsCompositionShader,
()=>new Promise((f,r)=>a(["./CloudsComposition.glsl"],f,r)));b.CloudsCompositionTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(){const u=new w.ShaderBuilder,{attributes:v,varyings:y,vertex:D,fragment:G}=u;v.add(p.VertexAttribute.POSITION,"vec2");y.add("worldRay","vec3");D.uniforms.add(new x.Matrix4PassUniform("inverseProjectionMatrix",(A,C)=>C.camera.inverseProjectionMatrix),new x.Matrix4PassUniform("inverseViewMatrix",(A,C)=>b.invertOrIdentity(q,C.camera.viewMatrix)));D.code.add(r.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);G.include(c.ColorConversion);G.include(l.RgbaFloatEncoding);u.include(h.EvaluateAmbientLighting,{pbrMode:g.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});u.include(e.PiUtils);u.include(k.Gamma);u.include(m.MainLighting);u.include(d.CloudsParallaxShading);G.uniforms.add(new f.Float3PassUniform("cameraPosition",(A,C)=>C.camera.eye));G.code.add(r.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return u}const q=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:t},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=n;a.build=t})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,n,h,k,m,g,e,d){const c=n.create(),l=k.create();a.EvaluateAmbientLighting=function(f,r){f=f.fragment;const x=void 0!==r.lightingSphericalHarmonicsOrder?r.lightingSphericalHarmonicsOrder:2;0===x?(f.uniforms.add(new g.Float3PassUniform("lightingAmbientSH0",(w,p)=>b.set(c,p.lighting.sh.r[0],p.lighting.sh.g[0],p.lighting.sh.b[0]))),f.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===x?(f.uniforms.add(new e.Float4PassUniform("lightingAmbientSH_R",(w,p)=>h.set(l,p.lighting.sh.r[0],p.lighting.sh.r[1],p.lighting.sh.r[2],p.lighting.sh.r[3])),new e.Float4PassUniform("lightingAmbientSH_G",(w,p)=>h.set(l,p.lighting.sh.g[0],p.lighting.sh.g[1],p.lighting.sh.g[2],p.lighting.sh.g[3])),new e.Float4PassUniform("lightingAmbientSH_B",(w,p)=>h.set(l,p.lighting.sh.b[0],p.lighting.sh.b[1],p.lighting.sh.b[2],p.lighting.sh.b[3]))),f.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===x&&(f.uniforms.add(new g.Float3PassUniform("lightingAmbientSH0",(w,p)=>b.set(c,p.lighting.sh.r[0],p.lighting.sh.g[0],p.lighting.sh.b[0])),new e.Float4PassUniform("lightingAmbientSH_R1",(w,p)=>h.set(l,p.lighting.sh.r[1],p.lighting.sh.r[2],p.lighting.sh.r[3],p.lighting.sh.r[4])),new e.Float4PassUniform("lightingAmbientSH_G1",(w,p)=>h.set(l,p.lighting.sh.g[1],p.lighting.sh.g[2],p.lighting.sh.g[3],p.lighting.sh.g[4])),new e.Float4PassUniform("lightingAmbientSH_B1",(w,p)=>h.set(l,p.lighting.sh.b[1],
p.lighting.sh.b[2],p.lighting.sh.b[3],p.lighting.sh.b[4])),new e.Float4PassUniform("lightingAmbientSH_R2",(w,p)=>h.set(l,p.lighting.sh.r[5],p.lighting.sh.r[6],p.lighting.sh.r[7],p.lighting.sh.r[8])),new e.Float4PassUniform("lightingAmbientSH_G2",(w,p)=>h.set(l,p.lighting.sh.g[5],p.lighting.sh.g[6],p.lighting.sh.g[7],p.lighting.sh.g[8])),new e.Float4PassUniform("lightingAmbientSH_B2",(w,p)=>h.set(l,p.lighting.sh.b[5],p.lighting.sh.b[6],p.lighting.sh.b[7],p.lighting.sh.b[8]))),f.code.add(d.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),r.pbrMode!==m.PBRMode.Normal&&r.pbrMode!==m.PBRMode.Schematic||f.code.add(d.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),function(a,
b,n,h,k,m,g,e,d){a.PBRMode=void 0;(function(l){l[l.Disabled=0]="Disabled";l[l.Normal=1]="Normal";l[l.Schematic=2]="Schematic";l[l.Water=3]="Water";l[l.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";l[l.Simplified=5]="Simplified";l[l.TerrainWithWater=6]="TerrainWithWater";l[l.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));class c extends d.GLTextureMaterialBindParameters{}a.PBRBindParameters=c;a.PhysicallyBasedRenderingParameters=function(l,f){const r=l.fragment,x=f.hasMetallicRoughnessTexture||f.hasEmissionTexture||
f.hasOcclusionTexture;f.pbrMode===a.PBRMode.Normal&&x&&l.include(b.VertexTextureCoordinates,f);f.pbrMode===a.PBRMode.Schematic?r.code.add(k.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`):f.pbrMode===a.PBRMode.Disabled?r.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`):f.pbrMode===a.PBRMode.Normal&&(r.code.add(k.glsl`vec3 mrr;
vec3 emission;
float occlusion;`),l=f.pbrTextureBindType,f.hasMetallicRoughnessTexture&&(r.uniforms.add(l===e.BindType.Pass?new g.Texture2DPassUniform("texMetallicRoughness",w=>w.textureMetallicRoughness):new m.Texture2DDrawUniform("texMetallicRoughness",w=>w.textureMetallicRoughness)),r.code.add(k.glsl`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),f.hasEmissionTexture&&(r.uniforms.add(l===e.BindType.Pass?new g.Texture2DPassUniform("texEmission",w=>w.textureEmissive):new m.Texture2DDrawUniform("texEmission",w=>w.textureEmissive)),r.code.add(k.glsl`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),f.hasOcclusionTexture?(r.uniforms.add(l===e.BindType.Pass?new g.Texture2DPassUniform("texOcclusion",w=>w.textureOcclusion):new m.Texture2DDrawUniform("texOcclusion",w=>w.textureOcclusion)),r.code.add(k.glsl`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(k.glsl`float getBakedOcclusion() { return 1.0; }`),l===e.BindType.Pass?r.uniforms.add(new h.Float3PassUniform("emissionFactor",w=>w.emissiveFactor),new h.Float3PassUniform("mrrFactors",w=>w.mrrFactors)):r.uniforms.add(new n.Float3DrawUniform("emissionFactor",w=>w.emissiveFactor),new n.Float3DrawUniform("mrrFactors",w=>w.mrrFactors)),r.code.add(k.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${f.hasMetallicRoughnessTexture?k.glsl`applyMetallnessAndRoughness(${f.hasMetallicRoughnessTextureTransform?k.glsl`metallicRoughnessUV`:"vuv0"});`:""}

      ${f.hasEmissionTexture?k.glsl`applyEmission(${f.hasEmissiveTextureTransform?k.glsl`emissiveUV`:"vuv0"});`:""}

      ${f.hasOcclusionTexture?k.glsl`applyOcclusion(${f.hasOcclusionTextureTransform?k.glsl`occlusionUV`:"vuv0"});`:""}
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,n,h,k){a.VertexTextureCoordinates=function(m,g){m.include(n.TextureCoordinateAttribute,g);switch(g.textureCoordinateType){case n.TextureCoordinateAttributeType.Default:case n.TextureCoordinateAttributeType.Compressed:m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);break;case n.TextureCoordinateAttributeType.Atlas:m.include(h.TextureAtlasLookup);m.fragment.code.add(k.glsl`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);break;default:b.neverReached(g.textureCoordinateType);case n.TextureCoordinateAttributeType.None:case n.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(n){n.fragment.code.add(b.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec3",n.BindType.Draw,(g,e,d,c)=>g.setUniform3fv(k,m(e,d,c)))}}a.Float3DrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"sampler2D",n.BindType.Draw,(g,e,d)=>g.bindTexture(k,m(e,d)))}}a.Texture2DDrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,n,h,k,m){class g extends m{constructor(d){super(d);
this._numLoading=0;this._disposed=!1;this._textureRepository=d.textureRepository;this._textureId=d.textureId;this._acquire(d.textureId,c=>this._texture=c);this._acquire(d.normalTextureId,c=>this._textureNormal=c);this._acquire(d.emissiveTextureId,c=>this._textureEmissive=c);this._acquire(d.occlusionTextureId,c=>this._textureOcclusion=c);this._acquire(d.metallicRoughnessTextureId,c=>this._textureMetallicRoughness=c)}dispose(){this._texture=b.releaseMaybe(this._texture);this._textureNormal=b.releaseMaybe(this._textureNormal);
this._textureEmissive=b.releaseMaybe(this._textureEmissive);this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0}ensureResources(d){return 0===this._numLoading?k.ResourceState.LOADED:k.ResourceState.LOADING}get textureBindParameters(){return new e(null!=this._texture?this._texture.glTexture:null,null!=this._textureNormal?this._textureNormal.glTexture:null,null!=this._textureEmissive?this._textureEmissive.glTexture:
null,null!=this._textureOcclusion?this._textureOcclusion.glTexture:null,null!=this._textureMetallicRoughness?this._textureMetallicRoughness.glTexture:null)}updateTexture(d){if(null==this._texture||d!==this._texture.id)this._texture=b.releaseMaybe(this._texture),this._textureId=d,this._acquire(this._textureId,c=>this._texture=c)}_acquire(d,c){null==d?c(null):(d=this._textureRepository.acquire(d),n.isPromiseLike(d)?(++this._numLoading,d.then(l=>{this._disposed?(b.releaseMaybe(l),c(null)):c(l)}).finally(()=>
--this._numLoading)):c(d))}}class e extends h.NoParameters{constructor(d=null,c=null,l=null,f=null,r=null,x,w){super();this.texture=d;this.textureNormal=c;this.textureEmissive=l;this.textureOcclusion=f;this.textureMetallicRoughness=r;this.scale=x;this.normalTextureTransformMatrix=w}}a.GLTextureMaterial=g;a.GLTextureMaterialBindParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["./basicInterfaces"],function(a){class b{constructor(n){this._material=
n.material;this._techniqueRepository=n.techniqueRep;this._output=n.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(n,h){return this._technique=this._techniqueRepository.releaseAndAcquire(n,this._material.getConfiguration(this._output,
h),this._technique)}ensureResources(n){return a.ResourceState.LOADED}}return b})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(n){n.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);n.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsData ../../../../environment/CloudsParameters ../../../../environment/weather ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.CloudsParallaxShading=function(x){x=x.fragment;x.uniforms.add(new f.Matrix4PassUniform("rotationMatrixClouds",(w,p)=>p.cloudsFade.parallax.transform),new f.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(w,p)=>p.cloudsFade.parallaxNew.transform),new d.Float3PassUniform("anchorPosition",(w,p)=>p.cloudsFade.parallax.anchorPointClouds),new d.Float3PassUniform("anchorPositionCrossFade",(w,p)=>p.cloudsFade.parallaxNew.anchorPointClouds),new c.FloatPassUniform("cloudsHeight",
()=>m.cloudsHeight),new c.FloatPassUniform("radiusCurvatureCorrectionFactor",(w,p)=>p.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new c.FloatPassUniform("totalFadeInOut",(w,p)=>1-p.cloudsFade.opacity),new c.FloatPassUniform("crossFadeAnchorFactor",(w,p)=>b.clamp(p.cloudsFade.fadeFactor,0,1)),new r.TextureCubePassUniform("cubeMap",(w,p)=>p.cloudsFade.data?.cubeMap?.colorTexture??null),new e.BooleanPassUniform("crossFade",(w,p)=>p.cloudsFade.fadeMode===k.FadeMode.CROSS_FADE),new e.BooleanPassUniform("readChannelsRG",
(w,p)=>p.cloudsFade.readChannels===h.CloudsTextureChannels.RG),new e.BooleanPassUniform("fadeTextureChannels",(w,p)=>p.cloudsFade.renderingStage===h.CloudsRenderingStages.FADING));x.constants.add("planetRadius","float",n.earth.radius);x.code.add(l.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);x.code.add(l.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);x.code.add(l.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);g.addMainLightDirection(x);g.addMainLightIntensity(x);x.code.add(l.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);x.code.add(l.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);x.code.add(l.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);x.code.add(l.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);x.code.add(l.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports"],function(a){a.CloudsRenderingStages=void 0;(function(b){b[b.RENDERING=0]="RENDERING";b[b.FADING=1]="FADING";b[b.FINISHED=2]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return null!=
b&&!b.running};a.isReadyCloudsData=function(b){return null!=b?.cubeMap};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsParameters":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f{constructor(){this.readChannels=d.CloudsTextureChannels.RG;this.renderingStage=d.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=m.create();this.parallax=new r;this.parallaxNew=new r;this.pointOnGround=m.create();this.fadeMode=a.FadeMode.HIDE;this.opacity=this.fadeFactor=0}updateParallax(t){var q=this.parallax;t=k.length(t.eye);q.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(t*t-e.earth.radius*e.earth.radius,
0))/t;g.fromPoints(x,q.anchorPointClouds,w);n.rotate(q.transform,h.IDENTITY,w[3],g.axis(w));this.fadeMode===a.FadeMode.CROSS_FADE&&(q=this.parallaxNew,g.fromPoints(x,q.anchorPointClouds,w),n.rotate(q.transform,h.IDENTITY,w[3],g.axis(w)))}updateFading(t,q,u,v){this.isFading&&this._advanceFading(u,v);this._evaluateFading(t,q,u)}_evaluateFading(t,q,u){const v=t.relativeElevation;t=this._calculateDistanceToAnchorPoint(t);(v>1.7*c.weatherHeightLimit||v<-c.weatherHeightLimit||2E5<t)&&0<this.opacity?this._setFade(a.FadeMode.HIDE,
u):this.isFading||((v>c.weatherHeightLimit||v<-.35*c.weatherHeightLimit||64E3<t)&&0<this.opacity?this._setFade(a.FadeMode.FADE_OUT,u):v<=c.weatherHeightLimit&&v>=-.35*c.weatherHeightLimit&&q===l.RenderState.IDLE&&d.ensureClouds(this.data)&&(0===this.opacity?this._setFade(a.FadeMode.FADE_IN,u):(34E3<t||this.renderingStage===d.CloudsRenderingStages.FADING)&&this._setFade(a.FadeMode.CROSS_FADE,u)))}_advanceFading(t,q){this._switchReadChannels();this._updateAnchorPoint();this._advanceFadingFactorAndOpacity(t,
q)}_advanceFadingFactorAndOpacity(t,q){1>this.fadeFactor?(this.fadeFactor=q?b.clamp((t-this.startTime)/(1.25*q),0,1):1,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=this.fadeFactor),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1)):(this.fadeFactor=0,this.fadeMode===a.FadeMode.FADE_OUT&&(this.opacity=0),this.fadeMode===a.FadeMode.FADE_IN&&(this.opacity=1),this.fadeMode===a.FadeMode.CROSS_FADE&&(this.opacity=1),this.fadeMode=
a.FadeMode.NONE)}_switchReadChannels(){const t=this.fadeMode===a.FadeMode.CROSS_FADE&&1===this.fadeFactor,q=this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor;this.renderingStage===d.CloudsRenderingStages.FADING&&(t||q)&&(this.readChannels=1-this.readChannels,this.renderingStage=d.CloudsRenderingStages.FINISHED)}_calculateDistanceToAnchorPoint(t){k.normalize(this.pointOnGround,t.eye);k.scale(this.pointOnGround,this.pointOnGround,e.earth.radius);return k.length(k.subtract(p,this.parallax.anchorPointClouds,
this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===a.FadeMode.CROSS_FADE&&(0===this.fadeFactor&&k.copy(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds));this.fadeMode===a.FadeMode.FADE_IN&&0===this.fadeFactor&&k.copy(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(t,q){switch(t){case a.FadeMode.HIDE:this.opacity=0;break;case a.FadeMode.FADE_OUT:this.opacity=1;break;case a.FadeMode.FADE_IN:this.opacity=
0;break;case a.FadeMode.CROSS_FADE:this.opacity=1}this.fadeMode=t;this.fadeFactor=0;this.startTime=q}get isFading(){return this.fadeMode===a.FadeMode.FADE_OUT||this.fadeMode===a.FadeMode.FADE_IN||this.fadeMode===a.FadeMode.CROSS_FADE}}a.FadeMode=void 0;(function(t){t[t.NONE=0]="NONE";t[t.HIDE=1]="HIDE";t[t.FADE_OUT=2]="FADE_OUT";t[t.FADE_IN=3]="FADE_IN";t[t.CROSS_FADE=4]="CROSS_FADE"})(a.FadeMode||(a.FadeMode={}));class r{constructor(){this.anchorPointClouds=m.create();this.radiusCurvatureCorrectionFactor=
0;this.transform=h.create()}}const x=m.fromValues(0,0,1),w=g.create(),p=m.create();a.CloudsParameters=f;a.crossFadeDistanceThreshold=34E3;a.fadeOutDistanceThreshold=64E3;a.hideDistanceThreshold=2E5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngleDegrees":function(){define("exports ../../core/mathUtils ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,n,h,k,m,g,e){function d(D=w){return[D[0],D[1],D[2],D[3]]}function c(D,G,A,C,E=d()){E[0]=D;E[1]=G;E[2]=A;E[3]=C;return E}function l(D,G,A=d()){m.copy(A,D);A[3]=G;return A}function f(D,G,A=d()){h.setAxisAngle(p,D,r(D));h.setAxisAngle(t,G,r(G));h.multiply(p,t,p);return x(A,b.rad2deg(h.getAxisAngle(A,p)))}function r(D){return b.deg2rad(D[3])}function x(D,G){D[3]=G;return D}const w=[0,0,1,0],p=k.create(),t=k.create(),q=d(),u=d(),v=d(),y=d();a.angle=function(D){return D[3]};a.angleRad=r;a.axis=
function(D){return D};a.compose=f;a.composeAxes=function(D,G,A,C=d()){l(g.UNIT_X,D,u);l(g.UNIT_Y,G,v);l(g.UNIT_Z,A,y);f(u,v,u);f(u,y,C);return C};a.copy=function(D,G=d()){return c(D[0],D[1],D[2],D[3],G)};a.create=d;a.fromAxisAndAngle=l;a.fromMatrix=function(D,G=d()){D=n.getRotation(p,D);x(G,b.rad2deg(h.getAxisAngle(G,D)));return G};a.fromPoints=function(D,G,A=e.create()){m.cross(A,D,G);m.normalize(A,A);A[3]=-m.angle(D,G);return A};a.fromValues=c;a.setAngle=x;a.up=w;a.wrap=function(D,G,A,C){return c(D,
G,A,C,q)};a.wrapAxisAngle=function(D,G){return c(D[0],D[1],D[2],G,q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/RenderState":function(){define(["exports"],function(a){a.RenderState=void 0;var b=a.RenderState||(a.RenderState={});b[b.ANIMATING=0]="ANIMATING";b[b.INTERACTING=1]="INTERACTING";b[b.IDLE=2]="IDLE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"bool",n.BindType.Pass,(g,e,d)=>g.setUniform1b(k,m(e,d)))}}a.BooleanPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"samplerCube",n.BindType.Pass,(g,e,
d)=>g.bindTexture(k,m(e,d)))}}a.TextureCubePassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(n){n.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../support/Yield ../../webgl/enums ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K){a.CloudsGenerator=class extends n{constructor(S){super(S);this._techniques=[];this._techniqueConfiguration=new A.CloudsTechniqueConfiguration;this._bindParameters=new E.BindParameters(null,null);this._passParameters=new u.CloudsPassParameters;this._weatherTile=p.create();this._weatherTileCount=128;this._tileIndex=this._faceIndex=0;this.coverage=h.lerp(D.cloudPresets.default.coverage[0],D.cloudPresets.default.coverage[1],.5);
this.density=h.lerp(D.cloudPresets.default.density[0],D.cloudPresets.default.density[1],.5);this.absorption=h.lerp(D.cloudPresets.default.absorption[0],D.cloudPresets.default.absorption[1],.5);this.cloudSize=h.lerp(D.cloudPresets.default.cloudSize[0],D.cloudPresets.default.cloudSize[1],.5);this.detailSize=h.lerp(D.cloudPresets.default.detailSize[0],D.cloudPresets.default.detailSize[1],.5);this.smoothness=h.lerp(D.cloudPresets.default.smoothness[0],D.cloudPresets.default.smoothness[1],.5);this.cloudHeight=
h.lerp(D.cloudPresets.default.cloudHeight[0],D.cloudPresets.default.cloudHeight[1],.5);this.raymarchingSteps=D.cloudPresets.default.raymarchingSteps;this._viewMatrix=x.create();this.running=this._dirty=!1;this._vao=I.createQuadVAO(S.context.renderContext.rctx)}_getTechnique(S){const N=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,P=N===v.CloudsTextureChannels.RG?2*S:2*S+1,R=this._techniques[P];if(R)return R;this._techniqueConfiguration.writeTextureChannels=N;this._techniqueConfiguration.steps=
S;this._techniques[P]=new G.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[P]}updateWeatherTile(){var S=this.view.camera.position.latitude,N=this.view.camera.position.longitude;null!=S&&null!=N&&(w.set(this._weatherTile,(S+90)/180,(N+180)/360),S=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=
Math.floor(4*(this._weatherTileCount-S)*this._weatherTile[1]),N=S=0,null!=this.view.environment&&"virtual"!==this.view.environment.lighting.type&&null!=this.view.environment.lighting.date&&(N=new Date(this.view.environment.lighting.date),N.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),S=31*N.getUTCMonth()+N.getUTCDate(),N=N.getUTCFullYear()),this._weatherTile[0]=(this._weatherTile[0]+S)%(2*this._weatherTileCount),this._weatherTile[1]=
(this._weatherTile[1]+N%100)%(4*this._weatherTileCount),w.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())}initialize(){const S=q.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*S.radius;this.setDirty();this.updateWeatherTile();this.addHandles([this.view.resourceController.scheduler.registerTask(H.TaskPriority.CLOUDS_GENERATOR,this),m.watch(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,
this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),m.initial)])}destroy(){this._techniques.forEach(S=>k.releaseMaybe(S));this._frameBufferCube=k.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao.dispose();this._passParameters.noiseTexture=k.destroyMaybe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case A.RayMarchingSteps.SIXTEEN:return 1;case A.RayMarchingSteps.HUNDRED:return 4;case A.RayMarchingSteps.COUNT:case A.RayMarchingSteps.TWOHUNDRED:return 8}}get usedMemory(){return(this._frameBufferCube?.usedMemory??
0)+(this._passParameters.noiseTexture?.textureAtlas?.usedMemory??0)}_ensureNoiseTexture(){null==this._passParameters.noiseTexture&&(this._passParameters.noiseTexture=new C.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return null!=this._passParameters.noiseTexture.textureAtlas}_ensureFrameBufferCube(S){null==this._frameBufferCube&&(S=new K.TextureDescriptor(S),S.target=B.TextureType.TEXTURE_CUBE_MAP,S.wrapMode=B.TextureWrapMode.CLAMP_TO_EDGE,
this._frameBufferCube=new z.FramebufferObject(this.context.renderContext.rctx,S));return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=k.disposeMaybe(this._frameBufferCube)}applyPreset(S,N){const P=S.median,R=O=>{const T=h.lerp(O[0],O[1],P);return.5>N?h.lerp(O[0],T,2*N):h.lerp(T,O[1],2*(N-.5))};this.coverage=R(S.coverage);this.density=R(S.density);this.absorption=R(S.absorption);this.cloudSize=R(S.cloudSize);this.detailSize=R(S.detailSize);
this.smoothness=R(S.smoothness);this.cloudHeight=R(S.cloudHeight);this.raymarchingSteps=S.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(S){0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),w.copy(this._passParameters.weatherTile,this._weatherTile));var N=this._getTechnique(this._passParameters.raymarchingSteps);if(!N.compiled||this.context.renderContext.bindParameters.cloudsFade.fadeMode===y.FadeMode.CROSS_FADE||
!this._ensureNoiseTexture())return J.Yield;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=v.CloudsRenderingStages.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,
this._dirty=!1);r.targetTo(this._viewMatrix,M,L[this._faceIndex],F[this._faceIndex]);f.fromMat4(this._passParameters.viewMatrix,this._viewMatrix);const P=this.context.renderContext.rctx;var R=P.bindTechnique(N,this._bindParameters,this._passParameters);P.bindVAO(this._vao);R.assertCompatibleVertexAttributeLocations(this._vao);R=P.getViewport();N=N.configuration.cubeMapSize;const O=N/this._tilesPerFace;P.setViewport(0,this._tileIndex*O,N,O);N=this._ensureFrameBufferCube(N);P.bindFramebuffer(N);N.setColorTextureTarget(B.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+
this._faceIndex);P.gl.drawArrays(P.gl.TRIANGLE_STRIP,0,4);P.gl.flush();P.setViewport(R.x,R.y,R.width,R.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=v.CloudsRenderingStages.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);S.madeProgress();return J.Yield}};b.__decorate([g.property({constructOnly:!0})],
a.CloudsGenerator.prototype,"context",void 0);b.__decorate([g.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);b.__decorate([g.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"coverage",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"density",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"absorption",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,
"cloudSize",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"detailSize",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"smoothness",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);b.__decorate([g.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=b.__decorate([l.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);
const L=[t.fromValues(1,0,0),t.fromValues(-1,0,0),t.fromValues(0,1,0),t.fromValues(0,-1,0),t.fromValues(0,0,1)],F=[t.fromValues(0,1,0),t.fromValues(0,1,0),t.fromValues(0,0,-1),t.fromValues(0,0,1),t.fromValues(0,1,0)],M=t.zeros();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function n(t){const q=new Float32Array(3);q[0]=t[0];q[1]=t[1];q[2]=t[2];return q}
function h(t,q,u){const v=new Float32Array(3);v[0]=t;v[1]=q;v[2]=u;return v}function k(t,q){return new Float32Array(t,q,3)}function m(){return b()}function g(){return h(1,1,1)}function e(){return h(1,0,0)}function d(){return h(0,1,0)}function c(){return h(0,0,1)}const l=b(),f=g(),r=e(),x=d(),w=c(),p=Object.freeze(Object.defineProperty({__proto__:null,ONES:f,UNIT_X:r,UNIT_Y:x,UNIT_Z:w,ZEROS:l,clone:n,create:b,createView:k,fromValues:h,ones:g,unitX:e,unitY:d,unitZ:c,zeros:m},Symbol.toStringTag,{value:"Module"}));
a.ONES=f;a.UNIT_X=r;a.UNIT_Y=x;a.UNIT_Z=w;a.ZEROS=l;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.ones=g;a.unitX=e;a.unitY=d;a.unitZ=c;a.vec3f32=p;a.zeros=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Clouds.glsl":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/factories/mat3f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(v){const y=new x.ShaderBuilder;y.include(d.ScreenSpacePass,!1);const D=y.fragment;D.uniforms.add(new l.FloatPassUniform("cloudRadius",G=>G.cloudRadius),new l.FloatPassUniform("power",G=>b.lerp(35,120,G.absorption)),new l.FloatPassUniform("sigmaE",G=>1+G.absorption),new l.FloatPassUniform("density",G=>b.lerp(0,.3,G.density)),new l.FloatPassUniform("cloudSize",G=>b.lerp(0,.02,Math.max(.01,1-G.cloudSize))),new l.FloatPassUniform("detailSize",G=>b.lerp(0,
.2,Math.max(.01,1-G.detailSize))),new l.FloatPassUniform("smoothness",G=>b.lerp(0,.5,1-G.smoothness)),new l.FloatPassUniform("cloudHeight",G=>b.lerp(0,1500,G.cloudHeight)),new l.FloatPassUniform("coverage",G=>G.coverage),new r.Matrix3PassUniform("view",G=>G.viewMatrix),new w.Texture2DPassUniform("cloudShapeTexture",G=>null!=G.noiseTexture?G.noiseTexture.textureAtlas:null),new c.Float2PassUniform("cloudVariables",G=>h.set(q,G.coverage,G.absorption)));D.constants.add("halfCubeMapSize","float",.5*v.cubeMapSize);
D.code.add(f.glsl`
    const int STEPS = ${v.steps===g.RayMarchingSteps.SIXTEEN?f.glsl`16`:v.steps===g.RayMarchingSteps.HUNDRED?f.glsl`100`:f.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);D.code.add(f.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${f.glsl.float(e.atlasSize)};
      const float dataWidth = ${f.glsl.float(e.atlasSize)};
      const float tileRows = ${f.glsl.float(e.tileRows)};
      const vec3 atlasDimensions = vec3(${f.glsl.float(e.tileSize)}, ${f.glsl.float(e.tileSize)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${f.glsl.float(e.textureScale)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${f.glsl.float(e.weatherMapScale)} * p) / ${f.glsl.float(e.atlasSize)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `);D.code.add(f.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);D.code.add(f.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);D.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
D.code.add(f.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);D.code.add(f.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);D.code.add(f.glsl`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return y}class t extends f.NoParameters{constructor(){super(...arguments);this.coverage=this.cloudHeight=this.smoothness=this.density=this.absorption=this.detailSize=this.cloudSize=this.cloudRadius=0;this.raymarchingSteps=m.cloudPresets.default.raymarchingSteps;this.weatherTile=k.create();this.viewMatrix=n.create()}}const q=k.create(),u=Object.freeze(Object.defineProperty({__proto__:null,CloudsPassParameters:t,build:p},Symbol.toStringTag,{value:"Module"}));a.Clouds=u;a.CloudsPassParameters=t;
a.build=p})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){class n{constructor(k,m,g,e,d,c,l,f,r=.5){this.coverage=k;this.density=m;this.absorption=g;this.cloudSize=e;this.detailSize=d;this.smoothness=c;this.cloudHeight=l;this.raymarchingSteps=f;this.median=r}}const h=new n([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN);b={sunny:h,cloudy:new n([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,
.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new n([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new n([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new n([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN),default:h};a.CloudPresets=n;a.cloudPresets=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","../../../core/has","./CloudsData","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n,h,k){a.RayMarchingSteps=void 0;(function(g){g[g.SIXTEEN=0]="SIXTEEN";g[g.HUNDRED=1]="HUNDRED";g[g.TWOHUNDRED=2]="TWOHUNDRED";g[g.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));class m extends k.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.steps=a.RayMarchingSteps.SIXTEEN;this.writeTextureChannels=h.CloudsTextureChannels.RG}}
b.__decorate([k.parameter({count:a.RayMarchingSteps.COUNT})],m.prototype,"steps",void 0);b.__decorate([k.parameter({constValue:n("esri-mobile")?1024:2048})],m.prototype,"cubeMapSize",void 0);b.__decorate([k.parameter()],m.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:
128;const n=Math.ceil(Math.sqrt(b)),h=(b+2)*n;a.atlasSize=h;a.textureScale=b/128;a.tileRows=n;a.tileSize=b;a.weatherMapScale=h/1560;a.weatherMapSize=1E5;a.weatherTileSize=128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"mat3",n.BindType.Pass,(g,e,d)=>g.setUniformMatrix3fv(k,
m(e,d)))}}a.Matrix3PassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends m.ShaderTechnique{constructor(f,
r){super(f,r,()=>this.destroy())}initializeProgram(f){return new e.Program(f.rctx,l.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){return c.makePipelineState({blending:c.simpleBlendingParams(d.BlendFactor.CONSTANT_COLOR,d.BlendFactor.ONE_MINUS_CONSTANT_COLOR,d.BlendOperation.ADD,this.configuration.writeTextureChannels===h.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:c.defaultColorWriteParams})}}l.shader=new k.ReloadableShaderModule(n.Clouds,
()=>new Promise((f,r)=>a(["./Clouds.glsl"],f,r)));b.CloudsTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/FramebufferObject ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){a.NoiseTextureAtlas=class extends n{constructor(q){super(q);this._needsRender=!0;this._passParameters=new l.NoiseTextureAtlasPassParameters;this._fbo=new p.FramebufferObject(q.context.renderContext.rctx,new t.TextureDescriptor(r.atlasSize));this._vao=w.createQuadVAO(q.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){null!=this._texture?null!=this._weatherMapTechnique&&this._weatherMapTechnique.compiled&&
this._needsRender&&(this._texture=this._render(f.NoiseTextureRenderMode.WeatherMap)):null!=this._fullTechnique&&this._fullTechnique.compiled&&(this._texture=this._render(f.NoiseTextureRenderMode.Full));return this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(q){if(this._passParameters.weatherTile[0]!==q[0]||this._passParameters.weatherTile[1]!==q[1])c.copy(this._passParameters.weatherTile,q),this._setDirty()}destroy(){this._fullTechniqueCached=h.releaseMaybe(this._fullTechniqueCached);
this._weatherMapTechniqueCached=h.releaseMaybe(this._weatherMapTechniqueCached);this._fbo=h.disposeMaybe(this._fbo);this._vao=h.disposeMaybe(this._vao)}get _fullTechnique(){if(null==this._fullTechniqueCached){const q=new f.NoiseTextureAtlasTechniqueConfiguration;q.mode=f.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(x.NoiseTextureAtlasTechnique,q)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(null==this._weatherMapTechniqueCached){const q=
new f.NoiseTextureAtlasTechniqueConfiguration;q.mode=f.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(x.NoiseTextureAtlasTechnique,q)}return this._weatherMapTechniqueCached}_render(q){if(null==this._vao||null==this._fbo)return null;var u=q===f.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;q=this.context.renderContext.rctx;const v=q.getViewport();q.setViewport(0,0,r.atlasSize,r.atlasSize);q.bindFramebuffer(this._fbo);
u=q.bindTechnique(u,null,this._passParameters);q.bindVAO(this._vao);u.assertCompatibleVertexAttributeLocations(this._vao);q.gl.drawArrays(q.gl.TRIANGLE_STRIP,0,4);q.setViewport(v.x,v.y,v.width,v.height);this._needsRender=!1;return this._fbo.colorTexture}};b.__decorate([k.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);b.__decorate([k.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=b.__decorate([d.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,n,h,k,m,g,e){function d(f){const r=new e.ShaderBuilder;r.include(k.ScreenSpacePass,!1);r.fragment.code.add(g.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);f.mode===n.NoiseTextureRenderMode.Full&&r.fragment.code.add(g.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${g.glsl.float(h.tileRows)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${g.glsl.float(8)});

      float worley0 = worley(p, ${g.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${g.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${g.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${g.glsl.float(2)});
      float worley1 = worley(p, ${g.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${g.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${g.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);r.fragment.uniforms.add(new m.Float2PassUniform("weatherTile",x=>x.weatherTile));r.fragment.code.add(g.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${g.glsl.float(h.weatherTileSize)});

      // Get global coordinates of p
      p += weatherTile * ${g.glsl.float(h.weatherTileSize)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${g.glsl.float(h.weatherMapSize)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);r.fragment.code.add(g.glsl`void main() {`);f.mode===n.NoiseTextureRenderMode.Full&&r.fragment.code.add(g.glsl`
        float padWidth = 1.0;
        float paddedSize = ${g.glsl.float(h.tileSize)} + 2.0 * padWidth;
        float tileCount = ${g.glsl.float(h.tileRows)} * ${g.glsl.float(h.tileRows)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${g.glsl.float(h.tileSize)};
          }

          if (startPadY) {
            pixel.y += ${g.glsl.float(h.tileSize)};
          }

          if (endPadX) {
            pixel.x -= ${g.glsl.float(h.tileSize)};
          }

          if (endPadY) {
            pixel.y -= ${g.glsl.float(h.tileSize)};
          }

          uv = vec2(pixel.xy / ${g.glsl.float(h.tileSize)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${g.glsl.float(h.tileSize)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${g.glsl.float(h.tileRows)} * ${g.glsl.float(h.tileRows)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${g.glsl.float(h.tileRows)} * ${g.glsl.float(h.tileRows)});
        p = p_;
        p.z /= (${g.glsl.float(h.tileRows)} * ${g.glsl.float(h.tileRows)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);r.fragment.code.add(g.glsl`
      vec2 mapUV = ${g.glsl.float(h.weatherTileSize)} * (gl_FragCoord.xy / ${g.glsl.float(h.atlasSize)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${f.mode===n.NoiseTextureRenderMode.Full?g.glsl`fragColor.ba = vec2(0.0, map);`:g.glsl`fragColor = vec4(map);`};
    }
  `);return r}class c extends g.NoParameters{constructor(){super(...arguments);this.weatherTile=b.fromValues(0,0)}}const l=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:c,build:d},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=l;a.NoiseTextureAtlasPassParameters=c;a.build=d})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n){a.NoiseTextureRenderMode=void 0;(function(k){k[k.Full=0]="Full";k[k.WeatherMap=1]="WeatherMap";k[k.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.mode=a.NoiseTextureRenderMode.Full}}b.__decorate([n.parameter({count:a.NoiseTextureRenderMode.COUNT})],h.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends m.ShaderTechnique{initializeProgram(f){return new e.Program(f.rctx,
l.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){return c.makePipelineState({blending:this.configuration.mode===h.NoiseTextureRenderMode.Full?c.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO):c.separateBlendingParams(d.BlendFactor.ZERO,d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ZERO),depthTest:{func:d.CompareFunction.ALWAYS},colorWrite:c.defaultColorWriteParams})}}l.shader=new k.ReloadableShaderModule(n.NoiseTextureAtlas,()=>new Promise((f,r)=>a(["./NoiseTextureAtlas.glsl"],
f,r)));b.NoiseTextureAtlasTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../core/has ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./enums ./GLObjectType ./Renderbuffer ./Texture".split(" "),function(a,b,n,h,k,m,g,e,d,c){function l(w){return null!=w&&"type"in w&&w.type===e.GLObjectType.Texture}function f(w,p){const t=Math.max(w.width,w.height);return t>p?(n.getLogger("esri.views.webgl.FramebufferObject").warn(`Resizing FBO attachment size ${w.width}x${w.height} to device limit ${p}`),
p/=t,w.width=Math.round(w.width*p),w.height=Math.round(w.height*p),!1):!0}function r(w){return w.descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:g.TextureType.TEXTURE_2D}class x{constructor(w,p,t=null){this._context=w;this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=this._depthStencilBuffer=null;this._initialized=!1;w.instanceCounter.increment(g.ResourceType.FramebufferObject,this);w=l(p)?p:new c.Texture(this._context,p);this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,
w);this._validateTextureDescriptor(w.descriptor);this._validateColorAttachmentPoint(g.ColorAttachment.COLOR_ATTACHMENT0);null!=t&&(l(t)||null!=t&&"pixelFormat"in t?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=l(t)?t:new c.Texture(this._context,t),this._validateTextureDescriptor(this._depthStencilTexture.descriptor)):(this._depthStencilBuffer=t=null!=t&&"type"in t&&t.type===
e.GLObjectType.RenderBuffer?t:new d.Renderbuffer(this._context,t),this._validateRenderBufferDescriptor(t.descriptor)))}dispose(){if(0!==this._colorAttachments.size||this._glName){var w=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((p,t)=>this.detachColorTexture(t)?.dispose());this.detachDepthStencilBuffer()?.dispose();this.detachDepthStencilTexture()?.dispose();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(w);
this._context.instanceCounter.decrement(g.ResourceType.FramebufferObject,this)}}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.width??0}get height(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)?.descriptor?.height??
0}get usedMemory(){return[...this._colorAttachments].reduce((w,[,p])=>w+p.usedMemory,this.depthStencil?.usedMemory??0)}getColorTexture(w){return(w=this._colorAttachments.get(w))&&l(w)?w:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(w,p=g.ColorAttachment.COLOR_ATTACHMENT0){w&&(this._validateColorAttachmentPoint(p),this._validateTextureDescriptor(w.descriptor),this.detachColorTexture(p)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,
p)),this._colorAttachments.set(p,w))}detachColorTexture(w=g.ColorAttachment.COLOR_ATTACHMENT0){const p=this._colorAttachments.get(w);if(p){if(this._initialized){const t=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this);this._framebufferTexture2D(null,w);this._context.bindFramebuffer(t)}this._colorAttachments.delete(w);return p}}setColorTextureTarget(w,p=g.ColorAttachment.COLOR_ATTACHMENT0){const t=this._colorAttachments.get(p);t&&this._framebufferTexture2D(t.glName,p,w)}attachDepthStencil(w){if(w)switch(w.type){case e.GLObjectType.Texture:return this._attachDepthStencilTexture(w);
case e.GLObjectType.RenderBuffer:return this._attachDepthStencilBuffer(w)}}_attachDepthStencilTexture(w){if(null!=w){var p=w.descriptor;p.pixelFormat!==g.PixelFormat.DEPTH_STENCIL&&p.pixelFormat!==g.PixelFormat.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");p.dataType!==g.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
this._validateTextureDescriptor(p);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,g.DepthStencilAttachment));this._depthStencilTexture?.dispose();this._depthStencilTexture=w}}detachDepthStencilTexture(){const w=this._depthStencilTexture;w&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,g.DepthStencilAttachment));this._depthStencilTexture=null;return w}_attachDepthStencilBuffer(w){if(null!=
w){var p=w.descriptor;this._validateRenderBufferDescriptor(p);this._disposeDepthStencilAttachments();if(this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;p=this._getGLAttachmentPoint(p);t.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,p,t.RENDERBUFFER,w.glName)}this._depthStencilBuffer=w}}detachDepthStencilBuffer(){const w=this._depthStencilBuffer;if(w&&this._initialized){this._context.bindFramebuffer(this);const p=this._context.gl,t=this._getGLAttachmentPoint(w.descriptor);
p.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,t,p.RENDERBUFFER,null)}this._depthStencilBuffer=null;return w}copyToTexture(w,p,t,q,u,v,y){(0>w||0>p||0>u||0>v)&&console.error("Offsets cannot be negative!");(0>=t||0>=q)&&console.error("Copy width and height must be greater than zero!");var D=y.descriptor;y.descriptor.target!==g.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==D?.width||null==D?.height||w+t>this.width||p+q>this.height||u+t>D.width||v+q>D.height)&&
console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");D=this._context;y=D.bindTexture(y,c.Texture.TEXTURE_UNIT_FOR_UPDATES);D.setActiveTexture(c.Texture.TEXTURE_UNIT_FOR_UPDATES);D.bindFramebuffer(this);D.gl.copyTexSubImage2D(g.TextureType.TEXTURE_2D,0,u,v,w,p,t,q);D.bindTexture(y,c.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(w,p,t,q,u,v,y){(0>=t||0>=q)&&console.error("Copy width and height must be greater than zero!");y||console.error("Target memory is not initialized!");
this._context.bindFramebuffer(this);this._context.gl.readPixels(w,p,t,q,u,v,y)}async readPixelsAsync(w,p,t,q,u,v,y){const {gl:D}=this._context,G=k.BufferObject.createPixelPack(this._context,g.Usage.STREAM_READ,y.byteLength);this._context.bindBuffer(G);this._context.bindFramebuffer(this);D.readPixels(w,p,t,q,u,v,0);this._context.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);await G.getSubDataAsync(y);G.dispose()}resize(w,p){if(this.width!==w||this.height!==p){var t={width:w,height:p};f(t,this._context.parameters.maxTextureSize);
this._colorAttachments.forEach(q=>q.resize(t.width,t.height));this._depthStencilTexture?.resize(t.width,t.height);this._initialized&&(f(t,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(t.width,t.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}}initializeAndBind(w=g.FramebufferTarget.FRAMEBUFFER){const p=this._context.gl;if(this._initialized)p.bindFramebuffer(w,this.glName);else{this._glName&&p.deleteFramebuffer(this._glName);
var t=p.createFramebuffer();p.bindFramebuffer(w,t);this._colorAttachments.forEach((q,u)=>this._framebufferTexture2D(q.glName,u,r(q),w));if(this._depthStencilBuffer){const q=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);p.framebufferRenderbuffer(w,q,p.RENDERBUFFER,this._depthStencilBuffer.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,p.DEPTH_STENCIL_ATTACHMENT,r(this._depthStencilTexture),w);m.webglDebugEnabled()&&p.checkFramebufferStatus(w)!==
p.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=t;this._initialized=!0}}_framebufferTexture2D(w,p=g.ColorAttachment.COLOR_ATTACHMENT0,t=g.TextureType.TEXTURE_2D,q=g.FramebufferTarget.FRAMEBUFFER,u=0){this._context.gl.framebufferTexture2D(q,p,t,w,u)}_disposeDepthStencilAttachments(){const w=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const p=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);w.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,
p,w.RENDERBUFFER,null)}this._depthStencilBuffer=h.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=h.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(w){w.target!==g.TextureType.TEXTURE_2D&&w.target!==g.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");f(w,this._context.parameters.maxTextureSize);
this._validateBufferDimensions(w)}_validateRenderBufferDescriptor(w){f(w,this._context.parameters.maxRenderbufferSize);this._validateBufferDimensions(w)}_validateBufferDimensions(w){0>=w.width&&(w.width=this.width);0>=w.height&&(w.height=this.height);0<this.width&&0<this.height&&(this.width!==w.width||this.height!==w.height)&&console.error("Attachment size must match framebuffer size!")}_getGLAttachmentPoint(w){switch(w.internalFormat){case g.RenderbufferFormat.DEPTH_COMPONENT16:case g.RenderbufferFormat.DEPTH_COMPONENT24:case g.RenderbufferFormat.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;
case g.RenderbufferFormat.DEPTH24_STENCIL8:case g.RenderbufferFormat.DEPTH32F_STENCIL8:case g.RenderbufferFormat.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case g.RenderbufferFormat.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(w){if(-1===x._MAX_COLOR_ATTACHMENTS){const {gl:p}=this._context;x._MAX_COLOR_ATTACHMENTS=p.getParameter(p.MAX_COLOR_ATTACHMENTS)}w-=g.ColorAttachment.COLOR_ATTACHMENT0;w+1>x._MAX_COLOR_ATTACHMENTS&&n.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",
`illegal attachment point for color attachment: ${w+1}. Implementation supports up to ${x._MAX_COLOR_ATTACHMENTS} color attachments`)}}x._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=x;a.ensureAttachmentMaxSize=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","./enums","./GLObjectType","./RenderbufferDescriptor"],function(a,b,n,h){class k{constructor(m,g){this._context=m;this._descriptor=g;this.type=n.GLObjectType.RenderBuffer;
this._context.instanceCounter.increment(b.ResourceType.Renderbuffer,this);m=this._context.gl;this.glName=m.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:e,height:d,internalFormat:c,multisampled:l}=g;l?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,c,e,d):m.renderbufferStorage(m.RENDERBUFFER,c,e,d)}get descriptor(){return this._descriptor}get samples(){const m=this._descriptor.samples,g=this._context.parameters.maxSamples;return m?Math.min(m,g):g}get usedMemory(){return h.estimateMemory(this._descriptor)}resize(m,
g){const e=this._descriptor;if(e.width!==m||e.height!==g)e.width=m,e.height=g,m=this._context.gl,this._context.bindRenderbuffer(this),e.multisampled?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,e.internalFormat,e.width,e.height):m.renderbufferStorage(m.RENDERBUFFER,e.internalFormat,e.width,e.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(b.ResourceType.Renderbuffer,this),this._context=null)}}a.Renderbuffer=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(a,b){class n{constructor(h,k,m=k){this.internalFormat=h;this.width=k;this.height=m;this.multisampled=!1;this.samples=1}}a.RenderbufferDescriptor=n;a.estimateMemory=function(h){return 0>=h.width||0>=h.height||null==h.internalFormat?0:h.width*h.height*b.getBytesPerElementFormat(h.internalFormat)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../environment/CloudsParameters ../core/shaderLibrary/hud/HUDRenderStyle ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ./basicInterfaces ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f){class r{constructor(w,
p){this.shadowMap=w;this.slicePlane=p;this.slot=c.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=l.TransparencyPassType.NONE;this.alignPixelEnabled=!1;this.decorations=e.Decorations.ON;this.overlayStretch=1;this._camera=new d.Camera;this._inverseViewport=n.create();this.oldLighting=new f.SceneLighting;this.newLighting=new f.SceneLighting;this._fadedLighting=new f.SceneLighting;this._lighting=this.newLighting;this.ssr=new x;this.multipassEnabled=
!1;this.multipassTerrain=new g.MultipassTerrainUniforms;this.multipassGeometry=new m.MultipassGeometryUniforms;this.hudRenderStyle=k.HUDRenderStyle.Occluded;this.cloudsFade=new h.CloudsParameters}get camera(){return this._camera}set camera(w){this._camera=w;this._inverseViewport[0]=1/w.fullViewport[2];this._inverseViewport[1]=1/w.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(w){const {oldLighting:p,
newLighting:t}=this;1<=w?this._lighting=t:(this._fadedLighting.lerpLighting(p,t,w),this._lighting=this._fadedLighting)}}class x{constructor(){this.fadeFactor=1;this.reprojectionMatrix=b.create()}}a.BindParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDRenderStyle":function(){define(["exports"],function(a){a.HUDRenderStyle=void 0;var b=a.HUDRenderStyle||(a.HUDRenderStyle={});b[b.Occluded=0]="Occluded";b[b.NotOccluded=
1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){class m{}a.MultipassGeometryUniforms=m;a.multipassGeometryTest=function(g){g.include(b.ReadLinearDepth);
g.uniforms.add(new k.Texture2DPassUniform("geometryDepthTexture",(e,d)=>d.multipassGeometry.linearDepth?.getTexture()),new n.Float2PassUniform("nearFar",(e,d)=>d.camera.nearFar));g.code.add(h.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){class m{constructor(){this.cullAboveGround=!1}}a.MultipassTerrainUniforms=m;a.multipassTerrainTest=function(g,e){if(e.multipassEnabled){g.fragment.include(b.ReadLinearDepth);
g.fragment.uniforms.add(new k.Texture2DPassUniform("terrainDepthTexture",(c,l)=>l.multipassTerrain.linearDepth?.getTexture()),new n.Float2PassUniform("nearFar",(c,l)=>l.camera.nearFar));var d=e.occlusionPass;g.fragment.code.add(h.glsl`
   ${d?"bool":"void"} terrainDepthTest(float fragmentDepth) {
      vec4 data = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);
      float linearDepth = linearDepthFromRGBA(data, nearFar);
      ${d?h.glsl`return fragmentDepth < linearDepth && data != vec4(0.0, 0.0, 0.0, 1.0);`:h.glsl`
          if(fragmentDepth ${e.cullAboveGround?"\x3e":"\x3c\x3d"} linearDepth){
            discard;
          }`}
    }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){var A;a.Camera=A=class extends n{constructor(B){super(B);this._ray=v.create();this._viewport=q.fromValues(0,0,1,1);this._padding=q.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=x.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=f.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=f.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=f.create();this._frustumDirty=!0;this._frustum=
u.create();this._fullViewport=q.create();this._pixelRatio=1;this.column=this.row=0;this._columns=this._rows=1;this._center=p.create();this._up=p.create();this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(B){this._pixelRatio=0<B?B:1}get rows(){return this._rows}set rows(B){this._rows=Math.max(1,B)}get columns(){return this._columns}set columns(B){this._columns=Math.max(1,B)}get eye(){return this._ray.origin}set eye(B){this._compareAndSetView(B,this._ray.origin)}get center(){return this._center}set center(B){this._compareAndSetView(B,
this._center,"_center")}get ray(){w.subtract(this._ray.direction,this.center,this.eye);return this._ray}get up(){return this._up}set up(B){this._compareAndSetView(B,this._up,"_up")}get viewMatrix(){this._ensureViewClean();return this._viewMatrix}set viewMatrix(B){l.copy(this._viewMatrix,B);this.notifyChange("_viewMatrix");this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}get viewForward(){this._ensureViewClean();return w.set(p.create(),-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){this._ensureViewClean();return w.set(p.create(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){this._ensureViewClean();return w.set(p.create(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(B){this._nearFar[0]!==B&&(this._nearFar[0]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(B){this._nearFar[1]!==
B&&(this._nearFar[1]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(B){this.x=B[0];this.y=B[1];this.width=B[2];this.height=B[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const B=t.scale(q.create(),this._viewport,1/this.pixelRatio),z=this._get("screenViewport");return z&&t.equals(B,z)?z:B}get screenPadding(){if(1===this.pixelRatio)return this._padding;const B=t.scale(q.create(),this._padding,
1/this.pixelRatio),z=this._get("screenPadding");return z&&t.equals(B,z)?z:B}get x(){return this._viewport[0]}set x(B){B+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==B&&(this._viewport[0]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(B){B+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==B&&(this._viewport[1]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(B){this._viewport[2]!==
B&&(this._viewport[2]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(B){this._viewport[3]!==B&&(this._viewport[3]=B,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]}set fullWidth(B){this.width=B-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}get fullHeight(){return this._viewport[3]+
this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]}set fullHeight(B){this.height=B-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}get fullViewport(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(B){t.exactEquals(this._padding,
B)||(this._viewport[0]+=B[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=B[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=B[a.PaddingSide.RIGHT]+B[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=B[a.PaddingSide.TOP]+B[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),t.copy(this._padding,B),this._frustumDirty=this._viewProjectionDirty=!0,
this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){this._viewProjectionDirty&&(l.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}get projectionMatrix(){var B=this.width,z=this.height,K=this.near*Math.tan(this.fovY/2)*2,L=K*this._aspect,F=K/this.rows,M=L/this.columns;L=-L/2+this.column*M;M=L+M;K=-K/2+this.row*F;F=K+F;B=l.frustum(f.create(),L*(1+2*this._padding[a.PaddingSide.LEFT]/
B),M*(1+2*this._padding[a.PaddingSide.RIGHT]/B),K*(1+2*this._padding[a.PaddingSide.BOTTOM]/z),F*(1+2*this._padding[a.PaddingSide.TOP]/z),this.near,this.far);return(z=this._get("projectionMatrix"))&&l.equals(z,B)?z:B}get inverseProjectionMatrix(){return l.invert(f.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||f.create()}get fov(){return this._fov}set fov(B){this._fov=B;this._frustumDirty=this._viewProjectionDirty=!0}get fovX(){return G.fovd2fovx(this._fov,this.width,this.height)}set fovX(B){this._fov=
G.fovx2fovd(B,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get fovY(){return G.fovd2fovy(this._fov,this.width,this.height)}set fovY(B){this._fov=G.fovy2fovd(B,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}get distance(){return w.distance(this.center,this.eye)}get frustum(){this._recomputeFrustum();return this._frustum}get viewInverseTransposeMatrix(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)l.invert(this._viewInverseTransposeMatrix,
this.viewMatrix),l.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}depthNDCToWorld(B){return 2*this.near*this.far/(this.far+this.near-(2*B-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&0<=this.relativeElevation}copyFrom(B){w.copy(this._ray.origin,
B.eye);this.center=B.center;this.up=B.up;t.copy(this._viewport,B.viewport);this.notifyChange("_viewport");t.copy(this._padding,B.padding);this.notifyChange("_padding");r.copy(this._nearFar,B.nearFar);this.notifyChange("_nearFar");this._fov=B.fov;this.row=B.row;this.column=B.column;this.rows=B.rows;this.columns=B.columns;this.relativeElevation=B.relativeElevation;this._viewDirty=B._viewDirty;this._viewDirty||(l.copy(this._viewMatrix,B.viewMatrix),this.notifyChange("_viewMatrix"));this._viewProjectionDirty=
!0;this._frustumDirty=B._frustumDirty;this._frustumDirty||(u.copy(this._frustum,B.frustum),this._frustumDirty=!1);B._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(l.copy(this._viewInverseTransposeMatrix,B.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);t.copy(this._fullViewport,B.fullViewport);this.pixelRatio=B.pixelRatio;return this}copyViewFrom(B){this.eye=B.eye;this.center=B.center;this.up=B.up}clone(){return(new A).copyFrom(this)}equals(B){return w.exactEquals(this.eye,
B.eye)&&w.exactEquals(this.center,B.center)&&w.exactEquals(this.up,B.up)&&t.exactEquals(this._viewport,B.viewport)&&t.exactEquals(this._padding,B.padding)&&r.exactEquals(this.nearFar,B.nearFar)&&this._fov===B.fov&&this.pixelRatio===B.pixelRatio&&this.relativeElevation===B.relativeElevation&&this.row===B.row&&this.column===B.column&&this.rows===B.rows&&this.columns===B.columns}almostEquals(B){var z=Math.max(1,1/this.pixelRatio,1/B.pixelRatio);if(.001<=Math.abs(B.fov-this._fov)||t.squaredDistance(B.screenPadding,
this.screenPadding)>=z||t.squaredDistance(this.screenViewport,B.screenViewport)>=z||this.row!==B.row||this.column!==B.column||this.rows!==B.rows||this.columns!==B.columns)return!1;w.sub(I,B.eye,B.center);w.sub(H,this.eye,this.center);z=w.dot(I,H);const K=w.sqrLen(I),L=w.sqrLen(H);return z*z>=(1-1E-10)*K*L&&w.sqrDist(B.eye,this.eye)<2.5E-7*Math.max(K,L)}computeRenderPixelSizeAt(B){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(B))}computeRenderPixelSizeAtDist(B){return B*this.perRenderPixelRatio}computeScreenPixelSizeAt(B){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(B))}_viewDirectionDistance(B){return Math.abs(y.projectPointSignedLength(this.viewForward,
w.subtract(I,B,this.eye)))}computeScreenPixelSizeAtDist(B){return B*this.perScreenPixelRatio}computeDistanceFromRadius(B,z){return B/Math.tan(Math.min(this.fovX,this.fovY)/(2*(z||1)))}getScreenCenter(B=m.createScreenPointArray()){B[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;B[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return B}getRenderCenter(B,z=.5,K=.5){B[0]=this.padding[a.PaddingSide.LEFT]+this.width*z;B[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*
K;B[2]=.5;return B}setGLViewport(B){const z=this.viewport,K=this.padding;B.setViewport(z[0]-K[3],z[1]-K[2],z[2]+K[1]+K[3],z[3]+K[0]+K[2])}applyProjection(B,z){B!==C&&w.copy(C,B);C[3]=1;t.transformMat4(C,C,this.projectionMatrix);B=Math.abs(C[3]);w.scale(C,C,1/B);const K=this.fullViewport;z[0]=k.lerp(0,K[0]+K[2],.5+.5*C[0]);z[1]=k.lerp(0,K[1]+K[3],.5+.5*C[1]);z[2]=.5*(C[2]+1);z[3]=B}unapplyProjection(B,z){const K=this.fullViewport;C[0]=(B[0]/(K[0]+K[2])*2-1)*B[3];C[1]=(B[1]/(K[1]+K[3])*2-1)*B[3];C[2]=
(2*B[2]-1)*B[3];C[3]=B[3];null!=this.inverseProjectionMatrix&&(t.transformMat4(C,C,this.inverseProjectionMatrix),z[0]=C[0],z[1]=C[1],z[2]=C[2])}projectToScreen(B,z){this.projectToRenderScreen(B,J);this.renderToScreen(J,z);return z}projectToRenderScreen(B,z){C[0]=B[0];C[1]=B[1];C[2]=B[2];C[3]=1;t.transformMat4(C,C,this.viewProjectionMatrix);if(0===C[3])return null;B=C;w.scale(B,B,1/Math.abs(C[3]));var K=this.fullViewport;const L=k.lerp(0,K[0]+K[2],.5+.5*B[0]);K=k.lerp(0,K[1]+K[3],.5+.5*B[1]);"x"in
z?(z.x=L,z.y=K):(z[0]=L,z[1]=K,2<z.length&&(z[2]=.5*(B[2]+1)));return z}unprojectFromScreen(B,z){return this.unprojectFromRenderScreen(this.screenToRender(B,J),z)}unprojectFromRenderScreen(B,z){l.multiply(E,this.projectionMatrix,this.viewMatrix);if(!l.invert(E,E))return null;const K=this.fullViewport;C[0]=2*(B[0]-K[0])/K[2]-1;C[1]=2*(B[1]-K[1])/K[3]-1;C[2]=2*B[2]-1;C[3]=1;t.transformMat4(C,C,E);if(0===C[3])return null;z[0]=C[0]/C[3];z[1]=C[1]/C[3];z[2]=C[2]/C[3];return z}constrainWindowSize(B,z,K,
L){B*=this.pixelRatio;z*=this.pixelRatio;return[Math.round(Math.max(B-K/2,0)),Math.round(Math.max(this.fullHeight-z-L/2,0)),Math.round(K- -Math.min(B-K/2,0)- -Math.min(this.fullWidth-B-K/2,0)),Math.round(L- -Math.min(this.fullHeight-z-L/2,0)- -Math.min(z-L/2,0))]}computeUp(B){B===D.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(B,z){const K=this.fullHeight-B[1]*this.pixelRatio;z[0]=B[0]*this.pixelRatio;z[1]=K;return z}renderToScreen(B,z){const K=(this.fullHeight-
B[1])/this.pixelRatio;z[0]=B[0]/this.pixelRatio;z[1]=K}_computeUpGlobal(){w.subtract(I,this.center,this.eye);const B=w.length(this.center);1>B?(w.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(w.dot(I,this.center))>.9999*w.length(I)*B||(w.cross(this._up,I,this.center),w.cross(this._up,this._up,I),w.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){w.direction(I,this.eye,this.center);.9999>=Math.abs(I[2])&&(w.scale(I,I,I[2]),
w.set(this._up,-I[0],-I[1],1-I[2]),w.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(B,z,K=""){"number"===typeof B[0]&&isFinite(B[0])&&"number"===typeof B[1]&&isFinite(B[1])&&"number"===typeof B[2]&&isFinite(B[2])?w.exactEquals(B,z)||(w.copy(z,B),this._markViewDirty(),K.length&&this.notifyChange(K)):h.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewProjectionDirty=
this._frustumDirty=this._viewDirty=!0}_recomputeFrustum(){this._frustumDirty&&(u.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(l.lookAt(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};b.__decorate([g.property()],a.Camera.prototype,"_viewport",void 0);b.__decorate([g.property()],a.Camera.prototype,"_padding",void 0);b.__decorate([g.property()],
a.Camera.prototype,"_fov",void 0);b.__decorate([g.property()],a.Camera.prototype,"_nearFar",void 0);b.__decorate([g.property()],a.Camera.prototype,"_viewDirty",void 0);b.__decorate([g.property()],a.Camera.prototype,"_viewMatrix",void 0);b.__decorate([g.property()],a.Camera.prototype,"_pixelRatio",void 0);b.__decorate([g.property()],a.Camera.prototype,"pixelRatio",null);b.__decorate([g.property()],a.Camera.prototype,"row",void 0);b.__decorate([g.property()],a.Camera.prototype,"column",void 0);b.__decorate([g.property()],
a.Camera.prototype,"_rows",void 0);b.__decorate([g.property()],a.Camera.prototype,"rows",null);b.__decorate([g.property()],a.Camera.prototype,"_columns",void 0);b.__decorate([g.property()],a.Camera.prototype,"columns",null);b.__decorate([g.property()],a.Camera.prototype,"eye",null);b.__decorate([g.property()],a.Camera.prototype,"center",null);b.__decorate([g.property()],a.Camera.prototype,"_center",void 0);b.__decorate([g.property()],a.Camera.prototype,"up",null);b.__decorate([g.property()],a.Camera.prototype,
"_up",void 0);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"viewForward",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"viewUp",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"viewRight",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"nearFar",null);b.__decorate([g.property()],a.Camera.prototype,"near",null);b.__decorate([g.property()],a.Camera.prototype,"far",null);b.__decorate([g.property()],a.Camera.prototype,"viewport",null);
b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"screenViewport",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"screenPadding",null);b.__decorate([g.property()],a.Camera.prototype,"x",null);b.__decorate([g.property()],a.Camera.prototype,"y",null);b.__decorate([g.property()],a.Camera.prototype,"width",null);b.__decorate([g.property()],a.Camera.prototype,"height",null);b.__decorate([g.property()],a.Camera.prototype,"fullWidth",null);b.__decorate([g.property()],a.Camera.prototype,
"fullHeight",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"_aspect",null);b.__decorate([g.property()],a.Camera.prototype,"padding",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"projectionMatrix",null);b.__decorate([g.property({readOnly:!0})],a.Camera.prototype,"inverseProjectionMatrix",null);b.__decorate([g.property()],a.Camera.prototype,"fov",null);b.__decorate([g.property()],a.Camera.prototype,"fovX",null);b.__decorate([g.property()],a.Camera.prototype,
"fovY",null);a.Camera=A=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.Camera")],a.Camera);const C=q.create(),E=f.create(),I=p.create(),H=p.create(),J=m.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(B){B[B.TOP=0]="TOP";B[B.RIGHT=1]="RIGHT";B[B.BOTTOM=2]="BOTTOM";B[B.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../core/libs/gl-matrix-2/math/mat4 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../../chunks/vec42 ../../core/libs/gl-matrix-2/factories/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(){return[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]}function f(q,u){d.fromPoints(u[a.PointIndex.FAR_BOTTOM_LEFT],u[a.PointIndex.NEAR_BOTTOM_LEFT],u[a.PointIndex.NEAR_TOP_LEFT],q[a.PlaneIndex.LEFT]);d.fromPoints(u[a.PointIndex.NEAR_BOTTOM_RIGHT],u[a.PointIndex.FAR_BOTTOM_RIGHT],u[a.PointIndex.FAR_TOP_RIGHT],q[a.PlaneIndex.RIGHT]);d.fromPoints(u[a.PointIndex.FAR_BOTTOM_LEFT],u[a.PointIndex.FAR_BOTTOM_RIGHT],u[a.PointIndex.NEAR_BOTTOM_RIGHT],
q[a.PlaneIndex.BOTTOM]);d.fromPoints(u[a.PointIndex.NEAR_TOP_LEFT],u[a.PointIndex.NEAR_TOP_RIGHT],u[a.PointIndex.FAR_TOP_RIGHT],q[a.PlaneIndex.TOP]);d.fromPoints(u[a.PointIndex.NEAR_BOTTOM_LEFT],u[a.PointIndex.NEAR_BOTTOM_RIGHT],u[a.PointIndex.NEAR_TOP_RIGHT],q[a.PlaneIndex.NEAR]);d.fromPoints(u[a.PointIndex.FAR_BOTTOM_RIGHT],u[a.PointIndex.FAR_BOTTOM_LEFT],u[a.PointIndex.FAR_TOP_LEFT],q[a.PlaneIndex.FAR])}function r(q,u){for(let v=0;6>v;v++)if(!d.clip(q[v],u))return!1;return!0}a.PlaneIndex=void 0;
(function(q){q[q.LEFT=0]="LEFT";q[q.RIGHT=1]="RIGHT";q[q.BOTTOM=2]="BOTTOM";q[q.TOP=3]="TOP";q[q.NEAR=4]="NEAR";q[q.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(q){q[q.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";q[q.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";q[q.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";q[q.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";q[q.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";q[q.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";q[q.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";q[q.FAR_TOP_LEFT=7]=
"FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const x={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,
a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]},w=[g.fromValues(-1,-1,-1,1),g.fromValues(1,-1,-1,1),g.fromValues(1,1,-1,1),g.fromValues(-1,1,-1,1),g.fromValues(-1,-1,1,1),g.fromValues(1,-1,1,1),g.fromValues(1,1,1,1),g.fromValues(-1,1,1,1)],p=new b.ObjectStack(e.create),t=l();a.computePlanes=
f;a.copy=function(q,u){for(let v=0;6>v;v++)d.copy(q[v],u[v]);return q};a.create=function(q){return q?[d.create(q[0]),d.create(q[1]),d.create(q[2]),d.create(q[3]),d.create(q[4]),d.create(q[5])]:[d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]};a.createPoints=l;a.fromMatrix=function(q,u,v,y=t){q=n.multiply(c.sm4d.get(),u,q);n.invert(q,q);for(u=0;8>u;++u){const D=m.transformMat4(c.sv4d.get(),w[u],q);h.set(y[u],D[0]/D[3],D[1]/D[3],D[2]/D[3])}f(v,y)};a.intersectClipRay=function(q,u){for(let v=
0;6>v;v++)if(!d.clipInfinite(q[v],u))return!1;return!0};a.intersectsLineSegment=function(q,u,v){return r(q,e.fromLineSegmentAndDirection(u,v,p.get()))};a.intersectsPoint=function(q,u){for(let v=0;6>v;v++)if(0<d.signedDistance(q[v],u))return!1;return!0};a.intersectsRay=function(q,u){return r(q,e.fromRay(u,p.get()))};a.intersectsSphere=function(q,u){for(let v=0;6>v;v++){const y=q[v];if(y[0]*u[0]+y[1]*u[1]+y[2]*u[2]+y[3]>=u[3])return!1}return!0};a.numPlanes=6;a.numPoints=8;a.planePointIndices=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","./ray"],function(a,b,n,h){function k(d){return d?{ray:h.create(d.ray),c0:d.c0,c1:d.c1}:{ray:h.create(),c0:0,c1:Number.MAX_VALUE}}function m(d,c,l,f=k()){h.copy(d,f.ray);f.c0=c;f.c1=l;return f}function g(d,c,l){return n.add(l,d.ray.origin,n.scale(l,d.ray.direction,c))}const e=new b.ObjectStack(()=>k());a.copy=function(d,c=k()){return m(d.ray,d.c0,d.c1,
c)};a.create=k;a.fromLineSegmentAndDirection=function(d,c,l=k()){const f=n.length(d.vector);h.fromValues(d.origin,c,l.ray);l.c0=0;l.c1=f;return l};a.fromRay=function(d,c=k()){h.copy(d,c.ray);c.c0=0;c.c1=Number.MAX_VALUE;return c};a.fromValues=m;a.getAt=g;a.getEnd=function(d,c){return g(d,d.c1,c)};a.getStart=function(d,c){return g(d,d.c0,c)};a.wrap=function(d,c,l){const f=e.get();f.ray=d;f.c0=c;f.c1=l;return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],
function(a){a.fovd2fovx=function(b,n,h){return 2*Math.atan(n*Math.tan(.5*b)/Math.sqrt(n*n+h*h))};a.fovd2fovy=function(b,n,h){return 2*Math.atan(h*Math.tan(.5*b)/Math.sqrt(n*n+h*h))};a.fovx2fovd=function(b,n,h){return 2*Math.atan(Math.sqrt(n*n+h*h)*Math.tan(.5*b)/n)};a.fovy2fovd=function(b,n,h){return 2*Math.atan(Math.sqrt(n*n+h*h)*Math.tan(.5*b)/h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=
void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.OPAQUE_NO_SSAO_DEPTH=3]="OPAQUE_NO_SSAO_DEPTH";b[b.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_NO_SSAO_DEPTH=5]="TRANSPARENT_NO_SSAO_DEPTH";b[b.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN";
b[b.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS";b[b.ANTIALIASING=12]="ANTIALIASING";b[b.COMPOSITE=13]="COMPOSITE";b[b.BLIT=14]="BLIT";b[b.SSAO=15]="SSAO";b[b.HIGHLIGHT=16]="HIGHLIGHT";b[b.SHADOW_HIGHLIGHT=17]="SHADOW_HIGHLIGHT";b[b.ENVIRONMENT_OPAQUE=18]="ENVIRONMENT_OPAQUE";b[b.ENVIRONMENT_TRANSPARENT=19]="ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=20]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=
21]="LASERLINES_CONTRAST_CONTROL";b[b.HUD_MATERIAL=22]="HUD_MATERIAL";b[b.LABEL_MATERIAL=23]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=24]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=25]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=26]="DRAPED_MATERIAL";b[b.DRAPED_WATER=27]="DRAPED_WATER";b[b.VOXEL=28]="VOXEL";b[b.MAX_SLOTS=29]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=
void 0;var b=a.TransparencyPassType||(a.TransparencyPassType={});b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,b,n,h,k,m){class g{constructor(){this.color=
h.create();this.intensity=1}}class e{constructor(){this.direction=h.create();this.ambient=new g;this.diffuse=new g}}class d{constructor(){this._shOrder=2;this._legacy=new e;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new k.SphericalHarmonicsAmbientLight;this._mainLight=new k.MainLight(h.create(),h.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(l){m.combineLights(l,this._shOrder,this._mainLight,
this._sphericalHarmonics);n.copy(this._legacy.direction,this._mainLight.direction);l=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*l;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*l;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*l;n.scale(this._legacy.diffuse.color,this._mainLight.intensity,l);n.copy(c,this._legacy.diffuse.color);n.scale(c,c,.4*this.globalFactor);n.add(this._legacy.ambient.color,this._legacy.ambient.color,c)}copyFrom(l){this._sphericalHarmonics.r=
Array.from(l.sh.r);this._sphericalHarmonics.g=Array.from(l.sh.g);this._sphericalHarmonics.b=Array.from(l.sh.b);n.copy(this._mainLight.direction,l.mainLight.direction);n.copy(this._mainLight.intensity,l.mainLight.intensity);this._mainLight.castShadows=l.mainLight.castShadows;this._mainLight.specularStrength=l.mainLight.specularStrength;this._mainLight.environmentStrength=l.mainLight.environmentStrength;this.globalFactor=l.globalFactor;this.noonFactor=l.noonFactor}lerpLighting(l,f,r){n.lerp(this._mainLight.intensity,
l.mainLight.intensity,f.mainLight.intensity,r);this._mainLight.environmentStrength=b.lerp(l.mainLight.environmentStrength,f.mainLight.environmentStrength,r);this._mainLight.specularStrength=b.lerp(l.mainLight.specularStrength,f.mainLight.specularStrength,r);n.copy(this._mainLight.direction,f.mainLight.direction);this._mainLight.castShadows=f.mainLight.castShadows;this.globalFactor=b.lerp(l.globalFactor,f.globalFactor,r);this.noonFactor=b.lerp(l.noonFactor,f.noonFactor,r);if(l.sh.r.length===f.sh.r.length)for(let x=
0;x<f.sh.r.length;x++)this._sphericalHarmonics.r[x]=b.lerp(l.sh.r[x],f.sh.r[x],r),this._sphericalHarmonics.g[x]=b.lerp(l.sh.g[x],f.sh.g[x],r),this._sphericalHarmonics.b[x]=b.lerp(l.sh.b[x],f.sh.b[x],r);else for(l=0;l<f.sh.r.length;l++)this._sphericalHarmonics.r[l]=f.sh.r[l],this._sphericalHarmonics.g[l]=f.sh.g[l],this._sphericalHarmonics.b[l]=f.sh.b[l]}}const c=h.create();a.SceneLighting=d;a.SunLight=e;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(g=b.create()){this.intensity=g}}class h{constructor(g=b.create(),e=b.fromValues(.57735,.57735,.57735)){this.intensity=g;this.direction=e}}class k{constructor(g=b.create(),e=b.fromValues(.57735,.57735,.57735),d=!0,c=1,l=1){this.intensity=g;this.direction=e;this.castShadows=d;this.specularStrength=c;this.environmentStrength=l}}class m{constructor(){this.r=[0];this.g=[0];this.b=[0]}}a.AmbientLight=n;a.FillLight=
h;a.MainLight=k;a.SphericalHarmonicsAmbientLight=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,b,n,h,k,m){function g(v){return(v+1)*(v+1)}function e(v){return b.clamp(Math.floor(Math.sqrt(v)-1),0,2)}function d(v,y,D){const G=v[0],A=v[1];
v=v[2];D=D||[];D.length=g(y);0<=y&&(D[0]=.28209479177);1<=y&&(D[1]=.4886025119*G,D[2]=.4886025119*v,D[3]=.4886025119*A);2<=y&&(D[4]=1.09254843059*G*A,D[5]=1.09254843059*A*v,D[6]=.31539156525*(3*v*v-1),D[7]=1.09254843059*G*v,D[8]=.54627421529*(G*G-A*A));return D}function c(v,y){v=g(v);y=y||{r:[],g:[],b:[]};y.r.length=y.g.length=y.b.length=v;for(let D=0;D<v;D++)y.r[D]=y.g[D]=y.b[D]=0;return y}function l(v,y){const D=e(y.r.length);for(const G of v)n.negate(q,G.direction),d(q,D,p),k.elementwiseProduct(p,
u),k.scalarProduct(p,G.intensity[0],t),k.add(y.r,t),k.scalarProduct(p,G.intensity[1],t),k.add(y.g,t),k.scalarProduct(p,G.intensity[2],t),k.add(y.b,t);return y}function f(v,y){d(q,0,p);for(const D of v)y.r[0]+=p[0]*u[0]*D.intensity[0]*4*Math.PI,y.g[0]+=p[0]*u[0]*D.intensity[1]*4*Math.PI,y.b[0]+=p[0]*u[0]*D.intensity[2]*4*Math.PI;return y}const r=[],x=[],w=[],p=[0],t=[0],q=h.create(),u=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(v,y,D,G){c(y,
G);n.set(D.intensity,0,0,0);y=!1;r.length=0;x.length=0;w.length=0;for(const A of v)A instanceof m.MainLight&&!y?(n.copy(D.direction,A.direction),n.copy(D.intensity,A.intensity),D.specularStrength=A.specularStrength,D.environmentStrength=A.environmentStrength,D.castShadows=A.castShadows,y=!0):A instanceof m.MainLight||A instanceof m.FillLight?r.push(A):A instanceof m.AmbientLight?x.push(A):A instanceof m.SphericalHarmonicsAmbientLight&&w.push(A);l(r,G);f(x,G);for(const A of w)k.add(G.r,A.r),k.add(G.g,
A.g),k.add(G.b,A.b)};a.computeCoefficients=d;a.initSHCoefficients=c;a.numberOfCoefficients=g;a.orderFromNumberOfCoefficients=e;a.projectAmbientLights=f;a.projectFillLights=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,n,h){h=h||b;h.length=b.length;for(let k=0;k<b.length;k++)h[k]=b[k]+n[k];return h};a.dotProduct=function(b,n){let h=0;for(let k=0;k<b.length;k++)h+=b[k]*n[k];
return h};a.elementwiseProduct=function(b,n,h){h=h||b;h.length=b.length;for(let k=0;k<b.length;k++)h[k]=b[k]*n[k];return h};a.scalarProduct=function(b,n,h){h=h||b;h.length=b.length;for(let k=0;k<b.length;k++)h[k]=b[k]*n;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define("exports ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/PerformanceSampler ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/signal ../../core/time ../../layers/support/PromiseQueue ./debugFlags ./RenderState ./Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(I){return t.has(I)?t.get(I):"number"===typeof I?I:1}a.TaskPriority=void 0;(function(I){I.RESOURCE_CONTROLLER_IMMEDIATE="immediate";I.RESOURCE_CONTROLLER="schedule";I.SLIDE="slide";I.STREAM_DATA_LOADER="stream loader";I.ELEVATION_QUERY="elevation query";I.TERRAIN_SURFACE="terrain";I.SURFACE_GEOMETRY_UPDATES="surface geometry updates";I.LOD_RENDERER="LoD renderer";I.GRAPHICS_CORE="Graphics3D";I.I3S_CONTROLLER="I3S";I.POINT_CLOUD_LAYER="point cloud";
I.FEATURE_TILE_FETCHER="feature fetcher";I.OVERLAY="overlay";I.STAGE="stage";I.GRAPHICS_DECONFLICTOR="graphics deconflictor";I.FILTER_VISIBILITY="Graphics3D filter visibility";I.SCALE_VISIBILITY="Graphics3D scale visibility";I.FRUSTUM_VISIBILITY="Graphics3D frustum visibility";I.POINT_OF_INTEREST_FREQUENT="POI frequent";I.POINT_OF_INTEREST_INFREQUENT="POI infrequent";I.LABELER="labeler";I.FEATURE_QUERY_ENGINE="feature query";I.FEATURE_TILE_TREE="feature tile tree";I.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree";
I.ELEVATION_ALIGNMENT="elevation alignment";I.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene";I.TEXT_TEXTURE_ATLAS="text texture atlas";I.TEXTURE_UNLOAD="texture unload";I.LINE_OF_SIGHT_TOOL="line of sight tool";I.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool";I.ELEVATION_PROFILE="elevation profile";I.SNAPPING="snapping";I.SHADOW_ACCUMULATOR="shadow accumulator";I.CLOUDS_GENERATOR="clouds generator";I[I.NONE=0]="NONE";I[I.TEST_PRIO=1]="TEST_PRIO"})(a.TaskPriority||(a.TaskPriority=
{}));const t=new Map([[a.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE,0],[a.TaskPriority.RESOURCE_CONTROLLER,4],[a.TaskPriority.SLIDE,0],[a.TaskPriority.STREAM_DATA_LOADER,0],[a.TaskPriority.ELEVATION_QUERY,0],[a.TaskPriority.TERRAIN_SURFACE,1],[a.TaskPriority.SURFACE_GEOMETRY_UPDATES,1],[a.TaskPriority.LOD_RENDERER,2],[a.TaskPriority.GRAPHICS_CORE,2],[a.TaskPriority.I3S_CONTROLLER,2],[a.TaskPriority.POINT_CLOUD_LAYER,2],[a.TaskPriority.FEATURE_TILE_FETCHER,2],[a.TaskPriority.OVERLAY,4],[a.TaskPriority.STAGE,
4],[a.TaskPriority.GRAPHICS_DECONFLICTOR,4],[a.TaskPriority.FILTER_VISIBILITY,4],[a.TaskPriority.SCALE_VISIBILITY,4],[a.TaskPriority.FRUSTUM_VISIBILITY,4],[a.TaskPriority.CLOUDS_GENERATOR,4],[a.TaskPriority.POINT_OF_INTEREST_FREQUENT,6],[a.TaskPriority.POINT_OF_INTEREST_INFREQUENT,30],[a.TaskPriority.LABELER,8],[a.TaskPriority.FEATURE_QUERY_ENGINE,8],[a.TaskPriority.FEATURE_TILE_TREE,16],[a.TaskPriority.FEATURE_TILE_TREE_ACTIVE,0],[a.TaskPriority.ELEVATION_ALIGNMENT,12],[a.TaskPriority.ELEVATION_ALIGNMENT_SCENE,
14],[a.TaskPriority.TEXT_TEXTURE_ATLAS,12],[a.TaskPriority.TEXTURE_UNLOAD,12],[a.TaskPriority.LINE_OF_SIGHT_TOOL,16],[a.TaskPriority.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[a.TaskPriority.SNAPPING,0],[a.TaskPriority.SHADOW_ACCUMULATOR,30]]),q=l.Milliseconds(6.5),u=l.Milliseconds(1),v=l.Milliseconds(30),y=l.Milliseconds(1E3/30),D=l.Milliseconds(100);var G;(function(I){class H{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(z=>z.needsUpdate)}constructor(){this._updating=
c.signal(!0);this._microTaskQueued=!1;this._frameNumber=0;this.performanceInfo={total:new m("total"),tasks:new Map};this._frameTaskTimes=new Map;this._budget=new B;this._state=x.RenderState.INTERACTING;this._tasks=new g;this._runQueue=new g;this._load=0;this._idleStateCallbacks=new g;this._debug=this._forceTask=this._idleUpdatesStartFired=!1;this._debugHandle=d.watch(()=>r.SCHEDULER_LOG_SLOW_TASKS,K=>this._debug=K,d.initial);for(const K of Object.keys(a.TaskPriority))this.performanceInfo.tasks.set(a.TaskPriority[K],
new m(a.TaskPriority[K]));const z=this;this._test={FRAME_SAFETY_BUDGET:q,INTERACTING_BUDGET:y,IDLE_BUDGET:D,get availableBudget(){return z._budget.budget},usedBudget:0,getBudget:()=>z._budget,setBudget:K=>z._budget=K,updateTask:K=>this._updateTask(K),getState:K=>this._getState(K),getRuntime:K=>this._getRuntime(K),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(z=>z.remove());this._tasks.clear();
k.removeMaybe(this._debugHandle);this._microTaskQueued=!1;this._updatingChanged()}taskRunningChanged(z){this._updatingChanged();z&&0<this._budget.remaining&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,0<this._budget.remaining&&this._schedule()&&this.frame())}))}registerTask(z,K){K=new J(this,z,K);this._tasks.push(K);this._updatingChanged();this.performanceInfo.tasks.has(z)||this.performanceInfo.tasks.set(z,new m(z));return K}registerIdleStateCallbacks(z,
K){const L={idleBegin:z,idleEnd:K};this._idleStateCallbacks.push(L);this.state===x.RenderState.IDLE&&this._idleUpdatesStartFired&&L.idleBegin();const F=this;return{remove:()=>this._removeIdleStateCallbacks(L),set idleBegin(M){F._idleUpdatesStartFired&&(L.idleEnd(),F._state===x.RenderState.IDLE&&M());L.idleBegin=M},set idleEnd(M){L.idleEnd=M}}}get load(){return this._load}set state(z){this._state!==z&&(this._state=z,this.state!==x.RenderState.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this._idleStateCallbacks.forAll(K=>K.idleEnd())))}get state(){return this._state}updateBudget(z){this._test.usedBudget=0;++this._frameNumber;let K=q,L=z.frameDuration,F=u;switch(this.state){case x.RenderState.IDLE:K=l.Milliseconds(0);L=l.Milliseconds(Math.max(D,z.frameDuration));F=v;break;case x.RenderState.INTERACTING:L=l.Milliseconds(Math.max(y,z.frameDuration))}L=l.Milliseconds(L-z.elapsedFrameTime-K);if(this.state!==x.RenderState.IDLE&&L<u&&!this._forceTask)return this._forceTask=!0,!1;L=l.Milliseconds(Math.max(L,
F));this._budget.reset(L,this.state);this._updateLoad();return this._schedule()}frame(){this._microTaskQueued=this._forceTask=!1;switch(this.state){case x.RenderState.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(z=>z.idleBegin()));this._runIdle();break;case x.RenderState.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(l.Milliseconds(0),this._state);this._budget.madeProgress()}_removeIdleStateCallbacks(z){this._idleUpdatesStartFired&&
z.idleEnd();this._idleStateCallbacks.removeUnordered(z)}removeTask(z){this._tasks.removeUnordered(z);this._runQueue.removeUnordered(z);this._updatingChanged()}_updateTask(z){this._tasks.forAll(K=>{K.name===z&&K.setPriority(z)})}_getState(z){if(this._runQueue.some(L=>L.name===z))return a.TaskState.SCHEDULED;let K=a.TaskState.IDLE;this._tasks.forAll(L=>{L.name===z&&L.needsUpdate&&(1>=L.schedulePriority?K=a.TaskState.READY:K!==a.TaskState.READY&&(K=a.TaskState.WAITING))});return K}_getRuntime(z){let K=
0;this._tasks.forAll(L=>{L.name===z&&(K+=L.runtime)});return K}_resetRuntimes(){this._tasks.forAll(z=>z.runtime=0)}_getRunning(){const z=new Map;this._tasks.forAll(L=>{L.needsUpdate&&z.set(L.name,(z.get(L.name)||0)+1)});if(0===z.size)return null;let K="";z.forEach((L,F)=>{K=1<L?K+` ${L}x ${F}`:K+` ${F}`});return K}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const z=this._tasks.reduce((K,L)=>L.needsUpdate?++K:K,0);this._load=.9*this._load+z*(1-.9)}_schedule(){this._runQueue.filterInPlace(z=>
{if(z.needsUpdate)return!0;z.schedulePriority=z.basePriority;return!1});for(this._tasks.forAll(z=>{0===z.basePriority&&z.needsUpdate&&!this._runQueue.includes(z)&&z.blockFrame!==this._frameNumber&&this._runQueue.unshift(z)});0===this._runQueue.length;){let z=!1;this._tasks.forAll(K=>{if(K.needsUpdate&&0!==K.schedulePriority&&0!==K.basePriority&&K.blockFrame!==this._frameNumber)switch(z=!0,K.schedulePriority){case 1:K.schedulePriority=0;this._runQueue.push(K);break;default:--K.schedulePriority}});
if(!z)return this._updatingChanged(),!1}this._updatingChanged();return!0}_run(){const z=this._budget.now();this._startFrameTaskTimes();do for(;0<this._runQueue.length;){var K=this._budget.now();const L=this._runQueue.pop();this._budget.resetProgress();try{L.task.runTask(this._budget)===w.Yield&&(L.blockFrame=this._frameNumber)}catch(F){h.getLogger("esri.views.support.Scheduler").error(`Exception in task "${L.name}"`,F),L.blockFrame=this._frameNumber}!this._budget.hasProgressed&&L.blockFrame!==this._frameNumber&&
L.needsUpdate&&(L.blockFrame=this._frameNumber);L.schedulePriority=L.basePriority;K=this._budget.now()-K;L.runtime+=K;this._frameTaskTimes.set(L.priority,this._frameTaskTimes.get(L.priority)+K);this._debug&&K>2*this._budget.budget&&console.log("Task",L.name,"used",K,"of max",this._budget.budget,"ms");if(0>=this._budget.remaining){this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-z);return}}while(this._schedule());this._updatingChanged();this._recordFrameTaskTimes(this._budget.now()-
z)}_startFrameTaskTimes(){for(const z of Object.keys(a.TaskPriority))this._frameTaskTimes.set(a.TaskPriority[z],0)}_recordFrameTaskTimes(z){this._frameTaskTimes.forEach((K,L)=>this.performanceInfo.tasks.get(L).record(K));this.performanceInfo.total.record(z)}get test(){return this._test}}I.Scheduler=H;class J{get task(){return this._task.value}get updating(){return this._queue.running}constructor(z,K,L){this._scheduler=z;this.name=K;this.runtime=this.blockFrame=0;this._queue=new f.PromiseQueue;this._handles=
new b;this.schedulePriority=this._basePriority=p(K);this._task=c.signal(null!=L?L:this._queue);this._handles.add(d.when(()=>this.task.running,F=>z.taskRunningChanged(F)))}remove(){this.processQueue(A);this._scheduler.removeTask(this);this.schedule=E.schedule;this.reschedule=E.reschedule;this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(z){if(this.name!==z){this.name=z;z=p(z);if(0===this._basePriority||0!==this.schedulePriority)this.schedulePriority=z;this._basePriority=
z}}get priority(){return this.name}set priority(z){this.setPriority(z)}get needsUpdate(){return this.updating||this.task.running}schedule(z,K,L){return this._queue.push(z,K,L)}reschedule(z,K,L){return this._queue.unshift(z,K,L)}processQueue(z){return this._queue.runTask(z)}}class B{constructor(){this._begin="undefined"!==typeof performance?performance.now():0;this._budget=0;this._state=x.RenderState.IDLE;this._progressed=this._done=!1;this._enabled=!0}run(z){if(this.done)return!1;!0===z()&&this.madeProgress();
return!0}get done(){return this._done}get budget(){return this._budget}madeProgress(){this._progressed=!0;return this._done=this.elapsed>=this._budget&&this._enabled}get state(){return this._state}get enabled(){return this._enabled}set enabled(z){this._enabled=z}reset(z,K){this._begin=this.now();this._budget=z;this._state=K;this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._done=
this._progressed=!1}get hasProgressed(){return this._progressed}}I.Budget=B})(G||={});a.TaskState=void 0;(function(I){I.SCHEDULED="s";I.READY="r";I.WAITING="w";I.IDLE="i"})(a.TaskState||(a.TaskState={}));const A=(()=>{const I=new G.Budget;I.enabled=!1;return I})();class C{remove(){}processQueue(){}schedule(I,H,J){try{if(e.isAborted(H)){const B=e.createAbortError();return J?Promise.resolve(J(B)):Promise.reject(B)}return e.when(I(A))}catch(B){return Promise.reject(B)}}reschedule(I,H,J){return this.schedule(I,
H,J)}}const E=new C;a.ImmediateTask=E;a.getTaskPriority=p;a.newScheduler=function(){return new G.Scheduler};a.noBudget=A;a.taskPriorities=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(a,b,n,h){class k{constructor(){this._tasks=[];this._runningTasks=n.signal(0)}get length(){return this._tasks.length}get running(){return 0<this._runningTasks.value}destroy(){this.cancelAll()}runTask(g){if(0===
this.length)return h.Yield;for(;!g.done&&this._process(g);)g.madeProgress()}push(g,e,d){++this._runningTasks.value;return(new Promise((c,l)=>this._tasks.push(new m(c,l,g,e,d)))).finally(()=>--this._runningTasks.value)}unshift(g,e,d){++this._runningTasks.value;return(new Promise((c,l)=>this._tasks.unshift(new m(c,l,g,e,d)))).finally(()=>--this._runningTasks.value)}_process(g){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const d=b.isAborted(e.signal);if(d&&!e.abortCallback)e.reject(b.createAbortError());
else{const c=d?e.abortCallback?.(b.createAbortError()):e.callback(g);b.isPromiseLike(c)?c.then(e.resolve,e.reject):e.resolve(c)}}catch(d){e.reject(d)}return!0}cancelAll(){const g=b.createAbortError();for(const e of this._tasks)if(e.abortCallback){const d=e.abortCallback(g);e.resolve(d)}else e.reject(g);this._tasks.length=0}}class m{constructor(g,e,d,c,l){this.resolve=g;this.reject=e;this.callback=d;this.signal=c;this.abortCallback=l}}a.PromiseQueue=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/support/Yield":function(){define(["exports"],function(a){const b=Symbol("Yield");a.Yield=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g){b=class extends b{constructor(){super(...arguments);this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=
this.SCHEDULER_LOG_SLOW_TASKS=!1}};a.__decorate([n.property()],b.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0);a.__decorate([n.property()],b.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);b=a.__decorate([g.subclass("esri.views.support.DebugFlags")],b);return new b})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/Fog.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){a.Fog=class extends n{constructor(G){super(G);this._passParameters=new x.FogPassParameters;this._vao=q.createQuadVAO(G.context.renderContext.rctx,t.Pos2Tex);this._technique=new w.FogTechnique(G);G=f.getReferenceEllipsoid(G.view.spatialReference);this._planetRadius=G.radius;this._atmosphereRadius=G.radius+r.atmosphereHeight}destroy(){this._technique.release();this._vao.dispose()}set strength(G){this._passParameters.fogStrength=G}get strength(){return this._passParameters.fogStrength}render(G,
A){this._update(G,A);if(!(0>=this._passParameters.fogAmount)){var C=this._technique;if(C.compiled){var E=G.offscreenRenderingHelper;E.renderDepthDetached(()=>{this._passParameters.depthTexture=E.depthTexture;const I=G.rctx.bindTechnique(C,G.bindParameters,this._passParameters);this._renderFog(I,G)})}else this.context.requestRender()}}_renderFog(G,A){A=A.rctx;A.bindVAO(this._vao);G.assertCompatibleVertexAttributeLocations(this._vao);A.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4)}_update(G,A){var C=
G.bindParameters.camera;c.normalize(y,C.eye);G=Math.max(0,c.dot(y,G.bindParameters.lighting.mainLight.direction));const E=A.color;c.scale(D,E,.1);c.lerp(this._passParameters.fogColor,D,E,G);C=c.length(C.eye);this._passParameters.atmosphereC=C*C-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-h.smoothstep(.95*p.weatherHeightLimit,1*p.weatherHeightLimit,Math.abs(C-this._planetRadius)))*A.amount;this._passParameters.fogStrength=A.strength}static isSupported(G){return G.capabilities.depthTexture}};
b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"rctx",void 0);b.__decorate([k.property({constructOnly:!0})],a.Fog.prototype,"viewingMode",void 0);a.Fog=b.__decorate([d.subclass("esri.views.3d.environment.Fog")],a.Fog);class v{constructor(){this.color=l.create();this.amount=this.strength=0}}const y=l.create(),D=l.create();a.FogParameters=
v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Fog.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(){const u=new r.ShaderBuilder;u.attributes.add(w.VertexAttribute.POSITION,"vec2");u.include(k.TextureCoordinateAttribute,{textureCoordinateType:k.TextureCoordinateAttributeType.Default});u.varyings.add("worldRay","vec3");u.varyings.add("eyeDir","vec3");const {vertex:v,fragment:y}=u;v.uniforms.add(new f.Matrix4PassUniform("inverseProjectionMatrix",(D,G)=>G.camera.inverseProjectionMatrix),new f.Matrix4PassUniform("inverseViewMatrix",(D,G)=>b.invertOrIdentity(q,
G.camera.viewMatrix)));v.code.add(l.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);y.uniforms.add(new c.FloatPassUniform("atmosphereC",D=>D.atmosphereC),new d.Float3PassUniform("cameraPosition",(D,G)=>G.camera.eye),new e.Float2PassUniform("nearFar",(D,G)=>G.camera.nearFar),new x.Texture2DPassUniform("depthTexture",D=>D.depthTexture),new c.FloatPassUniform("fogStrength",D=>D.fogStrength),new c.FloatPassUniform("fogAmount",D=>D.fogAmount),new d.Float3PassUniform("fogColor",D=>D.fogColor));u.include(g.Gamma);y.include(m.ReadLinearDepth);y.code.add(l.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);y.code.add(l.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);y.code.add(l.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`);return u}class t extends l.NoParameters{constructor(){super(...arguments);this.fogColor=h.create();this.fogStrength=4E-6;this.atmosphereC=1;this.fogAmount=0}}const q=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:t,build:p},Symbol.toStringTag,{value:"Module"}));a.Fog=n;a.FogPassParameters=t;a.build=p})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends k.ShaderTechnique{constructor(f){super(f,new m.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(f){return new e.Program(f.rctx,l.shader.get().build(),g.Default3D)}initializePipeline(){return c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE),colorWrite:c.defaultColorWriteParams})}}l.shader=new h.ReloadableShaderModule(n.Fog,()=>new Promise((f,
r)=>a(["./Fog.glsl"],f,r)));b.FogTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/LocalAtmosphere":function(){define("exports ../../../core/maybe ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){class y{constructor(A,C){this.type=k.AtmosphereType.Local;this._configuration=new e.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new m.SimpleAtmospherePassParameters;this._configuration.geometry=e.SimpleAtmosphereGeometry.Cylinder;this._technique=C.techniqueRepository.acquire(g.SimpleAtmosphereTechnique,this._configuration);A=C.renderContext.rctx;this._vao=this._createVertexArrayObject(A);this._vaoCount=v.vertexCount(this._vao,"geometry");
C=new u.TextureDescriptor;C.wrapMode=t.TextureWrapMode.CLAMP_TO_EDGE;C.flipped=!0;C.width=1;C.height=512;this._passParameters.texture=new q.Texture(A,C,d.earthAtmosphereTextureSimple)}destroy(){this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()}render(A){const C=A.rctx,E=C.bindTechnique(this._technique,A.bindParameters,this._passParameters);var I=D;n.copy(I,A.bindParameters.camera.viewMatrix);I[12]=0;I[13]=0;I[14]=0;I[15]=1;E.setUniformMatrix4fv("view",
D);C.bindVAO(this._vao);E.assertCompatibleVertexAttributeLocations(this._vao);C.drawArrays(t.PrimitiveType.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(A){var C=r.createPolySphereData(1,2,!1);const {data:E,indices:I}=C[0][1];C=G.createBuffer(I.length);const H=C.position;for(let J=0;J<I.length;++J){const B=3*I[0===J%3?J+2:2===J%3?J-2:J];H.set(J,0,E[B]);H.set(J,1,E[B+1]);H.set(J,2,E[B+2])}return new x.VertexArrayObject(A,f.Default3D,{geometry:c.glLayout(G)},{geometry:p.BufferObject.createVertex(A,
t.Usage.STATIC_DRAW,C.buffer)})}}const D=h.create(),G=l.newLayout().vec3f(w.VertexAttribute.POSITION);a.LocalAtmosphere=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(u){const v=new f.ShaderBuilder,{vertex:y,fragment:D}=v;m.addMainLightDirection(y);u.geometry===h.SimpleAtmosphereGeometry.Underground?(v.attributes.add(x.VertexAttribute.POSITION,"vec2"),v.varyings.add("color","vec4"),y.uniforms.add(new e.Float3PassUniform("cameraPosition",(G,A)=>A.camera.eye),new d.FloatPassUniform("undergroundFadeAlpha",G=>G.undergroundFadeAlpha)),y.code.add(c.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),D.code.add(c.glsl`void main() {
fragColor = color;
}`)):(v.include(k.Transform,u),v.attributes.add(x.VertexAttribute.POSITION,"vec3"),v.varyings.add("vtc","vec2"),v.varyings.add("falloff","float"),u=u.geometry===h.SimpleAtmosphereGeometry.Cylinder,y.uniforms.add(new l.Matrix4PassUniform("proj",(G,A)=>A.camera.projectionMatrix),new l.Matrix4PassUniform("view",(G,A)=>A.camera.viewMatrix)),u||(v.varyings.add("innerFactor","float"),y.uniforms.add(new e.Float3PassUniform("silCircleCenter",G=>G.silhouette.center)),y.uniforms.add(new e.Float3PassUniform("silCircleV1",
G=>G.silhouette.v1)),y.uniforms.add(new e.Float3PassUniform("silCircleV2",G=>G.silhouette.v2)),y.uniforms.add(new g.Float2PassUniform("texV",G=>G.texV)),y.uniforms.add(new d.FloatPassUniform("innerScale",G=>G.innerScale))),y.code.add(c.glsl`
		void main(void) {
      ${u?c.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:c.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${c.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${c.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),D.uniforms.add(new r.Texture2DPassUniform("tex",G=>G.texture)),u||D.uniforms.add(new d.FloatPassUniform("altitudeFade",G=>G.altitudeFade)),D.code.add(c.glsl`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${u?c.glsl`fragColor = atmosphereColor;`:c.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return v}class p extends c.NoParameters{constructor(){super(...arguments);this.texV=b.create();this.undergroundFadeAlpha=this.innerScale=this.altitudeFade=0;this.silhouette=new t}}class t{constructor(){this.center=n.create();this.v1=n.create();this.v2=n.create()}}const q=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:t,SimpleAtmospherePassParameters:p,build:w},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=t;a.SimpleAtmosphere=q;a.SimpleAtmospherePassParameters=
p;a.build=w})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,b,n,h){a.SimpleAtmosphereGeometry=void 0;(function(m){m[m.Cone=0]="Cone";m[m.Cylinder=1]="Cylinder";m[m.Underground=2]="Underground";m[m.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));class k extends h.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.geometry=a.SimpleAtmosphereGeometry.Cone}}b.__decorate([n.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],k.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n,h,k){class m extends n.InstancedDoubleConfiguration{}b.__decorate([k.parameter({constValue:!0})],m.prototype,"hasSliceHighlight",void 0);b.__decorate([k.parameter({constValue:!1})],m.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([k.parameter({constValue:h.BindType.Pass})],m.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){class q extends w.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasModelTransformation=this.instancedDoublePrecision=!1}}b.__decorate([w.parameter()],q.prototype,"instancedDoublePrecision",void 0);b.__decorate([w.parameter()],q.prototype,"hasModelTransformation",void 0);class u extends f.NoParameters{constructor(){super(...arguments);this.modelTransformation=null}}const v=h.create(),y=g.create();a.InstancedDoubleConfiguration=q;a.InstancedDoublePassParameters=
u;a.InstancedDoublePrecision=function(D,G){const A=G.hasModelTransformation,C=G.instancedDoublePrecision;A&&(D.vertex.uniforms.add(new x.Matrix4PassUniform("model",E=>E.modelTransformation??k.IDENTITY)),D.vertex.uniforms.add(new r.Matrix3PassUniform("normalLocalOriginFromModel",E=>{n.normalFromMat4(v,E.modelTransformation??k.IDENTITY);return v})));G.instanced&&C&&(D.attributes.add(p.VertexAttribute.INSTANCEMODELORIGINHI,"vec3"),D.attributes.add(p.VertexAttribute.INSTANCEMODELORIGINLO,"vec3"),D.attributes.add(p.VertexAttribute.INSTANCEMODEL,
"mat3"),D.attributes.add(p.VertexAttribute.INSTANCEMODELNORMAL,"mat3"));D=D.vertex;C&&(D.include(d.DoublePrecision,G),D.uniforms.add(new l.Float3DrawUniform("viewOriginHi",(E,I)=>t.encodeDoubleHi(m.set(y,I.camera.viewInverseTransposeMatrix[3],I.camera.viewInverseTransposeMatrix[7],I.camera.viewInverseTransposeMatrix[11]),y)),new l.Float3DrawUniform("viewOriginLo",(E,I)=>t.encodeDoubleLo(m.set(y,I.camera.viewInverseTransposeMatrix[3],I.camera.viewInverseTransposeMatrix[7],I.camera.viewInverseTransposeMatrix[11]),
y))));D.code.add(f.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${A?C?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":C?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${C?f.glsl`
          // Negated inputs are intentionally the first two arguments. The other way around the obfuscation in dpAdd() stopped
          // working for macOS 14+ and iOS 17+.
          // Issue: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(-instanceModelOriginHi, -instanceModelOriginLo, viewOriginHi, viewOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);D.code.add(f.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${A?C?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":C?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `);G.output===e.ShaderOutput.Normal&&(c.addViewNormal(D),D.code.add(f.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${A?C?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":C?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `));G.hasVertexTangents&&D.code.add(f.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${A?C?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":C?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){function b(e){return e===a.ShaderOutput.Shadow||e===a.ShaderOutput.ShadowHighlight||e===a.ShaderOutput.ShadowExcludeHighlight}function n(e){return e===a.ShaderOutput.Highlight||e===a.ShaderOutput.ObjectAndLayerIdColor}function h(e){return e===a.ShaderOutput.Color||e===a.ShaderOutput.Alpha}function k(e){return h(e)||e===a.ShaderOutput.Highlight}
function m(e){return h(e)||n(e)}function g(e){return m(e)||e===a.ShaderOutput.LinearDepth}a.ShaderOutput=void 0;(function(e){e[e.Color=0]="Color";e[e.LinearDepth=1]="LinearDepth";e[e.Depth=2]="Depth";e[e.Normal=3]="Normal";e[e.Shadow=4]="Shadow";e[e.ShadowHighlight=5]="ShadowHighlight";e[e.ShadowExcludeHighlight=6]="ShadowExcludeHighlight";e[e.Highlight=7]="Highlight";e[e.Alpha=8]="Alpha";e[e.ObjectAndLayerIdColor=9]="ObjectAndLayerIdColor";e[e.CompositeColor=10]="CompositeColor";e[e.COUNT=11]="COUNT"})(a.ShaderOutput||
(a.ShaderOutput={}));a.is2DGeometryOutput=function(e){return e===a.ShaderOutput.Color||n(e)};a.is3DGeometryOutput=function(e){return g(e)||e===a.ShaderOutput.Normal};a.isColorAlphaHighlightOIDOrDepth=g;a.isColorAlphaHighlightOrDepth=function(e){return k(e)||e===a.ShaderOutput.LinearDepth};a.isColorAlphaHighlightOrOID=m;a.isColorAlphaOrHighlight=k;a.isColorAlphaOrOID=function(e){return h(e)||e===a.ShaderOutput.ObjectAndLayerIdColor};a.isColorOrAlpha=h;a.isDepthLikeOutput=function(e){return b(e)||e===
a.ShaderOutput.Depth||e===a.ShaderOutput.LinearDepth||e===a.ShaderOutput.Normal||e===a.ShaderOutput.ObjectAndLayerIdColor};a.isOIDorHighlight=n;a.isShadowRelatedOutput=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DoublePrecision=function({code:n},h){h.doublePrecisionRequiresObfuscation?n.add(b.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):n.add(b.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c){const l=n.create(),f=k.create();a.addCameraPosition=function(r,x){x.instancedDoublePrecision?r.constants.add("cameraPosition","vec3",k.ZEROS):r.uniforms.add(new m.Float3DrawUniform("cameraPosition",(w,p)=>h.set(f,p.camera.viewInverseTransposeMatrix[3]-w.origin[0],p.camera.viewInverseTransposeMatrix[7]-w.origin[1],p.camera.viewInverseTransposeMatrix[11]-w.origin[2])))};a.addPixelRatio=function(r){r.uniforms.add(new e.FloatPassUniform("pixelRatio",(x,w)=>w.camera.pixelRatio/
w.overlayStretch))};a.addProjViewLocalOrigin=function(r,x){x.instancedDoublePrecision?r.uniforms.add(new c.Matrix4PassUniform("proj",(w,p)=>p.camera.projectionMatrix),new c.Matrix4PassUniform("view",(w,p)=>b.translate(l,p.camera.viewMatrix,h.set(f,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))),new g.Float3PassUniform("localOrigin",(w,p)=>h.set(f,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]))):
r.uniforms.add(new c.Matrix4PassUniform("proj",(w,p)=>p.camera.projectionMatrix),new d.Matrix4DrawUniform("view",(w,p)=>b.translate(l,p.camera.viewMatrix,w.origin)),new m.Float3DrawUniform("localOrigin",w=>w.origin))};a.addViewNormal=function(r){r.uniforms.add(new c.Matrix4PassUniform("viewNormal",(x,w)=>w.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"mat4",n.BindType.Draw,(g,e,d)=>g.setUniformMatrix4fv(k,m(e,d)))}}a.Matrix4DrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(n,h,k){for(let m=0;m<k;++m)h[m]=n[2*m]+n[2*m+1]};a.encodeDoubleArray=function(n,h,k){for(let m=0;m<
k;++m)h[2*m]=n[m],h[2*m+1]=n[m]-h[2*m]};a.encodeDoubleHi=function(n,h){const k=n.length;for(let m=0;m<k;++m)b[0]=n[m],h[m]=b[0];return h};a.encodeDoubleLo=function(n,h){const k=n.length;for(let m=0;m<k;++m)b[0]=n[m],b[1]=n[m]-b[0],h[m]=b[1];return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,b,n){a.Transform=function(h){b.addCalculateLinearDepth(h);
h.vertex.code.add(n.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`);h.vertex.code.add(n.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,n,h,k){function m(d){d.varyings.add("linearDepth","float")}function g(d){d.vertex.uniforms.add(new h.Float2PassUniform("nearFar",(c,l)=>l.camera.nearFar))}function e(d){d.vertex.code.add(k.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(d,c){const {vertex:l}=d;switch(c.output){case b.ShaderOutput.Color:if(c.receiveShadows){m(d);l.code.add(k.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case b.ShaderOutput.LinearDepth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:d.include(n.VertexPosition,c);m(d);g(d);e(d);l.code.add(k.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}l.code.add(k.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=e;a.addLinearDepth=m;a.addNearFar=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r extends d.NoParameters{constructor(){super(...arguments);this.transformWorldFromViewTH=h.create();this.transformWorldFromViewTL=h.create();this.transformViewFromCameraRelativeRS=b.create();this.transformProjFromView=n.create()}}class x extends d.NoParameters{constructor(){super(...arguments);this.transformWorldFromModelRS=b.create();this.transformWorldFromModelTH=h.create();this.transformWorldFromModelTL=h.create()}}a.VertexPosition=function(w,p){w.include(k.PositionAttribute);
const t=w.vertex;t.include(m.DoublePrecision,p);w.varyings.add("vPositionWorldCameraRelative","vec3");w.varyings.add("vPosition_view","vec3");t.uniforms.add(new e.Float3PassUniform("transformWorldFromViewTH",q=>q.transformWorldFromViewTH),new e.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL),new l.Matrix3PassUniform("transformViewFromCameraRelativeRS",q=>q.transformViewFromCameraRelativeRS),new f.Matrix4PassUniform("transformProjFromView",q=>q.transformProjFromView),new c.Matrix3DrawUniform("transformWorldFromModelRS",
q=>q.transformWorldFromModelRS),new g.Float3DrawUniform("transformWorldFromModelTH",q=>q.transformWorldFromModelTH),new g.Float3DrawUniform("transformWorldFromModelTL",q=>q.transformWorldFromModelTL));t.code.add(d.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);t.code.add(d.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${p.spherical?d.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:d.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);w.fragment.uniforms.add(new e.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL));t.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);w.fragment.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=x;a.VertexPositionPassParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n){a.PositionAttribute=function(h){h.attributes.add(n.VertexAttribute.POSITION,"vec3");h.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"mat3",n.BindType.Draw,(g,e,d)=>g.setUniformMatrix3fv(k,m(e,d)))}}a.Matrix3DrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends m.ShaderTechnique{initializeProgram(f){return new e.Program(f.rctx,l.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){return this.configuration.geometry===h.SimpleAtmosphereGeometry.Cylinder?c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:c.backFaceCullingParams,depthTest:{func:d.CompareFunction.LEQUAL},
colorWrite:c.defaultColorWriteParams}):c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:c.defaultColorWriteParams})}}l.shader=new k.ReloadableShaderModule(n.SimpleAtmosphere,()=>new Promise((f,r)=>a(["./SimpleAtmosphere.glsl"],f,r)));b.SimpleAtmosphereTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,
11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,
11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,
0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,
56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,
14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,
43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,
54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,
95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,
120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,
151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,
255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,
242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,n){const h={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,
f32:b.DataType.FLOAT};a.glLayout=function(k,m=0){const g=k.stride;return Array.from(k.fields.keys()).map(e=>{const d=k.fields.get(e),c=d.constructor.ElementCount;var l=h[d.constructor.ElementType];if(!l)throw Error("BufferType not supported in WebGL");return new n.VertexElementDescriptor(e,c,l,d.offset,g,!(!d.optional||!d.optional.glNormalized),m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/buffer/BufferView",
"../../../../geometry/support/buffer/types","../../webgl-engine/lib/Util"],function(a,b,n,h){class k{constructor(c,l){this.layout=c;this.buffer="number"===typeof l?new ArrayBuffer(l*c.stride):l;for(const f of c.fields.keys())l=c.fields.get(f),this[f]=new l.constructor(this.buffer,l.offset,this.stride)}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(c,l){return(c=this[c])&&c.elementCount===l.ElementCount&&
c.elementType===l.ElementType?c:null}slice(c,l){return new k(this.layout,this.buffer.slice(c*this.stride,l*this.stride))}copyFrom(c,l=0,f=0,r=c.count){const x=this.stride;0===x%4?(c=new Uint32Array(c.buffer,l*x,r*x/4),(new Uint32Array(this.buffer,f*x,r*x/4)).set(c)):(c=new Uint8Array(c.buffer,l*x,r*x),(new Uint8Array(this.buffer,f*x,r*x)).set(c));return this}get usedMemory(){return this.byteLength}dispose(){}}class m{constructor(c=null){this._lastAligned=this._stride=0;this._fields=new Map;c&&(this._stride=
c.stride,c.fields.forEach(l=>this._fields.set(l[0],{...l[1],constructor:d.get(l[1].constructor)})))}vec2f(c,l){this._appendField(c,b.BufferViewVec2f,l);return this}vec2f64(c,l){this._appendField(c,b.BufferViewVec2f64,l);return this}vec3f(c,l){this._appendField(c,b.BufferViewVec3f,l);return this}vec3f64(c,l){this._appendField(c,b.BufferViewVec3f64,l);return this}vec4f(c,l){this._appendField(c,b.BufferViewVec4f,l);return this}vec4f64(c,l){this._appendField(c,b.BufferViewVec4f64,l);return this}mat3f(c,
l){this._appendField(c,b.BufferViewMat3f,l);return this}mat3f64(c,l){this._appendField(c,b.BufferViewMat3f64,l);return this}mat4f(c,l){this._appendField(c,b.BufferViewMat4f,l);return this}mat4f64(c,l){this._appendField(c,b.BufferViewMat4f64,l);return this}vec4u8(c,l){this._appendField(c,b.BufferViewVec4u8,l);return this}f32(c,l){this._appendField(c,b.BufferViewFloat,l);return this}f64(c,l){this._appendField(c,b.BufferViewFloat64,l);return this}u8(c,l){this._appendField(c,b.BufferViewUint8,l);return this}u16(c,
l){this._appendField(c,b.BufferViewUint16,l);return this}i8(c,l){this._appendField(c,b.BufferViewInt8,l);return this}vec2i8(c,l){this._appendField(c,b.BufferViewVec2i8,l);return this}vec2i16(c,l){this._appendField(c,b.BufferViewVec2i16,l);return this}vec2u8(c,l){this._appendField(c,b.BufferViewVec2u8,l);return this}vec4u16(c,l){this._appendField(c,b.BufferViewVec4u16,l);return this}u32(c,l){this._appendField(c,b.BufferViewUint32,l);return this}_appendField(c,l,f){if(this._fields.has(c))h.assert(!1,
`${c} already added to vertex buffer layout`);else{var r=l.ElementCount*n.elementTypeSize(l.ElementType),x=this._stride;this._stride+=r;this._fields.set(c,{size:r,constructor:l,offset:x,optional:f})}}createBuffer(c){return new k(this,c)}createView(c){return new k(this,c)}clone(){const c=new m;c._stride=this._stride;c._fields=new Map;this._fields.forEach((l,f)=>c._fields.set(f,l));c.BufferType=this.BufferType;return c}get stride(){if(this._lastAligned!==this._fields.size){let c=1;this._fields.forEach(l=>
c=Math.max(c,n.elementTypeSize(l.constructor.ElementType)));this._stride=Math.floor((this._stride+c-1)/c)*c;this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}}class g{constructor(c){this.fields=[];c.fields.forEach((l,f)=>{var r=l.constructor;this.fields.push([f,{...l,constructor:`${r.ElementType}_${r.ElementCount}`}])});this.stride=c.stride}}const e=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,
b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,
b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32],d=new Map;e.forEach(c=>d.set(`${c.ElementType}_${c.ElementCount}`,c));a.InterleavedBuffer=k;a.InterleavedLayout=m;a.PackedLayout=g;a.newLayout=function(){return new m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,b,n,h,k,m,g){class e extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Float32Array,U,W,ca,X);this.elementType="f32"}static fromTypedArray(U,W){return new e(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}e.ElementType="f32";class d extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Float32Array,U,W,ca,X);this.elementType="f32"}slice(U,W){return this.sliceBuffer(d,U,W)}static fromTypedArray(U,W){return new d(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}d.ElementType="f32";class c extends m.BufferViewVec3Impl{constructor(U,W=0,ca,X){super(Float32Array,
U,W,ca,X);this.elementType="f32"}slice(U,W){return this.sliceBuffer(c,U,W)}static fromTypedArray(U,W){return new c(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}c.ElementType="f32";class l extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Float32Array,U,W,ca,X);this.elementType="f32"}slice(U,W){return this.sliceBuffer(l,U,W)}static fromTypedArray(U,W){return new l(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}l.ElementType="f32";class f extends b.BufferViewMat3Impl{constructor(U,
W=0,ca,X){super(Float32Array,U,W,ca,X);this.elementType="f32"}slice(U,W){return this.sliceBuffer(f,U,W)}static fromTypedArray(U,W){return new f(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}f.ElementType="f32";class r extends b.BufferViewMat3Impl{constructor(U,W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(r,U,W)}static fromTypedArray(U,W){return new r(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}r.ElementType="f64";class x extends n.BufferViewMat4Impl{constructor(U,
W=0,ca,X){super(Float32Array,U,W,ca,X);this.elementType="f32"}slice(U,W){return this.sliceBuffer(x,U,W)}static fromTypedArray(U,W){return new x(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}x.ElementType="f32";class w extends n.BufferViewMat4Impl{constructor(U,W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(w,U,W)}static fromTypedArray(U,W){return new w(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}w.ElementType="f64";class p extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(p,U,W)}static fromTypedArray(U,W){return new p(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}p.ElementType="f64";class t extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(t,U,W)}static fromTypedArray(U,W){return new t(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}t.ElementType="f64";class q extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(q,U,W)}static fromTypedArray(U,W){return new q(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}q.ElementType="f64";class u extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Float64Array,U,W,ca,X);this.elementType="f64"}slice(U,W){return this.sliceBuffer(u,U,W)}static fromTypedArray(U,W){return new u(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}u.ElementType="f64";class v extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Uint8Array,U,W,ca,X);this.elementType="u8"}slice(U,W){return this.sliceBuffer(v,U,W)}static fromTypedArray(U,W){return new v(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}v.ElementType="u8";class y extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Uint8Array,U,W,ca,X);this.elementType="u8"}slice(U,W){return this.sliceBuffer(y,U,W)}static fromTypedArray(U,W){return new y(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}y.ElementType="u8";class D extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Uint8Array,U,W,ca,X);this.elementType="u8"}slice(U,W){return this.sliceBuffer(D,U,W)}static fromTypedArray(U,W){return new D(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}D.ElementType="u8";class G extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Uint8Array,U,W,ca,X);this.elementType="u8"}slice(U,W){return this.sliceBuffer(G,U,W)}static fromTypedArray(U,W){return new G(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}G.ElementType="u8";class A extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Uint16Array,U,W,ca,X);this.elementType="u16"}slice(U,W){return this.sliceBuffer(A,U,W)}static fromTypedArray(U,W){return new A(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}A.ElementType="u16";class C extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Uint16Array,U,W,ca,X);this.elementType="u16"}slice(U,W){return this.sliceBuffer(C,U,W)}static fromTypedArray(U,W){return new C(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}C.ElementType="u16";class E extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Uint16Array,U,W,ca,X);this.elementType="u16"}slice(U,W){return this.sliceBuffer(E,U,W)}static fromTypedArray(U,W){return new E(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}E.ElementType="u16";class I extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Uint16Array,U,W,ca,X);this.elementType="u16"}slice(U,W){return this.sliceBuffer(I,U,W)}static fromTypedArray(U,W){return new I(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}I.ElementType="u16";class H extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Uint32Array,U,W,ca,X);this.elementType="u32"}slice(U,W){return this.sliceBuffer(H,U,W)}static fromTypedArray(U,W){return new H(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}H.ElementType="u32";class J extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Uint32Array,U,W,ca,X);this.elementType="u32"}slice(U,W){return this.sliceBuffer(J,U,W)}static fromTypedArray(U,W){return new J(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}J.ElementType="u32";class B extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Uint32Array,U,W,ca,X);this.elementType="u32"}slice(U,W){return this.sliceBuffer(B,U,W)}static fromTypedArray(U,W){return new B(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}B.ElementType="u32";class z extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Uint32Array,U,W,ca,X);this.elementType="u32"}slice(U,W){return this.sliceBuffer(z,U,W)}static fromTypedArray(U,W){return new z(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}z.ElementType="u32";class K extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Int8Array,U,W,ca,X);this.elementType="i8"}slice(U,W){return this.sliceBuffer(K,U,W)}static fromTypedArray(U,W){return new K(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}K.ElementType="i8";class L extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Int8Array,U,W,ca,X);this.elementType="i8"}slice(U,W){return this.sliceBuffer(L,U,W)}static fromTypedArray(U,W){return new L(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}L.ElementType="i8";class F extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Int8Array,U,W,ca,X);this.elementType="i8"}slice(U,W){return this.sliceBuffer(F,U,W)}static fromTypedArray(U,W){return new F(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}F.ElementType="i8";class M extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Int8Array,U,W,ca,X);this.elementType="i8"}slice(U,W){return this.sliceBuffer(M,U,W)}static fromTypedArray(U,W){return new M(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}M.ElementType="i8";class S extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Int16Array,U,W,ca,X);this.elementType="i16"}slice(U,W){return this.sliceBuffer(S,U,W)}static fromTypedArray(U,W){return new S(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}S.ElementType="i16";class N extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Int16Array,U,W,ca,X);this.elementType="i16"}slice(U,W){return this.sliceBuffer(N,U,W)}static fromTypedArray(U,W){return new N(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}N.ElementType="i16";class P extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Int16Array,U,W,ca,X);this.elementType="i16"}slice(U,W){return this.sliceBuffer(P,U,W)}static fromTypedArray(U,W){return new P(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}P.ElementType="i16";class R extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Int16Array,U,W,ca,X);this.elementType="i16"}slice(U,W){return this.sliceBuffer(R,U,W)}static fromTypedArray(U,W){return new R(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}R.ElementType="i16";class O extends h.BufferViewScalarImpl{constructor(U,
W=0,ca,X){super(Int32Array,U,W,ca,X);this.elementType="i32"}slice(U,W){return this.sliceBuffer(O,U,W)}static fromTypedArray(U,W){return new O(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}O.ElementType="i32";class T extends k.BufferViewVec2Impl{constructor(U,W=0,ca,X){super(Int32Array,U,W,ca,X);this.elementType="i32"}slice(U,W){return this.sliceBuffer(T,U,W)}static fromTypedArray(U,W){return new T(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}T.ElementType="i32";class Q extends m.BufferViewVec3Impl{constructor(U,
W=0,ca,X){super(Int32Array,U,W,ca,X);this.elementType="i32"}slice(U,W){return this.sliceBuffer(Q,U,W)}static fromTypedArray(U,W){return new Q(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}Q.ElementType="i32";class V extends g.BufferViewVec4Impl{constructor(U,W=0,ca,X){super(Int32Array,U,W,ca,X);this.elementType="i32"}slice(U,W){return this.sliceBuffer(V,U,W)}static fromTypedArray(U,W){return new V(U.buffer,U.byteOffset,W,U.byteOffset+U.byteLength)}}V.ElementType="i32";a.BufferViewFloat=e;a.BufferViewFloat64=
p;a.BufferViewInt16=S;a.BufferViewInt32=O;a.BufferViewInt8=K;a.BufferViewMat3f=f;a.BufferViewMat3f64=r;a.BufferViewMat4f=x;a.BufferViewMat4f64=w;a.BufferViewUint16=A;a.BufferViewUint32=H;a.BufferViewUint8=v;a.BufferViewVec2f=d;a.BufferViewVec2f64=t;a.BufferViewVec2i16=N;a.BufferViewVec2i32=T;a.BufferViewVec2i8=L;a.BufferViewVec2u16=C;a.BufferViewVec2u32=J;a.BufferViewVec2u8=y;a.BufferViewVec3f=c;a.BufferViewVec3f64=q;a.BufferViewVec3i16=P;a.BufferViewVec3i32=Q;a.BufferViewVec3i8=F;a.BufferViewVec3u16=
E;a.BufferViewVec3u32=B;a.BufferViewVec3u8=D;a.BufferViewVec4f=l;a.BufferViewVec4f64=u;a.BufferViewVec4i16=R;a.BufferViewVec4i32=V;a.BufferViewVec4i8=M;a.BufferViewVec4u16=I;a.BufferViewVec4u32=z;a.BufferViewVec4u8=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(a){class b{constructor(n,h,k=0,m,g){this.TypedArrayConstructor=n;this.elementCount=9;n=this.TypedArrayConstructor;void 0===m&&(m=9*n.BYTES_PER_ELEMENT);
const e=0===h.byteLength?0:k;this.typedBuffer=null==g?new n(h,e):new n(h,e,(g-k)/n.BYTES_PER_ELEMENT);this.typedBufferStride=m/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(n,h,k=this.count-h){h=this.typedBuffer.byteOffset+h*this.stride;return new n(this.buffer,h,this.stride,h+k*this.stride)}getMat(n,h){n*=this.typedBufferStride;for(let k=0;9>k;k++)h[k]=this.typedBuffer[n++];
return h}setMat(n,h){n*=this.typedBufferStride;for(let k=0;9>k;k++)this.typedBuffer[n++]=h[k]}get(n,h){return this.typedBuffer[n*this.typedBufferStride+h]}set(n,h,k){this.typedBuffer[n*this.typedBufferStride+h]=k}copyFrom(n,h,k){const m=this.typedBuffer,g=h.typedBuffer;n*=this.typedBufferStride;h=k*h.typedBufferStride;for(k=0;9>k;++k)m[n++]=g[h++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],
function(a){class b{constructor(n,h,k=0,m,g){this.TypedArrayConstructor=n;this.elementCount=16;n=this.TypedArrayConstructor;void 0===m&&(m=16*n.BYTES_PER_ELEMENT);const e=0===h.byteLength?0:k;this.typedBuffer=null==g?new n(h,e):new n(h,e,(g-k)/n.BYTES_PER_ELEMENT);this.typedBufferStride=m/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(n,h,k=this.count-h){h=this.typedBuffer.byteOffset+
h*this.stride;return new n(this.buffer,h,this.stride,h+k*this.stride)}getMat(n,h){n*=this.typedBufferStride;for(let k=0;16>k;k++)h[k]=this.typedBuffer[n++];return h}setMat(n,h){n*=this.typedBufferStride;for(let k=0;16>k;k++)this.typedBuffer[n++]=h[k]}get(n,h){return this.typedBuffer[n*this.typedBufferStride+h]}set(n,h,k){this.typedBuffer[n*this.typedBufferStride+h]=k}copyFrom(n,h,k){const m=this.typedBuffer,g=h.typedBuffer;n*=this.typedBufferStride;h=k*h.typedBufferStride;for(k=0;16>k;++k)m[n++]=
g[h++]}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(a){class b{constructor(n,h,k=0,m,g){this.TypedArrayConstructor=n;this.elementCount=1;n=this.TypedArrayConstructor;void 0===m&&(m=n.BYTES_PER_ELEMENT);const e=0===h.byteLength?0:k;this.typedBuffer=null==g?new n(h,e):new n(h,e,(g-k)/n.BYTES_PER_ELEMENT);this.stride=
m;this.typedBufferStride=m/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(n,h,k=this.count-h){h=this.typedBuffer.byteOffset+h*this.stride;return new n(this.buffer,h,this.stride,h+k*this.stride)}get(n){return this.typedBuffer[n*this.typedBufferStride]}set(n,h){this.typedBuffer[n*this.typedBufferStride]=h}get buffer(){return this.typedBuffer.buffer}}b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2"],function(a,b){class n{constructor(h,k,m=0,g,e){this.TypedArrayConstructor=h;this.elementCount=2;h=this.TypedArrayConstructor;void 0===g&&(g=2*h.BYTES_PER_ELEMENT);const d=0===k.byteLength?0:m;this.typedBuffer=null==e?new h(k,d):new h(k,d,(e-m)/h.BYTES_PER_ELEMENT);this.typedBufferStride=g/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(h,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new h(this.buffer,k,this.stride,k+m*this.stride)}getVec(h,k){h*=this.typedBufferStride;return b.set(k,this.typedBuffer[h],this.typedBuffer[h+1])}setVec(h,k){h*=this.typedBufferStride;this.typedBuffer[h++]=k[0];this.typedBuffer[h]=k[1]}get(h,k){return this.typedBuffer[h*this.typedBufferStride+k]}set(h,k,m){this.typedBuffer[h*this.typedBufferStride+
k]=m}setValues(h,k,m){h*=this.typedBufferStride;this.typedBuffer[h++]=k;this.typedBuffer[h]=m}copyFrom(h,k,m){const g=this.typedBuffer,e=k.typedBuffer;h*=this.typedBufferStride;k=m*k.typedBufferStride;g[h++]=e[k++];g[h]=e[k]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=2;a.BufferViewVec2Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec32"],function(a,b){class n{constructor(h,
k,m=0,g,e){this.TypedArrayConstructor=h;this.elementCount=3;h=this.TypedArrayConstructor;void 0===g&&(g=3*h.BYTES_PER_ELEMENT);const d=0===k.byteLength?0:m;this.typedBuffer=null==e?new h(k,d):new h(k,d,(e-m)/h.BYTES_PER_ELEMENT);this.typedBufferStride=g/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(h,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new h(this.buffer,
k,this.stride,k+m*this.stride)}getVec(h,k){h*=this.typedBufferStride;return b.set(k,this.typedBuffer[h],this.typedBuffer[h+1],this.typedBuffer[h+2])}setVec(h,k){h*=this.typedBufferStride;this.typedBuffer[h++]=k[0];this.typedBuffer[h++]=k[1];this.typedBuffer[h]=k[2]}get(h,k){return this.typedBuffer[h*this.typedBufferStride+k]}set(h,k,m){this.typedBuffer[h*this.typedBufferStride+k]=m}setValues(h,k,m,g){h*=this.typedBufferStride;this.typedBuffer[h++]=k;this.typedBuffer[h++]=m;this.typedBuffer[h]=g}copyFrom(h,
k,m){const g=this.typedBuffer,e=k.typedBuffer;h*=this.typedBufferStride;k=m*k.typedBufferStride;g[h++]=e[k++];g[h++]=e[k++];g[h]=e[k]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=3;a.BufferViewVec3Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec42"],function(a,b){class n{constructor(h,k,m=0,g,e){this.TypedArrayConstructor=h;this.start=m;this.elementCount=4;h=this.TypedArrayConstructor;
void 0===g&&(g=4*h.BYTES_PER_ELEMENT);const d=0===k.byteLength?0:m;this.typedBuffer=null==e?new h(k,d):new h(k,d,(e-m)/h.BYTES_PER_ELEMENT);this.typedBufferStride=g/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(h,k,m=this.count-k){k=this.typedBuffer.byteOffset+k*this.stride;return new h(this.buffer,k,this.stride,k+m*this.stride)}getVec(h,k){h*=this.typedBufferStride;
return b.set(k,this.typedBuffer[h++],this.typedBuffer[h++],this.typedBuffer[h++],this.typedBuffer[h])}setVec(h,k){h*=this.typedBufferStride;this.typedBuffer[h++]=k[0];this.typedBuffer[h++]=k[1];this.typedBuffer[h++]=k[2];this.typedBuffer[h]=k[3]}get(h,k){return this.typedBuffer[h*this.typedBufferStride+k]}set(h,k,m){this.typedBuffer[h*this.typedBufferStride+k]=m}setValues(h,k,m,g,e){h*=this.typedBufferStride;this.typedBuffer[h++]=k;this.typedBuffer[h++]=m;this.typedBuffer[h++]=g;this.typedBuffer[h]=
e}copyFrom(h,k,m){const g=this.typedBuffer,e=k.typedBuffer;h*=this.typedBufferStride;k=m*k.typedBufferStride;g[h++]=e[k++];g[h++]=e[k++];g[h++]=e[k++];g[h]=e[k]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=4;a.BufferViewVec4Impl=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./Geometry ./Util ./VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(ca,X,ba){function ia(ea,ha){ea>ha&&([ea,ha]=[ha,ea]);const Y=ea.toString()+"."+ha.toString();if(aa[Y])return aa[Y];let Z=fa.length;fa.length+=3;y.add(fa,3*ea,fa,3*ha,fa,Z);y.scale(fa,Z,ca/y.length(fa,Z));Z/=3;return aa[Y]=Z}let fa;ba?(fa=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],ba=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(ba=ca*(1+Math.sqrt(5))/2,fa=[-ca,ba,0,ca,ba,0,-ca,-ba,0,ca,-ba,0,0,-ca,ba,0,ca,ba,0,-ca,-ba,0,ca,-ba,ba,0,-ca,ba,0,
ca,-ba,0,-ca,-ba,0,ca],ba=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var da=0;da<fa.length;da+=3)y.scale(fa,da,ca/y.length(fa,da));let aa={};for(da=0;da<X;da++){const ea=ba.length,ha=Array(4*ea);for(let Y=0;Y<ea;Y+=3){const Z=ba[Y],ja=ba[Y+1],oa=ba[Y+2],qa=ia(Z,ja),ta=ia(ja,oa),va=ia(oa,Z),Ca=4*Y;ha[Ca]=Z;ha[Ca+1]=qa;ha[Ca+2]=va;ha[Ca+3]=ja;ha[Ca+4]=ta;ha[Ca+5]=qa;ha[Ca+6]=oa;ha[Ca+7]=va;ha[Ca+8]=ta;ha[Ca+
9]=qa;ha[Ca+10]=ta;ha[Ca+11]=va}ba=ha;aa={}}X=g.floatArrayFrom(fa);for(da=0;da<X.length;da+=3)y.normalize(X,da);return[[p.VertexAttribute.POSITION,new l.Attribute(g.floatArrayFrom(fa),ba,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(X,ba,3,!0)]]}function q(ca,X,ba,ia,fa,da,aa=h.fromValues(0,0,0)){var ea=X.length;const ha=g.newFloatArray(ba.length*ea*3+(6*ia.length||0)),Y=g.newFloatArray(ba.length*ea*3+(ia?6:0)),Z=[],ja=[];let oa=0;var qa=0;const ta=k.create(),va=k.create(),Ca=k.create(),ma=k.create(),
wa=k.create(),Ba=k.create(),pa=k.create(),Aa=k.create(),ra=k.create(),ua=k.create(),Ea=k.create(),Ka=k.create(),Ma=k.create(),Ua=d.create();n.set(ra,0,1,0);n.subtract(va,ba[1],ba[0]);n.normalize(va,va);da?(n.add(Aa,ba[0],aa),n.normalize(Ca,Aa)):n.set(Ca,0,0,1);v(va,Ca,ra,ra,wa,Ca,.99619469809);n.copy(ma,Ca);n.copy(Ka,wa);for(var Ga=0;Ga<ia.length;Ga++)n.scale(Ba,wa,ia[Ga][0]),n.scale(Aa,Ca,ia[Ga][2]),n.add(Ba,Ba,Aa),n.add(Ba,Ba,ba[0]),ha[oa++]=Ba[0],ha[oa++]=Ba[1],ha[oa++]=Ba[2];Y[qa++]=-va[0];Y[qa++]=
-va[1];Y[qa++]=-va[2];for(Ga=0;Ga<fa.length;Ga++)Z.push(0<fa[Ga][0]?fa[Ga][0]:-fa[Ga][0]-1+ia.length),Z.push(0<fa[Ga][1]?fa[Ga][1]:-fa[Ga][1]-1+ia.length),Z.push(0<fa[Ga][2]?fa[Ga][2]:-fa[Ga][2]-1+ia.length),ja.push(0),ja.push(0),ja.push(0);Ga=ia.length;const Na=ia.length-1;for(let Xa=0;Xa<ba.length;Xa++){let Pa=!1;0<Xa&&(n.copy(ta,va),Xa<ba.length-1?(n.subtract(va,ba[Xa+1],ba[Xa]),n.normalize(va,va)):Pa=!0,n.add(ua,ta,va),n.normalize(ua,ua),n.add(Ea,ba[Xa-1],ma),d.fromPositionAndNormal(ba[Xa],ua,
Ua),d.intersectRay(Ua,c.wrap(Ea,ta),Aa)?(n.subtract(Aa,Aa,ba[Xa]),n.normalize(Ca,Aa),n.cross(wa,ua,Ca),n.normalize(wa,wa)):v(ua,ma,Ka,ra,wa,Ca,.99619469809),n.copy(ma,Ca),n.copy(Ka,wa));da&&(n.add(Aa,ba[Xa],aa),n.normalize(Ma,Aa));for(let bb=0;bb<ea;bb++)if(n.scale(Ba,wa,X[bb][0]),n.scale(Aa,Ca,X[bb][1]),n.add(Ba,Ba,Aa),n.normalize(pa,Ba),Y[qa++]=pa[0],Y[qa++]=pa[1],Y[qa++]=pa[2],n.add(Ba,Ba,ba[Xa]),ha[oa++]=Ba[0],ha[oa++]=Ba[1],ha[oa++]=Ba[2],!Pa){var Va=(bb+1)%ea;Z.push(Ga+bb);Z.push(Ga+ea+bb);
Z.push(Ga+Va);Z.push(Ga+Va);Z.push(Ga+ea+bb);Z.push(Ga+ea+Va);for(Va=0;6>Va;Va++)ja.push(Z[Z.length-6+Va]-Na)}Ga+=ea}X=ba[ba.length-1];for(ba=0;ba<ia.length;ba++)n.scale(Ba,wa,ia[ba][0]),n.scale(Aa,Ca,ia[ba][1]),n.add(Ba,Ba,Aa),n.add(Ba,Ba,X),ha[oa++]=Ba[0],ha[oa++]=Ba[1],ha[oa++]=Ba[2];ia=qa/3;Y[qa++]=va[0];Y[qa++]=va[1];Y[qa++]=va[2];ea=Ga-ea;for(qa=0;qa<fa.length;qa++)Z.push(0<=fa[qa][0]?Ga+fa[qa][0]:-fa[qa][0]-1+ea),Z.push(0<=fa[qa][2]?Ga+fa[qa][2]:-fa[qa][2]-1+ea),Z.push(0<=fa[qa][1]?Ga+fa[qa][1]:
-fa[qa][1]-1+ea),ja.push(ia),ja.push(ia),ja.push(ia);fa=[[p.VertexAttribute.POSITION,new l.Attribute(ha,Z,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(Y,ja,3,!0)]];return new x.Geometry(ca,fa)}function u(ca,X,ba,ia,fa){if(Math.abs(n.dot(X,ca))>fa)return!1;n.cross(ba,ca,X);n.normalize(ba,ba);n.cross(ia,ba,ca);n.normalize(ia,ia);return!0}function v(ca,X,ba,ia,fa,da,aa){return u(ca,X,fa,da,aa)||u(ca,ba,fa,da,aa)||u(ca,ia,fa,da,aa)}const y=f.Vec3Compact,D=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,
.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],G=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],A=[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],E=Array(36);for(f=0;6>f;f++)for(var I=0;6>I;I++)E[6*f+I]=f;const H=Array(36);for(f=0;6>f;f++)H[6*f]=0,H[6*f+1]=1,H[6*f+2]=2,H[6*f+3]=2,H[6*f+4]=3,H[6*f+5]=0;const J=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],B=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],z=[5,1,0,5,2,
1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],K=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];f=h.fromValues(-.5,0,-.5);I=h.fromValues(.5,0,-.5);const L=h.fromValues(0,0,.5),F=h.fromValues(0,.5,0),M=h.create(),S=h.create(),N=h.create(),P=h.create(),R=h.create();n.subtract(M,f,F);n.subtract(S,f,I);n.cross(N,M,S);n.normalize(N,N);n.subtract(M,I,F);n.subtract(S,I,L);n.cross(P,M,S);n.normalize(P,P);n.subtract(M,L,F);n.subtract(S,L,f);n.cross(R,M,S);n.normalize(R,R);const O=[f,I,L,F],T=[0,-1,0,N[0],N[1],
N[2],P[0],P[1],P[2],R[0],R[1],R[2]],Q=[0,1,2,3,1,0,3,2,1,3,0,2],V=[0,0,0,1,1,1,2,2,2,3,3,3],U=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],W=k.create();a.cgToGIS=function(ca,X=ca){var ba=ca.attributes;ca=ba.get(p.VertexAttribute.POSITION).data;if(ba=ba.get(p.VertexAttribute.NORMAL).data){var ia=X.getMutableAttribute(p.VertexAttribute.NORMAL).data;for(let fa=0;fa<ba.length;fa+=3){const da=ba[fa+1];ia[fa+1]=-ba[fa+2];ia[fa+2]=da}}if(ca)for(X=X.getMutableAttribute(p.VertexAttribute.POSITION).data,ba=0;ba<ca.length;ba+=
3)ia=ca[ba+1],X[ba+1]=-ca[ba+2],X[ba+2]=ia};a.createBoxGeometry=function(ca,X){Array.isArray(X)||(X=[X,X,X]);const ba=Array(24);for(let ia=0;8>ia;ia++)ba[3*ia]=D[ia][0]*X[0],ba[3*ia+1]=D[ia][1]*X[1],ba[3*ia+2]=D[ia][2]*X[2];return new x.Geometry(ca,[[p.VertexAttribute.POSITION,new l.Attribute(ba,C,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(G,E,3)],[p.VertexAttribute.UV0,new l.Attribute(A,H,2)]])};a.createConeGeometry=function(ca,X,ba,ia,fa,da=!0,aa=!0){let ea=0;var ha=h.fromValues(0,ea,0),Y=
h.fromValues(0,ea+X,0),Z=h.fromValues(0,-1,0),ja=h.fromValues(0,1,0);fa&&(ea=X,Y=h.fromValues(0,0,0),ha=h.fromValues(0,ea,0),Z=h.fromValues(0,1,0),ja=h.fromValues(0,-1,0));ha=[Y,ha];Z=[Z,ja];ja=ia+2;Y=Math.sqrt(X*X+ba*ba);if(fa)for(fa=ia-1;0<=fa;fa--){var oa=2*Math.PI/ia*fa,qa=h.fromValues(Math.cos(oa)*ba,ea,Math.sin(oa)*ba);ha.push(qa);oa=h.fromValues(X*Math.cos(oa)/Y,-ba/Y,X*Math.sin(oa)/Y);Z.push(oa)}else for(fa=0;fa<ia;fa++)oa=2*Math.PI/ia*fa,qa=h.fromValues(Math.cos(oa)*ba,ea,Math.sin(oa)*ba),
ha.push(qa),oa=h.fromValues(X*Math.cos(oa)/Y,ba/Y,X*Math.sin(oa)/Y),Z.push(oa);X=[];ba=[];if(da){for(da=3;da<ha.length;da++)X.push(1),X.push(da-1),X.push(da),ba.push(0),ba.push(0),ba.push(0);X.push(ha.length-1);X.push(2);X.push(1);ba.push(0);ba.push(0);ba.push(0)}if(aa){for(aa=3;aa<ha.length;aa++)X.push(aa),X.push(aa-1),X.push(0),ba.push(aa),ba.push(aa-1),ba.push(1);X.push(0);X.push(2);X.push(ha.length-1);ba.push(1);ba.push(2);ba.push(Z.length-1)}aa=g.newFloatArray(3*ja);for(da=0;da<ja;da++)aa[3*
da]=ha[da][0],aa[3*da+1]=ha[da][1],aa[3*da+2]=ha[da][2];ha=g.newFloatArray(3*ja);for(da=0;da<ja;da++)ha[3*da]=Z[da][0],ha[3*da+1]=Z[da][1],ha[3*da+2]=Z[da][2];ha=[[p.VertexAttribute.POSITION,new l.Attribute(aa,X,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(ha,ba,3,!0)]];return new x.Geometry(ca,ha)};a.createCylinderGeometry=function(ca,X,ba,ia,fa,da,aa){fa=fa?h.clone(fa):h.fromValues(1,0,0);da=da?h.clone(da):h.fromValues(0,0,0);aa??=!0;var ea=h.create();n.normalize(ea,fa);var ha=h.create();n.scale(ha,
ea,Math.abs(X));var Y=h.create();n.scale(Y,ha,-.5);n.add(Y,Y,da);const Z=h.fromValues(0,1,0);.2>Math.abs(1-n.dot(ea,Z))&&n.set(Z,0,0,1);const ja=h.create();n.cross(ja,ea,Z);n.normalize(ja,ja);n.cross(Z,ja,ea);X=2*ia+(aa?2:0);da=ia+(aa?2:0);fa=g.newFloatArray(3*X);const oa=g.newFloatArray(3*da),qa=g.newFloatArray(2*X),ta=Array(3*ia*(aa?4:2)),va=Array(3*ia*(aa?4:2));aa&&(fa[3*(X-2)]=Y[0],fa[3*(X-2)+1]=Y[1],fa[3*(X-2)+2]=Y[2],qa[2*(X-2)]=0,qa[2*(X-2)+1]=0,fa[3*(X-1)]=fa[3*(X-2)]+ha[0],fa[3*(X-1)+1]=
fa[3*(X-2)+1]+ha[1],fa[3*(X-1)+2]=fa[3*(X-2)+2]+ha[2],qa[2*(X-1)]=1,qa[2*(X-1)+1]=1,oa[3*(da-2)]=-ea[0],oa[3*(da-2)+1]=-ea[1],oa[3*(da-2)+2]=-ea[2],oa[3*(da-1)]=ea[0],oa[3*(da-1)+1]=ea[1],oa[3*(da-1)+2]=ea[2]);ea=0;const Ca=h.create(),ma=h.create();for(let Aa=0;Aa<ia;Aa++){var wa=2*Math.PI/ia*Aa;n.scale(Ca,Z,Math.sin(wa));n.scale(ma,ja,Math.cos(wa));n.add(Ca,Ca,ma);oa[3*Aa]=Ca[0];oa[3*Aa+1]=Ca[1];oa[3*Aa+2]=Ca[2];n.scale(Ca,Ca,ba);n.add(Ca,Ca,Y);fa[3*Aa]=Ca[0];fa[3*Aa+1]=Ca[1];fa[3*Aa+2]=Ca[2];qa[2*
Aa]=Aa/ia;qa[2*Aa+1]=0;fa[3*(Aa+ia)]=fa[3*Aa]+ha[0];fa[3*(Aa+ia)+1]=fa[3*Aa+1]+ha[1];fa[3*(Aa+ia)+2]=fa[3*Aa+2]+ha[2];qa[2*(Aa+ia)]=Aa/ia;qa[2*Aa+1]=1;wa=(Aa+1)%ia;var Ba=ea++,pa=Aa;ta[Ba]=Aa;va[Ba]=pa;Ba=ea++;pa=Aa;ta[Ba]=Aa+ia;va[Ba]=pa;Ba=ea++;pa=wa;ta[Ba]=wa;va[Ba]=pa;Ba=ea++;pa=wa;ta[Ba]=wa;va[Ba]=pa;Ba=ea++;pa=Aa;ta[Ba]=Aa+ia;va[Ba]=pa;Ba=ea++;pa=wa;ta[Ba]=wa+ia;va[Ba]=pa}if(aa){for(ba=0;ba<ia;ba++)aa=(ba+1)%ia,ha=ea++,Y=da-2,ta[ha]=X-2,va[ha]=Y,ha=ea++,Y=da-2,ta[ha]=ba,va[ha]=Y,ha=ea++,Y=da-
2,ta[ha]=aa,va[ha]=Y;for(ba=0;ba<ia;ba++)aa=(ba+1)%ia,ha=ea++,Y=da-1,ta[ha]=ba+ia,va[ha]=Y,ha=ea++,Y=da-1,ta[ha]=X-1,va[ha]=Y,ha=ea++,Y=da-1,ta[ha]=aa+ia,va[ha]=Y}ia=[[p.VertexAttribute.POSITION,new l.Attribute(fa,ta,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(oa,va,3,!0)],[p.VertexAttribute.UV0,new l.Attribute(qa,ta,2,!0)]];return new x.Geometry(ca,ia)};a.createDiamondGeometry=function(ca,X){Array.isArray(X)||(X=[X,X,X]);const ba=Array(18);for(let ia=0;6>ia;ia++)ba[3*ia]=J[ia][0]*X[0],ba[3*
ia+1]=J[ia][1]*X[1],ba[3*ia+2]=J[ia][2]*X[2];return new x.Geometry(ca,[[p.VertexAttribute.POSITION,new l.Attribute(ba,z,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(B,K,3)]])};a.createExtrudedTriangle=function(ca,X,ba,ia,fa,da=0){const aa=Array(18);X=[[-ba,da,fa/2],[ia,da,fa/2],[0,X+da,fa/2],[-ba,da,-fa/2],[ia,da,-fa/2],[0,X+da,-fa/2]];for(ba=0;6>ba;ba++)aa[3*ba]=X[ba][0],aa[3*ba+1]=X[ba][1],aa[3*ba+2]=X[ba][2];return new x.Geometry(ca,[[p.VertexAttribute.POSITION,new l.Attribute(aa,[0,1,2,3,
0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])};a.createPathExtrusionGeometry=q;a.createPointGeometry=function(ca,X,ba,ia,fa,da,aa,ea,ha=null){ba=ba?k.clone(ba):k.create();X=X?k.clone(X):k.fromValues(0,0,1);aa??=b.create();ia=ia?[255*ia[0],255*ia[1],255*ia[2],3<ia.length?255*ia[3]:255]:[255,255,255,255];const Y=null!=fa&&2===fa.length?fa:[1,1];fa=e.getZeroIndexArray(1);aa=[[p.VertexAttribute.POSITION,new l.Attribute(ba,fa,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(X,fa,3,!0)],[p.VertexAttribute.UV0,
new l.Attribute(aa,fa,aa.length)],[p.VertexAttribute.COLOR,new l.Attribute(ia,fa,4,!0)],[p.VertexAttribute.SIZE,new l.Attribute(Y,fa,2)]];null!=da&&(da=[da[0],da[1],da[2],da[3]],aa.push([p.VertexAttribute.CENTEROFFSETANDDISTANCE,new l.Attribute(da,fa,4)]));ea&&aa.push([p.VertexAttribute.FEATUREATTRIBUTE,new l.Attribute([ea[0],ea[1],ea[2],ea[3]],fa,4)]);return new x.Geometry(ca,aa,null,r.ContentObjectType.Point,ha)};a.createPolySphereData=t;a.createPolySphereGeometry=function(ca,X,ba,ia){X=t(X,ba,
ia);return new x.Geometry(ca,X)};a.createPolylineGeometry=function(ca,X,ba,ia){w.assert(1<X.length,"createPolylineGeometry(): polyline needs at least 2 points");w.assert(3===X[0].length,"createPolylineGeometry(): malformed vertex");w.assert(null==ba||ba.length===X.length,"createPolylineGeometry: need same number of points and normals");w.assert(null==ba||3===ba[0].length,"createPolylineGeometry(): malformed normal");var fa=m.newDoubleArray(3*X.length);const da=Array(2*(X.length-1));var aa=0,ea=0;
for(var ha=0;ha<X.length;ha++){for(var Y=0;3>Y;Y++)fa[aa++]=X[ha][Y];0<ha&&(da[ea++]=ha-1,da[ea++]=ha)}fa=[[p.VertexAttribute.POSITION,new l.Attribute(fa,da,3,!0)]];if(ba){aa=g.newFloatArray(3*ba.length);ea=0;for(ha=0;ha<X.length;ha++)for(Y=0;3>Y;Y++)aa[ea++]=ba[ha][Y];fa.push([p.VertexAttribute.NORMAL,new l.Attribute(aa,da,3,!0)])}ia&&fa.push([p.VertexAttribute.COLOR,new l.Attribute(ia,e.getContinuousIndexArray(ia.length/4),4)]);return new x.Geometry(ca,fa,null,r.ContentObjectType.Line)};a.createSphereGeometry=
function(ca,X,ba,ia,fa={uv:!0}){var da=-Math.PI,aa=2*Math.PI,ea=-Math.PI/2,ha=Math.PI;ba=Math.max(3,Math.floor(ba));ia=Math.max(2,Math.floor(ia));var Y=(ba+1)*(ia+1);const Z=g.newFloatArray(3*Y),ja=g.newFloatArray(3*Y);Y=g.newFloatArray(2*Y);const oa=[];var qa=0;for(var ta=0;ta<=ia;ta++){const Ca=[],ma=ta/ia,wa=ea+ma*ha,Ba=Math.cos(wa);for(let pa=0;pa<=ba;pa++){const Aa=pa/ba;var va=da+Aa*aa;const ra=Math.cos(va)*Ba,ua=Math.sin(wa);va=-Math.sin(va)*Ba;Z[3*qa]=ra*X;Z[3*qa+1]=ua*X;Z[3*qa+2]=va*X;ja[3*
qa]=ra;ja[3*qa+1]=ua;ja[3*qa+2]=va;Y[2*qa]=Aa;Y[2*qa+1]=ma;Ca.push(qa);++qa}oa.push(Ca)}X=[];for(da=0;da<ia;da++)for(aa=0;aa<ba;aa++)ea=oa[da][aa],ha=oa[da][aa+1],qa=oa[da+1][aa+1],ta=oa[da+1][aa],0===da?(X.push(ea),X.push(qa),X.push(ta)):da===ia-1?(X.push(ea),X.push(ha),X.push(qa)):(X.push(ea),X.push(ha),X.push(qa),X.push(qa),X.push(ta),X.push(ea));ba=[[p.VertexAttribute.POSITION,new l.Attribute(Z,X,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(ja,X,3,!0)]];fa.uv&&ba.push([p.VertexAttribute.UV0,
new l.Attribute(Y,X,2,!0)]);fa.offset&&(ba[0][0]=p.VertexAttribute.OFFSET,ba.push([p.VertexAttribute.POSITION,new l.Attribute(Float64Array.from(fa.offset),e.getZeroIndexArray(X.length),3,!0)]));return new x.Geometry(ca,ba)};a.createSquareGeometry=function(ca,X=U){var ba=Array(12);for(var ia=0;4>ia;ia++)for(let fa=0;3>fa;fa++)ba[3*ia+fa]=X[ia][fa];X=[0,1,2,2,3,0];ia=[0,0,0,0,0,0];ba=[[p.VertexAttribute.POSITION,new l.Attribute(ba,X,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute([0,0,1],ia,3,!0)],
[p.VertexAttribute.UV0,new l.Attribute([0,0,1,0,1,1,0,1],X,2,!0)],[p.VertexAttribute.COLOR,new l.Attribute([255,255,255,255],ia,4,!0)]];return new x.Geometry(ca,ba)};a.createTetrahedronGeometry=function(ca,X){Array.isArray(X)||(X=[X,X,X]);const ba=Array(12);for(let ia=0;4>ia;ia++)ba[3*ia]=O[ia][0]*X[0],ba[3*ia+1]=O[ia][1]*X[1],ba[3*ia+2]=O[ia][2]*X[2];return new x.Geometry(ca,[[p.VertexAttribute.POSITION,new l.Attribute(ba,Q,3,!0)],[p.VertexAttribute.NORMAL,new l.Attribute(T,V,3)]])};a.createTubeGeometry=
function(ca,X,ba,ia,fa,da){ia=ia||10;fa=null!=fa?fa:!0;w.assert(1<X.length);const aa=[],ea=[];for(let ha=0;ha<ia;ha++){aa.push([0,-ha-1,-((ha+1)%ia)-1]);const Y=ha/ia*2*Math.PI;ea.push([Math.cos(Y)*ba,Math.sin(Y)*ba])}return q(ca,ea,X,[[0,0,0]],aa,fa,da)};a.makeOrthoBasisDirUpFallback=v;a.transformInPlace=function(ca,X){ca=ca.getMutableAttribute(p.VertexAttribute.POSITION).data;for(let ba=0;ba<ca.length;ba+=3)n.set(W,ca[ba],ca[ba+1],ca[ba+2]),n.transformMat4(W,W,X),ca[ba]=W[0],ca[ba+1]=W[1],ca[ba+
2]=W[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.copyInto=function(n,h){for(let k=0;k<h.length;++k)n[k]=h[k];return n};a.doubleArrayFrom=function(n){return(b.isArray(n)?n.length:n.byteLength/8)<=b.nativeArrayMaxSize?Array.from(n):new Float64Array(n)};a.doubleSubArray=function(n,h,k){return Array.isArray(n)?n.slice(h,h+k):n.subarray(h,h+k)};a.newDoubleArray=function(n,
h=!1){return n<=b.nativeArrayMaxSize?h?Array(n).fill(0):Array(n):new Float64Array(n)};a.toFloat64Array=function(n){return Array.isArray(n)?new Float64Array(n):n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.compactFloatArray=function(n){return b.isArray(n)?n.length<b.nativeArrayMaxSize?n:new Float32Array(n):n.length<b.nativeArrayMaxSize?Array.from(n):n};a.floatArrayFrom=
function(n){return(b.isArray(n)?n.length:n.byteLength/8)<=b.nativeArrayMaxSize?Array.from(n):new Float32Array(n)};a.floatSubArray=function(n,h,k){return Array.isArray(n)?n.slice(h,h+k):n.subarray(h,h+k)};a.newFloatArray=function(n,h=!1){return n<=b.nativeArrayMaxSize?h?Array(n).fill(0):Array(n):new Float32Array(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){function n(c){let l=
!0;for(const f of c){if(65536<=f)return b.isArray(c)?new Uint32Array(c):c;256<=f&&(l=!1)}return l?new Uint8Array(c):new Uint16Array(c)}function h(c){if(1===c)return g;if(c<b.nativeArrayMaxSize)return Array.from(new Uint16Array(e.buffer,0,c));if(c<e.length)return new Uint16Array(e.buffer,0,c);if(c>m.length){m=new Uint32Array(Math.max(2*m.length,c));for(let l=0;l<m.length;l++)m[l]=l}return new Uint32Array(m.buffer,0,c)}function k(c){if(1===c)return g;if(c<b.nativeArrayMaxSize)return Array(c).fill(0);
c>d.length&&(d=new Uint8Array(Math.max(2*d.length,c)));return new Uint8Array(d.buffer,0,c)}let m=(()=>{const c=new Uint32Array(131072);for(let l=0;l<c.length;++l)c[l]=l;return c})();const g=[0],e=(()=>{const c=new Uint16Array(65536);for(let l=0;l<c.length;++l)c[l]=l;return c})();let d=new Uint8Array(65536);a.compactIndices=function(c){if(b.isArray(c)){if(c.length<b.nativeArrayMaxSize)return c}else if(c.length<b.nativeArrayMaxSize)return Array.from(c);let l=!0,f=!0;c.some((r,x)=>{l=l&&0===r;f=f&&r===
x;return!l&&!f});return l?k(c.length):f?h(c.length):b.isArray(c)||c.BYTES_PER_ELEMENT!==Uint16Array.BYTES_PER_ELEMENT?n(c):c};a.getContinuousIndexArray=h;a.getZeroIndexArray=k;a.newIndexArray=function(c){return c<=b.nativeArrayMaxSize?Array(c):65536>=c?new Uint16Array(c):new Uint32Array(c)};a.newIntArray=function(c){return c<=b.nativeArrayMaxSize?Array(c):new Uint32Array(c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],
function(a){a.Vec3Compact=void 0;(function(b){b.length=function(n,h){const k=n[h],m=n[h+1];n=n[h+2];return Math.sqrt(k*k+m*m+n*n)};b.normalize=function(n,h){var k=n[h];const m=n[h+1],g=n[h+2];k=1/Math.sqrt(k*k+m*m+g*g);n[h]*=k;n[h+1]*=k;n[h+2]*=k};b.scale=function(n,h,k){n[h]*=k;n[h+1]*=k;n[h+2]*=k};b.add=function(n,h,k,m,g,e=h){g=g||n;g[e]=n[h]+k[m];g[e+1]=n[h+1]+k[m+1];g[e+2]=n[h+2]+k[m+2]};b.subtract=function(n,h,k,m,g,e=h){g=g||n;g[e]=n[h]-k[m];g[e+1]=n[h+1]-k[m+1];g[e+2]=n[h+2]-k[m+2]}})(a.Vec3Compact||
(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Mesh=2]="Mesh";b[b.Line=3]="Line";b[b.Point=4]="Point";b[b.Material=5]="Material";b[b.Texture=6]="Texture";b[b.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../geometry/support/Indices ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends e.ContentObject{constructor(p,t,q=null,u=d.ContentObjectType.Mesh,v=null,y=-1){super();this.material=p;this.mapPositions=q;this.type=u;this.objectAndLayerIdColor=v;this.edgeIndicesLength=y;this.visible=!0;this._attributes=new Map;this._boundingInfo=null;for(const [D,G]of t)this._attributes.set(D,{...G,indices:h.compactIndices(G.indices)}),D===r.VertexAttribute.POSITION&&(this.edgeIndicesLength=0>this.edgeIndicesLength?this._attributes.get(D).indices.length:
this.edgeIndicesLength)}instantiate(p={}){const t=new w(p.material||this.material,[],this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);this._attributes.forEach((q,u)=>{q.exclusive=!1;t._attributes.set(u,q)});t._boundingInfo=this._boundingInfo;t.transformation=p.transformation||this.transformation;return t}get attributes(){return this._attributes}getMutableAttribute(p){let t=this._attributes.get(p);t&&!t.exclusive&&(t={...t,exclusive:!0,data:k.cloneAttributeData(t.data)},
this._attributes.set(p,t));return t}setAttributeData(p,t){const q=this._attributes.get(p);q&&this._attributes.set(p,{...q,exclusive:!0,data:t})}get indexCount(){return this._attributes.values().next().value.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}computeAttachmentOrigin(p){return(this.type===d.ContentObjectType.Mesh?this._computeAttachmentOriginTriangles(p):
this.type===d.ContentObjectType.Line?this._computeAttachmentOriginLines(p):this._computeAttachmentOriginPoints(p))?(null!=this._transformation&&n.transformMat4(p,p,this._transformation),!0):!1}_computeAttachmentOriginTriangles(p){const t=this.attributes.get(r.VertexAttribute.POSITION);return c.computeAttachmentOriginTriangles(t,p)}_computeAttachmentOriginLines(p){const t=this.attributes.get(r.VertexAttribute.POSITION);var q=c.computeAttachmentOriginLines;var u=this.material.parameters;u="isClosed"in
u&&u.isClosed?2<t.indices.length:!1;return q.call(c,t,u,p)}_computeAttachmentOriginPoints(p){const t=this.attributes.get(r.VertexAttribute.POSITION);return c.computeAttachmentOriginPoints(t,p)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const p=this.attributes.get(r.VertexAttribute.POSITION);if(!p||0===p.indices.length)return null;const t=this.type===d.ContentObjectType.Mesh?3:1;f.assert(0===p.indices.length%t,"Indexing error: "+p.indices.length+" not divisible by "+
t);const q=h.getContinuousIndexArray(p.indices.length/t);return new g.BoundingInfo(q,t,p)}get transformation(){return this._transformation??b.IDENTITY}set transformation(p){this._transformation=p&&p!==b.IDENTITY?b.clone(p):null}addHighlight(){const p=new l.Object3DStateID(m.Object3DState.Highlight);this.highlights=x.addObject3DStateID(this.highlights,p);return p}removeHighlight(p){this.highlights=x.removeObject3DStateID(this.highlights,p)}}a.Geometry=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,b){a.cloneAttributeData=function(n){if(n.length<b.nativeArrayMaxSize)return Array.from(n);if(b.isArray(n))return Float64Array.from(n);if(!("BYTES_PER_ELEMENT"in n))return Array.from(n);switch(n.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(n);case 2:return b.isUint16Array(n)?Uint16Array.from(n):Int16Array.from(n);case 4:return Float32Array.from(n);default:case 8:return Float64Array.from(n)}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(a,b,n,h,k){class m{constructor(e,d,c){this.primitiveIndices=e;this._numIndexPerPrimitive=d;this.position=c;this._children=void 0;k.assert(1<=e.length);k.assert(3===c.size||4===c.size);const {data:l,size:f,indices:r}=c;k.assert(0===
r.length%this._numIndexPerPrimitive);k.assert(r.length>=e.length*this._numIndexPerPrimitive);var x=e.length;d=f*r[this._numIndexPerPrimitive*e[0]];g.clear();g.push(d);c=h.fromValues(l[d],l[d+1],l[d+2]);var w=h.clone(c);for(var p=0;p<x;++p){var t=this._numIndexPerPrimitive*e[p];for(var q=0;q<this._numIndexPerPrimitive;++q){d=f*r[t+q];g.push(d);let u=l[d];c[0]=Math.min(u,c[0]);w[0]=Math.max(u,w[0]);u=l[d+1];c[1]=Math.min(u,c[1]);w[1]=Math.max(u,w[1]);u=l[d+2];c[2]=Math.min(u,c[2]);w[2]=Math.max(u,w[2])}}this.bbMin=
c;this.bbMax=w;e=n.lerp(h.create(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(w[0]-c[0],w[1]-c[1]),w[2]-c[2]);c=this.radius*this.radius;for(w=0;w<g.length;++w)d=g.at(w),x=l[d]-e[0],p=l[d+1]-e[1],d=l[d+2]-e[2],t=x*x+p*p+d*d,t<=c||(t=Math.sqrt(t),q=.5*(t-this.radius),this.radius+=q,c=this.radius*this.radius,t=q/t,e[0]+=x*t,e[1]+=p*t,e[2]+=d*t);this.center=e;g.clear()}getChildren(){if(this._children||1>=n.squaredDistance(this.bbMin,this.bbMax))return this._children;var e=n.lerp(h.create(),
this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length;const c=new Uint8Array(d),l=Array(8);for(var f=0;8>f;++f)l[f]=0;const {data:r,size:x,indices:w}=this.position;for(f=0;f<d;++f){var p=0;const q=this._numIndexPerPrimitive*this.primitiveIndices[f];var t=x*w[q];let u=r[t],v=r[t+1],y=r[t+2];for(let D=1;D<this._numIndexPerPrimitive;++D){t=x*w[q+D];const G=r[t],A=r[t+1];t=r[t+2];G<u&&(u=G);A<v&&(v=A);t<y&&(y=t)}u<e[0]&&(p|=1);v<e[1]&&(p|=2);y<e[2]&&(p|=4);c[f]=p;++l[p]}e=0;for(f=0;8>f;++f)0<l[f]&&
++e;if(!(2>e)){e=Array(8);for(f=0;8>f;++f)e[f]=0<l[f]?new Uint32Array(l[f]):void 0;for(f=0;8>f;++f)l[f]=0;for(f=0;f<d;++f)p=c[f],e[p][l[p]++]=this.primitiveIndices[f];this._children=[];for(d=0;8>d;++d)void 0!==e[d]&&this._children.push(new m(e[d],this._numIndexPerPrimitive,this.position));return this._children}}static prune(){g.prune()}}const g=new b({deallocator:null});a.BoundingInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports",
"../../../../core/uid"],function(a,b){class n{constructor(){this.id=b.generateUID()}}a.ContentObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/triangle"],function(a,b,n,h){const k=n.create(),m=n.create(),g=n.create(),e=n.create();a.computeAttachmentOriginLines=function(d,c,l){if(!d)return!1;
b.set(l,0,0,0);b.set(e,0,0,0);let f=0,r=0;const {size:x,data:w,indices:p}=d;d=p.length-1;c=d+(c?2:0);for(let q=0;q<c;q+=2){var t=p[q<d?q:d]*x;const u=p[q<d?q+1:0]*x;k[0]=w[t];k[1]=w[t+1];k[2]=w[t+2];m[0]=w[u];m[1]=w[u+1];m[2]=w[u+2];b.scale(k,b.add(k,k,m),.5);t=b.dist(k,m);0<t?(b.add(l,l,b.scale(k,k,t)),f+=t):0===f&&(b.add(e,e,k),r++)}return 0!==f?(b.scale(l,l,1/f),!0):0!==r?(b.scale(l,e,1/r),!0):!1};a.computeAttachmentOriginPoints=function(d,c){if(!d)return!1;const {size:l,data:f,indices:r}=d;b.set(c,
0,0,0);d=-1;let x=0;for(let w=0;w<r.length;w++){const p=r[w]*l;d!==p&&(c[0]+=f[p],c[1]+=f[p+1],c[2]+=f[p+2],x++);d=p}1<x&&b.scale(c,c,1/x);return 0<x};a.computeAttachmentOriginTriangles=function(d,c){if(!d)return!1;const {size:l,data:f,indices:r}=d;b.set(c,0,0,0);b.set(e,0,0,0);let x=d=0;for(let p=0;p<r.length-2;p+=3){var w=r[p]*l;const t=r[p+1]*l,q=r[p+2]*l;b.set(k,f[w],f[w+1],f[w+2]);b.set(m,f[t],f[t+1],f[t+2]);b.set(g,f[q],f[q+1],f[q+2]);(w=h.areaPoints3d(k,m,g))?(b.add(k,k,m),b.add(k,k,g),b.scale(k,
k,1/3*w),b.add(c,c,k),d+=w):(b.add(e,e,k),b.add(e,e,m),b.add(e,e,g),x+=3)}return 0===x&&0===d?!1:0!==d?(b.scale(c,c,1/d),!0):0!==x?(b.scale(c,e,1/x),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,n,h,k,m){function g(r){return r?{p0:h.clone(r.p0),p1:h.clone(r.p1),p2:h.clone(r.p2)}:
{p0:h.create(),p1:h.create(),p2:h.create()}}function e(r,x,w,p=g()){n.copy(p.p0,r);n.copy(p.p1,x);n.copy(p.p2,w);return p}const d=new b.ObjectStack(k.create),c=new b.ObjectStack(()=>g()),l=h.create(),f=h.create();a.areaPoints2d=function(r,x,w){return.5*Math.abs((x[0]-r[0])*(w[1]-r[1])-(x[1]-r[1])*(w[0]-r[0]))};a.areaPoints3d=function(r,x,w){n.subtract(l,x,r);n.subtract(f,w,r);return.5*n.length(n.cross(l,l,f))};a.copy=function(r,x=g()){return e(r.p0,r.p1,r.p2,x)};a.create=g;a.distance2=function(r,
x){var w=r.p0,p=r.p1;r=r.p2;const t=n.subtract(m.sv3d.get(),p,w),q=n.subtract(m.sv3d.get(),r,p),u=n.subtract(m.sv3d.get(),w,r),v=n.subtract(m.sv3d.get(),x,w);var y=n.subtract(m.sv3d.get(),x,p),D=n.subtract(m.sv3d.get(),x,r);const G=n.cross(t,t,u),A=n.dot(n.cross(m.sv3d.get(),t,G),v);y=n.dot(n.cross(m.sv3d.get(),q,G),y);D=n.dot(n.cross(m.sv3d.get(),u,G),D);if(0<A&&0<y&&0<D)return x=n.dot(G,v),x*x/n.dot(G,G);w=k.distance2(k.fromValues(w,t,d.get()),x);p=k.distance2(k.fromValues(p,q,d.get()),x);x=k.distance2(k.fromValues(r,
u,d.get()),x);return Math.min(w,p,x)};a.fromValues=e;a.intersectRay=function(r,x,w){const {direction:p,origin:t}=x,{p0:q,p1:u,p2:v}=r;var y=u[0]-q[0],D=u[1]-q[1],G=u[2]-q[2];r=v[0]-q[0];x=v[1]-q[1];const A=v[2]-q[2];var C=p[1]*A-x*p[2],E=p[2]*r-A*p[0];const I=p[0]*x-r*p[1];var H=y*C+D*E+G*I;if(-1E-5<H&&1E-5>H)return!1;H=1/H;const J=t[0]-q[0],B=t[1]-q[1],z=t[2]-q[2];C=H*(J*C+B*E+z*I);if(0>C||1<C)return!1;E=B*G-D*z;G=z*y-G*J;y=J*D-y*B;D=H*(p[0]*E+p[1]*G+p[2]*y);if(0>D||1<C+D)return!1;w&&(n.scale(w,
p,H*(r*E+x*G+A*y)),n.add(w,t,w));return!0};a.wrap=function(r,x,w){const p=c.get();p.p0=r;p.p1=x;p.p2=w;return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){class n{constructor(h){this.channel=h;this.id=b.generateUID()}}a.Object3DStateID=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,b,n){const h=b.create(),k=new Float32Array(6);a.addObject3DStateID=function(m,g){null==m&&(m=[]);m.push(g);return m};a.encodeDoubleVec3=function(m,g,e,d,c){h[0]=m.get(g,0);h[1]=m.get(g,1);h[2]=m.get(g,2);n.encodeDoubleArray(h,k,3);e.set(c,0,k[0]);d.set(c,0,k[1]);e.set(c,1,k[2]);d.set(c,1,k[3]);e.set(c,2,k[4]);d.set(c,2,k[5])};a.removeObject3DStateID=function(m,g){if(null==m)return null;m=
m.filter(e=>e!==g);return 0===m.length?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/MarsAtmosphere":function(){define("../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/FloatArray ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor ../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J){function B(P,R,O,T,Q){const V=g.length(P),U=T*Math.sqrt(V*V-T*T)/V,W=Q.v1,ca=Q.v2;g.scale(Q.center,P,Math.sqrt(T*T-U*U)/V);g.cross(W,P,R);1>g.squaredLength(W)&&g.cross(W,P,O);g.scale(W,W,U/g.length(W));g.cross(ca,W,P);g.scale(ca,ca,U/g.length(ca));return U}const z=-f.innerAtmosphereDepth,K=t.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);class L{constructor(P,R){this.view=P;this.type=l.AtmosphereType.Mars;
this._passParameters=new r.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;P=d.getReferenceEllipsoid(P.spatialReference);this._planetRadius=P.radius;this._outerRimWidth=P.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+z)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;this._texVScale=this._texV1-this._texV0;this._techniqueRepository=
R.techniqueRepository;P=R.renderContext.rctx;this._cameraChangeHandle=n.watch(()=>this.view.state?.camera,()=>R.requestRender(),n.syncAndInitial);this._vao=this._createRibbon(P);this._vaoCount=J.vertexCount(this._vao,"geometry");this._fadeVao=y.createQuadVAO(P);this._fadeVaoCount=J.vertexCount(this._fadeVao,"geometry");const O=new H.TextureDescriptor;O.wrapMode=E.TextureWrapMode.CLAMP_TO_EDGE;O.flipped=!0;O.width=1;O.height=512;this._passParameters.texture=new I.Texture(P,O,p.marsAtmosphereTextureSimple);
P=new w.SimpleAtmosphereTechniqueConfiguration;P.geometry=w.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(x.SimpleAtmosphereTechnique,P);P.geometry=w.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(x.SimpleAtmosphereTechnique,P)}destroy(){this._coneTechnique.release();this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=b.disposeMaybe(this._passParameters.texture);
this._fadeVao.dispose();this._vao.dispose()}render(P){this._update(P.bindParameters.camera);const R=P.rctx;1>this._passParameters.undergroundFadeAlpha&&(R.bindTechnique(this._coneTechnique,P.bindParameters,this._passParameters),R.bindVAO(this._vao),R.drawArrays(E.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&(R.bindTechnique(this._undergroundTechnique,P.bindParameters,this._passParameters),R.bindVAO(this._fadeVao),R.drawArrays(E.PrimitiveType.TRIANGLE_STRIP,
0,this._fadeVaoCount))}renderHaze(){}_update(P){var R=e.create();const O=this._planetRadius;var T=g.length(P.eye);const Q=T-O;this._passParameters.undergroundFadeAlpha=0>Q?Math.min(-Q/5E3,1):0;var V=O+z,U=O+Math.max(50,Q);this._passParameters.innerScale=U*U/(Math.sqrt(U*U-O*O)*Math.sqrt(U*U-V*V)+O*V)-1;this._passParameters.altitudeFade=f.computeInnerAltitudeFade(Q);g.scale(R,P.eye,(O+50)/T);B(R,P.center,P.up,O,this._passParameters.silhouette);R=this._computeScreenRimWidth(P,R,P.up,this._passParameters.silhouette);
T=K(Q);V=this._texV0+.001953125*this._texVScale;U=this._texV0+R*T*this._texVScale;50<Q&&(B(P.eye,P.center,P.up,O,this._passParameters.silhouette),P=this._computeScreenRimWidth(P,P.eye,P.up,this._passParameters.silhouette),P=a.clamp((P-1.5)/(R-1.5),0,1),V=this._texV0+.001953125*P*this._texVScale,U=this._texV0+a.lerp(this._texV1,R*T,P)*this._texVScale);m.set(this._passParameters.texV,V,U)}_createRibbon(P){const R=c.newFloatArray(1155),O=new Uint32Array(1920);R[0]=0;R[1]=0;R[2]=-1;for(var T=0;128>T;T++){var Q=
9*T+3;R[Q]=T;R[Q+1]=this._innerRimFactor;R[Q+2]=-1;R[Q+3]=T;R[Q+4]=this._middleRimFactor;R[Q+5]=0;R[Q+6]=T;R[Q+7]=this._outerRimFactor;R[Q+8]=1;Q=3*T+1;var V=127===T?1:Q+3,U=15*T;O[U]=Q;O[U+1]=Q+1;O[U+2]=V+1;O[U+3]=V+1;O[U+4]=V;O[U+5]=Q;O[U+6]=Q+1;O[U+7]=Q+2;O[U+8]=V+2;O[U+9]=V+2;O[U+10]=V+1;O[U+11]=Q+1;O[U+12]=Q;O[U+13]=V;O[U+14]=0}T=N.createBuffer(O.length);Q=T.position;for(V=0;V<O.length;++V)U=3*O[V],Q.set(V,0,R[U]),Q.set(V,1,R[U+1]),Q.set(V,2,R[U+2]);return new G.VertexArrayObject(P,v.Default3D,
{geometry:q.glLayout(N)},{geometry:C.BufferObject.createVertex(P,E.Usage.STATIC_DRAW,T.buffer)})}_computeScreenRimWidth(P,R,O,T){g.add(M,T.center,T.v2);g.scale(S,M,this._outerRimFactor);h.lookAt(F,R,M,O);D.project(M,F,P.projectionMatrix,P.viewport,M);D.project(S,F,P.projectionMatrix,P.viewport,S);return g.distance(M,S)/P.height}}const F=k.create(),M=e.create(),S=e.create(),N=u.newLayout().vec3f(A.VertexAttribute.POSITION);return L})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],
function(a){const b=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,
0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,
6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,
4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,
11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,
118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,
138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,
28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,
96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,
61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,
87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,
221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,
212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){a.Precipitation=class extends n{constructor(E){super(E);this._numParticles=25E4;this._rainSpeed=.1;this._snowSpeed=.01;this._passParameters=new x.PrecipitationPassParameters;this._animation=new q.AnimationTimer;this._updatingTracking=new f.UpdatingHandles;this._passParameters.time=0;this._passParameters.radius=r.getReferenceEllipsoid(E.view.spatialReference).radius;this._techniqueRepository=E.context.techniqueRepository}destroy(){this._updatingTracking.destroy();
this._numParticles=0;this._snowTechniqueCached=k.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=k.releaseMaybe(this._rainTechniqueCached);this._vao=k.disposeMaybe(this._vao);this._instanceIdBuffer=k.disposeMaybe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(null==this._rainTechniqueCached){const E=new w.PrecipitationTechniqueConfiguration;E.type=w.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(x.PrecipitationTechnique,
E)}return this._rainTechniqueCached}get _snowTechnique(){if(null==this._snowTechniqueCached){const E=new w.PrecipitationTechniqueConfiguration;E.type=w.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(x.PrecipitationTechnique,E)}return this._snowTechniqueCached}update(E){return this._animation.advance(E)}render(E,I,H){const J="rainy"===H?this._rainTechnique:this._snowTechnique;if(J.compiled){var B=E.rctx;this._ensureResources(B);null!=J&&null!=this._vao&&null!=this._instanceIdBuffer&&
(null!=E.bindParameters.cloudsFade.data&&(this._passParameters.opacity=E.bindParameters.cloudsFade.opacity),0>=this._passParameters.opacity||(I=.5>I?h.lerp(0,.35,2*I):h.lerp(.35,1,2*(I-.5)),this._passParameters.time=("rainy"===H?this._rainSpeed:this._snowSpeed)*m.secondsFromMilliseconds(this._animation.time)%1E5,E=B.bindTechnique(J,E.bindParameters,this._passParameters),B.bindVAO(this._vao),E.assertCompatibleVertexAttributeLocations(this._vao),G.bindVertexBufferLayout(B,x.attributeLocations,this._instanceIdBuffer,
C,0),B.drawArraysInstanced(D.PrimitiveType.TRIANGLES,0,3,this._numParticles*I),G.unbindVertexBufferLayout(B,x.attributeLocations,this._instanceIdBuffer,C)))}else this.context.requestRender()}_ensureResources(E){null==this._vao&&(this._vao=this._createVertexArrayObject(E));null==this._instanceIdBuffer&&(this._instanceIdBuffer=this._createInstanceIndices(E))}_createInstanceIndices(E){const I=[];for(let H=0;H<this._numParticles;H++)I.push(H);return y.BufferObject.createVertex(E,D.Usage.STATIC_DRAW,new Float32Array(I))}_createVertexArrayObject(E){const I=
new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new u.VertexArrayObject(E,x.attributeLocations,{geometry:p.glLayout(A)},{geometry:y.BufferObject.createVertex(E,D.Usage.STATIC_DRAW,I)})}};b.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);b.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);b.__decorate([g.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);b.__decorate([g.property()],a.Precipitation.prototype,
"_updatingTracking",void 0);a.Precipitation=b.__decorate([l.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const A=t.newLayout().vec3f(v.VertexAttribute.POSITION),C=p.glLayout(t.newLayout().f32(v.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends h.NoParameters{constructor(){super(...arguments);this.time=0;this.radius=1;this.width=500;this.opacity=1}}class f extends m.ShaderTechnique{initializeProgram(x){return new g.Program(x.rctx,f.shader.get().build(this.configuration),r)}initializePipeline(){return c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},
colorWrite:c.defaultColorWriteParams})}}f.shader=new k.ReloadableShaderModule(n.Precipitation,()=>new Promise((x,w)=>a(["./Precipitation.glsl"],x,w)));const r=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=l;b.PrecipitationTechnique=f;b.attributeLocations=r;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(p){const t=new d.ShaderBuilder;t.attributes.add(c.VertexAttribute.POSITION,"vec3");t.attributes.add(c.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");t.vertex.uniforms.add(new k.Float3PassUniform("cameraPosition",(q,u)=>u.camera.eye));t.vertex.uniforms.add(new k.Float3PassUniform("offset",(q,u)=>{u=u.camera.eye;var v=.5*q.width;const y=1/q.width;v=b.floor(f,b.set(f,(u[0]+v)*y,(u[1]+v)*y,(u[2]+v)*y));return b.sub(v,u,b.scale(v,v,q.width))}));t.vertex.uniforms.add(new m.FloatPassUniform("width",
q=>q.width));t.vertex.uniforms.add(new e.Matrix4PassUniform("proj",(q,u)=>u.camera.projectionMatrix));t.vertex.uniforms.add(new e.Matrix4PassUniform("view",(q,u)=>u.camera.viewMatrix));t.vertex.uniforms.add(new m.FloatPassUniform("time",q=>q.time));t.varyings.add("vUv","vec2");t.vertex.code.add(g.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${p.type===h.PrecipitationType.Rain?g.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:g.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);t.fragment.uniforms.add(new m.FloatPassUniform("opacity",q=>q.opacity),new k.Float3PassUniform("particleColor",(q,u)=>{q=p.type===h.PrecipitationType.Rain?w:x;const v=b.scale(f,q,.7);b.normalize(r,u.camera.eye);u=Math.max(0,b.dot(r,u.lighting.mainLight.direction));return b.lerp(v,v,q,u)}));t.fragment.code.add(g.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${p.type===h.PrecipitationType.Rain?g.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:g.glsl`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `);return t}const f=n.create(),r=n.create(),x=n.fromValues(1,1,1),w=n.fromValues(.85,.85,.85);n=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.Precipitation=n;a.build=l})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){a.PrecipitationType=void 0;(function(k){k[k.Rain=0]="Rain";k[k.Snow=
1]="Snow";k[k.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.type=a.PrecipitationType.Rain}}b.__decorate([n.parameter({count:a.PrecipitationType.COUNT})],h.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../core/time"],function(a,
b){class n{constructor(){this.enabled=!0;this._time=b.Milliseconds(0)}get time(){return this._time}advance({deltaTime:k,fixedTime:m}){if(null!=m){if(this._time===m)return!1;this._time=m;return!0}this._time=b.Milliseconds(this._time+k);return 0!==k}}class h{constructor(k,m){this.deltaTime=k;this.fixedTime=m}}a.AnimationTimer=n;a.Parameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/support/UpdatingHandles ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){a.Stars=class extends h{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return null!=this._loadDataTask&&!this._loadDataTask.finished}constructor(z){super(z);this._loadDataTask=null;this._numPoints=0;this._passParameters=new q.StarPassParameters;this._updatingTracking=new t.UpdatingHandles}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=e.abortMaybe(this._loadDataTask);
this._updatingTracking.destroy();this._numPoints=0;this._technique=e.releaseMaybe(this._technique);this._vao=e.disposeMaybe(this._vao);B=null}render(z){const {rctx:K}=z;this._ensureResources(K);null!=this._technique&&null!=this._vao&&(this._technique.compiled?(z=K.bindTechnique(this._technique,z.bindParameters,this._passParameters),K.bindVAO(this._vao),z.assertCompatibleVertexAttributeLocations(this._vao),K.drawArrays(C.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())}_ensureResources(z){if(null==
this._technique&&null!=B){this._technique=new q.StarsTechnique({rctx:z,viewingMode:this.view.state.viewingMode});this._numPoints=B.byteLength/9;var K=new Float32Array(B,0,2*this._numPoints),L=new Uint8Array(B,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(z,K,L,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,F=>this._update(F),c.initial)}}_computeDayDuration(z){const K=new Date(z.getFullYear(),
0,1,11,58,56),L=new Date(z.getFullYear()+1,0,1,11,58,55);return(+z-+K)/(+L-+K)}_update(z){if(z){var K=z.getHours()/12,L=z.getMinutes()/60*(2/24),F=z.getSeconds()/60*(2/1440);K=(K+L+F-.9972222)%2;z=2*this._computeDayDuration(z);L=w.copy(this._passParameters.modelMatrix,H);w.rotateZ(L,L,-z*Math.PI);w.multiply(L,I,L);w.rotateZ(L,L,-K*Math.PI);this.requestRender()}}_hexToRGB(z){return[parseInt(z.substring(0,2),16),parseInt(z.substring(2,4),16),parseInt(z.substring(4,6),16)]}_unpackUint8Attributes(z){return 192<=
z?[2.9,z-192]:160<=z?[2.5,z-160]:128<=z?[2,z-128]:96<=z?[1.5,z-96]:64<=z?[1,z-64]:32<=z?[.7,z-32]:[.4,z]}_createVertexArrayObject(z,K,L,F){const M=J.createBuffer(F),S=M.position,N=M.color,P=M.size;for(let T=0;T<F;T++){var R=K[2*T],O=K[2*T+1];S.set(T,0,-Math.cos(R)*Math.sin(O));S.set(T,1,-Math.sin(R)*Math.sin(O));S.set(T,2,-Math.cos(O));R=this._unpackUint8Attributes(L[T]);O=this._hexToRGB(E[R[1]]);N.set(T,0,255*O[0]);N.set(T,1,255*O[1]);N.set(T,2,255*O[2]);N.set(T,3,255);P.set(T,R[0])}return new D.VertexArrayObject(z,
y.Default3D,{geometry:u.glLayout(J)},{geometry:A.BufferObject.createVertex(z,C.Usage.STATIC_DRAW,M.buffer)})}_createLoadDataTask(){if(null!=B)return null;const z=k.createTask(async K=>{({data:K}=await n.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:K}));this._verifyStarData(K);B=K});z.promise.catch(K=>{d.isAbortError(K)||g.getLogger(this).error(K)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return z}_verifyStarData(z){if(!z)throw new m("stars:no-data-received",
"Failed to create stars because star catalogue is missing");z=z.byteLength/9;if(0!==z%1||5E4<z||5E3>z)throw new m("stars:invalid-data","Failed to create stars because star catalogue data is invalid");}};b.__decorate([l.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([l.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);b.__decorate([l.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([l.property()],a.Stars.prototype,"_loadDataTask",
void 0);b.__decorate([l.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=b.__decorate([x.subclass("esri.views.3d.environment.Stars")],a.Stars);const E="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),I=p.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),H=p.fromValues(1,0,0,0,0,.9174771405229186,
-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),J=v.newLayout().vec3f(G.VertexAttribute.POSITION).vec4u8(G.VertexAttribute.COLOR).f32(G.VertexAttribute.SIZE);let B=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r extends k.NoParameters{constructor(){super(...arguments);this.modelMatrix=n.create()}}class x extends g.ShaderTechnique{constructor(w){super(w,new e.ShaderTechniqueConfiguration,()=>this.destroy())}initializeProgram(w){return new c.Program(w.rctx,x.shader.get().build(),d.Default3D)}initializePipeline(){return f.makePipelineState({blending:f.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),
depthTest:{func:l.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})}}x.shader=new m.ReloadableShaderModule(h.Stars,()=>new Promise((w,p)=>a(["./Stars.glsl"],w,p)));b.StarPassParameters=r;b.StarsTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(){const f=new e.ShaderBuilder;f.attributes.add(d.VertexAttribute.POSITION,"vec3");f.attributes.add(d.VertexAttribute.COLOR,"vec4");f.attributes.add(d.VertexAttribute.SIZE,"float");f.varyings.add("vcolor","vec4");f.varyings.add("vsize","float");f.vertex.uniforms.add(new g.Matrix4PassUniform("transform",(r,x)=>{b.copy(l,x.camera.projectionMatrix);l[10]=2.4E-7-1;l[11]=-1;l[14]=(2.4E-7-2)*x.camera.near;b.multiply(l,l,x.camera.viewMatrix);return b.multiply(l,l,r.modelMatrix)}),
new h.Float4PassUniform("viewport",(r,x)=>x.camera.fullViewport),new k.FloatPassUniform("pixelRatio",(r,x)=>x.camera.pixelRatio));f.vertex.code.add(m.glsl`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);f.fragment.code.add(m.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`);return f}const l=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));a.Stars=n;a.build=c})},"esri/views/3d/webgl-engine/effects/RenderPlugin":function(){define(["exports","../../../../core/Accessor","../core/shaderLibrary/ShaderOutput"],function(a,b,n){const h={required:[]},k={required:[n.ShaderOutput.LinearDepth]},m={required:[n.ShaderOutput.CompositeColor]},g={required:[n.ShaderOutput.Highlight]};n={required:[n.ShaderOutput.Depth,n.ShaderOutput.Normal]};
class e extends b{consumes(){return h}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(x){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(x){return!1}}class d extends e{}class c extends e{constructor(){super(...arguments);this.drapedPriority=0}}class l extends e{}class f extends e{}class r extends e{}a.ASyncPreparesRenderPlugin=r;a.AsyncRenderPlugin=f;a.ConsumesCompositeColor=m;a.ConsumesDepth=
k;a.ConsumesDepthNormal=n;a.ConsumesHighlight=g;a.ConsumesNone=h;a.SyncPrepareRenderPlugin=c;a.SyncPreparesRenderPlugin=l;a.SyncRenderPlugin=d;a.isPrepareRenderPlugin=function(x){return"prepareTechnique"in x};a.isPreparesRenderPlugin=function(x){return"prepareTechniques"in x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],function(a){a.Update=void 0;var b=a.Update||(a.Update={});b[b.Immediate=0]="Immediate";b[b.Faded=
1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(a,b,n,h,k,m,g,e,
d,c,l){function f(R,O,T){O===d.ViewingMode.Global?g.normalize(S,R.eye):g.set(S,0,0,1);g.scale(N,R.viewForward,-1);O=l.angle(N,S);const Q=Math.max(O-.5,0);n.fromRotation(M,-Math.max(.25,O-.25-.85*Q/(Q+1)),R.viewRight);g.transformMat4(T,N,M);g.add(T,T,g.scale(P,R.viewRight,.2));g.normalize(T,T)}function r(R,O,T,Q){const V=y,U=n.identity(v);if(T===d.ViewingMode.Global)c.SunCalc.getPosition(R,0,0,V),g.set(Q,0,0,-1),n.rotateX(U,U,-V.azimuth),n.rotateY(U,U,-V.altitude);else{var W=p.planarDirection;T=W.globalAngles;
W=(Math.abs(O[2])-W.localAltitude)/(W.globalAltitude-W.localAltitude);W=b.clamp(W,0,1);1>W?(c.SunCalc.getPosition(R,O[1],O[0],V),V.azimuth=(1-W)*V.azimuth+W*T.azimuth,V.altitude=(1-W)*V.altitude+W*T.altitude):(V.azimuth=T.azimuth,V.altitude=T.altitude);g.set(Q,0,-1,0);n.rotateZ(U,U,-V.azimuth);n.rotateX(U,U,-V.altitude)}g.transformMat4(Q,Q,U)}function x(R){switch(R){case "disabled":case "sunny":return new t(1,1);case "cloudy":return new t(1,1);case "rainy":return new t(.4,1.2);case "snowy":return new t(.5,
1.3);case "foggy":return new t(.2,1.6)}}function w(R,O){const T=(R[0]+R[1]+R[2])/3;R[0]+=(T-R[0])*O;R[1]+=(T-R[1])*O;R[2]+=(T-R[2])*O}const p={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class t{constructor(R,O){this.direct=R;this.ambient=O}}const q=e.fromValues(.5773502691896258,
-.5773502691896258,.5773502691896258);class u{constructor(){this.ambient={color:e.fromValues(1,1,1),intensity:.55};this.direct={color:e.fromValues(1,1,1),intensity:.55,directionToLightSource:e.clone(q)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1}}const v=h.create(),y={azimuth:0,altitude:0},D=e.fromValues(.01,.01,.01),G=e.fromValues(1,.6,.5),A=e.fromValues(1,.98,.98),C=e.fromValues(1,1,1),E=e.fromValues(.8,.8,1),I=e.fromValues(.8,.8,1),H=e.fromValues(.98,
.98,1),J=e.fromValues(1,1,1),B=m.fromValues(.01,p.local.ambientAtNight),z=m.fromValues(p.local.directAtTwilight,p.local.ambientAtTwilight),K=m.fromValues(.9*p.local.directAtNoon,p.local.ambientAtNoon),L=m.fromValues(p.local.directAtNoon,p.local.ambientAtNoon),F=new Date(0),M=h.create(),S=e.create(),N=e.create(),P=e.create();a.ColorAndIntensity=u;a.computeColorAndIntensity=function(R,O,T,Q,V,U){g.set(U.ambient.color,1,1,1);U.ambient.intensity=p.global.ambient;g.set(U.direct.color,1,1,1);U.direct.intensity=
p.global.direct;var W=b.clamp((Math.abs(O[2])-p.local.altitude)/(p.global.altitude-p.local.altitude),0,1);U.globalFactor=W;var ca;null!=R&&(ca=c.SunCalc.getTimes(R,O[1],O[0]));if(1>W){if(null!=R){var X=ca;var ba=R.valueOf();if(X.polarException===c.SunCalc.PolarException.MIDNIGHT_SUN){var ia=ba-36E5*(R.getHours()+48)-6E4*R.getMinutes();X=ia+432E6}else X.polarException===c.SunCalc.PolarException.POLAR_NIGHT?(ia=ba-2,X=ba-1):(ia=X.sunrise.valueOf(),X=X.sunset.valueOf());var fa=X-ia;var da=ia+fa/2,aa=
fa/4;const ea=da-aa;aa=da+aa;fa*=.06;const ha=ia-fa/2,Y=ia+fa/2,Z=X-fa/2,ja=X+fa/2;ia=m.create();fa=e.create();X=e.create();ba<ha||ba>ja?(k.copy(ia,B),g.copy(fa,D),g.copy(X,E)):ba<Y?(ba=(ba-ha)/(Y-ha),k.lerp(ia,B,z,ba),g.lerp(fa,D,G,ba),g.lerp(X,E,I,ba)):ba<ea?(ba=(ba-Y)/(ea-Y),k.lerp(ia,z,K,ba),g.lerp(fa,G,A,ba),g.lerp(X,I,H,ba)):ba<da?(ba=(ba-ea)/(da-ea),k.lerp(ia,K,L,ba),g.lerp(fa,A,C,ba),g.lerp(X,H,J,ba)):ba<aa?(ba=(ba-da)/(aa-da),k.lerp(ia,L,K,ba),g.lerp(fa,C,A,ba),g.lerp(X,J,H,ba)):ba<Z?(ba=
(ba-aa)/(Z-aa),k.lerp(ia,K,z,ba),g.lerp(fa,A,G,ba),g.lerp(X,H,I,ba)):ba<ja&&(ba=(ba-Z)/(ja-Z),k.lerp(ia,z,B,ba),g.lerp(fa,G,D,ba),g.lerp(X,I,E,ba));ba=0;switch(Q){case "rainy":case "foggy":ba=.8;break;case "snowy":ba=.5}0<ba&&(w(fa,ba),w(X,ba));da=x(Q);ba=ia[0]*da.direct;ia=ia[1]*da.ambient}else X=x(Q),ba=p.local.directAtNoon*X.direct,fa=e.fromValues(1,1,1),ia=p.local.ambientAtNoon*X.ambient,X=e.fromValues(1,1,1);g.lerp(U.ambient.color,X,U.ambient.color,W);U.ambient.intensity=b.lerp(ia,U.ambient.intensity,
W);g.lerp(U.direct.color,fa,U.direct.color,W);U.direct.intensity=b.lerp(ba,U.direct.intensity,W);U.specularStrength="rainy"===Q||"snowy"===Q||"foggy"===Q?0:1;U.environmentStrength="rainy"===Q?.7:"snowy"===Q||"foggy"===Q?.75:1}null!=R?(Q=R.valueOf(),ca.polarException===c.SunCalc.PolarException.MIDNIGHT_SUN?(W=Q-36E5*(R.getHours()+48)-6E4*R.getMinutes(),ca=W+432E6):ca.polarException===c.SunCalc.PolarException.POLAR_NIGHT?(W=Q-2,ca=Q-1):(W=ca.sunrise.valueOf(),ca=ca.sunset.valueOf()),Q=1-b.clamp(Math.abs(Q-
(W+(ca-W)/2))/432E5,0,1)):Q=1;U.noonFactor=Q;null!=R?r(R,O,T,U.direct.directionToLightSource):f(V,T,U.direct.directionToLightSource)};a.computeDirectionsOverTime=function(R,O,T,Q,V){R=R.getTime();O=O.getTime()-R;O=Math.floor(O/T)+1;const U=Array(O);for(let W=0;W<O;++W)F.setTime(R+T*W),U[W]=e.create(),r(F,Q,V,U[W]);return U};a.computeShadowsEnabled=function(R,O){return O===d.ViewingMode.Global?!0:Math.abs(R)<p.planarDirection.localAltitude};a.computeVirtualLightDirection=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports","./_commonjsHelpers"],function(a,b){var n={exports:{}};(function(h){(function(k){k=k();void 0!==k&&(h.exports=k)})(function(){function k(E){return new Date(864E5*(E+.5-2440588))}function m(E,I){return u(w(E)*p(G)-t(I)*w(G),p(E))}function g(E,I){return q(w(I)*p(G)+p(I)*w(G)*w(E))}function e(E,I,H){return u(w(E),p(E)*w(I)-t(H)*p(I))}function d(E,I,H){return q(w(I)*w(H)+p(I)*p(H)*p(E))}function c(E){return y*(1.9148*
w(E)+.02*w(2*E)+3E-4*w(3*E))}function l(E,I){E=y*(357.5291+.98560028*E);var H=c(E);E=E+H+102.9372*y+x;I||={dec:0,ra:0};I.dec=g(E,0);I.ra=m(E,0);return I}function f(E,I,H){return 2451545+E+.0053*w(I)-.0069*w(2*H)}function r(E){var I=y*(134.963+13.064993*E),H=y*(93.272+13.22935*E);E=y*(218.316+13.176396*E)+6.289*y*w(I);H=5.128*y*w(H);I=385001-20905*p(I);return{ra:m(E,H),dec:g(E,H),dist:I}}var x=Math.PI,w=Math.sin,p=Math.cos,t=Math.tan,q=Math.asin,u=Math.atan2,v=Math.acos,y=x/180,D={dec:0,ra:0},G=23.4397*
y,A={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(E,I,H,J){H=y*-H;I*=y;var B=E.valueOf()/864E5-.5+2440588-2451545;E=l(B,D);H=y*(280.16+360.9856235*B)-H-E.ra;J||={azimuth:0,altitude:0};J.azimuth=e(H,I,E.dec);J.altitude=d(H,I,E.dec);return J}},C=[[-.83,"sunrise","sunset"]];A.addTime=function(E,I,H){C.push([E,I,H])};A.getTimes=function(E,I,H){function J(O){var T=z,Q=M;O=v((w(O)-w(T)*w(Q))/(p(T)*p(Q)));return f(9E-4+(O+B)/(2*x)+K,L,F)}var B=y*-H,z=y*I,K=Math.round(E.valueOf()/
864E5-.5+2440588-2451545-9E-4-B/(2*x));E=9E-4+(0+B)/(2*x)+K;var L=y*(357.5291+.98560028*E);I=c(L);var F=L+I+102.9372*y+x,M=g(F,0);E=f(E,L,F);I={solarNoon:k(E),nadir:k(E-.5),polarException:A.PolarException.NORMAL};var S;H=0;for(S=C.length;H<S;H+=1){var N=C[H];var P=J(N[0]*y);var R=E-(P-E);I[N[1]]=k(R);I[N[2]]=k(P)}I.polarException=function(O){O=(w(O)-w(z)*w(M))/(p(z)*p(M));return-1>O?A.PolarException.MIDNIGHT_SUN:1<O?A.PolarException.POLAR_NIGHT:A.PolarException.NORMAL}(C[0][0]*y);return I};A.getMoonPosition=
function(E,I,H){H=y*-H;I*=y;var J=E.valueOf()/864E5-.5+2440588-2451545;E=r(J);H=y*(280.16+360.9856235*J)-H-E.ra;J=d(H,I,E.dec);J+=.017*y/t(J+10.26*y/(J+5.1*y));return{azimuth:e(H,I,E.dec),altitude:J,distance:E.dist}};A.getMoonFraction=function(E){var I=E.valueOf()/864E5-.5+2440588-2451545;E=l(I);I=r(I);E=v(w(E.dec)*w(I.dec)+p(E.dec)*p(I.dec)*p(E.ra-I.ra));E=u(149598E3*w(E),I.dist-149598E3*p(E));return(1+p(E))/2};return A})})(n);b=b.getDefaultExportFromCjs(n.exports);a.SunCalc=b})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J){b=class extends b{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(z){"pan"!==z&&"rotate"!==z||z===this._get("primaryDragAction")||(this._set("primaryDragAction",z),this._updateMode())}get mode(){return this._get("mode")}set mode(z){"default"!==z&&"pro"!==z||z===this._get("mode")||(this._set("mode",z),this._updateMode())}get updating(){return!!this._inputManager?.updating}get latestPointerType(){return this._inputManager?.latestPointerType}get latestPointerLocation(){return this._inputManager?.latestPointerLocation}get multiTouchActive(){return this._inputManager?.multiTouchActive??
!1}disconnect(){this.view.viewEvents.disconnect();this._inputManager=n.destroyMaybe(this._inputManager)}connect(){const z=this.view;this._source=new y.BrowserEventSource(this.view.surface,z.input);var K=[new C.ImmediateDoubleClick,new E.PointerClickHoldAndDrag,new I.SingleAndDoubleClick,new A.Drag(this.view.navigation),new H.VerticalTwoFingerDrag];this._inputManager=K=new D.InputManager({eventSource:this._source,recognizers:K});K.installHandlers("prevent-context-menu",[new G.PreventContextMenu],D.ViewEventPriorities.INTERNAL);
this._modeDragPan=new p.PinchAndPanNavigation(z,"primary");this._modeDragRotate=new l.DragRotate(z,"secondary",J.PivotPoint.CENTER);this._modeDragZoom=new f.DragZoom(z,"tertiary");K.installHandlers("navigation",[new t.PointerDownCancelAnimation(z),new c.DoubleClickZoom(z),new r.GamepadNavigation(z),new x.KeyboardNavigation(z,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),
new w.MouseWheelZoom(z),new u.SingleKeyResetTilt(z,"p"),new q.SingleKeyResetHeading(z,"n"),new l.DragRotate(z,"primary",J.PivotPoint.EYE,["b"]),new l.DragRotate(z,"secondary",J.PivotPoint.CENTER,["b"]),new p.PinchAndPanNavigation(z,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new v.TwoFingerTilt(z)],D.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(K);this._updateMode();this.addHandles(h.watch(()=>this.view.navigation?.browserTouchPanEnabled,L=>{this._source.browserTouchPanningEnabled=
!L},h.initial))}isModifierKeyDown(z){return this._inputManager?.isModifierKeyDown(z)??!1}_updateMode(){var z=this.primaryDragAction;if(z=B.get(this.mode)?.get(z))this._modeDragPan&&(this._modeDragPan.pointerAction=z.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=z.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=z.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};
a.__decorate([k.property()],b.prototype,"view",void 0);a.__decorate([k.property({value:"pan"})],b.prototype,"primaryDragAction",null);a.__decorate([k.property({value:"default"})],b.prototype,"mode",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property()],b.prototype,"latestPointerType",null);a.__decorate([k.property()],b.prototype,"latestPointerLocation",null);a.__decorate([k.property()],b.prototype,"multiTouchActive",null);a.__decorate([k.property()],
b.prototype,"_inputManager",void 0);b=a.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],b);const B=new Map;a=new Map;k=new Map;a.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});a.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});k.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});k.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});B.set("default",a);B.set("pro",k);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,n,h,k,m){class g extends k.InputHandler{constructor(e,d){super(!0);this._view=e;this.registerIncoming("double-click",d,c=>this._handleDoubleClick(c))}_handleDoubleClick(e){const d=e.data;if(m.eventMatchesPointerAction(d,"primary")){const c=this._view.state.isGlobal?new n.ZoomStepController({view:this._view,mode:"animation"}):new h.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(c);c.zoomStep(Math.log(.5)/Math.log(.6),b.createScreenPointArray(d.x,
d.y));e.stopPropagation()}}}a.DoubleClickZoom=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){a.ZoomStepController=class extends u.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=l.create();this._tmpCamera=new G.Camera;this._tmpViewDir=l.create();this._tmpRayDir={origin:l.create(),direction:l.create()};this._targetOnSphere=l.create();this._tmpCenter=l.create();this._beginCamera=new G.Camera;this._constraintOptions=new w.ConstraintOptions(p.ConstraintTypes.ALL_EXCEPT_COLLISION,t.InteractionType.ZOOM,
null,this._beginCamera);this._sphere=r.create()}initialize(){this._intersector=A.newIntersector(this.view.state.viewingMode)}zoomStep(H,J){if(this.active){var B=this.view.state;this.animation.finished?this._beginCamera.copyFrom(B.camera):this.animation.cameraAt(1,this._beginCamera);var z=!1,K=!1;this.intersectionHelper.intersectScreen(J,this._zoomLocation,0===this.view.map.ground.opacity?v.contentIntersectorOptions:{})&&(z=0<H,K=!0);this._tmpCamera.copyFrom(B.camera);z?this.intersectionHelper.intersectRay(this._tmpCamera.ray,
this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:c.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,H,this._zoomLocation,J,K);this.begin(this._tmpCamera)}}animationSettings(){return{duration:h.Milliseconds(600),easing:C.outExpo}}_updateCamera(H,J,B,z,K){var L=f.getReferenceEllipsoid(this.view.spatialReference);
L=v.decideNavigationMode(H,z,L);var F=Math.abs(this.view.camera.position.z);c.normalize(I,H.eye);c.scale(I,I,-1);y.fromScreenAtEye(H,z,this._tmpRayDir);c.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const M=n.clamp(Math.min(v.zoomDistanceModifier,1/Math.abs(c.dot(I,this._tmpRayDir.direction)))*F,v.zoomMinDistanceModifier,v.zoomMaxDistanceModifier);if(L===v.NavigationMode.Horizontal){J=.6**J;this._sphere[3]=c.length(B);c.subtract(this._tmpViewDir,H.center,H.eye);K=Math.min(c.length(this._tmpViewDir),
M);L=K*J;1>=J&&4>L&&(L=4,J=L/K);if(1E-6>Math.abs(K-L))return;K=c.length(H.center);this._sphere[3]!==K&&(H.center=c.scale(E,H.center,(this._sphere[3]+J*(K-this._sphere[3]))/K));c.scale(this._tmpViewDir,this._tmpViewDir,-J);H.eye=c.add(E,H.center,this._tmpViewDir);x.applyAll(this.view,H,this._constraintOptions);1E-12<c.squaredDistance(B,H.center)&&D.intersectScreen(this._sphere,H,z,this._targetOnSphere)&&v.panToPosition(this._sphere,H,B,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,
!0)}else{L=.6**Math.abs(J);F=0<J?1:-1;c.subtract(this._tmpViewDir,B,H.eye);const S=c.length(this._tmpViewDir);z=this.view._stage.renderView.getMinimalDepthForArea(null,z[0],z[1],this.view.state.camera,60);z=null!=z?z:M;z=K&&0<J?Math.min(z,S):z;c.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,z);c.add(B,this._tmpRayDir.origin,this._tmpRayDir.direction);B=z*L;K=Math.max(4,1.01*H.nearFar[0]);0<J&&B<K&&(B=K,L=B/z);if(1E-6>Math.abs(z-B))return;c.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,
F*(1-L));H.eye=c.add(E,H.eye,this._tmpRayDir.direction);H.center=c.add(E,H.center,this._tmpRayDir.direction)}q.applySurfaceCollisionConstraint(this.view,H)}};a.ZoomStepController=b.__decorate([d.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const E=l.create(),I=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintOptions ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),
function(a,b,n,h,k,m,g,e,d,c){const l=[{type:k.ConstraintTypes.TILT,error:function(r,x,w){return d.getTiltConstraintError(r,x,w)*x.distance},apply:d.applyTiltConstraint},{type:k.ConstraintTypes.ALTITUDE,error:b.getAltitudeConstraintError,apply:b.applyAltitudeConstraint},{type:k.ConstraintTypes.DISTANCE,error:m.getDistanceConstraintError,apply:m.applyDistanceConstraint}],f=new h.ConstraintOptions;a.applyAll=function(r,x,w=f,p=x){p!==x&&p.copyFrom(x);p.computeUp(r.state.viewingMode);x=!1;for(let q=
0;5>q;q++){let u=0;for(var t of l)if(n.hasConstraintType(w.selection,t.type)){const v=Math.abs(t.error(r,p,w));t.apply(r,p,w)&&(x=!0,u+=v)}if(0===u)break}t=n.hasConstraintType(w.selection,k.ConstraintTypes.COLLISION);a:switch(w.interactionType){case g.InteractionType.PAN:w=e.Mode.EYE_AND_CENTER;break a;case g.InteractionType.ASCEND:w=r.state.isGlobal?e.Mode.EYE_AND_CENTER_SCALE:e.Mode.EYE_AND_CENTER;break a;default:w=e.Mode.EYE}t&&e.applySurfaceCollisionConstraint(r,p,w)&&(x=!0);x&&p.computeUp(r.state.viewingMode);
return x};a.pixelDistanceToInteractionFactor=function(r){return c.inOutCubic(Math.min(1,r/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),function(a,b,n,h,k,m,g,e,d){function c(p,
t,q=m.defaultConstraintOptions){var u=p.state.constraints.altitude;u=p.state.isGlobal&&u?q.interactionType===e.InteractionType.TUMBLE&&m.hasConstraintType(q.selection,g.ConstraintTypes.TILT)?!1:!0:!1;if(!u||!p.state.constraints.altitude)return 0;var v=p.state.constraints.altitude;u=l;u.min=v.min;u.max=v.max;v=q.interactionType;if(v!==e.InteractionType.NONE){var {min:y,max:D}=u,{interactionStartCamera:G,interactionFactor:A}=q;if(G){q=v===e.InteractionType.TUMBLE||v===e.InteractionType.ZOOM;v=c(p,G);
var C=0===v?0:p.renderCoordsHelper.getAltitude(G.eye);u.min=y;u.max=D;m.adjustRangeForInteraction(v,C,q,A,.05*C,u)}}p=p.renderCoordsHelper.getAltitude(t.eye);p=b.clamp(p,u.min,u.max)-p;return 1E-6>=Math.abs(p)?0:p}const l={min:0,max:0},f=h.create(),r=h.create(),x=h.create(),w=h.create();a.applyAltitudeConstraint=function(p,t,q=m.defaultConstraintOptions){var u=c(p,t,q);if(0===u)return!1;const v=p.renderCoordsHelper,y=v.getAltitude(t.eye)+u;var D=m.interactionDirectionTowardsConstraintMinimization;
q=q.interactionDirection;u=Math.sign(u);p.renderCoordsHelper.worldUpAtPosition(t.eye,r);n.scale(r,r,u);D=D.call(m,t,q,r,f);p=n.copy(x,t.viewForward);D=v.intersectInfiniteManifold(k.wrap(t.eye,D),y,w);t.eye=null!=D?D:v.setAltitude(w,y,t.eye);t.center=d.closestPointOnRay(w,t.eye,p,t.center);return!0};a.getAltitudeConstraintError=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec32","./ConstraintOptions",
"./ConstraintTypes"],function(a,b,n,h){n=new n.ConstraintOptions(h.ConstraintTypes.NONE);a.adjustRangeForInteraction=function(k,m,g,e,d,c){0!==k&&(g?(c.min=Math.min(c.min,m),c.max=Math.max(c.max,m)):null!=e?(c.min-=Math.max(0,(m-c.min)*(1-e)),c.max+=Math.max(0,(m-c.max)*(1-e))):d&&(c.min-=Math.max(0,m-c.min-d),c.max+=Math.max(0,m-c.max-d)))};a.defaultConstraintOptions=n;a.hasConstraintType=function(k,m){return 0!==(k&m)};a.interactionDirectionTowardsConstraintMinimization=function(k,m,g,e){m=m||k.viewForward;
b.copy(e,m);b.scale(e,e,Math.sign(b.dot(m,g)));return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintOptions":function(){define(["exports","./ConstraintTypes","./InteractionType","./TiltMode"],function(a,b,n,h){class k{constructor(m=b.ConstraintTypes.ALL,g=n.InteractionType.NONE,e=0,d=null,c=null,l=h.TiltMode.TUMBLE){this.selection=m;this.interactionType=g;this.interactionFactor=e;this.interactionStartCamera=d;this.interactionDirection=
c;this.tiltMode=l}}a.ConstraintOptions=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var b=a.ConstraintTypes||(a.ConstraintTypes={});b[b.NONE=0]="NONE";b[b.TILT=1]="TILT";b[b.ALTITUDE=2]="ALTITUDE";b[b.DISTANCE=4]="DISTANCE";b[b.COLLISION=8]="COLLISION";b[b.ALL=15]="ALL";b[b.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var b=a.InteractionType||(a.InteractionType={});b[b.NONE=0]="NONE";b[b.ZOOM=1]="ZOOM";b[b.TUMBLE=2]="TUMBLE";b[b.LOOK_AROUND=3]="LOOK_AROUND";b[b.PAN=4]="PAN";b[b.ASCEND=5]="ASCEND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var b=
a.TiltMode||(a.TiltMode={});b[b.TUMBLE=0]="TUMBLE";b[b.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/plane"],function(a,b,n,h,k){function m(d,c,l,f){const r=e;d?(l&&f&&(r.len=n.distance(c,l)),n.copy(r.dir,d)):f?(r.len=n.distance(c,
l),n.subtract(r.dir,l,c),n.scale(r.dir,r.dir,1/r.len)):(n.subtract(r.dir,l,c),n.normalize(r.dir,r.dir));return r}function g(d,c,l,f){f.clip[0]=0;f.clip[1]=l?f.len:Number.MAX_VALUE;for(l=0;l<d.length;l++){{var r=d[l],x=c;var w=f;const p=n.dot(k.getNormal(r),w.dir);r=-k.signedDistance(r,x);0>r&&0<=p?w=!1:-1E-6<p&&1E-6>p?w=0<r:!(0>r||0>p)||0>r&&0>p?(r/=p,0<p?r<w.clip[1]&&(w.clip[1]=r):r>w.clip[0]&&(w.clip[0]=r),w=w.clip[0]<=w.clip[1]):w=!0}if(!w)return!1}return!0}const e={dir:h.create(),len:0,clip:b.create()};
a.closestPointOnRay=function(d,c,l,f){f=n.dot(l,n.subtract(d,f,c));return n.add(d,c,n.scale(d,l,f))};a.frustumLineSegment=function(d,c,l,f){f=m(f,c,l,!0);return g(d,c,l,f)};a.frustumPoint=function(d,c){for(let l=0;6>l;l++)if(0<k.signedDistance(d[l],c))return!1;return!0};a.frustumRay=function(d,c,l,f){l=m(f,c,l,!1);return g(d,c,null,l)};a.frustumSphere=function(d,c,l){const f=c[0],r=c[1];c=c[2];return d[0][0]*f+d[0][1]*r+d[0][2]*c+d[0][3]>l||d[1][0]*f+d[1][1]*r+d[1][2]*c+d[1][3]>l||d[2][0]*f+d[2][1]*
r+d[2][2]*c+d[2][3]>l||d[3][0]*f+d[3][1]*r+d[3][2]*c+d[3][3]>l||d[4][0]*f+d[4][1]*r+d[4][2]*c+d[4][3]>l||d[5][0]*f+d[5][1]*r+d[5][2]*c+d[5][3]>l?!1:!0};a.planeSphere=function(d,c,l){return d[0]*c[0]+d[1]*c[1]+d[2]*c[2]+d[3]<l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,b,n,h,k,m,g){function e(p,t,q=m.defaultConstraintOptions){if(!p.state.isLocal)return 0;var u=p.state.constraints.distance;if(!p.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===u)return 0;c.min=0;c.max=u;u=c;var v=q.interactionType;if(v!==g.InteractionType.NONE){var {min:y,max:D}=u,{interactionStartCamera:G,interactionFactor:A}=q;if(G){q=v===g.InteractionType.ZOOM||v===g.InteractionType.PAN;v=e(p,G);var C=0===v?0:d(p,G);u.min=y;u.max=D;m.adjustRangeForInteraction(v,C,q,A,.05*C,
u)}}p=d(p,t);p=c.max-p;return-1E-6<=p?0:p}function d(p,t){p=p.pointsOfInterest.surfaceOrigin;return p.renderLocation?b.distance(t.eye,p.renderLocation):0}const c={min:0,max:0},l=n.create(),f=n.create(),r=n.create(),x=n.create(),w=n.create();a.applyDistanceConstraint=function(p,t,q=m.defaultConstraintOptions){var u=e(p,t,q);if(0===u)return!1;var v=p.pointsOfInterest.surfaceOrigin;if(!v.renderLocation)return!1;u=d(p,t)+u;const y=b.copy(l,t.eye);q=m.interactionDirectionTowardsConstraintMinimization(t,
q.interactionDirection,b.direction(x,t.eye,v.renderLocation),r);if(!k.intersectRay(k.fromCenterAndRadius(v.renderLocation,u),h.wrap(t.eye,q),w))return!1;t.eye=w;v=b.subtract(f,t.eye,y);t.center=b.add(w,t.center,v);v=p.renderCoordsHelper.getAltitude(t.center);p=p.renderCoordsHelper.intersectInfiniteManifold(t.ray,v,w);null!=p&&(t.center=p);return!0};a.getDistanceConstraintError=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../intersectionUtils"],function(a,b,n,h){a.Mode=void 0;(function(g){g[g.EYE=0]="EYE";g[g.EYE_AND_CENTER=1]="EYE_AND_CENTER";g[g.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const k=n.create(),m=n.create();a.applySurfaceCollisionConstraint=function(g,e,d=a.Mode.EYE){var c=g.state.constraints;if(!c.collision.enabled)return!1;var l=h.surfaceElevationBelowRenderLocation(g,e.eye);const f=g.renderCoordsHelper.getAltitude(e.eye);
c=l+c.collision.elevationMargin;if(f>=c)return!1;l=b.length(e.eye);b.subtract(k,e.center,e.eye);e.eye=g.renderCoordsHelper.setAltitude(m,c,e.eye);d===a.Mode.EYE_AND_CENTER?e.center=b.add(k,e.eye,k):d===a.Mode.EYE_AND_CENTER_SCALE&&(e.center=b.scale(k,e.center,(l-f+c)/l));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(E,I,H,J=!0){C.eyeCenterDistance=0;C.requiresTwoSteps=!1;const B=p(E,I,H,c.defaultConstraintOptions,C);if(0===B)return!1;h.fromRotation(v,-B,I.viewRight);switch(H.tiltMode){case r.TiltMode.LOOK_AROUND:m.transformMat4(u,I.viewForward,v);m.scale(u,u,C.eyeCenterDistance);I.center=m.add(y,I.eye,u);break;case r.TiltMode.TUMBLE:m.subtract(u,I.center,I.eye);m.transformMat4(u,u,v);I.eye=m.subtract(y,I.center,u);break;default:b.neverReached(H.tiltMode)}I.up=
m.transformMat4(y,I.up,v);return C.requiresTwoSteps&&J?w(E,I,H,!1):!0}function p(E,I,H,J=c.defaultConstraintOptions,B){if(!E.state.constraints.tilt)return 0;var z=E.state.constraints.tilt(I.distance,G);if(H.interactionType!==f.InteractionType.NONE){var {interactionStartCamera:K,interactionFactor:L}=H;if(K){var {min:F,max:M}=z,S=p(E,K,c.defaultConstraintOptions,H),N=0===S?0:x.viewAngle(E.renderCoordsHelper,K.center,K.eye);z.min=F;z.max=M;H.interactionType===f.InteractionType.TUMBLE?(c.hasConstraintType(H.selection,
l.ConstraintTypes.ALTITUDE)&&q(E,K,z),c.adjustRangeForInteraction(S,N,!0,L,D,z)):c.adjustRangeForInteraction(S,N,!1,L,D,z)}}J.interactionType===f.InteractionType.TUMBLE&&c.hasConstraintType(J.selection,l.ConstraintTypes.ALTITUDE)&&q(E,J.interactionStartCamera,z);if(H.tiltMode===r.TiltMode.LOOK_AROUND||J.tiltMode===r.TiltMode.LOOK_AROUND){a:{B&&(B.requiresTwoSteps=!1);switch(E.viewingMode){case "global":H=A;S=E.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;J=S+e.getReferenceEllipsoid(E.spatialReference).radius;
S=E.renderCoordsHelper.intersectManifold(I.ray,S,y);H.eyeCenterDistance=I.distance;H.centerIsOnSurface=!1;null!=S?(H.eyeCenterDistance=m.distance(I.eye,S),H.tiltAtCenter=x.viewAngle(E.renderCoordsHelper,S,I.eye),H.centerIsOnSurface=!0):E.state.isLocal?H.tiltAtCenter=x.viewAngle(E.renderCoordsHelper,I.center,I.eye):(d.closestPointOnSilhouette(d.fromRadius(d.tmpSphere,J),I.ray,y),H.eyeCenterDistance=m.distance(I.eye,y),H.tiltAtCenter=n.acosClamped(-m.dot(I.viewForward,m.normalize(y,y))));H.radius=J;
H.eyeRadius=m.length(I.eye);H.constraints=E.state.constraints;I=n.clamp(H.tiltAtCenter,z.min,z.max);if(1E-9<Math.abs(H.tiltAtCenter-I)){if(H.centerIsOnSurface){{const {constraints:P,eyeCenterDistance:R,tiltAtCenter:O}=H;I=O;E=P.clampTilt(R,O);z=t(H,E);if(P.clampTilt(z,O)!==E)for(z=0;10>z&&1E-9<Math.abs(E-I);)J=(I+E)/2,S=t(H,J),S=P.clampTilt(S,J),1E-9<Math.abs(S-J)?I=J:E=J,z++;I=E}z=I;E=n.asinClamped(H.radius/H.eyeRadius*Math.sin(H.tiltAtCenter));z=n.asinClamped(H.radius/H.eyeRadius*Math.sin(z));E=
H.eyeRadius>H.radius?E-z:z-E}else I=H.constraints.clampTilt(H.eyeCenterDistance,H.tiltAtCenter),B&&I<Math.PI/2&&(B.requiresTwoSteps=!0,I=Math.PI/2-1E-5),E=H.tiltAtCenter-Math.PI/2-(I-Math.PI/2);B&&(B.eyeCenterDistance=t(H,I));B=E}else B=0;break a;case "local":J=x.viewAngle(E.renderCoordsHelper,I.center,I.eye);H=n.clamp(J,z.min,z.max);z=J-H;1E-9<Math.abs(z)?(B&&(J=E.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,E=E.renderCoordsHelper.getAltitude(I.eye)-J,H=Math.cos(H),B.eyeCenterDistance=
1E-4<Math.abs(H)?E/H:I.distance),B=z):B=0;break a}B=void 0}return B}B=x.viewAngle(E.renderCoordsHelper,I.center,I.eye);H=n.clamp(B,z.min,z.max);B-=H;B=1E-9<Math.abs(B)?B:0;return B}function t(E,I){if(!E.centerIsOnSurface)return E.eyeCenterDistance;I=Math.PI-n.clamp(I,0,Math.PI);const H=n.asinClamped(E.radius/E.eyeRadius*Math.sin(I)),J=Math.sin(Math.PI-I-H)/Math.sin(I);return E.eyeRadius<E.radius&&1<J?Math.sin(Math.PI-I-(Math.PI-H))/Math.sin(I)*E.eyeRadius:J*E.eyeRadius}function q(E,I,H){var J=E.state.constraints;
if(!E.state.isLocal&&J.altitude&&I){var B=m.squaredLength(I.center),z=Math.sqrt(B);I=I.distance;var K=e.getReferenceEllipsoid(E.spatialReference).radius;E=J.altitude.min+K;J=J.altitude.max+K;E=(E*E-I*I-B)/(-2*z*I);H.min=Math.max(H.min,Math.min(Math.PI-n.acosClamped((J*J-I*I-B)/(-2*z*I)),H.max));H.max=Math.min(H.max,Math.PI-n.acosClamped(E))}}const u=g.create(),v=k.create(),y=g.create(),D=n.deg2rad(5),G={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,
tiltAtCenter:0},C={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=w;a.getTiltConstraintError=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,h){const k=h.create(),m=h.create();a.viewAngle=function(g,e,d){g.worldUpAtPosition(e,k);n.subtract(m,d,e);g=n.length(m);return 0===g?
0:b.acosClamped(n.dot(m,k)/g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(P){const R=2*(P-Math.sqrt((P-1)*P)),O=R/2/P;return T=>T<O?P*T*T:R*T-R+1}function n(P,R){return(O,T)=>O<R?R*P(O/R,T):1-P((1-O)/(1-R),T)*(1-R)}const h=P=>P,k=P=>P*P,m=P=>1-k(1-P),g=P=>.5>P?k(2*P)/2:(1-k(1-2*(P-.5))+1)/2,e=P=>P*P*P,d=P=>1-e(1-P),c=P=>.5>P?e(2*P)/2:(1-e(1-2*(P-.5))+1)/2,l=P=>P*P*P*P,f=P=>1-l(1-P),r=P=>.5>P?l(2*
P)/2:(1-l(1-2*(P-.5))+1)/2,x=P=>P*P*P*P*P,w=P=>1-x(1-P),p=P=>.5>P?x(2*P)/2:(1-x(1-2*(P-.5))+1)/2,t=P=>-Math.cos(P*Math.PI/2)+1,q=P=>1-t(1-P),u=P=>.5>P?t(2*P)/2:(1-t(1-2*(P-.5))+1)/2,v=P=>2**(10*(P-1)),y=P=>1-2**(10*(1-P-1)),D=P=>.5>P?2**(10*(2*P-1))/2:(1-2**(10*(1-2*(P-.5)-1))+1)/2,G=P=>-(Math.sqrt(1-P*P)-1),A=P=>1-G(1-P),C=P=>.5>P?G(2*P)/2:(1-G(1-2*(P-.5))+1)/2,E=n(b(1),1),I=n(b(1),0),H=n(b(1),.5),J=n(b(2),1),B=n(b(2),0),z=n(b(2),.5),K=n(b(3),1),L=n(b(3),0),F=n(b(3),.5),M=n(b(4),1),S=n(b(4),0),N=
n(b(4),.5);a.EasingFunctions={linear:h,"in-quad":k,"out-quad":m,"in-out-quad":g,"in-coast-quad":E,"out-coast-quad":I,"in-out-coast-quad":H,"in-cubic":e,"out-cubic":d,"in-out-cubic":c,"in-coast-cubic":J,"out-coast-cubic":B,"in-out-coast-cubic":z,"in-quart":l,"out-quart":f,"in-out-quart":r,"in-coast-quart":K,"out-coast-quart":L,"in-out-coast-quart":F,"in-quint":x,"out-quint":w,"in-out-quint":p,"in-coast-quint":M,"out-coast-quint":S,"in-out-coast-quint":N,"in-sine":t,"out-sine":q,"in-out-sine":u,"in-expo":v,
"out-expo":y,"in-out-expo":D,"in-circ":G,"out-circ":A,"in-out-circ":C};a.inCirc=G;a.inCoastCubic=J;a.inCoastQuad=E;a.inCoastQuart=K;a.inCoastQuint=M;a.inCubic=e;a.inExpo=v;a.inOutCirc=C;a.inOutCoastCubic=z;a.inOutCoastQuad=H;a.inOutCoastQuart=F;a.inOutCoastQuint=N;a.inOutCubic=c;a.inOutExpo=D;a.inOutQuad=g;a.inOutQuart=r;a.inOutQuint=p;a.inOutSine=u;a.inQuad=k;a.inQuart=l;a.inQuint=x;a.inSine=t;a.linear=h;a.outCirc=A;a.outCoastCubic=B;a.outCoastQuad=I;a.outCoastQuart=L;a.outCoastQuint=S;a.outCubic=
d;a.outExpo=y;a.outQuad=m;a.outQuart=f;a.outQuint=w;a.outSine=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){a.PointToPointAnimationController=class extends l.AnimationController{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(t){super(t);this.mode="interaction";this._hasTarget=!1}initialize(){this.animation=new c.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new d}get isInteractive(){return"interaction"===this.mode}begin(t,q){this._hasTarget=!0;q=this.animationSettings(q);w.copyFrom(this.view.state.camera);
const u=r.newIntersector(this.view.state.viewingMode);this.intersectionHelper.intersectRay(w.ray,u,p)&&(w.center=p);this.animation.update(w,t,q);this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time;super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(t,q){this._hasTarget&&this.animation.step(t,q)}onControllerEnd(t){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,t),this.animation.currentTime=
this.animation.time);super.onControllerEnd(t)}animationSettings(t={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...t,easing:"string"===typeof t.easing?x.EasingFunctions[t.easing]:t.easing}}};b.__decorate([n.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);b.__decorate([n.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=
b.__decorate([g.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const w=new f.Camera,p=e.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../core/time ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,
b,n,h,k,m,g){class e{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(c){this.currentTime=b.Milliseconds(0);this._animation=new g.Animation(()=>new k.Camera(c));this._current=new k.Camera(c)}update(c,l,f){const {source:r,target:x}=this._animation.definition,w=n.subtract(d,l.center,c.center),p=n.length(w);1E-5<=p?(w[0]/=p,w[1]/=p,w[2]/=p):(w[0]=0,w[1]=1,w[0]=0);n.copy(r.direction,w);n.copy(x.direction,w);r.copyFromRenderCamera(c);x.copyFromRenderCamera(l);
this._current.copyFrom(r);this._animation.update(r,x,f);this.currentTime=b.Milliseconds(0);c.almostEquals(l)&&(this.currentTime=this._animation.time)}cameraAt(c,l){this._animation.cameraAt(c,this._current);l=l||new m.Camera;this._current.copyToRenderCamera(l);return l}step(c,l){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.millisecondsFromSeconds(c)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,l)}}const d=h.create();
a.Animation=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,n,h,k,m,g,e){class d{constructor(v){this.viewingMode=v;this.center=m.create();this.distance=
this.yaw=this.pitch=0;this.direction=m.clone(t);this.fov=55;this.size=1}pixelsPerPanAtZoom(v){return this.size/2/(this._zoomToPanScale*v)}zoomAtPixelsPerPan(v){return this.size/2/(this._zoomToPanScale*v)}pixelsPerRotateAtZoom(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)}compareTo(v,y){y||={pan:0,rotate:0,sourceZoom:0,targetZoom:0};if(this.viewingMode===g.ViewingMode.Global){var D=k.length(this.center);const G=k.length(v.center);D=(D+G)/2;y.pan=e.angle(this.center,v.center)*D}else y.pan=
k.distance(this.center,v.center);D=Math.abs(v.yaw-this.yaw);D>=Math.PI&&(D=2*Math.PI-D);y.rotate=Math.max(D,Math.abs(v.pitch-this.pitch));y.sourceZoom=this.distance;y.targetZoom=v.distance;return y}interpolate(v,y,D){this.viewingMode===g.ViewingMode.Global?e.slerp(v.center,y.center,D.pan,this.center):k.lerp(this.center,v.center,y.center,D.pan);this.distance=isFinite(y.distance)?b.lerp(v.distance,y.distance,D.zoom):v.distance;this.pitch=b.lerp(v.pitch,y.pitch,D.rotate);v=v.yaw;y=y.yaw;Math.abs(y-v)>=
Math.PI&&(v+=2*(v<y?1:-1)*Math.PI);this.yaw=b.lerp(v,y,D.rotate)}copyFrom(v){k.copy(this.center,v.center);this.pitch=v.pitch;this.yaw=v.yaw;this.distance=v.distance;k.copy(this.direction,v.direction);this.size=v.size;this.copyFromCommon(v);this.viewingMode=v.viewingMode}copyFromRenderCamera(v){var y=this._lookAtOrientation(v.center,u);k.copy(this.center,v.center);k.subtract(r,v.center,v.eye);k.transformMat3(r,r,y);k.transformMat3(x,v.up,y);this.distance=k.length(r);0!==this.distance&&(r[0]/=this.distance,
r[1]/=this.distance,r[2]/=this.distance);this.pitch=this._eyeUpToPitch(r);y=r;const D=w;.5>Math.abs(x[2])?(k.copy(D,x),0<y[2]&&k.scale(D,D,-1)):k.copy(D,y);k.cross(l,D,p);k.normalize(l,l);this.yaw=e.angle(q,l,p);this.size=Math.sqrt(v.width*v.width+v.height*v.height);this.copyFromCommon(v)}copyFromCommon(v){this.fov=v.fov;this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(v){const y=this._lookAtOrientation(this.center,u);n.transpose(y,y);this._axisAngleVec3(q,this.pitch-Math.PI/2,t,r);
this._axisAngleVec3(p,this.yaw,r,r);this._axisAngleVec3(q,this.pitch-Math.PI/2,p,x);this._axisAngleVec3(p,this.yaw,x,x);k.scale(r,r,this.distance);k.transformMat3(r,r,y);k.transformMat3(x,x,y);v.center=this.center;v.eye=k.subtract(r,this.center,r);v.up=x}_axisAngleVec3(v,y,D,G){const A=Math.cos(y);y=Math.sin(y);k.scale(c,D,A);k.cross(l,v,D);k.scale(l,l,y);k.scale(f,v,(1-A)*k.dot(v,D));return k.add(G,k.add(G,c,l),f)}_lookAtOrientation(v,y=h.create()){this._upAtLookAt(v,f);k.cross(c,this.direction,
f);k.normalize(c,c);0===c[0]&&0===c[1]&&0===c[2]&&k.copy(c,q);k.cross(l,f,c);k.normalize(l,l);y[0]=c[0];y[1]=l[0];y[2]=f[0];y[3]=c[1];y[4]=l[1];y[5]=f[1];y[6]=c[2];y[7]=l[2];y[8]=f[2];return y}_upAtLookAt(v,y){return this.viewingMode===g.ViewingMode.Local?k.copy(y,p):k.normalize(y,v)}_eyeUpToPitch(v){return Math.PI-e.angle(p,v)}}const c=m.create(),l=m.create(),f=m.create(),r=m.create(),x=m.create(),w=m.create(),p=m.UNIT_Z,t=m.UNIT_Y,q=m.UNIT_X,u=h.create();a.Camera=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,b,n,h,k,m){const g={zoom:0,pan:0,rotate:0};a.Animation=class{get time(){return this._time}constructor(e){this._createCamera=e;this._time=b.Milliseconds(0);this.definition=new h.Definition(e);this.path=new m.Path}update(e,d,c){this.definition.update(e,d,c);this.path.update(this.definition,c);this._time=this._applyTimeSettings(b.millisecondsFromSeconds(isFinite(this.path.time)?
this.path.time:b.Seconds(0)),c);this._easing=c.easing??(1E3<=this._time?n.inOutCoastQuad:n.outExpo)}cameraAt(e,d){d=d||this._createCamera();e=Math.min(Math.max(0,e),1);e=this._normalizedEasing(e);e=this.path.interpolateComponentsAt(e,g);d.interpolate(this.definition.source,this.definition.target,e);return d}_normalizedEasing(e){const d=this._easing(0,this._time),c=this._easing(1,this._time);return(this._easing(e,this._time)-d)/(c-d)}_applyTimeSettings(e,d){const c=null!=d.speedFactor?d.speedFactor:
1;null!=d.duration?e=d.duration:null!=d.speedFactor&&(e=b.Milliseconds(e/c));return b.Milliseconds(Math.min(Math.max(null!=d.minDuration?d.minDuration:k.defaultSettings.minDuration/c,e),null!=d.maxDuration?d.maxDuration:k.defaultSettings.maxDuration/c))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","./Settings"],function(a,b){class n{constructor(h){this._createCamera=h;this.compared={sourceZoom:0,targetZoom:0,
pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=h();this.target=h()}clone(){const h=new n(this._createCamera);h.copyFrom(this);return h}copyFrom(h){this.update(h.source,h.target,h.settings)}update(h,k,m){this.source!==h&&this.source.copyFrom(h);this.target!==k&&this.target.copyFrom(k);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=m.desiredScreenFlow?m.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;
this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(h){h=this.target.pixelsPerPanAtZoom(h);return this.halfWindowSize/h}get hasZoom(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}get hasPan(){return 1E-9<this.compared.pan}get hasRotate(){return 1E-9<this.compared.rotate}}a.Definition=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports",
"../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define(["exports","../../easing","../Path","../Segment","./planning"],function(a,b,n,h,k){class m extends n.Path{constructor(g,e){super();this._preallocSegments=[new h.Segment,new h.Segment,new h.Segment];this._descensionSegment=this._ascensionSegment=
null;this.update(g,e)}update(g,e){if(g){this.definition?this.definition.copyFrom(g):this.definition=g.clone();var d=null;e?.apex&&(d=k.optimalDistance(g,e.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,e?.apex)}}segmentInterpolateComponentsAt(g,e,d){d=g.interpolateComponentsAt(e,d);g===this._ascensionSegment?d.zoom=b.outQuad(d.zoom):g===this._descensionSegment&&(d.zoom=b.inQuad(d.zoom));return d}_updateWithApex(g,
e){const [d,c,l]=this._preallocSegments,f=e?.ascensionFactor??.5;e=Math.min(1-f,null!=e?.ascensionFactor&&null!=e.descensionFactor?e.descensionFactor:.5);const r=1-f-e;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.targetZoom=g;d.definition.compared.pan=this.definition.compared.pan*f;d.definition.compared.rotate=this.definition.compared.rotate*f;d.update();this._ascensionSegment=d;this.segments.push(d);0<r&&(c.definition?c.definition.copyFrom(this.definition):
c.definition=this.definition.clone(),c.definition.copyFrom(this.definition),c.definition.compared.sourceZoom=g,c.definition.compared.targetZoom=g,c.definition.compared.pan=this.definition.compared.pan*r,c.definition.compared.rotate=this.definition.compared.rotate*r,c.update(),this.segments.push(c));l.definition?l.definition.copyFrom(this.definition):l.definition=this.definition.clone();l.definition.compared.sourceZoom=g;l.definition.compared.pan=this.definition.compared.pan*e;l.definition.compared.rotate=
this.definition.compared.rotate*e;l.update();this._descensionSegment=l;this.segments.push(l)}_updateWithoutApex(){const [g]=this._preallocSegments;g.update(this.definition);this.segments.push(g)}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../core/time"],function(a,b){a.Path=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((n,h)=>b.Seconds(n+h.time),b.Seconds(0))}interpolateComponentsAt(n,
h){n=Math.min(Math.max(n,0),1);n*=this.time;let k=0,m=0;const g=this.definition;for(let e=0;e<this.segments.length;e++){const d=this.segments[e],c=d.definition;if(n<=d.time||e===this.segments.length-1)return h=this.segmentInterpolateComponentsAt(d,0===d.time?0:n/d.time,h),g.hasPan&&!isNaN(h.pan)&&isFinite(g.compared.pan)?h.pan=(k+c.compared.pan*h.pan)/g.compared.pan:h.pan=1,g.hasRotate&&!isNaN(h.rotate)&&isFinite(g.compared.rotate)?h.rotate=(m+c.compared.rotate*h.rotate)/g.compared.rotate:h.rotate=
1,g.hasZoom&&!isNaN(h.zoom)&&isFinite(c.compared.targetZoom)?(n=this.segments[0].definition.compared.sourceZoom,h.zoom=(h.zoom*(c.compared.targetZoom-c.compared.sourceZoom)+c.compared.sourceZoom-n)/(this.segments[this.segments.length-1].definition.compared.targetZoom-n)):h.zoom=1,h;n-=d.time;k+=c.compared.pan;m+=c.compared.rotate}}segmentInterpolateComponentsAt(n,h,k){return n.interpolateComponentsAt(h,k)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports",
"../../../core/time"],function(a,b){class n{get time(){return this._time}constructor(h){h&&this.update(h)}update(h){h&&(this.definition?this.definition.copyFrom(h):this.definition=h.clone());this._updatePrecomputedVariables();this._updatePixelFlow()}_updatePrecomputedVariables(){var h=this.definition;const k=h.compared,m=k.sourceZoom,g=k.targetZoom;this._zoomSign=m>g?1:-1;this._panPixelsAtSource=k.pan*h.source.pixelsPerPanAtZoom(m);h=(h.source.pixelsPerRotateAtZoom(m)+h.target.pixelsPerRotateAtZoom(g))/
2;this._rotatePixels=k.rotate*h}_updatePixelFlow(){var h=this.definition.compared.sourceZoom,k=this.definition.compared.targetZoom;const {hasZoom:m,hasPan:g,hasRotate:e}=this.definition;var d=0,c=0;m&&(g&&(d=(k/h-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(c=Math.log(h/k)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;h=this.definition.desiredPixelFlow;m&&g&&
e?(k=d+c+d*c,this._zoomPixelFlow=d*c/k*h,this._panPixelFlow=c/k*h,this._rotatePixelFlow=d/k*h):m&&g?(c=1+d,this._zoomPixelFlow=d/c*h,this._panPixelFlow=1/c*h):m&&e?(d=1+c,this._zoomPixelFlow=c/d*h,this._rotatePixelFlow=1/d*h):g&&e?(d=this._panPixelsAtSource/this._rotatePixels,c=1+d,this._panPixelFlow=d/c*h,this._rotatePixelFlow=1/c*h):g?this._panPixelFlow=h:m?this._zoomPixelFlow=h:e&&(this._rotatePixelFlow=h);this._time=e?this.rotateTime:m?this.zoomTime:g?this.panTime:b.Seconds(0)}get rotateTime(){return this.definition.hasRotate?
b.Seconds(this._rotatePixels/this._rotatePixelFlow):b.Seconds(0)}get zoomTime(){return this.definition.hasZoom?b.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):b.Seconds(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const h=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return b.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*
h+1)/(h*this._zoomPixelFlow))}return b.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return b.Seconds(0)}_interpolateComponentsZoom(h){if(0===h||1===h)return h;if(this.definition.hasZoom){const k=this.definition.compared.sourceZoom,m=this.definition.compared.targetZoom;return(k*(k/m)**-h-k)/(m-k)}return h}_interpolateComponentsPan(h){if(0===h||1===h)return h;if(this.definition.hasPan&&this.definition.hasZoom){const k=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/
this._panPixelsAtSource*this._panPixelFlow*(2**(k*h*this._time)-1)/(k*Math.LN2)}return h}_interpolateComponentsRotate(h){return h}interpolateComponentsAt(h,k){h=Math.min(Math.max(h,0),1);const m=this._interpolateComponentsZoom(h),g=this._interpolateComponentsPan(h);h=this._interpolateComponentsRotate(h);k?(k.zoom=m,k.pan=g,k.rotate=h):k={zoom:m,pan:g,rotate:h};return k}}a.Segment=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports",
"./functions"],function(a,b){function n(h,k){const m=Math.max(h.compared.sourceZoom,h.compared.targetZoom);h=h.source.zoomAtPixelsPerPan(h.desiredPixelFlow/h.compared.pan)/2;return h<m?null!=k.maximumDistance?m+(k.maximumDistance-m)/2:1.5*m:k.maximumDistance?Math.min(k.maximumDistance,h):h}a.optimalDistance=function(h,k){let m=n(h,k);const g={ascensionFactor:null!=k.ascensionFactor?k.ascensionFactor:.5,descensionFactor:null!=k.descensionFactor?k.descensionFactor:.5};var e=0===g.ascensionFactor,d=
0===g.descensionFactor;const c=e?b.tAscensionZoomOnly:b.tAscensionZoomPan,l=e?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,f=e?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,r=d?b.tDescensionZoomOnly:b.tDescensionZoomPan,x=d?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,w=d?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;e=D=>c(h,D,g)+b.tPanion(h,D,g)+r(h,D,g);d=D=>l(h,D,g)+b.dtPanion(h,D,g)+x(h,D,g);const p=D=>f(h,D,g)+b.ddtPanion(h,D,g)+w(h,D,g);let t=e(m);const q=b.tBaseLine(h),u=k.maximumIterations||
20,v=null!=k.maximumDistance?k.maximumDistance:Infinity;for(k=0;k<u;k++){var y=(d(m)+1E-6)/p(m);if(isNaN(y)||m>=v&&0>y){if(!isFinite(v))return null;m=v;t=e(m);break}m-=y;if(m<h.compared.sourceZoom||m<h.compared.targetZoom)return null;y=e(m);if(.005>=Math.abs(y-t)/t)break;t=y}return t>.7*q||m<h.compared.sourceZoom||m<h.compared.targetZoom?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=
function(b,n){return-b.halfWindowSize/(n*n*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,n,h){const k=n-b.compared.sourceZoom,m=1/k,g=1/n,e=Math.log(b.compared.sourceZoom*g);h=(h.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(k))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*g*h+2*m*e+2*g-2*e*h/(k*k)-h/(n*n))/(b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomOnly=function(b,n){return-b.halfWindowSize/(n*n*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=
function(b,n,h){const k=n-b.compared.targetZoom,m=1/k,g=1/n,e=Math.log(n/b.compared.targetZoom);h=(b.halfWindowPanAtZoom(n)+h.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*m*(-2*m*g*h-2*m*e+2*g+2*e*h/(k*k)-h/(n*n))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,n,h){return-2*b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(n*n*n))};a.dtAscensionZoomOnly=
function(b,n){return b.halfWindowSize/(n*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,n,h){const k=1/n,m=Math.log(b.compared.sourceZoom*k),g=1/b.desiredPixelFlow,e=1/Math.LN2;n-=b.compared.sourceZoom;const d=1/n;h=(h.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(n))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*k*g*e*d*h-b.halfWindowSize*m*g*e*d+b.halfWindowSize*m*g*e*h/(n*n)};a.dtDescensionZoomOnly=function(b,n){return b.halfWindowSize/(n*b.desiredPixelFlow*Math.LN2)};
a.dtDescensionZoomPan=function(b,n,h){const k=Math.log(n/b.compared.targetZoom),m=1/b.desiredPixelFlow,g=1/Math.LN2,e=-n+b.compared.targetZoom,d=1/e;h=(-b.halfWindowPanAtZoom(n)-h.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*k*m*g*d+b.halfWindowSize*k*m*g*h/(e*e)+b.halfWindowSize*m*g*d*h/n};a.dtPanion=function(b,n,h){return b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(n*n))};a.tAscensionZoomOnly=function(b,n){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/n)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,n,h){const k=b.halfWindowPanAtZoom(n-b.compared.sourceZoom);return-b.halfWindowSize*(h.ascensionFactor*Math.LN2*b.compared.pan+k)*Math.log(b.compared.sourceZoom/n)/(b.desiredPixelFlow*Math.LN2*k)};a.tBaseLine=function(b){const n=Math.LN2*b.compared.pan,h=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),
k=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*h);return b.compared.sourceZoom<=b.compared.targetZoom?k*(n-h):k*(n+h)};a.tDescensionZoomOnly=function(b,n){return b.halfWindowSize*Math.log(n/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,n,h){return b.halfWindowSize*(-b.halfWindowPanAtZoom(n)-h.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(n/b.compared.targetZoom)/
(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-n+b.compared.targetZoom))};a.tPanion=function(b,n,h){return-b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(n))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.AnimationController=class extends l.CameraController{constructor(){super(...arguments);this._asyncResult=null}get canStop(){return!0}set asyncResult(f){this._asyncResult&&(this._asyncResult.reject(h.createAbortError()),this._asyncResult=null);this.state===l.State.Finished||this.state===l.State.Stopped?(n.assertIsSome(f),this.state===l.State.Finished?f.resolve():f.reject(h.createAbortError())):this._asyncResult=f}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=
l.State.Running;null!=this.viewAnimation&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){null==this.viewAnimation||this.state!==l.State.Ready&&this.state!==l.State.Running||(this.viewAnimation.state===c.State.FINISHED?this.finish():this.viewAnimation.state===c.State.STOPPED&&(this.state=l.State.Stopped))}onControllerEnd(){null==this.viewAnimation||this.viewAnimation.done||(this.state===l.State.Finished?this.viewAnimation.finish():
this.state===l.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(h.createAbortError()))}finish(){this.finishController()}};a.AnimationController=b.__decorate([d.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){a.State=void 0;(function(d){d[d.Ready=0]="Ready";d[d.Rejected=1]="Rejected";d[d.Running=2]="Running";d[d.Stopped=3]="Stopped";d[d.Finished=4]="Finished"})(a.State||(a.State={}));a.CameraController=class extends n{constructor(d){super(d);this.state=a.State.Ready}get active(){return this.state===a.State.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return this.canStop?(this.state=a.State.Stopped,!0):!1}finishController(){this.state=a.State.Finished}get steppingFinished(){return!1}};
b.__decorate([h.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);b.__decorate([h.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([h.property()],a.CameraController.prototype,"state",void 0);b.__decorate([h.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=b.__decorate([e.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(ma,wa,Ba){Ba=k.fromRotation(p.sm4d.get(),Ba[3],l.axis(Ba));null==Ba||k.exactEquals(Ba,m.IDENTITY)||(d.subtract(Z,ma.eye,wa),d.transformMat4(Z,Z,Ba),ma.eye=d.add(Z,Z,wa),d.subtract(Z,ma.center,wa),d.transformMat4(Z,Z,Ba),ma.center=d.add(Z,Z,wa),ma.up=d.transformMat4(Z,ma.up,Ba))}function D(ma,wa,Ba,pa){return Math.sin(ma/d.length(wa))*(Ba+pa.radius)}function G(ma,wa,Ba,pa){Ba=t.fromScreenAtEye(wa,Ba,va);if(null==Ba)return!1;x.closestPointOnSilhouette(ma,
Ba,P);return x.intersectRay(ma,Ba,pa)?d.squaredDistance(P,Ba.origin)<d.squaredDistance(pa,Ba.origin)?(d.copy(pa,P),!1):!0:(d.subtract(R,wa.eye,wa.center),d.normalize(R,R),r.fromNormalAndOffset(R,-d.dot(d.normalize(R,R),P),O),r.intersectRay(O,Ba,pa),!1)}function A(ma,wa,Ba,pa,Aa,ra){var ua=0;d.cross(qa,ma,wa);d.subtract(ja,ma,wa);d.length(ma)<=Aa||!pa.aboveGround?(d.cross(Ba,ja,pa.eye),ua=d.dot(ma,wa)/(d.length(ma)*d.length(wa)),.9999>ua?ua=n.acosClamped(ua):(ma=d.length(d.cross(c.create(),ma,wa))/
(d.length(ma)*d.length(wa)),ua=n.asinClamped(ma)),ra=Math.cos(n.clamp(b.cyclicalPI.normalize(n.deg2rad(ra)),0,S)),ua=-ua-Math.max(0,d.length(wa)-Aa)/(ra*Aa)):(d.subtract(T,pa.eye,pa.center),d.cross(Ba,ja,T),ua=-d.length(ja)/Aa);d.normalize(Ba,Ba);d.scale(Ba,Ba,d.length(qa));return ua}function C(ma,wa,Ba,pa){pa=Math.cos(n.clamp(b.cyclicalPI.normalize(n.deg2rad(pa)),0,S));wa=wa>Ba?-(wa-Ba)/(pa*Ba):wa<-Ba?Math.PI-(wa+Ba)/(pa*Ba):n.acosClamped(wa/Ba);return((ma>Ba?-(ma-Ba)/(pa*Ba):ma<-Ba?Math.PI-(ma+
Ba)/(pa*Ba):n.acosClamped(ma/Ba))-wa)*Ba}function E(ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma){Ea=C(ma[2],wa[2],ra[3],Ea);wa=Ka?C(ma[0],wa[0],ra[3],180):wa[0]-ma[0];ma=Math.sin(ua)*wa-Math.cos(ua)*Ea;ua=Math.cos(ua)*wa+Math.sin(ua)*Ea;d.normalize(Z,Aa);Aa=Ka?ma/Math.sqrt(Math.abs(ra[3]**2-d.dot(Ba,Z)**2)):ma/ra[3];Ba=ua/Math.sqrt(Math.abs(ra[3]**2-d.dot(Ba,pa)**2));g.set(Ma,Aa,Ba)}function I(ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma){d.cross(qa,ma,wa);f.coordinateSystemFromOneAxisAndNormalVector(ra.up,ra.eye,W,ca,X);f.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],ra.eye,Q,V,U);d.copy(Ba,V);d.copy(pa,Q);d.normalize(Ba,Ba);d.scale(Ba,Ba,d.length(qa));f.vectorCoordinates(ma,d.normalize(ca,ca),d.normalize(X,X),d.normalize(W,W),ba);f.vectorCoordinates(wa,ca,X,W,ia);E(ba,ia,ma,Q,V,ua,Ea,Ka,Ma,Aa)}function H(ma,wa,Ba,pa,Aa,ra,ua){k.fromRotation(aa,Aa,pa);k.fromRotation(ea,ua,ra);k.multiply(ha,aa,ea);d.subtract(wa,ma,Ba);d.transformMat4(wa,wa,ha);d.add(wa,wa,Ba)}function J(ma,wa,Ba,pa,Aa,ra){k.fromRotation(aa,pa,Ba);k.fromRotation(ea,ra,Aa);k.multiply(ha,aa,
ea);d.subtract(Z,ma.eye,wa);d.transformMat4(Z,Z,ha);ma.eye=d.add(Z,Z,wa);d.subtract(Z,ma.center,wa);d.transformMat4(Z,Z,ha);ma.center=d.add(Z,Z,wa);d.subtract(Z,ma.up,wa);d.transformMat4(Z,Z,ha);ma.up=d.add(Z,Z,wa)}function B(ma,wa,Ba,pa,Aa,ra){return(Math.abs(pa)>Math.PI-M.Angle||Math.abs(pa)<M.Angle)&&(Math.abs(ma[2])<Ba*M.Pole||Math.abs(wa)>Ba)&&ra.aboveGround&&Aa<M.Tilt}function z(ma,wa,Ba,pa,Aa,ra){ra?(l.fromPoints(Ba,pa,da),y(wa,x.getCenter(ma),da)):(Ba=A(Ba,pa,ta,wa,ma[3],Aa),y(wa,x.getCenter(ma),
l.wrapAxisAngle(ta,Ba)))}function K(ma,wa,Ba,pa,Aa,ra,ua){const Ea=ua?20:1;d.copy(Y,pa);oa.copyFrom(wa);let Ka;for(let Ma=0;Ma<Ea&&1E-12<d.squaredDistance(Ba,Y);Ma++)if(pa=d.squaredDistance(Ba,Y),I(Ba,Y,V,Q,fa,oa,ma,Aa,ra,ua),J(oa,x.getCenter(ma),Q,fa[1],V,fa[0]),H(Y,Y,x.getCenter(ma),Q,fa[1],V,fa[0]),Ka=d.squaredDistance(Ba,Y),Ka<pa||0===Ma)wa.copyFrom(oa);else break}a.SpherePickPointFallback=void 0;(function(ma){ma[ma.Ellipsoid=0]="Ellipsoid";ma[ma.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));v={exclude:new Set([v.terrainId])};const L=h.createScreenPointArray();a.NavigationMode=void 0;(function(ma){ma[ma.Vertical=0]="Vertical";ma[ma.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const F={Elevation:3E4,Angle:n.deg2rad(16)},M={Pole:.95,Angle:n.deg2rad(18),Tilt:45},S=n.deg2rad(80),N=c.create(),P=c.create(),R=c.create(),O=r.create(),T=c.create(),Q=c.create(),V=c.create(),U=c.create(),W=c.create(),ca=c.create(),X=c.create(),ba=c.create(),
ia=c.create(),fa=e.create(),da=l.create(),aa=m.create(),ea=m.create(),ha=m.create(),Y=c.create(),Z=c.create(),ja=c.create(),oa=new u.Camera,qa=c.create(),ta=c.create(),va={origin:c.create(),direction:c.create()},Ca={origin:c.create(),direction:c.create()};a.PreservingHeadingThreshold=M;a.TiltThresholdPanningSpeed=S;a.VerticalPanTresholds=F;a.applyPanPlanar=function(ma,wa,Ba){d.subtract(N,Ba,wa);ma.eye=d.subtract(Z,ma.eye,N);ma.center=d.subtract(Z,ma.center,N)};a.applyPanSphericalDirectRotation=z;
a.applyPanSphericalPreserveHeading=K;a.applyRotation=y;a.applyRotationWithTwoAxes=J;a.applyZoomOnSphere=function(ma,wa,Ba){wa.getScreenCenter(L);q.intersectScreen(ma,wa,L,Z)&&(wa.center=Z);ma=wa.distance;Ba*=ma;1E-6>Math.abs(ma-Ba)||(Ba=d.scale(p.sv3d.get(),wa.viewForward,Ba),wa.eye=d.subtract(Z,wa.center,Ba))};a.applyZoomToPoint=function(ma,wa,Ba,pa){const Aa=p.sv3d.get();Ba=1-Ba;d.subtract(Aa,wa,ma.eye);const ra=d.length(Aa);let ua=ra*(1-Ba);0<=Ba&&ua<pa&&(ua=pa,Ba=-(ua-ra)/ra);1E-6>Math.abs(ra-
ua)||(d.scale(Aa,Aa,Ba),ma.eye=d.add(Z,ma.eye,Aa),ma.center=d.lerp(Z,ma.center,wa,Ba))};a.centroid=function(ma,wa){d.set(wa,0,0,0);for(const Ba of ma)d.add(wa,wa,Ba);d.scale(wa,wa,1/ma.length)};a.contentIntersectorOptions=v;a.decideNavigationMode=function(ma,wa,Ba){if(d.length(ma.eye)-Ba.radius>F.Elevation)return a.NavigationMode.Horizontal;t.fromScreenAtEye(ma,wa,Ca);return-Math.sign(ma.relativeElevation)*(.5*Math.PI+w.angle(ma.eye,Ca.direction))<F.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};
a.distanceClampValues=[1,3E8];a.intersectPlaneFromScreenPoint=function(ma,wa,Ba,pa){return r.intersectRay(ma,t.fromScreen(wa,Ba,va),pa)};a.intersectPlaneFromScreenPointAtEye=function(ma,wa,Ba,pa){return r.intersectRay(ma,t.fromScreenAtEye(wa,Ba,va),pa)};a.lengthFromPoints=C;a.minHeightLimit=50;a.normalizeCoordinate=function(ma,wa,Ba){Ba[0]=wa[0]/(ma.fullWidth/ma.pixelRatio);Ba[1]=wa[1]/(ma.fullHeight/ma.pixelRatio);return Ba};a.normalizeRotationDelta=function(ma){for(;ma>Math.PI;)ma-=2*Math.PI;for(;ma<
-Math.PI;)ma+=2*Math.PI;return ma};a.offSurfaceTiltToEyeTiltGlobal=function(ma,wa,Ba,pa){return D(Math.PI/2,wa,Ba,pa)+(ma-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=D;a.panDistanceModifier=5;a.panMotionToRotationMatrix=function(ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka){if(B(ma.center,d.dot(ma.up,ma.center),d.length(ma.center),-b.cyclicalPI.normalize(n.deg2rad(ra)),ua,wa))switch(ma=-b.cyclicalPI.normalize(n.deg2rad(Aa)),{eye:Aa}=wa,f.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Aa,Q,V,U),Aa=Ba.translation[0]*
pa.pan,ra="zoom"===Ka.mode?0:Ba.translation[1]*pa.pan,wa=Math.max(Math.sqrt(Math.abs(1-d.dot(wa.center,Q)**2/d.length(wa.center)**2)),.5),ua=-Math.cos(ma)*ra+Math.sin(ma)*Aa,k.rotate(Ea.pan.matrix,Ea.pan.matrix,(Math.sin(ma)*ra+Math.cos(ma)*Aa)/wa,Q),Ea.pan.enabled=!0,Ka.mode){case "pan":k.rotate(Ea.pan.matrix,Ea.pan.matrix,ua,V);Ea.pan.enabled=!0;break;case "zoom":Ea.zoom=-Ba.translation[1]*pa.zoom}else{const {eye:Ma,viewRight:Ua}=wa;wa=d.cross(p.sv3d.get(),Ua,Ma);ma=Ba.translation[0]*pa.pan;0!==
ma&&(k.rotate(Ea.pan.matrix,Ea.pan.matrix,-ma,wa),Ea.pan.enabled=!0);switch(Ka.mode){case "pan":Ba=Ba.translation[1]*pa.pan;0!==Ba&&(k.rotate(Ea.pan.matrix,Ea.pan.matrix,Ba,Ua),Ea.pan.enabled=!0);break;case "zoom":Ea.zoom=-Ba.translation[1]*pa.zoom}}};a.panToPosition=function(ma,wa,Ba,pa,Aa,ra,ua){B(Ba,d.dot(wa.up,Ba),ma[3],-b.cyclicalPI.normalize(n.deg2rad(Aa)),ra,wa)?K(ma,wa,Ba,pa,-b.cyclicalPI.normalize(n.deg2rad(Aa)),ra,ua):z(ma,wa,Ba,pa,ra,ua)};a.pickPointAndInitSphere=function(ma,wa,Ba,pa,Aa,
ra){const ua=c.create(),Ea=x.create();let Ka=!0,Ma=!0;ma.intersectScreen(Ba,ua,ra)?Ea[3]=d.length(ua):(Ma=!1,Ea[3]=wa.aboveGround&&Aa!==a.SpherePickPointFallback.Ellipsoid?Math.max(d.length(wa.center),.9*pa.radius):d.length(wa.eye)-wa.relativeElevation,Aa===a.SpherePickPointFallback.Silhouette?G(Ea,wa,Ba,ua):Ka=q.intersectScreen(Ea,wa,Ba,ua));return{sphere:Ea,scenePickPoint:Ka?ua:null,hasGeometryIntersection:Ma}};a.pivotDistanceModifier=30;a.preserveHeadingThreshold=B;a.rotatePivotDistanceModifier=
5;a.rotatePivotMinDistanceModifier=10;a.rotatePointAroundTwoAxes=H;a.rotateScreenPixelArea=90;a.rotationAngleAndAxisDirectRotation=A;a.rotationAnglesAndAxesHeadingPreserving=I;a.rotationAnglesHeadingPreserving=E;a.screenPixelArea=80;a.sphereOrPlanePointFromScreenPoint=G;a.zoomDistanceModifier=8;a.zoomMaxDistanceModifier=1508E5;a.zoomMinDistanceModifier=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ./vector ./vectorStacks".split(" "),
function(a,b,n,h,k,m){function g(r=c){return[r[0],r[1],r[2],r[3]]}function e(r,x,w,p,t=g()){t[0]=r;t[1]=x;t[2]=w;t[3]=p;return t}function d(r,x){r[3]=x;return r}const c=[0,0,1,0],l=n.create(),f=n.create();a.angle=function(r){return r[3]};a.axis=function(r){return r};a.compose=function(r,x,w){b.setAxisAngle(l,r,r[3]);b.setAxisAngle(f,x,x[3]);b.multiply(l,f,l);return d(w,b.getAxisAngle(w,l))};a.copy=function(r,x=g()){return e(r[0],r[1],r[2],r[3],x)};a.create=g;a.fromAxisAndAngle=function(r,x){const w=
g();h.copy(w,r);w[3]=x;return w};a.fromPoints=function(r,x,w){h.cross(w,r,x);h.normalize(w,w);w[3]=k.angle(r,x);return w};a.fromValues=e;a.setAngle=d;a.up=c;a.wrap=function(r,x,w,p){return e(r,x,w,p,m.sv4d.get())};a.wrapAxisAngle=function(r,x){return e(r[0],r[1],r[2],x,m.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,n,h,k,m){function g(c,l,f){return e(c,c.screenToRender(l,b.castRenderScreenPointArray3(m.sv3d.get())),f)}function e(c,l,f){const r=b.castRenderScreenPointArray3(n.copy(m.sv3d.get(),l));r[2]=0;if(!c.unprojectFromRenderScreen(r,f.origin))return null;l=b.castRenderScreenPointArray3(n.copy(m.sv3d.get(),l));l[2]=1;c=c.unprojectFromRenderScreen(l,m.sv3d.get());if(null==c)return null;h.subtract(f.direction,c,f.origin);return f}function d(c,l,f){h.copy(f.origin,c.eye);l=h.set(m.sv3d.get(),l[0],
l[1],1);c=c.unprojectFromRenderScreen(l,m.sv3d.get());if(null==c)return null;h.subtract(f.direction,c,f.origin);return f}a.fromRender=e;a.fromRenderAtEye=d;a.fromScreen=g;a.fromScreenAtEye=function(c,l,f){return d(c,c.screenToRender(l,b.castRenderScreenPointArray3(m.sv3d.get())),f)};a.fromScreenNormalized=function(c,l,f=k.create()){g(c,b.screenPointObjectToArray(l),f);h.normalize(f.direction,f.direction);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports",
"../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,b,n,h){const k=b.create();a.intersectScreen=function(m,g,e,d){g=h.fromScreenAtEye(g,e,k);return n.intersectRay(m,g,d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/time ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../layers/VoxelWasm ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){a.ZoomStepController=class extends t.PointToPointAnimationController{constructor(){super(...arguments);this._zoomLocation=l.create();this._tmpCamera=new u.Camera;this._tmpRayDir=l.create();this._tmpCenter=l.create();this._beginCamera=new u.Camera;this._constraintOptions=new r.ConstraintOptions(x.ConstraintTypes.ALL,w.InteractionType.ZOOM,null,this._beginCamera)}zoomStep(C,E){if(this.active){var I=this.view.state;this.animation.finished?this._beginCamera.copyFrom(I.camera):
this.animation.cameraAt(1,this._beginCamera);this._tmpCamera.copyFrom(I.camera);var H=v.newIntersector(this.view.state.viewingMode);I=!1;0<C?(I=this.intersectionHelper.intersectScreenFreePointFallback(E,this._zoomLocation,0===this.view.map.ground.opacity?q.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,H,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,H,this._zoomLocation)?this._tmpCamera.center=
this._zoomLocation:c.copy(this._zoomLocation,this._tmpCamera.center);C=.6**C;E=this.view._stage.renderView.getMinimalDepthForArea(p.getVoxelWasm(this.view),E[0],E[1],this.view.state.camera,60);c.subtract(A,this._tmpCamera.eye,this._zoomLocation);c.normalize(A,A);H=n.clamp(Math.min(q.zoomDistanceModifier,1/Math.abs(c.dot(G,A)))*Math.abs(this.view.camera.position.z),q.zoomMinDistanceModifier,q.zoomMaxDistanceModifier);if(E=null!=E?E:H)if(H=l.create(),c.subtract(H,this._zoomLocation,this._tmpCamera.eye),
E<c.length(H)||!I)c.normalize(H,H),c.add(this._zoomLocation,this._tmpCamera.eye,c.scale(H,H,E));this._updateCamera(this._tmpCamera,C,this._zoomLocation);this.begin(this._tmpCamera)}}animationSettings(){return{duration:h.Milliseconds(600),easing:y.outExpo}}_updateCamera(C,E,I){c.subtract(this._tmpRayDir,I,C.eye);const H=c.length(this._tmpRayDir);let J=H*E;const B=Math.max(4,1.01*C.nearFar[0]);0!==J&&(1>=E&&J<B&&(J=B,E=J/H),1E-6>Math.abs(H-J)||(c.scale(this._tmpRayDir,this._tmpRayDir,E),C.eye=c.subtract(D,
I,this._tmpRayDir),C.center=c.lerp(D,C.center,I,1-E),f.applyAll(this.view,C,this._constraintOptions)))}};a.ZoomStepController=b.__decorate([d.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const D=l.create(),G=l.fromValues(0,0,1),A=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/VoxelWasm":function(){define(["require","exports"],function(a,b){let n,h=null;const k=new Map;b.addLayerViewToWasm=async function(m){null==
h&&(null==n&&(n=new Promise((d,c)=>a(["../../../layers/VoxelWasmPerSceneView"],l=>d(Object.freeze(Object.defineProperty({__proto__:null,default:l},Symbol.toStringTag,{value:"Module"}))),c))),h=await n);const g=m.view;let e=k.get(g);e||(e=new h.default({view:g}),k.set(g,e));return e.addVoxelLayer(m)};b.getVoxelWasm=function(m){return k.get(m)};b.removeLayerViewFromWasm=function(m){const g=m.view,e=k.get(g);e&&1>e.removeVoxelLayer(m)&&(k.delete(g),0===k.size&&(h=n=null))};Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,n){if("touch"===b.pointerType)return!1;switch(n){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,n){switch(n){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,n,h,k){class m extends h.InputHandler{constructor(g,e,d,c){super(!0);this._view=g;this.pointerAction=e;this._pivot=d;this.registerIncoming("drag",c,l=>this._handleDrag(l))}_handleDrag(g){const e=
g.data;if(!(1<e.pointers.size)&&k.eventMatchesMousePointerAction(g.data,this.pointerAction)){var d=b.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new n.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(d);break;case "update":this._cameraController&&this._cameraController.update(d);
break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}g.stopPropagation()}}}Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>n.PivotPoint});a.DragRotate=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../../layers/VoxelWasm ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){a.PivotPoint=void 0;(function(H){H[H.CENTER=0]="CENTER";H[H.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=class extends A.InteractiveController{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(H){super(H);this.pivot=a.PivotPoint.CENTER;this._rotScale=0;this._lastPoint=r.create();this._tmpWorldUp=w.create();this._tmpViewDir=w.create();this._tmpRotCurPoint=r.create();this._tmpTransf=l.create();
this._tmpAxis=w.create();this._tmpPivotPoint=w.create();this._pivotPos=w.create();this._constraintOptions=new q.ConstraintOptions(u.ConstraintTypes.ALL,v.InteractionType.TUMBLE,0,this.startCamera)}initialize(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5}begin(H){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:x.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=v.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=y.TiltMode.LOOK_AROUND;this._constraintOptions.selection=
u.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const J=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});J||x.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(H,J);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=v.InteractionType.TUMBLE;this._constraintOptions.tiltMode=y.TiltMode.TUMBLE;this._constraintOptions.selection=u.ConstraintTypes.ALL&
~u.ConstraintTypes.DISTANCE}C.normalizeCoordinate(this.startCamera,H,this._lastPoint)}}_constrainPivotPoint(H,J){const B=this.startCamera,z=w.create();x.subtract(z,this._pivotPos,B.eye);const K=x.length(z);var L=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(B.eye,I);L=Math.max(Math.min(C.rotatePivotDistanceModifier,1/Math.abs(x.dot(I,B.viewForward)))*L,C.rotatePivotMinDistanceModifier);J&&(L=Math.min(K,L));var F=p.getReferenceEllipsoid(this.view.spatialReference),
M=h.createScreenPointArray(B.width/B.pixelRatio*.5,B.height/B.pixelRatio*.5);F=C.decideNavigationMode(this.startCamera,M,F);M=this.view._stage.renderView.getMinimalDepthForArea(D.getVoxelWasm(this.view),B.fullWidth/B.pixelRatio*.5,B.fullHeight/B.pixelRatio*.5,B,2.5*C.rotateScreenPixelArea,C.rotateScreenPixelArea);H=this.view._stage.renderView.getMinimalDepthForArea(D.getVoxelWasm(this.view),H[0],H[1],B,C.rotateScreenPixelArea);if(null!=M||null!=H)M=M??H??0,H=null==H||F===C.NavigationMode.Horizontal?
M:H,L=M>H?H:M,L=J?Math.min(L,K):L;x.normalize(z,z);x.copy(this._pivotPos,x.add(this._tmpPivotPoint,B.eye,x.scale(this._tmpPivotPoint,z,L)))}update(H){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,H,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,H,this.currentCamera.eye,this._pivotPos)}t.applyAll(this.view,
this.currentCamera,this._constraintOptions);this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(H,J,B,z){this.view.renderCoordsHelper.worldUpAtPosition(z,this._tmpWorldUp);C.normalizeCoordinate(H,J,this._tmpRotCurPoint);J=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let K=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;x.subtract(this._tmpViewDir,B,z);B=x.length(this._tmpViewDir);B=n.acosClamped(x.dot(this._tmpViewDir,this._tmpWorldUp)/B);if(this.pivot===
a.PivotPoint.EYE){const L=.5*Math.PI-B,F=.495*Math.PI;J=L-Math.max(-F,Math.min(F,L+-.5*J))}J=n.clamp(J+B,G.TiltRange.min,G.TiltRange.max)-B;x.cross(this._tmpAxis,H.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(K=-K);c.fromRotation(this._tmpTransf,K,this._tmpWorldUp);c.rotate(this._tmpTransf,this._tmpTransf,J,this._tmpAxis);x.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);H.up=x.transformMat4(E,H.up,this._tmpTransf);x.add(E,z,this._tmpViewDir);f.copy(this._lastPoint,this._tmpRotCurPoint);
return E}};b.__decorate([k.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([d.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const E=w.create(),I=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,n,h,k,m,g,e,d,c){a.InteractiveController=class extends d.CameraController{constructor(){super(...arguments);this.startCamera=new c.Camera;this.currentCamera=new c.Camera;this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<e.interactingTimeout}stepController(l,f){f.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(f)}onControllerStart(l){this.state=d.State.Running;this.startCamera.copyFrom(l);this.currentCamera.copyFrom(l)}onControllerEnd(l){l.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),e.interactingTimeout);this.view.state.updateCamera(l=>this.stepController(0,l));this.steppingFinished&&this.finishController()}};b.__decorate([n.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);b.__decorate([n.property()],a.InteractiveController.prototype,"_lastInteraction",void 0);a.InteractiveController=b.__decorate([g.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/projection ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState ../../webgl/FramebufferObject".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M){a.ViewStateManager=class extends k{constructor(V){super(V);this.ready=!1;this._windowDevicePixelRatio=1;this._devicePixelRatioOverride=null;this._idleTimeout=300;this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:U=>this._devicePixelRatioOverride=U,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return null!=
this.renderState},get idleTimeoutEnabled(){return 0<this.viewStateManager._idleTimeout},set idleTimeoutEnabled(U){this.viewStateManager._idleTimeout=U?300:0}};this._propertiesPool=new B.PropertiesPool({frustum:E.Frustum},this);this._cameraSetByUser=!1;this._gotoOperation=null;this._cameraChangeTime=0;this._tmpCanvasSize=new S}initialize(){this._cameraChangeTime=performance.now();this.addHandles([e.on(()=>this.view.state.events,"before-camera-change",V=>V&&this._updateElevation(V)),e.watch(()=>this.view.state?.camera,
(V,U)=>this._cameraChangedHandler(V,U),e.sync)]);e.when(()=>this.view.state?.camera,V=>this._updateElevation(V),{once:!0,sync:!0});this.addHandles([d.addFrameTask({prepare:()=>this._prepareFrame()}),e.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),e.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit();this._propertiesPool=g.destroyMaybe(this._propertiesPool)}get camera(){const V=
this._get("camera");if(!this.ready)return V;const U=J.internalToExternal(this.view,this.view.state.camera,O);return U&&V&&U.equals(V)?V:U.clone()}set camera(V){this._updatePropertyBeforeReady("camera",V)||(this.view.elevationProvider?.enableCache(!0),this.setStateCamera(J.externalToInternal(this.view,V),{applyConstraints:!1})||m.getLogger(this).error("#camera\x3d","Invalid camera",V),this.view.elevationProvider?.enableCache(!1))}get contentCamera(){const V=this._get("contentCamera");if(!this.ready)return V;
const U=J.internalToExternal(this.view,this.view.state.contentCamera,O);return U&&V&&U.equals(V)?V:U.clone()}set contentCamera(V){this._updatePropertyBeforeReady("contentCamera",V)||(V=J.externalToInternal(this.view,V),null==V?this.view.state.contentCamera=null:(this._updateElevation(V),this.view.state.contentCamera=V))}installContentCameraReset(V){this.removeHandles("content-camera-reset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const U=this.zoom,
W=this.view.state.camera.distance**2,ca=p.fromArray(this.view.state.camera.center),X=V.sticky?this.contentCamera.clone():null;this.addHandles([e.watch(()=>this.contentCamera,()=>{V.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),e.watch(()=>this.zoom,ba=>{void 0!==ba&&void 0!==U&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(ba-U)/2),2<Math.abs(ba-U)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=X))}),
e.watch(()=>this.view.state.camera,ba=>{ba=w.squaredDistance(ca,ba.center);this.test.contentCameraResetState.set("camera.center",ba/W);ba>W?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=X)})],"content-camera-reset");return!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(V){this._updatePropertyBeforeReady("center",V)||(V?this.isCompatible(V)?this.setStateCamera(this._centerToCamera(V),{applyConstraints:!0})?
this.view.pointsOfInterest.centerOnContent.runTask():m.getLogger(this).error("#center\x3d","Invalid center",V):m.getLogger(this).error("#center\x3d","Center has an incompatible spatial reference (center: "+(V.spatialReference?V.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",V):m.getLogger(this).error("#center\x3d","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");var V=this.view;V=J.toExtent(V,V.state.camera,V.pointsOfInterest.centerOnContent.renderLocation);
return null!=V?V:this._get("extent")}set extent(V){this._updatePropertyBeforeReady("extent",V)||(V?this.isCompatible(V)?this.setStateCamera(this._extentToCamera(V),{applyConstraints:!0})||m.getLogger(this).error("#extent\x3d","Invalid extent",V):m.getLogger(this).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(V.spatialReference?V.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",V):m.getLogger(this).error("#extent\x3d","Extent may not be null or undefined"))}get frustum(){const V=
this._propertiesPool.get("frustum");V.renderCoordsHelper=this.view.renderCoordsHelper;V.update(this.view.state.camera);return V}get constraintsManager(){return this._constraintsManager}get _initialViewpoint(){const V=this.view.map;return V&&"initialViewProperties"in V?V.initialViewProperties?.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const V=this.view.pointsOfInterest.centerOnContent;return J.distanceToScale(this.view,V.distance,V.location.latitude)}return this._get("scale")}set scale(V){this._updatePropertyBeforeReady("scale",
V)||this.setStateCamera(this._scaleToCamera(V),{applyConstraints:!0})||m.getLogger(this).error("#scale\x3d","Invalid scale",V)}get padding(){if(!this.ready)return this._get("padding");var V=this.view.state.camera,U=V.padding;const W=V.pixelRatio;V=this._get("padding");const ca=Math.round(U[K.PaddingSide.TOP]/W),X=Math.round(U[K.PaddingSide.RIGHT]/W),ba=Math.round(U[K.PaddingSide.BOTTOM]/W);U=Math.round(U[K.PaddingSide.LEFT]/W);return null!=V&&V.top===ca&&V.right===X&&V.bottom===ba&&V.left===U?V:{top:ca,
right:X,bottom:ba,left:U}}set padding(V){this._updatePropertyBeforeReady("padding",V)||(this._paddingToArray(V,this.view.state.camera.pixelRatio,Q),this.view.state.updateCamera(U=>U.padding=Q))}_paddingToArray(V,U,W){V?t.set(W,V.top||0,V.right||0,V.bottom||0,V.left||0):t.set(W,0,0,0,0);for(V=0;4>V;V++)W[V]=Math.round(W[V]*U)}get screenCenter(){const V=this.padding;return c.createScreenPoint((this.view.width-(V.left+V.right))/2+V.left,(this.view.height-(V.top+V.bottom))/2+V.top)}get viewpoint(){return this.ready?
z.fromCamera(this.view,this.camera):this._get("viewpoint")}set viewpoint(V){if(!this._updatePropertyBeforeReady("viewpoint",V))if(V)if(this.isCompatible(V))this.setStateCamera(this._viewpointToCamera(V),{applyConstraints:!V.camera})||m.getLogger(this).error("#viewpoint\x3d","Invalid viewpoint",V);else{var U=null!=V.camera?V.camera.position:V.targetGeometry;U=null!=U&&U.spatialReference;m.getLogger(this).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(U?U.wkid:
"none")+", view: "+this.view.spatialReference?.wkid+")",V)}else m.getLogger(this).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}get zoom(){return this.ready?J.scaleToZoom(this.view,this.scale):this._get("zoom")}set zoom(V){this._updatePropertyBeforeReady("zoom",V)||void 0===V||this.setStateCamera(this._zoomToCamera(V),{applyConstraints:!0})||m.getLogger(this).error("#zoom\x3d","Invalid zoom",V)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=
this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;var V=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio);V=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:V)*this.view.resolutionScale;this._tmpCanvasSize.width=
Math.round(this.view.surface.clientWidth*V);this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*V);const U=this.view._stage.renderView.renderingContext?.parameters.maxTextureSize;U&&M.ensureAttachmentMaxSize(this._tmpCanvasSize,U);this._tmpCanvasSize.pixelRatio=0<this._tmpCanvasSize.width?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:V;this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,
this.view.qualitySettings.maximumPixelRatio));return this._tmpCanvasSize}get _rasterPixelRatio(){return null!=this._devicePixelRatioOverride?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){return this.view?._stage?.renderer.isFeatureEnabled(L.RenderFeature.PhysicalPixelRendering)??!1}get _usePhysicalPixelRenderingAny(){const V=this.view?._stage?.renderer;
return V&&(V.isFeatureEnabled(L.RenderFeature.PhysicalPixelRendering,F.RenderState.IDLE)||V.isFeatureEnabled(L.RenderFeature.PhysicalPixelRendering,F.RenderState.INTERACTING)||V.isFeatureEnabled(L.RenderFeature.PhysicalPixelRendering,F.RenderState.ANIMATING))}preinit(V){return this._isOverridden("center")&&!y.isLoadedOrLoadFor(this.center.spatialReference,V)||this._isOverridden("camera")&&!y.isLoadedOrLoadFor(this.camera.position.spatialReference,V)||this._isOverridden("extent")&&!y.isLoadedOrLoadFor(this.extent.spatialReference,
V)||this._isOverridden("viewpoint")&&(!y.isLoadedOrLoadFor(this.viewpoint.targetGeometry?.spatialReference,V)||!y.isLoadedOrLoadFor(this.viewpoint.camera?.position?.spatialReference,V))?!1:!0}init(){this._constraintsManager=new C.ConstraintsManager({view:this.view});this._prepareFrame();var V=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const U of V)this.set(U.name,U.value);this._cameraSetByUser||((V=this._initialViewpoint||this.view.initialExtent)&&this.isCompatible(V)?
this._setInitialView(V):this.view.state.viewingMode===D.ViewingMode.Local&&this.addHandles(e.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))}exit(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this._constraintsManager=
g.destroyMaybe(this._constraintsManager))}async goTo(V,U){U={animate:!0,...U};null!=this._gotoOperation&&this._gotoOperation.abort(U.animate);this._gotoOperation=new I.GoToOperation(V,U,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(A.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})}step(V){const U=this.view.state,W=U?.cameraController;W&&(U.updateCamera(ca=>W.stepController(V,ca)),W.steppingFinished&&
W.finishController())}_cancelGoToOperation(){null!=this._gotoOperation&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const V=new Set,U=[];for(const {propertyName:W,overrides:ca}of P){const X=V.has(W),ba=this._isOverridden(W);!X&&ba&&U.push({name:W,value:this._get(W)});this._clearOverride(W);(X||ba)&&ca.forEach(ia=>V.add(ia))}return U}_setInitialView(V){if(null!=V&&!this._cameraSetByUser)if(V instanceof n)this.setStateCamera(J.externalToInternal(this.view,V),{applyConstraints:!1});
else if(V instanceof h)if(V.targetGeometry instanceof u){var U=J.fromExtentSync(this.view,V.targetGeometry,0,.5,J.OrientationMode.LOCKED);null!=U&&this.setStateCamera(J.externalToInternal(this.view,U),{applyConstraints:!0})}else U={applyConstraints:!V.camera},V=this._viewpointToCamera(V),this.setStateCamera(V,U);else U=J.fromExtentSync(this.view,V,0,.5,J.OrientationMode.LOCKED),null!=U&&this.setStateCamera(J.externalToInternal(this.view,U),{applyConstraints:!0})}_updatePropertyBeforeReady(V,U){if(this.ready)return!1;
this._override(V,U);U&&N.has(V)&&this._override("hasInitialView",!0);return!0}isCompatible(V){return null==V?!1:V instanceof h?V.camera?this.isCompatible(V.camera):this.isCompatible(V.targetGeometry):V instanceof n?this.isCompatible(V.position):V.spatialReference&&!y.requiresLoad(V.spatialReference,this.view.spatialReference)}_getPreservingHeadingTilt(V=R){this._cameraSetByUser?(V.heading=this.camera.heading,V.tilt=this.camera.tilt):(V.heading=0,V.tilt=.5);return V}_centerPointAtDistanceToCamera(V,
U,W=T){const {heading:ca,tilt:X}=this._getPreservingHeadingTilt();V=J.getObserverForPointAtDistanceSync(this.view,ca,X,V,U,J.OrientationMode.ADJUST);if(null==V)return null;W.copyFrom(this.view.state.camera);W.eye=V.eye;W.center=V.center;W.up=V.up;return W}_centerToCamera(V){const U=this.view.pointsOfInterest.centerOnContent;U.runTask();return this._centerPointAtDistanceToCamera(V,U.distance)}_extentToCamera(V){const {heading:U,tilt:W}=this._getPreservingHeadingTilt();return(V=J.fromExtentSync(this.view,
V,U,W,J.OrientationMode.ADJUST,O))?J.externalToInternal(this.view,V):null}_scaleToCamera(V){if(null==V)return null;const U=this.view.pointsOfInterest.centerOnContent;U.runTask();const W=U.renderLocation;V=J.scaleToDistance(this.view,V,U.location.latitude);return this._centerPointAtDistanceToCamera(W,V)}_zoomToCamera(V){return this._scaleToCamera(J.zoomToScale(this.view,V))}_viewpointToCamera(V){return J.externalToInternal(this.view,z.toCameraSync(this.view,V))}setStateCamera(V,U){if(null==V||!this.view.state.stopActiveCameraController())return!1;
this._cameraSetByUser=!0;U.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(W=>{U.positionAndOrientationOnly?(W.eye=V.eye,W.center=V.center,W.up=V.up):W.copyFrom(V);U.applyConstraints&&G.applyAll(this.view,W)});U.applyConstraints||(this.view.state.cameraController=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:V}));return!0}_prepareFrame(){const {surface:V,canvas:U}=this.view;if(V&&U){this._windowDevicePixelRatio=window.devicePixelRatio;
var W=this._computeCanvasSize();if(0!==W.width&&0!==W.height){if(U.width!==W.width||U.height!==W.height)U.width=W.width,U.height=W.height;if(this.view.state){const ca=this.view.state.camera;if(ca.fullWidth!==W.width||ca.fullHeight!==W.height||ca.pixelRatio!==W.pixelRatio)T.copyFrom(ca),T.pixelRatio!==W.pixelRatio&&(this._paddingToArray(this.padding,W.pixelRatio,Q),T.padding=Q),T.fullWidth=W.width,T.fullHeight=W.height,T.pixelRatio=W.pixelRatio,this.view.state.camera=T;this._updateViewState()}}}}_updateElevation(V){var U=
this.view.basemapTerrain?.spatialReference;const W=this.view.renderCoordsHelper?.getAltitude(V.eye)??0;U=U?A.surfaceElevationBelowRenderLocation(this.view,V.eye):0;V.relativeElevation=W-U}_updateViewState(){null!=this.test.renderState?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=F.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=F.RenderState.INTERACTING:(this.view.state.mode===F.RenderState.ANIMATING&&(this._cameraChangeTime=0),performance.now()-
this._cameraChangeTime<this._idleTimeout?this.view.state.mode=F.RenderState.INTERACTING:this.view.state.mode=F.RenderState.IDLE);this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(V,U){V&&U&&V.almostEquals(U)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};b.__decorate([l.property({type:n,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);b.__decorate([l.property({type:n,dependsOn:["view.state.contentCamera","ready"]})],
a.ViewStateManager.prototype,"contentCamera",null);b.__decorate([l.property({type:v})],a.ViewStateManager.prototype,"center",null);b.__decorate([l.property({type:u})],a.ViewStateManager.prototype,"extent",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"_constraintsManager",void 0);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"constraintsManager",null);b.__decorate([l.property()],
a.ViewStateManager.prototype,"_initialViewpoint",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);b.__decorate([l.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,"ready",void 0);b.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"scale",null);b.__decorate([l.property()],a.ViewStateManager.prototype,"padding",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"screenCenter",null);b.__decorate([l.property({constructOnly:!0})],
a.ViewStateManager.prototype,"view",void 0);b.__decorate([l.property({type:h})],a.ViewStateManager.prototype,"viewpoint",null);b.__decorate([l.property({type:Number})],a.ViewStateManager.prototype,"zoom",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);b.__decorate([l.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",
null);b.__decorate([l.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);b.__decorate([l.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=b.__decorate([x.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);class S{constructor(){this.height=this.width=0;this.pixelRatio=1}}const N=new Set("camera viewpoint extent scale center zoom".split(" ")),P=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",
overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],R={heading:0,tilt:0},O=new n,T=new K.Camera,Q=q.create();a.interactingTimeout=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintOptions ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){a.ConstraintsManager=class extends n{constructor(u){super(u);this.nearFarHeuristic=t.createNearFarHeuristic(u.view.state.viewingMode,u.view.basemapTerrain,u.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([k.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),k.watch(()=>this.view.constraints?.clipDistance?.mode,()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",
u=>this._updateCameraNearFar(u)),k.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),k.sync),k.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),k.sync),k.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),k.sync),k.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),k.sync),k.watch(()=>this.view.state?.camera,()=>this._updateTiltAutoMax(),k.sync),k.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,
this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),k.sync)]);this.view.state.isLocal&&this.addHandles(k.watch(()=>this.view.renderDataExtent,u=>this._updateLocalSurfaceDistance(u),k.initial));this._updateNearFar();this.view.state.viewingMode!==l.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new q.SurfaceCollisionConstraint({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){const u=this.view.constraints?.clipDistance;u&&"auto"!==u.mode&&this.view.state.updateCamera(v=>this._updateCameraNearFarManual(v,u))}_updateNearFar(){this.view.state.updateCamera(u=>this._updateCameraNearFar(u))}_updateCameraNearFar(u){const v=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(v?v.mode:"auto")?this._updateCameraNearFarManual(u,v):this._updateCameraNearFarAuto(u,v)}_updateCameraNearFarAuto(u,
v){this.nearFarHeuristic.compute(u.eye,u.center,this.view.renderDataExtent,r.surfaceElevationBelowRenderLocation(this.view,u.eye),u);v&&v.autoUpdate(u.near,u.far)}_updateCameraNearFarManual(u,v){v&&(u.near=v.near,u.far=v.far)}_updateCollision(){var u=this.view.map?.ground?.navigationConstraint?.type;u=u?"stay-above"===u:!0;const v=this.view.state.constraints.collision;u!==v.enabled&&((v.enabled=u)&&this._reapplyConstraints(w.ConstraintTypes.COLLISION),(u=this.view.constraints&&this.view.constraints.tilt)&&
"auto"!==u.mode||this._updateTiltAuto())}_updateAltitude(){const u=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=u&&this.view.state.viewingMode!==l.ViewingMode.Local?{min:u.min,max:u.max}:null;this._reapplyConstraints()}_updateTiltMax(){const u=this.view.constraints&&this.view.constraints.tilt;u&&"auto"!==u.mode&&(this._updateTiltManual(u),this._reapplyConstraints())}_updateTilt(){const u=this.view.constraints&&this.view.constraints.tilt;"manual"===(u?
u.mode:"auto")?this._updateTiltManual(u):this._updateTiltAuto();this._reapplyConstraints()}_updateTiltManual(u){const v=this.view.state.constraints;v.tilt=v.createConstantMaxTilt(h.deg2rad(u.max))}_updateTiltAuto(){const u=this.view.state.constraints;u.tilt=u.createDefaultTilt();this._updateTiltAutoMax()}_updateTiltAutoMax(){const u=this.view.constraints&&this.view.constraints.tilt;if(u&&"auto"===u.mode){var v=this.view.state.constraints;v.tilt&&(v=v.tilt(this.view.state.camera.distance).max,u.autoUpdate(h.rad2deg(v)))}}_updateLocalSurfaceDistance(u){if(null!=
u){var v=Math.max(u.width,u.height);0>=v||(null!=u.zmax&&null!=u.zmin&&(v=Math.max(v,u.zmax-u.zmin)),u=this.view.state,v=3*v/Math.atan(u.camera.fov/2),v!==u.constraints.distance&&(u.constraints.distance=v))}}_reapplyConstraints(u=w.ConstraintTypes.ALL){this.view.state.updateCamera(v=>f.applyAll(this.view,v,new x.ConstraintOptions(u,p.InteractionType.NONE,null)))}};b.__decorate([m.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([m.property({readOnly:!0})],a.ConstraintsManager.prototype,
"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([c.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(w,p,t,q){t=2/t;w/p>t?(q.far=w,q.near=q.far/p):(q.near=t,q.far=q.near*p);return q}class l{constructor(w,p){this._elevationProvider=w;this._referenceEllipsoid=m.getReferenceEllipsoid(p);this._unitInMeters=n.getMetersPerUnitForSR(p,this._referenceEllipsoid.metersPerDegree)}compute(w,p,t,q,u){u||={near:0,far:0};var v=w[2]*this._unitInMeters,y=v;q=v-q;var D=this._elevationProvider?.visibleElevationBounds;D&&(v=0<=q?y-this._unitInMeters*D.min:this._unitInMeters*D.max-
y);t=null!=t?t:new g({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});y=Math.max(t.xmax-t.xmin,t.ymax-t.ymin,4*Math.max(t.xmax-t.xmin,t.ymax-t.ymin));h.subtract(x,p,w);r[0]=0<x[0]?t.xmax:t.xmin;r[1]=0<x[1]?t.ymax:t.ymin;r[2]=0<x[2]?y/2:-y/2;h.subtract(r,r,w);h.normalize(x,x);w=1.1*h.dot(r,x)*this._unitInMeters;p=Math.sqrt(v*(v+2*this._referenceEllipsoid.radius));t=Math.max(t.xmax-t.xmin,t.ymax-t.ymin);D=1E-4*t*this._unitInMeters;v=b.clamp((v-D)/(.001*t*this._unitInMeters-D),0,1);v=Math.min(b.lerp(p,w,
v**3),p)*Math.max(Math.log(Math.abs(q)),1);return c(Math.min(v,Math.max(34064E4,y))/this._unitInMeters,2E4,this._unitInMeters,u)}}class f{constructor(w){this._referenceEllipsoid=m.getReferenceEllipsoid(w)}compute(w,p,t,q,u){u||={near:0,far:0};w=h.length(w);p=w-this._referenceEllipsoid.radius;p=Math.max(Math.abs(p-q),Math.abs(p));q=1.2*b.lerp(Math.sqrt(p*(p+2*(this._referenceEllipsoid.radius+Math.min(0,q)))),w+this._referenceEllipsoid.radius,d.computeInnerAltitudeFade(p));w=b.clamp(2E4-(Math.log(p)-
7.983)/9.011*19E3,1E3,2E4);return c(q,w,1,u)}}const r=k.create(),x=k.create();a.createNearFarHeuristic=function(w,p,t){return w===e.ViewingMode.Global?new f(t):new l(p,t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,n,h,k,m,g,e,d,c){a.SurfaceCollisionConstraint=class extends n{constructor(l){super(l)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",l=>this._handleElevationChangeEvent(l)))}_handleElevationChangeEvent(l){if(!this.view.state.cameraController){var f=this.view.state.camera;null!=l.spatialReference&&d.eyeWithinExtent(this.view,f,l.extent,l.spatialReference)&&this._applyToCurrentCamera()}}_applyToCurrentCamera(){this.view.state.updateCamera(l=>c.applySurfaceCollisionConstraint(this.view,
l,c.Mode.EYE_AND_CENTER))}};b.__decorate([h.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/frustum"],function(a,
b,n,h){function k(g,e,d){g.origin=e;g.endpoint=d;b.direction(g.direction,e,d)}class m{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(g){this.renderCoordsHelper=g;this.frustum=h.create();this._points=h.createPoints();this.lines=Array(12);this._origin=n.create();this._direction=n.create();this._altitude=null;for(g=0;12>g;g++)this.lines[g]={origin:null,direction:n.create(),
endpoint:null}}update(g){h.fromMatrix(g.viewMatrix,g.projectionMatrix,this.frustum,this._points);b.copy(this._origin,g.eye);b.copy(this._direction,g.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()}updatePoints(g){for(let e=0;e<this._points.length;e++)b.copy(this._points[e],g[e]);h.computePlanes(this.frustum,this._points);this._updateLines()}get altitude(){return this._altitude}intersectsSphere(g){return h.intersectsSphere(this.frustum,g)}intersectsRay(g){return h.intersectsRay(this.frustum,
g)}intersectsLineSegment(g,e){return h.intersectsLineSegment(this.frustum,g,e)}intersectsPoint(g){return h.intersectsPoint(this.frustum,g)}_updateLines(){const g=this._points;for(let e=0;4>e;e++){const d=e+4;k(this.lines[e],g[e],g[d]);k(this.lines[e+4],g[e],3===e?g[0]:g[e+1]);k(this.lines[e+8],g[d],3===e?g[4]:g[d+1])}}}m.planePointIndices=h.planePointIndices;m.nearFarLineIndices=[[h.PointIndex.NEAR_BOTTOM_LEFT,h.PointIndex.FAR_BOTTOM_LEFT],[h.PointIndex.NEAR_BOTTOM_RIGHT,h.PointIndex.FAR_BOTTOM_RIGHT],
[h.PointIndex.NEAR_TOP_RIGHT,h.PointIndex.FAR_TOP_RIGHT],[h.PointIndex.NEAR_TOP_LEFT,h.PointIndex.FAR_TOP_LEFT]];a.Frustum=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x{constructor(w,p,t){this.target=w;this.options=p;this.view=t;this.state="pending";this._animationController=null;this.promise=new Promise((q,u)=>{this._resolveCallback=q;this._rejectCallback=u;q=new AbortController;if(null!=this.options.signal)k.onAbort(this.options.signal,()=>{this.abort()});this._abortController=q;this.waitForReady()})}resolve(w){if("finished"!==this.state)return this.state="finished",this._resolveCallback(w)}reject(w){if("finished"!==
this.state)return this.state="finished",this._rejectCallback(w)}abort(w=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!w&&null!=this._animationController&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(k.createAbortError())}async waitForReady(){this.state="wait-for-ready";if(!this.view.ready)try{await m.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(w){return this.reject(w)}this.createViewPoint()}async createViewPoint(){if("finished"!==
this.state){this.state="wait-for-viewpoint";this._animationController=this.options.animate?this._getAnimationController():null;try{const p=await r.create(this.view,this.target,this._abortController.signal);if("finished"!==this.state){var w=p?this._getCameraFromViewpoint(p):null;null!=w&&(this.options.animate?null!=this._animationController&&this.startAnimation(w,this._animationController):(this.view.stateManager.setStateCamera(w.camera,{applyConstraints:!w.isFullySpecified,positionAndOrientationOnly:!0,
doNotCancelGoToOperation:!0}),this.resolve()))}}catch(p){this.reject(p)}}}_getCameraFromViewpoint(w){const p=!!(this.target instanceof n&&this.target.camera||this.target instanceof b);var t=w.camera;if(null==t)return null;if(!this.view.stateManager.isCompatible(t))return w=(w=t.position)&&w.spatialReference,this.reject(new h("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${w?w.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,
{camera:t})),null;t=f.externalToInternal(this.view,t);return null==t?(this.reject(new h("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:w,camera:t,isFullySpecified:p}}startAnimation(w,p){this.state="wait-for-animation-finish";const t=p.viewAnimation;if(null==t)this.reject(new h("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{t.update(w.viewpoint,"running");if(!p.active||null==p.viewAnimation||p.viewAnimation.target!==w.viewpoint||this.view.state.cameraController!==
p)return this.abort();if(w.isFullySpecified){var q=new l.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:w.camera});e.applySurfaceCollisionConstraint(this.view,w.camera,e.Mode.EYE_AND_CENTER)}else g.applyAll(this.view,w.camera);p.begin(w.camera,this.options);var u=v=>{if(null!=this.view.state)switch(p.state){case d.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case d.State.Ready:case d.State.Rejected:case d.State.Running:case d.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(v)}}};
t.when(()=>{const v=this.view.state.cameraController;q&&(v&&v.active?v instanceof c.PointToPointAnimationController&&null!=v.viewAnimation&&v.viewAnimation.target===w.viewpoint&&(this.view.state.cameraController=q):null!=p.viewAnimation&&p.viewAnimation.target===w.viewpoint&&p.state===d.State.Finished&&(this.view.state.cameraController=q))},v=>u(v));p.asyncResult={resolve:()=>u(),reject:v=>u(v)}}}_getAnimationController(){let w=null;var p=null;p=this.view.state.cameraController;p instanceof c.PointToPointAnimationController&&
(p.updateStateFromViewAnimation(),p.active&&(w=p,p=w.viewAnimation));return null!=w||(w=new c.PointToPointAnimationController({view:this.view,mode:"animation"}),p=w.viewAnimation,this.view.state.switchCameraController(w))?w:(null!=p&&p.stop(),this.reject(new h("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}a.GoToOperation=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,b,n,h,k,m,g,e,d,c){a.SurfaceCollisionCorrectionController=class extends c.CameraController{set desiredCamera(l){this._set("desiredCamera",l.clone())}constructor(l){super(l)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=c.State.Running;this.addHandles(this.view.basemapTerrain.on("elevation-change",l=>this._handleElevationChangeEvent(l)));this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(l){(null==
l.spatialReference||e.eyeWithinExtent(this.view,this.desiredCamera,l.extent,l.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(l=>{l.copyViewFrom(this.desiredCamera);d.applySurfaceCollisionConstraint(this.view,l,d.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=c.State.Stopped)})}};b.__decorate([n.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([g.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],
a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Multipoint".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K){async function L(ma,wa,Ba,pa){var Aa=wa.camera;if(null!=Aa)return F(Aa,E.getViewSR(ma),pa);({targetGeometry:Aa}=wa);if(null==Aa)throw Error("Viewpoint has no targetGeometry!");const {camera:ra,mode:ua}=M(ma,wa.rotation,Ba);if("point"===Aa.type)return S(ma,wa,Aa,ra,ua,pa);wa=Aa.extent;if(null==wa)throw Error("Target geometry has no extent!");return E.fromExtentAsync(ma,wa,ra.heading,ra.tilt,ua,pa)}async function F(ma,wa,Ba){wa=
await p.projectWithZConversion(ma.position,wa,{signal:Ba});c.throwIfAborted(Ba);ma=ma.clone();ma.position=wa.clone();return ma}function M(ma,wa,Ba){ma=E.internalToExternal(ma,ma.state.camera);let pa=E.OrientationMode.ADJUST;null!=wa&&(ma.heading=360-e.cyclicalDegrees.normalize(wa),pa=E.OrientationMode.LOCKED);null!=Ba&&(ma.tilt=Ba);return{camera:ma,mode:pa}}async function S(ma,wa,Ba,pa,Aa,ra){const ua=ma.spatialReference;Ba=await p.projectWithZConversion(Ba.clone(),ua,{signal:ra});c.throwIfAborted(ra);
wa=null!=wa.scale?E.scaleToDistance(ma,wa.scale,Ba.latitude):ma.state.camera.distance;return E.fromCenterDistanceAsync(ma,Ba,wa,pa,Aa,ra)}function N(ma,wa){return null==wa.scale&&null!=wa.zoom?E.zoomToScale(ma,wa.zoom):wa.scale}function P(ma,wa){let Ba=!1;null!=wa.heading?(ma.heading=wa.heading,Ba=!0):null!=wa.rotation&&(ma.heading=360-e.cyclicalDegrees.normalize(wa.rotation),Ba=!0);null!=wa.tilt&&(ma.tilt=wa.tilt,Ba=!0);null!=wa.fov&&(ma.fov=wa.fov);return Ba}function R(ma,wa,Ba,pa){var Aa=ma.spatialReference||
B.WGS84;wa=null!=wa?wa:E.externalToInternal(ma,Ba);if(null==wa)return pa;Aa=new H({spatialReference:Aa});if(!u.projectVectorToPoint(wa.center,ma.renderSpatialReference,Aa))return pa;pa.targetGeometry=Aa;pa.scale=E.computeScale(ma,wa);pa.rotation=e.cyclicalDegrees.normalize(360-Ba.heading);pa.camera=Ba;return pa}async function O(ma,wa,Ba,pa){const Aa=()=>new d("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!wa)throw Aa();"mesh"===wa.type&&(wa=wa.extent);const ra=wa.spatialReference,
ua=ma.spatialReference,Ea=ma.basemapTerrain.spatialReference;if(!wa.hasZ&&ma.basemapTerrain){let Ma;switch(wa.type){case "point":Ma=wa;break;case "multipoint":case "polyline":Ma=wa.extent?.center;break;case "extent":Ma=wa.center;break;case "polygon":Ma=wa.centroid}null!=Ma&&null!=Ea&&null!=ma.elevationProvider?(Ma=await p.projectWithZConversion(Ma,Ea,{signal:pa}),aa[2]=I.getElevationAtPoint(ma.elevationProvider,Ma)??0):aa[2]=0}const Ka=[];(0,Ca[wa.type])(wa,wa.hasZ?Ma=>{Ka.push([Ma[0],Ma[1],Ma[2]])}:
Ma=>{Ka.push([Ma[0],Ma[1]])},aa);if(0===Ka.length)throw Aa();ma=await p.projectWithZConversion(new K({spatialReference:ra,hasZ:wa.hasZ,hasM:!1,points:Ka}),ua,{signal:pa});wa.hasZ&&(Ba.hasZ=!0);if(wa.hasZ)for(const [Ma,Ua,Ga]of ma.points)aa[0]=Ma,aa[1]=Ua,aa[2]=Ga,y.expandWithVec3(Ba.boundingBox,aa);else for(const [Ma,Ua]of ma.points)aa[0]=Ma,aa[1]=Ua,y.expandWithVec3(Ba.boundingBox,aa)}async function T(ma,wa,Ba,pa,Aa){const ra=await m.result(ma.whenViewForGraphic(wa));if(!1!==ra.ok&&null!=ra.value&&
"whenGraphicBounds"in ra.value)if(Ba=await m.result(ra.value.whenGraphicBounds(wa,{minDemResolution:Ba})),!1!==Ba.ok&&Ba.value){var {screenSpaceObjects:ua,boundingBox:Ea}=Ba.value;y.expandWithAABB(pa.boundingBox,Ea);ua&&ua.forEach(Ka=>{pa.screenSpaceObjects.push(Ka)});isFinite(Ea[2])&&(pa.hasZ=!0)}else await O(ma,wa.geometry,pa,Aa);else await O(ma,wa.geometry,pa,Aa)}async function Q(ma,wa,Ba,pa,Aa){if(Array.isArray(wa)&&2===wa.length){const ra=wa[0],ua=wa[1];if("number"===typeof ra&&"number"===typeof ua){va.x=
ra;va.y=ua;va.z=void 0;va.spatialReference=ma.spatialReference?.isGeographic?ma.spatialReference:B.WGS84;await O(ma,va,pa,Aa);return}}wa&&"map"in wa&&"function"===typeof wa.map?await Promise.allSettled(wa.map(ra=>Q(ma,ra,Ba,pa,Aa))):wa instanceof z?await O(ma,wa,pa,Aa):wa instanceof h&&await T(ma,wa,Ba,pa,Aa)}async function V(ma,wa,Ba,pa,Aa){if(null!=wa.camera)return U(ma,wa.camera,pa,Aa);Aa.scale=wa.scale;Aa.rotation=wa.rotation;Aa.targetGeometry=null!=wa.targetGeometry?wa.targetGeometry.clone():
null;Aa.camera=null;null!=Ba.heading?Aa.rotation=e.cyclicalDegrees.normalize(360-Ba.heading):null!=Ba.rotation&&(Aa.rotation=Ba.rotation);wa=N(ma,Ba);null!=wa&&(Aa.scale=wa);Aa.camera=await L(ma,Aa,Ba.tilt,pa);return Aa}async function U(ma,wa,Ba,pa){Ba=await p.projectWithZConversion(wa.position,ma.spatialReference,{signal:Ba});wa=wa.clone();wa.fov=ma.camera.fov;wa.position=Ba;return R(ma,null,wa,pa)}async function W(ma,wa,Ba,pa,Aa,ra,ua){const Ea=ma.renderSpatialReference;await q.projectPointToVectorAsync(wa,
qa,Ea,0,{signal:ua});await q.projectPointToVectorAsync(Ba,oa,Ea,0,{signal:ua});ra.targetGeometry=new H(wa);Aa.position=new H(Ba);x.subtract(ja,qa,oa);E.directionToHeadingTilt(ma,oa,ja,pa.up,Aa);ra.scale=E.distanceToScale(ma,x.distance(oa,qa),ra.targetGeometry.latitude);ra.rotation=e.cyclicalDegrees.normalize(360-Aa.heading);ra.camera=Aa;return ra}async function ca(ma,wa,Ba,pa,Aa,ra){if(null==Ba)throw new d("createfromcenter","invalid point");ra.targetGeometry=Ba.clone();const ua=C.cameraOnContentAlongViewDirection(ma);
if(wa.position)return W(ma,ra.targetGeometry,wa.position,ua,pa,ra,Aa);if(wa.zoomFactor){var Ea=ua.distance/wa.zoomFactor;const Ka=x.scale(aa,ua.viewForward,-Ea);ua.eye=x.add(aa,ua.center,Ka);ra.scale=E.distanceToScale(ma,Ea,Ba.latitude)}E.internalToExternal(ma,ua,pa);Ea=P(pa,wa)?E.OrientationMode.LOCKED:E.OrientationMode.ADJUST;wa.zoomFactor||(wa=N(ma,wa),null==wa?({renderSpatialReference:wa}=ma,await q.projectPointToVectorAsync(Ba,aa,wa,0,{signal:Aa}),G.intersectsPoint(ua.frustum,aa)?ra.scale=E.distanceToScale(ma,
x.distance(ua.eye,aa),Ba.latitude):ra.scale=E.computeScale(ma,ua)):ra.scale=wa,ra.camera=await E.fromCenterScale(ma,ra.targetGeometry,ra.scale,pa,Ea,Aa));return ra}async function X(ma,wa,Ba,pa,Aa){var ra=C.cameraOnContentAlongViewDirection(ma);x.copy(ja,ra.viewForward);E.directionToHeadingTilt(ma,ra.eye,ja,ra.up,ta);ra=ma.spatialReference;const {position:ua}=wa;ua?(Aa=await p.projectWithZConversion(ua,ra,{signal:Aa}),Ba.position=Aa):Ba.position=new H;Ba.heading=null!=wa.heading?wa.heading:ta.heading;
Ba.tilt=null!=wa.tilt?wa.tilt:ta.tilt;return R(ma,null,Ba,pa)}async function ba(ma,wa,Ba,pa,Aa){const ra=C.cameraOnContentAlongViewDirection(ma),{spatialReference:ua,renderSpatialReference:Ea}=ma,Ka=new H({spatialReference:ua});return u.projectVectorToPoint(ra.center,Ea,Ka)?ca(ma,wa,Ka,Ba,pa,Aa):ca(ma,wa,null,Ba,pa,Aa)}async function ia(ma,wa,Ba,pa,Aa,ra){ra.targetGeometry=Ba.clone();const ua=C.cameraOnContentAlongViewDirection(ma);E.internalToExternal(ma,ua,pa);wa=P(pa,wa)?E.OrientationMode.LOCKED:
E.OrientationMode.ADJUST;ra.camera=await E.fromExtentAsync(ma,Ba,pa.heading,pa.tilt,wa,Aa);return ra}async function fa(ma,wa,Ba,pa,Aa,ra,ua,Ea){Ea.targetGeometry=Ba.clone();const Ka=C.cameraOnContentAlongViewDirection(ma);var Ma=0;null!=Ba.z?Ma=Ba.z:ma.basemapTerrain&&ma.elevationProvider&&(Ma=I.getElevationAtPoint(ma.elevationProvider,Ba));x.set(aa,Ba.x,Ba.y,Ma);t.computeTranslationToOriginAndRotation(ma.spatialReference,aa,ea,ma.renderSpatialReference);l.fromMat4(ha,ea);l.transpose(ha,ha);y.empty(Y);
Ba=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Ua=0;Ua<Ba.length;Ua++){const Ga=Ba[Ua];let Na=pa[Ga[2]];isFinite(Na)||(Na=Ma);x.set(aa,pa[Ga[0]],pa[Ga[1]],Na);v.projectVectorToVector(aa,ma.spatialReference,aa,ma.renderSpatialReference);y.expandWithVec3(Y,x.transformMat3(aa,aa,ha))}pa=y.width(Y);Ma=y.height(Y);Ba=y.depth(Y);Ua=1/Math.tan(Ka.fovY/2);Aa=Math.max(.5*Math.sqrt(pa*pa+Ba*Ba)*Math.max(Ua,1/Math.tan(Ka.fovX/2))+.5*Ma,.5*Ma*Ua+.5*Math.max(pa,Ba))/Aa;E.internalToExternal(ma,
Ka,ra);wa=P(ra,wa)?E.OrientationMode.LOCKED:E.OrientationMode.ADJUST;Ea.scale=E.distanceToScale(ma,Aa,Ea.targetGeometry.latitude);Ea.camera=await E.fromCenterScale(ma,Ea.targetGeometry,Ea.scale,ra,wa,ua);return Ea}function da(ma){null!=ma?.camera&&(ma.rotation=e.cyclicalDegrees.normalize(360-ma.camera.heading));return ma}const aa=w.create(),ea=r.create(),ha=f.create(),Y=y.create(),Z=D.create(),ja=w.create(),oa=w.create(),qa=w.create(),ta={heading:0,tilt:0},va=new H,Ca={point(ma,wa,Ba){Ba[0]=ma.x;
Ba[1]=ma.y;null!=ma.z&&(Ba[2]=ma.z);wa(Ba)},polygon(ma,wa,Ba){const pa=ma.hasZ;for(let Aa=0;Aa<ma.rings.length;Aa++){const ra=ma.rings[Aa];for(let ua=0;ua<ra.length;ua++)Ba[0]=ra[ua][0],Ba[1]=ra[ua][1],pa&&(Ba[2]=ra[ua][2]),wa(Ba)}},polyline(ma,wa,Ba){const pa=ma.hasZ;for(let Aa=0;Aa<ma.paths.length;Aa++){const ra=ma.paths[Aa];for(let ua=0;ua<ra.length;ua++)Ba[0]=ra[ua][0],Ba[1]=ra[ua][1],pa&&(Ba[2]=ra[ua][2]),wa(Ba)}},multipoint(ma,wa,Ba){const pa=ma.points;ma=ma.hasZ;for(let Aa=0;Aa<pa.length;Aa++)Ba[0]=
pa[Aa][0],Ba[1]=pa[Aa][1],ma&&(Ba[2]=pa[Aa][2]),wa(Ba)},extent(ma,wa,Ba){null!=ma.zmin&&null!=ma.zmax?(wa(x.set(Ba,ma.xmin,ma.ymin,ma.zmin)),wa(x.set(Ba,ma.xmax,ma.ymin,ma.zmin)),wa(x.set(Ba,ma.xmin,ma.ymax,ma.zmin)),wa(x.set(Ba,ma.xmax,ma.ymax,ma.zmin)),wa(x.set(Ba,ma.xmin,ma.ymin,ma.zmax)),wa(x.set(Ba,ma.xmax,ma.ymin,ma.zmax)),wa(x.set(Ba,ma.xmin,ma.ymax,ma.zmax)),wa(x.set(Ba,ma.xmax,ma.ymax,ma.zmax))):(wa(x.set(Ba,ma.xmin,ma.ymin,Ba[2])),wa(x.set(Ba,ma.xmax,ma.ymin,Ba[2])),wa(x.set(Ba,ma.xmin,
ma.ymax,Ba[2])),wa(x.set(Ba,ma.xmax,ma.ymax,Ba[2])))}};a.create=async function(ma,wa,Ba){if(wa&&ma.spatialReference){var pa={target:void 0};"declaredClass"in wa||Array.isArray(wa)?pa.target=wa:(Object.assign(pa,wa),wa.center&&!pa.target&&(pa.target=wa.center));wa=pa}else wa=null;if(!wa)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");pa=new b({fov:ma.camera.fov});const Aa=new k({camera:pa});if(wa.target instanceof k)return ma=await V(ma,wa.target,wa,Ba,Aa),da(ma);
if(wa.target instanceof b)return da(await U(ma,wa.target,Ba,Aa));var ra=null!=wa.scale||null!=wa.zoom;if(wa.target instanceof J){var ua=wa.target.xmin===wa.target.xmax||wa.target.ymin===wa.target.ymax;return ra||ua?da(await ca(ma,wa,wa.target.center,pa,Ba,Aa)):da(await ia(ma,wa,wa.target,pa,Ba,Aa))}ua={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]};var Ea=ra?(Ea=N(ma,wa))?A.getResolutionInMetersForScale(Ea):void 0:void 0;await Q(ma,wa.target,Ea,ua,Ba);if(isFinite(ua.boundingBox[0])){y.center(ua.boundingBox,
aa);va.x=aa[0];va.y=aa[1];va.z=aa[2];va.spatialReference=ma.spatialReference;isFinite(va.z)&&ua.hasZ?Ea=y.isPoint(ua.boundingBox):(va.z=void 0,Ea=D.isPoint(y.toRect(ua.boundingBox,Z)));if(ra||Ea)return da(await ca(ma,wa,va,pa,Ba,Aa));ra=ua.screenSpaceObjects;if(ra.length){Ea=Number.NEGATIVE_INFINITY;for(let Ka=0;Ka<ra.length;Ka++){const Ma=ra[Ka].screenSpaceBoundingRect;Ea=Math.max(Ea,Math.abs(Ma[0]),Math.abs(Ma[1]),Math.abs(Ma[2]),Math.abs(Ma[3]))}ra=.66-Ea/Math.min(ma.width,ma.height)*2}else ra=
.66;return da(await fa(ma,wa,va,ua.boundingBox,ra,pa,Ba,Aa))}return wa.position?da(await X(ma,wa,pa,Aa,Ba)):da(await ba(ma,wa,pa,Ba,Aa))};a.fromCamera=function(ma,wa,Ba=null){null==Ba&&(Ba=new k);return R(ma,null,wa.clone(),Ba)};a.toCameraAsync=L;a.toCameraSync=function(ma,wa,Ba){var pa=wa.camera;if(null!=pa){a:{ma=E.getViewSR(ma);var Aa=pa.position;try{var ra=p.tryProjectWithZConversion(Aa,ma)}catch(Ka){ma=null;break a}ra?(ma=pa.clone(),ma.position=ra.clone()):ma=null}return ma}({targetGeometry:ra}=
wa);if(null==ra)return null;const {camera:ua,mode:Ea}=M(ma,wa.rotation,Ba);if("point"===ra.type){a:{pa=ma.spatialReference;try{Aa=p.tryProjectWithZConversion(ra.clone(),pa)}catch(Ka){ma=null;break a}Aa?(ra=null!=wa.scale?E.scaleToDistance(ma,wa.scale,Aa.latitude):ma.state.camera.distance,ma=E.fromCenterDistanceSync(ma,Aa,ra,ua,Ea)):ma=null}return ma}ra=ra.extent;return null==ra?null:E.fromExtentSync(ma,ra,ua.heading,ua.tilt,Ea)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports",
"../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],function(a,b,n,h){a.RenderFeature=void 0;(function(k){k[k.Antialiasing=0]="Antialiasing";k[k.HighQualityTransparency=1]="HighQualityTransparency";k[k.HighResolutionVoxel=2]="HighResolutionVoxel";k[k.HighResolutionAtmosphere=3]="HighResolutionAtmosphere";k[k.SSAO=4]="SSAO";k[k.WaterReflection=5]="WaterReflection";k[k.HighResolutionShadows=6]="HighResolutionShadows";k[k.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(a.RenderFeature||
(a.RenderFeature={}));a.setupFeatureDefaults=function(k=!b("disable-feature:high-quality-idle"),m=null){const g=new n.NestedMap;k?(g.set(h.RenderState.IDLE,a.RenderFeature.Antialiasing,"low"!==m),g.set(h.RenderState.IDLE,a.RenderFeature.HighResolutionAtmosphere,"low"!==m),g.set(h.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,!0),g.set(h.RenderState.IDLE,a.RenderFeature.SSAO,!0),g.set(h.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),g.set(h.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,
!0)):(g.set(h.RenderState.ANIMATING,a.RenderFeature.HighResolutionShadows,!0),g.set(h.RenderState.INTERACTING,a.RenderFeature.HighResolutionShadows,!0));g.set(h.RenderState.IDLE,a.RenderFeature.HighResolutionShadows,!0);g.set(h.RenderState.IDLE,a.RenderFeature.HighResolutionVoxel,!0);return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports"],function(a){class b{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===
this._outer.size}get(n,h){return this._outer.get(n)?.get(h)}set(n,h,k){const m=this._outer.get(n);m?m.set(h,k):this._outer.set(n,new Map([[h,k]]))}delete(n,h){const k=this._outer.get(n);k&&(k.delete(h),0===k.size&&this._outer.delete(n))}forEach(n){this._outer.forEach((h,k)=>n(h,k))}}a.NestedMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,n,h,k,m){class g extends k.InputHandler{constructor(e,d,c){super(!0);this._view=e;this.pointerAction=d;this.registerIncoming("drag",c,l=>this._handleDrag(l))}_handleDrag(e){const d=e.data;if(!(1<d.pointers.size)&&m.eventMatchesMousePointerAction(e.data,this.pointerAction)){var c=b.createScreenPointArray(d.center.x,d.center.y);switch(d.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?
new n.ZoomController({view:this._view}):new h.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(c);break;case "update":this._cameraController&&this._cameraController.update(c);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}}}a.DragZoom=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){a.ZoomController=class extends D.InteractiveController{constructor(){super(...arguments);this._pickPoint=r.create();this._tmpP0=l.create();this._panAxisAngle=w.create();this._tmpRayDir=r.create();this._tmpRayDirPick=r.create();this._targetOnSphere=r.create();this._navMode=G.NavigationMode.Horizontal;this._tmpRay={origin:r.create(),direction:r.create()};this.dragBeginPoint=h.createScreenPointArray();this._normalizedAnchorPoint=l.create();this._constraintOptions=
new q.ConstraintOptions(u.ConstraintTypes.ALL_EXCEPT_COLLISION,v.InteractionType.ZOOM,0,this.startCamera);this._sphere=p.create();this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(I){if(this.active){c.copy(this.dragBeginPoint,I);G.normalizeCoordinate(this.startCamera,I,this._normalizedAnchorPoint);var H=x.getReferenceEllipsoid(this.view.spatialReference),J=G.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,I,H,G.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?G.contentIntersectorOptions:{});this._navMode=G.decideNavigationMode(this.startCamera,I,H);if(this._navMode===G.NavigationMode.Horizontal)this._hasPickPoint=!!J.scenePickPoint,this._pickPoint=J.scenePickPoint??this._pickPoint,this._sphere=J.sphere;else{A.fromScreenAtEye(this.startCamera,I,this._tmpRay);f.normalize(this._tmpRay.direction,this._tmpRay.direction);let B;null!=J.scenePickPoint&&(f.subtract(this._tmpRayDirPick,this.startCamera.eye,J.scenePickPoint),B=f.length(this._tmpRayDirPick));
H=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,E);H=n.clamp(Math.min(G.pivotDistanceModifier,1/Math.abs(f.dot(E,this._tmpRay.direction)))*H,G.distanceClampValues[0],G.distanceClampValues[1]);I=this.view._stage.renderView.getMinimalDepthForArea(null,I[0],I[1],this.view.state.camera,G.screenPixelArea);H=null!=I?I:H;H=null!=B?Math.min(H,B):H;this._hasPickPoint=!0;f.scale(this._tmpRay.direction,this._tmpRay.direction,H);f.add(this._pickPoint,
this._tmpRay.origin,this._tmpRay.direction)}}}update(I){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===G.NavigationMode.Horizontal){f.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var H=f.length(this._tmpRayDir);G.normalizeCoordinate(this.currentCamera,I,this._tmpP0);var J=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),B=H*2**J;const z=this.view.state.constraints.minimumPoiDistance;
0>J&&B<z&&(B=z);if(1E-6>Math.abs(H-B))return;this._hasPickPoint&&B<H&&(J=1-(1-B/H)*(1-this._sphere[3]/f.length(this.currentCamera.center)),this.currentCamera.center=f.scale(C,this.currentCamera.center,J));f.scale(this._tmpRayDir,this._tmpRayDir,-B/H);this.currentCamera.eye=f.add(C,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=t.pixelDistanceToInteractionFactor(c.distance(this.dragBeginPoint,I));t.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._hasPickPoint&&(G.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),w.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),G.applyRotation(this.currentCamera,p.getCenter(this._sphere),this._panAxisAngle))}else{H=f.length(this._tmpRay.direction);G.normalizeCoordinate(this.currentCamera,I,this._tmpP0);I=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);B=H*2**I;J=this.view.state.constraints.minimumPoiDistance;0>I&&B<J&&(B=
J);if(1E-6>Math.abs(H-B))return;f.scale(this._tmpRayDir,this._tmpRay.direction,1-B/H);this.currentCamera.eye=f.add(C,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=f.add(C,this.currentCamera.center,this._tmpRayDir)}y.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}}end(){this.active&&this.finishController()}};a.ZoomController=b.__decorate([d.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const C=r.create(),
E=r.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../layers/VoxelWasm ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){a.ZoomController=class extends v.InteractiveController{constructor(){super(...arguments);this._tmpP=r.create();this._tmpDir=r.create();this._tmpN=r.create();this._tmpP0=l.create();this._tmpPoi=r.create();this._tmpRayDir=r.create();this.dragBeginPoint=h.createScreenPointArray();this._normalizedAnchorPoint=l.create();this._constraintOptions=new p.ConstraintOptions(t.ConstraintTypes.ALL,q.InteractionType.ZOOM,0,this.startCamera,r.create());this._plane=
x.create()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(A){if(this.active){c.copy(this.dragBeginPoint,A);y.normalizeCoordinate(this.startCamera,A,this._normalizedAnchorPoint);var C=this._intersectionHelper.intersectScreenFreePointFallback(A,this._tmpP,0===this.view.map.ground.opacity?y.contentIntersectorOptions:{});f.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var E=f.length(this._tmpDir);f.normalize(this._tmpDir,this._tmpDir);var I=Math.abs(this.view.camera.position.z);
I=n.clamp(Math.min(y.pivotDistanceModifier,1/Math.abs(f.dot(G,this._tmpDir)))*I,y.distanceClampValues[0],y.distanceClampValues[1]);A=this.view._stage.renderView.getMinimalDepthForArea(u.getVoxelWasm(this.view),A[0],A[1],this.view.state.camera,y.screenPixelArea);I=null!=A?A:I;I=C?Math.min(I,E):I;f.scale(this._tmpDir,this._tmpDir,I);f.add(this._tmpP,this.startCamera.eye,this._tmpDir);f.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);f.normalize(this._tmpN,this._tmpN);0>this._tmpN[1]&&
f.negate(this._tmpN,this._tmpN);x.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane)}}update(A){if(this.active){y.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||f.copy(this._tmpPoi,this.currentCamera.center);y.normalizeCoordinate(this.currentCamera,A,this._tmpP0);var C=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);c.copy(this._normalizedAnchorPoint,this._tmpP0);f.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var E=f.length(this._tmpRayDir),
I=E*(1-C);this._constraintOptions.interactionDirection&&(f.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),f.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(C)/E));var H=this.view.state.constraints.minimumPoiDistance;0<=C&&I<H&&(I=H,C=-(I-E)/E);1E-6>Math.abs(E-I)||(f.scale(this._tmpRayDir,this._tmpRayDir,C),this.currentCamera.eye=f.add(D,this.currentCamera.eye,this._tmpRayDir),f.lerp(D,this.currentCamera.center,this._tmpPoi,
C),D[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],D[2]):Math.min(this.startCamera.center[2],D[2]),this.currentCamera.center=D,this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(c.distance(this.dragBeginPoint,A)),w.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}}end(){this.active&&this.finishController()}};a.ZoomController=b.__decorate([d.subclass("esri.views.3d.state.controllers.local.ZoomController")],
a.ZoomController);const D=r.create(),G=r.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define(["exports","../../../../core/Handles","../../../../core/reactiveUtils","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,n,h,k){class m extends k.InputHandler{constructor(g){super(!0);this._view=g;this._watchHandles=new b;this._handle=this.registerIncoming("gamepad",
e=>this._handleEventGamepad(e));this._handle.pause()}onInstall(g){super.onInstall(g);this._watchHandles.add([n.watch(()=>this._view.navigation.gamepad.enabled,e=>{e?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},n.initial),n.watch(()=>this._view.navigation.gamepad.device,e=>{this._cameraControllerGamepad&&e&&this._cameraControllerGamepad.gamepadDevice!==e&&(this._cameraControllerGamepad.finishController(),
this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll();super.onUninstall()}_handleEventGamepad(g){var e=this._view.navigation.gamepad.device;if(!e||g.data.device===e)if((e=this._cameraControllerGamepad&&this._cameraControllerGamepad.active)||h.GamepadKeyboardController.activatesFor(this._view,g.data))e||(e=new h.GamepadKeyboardController({view:this._view,gamepadDevice:g.data.device}),this._view.state.switchCameraController(e)&&(this._cameraControllerGamepad=e)),this._cameraControllerGamepad&&
this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===g.data.device&&this._cameraControllerGamepad.handleEventGamepad(g.data)}}a.GamepadNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintOptions ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B){a.GamepadKeyboardController=class extends A.InteractiveController{constructor(R){super(R);this._filteredSurfaceElevation=0;this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];this._tmpCamera=new J.Camera;this._headingStart=0;this._constraintOptions=new u.ConstraintOptions(v.ConstraintTypes.ALL,y.InteractionType.NONE,0,new J.Camera,null,D.TiltMode.LOOK_AROUND)}handleEventGamepad(R){const O=
B.extractTransformation(R,this.view.navigation.gamepad,this._transformation);("end"===R.action||B.isZeroTransformation(O))&&this.finishController()}activateDirection(R){this._keysButtonState[R]=1;B.extractTransformationKeyboard(this._keysButtonState,this._transformation)}deactivateDirection(R){this._keysButtonState[R]=0;R=B.extractTransformationKeyboard(this._keysButtonState,this._transformation);B.isZeroTransformation(R)&&this.finishController()}onControllerStart(R){this._filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;super.onControllerStart(R)}_updateFilteredSurfaceElevation(R){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*R}stepController(R,O){this._updateStartHeading();this._updateFilteredSurfaceElevation(R);this.currentCamera.copyViewFrom(O);this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);
this._calculateControlTransformation(R,this.currentCamera,M);this._applyDisabledMovementTypes(M);this._applyPan(M.pan);this._applyRotate(M.rotate);this._applyZoom(M.zoom);this._applyAscend(M.ascend);this._constraintOptions.interactionType=y.InteractionType.NONE;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions);super.stepController(R,O)}_updateStartHeading(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)}_applyRotate(R){if(R.enabled){var O=
this.currentCamera;l.subtract(S,O.center,O.eye);l.transformMat4(S,S,R.matrix);O.center=l.add(S,S,O.eye);O.up=l.transformMat4(S,O.up,R.matrix);this._constraintOptions.interactionType=y.InteractionType.LOOK_AROUND;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,O,this._constraintOptions)}}_applyPan(R,O=this.currentCamera){R.enabled&&(O.eye=l.transformMat4(S,O.eye,R.matrix),O.center=l.transformMat4(S,O.center,R.matrix),this.view.state.isGlobal&&(O.up=l.transformMat4(S,
O.up,R.matrix)),this._constraintOptions.interactionType=y.InteractionType.PAN,this._constraintOptions.selection=v.ConstraintTypes.ALL,q.applyAll(this.view,O,this._constraintOptions))}_applyZoom(R){if(R){var O=this.currentCamera.viewForward;this.currentCamera.eye=l.add(S,this.currentCamera.eye,l.scale(t.sv3d.get(),O,R));l.copy(N,O);l.negate(N,N);this._constraintOptions.interactionDirection=N;this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;
q.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}}_applyAscend(R){if(R){var O=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,t.sv3d.get());this._constraintOptions.interactionDirection=l.copy(N,O);this.view.state.isGlobal?(O=l.length(this.currentCamera.eye),R=(O+R)/O,this.currentCamera.eye=l.scale(S,this.currentCamera.eye,R),this.currentCamera.center=l.scale(S,this.currentCamera.center,R)):(R=l.scale(t.sv3d.get(),
O,R),this.currentCamera.eye=l.add(S,this.currentCamera.eye,R),this.currentCamera.center=l.add(S,this.currentCamera.center,R));this._updateCameraCenter();this._constraintOptions.interactionType=y.InteractionType.ASCEND;this._constraintOptions.selection=v.ConstraintTypes.COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=v.ConstraintTypes.ALL_EXCEPT_COLLISION;q.applyAll(this.view,this.currentCamera,this._constraintOptions);
this._constraintOptions.interactionDirection=null}}_calculateControlTransformation(R,O,T){T.zoom=0;T.ascend=0;T.pan.enabled=!1;d.identity(T.pan.matrix);T.rotate.enabled=!1;d.identity(T.rotate.matrix);R=this._computeVelocities(R);this.view.state.isLocal?this._calculateControlTransformationLocal(R,O,T):this._calculateControlTransformationGlobal(R,O,T)}_updateCameraCenter(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,
S)}_calculateControlTransformationLocal(R,O,T){const {viewRight:Q,viewForward:V}=O,U=this._transformation;var W=this.view.navigation.gamepad,ca=l.set(t.sv3d.get(),V[0],V[1],0);l.normalize(ca,ca);var X=U.translation[0]*R.pan;0!==X&&(X=l.scale(t.sv3d.get(),Q,X),d.translate(T.pan.matrix,T.pan.matrix,X),T.pan.enabled=!0);switch(W.mode){case "pan":W=-U.translation[1]*R.pan;0!==W&&(ca=l.scale(t.sv3d.get(),ca,W),d.translate(T.pan.matrix,T.pan.matrix,ca),T.pan.enabled=!0);T.zoom=U.zoom*R.zoom;break;case "zoom":T.zoom=
(-U.translation[1]+U.zoom)*R.zoom;break;default:n.neverReached(W.mode)}T.ascend=U.translation[2]*R.ascend;ca=-U.heading*R.rotate;0!==ca&&(d.rotate(T.rotate.matrix,T.rotate.matrix,ca,this.view.renderCoordsHelper.worldUpAtPosition(O.eye,t.sv3d.get())),T.rotate.enabled=!0);R=U.tilt*R.rotate;O=E.viewAngle(this.view.renderCoordsHelper,O.center,O.eye);if(O=h.clamp(O+R,G.TiltRange.min,G.TiltRange.max)-O)d.rotate(T.rotate.matrix,T.rotate.matrix,O,Q),T.rotate.enabled=!0}_calculateControlTransformationGlobal(R,
O,T){const {eye:Q,viewRight:V}=O,U=this._transformation;var W=this.view.navigation.gamepad,ca=l.cross(t.sv3d.get(),V,Q);l.normalize(ca,ca);l.negate(ca,ca);C.panMotionToRotationMatrix(this.startCamera,O,U,R,this.view.camera.heading,this._headingStart,this.view.camera.tilt,T,W);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(M.pan,this._tmpCamera);W=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;T.ascend=U.translation[2]*R.ascend;ca=-U.heading*R.rotate;0!==ca&&
(d.rotate(T.rotate.matrix,T.rotate.matrix,ca,this._tmpCamera.eye),T.rotate.enabled=!0);O=this._clampTiltDeltaGlobalToValidRange(U.tilt*R.rotate,O.ray,W);0!==O&&(d.rotate(T.rotate.matrix,T.rotate.matrix,O,this._tmpCamera.viewRight),T.rotate.enabled=!0);T.zoom+=U.zoom*R.zoom}_clampTiltDeltaGlobalToValidRange(R,O,T){const Q=r.getReferenceEllipsoid(this.view.spatialReference),V=C.onSurfaceTiltToEyeTiltGlobal(G.TiltRange.min,O.origin,T,Q);var U=0;let W=0;U=t.sv3d.get();this.view.renderCoordsHelper.intersectManifold(O,
T,U)?(U=E.viewAngle(this.view.renderCoordsHelper,U,O.origin),U=C.onSurfaceTiltToEyeTiltGlobal(U,O.origin,T,Q),W=C.onSurfaceTiltToEyeTiltGlobal(G.TiltRange.max,O.origin,T,Q)):(w.closestPointOnSilhouette(w.fromRadius(w.tmpSphere,T+Q.radius),O,U),U=Math.PI+p.angle(O.direction,U),U=C.offSurfaceTiltToEyeTiltGlobal(U,O.origin,T,Q),W=C.offSurfaceTiltToEyeTiltGlobal(G.TiltRange.max,O.origin,T,Q));return h.clamp(U+R,V,W)-U}_getPointAbsoluteSurfaceElevation(R,O,T){const {renderCoordsHelper:Q}=this.view,V=Q.getAltitude(R);
O+=Math.abs(V-O);Q.setAltitude(T,O,R);return O}_clampedDistanceToSurface(R,O){const {renderCoordsHelper:T}=this.view,{camera:Q}=this.view.state;var {direction:V}=I.headingTiltToDirectionUp(this.view,O,0,80,P);V=T.intersectManifoldClosestSilhouette(x.wrap(O,V),R,t.sv3d.get());V=l.distance(O,V);R=T.intersectManifoldClosestSilhouette(x.wrap(O,l.direction(t.sv3d.get(),O,Q.center)),R,t.sv3d.get());O=l.distance(O,R);return Math.min(V,O)}_computeHeadingRotateRadius(R){const {renderCoordsHelper:O,state:T}=
this.view,{camera:Q,isGlobal:V}=T;var U=O.intersectManifoldClosestSilhouette(Q.ray,this._filteredSurfaceElevation,t.sv3d.get());if(V){const W=l.subtract(t.sv3d.get(),R,U);U=l.length(W);l.scale(W,W,1/U);R=l.normalize(t.sv3d.get(),R);R=h.acosClamped(l.dot(R,W));return U*Math.sin(Math.min(K,R))}R=l.copy(t.sv3d.get(),R);O.setAltitude(R,this._filteredSurfaceElevation);return l.distance(U,R)}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:5}_computeVelocities(R){var O=this._filteredSurfaceElevation,
T=O+r.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:Q,isGlobal:V}=this.view.state;var U=t.sv3d.get();const W=this._getPointAbsoluteSurfaceElevation(Q.eye,O,U);var ca=this._clampedDistanceToSurface(O,U);const X=Q.width/2,ba=.75*Q.width,ia=.75*Q.width;var fa=ca*Math.tan(.5*Q.fovX)/X;T=fa/T;U=fa/this._computeHeadingRotateRadius(U);fa=(V?T:fa)*ba*R;O=W-O;O=Math.max(this._minimumAscendVelocity()*R,2**(ba*R/X)*O-O);ca=2**(ba*R/X)*ca-ca;R*=h.clamp(U*ia,L,F);return{pan:fa,ascend:O,
zoom:ca,rotate:R}}_applyDisabledMovementTypes(R){null==this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(R.zoom=this.disableMovements.zoom?0:R.zoom,R.ascend=this.disableMovements.ascend?0:R.ascend,R.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&d.identity(R.pan.matrix),R.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&d.identity(R.rotate.matrix))}static activatesFor(R,O){R=B.extractTransformation(O,
R.navigation.gamepad,z);return!("end"===O.action||B.isZeroTransformation(R))}};b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([k.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([e.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const z={translation:[0,0,0],heading:0,tilt:0,zoom:0},K=h.deg2rad(80),
L=h.deg2rad(30),F=h.deg2rad(80),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:c.create()},rotate:{enabled:!1,matrix:c.create()}},S=f.create(),N=f.create(),P=H.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec32"],function(a,b){function n(h){let k=h*h;0>h&&(k*=-1);return k}a.extractTransformation=function(h,k,m){const g=h.state;h=h.device;k="forward-down"===k.tiltDirection?1:
-1;"standard"===h.deviceType?(m.translation[0]=n(g.axes[0]),m.translation[1]=n(g.axes[1]),m.translation[2]=n(g.buttons[7])-n(g.buttons[6]),m.heading=n(g.axes[2]),m.tilt=n(g.axes[3])):"spacemouse"===h.deviceType&&(m.translation[0]=1.2*n(g.axes[0]),m.translation[1]=1.2*n(g.axes[1]),m.translation[2]=2*-n(g.axes[2]),m.heading=1.2*n(g.axes[5]),m.tilt=1.2*n(g.axes[3]));m.tilt*=k;b.scale(m.translation,m.translation,1);return m};a.extractTransformationKeyboard=function(h,k){k.translation[0]=h[1]-h[0];k.translation[1]=
h[3]-h[2];k.translation[2]=h[4]-h[5];k.heading=h[7]-h[6];k.tilt=h[8]-h[9];k.zoom=h[10]-h[11];return k};a.isZeroTransformation=function(h){return 0===h.translation[0]&&0===h.translation[1]&&0===h.translation[2]&&0===h.heading&&0===h.tilt&&0===h.zoom};a.resetTransformation=function(h){h.translation[0]=0;h.translation[1]=0;h.translation[2]=0;h.heading=0;h.tilt=0;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports",
"../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler","../../../input/VisibilityChange"],function(a,b,n,h,k){var m;(function(e){e[e.LEFT=0]="LEFT";e[e.RIGHT=1]="RIGHT";e[e.FORWARD=2]="FORWARD";e[e.BACKWARD=3]="BACKWARD";e[e.UP=4]="UP";e[e.DOWN=5]="DOWN";e[e.HEADINGLEFT=6]="HEADINGLEFT";e[e.HEADINGRIGHT=7]="HEADINGRIGHT";e[e.TILTUP=8]="TILTUP";e[e.TILTDOWN=9]="TILTDOWN";e[e.ZOOMIN=10]="ZOOMIN";e[e.ZOOMOUT=11]="ZOOMOUT"})(m||={});class g extends h.InputHandler{constructor(e,
d){super(!0);this._view=e;this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:b.ViewingMode.Local};this._keyToNumber={[d.left]:m.LEFT,[d.right]:m.RIGHT,[d.forward]:m.FORWARD,[d.backward]:m.BACKWARD,[d.up]:m.UP,[d.down]:m.DOWN,[d.headingLeft]:m.HEADINGLEFT,[d.headingRight]:m.HEADINGRIGHT,[d.tiltUp]:m.TILTUP,[d.tiltDown]:m.TILTDOWN,[d.zoomIn]:m.ZOOMIN,[d.zoomOut]:m.ZOOMOUT};this.registerIncoming("key-down",null,c=>this._handleKeyDown(c));this.registerIncoming("key-up",null,c=>this._handleKeyUp(c));
this.registerIncoming("blur",null,()=>this._handleStop());this._visibilityHandle=k.onVisibilityChange(c=>c?null:this._handleStop())}onUninstall(){this._visibilityHandle?.remove();this._handleStop()}_handleKeyDown(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var d=this._keyToNumber[e.data.key];null!=d&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new n.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),
this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(d),e.stopPropagation()))}}_handleStop(){this._cameraControllerKeyboard?.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var d=this._keyToNumber[e.data.key];null!=d&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&
(this._cameraControllerKeyboard.deactivateDirection(d),e.stopPropagation())}}}a.KeyboardNavigation=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/VisibilityChange":function(){define(["exports"],function(a){a.onVisibilityChange=function(b){const n=()=>b("visible"===document.visibilityState);document.addEventListener("visibilitychange",n);return{remove:()=>document.addEventListener("visibilitychange",n)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["exports","../../../../core/screenUtils","../../state/controllers/global/ZoomStepController","../../state/controllers/local/ZoomStepController","../../../input/InputHandler"],function(a,b,n,h,k){class m extends k.InputHandler{constructor(g,e){super(!0);this._view=g;this.registerIncoming("mouse-wheel",e,d=>this._handleMouseWheel(d))}_handleMouseWheel(g){if(this._view.navigation.mouseWheelZoomEnabled){var e=g.data;this._cameraController&&
this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new n.ZoomStepController({view:this._view,mode:"interaction"}):new h.ZoomStepController({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*e.deltaY,b.createScreenPointArray(e.x,e.y));g.preventDefault();g.stopPropagation()}}}a.MouseWheelZoom=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define(["exports",
"../../state/controllers/global/PinchAndPanController","../../state/controllers/local/PinchAndPanController","../../../input/InputHandler","../../../input/handlers/support"],function(a,b,n,h,k){class m extends h.InputHandler{constructor(g,e,d){super(!0);this._view=g;this.pointerAction=e;this._lastTimestamp=this._lastEndTimestamp=0;this.registerIncoming("drag",d,c=>this._handleDrag(c))}_handleDrag(g){if("mouse"!==g.data.pointerType||k.eventMatchesMousePointerAction(g.data,this.pointerAction)){var e=
g.timestamp-this._lastEndTimestamp;e=this._momentum&&this._momentum.active&&40>e;switch(g.data.action){case "start":case "update":if(e)break;this._controller&&this._controller.active?2<g.data.timestamp-this._lastTimestamp&&(this._controller.update(g.data),this._lastTimestamp=g.timestamp):this._startController(g);break;case "end":case "removed":this._endController(g,!0);break;case "added":this._endController(g,!1),this._startController(g)}g.stopPropagation()}}_endController(g,e){this._controller&&
this._controller.active&&(this._lastEndTimestamp=g.timestamp,g=this._controller.end(g.data),e&&g&&(this._momentum=g,this._view.state.switchCameraController(this._momentum)));this._controller=null}_startController(g){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(g.data);this._lastTimestamp=g.timestamp}_createController(){return this._view.state.isGlobal?new b.PinchAndPanController({view:this._view}):new n.PinchAndPanController({view:this._view})}}
a.PinchAndPanNavigation=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F){a.PinchAndPanController=class extends G.InteractiveController{constructor(){super(...arguments);this._smoothRotation=new D.ExponentialFalloff(.05);this._rotationAxis=r.create();this._beginHeading=this._beginAngle=0;this._panningPlane=p.create();this._beginRadius=0;this._smoothScaling=new D.ExponentialFalloff(.05);this._zoomCenterScreen=k.createScreenPointArray();this._zoomMomentumEstimator=new F.ZoomMomentumEstimator;this._rotationMomentumEstimator=
new L.RotationMomentumEstimator;this._panSphericalMomentumEstimator=new K.PanSphericalMomentumEstimator;this._panPlanarMomentumEstimator=new z.PanPlanarMomentumEstimator;this._adjustedSphere=t.create();this._tmp3d=r.create();this._tmpScreenPointArray=k.createScreenPointArray();this._beginScreenPoint=k.createScreenPointArray();this._beginScenePoint=r.create();this._screenPickPoint=k.createScreenPointArray();this._scenePickPoint=r.create();this._mode=J.NavigationMode.Horizontal;this._sphere=t.create();
this._pointerCount=0;this._tmpInteractionDirection=r.create();this._beginCamera=new B.Camera;this._constraintOptions=new u.ConstraintOptions(v.ConstraintTypes.ALL,y.InteractionType.NONE,0,this._beginCamera)}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(M){if(this.active){this._zoomMomentumEstimator.enabled=this._rotationMomentumEstimator.enabled=this._panPlanarMomentumEstimator.enabled=this._panSphericalMomentumEstimator.enabled=this.view.navigation.momentumEnabled;this._beginHeading=
-n.cyclicalPI.normalize(h.deg2rad(this.view.camera.heading));this._beginRadius=M.radius;this._pointerCount=M.pointers.size;this._beginAngle=M.angle;this._smoothRotation.reset();k.screenPointObjectToArray(M.center,this._screenPickPoint);l.copy(this._beginScreenPoint,this._screenPickPoint);var S=x.getReferenceEllipsoid(this.view.spatialReference),N=J.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,S,J.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?
J.contentIntersectorOptions:{});null!=N.scenePickPoint&&(this._scenePickPoint=N.scenePickPoint,this._sphere=N.sphere,f.copy(this._beginScenePoint,this._scenePickPoint),this._mode=J.decideNavigationMode(this.startCamera,this._screenPickPoint,S),this._mode===J.NavigationMode.Vertical&&this._preparePlanarPanMode(M,N.hasGeometryIntersection),this._beginCamera.copyFrom(this.startCamera))}}update(M){if(this.active){this.currentCamera.copyFrom(this.startCamera);var S=1<M.pointers.size;this._mode===J.NavigationMode.Horizontal?
(S&&this._zoomSpherical(M),this._panningSpherical(M),S&&this._rotateSpherical(M)):(S&&this._zoomPlanar(M),this._panningPlanar(M),S&&this._rotatePlanar(M));this.commitCamera()}}end(M){M.pointers.size===this._pointerCount&&this.update(M);this.finishController();if(M=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===J.NavigationMode.Horizontal?new H.ZoomSphericalMomentumController({view:this.view,momentum:M,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):
new I.ZoomPlanarMomentumController({view:this.view,momentum:M,zoomCenter:this._beginScenePoint});if(M=this._rotationMomentumEstimator.evaluateMomentum())return new E.RotationMomentumController({view:this.view,momentum:M,center:t.getCenter(this._sphere),axis:this._rotationAxis});if(this._mode===J.NavigationMode.Horizontal){if(M=this._panSphericalMomentumEstimator.evaluateMomentum())return new C.PanSphericalMomentumController({view:this.view,momentum:M})}else if(M=this._panPlanarMomentumEstimator.evaluateMomentum())return new A.PanPlanarMomentumController({view:this.view,
momentum:M});return null}_preparePlanarPanMode(M,S){var N=f.negate(this._tmp3d,this.startCamera.viewForward);p.fromPositionAndNormal(this._scenePickPoint,N,this._panningPlane);var P=k.createScreenPointArray(this._screenPickPoint[0],0);N=r.create();var R=f.length(this.startCamera.eye);this._adjustedSphere[3]=R<this._sphere[3]?R-100:this._sphere[3];J.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,this.startCamera,P,N);P=k.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(N,
P);N=r.create();P=r.create();R=r.create();f.subtract(N,this._scenePickPoint,this.currentCamera.eye);const O=f.length(N);f.normalize(N,N);var T=J.panDistanceModifier*Math.max(Math.abs(this.view.camera.position.z),J.minHeightLimit);const Q=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,J.screenPixelArea);T=null!=Q?Q:T;T=S?Math.min(T,O):T;f.copy(R,f.add(P,this.currentCamera.eye,f.scale(P,N,T)));this._panningPlane[3]=-f.dot(p.getNormal(this._panningPlane),
R);this.startCamera.center=f.add(P,this.startCamera.eye,f.scale(P,this.startCamera.viewForward,T));M=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);J.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,M,this._beginScenePoint)}_zoomSpherical(M){const S=this._beginRadius/M.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(M.radius,40),120);this._smoothScaling.update(S);J.applyZoomOnSphere(this._sphere,this.currentCamera,this._smoothScaling.value);k.screenPointObjectToArray(M.center,
this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*M.timestamp);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(M.radius-this._beginRadius);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(M){const S=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);J.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,S,this._tmp3d);
J.preserveHeadingThreshold(this._beginScenePoint,f.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(J.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(S,this._tmp3d,.001*M.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(J.applyPanSphericalDirectRotation(this._sphere,
this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(S,this._tmp3d,.001*M.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=y.InteractionType.PAN;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(l.distance(this._screenPickPoint,S));q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(M){f.normalize(this._rotationAxis,
this._scenePickPoint);this.currentCamera.aboveGround||f.negate(this._rotationAxis,this._rotationAxis);var S=this._smoothRotation.value,N=J.normalizeRotationDelta(M.angle-S);S+=N;this._smoothRotation.gain=.00125*Math.min(Math.max(M.radius,40),120);this._smoothRotation.update(S);N=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(N,.001*M.timestamp);J.applyRotation(this.currentCamera,t.getCenter(this._sphere),w.wrapAxisAngle(this._rotationAxis,N));this._constraintOptions.interactionType=
y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(M.radius*S);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(M){const S=k.screenPointObjectToArray(M.center,this._tmpScreenPointArray);J.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,S,this._tmp3d)&&(J.applyPanPlanar(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(S,this._tmp3d,.001*M.timestamp),this._constraintOptions.interactionType=
y.InteractionType.PAN,this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(l.distance(this._beginScreenPoint,S)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),q.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(M){const S=this._beginRadius/M.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(M.radius,
40),120);this._smoothScaling.update(S);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*M.timestamp);J.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=y.InteractionType.ZOOM;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(M.radius-this._beginRadius);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(M){f.copy(this._rotationAxis,
this._beginScenePoint);this.currentCamera.aboveGround||f.negate(this._rotationAxis,this._rotationAxis);var S=this._smoothRotation.value;let N=M.angle-S;N=J.normalizeRotationDelta(N);this._smoothRotation.gain=.00125*Math.min(Math.max(M.radius,40),120);this._smoothRotation.update(S+N);S=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(S,.001*M.timestamp);J.applyRotation(this.currentCamera,t.getCenter(this._sphere),w.wrapAxisAngle(this._rotationAxis,S));this._constraintOptions.interactionType=
y.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(M.radius*S);q.applyAll(this.view,this.currentCamera,this._constraintOptions)}};a.PinchAndPanController=b.__decorate([c.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n}reset(n){this._value=
n}set gain(n){this._gain=n}get value(){return void 0===this._value?0:this._value}update(n){this._value=void 0===this._value?n:this._gain*n+(1-this._gain)*this._value}}a.ExponentialFalloff=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.PanPlanarMomentumController=class extends l.MomentumController{constructor(r){super(r);this.interactionType=c.InteractionType.PAN;this._tmpPan=d.create()}momentumStep(r,x){r=this.momentum.value(r);e.scale(this._tmpPan,this.momentum.direction,r);x.eye=e.subtract(f,x.eye,this._tmpPan);x.center=e.subtract(f,x.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan}};b.__decorate([n.property({constructOnly:!0})],a.PanPlanarMomentumController.prototype,
"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const f=d.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){a.MomentumController=class extends r.AnimationController{constructor(){super(...arguments);this._beginCamera=new x.Camera;this._elapsedTimeSec=0;this.constraintOptions=new c.ConstraintOptions(l.ConstraintTypes.ALL,f.InteractionType.PAN,0,this._beginCamera)}initialize(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new e}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(w){this._beginCamera.copyFrom(w);
super.onControllerStart(w)}stepController(w,p){p.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=w;this.momentumStep(this._elapsedTimeSec,p);d.applyAll(this.view,p,this.constraintOptions)}};a.MomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){const r=d.create(),x=d.create();a.PanSphericalMomentumController=class extends l.MomentumController{constructor(w){super(w);this.interactionType=c.InteractionType.PAN}momentumStep(w,p){const t=this.momentum.value1(w);w=this.momentum.value2(w);e.copy(x,p.eye);e.normalize(x,x);e.cross(this.momentum.axis2,x,this.momentum.axis1);f.applyRotationWithTwoAxes(p,r,this.momentum.axis1,t,this.momentum.axis2,w)}};b.__decorate([n.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,
"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){a.RotationMomentumController=class extends l.MomentumController{set center(r){this._set("center",e.clone(r))}set axis(r){this._set("axis",e.clone(r))}constructor(r){super(r);this.interactionType=c.InteractionType.TUMBLE}momentumStep(r,x){r=this.momentum.value(r);f.applyRotation(x,this.center,d.wrapAxisAngle(this.axis,r))}};b.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([n.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"center",null);b.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){a.ZoomPlanarMomentumController=class extends l.MomentumController{set zoomCenter(r){this._set("zoomCenter",d.clone(r))}constructor(r){super(r);this.interactionType=c.InteractionType.ZOOM;this.constraintOptions.interactionDirection=d.create()}momentumStep(r,x){const {interactionDirection:w}=this.constraintOptions;w&&(e.copy(w,x.eye),r=this.momentum.valueDelta(0,r),f.applyZoomToPoint(x,this.zoomCenter,r,this.view.state.constraints.minimumPoiDistance),e.direction(w,
x.eye,w))}};b.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){a.ZoomSphericalMomentumController=class extends x.MomentumController{set screenCenter(p){this._set("screenCenter",n.createScreenPointArray(p[0],p[1]))}set sceneCenter(p){this._set("sceneCenter",d.clone(p))}constructor(p){super(p);this.interactionType=r.InteractionType.ZOOM;this.radius=0;this._tmpSceneCenter=d.create();this._tmpZoomAxisAngle=c.create();this._sphere=l.create()}initialize(){this._sphere[3]=this.radius}momentumStep(p,t){p=this.momentum.valueDelta(0,
p);w.applyZoomOnSphere(this._sphere,t,p);this.constraintOptions.interactionType=r.InteractionType.ZOOM;f.applyAll(this.view,t,this.constraintOptions);w.sphereOrPlanePointFromScreenPoint(this._sphere,t,this.screenCenter,this._tmpSceneCenter);c.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);w.applyRotation(t,l.getCenter(this._sphere),this._tmpZoomAxisAngle);this.constraintOptions.interactionType=r.InteractionType.PAN}};b.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,
"momentum",void 0);b.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([h.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=b.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],function(a,b,n,h,k){class m extends k.Momentum{constructor(e,d,c,l,f){super(e,d,c);this._sceneVelocity=l;this.direction=f}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}}class g{constructor(e=300,d=12,c=.84){this._minimumInitialVelocity=
e;this._stopVelocity=d;this._friction=c;this.enabled=!0;this._time=new h.FilteredFiniteDifference(.6);this._screen=[new h.FilteredFiniteDifference(.4),new h.FilteredFiniteDifference(.4)];this._scene=[new h.FilteredFiniteDifference(.6),new h.FilteredFiniteDifference(.6),new h.FilteredFiniteDifference(.6)];this._tmpDirection=n.create()}add(e,d,c){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(c)||(this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(d[0]),
this._scene[1].update(d[1]),this._scene[2].update(d[2]),this._time.update(c))}reset(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var e=this._screen[0].filteredDelta,d=this._screen[1].filteredDelta;e=null==e||null==d?0:Math.sqrt(e*e+d*d);d=this._time.filteredDelta;e=null==d||null==e?0:e/d;return Math.abs(e)<
this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,d,c){b.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const l=b.length(this._tmpDirection);0<l&&b.scale(this._tmpDirection,this._tmpDirection,1/l);const f=this._time.filteredDelta;return new m(e,d,c,null==f?0:l/f,this._tmpDirection)}}a.PanPlanarMomentum=m;a.PanPlanarMomentumEstimator=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n;this.filteredDelta=this.lastValue=void 0}update(n){if(this.hasLastValue()){const h=this.computeDelta(n);this._updateDelta(h)}this.lastValue=n}reset(){this.filteredDelta=this.lastValue=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(n){return void 0===this.lastValue?NaN:n-this.lastValue}_updateDelta(n){this.filteredDelta=
void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+this._gain*n:n}}a.FilteredFiniteDifference=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(a){class b{constructor(n,h,k){this._initialVelocity=n;this._stopVelocity=h;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(n){return n>
this.duration}get friction(){return this._friction}value(n){return this.valueFromInitialVelocity(this._initialVelocity,n)}valueDelta(n,h){const k=this.value(n);return this.value(n+h)-k}valueFromInitialVelocity(n,h){h=Math.min(h,this.duration);const k=1-this.friction;return n*(k**h-1)/Math.log(k)}}a.Momentum=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../core/libs/gl-matrix-2/factories/vec2f64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,n,h,k,m,g,e){class d extends e.Momentum{constructor(l,f,r,x,w,p=0,t){super(l,f,r);this._angularVelocity1=x;this.axis1=w;this.angularVelocity2=p;this.axis2=t}value1(l){return super.valueFromInitialVelocity(this._angularVelocity1,l)}value2(l){return super.valueFromInitialVelocity(this.angularVelocity2,l)}}class c{constructor(l=300,f=12,r=.84){this._minimumInitialVelocity=l;this._stopVelocity=f;this._friction=r;this.enabled=!0;this._tmpAxis1=h.create();this._tmpAxis2=h.create();this._tmpAngles=
b.create();this._time=new m.FilteredFiniteDifference(.3);this._screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this._angle1=new g.FilteredValue(.6);this._angle2=new g.FilteredValue(.6);this._axis1=h.create();this._axis2=h.create();this._lastScene=h.create()}addMomentumDirectRotation(l,f,r,x,w,p){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(r))return;x=k.rotationAngleAndAxisDirectRotation(this._lastScene,f,this._tmpAxis2,x,w,p);this._angle2.update(0);
1E-5>n.squaredLength(this._tmpAxis2)?x=0:n.normalize(this._axis1,this._tmpAxis2);this._angle1.update(x);n.copy(this._lastScene,f)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(r)}}addMomentumPreserveHeading(l,f,r,x,w,p,t){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(r))return;k.rotationAnglesAndAxesHeadingPreserving(this._lastScene,f,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,x,w,p,t,!1);1E-5>n.squaredLength(this._tmpAxis2)?(this._angle1.update(0),
this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),n.normalize(this._axis1,this._tmpAxis1),n.normalize(this._axis2,this._tmpAxis2));n.copy(this._lastScene,f)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(r)}}reset(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var l=this._screen[0].filteredDelta,
f=this._screen[1].filteredDelta;l=null==l||null==f?null:Math.sqrt(l*l+f*f);f=this._time.filteredDelta;l=null==l||null==f?0:l/f;return Math.abs(l)<this._minimumInitialVelocity?null:this.createMomentum(l,this._stopVelocity,this._friction)}createMomentum(l,f,r){const x=this._time.filteredDelta,w=this._angle1.filteredValue,p=this._angle2.filteredValue;return new d(l,f,r,null==x||null==w?0:w/x,this._axis1,null==x||null==p?0:p/x,this._axis2)}}a.PanSphericalMomentum=d;a.PanSphericalMomentumEstimator=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports"],function(a){class b{constructor(n){this._gain=n}update(n){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*n:n}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}a.FilteredValue=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports",
"./MomentumEstimator"],function(a,b){class n extends b.MomentumEstimator{constructor(h=3,k=.01,m=.95,g=12){super(h,k,m,g)}add(h,k){const m=this.value.lastValue;if(null!=m){for(h-=m;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=2*Math.PI;h=m+h}super.add(h,k)}}a.RotationMomentumEstimator=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,
n,h){class k{constructor(m=2.5,g=.01,e=.95,d=12){this._minimumInitialVelocity=m;this._stopVelocity=g;this._friction=e;this._maxVelocity=d;this.enabled=!0;this.value=new n.FilteredFiniteDifference(.8);this.time=new n.FilteredFiniteDifference(.3)}add(m,g){if(this.enabled&&null!=g){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(g))return;if(this.value.hasFilteredDelta()){const e=this.value.computeDelta(m);0>this.value.filteredDelta*e&&this.value.reset()}}this.time.update(g);this.value.update(m)}}reset(){this.value.reset();
this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let m=this.value.filteredDelta/this.time.filteredDelta;m=b.clamp(m,-this._maxVelocity,this._maxVelocity);return Math.abs(m)<this._minimumInitialVelocity?null:this.createMomentum(m,this._stopVelocity,this._friction)}createMomentum(m,g,e){return new h.Momentum(m,g,e)}}a.MomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports",
"./Momentum","./MomentumEstimator"],function(a,b,n){class h extends b.Momentum{constructor(m,g,e){super(m,g,e)}value(m){m=super.value(m);return Math.exp(m)}valueDelta(m,g){const e=super.value(m);m=super.value(m+g);return Math.exp(m-e)}}class k extends n.MomentumEstimator{constructor(m=2.5,g=.01,e=.95,d=12){super(m,g,e,d)}add(m,g){super.add(Math.log(m),g)}createMomentum(m,g,e){return new h(m,g,e)}}a.ZoomMomentum=h;a.ZoomMomentumEstimator=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintOptions ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../input/util ../../../layers/VoxelWasm ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J){const B=f.fromValues(0,0,1);var z=16/180*Math.PI;a.PinchAndPanController=class extends y.InteractiveController{constructor(){super(...arguments);this._rotationValueSmooth=new u.ExponentialFalloff(.05);this._scalingValueSmooth=new u.ExponentialFalloff(.05);this._planeHorizontal=x.create();this._planeVertical=x.create();this._rotationMomentumEstimator=new H.RotationMomentumEstimator;this._panMomentumEstimator=new I.PanPlanarMomentumEstimator(300,
12,.9);this._zoomMomentumEstimator=new J.ZoomMomentumEstimator;this._beginRadius=0;this._beginCenter=f.create();this._beginAngle=0;this._tmpPoints=[];this._panMode=C.NavigationMode.Horizontal;this._beginCenterScreen=h.createScreenPointArray();this._tmpCentroid3d=f.create();this._tmpCentroid2d=h.createScreenPointArray();this._tmp2d=h.createScreenPointArray();this._pointerCount=0;this._beginCamera=new E.Camera;this._constraintOptions=new p.ConstraintOptions(t.ConstraintTypes.ALL,q.InteractionType.NONE,
0,this._beginCamera)}begin(K){if(this.active){var L=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=L;this._rotationMomentumEstimator.enabled=L;this._panMomentumEstimator.enabled=L;this._beginRadius=K.radius;this._pointerCount=K.pointers.size;this._beginAngle=K.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();h.screenPointObjectToArray(K.center,this._beginCenterScreen);x.fromNormalAndOffset(B,0,this._planeHorizontal);var F=f.create();L=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,
F,0===this.view.map.ground.opacity?C.contentIntersectorOptions:{});var M=f.create();l.negate(M,this.startCamera.viewForward);var S=f.create();l.copy(S,B);var N=l.dot(M,S);this._panMode=n.asinClamped(0>N?-N:N)>=z?C.NavigationMode.Horizontal:C.NavigationMode.Vertical;var P=Math.min(C.panDistanceModifier,1/Math.abs(l.dot(S,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),C.minHeightLimit);x.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,F);this.startCamera.aboveGround||
x.negate(this._planeHorizontal,this._planeHorizontal);var R=f.create(),O=f.create(),T=f.create();l.subtract(R,F,this.currentCamera.eye);var Q=l.length(R);l.normalize(R,R);this._panMode===C.NavigationMode.Vertical?(l.scale(S,S,N),l.subtract(x.getNormal(this._planeVertical),M,S),l.normalize(x.getNormal(this._planeVertical),x.getNormal(this._planeVertical)),x.setOffsetFromPoint(this._planeVertical,this._planeVertical,F),F=this.view._stage.renderView.getMinimalDepthForArea(v.getVoxelWasm(this.view),this._beginCenterScreen[0],
this._beginCenterScreen[1],this.view.state.camera,C.screenPixelArea),P=null!=F?F:P,P=L?Math.min(P,Q):P,l.copy(T,l.add(O,this.currentCamera.eye,l.scale(O,R,P))),this._planeVertical[3]=-l.dot(x.getNormal(this._planeVertical),T),this._computePlanePoints(K.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(l.copy(T,l.add(O,this.currentCamera.eye,l.scale(O,R,L?Q:P))),this._planeHorizontal[3]=-l.dot(x.getNormal(this._planeHorizontal),T),this._computePlanePoints(K.pointers,this._planeHorizontal,
this.startCamera,this._tmpPoints));C.centroid(this._tmpPoints,this._beginCenter);this._beginCamera.copyFrom(this.startCamera)}}update(K){if(this.active){this.currentCamera.copyFrom(this.startCamera);var L=1<K.pointers.size,F=this._panMode===C.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,M=this._beginCenter;if(L){const S=this._beginRadius/K.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(K.radius,40),120);this._scalingValueSmooth.update(S);C.applyZoomToPoint(this.currentCamera,
M,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*K.timestamp);this._constraintOptions.interactionType=q.InteractionType.ZOOM;this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(K.radius-this._beginRadius));w.applyAll(this.view,this.currentCamera,this._constraintOptions)}this._computePlanePoints(K.pointers,F,this.currentCamera,this._tmpPoints);C.centroid(this._tmpPoints,
this._tmpCentroid3d);h.screenPointObjectToArray(K.center,this._tmpCentroid2d);C.applyPanPlanar(this.currentCamera,M,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*K.timestamp);this._constraintOptions.interactionType=q.InteractionType.PAN;this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(c.distance(this._beginCenterScreen,this._tmpCentroid2d));w.applyAll(this.view,this.currentCamera,this._constraintOptions);L&&(L=this._rotationValueSmooth.value,
F=C.normalizeRotationDelta(K.angle-L),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(K.radius,40),120),this._rotationValueSmooth.update(L+F),L=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(L,.001*K.timestamp),F=x.getNormal(this._planeHorizontal),C.applyRotation(this.currentCamera,M,r.wrapAxisAngle(F,L)),this._constraintOptions.interactionType=q.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(K.radius*
L)),w.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}}end(K){K.pointers.size===this._pointerCount&&this.update(K);this.finishController();return(K=this._zoomMomentumEstimator.evaluateMomentum())?new A.ZoomPlanarMomentumController({view:this.view,momentum:K,zoomCenter:this._beginCenter}):(K=this._rotationMomentumEstimator.evaluateMomentum())?new G.RotationMomentumController({view:this.view,momentum:K,center:this._beginCenter,axis:x.getNormal(this._planeHorizontal)}):
(K=this._panMomentumEstimator.evaluateMomentum())?new D.PanPlanarMomentumController({view:this.view,momentum:K}):null}_computePlanePoints(K,L,F,M){M.length=K.size;const S=this._tmp2d;let N=0;K.forEach(P=>{S[0]=P.x;S[1]=P.y;void 0===M[N]&&(M[N]=f.create());C.intersectPlaneFromScreenPointAtEye(L,F,S,M[N]);N+=1});return M}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};a.PinchAndPanController=b.__decorate([d.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../input/InputHandler"],function(a,b){class n extends b.InputHandler{constructor(h,k){super(!0);this.view=h;this.registerIncoming("pointer-down",k,()=>this.view.state.stopActiveCameraController())}}a.PointerDownCancelAnimation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports",
"./SingleKey"],function(a,b){class n extends b.SingleKey{constructor(h,k,m){super(k,m);this.view=h}activate(){this.view.goTo({heading:0}).catch(()=>{})}}a.SingleKeyResetHeading=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../input/InputHandler"],function(a,b){class n extends b.InputHandler{constructor(h,k){super(!0);this.key=h;this.registerIncoming("key-down",k,m=>this._handleKeyDown(m))}_handleKeyDown(h){h.data.key===
this.key&&(this.activate(),h.stopPropagation())}}a.SingleKey=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","./SingleKey"],function(a,b){class n extends b.SingleKey{constructor(h,k,m){super(k,m);this.view=h}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}a.SingleKeyResetTilt=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports",
"../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,b,n,h){class k extends h.InputHandler{constructor(m,g=!1){super(!0);this._view=m;this._invert=g;this.registerIncoming("vertical-two-finger-drag",e=>this._handleTwoFinger(e))}_handleTwoFinger(m){const g=b.createScreenPointArray(0,m.data.delta*(this._invert?-1:1));switch(m.data.action){case "begin":this._cameraController?.end();this._cameraController=new n.RotateController({view:this._view,
pivot:n.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(g);break;case "update":this._cameraController?.update(g);break;case "end":this._cameraController?.end(),this._cameraController=null}}}a.TwoFingerTilt=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define(["exports","../../core/has","../../core/maybe","./gamepad/GamepadSource","../support/screenUtils"],function(a,
b,n,h,k){const m=b("edge"),g=b("chrome"),e=b("ff"),d=b("safari");class c{constructor(f,r){this._input=r;this._active={};this._callback=()=>{};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=f;f.getAttribute("tabindex")||f.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new h.GamepadSource(f,this._input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}destroy(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(f=>
{this._releasePointerCaptureSafe(f)});this._gamepadSource=n.destroyMaybe(this._gamepadSource);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(f){this._browserTouchPanningEnabled=f;this._updateTouchAction();this._updateTouchEventHandling()}set onEventReceived(f){this._callback=f}set activeEvents(f){for(const r in this._active)f&&
f.has(r)||(this._element.removeEventListener(l[r],this._active[r]),delete this._active[r]);f&&f.forEach(r=>{if(!this._active[r]&&l[r]){const x=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(l[r],x);this._active[r]=x}});this._gamepadSource.hasEventListeners=f?.has("gamepad")??!1}setPointerCapture(f,r){r?this._setPointerCatpureSafe(f.pointerId):(this._releasePointerCaptureSafe(f.pointerId),this._activePointerCaptures.delete(f.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(f){try{this._element.setPointerCapture(f),this._activePointerCaptures.add(f)}catch{}}_releasePointerCaptureSafe(f){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(f)||this._element.releasePointerCapture(f)}catch(r){}}_updateNormalizedPointerLikeEvent(f,r){f=k.createScreenPointFromNativeEvent(this._element,f);c.test.disableSubpixelCoordinates&&(f.x=Math.round(f.x),f.y=Math.round(f.y));
r.x=f.x;r.y=f.y;return r}_handleKey(f,r){const {key:x}=r;x&&"key-up"===f&&this._keyDownState.delete(x);r={native:r,key:x,repeat:!!x&&this._keyDownState.has(x)};x&&"key-down"===f&&this._keyDownState.add(r.key);this._callback(f,r)}_handlePointer(f,r){r=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(f,r)}_handlePointerPreventDefault(f,r){const x=this._updateNormalizedPointerLikeEvent(r,{native:r,
x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault();this._callback(f,x)}_handleMouseWheel(f,r){let x=r.deltaY;switch(r.deltaMode){case 0:m&&(x=x/document.documentElement.clientHeight*600);break;case 1:x*=30;break;case 2:x*=900}m?x*=.7:g||d?x*=.6:e&&(x*=1.375);const w=Math.abs(x);100<w&&(x=x/w*200/(1+Math.exp(-.02*(w-100))));r=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:x});this._callback(f,r)}_handlePointerCaptureLost(f,
r){this._activePointerCaptures.delete(r.pointerId);this._handleDefault(f,r)}_handleDefault(f,r){const x={native:r};r.preventDefault();this._callback(f,x)}_preventAltKeyDefault(f){"Alt"===f.key&&f.preventDefault()}_preventMultiTouchPanning(f){1<f.touches.length&&f.preventDefault()}}c.test={disableSubpixelCoordinates:!1};const l={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture",
"pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,n,h){class k{constructor(m,g){this._element=m;this._input=g;this._hasEventListeners=
!1;this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)};this._onDisconnectGamepad=e=>{e=e.gamepad;const d=e.index,c=this._inputDevices[d];c&&(this._emitGamepadEvent(e,h.extractState(c),!1),this._inputDevices.splice(d,1),this._latestUpdate.splice(d,1),this._input.gamepad.devices.remove(c),this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;m=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&m)this._forEachGamepad(e=>
this._connectGamepad(e)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}destroy(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(m){this._hasEventListeners!==m&&(this._hasEventListeners=m,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&
0<this._inputDevices.length&&this._hasEventListeners}set onEvent(m){this._callback=m}_connectGamepad(m){const g=new n(m);"unknown"!==g.deviceType&&(this._inputDevices[m.index]=g,this._input.gamepad.devices.add(g));this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this._frameTask&&(this._frameTask=b.addFrameTask({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=
null,this._latestUpdate=[])}_readGamepadState(){const m=document.hasFocus(),g=this._element.contains(document.activeElement),e="document"===this._input.gamepad.enabledFocusMode&&!m||"view"===this._input.gamepad.enabledFocusMode&&!g;this._forEachGamepad(d=>{var c=this._inputDevices[d.index];if(c){var l=this._latestUpdate[d.index];c=h.extractState(c);var f=e||h.stateIdle(c);l&&(l.timestamp===d.timestamp||!l.active&&f||h.stateEqual(l.state,c))||this._emitGamepadEvent(d,c,!f)}})}_forEachGamepad(m){const g=
window.navigator.getGamepads();for(let e=0;e<g.length;e++){const d=g[e];this._validate(d)&&m(d)}}_emitGamepadEvent(m,g,e){var d=this._latestUpdate[m.index];if((d=d&&d.active)||e)this._latestUpdate[m.index]={timestamp:m.timestamp,state:g,active:e},this._callback&&this._callback({device:this._inputDevices[m.index],state:g,action:!d&&e?"start":d&&e?"update":"end"})}_validate(m){if(!m||!m.connected)return!1;for(let g=0;g<m.axes.length;g++)if(isNaN(m.axes[g]))return!1;return!0}}a.GamepadSource=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const n=b.native;return n?{buttons:n.buttons.map(h=>h.pressed?h.value||1:0),axes:n.axes.map(h=>{{var k=b.axisThreshold;const m=Math.abs(h);h=m<k?0:Math.sign(h)*(m-k)/(1-k)}return h})}:{buttons:[],axes:[]}};a.stateEqual=function(b,n){if(b.axes.length!==n.axes.length||b.buttons.length!==n.buttons.length)return!1;for(var h=0;h<b.axes.length;h++)if(b.axes[h]!==
n.axes[h])return!1;for(h=0;h<b.buttons.length;h++)if(b.buttons[h]!==n.buttons[h])return!1;return!0};a.stateIdle=function(b){for(var n=0;n<b.axes.length;n++)if(0!==b.axes[n])return!1;for(n=0;n<b.buttons.length;n++)if(0!==b.buttons[n])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../InputHandler"],function(a,b){class n extends b.InputHandler{constructor(){super(!0);this.registerIncoming("context-menu",
h=>{h.data.native.preventDefault()})}}a.PreventContextMenu=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define(["exports","../../../core/screenUtils","../../../core/time","../InputHandler","./support"],function(a,b,n,h,k){function m(l){const f=[];l.forEach(r=>{f.push(b.createScreenPoint(r.event.x,r.event.y))});return k.fitCircleLSQ(f)}function g(l){const f=m(l);let r=0;l.forEach(x=>{var w=d(x,f);for(w-=x.lastAngle;w>Math.PI;)w-=2*
Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;w=x.lastAngle+w;x.lastAngle=w;r+=w-x.initialAngle});r/=l.size||1;return{angle:r,radius:f.radius,center:f.center}}function e(l){const f=new Map;l.forEach((r,x)=>f.set(x,r.event));return f}function d(l,f){l=l.event;return Math.atan2(l.y-f.center.y,l.x-f.center.x)}class c extends h.InputHandler{constructor(l){super(!1);this._navigationTouch=l;this._startStateModifiers=new Set;this._activePointerMap=new Map;this._isCurrentDragSuppressed=this._isDragging=!1;this._drag=
this.registerOutgoing("drag");this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this));this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this));this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(l,f,r,x){return{action:l,pointerType:this._pointerType,button:this._mouseButton,buttons:f.buttons,timestamp:x,pointers:e(this._activePointerMap),
pointer:f,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(l){var f=l.native.pointerId;const r=g(this._activePointerMap).angle;l={event:l,initialAngle:0,lastAngle:0};this._activePointerMap.set(f,l);f=d(l,m(this._activePointerMap));l.initialAngle=f;l.lastAngle=f;this._updatePointerAngles(r)}_updatePointer(l){if(!l||null!=l.x||null!=l.y){var f=this._activePointerMap.get(l.native.pointerId);f?f.event=l:this._addPointer(l)}}_removePointer(l){const f=g(this._activePointerMap).angle;this._activePointerMap.delete(l);
this._updatePointerAngles(f)}_updatePointerAngles(l){const f=g(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=d(r,f)-l;r.lastAngle=d(r,f)-l})}_emitEvent(l,f,r){const x=g(this._activePointerMap);this._drag.emit(this._createPayload(l,f,x,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(l){const f=l.data.native.pointerId,r=n.Milliseconds(l.timestamp);this._activePointerMap.get(f)&&(1===this._activePointerMap.size?(this._updatePointer(l.data),!this._isCurrentDragSuppressed&&
this._emitEvent("end",l.data,r),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(f)):(this._removePointer(f),this._emitEvent("removed",l.data,n.Milliseconds(l.timestamp))))}_handlePointerDrag(l){const f=l.data,r=f.currentEvent,x=n.Milliseconds(l.timestamp);switch(f.action){case "start":case "update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,x)):(this._addPointer(r),this._emitEvent("added",
r,x),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=l.data.startEvent.pointerType,this._mouseButton=l.data.startEvent.button,this._startStateModifiers=l.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,x))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}a.Button=
void 0;(function(l){l[l.Left=0]="Left";l[l.Middle=1]="Middle";l[l.Right=2]="Right";l[l.Back=3]="Back";l[l.Forward=4]="Forward";l[l.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,
maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};a.euclideanDistance=function(n,h){const k=h.x-n.x;n=h.y-n.y;return Math.sqrt(k*k+n*n)};a.fitCircleLSQ=function(n,h){h?(h.radius=0,h.center.x=0,h.center.y=0):h={radius:0,center:b.createScreenPoint()};if(0===n.length)return h;if(1===n.length)return h.center.x=n[0].x,h.center.y=n[0].y,h;if(2===n.length){const [p,t]=n,[q,u]=[t.x-p.x,t.y-p.y];h.radius=Math.sqrt(q*q+u*u)/2;h.center.x=(p.x+t.x)/2;h.center.y=(p.y+t.y)/
2;return h}let k=0,m=0;for(h=0;h<n.length;h++)k+=n[h].x,m+=n[h].y;k/=n.length;m/=n.length;var g=n.map(p=>p.x-k),e=n.map(p=>p.y-m);let d=h=0;var c=0,l=0,f=0,r=0,x=0;for(var w=0;w<g.length;w++){const p=g[w],t=e[w],q=p*p,u=t*t;h+=q;d+=u;c+=p*t;l+=q*p;f+=u*t;r+=p*u;x+=t*q}g=h;e=c;w=d;l=.5*(l+r);f=.5*(f+x);x=g*w-c*e;r=(l*w-f*e)/x;f=(g*f-c*l)/x;x=b.createScreenPoint(r+k,f+m);return{radius:Math.sqrt(r*r+f*f+(h+d)/n.length),center:x}};a.getPointerId=function(n){({native:n}=n);const {pointerId:h,button:k,
pointerType:m}=n;return"mouse"===m?`${h}:${k}`:`${m}`};a.manhattanDistance=function(n,h){return Math.abs(h.x-n.x)+Math.abs(h.y-n.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define(["exports","../../../core/clock","../InputHandler","./support"],function(a,b,n,h){class k extends n.InputHandler{constructor(m=h.DefaultParameters.maximumDoubleClickDelay,g=h.DefaultParameters.maximumDoubleClickDistance,e=h.DefaultParameters.maximumDoubleTouchDelay,
d=h.DefaultParameters.maximumDoubleTouchDistance,c=b.clock){super(!1);this._maximumDoubleClickDelay=m;this._maximumDoubleClickDistance=g;this._maximumDoubleTouchDelay=e;this._maximumDoubleTouchDistance=d;this._clock=c;this._pointerState=new Map;this._immediateDoubleClick=this.registerOutgoing("immediate-double-click");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(m=>
{m.immediateDoubleClick&&m.immediateDoubleClick.timeoutHandle.remove()});super.onUninstall()}_handlePointerDown(m){m=m.data;const g=h.getPointerId(m);this._pointerState.has(g)||(this._pointerState.set(g,{downButton:m.native.button,x:m.x,y:m.y,immediateDoubleClick:null}),this.startCapturingPointer(m.native))}_handlePointerUp(m){const g=m.data;var e=h.getPointerId(g);if((e=this._pointerState.get(e))&&e.downButton===g.native.button){const d=e.immediateDoubleClick,c="touch"===m.data.native.pointerType?
this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;d?(d.timeoutHandle.remove(),h.manhattanDistance(d,m.data)>c?this._startImmediateDoubleClick(m,e):(this._immediateDoubleClick.emit(m.data,void 0,d.modifiers),this._removeState(g))):h.manhattanDistance(e,m.data)>c?this._removeState(g):this._startImmediateDoubleClick(m,e)}}_startImmediateDoubleClick(m,g){g.immediateDoubleClick={x:m.data.x,y:m.data.y,modifiers:m.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(m.data),
"touch"===m.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}}_removeState(m){const g=h.getPointerId(m);this._pointerState.delete(g);this.stopCapturingPointer(m.native);this.refreshHasPendingInputs()}}a.ImmediateDoubleClick=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(a,b,n,h,
k){class m extends h.InputHandler{constructor(g=k.DefaultParameters.maximumClickDelay,e=k.DefaultParameters.movementUntilMouseDrag,d=k.DefaultParameters.movementUntilPenDrag,c=k.DefaultParameters.movementUntilTouchDrag,l=k.DefaultParameters.holdDelay,f=b.clock){super(!1);this._maximumClickDelay=g;this._movementUntilMouseDrag=e;this._movementUntilPenDrag=d;this._movementUntilTouchDrag=c;this._holdDelay=l;this._clock=f;this._pointerState=new Map;this._pointerDrag=this.registerOutgoing("pointer-drag");
this._immediateClick=this.registerOutgoing("immediate-click");this._pointerHold=this.registerOutgoing("hold");this.registerIncoming("pointer-down",this._handlePointerDown.bind(this));this.registerIncoming("pointer-up",r=>{this._handlePointerLoss(r,"pointer-up")});this.registerIncoming("pointer-capture-lost",r=>{this._handlePointerLoss(r,"pointer-capture-lost")});this.registerIncoming("pointer-cancel",r=>{this._handlePointerLoss(r,"pointer-cancel")});this._moveHandle=this.registerIncoming("pointer-move",
this._handlePointerMove.bind(this));this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(g=>{g.holdTimeout=n.removeMaybe(g.holdTimeout)});super.onUninstall()}_handlePointerDown(g){const e=g.data,d=e.native.pointerId;var c=null;0===this._pointerState.size&&(c=this._clock.setTimeout(()=>{const l=this._pointerState.get(d);l&&(l.isDragging||(this._pointerHold.emit(l.previousEvent,void 0,g.modifiers),l.holdEmitted=!0),l.holdTimeout=null)},this._holdDelay));c={startEvent:e,previousEvent:e,
startTimestamp:g.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:c,modifiers:new Set};this._pointerState.set(d,c);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(g)}_createPointerDragData(g,e,d){return{action:g,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:d}}_handlePointerMove(g){const e=g.data,d=this._pointerState.get(e.native.pointerId);if(d){if(d.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
d,e),void 0,d.modifiers);else{const c=k.euclideanDistance(e,d.startEvent),l=this._getDragThreshold(e.native.pointerType);c>l&&this._startDragging(g)}d.previousEvent=e}}_getDragThreshold(g){switch(g){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(g){const e=g.data,d=e.native.pointerId;this._pointerState.forEach(c=>{null!=c.holdTimeout&&(c.holdTimeout.remove(),c.holdTimeout=null);c.isDragging||
(c.modifiers=g.modifiers,c.isDragging=!0,d===c.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",c,e)):this._pointerDrag.emit(this._createPointerDragData("start",c,c.previousEvent),g.timestamp))})}_handlePointerLoss(g,e){const d=g.data,c=d.native.pointerId,l=this._pointerState.get(c);l&&(null!=l.holdTimeout&&(l.holdTimeout.remove(),l.holdTimeout=null),l.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",l,"pointer-up"===e?d:l.previousEvent),void 0,
l.modifiers):"pointer-up"===e&&l.downButton===d.native.button&&g.timestamp-l.startTimestamp<=this._maximumClickDelay&&!l.holdEmitted&&this._immediateClick.emit(d),this._pointerState.delete(c),this.stopCapturingPointer(d.native),0===this._pointerState.size&&this._moveHandle.pause())}}a.PointerClickHoldAndDrag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,n,h,k,m){class g extends k.InputHandler{constructor(e=m.DefaultParameters.maximumDoubleClickDelay,d=m.DefaultParameters.maximumDoubleClickDistance,c=m.DefaultParameters.maximumDoubleTouchDelay,l=m.DefaultParameters.maximumDoubleTouchDistance,f=b.clock){super(!1);this._maximumDoubleClickDelay=e;this._maximumDoubleClickDistance=d;this._maximumDoubleTouchDelay=c;this._maximumDoubleTouchDistance=l;this._clock=f;this._pointerState=new Map;this._click=this.registerOutgoing("click");this._doubleClick=
this.registerOutgoing("double-click");this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this));this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=h.removeMaybe(e.doubleClickTimer))}get hasPendingInputs(){return n.someMap(this._pointerState,e=>null!=e.doubleClickTimer)}_clearDoubleClickTimer(e,d){const c=this._pointerState.get(e);c&&(c.doubleClickTimer=h.removeMaybe(c.doubleClickTimer),d&&this._click.emit(c.event.data,
void 0,c.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const d=this._pointerState.get(e);1===d.pointerDownCount&&this._click.emit(d.event.data,void 0,d.event.modifiers);d.doubleClickTimer=null;this._pointerState.delete(e);this.refreshHasPendingInputs()}_getPointerId(e){const {pointerId:d,pointerType:c,button:l}=e.native;return"mouse"===c?`${d}:${l}`:`${c}`}_handleImmediateClick(e){const d=e.data;var {pointerType:c}=d.native;const l=this._getPointerId(d);
if(this._pointerState.has(l)){var f=this._pointerState.get(l),{data:r,modifiers:x}=f.event;c="touch"===c?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;m.manhattanDistance(r,d)>c?(this._clearDoubleClickTimer(l,!0),this._startClick(e)):(this._clearDoubleClickTimer(l,!1),2===f.pointerDownCount&&this._doubleClick.emit(r,void 0,x))}else this._startClick(e)}_handlePointerDown(e){e=m.getPointerId(e.data);if(e=this._pointerState.get(e))e.pointerDownCount+=1}_startClick(e){var {data:d}=
e;const {native:{pointerType:c}}=d,l=m.getPointerId(d);d=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(l),"touch"===c?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(l,{event:e,doubleClickTimer:d,pointerDownCount:1});this.refreshHasPendingInputs()}}a.SingleAndDoubleClick=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../DragEventSeparator","../InputHandler"],
function(a,b,n){class h extends n.InputHandler{constructor(k=20,m=40){super(!1);this._threshold=k;this._maxDelta=m;this._state="ready";this._emittedArtificalEnd2=!1;this._vertical=this.registerOutgoing("vertical-two-finger-drag");this._artificalDrag=this.registerOutgoing("drag");this._dragEventSeparator=new b.DragEventSeparator({start:(g,e)=>this._observeStart(g,e),update:(g,e,d)=>this._observeUpdate(g,e,d),end:(g,e)=>this._observeEnd(e)});this.registerIncoming("drag",g=>this._dragEventSeparator.handle(g))}get failed(){return"failed"===
this._state}_observeStart(k,m){1===k&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),m.stopPropagation());this._state=2===k?"ready":"failed"}_observeUpdate(k,m,g){"failed"!==this._state&&2===k&&("active"===this._state?(this._vertical.emit({delta:m.data.center.y-
this._thresholdReachedCenter.y,action:"update"}),m.stopPropagation()):this._checkMovementWithinLimits(m.data,g.data)?this._checkVerticalThresholdReached(m.data,g.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=m.data.center,this._artificalDrag.emit({action:"end",button:m.data.button,buttons:m.data.buttons,pointerType:m.data.pointerType,timestamp:m.data.timestamp,pointers:m.data.pointers,pointer:m.data.pointer,angle:m.data.angle,radius:m.data.radius,center:m.data.center}),
this._vertical.emit({delta:m.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),m.stopPropagation()):this._state="failed")}_observeEnd(k){"active"===this._state&&(this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",k.stopPropagation())}_checkMovementWithinLimits(k,m){let g=-Infinity,e=Infinity,d=-Infinity,c=Infinity;for(const {x:w,y:p}of m.pointers.values())g=Math.max(g,w),e=Math.min(e,w),d=Math.max(d,p),c=Math.min(c,p);let l=-Infinity,
f=Infinity,r=-Infinity,x=Infinity;for(const {x:w,y:p}of k.pointers.values())l=Math.max(l,w),f=Math.min(f,w),r=Math.max(r,p),x=Math.min(x,p);return Math.abs(k.center.x-m.center.x)<this._threshold&&Math.abs(l-f-(g-e))<=this._maxDelta&&Math.abs(r-x-(d-c))<=this._maxDelta}_checkVerticalThresholdReached(k,m){let g=Math.abs(k.center.y-m.center.y);k.pointers.forEach((e,d)=>{d=m.pointers.get(d);g=Math.min(g,Math.abs(e.y-d.y))});return g>=this._threshold}}a.VerticalTwoFingerDrag=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){class b{constructor(n){this._callbacks=n;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(n){const h=n.data,k=h.pointers.size;switch(h.action){case "start":this._currentCount=k;this._emitStart(n);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(n);break;case "update":this._emitUpdate(n);break;case "removed":this._startEvent&&
this._emitEnd(this._previousEvent);this._currentCount=k;this._emitStart(n);break;case "end":this._emitEnd(n),this._currentCount=0}this._previousEvent=n}_emitStart(n){this._startEvent=n;this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.start(this._currentCount,n,this._startEvent)}_emitUpdate(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.update(this._currentCount,n,this._startEvent)}_emitEnd(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.end(this._currentCount,
n,this._startEvent);this._startEvent=null}}a.DragEventSeparator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/Error ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(q){q=q.layer;return!(!q?.featureReduction||"selection"!==q.featureReduction.type)}function t(q){(q=q.graphics3DGraphics)&&q.forEach(u=>u.setVisibilityFlag(r.VisibilityGroup.GRAPHIC,r.VisibilityFlag.DECONFLICTION,!0))}a.GraphicsDeconflictor=class extends f.Deconflictor{constructor(){super(...arguments);this._contexts=new Map;this.visibilityGroup=r.VisibilityGroup.GRAPHIC;this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([k.watch(()=>
this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),k.watch(()=>this.view?.map?.ground?.opacity,(q,u)=>{1!==q&&1!==u||this.setDirty()}),k.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},k.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(w.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new x.LabelDeconflictor({view:this.view,parent:this})}destroy(){this._labels=h.destroyMaybe(this._labels);this._frameTask=
h.removeMaybe(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(q){this._marginFactor=q;this.setDirty()}setDirty(){0<this._contexts.size&&(super.setDirty(),this._labels.setDirty())}runTask(q){super.runTask(q);this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(q,u){q=!(this._graphicSupportsDeconfliction(u)&&p(q));u.setVisibilityFlag(r.VisibilityGroup.GRAPHIC,r.VisibilityFlag.DECONFLICTION,q)}_updateViewState(){this.view?.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this._updateSlicePlane())}_updateSlicePlane(){const q=this.view?this.view.slicePlane:null;null!=q&&l.transform(q,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=null!=q}_slicePlaneChanged(){n.someMap(this._contexts,(q,u)=>u.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(q){const u=this._getGraphicsContext(q);return{addGraphic:v=>this._addGraphic(q,u,v),removeGraphic:v=>this._removeGraphic(u,v),labelingInfoChange:()=>this._labels.enabledChanged(q,
u),featureReductionChange:()=>this.enabledChanged(q,u),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(q,u),clear:()=>u.forEach(v=>this._removeGraphic(u,v.graphics3DGraphic))}}removeGraphicsOwner(q){const u=this._contexts.get(q);u&&(u.forEach(v=>this._removeGraphic(u,v.graphics3DGraphic)),this._contexts.delete(q),this.setDirty())}_addGraphic(q,u,v){const y=v.graphic.uid;v=new f.DeconflictorGraphic(v,q.symbolCreationContext.slicePlaneEnabled);u.set(y,v);p(q)&&this.addToActiveGraphics(v);
q.labelsEnabled&&this._labels.addToActiveGraphics(v)}_removeGraphic(q,u){u=u.graphic.uid;const v=q.get(u);v&&(this.removeFromActiveGraphics(v),this._labels.removeFromActiveGraphics(v),q.delete(u),this.setDirty())}enabledChanged(q,u){const v=p(q);v||t(q);this.modifyGraphics(u,v)}_slicePlaneEnabledChanged(q,u){const v=q.symbolCreationContext.slicePlaneEnabled;u.forEach(y=>y.slicePlaneEnabled=v);this.setDirty()}getGraphicsLayers(q){return q.layers}_graphicSupportsDeconfliction(q){if(q.isDraped)return!1;
q=q.layers;if(!q?.length)return!1;for(const u of q)if(this.layerSupportsDeconfliction(u))return!0;return!1}_getGraphicsContext(q){var u=this._contexts.get(q);if(u)return u;u=new Map;this._contexts.set(q,u);this.setDirty();return u}};a.GraphicsDeconflictor=b.__decorate([c.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J){function*B(ia){if(Map.prototype.entries){ia=ia.entries();for(let fa=ia.next();!fa.done;fa=ia.next())yield fa.value[1]}else yield*ia.values()}function*z(ia,fa,da){fa.clear();ia.forEach((ea,ha)=>{const Y=fa.pushNew();Y.id=ha;Y.visible=ea.graphics3DGraphic.getVisibilityFlag(da,A.VisibilityFlag.DECONFLICTION);ha=ea.info?.[da];Y.prio=ea.graphics3DGraphic.deconflictionPriority;Y.distance=ha?ha.distance:Number.MAX_VALUE});yield;const aa=
fa.iterableSort((ea,ha)=>ea.prio!==ha.prio?ha.prio-ea.prio:ea.distance!==ha.distance?ea.distance-ha.distance:ea.visible!==ha.visible?ea.visible?-1:1:ea.id-ha.id);for(let ea=aa.next();!ea.done;ea=aa.next())yield;fa.forAll(ea=>{const ha=ia.get(ea.id);ha&&(ia.delete(ea.id),ia.set(ea.id,ha))});fa.clear()}const K=w.create(),L=t.create(),F=t.create(),M=w.create(),S=f.create(),N=D.create(),P=y.create(),R=w.create(),O=u.create();class T{constructor(){this.aabr=u.create();this.distance=0;this.visible=this.culled=
!1}}class Q{constructor(ia,fa){this.graphics3DGraphic=ia;this.slicePlaneEnabled=fa;this.info={}}}a.State=void 0;(function(ia){ia[ia.Idle=0]="Idle";ia[ia.Process=1]="Process";ia[ia.Sort=2]="Sort";ia[ia.Deconflict=3]="Deconflict";ia[ia.NumStates=4]="NumStates"})(a.State||(a.State={}));class V{constructor(){this.camera=new C.Camera;this.slicePlane=v.create();this.slicePlaneEnabled=!1}copyFrom(ia){this.camera.copyFrom(ia.camera);v.copy(ia.slicePlane,this.slicePlane);this.slicePlaneEnabled=ia.slicePlaneEnabled}}
a.Deconflictor=class extends n{get dirty(){return this._dirty}get state(){return this._state}constructor(ia){super(ia);this._dirty=!1;this._viewState=new V;this._state=a.State.Idle;this._active=new Map;this._visible=new Map;this._iterators=new W;this._accBinsNumX=15;this._accBinsNumY=20;this._accBinsSizeY=this._accBinsSizeX=0;this._accBins=null;this.accNumTests=0}destroy(){this._active.clear();this._visible.clear();this._iterators=null}setDirty(){!this._dirty&&0<this._active.size&&(this._dirty=!0,
this.notifyChange("updating"))}get updating(){return this._state!==a.State.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const ia=this._state/a.State.NumStates;return this._dirty?.5*ia:ia}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(ia){switch(this._state){case a.State.Idle:this._startUpdate(),ia.madeProgress();case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(ia))break;case a.State.Sort:if(this._state=a.State.Sort,
!this._sortVisibleGraphics(ia))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ia))break;default:G.drawAccelerationStruct(this,this._visible),this._state=a.State.Idle,this.notifyChange("updating")}}modifyGraphics(ia,fa){fa?ia.forEach(da=>this.addToActiveGraphics(da)):ia.forEach(da=>this.removeFromActiveGraphics(da));this.setDirty()}layerSupportsDeconfliction(ia){if(null==ia||"object3d"!==ia.type)return!1;ia=ia.stageObject;return 1===(ia?.geometries.length??
0)&&ia?.geometries[0]?.material instanceof H.HUDMaterial?!0:!1}_startUpdate(){G.prepare(this.view);this._dirty=!1;this._viewState.copyFrom(this.viewState);const {fullWidth:ia,fullHeight:fa}=this._viewState.camera;this._initBins(ia,fa);this._resetIterators()}addToActiveGraphics(ia){ia.info[this.visibilityGroup]=new T;this._active.set(ia.graphics3DGraphic.graphic.uid,ia);this.setDirty()}removeFromActiveGraphics(ia){this._visible.delete(ia.graphics3DGraphic.graphic.uid);const fa=ia.graphics3DGraphic;
fa.destroyed||fa.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,!0);delete ia.info[this.visibilityGroup];this._active.delete(ia.graphics3DGraphic.graphic.uid);this.setDirty()}_processActiveGraphics(ia){const fa=this._ensureActiveGraphicsIterator(),da=l.invertOrIdentity(S,this._viewState.camera.projectionMatrix),aa="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._viewState.camera.relativeElevation?N:null;let ea=0;null!=aa&&(x.transformMat4(D.getCenter(aa),
w.ZEROS,this._viewState.camera.viewMatrix),aa[3]=q.getReferenceEllipsoid(this.view.spatialReference).radius,ea=D.distanceToSilhouette(aa,w.ZEROS));for(;!ia.done;){ia.madeProgress();var ha=fa.next();if(!0===ha.done)return this._resetActiveGraphicsIterator(),!0;ha=ha.value;const Y=ha?.info[this.visibilityGroup];Y&&(this._collectGraphics3DGraphics(ha,da,aa,ea),Y.culled?this._visible.delete(ha.graphics3DGraphic.graphic.uid):this._visible.set(ha.graphics3DGraphic.graphic.uid,ha))}return!1}_sortVisibleGraphics(ia){const fa=
this._ensureSortGraphicsIterator();for(;!ia.done;){const da=fa.next();ia.madeProgress();if(!0===da.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(ia){const fa=this._ensureVisibleGraphicsIterator(),da=this.visibilityGroup===A.VisibilityGroup.LABEL;for(;!ia.done;){ia.madeProgress();var aa=fa.next();if(!0===aa.done)return this._resetVisibleGraphicsIterator(),!0;aa=aa.value;const ha=aa.info[this.visibilityGroup];if(!ha||ha.culled)this._setGraphicVisibility(aa,!1);
else{var ea=aa.graphics3DGraphic;ea=!da||ea.isVisible();ha.visible=ea&&!this._isConflicted(aa);ha.visible&&this._addToBins(aa);this._setGraphicVisibility(aa,ha.visible);G.drawPoly(ha,ha.visible)}}return!1}_resetIterators(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null}_ensureActiveGraphicsIterator(){this._iterators.active||(this._iterators.active=B(this._active));return this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){this._iterators.visible||
(this._iterators.visible=B(this._visible));return this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){this._iterators.sort||(this._iterators.sort=z(this._visible,this._iterators.sortArray,this.visibilityGroup));return this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(ia,fa,da,aa){var ea=ia.graphics3DGraphic;if(!ea.destroyed){var ha=ia.info[this.visibilityGroup];if(ea.isVisible(A.VisibilityGroup.GRAPHIC,
A.VisibilityFlag.DECONFLICTION)){var Y=this.getGraphicsLayers(ea);u.empty(ha.aabr);ea=null;for(const Z of Y)if(this.layerSupportsDeconfliction(Z)){Y=Z.stageObject.geometries[0].material;if(null==ea&&(ea=ba,this._getProjectionInfo(Z,fa,ea),ea.isOutsideScreen||this._isCulledBySlice(ia,K)||null!=da&&this._isCulledByHorizon(ea,da,aa))){ha.culled=!0;return}this._expandBoundingRect(ha,Z,Y,ea)}null==ea?ha.culled=!0:(ha.distance=ea.distance,ha.culled=!1)}else ha.culled=!0}}_getProjectionInfo(ia,fa,da){const aa=
this._viewState.camera;ia=ia.stageObject;var ea=ia.geometries[0];const ha=ea.material;var Y=D.getCenter(ia.boundingVolumeWorldSpace.bounds);x.transformMat4(K,Y,aa.viewMatrix);Y=ea.attributes;ea=Y.get(I.VertexAttribute.NORMAL).data;Y=Y.get(I.VertexAttribute.CENTEROFFSETANDDISTANCE).data;ha.applyShaderOffsetsView(K,ea,ia.transformation,Y,aa,da.scaleInfo,K);p.set(L,K[0],K[1],K[2],1);p.transformMat4(F,L,aa.projectionMatrix);x.scale(da.positionNDC,F,1/F[3]);ha.applyShaderOffsetsNDC(da.positionNDC,Y,aa,
da.positionNDC,M);da.distanceWithoutPolygonOffset=aa.depthNDCToWorld(M[2]);da.distance=M[2]===da.positionNDC[2]?da.distanceWithoutPolygonOffset:aa.depthNDCToWorld(da.positionNDC[2]);p.set(F,da.positionNDC[0],da.positionNDC[1],da.positionNDC[2],1);p.transformMat4(L,F,fa);p.scale(L,L,1/L[3]);x.set(da.positionView,K[0],K[1],K[2])}_isCulledByHorizon(ia,fa,da){x.copy(P.direction,ia.positionView);x.set(P.origin,0,0,0);return D.intersectRay(fa,P,R)?ia.distanceWithoutPolygonOffset>da:!1}_isCulledBySlice(ia,
fa){return ia.slicePlaneEnabled&&this._viewState.slicePlaneEnabled&&v.extrusionContainsPoint(this._viewState.slicePlane,fa)}_expandBoundingRect(ia,fa,da,{positionNDC:aa,scaleInfo:ea}){const ha=this._viewState.camera;fa=fa.getScreenSize(ca);E.applyPrecomputedScaleFactor(fa,ea.factor,fa);fa[0]*=ha.pixelRatio;fa[1]*=ha.pixelRatio;da=u.offset(da.calculateRelativeScreenBounds(fa,ea.factorAlignment.scale,O),h.lerp(0,ha.fullWidth,.5+.5*aa[0]),h.lerp(0,ha.fullHeight,.5+.5*aa[1]));aa=this.marginFactor;0!==
aa&&(aa*=Math.min(u.width(da),u.height(da)),da[0]-=aa,da[1]-=aa,da[2]+=aa,da[3]+=aa);u.expand(ia.aabr,da,ia.aabr)}_isConflicted(ia){const fa=ia.graphics3DGraphic.graphic.uid;ia=ia.info[this.visibilityGroup];let da=!0;for(let aa=Math.floor(ia.aabr[0]/this._accBinsSizeX);aa<=Math.floor(ia.aabr[2]/this._accBinsSizeX);aa++)if(!(0>aa||aa>=this._accBinsNumX))for(let ea=Math.floor(ia.aabr[1]/this._accBinsSizeY);ea<=Math.floor(ia.aabr[3]/this._accBinsSizeY);ea++){if(0>ea||ea>=this._accBinsNumY)continue;da=
!1;const ha=this._accBins[aa][ea];for(let Y=0;Y<ha.length;Y++){const Z=ha.data[Y],ja=Z.info[this.visibilityGroup];if(ja&&ja.visible&&Z.graphics3DGraphic.graphic.uid!==fa&&(this.accNumTests++,u.intersects(ja.aabr,ia.aabr)))return!0}}return da}_initBins(ia,fa){if(null==this._accBins){this._accBins=[];for(var da=0;da<this._accBinsNumX;da++){this._accBins.push([]);var aa=this._accBins[this._accBins.length-1];for(let ea=0;ea<this._accBinsNumY;ea++)aa.push(new k)}}else for(da=0;da<this._accBinsNumX;da++)for(aa=
0;aa<this._accBinsNumY;aa++)this._accBins[da][aa].clear();this._accBinsSizeX=ia/this._accBinsNumX;this._accBinsSizeY=fa/this._accBinsNumY;this.accNumTests=0}_addToBins(ia){var fa=ia.info[this.visibilityGroup],da=Math.floor(fa.aabr[0]/this._accBinsSizeX);const aa=Math.floor(fa.aabr[2]/this._accBinsSizeX),ea=Math.floor(fa.aabr[1]/this._accBinsSizeY);for(fa=Math.floor(fa.aabr[3]/this._accBinsSizeY);da<=aa;da++)if(!(0>da||da>=this._accBinsNumX))for(let ha=ea;ha<=fa;ha++)0>ha||ha>=this._accBinsNumY||this._accBins[da][ha].push(ia)}_setGraphicVisibility(ia,
fa){ia=ia.graphics3DGraphic;ia.destroyed||(ia.setVisibilityFlag(this.visibilityGroup,A.VisibilityFlag.DECONFLICTION,fa),this.visibilityGroup===A.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ia,fa))}};b.__decorate([m.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([m.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([c.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);
class U{constructor(){this.id=0;this.visible=!1;this.distance=this.prio=0}}class W{constructor(ia=null,fa=null,da=null){this.active=ia;this.visible=fa;this.sort=da;this.sortArray=new k({allocator:aa=>aa||new U})}}const ca=r.create();class X{constructor(){this.positionView=w.create();this.positionNDC=w.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new J.ScaleInfo}get isOutsideScreen(){const ia=this.positionNDC;return-1>ia[0]||-1>ia[1]||-1>ia[2]||1<=ia[0]||1<=ia[1]}}const ba=
new X;a.DeconflictorGraphic=Q;a.DeconflictorViewState=V;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function n(l,f,r,x,w){e&&(e(),e=null);const p=d.height,t=c;t.beginPath();t.lineWidth=1;t.strokeStyle=w;t.moveTo(l,p-r);t.lineTo(f,p-r);t.stroke();t.lineTo(f,p-x);t.stroke();t.lineTo(f,p-r);t.stroke();t.lineTo(l,p-r);t.stroke();t.lineTo(l,p-r);t.stroke();t.closePath()}
let h=!1,k=!1,m=!1,g=!1,e=null,d,c;a.drawAccelerationStruct=function(l,f){if(k&&c){e&&(e(),e=null);var r=c,x=0;for(let w=0;w<l.accBinsNumX;w++)for(let p=0;p<l.accBinsNumY;p++){const t=l.accBins[w][l.accBinsNumY-1-p];x+=t.length;const q=w*l.accBinsSizeX,u=(w+1)*l.accBinsSizeX,v=p*l.accBinsSizeY,y=(p+1)*l.accBinsSizeY;r.fillText(t.length.toFixed(),q+5,v+15);n(q,u,v,y,"blue")}r.fillText("total totalShownLabels: "+x,70,40);r.fillText("total visible labels: "+f.size,70,50);r.fillText("total numTests: "+
l.accNumTests,70,30)}};a.drawPoly=function(l,f){h&&(f&&m||!f&&g)&&n(l.aabr[0],l.aabr[2],l.aabr[1],l.aabr[3],f?"green":"red")};a.prepare=function(l){m=b.debugFlags.DECONFLICTOR_SHOW_VISIBLE;g=b.debugFlags.DECONFLICTOR_SHOW_INVISIBLE;h=m||g;k=b.debugFlags.DECONFLICTOR_SHOW_GRID;e=null;h||k?e=()=>{null==d&&(d=document.createElement("canvas"),d.setAttribute("id","debugCanvas2d"),l.surface.parentElement.style.position="relative",l.surface.parentElement.appendChild(d));var {state:f}=l;const {camera:r,pixelRatio:x}=
f,{width:w,height:p}=r;f=p*x;d.setAttribute("width",`${w*x}px`);d.setAttribute("height",`${f}px`);d.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${w}px;height:${p}px`);c=d.getContext("2d");c.clearRect(0,0,w,p);c.font="12px Arial"}:d&&(d.parentElement.removeChild(d),d=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){n=class extends n{constructor(){super(...arguments);this.LINE_WIREFRAMES=this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=this.I3S_SHOW_MODIFICATIONS=this.I3S_TREE_SHOW_TILES=this.TERRAIN_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_TREE_SHOW_TILES=this.FEATURE_TILE_FETCH_SHOW_TILES=this.DRAW_MESH_GEOMETRY_NORMALS=this.TESTS_DISABLE_FAST_UPDATES=this.TESTS_DISABLE_OPTIMIZATIONS=this.SHOW_POI=this.OVERLAY_SHOW_CENTER=
this.OVERLAY_DRAW_DEBUG_TEXTURE=this.TEXT_SHOW_BORDER=this.TEXT_SHOW_BASELINE=this.LABELS_SHOW_BORDER=this.DECONFLICTOR_SHOW_GRID=this.DECONFLICTOR_SHOW_INVISIBLE=this.DECONFLICTOR_SHOW_VISIBLE=this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1}};b.__decorate([h.property()],n.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([h.property()],n.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([h.property()],n.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);b.__decorate([h.property()],
n.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([h.property()],n.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([h.property()],n.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([h.property()],n.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([h.property()],n.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([h.property()],n.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([h.property()],n.prototype,"SHOW_POI",void 0);b.__decorate([h.property()],n.prototype,"TESTS_DISABLE_OPTIMIZATIONS",
void 0);b.__decorate([h.property()],n.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([h.property()],n.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([h.property()],n.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([h.property()],n.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([h.property()],n.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([h.property()],n.prototype,"I3S_TREE_SHOW_TILES",void 0);b.__decorate([h.property()],n.prototype,
"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([h.property()],n.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([h.property()],n.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([h.property()],n.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([h.property()],n.prototype,"LINE_WIREFRAMES",void 0);n=b.__decorate([e.subclass("esri.views.3d.support.DebugFlags")],n);b=new n;a.debugFlags=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityFlag=void 0;(function(b){b[b.USER=1]="USER";b[b.SCALE_RANGE=2]="SCALE_RANGE";b[b.FILTER=4]="FILTER";b[b.DECONFLICTION=8]="DECONFLICTION";b[b.ALL_GRAPHIC=15]="ALL_GRAPHIC";b[b.ALL_LABEL=255]="ALL_LABEL"})(a.VisibilityFlag||(a.VisibilityFlag={}));a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=1]="GRAPHIC";b[b.LABEL=16]="LABEL"})(a.VisibilityGroup||(a.VisibilityGroup={}));Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,n){function h(c,l,f){f=f.parameters;e.scale=Math.min(f.divisor/(l-f.offset),1);e.factor=Math.abs(c*c*c);return e}function k(c,l){return b.lerp(c*Math.max(l.scale,l.minScaleFactor),c,l.factor)}class m{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(c,
l,f,r={camera:{distance:0,fovY:0},divisor:0,offset:0},x){this._viewingMode=c;this._description=l;this._ellipsoidRadius=f;this.parameters=r;this._fontHeight=x;this._viewingMode===n.ViewingMode.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(c){if(this.parameters&&
this.parameters.camera.fovY===c.fovY&&this.parameters.camera.distance===c.distance)return!1;this._calculateParameters(c,this._ellipsoidRadius,this.parameters);return!0}overrideFontHeight(c){return c!==this._fontHeight?new m(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,c):this}_calculateParameters(c,l,f){const {scaleStart:r,scaleFallOffRange:x}=this._description,{fovY:w,distance:p}=c;var t=this._calculateCurvatureDependentParameters(c,l);l=this._coverageCompensation(c,
l,t);const {tiltAngle:q,scaleFallOffFactor:u}=t,v=Math.sin(q)*p,y=.5*Math.PI-q-w*(.5-r*l);t=v/Math.cos(y);l=(t-v/Math.cos(y+w*x*l)*u)/(1-u);f.camera.fovY=c.fovY;f.camera.distance=c.distance;f.offset=l;f.divisor=t-l;return f}_calculateCurvatureDependentParametersLocal(c,l,f=d){f.tiltAngle=this._description.curvatureDependent.min.tiltAngle;f.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return f}_calculateCurvatureDependentParametersGlobal(c,l,f=d){const r=this._description.curvatureDependent;
c=1+c.distance/l;c=Math.sqrt(c*c-1);const [x,w]=[r.min.curvature,r.max.curvature];c=b.clamp((c-x)/(w-x),0,1);const [p,t]=[r.min,r.max];f.tiltAngle=b.lerp(p.tiltAngle,t.tiltAngle,c);f.scaleFallOffFactor=b.lerp(p.scaleFallOffFactor,t.scaleFallOffFactor,c);return f}_surfaceCoverageCompensationLocal(c,l,f){return(c.fovY-f.tiltAngle)/c.fovY}_surfaceCoverageCompensationGlobal(c,l,f){const r=l*l;f=f.tiltAngle+.5*Math.PI;const {fovY:x,distance:w}=c;c=w*w+r-2*Math.cos(f)*w*l;const p=Math.sqrt(c);return(Math.acos(Math.sqrt(c-
r)/p)-Math.asin(l/(p/Math.sin(f)))+.5*x)/x}}const g={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},e={scale:0,factor:0,minScaleFactor:0},d={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(c,l,f=[0,0]){l=Math.min(Math.max(l.scale,l.minScaleFactor),1);f[0]=c[0]*l;f[1]=c[1]*l;return f};a.applyScaleFactor=
k;a.getLabelSettings=function(c,l){const {curvatureDependent:f,scaleStart:r,scaleFallOffRange:x}=g;return new m(c,{curvatureDependent:{min:{curvature:f.min.curvature,tiltAngle:f.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:f.max.curvature,tiltAngle:f.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:r,scaleFallOffRange:x,minPixelSize:14},l)};a.getSettings=function(c,l){return new m(c,g,l)};a.precomputeScaleFactor=function(c,l,f,r){c=h(c,l,f);c.minScaleFactor=0;c=k(1,c);r.scale=c;r.factor=0;
r.minScaleFactor=f.minScaleFactor};a.scale=function(c,l,f,r){return k(c,h(l,f,r))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../layers/support/FastSymbolUpdates ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){function K(ha,Y,Z,ja,oa,qa,ta,va){Y=Y-oa-(0<va[0]?ja[0]*va[0]:0);let Ca=Y+ja[0]+2*oa;Z=Z-oa-(0<va[1]?ja[1]*va[1]:0);oa=Z+ja[1]+2*oa;va=ta.distanceFieldBoundingBox;ta.textureIsSignedDistanceField&&null!=va&&(Y+=ja[0]*va[0],Z+=ja[1]*va[1],Ca-=ja[0]*(1-va[2]),oa-=ja[1]*(1-va[3]),Y-=qa,Ca+=qa,Z-=qa,oa+=qa);return ha[0]>Y&&ha[0]<Ca&&ha[1]>Z&&ha[1]<oa}class L extends y.Material{constructor(ha){super(ha,new fa);this._configuration=new z.HUDMaterialTechniqueConfiguration;
this.produces=new Map([[D.RenderSlot.HUD_MATERIAL,Y=>q.isColorAlphaHighlightOrOID(Y)&&!this.parameters.drawInSecondSlot],[D.RenderSlot.LABEL_MATERIAL,Y=>q.isColorAlphaHighlightOrOID(Y)&&this.parameters.drawInSecondSlot],[D.RenderSlot.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[D.RenderSlot.DRAPED_MATERIAL,Y=>q.isColorAlphaHighlightOrOID(Y)]])}getConfiguration(ha,Y){this._configuration.output=ha;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=
!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.draped=this.parameters.draped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=
this.parameters.textureIsSignedDistanceField;this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.occlusionPass=Y.slot===D.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest;ha===q.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!p.debugFlags.LABELS_SHOW_BORDER);this._configuration.depthEnabled=
this.parameters.depthEnabled;this._configuration.transparencyPassType=Y.transparencyPassType;this._configuration.multipassEnabled=Y.multipassEnabled;this._configuration.cullAboveGround=Y.multipassTerrain.cullAboveGround;return this._configuration}intersect(ha,Y,Z,ja,oa,qa){if(Z.options.selectionMode&&Z.options.hud&&ha.visible&&Z.point){ja=this.parameters;oa=Z.point;var ta=Z.camera,{scaleX:va,scaleY:Ca}=this._getScreenScale(ha);va*=ta.pixelRatio;Ca*=ta.pixelRatio;h.fromMat4(T,Y);if(ha.attributes.has(C.VertexAttribute.FEATUREATTRIBUTE)){var ma=
T,wa=ma[0],Ba=ma[1],pa=ma[2],Aa=ma[3],ra=ma[4],ua=ma[5],Ea=ma[6],Ka=ma[7];const Ma=ma[8],Ua=1/Math.sqrt(wa*wa+Ba*Ba+pa*pa),Ga=1/Math.sqrt(Aa*Aa+ra*ra+ua*ua),Na=1/Math.sqrt(Ea*Ea+Ka*Ka+Ma*Ma);ma[0]=wa*Ua;ma[1]=Ba*Ua;ma[2]=pa*Ua;ma[3]=Aa*Ga;ma[4]=ra*Ga;ma[5]=ua*Ga;ma[6]=Ea*Na;ma[7]=Ka*Na;ma[8]=Ma*Na}ma=ha.attributes.get(C.VertexAttribute.POSITION);wa=ha.attributes.get(C.VertexAttribute.SIZE);Ba=ha.attributes.get(C.VertexAttribute.NORMAL);ha=ha.attributes.get(C.VertexAttribute.CENTEROFFSETANDDISTANCE);
A.assert(3<=ma.size);pa=J.calculateAnchorPosForRendering(ja);Aa="screen"===this.parameters.centerOffsetUnits;for(ra=0;ra<ma.data.length/ma.size;ra++)ua=ra*ma.size,d.set(S,ma.data[ua],ma.data[ua+1],ma.data[ua+2]),d.transformMat4(S,S,Y),ua=ra*wa.size,ba[0]=wa.data[ua]*va,ba[1]=wa.data[ua+1]*Ca,d.transformMat4(S,S,ta.viewMatrix),ua=ra*ha.size,d.set(U,ha.data[ua],ha.data[ua+1],ha.data[ua+2]),Aa||(S[0]+=U[0],S[1]+=U[1],0!==U[2]&&(ua=U[2],d.normalize(U,S),d.subtract(S,S,d.scale(U,U,ua)))),ua=ra*Ba.size,
d.set(N,Ba.data[ua],Ba.data[ua+1],Ba.data[ua+2]),this._normalAndViewAngle(N,T,ta,X),this._applyVerticalOffsetTransformationView(S,X,ta,M),ta.applyProjection(S,P),-1<P[0]&&(Aa&&(U[0]||U[1])&&(P[0]+=U[0]*ta.pixelRatio,0!==U[1]&&(P[1]+=G.applyScaleFactor(U[1],M.factorAlignment)*ta.pixelRatio),ta.unapplyProjection(P,S)),P[0]+=this.parameters.screenOffset[0]*ta.pixelRatio,P[1]+=this.parameters.screenOffset[1]*ta.pixelRatio,P[0]=Math.floor(P[0]),P[1]=Math.floor(P[1]),G.applyPrecomputedScaleFactor(ba,M.factor,
ba),ua=1*ta.pixelRatio,Ea=0,ja.textureIsSignedDistanceField&&(Ea=ja.outlineSize*ta.pixelRatio/2),K(oa,P[0],P[1],ba,ua,Ea,ja,pa)&&(Ea=Z.ray,d.transformMat4(O,S,m.invert(V,ta.viewMatrix)),P[0]=oa[0],P[1]=oa[1],ta.unprojectFromRenderScreen(P,S)&&(ua=c.create(),d.copy(ua,Ea.direction),Ka=1/d.length(ua),d.scale(ua,ua,Ka),Ea=d.distance(Ea.origin,S)*Ka,qa(Ea,ua,-1,!0,1,O))))}}intersectDraped(ha,Y,Z,ja,oa,qa){Y=ha.attributes.get(C.VertexAttribute.POSITION);Z=ha.attributes.get(C.VertexAttribute.SIZE);const ta=
this.parameters,va=J.calculateAnchorPosForRendering(ta);let {scaleX:Ca,scaleY:ma}=this._getScreenScale(ha);Ca*=ha.screenToWorldRatio;ma*=ha.screenToWorldRatio;const wa=2*ha.screenToWorldRatio;for(let Aa=0;Aa<Y.data.length/Y.size;Aa++){var Ba=Aa*Y.size;const ra=Y.data[Ba];Ba=Y.data[Ba+1];var pa=Aa*Z.size;ba[0]=Z.data[pa]*Ca;ba[1]=Z.data[pa+1]*ma;pa=0;ta.textureIsSignedDistanceField&&(pa=ta.outlineSize*ha.screenToWorldRatio/2);K(ja,ra,Ba,ba,wa,pa,ta,va)&&oa(qa.dist,qa.normal,-1,!1)}}createBufferWriter(){return new ea(this)}_normalAndViewAngle(ha,
Y,Z,ja){f.isMat4(Y)&&(Y=h.fromMat4(Q,Y));d.transformMat3(ja.normal,ha,Y);d.transformMat4(ja.normal,ja.normal,Z.viewInverseTransposeMatrix);ja.cosAngle=d.dot(R,ia);return ja}_updateScaleInfo(ha,Y,Z){const ja=this.parameters;null!=ja.screenSizePerspective?G.precomputeScaleFactor(Z,Y,ja.screenSizePerspective,ha.factor):(ha.factor.scale=1,ha.factor.factor=0,ha.factor.minScaleFactor=0);null!=ja.screenSizePerspectiveAlignment?G.precomputeScaleFactor(Z,Y,ja.screenSizePerspectiveAlignment,ha.factorAlignment):
(ha.factorAlignment.factor=ha.factor.factor,ha.factorAlignment.scale=ha.factor.scale,ha.factorAlignment.minScaleFactor=ha.factor.minScaleFactor)}applyShaderOffsetsView(ha,Y,Z,ja,oa,qa,ta){Y=this._normalAndViewAngle(Y,Z,oa,X);this._applyVerticalGroundOffsetView(ha,Y,oa,ta);this._applyVerticalOffsetTransformationView(ta,Y,oa,qa);this._applyPolygonOffsetView(ta,Y,ja[3],oa,ta);this._applyCenterOffsetView(ta,ja,ta);return ta}applyShaderOffsetsNDC(ha,Y,Z,ja,oa){this._applyCenterOffsetNDC(ha,Y,Z,ja);null!=
oa&&d.copy(oa,ja);this._applyPolygonOffsetNDC(ja,Y,Z,ja);return ja}_applyPolygonOffsetView(ha,Y,Z,ja,oa){var qa=ja.aboveGround?1:-1;Z=Math.sign(Z);0===Z&&(Z=qa);qa*=Z;if(0>=this.parameters.shaderPolygonOffset)return d.copy(oa,ha);Y=n.clamp(Math.abs(Y.cosAngle),.01,1);ja=1-Math.sqrt(1-Y*Y)/Y/ja.viewport[2];0<qa?d.scale(oa,ha,ja):d.scale(oa,ha,1/ja);return oa}_applyVerticalGroundOffsetView(ha,Y,Z,ja){const oa=d.length(ha),qa=Z.aboveGround?1:-1;Z=Z.computeRenderPixelSizeAtDist(oa)*u.HUDVerticalPixelOffset;
Y=d.scale(S,Y.normal,qa*Z);d.add(ja,ha,Y);return ja}_applyVerticalOffsetTransformationView(ha,Y,Z,ja){const oa=this.parameters;if(!oa.verticalOffset?.screenLength){if(oa.screenSizePerspective||oa.screenSizePerspectiveAlignment){var qa=d.length(ha);this._updateScaleInfo(ja,qa,Y.cosAngle)}else ja.factor.scale=1,ja.factorAlignment.scale=1;return ha}qa=d.length(ha);Z=H.verticalOffsetAtDistance(Z,qa,oa.verticalOffset,Y.cosAngle,oa.screenSizePerspectiveAlignment??oa.screenSizePerspective);this._updateScaleInfo(ja,
qa,Y.cosAngle);d.scale(Y.normal,Y.normal,Z);return d.add(ha,ha,Y.normal)}_applyCenterOffsetView(ha,Y,Z){const ja="screen"!==this.parameters.centerOffsetUnits;Z!==ha&&d.copy(Z,ha);ja&&(Z[0]+=Y[0],Z[1]+=Y[1],Y[2]&&(d.normalize(N,Z),d.add(Z,Z,d.scale(N,N,Y[2]))));return Z}_applyCenterOffsetNDC(ha,Y,Z,ja){const oa="screen"!==this.parameters.centerOffsetUnits;ja!==ha&&d.copy(ja,ha);oa||(ja[0]+=Y[0]/Z.fullWidth*2,ja[1]+=Y[1]/Z.fullHeight*2);return ja}_applyPolygonOffsetNDC(ha,Y,Z,ja){const oa=this.parameters.shaderPolygonOffset;
ha!==ja&&d.copy(ja,ha);oa&&(ha=Z.aboveGround?1:-1,ja[2]-=(ha*Math.sign(Y[3])||ha)*oa);return ja}createGLMaterial(ha){return new F(ha)}calculateRelativeScreenBounds(ha,Y,Z=r.create()){var ja=this.parameters;Z[0]=ja.anchorPosition[0]*-ha[0]+ja.screenOffset[0]*Y;Z[1]=ja.anchorPosition[1]*-ha[1]+ja.screenOffset[1]*Y;Z[2]=Z[0]+ha[0];Z[3]=Z[1]+ha[1];return Z}_getScreenScale(ha){ha=ha.attributes.get(C.VertexAttribute.FEATUREATTRIBUTE);if(null==ha)return{scaleX:1,scaleY:1};ha=l.fromArray(ha.data,ca);const [Y,
Z]=w.evaluateModelTransformScale(W,this.parameters,ha);return{scaleX:Y,scaleY:Z}}}class F extends v.GLTextureMaterial{constructor(ha){super({...ha,...ha.material.parameters})}selectProgram(ha){return this.ensureTechnique(B.HUDMaterialTechnique,ha)}beginSlot(ha){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.selectProgram(ha)}}const M=new E.ScaleInfo,S=c.create(),N=c.create(),P=l.create(),R=c.create(),O=c.create(),T=k.create(),
Q=k.create(),V=g.create(),U=c.create(),W=c.create(),ca=l.create(),X={normal:R,cosAngle:0},ba=[0,0],ia=c.fromValues(0,0,1);class fa extends v.GLTextureMaterialBindParameters{constructor(){super(...arguments);this.renderOccluded=y.RenderOccludedFlag.Occlude;this.isDecoration=!1;this.color=l.fromValues(1,1,1,1);this.texCoordScale=[1,1];this.polygonOffset=!1;this.anchorPosition=e.fromValues(.5,.5);this.screenOffset=[0,0];this.shaderPolygonOffset=1E-5;this.sampleSignedDistanceFieldTexelCenter=this.textureIsSignedDistanceField=
!1;this.outlineColor=l.fromValues(1,1,1,1);this.outlineSize=0;this.vvSizeEnabled=!1;this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.hasSlicePlane=!1;this.occlusionTest=this.pixelSnappingEnabled=!0;this.centerOffsetUnits="world";this.drawInSecondSlot=!1;this.depthEnabled=!0;this.draped=!1}}const da=t.newLayout().vec3f(C.VertexAttribute.POSITION).vec3f(C.VertexAttribute.NORMAL).vec2f(C.VertexAttribute.UV0).vec4u8(C.VertexAttribute.COLOR).vec2f(C.VertexAttribute.SIZE).vec4f(C.VertexAttribute.CENTEROFFSETANDDISTANCE).vec4f(C.VertexAttribute.FEATUREATTRIBUTE),
aa=da.clone().vec4u8(C.VertexAttribute.OBJECTANDLAYERIDCOLOR);class ea{constructor(ha){this._material=ha;this.vertexBufferLayout=b("enable-feature:objectAndLayerId-rendering")?aa:da}elementCount(ha){return 6*ha.attributes.get(C.VertexAttribute.POSITION).indices.length}write(ha,Y,Z,ja,oa){I.writePosition(Z.attributes.get(C.VertexAttribute.POSITION),ha,ja.position,oa,6);I.writeNormal(Z.attributes.get(C.VertexAttribute.NORMAL),Y,ja.normal,oa,6);ha=Z.attributes.get(C.VertexAttribute.UV0).data;var qa;
if(null==ha||4>ha.length){ha=this._material.parameters;var ta=qa=0;var va=ha.texCoordScale[0];var Ca=ha.texCoordScale[1]}else qa=ha[0],ta=ha[1],va=ha[2],Ca=ha[3];va=Math.min(1.99999,va+1);Ca=Math.min(1.99999,Ca+1);ha=Z.attributes.get(C.VertexAttribute.POSITION).indices.length;Y=oa;var ma=ja.uv0;for(let pa=0;pa<ha;++pa)ma.set(Y,0,qa),ma.set(Y,1,ta),Y++,ma.set(Y,0,va),ma.set(Y,1,ta),Y++,ma.set(Y,0,va),ma.set(Y,1,Ca),Y++,ma.set(Y,0,va),ma.set(Y,1,Ca),Y++,ma.set(Y,0,qa),ma.set(Y,1,Ca),Y++,ma.set(Y,0,
qa),ma.set(Y,1,ta),Y++;I.writeColor(Z.attributes.get(C.VertexAttribute.COLOR),4,ja.color,oa,6);const {data:wa,indices:Ba}=Z.attributes.get(C.VertexAttribute.SIZE);ha=Ba.length;qa=ja.size;Y=oa;for(ta=0;ta<ha;++ta)for(va=wa[2*Ba[ta]],Ca=wa[2*Ba[ta]+1],ma=0;6>ma;++ma)qa.set(Y,0,va),qa.set(Y,1,Ca),Y++;Z.attributes.get(C.VertexAttribute.CENTEROFFSETANDDISTANCE)?I.writeBufferVec4(Z.attributes.get(C.VertexAttribute.CENTEROFFSETANDDISTANCE),ja.centerOffsetAndDistance,oa,6):I.writeBufferVec4Zeros(ja.centerOffsetAndDistance,
oa,6*ha);Z.attributes.get(C.VertexAttribute.FEATUREATTRIBUTE)?I.writeBufferVec4(Z.attributes.get(C.VertexAttribute.FEATUREATTRIBUTE),ja.featureAttribute,oa,6):I.writeBufferVec4Zeros(ja.featureAttribute,oa,6*ha);null!=Z.objectAndLayerIdColor&&(ha=Z.attributes.get(C.VertexAttribute.POSITION)?.indices)&&(ha=ha.length,ja=ja.getField(C.VertexAttribute.OBJECTANDLAYERIDCOLOR,x.BufferViewVec4u8),I.writeObjectAndLayerIdColor(Z.objectAndLayerIdColor,ja,ha,oa,6))}}a.HUDMaterial=L;a.Parameters=fa;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(h){return h instanceof Float32Array&&16<=h.length}function n(h){return Array.isArray(h)&&16<=h.length}a.isMat4=function(h){return b(h)||n(h)};a.isMat4f32=b;a.isMat4f64=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags ../../webgl-engine/core/shaderModules/interfaces".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(Q){return null!==Q&&void 0!==Q}function x(Q){return"number"===typeof Q}function w(Q){return"string"===typeof Q}function p(Q,V){Q&&Q.push(V)}function t(Q,V,U,W=g.create()){Q=Q||0;V=V||0;U=U||0;0!==Q&&m.rotateZ(W,W,-Q/180*Math.PI);0!==V&&m.rotateX(W,W,V/180*Math.PI);0!==U&&m.rotateY(W,W,U/180*Math.PI);return W}function q(Q,V,U,W,ca){const X=Q.minSize,ba=Q.maxSize;if(Q.expression)return p(ca,"Could not convert size info: expression not supported"),!1;if(Q.useSymbolValue)return Q=
W.symbolSize[U],V.minSize[U]=Q,V.maxSize[U]=Q,V.offset[U]=V.minSize[U],V.factor[U]=0,V.type[U]=a.FastSizeType.DefinedSize,!0;if(r(Q.field)){if(r(Q.stops)){if(2===Q.stops.length&&x(Q.stops[0].size)&&x(Q.stops[1].size))return u(Q.stops[0].size,Q.stops[1].size,Q.stops[0].value,Q.stops[1].value,V,U),V.type[U]=a.FastSizeType.DefinedSize,!0;p(ca,"Could not convert size info: stops only supported with 2 elements");return!1}if(x(X)&&x(ba)&&r(Q.minDataValue)&&r(Q.maxDataValue))return u(X,ba,Q.minDataValue,
Q.maxDataValue,V,U),V.type[U]=a.FastSizeType.DefinedSize,!0;if("unknown"===Q.valueUnit)return p(ca,"Could not convert size info: proportional size not supported"),!1;if(null!=c.meterIn[Q.valueUnit])return V.minSize[U]=-Infinity,V.maxSize[U]=Infinity,V.offset[U]=0,V.factor[U]=1/c.meterIn[Q.valueUnit],V.type[U]=a.FastSizeType.DefinedSize,!0;p(ca,"Could not convert size info: scale-dependent size not supported");return!1}if(!r(Q.field)){if(Q.stops?.[0]&&x(Q.stops[0].size))return V.minSize[U]=Q.stops[0].size,
V.maxSize[U]=Q.stops[0].size,V.offset[U]=V.minSize[U],V.factor[U]=0,V.type[U]=a.FastSizeType.DefinedSize,!0;if(x(X))return V.minSize[U]=X,V.maxSize[U]=X,V.offset[U]=X,V.factor[U]=0,V.type[U]=a.FastSizeType.DefinedSize,!0}p(ca,"Could not convert size info: unsupported variant of sizeInfo");return!1}function u(Q,V,U,W,ca,X){W=0<Math.abs(W-U)?(V-Q)/(W-U):0;ca.minSize[X]=0<W?Q:V;ca.maxSize[X]=0<W?V:Q;ca.offset[X]=Q-U*W;ca.factor[X]=W}function v(Q,V,U,W){if(Q.normalizationField||Q.valueRepresentation)return p(W,
"Could not convert size info: unsupported property"),null;var ca=Q.field;if(null!=ca&&!w(ca))return p(W,"Could not convert size info: field is not a string"),null;if(!V.size)V.size=new z(Q.field);else if(Q.field)if(!V.size.field)V.size.field=Q.field;else if(Q.field!==V.size.field)return p(W,"Could not convert size info: multiple fields in use"),null;switch(Q.axis){case "width":return(ca=q(Q,V.size,0,U,W))?V:null;case "height":return(ca=q(Q,V.size,2,U,W))?V:null;case "depth":return(ca=q(Q,V.size,1,
U,W))?V:null;case "width-and-depth":return(ca=q(Q,V.size,0,U,W))&&q(Q,V.size,1,U,W),ca?V:null;case null:case void 0:case "all":return(ca=(ca=(ca=q(Q,V.size,0,U,W))&&q(Q,V.size,1,U,W))&&q(Q,V.size,2,U,W))?V:null;default:return p(W,`Could not convert size info: unknown axis "${Q.axis}""`),null}}function y(Q,V,U){for(let W=0;3>W;++W){let ca=V.unitInMeters;Q.type[W]===a.FastSizeType.DefinedSize&&(ca*=V.modelSize[W],Q.type[W]=a.FastSizeType.DefinedScale);Q.minSize[W]/=ca;Q.maxSize[W]/=ca;Q.offset[W]/=
ca;Q.factor[W]/=ca}if(Q.type[0]!==a.FastSizeType.Undefined)V=0;else if(Q.type[1]!==a.FastSizeType.Undefined)V=1;else if(Q.type[2]!==a.FastSizeType.Undefined)V=2;else return p(U,"No size axis contains a valid size or scale"),!1;for(U=0;3>U;++U)Q.type[U]===a.FastSizeType.Undefined&&(Q.minSize[U]=Q.minSize[V],Q.maxSize[U]=Q.maxSize[V],Q.offset[U]=Q.offset[V],Q.factor[U]=Q.factor[V],Q.type[U]=Q.type[V]);return!0}function D(Q,V,U){Q[4*V]=U.r/255;Q[4*V+1]=U.g/255;Q[4*V+2]=U.b/255;Q[4*V+3]=U.a}function G(Q,
V,U){if(Q.normalizationField)return p(U,"Could not convert color info: unsupported property"),null;if(w(Q.field))if(Q.stops){if(8<Q.stops.length)return p(U,"Could not convert color info: too many color stops"),null;V.color=new K(Q.field);Q=Q.stops;for(U=0;8>U;++U){const W=Q[Math.min(U,Q.length-1)];V.color.values[U]=W.value;D(V.color.colors,U,W.color)}}else return p(U,"Could not convert color info: missing stops or colors"),null;else if(Q.stops&&0<=Q.stops.length)for(Q=Q.stops&&0<=Q.stops.length&&
Q.stops[0].color,V.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},U=0;8>U;U++)V.color.values[U]=Infinity,D(V.color.colors,U,Q);else return p(U,"Could not convert color info: no field and no colors/stops"),null;return V}function A(Q,V,U){if(Q.normalizationField)return p(U,"Could not convert opacity info: unsupported property"),null;if(w(Q.field))if(Q.stops){if(8<Q.stops.length)return p(U,"Could not convert opacity info: too many opacity stops"),
null;V.opacity=new L(Q.field);Q=Q.stops;for(U=0;8>U;++U){const W=Q[Math.min(U,Q.length-1)];V.opacity.values[U]=W.value;V.opacity.opacityValues[U]=W.opacity}}else return p(U,"Could not convert opacity info: missing stops or opacities"),null;else if(Q.stops&&0<=Q.stops.length)for(Q=Q.stops&&0<=Q.stops.length?Q.stops[0].opacity:0,V.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},U=0;8>U;U++)V.opacity.values[U]=Infinity,V.opacity.opacityValues[U]=Q;else return p(U,"Could not convert opacity info: no field and no opacities/stops"),
null;return V}function C(Q,V,U){Q=2===U&&"arithmetic"===Q.rotationType;V.offset[U]=Q?90:0;V.factor[U]=Q?-1:1;V.type[U]=1}function E(Q,V,U){if(!w(Q.field))return p(U,"Could not convert rotation info: field is not a string"),null;if(!V.rotation)V.rotation={field:Q.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(Q.field)if(!V.rotation.field)V.rotation.field=Q.field;else if(Q.field!==V.rotation.field)return p(U,"Could not convert rotation info: multiple fields in use"),null;switch(Q.axis){case "tilt":return C(Q,
V.rotation,0),V;case "roll":return C(Q,V.rotation,1),V;case null:case void 0:case "heading":return C(Q,V.rotation,2),V;default:return p(U,`Could not convert rotation info: unknown axis "${Q.axis}""`),null}}function I(Q,V,U){if(!Q)return null;const W=Q.reduce((ca,X)=>{if(!ca)return ca;if(X.valueExpression)return p(U,"Could not convert visual variables: arcade expressions not supported"),null;switch(X.type){case "size":return V.supports.size?v(X,ca,V,U):ca;case "color":return V.supports.color?G(X,ca,
U):ca;case "opacity":return V.supports.opacity?A(X,ca,U):null;case "rotation":return V.supports.rotation?E(X,ca,U):ca;default:return null}},new M);return 0<Q.length&&W&&!W.size&&!W.color&&!W.opacity&&!W.rotation||W?.size&&!y(W.size,V,U)?null:W}function H(Q,V,U){if(!!Q!==!!V||Q&&Q.field!==V?.field)return!1;if(Q&&"rotation"===U)for(U=0;3>U;U++)if(Q.type[U]!==V.type[U]||Q.offset[U]!==V.offset[U]||Q.factor[U]!==V.factor[U])return!1;return!0}function J(Q,V){Q=new P(Q);Q.vvSize&&(Q.vvSymbolAnchor=V.anchor,
m.identity(T),t(V.rotation[2],V.rotation[0],V.rotation[1],T),Q.vvSymbolRotationMatrix=Q.vvSymbolRotationMatrix||k.create(),h.fromMat4(Q.vvSymbolRotationMatrix,T));return Q}a.FastSizeType=void 0;(function(Q){Q[Q.Undefined=0]="Undefined";Q[Q.DefinedSize=1]="DefinedSize";Q[Q.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(Q){Q[Q.Undefined=0]="Undefined";Q[Q.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));class B{constructor(Q){this.field=
Q}}class z extends B{constructor(Q){super(Q);this.minSize=[0,0,0];this.maxSize=[0,0,0];this.offset=[0,0,0];this.factor=[0,0,0];this.type=[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]}}class K extends B{constructor(Q){super(Q);this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.values=[0,0,0,0,0,0,0,0]}}class L extends B{constructor(Q){super(Q);this.values=[0,0,0,0,0,0,0,0];this.opacityValues=[0,0,0,0,0,0,0,0]}}class F extends B{constructor(Q){super(Q);
this.offset=[0,0,0];this.factor=[1,1,1];this.type=[0,0,0]}}class M{}class S{constructor(Q,V=[1,1,1],U=[1,1,1],W=1,ca=[0,0,0],X=[1,1,1],ba=[0,0,0]){this.supports=Q;this.modelSize=V;this.symbolSize=U;this.unitInMeters=W;this.anchor=ca;this.scale=X;this.rotation=ba}}class N{constructor(Q,V,U){this.visualVariables=Q;this.materialParameters=V;this.requiresShaderTransformation=U}}class P extends f.NoParameters{constructor(Q){super();this.vvSize=Q?.size??null;this.vvColor=Q?.color??null;this.vvOpacity=Q?.opacity??
null}}const R=g.create(),O=d.create(),T=g.create();a.ConvertOptions=S;a.FastColorInfo=K;a.FastOpacityInfo=L;a.FastRotationInfo=F;a.FastSizeInfo=z;a.FastSymbolUpdatesState=N;a.FastVisualVariables=M;a.VisualVariablesParameters=P;a.convertVisualVariables=I;a.evaluateModelTransform=function(Q,V,U){if(!Q.vvSize)return U;m.copy(R,U);U=Q.vvSymbolRotationMatrix;m.set(T,U[0],U[1],U[2],0,U[3],U[4],U[5],0,U[6],U[7],U[8],0,0,0,0,1);m.multiply(R,R,T);for(U=0;3>U;++U)O[U]=n.clamp(Q.vvSize.offset[U]+V[0]*Q.vvSize.factor[U],
Q.vvSize.minSize[U],Q.vvSize.maxSize[U]);m.scale(R,R,O);m.translate(R,R,Q.vvSymbolAnchor);return R};a.evaluateModelTransformScale=function(Q,V,U){if(!V.vvSize)return e.set(Q,1,1,1),Q;for(let W=0;3>W;++W)Q[W]=n.clamp(V.vvSize.offset[W]+U[0]*V.vvSize.factor[W],V.vvSize.minSize[W],V.vvSize.maxSize[W]);return Q};a.getAttributeValue=function(Q,V){Q=null==Q?0:V.attributes[Q];return"number"===typeof Q&&isFinite(Q)?Q:0};a.getMaterialParameters=J;a.initFastSymbolUpdatesState=function(Q,V){return!Q||l.debugFlags.TESTS_DISABLE_FAST_UPDATES?
null:(Q=I(Q.visualVariables,V))?new N(Q,J(Q,V),!!Q.size):null};a.updateFastSymbolUpdatesState=function(Q,V,U){if(!V||!Q)return!1;const W=Q.visualVariables;V=I(V.visualVariables,U);if(!(V&&H(W.size,V.size,"size")&&H(W.color,V.color,"color")&&H(W.rotation,V.rotation,"rotation")&&H(W.opacity,V.opacity,"opacity")))return!1;Q.visualVariables=V;Q.materialParameters=J(V,U);Q.requiresShaderTransformation=!!V.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e){a.HUD=function(d,c){d.include(n.ScreenSizePerspective);d.attributes.add(e.VertexAttribute.POSITION,"vec3");d.attributes.add(e.VertexAttribute.NORMAL,"vec3");d.attributes.add(e.VertexAttribute.CENTEROFFSETANDDISTANCE,"vec4");d=d.vertex;h.addProjViewLocalOrigin(d,c);h.addCameraPosition(d,c);d.uniforms.add(new k.Float4PassUniform("viewport",(l,f)=>f.camera.fullViewport),new m.FloatPassUniform("polygonOffset",l=>l.shaderPolygonOffset),new m.FloatPassUniform("cameraGroundRelative",
(l,f)=>f.camera.aboveGround?1:-1));c.hasVerticalOffset&&b.addVerticalOffset(d);d.constants.add("smallOffsetAngle","float",.984807753012208);d.code.add(g.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);d.code.add(g.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${c.multipassEnabled?g.glsl.float(0):g.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);c.draped&&!c.hasVerticalOffset||h.addViewNormal(d);c.draped||(d.uniforms.add(new m.FloatPassUniform("perDistancePixelRatio",(l,f)=>Math.tan(f.camera.fovY/2)/(f.camera.fullViewport[2]/2))),d.code.add(g.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${g.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `));c.screenCenterOffsetUnitsEnabled&&h.addPixelRatio(d);c.hasScreenSizePerspective&&n.addScreenSizePerspectiveAlignment(d);d.code.add(g.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${c.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${c.hasScreenSizePerspective?c.hasVerticalOffset||c.screenCenterOffsetUnitsEnabled?"vec3 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${c.hasVerticalOffset?c.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${c.hasVerticalOffset?g.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${c.screenCenterOffsetUnitsEnabled?"":g.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${c.screenCenterOffsetUnitsEnabled?c.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${c.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)};a.HUDVerticalPixelOffset=.5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,n,h,k,m,g){function e(c){c.uniforms.add(new m.Float4PassUniform("verticalOffset",
(l,f)=>{const {minWorldLength:r,maxWorldLength:x,screenLength:w}=l.verticalOffset;return b.set(d,w*(f.camera.pixelRatio||1),Math.tan(.5*f.camera.fovY)/(.5*f.camera.fullViewport[3]),r,x)}))}const d=n.create();a.VerticalOffset=function(c,l){const f=c.vertex;l.hasVerticalOffset?(e(f),l.hasScreenSizePerspective&&(c.include(h.ScreenSizePerspective),h.addScreenSizePerspectiveAlignment(f),k.addCameraPosition(c.vertex,l)),f.code.add(g.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${l.spherical?g.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:g.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${l.hasScreenSizePerspective?g.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:g.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):f.code.add(g.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/interfaces"],function(a,b,n,h,k){function m(e){return b.set(g,
e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const g=n.create();a.ScreenSizePerspective=function(e){e.vertex.code.add(k.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);e.vertex.code.add(k.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`);e.vertex.code.add(k.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);e.vertex.code.add(k.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);e.vertex.code.add(k.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`);e.vertex.code.add(k.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(e){e.uniforms.add(new h.Float3PassUniform("screenSizePerspective",d=>m(d.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(e){e.uniforms.add(new h.Float3PassUniform("screenSizePerspectiveAlignment",d=>m(d.screenSizePerspectiveAlignment||d.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./basicInterfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends m.ContentObject{constructor(r,x){super();this.type=g.ContentObjectType.Material;this.supportsEdges=!1;this._visible=!0;this._renderPriority=0;this._vertexAttributeLocations=e.Default3D;this._pp0=b.fromValues(0,0,1);this._pp1=b.fromValues(0,0,0);this._parameters=d.copyParameters(r,x);this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(r){return!1}setParameters(r,x=!0){d.updateParameters(this._parameters,r)&&(this.validateParameters(this._parameters),
x&&this.parametersChanged())}validateParameters(r){}get visible(){return this._visible}set visible(r){r!==this._visible&&(this._visible=r,this.parametersChanged())}shouldRender(r){return this.isVisible()&&this.isVisibleForOutput(r.output)&&(!this.parameters.isDecoration||r.bindParameters.decorations===k.Decorations.ON)&&0!==(this.parameters.renderOccluded&r.renderOccludedMask)}isVisibleForOutput(r){return!0}get renderPriority(){return this._renderPriority}set renderPriority(r){r!==this._renderPriority&&
(this._renderPriority=r,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository?.materialChanged(this)}queryRenderOccludedState(r){return this.isVisible()&&this.parameters.renderOccluded===r}intersectDraped(r,x,w,p,t,q){this._pp0[0]=this._pp1[0]=p[0];this._pp0[1]=this._pp1[1]=p[1];return this.intersect(r,x,w,this._pp0,this._pp1,t)}}class l extends h.Parameters{constructor(r,x,w){super(x,w);
this.camera=r}}a.RenderOccludedFlag=void 0;(function(r){r[r.None=0]="None";r[r.Occlude=1]="Occlude";r[r.Transparent=2]="Transparent";r[r.OccludeAndTransparent=4]="OccludeAndTransparent";r[r.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";r[r.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));class f extends n.NoParameters{constructor(){super(...arguments);this.renderOccluded=a.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.Material=c;a.MaterialParameters=f;a.UpdateParameters=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),function(a,b,n,h,k,m,g,e,d,c){function l(A,
C,E,I,H,J){if(null!=A){var B=x(C,E,v);m.setMin(u,A.bbMin);m.setMax(u,A.bbMax);null!=H&&H.applyToAabb(u);if(w(u,C,B,I)){const {primitiveIndices:z,position:K}=A;B=z?z.length:K.indices.length/3;if(1E3<B&&(A=A.getChildren(),void 0!==A)){for(const L of A)l(L,C,E,I,H,J);return}f(C,E,0,B,K.indices,K,z,H,J)}}}function f(A,C,E,I,H,J,B,z,K){if(B){const {data:da,stride:aa}=J;J=A[0];var L=A[1];A=A[2];var F=C[0]-J,M=C[1]-L;for(C=C[2]-A;E<I;++E){var S=B[E],N=3*S,P=aa*H[N++],R=da[P++],O=da[P++],T=da[P];P=aa*H[N++];
var Q=da[P++],V=da[P++],U=da[P];P=aa*H[N];N=da[P++];var W=da[P++];P=da[P];null!=z&&([R,O,T]=z.applyToVertex(R,O,T,E),[Q,V,U]=z.applyToVertex(Q,V,U,E),[N,W,P]=z.applyToVertex(N,W,P,E));Q-=R;V-=O;U-=T;N-=R;W-=O;P-=T;var ca=M*P-W*C,X=C*N-P*F;const ea=F*W-N*M;var ba=Q*ca+V*X+U*ea;if(!(Math.abs(ba)<=Number.EPSILON)){R=J-R;O=L-O;T=A-T;ca=R*ca+O*X+T*ea;if(0<ba){if(0>ca||ca>ba)continue}else if(0<ca||ca<ba)continue;X=O*U-V*T;T=T*Q-U*R;O=R*V-Q*O;R=F*X+M*T+C*O;if(0<ba){if(0>R||ca+R>ba)continue}else if(0<R||
ca+R<ba)continue;T=(N*X+W*T+P*O)/ba;0<=T&&(Q=r(Q,V,U,N,W,P,y),K(T,Q,S,!1))}}}else{var {data:ia,stride:fa}=J;B=A[0];J=A[1];L=A[2];A=C[0]-B;F=C[1]-J;M=C[2]-L;for(let da=E,aa=3*E;da<I;++da)if(N=fa*H[aa++],O=ia[N++],T=ia[N++],U=ia[N],N=fa*H[aa++],C=ia[N++],E=ia[N++],S=ia[N],N=fa*H[aa++],Q=ia[N++],V=ia[N++],N=ia[N],null!=z&&([O,T,U]=z.applyToVertex(O,T,U,da),[C,E,S]=z.applyToVertex(C,E,S,da),[Q,V,N]=z.applyToVertex(Q,V,N,da)),C-=O,E-=T,S-=U,Q-=O,V-=T,N-=U,P=F*N-V*M,R=M*Q-N*A,ba=A*V-Q*F,W=C*P+E*R+S*ba,
!(Math.abs(W)<=Number.EPSILON)){O=B-O;T=J-T;U=L-U;P=O*P+T*R+U*ba;if(0<W){if(0>P||P>W)continue}else if(0<P||P<W)continue;R=T*S-E*U;U=U*C-S*O;T=O*E-C*T;O=A*R+F*U+M*T;if(0<W){if(0>O||P+O>W)continue}else if(0<O||P+O<W)continue;U=(Q*R+V*U+N*T)/W;0<=U&&(C=r(C,E,S,Q,V,N,y),K(U,C,da,!1))}}}function r(A,C,E,I,H,J,B){h.set(D,A,C,E);h.set(G,I,H,J);h.cross(B,D,G);h.normalize(B,B);return B}function x(A,C,E){return h.set(E,1/(C[0]-A[0]),1/(C[1]-A[1]),1/(C[2]-A[2]))}function w(A,C,E,I){return p(A,C,E,I,Infinity)}
function p(A,C,E,I,H){var J=(A[0]-I-C[0])*E[0],B=(A[3]+I-C[0])*E[0];let z=Math.min(J,B);J=Math.max(J,B);B=(A[1]-I-C[1])*E[1];const K=(A[4]+I-C[1])*E[1];J=Math.min(J,Math.max(B,K));if(0>J)return!1;z=Math.max(z,Math.min(B,K));if(z>J)return!1;B=(A[2]-I-C[2])*E[2];A=(A[5]+I-C[2])*E[2];J=Math.min(J,Math.max(B,A));if(0>J)return!1;z=Math.max(z,Math.min(B,A));return z>J?!1:z<H}function t(A,C){C=C?t(C):{};for(const E in A){let I=A[E];I?.forEach&&(I=q(I));null==I&&E in C||(C[E]=I)}return C}function q(A){const C=
[];A.forEach(E=>C.push(E));return C}const u=m.create(),v=k.create(),y=k.create(),D=k.create(),G=k.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=x;a.computeNormal=r;a.copyParameters=t;a.intersectAabbInvDir=w;a.intersectAabbInvDirBefore=p;a.intersectTriangleGeometry=function(A,C,E,I,H,J){A.visible&&(A.boundingInfo?(d.assert(A.type===g.ContentObjectType.Mesh),l(A.boundingInfo,E,I,C.tolerance,H,J)):(A=A.attributes.get(c.VertexAttribute.POSITION),C=A.indices,f(E,I,0,C.length/
3,C,A,void 0,H,J)))};a.intersectTriangles=f;a.updateParameters=function(A,C){let E=!1;for(const I in C){const H=C[I];void 0!==H&&(Array.isArray(H)?null===A[I]?(A[I]=H.slice(),E=!0):b.update(A[I],H)&&(E=!0):A[I]!==H&&(E=!0,A[I]=H))}return E};a.verticalOffsetAtDistance=function(A,C,E,I,H){let J=(E.screenLength||0)*A.pixelRatio;null!=H&&(J=e.scale(J,I,C,H));return n.clamp(J*Math.tan(.5*A.fovY)/(.5*A.fullHeight)*C,E.minWorldLength||0,null!=E.maxWorldLength?E.maxWorldLength:Infinity)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(a){class b{constructor(){this.factor=new n;this.factorAlignment=new n}}class n{constructor(){this.minScaleFactor=this.factor=this.scale=0}}a.ScaleFactor=n;a.ScaleInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4",
"../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,n,h,k){function m(p,t,q){const {data:u,indices:v}=p;p=t.typedBuffer;t=t.typedBufferStride;const y=v.length;q*=t;for(let D=0;D<y;++D){const G=2*v[D];p[q]=u[G];p[q+1]=u[G+1];q+=t}}function g(p,t,q,u){const {data:v,indices:y}=p;p=t.typedBuffer;t=t.typedBufferStride;const D=y.length;q*=t;if(null==u||1===u)for(u=0;u<D;++u){var G=3*y[u];p[q]=v[G];p[q+1]=v[G+1];p[q+2]=v[G+2];q+=t}else for(G=0;G<
D;++G){const A=3*y[G];for(let C=0;C<u;++C)p[q]=v[A],p[q+1]=v[A+1],p[q+2]=v[A+2],q+=t}}function e(p,t,q,u=1){const {data:v,indices:y}=p;p=t.typedBuffer;t=t.typedBufferStride;const D=y.length;q*=t;if(1===u)for(u=0;u<D;++u){var G=4*y[u];p[q]=v[G];p[q+1]=v[G+1];p[q+2]=v[G+2];p[q+3]=v[G+3];q+=t}else for(G=0;G<D;++G){const A=4*y[G];for(let C=0;C<u;++C)p[q]=v[A],p[q+1]=v[A+1],p[q+2]=v[A+2],p[q+3]=v[A+3],q+=t}}function d(p,t,q,u,v=1){if(t){var {data:y,indices:D}=p;p=q.typedBuffer;q=q.typedBufferStride;var G=
D.length,A=t[0],C=t[1],E=t[2],I=t[4],H=t[5],J=t[6],B=t[8],z=t[9],K=t[10],L=t[12],F=t[13],M=t[14];u*=q;var S=0,N=0,P=0;t=b.hasIdentityRotation(t)?R=>{S=y[R]+L;N=y[R+1]+F;P=y[R+2]+M}:R=>{const O=y[R],T=y[R+1];R=y[R+2];S=A*O+I*T+B*R+L;N=C*O+H*T+z*R+F;P=E*O+J*T+K*R+M};if(1===v)for(v=0;v<G;++v)t(3*D[v]),p[u]=S,p[u+1]=N,p[u+2]=P,u+=q;else for(let R=0;R<G;++R){t(3*D[R]);for(let O=0;O<v;++O)p[u]=S,p[u+1]=N,p[u+2]=P,u+=q}}else g(p,q,u,v)}function c(p,t,q,u,v=1){if(t){var {data:y,indices:D}=p;p=q.typedBuffer;
q=q.typedBufferStride;var G=D.length,A=t[0],C=t[1],E=t[2],I=t[4],H=t[5],J=t[6],B=t[8],z=t[9],K=t[10],L=!b.isOrthoNormal(t);u*=q;var F=0,M=0,S=0;t=b.hasIdentityRotation(t)?P=>{F=y[P];M=y[P+1];S=y[P+2]}:P=>{const R=y[P],O=y[P+1];P=y[P+2];F=A*R+I*O+B*P;M=C*R+H*O+z*P;S=E*R+J*O+K*P};if(1===v)if(L)for(v=0;v<G;++v)t(3*D[v]),L=F*F+M*M+S*S,.999999>L&&1E-6<L?(L=1/Math.sqrt(L),p[u]=F*L,p[u+1]=M*L,p[u+2]=S*L):(p[u]=F,p[u+1]=M,p[u+2]=S),u+=q;else for(v=0;v<G;++v)t(3*D[v]),p[u]=F,p[u+1]=M,p[u+2]=S,u+=q;else for(let P=
0;P<G;++P){t(3*D[P]);if(L){var N=F*F+M*M+S*S;.999999>N&&1E-6<N&&(N=1/Math.sqrt(N),F*=N,M*=N,S*=N)}for(N=0;N<v;++N)p[u]=F,p[u+1]=M,p[u+2]=S,u+=q}}else g(p,q,u,v)}function l(p,t,q,u,v=1){if(t){var {data:y,indices:D}=p;p=q.typedBuffer;q=q.typedBufferStride;var G=D.length,A=t[0],C=t[1],E=t[2],I=t[4],H=t[5],J=t[6],B=t[8],z=t[9],K=t[10];t=!b.isOrthoNormal(t);u*=q;if(1===v)for(v=0;v<G;++v){var L=4*D[v],F=y[L],M=y[L+1],S=y[L+2];L=y[L+3];var N=A*F+I*M+B*S,P=C*F+H*M+z*S;F=E*F+J*M+K*S;t&&(M=N*N+P*P+F*F,.999999>
M&&1E-6<M&&(M=1/Math.sqrt(M),N*=M,P*=M,F*=M));p[u]=N;p[u+1]=P;p[u+2]=F;p[u+3]=L;u+=q}else for(L=0;L<G;++L){N=4*D[L];M=y[N];S=y[N+1];const R=y[N+2];N=y[N+3];P=A*M+I*S+B*R;F=C*M+H*S+z*R;M=E*M+J*S+K*R;t&&(S=P*P+F*F+M*M,.999999>S&&1E-6<S&&(S=1/Math.sqrt(S),P*=S,F*=S,M*=S));for(S=0;S<v;++S)p[u]=P,p[u+1]=F,p[u+2]=M,p[u+3]=N,u+=q}}else e(p,q,u,v)}function f(p,t,q,u,v=1){const {data:y,indices:D}=p;var G=q.typedBuffer,A=q.typedBufferStride;p=D.length;u*=A;if(t===y.length&&4===t)for(G[u]=y[0],G[u+1]=y[1],G[u+
2]=y[2],G[u+3]=y[3],G=new Uint32Array(q.typedBuffer.buffer,q.start),A/=4,u/=4,t=G[u],u+=A,p*=v,v=1;v<p;++v)G[u]=t,u+=A;else if(1===v)if(4===t)for(v=0;v<p;++v)t=4*D[v],G[u]=y[t],G[u+1]=y[t+1],G[u+2]=y[t+2],G[u+3]=y[t+3],u+=A;else for(v=0;v<p;++v)t=3*D[v],G[u]=y[t],G[u+1]=y[t+1],G[u+2]=y[t+2],G[u+3]=255,u+=A;else if(4===t)for(t=0;t<p;++t){q=4*D[t];for(var C=0;C<v;++C)G[u]=y[q],G[u+1]=y[q+1],G[u+2]=y[q+2],G[u+3]=y[q+3],u+=A}else for(t=0;t<p;++t)for(q=3*D[t],C=0;C<v;++C)G[u]=y[q],G[u+1]=y[q+1],G[u+2]=
y[q+2],G[u+3]=255,u+=A}function r(p,t,q){const {data:u,indices:v}=p;p=t.typedBuffer;t=t.typedBufferStride;const y=v.length,D=u[0];q*=t;for(let G=0;G<y;++G)p[q]=D,q+=t}function x(p,t,q,u,v=1){const y=t.typedBuffer;t=t.typedBufferStride;u*=t;if(1===v)for(v=0;v<q;++v)y[u]=p[0],y[u+1]=p[1],y[u+2]=p[2],y[u+3]=p[3],u+=t;else for(let D=0;D<q;++D)for(let G=0;G<v;++G)y[u]=p[0],y[u+1]=p[1],y[u+2]=p[2],y[u+3]=p[3],u+=t}function w(p,t,q,u,v,y){switch(p){case k.VertexAttribute.POSITION:h.assert(3===t.size);u=
v.getField(p,n.BufferViewVec3f);h.assert(!!u,`No buffer view for ${p}`);u&&d(t,q,u,y);break;case k.VertexAttribute.NORMAL:h.assert(3===t.size);q=v.getField(p,n.BufferViewVec3f);h.assert(!!q,`No buffer view for ${p}`);q&&c(t,u,q,y);break;case k.VertexAttribute.NORMALCOMPRESSED:h.assert(2===t.size);u=v.getField(p,n.BufferViewVec2i16);h.assert(!!u,`No buffer view for ${p}`);u&&m(t,u,y);break;case k.VertexAttribute.UV0:h.assert(2===t.size);u=v.getField(p,n.BufferViewVec2f);h.assert(!!u,`No buffer view for ${p}`);
u&&m(t,u,y);break;case k.VertexAttribute.COLOR:case k.VertexAttribute.SYMBOLCOLOR:u=v.getField(p,n.BufferViewVec4u8);h.assert(!!u,`No buffer view for ${p}`);h.assert(3===t.size||4===t.size);!u||3!==t.size&&4!==t.size||f(t,t.size,u,y);break;case k.VertexAttribute.COLORFEATUREATTRIBUTE:u=v.getField(p,n.BufferViewFloat);h.assert(!!u,`No buffer view for ${p}`);h.assert(1===t.size);u&&1===t.size&&r(t,u,y);break;case k.VertexAttribute.TANGENT:h.assert(4===t.size);q=v.getField(p,n.BufferViewVec4f);h.assert(!!q,
`No buffer view for ${p}`);q&&l(t,u,q,y);break;case k.VertexAttribute.PROFILERIGHT:case k.VertexAttribute.PROFILEUP:case k.VertexAttribute.PROFILEVERTEXANDNORMAL:case k.VertexAttribute.FEATUREVALUE:h.assert(4===t.size),u=v.getField(p,n.BufferViewVec4f),h.assert(!!u,`No buffer view for ${p}`),u&&e(t,u,y)}}a.writeBufferFloat=function(p,t,q,u=1){const {data:v,indices:y}=p;p=t.typedBuffer;t=t.typedBufferStride;const D=y.length;q*=t;if(1===u)for(u=0;u<D;++u)p[q]=v[y[u]],q+=t;else for(let G=0;G<D;++G){const A=
v[y[G]];for(let C=0;C<u;C++)p[q]=A,q+=t}};a.writeBufferMat3f=function(p,t,q){const {data:u,indices:v}=p;p=t.typedBuffer;t=t.typedBufferStride;const y=v.length;q*=t;for(let D=0;D<y;++D){const G=9*v[D];for(let A=0;9>A;++A)p[q+A]=u[G+A];q+=t}};a.writeBufferMat4f=function(p,t,q){const {data:u,indices:v}=p;p=t.typedBuffer;t=t.typedBufferStride;const y=v.length;q*=t;for(let D=0;D<y;++D){const G=16*v[D];for(let A=0;16>A;++A)p[q+A]=u[G+A];q+=t}};a.writeBufferVec2=m;a.writeBufferVec3=g;a.writeBufferVec4=e;
a.writeBufferVec4Zeros=function(p,t,q){const u=p.typedBuffer;p=p.typedBufferStride;t*=p;for(let v=0;v<q;++v)u[t]=0,u[t+1]=0,u[t+2]=0,u[t+3]=0,t+=p};a.writeColor=f;a.writeColorFeatureAttribute=r;a.writeDefaultAttribute=w;a.writeDefaultAttributes=function(p,t,q,u,v,y){for(const G of t.fields.keys()){t=p.attributes.get(G);var D=t?.indices;t&&D?w(G,t,q,u,v,y):G===k.VertexAttribute.OBJECTANDLAYERIDCOLOR&&null!=p.objectAndLayerIdColor&&(t=p.attributes.get(k.VertexAttribute.POSITION)?.indices)&&(t=t.length,
D=v.getField(G,n.BufferViewVec4u8),x(p.objectAndLayerIdColor,D,t,y))}};a.writeNormal=c;a.writeObjectAndLayerIdColor=x;a.writePosition=d;a.writeTangent=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E){function I(B){const z=new G.ShaderBuilder;var K=B.signedDistanceFieldEnabled;z.include(d.HUD,B);z.include(m.SliceDraw,B);if(B.occlusionPass)return z.include(c.HUDOcclusionPass,B),z;const {vertex:L,fragment:F}=z;z.include(t.ScreenSizePerspective);F.include(p.RgbaFloatEncoding);F.include(w.ColorConversion);z.include(r.VisualVariables,B);z.include(g.ObjectAndLayerIdColor,B);z.include(l.HUDVisibility);z.varyings.add("vcolor","vec4");z.varyings.add("vtc",
"vec2");z.varyings.add("vsize","vec2");z.varyings.add("voccluded","float");L.uniforms.add(new v.Float4PassUniform("viewport",(N,P)=>P.camera.fullViewport),new u.Float2PassUniform("screenOffset",(N,P)=>b.set(J,2*N.screenOffset[0]*P.camera.pixelRatio,2*N.screenOffset[1]*P.camera.pixelRatio)),new u.Float2PassUniform("anchorPosition",N=>H(N)),new v.Float4PassUniform("materialColor",N=>N.color));q.addPixelRatio(L);K&&(L.uniforms.add(new v.Float4PassUniform("outlineColor",N=>N.outlineColor)),F.uniforms.add(new v.Float4PassUniform("outlineColor",
N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineColor:h.ZEROS),new y.FloatPassUniform("outlineSize",N=>0<N.outlineColor[3]&&0<N.outlineSize?N.outlineSize:0)));B.pixelSnappingEnabled&&L.include(e.AlignPixel);B.hasScreenSizePerspective&&(t.addScreenSizePerspective(L),t.addScreenSizePerspectiveAlignment(L));B.debugDrawLabelBorder&&z.varyings.add("debugBorderCoords","vec4");z.attributes.add(E.VertexAttribute.UV0,"vec2");z.attributes.add(E.VertexAttribute.COLOR,"vec4");z.attributes.add(E.VertexAttribute.SIZE,
"vec2");z.attributes.add(E.VertexAttribute.FEATUREATTRIBUTE,"vec4");L.code.add(D.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${B.hasScreenSizePerspective?D.glsl`
            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:D.glsl`
            inputSize = size;
            vec2 screenOffsetScaled = screenOffset;`}

      ${B.vvSize?"inputSize *\x3d vvScale(featureAttribute).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);
      bool visible = testHUDVisibility(posProj);
      voccluded = visible ? 0.0 : 1.0;
    `);var M=D.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const S=B.pixelSnappingEnabled?K?D.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:D.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:D.glsl`posProj += quadOffset;`;L.code.add(D.glsl`
    ${B.occlusionTestEnabled?"if (visible) {":""}
    ${M}
    ${B.vvColor?"vcolor \x3d interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${B.output===k.ShaderOutput.ObjectAndLayerIdColor?D.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${D.glsl.float(x.symbolAlphaCutoff)};
    ${K?`alphaDiscard = alphaDiscard && outlineColor.a < ${D.glsl.float(x.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${S}
      gl_Position = posProj;
    }

    vtc = uv;

    ${B.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${B.occlusionTestEnabled?D.glsl`} else { vtc = vec2(0.0);
      ${B.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);F.uniforms.add(new A.Texture2DPassUniform("tex",N=>N.texture));M=B.debugDrawLabelBorder?D.glsl`(isBorder > 0.0 ? 0.0 : ${D.glsl.float(x.defaultMaskAlphaCutoff)})`:D.glsl.float(x.defaultMaskAlphaCutoff);K=D.glsl`
    ${B.debugDrawLabelBorder?D.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${B.sampleSignedDistanceFieldTexelCenter?D.glsl`
      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;
      `:D.glsl`
      vec2 samplePos = vtc;
      `}

    ${K?D.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${M} ||
          fillPixelColor.a + outlinePixelColor.a < ${D.glsl.float(x.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${M}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:D.glsl`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${M}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${B.debugDrawLabelBorder?D.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;switch(B.output){case k.ShaderOutput.Color:F.code.add(D.glsl`
        void main() {
          ${K}
          ${B.transparencyPassType===C.TransparencyPassType.FrontFace?"fragColor.rgb /\x3d fragColor.a;":""}
        }`);break;case k.ShaderOutput.Alpha:F.code.add(D.glsl`
        void main() {
          ${K}
          fragColor = vec4(fragColor.a);
        }`);break;case k.ShaderOutput.ObjectAndLayerIdColor:F.code.add(D.glsl`
        void main() {
          ${K}
          outputObjectAndLayerIdColor();
        }`);break;case k.ShaderOutput.Highlight:F.constants.add("occludedHighlightFlag","vec4",f.occludedHighlightFlag),F.constants.add("unoccludedHighlightFlag","vec4",f.unoccludedHighlightFlag),F.code.add(D.glsl`
        void main() {
          ${K}
          if (voccluded == 1.0) {
            fragColor = occludedHighlightFlag;
          } else {
            fragColor = unoccludedHighlightFlag;
          }
        }`)}return z}function H(B,z=J){if(B.textureIsSignedDistanceField){var K=B.anchorPosition;B=B.distanceFieldBoundingBox;null!=B?b.set(z,K[0]*(B[2]-B[0])+B[0],K[1]*(B[3]-B[1])+B[1]):b.set(z,0,0)}else b.copy(z,B.anchorPosition);return z}const J=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:I,calculateAnchorPosForRendering:H},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=n;a.build=I;a.calculateAnchorPosForRendering=H})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,n,h,k,m,g,e){function d(v,y,...D){if(y.hasSlicePlane){y.hasSliceInVertexProgram&&v.vertex.uniforms.add(...D);v.fragment.uniforms.add(...D);D=e.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var G=e.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;G=y.hasSliceHighlight?e.glsl`
        ${G}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:e.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;y.hasSliceInVertexProgram&&v.vertex.code.add(D);v.fragment.code.add(D);v.fragment.code.add(G)}else D=e.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,y.hasSliceInVertexProgram&&v.vertex.code.add(D),v.fragment.code.add(D)}function c(v,y,D){return v.instancedDoublePrecision?h.set(p,D.camera.viewInverseTransposeMatrix[3],D.camera.viewInverseTransposeMatrix[7],D.camera.viewInverseTransposeMatrix[11]):y.slicePlaneLocalOrigin}function l(v,y){return null!=v?h.subtract(t,y.origin,v):y.origin}function f(v,y,D){return v.hasSliceTranslatedView?null!=y?b.translate(u,D.camera.viewMatrix,y):D.camera.viewMatrix:
null}function r(v,y,D){if(null==D.slicePlane)return k.ZEROS;const G=c(v,y,D);y=l(G,D.slicePlane);v=f(v,G,D);return null!=v?h.transformMat4(t,y,v):y}function x(v,y,D,G){if(null==G||null==D.slicePlane)return k.ZEROS;const A=c(v,y,D);y=l(A,D.slicePlane);v=f(v,A,D);return null!=v?(h.add(q,G,y),h.transformMat4(t,y,v),h.transformMat4(q,q,v),h.subtract(q,q,t)):G}class w extends e.NoParameters{constructor(v){super();this.slicePlaneLocalOrigin=v}}const p=k.create(),t=k.create(),q=k.create(),u=n.create();a.SliceDraw=
function(v,y){d(v,y,new m.Float3DrawUniform("slicePlaneOrigin",(D,G)=>r(y,D,G)),new m.Float3DrawUniform("slicePlaneBasis1",(D,G)=>x(y,D,G,G.slicePlane?.basis1)),new m.Float3DrawUniform("slicePlaneBasis2",(D,G)=>x(y,D,G,G.slicePlane?.basis2)))};a.SlicePass=function(v,y){d(v,y,new g.Float3PassUniform("slicePlaneOrigin",(D,G)=>r(y,D,G)),new g.Float3PassUniform("slicePlaneBasis1",(D,G)=>x(y,D,G,G.slicePlane?.basis1)),new g.Float3PassUniform("slicePlaneBasis2",(D,G)=>x(y,D,G,G.slicePlane?.basis2)))};a.SlicePlaneParameters=
w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,h){a.ObjectAndLayerIdColor=function(k,m){const g=m.output===b.ShaderOutput.ObjectAndLayerIdColor;m=m.objectAndLayerIdColorInstanced;g&&(k.varyings.add("objectAndLayerIdColorVarying","vec4"),m?k.attributes.add(h.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,
"vec4"):k.attributes.add(h.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));k.vertex.code.add(n.glsl`
     void forwardObjectAndLayerIdColor() {
      ${g?m?n.glsl`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:n.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:n.glsl``} }`);k.fragment.code.add(n.glsl`
      void outputObjectAndLayerIdColor() {
        ${g?n.glsl`fragColor = objectAndLayerIdColorVarying;`:n.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanPassUniform","../../shaderModules/interfaces"],function(a,b,n){a.AlignPixel=function(h){h.uniforms.add(new b.BooleanPassUniform("alignPixelEnabled",(k,m)=>m.alignPixelEnabled));h.code.add(n.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`);h.code.add(n.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/MultipassGeometryTest.glsl","../shading/MultipassTerrainTest.glsl","../../shaderModules/interfaces"],function(a,b,n,h,k){a.HUDOcclusionPass=function(m,g){const {vertex:e,fragment:d}=m;e.include(b.AlignPixel);g.multipassEnabled&&(e.include(n.multipassGeometryTest),m.varyings.add("depth","float"));
e.code.add(k.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${g.multipassEnabled?k.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${g.multipassEnabled?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);m.include(h.multipassTerrainTest,g);d.code.add(k.glsl`
  void main() {
    fragColor = vec4(1);
    ${g.multipassEnabled?k.glsl`
        if(terrainDepthTest(depth)) {
          fragColor.g = 0.5;
        }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define("exports ./AlignPixel.glsl ./HUDRenderStyle ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m,g){a.HUDVisibility=function(e){e.vertex.uniforms.add(new k.FloatPassUniform("renderTransparentlyOccludedHUD",(d,c)=>c.hudRenderStyle===
n.HUDRenderStyle.Occluded?1:c.hudRenderStyle===n.HUDRenderStyle.NotOccluded?0:.75),new h.Float4PassUniform("viewport",(d,c)=>c.camera.fullViewport),new g.Texture2DPassUniform("hudVisibilityTexture",(d,c)=>c.hudVisibility?.getTexture()));e.vertex.include(b.AlignPixel);e.vertex.code.add(m.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,h){const k=b.fromValues(1,1,0,1),m=b.fromValues(1,0,1,1);a.OutputHighlight=function(g){g.fragment.uniforms.add(new h.Texture2DPassUniform("depthTexture",(e,d)=>d.mainDepth));g.fragment.constants.add("occludedHighlightFlag",
"vec4",k).add("unoccludedHighlightFlag","vec4",m);g.fragment.code.add(n.glsl`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)};a.occludedHighlightFlag=k;a.unoccludedHighlightFlag=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,n,h,k,m,g,e){a.VisualVariables=function(d,c){const {vertex:l,attributes:f}=d;c.hasVvInstancing&&(c.vvSize||c.vvColor)&&f.add(g.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");c.vvSize?(l.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",r=>r.vvSize.minSize)),l.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",r=>r.vvSize.maxSize)),l.uniforms.add(new b.Float3PassUniform("vvSizeOffset",r=>r.vvSize.offset)),l.uniforms.add(new b.Float3PassUniform("vvSizeFactor",r=>r.vvSize.factor)),
l.uniforms.add(new m.Matrix3PassUniform("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),l.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",r=>r.vvSymbolAnchor)),l.code.add(k.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),l.code.add(k.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${c.hasVvInstancing?k.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):l.code.add(k.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);c.vvColor?(l.constants.add("vvColorNumber","int",e.vvColorNumber),l.uniforms.add(new h.FloatsPassUniform("vvColorValues",r=>r.vvColor.values,e.vvColorNumber),new n.Float4sPassUniform("vvColorColors",r=>r.vvColor.colors,e.vvColorNumber)),l.code.add(k.glsl`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${c.hasVvInstancing?k.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):l.code.add(k.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m,g){super(k,"vec4",n.BindType.Pass,(e,d,c)=>e.setUniform4fv(k,m(d,c)),g)}}a.Float4sPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports",
"./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m,g){super(k,"float",n.BindType.Pass,(e,d,c)=>e.setUniform1fv(k,m(d,c)),g)}}a.FloatsPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates","../lib/Material"],function(a,b,n){class h extends b.VisualVariablesParameters{constructor(){super(...arguments);
this.renderOccluded=n.RenderOccludedFlag.Occlude;this.isDecoration=!1}}a.VisualVariablePassParameters=h;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x extends m.ShaderTechnique{initializeConfiguration(t,q){q.spherical=t.viewingMode===n.ViewingMode.Global}initializeProgram(t){return new d.Program(t.rctx,x.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){const t=this.configuration.transparencyPassType,q=this.configuration,u=t===c.TransparencyPassType.NONE;var v=t===c.TransparencyPassType.FrontFace;const y=this.configuration.hasPolygonOffset?w:null;v=q.draped?null:(u||v)&&q.output!==
h.ShaderOutput.Highlight?q.depthEnabled||q.occlusionPass?r.defaultDepthWriteParams:null:null;return r.makePipelineState({blending:q.output===h.ShaderOutput.Color||q.output===h.ShaderOutput.Alpha||q.output===h.ShaderOutput.Highlight?u?p:e.oitBlending(t):null,depthTest:q.draped?null:{func:f.CompareFunction.LEQUAL},depthWrite:v,colorWrite:r.defaultColorWriteParams,polygonOffset:y})}get primitiveType(){return this.configuration.occlusionPass?f.PrimitiveType.POINTS:f.PrimitiveType.TRIANGLES}}x.shader=
new k.ReloadableShaderModule(l.HUDMaterial,()=>new Promise((t,q)=>a(["./HUDMaterial.glsl"],t,q)));const w={factor:0,units:-4},p=r.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,b,n,h){const k=h.separateBlendingParams(n.BlendFactor.SRC_ALPHA,
n.BlendFactor.ONE,n.BlendFactor.ONE_MINUS_SRC_ALPHA,n.BlendFactor.ONE_MINUS_SRC_ALPHA),m=h.simpleBlendingParams(n.BlendFactor.ONE,n.BlendFactor.ONE),g=h.simpleBlendingParams(n.BlendFactor.ZERO,n.BlendFactor.ONE_MINUS_SRC_ALPHA),e={factor:-1,units:-2};a.OITPolygonOffset=e;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=g;a.blendingColor=m;a.blendingDefault=k;a.getOITPolygonOffset=function(d){return d?e:null};a.oitBlending=function(d){return d===b.TransparencyPassType.FrontFace?null:d===b.TransparencyPassType.Alpha?
g:m};a.oitDepthTest=function(d,c=n.CompareFunction.LESS){return d===b.TransparencyPassType.NONE||d===b.TransparencyPassType.FrontFace?c:n.CompareFunction.LEQUAL};a.oitDepthWrite=function(d){return d===b.TransparencyPassType.FrontFace?h.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m){class g extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.hasPolygonOffset=this.hasSlicePlane=this.debugDrawLabelBorder=this.hasScreenSizePerspective=this.hasVerticalOffset=this.vvColor=this.vvSize=this.sampleSignedDistanceFieldTexelCenter=this.signedDistanceFieldEnabled=!1;this.pixelSnappingEnabled=
this.depthEnabled=!0;this.objectAndLayerIdColorInstanced=this.occlusionPass=this.cullAboveGround=this.multipassEnabled=this.draped=!1}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],g.prototype,"output",void 0);b.__decorate([h.parameter({count:k.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",void 0);b.__decorate([h.parameter()],g.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"spherical",void 0);b.__decorate([h.parameter()],
g.prototype,"occlusionTestEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"signedDistanceFieldEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"sampleSignedDistanceFieldTexelCenter",void 0);b.__decorate([h.parameter()],g.prototype,"vvSize",void 0);b.__decorate([h.parameter()],g.prototype,"vvColor",void 0);b.__decorate([h.parameter()],g.prototype,"hasVerticalOffset",void 0);b.__decorate([h.parameter()],g.prototype,"hasScreenSizePerspective",void 0);b.__decorate([h.parameter()],g.prototype,
"debugDrawLabelBorder",void 0);b.__decorate([h.parameter()],g.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],g.prototype,"hasPolygonOffset",void 0);b.__decorate([h.parameter()],g.prototype,"depthEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"pixelSnappingEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"draped",void 0);b.__decorate([h.parameter()],g.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter()],
g.prototype,"occlusionPass",void 0);b.__decorate([h.parameter()],g.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([h.parameter({constValue:!0})],g.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([h.parameter({constValue:!1})],g.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.LabelDeconflictor=class extends e.Deconflictor{constructor(f){super(f);this.visibilityGroup=d.VisibilityGroup.LABEL;this.marginFactor=.05;this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(f){if(this.parent.running)return l.Yield;const r=performance.now();if(f.state!==c.RenderState.IDLE&&2E3>r-this._lastDeconfliction)return l.Yield;super.runTask(f);this.state===e.State.Idle&&(this._lastDeconfliction=r)}enabledChanged(f,r){this.modifyGraphics(r,
f.labelsEnabled)}getGraphicsLayers(f){return f.labelLayers}};b.__decorate([n.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([g.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./LabelParameters ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){function K(P){return!P||0===P.length}function L(P){return!0===P.labelsVisible&&!!P.labelingInfo?.some(R=>!!R.symbol)}class F{constructor(P,R){this.labelingContext=P;this.graphics3DGraphic=R;this.textInitialized=this.addedToTextureAtlas=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]}}class M{constructor(P,R,O,T,Q){this.labelClass=P;this.graphics3DSymbol=R;this.graphics3DCalloutSymbolLayer=
O;this.textRenderParameters=T;this.labelFunction=Q;this.calloutSymbolLayerIndex=0}}class S{constructor(P,R,O,T,Q,V,U,W){this.layer=R;this.graphics3DCore=O;this.scaleVisibility=T;this.emptySymbolLabelSupported=Q;this.elevationInfoOverride=V;this.disablePlacement=U;this.active=W;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new J.WebGLLayer(P,{pickable:!0,disableOctree:!0},R.uid)}destroy(){this.stageLayer.destroy()}}
a.Labeler=class extends n{constructor(P){super(P);this._dirty=!1;this._labels=new Map;this._labelingContexts=[]}setup(){this.dispose();this.addHandles([d.watch(()=>this.view.state?.camera,()=>this.setDirty()),d.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(B.TaskPriority.LABELER,this)]);this._textTextureAtlas=new H.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new C.MaterialCollection(this.view._stage);
this._calloutMaterialCollection=new C.MaterialCollection(this.view._stage)}dispose(){this.removeAllHandles();this._textTextureAtlas=g.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=g.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=g.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear()}destroy(){this.dispose();N.graphic=null;N.renderingInfo=null;N.layer=null}_activateLabelingContext(P){P.graphics.forEach((R,O)=>
{const T=new F(P,R);this._labels.set(O,T);P.labelsToInitialize.set(O,T);R.setVisibilityFlag(q.VisibilityGroup.LABEL,q.VisibilityFlag.USER,!0)});P.active=!0}_deactivateLabelingContext(P){P.graphics.forEach((R,O)=>{R.setVisibilityFlag(q.VisibilityGroup.LABEL,q.VisibilityFlag.USER,!1);this.setLabelGraphicVisibility(R,!1);R.clearLabelGraphics();this._labels.delete(O)});P.active=!1}_addLabelTextureToAtlas(P){for(const R of P.graphics3DGraphic.labelLayers){if(!R._labelClass)continue;const O=P.textRenderers[R._labelIndex];
O&&(this._textTextureAtlas.addTextTexture(O,R.stageObject),P.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(P){for(const R of P.graphics3DGraphic.labelLayers){if(!R._labelClass)continue;const O=P.textRenderers[R._labelIndex];null!=O&&(this._textTextureAtlas.removeTextTexture(O,R.stageObject),P.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(P){this._updateLabels(P);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(P);
return z.Yield}_updateLabels(P){if(this._dirty){this._dirty=!1;for(const R of this._labelingContexts)R.active&&(R.labelClassPromise&&R.labelClassAbortController?this._dirty=!0:K(R.labelClassContexts)?null===R.labelClassContexts?this._deactivateLabelingContext(R):(this._createLabelClassContext(R),this._dirty=!0):m.someMap(R.labelsToInitialize,(O,T)=>{this._ensureGraphics3DResources(O)&&(this._labels.set(T,O),this.deconflictor.setDirty(),P.madeProgress());if(O.visible&&O.textInitialized||!O.visible&&
O.hasGraphics3DResources)R.labelsToInitialize.delete(T),P.madeProgress();return P.done})&&(this._dirty=!0));this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(P){const R=P.labelClassAbortController?.signal;P.layer.when&&await P.layer.when();e.throwIfAborted(R);P.scaleVisibility&&P.scaleVisibility.updateScaleRangeActive();const O=P.graphics3DCore,T=O.layer.labelingInfo?.filter(Q=>!!Q.symbol);T&&0!==T.length&&(await h.forEach(T,async(Q,V)=>{var U=Q.symbol;const W=y.getGraphics3DSymbol(O.getOrCreateGraphics3DSymbol(U));
if(null==W)k.getLogger(this).error("Failed to create Graphics3DSymbol for label");else{await W.load();e.throwIfAborted(R);var ca=null;t.hasCalloutSupport(U)&&U.hasVisibleCallout()&&(ca=u.make(U,O.symbolCreationContext),await ca.load(),e.throwIfAborted(R));U=await h.result(p.createLabelFunction(Q,P.layer.fieldsIndex,this.view.spatialReference));e.throwIfAborted(R);if(!0===U.ok){const X=await this._createTextRenderParameters(W.symbol);e.throwIfAborted(R);P.labelClassContexts[V]=new M(Q,W,ca,X,U.value)}else k.getLogger(this).error(`Label expression failed to evaluate: ${U.error}`)}}),
e.throwIfAborted(R))}async _createLabelClassContext(P){null==P.labelClassPromise&&(P.labelClassPromise=this._createLabelClassContextAsync(P).catch(R=>{if(e.isAbortError(R))throw R;P.labelClassContexts.length=0}).then(()=>{P.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return P.labelClassPromise}async _createTextRenderParameters(P){P=P.symbolLayers.at(0);return"text"!==P?.type?null:I.TextRenderParameters.fromSymbol(P,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(P){for(var R of P.labelClassContexts)--R.graphics3DSymbol.referenced;
R=P.labelClassAbortController;P.labelClassAbortController=new AbortController;g.abortMaybe(R);P.labelClassContexts.length=0;P.labelClassPromise=null;this.notifyChange("updating")}_createTextSymbolGraphic(P,R,O,T,Q,V){P=new D.LabelParameters(O,A.horizontalPlacementFromAnchor(O.anchor),A.verticalPlacementFromAnchor(O.anchor),P.text,x.fromValues(P.displayWidth,P.displayHeight));N.graphic=R;N.renderingInfo=null;N.layer=T;return Q.createLabel(N,P,this._hudMaterialCollection,this._textTextureAtlas,()=>
{const U=G.getLabelPlacement(V);return U?U.elevationOffset:null})}_createLineCalloutGraphic(P,R,O,T,Q){N.graphic=P;N.layer=Q;N.renderingInfo=new v.LineCalloutSymbolLayerRenderingInfo(null,R,T.translation,T.centerOffset,T.screenOffset[0],T.centerOffsetUnits,T.elevationOffset,this._calloutMaterialCollection);return O.createGraphics3DGraphic(N)}_ensureGraphics3DResources(P){if(P.hasGraphics3DResources)return!1;const R=P.graphics3DGraphic;if(R.destroyed)return!1;this._ensureTextTextureResources(P);const O=
P.labelingContext,T=O.labelClassContexts;if(K(T)||!O.emptySymbolLabelSupported&&0===R.layers.length)return!1;var Q=!1,V=R.graphic;const U=O.layer;var W=L(O.layer);for(let X=0;X<T.length;X++){const ba=P.textRenderers[X],ia=P.textLabelPlacements[X];if(null==ba||null==ia)continue;const fa=T[X];var ca=fa.graphics3DSymbol;const da=ca.symbol&&"label-3d"===ca.symbol.type?ca.symbol:null;if(ca=ca.symbolLayers[0]){ca.setElevationInfoOverride(O.elevationInfoOverride);Q=new G.LabelInfo(R,da,fa.labelClass);Q=
this._createTextSymbolGraphic(ba,V,ia,U,ca,Q);if(null==Q)return!1;Q._labelClass=fa.labelClass;Q._labelIndex=X;R.addLabelGraphic(Q,O.stageLayer);R.deconflictionPriority=fa.textRenderParameters?.definition.size??0;R.setVisibilityFlag(q.VisibilityGroup.LABEL,q.VisibilityFlag.USER,W);R.setVisibilityFlag(q.VisibilityGroup.LABEL,q.VisibilityFlag.SCALE_RANGE,!0);R.setVisibilityFlag(q.VisibilityGroup.LABEL,q.VisibilityFlag.DECONFLICTION,!1);Q=!0;(W=fa.graphics3DCalloutSymbolLayer)&&ia.hasLabelVerticalOffset&&
(W.setElevationInfoOverride(O.elevationInfoOverride),V=this._createLineCalloutGraphic(V,da,W,ia,U),null!=V&&(fa.calloutSymbolLayerIndex=R.labelLayers.length,R.addLabelGraphic(V,O.stageLayer)));break}}O.scaleVisibility&&Q&&O.scaleVisibility.updateGraphicLabelScaleVisibility(R);return P.hasGraphics3DResources=!0}_destroyGraphics3DResources(P){const R=P.labelingContext.labelClassContexts;for(const O of P.graphics3DGraphic.labelLayers)if(null!=O._labelClass)R[O._labelIndex].graphics3DSymbol.symbolLayers[0]?.onRemoveGraphic(O);
P.graphics3DGraphic.deconflictionPriority=0;P.graphics3DGraphic.clearLabelGraphics();P.hasGraphics3DResources=!1}_ensureTextTextureResources(P){if(!P.textInitialized){var R=P.labelingContext,O=R.labelClassContexts;if(!K(O)){var T=P.graphics3DGraphic.graphic;for(let U=0;U<O.length;U++){const W=O[U];P.textRenderers[U]=null;P.textLabelPlacements[U]=null;if(null==W?.textRenderParameters)continue;var Q=W.labelFunction;let ca;if("arcade"===Q.type)try{const X=Q.needsHydrationToEvaluate()?w.hydrateGraphic(T,
R.layer):T;ca=Q.evaluate(X)}catch(X){ca=null}else ca=Q.evaluate(T);if(null!=ca&&""!==ca&&!/^\s+$/.test(ca)&&(Q=W.graphics3DSymbol,Q.symbolLayers[0]&&(Q=G.getLabelPlacement({graphics3DGraphic:P.graphics3DGraphic,labelSymbol:"label-3d"===Q.symbol?.type?Q.symbol:null,labelClass:W.labelClass,disablePlacement:R.disablePlacement}),null!=Q))){var V=A.horizontalPlacementFromAnchor(Q.anchor);V=A.textRenderAlignmentFromHorizontalPlacement(V);P.textRenderers[U]=new E.TextRenderer(ca,V,W.textRenderParameters,
H.TextTextureAtlas.maxSize);P.textLabelPlacements[U]=Q}}P.textInitialized=!0}}}_destroyTextTextureResources(P){P.textInitialized=!1;P.textRenderers.length=0;P.textLabelPlacements.length=0}_addGraphic(P,R){const O=R.graphic.uid;P.graphics.set(O,R);P.active&&(R=new F(P,R),this._labels.set(O,R),P.labelsToInitialize.set(O,R));this.setDirty();this.deconflictor.setDirty()}_removeGraphic(P,R){R=R.graphic.uid;const O=this._labels.get(R);P.graphics.delete(R);O&&(this._destroyGraphic(O,R),P.labelsToInitialize.delete(R),
this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(P,R){this._labels.delete(R);P.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(P);this._destroyTextTextureResources(P);P.hasGraphics3DResources&&this._destroyGraphics3DResources(P)}async _labelingInfoChange(P,R){if(R)for(const O of R){if(R=P.graphics.get(O))this._removeGraphic(P,R),this._addGraphic(P,R)}else return this._visibilityInfoChange(P),this._resetLabels(P),this._createLabelClassContext(P)}_globalPropertyChanged(P,R){for(const O of R.labelClassContexts){const T=
new Map;R.graphics.forEach(Q=>T.set(Q.graphic.uid,Q));O.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(P,T,Q=>Q.labelLayers[0]);O.graphics3DCalloutSymbolLayer&&O.graphics3DCalloutSymbolLayer.globalPropertyChanged(P,T,Q=>Q.labelLayers[O.calloutSymbolLayerIndex])}}_visibilityInfoChange(P){const R=L(P.layer);R&&!P.active&&this._activateLabelingContext(P);!R&&P.active&&this._deactivateLabelingContext(P);this.setDirty()}_resetAllLabels(){for(const P of this._labelingContexts)this._resetLabels(P)}_resetLabels(P){P.graphics.forEach((R,
O)=>{if(R=this._labels.get(O))this._destroyGraphic(R,O),R.visible=!1,P.labelsToInitialize.set(O,R)});this._destroyLabelClassContext(P);this.setDirty();this.deconflictor.setDirty()}_findLabelingContext(P){for(const R of this._labelingContexts)if(R.graphics3DCore===P)return R;return null}addGraphicsOwner(P,R,O){const T=O&&O.emptySymbolLabelSupported||!1,Q=O?.elevationInfoOverride||null;O=O?.disablePlacement||null;if(!this._findLabelingContext(P)){var V=P.layer,U=new S(this.view._stage,V,P,R,T,Q,O,L(V));
this._labelingContexts.push(U);this.setDirty();return{addGraphic:W=>this._addGraphic(U,W),removeGraphic:W=>this._removeGraphic(U,W),featureReductionChange:()=>{},layerLabelsEnabled:()=>L(U.layer),labelingInfoChange:W=>this._labelingInfoChange(U,W),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",U),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",U),visibilityInfoChange:()=>this._visibilityInfoChange(U),reset:()=>this._resetLabels(U),clear:()=>{}}}}removeGraphicsOwner(P){const R=
this._findLabelingContext(P);R&&(P=this._labelingContexts.indexOf(R),this._labelingContexts.splice(P,1),R.graphics.forEach(O=>this._removeGraphic(R,O)),R.destroy(),this.setDirty())}setLabelGraphicVisibility(P,R){P=P.graphic.uid;const O=this._labels.get(P);O&&O.visible!==R&&(R&&!O.addedToTextureAtlas?(this._addLabelTextureToAtlas(O),O.textInitialized||O.labelingContext.labelsToInitialize.set(P,O)):!R&&O.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(O),O.visible=R,this.setDirty())}setDirty(){!this._dirty&&
0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(P=>!!P.labelClassPromise&&!!P.labelClassAbortController)}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const P=0<this._labelingContexts.length?this._labelingContexts.reduce((R,O)=>R+(O.labelClassPromise&&O.labelClassAbortController?0:1),0)/this._labelingContexts.length:
1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*P+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};b.__decorate([c.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([c.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([c.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);b.__decorate([c.property({type:Boolean,readOnly:!0})],
a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([r.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const N=new v.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedPoint ../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(u){return"declaredClass"in u}function l(u){return"declaredClass"in u}function f(u){return"declaredClass"in u}function r(u){return null==u?null:c(u)?u:g.fromJSON(x(u))}function x(u){const {wkid:v,wkt:y,wkt2:D,latestWkid:G}=u.spatialReference,A={wkid:v,wkt:y,wkt2:D,latestWkid:G};switch(u.type){case "point":const {x:C,y:E,z:I,m:H}=u;return{x:C,y:E,z:I,m:H,spatialReference:A};case "polygon":const {rings:J,hasZ:B,hasM:z}=u;return{rings:w(J),hasZ:B,hasM:z,spatialReference:A};
case "polyline":const {paths:K,hasZ:L,hasM:F}=u;return{paths:w(K),hasZ:L,hasM:F,spatialReference:A};case "extent":const {xmin:M,xmax:S,ymin:N,ymax:P,zmin:R,zmax:O,mmin:T,mmax:Q,hasZ:V,hasM:U}=u;return{xmin:M,xmax:S,ymin:N,ymax:P,zmin:R,zmax:O,mmin:T,mmax:Q,hasZ:V,hasM:U,spatialReference:A};case "multipoint":const {points:W,hasZ:ca,hasM:X}=u;return{points:q(W)?p(W):W,hasZ:ca,hasM:X,spatialReference:A}}}function w(u){return t(u)?u.map(v=>p(v)):u}function p(u){return u.map(v=>Array.from(v))}function t(u){for(const v of u)if(0!==
v.length)return q(v);return!1}function q(u){return 0<u.length&&(m.isFloat32Array(u[0])||m.isFloat64Array(u[0]))}a.clonePoint=function(u,v){if(!u)return null;if(l(u)){if(null==v)return u.clone();if(l(v))return v.copy(u)}null!=v?(v.x=u.x,v.y=u.y,v.spatialReference=u.spatialReference,u.hasZ?(v.z=u.z,v.hasZ=u.hasZ):(v.z=void 0,v.hasZ=!1),u.hasM?(v.m=u.m,v.hasM=!0):(v.m=void 0,v.hasM=!1)):(v=e.makeDehydratedPoint(u.x,u.y,u.z,u.spatialReference),u.hasM&&(v.m=u.m,v.hasM=!0));return v};a.hydrateGeometry=
r;a.hydrateGraphic=function(u,v){return u?f(u)?u:new n({layer:v,sourceLayer:v,visible:u.visible,symbol:k.clone(u.symbol),attributes:k.clone(u.attributes),geometry:r(u.geometry)}):null};a.hydratedSpatialReference=function(u){const {wkid:v,wkt:y,wkt2:D,latestWkid:G}=u;return d.fromJSON({wkid:v,wkt:y,wkt2:D,latestWkid:G})};a.isHydratedGeometry=c;a.isHydratedGraphic=f;a.isHydratedPoint=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("exports ../../core/Error ../../core/Logger ../../core/sql ../../intl/date ../../intl/number ./domainUtils ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(w,p){if(null==w)return"";const t=p.domain;if(t)if("codedValue"===t.type||"coded-value"===t.type)for(var q of t.codedValues){if(q.code===w)return q.name}else if("range"===t.type){const {max:u,min:v}=g.getDomainRange(p);q=+w;if(null!=v&&null!=u&&v<=q&&q<=u)return t.name}e.isDateField(p)?w=k.formatDate(w,k.convertDateFormatToIntlOptions("short-date")):e.isNumericField(p)&&(w=m.formatNumber(+w));return w||""}const f=()=>n.getLogger("esri.layers.support.labelFormatUtils"),
r={type:"simple",evaluate(){return null}},x={getAttribute(w,p){return w.field(p)}};a.createLabelFunction=async function(w,p,t){if(!w||!w.symbol||!p)return r;const q=w.where,u=d.getLabelExpression(w);if("arcade"===u.type){const v=await c.createLabelExpression(u.expression,t,p);if(null==v)return r;w={type:"arcade",evaluate(y,D){try{const G="attributes"in y?v.repurposeFeature(y):y;G.contextTimeZone=D??null;const A=v.evaluate({$view:{timeZone:D},$feature:G},v.services);if(null!=A)return A.toString()}catch(G){f().error(new b("arcade-expression-error",
"Encountered an error when evaluating label expression for feature",{error:G,feature:y,expression:u}))}return null},needsHydrationToEvaluate(){return null==d.getSingleFieldArcadeExpression(u.expression)}}}else w={type:"simple",evaluate(v){return u.expression.replaceAll(/{[^}]*}/g,y=>{var D=y.slice(1,-1);D=p.get(D);if(!D)return y;y=null;"attributes"in v?v&&v.attributes&&(y=v.attributes[D.name]):y=v.field(D.name);return null==y?"":l(y,D)})}};if(q){let v;try{v=await h.parseWhereClause(q,p)}catch(D){return f().error(new b("bad-where-clause",
"Encountered an error when evaluating where clause, ignoring",{where:q,error:D})),r}const y=w.evaluate;w.evaluate=(D,G)=>{const A="attributes"in D?void 0:x;try{if(v.testFeature(D,A))return y(D,G)}catch(C){f().error(new b("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:q,feature:D,error:C}))}return null}}return w};a.formatField=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,n,h){const k=()=>b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),m={line:h.Graphics3DLineCalloutSymbolLayer};a.make=function(g,e){if(!n.hasCalloutSupport(g))return k().error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${g.type}' does not support callouts`),null;if(!g.callout)return null;const d=m[g.callout.type];return d?new d(g,
e):(k().error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${g.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./SymbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){class D extends r.Graphics3DSymbolLayer{constructor(H,J){super(H,null,J,C);this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new y.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}_perInstanceMaterialParameters(H){const J=
this._materialParameters;J.horizontalScreenOffset=H.horizontalScreenOffset??0;J.centerOffsetUnits=H.centerOffsetUnits||"world";return J}get _materialParameters(){const H=new y.Parameters;var J=this.symbol,B=J.callout;H.color=null!=B.color?b.toUnitRGBA(B.color):[0,0,0,0];H.color[3]*=this._getLayerOpacity();H.size=n.pt2px(B.size||0);if(J.verticalOffset){const {screenLength:z,minWorldLength:K,maxWorldLength:L}=J.verticalOffset;H.verticalOffset={screenLength:n.pt2px(z),minWorldLength:K||0,maxWorldLength:null!=
L?L:Infinity}}H.borderColor=null!=B.border?.color?b.toUnitRGBA(B.border.color):null;B="object"===J.symbolLayers.at(0).type;J="label-3d"===J.type;H.occlusionTest=!B;H.shaderPolygonOffset=B?0:void 0;H.depthHUDAlignStart=J;H.hasSlicePlane=this._context.slicePlaneEnabled;H.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return H}_defaultElevationInfoNoZ(){return A}createGraphics3DGraphic(H){const J=H.renderingInfo;H=H.graphic;
const B=this.setGraphicElevationContext(H,new d.ElevationContext,J.elevationOffset||0);var z=J.symbol;const K="on-the-ground"===this._elevationContext.mode&&("cim"===z.type||!z.symbolLayers.some(L=>"object"===L.type||"text"===L.type));if("label-3d"!==z.type&&K||"point-3d"===z.type&&z.symbolLayers.every(L=>"text"===L.type&&!m.textSymbolLayerSupportsVerticalOffset(L)))return null;z=x.computeCentroid(H.geometry);return null==z?null:this._createAs3DShape(z,B,J,H.uid)}layerOpacityChanged(){this._materials[0]?.setParameters(this._materialParameters)}layerElevationInfoChanged(H,
J,B){B=e.elevationModeChangeUpdateType(D.elevationModeChangeTypes,B,this._elevationContext.mode);if(B!==e.SymbolUpdateType.UPDATE)return B;H.forEach(z=>{const K=J(z);null!=K&&this.updateGraphicElevationContext(z.graphic,K)});return B}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(H,J,B=0){super.setGraphicElevationContext(H,J);J.addOffsetRenderUnits(B);return J}updateGraphicElevationContext(H,
J){this.setGraphicElevationContext(H,J.elevationContext,null!=J.metadata?J.metadata.elevationOffset:0);J.needsElevationUpdates=e.needsElevationUpdates2D(J.elevationContext.mode)}computeComplexity(){return new p.SymbolComplexity({verticesPerFeature:6})}_createVertexData(H){const {translation:J,centerOffset:B}=H;H=J?new t.Attribute([J[0],J[1],J[2]],G,3,!0):new t.Attribute([0,0,0],G,3,!0);const z=B?new t.Attribute([B[0],B[1],B[2],B[3]],G,4,!0):new t.Attribute([0,0,0,1],G,4,!0);return[[v.VertexAttribute.POSITION,
H],[v.VertexAttribute.NORMAL,new t.Attribute([0,0,1],G,3,!0)],[v.VertexAttribute.CENTEROFFSETANDDISTANCE,z]]}_getOrCreateMaterial(H){const J=this._perInstanceMaterialParameters(H),B=y.LineCalloutMaterial.uniqueMaterialIdentifier(J);if(B===this._materials[0]?.uniqueMaterialIdentifier)return{material:this._materials[0],isUnique:!1};if(null!=H.materialCollection){let z=H.materialCollection.get(B);null==z&&(z=new y.LineCalloutMaterial(J),H.materialCollection.add(B,z));return{material:z,isUnique:!1}}return{material:new y.LineCalloutMaterial(J),
isUnique:!0}}_createAs3DShape(H,J,B,z){var K=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:z,layerUid:this._context.layer.uid}),L=this._getOrCreateMaterial(B);K=new u.Geometry(L.material,this._createVertexData(B),null,q.ContentObjectType.Point,K);z=w.createStageObject(this._context,H,K,J,z);if(null==z)return null;L=new l.Graphics3DObject3DGraphicLayer(this,z.object,[K],L.isUnique?[L.material]:null,null,g.perObjectElevationAligner,J);L.metadata=new f.Graphics3DObjectMetadata(B.elevationOffset);
L.alignedSampledElevation=z.sampledElevation;L.needsElevationUpdates=e.needsElevationUpdates2D(J.mode);w.extendPointGraphicElevationContext(L,H,this._context.elevationProvider);return L}}D.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.UPDATE,staysOnTheGround:e.SymbolUpdateType.UPDATE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const G=[0],A={mode:"relative-to-ground",offset:0},C={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class E{constructor(H,J,B=h.create(),z=k.create(),
K=0,L="world",F=0,M=null){this.renderer=H;this.symbol=J;this.translation=B;this.centerOffset=z;this.horizontalScreenOffset=K;this.centerOffsetUnits=L;this.elevationOffset=F;this.materialCollection=M}}class I extends c.Graphics3DGraphicCreationContext{}a.Graphics3DLineCalloutSymbolLayer=D;a.LineCalloutCreationContext=I;a.LineCalloutSymbolLayerRenderingInfo=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ./elevationAlignmentUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(y,D,G,A,C){let E=!1;var I=y.transformation;D=D.requiresSampledElevationInfo;p[0]=I[12];p[1]=I[13];p[2]=I[14];y.invalidateBoundingInfo();var H=y.getMutableAttribute(f.VertexAttribute.POSITION);I=H.data;H=H.size;const J=I.length/H;y=new c.SamplePosition(y.mapPositions,G);let B=0,z=0;for(let K=0;K<J;K++){t[0]=I[B];t[1]=I[B+1];t[2]=I[B+2];A(y,v);D&&(z+=v.sampledElevation);if(d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)I[B]=y.array[y.offset],I[B+1]=y.array[y.offset+
1],I[B+2]=v.z,g.projectBuffer(I,G,B,I,C.spatialReference,B,1),I[B]-=p[0],I[B+1]-=p[1],I[B+2]-=p[2],E=!0;else{w[0]=I[B]+p[0];w[1]=I[B+1]+p[1];w[2]=I[B+2]+p[2];C.setAltitude(w,v.z);I[B]=w[0]-p[0];I[B+1]=w[1]-p[1];I[B+2]=w[2]-p[2];const L=.01/C.unitInMeters;if(Math.abs(t[0]-I[B])>=L||Math.abs(t[1]-I[B+1])>=L||Math.abs(t[2]-I[B+2])>=L)E=!0}B+=H;y.offset+=3}return{update:E,averageGeometrySampledElevation:z/J}}const x=n.create(),w=k.create(),p=k.create(),t=k.create(),q=n.create(),u=k.create(),v=new e.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(y,D,G,A,C){var E=y.graphics3DSymbolLayer.lodRenderer;if(null==E)return 0;G=D.centerPointInElevationSR;A(G,v);D="absolute-height"!==D.mode?v.sampledElevation:0;A=E.instanceData;y=y.instanceIndex;A.getGlobalTransform(y,q);E=h.set(u,q[12],q[13],q[14]);d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=G.x,w[1]=G.y,w[2]=v.z,m.computeTranslationToOriginAndRotation(G.spatialReference,w,q,C.spatialReference)&&A.setGlobalTransform(y,q)):C.setAltitudeOfTransformation(v.z,
q);C=.01/C.unitInMeters;(d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(q[12]-E[0])>=C||Math.abs(q[13]-E[1])>=C||Math.abs(q[14]-E[2])>=C)&&A.setGlobalTransform(y,q);return D};a.perObjectElevationAligner=function(y,D,G,A,C,E){y=y.stageObject;const I=D.centerPointInElevationSR;G=0;y.usesVerticalDistanceToGround?(A(I,v),e.updateVertexPointGroundDistance(y,v.verticalDistanceToGround),G=v.sampledElevation):(A(I,v),"absolute-height"!==D.mode&&(G=v.sampledElevation));D=b.copy(x,E??y.transformation);
A=h.set(u,D[12],D[13],D[14]);d.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=I.x,w[1]=I.y,w[2]=v.z,m.computeTranslationToOriginAndRotation(I.spatialReference,w,D,C.spatialReference)&&(E?b.copy(E,D):y.transformation=D)):C.setAltitudeOfTransformation(v.z,D);C=.01/C.unitInMeters;if(Math.abs(D[12]-A[0])>=C||Math.abs(D[13]-A[1])>=C||Math.abs(D[14]-A[2])>=C)E?b.copy(E,D):y.transformation=D;return G};a.perVertexElevationAligner=function(y,D,G,A,C){y=y.stageObject;const E=y.geometries;let I=0;for(const H of E){if(!l.isGeometryWithMapPositions(H))continue;
const {update:J,averageGeometrySampledElevation:B}=r(H,D,G,A,C);I+=B;J&&y.geometryVertexAttributeUpdated(H,f.VertexAttribute.POSITION)}return I/E.length};a.sharedGeometryElevationAligner=function(y,D,G,A,C){y=y.stageObject;const E=y.geometries;if(0===E.length)return 0;let I=0,H=null,J=0,B=!1;for(const z of E){if(!l.isGeometryWithMapPositions(z))continue;const K=z.attributes.get(f.VertexAttribute.POSITION);if(K!==H){const {update:L,averageGeometrySampledElevation:F}=r(z,D,G,A,C);J=F;H=K;B=L}B&&y.geometryVertexAttributeUpdated(z,
f.VertexAttribute.POSITION);I+=J}return I/E.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../layers/graphics/dehydratedFeatureUtils ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(t,q,u,v,y){const D=(g.isDehydratedPoint(t)?t.z:e.isSamplePosition(t)?t.array[t.offset+2]:t[2])||0;switch(u.mode){case "on-the-ground":u=e.getElevationAtPoint(q,t,"ground")??0;y.verticalDistanceToGround=0;y.sampledElevation=u;y.z=u;break;case "relative-to-ground":t=e.getElevationAtPoint(q,t,"ground")??0;u=u.geometryZWithOffset(D,v);y.verticalDistanceToGround=u;y.sampledElevation=t;y.z=u+t;break;case "relative-to-scene":t=e.getElevationAtPoint(q,t,"scene")??0;
u=u.geometryZWithOffset(D,v);y.verticalDistanceToGround=u;y.sampledElevation=t;y.z=u+t;break;case "absolute-height":u=u.geometryZWithOffset(D,v);v=e.getElevationAtPoint(q,t,"ground")??0;y.verticalDistanceToGround=u-v;y.sampledElevation=v;y.z=u;break;default:y.z=0}}function l(t,q){for(let u=0;u<t.geometries.length;++u){const v=t.geometries[u].getMutableAttribute(d.VertexAttribute.CENTEROFFSETANDDISTANCE);v&&v.data[3]!==q&&(v.data[3]=q,t.geometryVertexAttributeUpdated(t.geometries[u],d.VertexAttribute.CENTEROFFSETANDDISTANCE))}}
class f{constructor(){this.z=this.sampledElevation=this.verticalDistanceToGround=0}}a.SymbolUpdateType=void 0;(function(t){t[t.NONE=0]="NONE";t[t.UPDATE=1]="UPDATE";t[t.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const r={"absolute-height":{applyElevationAlignmentBuffer:function(t,q,u,v,y,D,G,A){D=A.calculateOffsetRenderUnits(G);A=A.featureExpressionInfoContext;q*=3;v*=3;for(G=0;G<y;++G){const C=t[q+1],E=t[q+2];u[v]=t[q];u[v+1]=C;u[v+2]=null==A?E+D:D;q+=3;v+=3}return 0},
requiresAlignment:function(t){const q=t.featureExpressionInfoContext;return 0!==t.meterUnitOffset||null!=q}},"on-the-ground":{applyElevationAlignmentBuffer:function(t,q,u,v,y,D){let G=0;const A=D.spatialReference;q*=3;v*=3;for(let C=0;C<y;++C){const E=t[q],I=t[q+1],H=D.getElevation(E,I,t[q+2],A,"ground")??0;G+=H;u[v]=E;u[v+1]=I;u[v+2]=H;q+=3;v+=3}return G/y},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(t,q,u,v,y,D,G,A){let C=0;G=A.calculateOffsetRenderUnits(G);
A=A.featureExpressionInfoContext;const E=D.spatialReference;q*=3;v*=3;for(let I=0;I<y;++I){const H=t[q],J=t[q+1],B=t[q+2],z=D.getElevation(H,J,B,E,"ground")??0;C+=z;u[v]=H;u[v+1]=J;u[v+2]=null==A?B+z+G:z+G;q+=3;v+=3}return C/y},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(t,q,u,v,y,D,G,A){let C=0;G=A.calculateOffsetRenderUnits(G);A=A.featureExpressionInfoContext;const E=D.spatialReference;q*=3;v*=3;for(let I=0;I<y;++I){const H=t[q],J=t[q+1],B=t[q+2],z=D.getElevation(H,
J,B,E,"scene")??0;C+=z;u[v]=H;u[v+1]=J;u[v+2]=null==A?B+z+G:z+G;q+=3;v+=3}return C/y},requiresAlignment:()=>!0}},x=n.create(),w=new f,p=h.create();a.SampleElevationInfo=f;a.applyElevationAlignmentForHUD=function(t,q,u,v,y){c(q,u,y,v,w);l(t,w.verticalDistanceToGround);u=w.sampledElevation;y=b.copy(x,t.transformation);p[0]=q.x;p[1]=q.y;p[2]=w.z;k.computeTranslationToOriginAndRotation(q.spatialReference,p,y,v.spatialReference)?t.transformation=y:console.warn("Could not locate symbol object properly, it might be misplaced");
return u};a.applyPerVertexElevationAlignment=function(t,q,u,v,y,D,G,A,C,E,I){const H=r[I.mode];let J=0;if(m.projectBuffer(t,q,u,v,C.spatialReference,y,A)&&(H.requiresAlignment(I)?(J=H.applyElevationAlignmentBuffer(v,y,D,G,A,C,E,I),t=D,y=G):t=v,m.projectBuffer(t,C.spatialReference,y,D,E.spatialReference,G,A)))return J};a.elevationModeChangeUpdateType=function(t,q,u){return null==q||null==u?t.definedChanged:"on-the-ground"===q&&"on-the-ground"===u?t.staysOnTheGround:q===u||"on-the-ground"!==q&&"on-the-ground"!==
u?a.SymbolUpdateType.UPDATE:t.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(t,q,u,v){c(t,q,u,v,w);return w.z};a.evaluateElevationInfoAtPoint=c;a.needsElevationUpdates2D=function(t){return"relative-to-ground"===t||"relative-to-scene"===t};a.needsElevationUpdates3D=function(t){return"absolute-height"!==t};a.updateVertexPointGroundDistance=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports",
"./Geometry"],function(a,b){class n extends b.Geometry{}a.GeometryWithMapPositions=n;a.isGeometryWithMapPositions=function(h){return null!=h.mapPositions};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,n){class h{constructor(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=
1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(k){this._unit=k;this._metersPerElevationInfoUnit=b.getMetersPerUnit(k)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit=
"meters"}set offsetMeters(k){this._meterUnitOffset=k;this._renderUnitOffset=0}set offsetElevationInfoUnits(k){this._meterUnitOffset=k*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}addOffsetRenderUnits(k){this._renderUnitOffset+=k}geometryZWithOffset(k,m){m=this.calculateOffsetRenderUnits(m);return null!=this.featureExpressionInfoContext?m:k+m}calculateOffsetRenderUnits(k){let m=this._meterUnitOffset;const g=this.featureExpressionInfoContext;null!=g&&(m+=n.execute(g)*this._metersPerElevationInfoUnit);
return m/k.unitInMeters+this._renderUnitOffset}setFromElevationInfo(k){this.mode=k.mode;this.unit=b.supportsUnit(k.unit)?k.unit:"meters";this.offsetElevationInfoUnits=k.offset??0}updateFeatureExpressionInfoContext(k,m,g){if(null==k)this._featureExpressionInfoContext=null;else{var e=k?.arcade;e&&null!=m&&null!=g?(this._featureExpressionInfoContext=n.clone(k),n.setContextFeature(this._featureExpressionInfoContext,n.createFeature(e.modules,m,g))):this._featureExpressionInfoContext=k}}static fromElevationInfo(k){const m=
new h;null!=k&&m.setFromElevationInfo(k);return m}}a.ElevationContext=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../core/promiseUtils","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,n,h,k){a.clone=function(m){return{cachedResult:m.cachedResult,arcade:m.arcade?{func:m.arcade.func,context:m.arcade.modules.arcadeUtils.createExecContext(null,
{sr:m.arcade.context.spatialReference}),modules:m.arcade.modules}:null}};a.createContext=async function(m,g,e,d){m=m?.expression;if("string"!==typeof m)return null;var c="0"===m?0:null;if(null!=c)return{cachedResult:c};c=await k.loadArcade();n.throwIfAborted(e);e=c.arcadeUtils;m=e.createSyntaxTree(m);return e.dependsOnView(m)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:e.createFunction(m),context:e.createExecContext(null,{sr:g}),
modules:c}}};a.createContextWithoutExpressionSupport=function(m){m=m?.expression;return"string"===typeof m&&(m="0"===m?0:null,null!=m)?{cachedResult:m}:null};a.createFeature=function(m,g,e){return m.arcadeUtils.createFeature(g.attributes,g.geometry,e)};a.execute=function(m){if(null!=m){if(null!=m.cachedResult)return m.cachedResult;var g=m.arcade;g=g?.modules.arcadeUtils.executeFunction(g.func,g.context);"number"!==typeof g&&(g=m.cachedResult=0);return g}return 0};a.extractExpressionInfo=function(m,
g=!1){m=m?.featureExpressionInfo;g||"0"===m?.expression||(m=null);return m??null};a.setContextFeature=function(m,g){null!=m&&null==m.cachedResult&&(g&&m.arcade?(g._geometry&&(g._geometry=h.hydrateGeometry(g._geometry)),m.arcade.modules.arcadeUtils.updateExecContext(m.arcade.context,g)):b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(["exports"],function(a){class b{constructor(n,h,k){this.graphic=n;this.renderingInfo=h;this.layer=k}}a.Graphics3DGraphicCreationContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(q){return q.isVisible()?q.parameters.transparent?c.Transparency.TRANSPARENT:c.Transparency.OPAQUE:c.Transparency.INVISIBLE}class f{constructor(q,u,v){this.baseMaterial=q;this.edgeMaterials=u;this.properties=v}}class r{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(q,u,v,y,D,G,A,C=null){this.graphics3DSymbolLayer=q;this.stageObject=u;this._uniqueGeometries=v;this._uniqueMaterials=y;this._sharedResource=D;this.elevationAligner=
G;this.elevationContext=A;this._edgeState=C;this.type="object3d";this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}initialize(q){this._stageLayer=q;q=q.stage;q.addMany(this._uniqueMaterials);q.addMany(this._uniqueGeometries);q.add(this.stageObject)}destroy(){if(this._stageLayer){var q=this._stageLayer.stage;q.removeMany(this._uniqueMaterials);q.removeMany(this._uniqueGeometries);q.remove(this.stageObject);
this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);q.renderer.edgeView?.removeObject(this.stageObject);this.stageObject.dispose();this._sharedResource?.release();this._visible=!1;this._stageLayer=null}}layerOpacityChanged(q,u){if(null!=this._edgeState){var v=l(this._edgeState.baseMaterial),y=!1;for(const D of this._edgeState.edgeMaterials)D.objectTransparency!==v&&(D.objectTransparency=v,y=!0);y&&this.resetEdgeObject(u);this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[q])}}slicePlaneEnabledChanged(q,u){null!=this._edgeState&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:q},!u),this._edgeState.properties.hasSlicePlane=q)}setVisibility(q){if(null!=this._stageLayer&&this._visible!==q&&(this._visible=q,this.stageObject.visible=q,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const u=this._stageLayer.stage.renderer.ensureEdgeView();
u.hasObject(this.stageObject)?u.updateObjectVisibility(this.stageObject,q):q&&this._addOrUpdateEdgeObject(u,!1)}}get visible(){return this._visible}alignWithElevation(q,u,v,y){null!=this.elevationAligner&&(null!=v&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,v),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,q.spatialReference,(D,G)=>m.evaluateElevationInfoAtPoint(D,q,this.elevationContext,u,G),u),this.resetEdgeObject(y))}alignWithAbsoluteElevation(q,
u,v){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(y,D)=>{D.sampledElevation=q;D.verticalDistanceToGround=0;D.z=q},u);this.resetEdgeObject(v)}getCenterObjectSpace(q=n.create()){return b.copy(q,k.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(q=h.create()){const u=this.stageObject.boundingVolumeObjectSpace;h.setMin(q,u.min);h.setMax(q,u.max);return q}computeAttachmentOrigin(q){const u=this.stageObject.effectiveTransformation;
if(this.useObjectOriginAsAttachmentOrigin)q.render.origin[0]+=u[12],q.render.origin[1]+=u[13],q.render.origin[2]+=u[14],q.render.num++;else for(const v of this.stageObject.geometries)v.computeAttachmentOrigin(p)&&(b.transformMat4(p,p,u),b.add(q.render.origin,q.render.origin,p),q.render.num++)}async getProjectedBoundingBox(q,u,v,y,D){D=this.getBoundingBoxObjectSpace(D);var G=t,A=h.isPoint(D)?1:G.length;for(var C=0;C<A;C++){const E=G[C];w[0]=D[E[0]];w[1]=D[E[1]];w[2]=D[E[2]];b.transformMat4(w,w,this.stageObject.transformation);
x[3*C]=w[0];x[3*C+1]=w[1];x[3*C+2]=w[2]}if(!q(x,0,A))return null;h.empty(D);q=null;this.calculateRelativeScreenBounds&&(q=this.calculateRelativeScreenBounds());for(G=0;G<3*A;G+=3){for(C=0;3>C;C++)D[C]=Math.min(D[C],x[G+C]),D[C+3]=Math.max(D[C+3],x[G+C]);q&&v.push({location:x.slice(G,G+3),screenSpaceBoundingRect:q})}if(u?.service&&"absolute-height"!==this.elevationContext.mode){h.center(D,p);v="relative-to-scene"===this.elevationContext.mode?"scene":"ground";A=0;if(u.useViewElevation)A=u.service.getElevation(p[0],
p[1],v)??0;else try{const E=e.demResolutionForBoundingBox(D,u.service.spatialReference,u);A=await u.service.queryElevation(p[0],p[1],y,E,v)??0}catch(E){}h.offset(D,0,0,-this.alignedSampledElevation+A)}return D}addObjectState(q,u){q===d.Object3DState.Highlight&&u.addObject(this.stageObject,this.stageObject.highlight());q===d.Object3DState.MaskOccludee&&u.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(q){q.removeObject(this.stageObject)}resetEdgeObject(q){if(null!=this._edgeState){var u=
this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(u,q):u.removeObject(this.stageObject)}}_addOrUpdateEdgeObject(q,u){const v=this._edgeState;if(null!=v){var y=l(v.baseMaterial);for(const D of v.edgeMaterials)D.objectTransparency=y;q.addOrUpdateObject3D(this.stageObject,v.edgeMaterials,v.properties,!u).then(()=>this._stageLayer?.sync())}}}const x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=n.create(),p=n.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,
1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=r;a.Object3DEdgeState=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/hydratedFeatures".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(q){var u=q.paths[0];if(!u||0===u.length)return null;u=f.getPointOnPath(u,f.getPathLength(u)/2);return r.makeDehydratedPoint(u[0],u[1],u[2],q.spatialReference)}function p(q,u,v){v=v?q:x.clonePoint(q);return u&&q?e.projectPoint(q,v,u)?v:null:v}function t(q){const u=v=>null==v||0<=v;return Array.isArray(q)?q.every(u):null==q||0<=q}a.computeCentroid=function(q,u){if("point"===q.type)return p(q,u,!1);if(x.isHydratedGeometry(q))switch(q.type){case "extent":return p(q.center,
u,!1);case "polygon":return p(q.centroid,u,!1);case "polyline":return p(w(q),u,!0);case "mesh":return p(q.origin,u,!1)}else switch(q.type){case "extent":return q=r.makeDehydratedPoint(.5*(q.xmax+q.xmin),.5*(q.ymax+q.ymin),null!=q.zmin&&null!=q.zmax&&isFinite(q.zmin)&&isFinite(q.zmax)?.5*(q.zmax+q.zmin):void 0,q.spatialReference),p(q,u,!0);case "polygon":var v=q.rings[0];v&&0!==v.length?(v=l.ringsCentroid(q.rings,!!q.hasZ),q=r.makeDehydratedPoint(v[0],v[1],v[2],q.spatialReference)):q=null;return p(q,
u,!0);case "polyline":return p(w(q),u,!0)}};a.computeObjectRotation=function(q,u,v,y=h.create()){q&&n.rotateZ(y,y,-q/180*Math.PI);u&&n.rotateX(y,y,u/180*Math.PI);v&&n.rotateY(y,y,v/180*Math.PI);return y};a.computeObjectScale=function(q=k.ONES,u,v,y=1){const D=Array(3);if(null==u||null==v)D[0]=1,D[1]=1,D[2]=1;else{let A=0;for(let C=2;0<=C;C--){const E=q[C];let I;const H=null!=E,J=0===C&&!G&&!H,B=v[C];"symbol-value"===E||J?I=0!==B?u[C]/B:1:H&&"proportional"!==E&&isFinite(E)&&(I=0!==B?E/B:1);if(null!=
I){var G=D[C]=I;A=Math.max(A,Math.abs(I))}}for(q=2;0<=q;q--)null==D[q]?D[q]=G:0===D[q]&&(D[q]=.001*A)}for(G=2;0<=G;G--)D[G]/=y;return k.fromArray(D)};a.demResolutionForBoundingBox=function(q,u,v){if(null!=v.minDemResolution)return v.minDemResolution;const y=b.getMetersPerUnitForSR(u),D=d.width(q)*y,G=d.depth(q)*y;q=d.height(q)*(u.isGeographic?1:y);return 0===D&&0===G&&0===q?v.minDemResolutionForPoints:.01*Math.max(D,G,q)};a.enlargeExtent=function(q,u,v,y=0){if(q){u||=c.create();let D=.5*q.width*(v-
1);v=.5*q.height*(v-1);q.width<1E-7*q.height?D+=v/20:q.height<1E-7*q.width&&(v+=D/20);m.set(u,q.xmin-D-y,q.ymin-v-y,q.xmax+D+y,q.ymax+v+y);return u}return null};a.isValidSize=t;a.mixinColorAndOpacity=function(q,u,v=null){const y=g.clone(g.ONES);null!=q&&(y[0]=q[0],y[1]=q[1],y[2]=q[2]);null!=u?y[3]=u:null!=q&&3<q.length&&(y[3]=q[3]);v&&(y[0]*=v,y[1]*=v,y[2]*=v,y[3]*=v);return y};a.overrideColor=function(q,u,v,y,D,G=[0,0,0,0]){for(let A=0;3>A;++A)G[A]=null!=q?.[A]?q[A]:null!=v?.[A]?v[A]:D[A];G[3]=null!=
u?u:null!=y?y:D[3];return G};a.validateSymbolLayerSize=function(q){return t(null!=q.isPrimitive?[q.width,q.depth,q.height]:q)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency={});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports"],function(a){class b{constructor(n,h=null){this.labelText=h;this.elevationOffset=n??0}}a.Graphics3DObjectMetadata=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./defaultSymbolComplexity ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ../support/FastSymbolUpdates".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(y){const D={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};y&&"visualVariables"in y&&y.visualVariables&&y.visualVariables.forEach(G=>{switch(G.type){case "color":D.color=!0;if(G.stops)for(let A=0;A<G.stops.length;A++){const C=G.stops[A].color;C&&(D.opacity=!0,1>C.a&&(D.opacityAlwaysOpaque=!1))}break;case "opacity":D.opacity=!0;D.opacityAlwaysOpaque=!1;break;case "size":D.size=!0}});return D}const p=()=>h.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
class t extends r.Loadable{constructor(y,D,G,A){super(G.schedule);this.symbol=y;this.symbolLayer=D;this._context=G;this.ignoreDrivers=!1;this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};this._materials=[];this.usedMemory=0;this.logger=p();this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};this.skipHighSymbolLodsChanged=!0;this._renderPriority=A.renderPriority;this._renderPriorityStep=A.renderPriorityStep;this._elevationContext=new d.ElevationContext;
this.complexity=this.computeComplexity();this.ignoreDrivers=A.ignoreDrivers;this.ignoreDrivers||(this._drivenProperties=w(this._context.renderer));this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}_drivenPropertiesChanged(y){if(this.ignoreDrivers)return!1;const D=this._drivenProperties;y=w(y);return y.color!==D.color||y.opacity!==D.opacity||y.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||y.size!==D.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(y,D,G,A){const C="polygons"in y?y.polygons:null,E=`${A} geometry failed to be created`;let I=null;y.projectionSuccess?!this._logGeometryValidationWarnings(D,G,A)&&C&&0===C.length&&"rings"===G&&0<D.length&&2<D[0].length&&(I=`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):I=`${E} (failed to project geometry to view spatial reference)`;I&&p().warnOncePerTick(I)}_logGeometryValidationWarnings(y,
D,G){G=`${G} geometry failed to be created`;return!y.length||1===y.length&&!y[0].length?(p().warnOncePerTick(`${G} (no ${D} were defined)`),!0):Array.isArray(y)&&Array.isArray(y[0])?!1:(p().warnOncePerTick(`${G} (${D} should be defined as a 2D array)`),!0)}_validateGeometry(y,D=null,G=null){return null==D||D.includes(y.type)?"point"!==y.type||isFinite(y.x)&&isFinite(y.y)?!0:(p().warn("point coordinate is not a valid number, graphic skipped"),!1):(this.logger.warn("unsupported geometry type for "+
G+` symbol: ${y.type}`),!1)}_defaultElevationInfoNoZ(){return q}_defaultElevationInfoZ(){return u}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()}getDefaultElevationInfo(y){return y.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(y,D=this.getDefaultElevationInfo(y)){return this._elevationContext.mode||D.mode}setElevationInfoOverride(y){this._elevationInfoOverride=y;this._updateElevationContext()}setGraphicElevationContext(y,D=new d.ElevationContext){var G=y.geometry;const A=this.getDefaultElevationInfo(G);D.unit=null!=this._elevationContext.unit?this._elevationContext.unit:
A.unit;D.mode=this.getGeometryElevationMode(G,A);D.offsetMeters=this._elevationContext.meterUnitOffset??A.offset??0;if(G=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode="relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(G?c.zeroContext:this._elevationContext.featureExpressionInfoContext,y,this._context.layer);return D}prepareSymbolLayerPatch(y){}updateGeometry(y,D){return!1}updateTransform(y,D,G,A){return!1}onRemoveGraphic(y){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&
"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const y=this._context.layer.opacity;return null==y?1:y}_getCombinedOpacity(y,D=v){let G=1;this.draped||(G*=this._getLayerOpacity());if(this._drivenProperties.opacity)return G;null!=y?G*=y.a:D.hasIntrinsicColor||(G=0);return G}_getCombinedOpacityAndColor(y,D=v){D=this._getCombinedOpacity(y,D);if(this._drivenProperties.color)return l.mixinColorAndOpacity(null,D);y=null!=y?b.toUnitRGB(y):k.ONES;return l.mixinColorAndOpacity(y,
D)}_getVertexOpacityAndColor(y,D=null){y=l.mixinColorAndOpacity(this._drivenProperties.color?y.color:null,this._drivenProperties.opacity?y.opacity:null);D&&(y[0]*=D,y[1]*=D,y[2]*=D,y[3]*=D);return y}isFastUpdatesEnabled(){return null!=this._fastUpdates}computeComplexity(){return g.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)}globalPropertyChanged(y,D,G){switch(y){case "opacity":return this.layerOpacityChanged(D,G),!0;case "elevationInfo":return y=this._elevationContext.mode,this._updateElevationContext(),
this.layerElevationInfoChanged(D,G,y)===e.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,G);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged;case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(y,D,G){let A=e.SymbolUpdateType.UPDATE;y.forEach(C=>{const E=D(C);null!=E?(this.setGraphicElevationContext(C.graphic,
E.elevationContext),E.needsElevationUpdates=G(E.elevationContext.mode)):A=e.SymbolUpdateType.RECREATE});return A}applyRendererDiff(y,D){return f.ApplyRendererDiffResult.RecreateSymbol}getFastUpdateAttrValues(y){if(!this._fastUpdates)return null;const D=this._fastUpdates.visualVariables,G=D.size?x.getAttributeValue(D.size.field,y):0,A=D.color?x.getAttributeValue(D.color.field,y):0;y=D.opacity?x.getAttributeValue(D.opacity.field,y):0;return m.fromValues(G,A,y,0)}get draped(){return this._draped}ensureDrapedStatus(y){if(null==
this._draped)return this._draped=y,!0;y!==this.draped&&p().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??
null})}}}const q={mode:"on-the-ground",offset:0,unit:"meters"},u={mode:"absolute-height",offset:0,unit:"meters"},v={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/defaultSymbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ./SymbolComplexity ../support/edgeUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,n,h,k,m,g,e){function d(p){let t=0,q=0,u=0,v=!1,y=0;const D=new m.SymbolComplexityMemory;for(const G of p)null!=G&&(t+=G.verticesPerFeature,q+=G.verticesPerCoordinate,u+=G.drawCallsPerFeature,D.bytesPerFeature+=G.memory.bytesPerFeature,D.bytesPerFeatureLabel+=G.memory.bytesPerFeatureLabel,D.resourceBytes+=G.memory.resourceBytes,D.draped.bytesPerFeature+=G.memory.bytesPerFeature,D.draped.bytesPerFeatureLabel+=G.memory.bytesPerFeatureLabel,v=v||G.estimated,++y);return v?new m.EstimatedAggregateSymbolComplexity(y,
{verticesPerFeature:t,verticesPerCoordinate:q,drawCallsPerFeature:u,memory:D}):new m.AggregateSymbolComplexity(y,{verticesPerFeature:t,verticesPerCoordinate:q,drawCallsPerFeature:u,memory:D})}function c(p,t){const q=l(p,t);var u=g.hasEdges(t)?2:0;switch(t.type){case "extrude":return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:u,memory:q});case "fill":if("mesh-3d"===p.type)return new m.SymbolComplexity({drawCallsPerFeature:u,memory:q});if(null!=t.outline&&
0<t.outline.size)return new m.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:q});case "water":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:q});case "line":return new m.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:q});case "object":if(t.resource?.href)return new m.EstimatedSymbolComplexity({verticesPerFeature:100,memory:q});t=t.resource?.primitive??n.defaultPrimitive;(p=x[t])?t=p:(p=k.primitiveLodResources(t,
new e.DefaultMaterial({})),p=f(p.levels),x[t]=new m.SymbolComplexity({verticesPerFeature:p}),t=x[t]);return{...t,memory:q};case "path":var v=p=0;switch(t.profile){case "circle":p=h.pathNumCircleProfileSubdivisions;break;case "quad":p=4;break;default:b.neverReached(t.profile);return}switch(t.join??"simple"){case "round":v=h.pathNumRoundJoinSubdivisions;break;case "miter":case "bevel":v=1;break;default:return}u=2*p;v=p*v*2;let y=-2*v-u;switch(t.cap){case "none":break;case "butt":case "square":y+=2*
(p-1);break;case "round":y+=2*(p*(h.pathNumRoundCapExtrusionSubdivisions-1)*2+p);break;default:return}return new m.SymbolComplexity({verticesPerFeature:y,verticesPerCoordinate:v+u,memory:q});case "text":case "icon":return new m.SymbolComplexity({verticesPerFeature:6,memory:q})}}function l(p,t){p="point-3d"===p.type;switch(t.type){case "extrude":return t.edges&&0<t.edges.size?w.EXTRUDE_EDGES:w.EXTRUDE;case "fill":return null!=t.outline&&0<t.outline.size?w.FILL_OUTLINE:w.FILL;case "water":return w.FILL;
case "line":return"round"===t.join?w.LINE_ROUND:w.LINE_MITER;case "path":switch(t.join){case "round":switch(t.profile){case "circle":return w.PATH_ROUND_CIRCLE;case "quad":return w.PATH_ROUND_QUAD;default:b.neverReached(t.profile);return}case "miter":case "bevel":switch(t.profile){case "circle":return w.PATH_MITER_CIRCLE;case "quad":return w.PATH_MITER_QUAD;default:b.neverReached(t.profile);return}case "simple":return;default:return}case "object":return p?w.OBJECT_POINT:w.OBJECT_POLYGON;case "icon":case "text":return p?
w.ICON_POINT:w.ICON_POLYGON}}function f(p){return p.reduce((t,q,u)=>t+1/10**u*q.numVertices,0)/p.reduce((t,q,u)=>t+1/10**u,0)}const r=new m.EstimatedSymbolComplexity({}),x={},w={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},
OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,
bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,
draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,
resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,
bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}};a.averageSymbolComplexities=function(p){p=d(p);0<p.numComplexities&&(p.verticesPerFeature/=p.numComplexities,p.verticesPerCoordinate/=p.numComplexities,p.drawCallsPerFeature/=p.numComplexities,p.memory.bytesPerFeature/=p.numComplexities,p.memory.bytesPerFeatureLabel/=p.numComplexities,p.memory.resourceBytes/=p.numComplexities,p.memory.draped.bytesPerFeature/=
p.numComplexities,p.memory.draped.bytesPerFeatureLabel/=p.numComplexities);return p};a.defaultSymbolComplexity=function(p){if("web-style"===p.type)return r;const t=p.symbolLayers.toArray().map(q=>c(p,q));return d(t)};a.defaultSymbolLayerComplexity=c;a.defaultSymbolLayerMemoryComplexity=l;a.emptySymbolComplexity=r;a.estimateNumVerticesForLods=f;a.memoryEstimators=w;a.totalSymbolComplexities=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],
function(a){a.pathNumCircleProfileSubdivisions=10;a.pathNumRoundCapExtrusionSubdivisions=3;a.pathNumRoundJoinSubdivisions=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b,n,h){const k=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,
minScreenSpaceRadius:65}];a.isValidPrimitive=function(m){switch(m){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(m,g){const e=(d,c,l=!1)=>new h.LodResources(d.map(f=>{const r=c(f.tesselation);l&&n.cgToGIS(r);return new h.LodLevelResources([new h.LodComponentResources(r)],f.minScreenSpaceRadius)}));switch(m){case "sphere":return e([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,
minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],d=>n.createPolySphereGeometry(g,.5,d,!0));case "cube":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>n.createBoxGeometry(g,1));case "cone":return e(k,d=>n.createConeGeometry(g,1,.5,d,!1),!0);case "inverted-cone":return e(k,d=>n.createConeGeometry(g,1,.5,d,!0),!0);case "cylinder":return e(k,d=>n.createCylinderGeometry(g,1,.5,d,[0,0,1],[0,0,.5]));case "tetrahedron":return e([{tesselation:0,
minScreenSpaceRadius:0}],()=>n.createTetrahedronGeometry(g,1),!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>n.createDiamondGeometry(g,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../VertexAttribute"],function(a,b,n){class h{constructor(g,e=null){this.geometry=g;this.textures=e}}class k{constructor(g,e,d){this.components=g;
this.minScreenSpaceRadius=e;this.pivotOffset=d;this.numVertices=this.geometries.reduce((c,l)=>c+l.attributes.get(n.VertexAttribute.POSITION).indices.length,0)}get geometries(){return b.unique(this.components.map(g=>g.geometry))}}class m{constructor(g){this.levels=g;this.levels.sort((e,d)=>e.minScreenSpaceRadius===d.minScreenSpaceRadius?e.numVertices-d.numVertices:e.minScreenSpaceRadius-d.minScreenSpaceRadius)}}a.LodComponentResources=h;a.LodLevelResources=k;a.LodResources=m;a.geometriesFromLodResources=
function(g){const e=[];g.levels.forEach(d=>d.components.forEach(c=>e.push(c.geometry)));return b.unique(e)};a.materialsFromLodResources=function(g){const e=[];g.levels.forEach(d=>d.components.forEach(c=>e.push(c.geometry.material)));return b.unique(e)};a.texturesFromLodResources=function(g){const e=[];g.levels.forEach(d=>d.components.forEach(c=>{null!=c.textures&&e.push(...c.textures)}));return b.unique(e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SymbolComplexity":function(){define(["exports"],
function(a){class b{constructor(g){this.estimated=!1;this.verticesPerFeature=g.verticesPerFeature??0;this.verticesPerCoordinate=g.verticesPerCoordinate??0;this.drawCallsPerFeature=g.drawCallsPerFeature??0;this.memory=g.memory??new m}}class n extends b{constructor(g){super(g);this.estimated=!0}}class h extends b{constructor(g,e){super(e);this.numComplexities=g}}class k extends n{constructor(g,e){super(e);this.numComplexities=g}}class m{constructor(){this.resourceBytes=this.bytesPerFeatureLabel=this.bytesPerFeature=
0;this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}a.AggregateSymbolComplexity=h;a.EstimatedAggregateSymbolComplexity=k;a.EstimatedSymbolComplexity=n;a.SymbolComplexity=b;a.SymbolComplexityMemory=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,n,h,k,m,g){function e(f,r){if(null==f)return null;const x=null!=f.color?k.fromArray(b.toUnitRGBA(f.color)):k.fromValues(0,0,0,0),w=h.pt2px(f.size),p=h.pt2px(f.extensionLength);switch(f.type){case "solid":return d({color:x,size:w,extensionLength:p,...r});case "sketch":return{...l,color:x,size:w,extensionLength:p,...r,type:"sketch"}}}function d(f){return{...c,...f,type:"solid"}}const c={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,
hasSlicePlane:!1},l={color:k.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(f,r){return e(f&&f.enabled&&f.edges||null,r)};a.createMaterialFromEdges=e;a.createSolidEdgeMaterial=d;a.hasEdges=function(f){return f&&f.enabled&&(m.isExtrudeSymbol3DLayer(f)||m.isFillSymbol3DLayer(f))&&null!=f.edges};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../core/has ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(M){const S=m.newLayout().vec3f(p.VertexAttribute.POSITION);M.normalType===e.NormalType.Compressed?S.vec2i16(p.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}):S.vec3f(p.VertexAttribute.NORMAL);M.hasVertexTangents&&S.vec4f(p.VertexAttribute.TANGENT);(M.textureId||M.normalTextureId||M.metallicRoughnessTextureId||M.emissiveTextureId||M.occlusionTextureId)&&S.vec2f(p.VertexAttribute.UV0);M.hasVertexColors&&S.vec4u8(p.VertexAttribute.COLOR);
M.hasSymbolColors&&S.vec4u8(p.VertexAttribute.SYMBOLCOLOR);b("enable-feature:objectAndLayerId-rendering")&&S.vec4u8(p.VertexAttribute.OBJECTANDLAYERIDCOLOR);return S}class A extends r.Material{constructor(M){super(M,I);this.supportsEdges=!0;this.produces=new Map([[w.RenderSlot.OPAQUE_MATERIAL,S=>(g.is3DGeometryOutput(S)||g.isShadowRelatedOutput(S))&&!this.parameters.transparent],[w.RenderSlot.TRANSPARENT_MATERIAL,S=>(g.is3DGeometryOutput(S)||g.isShadowRelatedOutput(S))&&this.parameters.transparent&&
this.parameters.writeDepth],[w.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,S=>(g.is3DGeometryOutput(S)||g.isShadowRelatedOutput(S))&&this.parameters.transparent&&!this.parameters.writeDepth]]);this._configuration=new y.DefaultMaterialTechniqueConfiguration;this._vertexBufferLayout=G(this.parameters)}isVisibleForOutput(M){return M===g.ShaderOutput.Shadow||M===g.ShaderOutput.ShadowExcludeHighlight||M===g.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){var M=this.parameters;
if(!super.isVisible()||0===M.layerOpacity)return!1;const {hasInstancedColor:S,hasVertexColors:N,hasSymbolColors:P,vvColor:R}=M,O="replace"===M.colorMixMode,T=0<M.opacity;M=M.externalColor&&0<M.externalColor[3];const Q=S||R||P;return N&&Q?O||T:N?O?M:T:Q?O||T:O?M:T}getConfiguration(M,S){this._configuration.output=M;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=this.parameters.hasVertexTangents;
this._configuration.instanced=this.parameters.isInstanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=
this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;null!=this.parameters.customDepthTest&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?l.CullFaceOptions.None:this.parameters.cullFace;this._configuration.multipassEnabled=
S.multipassEnabled;this._configuration.cullAboveGround=S.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=null!=this.parameters.modelTransformation;if(M===g.ShaderOutput.Color||M===g.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=this.parameters.treeRendering?d.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===
this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.WindingOrder:d.NormalsDoubleSidedMode.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=this.parameters.receiveAmbientOcclusion&&null!=S.ssao,this._configuration.vvColor=
!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?c.PBRMode.Schematic:c.PBRMode.Normal:c.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=
!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=S.transparencyPassType,this._configuration.enableOffset=S.camera.relativeElevation<x.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(S),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=
!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration}hasSnowCover(M){return null!=M.weather&&M.weatherVisible&&"snowy"===M.weather.type&&"enabled"===M.weather.snowCover}intersect(M,S,N,P,R,O){if(null!=this.parameters.verticalOffset){const Q=N.camera;n.set(L,S[12],
S[13],S[14]);S=null;switch(N.viewingMode){case k.ViewingMode.Global:S=n.normalize(z,L);break;case k.ViewingMode.Local:S=n.copy(z,B)}let V=0;var T=n.subtract(F,L,Q.eye);const U=n.length(T);T=n.scale(T,T,1/U);let W=null;this.parameters.screenSizePerspective&&(W=n.dot(S,T));V+=u.verticalOffsetAtDistance(Q,U,this.parameters.verticalOffset,W??0,this.parameters.screenSizePerspective);n.scale(S,S,V);n.transformMat3(K,S,N.transform.inverseRotation);P=n.subtract(H,P,K);R=n.subtract(J,R,K)}u.intersectTriangleGeometry(M,
N,P,R,t.getVerticalOffsetObject3D(N.verticalOffset),O)}createGLMaterial(M){return new C(M)}createBufferWriter(){return new q.DefaultBufferWriter(this._vertexBufferLayout)}}class C extends f.GLTextureMaterial{constructor(M){super({...M,...M.material.parameters})}_updateShadowState(M){M.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:M.shadowMap.enabled})}_updateOccludeeState(M){M.hasOccludees!==this._material.parameters.hasOccludees&&
this._material.setParameters({hasOccludees:M.hasOccludees})}beginSlot(M){if(this._output===g.ShaderOutput.Color||this._output===g.ShaderOutput.Alpha)this._updateShadowState(M),this._updateOccludeeState(M);const S=this._material.parameters;this.updateTexture(S.textureId);const N=M.camera.viewInverseTransposeMatrix;n.set(S.origin,N[3],N[7],N[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(S.treeRendering?D.RealisticTreeTechnique:v.DefaultMaterialTechnique,M)}}
class E extends v.DefaultMaterialPassParameters{constructor(){super(...arguments);this.hasVertexTangents=this.treeRendering=this.initTextureTransparent=!1}}const I=new E,H=h.create(),J=h.create(),B=h.fromValues(0,0,1),z=h.create(),K=h.create(),L=h.create(),F=h.create();a.DefaultGLMaterial=C;a.DefaultMaterial=A;a.DefaultMaterialParameters=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports",
"../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,n,h){a.NormalType=void 0;(function(k){k[k.Attribute=0]="Attribute";k[k.Compressed=1]="Compressed";k[k.Ground=2]="Ground";k[k.ScreenDerivative=3]="ScreenDerivative";k[k.COUNT=4]="COUNT"})(a.NormalType||(a.NormalType={}));a.NormalAttribute=function(k,m){switch(m.normalType){case a.NormalType.Compressed:k.attributes.add(h.VertexAttribute.NORMALCOMPRESSED,"vec2");k.vertex.code.add(n.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case a.NormalType.Attribute:k.attributes.add(h.VertexAttribute.NORMAL,"vec3");k.vertex.code.add(n.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalType.ScreenDerivative:k.fragment.code.add(n.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:b.neverReached(m.normalType);case a.NormalType.COUNT:case a.NormalType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,n){a.NormalsDoubleSidedMode=void 0;(function(h){h[h.None=0]="None";h[h.View=1]="View";h[h.WindingOrder=2]="WindingOrder";h[h.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||
(a.NormalsDoubleSidedMode={}));a.Normals=function(h,k){h=h.fragment;h.code.add(n.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(k.doubleSidedMode){case a.NormalsDoubleSidedMode.None:h.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:h.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:h.code.add(n.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(k.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,b,n){class h{constructor(k){this.vertexBufferLayout=k}elementCount(k){return k.attributes.get(b.VertexAttribute.POSITION).indices.length}write(k,m,g,e,d){n.writeDefaultAttributes(g,this.vertexBufferLayout,
k,m,e,d)}}a.DefaultBufferWriter=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/pbrUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){class A extends d.VertexNormalPassParameters{constructor(){super(...arguments);this.usePBR=this.isSchematic=!1;this.mrrFactors=n.fromArray(v.defaultAdvancedMRRFactors);this.doubleSided=this.hasSymbolColors=this.hasVertexColors=!1;this.doubleSidedType="normal";this.cullFace=r.CullFaceOptions.Back;this.hasInstancedColor=this.isInstanced=!1;this.emissiveFactor=n.fromValues(0,0,0);this.instancedDoublePrecision=!1;this.normalType=g.NormalType.Attribute;
this.castShadows=this.receiveAmbientOcclusion=this.receiveShadows=!0;this.shadowMappingEnabled=!1;this.ambient=n.fromValues(.2,.2,.2);this.diffuse=n.fromValues(.8,.8,.8);this.externalColor=h.fromValues(1,1,1,1);this.colorMixMode="multiply";this.layerOpacity=this.opacity=1;this.origin=n.create();this.hasSlicePlane=!1;this.hasSliceHighlight=!0;this.offsetTransparentBackfaces=!1;this.modelTransformation=this.vvSymbolRotationMatrix=this.vvSymbolAnchor=this.vvOpacity=this.vvColor=this.vvSize=null;this.transparent=
!1;this.writeDepth=!0;this.customDepthTest=r.DepthTestFunction.Less;this.textureAlphaMode=r.AlphaDiscardMode.Blend;this.textureAlphaCutoff=c.defaultMaskAlphaCutoff;this.hasOccludees=this.textureAlphaPremultiplied=!1;this.renderOccluded=w.RenderOccludedFlag.Occlude;this.isDecoration=!1}}class C extends d.VertexNormalDrawParameters{constructor(){super(...arguments);this.slicePlaneLocalOrigin=this.origin=n.create()}}class E extends f.ShaderTechnique{initializeConfiguration(I,H){H.spherical=I.viewingMode===
k.ViewingMode.Global;H.doublePrecisionRequiresObfuscation=I.rctx.driverTest.doublePrecisionRequiresObfuscation.result;H.textureCoordinateType=H.hasColorTexture||H.hasMetallicRoughnessTexture||H.hasEmissionTexture||H.hasOcclusionTexture||H.hasNormalTexture?e.TextureCoordinateAttributeType.Default:e.TextureCoordinateAttributeType.None;H.objectAndLayerIdColorInstanced=H.instanced}initializeProgram(I){return this._initializeProgram(I,E.shader)}_initializeProgram(I,H){return new t.Program(I.rctx,H.get().build(this.configuration),
x.Default3D)}_convertDepthTestFunction(I){return I===r.DepthTestFunction.Lequal?D.CompareFunction.LEQUAL:D.CompareFunction.LESS}_makePipeline(I,H){const J=this.configuration,B=I===u.TransparencyPassType.NONE,z=I===u.TransparencyPassType.FrontFace;var K=G.makePipelineState,L=J.output!==m.ShaderOutput.Color&&J.output!==m.ShaderOutput.Alpha||!J.transparent?null:B?p.blendingDefault:p.oitBlending(I);var F=J.cullFace!==r.CullFaceOptions.None?!0:J.hasSlicePlane?!1:!J.transparent&&!J.doubleSidedMode;return K.call(G,
{blending:L,culling:F?G.cullingParams(J.cullFace):null,depthTest:{func:p.oitDepthTest(I,this._convertDepthTestFunction(J.customDepthTest))},depthWrite:B||z?J.writeDepth?G.defaultDepthWriteParams:null:null,colorWrite:G.defaultColorWriteParams,stencilWrite:J.hasOccludees?q.stencilWriteMaskOn:null,stencilTest:J.hasOccludees?H?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null,polygonOffset:B||z?null:p.getOITPolygonOffset(J.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,
!0);return this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(I){return I?this._occludeePipelineState:super.getPipeline()}}E.shader=new l.ReloadableShaderModule(y.DefaultMaterial,()=>new Promise((I,H)=>a(["./DefaultMaterial.glsl"],I,H)));b.DefaultMaterialDrawParameters=C;b.DefaultMaterialPassParameters=A;b.DefaultMaterialTechnique=E;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends m.VertexPositionPassParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=n.create()}}class l extends m.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalGlobalFromModel=n.create();this.toMapSpace=h.create()}}a.VertexNormal=function(f,r){switch(r.normalType){case k.NormalType.Attribute:case k.NormalType.Compressed:f.include(k.NormalAttribute,r);f.varyings.add("vNormalWorld","vec3");f.varyings.add("vNormalView",
"vec3");f.vertex.uniforms.add(new e.Matrix3DrawUniform("transformNormalGlobalFromModel",x=>x.transformNormalGlobalFromModel),new d.Matrix3PassUniform("transformNormalViewFromGlobal",x=>x.transformNormalViewFromGlobal));f.vertex.code.add(g.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case k.NormalType.Ground:f.include(m.VertexPosition,r);f.varyings.add("vNormalWorld","vec3");f.vertex.code.add(g.glsl`
        void forwardNormal() {
          vNormalWorld = ${r.spherical?g.glsl`normalize(vPositionWorldCameraRelative);`:g.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case k.NormalType.ScreenDerivative:f.vertex.code.add(g.glsl`void forwardNormal() {}`);break;default:b.neverReached(r.normalType);case k.NormalType.COUNT:}};a.VertexNormalDrawParameters=l;a.VertexNormalPassParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,n){const h={func:n.CompareFunction.LESS},k={function:{func:n.CompareFunction.ALWAYS,
ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.ZERO}},m={function:{func:n.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.REPLACE}},g={function:{func:n.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}};b={function:{func:n.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}};a.depthCompareAlways={func:n.CompareFunction.ALWAYS};a.depthCompareLess=h;a.renderWhenBitIsNotSet=e=>({function:{func:n.CompareFunction.NOTEQUAL,
ref:e,mask:e},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=e=>({function:{func:n.CompareFunction.ALWAYS,ref:e,mask:e},operation:{fail:n.StencilOperation.KEEP,zFail:n.StencilOperation.KEEP,zPass:n.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=k;a.stencilToolMaskBaseParams=m;a.stencilToolMaskOccluderParams=g;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn=
{mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n){a.defaultAdvancedMRRFactors=[1,1,.5];a.defaultEsriSymbologyMRRFactors=[0,1,.2];a.defaultSchematicMRRFactors=[0,.6,.2];a.useSchematicPBR=function({normalTexture:h,metallicRoughnessTexture:k,metallicFactor:m,roughnessFactor:g,emissiveTexture:e,emissiveFactor:d,
occlusionTexture:c}){return null==h&&null==k&&null==e&&(null==d||b.exactEquals(d,n.ZEROS))&&null==c&&(null==g||1===g)&&(null==m||1===m)};a.useSchematicPBRI3S=function({normalTexture:h,metallicRoughnessTexture:k,metallicFactor:m,roughnessFactor:g,emissiveTexture:e,emissiveFactor:d,occlusionTexture:c}){return null==h&&null==k&&null==e&&(null==d||b.exactEquals(d,n.ZEROS))&&null==c&&(null==g||1===g)&&(null==m||1===m||0===m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P){function R(T){const Q=new M.ShaderBuilder,{vertex:V,fragment:U,varyings:W}=Q;B.addProjViewLocalOrigin(V,T);Q.include(d.PositionAttribute);W.add("vpos","vec3");Q.include(E.VisualVariables,T);Q.include(g.InstancedDoublePrecision,T);Q.include(x.VerticalOffset,T);Q.include(C.colorTextureUV,T);if(T.output===h.ShaderOutput.Color||T.output===h.ShaderOutput.Alpha){Q.include(C.normalTextureUV,T);Q.include(C.emissiveTextureUV,
T);Q.include(C.occlusionTextureUV,T);Q.include(C.metallicRoughnessTextureUV,T);B.addCameraPosition(V,T);Q.include(e.NormalAttribute,T);Q.include(m.Transform,T);const ca=T.normalType===e.NormalType.Attribute||T.normalType===e.NormalType.Compressed;ca&&T.offsetBackfaces&&Q.include(n.Offset);Q.include(p.ComputeNormalTexture,T);Q.include(r.VertexNormal,T);T.instancedColor&&Q.attributes.add(P.VertexAttribute.INSTANCECOLOR,"vec4");W.add("vPositionLocal","vec3");Q.include(l.TextureCoordinateAttribute,T);
Q.include(b.ForwardLinearDepth,T);Q.include(c.SymbolColor,T);Q.include(f.VertexColor,T);V.uniforms.add(new K.Float4PassUniform("externalColor",X=>X.externalColor));W.add("vcolorExt","vec4");T.multipassEnabled&&W.add("depth","float");V.code.add(F.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${T.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${F.glsl.float(I.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = getVertexInLocalOriginSpace();
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${ca?F.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${T.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${ca&&T.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${T.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        forwardColorUV();
        forwardNormalUV();
        forwardEmissiveUV();
        forwardOcclusionUV();
        forwardMetallicRoughnessUV();
      }
    `)}switch(T.output){case h.ShaderOutput.Alpha:Q.include(k.SliceDraw,T);Q.include(H.DiscardOrAdjustAlphaPass,T);Q.include(v.multipassTerrainTest,T);U.uniforms.add(new L.FloatPassUniform("opacity",ca=>ca.opacity),new L.FloatPassUniform("layerOpacity",ca=>ca.layerOpacity));T.hasColorTexture&&U.uniforms.add(new S.Texture2DPassUniform("tex",ca=>ca.texture));U.include(J.MixExternalColor);U.code.add(F.glsl`
      void main() {
        discardBySlice(vpos);
        ${T.multipassEnabled?"terrainDepthTest(depth);":""}
        ${T.hasColorTexture?F.glsl`
                vec4 texColor = texture(tex, ${T.hasColorTextureTransform?F.glsl`colorUV`:F.glsl`vuv0`});
                ${T.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F.glsl`vec4 texColor = vec4(1.0);`}
        ${T.hasVertexColors?F.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case h.ShaderOutput.Color:Q.include(k.SliceDraw,T),Q.include(q.EvaluateSceneLighting,T),Q.include(t.EvaluateAmbientOcclusion,T),Q.include(H.DiscardOrAdjustAlphaPass,T),Q.include(T.instancedDoublePrecision?A.ReadShadowMapPass:A.ReadShadowMapDraw,T),Q.include(v.multipassTerrainTest,T),B.addCameraPosition(U,T),U.uniforms.add(V.uniforms.get("localOrigin"),new z.Float3PassUniform("ambient",ca=>ca.ambient),new z.Float3PassUniform("diffuse",ca=>ca.diffuse),new L.FloatPassUniform("opacity",ca=>
ca.opacity),new L.FloatPassUniform("layerOpacity",ca=>ca.layerOpacity)),T.hasColorTexture&&U.uniforms.add(new S.Texture2DPassUniform("tex",ca=>ca.texture)),Q.include(G.PhysicallyBasedRenderingParameters,T),Q.include(D.PhysicallyBasedRendering,T),U.include(J.MixExternalColor),Q.include(y.Normals,T),q.addAmbientBoostFactor(U),q.addLightingGlobalFactor(U),u.addMainLightIntensity(U),U.code.add(F.glsl`
      void main() {
        discardBySlice(vpos);
        ${T.multipassEnabled?"terrainDepthTest(depth);":""}
        ${T.hasColorTexture?F.glsl`
                vec4 texColor = texture(tex, ${T.hasColorTextureTransform?F.glsl`colorUV`:F.glsl`vuv0`});
                ${T.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:F.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${T.normalType===e.NormalType.ScreenDerivative?F.glsl`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:F.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${T.pbrMode===G.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${T.receiveShadows?"readShadowMap(vpos, linearDepth)":T.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${T.hasVertexColors?F.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:F.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${T.hasNormalTexture?F.glsl`
                mat3 tangentSpace = ${T.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${T.hasNormalTextureTransform?F.glsl`normalUV`:"vuv0"});`:F.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${T.spherical?F.glsl`normalize(posWorld);`:F.glsl`vec3(0.0, 0.0, 1.0);`}

        ${T.snowCover?F.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${T.pbrMode===G.PBRMode.Normal||T.pbrMode===G.PBRMode.Schematic?F.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${T.snowCover?F.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:F.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${T.transparencyPassType===N.TransparencyPassType.Color?F.glsl`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}Q.include(w.DefaultMaterialAuxiliaryPasses,T);return Q}const O=Object.freeze(Object.defineProperty({__proto__:null,build:R},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=O;a.build=R})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(n){n.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,n,h,k,m){a.SymbolColor=function(g,e){e.hasSymbolColors?(g.include(b.DecodeSymbolColor),g.attributes.add(k.VertexAttribute.SYMBOLCOLOR,
"vec4"),g.varyings.add("colorMixMode","mediump float"),g.vertex.code.add(h.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(g.fragment.uniforms.add(new n.IntegerPassUniform("colorMixMode",d=>m.colorMixModes[d.colorMixMode])),g.vertex.code.add(h.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,n){a.DecodeSymbolColor=function(h){h.vertex.code.add(n.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${n.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils"],function(a,b){a.ColorMixModeEnum=void 0;(function(n){n[n.Multiply=1]="Multiply";n[n.Ignore=2]="Ignore";n[n.Replace=3]="Replace";n[n.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(n,h,k){if(null==n||h===a.ColorMixModeEnum.Ignore)k[0]=255,k[1]=255,k[2]=255,k[3]=255;else{var m=b.clamp(Math.round(85*
n[3]),0,85);h=0===m||h===a.ColorMixModeEnum.Tint?0:h===a.ColorMixModeEnum.Replace?85:170;k[0]=b.clamp(Math.round(255*n[0]),0,255);k[1]=b.clamp(Math.round(255*n[1]),0,255);k[2]=b.clamp(Math.round(255*n[2]),0,255);k[3]=m+h}};a.parseColorMixMode=function(n){switch(n){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"int",n.BindType.Pass,(g,e,d)=>g.setUniform1i(k,m(e,d)))}}a.IntegerPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(a,b,n){a.VertexColor=function(h,k){k.hasVertexColors?(h.attributes.add(n.VertexAttribute.COLOR,"vec4"),h.varyings.add("vColor","vec4"),h.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),h.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):h.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){a.DefaultMaterialAuxiliaryPasses=function(q,u){const {vertex:v,fragment:y}=q,D=u.hasColorTexture&&u.alphaDiscardMode!==t.AlphaDiscardMode.Opaque;switch(u.output){case n.ShaderOutput.LinearDepth:case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:case n.ShaderOutput.ObjectAndLayerIdColor:x.addProjViewLocalOrigin(v,u);q.include(k.Transform,u);q.include(e.TextureCoordinateAttribute,u);q.include(f.VisualVariables,
u);q.include(c.OutputDepth,u);q.include(h.SliceDraw,u);q.include(g.ObjectAndLayerIdColor,u);b.addNearFar(q);q.varyings.add("depth","float");D&&y.uniforms.add(new p.Texture2DPassUniform("tex",G=>G.texture));v.code.add(w.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();
}`);q.include(r.DiscardOrAdjustAlphaPass,u);y.code.add(w.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${u.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${u.output===n.ShaderOutput.ObjectAndLayerIdColor?w.glsl`outputObjectAndLayerIdColor();`:w.glsl`outputDepth(depth);`}
          }
        `);break;case n.ShaderOutput.Normal:x.addProjViewLocalOrigin(v,u);q.include(k.Transform,u);q.include(m.NormalAttribute,u);q.include(d.VertexNormal,u);q.include(e.TextureCoordinateAttribute,u);q.include(f.VisualVariables,u);D&&y.uniforms.add(new p.Texture2DPassUniform("tex",G=>G.texture));u.normalType===m.NormalType.ScreenDerivative&&q.varyings.add("vPositionView","vec3");v.code.add(w.glsl`
          void main(void) {
            vpos = getVertexInLocalOriginSpace();

            ${u.normalType===m.NormalType.Attribute||u.normalType===m.NormalType.Compressed?w.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:w.glsl`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `);q.include(h.SliceDraw,u);q.include(r.DiscardOrAdjustAlphaPass,u);y.code.add(w.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${u.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${u.normalType===m.NormalType.ScreenDerivative?w.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:w.glsl`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break;case n.ShaderOutput.Highlight:x.addProjViewLocalOrigin(v,u),q.include(k.Transform,u),q.include(e.TextureCoordinateAttribute,u),q.include(f.VisualVariables,u),D&&y.uniforms.add(new p.Texture2DPassUniform("tex",G=>G.texture)),v.code.add(w.glsl`void main(void) {
vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();
}`),q.include(h.SliceDraw,u),q.include(r.DiscardOrAdjustAlphaPass,u),q.include(l.OutputHighlight,u),y.code.add(w.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?w.glsl`
                    vec4 texColor = texture(tex, ${u.hasColorTextureTransform?w.glsl`colorUV`:w.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloat16Encoding.glsl","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,n,h,k){a.OutputDepth=function(m,g){switch(g.output){case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:m.fragment.include(n.Rgba4FloatEncoding);
m.fragment.code.add(k.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth) {
fragColor = floatToRgba4(_calculateFragDepth(_linearDepth));
}`);break;case b.ShaderOutput.LinearDepth:m.fragment.include(h.RgbaFloatEncoding),m.fragment.code.add(k.glsl`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloat16Encoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Rgba4FloatEncoding=function(n){n.code.add(b.glsl`const float MAX_RGBA4_FLOAT =
15.0 / 16.0 +
15.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 +
15.0 / 16.0 / 16.0 / 16.0 / 16.0;
const vec4 FIXED_POINT_FACTORS_RGBA4 = vec4(1.0, 16.0, 16.0 * 16.0, 16.0 * 16.0 * 16.0);
vec4 floatToRgba4(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA4_FLOAT);
vec4 fixedPointU4 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS_RGBA4) * 16.0);
const float toU4AsFloat = 1.0 / 15.0;
return fixedPointU4 * toU4AsFloat;
}
const vec4 RGBA4_2_FLOAT_FACTORS = vec4(
15.0 / (16.0),
15.0 / (16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0),
15.0 / (16.0 * 16.0 * 16.0 * 16.0)
);
float rgba4ToFloat(vec4 rgba) {
return dot(rgba, RGBA4_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,n,h,k,m){function g(e,d,c){const l=e.fragment;d.alphaDiscardMode!==m.AlphaDiscardMode.Mask&&d.alphaDiscardMode!==m.AlphaDiscardMode.MaskBlend||
l.uniforms.add(c);switch(d.alphaDiscardMode){case m.AlphaDiscardMode.Blend:return e.include(b.DiscardOrAdjustAlphaBlend);case m.AlphaDiscardMode.Opaque:l.code.add(k.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case m.AlphaDiscardMode.Mask:l.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case m.AlphaDiscardMode.MaskBlend:e.fragment.code.add(k.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(e,d){g(e,d,new n.FloatDrawUniform("textureAlphaCutoff",c=>c.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(e,d){g(e,d,new h.FloatPassUniform("textureAlphaCutoff",
c=>c.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,n){a.DiscardOrAdjustAlphaBlend=function(h){h.fragment.code.add(n.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${n.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"float",n.BindType.Draw,(g,e,d)=>g.setUniform1f(k,m(e,d)))}}a.FloatDrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.ComputeNormalTexture=function(x,w){const p=x.fragment;w.hasVertexTangents?(x.attributes.add(r.VertexAttribute.TANGENT,"vec4"),x.varyings.add("vTangent","vec4"),w.doubleSidedMode===m.NormalsDoubleSidedMode.WindingOrder?p.code.add(e.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):p.code.add(e.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):p.code.add(e.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`);w.textureCoordinateType!==h.TextureCoordinateAttributeType.None&&(x.include(k.VertexTextureCoordinates,w),p.uniforms.add(w.pbrTextureBindType===f.BindType.Pass?new l.Texture2DPassUniform("normalTexture",t=>t.textureNormal):new c.Texture2DDrawUniform("normalTexture",t=>t.textureNormal)),w.hasNormalTextureTransform&&(p.uniforms.add(new g.Float2PassUniform("scale",t=>t.scale??n.ONES)),p.uniforms.add(new d.Matrix3PassUniform("normalTextureTransformMatrix",t=>t.normalTextureTransformMatrix??b.IDENTITY))),
p.code.add(e.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),w.hasNormalTextureTransform&&p.code.add(e.glsl`mat3 normalTextureRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalTextureRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),p.code.add(e.glsl`return tangentSpace * rawNormal;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform","../../../effects/ssao/SSAO"],function(a,b,n,h){a.EvaluateAmbientOcclusion=function(k,m){k=k.fragment;m.receiveAmbientOcclusion?(k.uniforms.add(new n.Texture2DPassUniform("ssaoTex",(g,e)=>e.ssao?.getTexture())),k.constants.add("blurSizePixelsInverse",
"float",1/h.blurSizePixels),k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):k.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/time ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../webgl/formats ../../core/shaderLibrary/shading/ScreenSpaceConstants ../RenderPlugin ./SSAOBlurTechnique ./SSAONoiseData ./SSAOParameters ./SSAOTechnique ../../lib/RenderFeature ../../lib/RenderSlot ../../../../../chunks/SSAO.glsl ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){a.SSAO=class extends w.SyncRenderPlugin{constructor(E){super(E);this._context=null;this._passParameters=new q.SSAOPassParameters;this._drawParameters=new q.BlurDrawParameters;this.produces=new Map([[y.RenderSlot.SSAO,()=>this._produces()]])}_getCameraElevation(){return this._context?.renderContext.bindParameters.camera.relativeElevation??Infinity}_produces(){return null!=this._enableTime&&null!=this._context&&this._getCameraElevation()<x.distanceFadeEnd}consumes(){return this._produces()?
w.ConsumesDepthNormal:w.ConsumesNone}initializeRenderContext(E){this._context=E;this.addHandles([k.watch(()=>this.view.qualitySettings.ambientOcclusion||this._context?.isFeatureEnabled(v.RenderFeature.SSAO),I=>I?this._enable():this._disable(),k.syncAndInitial)])}uninitializeRenderContext(){this._disable();this._context=null}_disable(){this._passParameters.noiseTexture=h.disposeMaybe(this._passParameters.noiseTexture);this._enableTime=null}destroy(){this._disable()}_enable(){if(null==this._enableTime&&
this._context){var E=Uint8Array.from(atob(t.noiseData),H=>H.charCodeAt(0)),I=new C.TextureDescriptor;I.wrapMode=G.TextureWrapMode.CLAMP_TO_EDGE;I.pixelFormat=G.PixelFormat.RGB;I.wrapMode=G.TextureWrapMode.REPEAT;I.hasMipmap=!0;I.width=32;I.height=32;this._passParameters.noiseTexture=new A.Texture(this._context.renderContext.rctx,I,E);null==this._ssaoTechnique&&(this._ssaoTechnique=this._context.techniqueRepository.acquire(u.SSAOTechnique));null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(p.SSAOBlurTechnique));
this._enableTime=m.Milliseconds(0);this._context?.requestRender()}}renderNode(E,I,H){I=E.bindParameters;H=H?.get("normals");var J=H?.getTexture(),B=H?.getTexture(G.DepthStencilAttachment);if(null!=this._enableTime&&null!=this._context&&J&&B){if(this._ssaoTechnique.compiled&&this._blurTechnique.compiled){0===this._enableTime&&(this._enableTime=E.time);H=E.rctx;var z=I.camera,K=this.view.qualitySettings.fadeDuration,L=n.clamp((x.distanceFadeEnd-z.relativeElevation)/(x.distanceFadeEnd-x.distanceFadeStart),
0,1);E=0<K?Math.min(K,E.time-this._enableTime)/K:1;L*=E;this._passParameters.normalTexture=J;this._passParameters.depthTexture=B;this._passParameters.projScale=1/z.computeScreenPixelSizeAtDist(1);this._passParameters.intensity=2/D.getRadius(z)**6*L;J=z.fullViewport[2];B=z.fullViewport[3];L=Math.round(J/2);K=Math.round(B/2);var F=this._context.fbos,M=F.acquire(J,B,"ssao input",r.ColorFormat.RG);H.unbindTexture(M.fbo.colorTexture);H.bindFramebuffer(M.fbo);H.setViewport(0,0,J,B);H.bindTechnique(this._ssaoTechnique,
I,this._passParameters,this._drawParameters);H.screen.draw();var S=F.acquire(L,K,"ssao blur",r.ColorFormat.RED);H.unbindTexture(S.fbo.colorTexture);H.bindFramebuffer(S.fbo);this._drawParameters.colorTexture=M.getTexture();f.set(this._drawParameters.blurSize,0,2/B);H.bindTechnique(this._blurTechnique,I,this._passParameters,this._drawParameters);H.setViewport(0,0,L,K);H.screen.draw();M.release();F=F.acquire(L,K,"ssao",r.ColorFormat.RED);H.unbindTexture(F.fbo.colorTexture);H.bindFramebuffer(F.fbo);H.setViewport(0,
0,J,B);H.setClearColor(1,1,1,0);H.clear(G.ClearBufferBit.COLOR_BUFFER_BIT);this._drawParameters.colorTexture=S.getTexture();f.set(this._drawParameters.blurSize,2/J,0);H.bindTechnique(this._blurTechnique,I,this._passParameters,this._drawParameters);H.setViewport(0,0,L,K);H.screen.draw();H.setViewport4fv(z.fullViewport);S.release();1>E&&this._context.requestRender();return F}this._enableTime=E.time;this._context.requestRender()}}};b.__decorate([g.property({constructOnly:!0})],a.SSAO.prototype,"view",
void 0);b.__decorate([g.property()],a.SSAO.prototype,"_context",void 0);a.SSAO=b.__decorate([l.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],a.SSAO);a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceConstants":function(){define(["exports"],function(a){a.distanceFadeEnd=5E5;a.distanceFadeStart=3E5;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAOBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.SSAOBlur,()=>new Promise((c,l)=>a(["../../shaders/SSAOBlur.glsl"],c,l)));b.SSAOBlurTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec32 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(){const x=new d.ShaderBuilder,w=x.fragment;x.include(n.ScreenSpacePass);w.include(h.ReadDepth);w.uniforms.add(new l.Texture2DPassUniform("depthMap",p=>p.depthTexture),new c.Texture2DDrawUniform("tex",p=>p.colorTexture),new k.Float2DrawUniform("blurSize",p=>p.blurSize),new g.FloatPassUniform("projScale",(p,t)=>{t=b.distance(t.camera.eye,t.camera.center);return 5E4<t?Math.max(0,p.projScale-(t-5E4)):p.projScale}),new m.Float2PassUniform("nearFar",(p,t)=>t.camera.nearFar));
w.code.add(e.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${e.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);x.outputs.add("fragBlur","float");w.code.add(e.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${e.glsl.int(4)}; r <= ${e.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragBlur = b / w_total;
    }
  `);return x}const r=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=r;a.build=f})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec2",n.BindType.Draw,(g,e,d,c)=>g.setUniform2fv(k,m(e,d,c)))}}a.Float2DrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../core/shaderModules/interfaces"],function(a,b,n){class h extends n.NoParameters{constructor(){super(...arguments);this.projScale=1}}class k extends h{constructor(){super(...arguments);this.intensity=1}}class m extends n.NoParameters{}class g extends m{constructor(){super(...arguments);this.blurSize=
b.create()}}a.BlurDrawParameters=g;a.BlurPassParameters=h;a.SSAODrawParameters=m;a.SSAOPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/SSAO.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,
h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.SSAO,()=>new Promise((c,l)=>a(["../../shaders/SSAO.glsl"],c,l)));b.SSAOTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(){const w=new c.ShaderBuilder,p=w.fragment;w.include(h.ScreenSpacePass);w.include(m.CameraSpace);p.include(k.ReadDepth);p.uniforms.add(new e.FloatPassUniform("radius",(t,q)=>r(q.camera)));p.code.add(d.glsl`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`);p.code.add(d.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);p.uniforms.add(new g.Float2PassUniform("nearFar",(t,q)=>q.camera.nearFar),new l.Texture2DPassUniform("normalMap",t=>t.normalTexture),new l.Texture2DPassUniform("depthMap",t=>t.depthTexture),new e.FloatPassUniform("projScale",t=>t.projScale),new l.Texture2DPassUniform("rnm",t=>t.noiseTexture),new g.Float2PassUniform("rnmScale",(t,q)=>b.set(x,q.camera.fullWidth/t.noiseTexture.descriptor.width,q.camera.fullHeight/t.noiseTexture.descriptor.height)),new e.FloatPassUniform("intensity",t=>t.intensity),
new g.Float2PassUniform("screenSize",(t,q)=>b.set(x,q.camera.fullWidth,q.camera.fullHeight)));w.outputs.add("fragOcclusion","float");p.code.add(d.glsl`
    void main(void) {
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
        fragOcclusion = 1.0;
        return;
      }

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      if(norm4.a != 1.0) {
        fragOcclusion = 1.0;
        return;
      }
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

      float sum = 0.0;
      vec3 tapPixelPos;

      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${d.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        // don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${d.glsl.int(16)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

      fragOcclusion = A;
    }
  `);return w}function r(w){return Math.max(10,20*w.computeScreenPixelSizeAtDist(Math.abs(4*w.relativeElevation)))}const x=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:f,getRadius:r},Symbol.toStringTag,{value:"Module"}));a.SSAO=n;a.build=f;a.getRadius=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,n,h,k,m,g,e){function d(r){const x=r.projectionMatrix;return 0===x[11]?h.set(l,2/(r.fullWidth*x[0]),2/(r.fullHeight*x[5]),(1+x[12])/x[0],(1+x[13])/x[5]):h.set(l,-2/(r.fullWidth*x[0]),-2/(r.fullHeight*x[5]),(1-x[8])/x[0],(1-x[9])/x[5])}function c(r){return 0===r.projectionMatrix[11]?b.set(f,0,1):b.set(f,1,0)}const l=k.create(),f=n.create();a.CameraSpace=function(r){r.fragment.uniforms.add(new g.Float4PassUniform("projInfo",(x,w)=>d(w.camera)));r.fragment.uniforms.add(new m.Float2PassUniform("zScale",
(x,w)=>c(w.camera)));r.fragment.code.add(e.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getProjectionInfo=d;a.getZScale=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(w){w.constants.add("ambientBoostFactor","float",f.ambientBoost)}function x(w){w.uniforms.add(new c.FloatPassUniform("lightingGlobalFactor",(p,t)=>t.lighting.globalFactor))}a.EvaluateSceneLighting=function(w,p){const t=w.fragment;w.include(h.EvaluateAmbientOcclusion,p);p.pbrMode!==g.PBRMode.Disabled&&w.include(m.PhysicallyBasedRendering,p);w.include(n.EvaluateAmbientLighting,p);w.include(e.PiUtils);t.code.add(l.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${p.pbrMode===g.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);r(t);x(t);k.addMainLightDirection(t);t.code.add(l.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${p.spherical?l.glsl`normalize(vPosWorld)`:l.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);k.addMainLightIntensity(t);t.code.add(l.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(p.pbrMode){case g.PBRMode.Disabled:case g.PBRMode.WaterOnIntegratedMesh:case g.PBRMode.Water:w.include(k.MainLighting);t.code.add(l.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case g.PBRMode.Normal:case g.PBRMode.Schematic:t.code.add(l.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);t.code.add(l.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);p.useFillLights?t.uniforms.add(new d.BooleanPassUniform("hasFillLights",(q,u)=>u.enableFillLights)):t.constants.add("hasFillLights","bool",!1);t.code.add(l.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);t.uniforms.add(new c.FloatPassUniform("lightingSpecularStrength",(q,u)=>u.lighting.mainLight.specularStrength),new c.FloatPassUniform("lightingEnvironmentStrength",(q,u)=>u.lighting.mainLight.environmentStrength));t.code.add(l.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);t.code.add(l.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission == vec3(0.0) ? _emission : pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${p.pbrMode!==g.PBRMode.Schematic||p.hasColorTexture?l.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`:l.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case g.PBRMode.Simplified:case g.PBRMode.TerrainWithWater:w.include(k.MainLighting);t.code.add(l.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:b.neverReached(p.pbrMode);case g.PBRMode.COUNT:}};a.addAmbientBoostFactor=r;a.addLightingGlobalFactor=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,n,h,k){a.PhysicallyBasedRendering=function(m,g){const e=m.fragment.code;
m.include(h.PiUtils);if(g.pbrMode===n.PBRMode.Normal||g.pbrMode===n.PBRMode.Schematic||g.pbrMode===n.PBRMode.Simplified||g.pbrMode===n.PBRMode.TerrainWithWater)e.add(k.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),e.add(k.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(g.pbrMode===n.PBRMode.Normal||g.pbrMode===n.PBRMode.Schematic)m.include(b.AnalyticalSkyModel),e.add(k.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),e.add(k.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),e.add(k.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),e.add(k.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(m,g){const e=m.fragment.code;m.include(h.PiUtils);e.add(k.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${g.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);e.add(k.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);e.add(k.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);e.add(k.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);e.add(k.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(n){n=n.fragment.code;n.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);n.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);n.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../util/RgbaFloat16Encoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(p){p=p.fragment;p.include(h.Rgba4FloatEncoding);p.uniforms.add(new c.Texture2DPassUniform("shadowMap",(t,q)=>q.shadowMap.depthTexture),new m.IntegerPassUniform("numCascades",(t,q)=>q.shadowMap.numCascades),new k.Float4PassUniform("cascadeDistances",(t,q)=>q.shadowMap.cascadeDistances));p.code.add(g.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
float readShadowMapDepth(ivec2 uv, sampler2D _depthTex) {
return rgba4ToFloat(texelFetch(_depthTex, uv, 0));
}
float posIsInShadow(ivec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, ivec2 texSize, sampler2D _depthTex) {
vec2 st = fract(uv * vec2(texSize) + vec2(0.5));
ivec2 base = ivec2(uv * vec2(texSize) - vec2(0.5));
float s00 = posIsInShadow(ivec2(base.x, base.y), lvpos, _depthTex);
float s10 = posIsInShadow(ivec2(base.x + 1, base.y), lvpos, _depthTex);
float s11 = posIsInShadow(ivec2(base.x + 1, base.y + 1), lvpos, _depthTex);
float s01 = posIsInShadow(ivec2(base.x, base.y + 1), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
ivec2 size = textureSize(shadowMap, 0);
vec2 uv = cascadeCoordinates(i, size, lvpos);
return filterShadow(uv, lvpos, size, shadowMap);
}`)}class f extends g.NoParameters{constructor(){super(...arguments);this.origin=n.create()}}class r extends f{}class x extends g.NoParameters{constructor(){super(...arguments);this.modelTransformation=b.IDENTITY}}class w extends x{constructor(){super(...arguments);this.origin=n.create()}}a.ReadShadowMapDraw=function(p,t){t.receiveShadows&&(p.fragment.uniforms.add(new e.Matrix4sDrawUniform("shadowMapMatrix",(q,u)=>u.shadowMap.getShadowMapMatrices(q.origin),4)),l(p))};a.ReadShadowMapDrawParameters=
r;a.ReadShadowMapParameters=x;a.ReadShadowMapPass=function(p,t){t.receiveShadows&&(p.fragment.uniforms.add(new d.Matrix4sPassUniform("shadowMapMatrix",(q,u)=>u.shadowMap.getShadowMapMatrices(q.origin),4)),l(p))};a.ReadShadowMapPassParameters=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,
m,g){super(k,"mat4",n.BindType.Draw,(e,d,c,l)=>e.setUniformMatrix4fv(k,m(d,c,l)),g)}}a.Matrix4sDrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m,g){super(k,"mat4",n.BindType.Pass,(e,d,c)=>e.setUniformMatrix4fv(k,m(d,c)),g)}}a.Matrix4sPassUniform=h;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../attributes/TextureCoordinateAttribute.glsl","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,b,n,h,k){a.colorTextureUV=function(m,g){g.hasColorTextureTransform?(m.vertex.uniforms.add(new k.Matrix3PassUniform("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix??
b.IDENTITY)),m.varyings.add("colorUV","vec2"),m.vertex.code.add(h.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(h.glsl`void forwardColorUV(){}`)};a.emissiveTextureUV=function(m,g){g.hasEmissionTextureTransform&&g.textureCoordinateType!==n.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix??b.IDENTITY)),m.varyings.add("emissiveUV","vec2"),m.vertex.code.add(h.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(h.glsl`void forwardEmissiveUV(){}`)};a.metallicRoughnessTextureUV=function(m,g){g.hasMetallicRoughnessTextureTransform&&g.textureCoordinateType!==n.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix??b.IDENTITY)),m.varyings.add("metallicRoughnessUV","vec2"),m.vertex.code.add(h.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(h.glsl`void forwardMetallicRoughnessUV(){}`)};a.normalTextureUV=function(m,g){g.hasNormalTextureTransform&&g.textureCoordinateType!==n.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix??b.IDENTITY)),m.varyings.add("normalUV","vec2"),m.vertex.code.add(h.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(h.glsl`void forwardNormalUV(){}`)};a.occlusionTextureUV=function(m,g){g.hasOcclusionTextureTransform&&g.textureCoordinateType!==n.TextureCoordinateAttributeType.None?(m.vertex.uniforms.add(new k.Matrix3PassUniform("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix??b.IDENTITY)),m.varyings.add("occlusionUV","vec2"),m.vertex.code.add(h.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):m.vertex.code.add(h.glsl`void forwardOcclusionUV(){}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,n,h){a.MixExternalColor=function(k){k.include(n.ColorConversion);k.code.add(h.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${h.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${h.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${h.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${h.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${h.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends l.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.alphaDiscardMode=d.AlphaDiscardMode.Opaque;this.doubleSidedMode=m.NormalsDoubleSidedMode.None;this.pbrMode=g.PBRMode.Disabled;this.cullFace=d.CullFaceOptions.None;this.transparencyPassType=c.TransparencyPassType.NONE;this.normalType=h.NormalType.Attribute;this.textureCoordinateType=k.TextureCoordinateAttributeType.None;this.customDepthTest=d.DepthTestFunction.Less;
this.hasSlicePlane=this.hasVerticalOffset=this.hasSymbolColors=this.hasVertexColors=this.spherical=!1;this.hasSliceHighlight=!0;this.doublePrecisionRequiresObfuscation=this.instancedDoublePrecision=this.objectAndLayerIdColorInstanced=this.instancedColor=this.instanced=this.textureAlphaPremultiplied=this.receiveAmbientOcclusion=this.receiveShadows=this.vvColor=this.vvSize=this.offsetBackfaces=this.hasModelTransformation=this.multipassEnabled=this.hasOccludees=this.hasVertexTangents=this.hasScreenSizePerspective=
this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasColorTexture=!1;this.writeDepth=!0;this.transparent=!1;this.enableOffset=!0;this.hasMetallicRoughnessTextureTransform=this.hasOcclusionTextureTransform=this.hasNormalTextureTransform=this.hasEmissionTextureTransform=this.hasColorTextureTransform=this.snowCover=this.cullAboveGround=!1}}b.__decorate([e.parameter({count:n.ShaderOutput.COUNT})],f.prototype,"output",void 0);b.__decorate([e.parameter({count:d.AlphaDiscardMode.COUNT})],
f.prototype,"alphaDiscardMode",void 0);b.__decorate([e.parameter({count:m.NormalsDoubleSidedMode.COUNT})],f.prototype,"doubleSidedMode",void 0);b.__decorate([e.parameter({count:g.PBRMode.COUNT})],f.prototype,"pbrMode",void 0);b.__decorate([e.parameter({count:d.CullFaceOptions.COUNT})],f.prototype,"cullFace",void 0);b.__decorate([e.parameter({count:c.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",void 0);b.__decorate([e.parameter({count:h.NormalType.COUNT})],f.prototype,"normalType",
void 0);b.__decorate([e.parameter({count:k.TextureCoordinateAttributeType.COUNT})],f.prototype,"textureCoordinateType",void 0);b.__decorate([e.parameter({count:d.DepthTestFunction.COUNT})],f.prototype,"customDepthTest",void 0);b.__decorate([e.parameter()],f.prototype,"spherical",void 0);b.__decorate([e.parameter()],f.prototype,"hasVertexColors",void 0);b.__decorate([e.parameter()],f.prototype,"hasSymbolColors",void 0);b.__decorate([e.parameter()],f.prototype,"hasVerticalOffset",void 0);b.__decorate([e.parameter()],
f.prototype,"hasSlicePlane",void 0);b.__decorate([e.parameter()],f.prototype,"hasSliceHighlight",void 0);b.__decorate([e.parameter()],f.prototype,"hasColorTexture",void 0);b.__decorate([e.parameter()],f.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([e.parameter()],f.prototype,"hasEmissionTexture",void 0);b.__decorate([e.parameter()],f.prototype,"hasOcclusionTexture",void 0);b.__decorate([e.parameter()],f.prototype,"hasNormalTexture",void 0);b.__decorate([e.parameter()],f.prototype,
"hasScreenSizePerspective",void 0);b.__decorate([e.parameter()],f.prototype,"hasVertexTangents",void 0);b.__decorate([e.parameter()],f.prototype,"hasOccludees",void 0);b.__decorate([e.parameter()],f.prototype,"multipassEnabled",void 0);b.__decorate([e.parameter()],f.prototype,"hasModelTransformation",void 0);b.__decorate([e.parameter()],f.prototype,"offsetBackfaces",void 0);b.__decorate([e.parameter()],f.prototype,"vvSize",void 0);b.__decorate([e.parameter()],f.prototype,"vvColor",void 0);b.__decorate([e.parameter()],
f.prototype,"receiveShadows",void 0);b.__decorate([e.parameter()],f.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([e.parameter()],f.prototype,"textureAlphaPremultiplied",void 0);b.__decorate([e.parameter()],f.prototype,"instanced",void 0);b.__decorate([e.parameter()],f.prototype,"instancedColor",void 0);b.__decorate([e.parameter()],f.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([e.parameter()],f.prototype,"instancedDoublePrecision",void 0);b.__decorate([e.parameter()],
f.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([e.parameter()],f.prototype,"writeDepth",void 0);b.__decorate([e.parameter()],f.prototype,"transparent",void 0);b.__decorate([e.parameter()],f.prototype,"enableOffset",void 0);b.__decorate([e.parameter()],f.prototype,"cullAboveGround",void 0);b.__decorate([e.parameter()],f.prototype,"snowCover",void 0);b.__decorate([e.parameter()],f.prototype,"hasColorTextureTransform",void 0);b.__decorate([e.parameter()],f.prototype,"hasEmissionTextureTransform",
void 0);b.__decorate([e.parameter()],f.prototype,"hasNormalTextureTransform",void 0);b.__decorate([e.parameter()],f.prototype,"hasOcclusionTextureTransform",void 0);b.__decorate([e.parameter()],f.prototype,"hasMetallicRoughnessTextureTransform",void 0);b.__decorate([e.parameter({constValue:!1})],f.prototype,"occlusionPass",void 0);b.__decorate([e.parameter({constValue:!0})],f.prototype,"hasVvInstancing",void 0);b.__decorate([e.parameter({constValue:!1})],f.prototype,"useCustomDTRExponentForWater",
void 0);b.__decorate([e.parameter({constValue:!1})],f.prototype,"supportsTextureAtlas",void 0);b.__decorate([e.parameter({constValue:!0})],f.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,b,n,h,k,m,g){class e extends m.DefaultMaterialTechnique{initializeConfiguration(d,c){super.initializeConfiguration(d,c);c.hasMetallicRoughnessTexture=!1;c.hasEmissionTexture=!1;c.hasOcclusionTexture=!1;c.hasNormalTexture=!1;c.hasModelTransformation=!1;c.normalType=n.NormalType.Attribute;c.doubleSidedMode=h.NormalsDoubleSidedMode.WindingOrder;c.hasVertexTangents=!1}initializeProgram(d){return this._initializeProgram(d,e.shader)}}e.shader=new k.ReloadableShaderModule(g.RealisticTree,()=>
new Promise((d,c)=>a(["./RealisticTree.glsl"],d,c)));b.RealisticTreeTechnique=e;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F){function M(N){const P=new z.ShaderBuilder,{vertex:R,fragment:O,varyings:T}=P;E.addProjViewLocalOrigin(R,N);P.include(d.PositionAttribute);T.add("vpos","vec3");P.include(D.VisualVariables,N);P.include(g.InstancedDoublePrecision,N);P.include(r.VerticalOffset,N);if(N.output===h.ShaderOutput.Color||N.output===h.ShaderOutput.Alpha)E.addCameraPosition(P.vertex,N),P.include(e.NormalAttribute,N),P.include(m.Transform,N),N.offsetBackfaces&&
P.include(n.Offset),N.instancedColor&&P.attributes.add(F.VertexAttribute.INSTANCECOLOR,"vec4"),T.add("vNormalWorld","vec3"),T.add("localvpos","vec3"),N.multipassEnabled&&T.add("depth","float"),P.include(l.TextureCoordinateAttribute,N),P.include(b.ForwardLinearDepth,N),P.include(c.SymbolColor,N),P.include(f.VertexColor,N),R.uniforms.add(new H.Float4PassUniform("externalColor",Q=>Q.externalColor)),T.add("vcolorExt","vec4"),R.code.add(B.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${N.instancedColor?"vcolorExt *\x3d instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${B.glsl.float(G.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = getVertexInLocalOriginSpace();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${N.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${N.multipassEnabled?B.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);N.output===h.ShaderOutput.Alpha&&(P.include(k.SliceDraw,N),P.include(A.DiscardOrAdjustAlphaPass,N),P.include(q.multipassTerrainTest,N),O.uniforms.add(new J.FloatPassUniform("opacity",Q=>Q.opacity),new J.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)),N.hasColorTexture&&O.uniforms.add(new K.Texture2DPassUniform("tex",Q=>Q.texture)),O.include(C.MixExternalColor),O.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.multipassEnabled?B.glsl`terrainDepthTest(depth);`:""}
        ${N.hasColorTexture?B.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?B.glsl`colorUV`:B.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:B.glsl`vec4 texColor = vec4(1.0);`}
        ${N.hasVertexColors?B.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:B.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `));N.output===h.ShaderOutput.Color&&(P.include(k.SliceDraw,N),P.include(p.EvaluateSceneLighting,N),P.include(w.EvaluateAmbientOcclusion,N),P.include(A.DiscardOrAdjustAlphaPass,N),P.include(N.instancedDoublePrecision?y.ReadShadowMapPass:y.ReadShadowMapDraw,N),P.include(q.multipassTerrainTest,N),E.addCameraPosition(P.fragment,N),t.addMainLightDirection(O),p.addAmbientBoostFactor(O),p.addLightingGlobalFactor(O),O.uniforms.add(R.uniforms.get("localOrigin"),R.uniforms.get("view"),new I.Float3PassUniform("ambient",
Q=>Q.ambient),new I.Float3PassUniform("diffuse",Q=>Q.diffuse),new J.FloatPassUniform("opacity",Q=>Q.opacity),new J.FloatPassUniform("layerOpacity",Q=>Q.layerOpacity)),N.hasColorTexture&&O.uniforms.add(new K.Texture2DPassUniform("tex",Q=>Q.texture)),P.include(v.PhysicallyBasedRenderingParameters,N),P.include(u.PhysicallyBasedRendering,N),O.include(C.MixExternalColor),t.addMainLightIntensity(O),O.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.multipassEnabled?B.glsl`terrainDepthTest(depth);`:""}
        ${N.hasColorTexture?B.glsl`
                vec4 texColor = texture(tex, ${N.hasColorTextureTransform?B.glsl`colorUV`:B.glsl`vuv0`});
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:B.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${N.pbrMode===v.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${N.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":N.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${N.hasVertexColors?B.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:B.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${N.snowCover?B.glsl`albedo = mix(albedo, vec3(1), 0.9);`:B.glsl``}
        ${B.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${N.pbrMode===v.PBRMode.Normal||N.pbrMode===v.PBRMode.Schematic?N.spherical?B.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:B.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:B.glsl``}
        ${N.pbrMode===v.PBRMode.Normal||N.pbrMode===v.PBRMode.Schematic?B.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${N.snowCover?B.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:B.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${N.transparencyPassType===L.TransparencyPassType.Color?B.glsl`fragColor = premultiplyAlpha(fragColor);`:B.glsl``}
      }
    `));P.include(x.DefaultMaterialAuxiliaryPasses,N);return P}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=S;a.build=M})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.RecreateSymbol=0]="RecreateSymbol";b[b.RecreateGraphics=1]="RecreateGraphics";b[b.FastUpdate=2]="FastUpdate";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,n){class h{constructor(k){this.schedule=k;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(k,m){if(this._loadStatus===a.LoadStatus.LOADED)return k&&k(),this._loader??Promise.resolve();if(this._loadStatus===
a.LoadStatus.FAILED)return m&&m(this._loadError),this._loader??Promise.resolve();null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},g=>{this._loadError=g;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!n.isAbortError(g)&&this.logger&&g.message&&this.logger.warn(g.message);throw g;}));this._loader.then(k,m).catch(()=>{});return this._loader}abortLoad(){null!=
this._abortController?this._abortController=b.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null}}a.LoadStatus=void 0;(function(k){k[k.LOADING=0]="LOADING";k[k.LOADED=1]="LOADED";k[k.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedPoint ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,b,n,h,k,m,g,e,d){const c=b.create();a.createStageObject=function(l,f,r,x,w){const p=l.clippingExtent;n.projectPointToVector(f,c,l.elevationProvider.spatialReference);if(null!=p&&!h.containsPoint(p,c))return null;n.projectPointToVector(f,c,l.renderCoordsHelper.spatialReference);r.localOrigin=l.localOriginFactory.getOrigin(c);r=new d.Object3D({geometries:[r],castShadow:!1,layerUid:l.layer.uid,graphicUid:w,usesVerticalDistanceToGround:!0});l=g.applyElevationAlignmentForHUD(r,f,l.elevationProvider,
l.renderCoordsHelper,x);return{object:r,sampledElevation:l}};a.extendPointGraphicElevationContext=function(l,f,r){l=l.elevationContext;r=r.spatialReference;n.projectPointToVector(f,c,r);l.centerPointInElevationSR=m.makeDehydratedPoint(c[0],c[1],f.hasZ?c[2]:0,null!=r?r:null)};a.placePointOnGeometry=function(l){switch(l.type){case "point":return l;case "polygon":case "extent":return e.computeCentroid(l);case "polyline":var f=l.paths[0];if(!f||0===f.length)break;f=k.getPointOnPath(f,k.getPathLength(f)/
2);return m.makeDehydratedPoint(f[0],f[1],f[2],l.spatialReference);case "mesh":return l.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends d.ContentObject{get geometries(){return this._geometries}get transformation(){return this._transformation??n.IDENTITY}set transformation(G){this._transformation=b.copy(this._transformation??n.create(),G);this._invalidateBoundingVolume();this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(G){this._shaderTransformation=G?b.copy(this._shaderTransformation??n.create(),G):null;
this._invalidateBoundingVolume();this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){return this.shaderTransformation??this.transformation}constructor(G={}){super();this.type=c.ContentObjectType.Object;this._parentLayer=this._shaderTransformation=null;this._visible=!0;this.castShadow=G.castShadow??!0;this.usesVerticalDistanceToGround=G.usesVerticalDistanceToGround??!1;this.graphicUid=G.graphicUid;this.layerUid=G.layerUid;G.isElevationSource&&(this.lastValidElevationBB=new p);
this._geometries=G.geometries?Array.from(G.geometries):[]}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(G){f.assert(null==this._parentLayer||null==G,"Object3D can only be added to a single Layer");this._parentLayer=G}addGeometry(G){G.visible=this._visible;this._geometries.push(G);this._emit("geometryAdded",{object:this,geometry:G});this._invalidateBoundingVolume()}removeGeometry(G){if(G=this._geometries.splice(G,1)[0])this._emit("geometryRemoved",{object:this,
geometry:G}),this._invalidateBoundingVolume()}removeAllGeometries(){for(;0<this._geometries.length;)this.removeGeometry(0)}geometryVertexAttributeUpdated(G,A,C=!1){this._emit("attributesChanged",{object:this,geometry:G,attribute:A,sync:C});r.affectsGeometry(A)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(G){if(this._visible!==G){this._visible=G;for(const A of this._geometries)A.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const G=new l.Object3DStateID(e.Object3DState.MaskOccludee);
for(const A of this._geometries)A.occludees=x.addObject3DStateID(A.occludees,G);this._emit("occlusionChanged",this);return G}removeOcclude(G){for(const A of this._geometries)A.occludees=x.removeObject3DStateID(A.occludees,G);this._emit("occlusionChanged",this)}highlight(){const G=new l.Object3DStateID(e.Object3DState.Highlight);for(const A of this._geometries)A.highlights=x.addObject3DStateID(A.highlights,G);this._emit("highlightChanged",this);return G}removeHighlight(G){for(const A of this._geometries)A.highlights=
x.removeObject3DStateID(A.highlights,G);this._emit("highlightChanged",this)}getCombinedStaticTransformation(G,A){return b.multiply(A,this.transformation,G.transformation)}getCombinedShaderTransformation(G,A=n.create()){return b.multiply(A,this.effectiveTransformation,G.transformation)}get boundingVolumeWorldSpace(){this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new t,this._validateBoundingVolume(this._bvWorldSpace,D.WorldSpace));return this._bvWorldSpace}get boundingVolumeObjectSpace(){this._bvObjectSpace||
(this._bvObjectSpace=this._bvObjectSpace||new t,this._validateBoundingVolume(this._bvObjectSpace,D.ObjectSpace));return this._bvObjectSpace}_validateBoundingVolume(G,A){A=A===D.ObjectSpace;for(var C of this._geometries){var E=C.boundingInfo;if(E){var I=G,H=A?C.transformation:this.getCombinedShaderTransformation(C),J=E.bbMin;E=E.bbMax;if(b.hasIdentityRotation(H))for(H=h.set(q,H[12],H[13],H[14]),h.add(u,J,H),h.add(v,E,H),J=0;3>J;++J)I.min[J]=Math.min(I.min[J],u[J]),I.max[J]=Math.max(I.max[J],v[J]);
else if(h.transformMat4(u,J,H),h.exactEquals(J,E))for(J=0;3>J;++J)I.min[J]=Math.min(I.min[J],u[J]),I.max[J]=Math.max(I.max[J],u[J]);else{h.transformMat4(v,E,H);for(var B=0;3>B;++B)I.min[B]=Math.min(I.min[B],u[B],v[B]),I.max[B]=Math.max(I.max[B],u[B],v[B]);for(B=0;3>B;++B){h.copy(u,J);h.copy(v,E);u[B]=E[B];v[B]=J[B];h.transformMat4(u,u,H);h.transformMat4(v,v,H);for(let z=0;3>z;++z)I.min[z]=Math.min(I.min[z],u[z],v[z]),I.max[z]=Math.max(I.max[z],u[z],v[z])}}}}h.lerp(m.getCenter(G.bounds),G.min,G.max,
.5);for(const z of this._geometries)C=z.boundingInfo,null!=C&&(J=A?z.transformation:this.getCombinedShaderTransformation(z),I=g.maxScale(J),h.transformMat4(y,C.center,J),J=h.distance(y,m.getCenter(G.bounds)),G.bounds[3]=Math.max(G.bounds[3],J+C.radius*I))}_invalidateBoundingVolume(){const G=this._bvWorldSpace?.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0;this._parentLayer&&G&&this._parentLayer.notifyObjectBBChanged(this,G)}_emit(G,A){this._parentLayer&&this._parentLayer.events.emit(G,A)}get test(){const G=
this;return{hasGeometry:A=>G._geometries.includes(A),getGeometryIndex:A=>G._geometries.indexOf(A)}}}class p{constructor(){this.min=k.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=k.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class t extends p{constructor(){super(...arguments);this.bounds=m.create()}}const q=k.create(),u=k.create(),v=k.create(),y=k.create();var D;
(function(G){G[G.WorldSpace=0]="WorldSpace";G[G.ObjectSpace=1]="ObjectSpace"})(D||={});a.Object3D=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends m.Material{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(q){super(q,new x);this.produces=new Map([[g.RenderSlot.LINE_CALLOUTS,u=>u===h.ShaderOutput.Color],[g.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,u=>u===h.ShaderOutput.Color]]);this._configuration=new l.LineCalloutTechniqueConfiguration;this._uniqueMaterialIdentifier=f.uniqueMaterialIdentifier(this.parameters)}passParameters(){return this.parameters}getConfiguration(q,
u){q=u?.slot!==g.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective;this._configuration.depthHudEnabled=q;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.multipassEnabled=u.multipassEnabled;return this._configuration}intersect(){}createGLMaterial(q){return new r(q)}createBufferWriter(){return new t}validateParameters(q){q=f.uniqueMaterialIdentifier(q);q!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=q)}static uniqueMaterialIdentifier(q){return JSON.stringify({horizontalScreenOffset:q.horizontalScreenOffset??0,centerOffsetUnits:q.centerOffsetUnits||"world"})}}class r extends k{beginSlot(q){return this.ensureTechnique(c.LineCalloutTechnique,
q)}}class x extends m.MaterialParameters{constructor(){super(...arguments);this.horizontalScreenOffset=0;this.color=[0,0,0,1];this.size=1;this.occlusionTest=!1;this.shaderPolygonOffset=1E-5;this.depthHUDAlignStart=!1;this.centerOffsetUnits="world";this.hasSlicePlane=!1}}const w=n.newLayout().vec3f(e.VertexAttribute.POSITION).vec3f(e.VertexAttribute.NORMAL).vec2f(e.VertexAttribute.UV0).vec4f(e.VertexAttribute.CENTEROFFSETANDDISTANCE),p=[b.fromValues(0,0),b.fromValues(1,0),b.fromValues(0,1),b.fromValues(1,
0),b.fromValues(1,1),b.fromValues(0,1)];class t{constructor(){this.vertexBufferLayout=w}elementCount(q){return 6*q.attributes.get(e.VertexAttribute.POSITION).indices.length}write(q,u,v,y,D){d.writePosition(v.attributes.get(e.VertexAttribute.POSITION),q,y.position,D,6);d.writeNormal(v.attributes.get(e.VertexAttribute.NORMAL),u,y.normal,D,6);d.writeBufferVec4(v.attributes.get(e.VertexAttribute.CENTEROFFSETANDDISTANCE),y.centerOffsetAndDistance,D,6);for(q=0;q<p.length;++q)y.uv0.setVec(D+q,p[q])}}a.LineCalloutMaterial=
f;a.Parameters=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function n(w){const p=new Float32Array(2);p[0]=w[0];p[1]=w[1];return p}function h(w,p){const t=new Float32Array(2);t[0]=w;t[1]=p;return t}function k(w,p){return new Float32Array(w,p,2)}function m(){return b()}function g(){return h(1,1)}function e(){return h(1,0)}function d(){return h(0,1)}const c=
b(),l=g(),f=e(),r=d(),x=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:f,UNIT_Y:r,ZEROS:c,clone:n,create:b,createView:k,fromValues:h,ones:g,unitX:e,unitY:d,zeros:m},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_X=f;a.UNIT_Y=r;a.ZEROS=c;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.ones=g;a.unitX=e;a.unitY=d;a.vec2f32=x;a.zeros=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends k.ShaderTechnique{initializeConfiguration(f,r){r.spherical=f.viewingMode===n.ViewingMode.Global}initializeProgram(f){return new g.Program(f.rctx,l.shader.get().build(this.configuration),m.Default3D)}setPipelineState(f){f=f?d.CompareFunction.ALWAYS:d.CompareFunction.LESS;return this.configuration.depthHudEnabled?c.makePipelineState({depthTest:{func:f},depthWrite:c.defaultDepthWriteParams}):c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.ONE,
d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f},colorWrite:c.defaultColorWriteParams})}initializePipeline(){return this.setPipelineState(this.configuration.multipassEnabled)}}l.shader=new h.ReloadableShaderModule(e.LineCallout,()=>new Promise((f,r)=>a(["./LineCallout.glsl"],f,r)));b.LineCalloutTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(v){const y=new w.ShaderBuilder,{vertex:D,fragment:G}=y;D.include(m.AlignPixel);y.include(g.HUD,v);y.include(k.SliceDraw,v);y.attributes.add(p.VertexAttribute.UV0,"vec2");D.uniforms.add(new f.Float4PassUniform("viewport",(A,C)=>C.camera.fullViewport),new r.FloatPassUniform("lineSize",(A,C)=>0<A.size?Math.max(1,A.size)*C.camera.pixelRatio:0),new l.Float2PassUniform("pixelToNDC",(A,C)=>b.set(u,2/C.camera.fullViewport[2],2/C.camera.fullViewport[3])),
new r.FloatPassUniform("borderSize",(A,C)=>null!=A.borderColor?C.camera.pixelRatio:0),new l.Float2PassUniform("screenOffset",(A,C)=>b.set(u,A.horizontalScreenOffset*C.camera.pixelRatio,0)));y.varyings.add("coverageSampling","vec4");y.varyings.add("lineSizes","vec2");v.multipassEnabled&&y.varyings.add("depth","float");v.occlusionTestEnabled&&y.include(e.HUDVisibility);v.hasScreenSizePerspective&&c.addScreenSizePerspectiveAlignment(D);D.code.add(x.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${v.occlusionTestEnabled?x.glsl`
      if (!testHUDVisibility(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${v.hasScreenSizePerspective?x.glsl`
      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x.glsl`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${v.multipassEnabled?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${v.depthHudEnabled?v.depthHudAlignStartEnabled?x.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${v.hasScreenSizePerspective?x.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);G.uniforms.add(new f.Float4PassUniform("uColor",A=>q(A.color)),new f.Float4PassUniform("borderColor",A=>q(A.borderColor)));v.multipassEnabled&&(G.include(d.multipassGeometryTest,v),G.uniforms.add(new l.Float2PassUniform("inverseViewport",(A,C)=>C.inverseViewport)));G.code.add(x.glsl`
    void main() {
      ${v.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${v.depthHudEnabled?x.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return y}function q(v){return null!=v?v:h.ZEROS}const u=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:t},Symbol.toStringTag,{value:"Module"}));a.LineCallout=n;a.build=t})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,h){class k extends h.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.spherical=this.screenCenterOffsetUnitsEnabled=!1;this.occlusionTestEnabled=!0;this.multipassEnabled=this.hasSlicePlane=this.depthHudAlignStartEnabled=this.depthHudEnabled=this.hasScreenSizePerspective=this.hasVerticalOffset=!1}}b.__decorate([n.parameter()],k.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([n.parameter()],k.prototype,"spherical",void 0);b.__decorate([n.parameter()],k.prototype,"occlusionTestEnabled",void 0);b.__decorate([n.parameter()],k.prototype,"hasVerticalOffset",
void 0);b.__decorate([n.parameter()],k.prototype,"hasScreenSizePerspective",void 0);b.__decorate([n.parameter()],k.prototype,"depthHudEnabled",void 0);b.__decorate([n.parameter()],k.prototype,"depthHudAlignStartEnabled",void 0);b.__decorate([n.parameter()],k.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],k.prototype,"multipassEnabled",void 0);b.__decorate([n.parameter({constValue:!0})],k.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([n.parameter({constValue:!1})],k.prototype,
"draped",void 0);a.LineCalloutTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,n){a.getGraphics3DSymbol=function(h){return h instanceof n.Graphics3DWebStyleSymbol?h.graphics3DSymbol:h instanceof b.Graphics3DSymbol?h:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/promiseUtils ./defaultSymbolComplexity ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCreationContext ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends l.Loadable{set symbol(x){this._symbol=x;x.symbolLayers.forEach((w,p)=>{p=this.symbolLayers[p];null!=p&&(p.symbol=x,p.symbolLayer=w)})}get symbol(){return this._symbol}constructor(x,w,p){super(w.schedule);this._symbol=x;this._context=w;this._backgroundLayers=p;this._destroyed=!1;this.symbolLayers=[];this._extentPadding=this.referenced=0}async doLoad(x){let w=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(w=this._backgroundLayers.concat(w));
const p=w.length;for(;this.symbolLayers.length<w.length;)this.symbolLayers.push(null);this.symbolLayers.length=w.length;const t=[];for(let u=0;u<p;u++){var q=w.at(u);if(!1===q.enabled)continue;r.renderPriority=1-(1+u)/p;r.renderPriorityStep=1/p;r.ignoreDrivers=q.ignoreDrivers;const v=d.make(this.symbol,q,this._context,r);(q=h.onAbortOrThrow(x,()=>{this.symbolLayers[u]=null;v.destroy()}))&&t.push(q);this.symbolLayers[u]=v}await n.forEach(this.symbolLayers,async(u,v)=>{if(null!=u)try{await u.load(),
this._extentPadding+=Math.max(this._extentPadding,u.extentPadding)}catch{this.symbolLayers[v]=null}});t.forEach(u=>u.remove());h.throwIfAborted(x);if(this.symbolLayers.length&&!this.symbolLayers.some(u=>!!u))throw Error();}getSymbolLayerSize(x){x=this.symbolLayers[x];return null!=x?x.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(x=>x?.queryForSnapping)}createGraphics3DGraphic(x,w){const p=x.graphic,t=this.symbolLayers.map(q=>
q?.createGraphics3DGraphic(x)??null);return new m.Graphics3DGraphic(p,w||this,t,x.layer,this._context.arcade||this._context.featureExpressionInfoContext?.arcade?.modules||null)}get complexity(){return k.totalSymbolComplexities(this.symbolLayers.map(x=>null!=x?x.complexity:null))}globalPropertyChanged(x,w){const p=this.symbolLayers.length;for(let t=0;t<p;t++){const q=this.symbolLayers[t],u=v=>{v=v.layers[t];return v instanceof g.Graphics3DObject3DGraphicLayer?v:null};if(null!=q&&!q.globalPropertyChanged(x,
w,u))return!1}return!0}applyRendererDiff(x,w){return this.loadStatus!==l.LoadStatus.LOADED?c.ApplyRendererDiffResult.RecreateSymbol:this.symbolLayers.reduce((p,t)=>p!==c.ApplyRendererDiffResult.RecreateSymbol&&null!=t?Math.min(p,t.applyRendererDiff(x,w)):p,c.ApplyRendererDiffResult.FastUpdate)}prepareSymbolPatch(x){if(this.loadStatus!==l.LoadStatus.FAILED&&"partial"===x.diff.type){var w=x.diff.diff;if(w.symbolLayers&&"partial"===w.symbolLayers.type){var p=w.symbolLayers.diff;this.symbolLayers.forEach((t,
q)=>{if(null!=t){var u=p[q];if(u){const v={diff:u,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(v);x.symbolStatePatches.push(...v.symbolLayerStatePatches);v.graphics3DGraphicPatches.length&&x.graphics3DGraphicPatches.push((y,D)=>{const G=y.layers[q];null!=G&&v.graphics3DGraphicPatches.forEach(A=>A(G,D))})}}})}}}updateGeometry(x,w){return this._updateGeometryOrTransform(x,(p,t)=>p.updateGeometry(t,w))}updateTransform(x,w,p,t){return this._updateGeometryOrTransform(x,
(q,u)=>q.updateTransform(u,w,p,t))}_updateGeometryOrTransform(x,w){for(let p=0;p<this.symbolLayers.length;p++){const t=this.symbolLayers[p];if(null==t)continue;const q=x.layers[p];if(!q||!w(t,q))return!1}return!0}onRemoveGraphic(x){for(let w=0;w<this.symbolLayers.length;w++){const p=this.symbolLayers[w];if(null==p)continue;const t=x.layers[w];if(null!=t)p.onRemoveGraphic(t)}}getFastUpdateStatus(){let x=0,w=0,p=0;this.symbolLayers.forEach(t=>{null!=t&&(t.loadStatus===l.LoadStatus.LOADING?x++:t.isFastUpdatesEnabled()?
p++:w++)});return{loading:x,slow:w,fast:p}}async queryForSnapping(x,w,p,t){var q=this.symbolLayers.filter(b.isSome).filter(u=>null!=u.queryForSnapping).map(u=>u.queryForSnapping(x,w,p,t));q=await Promise.all(q);h.throwIfAborted(t);return q.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const x of this.symbolLayers)null!=x&&x.destroy();this.symbolLayers.length=0;this._destroyed=!0}}get destroyed(){return this._destroyed}}
const r=new e.Graphics3DSymbolLayerCreationContext;a.Graphics3DSymbol=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("exports ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){const u=new k(Array,D=>f.set(D,f.zero),null,10,5),v=r.create();class y{get labelLayers(){return this._labelLayers||b.emptyArray}get extent(){return this._extent}get isElevationSource(){return this.layers.some(D=>D?.isElevationSource)}constructor(D,G,A,C,E){this.graphic=D;this.graphics3DSymbol=G;this.layers=A;this._visibleFlags=t.VisibilityFlag.ALL_LABEL;this.deconflictionPriority=0;++G.referenced;this._featureExpressionFeature=E?q.createFeature(E,D,C):
null}initialize(D){this._layer=D;this._forEachSymbolLayerGraphic(G=>{G.initialize(D);G.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(D=>D.destroy());this._calloutLayer=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(D=>D.destroy());this._labelLayers=null}addLabelGraphic(D,G){this._labelLayers||(this._labelLayers=[]);this._labelLayers.push(D);D.initialize(G);D.setVisibility(this.isVisible(t.VisibilityGroup.LABEL))}setCalloutGraphic(D){this._calloutLayer=
D;this._layer&&(D.initialize(this._layer),D.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let D=!1;this._forEachSymbolLayerGraphic(G=>{"draped"===G.type&&(D=!0)});return D}isVisible(D=t.VisibilityGroup.GRAPHIC,G){G=G?this._visibleFlags|G|t.VisibilityGroup.LABEL*G:this._visibleFlags;return D===t.VisibilityGroup.GRAPHIC?(G&t.VisibilityFlag.ALL_GRAPHIC)===t.VisibilityFlag.ALL_GRAPHIC:(G&t.VisibilityFlag.ALL_LABEL)===t.VisibilityFlag.ALL_LABEL}setVisibilityFlag(D,
G,A){const C=this.isVisible(D);this._visibleFlags=A?this._visibleFlags|D*G:this._visibleFlags&~(D*G);const E=this.isVisible(D);if(C===E)return!1;if(D===t.VisibilityGroup.LABEL)this._forEachLabelGraphic(I=>I.setVisibility(E));else{this._forEachSymbolLayerGraphic(H=>H.setVisibility(E));const I=this.isVisible(t.VisibilityGroup.LABEL);this._forEachLabelGraphic(H=>H.setVisibility(I))}return!0}getVisibilityFlag(D,G){return 0!==(this._visibleFlags&D*G)}computeExtent(D){if(!this._extent){var G=this.graphic.geometry;
if(null==G)return!1;this._extent=r.create();w.computeAABR(G,this._extent);G=G.spatialReference;if(!x.equals(G,D)&&!l.projectBoundingRect(this._extent,G,this._extent,D))return this._extent=null,!1}return!0}getAsOptimizedGeometry(D,G){this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,D,G));return this._optimizedGeometry}_convertGraphicToOptimizedGeometry(D,G,A){D=D.geometry;if("mesh"===D.type||"extent"===D.type)D=c.fromExtent("mesh"===D.type?D.extent:
D);return p.convertFromGeometry(D,G,A)}get usedMemory(){let D=h.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(G=>D+=G.graphics3DSymbolLayer.usedMemory);return D}computeAttachmentOrigin(){const D={render:{origin:d.create(),num:0},draped:{origin:g.create(),num:0}};for(const G of this.layers)null!=G&&G.computeAttachmentOrigin(D);1<D.render.num&&e.scale(D.render.origin,D.render.origin,1/D.render.num);1<D.draped.num&&m.scale(D.draped.origin,D.draped.origin,1/D.draped.num);
return D}async getProjectedBoundingBox(D,G,A,C,E){E||={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]};E.boundingBox?f.empty(E.boundingBox):E.boundingBox=f.empty();E.requiresDrapedElevation=!1;await n.forEach(this.layers,async I=>{if(null!=I){var H="draped"===I.type?G:D,J=u.acquire();I=await I.getProjectedBoundingBox(H,A,E.screenSpaceObjects,C,J);isFinite(I[2])&&isFinite(I[5])||(E.requiresDrapedElevation=!0);I&&f.expandWithAABB(E.boundingBox,J);u.release(J)}});return f.allFinite(E.boundingBox)||
r.allFinite(f.toRect(E.boundingBox,v))?E:null}needsElevationUpdates(){for(const D of this.layers)if(null!=D&&("object3d"===D.type||"lod-instance"===D.type)&&D.needsElevationUpdates)return!0;return this._labelLayers?.some(D=>D?.needsElevationUpdates??!1)??!1}alignWithElevation(D,G,A){this._forEachRenderedGraphic(C=>{"object3d"!==C.type&&"lod-instance"!==C.type||C.alignWithElevation(D,G,this._featureExpressionFeature,A)})}alignWithAbsoluteElevation(D,G,A){this._forEachRenderedGraphic(C=>{"object3d"===
C.type&&C.alignWithAbsoluteElevation(D,G,A)})}addObjectStateSet(D,G){this._forEachSymbolLayerGraphic(A=>A.addObjectState(D,G))}removeObjectState(D){this._forEachSymbolLayerGraphic(G=>G.removeObjectState(D))}_forEachGraphicList(D,G){D?.forEach(A=>A&&G(A))}_forEachSymbolLayerGraphic(D){this._forEachGraphicList(this.layers,D);this._calloutLayer&&D(this._calloutLayer)}_forEachLabelGraphic(D){this._forEachGraphicList(this._labelLayers,D)}_forEachRenderedGraphic(D){this._forEachSymbolLayerGraphic(D);this._forEachLabelGraphic(D)}get test(){const D=
this;return{addLabelLayer:G=>{D._labelLayers||(D._labelLayers=[]);D._labelLayers.push(G)}}}}a.Graphics3DGraphic=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(v,y,D,G){return{uid:k.generateUID(),objectId:G&&v.attributes?v.attributes[G]:null,attributes:v.attributes,geometry:x(v.geometry,y,D),visible:!0}}function x(v,y,D){if(null==v)return null;switch(y){case "point":return{x:v.x,y:v.y,z:v.z,m:v.m,hasZ:null!=v.z,hasM:null!=v.m,type:"point",spatialReference:D};case "polyline":return{paths:v.paths,hasZ:!!v.hasZ,hasM:!!v.hasM,type:"polyline",spatialReference:D};case "polygon":return{rings:v.rings,hasZ:!!v.hasZ,hasM:!!v.hasM,
type:"polygon",spatialReference:D};case "multipoint":return{points:v.points,hasZ:!!v.hasZ,hasM:!!v.hasM,type:"multipoint",spatialReference:D}}}function w(v){if(null==v)return 0;let y=32;switch(v.type){case "point":y+=42;break;case "polyline":case "polygon":var D=0;const G=2+(v.hasZ?1:0)+(v.hasM?1:0);v="polyline"===v.type?v.paths:v.rings;for(const A of v)D+=A.length;y+=8*D*G+64;y+=128*D;y=y+34+32*(v.length+1);break;case "multipoint":D=v.points.length;y+=8*D*(2+(v.hasZ?1:0)+(v.hasM?1:0))+64;y+=128*
D;y=y+34+32;break;case "extent":y+=98;v.hasM&&(y+=32);v.hasZ&&(y+=32);break;case "mesh":y+=h.estimateSize(v.vertexAttributes.position,v.vertexAttributes.normal,v.vertexAttributes.uv,v.vertexAttributes.tangent)}return y}function p(v,y){return null!=v.objectId?v.objectId:v.attributes&&y?v.attributes[y]:null}function t(v,y,D,G){if(y?.size&&null!=D&&v)for(const A in v){if(!y.has(A))continue;const C=v[A];"string"===typeof C&&C.length>D&&(G(A),v[A]="")}}class q{constructor(v,y,D){this.uid=v;this.geometry=
y;this.attributes=D;this.visible=!0;this.centroid=this.objectId=null}}class u{constructor(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null}}a.equals=f.equals;a.DehydratedFeatureClass=q;a.DehydratedFeatureSetClass=u;a.computeAABB=function(v,y){g.empty(y);"mesh"===v.type&&(v=v.extent);switch(v.type){case "point":y[0]=
y[3]=v.x;y[1]=y[4]=v.y;v.hasZ&&(y[2]=y[5]=v.z);break;case "polyline":for(var D=0;D<v.paths.length;D++)g.expandWithNestedArray(y,v.paths[D],!!v.hasZ);break;case "polygon":for(D=0;D<v.rings.length;D++)g.expandWithNestedArray(y,v.rings[D],!!v.hasZ);break;case "multipoint":g.expandWithNestedArray(y,v.points,!!v.hasZ);break;case "extent":y[0]=v.xmin,y[1]=v.ymin,y[3]=v.xmax,y[4]=v.ymax,null!=v.zmin&&(y[2]=v.zmin),null!=v.zmax&&(y[5]=v.zmax)}};a.computeAABR=function(v,y){e.empty(y);"mesh"===v.type&&(v=v.extent);
switch(v.type){case "point":y[0]=y[2]=v.x;y[1]=y[3]=v.y;break;case "polyline":for(var D=0;D<v.paths.length;D++)e.expandWithNestedArray(y,v.paths[D]);break;case "polygon":for(D=0;D<v.rings.length;D++)e.expandWithNestedArray(y,v.rings[D]);break;case "multipoint":e.expandWithNestedArray(y,v.points);break;case "extent":y[0]=v.xmin,y[1]=v.ymin,y[2]=v.xmax,y[3]=v.ymax}};a.estimateGeometryObjectSize=w;a.estimateSize=function(v){let y;y=32+b.estimateAttributesObjectSize(v.attributes);return y=y+3+(8+w(v.geometry))};
a.fromFeatureSetJSON=function(v,y){const D=c.featureGeometryTypeKebabDictionary.fromJSON(v.geometryType),G=m.fromJSON(v.spatialReference),A=v.transform,C=v.objectIdFieldName,E=y?.maxStringAttributeLength,I=y?.maxStringAttributeFields;let H;y=v.features.map(J=>{const B=r(J,D,G,v.objectIdFieldName);J=B.geometry;t(B.attributes,I,E,z=>{H??=[];const K=p(B,C);null!=K&&H.push({objectId:K,attribute:z})});if(null!=J&&A)switch(J.type){case "point":B.geometry=d.unquantizePoint(A,J,J,J.hasZ,J.hasM);break;case "multipoint":B.geometry=
d.unquantizeMultipoint(A,J,J,!!J.hasZ,!!J.hasM);break;case "polygon":B.geometry=d.unquantizePolygon(A,J,J,!!J.hasZ,!!J.hasM);break;case "polyline":B.geometry=d.unquantizePolyline(A,J,J,!!J.hasZ,!!J.hasM);break;case "extent":B.geometry=J;break;case "mesh":B.geometry=J}return B});return{geometryType:D,features:y,spatialReference:G,fields:v.fields?.map(J=>l.fromJSON(J))??[],objectIdFieldName:v.objectIdFieldName,globalIdFieldName:v.globalIdFieldName,geohashFieldName:v.geohashFieldName,geometryProperties:v.geometryProperties,
hasZ:v.hasZ,hasM:v.hasM,exceededTransferLimit:v.exceededTransferLimit,transform:null,missingAttributes:H}};a.fromJSONGeometry=x;a.getObjectId=p;a.hasGeometry=function(v){return null!=v.geometry};a.hasVertices=function(v){if(null==v)return!1;switch(v.type){case "extent":case "point":return!0;case "polyline":for(const y of v.paths)if(0<y.length)return!0;return!1;case "polygon":for(const y of v.rings)if(0<y.length)return!0;return!1;case "multipoint":return 0<v.points.length;case "mesh":return!v.loaded||
0<v.vertexAttributes.position.length}};a.numVertices=function(v){if(null==v)return 0;switch(v.type){case "point":return 1;case "polyline":var y=0;for(var D of v.paths)y+=D.length;return y;case "polygon":D=0;for(y of v.rings)D+=y.length;return D;case "multipoint":return v.points.length;case "extent":return 2;case "mesh":return(v=v.vertexAttributes&&v.vertexAttributes.position)?v.length/3:0}};a.removeLargeStringAttributes=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports",
"../../core/has","../../core/mathUtils","../../geometry/support/spatialReferenceUtils"],function(a,b,n,h){function k(c,l){if(c===l)return!0;if(null==c||null==l||c.length!==l.length)return!1;for(let f=0;f<c.length;f++){const r=c[f],x=l[f];if(r.length!==x.length)return!1;for(let w=0;w<r.length;w++)if(r[w]!==x[w])return!1}return!0}function m(c,l){if(c===l)return!0;if(null==c||null==l||c.length!==l.length)return!1;for(let f=0;f<c.length;f++)if(!k(c[f],l[f]))return!1;return!0}function g(c,l){return c===
l||null!=c&&null!=l&&h.equals(c.spatialReference,l.spatialReference)&&c.x===l.x&&c.y===l.y&&c.z===l.z&&c.m===l.m}function e(c,l){if(c===l)return!0;if(null==c||null==l||c.type!==l.type)return!1;switch(c.type){case "point":return g(c,l);case "extent":return c=c.hasZ!==l.hasZ||c.hasM!==l.hasM?!1:h.equals(c.spatialReference,l.spatialReference)?c.xmin===l.xmin&&c.ymin===l.ymin&&c.zmin===l.zmin&&c.xmax===l.xmax&&c.ymax===l.ymax&&c.zmax===l.zmax:!1,c;case "polyline":return c=c.hasZ!==l.hasZ||c.hasM!==l.hasM?
!1:h.equals(c.spatialReference,l.spatialReference)?m(c.paths,l.paths):!1,c;case "polygon":return c=c.hasZ!==l.hasZ||c.hasM!==l.hasM?!1:h.equals(c.spatialReference,l.spatialReference)?m(c.rings,l.rings):!1,c;case "multipoint":return c=c.hasZ!==l.hasZ||c.hasM!==l.hasM?!1:h.equals(c.spatialReference,l.spatialReference)?k(c.points,l.points):!1,c;case "mesh":return!1}}function d(c,l){if(c===l)return!0;if(!c||!l)return!1;const f=Object.keys(c),r=Object.keys(l);if(f.length!==r.length)return!1;for(const x of f)if(c[x]!==
l[x])return!1;return!0}a.equals=function(c,l){return c===l?!0:null!=c&&null!=l&&c.objectId===l.objectId&&e(c.geometry,l.geometry)&&d(c.attributes,l.attributes)?!0:!1};a.pointEquals=g;a.pointNear=function(c,l,f){return c===l||null!=c&&null!=l&&h.equals(c.spatialReference,l.spatialReference)&&n.floatEqualAbsolute(c.x,l.x,f)&&n.floatEqualAbsolute(c.y,l.y,f)&&n.floatEqualAbsolute(c.z??0,l.z??0,f)&&n.floatEqualAbsolute(c.m??0,l.m??0,f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],
function(a){class b{constructor(h,k){this.scheduler=h;this.schedule=k;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}class n{constructor(){this.renderPriority=
0;this.renderPriorityStep=1;this.ignoreDrivers=!1}}a.Graphics3DSymbolCreationContext=b;a.Graphics3DSymbolLayerCreationContext=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){const f={icon:h.Graphics3DIconSymbolLayer,object:g.Graphics3DObjectSymbolLayer,line:k.Graphics3DLineSymbolLayer,path:e.Graphics3DPathSymbolLayer,fill:d.Graphics3DPolygonFillSymbolLayer,extrude:n.Graphics3DExtrudeSymbolLayer,text:c.Graphics3DTextSymbolLayer,water:l.Graphics3DWaterSymbolLayer},r={"mesh-3d":{fill:m.Graphics3DMeshFillSymbolLayer}};a.make=function(x,w,p,t){const q=r[x.type]?.[w.type]||f[w.type];return q?new q(x,w,p,t):(b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${w.type}`),null)};a.setSymbolClass=function(x,w){f[x]=w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/unitUtils ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/Indices ../../../../chunks/vec3 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Normals ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O){function T(va,Ca,ma,wa,Ba,pa){const Aa=p.getZeroIndexArray(Ca.length);Ca=[[R.VertexAttribute.POSITION,new K.Attribute(wa.positions,Ca,3,!0)],[R.VertexAttribute.NORMALCOMPRESSED,new K.Attribute(wa.normals,Ca,2,!0)],[R.VertexAttribute.COLOR,new K.Attribute(Ba,Aa,4,!0)]];return new M.Geometry(va,Ca,wa.elevation,F.ContentObjectType.Mesh,pa,ma)}function Q(va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma,Ua){let Ga=0;var Na=2*
wa.count,Va=wa.index,Xa=wa.count,Pa=ma.length/3,bb=Na;l.copy(Y,Ma);const gb=0<Ka?1:-1;Na=3*Va;let cb=0;Va=3*cb;let ka=Xa;Ma=3*ka;for(let mb=0;mb<Xa;++mb)Ua&&(Y[0]=va[Na],Y[1]=va[Na+1],Y[2]=va[Na+2],l.normalize(Y,Y)),Ba[Va]=va[Na],Ba[Va+1]=va[Na+1],Ba[Va+2]=va[Na+2],pa[Va]=Ca[Na],pa[Va+1]=Ca[Na+1],pa[Va+2]=Ca[Na+2],Aa[Va]=-gb*Y[0],Aa[Va+1]=-gb*Y[1],Aa[Va+2]=-gb*Y[2],ra[cb]=0,Ba[Ma]=va[Na]+Ka*Y[0],Ba[Ma+1]=va[Na+1]+Ka*Y[1],Ba[Ma+2]=va[Na+2]+Ka*Y[2],pa[Ma]=Ca[Na],pa[Ma+1]=Ca[Na+1],pa[Ma+2]=Ca[Na+2],
Aa[Ma]=gb*Y[0],Aa[Ma+1]=gb*Y[1],Aa[Ma+2]=gb*Y[2],ra[ka]=Ka,Va+=3,Ma+=3,Na+=3,cb+=1,ka+=1;Va=Na=0;Ma=3*bb;va=0>Ka?oa:ja;Ca=0>Ka?ja:oa;for(Ua=0;Ua<Pa;++Ua)Ea[Va]=ma[Na+va[0]],Ea[Va+1]=ma[Na+va[1]],Ea[Va+2]=ma[Na+va[2]],ua[Ma]=ma[Na+Ca[0]]+Xa,ua[Ma+1]=ma[Na+Ca[1]]+Xa,ua[Ma+2]=ma[Na+Ca[2]]+Xa,Va+=3,Ma+=3,Na+=3;ma=2*wa.count;Na=0;U(Ba,pa,ra,Aa,Ga,wa.pathLengths[0],wa.count,ma,ua,Na,Ka);ma+=4*wa.pathLengths[0];Na+=2*wa.pathLengths[0];Ga+=wa.pathLengths[0];for(Ea=1;Ea<wa.pathLengths.length;++Ea)U(Ba,pa,
ra,Aa,Ga,wa.pathLengths[Ea],wa.count,ma,ua,Na,Ka),ma+=4*wa.pathLengths[Ea],Na+=2*wa.pathLengths[Ea],Ga+=wa.pathLengths[Ea]}function V(va,Ca,ma,wa,Ba,pa,Aa){wa[pa]=wa[Aa];Aa*=3;pa*=3;va[pa]=va[Aa];va[pa+1]=va[Aa+1];va[pa+2]=va[Aa+2];Ca[pa]=Ca[Aa];Ca[pa+1]=Ca[Aa+1];Ca[pa+2]=Ca[Aa+2];ma[pa]=Ba[0];ma[pa+1]=Ba[1];ma[pa+2]=Ba[2]}function U(va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka){let Ma=Ba,Ua=Ba+1,Ga=Ba+Aa,Na=Ba+Aa+1,Va=ra,Xa=ra+1,Pa=ra+2*pa;ra=ra+2*pa+1;0>Ka&&(Ma=Ba+Aa+1,Na=Ba);Ea*=3;for(let qb=0;qb<pa;++qb){qb===
pa-1&&(0<Ka?(Ua=Ba,Na=Ba+Aa):(Ua=Ba,Ma=Ba+Aa));var bb=va,gb=Ma,cb=Ua,ka=Ga,mb=X;gb*=3;cb*=3;ka*=3;l.set(ba,bb[gb++],bb[gb++],bb[gb++]);l.set(ia,bb[cb++],bb[cb++],bb[cb++]);l.set(fa,bb[ka++],bb[ka++],bb[ka++]);l.subtract(da,ia,ba);l.subtract(aa,fa,ba);l.cross(mb,aa,da);l.normalize(mb,mb);V(va,Ca,wa,ma,X,Va,Ma);V(va,Ca,wa,ma,X,Xa,Ua);V(va,Ca,wa,ma,X,Pa,Ga);V(va,Ca,wa,ma,X,ra,Na);ua[Ea++]=Va;ua[Ea++]=Pa;ua[Ea++]=ra;ua[Ea++]=Va;ua[Ea++]=ra;ua[Ea++]=Xa;Ma++;Ua++;Ga++;Na++;Va+=2;Xa+=2;Pa+=2;ra+=2}}const W=
["polygon","extent"];class ca extends G.Graphics3DSymbolLayer{constructor(va,Ca,ma,wa){super(va,Ca,ma,wa);this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){var va=A.validateSymbolLayerSize(this._getSymbolSize());if(va)throw new n("graphics3dextrudesymbollayer:invalid-size",va);}var Ca=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);va=f.fromArray(Ca);Ca=Ca[3];const ma=1>Ca||this.needsDrivenTransparentPass;va={usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0,diffuse:va,ambient:va,opacity:Ca,transparent:ma,cullFace:ma?L.CullFaceOptions.None:L.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:z.NormalType.Compressed};this._materials[qa.Main]=new O.DefaultMaterial(va);this._materials[qa.Bottom]=new O.DefaultMaterial({...va,cullFace:L.CullFaceOptions.Back});this._context.stage.addMany(this._materials)}destroy(){super.destroy();
this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(va){const Ca=va.graphic;if(!this._validateGeometry(Ca.geometry,W,this.symbolLayer.type))return null;const ma=this._getVertexOpacityAndColor(va.renderingInfo,255),wa=this.setGraphicElevationContext(Ca);return this._createAs3DShape(Ca,va.renderingInfo,ma,wa,Ca.uid)}layerOpacityChanged(va,Ca){const ma=this._getCombinedOpacity(this.symbolLayer?.material?.color),wa=1>ma||this.needsDrivenTransparentPass;this._materials[qa.Main]?.setParameters({opacity:ma,
transparent:wa});this._materials[qa.Bottom]?.setParameters({opacity:ma,transparent:wa});const Ba=this._getLayerOpacity();va.forEach(pa=>{pa=Ca(pa);null!=pa&&pa.layerOpacityChanged(Ba,this._context.isAsync)})}layerElevationInfoChanged(va,Ca){return this.updateGraphics3DGraphicElevationInfo(va,Ca,y.needsElevationUpdates3D)}slicePlaneEnabledChanged(va,Ca){this._materials[qa.Main]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[qa.Bottom]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
va.forEach(ma=>{ma=Ca(ma);null!=ma&&ma.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0}physicalBasedRenderingChanged(){const va={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};this._materials[qa.Main]?.setParameters(va);this._materials[qa.Bottom]?.setParameters(va);return!0}_getExtrusionSize(va){va=va.size&&this._drivenProperties.size?u.getDriverAxisSizeValue(va.size,2)??0:this._getSymbolSize();return va/=this._context.renderCoordsHelper.unitInMeters}applyRendererDiff(va,
Ca){return this._drivenPropertiesChanged(Ca)?C.ApplyRendererDiffResult.RecreateSymbol:C.ApplyRendererDiffResult.RecreateGraphics}async queryForSnapping(va,Ca,ma,wa){Ca=this._getExtrusionSize(ma)*this._context.renderCoordsHelper.unitInMeters/k.getMetersPerVerticalUnitForSR(Ca);const {objectId:Ba,target:pa}=va;ma=h.clone(pa);ma.z=(ma.z??0)+Ca;switch(va.type){case "edge":const {start:Aa,end:ra}=va;va=h.clone(Aa);wa=h.clone(ra);va.z=(va.z??0)+Ca;wa.z=(wa.z??0)+Ca;return[q.makeEdgeCandidate(Ba,ma,Infinity,
va,wa)];case "vertex":return[q.makeVertexCandidate(Ba,ma,Infinity),q.makeEdgeCandidate(Ba,pa,Infinity,pa,ma)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(va,Ca,ma,wa,Ba){var pa=E.geometryAsPolygon(va.geometry);if(null==pa)return null;if(0===pa.rings.length||!pa.rings.some(cb=>0<cb.length))return this._logGeometryValidationWarnings(pa.rings,"rings","ExtrudeSymbol3DLayer"),null;va=B.geometryToRenderInfo(pa,this._context.elevationProvider,this._context.renderCoordsHelper,
wa);this._logGeometryCreationWarnings(va,pa.rings,"rings","ExtrudeSymbol3DLayer");var Aa=A.computeCentroid(pa);if(null==Aa)return null;var ra=[];const ua=[],Ea=x.create(),Ka=c.create(),Ma=f.create(),Ua=this._context.renderCoordsHelper.viewingMode===v.ViewingMode.Global;Ua||this._context.renderCoordsHelper.worldUpAtPosition(null,Ma);r.computeTranslationToOriginAndRotation(pa.spatialReference,[Aa.x,Aa.y,0],Ka,this._context.renderCoordsHelper.spatialReference);pa=c.create();d.invert(pa,Ka);Aa=e.create();
g.normalFromMat4(Aa,pa);const {polygons:Ga,mapPositions:Na,position:Va}=va;for(const cb of Ga){Aa=cb.count;if(this._context.clippingExtent&&(x.empty(Ea),x.expandWithBuffer(Ea,cb.mapPositions),!x.intersectsClippingArea(Ea,this._context.clippingExtent)))continue;var Xa=m.earcut(cb.mapPositions,cb.holeIndices,3);if(0===Xa.length)continue;var Pa=Xa.length,bb=6*Aa;Aa=p.newIndexArray(bb+Pa);Pa=p.newIndexArray(Pa);var gb=w.newDoubleArray(3*bb);const ka=w.newDoubleArray(3*bb),mb=w.newDoubleArray(3*bb);bb=
w.newDoubleArray(bb);const qb=this._getExtrusionSize(Ca);Q(Va,Na,Xa,cb,gb,mb,ka,bb,Aa,Pa,qb,Ma,Ua);t.transformMat4(gb,gb,pa);Xa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Ba,layerUid:this._context.layer.uid});gb=new ta(gb,mb,N.compressNormals(ka),bb);ra.push(T(this._materials[qa.Main],Aa,Aa.length-Pa.length,gb,ma,Xa),T(this._materials[qa.Bottom],Pa,0,gb,ma,Xa));ua.push(gb.heights)}if(0===ra.length)return null;Ca=new P.Object3D({geometries:ra,layerUid:this._context.layer.uid,
graphicUid:Ba,isElevationSource:!0});Ca.transformation=Ka;ma=I.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});ra=new D.Graphics3DObject3DGraphicLayer(this,Ca,ra,null,null,(cb,ka,mb,qb,tb)=>{cb=cb.stageObject;const xa=cb.geometries,Ia=xa.length;ka="absolute-height"!==ka.mode;let na=0;const ya=cb.transformation,Da=d.invertOrIdentity(c.create(),ya);for(let Oa=0;Oa<Ia;Oa+=2){const Wa=xa[Oa];if(!S.isGeometryWithMapPositions(Wa))continue;const ab=Wa.getMutableAttribute(R.VertexAttribute.POSITION).data,
Ja=ua[Oa/2],Ra=new J.SamplePosition(Wa.mapPositions),Sa=ab.length/3;let db=0,eb=!1,lb=0;for(let sb=0;sb<Sa;sb++){ea[0]=ab[db];ea[1]=ab[db+1];ea[2]=ab[db+2];qb(Ra,Z);ka&&(lb+=Z.sampledElevation);H.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?(l.set(ha,Ra.array[Ra.offset],Ra.array[Ra.offset+1],Z.z+Ja[db/3]),null!=mb&&tb.toRenderCoords(ha,mb,ha)):(l.set(ha,ab[db],ab[db+1],ab[db+2]),l.transformMat4(ha,ha,ya),tb.setAltitude(ha,Z.z+Ja[db/3]));l.transformMat4(ha,ha,Da);ab[db]=ha[0];ab[db+1]=ha[1];ab[db+2]=ha[2];
const vb=.01/tb.unitInMeters;if(Math.abs(ea[0]-ab[db])>=vb||Math.abs(ea[1]-ab[db+1])>=vb||Math.abs(ea[2]-ab[db+2])>=vb)eb=!0;Ra.offset+=3;db+=3}eb&&(Wa.invalidateBoundingInfo(),cb.geometryVertexAttributeUpdated(xa[Oa],R.VertexAttribute.POSITION),xa[Oa+1].invalidateBoundingInfo(),cb.geometryVertexAttributeUpdated(xa[Oa+1],R.VertexAttribute.POSITION));na+=lb/Sa}return na/Ia},wa,null!=ma?{baseMaterial:this._materials[qa.Main],edgeMaterials:[ma],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:
null);ra.alignedSampledElevation=va.sampledElevation;ra.needsElevationUpdates=y.needsElevationUpdates3D(wa.mode);return ra}}const X=f.create(),ba=f.create(),ia=f.create(),fa=f.create(),da=f.create(),aa=f.create(),ea=f.create(),ha=f.create(),Y=f.create(),Z=new y.SampleElevationInfo,ja=[0,2,1],oa=[0,1,2];var qa;(function(va){va[va.Main=0]="Main";va[va.Bottom=1]="Bottom"})(qa||={});class ta{constructor(va,Ca,ma,wa){this.positions=va;this.elevation=Ca;this.normals=ma;this.heights=wa}}a.Graphics3DExtrudeSymbolLayer=
ca;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports","./_commonjsHelpers"],function(a,b){var n={exports:{}};(function(h){(function(k){k=k();void 0!==k&&(h.exports=k)})(function(){function k(E,I,H){H=H||2;var J=I&&I.length,B=J?I[0]*H:E.length,z=m(E,0,B,H,!0),K=[];if(!z||z.next===z.prev)return K;var L;if(J){var F=z;var M=H;z=[];var S;J=0;for(S=I.length;J<S;J++){var N=I[J]*M;var P=J<S-1?I[J+1]*M:E.length;N=m(E,N,P,M,!1);N===N.next&&(N.steiner=
!0);P=z;var R=P.push,O=N,T=N;do{if(O.x<T.x||O.x===T.x&&O.y<T.y)T=O;O=O.next}while(O!==N);R.call(P,T)}z.sort(c);for(J=0;J<z.length;J++)M=z[J],I=F,(F=f(M,I))?(S=y(F,M),M=g(F,F.next),S=l(S),g(S,S.next),M=l(M),F=l(I===F?M:I)):F=I,F=g(F,F.next);z=F}if(E.length>80*H){var Q=L=E[0];var V=J=E[1];for(M=H;M<B;M+=H)I=E[M],F=E[M+1],I<Q&&(Q=I),F<V&&(V=F),I>L&&(L=I),F>J&&(J=F);L=Math.max(L-Q,J-V);L=0!==L?1/L:0}e(z,K,H,Q,V,L);return K}function m(E,I,H,J,B){if(B===0<C(E,I,H,J))for(B=I;B<H;B+=J)var z=D(B,E[B],E[B+
1],z);else for(B=H-J;B>=I;B-=J)z=D(B,E[B],E[B+1],z);z&&p(z,z.next)&&(E=z.next,G(z),z=E);return z}function g(E,I){if(!E)return E;I||=E;do{var H=!1;if(E.steiner||!p(E,E.next)&&0!==w(E.prev,E,E.next))E=E.next;else{I=E.prev;G(E);E=I;if(E===E.next)break;H=!0}}while(H||E!==I);return I}function e(E,I,H,J,B,z,K){if(E){if(!K&&z){var L=E,F=L;do null===F.z&&(F.z=r(F.x,F.y,J,B,z)),F.prevZ=F.prev,F=F.nextZ=F.next;while(F!==L);F.prevZ.nextZ=null;F.prevZ=null;L=F;var M,S,N,P,R=1;do{F=L;var O=L=null;for(S=0;F;){S++;
var T=F;for(M=N=0;M<R&&(N++,T=T.nextZ,T);M++);for(P=R;0<N||0<P&&T;)0!==N&&(0===P||!T||F.z<=T.z)?(M=F,F=F.nextZ,N--):(M=T,T=T.nextZ,P--),O?O.nextZ=M:L=M,M.prevZ=O,O=M;F=T}O.nextZ=null;R*=2}while(1<S)}for(L=E;E.prev!==E.next;){F=E.prev;T=E.next;if(z)O=d(E,J,B,z);else a:if(O=E,S=O.prev,N=O,R=O.next,0<=w(S,N,R))O=!1;else{for(M=O.next.next;M!==O.prev;){if(x(S.x,S.y,N.x,N.y,R.x,R.y,M.x,M.y)&&0<=w(M.prev,M,M.next)){O=!1;break a}M=M.next}O=!0}if(O)I.push(F.i/H),I.push(E.i/H),I.push(T.i/H),G(E),L=E=T.next;
else if(E=T,E===L){if(!K)e(g(E),I,H,J,B,z,1);else if(1===K){E=g(E);K=I;L=H;F=E;do T=F.prev,O=F.next.next,!p(T,O)&&t(T,F,F.next,O)&&v(T,O)&&v(O,T)&&(K.push(T.i/L),K.push(F.i/L),K.push(O.i/L),G(F),G(F.next),F=E=O),F=F.next;while(F!==E);E=g(F);e(E,I,H,J,B,z,2)}else if(2===K)a:{K=E;do{for(L=K.next.next;L!==K.prev;){if(F=K.i!==L.i){O=O=O=O=void 0;F=K;T=L;if(O=F.next.i!==T.i&&F.prev.i!==T.i){b:{O=F;do{if(O.i!==F.i&&O.next.i!==F.i&&O.i!==T.i&&O.next.i!==T.i&&t(O,O.next,F,T)){O=!0;break b}O=O.next}while(O!==
F);O=!1}O=!O}if(O){if(O=v(F,T)&&v(T,F)){O=F;S=!1;N=(F.x+T.x)/2;R=(F.y+T.y)/2;do O.y>R!==O.next.y>R&&O.next.y!==O.y&&N<(O.next.x-O.x)*(R-O.y)/(O.next.y-O.y)+O.x&&(S=!S),O=O.next;while(O!==F);O=S}O=O&&(w(F.prev,F,T.prev)||w(F,T.prev,T))||p(F,T)&&0<w(F.prev,F,F.next)&&0<w(T.prev,T,T.next)}F=O}if(F){E=y(K,L);K=g(K,K.next);E=g(E,E.next);e(K,I,H,J,B,z);e(E,I,H,J,B,z);break a}L=L.next}K=K.next}while(K!==E)}break}}}}function d(E,I,H,J){var B=E.prev,z=E.next;if(0<=w(B,E,z))return!1;var K=B.x>E.x?B.x>z.x?B.x:
z.x:E.x>z.x?E.x:z.x,L=B.y>E.y?B.y>z.y?B.y:z.y:E.y>z.y?E.y:z.y,F=r(B.x<E.x?B.x<z.x?B.x:z.x:E.x<z.x?E.x:z.x,B.y<E.y?B.y<z.y?B.y:z.y:E.y<z.y?E.y:z.y,I,H,J);I=r(K,L,I,H,J);H=E.prevZ;for(J=E.nextZ;H&&H.z>=F&&J&&J.z<=I;){if(H!==E.prev&&H!==E.next&&x(B.x,B.y,E.x,E.y,z.x,z.y,H.x,H.y)&&0<=w(H.prev,H,H.next))return!1;H=H.prevZ;if(J!==E.prev&&J!==E.next&&x(B.x,B.y,E.x,E.y,z.x,z.y,J.x,J.y)&&0<=w(J.prev,J,J.next))return!1;J=J.nextZ}for(;H&&H.z>=F;){if(H!==E.prev&&H!==E.next&&x(B.x,B.y,E.x,E.y,z.x,z.y,H.x,H.y)&&
0<=w(H.prev,H,H.next))return!1;H=H.prevZ}for(;J&&J.z<=I;){if(J!==E.prev&&J!==E.next&&x(B.x,B.y,E.x,E.y,z.x,z.y,J.x,J.y)&&0<=w(J.prev,J,J.next))return!1;J=J.nextZ}return!0}function c(E,I){return E.x-I.x}function l(E){if(E.next.prev===E)return E;let I=E;do{const H=I.next;if(H.prev===I||H===I||H===E)break;I=H}while(1);return I}function f(E,I){var H=I,J=E.x,B=E.y,z=-Infinity;do{if(B<=H.y&&B>=H.next.y&&H.next.y!==H.y){var K=H.x+(B-H.y)*(H.next.x-H.x)/(H.next.y-H.y);if(K<=J&&K>z){z=K;if(K===J){if(B===H.y)return H;
if(B===H.next.y)return H.next}var L=H.x<H.next.x?H:H.next}}H=H.next}while(H!==I);if(!L)return null;if(J===z)return L;I=L;K=L.x;var F=L.y,M=Infinity;H=L;do{if(J>=H.x&&H.x>=K&&J!==H.x&&x(B<F?J:z,B,K,F,B<F?z:J,B,H.x,H.y)){var S=Math.abs(B-H.y)/(J-H.x);var N;if((N=v(H,E))&&!(N=S<M)&&(N=S===M)&&!(N=H.x>L.x)&&(N=H.x===L.x)){N=L;var P=H;N=0>w(N.prev,N,P.prev)&&0>w(P.next,N,N.next)}N&&(L=H,M=S)}H=H.next}while(H!==I);return L}function r(E,I,H,J,B){E=32767*(E-H)*B;I=32767*(I-J)*B;E=(E|E<<8)&16711935;E=(E|E<<
4)&252645135;E=(E|E<<2)&858993459;I=(I|I<<8)&16711935;I=(I|I<<4)&252645135;I=(I|I<<2)&858993459;return(E|E<<1)&1431655765|((I|I<<1)&1431655765)<<1}function x(E,I,H,J,B,z,K,L){return 0<=(B-K)*(I-L)-(E-K)*(z-L)&&0<=(E-K)*(J-L)-(H-K)*(I-L)&&0<=(H-K)*(z-L)-(B-K)*(J-L)}function w(E,I,H){return(I.y-E.y)*(H.x-I.x)-(I.x-E.x)*(H.y-I.y)}function p(E,I){return E.x===I.x&&E.y===I.y}function t(E,I,H,J){var B=u(w(E,I,H)),z=u(w(E,I,J)),K=u(w(H,J,E)),L=u(w(H,J,I));return B!==z&&K!==L||0===B&&q(E,H,I)||0===z&&q(E,
J,I)||0===K&&q(H,E,J)||0===L&&q(H,I,J)?!0:!1}function q(E,I,H){return I.x<=Math.max(E.x,H.x)&&I.x>=Math.min(E.x,H.x)&&I.y<=Math.max(E.y,H.y)&&I.y>=Math.min(E.y,H.y)}function u(E){return 0<E?1:0>E?-1:0}function v(E,I){return 0>w(E.prev,E,E.next)?0<=w(E,I,E.next)&&0<=w(E,E.prev,I):0>w(E,I,E.prev)||0>w(E,E.next,I)}function y(E,I){var H=new A(E.i,E.x,E.y),J=new A(I.i,I.x,I.y),B=E.next,z=I.prev;E.next=I;I.prev=E;H.next=B;B.prev=H;J.next=H;H.prev=J;z.next=J;J.prev=z;return J}function D(E,I,H,J){E=new A(E,
I,H);J?(E.next=J.next,E.prev=J,J.next.prev=E,J.next=E):(E.prev=E,E.next=E);return E}function G(E){E.next.prev=E.prev;E.prev.next=E.next;E.prevZ&&(E.prevZ.nextZ=E.nextZ);E.nextZ&&(E.nextZ.prevZ=E.prevZ)}function A(E,I,H){this.i=E;this.x=I;this.y=H;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function C(E,I,H,J){for(var B=0,z=H-J;I<H;I+=J)B+=(E[z]-E[I])*(E[I+1]+E[z+1]),z=I;return B}k.deviation=function(E,I,H,J){var B=I&&I.length,z=Math.abs(C(E,0,B?I[0]*H:E.length,H));if(B){B=
0;for(var K=I.length;B<K;B++)z-=Math.abs(C(E,I[B]*H,B<K-1?I[B+1]*H:E.length,H))}for(B=I=0;B<J.length;B+=3){K=J[B]*H;var L=J[B+1]*H,F=J[B+2]*H;I+=Math.abs((E[K]-E[F])*(E[L+1]-E[K+1])-(E[K]-E[L])*(E[F+1]-E[K+1]))}return 0===z&&0===I?0:Math.abs((I-z)/z)};k.flatten=function(E){for(var I=E[0][0].length,H={vertices:[],holes:[],dimensions:I},J=0,B=0;B<E.length;B++){for(var z=0;z<E[B].length;z++)for(var K=0;K<I;K++)H.vertices.push(E[B][z][K]);0<B&&(J+=E[B-1].length,H.holes.push(J))}return H};return k})})(n);
b=b.getDefaultExportFromCjs(n.exports);a.earcut=b})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(b,n,h,k,m,g=!1){return{objectId:b,target:n,distance:h,type:"edge",start:k,end:m,draped:g}};a.makeVertexCandidate=function(b,n,h){return{objectId:b,target:n,distance:h,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../Color",
"../visualVariables/support/visualVariableUtils"],function(a,b,n){function h(m,g){if(!m||m.symbol)return null;g=g?.renderer;return m&&null!=g&&g.getObservationRenderer?g.getObservationRenderer(m):g}async function k(m,g){if(null!=m.symbol)return m.symbol;const e=h(m,g);return null!=e?e.getSymbolAsync(m,g):null}a.getDriverAxisSizeValue=function(m,g=0){m=m[g];return"number"===typeof m&&isFinite(m)?m:null};a.getDriverAxisSizeValueAny=function(m){for(let g=0;3>g;g++){const e=m[g];if("number"===typeof e)return isFinite(e)?
e:0}return 0};a.getRenderer=h;a.getRenderingInfo=function(m,g){const e=h(m,g);if(null!=m.symbol)var d=m.symbol;else d=h(m,g),d=null!=d&&"dot-density"!==d.type?d.getSymbol(m,g):null;if(null==d)return null;d={renderer:e,symbol:d};if(!(null!=e&&"visualVariables"in e&&e.visualVariables))return d;g=n.getVisualVariableValues(e,m,g)??[];m=["proportional","proportional","proportional"];for(const {variable:c,value:l}of g)switch(c.type){case "color":d.color=l.toRgba();break;case "size":if("outline"===c.target)d.outlineSize=
l;else switch(g=c.useSymbolValue?"symbol-value":l,c.axis){case "width":m[0]=g;break;case "depth":m[1]=g;break;case "height":m[2]=g;break;case "width-and-depth":m[0]=m[1]=g;break;default:m[0]=m[1]=m[2]=g}break;case "opacity":d.opacity=l;break;case "rotation":switch(c.axis){case "tilt":d.tilt=l;break;case "roll":d.roll=l;break;default:d.heading=l}}if("proportional"!==m[0]||"proportional"!==m[1]||"proportional"!==m[2])d.size=m;return d};a.getRenderingInfoAsync=async function(m,g){var e=h(m,g),d=await k(m,
g);if(!d)return null;d={renderer:e,symbol:d};if(!(e&&"visualVariables"in e&&e.visualVariables))return d;g=n.getVisualVariableValues(e,m,g)??[];m=["proportional","proportional","proportional"];for(const {variable:c,value:l}of g)"color"===c.type?d.color=b.toUnitRGBA(l):"size"===c.type?"outline"===c.target?d.outlineSize=l:(g=c.axis,e=c.useSymbolValue?"symbol-value":l,"width"===g?m[0]=e:"depth"===g?m[1]=e:"height"===g?m[2]=e:m[0]="width-and-depth"===g?m[1]=e:m[1]=m[2]=e):"opacity"===c.type?d.opacity=
l:"rotation"===c.type&&"tilt"===c.axis?d.tilt=l:"rotation"===c.type&&"roll"===c.axis?d.roll=l:"rotation"===c.type&&(d.heading=l);if(isFinite(m[0])||isFinite(m[1])||isFinite(m[2]))d.size=m;return d};a.getSymbolAsync=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/mathUtils ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec32 ../../../../geometry/support/Axis ../../../../geometry/support/Indices ../../../../geometry/support/plane ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(v,y,D,G){const A=Array.isArray(y[0])?(E,I)=>y[E][I]:(E,I)=>y[3*E+I],C=G?h.getMetersPerUnitForSR(G)/h.getMetersPerVerticalUnitForSR(G):1;return d.fromManyPoints(v,(E,I)=>m.set(E,A(I,0)*C,A(I,1)*C,A(I,2)),D)}function t(v,y,D){v=p(q,v,y,D)?d.getNormal(q):[0,0,1];return Math.abs(v[2])>Math.cos(n.deg2rad(80))?g.Axis.Z:Math.abs(v[1])>Math.abs(v[0])?g.Axis.Y:g.Axis.X}const q=d.create();class u{constructor(v,y,D){this.renderData=v;this.layerUid=y;this.graphicUid=
D;this.outGeometries=[]}}a.PolygonCreationDataBase=u;a.createColorGeometry=function(v){const y=[[r.VertexAttribute.POSITION,new c.Attribute(v.attributeData.position,v.indices,3,!0)]],D=e.getZeroIndexArray(v.indices.length);null!=v.attributeData.colorFeature?y.push([r.VertexAttribute.COLORFEATUREATTRIBUTE,new c.Attribute([v.attributeData.colorFeature],D,1,!0)]):v.attributeData.color&&y.push([r.VertexAttribute.COLOR,new c.Attribute(v.attributeData.color,D,4,!0)]);v.attributeData.uvMapSpace&&y.push([r.VertexAttribute.UVMAPSPACE,
new c.Attribute(v.attributeData.uvMapSpace,v.indices,4,!0)]);v.attributeData.boundingRect&&y.push([r.VertexAttribute.BOUNDINGRECT,new c.Attribute(v.attributeData.boundingRect,v.indices,9,!0)]);return new f.Geometry(v.material,y,v.mapPositions,l.ContentObjectType.Mesh,v.attributeData.objectAndLayerIdColor)};a.createIndices3D=function(v,y,D){D=t(v,(0<y.length?y[0]:v.length/3)-1,D);if(D!==g.Axis.Z){v=v.slice();for(let G=0;G<v.length;G+=3)v[G+D]=v[G+2]}return k.earcut(v,y,3)};a.createWaterGeometry=function(v,
y=null){const D=[[r.VertexAttribute.POSITION,new c.Attribute(v.attributeData.position,v.indices,3,!0)],[r.VertexAttribute.UV0,new c.Attribute(v.attributeData.uv0,v.indices,2,!0)]];return new f.Geometry(v.material,D,v.mapPositions,l.ContentObjectType.Mesh,y)};a.fitPlane=p;a.geometryAsPolygon=function(v){switch(v.type){case "extent":if(v instanceof x)return w.fromExtent(v);break;case "polygon":return v}return null};a.leastSignificantAxis=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,n,h,k,m){function g(x,w,p=null){return x.filter(({count:t})=>1<t).map(({index:t,count:q})=>{const u=3*t,v=3*q;return null!=p?new c(t,q,n.doubleSubArray(w,u,v),n.doubleSubArray(p,u,v)):new d(t,
q,n.doubleSubArray(w,u,v))})}function e(x,w,p=null){const t=[];for(const {index:q,count:u,holeIndices:v,pathLengths:y}of x){if(1>=u)continue;x=3*q;const D=3*u,G=v.map(A=>A-q);x=null!=p?new l(q,u,n.doubleSubArray(w,3*q,3*u),n.doubleSubArray(p,x,D),G,y):new f(q,u,n.doubleSubArray(w,3*q,3*u),G,y);t.push(x)}return t}class d{constructor(x,w,p){this.index=x;this.count=w;this.position=p}}class c extends d{constructor(x,w,p,t){super(x,w,p);this.mapPositions=t}}class l extends c{constructor(x,w,p,t,q,u){super(x,
w,p,t);this.holeIndices=q;this.pathLengths=u}}class f extends d{constructor(x,w,p,t,q){super(x,w,p);this.holeIndices=t;this.pathLengths=q}}class r{constructor(x,w,p,t,q,u){this.position=x;this.mapPositions=w;this.polygons=p;this.outlines=t;this.projectionSuccess=q;this.sampledElevation=u}}a.PolygonRenderInfo=r;a.PolygonVertexData=l;a.PolygonVertexDataDraped=f;a.geometryToRenderInfo=function(x,w,p,t){const q=h.pathsToTriangulationInfo(x.rings,!!x.hasZ&&"on-the-ground"!==t.mode,h.CounterClockwiseMode.CCW_IS_HOLE,
x.spatialReference),u=n.newDoubleArray(q.position.length);x=k.applyPerVertexElevationAlignment(q.position,x.spatialReference,0,u,0,q.position,0,q.position.length/3,w,p,t);w=null!=x;return new r(q.position,u,e(q.polygons,q.position,u),g(q.outlines,q.position,u),w,x)};a.geometryToRenderInfoDraped=function(x,w){const p=h.pathsToTriangulationInfo(x.rings,!1,h.CounterClockwiseMode.CCW_IS_HOLE);x=b.projectBuffer(p.position,x.spatialReference,0,p.position,w,0,p.position.length/3);for(w=2;w<p.position.length;w+=
3)p.position[w]=m.drapedZ;return{position:p.position,polygons:e(p.polygons,p.position),outlines:g(p.outlines,p.position),projectionSuccess:x}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define("exports ../../chunks/earcut ./Axis ./coordsUtils ./DoubleArray ./Indices ./meshUtils/deduplicate ../../views/3d/layers/graphics/polygonUtils".split(" "),function(a,b,n,h,k,m,g,e){function d(r,x,w){if(1===r.length)return r[0];x=k.newDoubleArray(x);
w=Array(w);let p=0,t=0,q=0;for(const u of r){for(r=0;r<u.position.length;r++)x[p++]=u.position[r];for(const v of u.faces)w[t++]=v+q;q=p/3}return{position:x,faces:m.compactIndices(w)}}function c(r,x,w,p){const t=r.length,q=Array(t),u=Array(t),v=Array(t);let y=0,D=0,G=0;var A=0;for(var C=0;C<t;++C)A+=r[C].length;A=k.newDoubleArray(3*A);C=0;for(let J=t-1;0<=J;J--){var E=r[J],I=w===a.CounterClockwiseMode.CCW_IS_HOLE?f(E,x,p):!1;if(I&&1!==t)q[y++]=E;else{var H=E.length;for(let B=0;B<y;++B)H+=q[B].length;
H={index:C,pathLengths:Array(y+1),count:H,holeIndices:Array(y)};H.pathLengths[0]=E.length;0<E.length&&(v[G++]={index:C,count:E.length});C=I?l(E,E.length-1,-1,A,C,E.length,x):l(E,0,1,A,C,E.length,x);for(E=0;E<y;++E)I=q[E],H.holeIndices[E]=C,H.pathLengths[E+1]=I.length,0<I.length&&(v[G++]={index:C,count:I.length}),C=l(I,0,1,A,C,I.length,x);y=0;0<H.count&&(u[D++]=H)}}for(r=0;r<y;++r)w=q[r],0<w.length&&(v[G++]={index:C,count:w.length}),C=l(w,0,1,A,C,w.length,x);u.length=D;v.length=G;return{position:A,
polygons:u,outlines:v}}function l(r,x,w,p,t,q,u){t*=3;for(let v=0;v<q;++v){const y=r[x];p[t++]=y[0];p[t++]=y[1];p[t++]=u?y[2]:0;x+=w}return t/3}function f(r,x,w){if(x){x=e.leastSignificantAxis(r,r.length-1,w);if(x===n.Axis.X)return!h.isClockwise(r,n.Axis.Y,n.Axis.Z);if(x===n.Axis.Y)return!h.isClockwise(r,n.Axis.X,n.Axis.Z)}return!h.isClockwise(r,n.Axis.X,n.Axis.Y)}a.CounterClockwiseMode=void 0;(function(r){r[r.NONE=0]="NONE";r[r.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode=
{}));a.isCounterClockwise=f;a.pathsToTriangulationInfo=c;a.triangulate=function(r){r=c(r.rings,r.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE,r.spatialReference);const x=[];let w=0,p=0;for(var t of r.polygons){const u=t.index,v=k.doubleSubArray(r.position,3*u,3*t.count);var q=t.holeIndices.map(y=>y-u);q=m.compactIndices(b.earcut(v,q,3));x.push({position:v,faces:q});w+=v.length;p+=q.length}t=d(x,w,p);r=Array.isArray(t.position)?g.deduplicate(t.position,3,{originalIndices:t.faces}):g.deduplicate(t.position.buffer,
6,{originalIndices:t.faces});t.position=k.doubleArrayFrom(new Float64Array(r.buffer));t.faces=r.indices;return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../Indices"],function(a,b,n){let h=null;a.deduplicate=function(k,m,g){var e=Array.isArray(k),d=e?k.length/m:k.byteLength/(4*m),c=e?k:new Uint32Array(k,0,d*m),l=g?.minReduction??0;const f=(k=g?.originalIndices||null)?k.length:
0;var r=g?.componentOffsets||null;g=0;if(r)for(var x=0;x<r.length-1;x++){var w=r[x+1]-r[x];w>g&&(g=w)}else g=d;var p=Math.floor(1.1*g)+1;if(null==h||h.length<2*p)h=new Uint32Array(b.nextHighestPowerOfTwo(2*p));for(g=0;g<2*p;g++)h[g]=0;g=0;const t=(w=!!r&&!!k)?f:d;x=n.newIndexArray(d);var q=new Uint32Array(f),u=0!==l?Math.ceil(7.84*1.96/(l*l)*l*(1-l)):t,v=1,y=r?r[1]:t;for(let E=0;E<t;E++){if(E===u){var D=1-g/E;if(D+1.96*Math.sqrt(D*(1-D)/E)<l)return null;u*=2}if(E===y){for(y=0;y<2*p;y++)h[y]=0;if(k)for(y=
r[v-1];y<r[v];y++)q[y]=x[k[y]];y=r[++v]}D=w?k[E]:E;const I=D*m;var G=0;for(var A=0;A<m;A++)G=c[I+A]+G|0,G=G+(G<<11)+(G>>>2)|0;G>>>=0;A=G%p;let H=g;for(;0!==h[2*A+1];){if(h[2*A]===G){const J=h[2*A+1]-1;var C=J*m;a:{for(let B=0;B<m;B++)if(c[I+B]!==c[C+B]){C=!1;break a}C=!0}if(C){H=x[J];break}}A++;A>=p&&(A-=p)}H===g&&(h[2*A]=G,h[2*A+1]=D+1,g++);x[D]=H}if(0!==l&&1-g/d<l)return null;if(w){for(d=r[v-1];d<q.length;d++)q[d]=x[k[d]];x=n.compactIndices(q)}e=e?Array(g):new Uint32Array(g*m);g=0;for(u=0;u<t;u++)if(x[u]===
g){d=c;l=(w?k[u]:u)*m;r=e;p=g*m;q=m;for(v=0;v<q;v++)r[p+v]=d[l+v];g++}if(k&&!w){m=new Uint32Array(f);for(c=0;c<m.length;c++)m[c]=x[k[c]];x=n.compactIndices(m)}return{buffer:Array.isArray(e)?e:e.buffer,indices:x,uniqueCount:g}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayContent ./OverlayRenderTargets ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../../../chunks/OverlayCompositing.glsl ../webgl-engine/shaders/OverlayCompositingTechnique ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X){a.OverlayRenderer=class extends H.SyncRenderPlugin{constructor(da){super(da);this._renderTargets=this._overlays=null;this._overlayParameters=new Q.OverlayCompositingPassParameters;this._hasWater=this.hasHighlights=!1;this._renderers=new Map;this._sortedDrapeSourceRenderersDirty=!1;this._sortedRenderers=new m;this._passParameters=new E.TextureOnlyPassParameters;this._materialRepository=null;this._screenToWorldRatio=
1;this._localOriginFactory=null;this.unloadedMemory=0;this.ignoresMemoryFactor=!1;this._camera=new J.Camera;this.worldToPCSRatio=1;this.events=new n;this.longitudeCyclical=null;this.produces=new Map([[F.RenderSlot.DRAPED_MATERIAL,aa=>aa!==A.ShaderOutput.Highlight||this.hasHighlights],[F.RenderSlot.DRAPED_WATER,()=>this._hasWater]]);this._hasDrapedRasterSource=this._hasDrapedFeatureSource=this._hasTargetWithoutRasterImage=!1}initialize(){const da=this.view._stage.renderer.fboCache,aa=this.view._stage.renderView,
{waterTextures:ea,stippleTextures:ha,markerTextures:Y}=aa;this._shaderTechniques=new I.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:t.ViewingMode.Local,stippleTextureRepository:ha,markerTextureRepository:Y,waterTextureRepository:ea});this._renderContext=new L.OverlayRenderContext(this._rctx,new M.ShadowMap(da,this.view.state.viewingMode),null);this.addHandles([g.watch(()=>ea.updating,()=>this.events.emit("content-changed"),g.syncAndInitial),g.watch(()=>this.spatialReference,Z=>this._localOriginFactory=
new z.GridLocalOriginFactory(Z),g.syncAndInitial),g.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]);this._materialRepository=new B.GLMaterialRepository(aa.textureRepository,this._shaderTechniques,()=>{this.notifyChange("rendersOccludedDraped");this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=F.RenderSlot.DRAPED_MATERIAL;this._bindParameters.mainDepth=
null;this._camera.near=1;this._camera.far=1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=R.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new T.AmbientLight(p.fromValues(1,1,1))]);this.addHandles(this.view.resourceController.scheduler.registerTask(U.TaskPriority.STAGE,this))}destroy(){this._renderers.forEach(da=>
da.destroy());this._renderers.clear();this._debugTextureTechnique=k.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=k.disposeMaybe(this._passParameters.texture);this._shaderTechniques=k.destroyMaybe(this._shaderTechniques);this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(da){this.pluginContext=
da}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||h.someMap(this._renderers,da=>da.updating)}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMemoryForMaterial(da){return Array.from(this._renderers.values()).reduce((aa,ea)=>aa+ea.getMemoryForMaterial(da),0)}get layers(){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();return this._sortedRenderers.map(da=>da.drapeSource.layer).filter(da=>
!!da)}createGeometryDrapeSourceRenderer(da){return this.createDrapeSourceRenderer(da,S.SortedRenderGeometryRenderer)}createDrapeSourceRenderer(da,aa,ea){const ha=this._renderers.get(da);null!=ha&&ha.destroy();aa=new aa({...ea,rendererContext:this,drapeSource:da});this._renderers.set(da,aa);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in da&&this.addHandles(g.watch(()=>da.fullOpacity,()=>this.events.emit("content-changed")),da);return aa}removeDrapeSourceRenderer(da){if(null!=da){var aa=this._renderers.get(da);
null!=aa&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(da),this.removeHandles(da),aa.destroy())}}computeValidity(){return this._renderTargets?.computeValidity()??0}releaseRenderTargets(){this._renderTargets?.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(da){this._hasTargetWithoutRasterImage=this._overlays?e.someSet(da,aa=>aa.drapeTargetType===q.DrapeTargetType.WithoutRasterImage):!1}ensureDrapeSources(da){this._overlays?(this._hasDrapedFeatureSource=e.someSet(da,
aa=>aa.drapeSourceType===q.DrapeSourceType.Features),this._hasDrapedRasterSource=e.someSet(da,aa=>aa.drapeSourceType===q.DrapeSourceType.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(da,aa,ea=this._bindParameters.overlayStretch){null==this._overlays&&(this._renderTargets=new G.OverlayRenderTargets(this.view._stage.renderer.fboCache),
this._overlays=[new y.Overlay,new y.Overlay]);this.ensureDrapeTargets(da);this.ensureDrapeSources(aa);this._bindParameters.overlayStretch=ea}disposeOverlays(){this._overlays=null;this._renderTargets=k.disposeMaybe(this._renderTargets);this.events.emit("textures-disposed")}getTexture(da){if(null!=da)return da===D.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?this._renderTargets?.getTexture(D.OverlayContent.Color):this._renderTargets?.getTexture(da)}get running(){return this.updating}runTask(da){this._processDrapeSources(da,
()=>!0)}_processDrapeSources(da,aa){let ea=!1;for(const [ha,Y]of this._renderers){if(da.done)break;(ha.destroyed||aa(ha))&&Y.commitChanges()&&(ea=!0,da.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,ea=!0,this._updateSortedDrapeSourceRenderers());ea&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=h.someMap(this._renderers,
ha=>ha.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(U.noBudget,da=>da.updatePolicy===O.UpdatePolicy.SYNC)}get isEmpty(){return u.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!h.someMap(this._renderers,da=>!da.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const da=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=fa;const aa=this._sortedRenderers.some(({renderer:ea})=>
ea.shouldRender(this._renderContext));this._renderContext.renderOccludedMask=da;return aa}renders(da){return u.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&da!==D.OverlayContent.Occluded||this._sortedRenderers.some(({renderer:aa})=>aa.shouldRender(this._renderContext))}get mode(){return this.isEmpty?C.OverlayMode.Disabled:this._renderTargets?.getTexture(D.OverlayContent.WaterNormal)?C.OverlayMode.EnabledWithWater:this._renderTargets?.getTexture(D.OverlayContent.Color)?C.OverlayMode.Enabled:C.OverlayMode.Disabled}updateAnimation(da){let aa=
!1;this._renderers.forEach(ea=>aa=ea.updateAnimation(da)||aa);return aa}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(da){if(this._overlays&&this._renderTargets){for(var aa of this._overlays)this.longitudeCyclical?aa.setupGeometryViewsCyclical(this.longitudeCyclical):aa.setupGeometryViewsDirect();for(const ea of this._renderTargets.targets){if(ea.content===D.OverlayContent.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;aa=this._drawTarget(v.OverlayIndex.INNER,
ea,da);const ha=this._drawTarget(v.OverlayIndex.OUTER,ea,da);(aa||ha)&&ea.fbo.generateMipMap()}}}_drawTarget(da,aa,ea){const ha=this._overlays[da],Y=ha.canvasGeometries;if(0===Y.numViews)return!1;const {alignPixelEnabled:Z,contentPixelRatio:ja}=ea;this._screenToWorldRatio=ja*ha.mapUnitsPerPixel/this._bindParameters.overlayStretch;const oa=aa.output;if(this.isEmpty||oa===A.ShaderOutput.Highlight&&!this.hasHighlights||oa===A.ShaderOutput.Normal&&!this.hasWater||!ha.hasSomeSizedView())return!1;const qa=
this._rctx;this._camera.pixelRatio=ha.pixelRatio*ja;this._renderContext.output=oa;this._bindParameters.alignPixelEnabled=Z;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=oa===A.ShaderOutput.Normal?F.RenderSlot.DRAPED_WATER:F.RenderSlot.DRAPED_MATERIAL;aa.content===D.OverlayContent.Occluded&&(this._renderContext.renderOccludedMask=fa);if(!this.renders(aa.content))return this._renderContext.renderOccludedMask=
L.defaultRenderOccludedMask,!1;ea=ha.resolution;this._rctx.setViewport(da===v.OverlayIndex.INNER?0:ea,0,ea,ea);const ta=2*ha.resolution,va=ha.resolution,Ca=aa.fbo;Ca.bind(qa,ta,va);da===v.OverlayIndex.INNER&&(qa.setClearColor(0,0,0,0),qa.clearSafe(W.ClearBufferBit.COLOR_BUFFER_BIT));if(u.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE&&aa.content!==D.OverlayContent.Occluded)for(ea=0;ea<Y.numViews;ea++)this._setViewParameters(Y.extents[ea],ha),this._ensureDebugPatternResources(ha.resolution,ia[da]),this._rctx.bindTechnique(this._debugTextureTechnique,
this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();this._sortedRenderers.forAll(({drapeSource:ma,renderer:wa})=>{if(aa.content!==D.OverlayContent.ColorNoRasterImage||ma.drapeSourceType!==q.DrapeSourceType.RasterImage){var {fullOpacity:Ba}=ma;ma=null!=Ba&&1>Ba&&oa===A.ShaderOutput.Color?this.bindTemporaryFramebuffer(ta,va):null;for(let pa=0;pa<Y.numViews;pa++)this._setViewParameters(Y.extents[pa],ha),wa.render(this._renderContext);ma&&(Ca.bind(qa,ta,va),this._overlayParameters.texture=
ma.getTexture(),this._overlayParameters.opacity=Ba,this._overlayParameters.overlayIndex=da,wa=this.pluginContext.techniqueRepository.acquire(V.OverlayCompositingTechnique),this._rctx.bindTechnique(wa,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),wa.release(),ma.release())}});qa.bindFramebuffer(null);this._renderContext.renderOccludedMask=L.defaultRenderOccludedMask;return!0}bindTemporaryFramebuffer(da,aa){const ea=this.view._stage.renderer.fboCache;da=ea.acquire(da,
aa,"overlay tmp");ea.rctx.unbindTexture(da.fbo.colorTexture);ea.rctx.bindFramebuffer(da.fbo);ea.rctx.clearSafe(W.ClearBufferBit.COLOR_BUFFER_BIT);return da}async reloadShaders(){await this._shaderTechniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(da,aa,ea,ha){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let Y=0;for(const {renderer:Z}of this._sortedRenderers)Y=Z.intersect?.(da,aa,ea,ha,Y)??Y}_updateSortedDrapeSourceRenderers(){this._sortedRenderers.clear();
if(0!==this._renderers.size){var da=this.view.map.allLayers,aa=da.length;this._renderers.forEach((ea,ha)=>{const Y=da.indexOf(ha.layer),Z=0<=Y;this._sortedRenderers.push(new ba(ha,ea,aa*(ha.renderGroup??(Z?q.DrapedRenderGroup.MapLayer:q.DrapedRenderGroup.ViewLayer))+(Z?Y:0)))});this._sortedRenderers.sort((ea,ha)=>ea.index-ha.index)}}_setViewParameters(da,aa){const ea=this._camera;ea.viewport=[0,0,aa.resolution,aa.resolution];x.ortho(ea.projectionMatrix,0,da[2]-da[0],0,da[3]-da[1],ea.near,ea.far);
x.fromTranslation(ea.viewMatrix,[-da[0],-da[1],0])}_updateHasWater(){const da=h.someMap(this._renderers,aa=>aa.hasWater);da!==this._hasWater&&(this._hasWater=da,this.events.emit("has-water",da))}_ensureDebugPatternResources(da,aa){w.set(this._passParameters.color,aa[0],aa[1],aa[2]);if(!this._passParameters.texture){aa=new Uint8Array(da*da*4);var ea=0;for(let ha=0;ha<da;ha++)for(let Y=0;Y<da;Y++){const Z=Math.floor(Y/10),ja=Math.floor(ha/10);2>Z||2>ja||10*Z>da-20||10*ja>da-20?(aa[ea++]=255,aa[ea++]=
255,aa[ea++]=255,aa[ea++]=255):(aa[ea++]=255,aa[ea++]=255,aa[ea++]=255,Z&1&&ja&1?aa[ea++]=Y&1^ha&1?0:255:aa[ea++]=Z&1^ja&1?0:128)}da=new X.TextureDescriptor(da);da.samplingMode=W.TextureSamplingMode.NEAREST;this._passParameters.texture=new ca.Texture(this._rctx,da,aa);da=new P.TextureTechniqueConfiguration;da.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniques.acquire(N.TextureTechnique,da)}}get test(){return{drapedRenderers:Array.from(this._renderers.values()),sortedDrapeSources:Array.from(this._sortedRenderers).map(({drapeSource:da})=>
da),getDrapeSourceRenderer:da=>this._renderers.get(da)}}};b.__decorate([d.property()],a.OverlayRenderer.prototype,"hasHighlights",void 0);b.__decorate([d.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);b.__decorate([d.property()],a.OverlayRenderer.prototype,"_shaderTechniques",void 0);b.__decorate([d.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([d.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([d.property()],
a.OverlayRenderer.prototype,"spatialReference",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);b.__decorate([d.property()],a.OverlayRenderer.prototype,"isEmpty",null);b.__decorate([d.property({readOnly:!0})],a.OverlayRenderer.prototype,"rendersOccludedDraped",null);a.OverlayRenderer=b.__decorate([r.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);class ba{constructor(da,aa,ea){this.drapeSource=da;this.renderer=aa;this.index=
ea}}const ia=[[1,.5,.5],[.5,.5,1]],fa=K.RenderOccludedFlag.OccludeAndTransparent;a.drapedZ=-2;a.overlayRenderOccludedFlag=fa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapedRenderGroup=void 0;(function(b){b[b.MapLayer=0]="MapLayer";b[b.ViewLayer=1]="ViewLayer";
b[b.Outline=2]="Outline";b[b.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||
(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define(["exports","../../../geometry/support/aaBoundingRect","../webgl-engine/lib/LocalOriginFactory"],function(a,b,n){class h{constructor(){this._extent=b.create();this.resolution=0;this.renderLocalOrigin=n.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new k}get extent(){return this._extent}setupGeometryViewsCyclical(m){this.setupGeometryViewsDirect();var g=.001*m.range;if(this._extent[0]-
g<=m.min){const e=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b.offset(this._extent,m.range,0,e)}this._extent[2]+g>=m.max&&(g=this.canvasGeometries.extents[this.canvasGeometries.numViews++],b.offset(this._extent,-m.range,0,g))}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1;b.copy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let m=0;m<this.canvasGeometries.numViews;m++){const g=this.canvasGeometries.extents[m];if(g[0]!==g[2]&&g[1]!==g[3])return!0}return!1}}
class k{constructor(){this.extents=[b.create(),b.create(),b.create()];this.numViews=0}}a.Overlay=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b){class n{constructor(h,k){this.vec3=h;this.id=k}}a.LocalOrigin=n;a.fromValues=function(h,k,m,g){return new n(b.fromValues(h,k,m),g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/OverlayContent":function(){define(["exports"],function(a){a.OverlayContent=void 0;var b=a.OverlayContent||(a.OverlayContent={});b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.WaterNormal=3]="WaterNormal";b[b.Occluded=4]="Occluded";b[b.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTargets":function(){define("exports ../../../core/has ./OverlayContent ./OverlayFramebufferObject ../webgl/formats ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),
function(a,b,n,h,k,m){class g{constructor(d,c,l,f,r=k.ColorFormat.RGBA_MIPMAP){this.output=l;this.content=f;this.fbo=new h.OverlayFramebufferObject(d,r,c)}get valid(){return this.fbo.valid}}class e{constructor(d){this.targets=[new g(d,"overlay color",m.ShaderOutput.Color,n.OverlayContent.Color),new g(d,"overlay IM color",m.ShaderOutput.Color,n.OverlayContent.ColorNoRasterImage),new g(d,"overlay highlight",m.ShaderOutput.Highlight,n.OverlayContent.Highlight,k.ColorFormat.RGBA4),new g(d,"overlay water",
m.ShaderOutput.Normal,n.OverlayContent.WaterNormal),new g(d,"overlay occluded",m.ShaderOutput.Color,n.OverlayContent.Occluded)];b("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new g(d,"overlay oid",m.ShaderOutput.ObjectAndLayerIdColor,n.OverlayContent.ObjectAndLayerIdColor))}getTexture(d){return this.targets[d]?.fbo.texture}dispose(){for(const d of this.targets)d.fbo.dispose()}computeValidity(){return this.targets.reduce((d,c,l)=>c.valid?d|=1<<l:d,0)}}a.OverlayRenderTargets=e;a.RenderTargetDescriptor=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define(["exports","../../../core/maybe"],function(a,b){class n{constructor(h,k,m){this._fbos=h;this._format=k;this._name=m}get valid(){return null!=this._handle?.getTexture()}dispose(){this._handle=b.releaseMaybe(this._handle)}get texture(){return this._handle?.getTexture()}bind(h,k,m){this._handle&&this._handle.fbo.width===k&&this._handle.fbo.height===m||(this._handle?.release(),
this._handle=this._fbos.acquire(k,m,this._name,this._format));h.unbindTexture(this._handle?.fbo.colorTexture);h.bindFramebuffer(this._handle?.fbo)}generateMipMap(){this._handle?.getTexture()?.descriptor?.hasMipmap&&this._handle?.getTexture()?.generateMipmap()}}a.OverlayFramebufferObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/OverlayContent ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(v,y){y.pbrMode!==d.PBRMode.Water&&y.pbrMode!==d.PBRMode.WaterOnIntegratedMesh&&y.pbrMode!==d.PBRMode.TerrainWithWater||v.include(c.Water,y);const {vertex:D,fragment:G}=v;v.varyings.add("vtcOverlay","vec4");D.code.add(r.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);G.code.add(r.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);G.code.add(r.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);G.code.add(r.glsl`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);if(y.pbrMode===d.PBRMode.Water||y.pbrMode===d.PBRMode.WaterOnIntegratedMesh||y.pbrMode===d.PBRMode.TerrainWithWater)e.addMainLightDirection(G),e.addMainLightIntensity(G),G.code.add(r.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function t(v,y){return v.identifier===m.RenderPassIdentifier.Material&&v.output===g.ShaderOutput.Color?y.overlay?.getTexture(k.OverlayContent.ColorNoRasterImage):v.identifier===m.RenderPassIdentifier.Material&&v.output===g.ShaderOutput.ObjectAndLayerIdColor?y.overlay?.getTexture(k.OverlayContent.ObjectAndLayerIdColor):v.identifier===m.RenderPassIdentifier.Highlight?y.overlay?.getTexture(k.OverlayContent.Highlight):null}a.OverlayMode=void 0;(function(v){v[v.Disabled=0]="Disabled";v[v.Enabled=1]=
"Enabled";v[v.EnabledWithWater=2]="EnabledWithWater";v[v.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));class q extends w.Uniform{constructor(v){super(v,"vec4")}}const u=b.create();a.OverlayIM=function(v,y){const {vertex:D,fragment:G}=v;D.uniforms.add(new l.Float4DrawUniform("overlayTexOffset",(A,C)=>{const E=C.overlay?.overlays[h.OverlayIndex.INNER]?.extent;n.hasArea(E)&&(u[0]=A.toMapSpace[0]/n.width(E)-E[0]/n.width(E),u[1]=A.toMapSpace[1]/n.height(E)-E[1]/n.height(E));C=C.overlay?.overlays[h.OverlayIndex.OUTER]?.extent;
n.hasArea(C)&&(u[2]=A.toMapSpace[0]/n.width(C)-C[0]/n.width(C),u[3]=A.toMapSpace[1]/n.height(C)-C[1]/n.height(C));return u}),new l.Float4DrawUniform("overlayTexScale",(A,C)=>{const E=C.overlay?.overlays[h.OverlayIndex.INNER]?.extent;n.hasArea(E)&&(u[0]=A.toMapSpace[2]/n.width(E),u[1]=A.toMapSpace[3]/n.height(E));C=C.overlay?.overlays[h.OverlayIndex.OUTER]?.extent;n.hasArea(C)&&(u[2]=A.toMapSpace[2]/n.width(C),u[3]=A.toMapSpace[3]/n.height(C));return u}));G.constants.add("overlayOpacity","float",1);
G.uniforms.add(new x.Texture2DPassUniform("ovColorTex",(A,C)=>t(A,C)));p(v,y)};a.OverlayTerrain=function(v,y){const {vertex:D,fragment:G}=v;D.uniforms.add(new q("overlayTexOffset"),new q("overlayTexScale"));G.uniforms.add(new f.FloatPassUniform("overlayOpacity",A=>A.overlayOpacity),new x.Texture2DPassUniform("ovColorTex",(A,C)=>C.overlay?.getTexture(A.overlayContent)));p(v,y)};a.getIMColorTexture=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,n,h){class k extends h.VertexNormalPassParameters{constructor(){super(...arguments);this.origin=this.slicePlaneLocalOrigin=b.create();this.modelTransformation=null}}class m extends h.VertexNormalDrawParameters{}a.RenderPassIdentifier=void 0;(function(c){c[c.Material=0]="Material";c[c.ShadowMap=1]="ShadowMap";c[c.Highlight=2]="Highlight"})(a.RenderPassIdentifier||
(a.RenderPassIdentifier={}));class g extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Material;this.output=n.ShaderOutput.Color;this.transparent=!1}}class e extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.ShadowMap}}class d extends k{constructor(){super(...arguments);this.identifier=a.RenderPassIdentifier.Highlight}}a.DrawParameters=m;a.HighlightPassParameters=d;a.MaterialPassParameters=g;a.PassParameters=k;a.ShadowMapPassParameters=
e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceConstants ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m,g,e,d,
c,l){a.Water=function(f,r){f.include(h.PhysicallyBasedRenderingWater,r);f.include(n.Gamma);f.include(b.FoamColor);r.hasCloudsReflections&&f.include(g.CloudsParallaxShading,r);r.hasScreenSpaceReflections&&f.include(m.ScreenSpaceReflections,r);f=f.fragment;f.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",k.distanceFadeStart).add("ssrHeightFadeEnd",
"float",k.distanceFadeEnd).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);f.code.add(d.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);f.uniforms.add(new e.FloatPassUniform("lightingSpecularStrength",(x,w)=>w.lighting.mainLight.specularStrength),new e.FloatPassUniform("lightingEnvironmentStrength",(x,w)=>w.lighting.mainLight.environmentStrength));f.code.add(d.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);r.hasCloudsReflections&&f.code.add(d.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);r.hasScreenSpaceReflections?(f.uniforms.add(new c.Matrix4PassUniform("view",(x,w)=>w.camera.viewMatrix),new l.Texture2DPassUniform("lastFrameColorTexture",(x,w)=>w.ssr.lastFrameColor?.getTexture()),new e.FloatPassUniform("fadeFactorSSR",(x,w)=>w.ssr.fadeFactor)),f.code.add(d.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):f.code.add(d.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);r.hasCloudsReflections?r.hasScreenSpaceReflections?f.code.add(d.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):f.code.add(d.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):f.code.add(d.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(n){n.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(n){n.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../output/ReadDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m,g){a.ScreenSpaceReflections=function(e,d){e=e.fragment;e.include(b.ReadLinearDepth);
e.uniforms.add(new n.Float2PassUniform("nearFar",(c,l)=>l.camera.nearFar));e.uniforms.add(new g.Texture2DPassUniform("depthMap",(c,l)=>l.linearDepth?.getTexture()));e.uniforms.add(new m.Matrix4PassUniform("proj",(c,l)=>l.camera.projectionMatrix));e.uniforms.add(new h.FloatPassUniform("invResolutionHeight",(c,l)=>1/l.camera.height));e.uniforms.add(new m.Matrix4PassUniform("reprojectionMatrix",(c,l)=>l.ssr.reprojectionMatrix));e.code.add(k.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${d.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P = clamp(P + dP, vec2(0.0), vec2(0.999));
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"vec4",n.BindType.Draw,(g,e,d)=>g.setUniform4fv(k,m(e,d)))}}a.Float4DrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g){function e(){const l=new m.ShaderBuilder;l.include(n.ScreenSpacePass);l.fragment.uniforms.add(new g.Texture2DPassUniform("tex",f=>f.texture),new h.Float3PassUniform("uColor",f=>f.color));l.fragment.code.add(k.glsl`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);
}`);return l}class d extends k.NoParameters{constructor(){super(...arguments);this.color=b.fromValues(1,1,1)}}const c=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:d,build:e},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=c;a.TextureOnlyPassParameters=d;a.build=e})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,b,n){class h{constructor(g){this._context=
g;this._perConstructorInstances=new b.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(g=>g.forEach(e=>e.technique.destroy()));this._perConstructorInstances.clear()}acquire(g,e=m){const d=e.key;let c=this._perConstructorInstances.get(g,d);if(null==c){const l=new g(this._context,e,()=>this.release(l));c=new k(l);this._perConstructorInstances.set(g,
d,c)}++c.refCount;return c.technique}releaseAndAcquire(g,e,d){if(null!=d){if(e.key===d.key)return d;this.release(d)}return this.acquire(g,e)}release(g){null==g||this._perConstructorInstances.empty||(g=this._perConstructorInstances.get(g.constructor,g.key),null!=g&&(--g.refCount,0===g.refCount&&(g.refZeroFrame=this._frameCounter)))}frameUpdate(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((g,e)=>{g.forEach((d,c)=>{0===d.refCount&&d.refZeroFrame+this._keepAliveFrameCount<
this._frameCounter&&(d.technique.destroy(),this._perConstructorInstances.delete(e,c))})})}async reloadAll(){const g=[];this._perConstructorInstances.forEach((e,d)=>{g.push((async(c,l)=>{if(l=l.shader)await l.reload(),c.forEach(f=>f.technique.reload(this._context))})(e,d))});await Promise.all(g)}}class k{constructor(g){this.technique=g;this.refZeroFrame=this.refCount=0}}const m=new n.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define(["exports","../../../../core/Logger","../../../../core/maybe","../../../../core/NestedMap","./Util"],function(a,b,n,h,k){class m{constructor(e,d,c,l){this._textureRepository=e;this._techniqueRepository=d;this.materialChanged=c;this.requestRender=l;this._id2glMaterialRef=new h.NestedMap}dispose(){this._textureRepository.destroy()}acquire(e,d,c){this._ownMaterial(e);d=e.produces.get(d);if(!d||!d(c))return null;d=this._id2glMaterialRef.get(c,
e.id);null==d&&(d=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:c}),d=new g(d),this._id2glMaterialRef.set(c,e.id,d));d.ref();return d.glMaterial}release(e,d){const c=this._id2glMaterialRef.get(d,e.id);null!=c&&(c.unref(),c.referenced||(n.disposeMaybe(c.glMaterial),this._id2glMaterialRef.delete(d,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&b.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");
e.repository=this}}class g{constructor(e){this.glMaterial=e;this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt;k.assert(0<=this._refCnt)}get referenced(){return 0<this._refCnt}}a.GLMaterialRepository=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/uid ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/projectBuffer ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){class p{constructor(q){this._originSR=q;this._rootOriginId="root/"+b.generateUID();this._origins=new Map;this._objects=new Map;this._gridSize=5E5}getOrigin(q){var u=this._origins.get(this._rootOriginId);if(null==u){u=f.gridLocalOriginFactory.rootOrigin;if(null!=u)return this._origins.set(this._rootOriginId,c.fromValues(u[0],u[1],u[2],this._rootOriginId)),this.getOrigin(q);q=c.fromValues(q[0]+Math.random()-.5,q[1]+Math.random()-.5,q[2]+Math.random()-.5,this._rootOriginId);
this._origins.set(this._rootOriginId,q);return q}var v=this._gridSize;const y=Math.round(q[0]/v),D=Math.round(q[1]/v),G=Math.round(q[2]/v),A=`${y}/${D}/${G}`;let C=this._origins.get(A);const E=.5*v;n.subtract(t,q,u.vec3);t[0]=Math.abs(t[0]);t[1]=Math.abs(t[1]);t[2]=Math.abs(t[2]);if(t[0]<E&&t[1]<E&&t[2]<E)return C&&(v=Math.max(...t),n.subtract(t,q,C.vec3),t[0]=Math.abs(t[0]),t[1]=Math.abs(t[1]),t[2]=Math.abs(t[2]),Math.max(...t)<v)?C:u;C||(C=c.fromValues(y*v,D*v,G*v,A),this._origins.set(A,C));return C}_drawOriginBox(q,
u=k.fromValues(1,1,0,1)){const v=window.view,y=v._stage;var D=u.toString();if(!this._objects.has(D)){this._material=new w.RibbonLineMaterial({width:2,color:u});y.add(this._material);u=new x.WebGLLayer(y,{pickable:!1});var G=new l.Object3D({castShadow:!1});y.add(G);u.add(G);this._objects.set(D,G)}D=this._objects.get(D);u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];G=u.length;const A=Array(3*G),C=[],E=.5*this._gridSize;for(let I=0;I<G;I++)A[3*I]=q[0]+(u[I]&1?E:-E),A[3*I+1]=q[1]+(u[I]&2?E:-E),A[3*I+2]=q[2]+
(u[I]&4?E:-E),0<I&&C.push(I-1,I);m.projectBuffer(A,this._originSR,0,A,v.renderSpatialReference,0,G);q=new d.Geometry(this._material,[[r.VertexAttribute.POSITION,new g.Attribute(A,C,3,!0)]],null,e.ContentObjectType.Line);y.add(q);D.addGeometry(q)}get test(){const q=this;return{set gridSize(u){q._gridSize=u}}}}const t=h.create();a.GridLocalOriginFactory=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory=
{rootOrigin:null};a.textTextureAtlas={stableRendering:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends m.ContentObject{get objects(){return this._objects}constructor(f,r,x=""){super();
this.stage=f;this.apiLayerUid=x;this.type=g.ContentObjectType.Layer;this.events=new b;this.pickable=this.visible=!0;this.sliceable=!1;this._objects=new k;this._objectsAdded=new k;this._handles=new n;this.apiLayerUid=x;this.visible=r?.visible??!0;this.pickable=r?.pickable??!0;this.updatePolicy=r?.updatePolicy??c.UpdatePolicy.ASYNC;this._disableOctree=r?.disableOctree??!1;f.add(this);for(const w of e.DirtyEventNames)this._handles.add(this.events.on(w,p=>f.handleEvent(w,p)))}destroy(){this._handles.size&&
(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(f){this._objects.push(f);f.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:f});null!=this._octree&&this._objectsAdded.push(f)}remove(f){this._objects.removeUnordered(f)&&(f.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:f}),null!=this._octree&&(this._objectsAdded.removeUnordered(f)||this._octree.remove([f])))}addMany(f){this._objects.pushArray(f);for(const r of f)r.parentLayer=
this;this.events.emit("layerObjectsAdded",{layer:this,objects:f});null!=this._octree&&this._objectsAdded.pushArray(f)}removeMany(f){const r=[];this._objects.removeUnorderedMany(f,f.length,r);if(0!==r.length){for(const x of r)x.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:r});if(null!=this._octree){for(f=0;f<r.length;)this._objectsAdded.removeUnordered(r[f])?(r[f]=r[r.length-1],--r.length):++f;this._octree.remove(r)}}}sync(){this.updatePolicy!==c.UpdatePolicy.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(f,
r){null==this._octree||this._objectsAdded.includes(f)||this._octree.update(f,r)}getSpatialQueryAccelerator(){null==this._octree&&50<this._objects.length&&!this._disableOctree?(this._octree=new d(f=>f.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree}invalidateSpatialQueryAccelerator(){this._octree=
h.destroyMaybe(this._octree);this._objectsAdded.clear()}}a.WebGLLayer=l;a.isWebGLLayer=function(f){return null!=f&&f.type===g.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved transformationChanged shaderTransformationChanged visibilityChanged occlusionChanged highlightChanged geometryAdded geometryRemoved attributesChanged".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,b,n,h,k,m,g,e){function d(L,F,M){M[0]=L[0]+F;M[1]=L[1]+F;M[2]=L[2]+F}function c(L,F,M,S){if(1===F)L=M(L[0]),g.copy(L,S);
else{G[0]=Infinity;G[1]=Infinity;G[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(let O=0;O<F;O++){var N=M(L[O]);if(x(N[3])){var P=G,R=N;P[0]=Math.min(P[0],R[0]-R[3]);P[1]=Math.min(P[1],R[1]-R[3]);P[2]=Math.min(P[2],R[2]-R[3]);P=A;P[0]=Math.max(P[0],N[0]+N[3]);P[1]=Math.max(P[1],N[1]+N[3]);P[2]=Math.max(P[2],N[2]+N[3])}}n.lerp(g.getCenter(S),G,A,.5);S[3]=Math.max(A[0]-G[0],A[1]-G[1],A[2]-G[2])/2}}function l(L,F,M){if(!z.length)for(var S=0;8>S;++S)z.push({index:0,distance:0});for(S=0;8>
S;++S){const N=t[S];z.data[S].index=S;z.data[S].distance=r(L,F,N)}z.sort((N,P)=>N.distance-P.distance);for(L=0;8>L;++L)M[L]=z.data[L].index}function f(L,F){let M=Infinity,S;for(let N=0;8>N;++N){const P=r(L,F,q[N]);P<M&&(M=P,S=q[N])}return S}function r(L,F,M){return F*(L[0]*M[0]+L[1]*M[1]+L[2]*M[2])}function x(L){return!isNaN(L)&&-Infinity!==L&&Infinity!==L&&0<L}class w{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(L,
F){this.objectToBoundingSphere=L;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new p;this._objectCount=0;F&&(void 0!==F.maximumObjectsPerNode&&(this._maximumObjectsPerNode=F.maximumObjectsPerNode),void 0!==F.maximumDepth&&(this._maximumDepth=F.maximumDepth))}destroy(){this._degenerateObjects.clear();p.clearPool();v[0]=null;C.prune();z.prune()}add(L,F=L.length){this._objectCount+=F;this._grow(L,F);const M=p.acquire();for(let S=0;S<F;S++){const N=L[S];
this._isDegenerate(N)?this._degenerateObjects.add(N):(M.init(this._root),this._add(N,M))}p.release(M)}remove(L,F=null){this._objectCount-=L.length;const M=p.acquire();for(const S of L)L=F??g.copy(this.objectToBoundingSphere(S),E),x(L[3])?(M.init(this._root),this._remove(S,L,M)):this._degenerateObjects.delete(S);p.release(M);this._shrink()}update(L,F){if(x(F[3])||!this._isDegenerate(L))v[0]=L,L=v,this.remove(L,F),this.add(L)}forEachAlongRay(L,F,M){const S=m.wrap(L,F);this._forEachNode(this._root,N=>
{if(!this._intersectsNode(S,N))return!1;N=N.node;N.terminals.forAll(P=>{this._intersectsObject(S,P)&&M(P)});null!==N.residents&&N.residents.forAll(P=>{this._intersectsObject(S,P)&&M(P)});return!0})}forEachAlongRayWithVerticalOffset(L,F,M,S){const N=m.wrap(L,F);this._forEachNode(this._root,P=>{if(!this._intersectsNodeWithOffset(N,P,S))return!1;P=P.node;P.terminals.forAll(R=>{this._intersectsObjectWithOffset(N,R,S)&&M(R)});null!==P.residents&&P.residents.forAll(R=>{this._intersectsObjectWithOffset(N,
R,S)&&M(R)});return!0})}forEach(L){this._forEachNode(this._root,F=>{F=F.node;F.terminals.forAll(L);null!==F.residents&&F.residents.forAll(L);return!0});this._degenerateObjects.forEach(L)}forEachDegenerateObject(L){this._degenerateObjects.forEach(L)}findClosest(L,F,M,S=()=>!0,N=Infinity){let P=Infinity,R=Infinity,O=null;const T=f(L,F),Q=V=>{--N;if(S(V)){var U=this.objectToBoundingSphere(V);if(k.intersectsSphere(M,U)){var W=r(L,F,g.getCenter(U)),ca=W-U[3];U=W+U[3];ca<P&&(P=ca,R=U,O=V)}}};this._forEachNodeDepthOrdered(this._root,
V=>{if(0>=N||!k.intersectsSphere(M,V.bounds))return!1;n.scale(D,T,V.halfSize);n.add(D,D,g.getCenter(V.bounds));if(r(L,F,D)>R)return!1;V=V.node;V.terminals.forAll(U=>Q(U));null!==V.residents&&V.residents.forAll(U=>Q(U));return!0},L,F);return O}forEachInDepthRange(L,F,M,S,N,P,R){let O=-Infinity,T=Infinity;const Q={setRange:X=>{M===w.DepthOrder.FRONT_TO_BACK?(O=Math.max(O,X.near),T=Math.min(T,X.far)):(O=Math.max(O,-X.far),T=Math.min(T,-X.near))}};Q.setRange(S);const V=r(F,M,L),U=f(F,M),W=f(F,-M),ca=
X=>{if(R(X)){var ba=this.objectToBoundingSphere(X),ia=g.getCenter(ba);ia=r(F,M,ia)-V;var fa=ia+ba[3];ia-ba[3]>T||fa<O||!k.intersectsSphere(P,ba)||N(X,Q)}};this._forEachNodeDepthOrdered(this._root,X=>{if(!k.intersectsSphere(P,X.bounds))return!1;n.scale(D,U,X.halfSize);n.add(D,D,g.getCenter(X.bounds));if(r(F,M,D)-V>T)return!1;n.scale(D,W,X.halfSize);n.add(D,D,g.getCenter(X.bounds));if(r(F,M,D)-V<O)return!1;X=X.node;X.terminals.forAll(ba=>ca(ba));null!==X.residents&&X.residents.forAll(ba=>ca(ba));return!0},
F,M)}forEachNode(L){this._forEachNode(this._root,F=>L(F.node,F.bounds,F.halfSize,F.depth))}forEachNeighbor(L,F){const M=g.getRadius(F),S=g.getCenter(F),N=O=>{const T=this.objectToBoundingSphere(O);var Q=g.getRadius(T);Q=M+Q;return 0>=n.squaredDistance(g.getCenter(T),S)-Q*Q?L(O):!0};let P=!0;const R=O=>{P&&=N(O)};this._forEachNode(this._root,O=>{var T=g.getRadius(O.bounds);T=M+T;if(0<n.squaredDistance(g.getCenter(O.bounds),S)-T*T)return!1;O=O.node;O.terminals.forAll(R);P&&null!==O.residents&&O.residents.forAll(R);
return P});P&&this.forEachDegenerateObject(R)}_intersectsNode(L,F){d(g.getCenter(F.bounds),2*-F.halfSize,G);d(g.getCenter(F.bounds),2*F.halfSize,A);return e.rayBoxTest(L.origin,L.direction,G,A)}_intersectsNodeWithOffset(L,F,M){d(g.getCenter(F.bounds),2*-F.halfSize,G);d(g.getCenter(F.bounds),2*F.halfSize,A);M.applyToMinMax(G,A);return e.rayBoxTest(L.origin,L.direction,G,A)}_intersectsObject(L,F){F=this.objectToBoundingSphere(F);return 0<F[3]?g.intersectsRay(F,L):!0}_intersectsObjectWithOffset(L,F,
M){F=this.objectToBoundingSphere(F);return 0<F[3]?g.intersectsRay(M.applyToBoundingSphere(F),L):!0}_forEachNode(L,F){L=p.acquire().init(L);const M=[L];for(;0!==M.length;){L=M.pop();if(F(L)&&!L.isLeaf())for(let S=0;S<L.node.children.length;S++)L.node.children[S]&&M.push(p.acquire().init(L).advance(S));p.release(L)}}_forEachNodeDepthOrdered(L,F,M,S=w.DepthOrder.FRONT_TO_BACK){L=p.acquire().init(L);const N=[L];for(l(M,S,K);0!==N.length;){L=N.pop();if(F(L)&&!L.isLeaf())for(M=7;0<=M;--M)S=K[M],L.node.children[S]&&
N.push(p.acquire().init(L).advance(S));p.release(L)}}_remove(L,F,M){C.clear();F=M.advanceTo(F,(S,N)=>{C.push(S.node);C.push(N)})?M.node.terminals:M.node.residents;F.removeUnordered(L);if(0===F.length)for(L=C.length-2;0<=L&&this._purge(C.data[L],C.data[L+1]);L-=2);}_nodeIsEmpty(L){if(0!==L.terminals.length)return!1;if(null!==L.residents)return 0===L.residents.length;for(let F=0;F<L.children.length;F++)if(L.children[F])return!1;return!0}_purge(L,F){0<=F&&(L.children[F]=null);return this._nodeIsEmpty(L)?
(null===L.residents&&(L.residents=new b({shrink:!0})),!0):!1}_add(L,F){F.advanceTo(this.objectToBoundingSphere(L))?F.node.terminals.push(L):(F.node.residents.push(L),F.node.residents.length>this._maximumObjectsPerNode&&F.depth<this._maximumDepth&&this._split(F))}_split(L){const F=L.node.residents;L.node.residents=null;for(let M=0;M<F.length;M++){const S=p.acquire().init(L);this._add(F.at(M),S);p.release(S)}}_grow(L,F){0!==F&&(c(L,F,M=>this.objectToBoundingSphere(M),I),x(I[3])&&!this._fitsInsideTree(I)&&
(this._nodeIsEmpty(this._root.node)?(g.copy(I,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(L=this._rootBoundsForRootAsSubNode(I),this._placingRootViolatesMaxDepth(L)?this._rebuildTree(I,L):this._growRootAsSubNode(L),p.release(L))))}_rebuildTree(L,F){n.copy(g.getCenter(H),g.getCenter(F.bounds));H[3]=F.halfSize;c([L,H],2,M=>M,J);L=p.acquire().init(this._root);this._root.initFrom(null,J,J[3]);this._root.increaseHalfSize(1.25);this._forEachNode(L,
M=>{this.add(M.node.terminals.data,M.node.terminals.length);null!==M.node.residents&&this.add(M.node.residents.data,M.node.residents.length);return!0});p.release(L)}_placingRootViolatesMaxDepth(L){const F=Math.log(L.halfSize/this._root.halfSize)*Math.LOG2E;let M=0;this._forEachNode(this._root,S=>{M=Math.max(M,S.depth);return M+F<=this._maximumDepth});return M+F>this._maximumDepth}_rootBoundsForRootAsSubNode(L){var F=L[3],M=-Infinity;const S=this._root.bounds,N=this._root.halfSize;for(var P=0;3>P;P++){var R=
Math.max(0,Math.ceil((S[P]-N-(L[P]-F))/(2*N)));const O=Math.max(0,Math.ceil((L[P]+F-(S[P]+N))/(2*N)))+1;M=Math.max(M,2**Math.ceil(Math.log(R+O)*Math.LOG2E));B[P].min=R;B[P].max=O}for(L=0;3>L;L++)F=B[L].min,P=B[L].max,R=(M-(F+P))/2,F+=Math.ceil(R),P+=Math.floor(R),y[L]=S[L]-N-F*N*2+(P+F)*N;M*=N;y[3]=M*u;return p.acquire().initFrom(null,y,M,0)}_growRootAsSubNode(L){const F=this._root.node;n.copy(g.getCenter(I),g.getCenter(this._root.bounds));I[3]=this._root.halfSize;this._root.init(L);L.advanceTo(I,
null,!0);L.node.children=F.children;L.node.residents=F.residents;L.node.terminals=F.terminals}_shrink(){for(;;){const L=this._findShrinkIndex();if(-1===L)break;this._root.advance(L);this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let L=null;const F=this._root.node.children;let M=0,S=0;for(;S<F.length&&null==L;)M=S++,L=F[M];for(;S<F.length;)if(F[S++])return-1;return M}_isDegenerate(L){L=this.objectToBoundingSphere(L)[3];return!x(L)}_fitsInsideTree(L){const F=
this._root.bounds,M=this._root.halfSize;return L[3]<=M&&L[0]>=F[0]-M&&L[0]<=F[0]+M&&L[1]>=F[1]-M&&L[1]<=F[1]+M&&L[2]>=F[2]-M&&L[2]<=F[2]+M}toJSON(){const {maximumDepth:L,maximumObjectsPerNode:F,_objectCount:M}=this,S=this._nodeToJSON(this._root.node);return{maximumDepth:L,maximumObjectsPerNode:F,objectCount:M,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:S}}}_nodeToJSON(L){const F=L.children.map(S=>S?this._nodeToJSON(S):null),M=L.residents?.map(S=>this.objectToBoundingSphere(S));
L=L.terminals?.map(S=>this.objectToBoundingSphere(S));return{children:F,residents:M,terminals:L}}static fromJSON(L){const F=new w(M=>M,{maximumDepth:L.maximumDepth,maximumObjectsPerNode:L.maximumObjectsPerNode});F._objectCount=L.objectCount;F._root.initFrom(L.root.node,L.root.bounds,L.root.halfSize,L.root.depth);return F}}class p{constructor(){this.bounds=g.create();this.halfSize=0;this.initFrom(null,null,0,0)}init(L){return this.initFrom(L.node,L.bounds,L.halfSize,L.depth)}initFrom(L,F,M,S=this.depth){this.node=
null!=L?L:p.createEmptyNode();F&&g.copy(F,this.bounds);this.halfSize=M;this.depth=S;return this}increaseHalfSize(L){this.halfSize*=L;this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*u}advance(L){let F=this.node.children[L];F||(F=p.createEmptyNode(),this.node.children[L]=F);this.node=F;this.halfSize/=2;this.depth++;L=t[L];this.bounds[0]+=L[0]*this.halfSize;this.bounds[1]+=L[1]*this.halfSize;this.bounds[2]+=L[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();
return this}advanceTo(L,F,M=!1){for(;;){if(this.isTerminalFor(L))return F&&F(this,-1),!0;if(this.isLeaf()){if(!M)return F&&F(this,-1),!1;this.node.residents=null}const S=this._childIndex(L);F&&F(this,S);this.advance(S)}}isLeaf(){return null!=this.node.residents}isTerminalFor(L){return L[3]>this.halfSize/2}_childIndex(L){const F=this.bounds;return(F[0]<L[0]?1:0)+(F[1]<L[1]?2:0)+(F[2]<L[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new b({shrink:!0}),
residents:new b({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(L){p._pool.release(L)}static clearPool(){p._pool.prune()}}p._pool=new a(p);(function(L){L=L.DepthOrder||(L.DepthOrder={});L[L.FRONT_TO_BACK=1]="FRONT_TO_BACK";L[L.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(w||={});const t=[h.fromValues(-1,-1,-1),h.fromValues(1,-1,-1),h.fromValues(-1,1,-1),h.fromValues(1,1,-1),h.fromValues(-1,-1,1),h.fromValues(1,-1,1),h.fromValues(-1,1,1),h.fromValues(1,1,1)],q=[h.fromValues(-1,-1,-1),
h.fromValues(-1,-1,1),h.fromValues(-1,1,-1),h.fromValues(-1,1,1),h.fromValues(1,-1,-1),h.fromValues(1,-1,1),h.fromValues(1,1,-1),h.fromValues(1,1,1)],u=Math.sqrt(3),v=[null],y=g.create(),D=h.create(),G=h.create(),A=h.create(),C=new b,E=g.create(),I=g.create(),H=g.create(),J=g.create(),B=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z=new b,K=[0,0,0,0,0,0,0,0];return w})},"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var b=a.UpdatePolicy||
(a.UpdatePolicy={});b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){function C(da,aa,ea,ha,Y){for(let Z=0;Z<Y;Z++)ea[ha++]=da[aa++];return ha}var E;(function(da){da[da.LEFT_JOIN_START=-2]="LEFT_JOIN_START";da[da.LEFT_JOIN_END=-1]="LEFT_JOIN_END";da[da.LEFT_CAP_START=-4]="LEFT_CAP_START";da[da.LEFT_CAP_END=-5]="LEFT_CAP_END";da[da.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";da[da.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";da[da.RIGHT_CAP_START=4]="RIGHT_CAP_START";da[da.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(E||={});class I extends p.Material{constructor(da){super(da,
new J);this._configuration=new A.RibbonLineTechniqueConfiguration;this.produces=new Map([[t.RenderSlot.OPAQUE_MATERIAL,aa=>aa===x.ShaderOutput.Highlight||aa===x.ShaderOutput.ObjectAndLayerIdColor||(aa===x.ShaderOutput.Color||aa===x.ShaderOutput.Alpha)&&this.parameters.renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil],[t.RenderSlot.OPAQUE_NO_SSAO_DEPTH,aa=>aa===x.ShaderOutput.LinearDepth],[t.RenderSlot.OCCLUDER_MATERIAL,aa=>x.isColorAlphaHighlightOIDOrDepth(aa)&&this.parameters.renderOccluded===
p.RenderOccludedFlag.OccludeAndTransparentStencil],[t.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,aa=>x.isColorAlphaHighlightOIDOrDepth(aa)&&this.parameters.renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil],[t.RenderSlot.TRANSPARENT_MATERIAL,aa=>(aa===x.ShaderOutput.Color||aa===x.ShaderOutput.Alpha)&&this.parameters.writeDepth&&this.parameters.renderOccluded!==p.RenderOccludedFlag.OccludeAndTransparentStencil],[t.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,aa=>(aa===x.ShaderOutput.Color||
aa===x.ShaderOutput.Alpha)&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==p.RenderOccludedFlag.OccludeAndTransparentStencil],[t.RenderSlot.DRAPED_MATERIAL,aa=>x.is2DGeometryOutput(aa)]]);this._vertexAttributeLocations=G.vertexAttributeLocations}getConfiguration(da,aa){this._configuration.output=da;this._configuration.draped=aa.slot===t.RenderSlot.DRAPED_MATERIAL;da=null!=this.parameters.stipplePattern&&da!==x.ShaderOutput.Highlight;this._configuration.stippleEnabled=da;this._configuration.stippleOffColorEnabled=
da&&null!=this.parameters.stippleOffColor;this._configuration.stipplePreferContinuous=da&&this.parameters.stipplePreferContinuous;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;da=this._configuration;if(null!=this.parameters.markerParameters){var ea=this.parameters.markerParameters;ea=ea.anchor===y.LineMarkerAnchor.Tip&&
ea.hideOnShortSegments&&"begin-end"===ea.placement&&ea.worldSpace}else ea=!1;da.applyMarkerOffset=ea;this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&null!=this.parameters.innerColor;this._configuration.falloffEnabled=
0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===p.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=aa.transparencyPassType;this._configuration.multipassEnabled=aa.multipassEnabled;this._configuration.cullAboveGround=aa.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration}intersectDraped(da,aa,ea,ha,Y,Z){if(ea.options.selectionMode){aa=da.attributes.get(u.VertexAttribute.POSITION).data;
ea=da.attributes.get(u.VertexAttribute.SIZE);var ja=this.parameters.width;this.parameters.vvSize?(ea=da.attributes.get(u.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],ja*=h.clamp(this.parameters.vvSize.offset[0]+ea*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ea&&(ja*=ea.data[0]);ea=ha[0];ha=ha[1];da=(ja/2+4)*da.screenToWorldRatio;ja=Number.MAX_VALUE;var oa=0;for(let ma=0;ma<aa.length-5;ma+=3){var qa=aa[ma],ta=aa[ma+1],va=ea-qa,Ca=ha-ta;qa=
aa[ma+3]-qa;ta=aa[ma+4]-ta;const wa=h.clamp((qa*va+ta*Ca)/(qa*qa+ta*ta),0,1);va=qa*wa-va;Ca=ta*wa-Ca;Ca=va*va+Ca*Ca;Ca<ja&&(ja=Ca,oa=ma/3)}ja<da*da&&Y(Z.dist,Z.normal,oa,!1)}}intersect(da,aa,ea,ha,Y,Z){if(ea.options.selectionMode&&da.visible)if(q.isTranslationMatrix(aa)){var ja=da.attributes;ha=ja.get(u.VertexAttribute.POSITION).data;da=this.parameters.width;this.parameters.vvSize?(Y=ja.get(u.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],da*=h.clamp(this.parameters.vvSize.offset[0]+Y*this.parameters.vvSize.factor[0],
this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])):ja.has(u.VertexAttribute.SIZE)&&(da*=ja.get(u.VertexAttribute.SIZE).data[0]);var oa=ea.camera,qa=M;m.copy(qa,ea.point);Y=da*oa.pixelRatio/2+4*oa.pixelRatio;g.set(W[0],qa[0]-Y,qa[1]+Y,0);g.set(W[1],qa[0]+Y,qa[1]+Y,0);g.set(W[2],qa[0]+Y,qa[1]-Y,0);g.set(W[3],qa[0]-Y,qa[1]-Y,0);for(da=0;4>da;da++)if(!oa.unprojectFromRenderScreen(W[da],ca[da]))return;f.fromPoints(oa.eye,ca[0],ca[1],X);f.fromPoints(oa.eye,ca[1],ca[2],ba);f.fromPoints(oa.eye,
ca[2],ca[3],ia);f.fromPoints(oa.eye,ca[3],ca[0],fa);var ta=Number.MAX_VALUE;da=0;ja=this.parameters.isClosed&&2<ja.get(u.VertexAttribute.POSITION).indices.length?ha.length-2:ha.length-5;for(let Ca=0;Ca<ja;Ca+=3){z[0]=ha[Ca]+aa[12];z[1]=ha[Ca+1]+aa[13];z[2]=ha[Ca+2]+aa[14];var va=(Ca+3)%ha.length;K[0]=ha[va]+aa[12];K[1]=ha[va+1]+aa[13];K[2]=ha[va+2]+aa[14];if(!(0>f.signedDistance(X,z)&&0>f.signedDistance(X,K)||0>f.signedDistance(ba,z)&&0>f.signedDistance(ba,K)||0>f.signedDistance(ia,z)&&0>f.signedDistance(ia,
K)||0>f.signedDistance(fa,z)&&0>f.signedDistance(fa,K))){oa.projectToRenderScreen(z,S);oa.projectToRenderScreen(K,N);if(0>S[2]&&0<N[2])g.subtract(L,z,K),va=oa.frustum,va=-f.signedDistance(va[c.PlaneIndex.NEAR],z)/g.dot(L,f.getNormal(va[c.PlaneIndex.NEAR])),g.scale(L,L,va),g.add(z,z,L),oa.projectToRenderScreen(z,S);else if(0<S[2]&&0>N[2])g.subtract(L,K,z),va=oa.frustum,va=-f.signedDistance(va[c.PlaneIndex.NEAR],K)/g.dot(L,f.getNormal(va[c.PlaneIndex.NEAR])),g.scale(L,L,va),g.add(K,K,L),oa.projectToRenderScreen(K,
N);else if(0>S[2]&&0>N[2])continue;S[2]=0;N[2]=0;va=l.distance2(l.fromPoints(S,N,O),qa);va<ta&&(ta=va,g.copy(P,z),g.copy(R,K),da=Ca/3)}}aa=ea.rayBegin;ea=ea.rayEnd;ta<Y*Y&&(ha=Number.MAX_VALUE,l.closestLineSegmentPoint(l.fromPoints(P,R,O),l.fromPoints(aa,ea,T),F)&&(g.subtract(F,F,aa),ha=g.length(F),g.scale(F,F,1/ha),ha/=g.distance(aa,ea)),Z(ha,F,da,!1))}else n.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}get _layout(){const da=
r.newLayout().vec3f(u.VertexAttribute.POSITION).vec3f(u.VertexAttribute.PREVPOSITION).vec3f(u.VertexAttribute.NEXTPOSITION).f32(u.VertexAttribute.SUBDIVISIONFACTOR).vec2f(u.VertexAttribute.UV0);this.parameters.vvSize?da.f32(u.VertexAttribute.SIZEFEATUREATTRIBUTE):da.f32(u.VertexAttribute.SIZE);this.parameters.vvColor?da.f32(u.VertexAttribute.COLORFEATUREATTRIBUTE):da.vec4f(u.VertexAttribute.COLOR);this.parameters.vvOpacity&&da.f32(u.VertexAttribute.OPACITYFEATUREATTRIBUTE);b("enable-feature:objectAndLayerId-rendering")&&
da.vec4u8(u.VertexAttribute.OBJECTANDLAYERIDCOLOR);return da}createBufferWriter(){return new B(this._layout,this.parameters)}createGLMaterial(da){return new H(da)}validateParameters(da){"miter"!==da.join&&(da.miterLimit=0);null!=da.markerParameters&&(da.markerScale=da.markerParameters.width/da.width)}}class H extends w{constructor(){super(...arguments);this._stipplePattern=null}dispose(){super.dispose();this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null}_updateOccludeeState(da){da.hasOccludees!==
this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:da.hasOccludees})}beginSlot(da){this._output!==x.ShaderOutput.Color&&this._output!==x.ShaderOutput.Alpha||this._updateOccludeeState(da);const aa=this._material.parameters.stipplePattern;this._stipplePattern!==aa&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(aa,this._stipplePattern)}),this._stipplePattern=aa);return this.ensureTechnique(G.RibbonLineTechnique,da)}}class J extends v.VisualVariablePassParameters{constructor(){super(...arguments);
this.width=0;this.color=d.ONES;this.join="miter";this.cap=A.CapType.BUTT;this.miterLimit=5;this.writeDepth=!0;this.hasPolygonOffset=!1;this.stippleTexture=null;this.stipplePreferContinuous=!0;this.markerParameters=null;this.markerScale=1;this.isClosed=this.vvFastUpdate=this.hasSlicePlane=!1;this.innerWidth=this.falloff=0;this.wireframe=this.hasOccludees=!1}}class B{constructor(da,aa){this.vertexBufferLayout=da;this._parameters=aa;this.numJoinSubdivisions=0;da=aa.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=
da;break;case "round":this.numJoinSubdivisions=D.ribbonlineNumRoundJoinSubdivisions+da}}_isClosed(da){return this._parameters.isClosed?2<da.attributes.get(u.VertexAttribute.POSITION).indices.length:!1}allocate(da){return this.vertexBufferLayout.createBuffer(da)}elementCount(da){var aa=da.attributes.get(u.VertexAttribute.POSITION).indices.length/2+1;da=this._isClosed(da);aa=(da?2:4)+((da?aa:aa-1)-(da?0:1))*(2*this.numJoinSubdivisions+4);aa+=2;this._parameters.wireframe&&(aa=2+4*(aa-2));return aa}write(da,
aa,ea,ha,Y){aa=Q;const Z=V,ja=U,oa=ea.attributes.get(u.VertexAttribute.POSITION);var qa=oa.indices;const ta=oa.data.length/3,va=ea.attributes.get(u.VertexAttribute.DISTANCETOSTART)?.data;qa&&qa.length!==2*(ta-1)&&console.warn("RibbonLineMaterial does not support indices");const Ca=ea.attributes.get(u.VertexAttribute.SIZEFEATUREATTRIBUTE)?.data[0]??ea.attributes.get(u.VertexAttribute.SIZE)?.data[0]??1;let ma=[1,1,1,1],wa=0;const Ba=this.vertexBufferLayout.fields.has(u.VertexAttribute.COLORFEATUREATTRIBUTE);
Ba?wa=ea.attributes.get(u.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ea.attributes.has(u.VertexAttribute.COLOR)&&(ma=ea.attributes.get(u.VertexAttribute.COLOR).data);const pa=b("enable-feature:objectAndLayerId-rendering")?ea.objectAndLayerIdColor:null,Aa=this.vertexBufferLayout.fields.has(u.VertexAttribute.OPACITYFEATUREATTRIBUTE),ra=Aa?ea.attributes.get(u.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]:0,ua=new Float32Array(ha.buffer),Ea=b("enable-feature:objectAndLayerId-rendering")?new Uint8Array(ha.buffer):
null;qa=this.vertexBufferLayout.stride/4;let Ka=Y*qa;Y=Ka;let Ma=0;const Ua=va?(bb,gb,cb)=>Ma=va[cb]:(bb,gb,cb)=>Ma+=g.distance(bb,gb),Ga=b("enable-feature:objectAndLayerId-rendering"),Na=(bb,gb,cb,ka,mb,qb,tb)=>{ua[Ka++]=gb[0];ua[Ka++]=gb[1];ua[Ka++]=gb[2];ua[Ka++]=bb[0];ua[Ka++]=bb[1];ua[Ka++]=bb[2];ua[Ka++]=cb[0];ua[Ka++]=cb[1];ua[Ka++]=cb[2];ua[Ka++]=ka;ua[Ka++]=tb;ua[Ka++]=mb;ua[Ka++]=Ca;Ba?ua[Ka++]=wa:(bb=Math.min(4*qb,ma.length-4),ua[Ka++]=ma[bb],ua[Ka++]=ma[bb+1],ua[Ka++]=ma[bb+2],ua[Ka++]=
ma[bb+3]);Aa&&(ua[Ka++]=ra);Ga&&(null!=pa&&(Ea[4*Ka]=pa[0],Ea[4*Ka+1]=pa[1],Ea[4*Ka+2]=pa[2],Ea[4*Ka+3]=pa[3]),Ka++)};Ka+=qa;g.set(Z,oa.data[0],oa.data[1],oa.data[2]);da&&g.transformMat4(Z,Z,da);if(ea=this._isClosed(ea)){var Va=oa.data.length-3;g.set(aa,oa.data[Va],oa.data[Va+1],oa.data[Va+2]);da&&g.transformMat4(aa,aa,da)}else g.set(ja,oa.data[3],oa.data[4],oa.data[5]),da&&g.transformMat4(ja,ja,da),Na(Z,Z,ja,1,E.LEFT_CAP_START,0,0),Na(Z,Z,ja,1,E.RIGHT_CAP_START,0,0),g.copy(aa,Z),g.copy(Z,ja);Va=
ea?0:1;const Xa=ea?ta:ta-1;for(let bb=Va;bb<Xa;bb++){var Pa=(bb+1)%ta*3;g.set(ja,oa.data[Pa],oa.data[Pa+1],oa.data[Pa+2]);da&&g.transformMat4(ja,ja,da);Ua(aa,Z,bb);Na(aa,Z,ja,0,E.LEFT_JOIN_END,bb,Ma);Na(aa,Z,ja,0,E.RIGHT_JOIN_END,bb,Ma);Pa=this.numJoinSubdivisions;for(let gb=0;gb<Pa;++gb){const cb=(gb+1)/(Pa+1);Na(aa,Z,ja,cb,E.LEFT_JOIN_END,bb,Ma);Na(aa,Z,ja,cb,E.RIGHT_JOIN_END,bb,Ma)}Na(aa,Z,ja,1,E.LEFT_JOIN_START,bb,Ma);Na(aa,Z,ja,1,E.RIGHT_JOIN_START,bb,Ma);g.copy(aa,Z);g.copy(Z,ja)}ea?(g.set(ja,
oa.data[3],oa.data[4],oa.data[5]),da&&g.transformMat4(ja,ja,da),Ma=Ua(aa,Z,Xa),Na(aa,Z,ja,0,E.LEFT_JOIN_END,Va,Ma),Na(aa,Z,ja,0,E.RIGHT_JOIN_END,Va,Ma)):(Ma=Ua(aa,Z,Xa),Na(aa,Z,Z,0,E.LEFT_CAP_END,Xa,Ma),Na(aa,Z,Z,0,E.RIGHT_CAP_END,Xa,Ma));C(ua,Y+qa,ua,Y,qa);Ka=C(ua,Ka-qa,ua,Ka,qa);this._parameters.wireframe&&this._addWireframeVertices(ha,Y,Ka,qa)}_addWireframeVertices(da,aa,ea,ha){const Y=new Float32Array(da.buffer,ea*Float32Array.BYTES_PER_ELEMENT);da=new Float32Array(da.buffer,aa*Float32Array.BYTES_PER_ELEMENT,
ea-aa);aa=0;for(ea=0;ea<da.length-1;ea+=2*ha)aa=C(da,ea,Y,aa,ha),aa=C(da,ea+2*ha,Y,aa,ha),aa=C(da,ea+1*ha,Y,aa,ha),aa=C(da,ea+2*ha,Y,aa,ha),aa=C(da,ea+1*ha,Y,aa,ha),aa=C(da,ea+3*ha,Y,aa,ha)}}const z=e.create(),K=e.create(),L=e.create(),F=e.create(),M=e.create(),S=k.createRenderScreenPointArray3(),N=k.createRenderScreenPointArray3(),P=e.create(),R=e.create(),O=l.create(),T=l.create(),Q=e.create(),V=e.create(),U=e.create(),W=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),
k.createRenderScreenPointArray3()],ca=[e.create(),e.create(),e.create(),e.create()],X=f.create(),ba=f.create(),ia=f.create(),fa=f.create();a.Parameters=J;a.RibbonLineMaterial=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m){a.LineMarkerSpace=void 0;(function(e){e[e.Draped=0]="Draped";e[e.Screen=1]="Screen";e[e.World=2]="World";e[e.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(e){e[e.Center=0]="Center";e[e.Tip=1]="Tip";e[e.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));class g extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.transparencyPassType=k.TransparencyPassType.NONE;
this.writeDepth=this.hasSlicePlane=this.occluder=!1;this.space=a.LineMarkerSpace.Screen;this.hasCap=this.hideOnShortSegments=!1;this.anchor=a.LineMarkerAnchor.Center;this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.vvOpacity=this.vvColor=this.vvSize=this.hasTip=!1}get draped(){return this.space===a.LineMarkerSpace.Draped}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],g.prototype,"output",void 0);b.__decorate([h.parameter({count:k.TransparencyPassType.COUNT})],g.prototype,
"transparencyPassType",void 0);b.__decorate([h.parameter()],g.prototype,"occluder",void 0);b.__decorate([h.parameter()],g.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],g.prototype,"writeDepth",void 0);b.__decorate([h.parameter({count:a.LineMarkerSpace.COUNT})],g.prototype,"space",void 0);b.__decorate([h.parameter()],g.prototype,"hideOnShortSegments",void 0);b.__decorate([h.parameter()],g.prototype,"hasCap",void 0);b.__decorate([h.parameter({count:a.LineMarkerAnchor.COUNT})],g.prototype,
"anchor",void 0);b.__decorate([h.parameter()],g.prototype,"hasTip",void 0);b.__decorate([h.parameter()],g.prototype,"vvSize",void 0);b.__decorate([h.parameter()],g.prototype,"vvColor",void 0);b.__decorate([h.parameter()],g.prototype,"vvOpacity",void 0);b.__decorate([h.parameter()],g.prototype,"hasOccludees",void 0);b.__decorate([h.parameter()],g.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter({constValue:!1})],g.prototype,
"occlusionPass",void 0);b.__decorate([h.parameter({constValue:!0})],g.prototype,"hasVvInstancing",void 0);b.__decorate([h.parameter({constValue:!0})],g.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){function C(I){const H=new v.ShaderBuilder,{attributes:J,varyings:B,constants:z,vertex:K,fragment:L}=H;H.include(l.PiUtils);H.include(m.RibbonVertexPosition,I);H.include(e.LineStipple,I);const F=I.applyMarkerOffset&&!I.draped;F&&(K.uniforms.add(new t.FloatPassUniform("markerScale",O=>O.markerScale)),H.include(d.MarkerSizing,{space:G.LineMarkerSpace.World,draped:!1}));I.output===n.ShaderOutput.LinearDepth&&H.include(g.OutputDepth,I);H.include(k.ObjectAndLayerIdColor,
I);x.addProjViewLocalOrigin(K,I);K.uniforms.add(new u.Matrix4PassUniform("inverseProjectionMatrix",(O,T)=>T.camera.inverseProjectionMatrix),new w.Float2PassUniform("nearFar",(O,T)=>T.camera.nearFar),new t.FloatPassUniform("miterLimit",O=>"miter"!==O.join?0:O.miterLimit),new p.Float4PassUniform("viewport",(O,T)=>T.camera.fullViewport));K.constants.add("LARGE_HALF_FLOAT","float",65500);J.add(D.VertexAttribute.POSITION,"vec3");J.add(D.VertexAttribute.PREVPOSITION,"vec3");J.add(D.VertexAttribute.NEXTPOSITION,
"vec3");J.add(D.VertexAttribute.SUBDIVISIONFACTOR,"float");J.add(D.VertexAttribute.UV0,"vec2");B.add("vColor","vec4");B.add("vpos","vec3");B.add("vLineDistance","float");B.add("vLineWidth","float");b.addLinearDepth(H);const M=I.multipassEnabled&&(I.output===n.ShaderOutput.Color||I.output===n.ShaderOutput.Alpha);M&&B.add("depth","float");const S=I.stippleEnabled;S&&B.add("vLineSizeInv","float");z.add("aaWidth","float",I.stippleEnabled?0:1);const N=I.capType===A.CapType.ROUND,P=I.stippleEnabled&&N,
R=I.falloffEnabled||P;R&&B.add("vLineDistanceNorm","float");N&&(B.add("vSegmentSDF","float"),B.add("vReverseSegmentSDF","float"));K.code.add(q.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);K.code.add(q.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);b.addCalculateLinearDepth(H);K.code.add(q.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${M?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);x.addPixelRatio(K);K.code.add(q.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;
      float lineSize = getSize();

      if (lineSize < 1.0) {
        coverage = lineSize; // convert sub-pixel coverage to alpha
        lineSize = 1.0;
      }
      lineSize += aaWidth;

      float lineWidth = lineSize * pixelRatio;
      vLineWidth = lineWidth;
      ${S?q.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      vec4 pos  = view * vec4(position, 1.0);
      vec4 prev = view * vec4(prevPosition, 1.0);
      vec4 next = view * vec4(nextPosition, 1.0);
  `);F&&K.code.add(q.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);K.code.add(q.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(I.stippleEnabled||N)&&K.code.add(q.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${N?q.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);K.code.add(q.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);I.roundJoins?K.code.add(q.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${I.stippleEnabled?q.glsl`min(1.0, subdivisionFactor * ${q.glsl.float(1.5)})`:q.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):K.code.add(q.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);K.code.add(q.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${I.capType!==A.CapType.BUTT?q.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);K.code.add(q.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;
    float lineDistNorm = sign(uv0.y) * pos.w;

    vLineDistance =  lineWidth * lineDistNorm;
    ${R?q.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);N&&K.code.add(q.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);I.stippleEnabled&&(I.draped?K.uniforms.add(new t.FloatPassUniform("worldToScreenRatio",(O,T)=>1/T.screenToPCSRatio)):K.code.add(q.glsl`vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),K.code.add(q.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),I.draped?K.code.add(q.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):K.code.add(q.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),K.uniforms.add(new t.FloatPassUniform("stipplePatternPixelSize",O=>e.computePixelSize(O))),K.code.add(q.glsl`float patternLength = lineSize * stipplePatternPixelSize;
vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);
vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);
if (segmentLengthScreenDouble >= 0.001) {
vec2 stippleDisplacement = pos.xy - segmentOrigin;
float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);
vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
}
vStippleDistanceLimits *= pos.w;
vStippleDistance *= pos.w;
vStippleDistanceLimits = isJoin ?
vStippleDistanceLimits :
isStartVertex ?
vec2(-1e34, vStippleDistanceLimits.y) :
vec2(vStippleDistanceLimits.x, 1e34);`));K.code.add(q.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${I.wireframe&&!I.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);M&&H.include(c.multipassTerrainTest,I);H.include(h.SliceDraw,I);L.include(r.ColorConversion);L.code.add(q.glsl`
  void main() {
    discardBySlice(vpos);
    ${M?"terrainDepthTest(depth);":""}
  `);I.wireframe?L.code.add(q.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(N&&L.code.add(q.glsl`
        float sdf = min(vSegmentSDF, vReverseSegmentSDF);
        vec2 fragmentPosition = vec2(
          min(sdf, 0.0),
          vLineDistance
        ) * gl_FragCoord.w;

        float fragmentRadius = length(fragmentPosition);
        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

        if (capCoverage < ${q.glsl.float(f.symbolAlphaCutoff)}) {
          discard;
        }
      `),P?L.code.add(q.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${q.glsl.float(f.symbolAlphaCutoff)}, stippleCoverage);
      `):L.code.add(q.glsl`float stippleAlpha = getStippleAlpha();`),I.output!==n.ShaderOutput.ObjectAndLayerIdColor&&L.code.add(q.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),L.uniforms.add(new p.Float4PassUniform("intrinsicColor",O=>O.color)),L.code.add(q.glsl`vec4 color = intrinsicColor * vColor;`),I.innerColorEnabled&&(L.uniforms.add(new p.Float4PassUniform("innerColor",O=>O.innerColor??O.color),new t.FloatPassUniform("innerWidth",(O,T)=>O.innerWidth*T.camera.pixelRatio)),
L.code.add(q.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),L.code.add(q.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),I.falloffEnabled&&(L.uniforms.add(new t.FloatPassUniform("falloff",O=>O.falloff)),L.code.add(q.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),I.stippleEnabled||L.code.add(q.glsl`float featherStartDistance = max(vLineWidth - 2.0, 0.0);
float value = abs(vLineDistance) * gl_FragCoord.w;
float feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);
finalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);`));L.code.add(q.glsl`
    ${I.output===n.ShaderOutput.ObjectAndLayerIdColor?q.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${q.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${I.output===n.ShaderOutput.Alpha?q.glsl`fragColor = vec4(finalColor.a);`:""}
    ${I.output===n.ShaderOutput.Color?q.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${I.output===n.ShaderOutput.Color&&I.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${I.output===n.ShaderOutput.Highlight?q.glsl`fragColor = vec4(1.0);`:""}
    ${I.output===n.ShaderOutput.LinearDepth?q.glsl`outputDepth(linearDepth);`:""}
    ${I.output===n.ShaderOutput.ObjectAndLayerIdColor?q.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return H}const E=Object.freeze(Object.defineProperty({__proto__:null,build:C,ribbonlineNumRoundJoinSubdivisions:1},Symbol.toStringTag,{value:"Module"}));a.RibbonLine=E;a.build=C;a.ribbonlineNumRoundJoinSubdivisions=1})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../shading/VisualVariables.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g){a.RibbonVertexPosition=function(e,d){const c=e.vertex;c.uniforms.add(new h.FloatPassUniform("intrinsicWidth",l=>l.width));d.vvSize?(e.attributes.add(g.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),c.uniforms.add(new n.Float3PassUniform("vvSizeMinSize",l=>l.vvSize.minSize),new n.Float3PassUniform("vvSizeMaxSize",l=>l.vvSize.maxSize),new n.Float3PassUniform("vvSizeOffset",l=>l.vvSize.offset),new n.Float3PassUniform("vvSizeFactor",l=>l.vvSize.factor)),c.code.add(m.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(g.VertexAttribute.SIZE,"float"),c.code.add(m.glsl`float getSize(){
return intrinsicWidth * size;
}`));d.vvOpacity?(e.attributes.add(g.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),c.constants.add("vvOpacityNumber","int",8),c.uniforms.add(new k.FloatsPassUniform("vvOpacityValues",l=>l.vvOpacity.values,8),new k.FloatsPassUniform("vvOpacityOpacities",l=>l.vvOpacity.opacityValues,8)),c.code.add(m.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):c.code.add(m.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);d.vvColor?(e.include(b.VisualVariables,d),e.attributes.add(g.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),c.code.add(m.glsl`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(e.attributes.add(g.VertexAttribute.COLOR,"vec4"),c.code.add(m.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../materials/stippleTextureRepository ../../../shaders/ensureColor4".split(" "),function(a,b,n,h,k,m,g,e,d){function c(r,x){const w=
!(x.draped&&x.stipplePreferContinuous),{vertex:p,fragment:t}=r;t.include(b.RgbaFloatEncoding);x.draped||(n.addCameraPosition(p,x),p.uniforms.add(new k.FloatPassUniform("worldToScreenPerDistanceRatio",(q,u)=>1/u.camera.perScreenPixelRatio)),p.code.add(m.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));r.varyings.add("vStippleDistance","float");r.varyings.add("vStippleDistanceLimits","vec2");r.varyings.add("vStipplePatternStretch","float");p.code.add(m.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${f};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);p.code.add(m.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);p.code.add(m.glsl`
    if (segmentLengthPseudoScreen >= ${w?"patternLength":"1e4"}) {
  `);n.addPixelRatio(p);p.code.add(m.glsl`float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
float segmentLengthScreenRounded = flooredRepetitions * patternLength;
float stretch = repetitions / flooredRepetitions;
vStipplePatternStretch = max(0.75, stretch);
return vec2(0.0, segmentLengthScreenRounded);
}
return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
}`);t.uniforms.add(new g.Texture2DPassUniform("stipplePatternTexture",q=>q.stippleTexture),new k.FloatPassUniform("stipplePatternSDFNormalizer",q=>(q=q.stipplePattern)?(Math.floor(.5*(e.computeLongestPattern(q)-1))+.5)/q.pixelRatio:1),new k.FloatPassUniform("stipplePatternPixelSizeInv",q=>1/l(q)));t.code.add(m.glsl`float getStippleSDF(out bool isClamped) {
float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;
float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;
u = fract(u);
float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;
return (sdf - 0.5) * vStipplePatternStretch + 0.5;
}
float getStippleSDF() {
bool ignored;
return getStippleSDF(ignored);
}
float getStippleAlpha() {
bool isClamped;
float stippleSDF = getStippleSDF(isClamped);
float antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);
return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
}`);x.stippleOffColorEnabled?(t.uniforms.add(new h.Float4PassUniform("stippleOffColor",q=>d.ensureColor4(q.stippleOffColor))),t.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):t.code.add(m.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function l(r){const x=r.stipplePattern;return x?e.computeTextureSize(r.stipplePattern)/x.pixelRatio:1}const f=m.glsl.float(.4);a.LineStipple=function(r,x){r.constants.add("stippleAlphaColorDiscard","float",.001);r.constants.add("stippleAlphaHighlightDiscard","float",.5);x.stippleEnabled?c(r,x):r.fragment.code.add(m.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/stippleTextureRepository":function(){define("exports ../../../../core/floatRGBA ./ProceduralTextureRepository ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),function(a,b,n,h,k,m){function g(c){return c.pattern.map(l=>Math.round(l*c.pixelRatio))}function e(c){if(null==c)return 1;c=g(c);
return Math.floor(c.reduce((l,f)=>l+f))}function d(c){return g(c).reduce((l,f)=>Math.max(l,f))}a.computeLongestPattern=d;a.computeTextureSize=e;a.createStippleTextureRepository=function(c,l){return new n.ProceduralTextureRepository(f=>{var r=g(f),x=1/f.pixelRatio,w=e(f);f=d(f);const p=(Math.floor(.5*(f-1))+.5)*x;f=[];let t=1;for(var q of r){for(let y=0;y<q;y++)f.push(t*(Math.min(y,q-1-y)+.5)*x/p*.5+.5);t=-t}r=Math.round(r[0]/2);r=[...f.slice(r),...f.slice(0,r)];x=new Uint8Array(4*w);q=0;for(const y of r)b.packFloatRGBA(y,
x,q),q+=4;const {encodedData:u,textureSize:v}={encodedData:x,textureSize:w};w=new m.TextureDescriptor;w.internalFormat=h.PixelFormat.RGBA;w.width=v;w.height=1;w.wrapMode=h.TextureWrapMode.REPEAT;return new k.Texture(c,w,u)},f=>`${f.pattern.join(",")}-r${f.pixelRatio}`,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function n(g,e=0){let d=0;for(let c=0;4>c;c++)d+=g[e+c]*k[c];return d}const h=[1,256,
65536,16777216],k=[1/256,1/65536,1/16777216,1/4294967296],m=n(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(g,e,d=0){g=b.clamp(g,0,m);for(let f=0;4>f;f++){var c=Math,l=g*h[f];e[d+f]=c.floor.call(c,256*(l-Math.floor(l)))}};a.unpackFloatRGBA=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ProceduralTextureRepository":function(){define(["exports","../../../../core/uid"],function(a,b){class n{constructor(k,m,g){this._createTexture=
k;this._parametersKey=m;this._repository=new Map;this._orphanCache=g.newCache(`procedural-texture-repository:${b.generateUID()}`,e=>e.dispose())}destroy(){for(const [,{texture:k}]of this._repository)k.dispose();this._repository.clear();this._orphanCache.destroy()}swap(k,m=null){k=this._acquire(k);this.release(m);return k}release(k){if(null!=k){k=this._parametersKey(k);var m=this._repository.get(k);m&&(m.refCount--,0===m.refCount&&(this._repository.delete(k),{texture:m}=m,this._orphanCache.put(k,m,
m.usedMemory)))}}_acquire(k){if(null==k)return null;const m=this._parametersKey(k);var g=this._repository.get(m);if(g)return g.refCount++,g.texture;k=this._orphanCache.pop(m)??this._createTexture(k);g=new h(k);this._repository.set(m,g);return k}}class h{constructor(k){this.texture=k;this.refCount=1}}a.ProceduralTextureRepository=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../chunks/vec42",
"../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,n){const h=n.create();a.ensureColor4=function(k){return null==k?n.ZEROS:4===k.length?k:b.set(h,k[0],k[1],k[2],1)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../support/engineContent/marker ../util/View.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m){a.MarkerSizing=function(g,e){const {vertex:d,constants:c}=g;c.add("markerSizePerLineWidth","float",b.markerSizePerLineWidth);n.addPixelRatio(d);null==d.uniforms.get("markerScale")&&d.constants.add("markerScale","float",1);d.code.add(k.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);e.space===m.LineMarkerSpace.World&&(d.constants.add("maxSegmentLengthFraction","float",.45),d.uniforms.add(new h.FloatPassUniform("perRenderPixelRatio",(l,f)=>f.camera.perRenderPixelRatio)),d.code.add(k.glsl`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(a,b,n,h,k){a.createMarkerTexture=function(m,g){m=b.createPrimitive(m,64,32,6.4);const e=new k.TextureDescriptor;e.internalFormat=n.PixelFormat.RGBA;e.width=64;e.height=64;e.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;return new h.Texture(g,e,m)};a.markerSizePerLineWidth=
10;a.markerSymbolSize=32;a.markerTextureSize=64;a.markerThickness=6.4;a.markerTipThicknessFactor=.25;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,n,h,k){function m(u,v=128,y=.5*v,D=0){switch(u){case "circle":return g(v,y);case "square":return e(v,y);case "cross":return c(v,y,D);
case "x":return l(v,y,D);case "kite":return d(v,y);case "triangle":return f(v,y);case "arrow":return r(v,y);default:return g(v,y)}}function g(u,v){const y=u/2-.5;return q(u,p(y,y,v/2))}function e(u,v){return x(u,v,!1)}function d(u,v){return x(u,v,!0)}function c(u,v,y=0){return w(u,v,!1,y)}function l(u,v,y=0){return w(u,v,!0,y)}function f(u,v){return q(u,t(u/2,v,v/2))}function r(u,v){const y=v/2,D=u/2,G=.8*v,A=p(D,(u-v)/2-G,Math.sqrt(G*G+y*y)),C=t(D,v,y);return q(u,(E,I)=>Math.max(C(E,I),-A(E,I)))}
function x(u,v,y){y&&(v/=Math.SQRT2);return q(u,(D,G)=>{D=D-.5*u+.25;G=-G+.5*u-.75;if(y){const A=(D+G)/Math.SQRT2;G=(G-D)/Math.SQRT2;D=A}return Math.max(Math.abs(D),Math.abs(G))-.5*v})}function w(u,v,y,D=0){v-=D;y&&(v*=Math.SQRT2);const G=.5*v;return q(u,(A,C)=>{A-=.5*u;C=-C+.5*u-1;if(y){const E=(A+C)/Math.SQRT2;C=(C-A)/Math.SQRT2;A=E}A=Math.abs(A);C=Math.abs(C);A=A>C?A>G?Math.sqrt((A-G)*(A-G)+C*C):C:C>G?Math.sqrt(A*A+(C-G)*(C-G)):A;return A-=D/2})}function p(u,v,y){return(D,G)=>{D-=u;G-=v;return Math.sqrt(D*
D+G*G)-y}}function t(u,v,y){const D=Math.sqrt(v*v+y*y);return(G,A)=>{A=A-u+v/2+.75;return Math.max((v*(Math.abs(G-u)-y)+y*A)/D,-A)}}function q(u,v){const y=new Uint8Array(4*u*u);for(let D=0;D<u;D++)for(let G=0;G<u;G++){const A=G+u*D;let C=v(G,D);C=C/u+.5;n.packFloatRGBA(C,y,4*A)}return y}a.createArrow=r;a.createCircle=g;a.createCross=c;a.createKite=d;a.createPrimitive=m;a.createSquare=e;a.createTexture=function(u,v=128,y=.5*v,D=0){u=m(u,v,y,D);return new h.Texture(u,{mipmap:!1,wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,
t:k.TextureWrapMode.CLAMP_TO_EDGE},width:v,height:v,components:4,noUnpackFlip:!0,reloadable:!0})};a.createTriangle=f;a.createX=l;a.defaultSymbolSizeRatio=.5;a.defaultTexSize=128;a.requiresHalfTexelOffset=function(u){return"cross"===u||"x"===u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/Evented ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(C){return C instanceof HTMLVideoElement?{width:C.videoWidth,height:C.videoHeight}:C}class D extends r.ContentObject{get parameters(){return this._parameters}constructor(C,E){super();this._data=C;this.type=x.ContentObjectType.Texture;this._loadingController=this._loadingPromise=this._glTexture=null;this.events=new h;this._parameters={...A,...E};this._startPreload(C)}dispose(){this.unload();this._data=this.frameUpdate=void 0}_startPreload(C){null!=
C&&(C instanceof HTMLVideoElement?(this.frameUpdate=E=>this._frameUpdate(C,E),this._startPreloadVideoElement(C)):C instanceof HTMLImageElement&&this._startPreloadImageElement(C))}_startPreloadVideoElement(C){if(!(e.isBlobProtocol(C.src)||"auto"===C.preload&&C.crossOrigin)){C.preload="auto";C.crossOrigin="anonymous";const E=!C.paused;C.src=C.src;if(E&&C.autoplay){const I=()=>{C.removeEventListener("canplay",I);C.play()};C.addEventListener("canplay",I)}}}_startPreloadImageElement(C){e.isDataProtocol(C.src)||
e.isBlobProtocol(C.src)||C.crossOrigin||(C.crossOrigin="anonymous",C.src=C.src)}_createDescriptor(C){const E=new v.TextureDescriptor;E.wrapMode=this._parameters.wrap??q.TextureWrapMode.REPEAT;E.flipped=!this._parameters.noUnpackFlip;E.samplingMode=this._parameters.mipmap?q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:q.TextureSamplingMode.LINEAR;E.hasMipmap=!!this._parameters.mipmap;E.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha;E.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?
C.parameters.maxMaxAnisotropy:1);return E}get glTexture(){return this._glTexture}get memoryEstimate(){var C;if(!(C=this._glTexture?.usedMemory)){C=this._data;var E=this._parameters;if(null==C)C=0;else if(g.isArrayBuffer(C)||g.isUint8Array(C))C=E.encoding===l.TextureEncodingMimeType.KTX2_ENCODING?f.estimateMemoryKTX2(C,!!E.mipmap):E.encoding===l.TextureEncodingMimeType.BASIS_ENCODING?f.estimateMemoryBasis(C,!!E.mipmap):C.byteLength;else{var {width:I,height:H}=C instanceof Image||C instanceof ImageData||
C instanceof HTMLCanvasElement||C instanceof HTMLVideoElement?y(C):E;C=(E.mipmap?4/3:1)*I*H*(E.components||4)||0}}return C}load(C){if(this._glTexture)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const E=this._data;if(null==E)return this._glTexture=new u.Texture(C,this._createDescriptor(C),null);this._parameters.reloadable||(this._data=void 0);return"string"===typeof E?this._loadFromURL(C,E):E instanceof Image?this._loadFromImageElement(C,E):E instanceof HTMLVideoElement?
this._loadFromVideoElement(C,E):E instanceof ImageData||E instanceof HTMLCanvasElement?this._loadFromImage(C,E):(g.isArrayBuffer(E)||g.isUint8Array(E))&&this._parameters.encoding===l.TextureEncodingMimeType.DDS_ENCODING?this._loadFromDDSData(C,E):(g.isArrayBuffer(E)||g.isUint8Array(E))&&this._parameters.encoding===l.TextureEncodingMimeType.KTX2_ENCODING?this._loadFromKTX2(C,E):(g.isArrayBuffer(E)||g.isUint8Array(E))&&this._parameters.encoding===l.TextureEncodingMimeType.BASIS_ENCODING?this._loadFromBasis(C,
E):g.isUint8Array(E)?this._loadFromPixelData(C,E):g.isArrayBuffer(E)?this._loadFromPixelData(C,new Uint8Array(E)):null}_frameUpdate(C,E){if(null==this._glTexture||C.readyState<G.HAVE_CURRENT_DATA||E===C.currentTime)return E;this._glTexture.setData(C);this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this._parameters.updateCallback&&this._parameters.updateCallback();return C.currentTime}_loadFromDDSData(C,E){return this._glTexture=w.createDDSTexture(C,this._createDescriptor(C),
E)}_loadFromKTX2(C,E){return this._loadAsync(()=>f.createTextureKTX2(C,this._createDescriptor(C),E).then(I=>this._glTexture=I))}_loadFromBasis(C,E){return this._loadAsync(()=>f.createTextureBasis(C,this._createDescriptor(C),E).then(I=>this._glTexture=I))}_loadFromPixelData(C,E){t.assert(0<this._parameters.width&&0<this._parameters.height);const I=this._createDescriptor(C);I.pixelFormat=1===this._parameters.components?q.PixelFormat.LUMINANCE:3===this._parameters.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;
I.width=this._parameters.width??0;I.height=this._parameters.height??0;return this._glTexture=new u.Texture(C,I,E)}_loadFromURL(C,E){return this._loadAsync(async I=>{const H=await d.requestImage(E,{signal:I});m.throwIfAborted(I);return this._loadFromImage(C,H)})}_loadFromImageElement(C,E){return E.complete?this._loadFromImage(C,E):this._loadAsync(async I=>{const H=await c.loadImageAsync(E,E.src,!1,I);m.throwIfAborted(I);return this._loadFromImage(C,H)})}_loadFromVideoElement(C,E){return E.readyState>=
G.HAVE_CURRENT_DATA?this._loadFromImage(C,E):this._loadFromVideoElementAsync(C,E)}_loadFromVideoElementAsync(C,E){return this._loadAsync(I=>new Promise((H,J)=>{const B=()=>{E.removeEventListener("loadeddata",z);E.removeEventListener("error",K);k.removeMaybe(L)},z=()=>{E.readyState>=G.HAVE_CURRENT_DATA&&(B(),H(this._loadFromImage(C,E)))},K=F=>{B();J(F||new n("Failed to load video"))};E.addEventListener("loadeddata",z);E.addEventListener("error",K);const L=m.onAbort(I,()=>K(m.createAbortError()))}))}_loadFromImage(C,
E){if(!(E instanceof HTMLVideoElement)){var {maxTextureSize:I}=C.parameters;E=this._parameters.downsampleUncompressed?p.downsampleImage(E,I):p.ensureImageMaxSize(E,I)}I=y(E);this._parameters.width=I.width;this._parameters.height=I.height;const H=this._createDescriptor(C);H.pixelFormat=3===this._parameters.components?q.PixelFormat.RGB:q.PixelFormat.RGBA;H.width=I.width;H.height=I.height;return this._glTexture=new u.Texture(C,H,E)}_loadAsync(C){const E=new AbortController;this._loadingController=E;
const I=C(E.signal);this._loadingPromise=I;C=()=>{this._loadingController===E&&(this._loadingController=null);this._loadingPromise===I&&(this._loadingPromise=null)};I.then(C,C);return I}unload(){this._glTexture=k.disposeMaybe(this._glTexture);if(null!=this._loadingController){const C=this._loadingController;this._loadingPromise=this._loadingController=null;C.abort()}this.events.emit("unloaded")}}var G;(function(C){C[C.HAVE_NOTHING=0]="HAVE_NOTHING";C[C.HAVE_METADATA=1]="HAVE_METADATA";C[C.HAVE_CURRENT_DATA=
2]="HAVE_CURRENT_DATA";C[C.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";C[C.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(G||={});const A={wrap:{s:q.TextureWrapMode.REPEAT,t:q.TextureWrapMode.REPEAT},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1,downsampleUncompressed:!1};a.Texture=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(a,b){a.requestImage=async function(n,h){({data:n}=await b(n,{responseType:"image",
...h}));return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,n,h,k,m){async function g(){null==r&&(r=b.getBasisTranscoder(),f=await r);return r}function e(x,w,p,t,q){w=m.getBytesPerElementFormat(w?h.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:h.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);
return Math.ceil(p*t*w*(q&&1<x?(4**x-1)/(3*4**(x-1)):1))}function d(x){return 1<=x.getNumImages()&&!x.isUASTC()}function c(x){return 1<=x.getFaces()&&x.isETC1S()}function l(x,w,p,t,q,u,v,y){const {compressedTextureETC:D,compressedTextureS3TC:G}=x.capabilities,[A,C]=D?t?[n.TextureFormat.ETC2_RGBA,h.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[n.TextureFormat.ETC1_RGB,h.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:G?t?[n.TextureFormat.BC3_RGBA,h.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:
[n.TextureFormat.BC1_RGB,h.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[n.TextureFormat.RGBA32,h.PixelFormat.RGBA];p=w.hasMipmap?p:Math.min(1,p);t=[];for(let E=0;E<p;E++)t.push(new Uint8Array(v(E,A))),y(E,A,t[E]);w.internalFormat=C;w.hasMipmap=1<t.length;w.samplingMode=w.hasMipmap?h.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:h.TextureSamplingMode.LINEAR;w.width=q;w.height=u;return new k.Texture(x,w,{type:"compressed",levels:t})}let f=null,r=null;a.createTextureBasis=async function(x,w,p){null==
f&&(f=await g());const t=new f.BasisFile(new Uint8Array(p));if(!d(t))return null;t.startTranscoding();x=l(x,w,t.getNumLevels(0),t.getHasAlpha(),t.getImageWidth(0,0),t.getImageHeight(0,0),(q,u)=>t.getImageTranscodedSizeInBytes(0,q,u),(q,u,v)=>t.transcodeImage(v,0,q,u,0,0));t.close();t.delete();return x};a.createTextureKTX2=async function(x,w,p){null==f&&(f=await g());const t=new f.KTX2File(new Uint8Array(p));if(!c(t))return null;t.startTranscoding();x=l(x,w,t.getLevels(),t.getHasAlpha(),t.getWidth(),
t.getHeight(),(q,u)=>t.getImageTranscodedSizeInBytes(q,0,0,u),(q,u,v)=>t.transcodeImage(v,q,0,0,u,0,-1,-1));t.close();t.delete();return x};a.estimateMemoryBasis=function(x,w){if(null==f)return x.byteLength;x=new f.BasisFile(new Uint8Array(x));w=d(x)?e(x.getNumLevels(0),x.getHasAlpha(),x.getImageWidth(0,0),x.getImageHeight(0,0),w):0;x.close();x.delete();return w};a.estimateMemoryKTX2=function(x,w){if(null==f)return x.byteLength;x=new f.KTX2File(new Uint8Array(x));w=c(x)?e(x.getLevels(),x.getHasAlpha(),
x.getWidth(),x.getHeight(),w):0;x.close();x.delete();return w};a.loadBasis=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets"],function(a,b,n){let h;b.getBasisTranscoder=function(){if(null==h){const k=m=>n.getAssetUrl(`esri/libs/basisu/${m}`);h=(new Promise((m,g)=>a(["../../chunks/basis_transcoder"],m,g))).then(m=>m.basis_transcoder).then(({default:m})=>m({locateFile:k}).then(g=>{g.initializeBasis();delete g.then;
return g}))}return h};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";
b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports",
"../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(a,b,n,h){function k(l){return l.charCodeAt(0)+(l.charCodeAt(1)<<8)+(l.charCodeAt(2)<<16)+(l.charCodeAt(3)<<24)}function m(l,f){var r=new Int32Array(l,0,31);if(542327876!==r[0])return g().error("Invalid magic number in DDS header"),null;if(!(r[20]&4))return g().error("Unsupported format, must contain a FourCC code"),null;var x=r[21];let w;switch(x){case e:x=8;w=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case d:x=16;w=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case c:x=16;w=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return g().error("Unsupported FourCC code:",String.fromCharCode(x&255,x>>8&255,x>>16&255,x>>24&255)),null}let p=1,t=r[4],q=r[3];if(0!==(t&3)||0!==(q&3))g().warn("Rounding up compressed texture size to nearest multiple of 4."),t=t+3&-4,q=q+3&-4;const u=t,v=q;r[2]&131072&&!1!==f&&(p=Math.max(1,r[7]));let y=r[1]+4;const D=[];for(let G=0;G<
p;++G)r=(t+3>>2)*(q+3>>2)*x,f=new Uint8Array(l,y,r),D.push(f),y+=r,t=Math.max(1,t>>1),q=Math.max(1,q>>1);return{textureData:{type:"compressed",levels:D},internalFormat:w,width:u,height:v}}const g=()=>b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),e=k("DXT1"),d=k("DXT3"),c=k("DXT5");a.createDDSTexture=function(l,f,r){r=m(r,f.hasMipmap??!1);if(null==r)throw Error("DDS texture data is null");const {textureData:x,internalFormat:w,width:p,height:t}=r;f.samplingMode=1<x.levels.length?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:
n.TextureSamplingMode.LINEAR;f.hasMipmap=1<x.levels.length;f.internalFormat=w;f.width=p;f.height=t;return new h.Texture(l,f,x)};a.createDDSTextureData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m){a.CapType=void 0;(function(e){e[e.BUTT=0]="BUTT";e[e.SQUARE=1]="SQUARE";e[e.ROUND=2]="ROUND";e[e.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));class g extends m.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.capType=a.CapType.BUTT;this.transparencyPassType=k.TransparencyPassType.NONE;this.stippleOffColorEnabled=this.stippleEnabled=this.draped=this.writeDepth=this.hasPolygonOffset=this.hasSlicePlane=this.occluder=!1;this.stipplePreferContinuous=
!0;this.objectAndLayerIdColorInstanced=this.wireframe=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.innerColorEnabled=this.falloffEnabled=this.vvOpacity=this.vvColor=this.vvSize=this.applyMarkerOffset=this.roundJoins=!1}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],g.prototype,"output",void 0);b.__decorate([h.parameter({count:a.CapType.COUNT})],g.prototype,"capType",void 0);b.__decorate([h.parameter({count:k.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",
void 0);b.__decorate([h.parameter()],g.prototype,"occluder",void 0);b.__decorate([h.parameter()],g.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],g.prototype,"hasPolygonOffset",void 0);b.__decorate([h.parameter()],g.prototype,"writeDepth",void 0);b.__decorate([h.parameter()],g.prototype,"draped",void 0);b.__decorate([h.parameter()],g.prototype,"stippleEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"stippleOffColorEnabled",void 0);b.__decorate([h.parameter()],g.prototype,
"stipplePreferContinuous",void 0);b.__decorate([h.parameter()],g.prototype,"roundJoins",void 0);b.__decorate([h.parameter()],g.prototype,"applyMarkerOffset",void 0);b.__decorate([h.parameter()],g.prototype,"vvSize",void 0);b.__decorate([h.parameter()],g.prototype,"vvColor",void 0);b.__decorate([h.parameter()],g.prototype,"vvOpacity",void 0);b.__decorate([h.parameter()],g.prototype,"falloffEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"innerColorEnabled",void 0);b.__decorate([h.parameter()],
g.prototype,"hasOccludees",void 0);b.__decorate([h.parameter()],g.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter()],g.prototype,"wireframe",void 0);b.__decorate([h.parameter()],g.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([h.parameter({constValue:!1})],g.prototype,"occlusionPass",void 0);b.__decorate([h.parameter({constValue:!0})],g.prototype,"hasVvInstancing",void 0);b.__decorate([h.parameter({constValue:!0})],
g.prototype,"hasSliceTranslatedView",void 0);a.RibbonLineTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){const x=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.PREVPOSITION,1],[c.VertexAttribute.NEXTPOSITION,2],[c.VertexAttribute.SUBDIVISIONFACTOR,3],[c.VertexAttribute.UV0,4],[c.VertexAttribute.COLOR,5],[c.VertexAttribute.COLORFEATUREATTRIBUTE,5],[c.VertexAttribute.SIZE,6],[c.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[c.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[c.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);class w extends k.ShaderTechnique{initializeProgram(t){return new g.Program(t.rctx,
w.shader.get().build(this.configuration),x)}_makePipelineState(t,q){const u=this.configuration,v=t===d.TransparencyPassType.NONE,y=t===d.TransparencyPassType.FrontFace,D=n.isDepthLikeOutput(u.output);return r.makePipelineState({blending:u.output===n.ShaderOutput.Color||u.output===n.ShaderOutput.Alpha?v?m.blendingDefault:m.oitBlending(t):null,depthTest:{func:m.oitDepthTest(t)},depthWrite:v?u.writeDepth||D?r.defaultDepthWriteParams:null:m.oitDepthWrite(t),colorWrite:r.defaultColorWriteParams,stencilWrite:u.hasOccludees?
e.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?q?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:v||y?u.hasPolygonOffset?p:null:m.OITPolygonOffset})}initializePipeline(){var t=this.configuration;t.occluder&&(t=t.hasPolygonOffset?p:null,this._occluderPipelineTransparent=r.makePipelineState({blending:m.blendingDefault,polygonOffset:t,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:r.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),
this._occluderPipelineOpaque=r.makePipelineState({blending:m.blendingDefault,polygonOffset:t,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:r.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=r.makePipelineState({blending:null,polygonOffset:t,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=
this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?f.PrimitiveType.LINES:f.PrimitiveType.TRIANGLE_STRIP}getPipeline(t,q,u){return t?this._occludeePipelineState:this.configuration.occluder?u?this._occluderPipelineTransparent:q?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}w.shader=new h.ReloadableShaderModule(l.RibbonLine,
()=>new Promise((t,q)=>a(["./RibbonLine.glsl"],t,q)));const p={factor:0,units:-4};b.RibbonLineTechnique=w;b.vertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,b,n,h,k,m){class g{constructor(c,l,f=null){this.rctx=c;this.sliceHelper=f;this.lastFrameCamera=new k.Camera;this.output=
n.ShaderOutput.Color;this.renderOccludedMask=d;this.bindParameters=new h.BindParameters(l,null!=f?f.plane:null);this.bindParameters.alignPixelEnabled=!0}}class e extends g{constructor(c,l,f,r){super(c,f,r);this.offscreenRenderingHelper=l;this.sliceHelper=r;this.time=b.Milliseconds(0)}}const d=m.RenderOccludedFlag.Occlude|m.RenderOccludedFlag.OccludeAndTransparent|m.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=g;a.RenderContext=e;a.defaultRenderOccludedMask=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../ViewingMode ../../webgl/formats ./CascadeCamera ./textureUtils ./Util ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(fa,da){e.set(X,fa[da],fa[da+3]);return X}a.SnapshotSlot=void 0;(function(fa){fa[fa.Highlight=0]="Highlight";fa[fa.ExcludeHighlight=1]="ExcludeHighlight"})(a.SnapshotSlot||(a.SnapshotSlot={}));class D{constructor(){this.camera=new p.CascadeCamera;this.lightMat=g.create()}}class G{constructor(){this.maxNumCascadesLowQuality=this.maxNumCascadesHighQuality=4;this.textureSizeModHighQuality=1.3;this.textureSizeModLowQuality=.9;this.splitSchemeLambda=
0}}class A{constructor(fa,da){this._fbos=fa;this._viewingMode=da;this._enabled=!1;this._snapshots=[];this._textureHeight=0;this._numCascades=1;this.settings=new G;this._projectionView=g.create();this._projectionViewInverse=g.create();this._modelViewLight=g.create();this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=r.create();this._cascades=[new D,new D,new D,new D];this._lastOrigin=null;this._maxTextureWidth=Math.min(b("esri-mobile")?4096:16384,fa.rctx.parameters.maxTextureSize)}dispose(){this.enabled=
!1;this.disposeOffscreenBuffers()}get depthTexture(){return this._handle?.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return f.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}disposeOffscreenBuffers(){this._handle=h.releaseMaybe(this._handle);
this._discardSnapshots()}set maxCascades(fa){this.settings.maxNumCascadesHighQuality=n.clamp(Math.floor(fa),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(fa){(this._enabled=fa)||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let fa=0;fa<this._numCascades;++fa)F[fa]=this._cascades[fa];F.length=this._numCascades;return F}start(fa,da,aa,ea,ha){q.assert(this.enabled);const {near:Y,
far:Z}=this._clampNearFar(aa);this._computeCascadeDistances(Y,Z,ea);this._textureHeight=this._computeTextureHeight(fa,ha,ea);this._setupMatrices(fa,da);const {viewMatrix:ja,projectionMatrix:oa}=fa;for(fa=0;fa<this._numCascades;++fa)this._constructCascade(fa,oa,ja,da);this._lastOrigin=null;this.clear()}finish(){q.assert(this.enabled);this._handle?.detachDepth()}getShadowMapMatrices(fa){if(!this._lastOrigin||!c.exactEquals(fa,this._lastOrigin)){this._lastOrigin=this._lastOrigin||l.create();c.copy(this._lastOrigin,
fa);for(let da=0;da<this._numCascades;++da){m.translate(M,this._cascades[da].lightMat,fa);for(let aa=0;16>aa;++aa)S[16*da+aa]=M[aa]}}return S}moveSnapshot(fa){q.assert(this.enabled);this._handle?.detachDepth();this._snapshots[fa]?.release();this._snapshots[fa]=this._handle;this._handle=null;this.clear()}copySnapshot(fa){var da=this._handle?.getTexture()?.descriptor;if(this.enabled&&da){this._snapshots[fa]?.release();var {width:aa,height:ea}=da;this._snapshots[fa]=this._fbos.acquire(aa,ea,fa===a.SnapshotSlot.Highlight?
"shadow highlight snapshot":"shadow no highlight snapshot",w.ColorFormat.RGBA4);da=this._fbos.rctx;this._bindFbo();fa=da.bindTexture(this._snapshots[fa]?.getTexture(),v.Texture.TEXTURE_UNIT_FOR_UPDATES);da.gl.copyTexSubImage2D(u.TextureType.TEXTURE_2D,0,0,0,0,0,aa,ea);da.bindTexture(fa,v.Texture.TEXTURE_UNIT_FOR_UPDATES)}}getSnapshot(fa){return this.enabled?this._snapshots[fa]?.getTexture():null}clear(){const fa=this._fbos.rctx;this._ensureFbo();this._bindFbo();fa.setClearColor(1,1,1,1);fa.clearSafe(u.ClearBufferBit.COLOR_BUFFER_BIT|
u.ClearBufferBit.DEPTH_BUFFER_BIT)}_computeTextureHeight(fa,da,aa){fa=t.applyTextureResizeModulo(Math.floor(Math.min(window.devicePixelRatio,da)/fa.pixelRatio*Math.max(fa.fullWidth,fa.fullHeight)*(aa?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality)));return t.applyTextureResizeFloorModulo(Math.min(this._maxTextureWidth,this._numCascades*fa)/this._numCascades)}_ensureFbo(){if(this._handle?.fbo.width!==this._textureWidth||this._handle?.fbo.height!==this._textureHeight)this._handle?.release(),
this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",w.ColorFormat.RGBA4);this._handle?.acquireDepth(w.DepthFormat.DEPTH16_BUFFER)}_discardSnapshot(fa){this._snapshots[fa]=h.releaseMaybe(this._snapshots[fa])}_discardSnapshots(){for(let fa=0;fa<this._snapshots.length;++fa)this._discardSnapshot(fa);this._snapshots.length=0}_bindFbo(){const fa=this._fbos.rctx;fa.unbindTexture(this.depthTexture);fa.bindFramebuffer(this._handle?.fbo)}_constructCascade(fa,da,aa,ea){const ha=
this._cascades[fa];var Y=-this._cascadeDistances[fa],Z=-this._cascadeDistances[fa+1];Y=(da[10]*Y+da[14])/Math.abs(da[11]*Y+da[15]);da=(da[10]*Z+da[14])/Math.abs(da[11]*Z+da[15]);q.assert(Y<da);for(Z=0;8>Z;++Z){f.set(E,0===Z%4||3===Z%4?-1:1,0===Z%4||1===Z%4?-1:1,4>Z?Y:da,1);var ja=I[Z];f.transformMat4(ja,E,this._projectionViewInverse);ja[0]/=ja[3];ja[1]/=ja[3];ja[2]/=ja[3]}c.negate(L,I[0]);ha.camera.viewMatrix=m.translate(C,this._modelViewLight,L);for(Y=0;8>Y;++Y)c.transformMat4(I[Y],I[Y],ha.camera.viewMatrix);
Y=I[0][2];da=I[0][2];for(Z=1;8>Z;++Z)Y=Math.min(Y,I[Z][2]),da=Math.max(da,I[Z][2]);Y-=200;da+=200;ha.camera.near=-da;ha.camera.far=-Y;Z=ha.camera;ja=1/I[0][3];var oa=1/I[4][3];q.assert(ja<oa);ja+=Math.sqrt(ja*oa);var qa=Math.sin(n.acosClamped(aa[2]*ea[0]+aa[6]*ea[1]+aa[10]*ea[2]));aa=I;var ta=ja/qa;ea=H;var va=J,Ca=B;oa=z;ja=K;e.set(N,0,0);for(var ma=0;4>ma;++ma)e.add(N,N,aa[ma]);e.scale(N,N,.25);e.set(P,0,0);for(ma=4;8>ma;++ma)e.add(P,P,aa[ma]);e.scale(P,P,.25);e.lerp(R[0],aa[4],aa[5],.5);e.lerp(R[1],
aa[5],aa[6],.5);e.lerp(R[2],aa[6],aa[7],.5);e.lerp(R[3],aa[7],aa[4],.5);ma=0;var wa=e.squaredDistance(R[0],N);for(var Ba=1;4>Ba;++Ba){var pa=e.squaredDistance(R[Ba],N);pa<wa&&(wa=pa,ma=Ba)}e.subtract(O,R[ma],aa[ma+4]);ma=O[0];O[0]=-O[1];O[1]=ma;e.subtract(T,P,N);0>e.dot(T,O)&&e.negate(O,O);e.lerp(O,O,T,qa);e.normalize(O,O);qa=ma=e.dot(e.subtract(Q,aa[0],N),O);for(wa=1;8>wa;++wa)Ba=e.dot(e.subtract(Q,aa[wa],N),O),Ba<qa?qa=Ba:Ba>ma&&(ma=Ba);e.copy(ea,N);e.scale(Q,O,qa-ta);e.add(ea,ea,Q);Ba=-1;pa=1;
ta=wa=0;for(let Aa=0;8>Aa;++Aa){e.subtract(V,aa[Aa],ea);e.normalize(V,V);const ra=O[0]*V[1]-O[1]*V[0];0<ra?ra>Ba&&(Ba=ra,wa=Aa):ra<pa&&(pa=ra,ta=Aa)}q.verify(0<Ba,"leftArea");q.verify(0>pa,"rightArea");e.scale(U,O,qa);e.add(U,U,N);e.scale(W,O,ma);e.add(W,W,N);ca[0]=-O[1];ca[1]=O[0];va=q.rayRay2D(ea,aa[ta],W,e.add(Q,W,ca),1,va);Ca=q.rayRay2D(ea,aa[wa],W,Q,1,Ca);oa=q.rayRay2D(ea,aa[wa],U,e.add(Q,U,ca),1,oa);aa=q.rayRay2D(ea,aa[ta],U,Q,1,ja);q.verify(va,"rayRay");q.verify(Ca,"rayRay");q.verify(oa,"rayRay");
q.verify(aa,"rayRay");Ca=H;aa=J;ea=z;oa=K;ja=Z.projectionMatrix;e.subtract(ba,ea,oa);e.scale(ba,ba,.5);ia[0]=ba[0];ia[1]=ba[1];ia[2]=0;ia[3]=ba[1];ia[4]=-ba[0];ia[5]=0;ia[6]=ba[0]*ba[0]+ba[1]*ba[1];ia[7]=ba[0]*ba[1]-ba[1]*ba[0];ia[8]=1;ia[6]=-e.dot(y(ia,0),Ca);ia[7]=-e.dot(y(ia,1),Ca);Ca=e.dot(y(ia,0),ea)+ia[6];va=e.dot(y(ia,1),ea)+ia[7];ta=e.dot(y(ia,0),oa)+ia[6];oa=e.dot(y(ia,1),oa)+ia[7];Ca=-(Ca+ta)/(va+oa);ia[0]+=ia[1]*Ca;ia[3]+=ia[4]*Ca;ia[6]+=ia[7]*Ca;Ca=1/(e.dot(y(ia,0),ea)+ia[6]);va=1/(e.dot(y(ia,
1),ea)+ia[7]);ia[0]*=Ca;ia[3]*=Ca;ia[6]*=Ca;ia[1]*=va;ia[4]*=va;ia[7]*=va;ia[2]=ia[1];ia[5]=ia[4];ia[8]=ia[7];ia[7]+=1;Ca=e.dot(y(ia,1),aa)+ia[7];va=e.dot(y(ia,2),aa)+ia[8];ta=e.dot(y(ia,1),ea)+ia[7];oa=e.dot(y(ia,2),ea)+ia[8];Ca=-.5*(Ca/va+ta/oa);ia[1]+=ia[2]*Ca;ia[4]+=ia[5]*Ca;ia[7]+=ia[8]*Ca;Ca=e.dot(y(ia,1),aa)+ia[7];va=e.dot(y(ia,2),aa)+ia[8];ta=-va/Ca;ia[1]*=ta;ia[4]*=ta;ia[7]*=ta;ja[0]=ia[0];ja[1]=ia[1];ja[2]=0;ja[3]=ia[2];ja[4]=ia[3];ja[5]=ia[4];ja[6]=0;ja[7]=ia[5];ja[8]=0;ja[9]=0;ja[10]=
1;ja[11]=0;ja[12]=ia[6];ja[13]=ia[7];ja[14]=0;ja[15]=ia[8];Z.projectionMatrix[10]=2/(Y-da);Z.projectionMatrix[14]=-(Y+da)/(Y-da);m.multiply(ha.lightMat,ha.camera.projectionMatrix,ha.camera.viewMatrix);Y=this._textureHeight;ha.camera.viewport=[fa*Y,0,Y,Y]}_setupMatrices(fa,da){m.multiply(this._projectionView,fa.projectionMatrix,fa.viewMatrix);m.invert(this._projectionViewInverse,this._projectionView);fa=this._viewingMode===x.ViewingMode.Global?fa.eye:c.set(L,0,0,1);m.lookAt(this._modelViewLight,[0,
0,0],[-da[0],-da[1],-da[2]],fa)}_clampNearFar(fa){let {near:da,far:aa}=fa;2>da&&(da=2);2>aa&&(aa=2);da>=aa&&(da=2,aa=4);return{near:da,far:aa}}_computeCascadeDistances(fa,da,aa){aa=aa?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(q.logWithBase(da/fa,4)),aa);aa=(da-fa)/this._numCascades;da=(da/fa)**(1/this._numCascades);let ea=fa;for(let ha=0;ha<this._numCascades+1;++ha)this._cascadeDistances[ha]=n.lerp(ea,fa,this.settings.splitSchemeLambda),
ea*=da,fa+=aa}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const C=g.create(),E=r.create(),I=[];for(let fa=0;8>fa;++fa)I.push(r.create());const H=d.create(),J=d.create(),B=d.create(),z=d.create(),K=d.create(),L=l.create(),F=[],M=g.create(),S=g.IDENTITY.concat(g.IDENTITY,g.IDENTITY,g.IDENTITY,g.IDENTITY),N=d.create(),P=d.create(),R=[d.create(),d.create(),d.create(),d.create()],O=d.create(),T=d.create(),Q=d.create(),V=d.create(),U=d.create(),W=d.create(),ca=d.create(),
X=d.create(),ba=d.create(),ia=k.create();a.ShadowMap=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ./Camera".split(" "),function(a,b,n,h,k,m,g,e,d){a.CascadeCamera=
class extends d.Camera{constructor(){super(...arguments);this._projectionMatrix=e.create()}get projectionMatrix(){return this._projectionMatrix}};b.__decorate([n.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);b.__decorate([n.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/sphere ../../terrain/Intersector ../core/shaderLibrary/ShaderOutput ./ChangeSet ./Intersector ./IntersectorInterfaces ./Material ./ModelDirtyTypes ./rendererUtils ./RenderSlot ../materials/renderers/MergedRenderer".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){function D(C,E,I,H,J,B,z){const K=new f.OverlayTarget(B,z,E);E=L=>{L.set(p.IntersectorType.OVERLAY,K,C.dist,C.normal,C.transformation,I,H)};(null==J.results.min.drapedLayerOrder||I>=J.results.min.drapedLayerOrder)&&(null==J.results.min.dist||J.results.ground.dist<=J.results.min.dist)&&E(J.results.min);J.options.store!==p.StoreResults.MIN&&(null==J.results.max.drapedLayerOrder||I<J.results.max.drapedLayerOrder)&&(null==J.results.max.dist||J.results.ground.dist>
J.results.max.dist)&&E(J.results.max);J.options.store===p.StoreResults.ALL&&(B=w.newIntersectorResult(J.ray),E(B),J.results.all.push(B))}a.SortedRenderGeometryRenderer=class extends n{constructor(C){super(C);this._pending=new G;this._changes=new x.ChangeSet;this._materialRenderers=new h;this._sortedMaterialRenderers=new h;this._geometries=new Map;this._hasWater=this._hasHighlights=!1}destroy(){this._changes.prune();this._materialRenderers.forAll(C=>C.destroy());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();
this._geometries.clear();this._pending.clear()}get updating(){return!this._pending.empty||0<this._changes.updates.length}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return this._materialRenderers.some(C=>0!==C.numGeometries&&!C.queryRenderOccludedState(t.RenderOccludedFlag.Occlude))}get isEmpty(){return!this.updating&&
0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(C){return null==C?0:this._materialRenderers.find(E=>E.materialReference===C)?.usedMemory??0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();let C=!1;u.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((E,I)=>{var H=this._materialRenderers.find(J=>J.materialReference===I);!H&&0<E.adds.length&&(H=new y.MergedRenderer({material:I}),H.initializeRenderContext(this.rendererContext.pluginContext,
this._materialRepository),this._materialRenderers.push(H),C=!0);H&&(H.modify(E),0===H.numGeometries&&(this._materialRenderers.removeUnordered(H),H.destroy(),C=!0))});this._changes.clear();C&&this._updateSortedMaterialRenderers();this._hasHighlights=this._materialRenderers.some(E=>(E=E.produces.get(v.RenderSlot.DRAPED_MATERIAL))?E(r.ShaderOutput.Highlight):!1);this._hasWater=this._materialRenderers.some(E=>(E=E.produces.get(v.RenderSlot.DRAPED_WATER))?E(r.ShaderOutput.Normal):!1);this.notifyChange("updating");
return!0}addGeometries(C,E){if(0!==C.length){var I=this._validateRenderGeometries(C);for(var H of I)this._geometries.set(H.id,H);H=this._pending.empty;for(const J of I)this._pending.adds.add(J);H&&this.notifyChange("updating");E===q.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(C)}}removeGeometries(C,E){const I=this._pending.empty,H=this._pending.adds;for(const J of C)H.has(J)?(this._pending.removed.add(J),H.delete(J)):this._pending.removed.has(J)||this._pending.removes.add(J),this._geometries.delete(J.id);
I&&!this._pending.empty&&this.notifyChange("updating");E===q.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(C)}modifyGeometries(C,E){const I=0===this._changes.updates.length;for(const H of C){const J=this._changes.updates.pushNew();J.renderGeometry=this._validateRenderGeometry(H);J.updateType=E}I&&0<this._changes.updates.length&&this.notifyChange("updating");switch(E){case q.DirtyState.TRANSFORMATION:case q.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(C);case q.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(C)}}updateAnimation(C){let E=
!1;this._sortedMaterialRenderers.forAll(I=>E=!!I.updateAnimation&&I.updateAnimation(C)||E);return E}shouldRender(C){return this._sortedMaterialRenderers.some(E=>E.prepareTechnique(C))}render(C){this._sortedMaterialRenderers.forAll(E=>{const I=E.prepareTechnique(C);null!=I&&E.renderNode(C,I)})}intersect(C,E,I,H,J){this._geometries.forEach(B=>{if(!H||H(B)){this._intersectRenderGeometry(B,I,E,0,C,J);var z=this.rendererContext.longitudeCyclical;z&&(B.boundingSphere[0]-B.boundingSphere[3]<z.min&&this._intersectRenderGeometry(B,
I,E,z.range,C,J),B.boundingSphere[0]+B.boundingSphere[3]>z.max&&this._intersectRenderGeometry(B,I,E,-z.range,C,J));J++}});return J}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();this._materialRenderers.forAll((C,E)=>{C.drapedPriority=E;this._sortedMaterialRenderers.push(C)});this._sortedMaterialRenderers.sort((C,E)=>E.materialReference?.renderPriority===C.materialReference?.renderPriority?C.drapedPriority-E.drapedPriority:(E.materialReference?.renderPriority||0)-(C.materialReference?.renderPriority||
0))}_processAddsRemoves(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let C=0;C<this._changes.updates.length;)this._pending.has(this._changes.updates.data[C].renderGeometry)?this._changes.updates.removeUnorderedIndex(C):C++;this._pending.clear()}_intersectRenderGeometry(C,E,I,H,J,B){if(C.visible){var z=0;H+=C.transformation[12];z=C.transformation[13];A[0]=
I[0]-H;A[1]=I[1]-z;C.screenToWorldRatio=this.rendererContext.screenToWorldRatio;C.material.intersectDraped(C,null,J,A,(K,L,F)=>{D(E,F,B,C.material.renderPriority,J,C.layerUid,C.graphicUid)},E)}}_notifyGraphicGeometryChanged(C){if(null!=this.drapeSource.notifyGraphicGeometryChanged)for(const I of C)if(C=I.graphicUid,null!=C&&C!==E){this.drapeSource.notifyGraphicGeometryChanged(C);var E=C}}_notifyGraphicVisibilityChanged(C){if(null!=this.drapeSource.notifyGraphicVisibilityChanged)for(const I of C)if(C=
I.graphicUid,null!=C&&C!==E){this.drapeSource.notifyGraphicVisibilityChanged(C);var E=C}}_validateRenderGeometries(C){for(const E of C)this._validateRenderGeometry(E);return C}_validateRenderGeometry(C){null==C.localOrigin&&(C.localOrigin=this._localOriginFactory.getOrigin(l.getCenter(C.boundingSphere)));return C}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);b.__decorate([k.property()],
a.SortedRenderGeometryRenderer.prototype,"updating",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);b.__decorate([k.property({constructOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);b.__decorate([k.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,
"isEmpty",null);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRenderers",void 0);b.__decorate([k.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);class G{constructor(){this.adds=new Set;this.removes=new Set;this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&
0===this.removed.size}has(C){return this.adds.has(C)||this.removes.has(C)||this.removed.has(C)}clear(){this.adds.clear();this.removes.clear();this.removed.clear()}}const A=c.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,b,n,h){class k extends n.Graphic3DTarget{constructor(m,
g,e){super(m,g);this.triangleNr=e}}a.OverlayTarget=k;a.isOverlayIntersectorResult=function(m){return h.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.OVERLAY&&!!m.target};a.isTerrainIntersectorResult=function(m){return h.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.TERRAIN&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){class n{constructor(){this.adds=
new b;this.removes=new b;this.updates=new b({allocator:m=>m||new h,deallocator:m=>{m.renderGeometry=null;return m}})}clear(){this.adds.clear();this.removes.clear();this.updates.clear()}prune(){this.adds.prune();this.removes.prune();this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class h{}class k{constructor(){this.adds=[];this.removes=[];this.updates=[]}}a.ChangeSet=n;a.MaterialChangeSet=k;a.RenderGeometryUpdate=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.DirtyOperation=void 0;(function(b){b[b.ADD=0]="ADD";b[b.UPDATE=1]="UPDATE";b[b.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(b){b[b.NONE=0]="NONE";b[b.VISIBILITY=1]="VISIBILITY";b[b.GEOMETRY=2]="GEOMETRY";b[b.TRANSFORMATION=4]="TRANSFORMATION";b[b.HIGHLIGHT=8]="HIGHLIGHT";b[b.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState=
{}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.RendererTarget=void 0;(function(n){n[n.Default=0]="Default";n[n.Screenshot=1]="Screenshot";n[n.ObjectAndLayerID=2]="ObjectAndLayerID"})(a.RendererTarget||(a.RendererTarget={}));a.splitRenderGeometryChangeSetByMaterial=function(n){const h=new Map,k=m=>{let g=h.get(m);g||(g=new b.MaterialChangeSet,h.set(m,g));return g};n.removes.forAll(m=>
{1<=m.geometry.indexCount&&k(m.material).removes.push(m)});n.adds.forAll(m=>{1<=m.geometry.indexCount&&k(m.material).adds.push(m)});n.updates.forAll(m=>{1<=m.renderGeometry.geometry.indexCount&&k(m.renderGeometry.material).updates.push(m)});return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../../lib/GLMaterials ../../lib/ModelDirtyTypes ../../lib/RenderSlot ../../lib/Util ../DrawParameters ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I){function H(N,P){let R;if(!N.some(T=>{if(T.numElements<P)return!1;R=T;return!0}))return null;const O=R.from;R.from+=P;R.from>=R.to&&N.removeUnordered(R);return O}function J(N){S.length<N&&(S=new Float32Array(N));return S}function B(N){N*=4;return 1024>=N?1024:262144>N?k.nextHighestPowerOfTwo(N):Math.max(Math.min(262144*Math.ceil(1.5*N/262144),16777216),N)}a.MergedRenderer=class extends t.SyncPrepareRenderPlugin{constructor(N){super(N);
this._bufferWriter=this._glMaterials=this._vaoCache=null;this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._produces=new Map;this.drapedPriority=0}destroy(){this._glMaterials=m.disposeMaybe(this._glMaterials);this._dataByOrigin.forEach(N=>N.dispose());this._dataByOrigin.clear();this._vaoCache=m.disposeMaybe(this._vaoCache)}initialize(){this.material.produces.forEach((N,P)=>{this._produces.set(P,R=>0!==this._dataByOrigin.size&&(R!==p.ShaderOutput.Highlight&&R!==p.ShaderOutput.ShadowHighlight||
this._hasHighlights)?N(R):!1)})}get produces(){return this._produces}initializeRenderContext(N,P){const {rctx:R}=N.renderContext;this._glMaterials=new q.GLMaterials(this.material,P??N.materialRepository);this._bufferWriter=this.material.createBufferWriter();this._vaoCache=new I.VaoCache(R,this.material.vertexAttributeLocations,w.glLayout(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(N){return this.material.queryRenderOccludedState(N)}get materialReference(){return this.material}get numGeometries(){let N=
0;this._dataByOrigin.forEach(P=>N+=P.buffers.reduce((R,O)=>R+=O.instances.size,0));return N}get usedMemory(){let N=0;this._dataByOrigin.forEach(P=>N+=P.buffers.reduce((R,O)=>R+O.vao.usedMemory,0));return N}forEachGeometry(N){this._dataByOrigin.forEach(P=>P.buffers.forEach(R=>R.instances.forEach(O=>N(O.geometry))))}modify(N){this._updateGeometries(N.updates);this._addAndRemoveGeometries(N.adds,N.removes);this._updateDrawCommands()}_updateGeometries(N){const P=this._bufferWriter;if(null!==P){var R=
P.vertexBufferLayout.stride/4;for(const T of N){N=T.renderGeometry;const Q=this._dataByOrigin.get(N.localOrigin.id)?.findBuffer(N.id);if(null==Q)break;const V=Q.instances.get(N.id);if(T.updateType&(u.DirtyState.GEOMETRY|u.DirtyState.TRANSFORMATION)){var O=P.elementCount(V.geometry.geometry)*R;O=J(O);const U=P.vertexBufferLayout.createView(O.buffer);this._writeGeometry(N,U,0);Q.vao.vertexBuffers.geometry.setSubData(O,V.from*R,0,V.numElements*R)}T.updateType&(u.DirtyState.HIGHLIGHT|u.DirtyState.OCCLUDEE|
u.DirtyState.VISIBILITY)&&(Q.drawCommandsDirty=!0)}}}_computeDeltas(N,P){const R=new g.NestedMap;for(var O of N){N=O.localOrigin;if(null==N)continue;let T=R.get(N.id,null);null==T&&(T=new z(N.vec3),R.set(N.id,null,T));T.changes.push(O)}for(const T of P)P=T.localOrigin,null!=P&&(O=this._dataByOrigin.get(P.id)?.findBuffer(T.id),null!=O&&(N=R.get(P.id,O),null==N&&(N=new z(P.vec3),R.set(P.id,O,N)),N.changes.push(T)));return R}_addAndRemoveGeometries(N,P){if(null!==this._bufferWriter&&null!==this._vaoCache){var {_bufferWriter:R,
_dataByOrigin:O}=this,T=R.vertexBufferLayout.stride/4,Q=this._computeDeltas(N,P);Q.forEach((V,U)=>{const W=V.get(null),ca=null!=W?W.changes:[];Q.delete(U,null);let X=O.get(U);V.forEach((ba,ia)=>{Q.delete(U,ia);if(null==ia)y.assert(!1,"No VAO for removed geometries");else if(ia.instances.size===ba.changes.length)this._vaoCache.deleteVao(ia.vao),n.removeUnordered(X.buffers,ia),0===X.buffers.length&&0===ca.length&&O.delete(U);else{var fa=ia.numElements,da=ia.vao.byteSize/4,aa=ca.reduce((ha,Y)=>ha+R.elementCount(Y.geometry),
0),ea=ba.changes.reduce((ha,Y)=>ha+R.elementCount(Y.geometry),0);fa=Math.min((fa+aa-ea)*T,4194304);aa=fa>da;65536<fa&&fa<da/2?(ba.changes.forEach(({id:ha})=>ia.deleteInstance(ha)),ia.instances.forEach(({geometry:ha})=>ca.push(ha)),this._vaoCache.deleteVao(ia.vao),n.removeUnordered(X.buffers,ia)):aa?this._applyAndRebuild(ia,ca,ba):this._applyRemoves(ia,ba)}});if(0<ca.length)for(null==X&&(X=new E.PerOriginData(W.origin),O.set(U,X)),X.buffers.forEach(ba=>this._applyAdds(ba,ca));0<ca.length;)X.buffers.push(this._applyAndRebuild(new C.PerBufferData,
ca,null))})}}_updateDrawCommands(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(N=>{N.buffers.forEach(P=>{P.drawCommandsDirty&&(P.hasHiddenInstances=!1,P.hasHighlights=!1,P.hasOccludees=!1,h.someMap(P.instances,R=>{P.updateDrawState(R);return P.hasHiddenInstances&&P.hasHighlights&&P.hasOccludees}),P.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));this._hasHighlights=this._hasHighlights||P.hasHighlights;this._hasOccludees=this._hasOccludees||P.hasOccludees})})}_applyAndRebuild(N,
P,R){if(null!=R)for(var O of R.changes)N.deleteInstance(O.id);const T=this._bufferWriter;R=T.vertexBufferLayout.stride;O=R/4;var Q=Math.floor(4194304/O);let V=N.numElements;for(;0<P.length;){const X=P.pop();var U=T.elementCount(X.geometry);if(V+U>Q&&0<V){P.push(X);break}V+=U;U=new A.Instance(X,0,0);y.assert(null==N.instances.get(X.id));N.addInstance(X.id,U)}P=V*O;Q=J(P);const W=T.vertexBufferLayout.createView(Q.buffer);let ca=0;N.hasHiddenInstances=!1;N.hasHighlights=!1;N.hasOccludees=!1;N.instances.forEach((X,
ba)=>{this._writeGeometry(X.geometry,W,ca);const ia=ca;ca+=T.elementCount(X.geometry.geometry);N.updateInstance(ba,ia,ca);N.updateDrawState(X)});this._vaoCache.deleteVao(N.vao);N.vao=this._vaoCache.newVao(B(P));N.vao.vertexBuffers.geometry.setSubData(Q,0,0,ca*O);N.holes.clear();P=N.holes.pushNew();P.from=ca;P.to=Math.floor(N.vao.byteSize/R);N.updateDrawCommands(R);return N}_applyRemoves(N,P){if(0!==P.changes.length&&null!==this._bufferWriter){for(var R of P.changes){var O=R.id;if(P=N.instances.get(O)){N.deleteInstance(O);
if(O=M.back()){if(O.to===P.from){O.to=P.to;continue}if(O.from===P.to){O.from=P.from;continue}}O=M.pushNew();O.from=P.from;O.to=P.to}}G.mergeAdjacentRanges(M);var T=this._bufferWriter.vertexBufferLayout.stride/4;R=M.reduce((U,W)=>Math.max(U,W.numElements),0)*T;var Q=J(R);Q.fill(0,0,R);var V=N.vao.vertexBuffers.geometry;M.forAll(U=>V.setSubData(Q,U.from*T,0,U.numElements*T));N.holes.pushArray(M.data,M.length);M.forAll((U,W)=>M.data[W]=null);M.clear();N.drawCommandsDirty=!0}}_applyAdds(N,P){if(0!==P.length&&
null!==this._bufferWriter)if(C.hasVao(N)){var R=this._bufferWriter,O=R.vertexBufferLayout.stride/4,T=N.numElements,Q=P.reduce((da,aa)=>da+R.elementCount(aa.geometry),0);T=Math.min((T+Q)*O,4194304);Q=4*T;if(N.vao.byteSize<B(4128768)&&Q>N.vao.byteSize)this._applyAndRebuild(N,P,null);else{G.mergeAdjacentRanges(N.holes);var V=[];for(var U of P)Q=R.elementCount(U.geometry),Q=H(N.holes,Q),V.push(Q);var W=N.vao.vertexBuffers.geometry,ca=0,X=0,ba=0,ia=J(T),fa=R.vertexBufferLayout.createView(ia.buffer);P.forEach((da,
aa)=>{aa=V[aa];if(null!=aa){if(ba!==aa){var ea=ba-X;0<ea&&W.setSubData(ia,X*O,0,ea*O);X=aa;ca=0}ea=R.elementCount(da.geometry);this._writeGeometry(da,fa,ca);ca+=ea;ba=aa+ea;aa=new A.Instance(da,aa,aa+ea);y.assert(null==N.instances.get(da.id));N.addInstance(da.id,aa);N.drawCommandsDirty=!0}});U=ba-X;0<U&&W.setSubData(ia,X*O,0,U*O);n.filterInPlace(P,(da,aa)=>null==V[aa])}}else this._applyAndRebuild(N,P,null)}_writeGeometry(N,P,R){if(null!==this._bufferWriter){var O=N.localOrigin.vec3;y.setMatrixTranslation3(K,
-O[0],-O[1],-O[2]);O=r.multiply(L,K,N.transformation);r.invert(F,O);r.transpose(F,F);this._bufferWriter.write(O,F,N.geometry,P,R)}}updateAnimation(N){return this.material.update(N)}prepareTechnique(N){if(!this.material.shouldRender(N))return null;const {output:P,bindParameters:R}=N;var O=this.material.produces.get(R.slot);if(!O||!O(P)||(O=P===p.ShaderOutput.Highlight||P===p.ShaderOutput.ShadowHighlight)&&!this._hasHighlights)return null;const T=P===p.ShaderOutput.ShadowExcludeHighlight,Q=!(O||T);
for(const U of this._dataByOrigin.values())for(const W of U.buffers){if(O&&!W.hasHighlights)continue;var V=(O?W.drawCommandsHighlight:T&&W.needsMultipleCommands()?W.drawCommandsShadowHighlightRest:W.drawCommandsDefault)||null;const ca=Q&&W.drawCommandsOccludees||null;if(V?.length||ca?.length)if(V=this._glMaterials.load(N.rctx,R.slot,P),V=null!=V?V.beginSlot(R):null,null!=V)return V}return null}renderNode(N,P){const {output:R,bindParameters:O}=N,T=R===p.ShaderOutput.Highlight||R===p.ShaderOutput.ShadowHighlight,
Q=R===p.ShaderOutput.ShadowExcludeHighlight,V=!(T||Q),U=N.rctx,W=N.bindParameters.slot===v.RenderSlot.OCCLUDER_MATERIAL;N=N.bindParameters.slot===v.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;U.runAppleAmdDriverHelper();U.bindTechnique(P,O,this.material.parameters);for(const ca of this._dataByOrigin.values())for(const X of ca.buffers){if(T&&!X.hasHighlights)continue;const ba=(T?X.drawCommandsHighlight:Q&&X.needsMultipleCommands()?X.drawCommandsShadowHighlightRest:X.drawCommandsDefault)||null,ia=V&&X.drawCommandsOccludees||
null;if(ba?.length||ia?.length)P.program.bindDraw(new D.DrawParameters(ca.origin),O,this.material.parameters),P.ensureAttributeLocations(X.vao),U.bindVAO(X.vao),ba?.length&&(U.setPipelineState(P.getPipeline(!1,W,N)),ba.forAll(fa=>U.drawArrays(P.primitiveType,fa.first,fa.count))),ia?.length&&(U.setPipelineState(P.getPipeline(!0,W,N)),ia.forAll(fa=>U.drawArrays(P.primitiveType,fa.first,fa.count)))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};
b.__decorate([d.property({constructOnly:!0})],a.MergedRenderer.prototype,"material",void 0);a.MergedRenderer=b.__decorate([f.subclass("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],a.MergedRenderer);class z{constructor(N){this.origin=N;this.changes=[]}}const K=x.create(),L=x.create(),F=x.create(),M=new e({allocator:N=>N||new G.BufferRange,deallocator:null});let S=new Float32Array(65536);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports",
"./basicInterfaces"],function(a,b){class n{constructor(h,k){this._material=h;this._repository=k;this._map=new Map}dispose(){this._map.forEach((h,k)=>{null!=h&&this._repository.release(this._material,k)})}load(h,k,m){const g=this._material.produces.get(k);if(!g||!g(m))return null;this._map.has(m)||this._map.set(m,this._repository.acquire(this._material,k,m));k=this._map.get(m);if(null!=k){if(k.ensureResources(h)===b.ResourceState.LOADED)return k;this._repository.requestRender()}return null}}a.GLMaterials=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,n){class h extends n.VertexNormalDrawParameters{constructor(k=b.create()){super();this.slicePlaneLocalOrigin=this.origin=k}}a.DrawParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports"],
function(a){class b{constructor(n=0,h=0){this.from=n;this.to=h}get numElements(){return this.to-this.from}}a.BufferRange=b;a.mergeAdjacentRanges=function(n){const h=new Map;n.forAll(m=>h.set(m.from,m));for(var k=!0;k;){k=!1;for(let m=0;m<n.length;++m){k=n.data[m];const g=h.get(k.to);if(!g)return;k.to=g.to;h.delete(g.from);n.removeUnordered(g);k=!0}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports",
"./BufferRange"],function(a,b){class n extends b.BufferRange{constructor(h,k,m){super(k,m);this.geometry=h}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}a.Instance=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define(["exports","../../../../../core/PooledArray","./BufferRange",
"./DrawCommand"],function(a,b,n,h){function k(){return new b({allocator:d=>d||new h.DrawCommand,deallocator:d=>d})}function m(d,c){const l=d.back();null==l?(d=d.pushNew(),d.first=c.from,d.count=c.numElements):l.first+l.count>=c.from?l.count=c.from-l.first+c.numElements:(d=d.pushNew(),d.first=c.from,d.count=c.numElements)}class g{constructor(){this._numElements=0;this._instances=new Map;this.holes=new b({allocator:d=>d||new n.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=
!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=k();this.drawCommandsHighlight=k();this.drawCommandsOccludees=k();this.drawCommandsShadowHighlightRest=k()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(d,c){this.deleteInstance(d);this._instances.set(d,c);this._numElements+=c.numElements}deleteInstance(d){const c=this._instances.get(d);c&&(this._numElements-=c.numElements,this._instances.delete(d))}updateInstance(d,c,l){if(d=this._instances.get(d))this._numElements-=
d.numElements,d.from=c,d.to=l,this._numElements+=d.numElements}updateDrawState(d){d.isVisible?(d.hasHighlights&&(this.hasHighlights=!0),d.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(d){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){d=Array.from(this._instances.values()).sort((l,
f)=>l.from===f.from?l.to-f.to:l.from-f.from);for(var c of d)c.isVisible&&(m(c.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,c),m(c.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,c))}else{const l=this.drawCommandsDefault.pushNew();c=this.holes.front();null!=this.vao&&1===this.holes.length&&c.to===Math.floor(this.vao.byteSize/d)?(l.first=0,l.count=c.from):(l.first=Infinity,l.count=0,this._instances.forEach(f=>{l.first=Math.min(l.first,f.from);l.count=
Math.max(l.count,f.to)}),l.count-=l.first)}}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}class e extends g{}a.PerBufferData=g;a.PerVaoData=e;a.hasVao=function(d){return null!=d.vao};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],function(a){class b{constructor(){this.count=this.first=0}}a.DrawCommand=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],function(a){class b{constructor(n){this.origin=n;this.buffers=[]}dispose(){this.buffers.forEach(n=>n.vao.dispose());this.buffers.length=0}findBuffer(n){return this.buffers.find(h=>h.instances.has(n))}}a.PerOriginData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define(["exports","../../../../../core/MemCachePool",
"../../lib/VertexArrayObject","../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,n,h,k){class m{constructor(g,e,d){this._rctx=g;this._locations=e;this._layout=d;this._cache=new b.MemCachePool(g.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(g){let e=this._cache.pop(g.toString());if(e)return e;e=new n.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},{geometry:h.BufferObject.createVertex(this._rctx,k.Usage.STATIC_DRAW)});e.vertexBuffers.geometry.setSize(g);
return e}deleteVao(g){null!=g&&this._cache.put(g.byteSize.toString(),g)}}a.VaoCache=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCachePool":function(){define(["exports","./MemCache"],function(a,b){class n{constructor(h,k){this._cache=h(k,(m,g,e)=>this._remove(m,g,e))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(h){return this._cache.getSize(h)}pop(h){const k=this._cache.peek(h);if(k){var m=k.pop();if(0<
k.length){if(m){const g=this._cache.getSize(h)-Math.round(m.usedMemory);this._cache.updateSize(h,k,g)}}else this._cache.pop(h);return m}}put(h,k,m=b.NoPriority){const g=this._cache.peek(h);g?(g.push(k),k=this._cache.getSize(h)+Math.round(k.usedMemory),this._cache.updateSize(h,g,k)):this._cache.put(h,[k],k.usedMemory,m)}_remove(h,k,m){switch(k){case b.RemoveMode.ALL:return h.forEach(g=>g.dispose()),0;case b.RemoveMode.SOME:if(h=h.shift())m-=Math.round(h.usedMemory),h.dispose();return m}}}a.MemCachePool=
n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d){class c extends k.ShaderTechnique{initializeProgram(l){return new g.Program(l.rctx,c.shader.get().build(),
m.Default3D)}initializePipeline(){return this.configuration.hasAlpha?d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams}):d.makePipelineState({colorWrite:d.defaultColorWriteParams})}}c.shader=new h.ReloadableShaderModule(n.TextureOnly,()=>new Promise((l,f)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],l,f)));b.TextureTechnique=c;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.hasAlpha=!1}}b.__decorate([n.parameter()],h.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e){function d(){const f=new g.ShaderBuilder;f.include(n.ScreenSpacePass);f.fragment.uniforms.add(new e.Texture2DPassUniform("tex",r=>r.texture));f.fragment.uniforms.add(new k.IntegerPassUniform("overlayIdx",r=>r.overlayIndex));f.fragment.uniforms.add(new h.FloatPassUniform("opacity",r=>r.opacity));f.fragment.code.add(m.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`);return f}class c extends m.NoParameters{constructor(){super(...arguments);this.overlayIndex=b.OverlayIndex.INNER;this.opacity=1}}const l=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:c,build:d},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=l;a.OverlayCompositingPassParameters=c;a.build=d})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends h.ShaderTechnique{initializeProgram(l){return new m.Program(l.rctx,c.shader.get().build(),k.Default3D)}initializePipeline(){return d.makePipelineState({blending:d.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}}c.shader=new n.ReloadableShaderModule(g.OverlayCompositing,()=>new Promise((l,f)=>a(["./OverlayCompositing.glsl"],l,f)));b.OverlayCompositingTechnique=c;Object.defineProperty(b,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Normals":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/FloatArray"],function(a,b,n,h,k){function m(c,l,f,r,x,w=2){var p=1/(Math.abs(f)+Math.abs(r)+Math.abs(x));f*=p;r*=p;p=0>=x?(0<=r?1:-1)*(1-Math.abs(f)):r;l*=w;c[l]=e(0>=x?(0<=f?1:-1)*(1-Math.abs(r)):f);c[l+1]=e(p)}function g(c,l,f,r=2){r*=f;f=d(l[r]);l=d(l[r+1]);r=1-Math.abs(f)-
Math.abs(l);c[2]=r;0>r?(c[0]=(0<=f?1:-1)*(1-Math.abs(l)),c[1]=(0<=l?1:-1)*(1-Math.abs(f))):(c[0]=f,c[1]=l);n.normalize(c,c)}function e(c){return b.clamp(Math.round(32767*c),-32767,32767)}function d(c){return b.clamp(c/32767,-1,1)}a.compressAndTransformNormals=function(c,l){const f=c.length/3,r=new Int16Array(2*f);let x=0;const w=h.create();for(let p=0;p<f;++p)w[0]=c[x++],w[1]=c[x++],w[2]=c[x++],n.transformMat3(w,w,l),m(r,p,w[0],w[1],w[2]);return r};a.compressNormal=m;a.compressNormals=function(c){const l=
c.length/3,f=new Int16Array(2*l);let r=0;for(let x=0;x<l;++x)m(f,x,c[r++],c[r++],c[r++]);return f};a.decodeInt16=d;a.decompressNormal=g;a.decompressNormals=function(c,l=2){const f=c.length/l,r=k.newFloatArray(3*f),x=h.create();let w=0;for(let p=0;p<f;++p)g(x,c,p,l),r[w++]=x[0],r[w++]=x[1],r[w++]=x[2];return r};a.encodeInt16=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../Color ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/OverrideHelper ../../../../symbols/cim/utils ../../../../symbols/support/cimSymbolUtils ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/Symbol3DAnchorPosition2D ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q){function V(aa){return null==aa?!1:"cross"===aa||"x"===aa}const U=r.fromValues(0,0,1),W=N.defaultTexSize,ca=N.defaultSymbolSizeRatio,X=[ca/2,ca/2,1-ca/2,1-ca/2];class ba extends z.Graphics3DSymbolLayer{getCachedSize(){return{size:this._getIconSize()}}constructor(aa,ea,ha,Y){super(aa,ea,ha,Y);this._cimSymbolMaterials=new Map;this._cimSymbolTextures=new Map;this._size=this._cimMaterialParametersInfo=null;this._symbolTextureRatio=
1;this._outlineSize=0;this._patchTask=null;this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(aa){this._validateOrThrow();const ea=this._prepareMaterialParameters();var ha=this._getPrimitive();if(null!=ha)this._prepareResourcesPrimitive(ea,ha);else{ha=A.getIconHref(this.symbolLayer);const Y=this._getCIMResource(ha);null!=Y?await this._prepareResourcesCIM(ea,JSON.parse(Y),aa):await this._prepareResourcesHref(ea,ha,aa)}}_getCIMResource(aa){aa=l.dataComponents(aa);
return"application/json"===aa?.mediaType?aa.data:void 0}_validateOrThrow(){if(!this._drivenProperties.size){var aa=K.validateSymbolLayerSize(this._getIconSize());if(aa)throw new k("graphics3diconsymbollayer:invalid-size",aa);}}_getIconSize(){var aa=this.symbolLayer;aa=Math.round(null!=aa.size?d.pt2px(aa.size):16);return this._drivenProperties.size?Math.max(aa,64):aa}_generateTextureCIM(aa){var ea=this._cimData;ea&&ea.symbol||this.logger.error("Can't create texture, CIM data is undefined");if(ea.primitiveOverrides){ea=
m.clone(ea);var ha=ea.primitiveOverrides;u.OverrideHelper.evaluateOverrides(ha,aa,this._arcadeInfo.geometryType,null,null);u.OverrideHelper.applyOverrides(ea.symbol,ha)}ha=c.numericHash(JSON.stringify(ea));var Y=this._cimSymbolTextures.get(ha);if(Y)return Y;Y=this._context.sharedResources.cimSymbolRasterizer;const Z=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;Z&&u.OverrideHelper.applyDictionaryTextOverrides(ea.symbol,aa,Z,null);aa=null!=
this._cimScaleFactorOrFunction?v.evaluateValueOrFunction(this._cimScaleFactorOrFunction,aa):1;1!==aa&&ea.symbol&&y.scaleCIMSymbol(ea.symbol,aa,!0);(aa=q.CIMSymbolHelper.getEnvelope(ea,null,Y.resourceManager))&&aa.width&&aa.height?(ea=Y.rasterize({type:"cim",data:ea},aa.width,aa.height,aa.x+aa.width/2,aa.y+aa.height/2,1,"esriGeometryPoint"),aa=new G.Symbol3DAnchorPosition2D({x:-aa.x/aa.width-.5,y:(aa.height+aa.y)/aa.height-.5}),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",
aa),Y=new T.Texture(ea,{width:ea?.width??1,height:ea?.height??1})):Y=new T.Texture(new ImageData(1,1),{width:1,height:1});this._cimSymbolTextures.set(ha,Y);this._context.stage.add(Y);return Y}_prepareMaterialParameters(){const aa={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ea=this.symbol;if(ea&&"point-3d"===ea.type&&ea.hasVisibleVerticalOffset()){const {screenLength:ha,minWorldLength:Y,maxWorldLength:Z}=ea.verticalOffset;aa.verticalOffset={screenLength:d.pt2px(ha),
minWorldLength:Y||0,maxWorldLength:null!=Z?Z:Infinity}}this._context.screenSizePerspectiveEnabled&&(aa.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);aa.occlusionTest=!0;aa.hasSlicePlane=this._context.slicePlaneEnabled;return aa}_prepareResourcesPrimitive(aa,ea){var ha=this._getOutlineSize();if(V(ea)&&0===ha)throw Error("Nothing to render");this._outlineSize=ha;aa.color=this._getFillColor();aa.outlineColor=this._getOutlineColor();aa.outlineSize=this._outlineSize;
null!=this._context.sharedResources.textures&&(this._textureHandle=ha=this._context.sharedResources.textures.fromData(`${ea}-icon`,()=>N.createTexture(ea)),aa.textureId=ha.texture.id);aa.textureIsSignedDistanceField=!0;aa.sampleSignedDistanceFieldTexelCenter=N.requiresHalfTexelOffset(ea);aa.distanceFieldBoundingBox=X;ha=this._getIconSize();this._size=[ha,ha];this._symbolTextureRatio=1/ca;this._createMaterialAndAddToStage(aa,this._context.stage)}async _prepareResourcesHref(aa,ea,ha){this._outlineSize=
this._getOutlineSize();aa.color=this._getFillColor();aa.outlineColor=this._getOutlineColor();aa.outlineSize=this._outlineSize;aa.textureIsSignedDistanceField=!1;const Y=this._getIconSize(),Z=Y*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(null!=this._context.sharedResources.textures){ha=await h.result(this._context.sharedResources.textures.fromUrl(ea,Z,{signal:ha}));if(!1===ha.ok)throw e.throwIfAbortError(ha.error),new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ea})`);
this._textureHandle=ha.value;ea=ha.value.texture;this._size=this._computeSizeFromTexture(ea,Y);aa.textureId=ea.id}this._createMaterialAndAddToStage(aa,this._context.stage)}async _prepareResourcesCIM(aa,ea,ha){this._cimData=ea;if(!this._context.sharedResources.cimSymbolRasterizer){var Y=(await new Promise((oa,qa)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],oa,qa))).CIMSymbolRasterizer;e.throwIfAborted(ha);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=
new Y(this._context.renderCoordsHelper.spatialReference))}var Z=this._context.sharedResources.cimSymbolRasterizer;Y=[];const ja=ea?.symbol;q.CIMSymbolHelper.fetchResources(ja,Z.resourceManager,Y,ha);q.CIMSymbolHelper.fetchFonts(ja,Z.resourceManager,Y);Z=this._context.layer.fields?this._context.layer.fields.map(oa=>oa.toJSON()):[];this._arcadeInfo={spatialReference:this._context.renderCoordsHelper.spatialReference,fields:Z,geometryType:"esriGeometryPoint"};ea?.primitiveOverrides&&Y.push(u.OverrideHelper.createRenderExpressions(ea.primitiveOverrides,
this._arcadeInfo));0<Y.length&&(await Promise.all(Y),e.throwIfAborted(ha));if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression&&(ea=this._context.renderer,ea.scaleExpression)){const oa=await t.createRendererExpression(ea.scaleExpression,this._context.layer.spatialReference,Z);this._cimScaleFactorOrFunction=(qa,ta,va)=>{qa=C(oa,qa,{$view:va},"esriGeometryPoint",ta);return null!==qa?qa:1}}e.throwIfAborted(ha);this._cimMaterialParametersInfo=
aa;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||D.defaultPrimitive}_getOutlineSize(){var aa=0;aa=this.symbolLayer;if(null!=aa.outline?.size)return Math.max(d.pt2px(aa.outline.size),
0);aa=this._getPrimitive();aa=V(aa)?1.5:0;return Math.max(aa,0)}_getOutlineColor(){const aa=this._getLayerOpacity(),ea=this.symbolLayer?.outline?.color;if(null!=ea){const ha=n.toUnitRGB(ea);return[ha[0],ha[1],ha[2],ea.a*aa]}return[0,0,0,0]}_getFillColor(){if(V(this._getPrimitive()))return E.transparentUnit;const aa=null==this._getPrimitive();return this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color,{hasIntrinsicColor:aa})}_getAnchorPos(aa,ea){return"relative"===aa?f.fromValues((ea.x||
0)+.5,-(ea.y||0)+.5):aa in F.namedAnchorToHUDMaterialAnchorPos?F.namedAnchorToHUDMaterialAnchorPos[aa]:F.namedAnchorToHUDMaterialAnchorPos.center}_createMaterialAndAddToStage(aa,ea){if(this._cimData){this._fastUpdates=null;let ha=aa.textureId?this._cimSymbolMaterials.get(aa.textureId):null;ha||(ha=new Q.HUDMaterial(aa),this._cimSymbolMaterials.set(aa.textureId??0,ha),ea.add(ha));return ha}(this._fastUpdates=S.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()))&&
(aa={...aa,...this._fastUpdates.materialParameters});this._materials[0]=new Q.HUDMaterial(aa);ea.add(this._materials[0]);return this._materials[0]}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(aa=>{aa.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy();this._patchTask=g.abortMaybe(this._patchTask);this._forEachMaterial(aa=>this._context.stage.remove(aa));
this._materials.length=0;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(aa=>this._context.stage.remove(aa));this._cimSymbolTextures.clear();this._textureHandle=g.releaseMaybe(this._textureHandle)}_getScaleFactor(aa,ea){if(this._drivenProperties.size&&aa.size){for(let ha=0;3>ha;ha++){const Y=aa.size[ha];Y&&"symbol-value"!==Y&&"proportional"!==Y&&(aa.size[ha]=d.pt2px(Y))}if("symbol-value"===aa.size[0])return 1;if(isFinite(+aa.size[0]))return+aa.size[0]/ea;if(isFinite(+aa.size[2]))return+aa.size[2]/
ea}return 1}createGraphics3DGraphic(aa){const ea=aa.graphic;if(!this._validateGeometry(ea.geometry))return null;var ha=[0,0];let Y;if(this._cimData){if(!this._cimData.symbol)return null;var Z=this._generateTextureCIM(ea);Y=this._createMaterialAndAddToStage({textureId:Z.id,...this._cimMaterialParametersInfo},this._context.stage);var ja=window.devicePixelRatio||1;ha=[Z.parameters.width/ja,Z.parameters.height/ja]}else ha=this._size,Y=this._materials[0];Z=M.placePointOnGeometry(ea.geometry);if(null==
Z)return this.logger.warn(`unsupported geometry type for icon symbol: ${ea.geometry.type}`),null;var oa=aa.renderingInfo;ja=this._getVertexOpacityAndColor(oa);let qa=1;this._fastUpdates?.visualVariables.size||(qa=this._getScaleFactor(oa,ha[0]>ha[1]?ha[0]:ha[1]));qa*=this._symbolTextureRatio;ha=f.fromValues(ha[0]*qa,ha[1]*qa);oa=this.setGraphicElevationContext(ea);this.ensureDrapedStatus("on-the-ground"===oa.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ea,
Z,Y,ja,ha,aa.layer.uid):this._createAs3DShape(ea,Z,Y,ja,ha,oa,ea.uid)}layerOpacityChanged(){const aa=this._getFillColor(),ea=this._getOutlineColor();this._forEachMaterial(ha=>{ha.setParameters({color:aa});ha.setParameters({outlineColor:ea})})}layerElevationInfoChanged(aa,ea,ha){const Y=this._elevationContext.mode;ha=H.elevationModeChangeUpdateType(ba.elevationModeChangeTypes,ha,Y);if(ha!==H.SymbolUpdateType.UPDATE)return ha;const Z=H.needsElevationUpdates2D(Y)||"absolute-height"===Y;return this.updateGraphics3DGraphicElevationInfo(aa,
ea,()=>Z)}slicePlaneEnabledChanged(){this.draped||this._forEachMaterial(aa=>{aa.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return null!=this._getPrimitive()}applyRendererDiff(aa,ea){for(const ha in aa.diff)switch(ha){case "visualVariables":if(S.updateFastSymbolUpdatesState(this._fastUpdates,ea,this._fastVisualVariableConvertOptions()))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);
else return L.ApplyRendererDiffResult.RecreateSymbol;break;default:return L.ApplyRendererDiffResult.RecreateSymbol}return L.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(aa){this._patchTask?.abort();"partial"===aa.diff.type&&this._preparePatchResource(aa,aa.diff.diff)}_preparePatchResource(aa,ea){if(ea.resource&&"partial"===ea.resource.type&&(ea=ea.resource.diff,"complete"===ea?.href?.type)){var ha=ea.href.newValue,{textures:Y}=this._context.sharedResources;if(null!=ha&&null!=Y&&null==
this._getCIMResource(ha)){var Z=this._getIconSize(),ja=Z*this._context.graphicsCoreOwner.view.state.pixelRatio;aa.symbolLayerStatePatches.push(()=>{this._patchTask=g.abortMaybe(this._patchTask);this._patchTask=h.createTask(oa=>this._context.schedule(async(qa,ta)=>{qa=await h.result(Y.fromUrl(ha,ja,{signal:ta}));e.throwIfAborted(ta);(ta=!qa.ok)&&e.throwIfAbortError(qa.error);this._textureHandle=g.releaseMaybe(this._textureHandle);this._patchTask=null;if(ta)this._forEachMaterial(Ca=>{Ca.visible=!1;
Ca.setParameters({textureId:null})}),this.logger.error(new k("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ha})`));else{this._textureHandle=qa.value;var va=qa.value.texture;this._size=this._computeSizeFromTexture(va,Z);this._forEachMaterial(Ca=>{Ca.setParameters({textureId:va.id});Ca.visible=!0})}},oa))});delete ea.href}}}_defaultElevationInfoNoZ(){return ia}_createAs3DShape(aa,ea,ha,Y,Z,ja,oa){aa=this.getFastUpdateAttrValues(aa);const qa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:oa,
layerUid:this._context.layer.uid});Y=R.createPointGeometry(ha,U,null,Y,Z,fa,null,aa,qa);oa=M.createStageObject(this._context,ea,Y,ja,oa);if(null==oa)return null;const ta=new B.Graphics3DObject3DGraphicLayer(this,oa.object,[Y],null,null,I.perObjectElevationAligner,ja);ta.alignedSampledElevation=oa.sampledElevation;ta.needsElevationUpdates=H.needsElevationUpdates2D(ja.mode)||"absolute-height"===ja.mode;ta.getScreenSize=this._createScreenSizeGetter(Z,aa);ta.calculateRelativeScreenBounds=va=>ha.calculateRelativeScreenBounds(ta.getScreenSize(),
1,va);M.extendPointGraphicElevationContext(ta,ea,this._context.elevationProvider);return ta}_createAsOverlay(aa,ea,ha,Y,Z,ja){ha.renderPriority=this._renderPriority;const oa=r.create();w.projectPointToVector(ea,oa,this._context.overlaySR);oa[2]=P.drapedZ;ea=this._context.clippingExtent;if(null!=ea&&!p.containsPoint(ea,oa))return null;ea=this.getFastUpdateAttrValues(aa);const qa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:aa.uid,layerUid:this._context.layer.uid});Y=R.createPointGeometry(ha,
U,oa,Y,Z,null,null,ea,qa);aa=new O.RenderGeometry(Y,{layerUid:ja,graphicUid:aa.uid});const ta=new J.Graphics3DDrapedGraphicLayer(this,[aa],null,this._context.drapeSourceRenderer);ta.getScreenSize=this._createScreenSizeGetter(Z,ea);ta.calculateRelativeScreenBounds=va=>ha.calculateRelativeScreenBounds(ta.getScreenSize(),1,va);return ta}_createScreenSizeGetter(aa,ea){const ha=this._outlineSize+2;if(this._fastUpdates&&ea){const ja=aa[0]/this._symbolTextureRatio,oa=aa[1]/this._symbolTextureRatio;return(qa=
f.create())=>{const [ta,va]=S.evaluateModelTransformScale(da,this._fastUpdates.materialParameters,ea);qa[0]=ta*ja+ha;qa[1]=va*oa+ha;return qa}}const Y=aa[0]/this._symbolTextureRatio+ha,Z=aa[1]/this._symbolTextureRatio+ha;return(ja=f.create())=>{ja[0]=Y;ja[1]=Z;return ja}}_fastVisualVariableConvertOptions(){var aa=Math.max(this._size[0],this._size[1]);const ea=r.fromValues(aa,aa,aa),ha=d.px2pt(1);aa*=ha;aa=r.fromValues(aa,aa,aa);return new S.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},
ea,aa,ha)}_forEachMaterial(aa){this._materials.forEach(aa);this._cimSymbolMaterials.forEach(aa)}_computeSizeFromTexture({parameters:aa},ea){aa=(aa.width??1)/(aa.height??1);return 1<aa?[ea,Math.round(ea/aa)]:[Math.round(ea*aa),ea]}test(){return{...super.test(),material:this._materials[0]}}}ba.PRIMITIVE_SIZE=[W*ca,W*ca];ba.elevationModeChangeTypes={definedChanged:H.SymbolUpdateType.UPDATE,staysOnTheGround:H.SymbolUpdateType.NONE,onTheGroundChanged:H.SymbolUpdateType.RECREATE};const ia={mode:"relative-to-ground",
offset:0},fa=x.fromValues(0,0,0,1),da=r.create();b.Graphics3DIconSymbolLayer=ba;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define("exports ../../core/BidiText ../../core/has ../../core/lang ../../core/Logger ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../Font ./CIMPlacements ./CIMSymbolDrawHelper ./defaultCIMValues ./enums ./utils ../support/defaults ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){function v(T,Q,V){switch(Q.type){case "CIMSymbolReference":return v(T,Q.symbol,V);case "CIMPointSymbol":null==V&&(V={x:0,y:0});T.drawSymbol(Q,V);break;case "CIMLineSymbol":null==V&&(V={paths:[[[0,0],[10,0]]]});T.drawSymbol(Q,V);break;case "CIMPolygonSymbol":null==V&&(V={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]});T.drawSymbol(Q,V);break;case "CIMTextSymbol":T.drawSymbol(Q,{x:0,y:0});break;case "CIMVectorMarker":V=new l.Placement,T.drawMarker(Q,V)}return T.envelope()}
function y(T){if(!T)return 0;switch(T.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(T.offset);case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(T.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(T.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(T.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(T.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(T.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(T.offset);
case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}function D(T){if(!T)return 0;switch(T.type){case "CIMGeometricEffectArrow":return Math.abs(.5*T.width);case "CIMGeometricEffectBuffer":return Math.abs(T.size);case "CIMGeometricEffectExtension":return Math.abs(T.length);case "CIMGeometricEffectJog":return Math.abs(.5*T.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(w.getValue(T.offsetX)),Math.abs(w.getValue(T.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(T.offset);
case "CIMGeometricEffectOffsetTangent":return Math.abs(T.offset);case "CIMGeometricEffectRadial":return Math.abs(T.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(T.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(T.fromWidth),Math.abs(T.toWidth));case "CIMGeometricEffectWave":return Math.abs(T.amplitude);case "CIMGeometricEffectDonut":return Math.abs(T.width);default:return 0}}
function G(T){if(!T)return 0;let Q=0;for(const V of T)Q+=D(V);return Q}function A(T,Q){if(T)switch(T.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(T=T.symbolLayers)for(const V of T)switch(Q(V),V.type){case "CIMVectorMarker":if(T=V.markerGraphics)for(const U of T)U&&(T=U.symbol)&&A(T,Q)}}}function C(T,Q,V){T.effects&&null==Q.geometryEngine&&(Q.geometryEnginePromise?V.push(Q.geometryEnginePromise):w.isGeometryEngineRequired(T.effects)&&(Q.geometryEnginePromise=w.importGeometryEngine(),
V.push(Q.geometryEnginePromise),Q.geometryEnginePromise.then(U=>Q.geometryEngine=U)))}function E(T){if(!T)return null;let Q=null;const {cap:V,color:U,join:W,miterLimit:ca,style:X,width:ba}=T;"solid"!==X&&"none"!==X&&"esriSLSSolid"!==X&&"esriSLSNull"!==X&&(Q=[{type:"CIMGeometricEffectDashes",dashTemplate:R(X,V),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);return{type:"CIMSolidStroke",color:"esriSLSNull"!==X&&"none"!==X?P(U):[0,0,0,0],capStyle:F(V),joinStyle:M(W),miterLimit:ca,
width:ba,effects:Q}}const I=Math.PI,H=I/2,J=Math.PI/180,B=96/72,z=()=>k.getLogger("esri.symbols.cim.CIMSymbolHelper");class K{static getSymbolInflateSize(T,Q,V,U,W){T||=[0,0,0,0];return Q?this._getInflateSize(T,Q,V,U,W):T}static safeSize(T){const Q=Math.max(Math.abs(T[0]),Math.abs(T[2]));T=Math.max(Math.abs(T[1]),Math.abs(T[3]));return Math.sqrt(Q*Q+T*T)}static _vectorMarkerBounds(T,Q,V,U){let W=!0;const ca=e.create();if(Q?.markerGraphics)for(const X of Q.markerGraphics)Q=[0,0,0,0],X.geometry&&(d.getBoundsXY(ca,
X.geometry),Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=0,this.getSymbolInflateSize(Q,X.symbol,V,0,U),ca[0]+=Q[0],ca[1]+=Q[1],ca[2]+=Q[2],ca[3]+=Q[3],W?(T[0]=ca[0],T[1]=ca[1],T[2]=ca[2],T[3]=ca[3],W=!1):(T[0]=Math.min(T[0],ca[0]),T[1]=Math.min(T[1],ca[1]),T[2]=Math.max(T[2],ca[2]),T[3]=Math.max(T[3],ca[3])));return T}static _getInflateSize(T,Q,V,U,W){return void 0!==Q.symbolLayers?(T=this._getLayersInflateSize(T,Q.symbolLayers,V,U,W),Q=G(Q.effects),0<Q&&(T[0]-=Q,T[1]-=Q,T[2]+=Q,T[3]+=Q),T):this._getTextInflatedSize(T,
Q,W)}static _getLayersInflateSize(T,Q,V,U,W){let ca=!0;if(!Q)return T;for(const aa of Q)if(aa){Q=[0,0,0,0];switch(aa.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":var X=aa,ba=X.width;null!=ba&&(ba=X.capStyle===x.LineCapStyle.Square||X.joinStyle===x.LineJoinStyle.Miter?ba/1.4142135623730951:ba/2,Q[0]=-ba,Q[1]=-ba,Q[2]=ba,Q[3]=ba);break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":X=aa;if("CIMVectorMarker"===aa.type){if(ba=aa,Q=this._vectorMarkerBounds(Q,
ba,V,W),ba.frame){var ia=(ba.frame.xmin+ba.frame.xmax)/2,fa=(ba.frame.ymin+ba.frame.ymax)/2;Q[0]-=ia;Q[1]-=fa;Q[2]-=ia;Q[3]-=fa;null!=ba.size&&(ba=ba.size/(ba.frame.ymax-ba.frame.ymin),Q[0]*=ba,Q[1]*=ba,Q[2]*=ba,Q[3]*=ba)}}else"CIMPictureMarker"===aa.type?(ba=aa,fa=V.getResource(ba.url),ia=1,null!=fa&&fa.height&&(ia=fa.width/fa.height),null!=X.size&&(Q=X.size/2,ba=X.size*ia*ba.scaleX/2,Q=[-ba,-Q,ba,Q])):null!=X.size&&(Q=X.size/2,Q=[-Q,-Q,Q,Q]);X.anchorPoint&&("Absolute"===X.anchorPointUnits?(ba=X.anchorPoint.x,
ia=X.anchorPoint.y):(ba=X.anchorPoint.x*(Q[2]-Q[0]),ia=X.anchorPoint.y*(Q[3]-Q[1])),Q[0]-=ba,Q[1]-=ia,Q[2]-=ba,Q[3]-=ia);ba=w.getValue(X.rotation);X.rotateClockwise&&(ba=-ba);U&&(ba-=U);ba&&(ia=J*ba,ba=Math.cos(ia),ia=Math.sin(ia),fa=e.create([t.cInfinity,t.cInfinity,-t.cInfinity,-t.cInfinity]),e.expandPointInPlace(fa,[Q[0]*ba-Q[1]*ia,Q[0]*ia+Q[1]*ba]),e.expandPointInPlace(fa,[Q[0]*ba-Q[3]*ia,Q[0]*ia+Q[3]*ba]),e.expandPointInPlace(fa,[Q[2]*ba-Q[1]*ia,Q[2]*ia+Q[1]*ba]),e.expandPointInPlace(fa,[Q[2]*
ba-Q[3]*ia,Q[2]*ia+Q[3]*ba]),Q=fa);ba=w.getValue(X.offsetX);ia=w.getValue(X.offsetY);if(U){var da=J*U;fa=Math.cos(da);da=Math.sin(da);const ea=ba*da+ia*fa;ba=ba*fa-ia*da;ia=ea}Q[0]+=ba;Q[1]+=ia;Q[2]+=ba;Q[3]+=ia;X=y(X.markerPlacement);0<X&&(Q[0]-=X,Q[1]-=X,Q[2]+=X,Q[3]+=X)}X=G(aa.effects);0<X&&(Q[0]-=X,Q[1]-=X,Q[2]+=X,Q[3]+=X);ca?(T[0]=Q[0],T[1]=Q[1],T[2]=Q[2],T[3]=Q[3],ca=!1):(T[0]=Math.min(T[0],Q[0]),T[1]=Math.min(T[1],Q[1]),T[2]=Math.max(T[2],Q[2]),T[3]=Math.max(T[3],Q[3]))}return T}static _getTextInflatedSize(T,
Q,V){const U=Q.height??r.defaultCIMValues.CIMTextSymbol.height;T[0]=-U/2;T[1]=-U/2;T[2]=U/2;T[3]=U/2;if(!V)return T;V=V.get(Q);if(!V||!V.glyphMosaicItems.glyphs.length)return T;const {lineGapType:W,lineGap:ca}=Q,X=W?f.lineGapType2LineHeight(W,ca??0,U):0,ba="CIMBackgroundCallout"===Q.callout?.type;Q=u.shapeGlyphs(V.glyphMosaicItems,{scale:U/q.glyphSize,angle:w.getValue(Q.angle),xOffset:w.getValue(Q.offsetX),yOffset:w.getValue(Q.offsetY),horizontalAlignment:Q.horizontalAlignment,verticalAlignment:Q.verticalAlignment,
maxLineWidth:512,lineHeight:q.magicLabelLineHeight*Math.max(.25,Math.min(X||1,4)),decoration:Q.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:ba}).boundsT;T[0]=Q.x-Q.halfWidth;T[1]=-Q.y-Q.halfHeight;T[2]=Q.x+Q.halfWidth;T[3]=-Q.y+Q.halfHeight;return T}}class L{static getEnvelope(T,Q,V){if(!T)return null;V=new f.EnvDrawHelper(V);if(Array.isArray(T)){let U;for(const W of T)U?U.union(v(V,W,Q)):U=v(V,W,Q);return U}return v(V,T,Q)}static getTextureAnchor(T,Q){T=this.getEnvelope(T,null,Q);
if(!T)return[0,0,0];Q=T.height*B+2;return[-((T.x+.5*T.width)*B)/(T.width*B+2),-((T.y+.5*T.height)*B)/Q,Q]}static rasterize(T,Q,V,U,W=!0){var ca=V||this.getEnvelope(Q,null,U);if(!ca)return[null,0,0,0,0];const X=(ca.x+.5*ca.width)*B,ba=(ca.y+.5*ca.height)*B;T.width=ca.width*B;T.height=ca.height*B;V||(T.width+=2,T.height+=2);V=T.getContext("2d",{willReadFrequently:!0});ca=f.Transformation.createScale(B,-B);ca.translate(.5*T.width-X,.5*T.height+ba);U=new f.CanvasDrawHelper(V,U,ca);switch(Q.type){case "CIMPointSymbol":U.drawSymbol(Q,
{type:"point",x:0,y:0});break;case "CIMVectorMarker":ca=new l.Placement,U.drawMarker(Q,ca)}Q=V.getImageData(0,0,T.width,T.height);Q=new Uint8Array(Q.data);if(W)for(U=0;U<Q.length;U+=4)W=Q[U+3]/255,Q[U]*=W,Q[U+1]*=W,Q[U+2]*=W;return[Q,T.width,T.height,-X/T.width,-ba/T.height]}static fromTextSymbol(T){const {text:Q}=T;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,
ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:L.createCIMTextSymbolfromTextSymbol(T),textString:Q}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(T){const {height:Q,outline:V,width:U,xoffset:W,xscale:ca,yoffset:X,yscale:ba}=T,ia=[],fa={type:"CIMPolygonSymbol",symbolLayers:ia};if(V){var da=E(V);da&&ia.push(da)}da=T.url;"esriPFS"===T.type&&T.imageData&&(da=T.imageData);T="angle"in T?T.angle??
0:0;ia.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:x.TextureFilter.Picture,tintColor:null,url:da,height:(Q??0)*(ba||1),width:(U??0)*(ca||1),offsetX:w.getValue(W),offsetY:w.getValue(X),rotation:w.getValue(-T),colorSubstitutions:null});return fa}static fromSimpleFillSymbol(T){const {color:Q,style:V,outline:U}=T;T=[];const W={type:"CIMPolygonSymbol",symbolLayers:T};if(U){var ca=E(U);ca&&T.push(ca)}if(V&&"solid"!==V&&"none"!==V&&"esriSFSSolid"!==V&&"esriSFSNull"!==V){ca=
{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:P(Q),capStyle:x.LineCapStyle.Butt,joinStyle:x.LineJoinStyle.Miter,width:.75}]};let X=0;const ba=g.px2pt("vertical"===V||"horizontal"===V||"cross"===V||"esriSFSCross"===V||"esriSFSVertical"===V||"esriSFSHorizontal"===V?8:10);switch(V){case "vertical":case "esriSFSVertical":X=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":X=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":X=45;break;case "cross":case "esriSFSCross":X=
0;break;case "diagonal-cross":case "esriSFSDiagonalCross":X=-45}T.push({type:"CIMHatchFill",lineSymbol:ca,offsetX:0,offsetY:0,rotation:X,separation:ba});"cross"===V||"esriSFSCross"===V?T.push({type:"CIMHatchFill",lineSymbol:h.clone(ca),offsetX:0,offsetY:0,rotation:90,separation:ba}):("diagonal-cross"===V||"esriSFSDiagonalCross"===V)&&T.push({type:"CIMHatchFill",lineSymbol:h.clone(ca),offsetX:0,offsetY:0,rotation:45,separation:ba})}else!V||"solid"!==V&&"esriSFSSolid"!==V||T.push({type:"CIMSolidFill",
enable:!0,color:P(Q)});return W}static fromSimpleLineSymbol(T){const {cap:Q,color:V,join:U,marker:W,miterLimit:ca,style:X,width:ba}=T;T=null;"solid"!==X&&"none"!==X&&"esriSLSSolid"!==X&&"esriSLSNull"!==X&&(T=[{type:"CIMGeometricEffectDashes",dashTemplate:R(X,Q),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const ia=[];if(W){let fa;switch(W.placement){case "begin-end":fa=x.ExtremityPlacement.Both;break;case "begin":fa=x.ExtremityPlacement.JustBegin;break;case "end":fa=x.ExtremityPlacement.JustEnd;
break;default:fa=x.ExtremityPlacement.None}const da=L.fromSimpleMarker(W,ba,V).symbolLayers[0];da.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:fa,offsetAlongLine:0};ia.push(da)}ia.push({type:"CIMSolidStroke",color:"none"!==X&&"esriSLSNull"!==X?P(V):[0,0,0,0],capStyle:F(Q),joinStyle:M(U),miterLimit:ca,width:ba,effects:T});return{type:"CIMLineSymbol",symbolLayers:ia}}static fromPictureMarker(T){const {angle:Q,height:V,width:U,xoffset:W,yoffset:ca}=
T;let X=T.url;"esriPMS"===T.type&&T.imageData&&(X=T.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:x.TextureFilter.Picture,tintColor:null,url:X,size:V,width:U,offsetX:w.getValue(W),offsetY:w.getValue(ca),rotation:w.getValue(-Q)}]}}static createCIMTextSymbolfromTextSymbol(T){const {angle:Q,color:V,font:U,haloColor:W,haloSize:ca,horizontalAlignment:X,kerning:ba,text:ia,verticalAlignment:fa,xoffset:da,yoffset:aa,backgroundColor:ea,
borderLineColor:ha,borderLineSize:Y}=T;let Z,ja,oa;if(U){var qa=U.family;var ta=U.style;var va=U.weight;Z=U.size;ja=U.decoration}T=!1;ia&&(T=b.bidiText(ia)[1]);if(ea||Y)oa={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:P(ea)},{type:"CIMSolidStroke",color:P(ha),width:Y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null};var Ca=x.BlockProgression.BTT,ma=x.FontEffects.Normal,wa=x.FontEncoding.Unicode;qa=qa||
"Arial";b:{if(va)switch(va.toLowerCase()){case "bold":case "bolder":va="bold";break b}va=""}b:{if(ta)switch(ta.toLowerCase()){case "italic":case "oblique":ta="italic";break b}ta=""}va=va&&ta?`${va}-${ta}`:`${va}${ta}`;return{type:"CIMTextSymbol",angle:Q,blockProgression:Ca,depth3D:1,extrapolateBaselines:!0,fontEffects:ma,fontEncoding:wa,fontFamilyName:qa,fontStyleName:va,fontType:x.FontType.Unspecified,haloSize:ca,height:Z,hinting:x.GlyphHinting.Default,horizontalAlignment:S(X??"center"),kerning:ba,
letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:w.getValue(da),offsetY:w.getValue(aa),strikethrough:"line-through"===ja,underline:"underline"===ja,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:P(V)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:P(W)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:T?x.TextReadingDirection.RTL:x.TextReadingDirection.LTR,verticalAlignment:N(fa??
"baseline"),verticalGlyphOrientation:x.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:x.BillBoardMode.FaceNearPlane,callout:oa}}static createPictureMarkerRasterizationParam(T){const {angle:Q,height:V,width:U,xoffset:W,yoffset:ca}=T;return(T=T.url??T.source?.url??T.source?.imageData)?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:x.TextureFilter.Picture,tintColor:null,url:T,size:V,width:U,offsetX:w.getValue(W),
offsetY:w.getValue(ca),rotation:w.getValue(-Q)}}:null}static createPictureFillRasterizationParam(T){const {width:Q,height:V,xoffset:U,yoffset:W,url:ca}=T;return ca?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:x.TextureFilter.Picture,tintColor:null,url:ca,width:Q,height:V,offsetX:w.getValue(U),offsetY:w.getValue(W),rotation:0}}:null}static fromSimpleMarker(T,Q,V){var {style:U}=T;V=T.color??V;if("path"===U||"esriSMSPath"===U){Q=[];if("outline"in
T&&T.outline){var W=T.outline;Q.push({type:"CIMSolidStroke",enable:!0,width:W.width,color:P(W.color),path:T.path})}Q.push({type:"CIMSolidFill",enable:!0,color:P(V),path:T.path});const [fa,da]=O("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-w.getValue(T.angle),size:w.getValue(T.size||6),offsetX:w.getValue(T.xoffset),offsetY:w.getValue(T.yoffset),scaleSymbolsProportionally:!1,frame:fa,markerGraphics:[{type:"CIMMarkerGraphic",geometry:da,symbol:{type:"CIMPolygonSymbol",
symbolLayers:Q}}]}]}}const ca=[];W=T.size;let X;if("outline"in T&&T.outline&&"none"!==T.outline.style&&"esriSLSNull"!==T.outline.style){const fa=T.outline,da="solid"!==fa.style&&"esriSLSSolid"!==fa.style;[U,X]=da?O(U,T.size):O(U);const aa=fa.width??p.defaultPolylineSymbol2D.width;if(da){var ba=aa/T.size,ia=(U.xmax-U.xmin)*ba/2;ba=(U.ymax-U.ymin)*ba/2;U.xmin-=ia;U.xmax+=ia;U.ymin-=ba;U.ymax+=ba;W&&(W+=aa)}ia="cross"!==T.style&&"x"!==T.style||"dot"===T?.outline.style||"short-dot"===T?.outline.style?
x.LineDashEnding.HalfGap:x.LineDashEnding.FullPattern;ia=da?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:R(fa.style,null).map(ea=>fa.width&&0<fa.width?ea*fa.width:ea),lineDashEnding:ia,controlPointEnding:x.LineDashEnding.FullPattern}]:void 0;ca.push({type:"CIMSolidStroke",capStyle:da?x.LineCapStyle.Round:x.LineCapStyle.Butt,enable:!0,width:aa,color:P(fa.color),effects:ia})}else!Q||"line-marker"!==T.type||"cross"!==T.style&&"x"!==T.style?[U,X]=O(U):([U,
X]=O(U),ca.push({type:"CIMSolidStroke",enable:!0,width:Q,color:P(V)}));ca.push({type:"CIMSolidFill",enable:!0,color:P(V)});V={type:"CIMPolygonSymbol",symbolLayers:ca};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:w.getValue(-T.angle),size:w.getValue(W||6*Q),offsetX:w.getValue(T.xoffset),offsetY:w.getValue(T.yoffset),scaleSymbolsProportionally:!1,frame:U,markerGraphics:[{type:"CIMMarkerGraphic",geometry:X,symbol:V}]}]}}static fromCIMHatchFill(T,Q){const V=Q*
(T.separation??r.defaultCIMValues.CIMHatchFill.separation),U=V/2;T=h.clone(T.lineSymbol);T.symbolLayers?.forEach(ca=>{switch(ca.type){case "CIMSolidStroke":null!=ca.width&&(ca.width*=Q);ca.effects?.forEach(X=>{"CIMGeometricEffectDashes"===X.type&&(X.dashTemplate=X.dashTemplate.map(ba=>ba*Q))});break;case "CIMVectorMarker":null!=ca.size&&(ca.size*=Q),ca=ca.markerPlacement,null!=ca&&"placementTemplate"in ca&&(ca.placementTemplate=ca.placementTemplate.map(X=>X*Q))}});for(var W=this._getLineSymbolPeriod(T)||
4;4>W;)W*=2;W/=2;return{type:"CIMVectorMarker",frame:{xmin:-W,xmax:W,ymin:-U,ymax:U},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-W,0],[W,0]]]},symbol:T}],size:V}}static fetchResources(T,Q,V,U=null){if(!T||!Q)return V;A(T,W=>{C(W,Q,V);"url"in W&&W.url&&V.push(Q.fetchResource(W.url,{signal:U}))});return V}static fetchFonts(T,Q,V){if(T&&Q)if("symbolLayers"in T&&T.symbolLayers)for(const ca of T.symbolLayers){if("CIMVectorMarker"===ca.type&&ca.markerGraphics)for(const X of ca.markerGraphics)X?.symbol&&
L.fetchFonts(X.symbol,Q,V)}else if("CIMTextSymbol"===T.type){const {fontFamilyName:ca,fontStyleName:X}=T;if(ca&&"calcitewebcoreicons"!==ca.toLowerCase()){var {style:U,weight:W}=w.fromCIMFontStyle(X);T=w.fromCIMFontDecoration(T);T=new c({family:ca,style:U,weight:W,decoration:T});V.push(Q.loadFont(T).catch(()=>{z().error(`Unsupported font ${ca} in CIM symbol`)}))}}}static _getLineSymbolPeriod(T){if(T){const Q=this._getEffectsRepeat(T.effects);if(Q)return Q;if(T.symbolLayers)for(const V of T.symbolLayers)if(V){if(T=
this._getEffectsRepeat(V.effects))return T;switch(V.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(T=this._getPlacementRepeat(V.markerPlacement))return T}}}return 0}static _getEffectsRepeat(T){if(T)for(var Q of T)if(Q)switch(Q.type){case "CIMGeometricEffectDashes":if((T=Q.dashTemplate)&&T.length){Q=0;for(const V of T)Q+=V;T.length&1&&(Q*=2);return Q}break;case "CIMGeometricEffectWave":return Q.period;default:z().error(`unsupported geometric effect type ${Q.type}`)}return 0}static _getPlacementRepeat(T){if(T)switch(T.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((T=
T.placementTemplate)&&T.length){let Q=0;for(const V of T)Q+=+V;T.length&1&&(Q*=2);return Q}}return 0}static fromCIMInsidePolygon(T){var Q=T.markerPlacement;const V={...T,markerPlacement:null,anchorPoint:null};T=Math.abs(Q.stepX);const U=Math.abs(Q.stepY);var W=(Q.randomness??100)/100;let ca,X;if("Random"===Q.gridType){var ba=g.px2pt(q.randomInsidePolygonTextureSize);const ia=Math.max(Math.floor(ba/T),1),fa=Math.max(Math.floor(ba/U),1);ba=ia*T/2;ca=fa*U/2;X=2*ca;Q=new m(Q.seed);const da=W*T/1.5,aa=
W*U/1.5;W=[];for(let ea=0;ea<ia;ea++)for(let ha=0;ha<fa;ha++){const Y=ea*T-ba+da*(.5-Q.getFloat()),Z=ha*U-ca+aa*(.5-Q.getFloat());W.push({x:Y,y:Z});0===ea&&W.push({x:Y+2*ba,y:Z});0===ha&&W.push({x:Y,y:Z+2*ca})}}else!0===Q.shiftOddRows?(ba=T/2,ca=U,X=2*U,W=[{x:-ba,y:0},{x:ba,y:0},{x:0,y:ca},{x:0,y:-ca}]):(ba=T/2,ca=U/2,X=U,W=[{x:-T,y:0},{x:0,y:-U},{x:-T,y:-U},{x:0,y:0},{x:T,y:0},{x:0,y:U},{x:T,y:U},{x:-T,y:U},{x:T,y:-U}]);T=W.map(ia=>({type:"CIMMarkerGraphic",geometry:ia,symbol:{type:"CIMPointSymbol",
symbolLayers:[V]}}));return{type:"CIMVectorMarker",frame:{xmin:-ba,xmax:ba,ymin:-ca,ymax:ca},markerGraphics:T,size:X}}}const F=T=>{if(!T)return x.LineCapStyle.Butt;switch(T){case "butt":return x.LineCapStyle.Butt;case "square":return x.LineCapStyle.Square;case "round":return x.LineCapStyle.Round}},M=T=>{if(!T)return x.LineJoinStyle.Miter;switch(T){case "miter":return x.LineJoinStyle.Miter;case "round":return x.LineJoinStyle.Round;case "bevel":return x.LineJoinStyle.Bevel}},S=T=>{if(null==T)return"Center";
switch(T){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},N=T=>{if(null==T)return"Center";switch(T){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";case "bottom":return"Bottom"}},P=T=>{if(!T)return[0,0,0,0];const {r:Q,g:V,b:U,a:W}=T;return[Q,V,U,255*W]},R=(T,Q)=>{const V=n("safari")?.001:0;Q="butt"===Q;switch(T){case "dash":case "esriSLSDash":return Q?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return Q?[4,3,1,3]:[3,4,V,
4];case "dot":case "esriSLSDot":return Q?[1,3]:[V,4];case "long-dash":case "esriSLSLongDash":return Q?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return Q?[8,3,1,3]:[7,4,V,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return Q?[8,3,1,3,1,3]:[7,4,V,4,V,4];case "short-dash":case "esriSLSShortDash":return Q?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return Q?[4,1,1,1]:[3,2,V,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return Q?[4,1,1,1,1,1]:[3,2,
V,2,V,2];case "short-dot":case "esriSLSShortDot":return Q?[1,1]:[V,2];case "solid":case "esriSLSSolid":case "none":return z().error("Unexpected: style does not require rasterization"),[0,0];default:return z().error(`Tried to rasterize SLS, but found an unexpected style: ${T}!`),[0,0]}},O=(T,Q=100)=>{var V=Q/2,U;if("circle"===T||"esriSMSCircle"===T){var W=Math.acos(1-.25/V);Q=Math.ceil(I/W/4);0===Q&&(Q=1);W=H/Q;Q*=4;T=[];T.push([V,0]);for(U=1;U<Q;U++)T.push([V*Math.cos(U*W),-V*Math.sin(U*W)]);T.push([V,
0]);W={rings:[T]};U={xmin:-V,ymin:-V,xmax:V,ymax:V}}else"cross"===T||"esriSMSCross"===T?(W={paths:[[[0,V],[0,-V]],[[V,0],[-V,0]]]},U={xmin:-V,ymin:-V,xmax:V,ymax:V}):"diamond"===T||"esriSMSDiamond"===T?(W={rings:[[[-V,0],[0,V],[V,0],[0,-V],[-V,0]]]},U={xmin:-V,ymin:-V,xmax:V,ymax:V}):"square"===T||"esriSMSSquare"===T?(W={rings:[[[-V,-V],[-V,V],[V,V],[V,-V],[-V,-V]]]},U={xmin:-V,ymin:-V,xmax:V,ymax:V}):"x"===T||"esriSMSX"===T?(W={paths:[[[V,V],[-V,-V]],[[V,-V],[-V,V]]]},U={xmin:-V,ymin:-V,xmax:V,ymax:V}):
"triangle"===T||"esriSMSTriangle"===T?(V=.5773502691896257*Q,T=-V,U=2/3*Q,Q=U-Q,W={rings:[[[T,Q],[0,U],[V,Q],[T,Q]]]},U={xmin:T,ymin:Q,xmax:V,ymax:U}):"arrow"===T&&(W={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},U={xmin:-V,ymin:-V,xmax:V,ymax:V});return[U,W]};a.CIMSymbolHelper=L;a.CIMSymbolInflatedSizeHelper=K;a.capTypeToEnum=F;a.getEffectsInflateSize=G;a.slsDashToTemplateArray=R;a.symbolToCIM=function(T){let Q;switch(T.type){case "cim":return T.data;case "web-style":return T;
case "simple-marker":T=L.fromSimpleMarker(T);if(!T)throw Error("InternalError: Cannot convert symbol to CIM");Q=T;break;case "picture-marker":Q=L.fromPictureMarker(T);break;case "simple-line":Q=L.fromSimpleLineSymbol(T);break;case "simple-fill":Q=L.fromSimpleFillSymbol(T);break;case "picture-fill":Q=L.fromPictureFillSymbol(T);break;case "text":Q=L.fromTextSymbol(T)}return{type:"CIMSymbolReference",symbol:Q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports",
"./BidiEngine"],function(a,b){const n=new b;a.bidiText=function(h){if(null==h)return["",!1];if(!n.hasBidiChar(h))return[h,!1];let k;k="rtl"===n.checkContextual(h)?"IDNNN":"ICNNN";return[n.bidiTransform(h,k,"VLYSN"),!0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(a){function b(G,A,C,E,I){var H=G;void 0===A&&(A=I.defInFormat);void 0===C&&(C=I.defOutFormat);void 0===E&&(E=I.defSwap);if(A!==C){var J=A.substring(0,
1),B=C.substring(0,1);var z=A.substring(1,4);var K=C.substring(1,4);"C"===z.charAt(0)&&(z=n(H),z="ltr"===z||"rtl"===z?z.toUpperCase():"L"===A.charAt(2)?"LTR":"RTL",A=J+z);"C"===K.charAt(0)&&(z=n(H),"rtl"===z?K="RTL":"ltr"===z?(H=H.split(""),H.reverse(),z=n(H.join("")),K=z.toUpperCase()):K="L"===C.charAt(2)?"LTR":"RTL",C=B+K)}if(A===C)return G;B=A.substring(0,1);H=A.substring(1,4);J=C.substring(0,1);K=C.substring(1,4);I.inFormat=A;I.outFormat=C;I.swap=E;if("L"===B&&"VLTR"===C){if("LTR"===H)return I.dir=
0,h(G,I);if("RTL"===H)return I.dir=1,h(G,I)}if("V"===B&&"V"===J)return I.dir="RTL"===H?1:0,m(G,I);if("L"===B&&"VRTL"===C)return I.dir="LTR"===H?0:1,G=h(G,I),m(G);if("VLTR"===A&&"LLTR"===C)return I.dir=0,h(G,I);if("V"===B&&"L"===J&&H!==K)return G=m(G),"RTL"===H?b(G,"LLTR","VLTR",E,I):b(G,"LRTL","VRTL",E,I);if("VRTL"===A&&"LRTL"===C)return b(G,"LRTL","VRTL",E,I);"L"===B&&"L"===J&&(A=I.swap,I.swap=A.substr(0,1)+"N","RTL"===H?(I.dir=1,G=h(G,I),I.swap="N"+A.substr(1,2),I.dir=0,G=h(G,I)):(I.dir=0,G=h(G,
I),I.swap="N"+A.substr(1,2),G=b(G,"VLTR","LRTL",I.swap,I)));return G}function n(G){return(G=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(G))?"z">=G[0]?"ltr":"rtl":""}function h(G,A){G=G.split("");const C=[];k(G,C,A);if(0!==A.hiLevel&&A.swap.substr(0,1)!==A.swap.substr(1,2))for(let H=0;H<G.length;H++)if(1===C[H]){var E=H;b:{let J=void 0;var I=G[H];let B=0,z=a.swapTable.length-1;for(;B<=z;)if(J=Math.floor((B+z)/2),I<a.swapTable[J][0])z=J-1;else if(I>a.swapTable[J][0])B=
J+1;else{I=a.swapTable[J][1];break b}}G[E]=I}d(2,G,C,A);d(1,G,C,A);u=C;return G.join("")}function k(G,A,C){const E=G.length;var I=C.dir?a.impTabRtl:a.impTabLtr,H=0,J=-1;const B=[],z=[];C.hiLevel=C.dir;C.lastArabic=!1;C.hasUbatAl=!1;C.hasUbatB=!1;C.hasUbatS=!1;for(var K=0;K<E;K++){var L=K,F=G[K].charCodeAt(0);const M=a.primaryTable[F>>8];B[L]=M<a.tbbase?M:a.unicodeTable[M-a.tbbase][F&255]}for(L=0;L<E;L++){K=c(G,B,z,L,C);z[L]=K;H=I[H][K];F=H&240;H&=15;K=I[H][5];A[L]=K;if(0<F){if(16===F)for(;J<L;J++)A[J]=
1;J=-1}if(I[H][6])-1===J&&(J=L);else if(-1<J){for(;J<L;J++)A[J]=K;J=-1}B[L]===a.ubatB&&(A[L]=0);C.hiLevel|=K}if(C.hasUbatS)for(G=0;G<E;G++)if(B[G]===a.ubatS)for(A[G]=C.dir,I=G-1;0<=I;I--)if(B[I]===a.ubatWs)A[I]=C.dir;else break}function m(G,A){G=G.split("");if(A){const C=[];k(G,C,A);u=C}G.reverse();t.reverse();return G.join("")}function g(G){for(let A=0;A<a.arabicAlefBetIntervalsBegine.length;A++)if(G>=a.arabicAlefBetIntervalsBegine[A]&&G<=a.arabicAlefBetIntervalsEnd[A])return!0;return!1}function e(G,
A,C,E){for(;A*C<E&&f(G[A]);)A+=C;return A*C<E&&g(G[A])?!0:!1}function d(G,A,C,E){if(!(E.hiLevel<G))if(1!==G||1!==E.dir||E.hasUbatB){E=A.length;for(var I=0,H,J,B;I<E;){if(C[I]>=G){for(H=I+1;H<E&&C[H]>=G;)H++;for(J=H-1;I<J;I++,J--)B=A[I],A[I]=A[J],A[J]=B,B=t[I],t[I]=t[J],t[J]=B;I=H}I++}}else A.reverse(),t.reverse()}function c(G,A,C,E,I){return{UBAT_L:()=>{I.lastArabic=!1;return a.ubatL},UBAT_R:()=>{I.lastArabic=!1;return a.ubatR},UBAT_ON:()=>a.ubatOn,UBAT_AN:()=>a.ubatAn,UBAT_EN:()=>I.lastArabic?a.ubatAn:
a.ubatEn,UBAT_AL:()=>{I.lastArabic=!0;I.hasUbatAl=!0;return a.ubatR},UBAT_WS:()=>a.ubatOn,UBAT_CS:()=>{let H,J;if(1>E||E+1>=A.length||(H=C[E-1])!==a.ubatEn&&H!==a.ubatAn||(J=A[E+1])!==a.ubatEn&&J!==a.ubatAn)return a.ubatOn;I.lastArabic&&(J=a.ubatAn);return J===H?J:a.ubatOn},UBAT_ES:()=>(0<E?C[E-1]:a.ubatB)===a.ubatEn&&E+1<A.length&&A[E+1]===a.ubatEn?a.ubatEn:a.ubatOn,UBAT_ET:()=>{if(0<E&&C[E-1]===a.ubatEn)return a.ubatEn;if(I.lastArabic)return a.ubatOn;let H=E+1;const J=A.length;for(;H<J&&A[H]===
a.ubatEt;)H++;return H<J&&A[H]===a.ubatEn?a.ubatEn:a.ubatOn},UBAT_NSM:()=>{if("VLTR"===I.inFormat){for(var H=A.length,J=E+1;J<H&&A[J]===a.ubatNsm;)J++;if(J<H&&(H=G[E].charCodeAt(0),J=A[J],(1425<=H&&2303>=H||64286===H)&&(J===a.ubatR||J===a.ubatAl)))return a.ubatR}return 1>E||A[E-1]===a.ubatB?a.ubatOn:C[E-1]},UBAT_B:()=>{I.lastArabic=!0;I.hasUbatB=!0;return I.dir},UBAT_S:()=>{I.hasUbatS=!0;return a.ubatOn},UBAT_LRE:()=>{I.lastArabic=!1;return a.ubatOn},UBAT_RLE:()=>{I.lastArabic=!1;return a.ubatOn},
UBAT_LRO:()=>{I.lastArabic=!1;return a.ubatOn},UBAT_RLO:()=>{I.lastArabic=!1;return a.ubatOn},UBAT_PDF:()=>{I.lastArabic=!1;return a.ubatOn},UBAT_BN:()=>a.ubatOn}[a.typesNames[A[E]]]()}function l(G,A){for(let C=0;C<a.baseForm.length;C++)if(G===a.baseForm[C])return A[C];return G}function f(G){return"\u064b"<=G&&"\u0655">=G}function r(G){return"L"===G?"LTR":"R"===G?"RTL":"C"===G?"CLR":"D"===G?"CRL":""}function x(G,A){for(let C=0;C<a.aLefTable.length;C++)if(G===a.aLefTable[C])return A[C];return G}function w(G,
A,C,E){for(let I=0;I<G.length;I++)if(G[I]>A||!C&&G[I]===A)G[I]+=E}class p{constructor(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}bidiTransform(G,A,C){this.sourceToTarget=[];this.targetToSource=[];if(!G)return"";var E=this.sourceToTarget,I=this.targetToSource,H=G.length;t=[];u=[];for(var J=0;J<H;J++)E[J]=J,I[J]=J,t[J]=J;if(!this.checkParameters(A,C))return G;A=this.inputFormat;C=this.outputFormat;E=G;E=v;J=r(A.charAt(1));I=r(C.charAt(1));
var B="I"===A.charAt(0)?"L":A.charAt(0);H="I"===C.charAt(0)?"L":C.charAt(0);J=B+J;I=H+I;H=A.charAt(2)+C.charAt(2);E.defInFormat=J;E.defOutFormat=I;E.defSwap=H;G=b(G,J,I,H,E);E=!1;if("R"===C.charAt(1))E=!0;else if("C"===C.charAt(1)||"D"===C.charAt(1))E="rtl"===this.checkContextual(G);I=this.sourceToTarget=t;H=Array(I.length);for(J=0;J<I.length;J++)H[I[J]]=J;q=this.targetToSource=H;if(A.charAt(3)===C.charAt(3))E=G;else if("S"===C.charAt(3))if(A=E,C=!0,0===G.length)E="";else{void 0===A&&(A=!0);void 0===
C&&(C=!0);G=String(G);G=G.split("");H=0;E=1;I=G.length;A||(H=G.length-1,E=-1,I=1);var z=H;H=C;var K=0;J=[];for(B=0;z*E<I;z+=E)if(g(G[z])||f(G[z])){var L;if(L="\u0644"===G[z])b:{for(var F=G,M=z+E,S=E,N=I;M*S<N&&f(F[M]);)M+=S;L=" ";if(M*S<N)for(L=F[M],F=0;F<a.aLefTable.length;F++)if(a.aLefTable[F]===L){L=!0;break b}L=!1}if(L){G[z]=0===K?x(G[z+E],a.lamAlefInialTableFE):x(G[z+E],a.lamAlefMedialTableFE);z+=E;K=G;L=z;F=E;for(M=I;L*F<M&&f(K[L]);)L+=F;L*F<M&&(K[L]=" ");H&&(J[B]=z,B++);K=0}else{L=G[z];if(1===
K){F=z;if(e(G,z+E,E,I))b:for(M=G[z],S=0;S<a.baseForm.length;S++){if(M===a.baseForm[S]){M=a.medialForm[S];break b}}else M=l(G[z],a.finalForm);G[F]=M}else!0===e(G,z+E,E,I)?G[z]=l(G[z],a.initialForm):G[z]=l(G[z],a.isolatedForm);f(L)||(K=1);b:{for(F=0;F<a.standAlonForm.length;F++)if(a.standAlonForm[F]===L){L=!0;break b}L=!1}!0===L&&(K=0)}}else K=0;E=J;I="";for(H=0;H<G.length;H++){if(J=C){b:{for(J=0;J<E.length;J++)if(E[J]===H)break b;J=-1}J=-1<J}J?(w(q,H,!A,-1),t.splice(H,1)):I+=G[H]}E=I}else if(A=G,C=
E,G=!0,0===A.length)E="";else for(void 0===G&&(G=!0),void 0===C&&(C=!0),A=String(A),E="",I=A.split(""),H=0;H<A.length;H++)J=!1,"\ufe70"<=I[H]&&"\ufeff">I[H]?(B=A.charCodeAt(H),"\ufef5"<=I[H]&&"\ufefc">=I[H]?(C?(0<H&&G&&" "===I[H-1]?E=E.substring(0,E.length-1)+"\u0644":(E+="\u0644",J=!0),E+=a.aLefTable[(B-65269)/2]):(E+=a.aLefTable[(B-65269)/2],E+="\u0644",H+1<A.length&&G&&" "===I[H+1]?H++:J=!0),J&&(w(q,H,!0,1),t.splice(H,0,t[H]))):E+=a.feTo06Table[B-65136]):E+=I[H];this.sourceToTarget=t;this.targetToSource=
q;this.levels=u;return E}_inputFormatSetter(G){if(!y.test(G))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=G}_outputFormatSetter(G){if(!y.test(G))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=G}checkParameters(G,A){G?this._inputFormatSetter(G):G=this.inputFormat;A?this._outputFormatSetter(A):A=this.outputFormat;return G===A?!1:!0}checkContextual(G){G=n(G);if("ltr"!==G&&"rtl"!==G){try{G=document.dir.toLowerCase()}catch(A){}"ltr"!==
G&&"rtl"!==G&&(G="ltr")}return G}hasBidiChar(G){return D.test(G)}}let t=[],q=[],u=[];const v={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},y=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,D=/[\u0591-\u06ff\ufb1d-\ufefc]/;return p})},"esri/core/bidiEngineTables":function(){define(["exports"],function(a){a.aLefTable=["\u0622","\u0623","\u0625","\u0627"];a.arabicAlefBetIntervalsBegine=
["\u0621","\u0641"];a.arabicAlefBetIntervalsEnd=["\u063a","\u064a"];a.baseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");a.feTo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
a.finalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");a.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];a.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];a.initialForm=
"\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");a.isolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
a.lamAlefInialTableFE=["\ufef5","\ufef7","\ufef9","\ufefb"];a.lamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];a.medialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");a.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107];a.standAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");
a.swapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];
a.tbbase=100;a.typesNames="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");a.ubatAl=7;a.ubatAn=3;a.ubatB=5;a.ubatBn=18;a.ubatCs=9;a.ubatEn=2;a.ubatEs=10;a.ubatEt=11;a.ubatL=0;a.ubatLre=13;a.ubatLro=16;a.ubatNsm=12;a.ubatOn=4;a.ubatPdf=15;a.ubatR=1;a.ubatRle=14;a.ubatRlo=17;a.ubatS=6;a.ubatWs=8;a.unicodeTable=[[18,18,18,18,18,18,18,18,18,6,5,6,8,5,18,18,18,18,18,18,18,18,18,18,18,18,
18,18,5,5,5,6,8,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,18,18,18,18,18,18,5,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,4,11,11,11,11,4,4,4,4,0,4,4,18,4,4,11,11,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,
0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,1,12,1,12,12,1,12,12,1,12,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,11,11,7,9,7,4,4,12,12,12,12,12,12,12,12,12,12,12,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,3,3,3,3,3,3,3,3,3,3,11,3,3,7,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,3,4,12,12,12,12,12,12,7,7,12,12,4,12,12,12,12,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,
12,12,12,12,12,12,12,12,12,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,12,12,12,12,12,12,12,12,12,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,18,18,18,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,18,18,18,18,18,4,4,4,4,4,18,18,18,18,18,18,2,0,4,4,2,2,2,2,2,2,10,10,4,4,4,0,2,2,2,2,2,2,2,2,2,2,10,
10,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,12,1,1,1,1,1,1,1,1,1,1,10,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,12,12,12,12,12,12,12,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,
4,9,4,4,4,4,4,4,4,4,4,11,4,4,10,10,4,4,4,4,4,11,11,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,18],[4,4,4,11,11,11,4,4,4,4,4,10,9,10,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,11,11,4,4,4,11,11,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],
function(a){class b{constructor(){this.setIdentity()}getAngle(){if(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)this.rz=Math.atan2(this.rzSin,this.rzCos);return this.rz}setIdentity(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rzCos=1;this.rzSin=0}setTranslate(h,k){this.tx=h;this.ty=k}setTranslateZ(h){this.tz=h}setRotateCS(h,k){this.rz=void 0;this.rzCos=h;this.rzSin=k}setRotate(h){this.rz=h;this.rzSin=this.rzCos=void 0}setRotateY(h){this.ry=h}setScale(h){this.s=
h}setMeasure(h){this.m=h}}class n{next(){return null}}a.EmptyPlacementCursor=n;a.Placement=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("exports ../../core/fontUtils ../../core/has ../../core/lang ../../core/Logger ../../core/ObjectPool ../../core/screenUtils ../../geometry/GeometryCursor ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ../../geometry/support/centroid ../../geometry/support/jsonUtils ./CIMEffects ./CIMImageColorSubstitutionHelper ./CIMOperators ./CIMPlacements ./defaultCIMValues ./enums ./imageUtils ./Rect ./TextRasterizer ./utils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){function C(F,M=1){const S=D.fromCIMFontDecoration(F);var N=D.fromCIMFontStyle(F.fontStyleName);const P=F.fontFamilyName??b.defaultFontFamily,{weight:R,style:O}=N;N=M*(F.height||5);const T=D.fromCIMHorizontalAlignment(F.horizontalAlignment),Q=D.fromCIMVerticalAlignment(F.verticalAlignment),V=D.getFillColor(F),U=D.getFillColor(F.haloSymbol);M=null!=U?M*(F.haloSize??0):0;var W="CIMBackgroundCallout"===F.callout?.type?F.callout.backgroundSymbol:
null;F=D.getFillColor(W);const ca=D.getStrokeWidth(W);W=D.getStrokeColor(W);return{color:V,size:N,horizontalAlignment:T,verticalAlignment:Q,font:{family:P,style:D.getFontStyle(O),weight:D.getFontWeight(R),decoration:S},halo:{size:M||0,color:U,style:O},backgroundColor:F,borderLine:null!=ca&&null!=W?{size:ca,color:W}:null,pixelRatio:1,premultiplyColors:!0}}const E=Math.PI/180;class I{constructor(F){this._t=F}static createIdentity(){return new I([1,0,0,0,1,0])}clone(){return new I(this._t.slice())}transform(F){const M=
this._t;return[M[0]*F[0]+M[1]*F[1]+M[2],M[3]*F[0]+M[4]*F[1]+M[5]]}static createScale(F,M){return new I([F,0,0,0,M,0])}scale(F,M){const S=this._t;S[0]*=F;S[1]*=F;S[2]*=F;S[3]*=M;S[4]*=M;S[5]*=M;return this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(F,M){return new I([0,0,F,0,0,M])}translate(F,M){const S=this._t;S[2]+=F;S[5]+=M;return this}static createRotate(F){const M=Math.cos(F);F=Math.sin(F);return new I([M,-F,0,F,M,0])}rotate(F){return I.multiply(this,
I.createRotate(F),this)}angle(){const F=this._t[0],M=this._t[3],S=Math.sqrt(F*F+M*M);return[F/S,M/S]}static multiply(F,M,S){F=F._t;M=M._t;const N=F[1]*M[0]+F[4]*M[1],P=F[2]*M[0]+F[5]*M[1]+M[2],R=F[0]*M[3]+F[3]*M[4],O=F[1]*M[3]+F[4]*M[4],T=F[2]*M[3]+F[5]*M[4]+M[5],Q=S._t;Q[0]=F[0]*M[0]+F[3]*M[1];Q[1]=N;Q[2]=P;Q[3]=R;Q[4]=O;Q[5]=T;return S}invert(){const F=this._t;let M=F[0]*F[4]-F[1]*F[3];if(0===M)return new I([0,0,0,0,0,0]);M=1/M;return new I([F[4]*M,-F[1]*M,(F[1]*F[5]-F[2]*F[4])*M,-F[3]*M,F[0]*M,
(F[2]*F[3]-F[0]*F[5])*M])}}class H{constructor(F,M){this._resourceManager=F;this._transfos=[];this._sizeTransfos=[];this._geomUnitsPerPoint=1;this._placementPool=new m(p.Placement,void 0,void 0,100);this._earlyReturn=!1;this._mapRotation=0;this._transfos.push(M||I.createIdentity());this._sizeTransfos.push(M?M.scaleRatio():1)}setTransform(F,M){this._transfos=[F||I.createIdentity()];this._sizeTransfos=[M||(F?F.scaleRatio():1)]}setGeomUnitsPerPoint(F){this._geomUnitsPerPoint=F}transformPt(F){return this._transfos[this._transfos.length-
1].transform(F)}transformSize(F){return F*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(F){return this._transfos[this._transfos.length-1].invert().transform(F)}reverseTransformSize(F){return F/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(F){return F/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return 2<
this._transfos.length?1:this._geomUnitsPerPoint}isEmbedded(){return 1<this._transfos.length}back(){return this._transfos[this._transfos.length-1]}push(F,M){M=M?F.scaleRatio():1;I.multiply(F,this.back(),F);this._transfos.push(F);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*M)}pop(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)}drawSymbol(F,M,S){if(F)switch(F.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(F,
M);break;case "CIMTextSymbol":this.drawTextSymbol(F,M,S)}}drawMultiLayerSymbol(F,M){if(F&&M){var S=F.symbolLayers;if(S)if((F=F.effects)&&0<F.length){if(M=this.executeEffects(F,M))for(F=M.next();F;)this.drawSymbolLayers(S,F.asJSON()),F=M.next()}else this.drawSymbolLayers(S,M)}}executeEffects(F,M){const S=this._resourceManager.geometryEngine;M=new r.SimpleEffectCursor(e.GeometryCursor.fromJSONCIM(M));for(const N of F)(F=w.getEffectOperator(N))&&(M=F.execute(M,N,this.geomUnitsPerPoint(),null,S));return M}drawSymbolLayers(F,
M){let S=F.length;for(;S--;){const P=F[S];if(P&&!1!==P.enable){var N=P.effects;if(N&&0<N.length){if(N=this.executeEffects(N,M)){let R=null;for(;(R=N.next())&&(this.drawSymbolLayer(P,R.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(P,M);if(this._earlyReturn)break}}}drawSymbolLayer(F,M){switch(F.type){case "CIMSolidFill":this.drawSolidFill(M,F.color);break;case "CIMHatchFill":this.drawHatchFill(M,F);break;case "CIMPictureFill":this.drawPictureFill(M,F);break;case "CIMGradientFill":this.drawGradientFill(M,
F);break;case "CIMSolidStroke":this.drawSolidStroke(M,F.color,F.width,F.capStyle,F.joinStyle,F.miterLimit);break;case "CIMPictureStroke":this.drawPictureStroke(M,F);break;case "CIMGradientStroke":this.drawGradientStroke(M,F);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(F,M)}}drawHatchFill(F,M){const S=this._buildHatchPolyline(M,F,this.geomUnitsPerPoint());S&&(this.pushClipPath(F),this.drawMultiLayerSymbol(M.lineSymbol,S),this.popClipPath())}drawPictureFill(F,
M){}drawGradientFill(F,M){}drawPictureStroke(F,M){}drawGradientStroke(F,M){}drawMarkerLayer(F,M){var S=F.markerPlacement;if(S){var N=w.getPlacementOperator(S);if(N){var P="CIMMarkerPlacementInsidePolygon"===S.type||"CIMMarkerPlacementPolygonCenter"===S.type&&S.clipAtBoundary;P&&this.pushClipPath(M);if(M=N.execute(e.GeometryCursor.fromJSONCIM(M),S,this.geomUnitsPerPoint(),null,this._resourceManager.geometryEngine))for(S=null;(S=M.next())&&(this.drawMarker(F,S),!this._earlyReturn););P&&this.popClipPath()}}else{P=
this._placementPool.acquire();if(f.isPoint(M))P.tx=M.x,P.ty=M.y,this.drawMarker(F,P);else if(f.isPolygon(M)){if(M=l.polygonCentroid(M))[P.tx,P.ty]=M,this.drawMarker(F,P)}else for(N of M.points)if(P.tx=N[0],P.ty=N[1],this.drawMarker(F,P),this._earlyReturn)break;this._placementPool.release(P)}}drawMarker(F,M){switch(F.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(F,M);break;case "CIMVectorMarker":this.drawVectorMarker(F,M)}}drawPictureMarker(F,M){if(F){var S=this._resourceManager.getResource(F.url),
N=D.getValue(F.size,t.defaultCIMValues.CIMPictureMarker.size);if(!(null==S||0>=N)){var P=S.width;S=S.height;if(P&&S){S=P/S;var R=D.getValue(F.scaleX,1);P=I.createIdentity();var O=F.anchorPoint;if(O){var T=O.x;O=O.y;"Absolute"!==F.anchorPointUnits&&(T*=N*S*R,O*=N);P.translate(-T,-O)}S=D.getValue(F.rotation);F.rotateClockwise&&(S=-S);this._mapRotation&&(S+=this._mapRotation);S&&P.rotate(S*E);S=D.getValue(F.offsetX);R=D.getValue(F.offsetY);if(S||R){if(this._mapRotation){O=E*this._mapRotation;T=Math.cos(O);
O=Math.sin(O);const Q=S*O+R*T;S=S*T-R*O;R=Q}P.translate(S,R)}S=this.geomUnitsPerPoint();1!==S&&P.scale(S,S);(S=M.getAngle())&&P.rotate(S);P.translate(M.tx,M.ty);this.push(P,!1);this.drawImage(F,N);this.pop()}}}}drawVectorMarker(F,M){if(F){var S=F.markerGraphics;if(S){var N=D.getValue(F.size,t.defaultCIMValues.CIMVectorMarker.size),P=F.frame,R=P?P.ymax-P.ymin:0;R=N&&R?N/R:1;N=I.createIdentity();P&&N.translate(.5*-(P.xmax+P.xmin),.5*-(P.ymax+P.ymin));var O=F.anchorPoint;if(O){var T=O.x;O=O.y;"Absolute"!==
F.anchorPointUnits?P&&(T*=P.xmax-P.xmin,O*=P.ymax-P.ymin):(T/=R,O/=R);N.translate(-T,-O)}1!==R&&N.scale(R,R);P=D.getValue(F.rotation);F.rotateClockwise&&(P=-P);this._mapRotation&&(P+=this._mapRotation);P&&N.rotate(P*E);P=D.getValue(F.offsetX);R=D.getValue(F.offsetY);if(P||R){if(this._mapRotation){O=E*this._mapRotation;T=Math.cos(O);O=Math.sin(O);const Q=P*O+R*T;P=P*T-R*O;R=Q}N.translate(P,R)}P=this.geomUnitsPerPoint();1!==P&&N.scale(P,P);(P=M.getAngle())&&N.rotate(P);N.translate(M.tx,M.ty);this.push(N,
F.scaleSymbolsProportionally);for(const Q of S)if(Q?.symbol&&Q.geometry||k.getLogger("esri.symbols.cim.CIMSymbolDrawHelper").error("Invalid marker graphic",Q),F=Q.textString,"number"===typeof F&&(F=F.toString()),this.drawSymbol(Q.symbol,Q.geometry,F),this._earlyReturn)break;this.pop()}}}drawTextSymbol(F,M,S){if(F&&f.isPoint(M)&&!(0>=D.getValue(F.height,t.defaultCIMValues.CIMTextSymbol.height))){var N=I.createIdentity(),P=D.getValue(F.angle);(P=-P)&&N.rotate(P*E);P=D.getValue(F.offsetX);var R=D.getValue(F.offsetY);
(P||R)&&N.translate(P,R);P=this.geomUnitsPerPoint();1!==P&&N.scale(P,P);N.translate(M.x,M.y);this.push(N,!1);this.drawText(F,S);this.pop()}}_buildHatchPolyline(F,M,S){var N=D.getValue(F.separation,t.defaultCIMValues.CIMHatchFill.separation)*S,P=D.getValue(F.rotation);if(0===N)return null;0>N&&(N=-N);for(var R=0,O=.5*N;R>O;)R-=N;for(;R<-O;)R+=N;R=d.create();c.getBoundsXY(R,M);R[0]-=O;R[1]-=O;R[2]+=O;R[3]+=O;for(var T=[[R[0],R[1]],[R[0],R[3]],[R[2],R[3]],[R[2],R[1]]];180<P;)P-=180;for(;0>P;)P+=180;
O=Math.cos(P*E);var Q=Math.sin(P*E);P=-N*Q;M=N*O;R=D.getValue(F.offsetX)*S;F=D.getValue(F.offsetY)*S;R=R*Q-F*O;let V;var U=F=Number.MAX_VALUE;V=S=-Number.MAX_VALUE;for(var W of T){var ca=W[0];const X=W[1];T=O*ca+Q*X;ca=-Q*ca+O*X;U=Math.min(U,T);F=Math.min(F,ca);V=Math.max(V,T);S=Math.max(S,ca)}F=Math.floor(F/N)*N;W=O*U-Q*F-P*R/N;T=Q*U+O*F-M*R/N;U=O*V-Q*F-P*R/N;R=Q*V+O*F-M*R/N;N=1+Math.round((S-F)/N);O=[];for(Q=0;Q<N;Q++)W+=P,T+=M,U+=P,R+=M,O.push([[W,T],[U,R]]);return{paths:O}}}class J extends H{constructor(F,
M){super(F,M);this.reset()}reset(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity;this._clipCount=0}envelope(){return new v(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return d.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(F){!F||0<this._clipCount||(f.isPolygon(F)?this._processPath(F.rings,0):f.isPolyline(F)?this._processPath(F.paths,0):f.isExtent(F)?(F=K(F))&&this._processPath(F.rings,0):console.error("drawSolidFill Unexpected geometry type!"))}drawSolidStroke(F,
M,S){!F||0<this._clipCount||null==S||0>=S||(M=Math.max(.5*this.transformSize(D.getValue(S,t.defaultCIMValues.CIMSolidStroke.width)),.25),f.isPolygon(F)?this._processPath(F.rings,M):f.isPolyline(F)?this._processPath(F.paths,M):f.isExtent(F)?(F=K(F))&&this._processPath(F.rings,M):console.error("drawSolidStroke unexpected geometry type!"))}drawMarkerLayer(F,M){f.isPolygon(M)&&F.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===F.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===F.markerPlacement.type&&
F.markerPlacement.clipAtBoundary)?this._processPath(M.rings,0):super.drawMarkerLayer(F,M)}drawHatchFill(F,M){this.drawSolidFill(F)}drawPictureFill(F,M){this.drawSolidFill(F)}drawGradientFill(F,M){this.drawSolidFill(F)}drawPictureStroke(F,M){this.drawSolidStroke(F,null,M.width)}drawGradientStroke(F,M){this.drawSolidStroke(F,null,M.width)}pushClipPath(F){this.drawSolidFill(F);this._clipCount++}popClipPath(){this._clipCount--}drawImage(F,M){var {url:S}=F;F=D.getValue(F.scaleX,1);let N=F*M;var P=M;S=
this._resourceManager.getResource(S);null!=S&&(P=S.height/S.width,N=F*(M?1<P?M:M/P:S.width),P=M?1<P?M*P:M:S.height);this._merge(this.transformPt([-N/2,-P/2]),0);this._merge(this.transformPt([-N/2,P/2]),0);this._merge(this.transformPt([N/2,-P/2]),0);this._merge(this.transformPt([N/2,P/2]),0)}drawText(F,M){if(M&&0!==M.length){this._textRasterizer||(this._textRasterizer=new y);var S=C(F),[N,P]=this._textRasterizer.computeTextSize(M,S);N=g.px2pt(N);P=g.px2pt(P);M=0;switch(F.horizontalAlignment){case "Left":M=
N/2;break;case "Right":M=-N/2}S=0;switch(F.verticalAlignment){case "Bottom":S=P/2;break;case "Top":S=-P/2;break;case "Baseline":S=P/6}this._merge(this.transformPt([-N/2+M,-P/2+S]),0);this._merge(this.transformPt([-N/2+M,P/2+S]),0);this._merge(this.transformPt([N/2+M,-P/2+S]),0);this._merge(this.transformPt([N/2+M,P/2+S]),0)}}_processPath(F,M){if(F)for(const S of F)if(F=S?S.length:0,1<F){this._merge(this.transformPt(S[0]),M);for(let N=1;N<F;N++)this._merge(this.transformPt(S[N]),M)}}_merge(F,M){F[0]-
M<this._xmin&&(this._xmin=F[0]-M);F[0]+M>this._xmax&&(this._xmax=F[0]+M);F[1]-M<this._ymin&&(this._ymin=F[1]-M);F[1]+M>this._ymax&&(this._ymax=F[1]+M)}}class B extends H{constructor(){super(...arguments);this._searchPoint=[0,0];this._searchDistPoint=0;this._textInfo=null}hitTest(F,M,S,N,P,R){R*=g.pt2px(1);this.setTransform();this.setGeomUnitsPerPoint(R);this._searchPoint=[(F[0]+F[2])/2,(F[1]+F[3])/2];this._searchDistPoint=(F[2]-F[0])/2/R;this._textInfo=N;this._mapRotation=M&&("CIMPointSymbol"===M.type&&
"Map"!==M.angleAlignment||"CIMTextSymbol"===M.type)?P:0;n("esri-mobile")||(F=g.px2pt(n("hittest-2d-small-symbol-tolerance")*window.devicePixelRatio),N=g.px2pt(n("hittest-2d-small-symbol-tolerance-threshold")),("CIMLineSymbol"!==M?.type&&"CIMPolygonSymbol"!==M?.type||!M.symbolLayers?.some(D.isCIMFill))&&"CIMMeshSymbol"!==M?.type&&(D.getSize(M)??0)<N&&(this._searchDistPoint=F));this._earlyReturn=!1;this.drawSymbol(M,S);return this._earlyReturn}drawSolidFill(F,M){this._hitTestFill(F)}drawHatchFill(F,
M){this._hitTestFill(F)}drawPictureFill(F,M){this._hitTestFill(F)}drawGradientFill(F,M){this._hitTestFill(F)}drawSolidStroke(F,M,S,N,P,R){this._hitTestStroke(F,S)}drawPictureStroke(F,M){this._hitTestStroke(F,M.width)}drawGradientStroke(F,M){this._hitTestStroke(F,M.width)}drawMarkerLayer(F,M){F.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===F.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===F.markerPlacement.type&&F.markerPlacement.clipAtBoundary)?this._hitTestFill(M):super.drawMarkerLayer(F,
M)}pushClipPath(F){}popClipPath(){}drawImage(F,M){var {url:S}=F;F=D.getValue(F.scaleX,1);S=this._resourceManager.getResource(S);if(null!=S&&0!==S.height&&0!==M){M*=this.geomUnitsPerPoint();F=S.width/S.height*F*M;S=this.reverseTransformPt(this._searchPoint);var N=this._searchDistPoint;Math.abs(S[0])<F/2+N&&Math.abs(S[1])<M/2+N&&(this._earlyReturn=!0)}}drawText(F,M){if((M=this._textInfo)&&(M=M.get(F))&&M.glyphMosaicItems.glyphs.length){var S=D.getValue(F.height,t.defaultCIMValues.CIMTextSymbol.height),
{lineGapType:N,lineGap:P}=F,R=N?L(N,D.getValue(P),S):0;F=A.shapeGlyphs(M.glyphMosaicItems,{scale:S/G.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:F.horizontalAlignment,verticalAlignment:F.verticalAlignment,maxLineWidth:512,lineHeight:G.magicLabelLineHeight*Math.max(.25,Math.min(R||1,4)),decoration:F.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:"CIMBackgroundCallout"===F.callout?.type});S=this.reverseTransformPt(this._searchPoint);M=S[0];S=S[1];for(const O of F.glyphs)if(M>
O.xTopLeft&&M<O.xBottomRight&&S>-O.yBottomRight&&S<-O.yTopLeft){this._earlyReturn=!0;break}}}_hitTestFill(F){let M=null;if(f.isExtent(F))M=[[[F.xmin,F.ymin],[F.xmin,F.ymax],[F.xmax,F.ymax],[F.xmax,F.ymin],[F.xmin,F.ymin]]];else if(f.isPolygon(F))M=F.rings;else if(f.isPolyline(F))M=F.paths;else return;F=this.reverseTransformPt(this._searchPoint);this._pointInPolygon(F,M)&&(this._earlyReturn=!0);if(!this._earlyReturn){const S=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();
this._nearLine(F,M,S)&&(this._earlyReturn=!0)}}_hitTestStroke(F,M){let S=null;if(f.isExtent(F))S=[[[F.xmin,F.ymin],[F.xmin,F.ymax],[F.xmax,F.ymax],[F.xmax,F.ymin],[F.xmin,F.ymin]]];else if(f.isPolygon(F))S=F.rings;else if(f.isPolyline(F))S=F.paths;else return;F=this.reverseTransformPt(this._searchPoint);M=D.getValue(M,t.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint();const N=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint();this._nearLine(F,S,M/2+N)&&
(this._earlyReturn=!0)}_pointInPolygon(F,M){let S=0;for(const N of M){M=N.length;for(let P=1;P<M;P++){const R=N[P-1],O=N[P];R[1]>F[1]!==O[1]>F[1]&&(0<(O[0]-R[0])*(F[1]-R[1])-(O[1]-R[1])*(F[0]-R[0])?S++:S--)}}return 0!==S}_nearLine(F,M,S){for(const P of M){M=P.length;for(let R=1;R<M;R++){var N=P[R-1];const O=P[R];let T=(O[0]-N[0])*(O[0]-N[0])+(O[1]-N[1])*(O[1]-N[1]);if(0!==T&&(T=Math.sqrt(T),Math.abs(((O[0]-N[0])*(F[1]-N[1])-(O[1]-N[1])*(F[0]-N[0]))/T)<S&&(N=((O[0]-N[0])*(F[0]-N[0])+(O[1]-N[1])*(F[1]-
N[1]))/T,N>-S&&N<T+S)))return!0}}return!1}}class z extends H{constructor(F,M,S,N){super(M,S);this._applyAdditionalRenderProps=N;this._colorSubstitutionHelper=new x;this._ctx=F}drawSolidFill(F,M){if(F){if(f.isPolygon(F))this._buildPath(F.rings,!0);else if(f.isPolyline(F))this._buildPath(F.paths,!0);else if(f.isExtent(F))this._buildPath(K(F).rings,!0);else if(f.isMultipoint(F))console.log("CanvasDrawHelper.drawSolidFill - No implementation!");else return;F=this._ctx;F.fillStyle="string"===typeof M?
M:"rgba("+Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+","+(M[3]??255)/255+")";F.fill("evenodd")}}drawSolidStroke(F,M,S,N,P,R){if(F&&M&&0!==S){if(f.isPolygon(F))this._buildPath(F.rings,!0);else if(f.isPolyline(F))this._buildPath(F.paths,!1);else if(f.isExtent(F))this._buildPath(K(F).rings,!0);else{console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");return}F=this._ctx;F.strokeStyle="string"===typeof M?M:"rgba("+Math.round(M[0])+","+Math.round(M[1])+","+Math.round(M[2])+
","+(M[3]??255)/255+")";F.lineWidth=Math.max(this.transformSize(S),.5);this._setCapStyle(N);this._setJoinStyle(P);F.miterLimit=R;F.stroke()}}pushClipPath(F){this._ctx.save();if(f.isPolygon(F))this._buildPath(F.rings,!0);else if(f.isPolyline(F))this._buildPath(F.paths,!0);else if(f.isExtent(F))this._buildPath(K(F).rings,!0);else return;this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(F,M){const {colorSubstitutions:S,url:N,tintColor:P}=F;F=D.getValue(F.scaleX,1);var R=this._resourceManager.getResource(N);
if(null!=R){var O=R.width/R.height*M,T=M;M||(O=R.width,T=R.height);var Q=D.isSVGImage(N)||"src"in R&&D.isSVGImage(R.src);M="getFrame"in R?u.getFirstFrame(R):R;S&&(M=this._colorSubstitutionHelper.applyColorSubstituition(M,S));this._applyAdditionalRenderProps&&!Q&&P&&(M=this._colorSubstitutionHelper.tintImageData(M,P));R=this.transformPt([0,0]);var [V,U]=this.getTransformAngle();Q=this.transformSize(1);var W=this._ctx;W.save();W.setTransform({m11:F*Q*V,m12:F*Q*U,m21:-Q*U,m22:Q*V,m41:R[0],m42:R[1]});
W.drawImage(M,-O/2,-T/2,O,T);W.restore()}}drawText(F,M){if(M&&0!==M.length&&(this._textRasterizer||(this._textRasterizer=new y),F=C(F),F.size*=this.transformSize(g.px2pt(1)),M=this._textRasterizer.rasterizeText(M,F))){var {size:S,anchorX:N,anchorY:P,canvas:R}=M;M=S[0]*(N+.5);F=S[1]*(P-.5);var O=this._ctx,T=this.transformPt([0,0]),[Q,V]=this.getTransformAngle();O.save();O.setTransform({m11:1*Q,m12:1*V,m21:-1*V,m22:1*Q,m41:T[0]-1*M,m42:T[1]+1*F});O.drawImage(R,0,0);O.restore()}}drawPictureFill(F,M){if(F){var {colorSubstitutions:S,
height:N,offsetX:P,offsetY:R,rotation:O,scaleX:T,tintColor:Q,url:V}=M;M=this._resourceManager.getResource(V);if(null!=M){if(f.isPolygon(F))this._buildPath(F.rings,!0);else if(f.isPolyline(F))this._buildPath(F.paths,!0);else if(f.isExtent(F))this._buildPath(K(F).rings,!0);else if(f.isMultipoint(F))console.log("CanvasDrawHelper.drawPictureFill - No implementation!");else return;F=this._ctx;var U=D.isSVGImage(V)||"src"in M&&D.isSVGImage(M.src),W="getFrame"in M?u.getFirstFrame(M):M;S&&(W=this._colorSubstitutionHelper.applyColorSubstituition(W,
S));if(this._applyAdditionalRenderProps){if(U||Q&&(W=this._colorSubstitutionHelper.tintImageData(W,Q)),U=F.createPattern(W,"repeat"),W=this.transformSize(1),O||=0,P=P?W*P:0,R=R?W*R:0,N&&=W*N,W=N?N/M.height:1,M=T&&N?T*N/M.width:1,0!==O||1!==W||1!==M||0!==P||0!==R){const ca=new DOMMatrix;ca.rotateSelf(0,0,-O).translateSelf(P,R).scaleSelf(M,W,1);U.setTransform(ca)}}else U=F.createPattern(W,"repeat");F.save();F.fillStyle=U;F.fill("evenodd");F.restore()}}}drawPictureStroke(F,M){if(F){var {colorSubstitutions:S,
capStyle:N,joinStyle:P,miterLimit:R,tintColor:O,url:T,width:Q}=M;M=this._resourceManager.getResource(T);if(null!=M){if(f.isPolygon(F))var V=F.rings;else if(f.isPolyline(F))V=F.paths;else if(f.isExtent(F))V=K(F).rings;else{f.isMultipoint(F)&&console.log("CanvasDrawHelper.drawPictureStroke - No implementation!");return}Q||(Q=M.width);F=D.isSVGImage(T)||"src"in M&&D.isSVGImage(M.src);var U="getFrame"in M?u.getFirstFrame(M):M;S&&(U=this._colorSubstitutionHelper.applyColorSubstituition(U,S));this._applyAdditionalRenderProps&&
(F||O&&(U=this._colorSubstitutionHelper.tintImageData(U,O)));M=Math.max(this.transformSize(g.pt2px(Q)),.5);F=M/U.width;var W=this._ctx;U=W.createPattern(U,"repeat-y");W.save();this._setCapStyle(N);this._setJoinStyle(P);void 0!==R&&(W.miterLimit=R);W.lineWidth=M;var ca;for(let da of V){da=h.clone(da);var X=ca=void 0,ba=void 0;let aa=X=void 0;V=da;for(var ia=V[0],fa=1;fa<V.length;)aa=V[fa][0]-ia[0],X=V[fa][1]-ia[1],X=0!==aa?X/aa:Math.PI/2,void 0!==ba&&1E-4>=X-ba?(V.splice(fa-1,1),ia=ca):(ca=ia,ia=V[fa],
fa++),ba=X;if(da&&!(1>=da.length))for(V=this.transformPt(da[0]),ba=1;ba<da.length;ba++)ca=this.transformPt(da[ba]),ia=180/Math.PI*Math.atan2(ca[1]-V[1],ca[0]-V[0]),fa=new DOMMatrix,fa.translateSelf(0,V[1]-M/2).scaleSelf(F,F,1).rotateSelf(0,0,90-ia),U.setTransform(fa),W.strokeStyle=U,W.beginPath(),W.moveTo(V[0],V[1]),W.lineTo(ca[0],ca[1]),W.stroke(),V=ca}W.restore()}}}_buildPath(F,M){const S=this._ctx;S.beginPath();if(F)for(const N of F)if(F=N?N.length:0,1<F){let P=this.transformPt(N[0]);S.moveTo(P[0],
P[1]);for(let R=1;R<F;R++)P=this.transformPt(N[R]),S.lineTo(P[0],P[1]);M&&S.closePath()}}_setCapStyle(F){switch(F){case q.LineCapStyle.Butt:this._ctx.lineCap="butt";break;case q.LineCapStyle.Round:this._ctx.lineCap="round";break;case q.LineCapStyle.Square:this._ctx.lineCap="square"}}_setJoinStyle(F){switch(F){case q.LineJoinStyle.Bevel:this._ctx.lineJoin="bevel";break;case q.LineJoinStyle.Round:this._ctx.lineJoin="round";break;case q.LineJoinStyle.Miter:this._ctx.lineJoin="miter"}}}const K=F=>F?{spatialReference:F.spatialReference,
rings:[[[F.xmin,F.ymin],[F.xmin,F.ymax],[F.xmax,F.ymax],[F.xmax,F.ymin],[F.xmin,F.ymin]]]}:null,L=(F,M,S)=>{switch(F){case "ExtraLeading":return 1+M/S;case "Multiple":return M;case "Exact":return M/S}};a.CIMSymbolDrawHelper=H;a.CanvasDrawHelper=z;a.EnvDrawHelper=J;a.HittestDrawHelper=B;a.Transformation=I;a.cDegToRad=E;a.lineGapType2LineHeight=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(a,b){function n(e){if(!e)return"arial-unicode-ms";
e=e.toLowerCase().split(" ").join("-");switch(e){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return e}}function h(e){a:{if(e.weight)switch(e.weight.toLowerCase()){case "bold":case "bolder":var d="-bold";break a}d=""}a:{if(e.style)switch(e.style.toLowerCase()){case "italic":case "oblique":var c="-italic";break a}c=""}d+=c;return n(e.family)+(0<d.length?d:
"-regular")}const k=new Map,m=new Set;class g{constructor(e,d){this.fontFace=e;this.promise=d}}a.clearFonts=function(){const e=document.fonts;k.forEach(d=>{e.delete(d.fontFace)});k.clear();m.clear()};a.defaultFontFamily="arial-unicode-ms";a.getFontFamily=n;a.getFullyQualifiedFontName=h;a.isCachedFontFace=function(e){return m.has(e)};a.loadFont=async function(e){const d=h(e),c=k.get(d);if(c)return c.promise;const l=new FontFace(e.family,`url('${b.fontsUrl}/woff2/${d}.${"woff2"}') format('${"woff2"}')`,
{style:e.style,weight:e.weight}),f=document.fonts;if(f.has(l)&&"loading"===l.status)return l.loaded;e=l.load().then(()=>{f.add(l);return l});k.set(d,new g(l,e));m.add(l);return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(a,b,n,h,k){function m(f){if(h.isPolygon(f))f=[f.rings,"esriGeometryPolygon"];else if(h.isPolyline(f))f=
[f.paths,"esriGeometryPolyline"];else if(h.isMultipoint(f))f=[[f.points],"esriGeometryMultipoint"];else if(h.isExtent(f))f=[[[[f.xmin,f.ymin],[f.xmin,f.ymax],[f.xmax,f.ymax],[f.xmax,f.ymin],[f.xmin,f.ymin]]],"esriGeometryEnvelope"];else if(h.isPoint(f)){const r=[f.x,f.y];f.z&&r.push(f.z);f.m&&r.push(f.m);f=[[[r]],"esriGeometryPoint"]}else f=[[],"esriGeometryPolyline"];return f}class g{static fromOptimized(f,r,x=!1,w=!1,p=1){return(new e).initialize(f,r,x,w,p)}static fromJSON(f,r=!1,x=!1){const [w,
p]=m(f);return(new d).initialize(w,p,r,x,1)}static fromOptimizedCIM(f,r,x=!1,w=!1,p=1){return(new c).initialize(f,r,x,w,p)}static fromJSONCIM(f,r=!1,x=!1,w=1){const [p,t]=m(f);return(new l).initialize(p,t,r,x,w)}static fromFeatureSetReader(f){const r=f.readGeometryForDisplay();f=f.geometryType;return r&&f?this.fromOptimized(r,f):null}static fromFeatureSetReaderCIM(f){const r=f.readGeometryForDisplay();f=f.geometryType;return r&&f?this.fromOptimizedCIM(r,f):null}static createEmptyOptimized(f,r=!1,
x=!1,w=1){return(new e).initialize(new k,f,r,x,w)}static createEmptyJSON(f,r=!1,x=!1){return(new d).initialize([],f,r,x,1)}static createEmptyOptimizedCIM(f,r=!1,x=!1,w=1){return(new c).initialize(new k,f,r,x,w)}static createEmptyJSONCIM(f,r=!1,x=!1,w=1){return(new l).initialize([],f,r,x,w)}asJSON(){const f=n.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:f[0][0][0],ymin:f[0][0][1],xmax:f[0][2][0],ymax:f[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:f.flat()}:
"esriGeometryPoint"===this.geometryType?{x:f[0][0][0],y:f[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:f}:{paths:f}}getCurrentRingArea(){if(3>this.pathSize)return 0;let f=0,r,x;this.seekPathStart();if(!this.nextPoint())return 0;r=this.x;x=this.y;const w=r,p=x;for(;this.nextPoint();)f+=(r-this.x)*(x+this.y),r=this.x,x=this.y;return-.5*(f+(r-w)*(x+p))}invertY(){this.yFactor*=-1}}class e extends g{constructor(){super(...arguments);this._end=-1}initialize(f,r,x,w,p){this.hasZ=x;this.hasM=
w;this.geometryType=r;this._stride=2+Number(x)+Number(w);this._geometry=f;this._pathIndex=-1;this._pathOffset=0;this._pointOffset=-this._stride;this._end=-1;this.yFactor=p;return this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(f){if(0<=f&&f<this.totalSize){if(this._pathIndex<f)for(;this._pathIndex<f&&this.nextPath(););else if(this._pathIndex>f)for(;this._pathIndex>f&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-
this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(f){f=this._pathOffset+f*this._stride;return 0<=f&&f<this._end?(this._pointOffset=f,!0):!1}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){if(this.pathIndex>=this.totalSize-1)return!1;0<=this._pathIndex&&(this._pathOffset+=this._stride*this.pathSize);this._pathIndex++;this._pointOffset=this._pathOffset-this._stride;this._end=this._pointOffset+
this._stride+this._stride*this.pathSize;return!0}prevPath(){if(0>=this.pathIndex)return!1;this._pathIndex--;this._end=this._pathOffset;this._pathOffset-=this._stride*this.pathSize;this._pointOffset=this._pathOffset-this._stride;return!0}pathLength(){const f=this._end,r=this._stride,x=this._geometry.coords;let w=0;for(let p=this._pathOffset+r;p<f;p+=r){const t=x[p]-x[p-r],q=x[p+1]-x[p-r+1];w+=Math.sqrt(t*t+q*q)}return w}startPath(){this._geometry.lengths.push(0)}pushPath(f){this.startPath();this.pushPoints(f)}pushPoint(f){for(let r=
0;r<this._stride;++r)this._geometry.coords.push(f[r]);this._geometry.lengths[this.totalSize-1]++}pushXY(f,r){this._geometry.coords.push(f,r);this._geometry.lengths[this.totalSize-1]++}pushPoints(f){for(const r of f)for(let x=0;x<this._stride;++x)this._geometry.coords.push(r[x]);this._geometry.lengths[this.totalSize-1]+=f.length}pushCursor(f){f=f.asOptimized();this._geometry.coords.push(...f.coords);this._geometry.lengths.push(...f.lengths)}asOptimized(){const f=this._geometry.clone();if(1!==this.yFactor)for(let r=
1;r<f.coords.length;r+=this._stride)f.coords[r]*=this.yFactor;"esriGeometryPoint"===this.geometryType&&(f.lengths.length=0);return f}isClosed(){const f=this._geometry.coords,r=this._pathOffset,x=this._end-this._stride;for(let w=0;w<this._stride;w++)if(f[r+w]!==f[x+w])return!1;return!0}clone(){return(new e).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((f,r)=>f+r)}get pathSize(){const {lengths:f}=
this._geometry;return 0>this._pathIndex||this._pathIndex>f.length-1?0:this._geometry.isPoint?1:f[this._pathIndex]}get totalSize(){return this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(f){this._geometry.coords[this._pointOffset]=f}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(f){this._geometry.coords[this._pointOffset+1]=this.yFactor*f}get z(){return this._geometry.coords[this._pointOffset+2]}set z(f){this._geometry.coords[this._pointOffset+
2]=f}get m(){return this._geometry.coords[this._pointOffset+(this.hasZ?3:2)]}set m(f){this._geometry.coords[this._pointOffset+3]=f}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}class d extends g{initialize(f,r,x,w,p){this._paths=f;this.geometryType=r;this.hasZ=x;this.hasM=w;this._pathIndex=this._pointIndex=-1;this.yFactor=p;this._mIndex=this.hasZ?3:2;return this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(f){this._pathIndex=f;this._pointIndex=
-1;return 0<=f&&f<this.totalSize?(this._currentPath=this._paths[f],!0):!1}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(f){return 0<=f&&f<this._currentPath.length?(this._pointIndex=f,this._currentPoint=this._currentPath[this._pointIndex],!0):!1}nextPoint(){this._currentPoint=this._currentPath[++this._pointIndex];return this._pointIndex<this._currentPath.length}prevPoint(){this._currentPoint=this._currentPath[--this._pointIndex];return 0<=this._pointIndex}nextPath(){this._pointIndex=
-1;this._currentPath=this._paths[++this._pathIndex];return this._pathIndex<this.totalSize}prevPath(){return 0<this.pathIndex?(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0):!1}pathLength(){const f=this._currentPath.length,r=this._currentPath;let x=0;for(let p=1;p<f;p++){var w=r[p-1];const t=r[p],q=t[0]-w[0];w=t[1]-w[1];x+=Math.sqrt(q*q+w*w)}return x}startPath(){this._paths.push([])}pushPath(f){this._paths.push(f)}pushPoint(f){this._paths[this.totalSize-1].push(f)}pushXY(f,
r){this._paths[this.totalSize-1].push([f,r])}pushPoints(f){this._paths[this.totalSize-1].push(...f)}pushCursor(f){f=n.collectMultipath(f);for(const r of f)this.pushPath(r)}asOptimized(){const f=new k;if("esriGeometryPoint"===this.geometryType)f.coords.push(...this._paths[0][0]),f.lengths.length=0;else for(const r of this._paths){for(const x of r)f.coords.push(x[0]),f.coords.push(x[1]*this.yFactor),this.hasZ&&f.coords.push(x[2]),this.hasM&&f.coords.push(x[this._mIndex]);f.lengths.push(r.length)}return f}isClosed(){const f=
this._currentPath[0],r=this._currentPath[this._currentPath.length-1];for(let x=0;x<f.length;x++)if(f[x]!==r[x])return!1;return!0}clone(){return(new d).initialize(b.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(f=>f.length).reduce((f,r)=>f+r)}get pathSize(){return 0>this._pathIndex||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(f){this._currentPoint[0]=
f}get y(){return this.yFactor*this._currentPoint[1]}set y(f){this._currentPoint[1]=this.yFactor*f}get z(){return this._currentPoint[2]}set z(f){this._currentPoint[2]=f}get m(){return this._currentPoint[this._mIndex]}set m(f){this._currentPoint[this._mIndex]=f}get pathIndex(){return this._pathIndex}}class c extends e{initialize(f,r,x,w,p){super.initialize(f,r,x,w,p);this._controlPoints||(this._controlPoints=this._controlPoints=Array(this.totalSize).fill(void 0).map(t=>new Set));return this}startPath(){super.startPath();
this._controlPoints.push(new Set)}clone(){const f=(new c).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);f._controlPoints=this._controlPoints;return f}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(f){this._controlPoints[this.pathIndex].add(f)}getControlPointAt(f){return this._controlPoints[this.pathIndex].has(f)}}class l extends d{initialize(f,
r,x,w,p){return super.initialize(f,r,x,w,p)}clone(){return(new l).initialize(b.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(f){this._paths[this.pathIndex][f][4]=1}getControlPointAt(f){return 1===this._paths[this.pathIndex][f][4]}}a.GeometryCursor=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/CIMEffects":function(){define(["exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper"],function(a,b,n){let h;class k{constructor(m){this._geometry=m}next(){const m=this._geometry;this._geometry=null;return m}}a.SimpleEffectCursor=k;a.clipCursorToTileExtent=function(m,g){h||=new n.TileClipper(0,0,0,1);var e="esriGeometryPolygon"===m.geometryType;const d=e?3:2;h.reset(e?n.GeometryType.Polygon:n.GeometryType.LineString);h.setPixelMargin(g+1);h.setExtent(512);
let c;for(;m.nextPath();)if(!(m.pathSize<d)){m.nextPoint();g=m.x;c=-m.y;for(h.moveTo(g,c);m.nextPoint();)g=m.x,c=-m.y,h.lineTo(g,c);e&&h.close()}if(e=h.result(!1)){m=b.GeometryCursor.createEmptyOptimizedCIM(m.geometryType);for(const l of e){m.startPath();for(const f of l)m.pushXY(f.x,-f.y)}m.reset();return m}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(a){a.GeometryType=void 0;(function(d){d[d.Unknown=
0]="Unknown";d[d.Point=1]="Point";d[d.LineString=2]="LineString";d[d.Polygon=3]="Polygon"})(a.GeometryType||(a.GeometryType={}));class b{constructor(d,c){this.x=d;this.y=c}clone(){return new b(this.x,this.y)}equals(d,c){return d===this.x&&c===this.y}isEqual(d){return d.x===this.x&&d.y===this.y}setCoords(d,c){this.x=d;this.y=c;return this}normalize(){var d=this.x;const c=this.y;d=Math.sqrt(d*d+c*c);this.x/=d;this.y/=d;return this}rightPerpendicular(){const d=this.x;this.x=this.y;this.y=-d;return this}leftPerpendicular(){const d=
this.x;this.x=-this.y;this.y=d;return this}move(d,c){this.x+=d;this.y+=c;return this}assign(d){this.x=d.x;this.y=d.y;return this}assignAdd(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this}assignSub(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this}rotate(d,c){const l=this.x,f=this.y;this.x=l*d-f*c;this.y=l*c+f*d;return this}scale(d){this.x*=d;this.y*=d;return this}length(){const d=this.x,c=this.y;return Math.sqrt(d*d+c*c)}sub(d){this.x-=d.x;this.y-=d.y;return this}add(d){this.x+=d.x;this.y+=d.y;return this}static distance(d,
c){const l=c.x-d.x;d=c.y-d.y;return Math.sqrt(l*l+d*d)}static add(d,c){return new b(d.x+c.x,d.y+c.y)}static sub(d,c){return new b(d.x-c.x,d.y-c.y)}}class n{constructor(d,c,l){this.ratio=d;this.x=c;this.y=l}}class h{constructor(d,c,l,f=8,r=8){this._lines=[];this._starts=[];this.validateTessellation=!0;this._pixelRatio=f;this._pixelMargin=r;this._tileSize=512*f;this._dz=d;this._yPos=c;this._xPos=l}setPixelMargin(d){d!==this._pixelMargin&&(this._pixelMargin=d,this.setExtent(this._extent))}setExtent(d){this._extent=
d;this._finalRatio=this._tileSize/d*(1<<this._dz);let c=this._pixelRatio*this._pixelMargin;c/=this._finalRatio;d>>=this._dz;c>d&&(c=d);this._margin=c;this._xmin=d*this._xPos-c;this._ymin=d*this._yPos-c;this._xmax=this._xmin+d+2*c;this._ymax=this._ymin+d+2*c}reset(d){this._type=d;this._lines=[];this._starts=[];this._line=null;this._start=0}moveTo(d,c){this._pushLine();this._prevIsIn=this._isIn(d,c);this._moveTo(d,c,this._prevIsIn);this._prevPt=new b(d,c);this._firstPt=new b(d,c);this._dist=0}lineTo(d,
c){const l=this._isIn(d,c),f=new b(d,c),r=b.distance(this._prevPt,f);if(l)if(this._prevIsIn)this._lineTo(d,c,!0);else{var x=this._prevPt;var w=f;d=this._intersect(w,x);this._start=this._dist+r*(1-this._r);this._lineTo(d.x,d.y,!0);this._lineTo(w.x,w.y,!0)}else if(this._prevIsIn)w=this._prevPt,x=f,d=this._intersect(w,x),this._lineTo(d.x,d.y,!0),this._lineTo(x.x,x.y,!1);else{const t=this._prevPt;if(!(t.x<=this._xmin&&f.x<=this._xmin||t.x>=this._xmax&&f.x>=this._xmax||t.y<=this._ymin&&f.y<=this._ymin||
t.y>=this._ymax&&f.y>=this._ymax)){d=[];if(t.x<this._xmin&&f.x>this._xmin||t.x>this._xmin&&f.x<this._xmin){c=(this._xmin-t.x)/(f.x-t.x);var p=t.y+c*(f.y-t.y);p<=this._ymin?w=!1:p>=this._ymax?w=!0:d.push(new n(c,this._xmin,p))}if(t.x<this._xmax&&f.x>this._xmax||t.x>this._xmax&&f.x<this._xmax)c=(this._xmax-t.x)/(f.x-t.x),p=t.y+c*(f.y-t.y),p<=this._ymin?w=!1:p>=this._ymax?w=!0:d.push(new n(c,this._xmax,p));if(t.y<this._ymin&&f.y>this._ymin||t.y>this._ymin&&f.y<this._ymin)c=(this._ymin-t.y)/(f.y-t.y),
p=t.x+c*(f.x-t.x),p<=this._xmin?x=!1:p>=this._xmax?x=!0:d.push(new n(c,p,this._ymin));if(t.y<this._ymax&&f.y>this._ymax||t.y>this._ymax&&f.y<this._ymax)c=(this._ymax-t.y)/(f.y-t.y),p=t.x+c*(f.x-t.x),p<=this._xmin?x=!1:p>=this._xmax?x=!0:d.push(new n(c,p,this._ymax));if(0===d.length)x?w?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):w?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(1<d.length&&d[0].ratio>d[1].ratio)this._start=this._dist+
r*d[1].ratio,this._lineTo(d[1].x,d[1].y,!0),this._lineTo(d[0].x,d[0].y,!0);else for(this._start=this._dist+r*d[0].ratio,x=0;x<d.length;x++)this._lineTo(d[x].x,d[x].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=r;this._prevIsIn=l;this._prevPt=f}close(){if(2<this._line.length){var d=this._firstPt,c=this._prevPt;d.x===c.x&&d.y===c.y||this.lineTo(d.x,d.y);d=this._line;for(c=d.length;4<=c;)if(d[0].x===d[1].x&&d[0].x===d[c-2].x||d[0].y===d[1].y&&d[0].y===d[c-2].y)d.pop(),d[0].x=d[c-2].x,d[0].y=d[c-2].y,--c;
else break}}result(d=!0){this._pushLine();if(0===this._lines.length)return null;this._type===a.GeometryType.Polygon&&d&&g.simplify(this._tileSize,this._margin*this._finalRatio,this._lines);return this._lines}resultWithStarts(){if(this._type!==a.GeometryType.LineString)throw Error("Only valid for lines");this._pushLine();const d=this._lines,c=d.length;if(0===c)return null;const l=[];for(let f=0;f<c;f++)l.push({line:d[f],start:this._starts[f]||0});return l}_isIn(d,c){return d>=this._xmin&&d<=this._xmax&&
c>=this._ymin&&c<=this._ymax}_intersect(d,c){let l,f,r;if(c.x>=this._xmin&&c.x<=this._xmax)f=c.y<=this._ymin?this._ymin:this._ymax,r=(f-d.y)/(c.y-d.y),l=d.x+r*(c.x-d.x);else if(c.y>=this._ymin&&c.y<=this._ymax)l=c.x<=this._xmin?this._xmin:this._xmax,r=(l-d.x)/(c.x-d.x),f=d.y+r*(c.y-d.y);else{f=c.y<=this._ymin?this._ymin:this._ymax;l=c.x<=this._xmin?this._xmin:this._xmax;const x=(l-d.x)/(c.x-d.x),w=(f-d.y)/(c.y-d.y);x<w?(r=x,f=d.y+x*(c.y-d.y)):(r=w,l=d.x+w*(c.x-d.x))}this._r=r;return new b(l,f)}_pushLine(){this._line&&
(this._type===a.GeometryType.Point?0<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===a.GeometryType.LineString?1<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===a.GeometryType.Polygon&&3<this._line.length&&(this._lines.push(this._line),this._starts.push(this._start)));this._line=[];this._start=0}_moveTo(d,c,l){this._type!==a.GeometryType.Polygon?l&&(d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),
c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new b(d,c))):(l||(d<this._xmin&&(d=this._xmin),d>this._xmax&&(d=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line.push(new b(d,c)),this._isV=this._isH=!1)}_lineTo(d,c,l){if(this._type!==a.GeometryType.Polygon)if(l){d=Math.round((d-(this._xmin+this._margin))*this._finalRatio);
c=Math.round((c-(this._ymin+this._margin))*this._finalRatio);if(0<this._line.length&&(l=this._line[this._line.length-1],l.equals(d,c)))return;this._line.push(new b(d,c))}else this._line&&0<this._line.length&&this._pushLine();else if(l||(d<this._xmin&&(d=this._xmin),d>this._xmax&&(d=this._xmax),c<this._ymin&&(c=this._ymin),c>this._ymax&&(c=this._ymax)),d=Math.round((d-(this._xmin+this._margin))*this._finalRatio),c=Math.round((c-(this._ymin+this._margin))*this._finalRatio),this._line&&0<this._line.length){l=
this._line[this._line.length-1];const f=l.x===d,r=l.y===c;f&&r||(this._isH&&f?(l.x=d,l.y=c,l=this._line[this._line.length-2],l.x===d&&l.y===c?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(l=this._line[this._line.length-2],this._isH=l.x===d,this._isV=l.y===c)):(this._isH=l.x===d,this._isV=l.y===c)):this._isV&&r?(l.x=d,l.y=c,l=this._line[this._line.length-2],l.x===d&&l.y===c?(this._line.pop(),1>=this._line.length?this._isV=this._isH=!1:(l=this._line[this._line.length-2],this._isH=l.x===
d,this._isV=l.y===c)):(this._isH=l.x===d,this._isV=l.y===c)):(this._line.push(new b(d,c)),this._isH=f,this._isV=r))}else this._line.push(new b(d,c))}}class k{setExtent(d){this._ratio=4096===d?1:4096/d}get validateTessellation(){return 1>this._ratio}reset(d){this._lines=[];this._line=null}moveTo(d,c){this._line&&this._lines.push(this._line);this._line=[];const l=this._ratio;this._line.push(new b(d*l,c*l))}lineTo(d,c){const l=this._ratio;this._line.push(new b(d*l,c*l))}close(){const d=this._line;d&&
!d[0].isEqual(d[d.length-1])&&d.push(d[0])}result(){this._line&&this._lines.push(this._line);return 0===this._lines.length?null:this._lines}}var m;(function(d){d[d.sideLeft=0]="sideLeft";d[d.sideRight=1]="sideRight";d[d.sideTop=2]="sideTop";d[d.sideBottom=3]="sideBottom"})(m||={});class g{static simplify(d,c,l){if(l){var f=-c,r=d+c,x=-c,w=d+c;d=[];c=[];var p=l.length;for(let t=0;t<p;++t){const q=l[t];if(!q||2>q.length)continue;let u=q[0],v;const y=q.length;for(let D=1;D<y;++D)v=q[D],u.x===v.x&&(u.x<=
f&&(u.y>v.y?(d.push(t),d.push(D),d.push(m.sideLeft),d.push(-1)):(c.push(t),c.push(D),c.push(m.sideLeft),c.push(-1))),u.x>=r&&(u.y<v.y?(d.push(t),d.push(D),d.push(m.sideRight),d.push(-1)):(c.push(t),c.push(D),c.push(m.sideRight),c.push(-1)))),u.y===v.y&&(u.y<=x&&(u.x<v.x?(d.push(t),d.push(D),d.push(m.sideTop),d.push(-1)):(c.push(t),c.push(D),c.push(m.sideTop),c.push(-1))),u.y>=w&&(u.x>v.x?(d.push(t),d.push(D),d.push(m.sideBottom),d.push(-1)):(c.push(t),c.push(D),c.push(m.sideBottom),c.push(-1)))),
u=v}0!==d.length&&0!==c.length&&(g.fillParent(l,c,d),g.fillParent(l,d,c),f=[],g.calcDeltas(f,c,d),g.calcDeltas(f,d,c),g.addDeltas(f,l))}}static fillParent(d,c,l){const f=l.length,r=c.length;for(let q=0;q<r;q+=4){var x=c[q],w=c[q+1];const u=c[q+2],v=d[x][w-1];x=d[x][w];w=8092;let y=-1;for(let D=0;D<f;D+=4){if(l[D+2]!==u)continue;var p=l[D];const G=l[D+1];var t=d[p][G-1];p=d[p][G];switch(u){case m.sideLeft:case m.sideRight:e(v.y,t.y,p.y)&&e(x.y,t.y,p.y)&&(t=Math.abs(p.y-t.y),t<w&&(w=t,y=D));break;case m.sideTop:case m.sideBottom:e(v.x,
t.x,p.x)&&e(x.x,t.x,p.x)&&(t=Math.abs(p.x-t.x),t<w&&(w=t,y=D))}}c[q+3]=y}}static calcDeltas(d,c,l){const f=c.length;for(let r=0;r<f;r+=4){const x=g.calcDelta(r,c,l,[]);d.push(c[r]);d.push(c[r+1]);d.push(c[r+2]);d.push(x)}}static calcDelta(d,c,l,f){d=c[d+3];if(-1===d)return 0;const r=f.length;if(1<r&&f[r-2]===d)return 0;f.push(d);return g.calcDelta(d,l,c,f)+1}static addDeltas(d,c){const l=d.length;let f=0;for(var r=0;r<l;r+=4){var x=d[r+3];x>f&&(f=x)}for(r=0;r<l;r+=4){x=c[d[r]];const w=d[r+1],p=f-
d[r+3];switch(d[r+2]){case m.sideLeft:x[w-1].x-=p;x[w].x-=p;1===w&&(x[x.length-1].x-=p);w===x.length-1&&(x[0].x-=p);break;case m.sideRight:x[w-1].x+=p;x[w].x+=p;1===w&&(x[x.length-1].x+=p);w===x.length-1&&(x[0].x+=p);break;case m.sideTop:x[w-1].y-=p;x[w].y-=p;1===w&&(x[x.length-1].y-=p);w===x.length-1&&(x[0].y-=p);break;case m.sideBottom:x[w-1].y+=p,x[w].y+=p,1===w&&(x[x.length-1].y+=p),w===x.length-1&&(x[0].y+=p)}}}}const e=(d,c,l)=>d>=c&&d<=l||d>=l&&d<=c;a.Point=b;a.SimpleBuilder=k;a.TileClipper=
h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){class a{applyColorSubstituition(b,n){if(!n)return b;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:h,height:k}=b,m=this._rasterizationCanvas,g=m.getContext("2d",{willReadFrequently:!0});b!==m&&(m.width=h,m.height=k,g.drawImage(b,0,0,h,k));b=g.getImageData(0,0,h,k).data;if(n)for(var e of n)if(e&&e.oldColor&&
4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const [d,c,l,f]=e.oldColor,[r,x,w,p]=e.newColor;if(d!==r||c!==x||l!==w||f!==p)for(n=0;n<b.length;n+=4)d===b[n]&&c===b[n+1]&&l===b[n+2]&&f===b[n+3]&&(b[n]=r,b[n+1]=x,b[n+2]=w,b[n+3]=p)}e=new ImageData(b,h,k);g.putImageData(e,0,0);return m}tintImageData(b,n){if(!n||4>n.length)return b;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const {width:h,height:k}=b,m=this._rasterizationCanvas,g=m.getContext("2d",
{willReadFrequently:!0});b!==m&&(m.width=h,m.height=k,g.drawImage(b,0,0,h,k));b=g.getImageData(0,0,h,k);b=new Uint8Array(b.data);n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255];for(let e=0;e<b.length;e+=4)b[e]*=n[0],b[e+1]*=n[1],b[e+2]*=n[2],b[e+3]*=n[3];n=new ImageData(new Uint8ClampedArray(b.buffer),h,k);g.putImageData(n,0,0);return m}}return a})},"esri/symbols/cim/CIMOperators":function(){define("exports ./effects/EffectAddControlPoints ./effects/EffectArrow ./effects/EffectBuffer ./effects/EffectControlMeasureLine ./effects/EffectCut ./effects/EffectDashes ./effects/EffectDonut ./effects/EffectJog ./effects/EffectMove ./effects/EffectOffset ./effects/EffectReverse ./effects/EffectRotate ./effects/EffectScale ./effects/EffectWave ./placements/PlacementAlongLineSameSize ./placements/PlacementAtExtremities ./placements/PlacementAtRatioPositions ./placements/PlacementInsidePolygon ./placements/PlacementOnLine ./placements/PlacementOnVertices ./placements/PlacementPolygonCenter".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){a.getEffectOperator=function(G){if(!G)return null;switch(G.type){case "CIMGeometricEffectAddControlPoints":return b.EffectAddControlPoints.local();case "CIMGeometricEffectArrow":return n.EffectArrow.local();case "CIMGeometricEffectBuffer":return h.EffectBuffer.local();case "CIMGeometricEffectControlMeasureLine":return k.EffectControlMeasureLine.local();case "CIMGeometricEffectCut":return m.EffectCut.local();case "CIMGeometricEffectDashes":return g.EffectDashes.local();
case "CIMGeometricEffectDonut":return e.EffectDonut.local();case "CIMGeometricEffectJog":return d.EffectJog.local();case "CIMGeometricEffectMove":return c.EffectMove.local();case "CIMGeometricEffectOffset":return l.EffectOffset.local();case "CIMGeometricEffectReverse":return f.EffectReverse.local();case "CIMGeometricEffectRotate":return r.EffectRotate.local();case "CIMGeometricEffectScale":return x.EffectScale.local();case "CIMGeometricEffectWave":return w.EffectWave.local()}return null};a.getPlacementOperator=
function(G){if(!G)return null;switch(G.type){case "CIMMarkerPlacementAlongLineSameSize":return p.PlacementAlongLineSameSize.local();case "CIMMarkerPlacementAtExtremities":return t.PlacementAtExtremities.local();case "CIMMarkerPlacementAtRatioPositions":return q.PlacementAtRatioPositions.local();case "CIMMarkerPlacementInsidePolygon":return u.PlacementInsidePolygon.local();case "CIMMarkerPlacementOnLine":return v.PlacementOnLine.local();case "CIMMarkerPlacementOnVertices":return y.PlacementOnVertices.local();
case "CIMMarkerPlacementPolygonCenter":return D.PlacementPolygonCenter.local()}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(a){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(h,k,m,g,e){return new n(h,k,m)}}b.instance=null;class n{constructor(h,k,m){this._inputGeometries=h;this._angleTolerance=void 0!==k.angleTolerance?k.angleTolerance:120;
this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let h=this._inputGeometries.next();for(;h;){if("esriGeometryPolygon"===h.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===h.geometryType)this._isClosed=!1;else if("esriGeometryEnvelope"===h.geometryType){if(this._maxCosAngle)return h;this._isClosed=!0}else{h=this._inputGeometries.next();continue}for(;h.nextPath();)this._processPath(h);h.reset();return h}return null}_processPath(h){if(h.nextPoint()){const k=
h.x,m=h.y;let g=k,e=m,d=h.pathSize,c=0,l=0,f=0,r=0,x=0,w=0;this._isClosed&&++d;for(let p=1;h.nextPoint()||p<d;++p){let t,q;this._isClosed&&p===d-1?(t=k,q=m):(t=h.x,q=h.y);const u=t-g,v=q-e,y=Math.sqrt(u*u+v*v);1<p&&0<y&&0<f&&(c*u+l*v)/y/f<=this._maxCosAngle&&h.setControlPointAt(p-1);1===p&&(r=u,x=v,w=y);0<y&&(g=t,e=q,c=u,l=v,f=y)}this._isClosed&&0<f&&0<w&&(c*r+l*x)/w/f<=this._maxCosAngle&&h.setControlPointAt(0)}}}a.EffectAddControlPoints=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/symbols/cim/effects/EffectArrow":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../CurveHelper ../enums".split(" "),function(a,b,n,h,k,m){const g=m.GeometricEffectArrowType.OpenEnded;class e{static local(){null===e.instance&&(e.instance=new e);return e.instance}execute(c,l,f,r,x){return new d(c,l,f)}}e.instance=null;class d extends h.PathEffectCursor{constructor(c,l,f){super(c,!1,!0);this._curveHelper=new k.CurveHelper;this._width=
(void 0!==l.width?l.width:5)*f;this._arrowType=void 0!==l.geometricEffectArrowType?l.geometricEffectArrowType:void 0!==l.arrowType?l.arrowType:g;this._offsetFlattenError=k.pixelTolerance*f}processPath(c){const l=b.GeometryCursor.createEmptyOptimizedCIM(c.geometryType);switch(this._arrowType){default:this._constructSimpleArrow(l,c,!0);break;case m.GeometricEffectArrowType.Block:this._constructSimpleArrow(l,c,!1);break;case m.GeometricEffectArrowType.Crossed:this._constructCrossedArrow(l,c)}return l}_constructSimpleArrow(c,
l,f){var r=l.pathLength(),x=this._width;r<2*x&&(x=r/2);var w=this._curveHelper.getSubCurve(l,0,r-x);if(w&&w.nextPath()&&(w.seekPathStart(),r=x/2,!this._curveHelper.isEmpty(w)&&(w=n.collectPath(w),x=this._constructOffset(w,-r)))&&(w=this._constructOffset(w,r))){var p=this._constructArrowBasePoint(x,-r/2);p&&(r=this._constructArrowBasePoint(w,r/2))&&(l.seekInPath(l.pathSize-1),l=[l.x,l.y],c.pushPath(w),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(r),c.nextPoint(),c.setControlPoint(),c.pushPoint(l),
c.nextPoint(),c.setControlPoint(),c.pushPoint(p),c.nextPoint(),c.setControlPoint(),c.pushPoints(x.reverse()),c.setControlPoint(),f||(c.setControlPointAt(0),c.setControlPointAt(c.pathSize-1),c.pushPoint(w[0])),c.reset())}}_constructCrossedArrow(c,l){var f=l.pathLength(),r=this._width;f<3.732050807568877*r&&(r=f/3.732050807568877);l.seekPathStart();var x=this._curveHelper.getSubCurve(l,0,f-2.732050807568877*r);if(x){x.nextPath();var w=r/2;if(!this._curveHelper.isEmpty(x)){var p=n.collectPath(x);if(x=
this._constructOffset(p,w))if(p=this._constructOffset(p,-w))if(f=this._curveHelper.getSubCurve(l,0,f-r))if(f.nextPath(),!this._curveHelper.isEmpty(f)&&(f=n.collectPath(f),r=this._constructOffset(f,w))){var t=this._constructOffset(f,-w);if(t&&(f=r[r.length-1],r=this._constructArrowBasePoint(r,w/2))){var q=t[t.length-1];if(w=this._constructArrowBasePoint(t,-w/2))l.seekInPath(l.pathSize-1),l=[l.x,l.y],c.pushPath(x),c.nextPath(),c.nextPoint(),c.setControlPoint(),c.pushPoint(q),c.nextPoint(),c.setControlPoint(),
c.pushPoint(w),c.nextPoint(),c.setControlPoint(),c.pushPoint(l),c.nextPoint(),c.setControlPoint(),c.pushPoint(r),c.nextPoint(),c.setControlPoint(),c.pushPoint(f),c.nextPoint(),c.setControlPoint(),c.pushPoints(p.reverse()),c.nextPoint(),c.setControlPoint(),c.reset()}}}}}_constructOffset(c,l){return this._curveHelper.offset(c,l,m.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError)}_constructArrowBasePoint(c,l){if(!c||2>c.length)return null;var f=c[c.length-2];c=c[c.length-1];f=[c[0]-f[0],
c[1]-f[1]];this._curveHelper.normalize(f);return[c[0]+f[1]*l,c[1]-f[0]*l]}}a.EffectArrow=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(a,b){class n{constructor(k,m=!0,g=!0,e=0){this.isClosed=!1;this.geometryCursor=null;this.geometryCursor=!m&&"esriGeometryPolygon"===k.geometryType||!g&&"esriGeometryPolyline"===k.geometryType?null:k;this.geomUnitsPerPoint=e;this.iteratePath=!1;this.internalPlacement=
new b.Placement}next(){if(!this.geometryCursor)return null;for(;this.iteratePath||this.geometryCursor.pathIndex<this.geometryCursor.totalSize-1;){this.iteratePath||this.geometryCursor.nextPath();const k=this.processPath(this.geometryCursor);if(k)return k}return this.geometryCursor=null}}class h{constructor(k,m,g,e=0){this.isClosed=!1;this.inputGeometries=k;this.acceptPolygon=m;this.acceptPolyline=g;this.geomUnitsPerPoint=e;this.iteratePath=!1;this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){for(var k=
this.inputGeometries.next();k&&!(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===k.geometryType||"esriGeometryEnvelope"===k.geometryType,this.multiPathCursor=k);)k=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();)if(this.multiPathCursor.seekPathStart(),k=this.processPath(this.multiPathCursor))return k;this.multiPathCursor=null}}}a.PathEffectCursor=h;a.PathTransformationCursor=n;a.getId=function(k){return k[4]};a.setId=
function(k,m){k[4]=m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor","./enums"],function(a,b,n){class h{constructor(k,m){}isEmpty(k){if(!k.nextPoint())return!0;let m,g,e,d;m=k.x;for(g=k.y;k.nextPoint();m=g,g=d)if(e=k.x,d=k.y,e!==m||d!==g)return k.seekPathStart(),!1;k.seekPathStart();return!0}normalize(k){const m=Math.sqrt(k[0]*k[0]+k[1]*k[1]);0!==m&&(k[0]/=m,k[1]/=m)}getLength(k,m,g,e){k=g-
k;m=e-m;return Math.sqrt(k*k+m*m)}getSegLength(k){const [[m,g],[e,d]]=k;return this.getLength(m,g,e,d)}getCoord2D(k,m,g,e,d){return[k+(g-k)*d,m+(e-m)*d]}getSegCoord2D(k,m){const [[g,e],[d,c]]=k;return this.getCoord2D(g,e,d,c,m)}getAngle(k,m,g,e,d){return Math.atan2(e-m,g-k)}getAngleCS(k,m,g,e,d){k=g-k;m=e-m;e=Math.sqrt(k*k+m*m);return 0<e?[k/e,m/e]:[1,0]}getSegAngleCS(k,m){const [[g,e],[d,c]]=k;return this.getAngleCS(g,e,d,c,m)}cut(k,m,g,e,d,c){d=0>=d?[k,m]:this.getCoord2D(k,m,g,e,d);k=1<=c?[g,e]:
this.getCoord2D(k,m,g,e,c);return[d,k]}getSubCurve(k,m,g){const e=b.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(e,k,m,g)?e:null}appendSubCurve(k,m,g,e){k.startPath();m.seekPathStart();let d=0;var c=!0;if(!m.nextPoint())return!1;var l=m.x;let f=m.y;for(;m.nextPoint();){const r=this.getLength(l,f,m.x,m.y);if(0!==r){if(c){if(d+r>g){const x=(g-d)/r;let w=1;c=!1;d+r>=e&&(w=(e-d)/r,c=!0);(l=this.cut(l,f,m.x,m.y,x,w))&&k.pushPoints(l);if(c)break;c=!1}}else{if(d+
r>e){(m=this.cut(l,f,m.x,m.y,0,(e-d)/r))&&k.pushPoint(m[1]);break}k.pushXY(m.x,m.y)}d+=r}l=m.x;f=m.y}return!0}getCIMPointAlong(k,m){if(!k.nextPoint())return null;let g=0,e,d,c,l;e=k.x;for(d=k.y;k.nextPoint();e=c,d=l){c=k.x;l=k.y;const f=this.getLength(e,d,c,l);if(0!==f){if(g+f>m)return this.getCoord2D(e,d,c,l,(m-g)/f);g+=f}}return null}offset(k,m,g,e,d){if(!k||2>k.length)return null;var c=0,l=k[c++];for(d=c;c<k.length;){var f=k[c];if(f[0]!==l[0]||f[1]!==l[1])c!==d&&(k[d]=k[c]),l=k[d++];c++}(c=k[0][0]===
k[d-1][0]&&k[0][1]===k[d-1][1])&&--d;if(d<(c?3:2))return null;f=[];l=c?k[d-1]:null;let r=k[0];for(let q=0;q<d;q++){const u=q===d-1?c?k[0]:null:k[q+1];if(l)if(u){var x=[u[0]-r[0],u[1]-r[1]];this.normalize(x);var w=[r[0]-l[0],r[1]-l[1]];this.normalize(w);var p=w[0]*x[1]-w[1]*x[0],t=w[0]*x[0]+w[1]*x[1];if(0===p&&1===t){r=u;continue}if(0<=p===0>=m)1>t&&(x=[x[0]-w[0],x[1]-w[1]],this.normalize(x),w=Math.sqrt((1+t)/2),w>1/e&&(w=-Math.abs(m)/w,f.push([r[0]-x[0]*w,r[1]-x[1]*w])));else switch(g){case n.GeometricEffectOffsetMethod.Mitered:if(l=
Math.sqrt((1+t)/2),0<l&&1/l<e){x=[x[0]-w[0],x[1]-w[1]];this.normalize(x);w=Math.abs(m)/l;f.push([r[0]-x[0]*w,r[1]-x[1]*w]);break}case n.GeometricEffectOffsetMethod.Bevelled:f.push([r[0]+w[1]*m,r[1]-w[0]*m]);f.push([r[0]+x[1]*m,r[1]-x[0]*m]);break;case n.GeometricEffectOffsetMethod.Rounded:if(1>t){f.push([r[0]+w[1]*m,r[1]-w[0]*m]);l=Math.floor(2.5*(1-t));if(0<l){p=t=1/l;for(let v=1;v<l;v++,p+=t){const y=[w[1]*(1-p)+x[1]*p,-w[0]*(1-p)-x[0]*p];this.normalize(y);f.push([r[0]+y[0]*m,r[1]+y[1]*m])}}f.push([r[0]+
x[1]*m,r[1]-x[0]*m])}break;default:0>p?(f.push([r[0]+(w[1]+w[0])*m,r[1]+(w[1]-w[0])*m]),f.push([r[0]+(x[1]-x[0])*m,r[1]-(x[0]+x[1])*m])):(l=Math.sqrt((1+Math.abs(t))/2),x=[x[0]-w[0],x[1]-w[1]],this.normalize(x),w=m/l,f.push([r[0]-x[0]*w,r[1]-x[1]*w]))}}else x=[r[0]-l[0],r[1]-l[1]],this.normalize(x),f.push([r[0]+x[1]*m,r[1]-x[0]*m]);else x=[u[0]-r[0],u[1]-r[1]],this.normalize(x),f.push([r[0]+x[1]*m,r[1]-x[0]*m]);l=r;r=u}if(f.length<(c?3:2))return null;c&&f.push([f[0][0],f[0][1]]);return f}}a.CurveHelper=
h;a.pixelTolerance=.03;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/enums":function(){define(["exports"],function(a){a.CapType=void 0;(function(b){b[b.BUTT=0]="BUTT";b[b.ROUND=1]="ROUND";b[b.SQUARE=2]="SQUARE";b[b.UNKNOWN=4]="UNKNOWN"})(a.CapType||(a.CapType={}));a.JoinType=void 0;(function(b){b[b.BEVEL=0]="BEVEL";b[b.ROUND=1]="ROUND";b[b.MITER=2]="MITER";b[b.UNKNOWN=4]="UNKNOWN"})(a.JoinType||(a.JoinType={}));a.Alignment=void 0;(function(b){b[b.SCREEN=0]="SCREEN";
b[b.MAP=1]="MAP"})(a.Alignment||(a.Alignment={}));a.ExternalColorMixMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Ignore=1]="Ignore";b[b.Multiply=99]="Multiply"})(a.ExternalColorMixMode||(a.ExternalColorMixMode={}));a.ExtremityPlacement=void 0;(function(b){b.Both="Both";b.JustBegin="JustBegin";b.JustEnd="JustEnd";b.None="None"})(a.ExtremityPlacement||(a.ExtremityPlacement={}));a.FillMode=void 0;(function(b){b[b.Mosaic=0]="Mosaic";b[b.Centered=1]="Centered"})(a.FillMode||(a.FillMode={}));a.FontEffects=
void 0;(function(b){b[b.Normal=0]="Normal";b[b.Superscript=1]="Superscript";b[b.Subscript=2]="Subscript"})(a.FontEffects||(a.FontEffects={}));a.FontEncoding=void 0;(function(b){b[b.MSSymbol=0]="MSSymbol";b[b.Unicode=1]="Unicode"})(a.FontEncoding||(a.FontEncoding={}));a.FontType=void 0;(function(b){b[b.Unspecified=0]="Unspecified";b[b.TrueType=1]="TrueType";b[b.PSOpenType=2]="PSOpenType";b[b.TTOpenType=3]="TTOpenType";b[b.Type1=4]="Type1"})(a.FontType||(a.FontType={}));a.AngleAlignment=void 0;(function(b){b[b.Display=
0]="Display";b[b.Map=1]="Map"})(a.AngleAlignment||(a.AngleAlignment={}));a.AnimatedSymbolRepeatType=void 0;(function(b){b.None="None";b.Loop="Loop";b.Oscillate="Oscillate"})(a.AnimatedSymbolRepeatType||(a.AnimatedSymbolRepeatType={}));a.DominantSizeAxis=void 0;(function(b){b[b.Z=0]="Z";b[b.X=1]="X";b[b.Y=2]="Y"})(a.DominantSizeAxis||(a.DominantSizeAxis={}));a.RotationOrder=void 0;(function(b){b[b.XYZ=0]="XYZ";b[b.ZXY=1]="ZXY";b[b.YXZ=2]="YXZ"})(a.RotationOrder||(a.RotationOrder={}));a.BalloonCalloutStyle=
void 0;(function(b){b[b.Rectangle=0]="Rectangle";b[b.RoundedRectangle=1]="RoundedRectangle";b[b.Oval=2]="Oval"})(a.BalloonCalloutStyle||(a.BalloonCalloutStyle={}));a.BlendingMode=void 0;(function(b){b[b.None=0]="None";b[b.Alpha=1]="Alpha";b[b.Screen=2]="Screen";b[b.Multiply=3]="Multiply";b[b.Add=4]="Add"})(a.BlendingMode||(a.BlendingMode={}));a.BlockProgression=void 0;(function(b){b[b.TTB=0]="TTB";b[b.RTL=1]="RTL";b[b.BTT=2]="BTT"})(a.BlockProgression||(a.BlockProgression={}));a.BillBoardMode=void 0;
(function(b){b[b.None=0]="None";b[b.SignPost=1]="SignPost";b[b.FaceNearPlane=2]="FaceNearPlane"})(a.BillBoardMode||(a.BillBoardMode={}));a.CGAAttributeType=void 0;(function(b){b[b.Float=0]="Float";b[b.String=1]="String";b[b.Boolean=2]="Boolean"})(a.CGAAttributeType||(a.CGAAttributeType={}));a.ClippingType=void 0;(function(b){b[b.Intersect=0]="Intersect";b[b.Subtract=1]="Subtract"})(a.ClippingType||(a.ClippingType={}));a.GeometricEffectArrowType=void 0;(function(b){b.OpenEnded="OpenEnded";b.Block=
"Block";b.Crossed="Crossed"})(a.GeometricEffectArrowType||(a.GeometricEffectArrowType={}));a.GeometricEffectControlMeasureLineRule=void 0;(function(b){b.FullGeometry="FullGeometry";b.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment";b.ReversedFirstSegment="ReversedFirstSegment";b.PerpendicularToSecondSegment="PerpendicularToSecondSegment";b.SecondSegmentWithTicks="SecondSegmentWithTicks";b.DoublePerpendicular="DoublePerpendicular";b.OppositeToFirstSegment="OppositeToFirstSegment";b.TriplePerpendicular=
"TriplePerpendicular";b.HalfCircleFirstSegment="HalfCircleFirstSegment";b.HalfCircleSecondSegment="HalfCircleSecondSegment";b.HalfCircleExtended="HalfCircleExtended";b.OpenCircle="OpenCircle";b.CoverageEdgesWithTicks="CoverageEdgesWithTicks";b.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks";b.GapExtentMidline="GapExtentMidline";b.Chevron="Chevron";b.PerpendicularWithArc="PerpendicularWithArc";b.ClosedHalfCircle="ClosedHalfCircle";b.TripleParallelExtended="TripleParallelExtended";b.ParallelWithTicks=
"ParallelWithTicks";b.Parallel="Parallel";b.PerpendicularToFirstSegment="PerpendicularToFirstSegment";b.ParallelOffset="ParallelOffset";b.OffsetOpposite="OffsetOpposite";b.OffsetSame="OffsetSame";b.CircleWithArc="CircleWithArc";b.DoubleJog="DoubleJog";b.PerpendicularOffset="PerpendicularOffset";b.LineExcludingLastSegment="LineExcludingLastSegment";b.MultivertexArrow="MultivertexArrow";b.CrossedArrow="CrossedArrow";b.ChevronArrow="ChevronArrow";b.ChevronArrowOffset="ChevronArrowOffset";b.PartialFirstSegment=
"PartialFirstSegment";b.Arch="Arch";b.CurvedParallelTicks="CurvedParallelTicks";b.Arc90Degrees="Arc90Degrees"})(a.GeometricEffectControlMeasureLineRule||(a.GeometricEffectControlMeasureLineRule={}));a.GeometricEffectDonutMethod=void 0;(function(b){b.Mitered="Mitered";b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square";b.TrueBuffer="TrueBuffer"})(a.GeometricEffectDonutMethod||(a.GeometricEffectDonutMethod={}));a.GeometricEffectEnclosingPolygonMethod=void 0;(function(b){b.ClosePath="ClosePath";
b.ConvexHull="ConvexHull";b.RectangularBox="RectangularBox"})(a.GeometricEffectEnclosingPolygonMethod||(a.GeometricEffectEnclosingPolygonMethod={}));a.GeometricEffectExtensionOrigin=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectExtensionOrigin||(a.GeometricEffectExtensionOrigin={}));a.GeometricEffectOffsetMethod=void 0;(function(b){b.Mitered="Mitered";b.Bevelled="Bevelled";b.Rounded="Rounded";b.Square="Square"})(a.GeometricEffectOffsetMethod||(a.GeometricEffectOffsetMethod=
{}));a.GeometricEffectOffsetOption=void 0;(function(b){b.Fast="Fast";b.Accurate="Accurate"})(a.GeometricEffectOffsetOption||(a.GeometricEffectOffsetOption={}));a.GeometricEffectOffsetTangentMethod=void 0;(function(b){b.BeginningOfLine="BeginningOfLine";b.EndOfLine="EndOfLine"})(a.GeometricEffectOffsetTangentMethod||(a.GeometricEffectOffsetTangentMethod={}));a.GeometricEffectWaveform=void 0;(function(b){b.Sinus="Sinus";b.Square="Square";b.Triangle="Triangle";b.Random="Random"})(a.GeometricEffectWaveform||
(a.GeometricEffectWaveform={}));a.GlyphHinting=void 0;(function(b){b[b.None=0]="None";b[b.Default=1]="Default";b[b.Force=2]="Force"})(a.GlyphHinting||(a.GlyphHinting={}));a.GradientAlignment=void 0;(function(b){b[b.Buffered=0]="Buffered";b[b.Left=1]="Left";b[b.Right=2]="Right";b[b.AlongLine=3]="AlongLine"})(a.GradientAlignment||(a.GradientAlignment={}));a.GradientFillMethod=void 0;(function(b){b[b.Linear=0]="Linear";b[b.Rectangular=1]="Rectangular";b[b.Circular=2]="Circular";b[b.Buffered=3]="Buffered"})(a.GradientFillMethod||
(a.GradientFillMethod={}));a.GradientStrokeType=void 0;(function(b){b[b.Discrete=0]="Discrete";b[b.Continuous=1]="Continuous"})(a.GradientStrokeType||(a.GradientStrokeType={}));a.GradientStrokeMethod=void 0;(function(b){b[b.AcrossLine=0]="AcrossLine";b[b.AloneLine=1]="AloneLine"})(a.GradientStrokeMethod||(a.GradientStrokeMethod={}));a.HorizontalAlignment=void 0;(function(b){b[b.Left=0]="Left";b[b.Right=1]="Right";b[b.Center=2]="Center";b[b.Justify=3]="Justify"})(a.HorizontalAlignment||(a.HorizontalAlignment=
{}));a.LeaderLineStyle=void 0;(function(b){b[b.Base=0]="Base";b[b.MidPoint=1]="MidPoint";b[b.ThreePoint=2]="ThreePoint";b[b.FourPoint=3]="FourPoint";b[b.Underline=4]="Underline";b[b.CircularCW=5]="CircularCW";b[b.CircularCCW=6]="CircularCCW"})(a.LeaderLineStyle||(a.LeaderLineStyle={}));a.LineCapStyle=void 0;(function(b){b.Butt="Butt";b.Round="Round";b.Square="Square"})(a.LineCapStyle||(a.LineCapStyle={}));a.LineDashEnding=void 0;(function(b){b.NoConstraint="NoConstraint";b.HalfPattern="HalfPattern";
b.HalfGap="HalfGap";b.FullPattern="FullPattern";b.FullGap="FullGap";b.Custom="Custom"})(a.LineDashEnding||(a.LineDashEnding={}));a.LineDecorationStyle=void 0;(function(b){b[b.None=-1]="None";b[b.Custom=0]="Custom";b[b.Circle=1]="Circle";b[b.OpenArrow=2]="OpenArrow";b[b.ClosedArrow=3]="ClosedArrow";b[b.Diamond=4]="Diamond"})(a.LineDecorationStyle||(a.LineDecorationStyle={}));a.LineGapType=void 0;(function(b){b[b.ExtraLeading=0]="ExtraLeading";b[b.Multiple=1]="Multiple";b[b.Exact=2]="Exact"})(a.LineGapType||
(a.LineGapType={}));a.LineJoinStyle=void 0;(function(b){b.Bevel="Bevel";b.Round="Round";b.Miter="Miter"})(a.LineJoinStyle||(a.LineJoinStyle={}));a.ExpressionReturnType=void 0;(function(b){b[b.Default=0]="Default";b[b.String=1]="String";b[b.Numeric=2]="Numeric"})(a.ExpressionReturnType||(a.ExpressionReturnType={}));a.MarkerPlacementType=void 0;(function(b){b[b.InsidePolygon=0]="InsidePolygon";b[b.PolygonCenter=1]="PolygonCenter";b[b.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"})(a.MarkerPlacementType||
(a.MarkerPlacementType={}));a.MaterialMode=void 0;(function(b){b[b.Tint=0]="Tint";b[b.Replace=1]="Replace";b[b.Multiply=2]="Multiply"})(a.MaterialMode||(a.MaterialMode={}));a.PlacementClip=void 0;(function(b){b[b.ClipAtBoundary=0]="ClipAtBoundary";b[b.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary";b[b.DoNotTouchBoundary=2]="DoNotTouchBoundary";b[b.DoNotClip=3]="DoNotClip"})(a.PlacementClip||(a.PlacementClip={}));a.PlacementEndings=void 0;(function(b){b.NoConstraint="NoConstraint";
b.WithMarkers="WithMarkers";b.WithFullGap="WithFullGap";b.WithHalfGap="WithHalfGap";b.Custom="Custom"})(a.PlacementEndings||(a.PlacementEndings={}));a.PlacementGridType=void 0;(function(b){b.Fixed="Fixed";b.Random="Random";b.RandomFixedQuantity="RandomFixedQuantity"})(a.PlacementGridType||(a.PlacementGridType={}));a.PlacementOnLineRelativeTo=void 0;(function(b){b.LineMiddle="LineMiddle";b.LineBeginning="LineBeginning";b.LineEnd="LineEnd";b.SegmentMidpoint="SegmentMidpoint"})(a.PlacementOnLineRelativeTo||
(a.PlacementOnLineRelativeTo={}));a.PlacementPolygonCenterMethod=void 0;(function(b){b.OnPolygon="OnPolygon";b.CenterOfMass="CenterOfMass";b.BoundingBoxCenter="BoundingBoxCenter"})(a.PlacementPolygonCenterMethod||(a.PlacementPolygonCenterMethod={}));a.PlacementRandomlyAlongLineRandomization=void 0;(function(b){b[b.Low=0]="Low";b[b.Medium=1]="Medium";b[b.High=2]="High"})(a.PlacementRandomlyAlongLineRandomization||(a.PlacementRandomlyAlongLineRandomization={}));a.PlacementStepPosition=void 0;(function(b){b[b.MarkerCenter=
0]="MarkerCenter";b[b.MarkerBounds=1]="MarkerBounds"})(a.PlacementStepPosition||(a.PlacementStepPosition={}));a.PointSymbolCalloutScale=void 0;(function(b){b[b.None=0]="None";b[b.PropUniform=1]="PropUniform";b[b.PropNonuniform=2]="PropNonuniform";b[b.DifUniform=3]="DifUniform";b[b.DifNonuniform=4]="DifNonuniform"})(a.PointSymbolCalloutScale||(a.PointSymbolCalloutScale={}));a.Simple3DLineStyle=void 0;(function(b){b.Tube="Tube";b.Strip="Strip";b.Wall="Wall"})(a.Simple3DLineStyle||(a.Simple3DLineStyle=
{}));a.SizeVariationMethod=void 0;(function(b){b[b.Random=0]="Random";b[b.Increasing=1]="Increasing";b[b.Decreasing=2]="Decreasing";b[b.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"})(a.SizeVariationMethod||(a.SizeVariationMethod={}));a.SymbolUnits=void 0;(function(b){b[b.Relative=0]="Relative";b[b.Absolute=1]="Absolute"})(a.SymbolUnits||(a.SymbolUnits={}));a.TextCase=void 0;(function(b){b[b.Normal=0]="Normal";b[b.LowerCase=1]="LowerCase";b[b.Allcaps=2]="Allcaps"})(a.TextCase||(a.TextCase=
{}));a.TextReadingDirection=void 0;(function(b){b[b.LTR=0]="LTR";b[b.RTL=1]="RTL"})(a.TextReadingDirection||(a.TextReadingDirection={}));a.TextureFilter=void 0;(function(b){b.Draft="Draft";b.Picture="Picture";b.Text="Text"})(a.TextureFilter||(a.TextureFilter={}));a.VerticalAlignment=void 0;(function(b){b[b.Top=0]="Top";b[b.Center=1]="Center";b[b.Baseline=2]="Baseline";b[b.Bottom=3]="Bottom"})(a.VerticalAlignment||(a.VerticalAlignment={}));a.VerticalGlyphOrientation=void 0;(function(b){b[b.Right=0]=
"Right";b[b.Upright=1]="Upright"})(a.VerticalGlyphOrientation||(a.VerticalGlyphOrientation={}));a.WaterbodySize=void 0;(function(b){b[b.Small=0]="Small";b[b.Medium=1]="Medium";b[b.Large=2]="Large"})(a.WaterbodySize||(a.WaterbodySize={}));a.WaveStrength=void 0;(function(b){b[b.Calm=0]="Calm";b[b.Rippled=1]="Rippled";b[b.Slight=2]="Slight";b[b.Moderate=3]="Moderate"})(a.WaveStrength||(a.WaveStrength={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e){class d{static local(){null===d.instance&&(d.instance=new d);return d.instance}execute(l,f,r,x,w,p){return new c(l,f,r,x,w,p)}}d.instance=null;class c{constructor(l,f,r,x,w,p){this._inputGeometries=l;this._tileKey=x;this._geometryEngine=w;this._curveHelper=new m.CurveHelper;this._size=(void 0!==f.size?f.size:1)*r;this._maxInflateSize=p*r;this._offsetFlattenError=m.pixelTolerance*r}next(){for(var l;l=this._inputGeometries.next();){if(0===this._size)return l;if("esriGeometryEnvelope"===
l.geometryType)if(0<this._size){var f=n.GeometryCursor.createEmptyOptimizedCIM(l.geometryType),r=h.collectMultipath(l)[0];if(r=this._curveHelper.offset(r,this._size,g.GeometricEffectOffsetMethod.Rounded,4,this._offsetFlattenError))return f.pushPath(r),f}else if(0>this._size&&(f=l.asJSON(),0<Math.min(f.xmax-f.xmin,f.ymax-f.ymin)+2*this._size))return n.GeometryCursor.fromJSONCIM({xmin:f.xmin-this._size,xmax:f.xmax+this._size,ymin:f.ymin-this._size,ymax:f.ymax+this._size});f=this._geometryEngine;if(null==
f)break;if(l=this._tileKey?k.clipCursorToTileExtent(l,this._maxInflateSize):l)return(l=f.buffer(e.WebMercator,l.asJSON(),this._size,1))?n.GeometryCursor.fromJSONCIM(l):null}return null}}a.EffectBuffer=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../enums"],function(a,b,n,h,k){class m{static local(){null===
m.instance&&(m.instance=new m);return m.instance}execute(e,d,c,l,f){return new g(e,d,c)}}m.instance=null;class g{constructor(e,d,c){this._defaultPointSize=20;this._inputGeometries=e;this._geomUnitsPerPoint=c;this._rule=d.rule??k.GeometricEffectControlMeasureLineRule.FullGeometry;this._defaultSize=this._defaultPointSize*c}next(){for(var e;e=this._inputGeometries.next();)if((e=this._processGeom(n.collectMultipath(e)))&&e.length)return b.GeometryCursor.fromJSONCIM({paths:e});return null}_clone(e){return[e[0],
e[1]]}_mid(e,d){return[(e[0]+d[0])/2,(e[1]+d[1])/2]}_mix(e,d,c,l){return[e[0]*d+c[0]*l,e[1]*d+c[1]*l]}_add(e,d){return[e[0]+d[0],e[1]+d[1]]}_add2(e,d,c){return[e[0]+d,e[1]+c]}_sub(e,d){return[e[0]-d[0],e[1]-d[1]]}_dist(e,d){return Math.sqrt((e[0]-d[0])*(e[0]-d[0])+(e[1]-d[1])*(e[1]-d[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,d=1){d/=this._norm(e);e[0]*=d;e[1]*=d}_leftPerpendicular(e){const d=e[0];e[0]=-e[1];e[1]=d}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const d=
-e[0];e[0]=e[1];e[1]=d}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,d){return e[0]*d[0]+e[1]*d[1]}_crossProduct(e,d){return e[0]*d[1]-e[1]*d[0]}_rotateDirect(e,d,c){const l=e[0]*c+e[1]*d;e[0]=e[0]*d-e[1]*c;e[1]=l}_makeCtrlPt(e){e=[e[0],e[1]];h.setId(e,1);return e}_addAngledTicks(e,d,c,l){const f=this._sub(c,d);this._normalize(f);var r=this._crossProduct(f,this._sub(l,d));l=0<r?this._rightPerp(f):this._leftPerp(f);r=Math.abs(r)/2;const x=[];x.push([d[0]+(l[0]-f[0])*r,d[1]+(l[1]-f[1])*r]);x.push(d);
x.push(c);x.push([c[0]+(l[0]+f[0])*r,c[1]+(l[1]+f[1])*r]);e.push(x)}_addBezier2(e,d,c,l,f){if(0===f--)e.push(l);else{var r=this._mid(d,c);c=this._mid(c,l);var x=this._mid(r,c);this._addBezier2(e,d,r,x,f);this._addBezier2(e,x,c,l,f)}}_addBezier3(e,d,c,l,f,r){if(0===r--)e.push(f);else{var x=this._mid(d,c),w=this._mid(c,l);l=this._mid(l,f);c=this._mid(x,w);w=this._mid(w,l);var p=this._mid(c,w);this._addBezier3(e,d,x,c,p,r);this._addBezier3(e,p,w,l,f,r)}}_add90DegArc(e,d,c,l,f){l=f??0<this._crossProduct(this._sub(c,
d),this._sub(l,d));f=this._mid(d,c);const r=this._sub(f,d);l?this._leftPerpendicular(r):this._rightPerpendicular(r);f[0]+=r[0];f[1]+=r[1];this._addBezier3(e,d,this._mix(d,.33333,f,.66667),this._mix(c,.33333,f,.66667),c,4)}_addArrow(e,d,c){var l=d[0],f=d[1],r=d[d.length-1],x=this._sub(l,f);this._normalize(x);const w=this._crossProduct(x,this._sub(r,f));f=.5*w;var p=this._leftPerp(x);const t=[r[0]-p[0]*w,r[1]-p[1]*w];var q=d.length-1;r=[];r.push(c?[-p[0],-p[1]]:p);var u=[-x[0],-x[1]];for(c=1;c<q-1;c++){x=
this._sub(d[c+1],d[c]);this._normalize(x);var v=this._dotProduct(x,u);p=this._crossProduct(x,u);v=Math.sqrt((1+v)/2);u=this._sub(x,u);this._normalize(u);u[0]/=v;u[1]/=v;r.push(0>p?[-u[0],-u[1]]:u);u=x}r.push(this._rightPerp(u));for(q=r.length-1;0<q;q--)e.push([d[q][0]+r[q][0]*f,d[q][1]+r[q][1]*f]);e.push([t[0]+r[0][0]*f,t[1]+r[0][1]*f]);e.push([t[0]+r[0][0]*w,t[1]+r[0][1]*w]);e.push(l);e.push([t[0]-r[0][0]*w,t[1]-r[0][1]*w]);e.push([t[0]-r[0][0]*f,t[1]-r[0][1]*f]);for(l=1;l<r.length;l++)e.push([d[l][0]-
r[l][0]*f,d[l][1]-r[l][1]*f])}_cp2(e,d,c){return 2<=e.length?e[1]:this._add2(e[0],d*this._defaultSize,c*this._defaultSize)}_cp3(e,d,c,l){if(3<=e.length)return e[2];c=this._mix(e[0],1-c,d,c);e=this._sub(d,e[0]);this._normalize(e);this._rightPerpendicular(e);return[c[0]+e[0]*l*this._defaultSize,c[1]+e[1]*l*this._defaultSize]}_arrowPath(e){if(2<e.length)return e;const d=e[0];e=this._cp2(e,-4,0);const c=this._sub(d,e);this._normalize(c);const l=this._rightPerp(c);return[d,e,[d[0]+(l[0]-c[0])*this._defaultSize,
d[1]+(l[1]-c[1])*this._defaultSize]]}_arrowLastSeg(e){var d=e[0];const c=this._cp2(e,-4,0);if(3<=e.length)d=e[e.length-1];else{e=this._sub(d,c);this._normalize(e);const l=this._rightPerp(e);d=[d[0]+(l[0]-e[0])*this._defaultSize,d[1]+(l[1]-e[1])*this._defaultSize]}return[c,d]}_processGeom(e){if(!e)return null;const d=[];for(const c of e){if(!c||0===c.length)continue;const l=c.length;let f=c[0];switch(this._rule){case k.GeometricEffectControlMeasureLineRule.PerpendicularFromFirstSegment:const r=this._cp2(c,
0,-1),x=this._cp3(c,r,.5,4),w=[];w.push(x);w.push(this._mid(f,r));d.push(w);break;case k.GeometricEffectControlMeasureLineRule.ReversedFirstSegment:const p=this._cp2(c,0,-1);d.push([p,f]);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularToSecondSegment:const t=this._cp2(c,-4,1),q=this._cp3(c,t,.882353,-1.94),u=[];u.push(this._mid(t,q));u.push(f);d.push(u);break;case k.GeometricEffectControlMeasureLineRule.SecondSegmentWithTicks:const v=this._cp2(c,-4,1),y=this._cp3(c,v,.882353,-1.94),
D=this._sub(y,v);let G;G=0<this._crossProduct(D,this._sub(f,v))?this._rightPerp(G):this._leftPerp(D);const A=[];A.push([v[0]+(G[0]-D[0])/3,v[1]+(G[1]-D[1])/3]);A.push(v);A.push(y);A.push([y[0]+(G[0]+D[0])/3,y[1]+(G[1]+D[1])/3]);d.push(A);break;case k.GeometricEffectControlMeasureLineRule.DoublePerpendicular:const C=this._cp2(c,0,-1),E=this._cp3(c,C,.5,3),I=this._mid(f,C),H=this._sub(I,E);this._normalize(H);const J=this._crossProduct(H,this._sub(f,E));this._leftPerpendicular(H);const B=[];B.push(f);
B.push([E[0]+H[0]*J,E[1]+H[1]*J]);d.push(B);const z=[];z.push([E[0]-H[0]*J,E[1]-H[1]*J]);z.push(C);d.push(z);break;case k.GeometricEffectControlMeasureLineRule.OppositeToFirstSegment:const K=this._cp2(c,0,-1),L=this._cp3(c,K,.5,3),F=this._mid(f,K),M=this._sub(F,L);this._normalize(M);const S=this._crossProduct(M,this._sub(f,L));this._leftPerpendicular(M);const N=[];N.push([L[0]+M[0]*S,L[1]+M[1]*S]);N.push([L[0]-M[0]*S,L[1]-M[1]*S]);d.push(N);break;case k.GeometricEffectControlMeasureLineRule.TriplePerpendicular:const P=
this._cp2(c,0,-1),R=this._cp3(c,P,.5,4),O=this._mid(f,P),T=this._sub(O,R);this._normalize(T);const Q=this._crossProduct(T,this._sub(f,R));this._leftPerpendicular(T);const V=[];V.push([R[0]+T[0]*Q*.8,R[1]+T[1]*Q*.8]);V.push([O[0]+.8*(f[0]-O[0]),O[1]+.8*(f[1]-O[1])]);d.push(V);d.push([R,O]);const U=[];U.push([R[0]-T[0]*Q*.8,R[1]-T[1]*Q*.8]);U.push([O[0]+.8*(P[0]-O[0]),O[1]+.8*(P[1]-O[1])]);d.push(U);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleFirstSegment:const W=this._cp2(c,0,-1),
ca=this._cp3(c,W,.5,4),X=this._mid(f,W);let ba=this._sub(W,f);const ia=Math.cos(Math.PI/18),fa=Math.sin(Math.PI/18),da=Math.sqrt((1+ia)/2),aa=Math.sqrt((1-ia)/2),ea=[];let ha;0<this._crossProduct(ba,this._sub(ca,f))?(ea.push(f),ba=this._sub(f,X),ha=W):(ea.push(W),ba=this._sub(W,X),ha=f);this._rotateDirect(ba,da,aa);ba[0]/=da;ba[1]/=da;for(let Bb=1;18>=Bb;Bb++)ea.push(this._add(X,ba)),this._rotateDirect(ba,ia,fa);ea.push(ha);d.push(ea);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleSecondSegment:const Y=
this._cp2(c,0,-1),Z=this._cp3(c,Y,1,-1);let ja=this._sub(f,Y);this._normalize(ja);const oa=this._crossProduct(ja,this._sub(Z,Y))/2;this._leftPerpendicular(ja);const qa=[Y[0]+ja[0]*oa,Y[1]+ja[1]*oa];ja=this._sub(Y,qa);const ta=Math.cos(Math.PI/18);let va=Math.sin(Math.PI/18);0<oa&&(va=-va);const Ca=[Y];for(let Bb=1;18>=Bb;Bb++)this._rotateDirect(ja,ta,va),Ca.push(this._add(qa,ja));d.push(Ca);break;case k.GeometricEffectControlMeasureLineRule.HalfCircleExtended:const ma=this._cp2(c,0,-2),wa=this._cp3(c,
ma,1,-1);let Ba;if(4<=l)Ba=c[3];else{const Bb=this._sub(f,ma);Ba=this._add(wa,Bb)}const pa=this._dist(ma,wa)/2/.75,Aa=this._sub(ma,f);this._normalize(Aa,pa);const ra=this._sub(wa,Ba);this._normalize(ra,pa);d.push([Ba,wa]);const ua=[this._clone(wa)];this._addBezier3(ua,wa,this._add(wa,ra),this._add(ma,Aa),ma,4);ua.push(f);d.push(ua);break;case k.GeometricEffectControlMeasureLineRule.OpenCircle:const Ea=this._cp2(c,-2,0),Ka=this._sub(Ea,f),Ma=Math.cos(Math.PI/18),Ua=-Math.sin(Math.PI/18),Ga=[Ea];for(let Bb=
1;33>=Bb;Bb++)this._rotateDirect(Ka,Ma,Ua),Ga.push(this._add(f,Ka));d.push(Ga);break;case k.GeometricEffectControlMeasureLineRule.CoverageEdgesWithTicks:const Na=this._cp2(c,0,-1);let Va;if(3<=l)Va=c[2];else{const Bb=this._sub(Na,f),jc=this._leftPerp(Bb);Va=[f[0]+jc[0]-.25*Bb[0],f[1]+jc[1]-.25*Bb[1]]}let Xa;if(4<=l)Xa=c[3];else{const Bb=this._mid(f,Na),jc=this._sub(f,Na);this._normalize(jc);this._leftPerpendicular(jc);const qc=this._crossProduct(jc,this._sub(Va,Bb));this._rightPerpendicular(jc);Xa=
[Va[0]+jc[0]*qc*2,Va[1]+jc[1]*qc*2]}const Pa=this._sub(Na,f);let bb,gb;bb=0<this._crossProduct(Pa,this._sub(Va,f))?this._rightPerp(Pa):this._leftPerp(Pa);gb=[];gb.push(Va);gb.push(f);gb.push([f[0]+(bb[0]-Pa[0])/3,f[1]+(bb[1]-Pa[1])/3]);d.push(gb);bb=0<this._crossProduct(Pa,this._sub(Xa,Na))?this._rightPerp(bb):this._leftPerp(Pa);gb=[];gb.push([Na[0]+(bb[0]+Pa[0])/3,Na[1]+(bb[1]+Pa[1])/3]);gb.push(Na);gb.push(Xa);d.push(gb);break;case k.GeometricEffectControlMeasureLineRule.GapExtentWithDoubleTicks:const cb=
this._cp2(c,0,2),ka=this._cp3(c,cb,0,1);let mb;if(4<=l)mb=c[3];else{const Bb=this._sub(cb,f);mb=this._add(ka,Bb)}this._addAngledTicks(d,f,cb,this._mid(ka,mb));this._addAngledTicks(d,ka,mb,this._mid(f,cb));break;case k.GeometricEffectControlMeasureLineRule.GapExtentMidline:const qb=this._cp2(c,2,0),tb=this._cp3(c,qb,0,1);let xa;if(4<=l)xa=c[3];else{const Bb=this._sub(qb,f);xa=this._add(tb,Bb)}const Ia=[];Ia.push(this._mid(f,tb));Ia.push(this._mid(qb,xa));d.push(Ia);break;case k.GeometricEffectControlMeasureLineRule.Chevron:const na=
this._cp2(c,-1,-1);let ya;if(3<=l)ya=c[2];else{const Bb=this._sub(na,f);this._leftPerpendicular(Bb);ya=this._add(f,Bb)}d.push([na,this._makeCtrlPt(f),ya]);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularWithArc:const Da=this._cp2(c,0,-2),Oa=this._cp3(c,Da,.5,-1);let Wa=this._sub(Da,f);const ab=this._norm(Wa);Wa[0]/=ab;Wa[1]/=ab;const Ja=this._crossProduct(Wa,this._sub(Oa,f));let Ra=this._dotProduct(Wa,this._sub(Oa,f));Ra<.05*ab?Ra=.05*ab:Ra>.95*ab&&(Ra=.95*ab);const Sa=[f[0]+Wa[0]*
Ra,f[1]+Wa[1]*Ra];this._leftPerpendicular(Wa);let db=[];db.push([Sa[0]-Wa[0]*Ja,Sa[1]-Wa[1]*Ja]);db.push([Sa[0]+Wa[0]*Ja,Sa[1]+Wa[1]*Ja]);d.push(db);const eb=[Da[0]+Wa[0]*Ja,Da[1]+Wa[1]*Ja];Wa=this._sub(Da,eb);const lb=Math.cos(Math.PI/18);let sb=Math.sin(Math.PI/18);0>Ja&&(sb=-sb);db=[f,Da];for(let Bb=1;9>=Bb;Bb++)this._rotateDirect(Wa,lb,sb),db.push(this._add(eb,Wa));d.push(db);break;case k.GeometricEffectControlMeasureLineRule.ClosedHalfCircle:const vb=this._cp2(c,2,0),rb=this._mid(f,vb),Eb=this._sub(vb,
rb),Lb=Math.cos(Math.PI/18),Yb=Math.sin(Math.PI/18),bc=[f,vb];for(let Bb=1;18>=Bb;Bb++)this._rotateDirect(Eb,Lb,Yb),bc.push(this._add(rb,Eb));d.push(bc);break;case k.GeometricEffectControlMeasureLineRule.TripleParallelExtended:const fc=this._cp2(c,0,-2),kc=this._cp3(c,fc,1,-2),Cb=this._mid(f,fc),Ib=this._sub(kc,fc);this._normalize(Ib);const Ub=Math.abs(this._crossProduct(Ib,this._sub(Cb,fc)))/2,Sb=this._dist(fc,kc),jb=[fc,f];jb.push([f[0]+Ib[0]*Sb*.5,f[1]+Ib[1]*Sb*.5]);d.push(jb);const sa=[];sa.push([Cb[0]-
Ib[0]*Ub,Cb[1]-Ib[1]*Ub]);sa.push([Cb[0]+Ib[0]*Sb*.375,Cb[1]+Ib[1]*Sb*.375]);h.setId(sa[sa.length-1],1);sa.push([Cb[0]+Ib[0]*Sb*.75,Cb[1]+Ib[1]*Sb*.75]);d.push(sa);d.push([fc,kc]);break;case k.GeometricEffectControlMeasureLineRule.ParallelWithTicks:const Ha=this._cp2(c,3,0),Qa=this._cp3(c,Ha,.5,-1),Ta=this._sub(Qa,Ha);this._normalize(Ta);const Za=this._crossProduct(Ta,this._sub(Qa,f));this._leftPerpendicular(Ta);this._addAngledTicks(d,f,Ha,Qa);this._addAngledTicks(d,this._mix(f,1,Ta,Za),this._mix(Ha,
1,Ta,Za),this._mid(f,Ha));break;case k.GeometricEffectControlMeasureLineRule.Parallel:const hb=this._cp2(c,3,0),ib=this._cp3(c,hb,.5,-1),pb=this._sub(hb,f);this._normalize(pb);const ob=this._leftPerp(pb),yb=this._crossProduct(pb,this._sub(ib,f));let wb=[f,hb];d.push(wb);wb=[];wb.push([f[0]+ob[0]*yb,f[1]+ob[1]*yb]);wb.push([hb[0]+ob[0]*yb,hb[1]+ob[1]*yb]);d.push(wb);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularToFirstSegment:const Fb=this._cp2(c,3,0),zb=this._cp3(c,Fb,.5,-1),Tb=
this._mid(f,Fb),nb=this._sub(Fb,f);this._normalize(nb);const xb=this._crossProduct(nb,this._sub(zb,f));this._leftPerpendicular(nb);const Ab=[];Ab.push([Tb[0]-nb[0]*xb*.25,Tb[1]-nb[1]*xb*.25]);Ab.push([Tb[0]+nb[0]*xb*1.25,Tb[1]+nb[1]*xb*1.25]);d.push(Ab);break;case k.GeometricEffectControlMeasureLineRule.ParallelOffset:const Mb=this._cp2(c,3,0),gc=this._cp3(c,Mb,.5,-1),Vb=this._sub(Mb,f);this._normalize(Vb);const Zb=this._crossProduct(Vb,this._sub(gc,f));this._leftPerpendicular(Vb);const hc=[];hc.push([f[0]-
Vb[0]*Zb,f[1]-Vb[1]*Zb]);hc.push([Mb[0]-Vb[0]*Zb,Mb[1]-Vb[1]*Zb]);d.push(hc);const Qb=[];Qb.push([f[0]+Vb[0]*Zb,f[1]+Vb[1]*Zb]);Qb.push([Mb[0]+Vb[0]*Zb,Mb[1]+Vb[1]*Zb]);d.push(Qb);break;case k.GeometricEffectControlMeasureLineRule.OffsetOpposite:const Nb=this._cp2(c,3,0),Wb=this._cp3(c,Nb,.5,-1),Hb=this._sub(Nb,f);this._normalize(Hb);const Gb=this._crossProduct(Hb,this._sub(Wb,f));this._leftPerpendicular(Hb);const Xb=[];Xb.push([f[0]-Hb[0]*Gb,f[1]-Hb[1]*Gb]);Xb.push([Nb[0]-Hb[0]*Gb,Nb[1]-Hb[1]*Gb]);
d.push(Xb);break;case k.GeometricEffectControlMeasureLineRule.OffsetSame:const $b=this._cp2(c,3,0),Db=this._cp3(c,$b,.5,-1),Jb=this._sub($b,f);this._normalize(Jb);const ic=this._crossProduct(Jb,this._sub(Db,f));this._leftPerpendicular(Jb);const ac=[];ac.push([f[0]+Jb[0]*ic,f[1]+Jb[1]*ic]);ac.push([$b[0]+Jb[0]*ic,$b[1]+Jb[1]*ic]);d.push(ac);break;case k.GeometricEffectControlMeasureLineRule.CircleWithArc:let mc=this._cp2(c,3,0);const Rb=this._cp3(c,mc,.5,-1);let cc,rc;if(4<=l)cc=c[3],rc=0<this._crossProduct(this._sub(cc,
mc),this._sub(Rb,mc));else{cc=mc;rc=0<this._crossProduct(this._sub(cc,f),this._sub(Rb,f));const Bb=24*this._geomUnitsPerPoint,jc=this._sub(cc,f);this._normalize(jc,Bb);const qc=Math.sqrt(2)/2;this._rotateDirect(jc,qc,rc?qc:-qc);mc=this._add(f,jc)}const oc=this._sub(mc,f),Bc=Math.cos(Math.PI/18),Cc=Math.sin(Math.PI/18),vc=[mc];for(let Bb=1;36>=Bb;Bb++)this._rotateDirect(oc,Bc,Cc),vc.push(this._add(f,oc));this._add90DegArc(vc,mc,cc,Rb,rc);h.setId(vc[vc.length-8],1);d.push(vc);break;case k.GeometricEffectControlMeasureLineRule.DoubleJog:let nc=
this._cp2(c,-3,1),wc;wc=3<=l?c[2]:this._add(f,this._sub(f,nc));let xc;if(4<=l)xc=c[3];else{const Bb=f;f=nc;xc=wc;const jc=this._dist(f,Bb),qc=this._dist(xc,Bb);let Lc=30*this._geomUnitsPerPoint;.5*jc<Lc&&(Lc=.5*jc);.5*qc<Lc&&(Lc=.5*qc);nc=this._mix(f,Lc/jc,Bb,(jc-Lc)/jc);wc=this._mix(xc,Lc/qc,Bb,(qc-Lc)/qc)}const Fc=this._mid(f,nc),Mc=this._mid(xc,wc),Yc=this._dist(f,nc),Uc=this._dist(wc,xc);let Dc=Math.min(Yc,Uc)/8;Dc=Math.min(Dc,24*this._geomUnitsPerPoint);const yc=Math.cos(Math.PI/4);let pc=this._sub(f,
nc);this._normalize(pc,Dc);0<this._crossProduct(pc,this._sub(xc,nc))?this._rotateDirect(pc,yc,-yc):this._rotateDirect(pc,yc,yc);let zc=[];zc.push(nc);zc.push(this._add(Fc,pc));zc.push(this._sub(Fc,pc));zc.push(f);d.push(zc);pc=this._sub(xc,wc);this._normalize(pc,Dc);0>this._crossProduct(pc,this._sub(f,wc))?this._rotateDirect(pc,yc,yc):this._rotateDirect(pc,yc,-yc);zc=[];zc.push(wc);zc.push(this._add(Mc,pc));zc.push(this._sub(Mc,pc));zc.push(xc);d.push(zc);break;case k.GeometricEffectControlMeasureLineRule.PerpendicularOffset:const hd=
this._cp2(c,-4,1),Bd=this._cp3(c,hd,.882353,-1.94),Zc=this._sub(Bd,hd);0<this._crossProduct(Zc,this._sub(f,hd))?this._rightPerpendicular(Zc):this._leftPerpendicular(Zc);const Cd=[Zc[0]/8,Zc[1]/8],Dd=this._sub(this._mid(hd,Bd),Cd);d.push([Dd,f]);break;case k.GeometricEffectControlMeasureLineRule.LineExcludingLastSegment:const $c=this._arrowPath(c),id=[];let vd=$c.length-2;for(;vd--;)id.push($c[vd]);d.push(id);break;case k.GeometricEffectControlMeasureLineRule.MultivertexArrow:const ee=this._arrowPath(c),
Ed=[];this._addArrow(Ed,ee,!1);d.push(Ed);break;case k.GeometricEffectControlMeasureLineRule.CrossedArrow:const fe=this._arrowPath(c),Fd=[];this._addArrow(Fd,fe,!0);d.push(Fd);break;case k.GeometricEffectControlMeasureLineRule.ChevronArrow:const [Gd,jd]=this._arrowLastSeg(c),wd=10*this._geomUnitsPerPoint,Ec=this._sub(f,Gd);this._normalize(Ec);const ad=this._crossProduct(Ec,this._sub(jd,Gd)),Rc=this._leftPerp(Ec),bd=[jd[0]-Rc[0]*ad*2,jd[1]-Rc[1]*ad*2],kd=[];kd.push([jd[0]+Ec[0]*wd,jd[1]+Ec[1]*wd]);
kd.push(f);kd.push([bd[0]+Ec[0]*wd,bd[1]+Ec[1]*wd]);d.push(kd);break;case k.GeometricEffectControlMeasureLineRule.ChevronArrowOffset:const [Vc,Sc]=this._arrowLastSeg(c),uc=this._sub(f,Vc);this._normalize(uc);const Tc=this._crossProduct(uc,this._sub(Sc,Vc));this._leftPerpendicular(uc);const Wc=[Sc[0]-uc[0]*Tc,Sc[1]-uc[1]*Tc],cd=[];cd.push([Wc[0]+uc[0]*Tc*.5,Wc[1]+uc[1]*Tc*.5]);cd.push(this._mid(Wc,f));cd.push([Wc[0]-uc[0]*Tc*.5,Wc[1]-uc[1]*Tc*.5]);d.push(cd);break;case k.GeometricEffectControlMeasureLineRule.PartialFirstSegment:const [ld,
Nc]=this._arrowLastSeg(c),dd=this._sub(f,ld);this._normalize(dd);const ge=this._crossProduct(dd,this._sub(Nc,ld));this._leftPerpendicular(dd);d.push([ld,[Nc[0]-dd[0]*ge,Nc[1]-dd[1]*ge]]);break;case k.GeometricEffectControlMeasureLineRule.Arch:const xd=this._cp2(c,0,-1),md=this._cp3(c,xd,.5,1),Hd=this._sub(f,xd),he=this._mix(md,1,Hd,.55),ie=this._mix(md,1,Hd,-.55),yd=[f];this._addBezier2(yd,f,he,md,4);this._addBezier2(yd,md,ie,xd,4);d.push(yd);break;case k.GeometricEffectControlMeasureLineRule.CurvedParallelTicks:const Oc=
this._cp2(c,-4,1),Xc=this._cp3(c,Oc,.882353,-1.94),Pc=this._sub(Xc,Oc);0<this._crossProduct(Pc,this._sub(f,Oc))?this._rightPerpendicular(Pc):this._leftPerpendicular(Pc);const nd=[Pc[0]/8,Pc[1]/8],zd=this._sub(this._mid(Oc,Xc),nd),je=this._sub(this._mix(Oc,.75,Xc,.25),nd),ke=this._sub(this._mix(Oc,.25,Xc,.75),nd),od=[Oc];this._addBezier2(od,Oc,je,zd,3);this._addBezier2(od,zd,ke,Xc,3);d.push(od);for(let Bb=0;8>Bb;Bb++){const jc=od[2*Bb+1],qc=[this._clone(jc)];qc.push(this._add(jc,[Pc[0]/4,Pc[1]/4]));
d.push(qc)}break;case k.GeometricEffectControlMeasureLineRule.Arc90Degrees:const Ad=this._cp2(c,0,-1),Id=this._cp3(c,Ad,.5,1),Jd=[Ad];this._add90DegArc(Jd,Ad,f,Id);d.push(Jd);break;default:d.push(c)}}return d}}a.EffectControlMeasureLine=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=
new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends n.PathEffectCursor{constructor(g,e,d){super(g,!0,!0);this._curveHelper=new h.CurveHelper;this._beginCut=(void 0!==e.beginCut?e.beginCut:1)*d;this._endCut=(void 0!==e.endCut?e.endCut:1)*d;this._middleCut=(void 0!==e.middleCut?e.middleCut:0)*d;this._invert=void 0!==e.invert?e.invert:!1;0>this._beginCut&&(this._beginCut=0);0>this._endCut&&(this._endCut=0);0>this._middleCut&&(this._middleCut=0)}processPath(g){const {_beginCut:e,
_endCut:d,_middleCut:c}=this,l=g.pathLength(),f=b.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(!this._invert)if(0===e&&0===d&&0===c)for(f.startPath();g.nextPoint();)f.pushXY(g.x,g.y);else e+d+c<l&&(0===c?this._curveHelper.appendSubCurve(f,g,e,l-d):(this._curveHelper.appendSubCurve(f,g,e,.5*(l-c)),this._curveHelper.appendSubCurve(f,g,.5*(l+c),l-d)));else if(0!==e||0!==d||0!==c)if(e+d+c>=l)for(f.startPath();g.nextPoint();)f.pushXY(g.x,g.y);else this._curveHelper.appendSubCurve(f,
g,0,e),this._curveHelper.appendSubCurve(f,g,.5*(l-c),.5*(l+c)),this._curveHelper.appendSubCurve(f,g,l-d,d);return 0===f.totalSize?null:f}}a.EffectCut=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define("exports ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../CIMCursor ../enums ../GeometryWalker ../utils".split(" "),function(a,b,n,h,k,m,g){class e{static local(){null===e.instance&&(e.instance=new e);
return e.instance}execute(c,l,f,r,x){return new d(c,l,f)}}e.instance=null;class d extends h.PathEffectCursor{constructor(c,l,f){super(c,!0,!0);this._firstCurve=null;this._walker=new m.GeometryWalker;this._walker.updateTolerance(f);this._endings=l.lineDashEnding;this._customDashPos=-(l.offsetAlongLine??0)*f;this._offsetAtEnd=(l.customEndingOffset??0)*f;this._pattern=new m.DashPattern;this._pattern.init(g.normalizeDashTemplate(l).dashTemplate,!0);this._pattern.scale(f)}processPath(c){if(0===this._pattern.length())return this.iteratePath=
!1,c=n.collectPath(c),b.GeometryCursor.fromJSONCIM({paths:[c]});if(!this.iteratePath){var l=!0;switch(this._endings){default:this._pattern.extPtGap=0;break;case k.LineDashEnding.FullPattern:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case k.LineDashEnding.FullGap:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case k.LineDashEnding.NoConstraint:this.isClosed||(l=!1);break;case k.LineDashEnding.Custom:this.isClosed||(this._pattern.extPtGap=
.5*this._offsetAtEnd)}var f=c.pathLength();if(this._pattern.isEmpty()||f<.1*this._pattern.length()||!this._walker.init(c,this._pattern,l))return c=n.collectPath(c),b.GeometryCursor.fromJSONCIM({paths:[c]})}if(this.iteratePath)c=this._pattern.nextValue();else{switch(this._endings){default:l=.5*this._pattern.firstValue();break;case k.LineDashEnding.HalfGap:l=.5*-this._pattern.lastValue();break;case k.LineDashEnding.FullGap:l=-this._pattern.lastValue();break;case k.LineDashEnding.FullPattern:l=0;break;
case k.LineDashEnding.NoConstraint:case k.LineDashEnding.Custom:l=-this._customDashPos}c=l/this._pattern.length();c-=Math.floor(c);l=c*this._pattern.length();this._pattern.reset();c=this._pattern.nextValue();for(f=!1;l>=c;)l-=c,c=this._pattern.nextValue(),f=!f;c-=l;f?(this._walker.nextPosition(c),c=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(c),c=this._pattern.nextValue(),this._walker.nextPosition(c),c=this._pattern.nextValue())}if(l=this._walker.nextCurve(c))if(this._walker.isPathEnd()){if(this.iteratePath=
!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)l.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else c=this._pattern.nextValue(),!this._walker.nextPosition(c)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(l.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,l=this._firstCurve,this._firstCurve=null;l?.reset();return l}}a.EffectDashes=e;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(a,b,n){class h{constructor(){this._values=[];this._currentValue=this._length=this.ctrlPtGap=this.extPtGap=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,d,c=!0){this._setEmpty();if(!e||0===e.length)return!1;for(let l=0;l<e.length;l++){let f=Math.abs(e[l]);c&&1E-7>f&&(f=1E-7);this._values.push(f);this._length+=f}d&&e.length&
1&&(this._length*=2);if(0===this._length)return!1;this.ctrlPtGap=this.extPtGap=0;this._currentValue=-1;return!0}scale(e){const d=this._values?this._values.length:0;for(let c=0;c<d;++c)this._values[c]*=e;this._length*=e;this.extPtGap*=e;this.ctrlPtGap*=e}addValue(e){this._length+=e;this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){this._currentValue++;this._currentValue===this._values.length&&(this._currentValue=0);return this._values[this._currentValue]}reset(){this._currentValue=
-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0;this._currentValue=-1;this._values.length=0}}class k{constructor(){this.pt=null;this.sa=this.ca=0}}a.EndType=void 0;(function(e){e[e.FAIL=0]="FAIL";e[e.END=1]="END";e[e.CONTINUE=2]="CONTINUE"})(a.EndType||(a.EndType={}));class m{constructor(){this.reset()}reset(){this.segment=null;this.abscissa=this.segmentLength=0;this.isPartEnd=this.isPathEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment;
e.segmentLength=this.segmentLength;e.abscissa=this.abscissa;e.isPathEnd=this.isPathEnd;e.isPartEnd=this.isPartEnd}}class g extends n.CurveHelper{constructor(e=0,d=!1){super(e,d);this._tolerance=n.pixelTolerance;this._currentPosition=new m}updateTolerance(e){this._tolerance=n.pixelTolerance*e}init(e,d,c=!0){c?(this._patternLength=d.length(),this._partExtPtGap=d.extPtGap,this._partCtrlPtGap=d.ctrlPtGap):this._partCtrlPtGap=this._partExtPtGap=this._patternLength=0;this._currentPosition.reset();this._partSegCount=
0;this._pathCursor=e;this._seg=-1;return this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,d=a.EndType.FAIL){const c=new m;if(!this._nextPosition(e,c,null,d))return!1;c.copyTo(this._currentPosition);return!0}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const [d,c]=this._getAngleCS(this._currentPosition);e.ca=d;e.sa=c}nextPointAndAngle(e,d,c=a.EndType.FAIL){const l=new m;if(!this._nextPosition(e,l,null,c))return!1;l.copyTo(this._currentPosition);
d.pt=this._getPoint(l);const [f,r]=this._getAngleCS(l);d.ca=f;d.sa=r;return!0}nextCurve(e){if(0===e)return null;const d=b.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");d.startPath();d.nextPath();const c=new m;if(!this._nextPosition(e,c,d,a.EndType.END))return null;c.copyTo(this._currentPosition);return d}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){this._pathCursor.seekInPath(e);return[this._pathCursor.x,this._pathCursor.y]}getSeg(e){const d=
this.getPt(e);e=this.getPt(e+1);return[d,e]}_nextPosition(e,d,c,l){if(this._currentPosition.isPathEnd)return!1;var f=this._currentPosition.abscissa;0<this._currentPosition.segmentLength&&(f/=this._currentPosition.segmentLength);for(this._currentPosition.copyTo(d);d.abscissa+e*this._partLengthRatio>d.segmentLength+this._tolerance;)if(c&&(0===c.pathSize&&(0===f?(f=d.segment[0],c.pushXY(f[0],f[1])):c.pushPoint(this.getSegCoord2D(d.segment,f))),f=d.segment[1],c.pushXY(f[0],f[1])),f=0,e-=(d.segmentLength-
d.abscissa)/this._partLengthRatio,this._partSegCount)d.segment=this._nextSegment(),d.segmentLength=this.getSegLength(d.segment),d.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart()){if(l===a.EndType.FAIL)return!1;d.segmentLength=this.getSegLength(d.segment);d.isPartEnd=!0;l===a.EndType.END?(d.abscissa=d.segmentLength,d.isPathEnd=!0):d.abscissa=d.segmentLength+e;return!0}this._currentPosition.copyTo(d)}d.abscissa+=e*this._partLengthRatio;c&&(0===c.pathSize&&(0===f?c.pushPoint(d.segment[0]):
c.pushPoint(this.getSegCoord2D(d.segment,f))),e=d.abscissa/d.segmentLength,1===e?c.pushPoint(d.segment[1]):c.pushPoint(this.getSegCoord2D(d.segment,e)));!this._partSegCount&&Math.abs(d.abscissa-d.segmentLength)<this._tolerance&&(d.isPathEnd=this._partIsLast,d.isPartEnd=!0);return!0}_getPoint(e){return this.getSegCoord2D(this._currentPosition.segment,0>=e.segmentLength?0:e.abscissa/e.segmentLength)}_getAngleCS(e){return this.getSegAngleCS(this._currentPosition.segment,0>=e.segmentLength?0:e.abscissa/
e.segmentLength)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;this._partLength=0;this._partIsLast=!0;for(this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}for(var e=this._partSegCount;e;)this._previousSegment(),--e;
this._currentPosition.segment=this._nextSegment();this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment);this._currentPosition.abscissa=0;this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1;--this._partSegCount;e=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(e);e=e+this._partSegCount+1;e>=this._pathCursor.pathSize&&(e=0);this._ctrlPtEnd=this._pathCursor.getControlPointAt(e);if(0<this._patternLength){e=this._ctrlPtBegin?
this._partCtrlPtGap:this._partExtPtGap;const d=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let c=Math.round((this._partLength-(e+d))/this._patternLength);0>=c&&(c=0<e+d?0:1);this._partLengthRatio=this._partLength/(e+d+c*this._patternLength);.01>this._partLengthRatio&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+
1}}a.DashPattern=h;a.GeometryWalker=g;a.Pos=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../CIMEffects ../enums ../../../geometry/SpatialReference".split(" "),function(a,b,n,h,k,m){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(d,c,l,f,r,x){return new e(d,c,l,f,r,x)}}g.instance=null;class e{constructor(d,c,l,f,r,x){this._inputGeometries=
d;this._tileKey=f;this._geometryEngine=r;this._maxInflateSize=x*l;this._width=(void 0!==c.width?c.width:2)*l;this._option=c.option}next(){for(var d;d=this._inputGeometries.next();){if("esriGeometryEnvelope"===d.geometryType&&0<this._width){var c=d.asJSON();return 0>Math.min(c.xmax-c.xmin,c.ymax-c.ymin)-2*this._width?d:n.GeometryCursor.fromJSONCIM({paths:[[[c.xmin+this._width,c.ymin+this._width],[c.xmax-this._width,c.ymin+this._width],[c.xmax-this._width,c.ymax-this._width],[c.xmin+this._width,c.ymax-
this._width],[c.xmin+this._width,c.ymin+this._width]],[[c.xmin,c.ymin],[c.xmin,c.ymax],[c.xmax,c.ymax],[c.xmax,c.ymin],[c.xmin,c.ymin]]]})}if("esriGeometryPolygon"===d.geometryType){if(0===this._width)return d.clone();var l=this._geometryEngine;if(null==l)break;if(d=this._tileKey?h.clipCursorToTileExtent(d,this._maxInflateSize):d.clone()){if(l=l.buffer(m.WebMercator,d.asJSON(),-this._width,1))for(c of l.rings)if(c){d.startPath();for(const f of c.reverse())d.pushXY(f[0],d.yFactor*f[1])}return d}}}return null}}
a.EffectDonut=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends n.PathEffectCursor{constructor(g,e,d){super(g,!1,!0);this._curveHelper=new h.CurveHelper;this._length=(void 0!==e.length?
e.length:20)*d;this._angle=void 0!==e.angle?e.angle:225;this._position=void 0!==e.position?e.position:50;0>this._length&&(this._length=-this._length);20>this._position&&(this._position=20);80<this._position&&(this._position=80);this._mirror=!1}processPath(g){const e=b.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(g))return null;g.seekInPath(0);const d=g.x,c=g.y;g.seekInPath(g.pathSize-1);const l=g.x;g=g.y;this._curveHelper.normalize([l-d,g-c]);const f=
d+(l-d)*this._position/100,r=c+(g-c)*this._position/100,x=Math.cos((90-this._angle)/180*Math.PI);let w=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(w=-w);this._mirror=!this._mirror;e.pushPath([[d,c],[f-this._length/2*x,r-this._length/2*w],[f+this._length/2*x,r+this._length/2*w],[l,g]]);return e}}a.EffectJog=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(a){class b{static local(){null===b.instance&&
(b.instance=new b);return b.instance}execute(h,k,m,g,e){return new n(h,k,m)}}b.instance=null;class n{constructor(h,k,m){this._inputGeometries=h;this._offsetX=void 0!==k.offsetX?k.offsetX*m:0;this._offsetY=void 0!==k.offsetY?k.offsetY*m:0}next(){let h=this._inputGeometries.next();for(;h;){if(0<h.totalSize)return this._move(h.clone(),this._offsetX,this._offsetY);h=this._inputGeometries.next()}return null}_move(h,k,m){for(;h.nextPath();)for(;h.nextPoint();)h.x+=k,h.y+=m;h.reset();return h}}a.EffectMove=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define("exports ../../../geometry ../../../geometry/GeometryCursor ../../../geometry/geometryCursorCollectUtils ../../../geometry/support/jsonUtils ../CIMEffects ../CurveHelper ../enums ../../../geometry/SpatialReference".split(" "),function(a,b,n,h,k,m,g,e,d){class c{static local(){null===c.instance&&(c.instance=new c);return c.instance}execute(f,r,x,w,p,t){return new l(f,r,x,w,p,
t)}}c.instance=null;class l{constructor(f,r,x,w,p,t){this._inputGeometries=f;this._tileKey=w;this._geometryEngine=p;this._curveHelper=new g.CurveHelper;this._offset=(r.offset??1)*x;this._method=r.method;this._maxInflateSize=Math.max(Math.abs(t*x),10);this._option=r.option;this._offsetFlattenError=g.pixelTolerance*x}next(){for(var f;f=this._inputGeometries.next();){if(0===this._offset)return f.clone();if("esriGeometryEnvelope"===f.geometryType){if(this._method===e.GeometricEffectOffsetMethod.Rounded&&
0<this._offset){var r=h.collectPath(f);if(r=this._curveHelper.offset(r,-this._offset,this._method,4,this._offsetFlattenError))return f=n.GeometryCursor.createEmptyOptimizedCIM(f.geometryType),f.pushPath(r),f;break}r=f.asJSON();if(k.isExtent(r)&&0<Math.min(r.xmax-r.xmin,r.ymax-r.ymin)+2*this._offset)return n.GeometryCursor.fromJSONCIM({xmin:r.xmin-this._offset,xmax:r.xmax+this._offset,ymin:r.ymin-this._offset,ymax:r.ymax+this._offset})}r=this._geometryEngine;if(null!=r&&(f=this._tileKey?m.clipCursorToTileExtent(f,
this._maxInflateSize):f.clone()))return(f=r.offset(d.WebMercator,f.asJSON(),-this._offset,1,this._method,4,this._offsetFlattenError))?n.GeometryCursor.fromJSONCIM(f):null}return null}}a.EffectOffset=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(a){class b{static local(){null===b.instance&&(b.instance=new b);return b.instance}execute(h,k,m,g,e){return new n(h,k,m)}}b.instance=null;class n{constructor(h,
k,m){this._inputGeometries=h;this._reverse=void 0!==k.reverse?k.reverse:!0}next(){for(var h=this._inputGeometries.next();h;){if(!this._reverse)return h;if("esriGeometryPolyline"===h.geometryType){for(h=h.clone();h.nextPath();)for(let k=0;k<h.pathSize/2;k++){h.seekInPath(k);const m=h.x,g=h.y;h.seekInPath(h.pathSize-k-1);const e=h.x,d=h.y;h.x=m;h.y=g;h.seekInPath(k);h.x=e;h.y=d}h.reset();return h}h=this._inputGeometries.next()}return null}}a.EffectReverse=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(a,b){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(k,m,g,e,d){return new h(k,m,g)}}n.instance=null;class h{constructor(k,m,g){this._inputGeometries=k;this._rotateAngle=void 0!==m.angle?m.angle*Math.PI/180:0}next(){let k=this._inputGeometries.next();for(;k;){if(0===this._rotateAngle||"esriGeometryPoint"===k.geometryType)return k;
if(0<k.totalSize){var m=b.getCursorBoundsXY(k);const g=(m[2]+m[0])/2;m=(m[3]+m[1])/2;k.reset();return this._rotate(k.clone(),g,m)}k=this._inputGeometries.next()}return null}_rotate(k,m,g){const e=Math.cos(this._rotateAngle),d=Math.sin(this._rotateAngle);for(;k.nextPath();)for(;k.nextPoint();){const c=k.x-m,l=k.y-g;k.x=m+c*e-l*d;k.y=g+c*d+l*e}k.reset();return k}}a.EffectRotate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports",
"../../../geometry/support/boundsUtils"],function(a,b){class n{static local(){null===n.instance&&(n.instance=new n);return n.instance}execute(k,m,g,e,d){return new h(k,m,g)}}n.instance=null;class h{constructor(k,m,g){this._inputGeometries=k;this._xFactor=void 0!==m.XScaleFactor?m.XScaleFactor:1.15;this._yFactor=void 0!==m.YScaleFactor?m.YScaleFactor:1.15}next(){const k=this._inputGeometries.next();if(k){if(1===this._xFactor&&1===this._yFactor||"esriGeometryPoint"===k.geometryType)return k;if(0<k.totalSize){var m=
b.getCursorBoundsXY(k);const g=(m[2]+m[0])/2;m=(m[3]+m[1])/2;k.reset();return this._scaleCursor(k.clone(),g,m)}}return null}_scaleCursor(k,m,g){for(;k.nextPath();)for(;k.nextPoint();)k.x=m+(k.x-m)*this._xFactor,k.y=g+(k.y-g)*this._yFactor;k.reset();return k}}a.EffectScale=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../enums","../GeometryWalker"],function(a,b,n,h){class k{static local(){null===
k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m{constructor(g,e,d){this._inputGeometries=g;this._height=(void 0!==e.amplitude?e.amplitude:2)*d;this._period=(void 0!==e.period?e.period:3)*d;this._style=e.waveform;0>=this._height&&(this._height=Math.abs(this._height));0>=this._period&&(this._period=Math.abs(this._period));this._pattern=new h.DashPattern;this._pattern.addValue(this._period);this._pattern.addValue(this._period);this._walker=
new h.GeometryWalker;this._walker.updateTolerance(d)}next(){for(var g=this._inputGeometries.next();g;){if(0===this._height||0===this._period||(g=this._processGeom(g)))return g;g=this._inputGeometries.next()}return null}_processGeom(g){const e=b.GeometryCursor.createEmptyOptimizedCIM(g.geometryType);for(;g.nextPath();){e.startPath();const d=g.pathLength();if(this._walker.init(g,this._pattern))switch(this._style){default:this._constructCurve(e,d,!1);break;case n.GeometricEffectWaveform.Square:this._constructSquare(e,
d);break;case n.GeometricEffectWaveform.Triangle:this._constructTriangle(e,d);break;case n.GeometricEffectWaveform.Random:this._constructCurve(e,d,!0)}else for(;g.nextPoint();)e.pushXY(g.x,g.y)}return e}_constructCurve(g,e,d){var c=Math.round(e/this._period);0===c&&(c=1);const l=this._period/16,f=1/(16*c+1);e=2*Math.PI*e/(e/c);c=2*Math.PI*Math.random();const r=2*Math.PI*Math.random(),x=2*Math.PI*Math.random(),w=.75-Math.random()/2,p=.75-Math.random()/2,t=new h.Pos;this._walker.curPointAndAngle(t);
g.pushPoint(t.pt);let q=0;for(;;)if(this._walker.nextPointAndAngle(l,t)){const u=q;q+=f;let v;if(d){const y=this._height/2*(1+.3*Math.sin(w*e*u+c));v=y*Math.sin(e*u+r);v+=y*Math.sin(p*e*u+x);v/=2}else v=.5*this._height*Math.sin(.5*e*u);g.pushXY(t.pt[0]-v*t.sa,t.pt[1]+v*t.ca)}else{g.pushPoint(this._walker.getPathEnd());break}}_constructSquare(g,e){Math.round(e/this._period);for(e=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const c=new h.Pos;this._walker.curPointAndAngle(c);const l=new h.Pos;
if(this._walker.nextPointAndAngle(this._period,l)){const f=new h.Pos;this._walker.nextPointAndAngle(this._period,f)&&(e?(g.pushPoint(c.pt),e=!1):g.pushPoint(c.pt),g.pushXY(c.pt[0]-this._height/2*c.sa,c.pt[1]+this._height/2*c.ca),g.pushXY(l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca),g.pushXY(l.pt[0]+this._height/2*l.sa,l.pt[1]-this._height/2*l.ca),g.pushXY(f.pt[0]+this._height/2*f.sa,f.pt[1]-this._height/2*f.ca),d=!0)}}if(!d){g.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(g,
e){Math.round(e/this._period);for(e=!0;;){let d=!1;if(this._walker.curPositionIsValid()){const c=new h.Pos;this._walker.curPointAndAngle(c);const l=new h.Pos;if(this._walker.nextPointAndAngle(this._period/2,l)){const f=new h.Pos;this._walker.nextPointAndAngle(this._period,f)&&(this._walker.nextPosition(this._period/2)&&(e?(g.pushPoint(c.pt),e=!1):g.pushPoint(c.pt),g.pushXY(l.pt[0]-this._height/2*l.sa,l.pt[1]+this._height/2*l.ca),g.pushXY(f.pt[0]+this._height/2*f.sa,f.pt[1]-this._height/2*f.ca)),d=
!0)}}if(!d){g.pushPoint(this._walker.getPathEnd());break}}}}a.EffectWave=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../enums","../GeometryWalker"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends b.PathTransformationCursor{constructor(g,e,d){super(g);this._geometryWalker=
new h.GeometryWalker;this._geometryWalker.updateTolerance(d);this._angleToLine=e.angleToLine??!0;this._offset=(e.offset?e.offset:0)*d;this._originalEndings=e.endings;this._offsetAtEnd=(e.customEndingOffset?e.customEndingOffset:0)*d;this._position=-(e.offsetAlongLine?e.offsetAlongLine:0)*d;this._pattern=new h.DashPattern;this._pattern.init(e.placementTemplate,!1);this._pattern.scale(d);this._endings=this._originalEndings}processPath(g){if(this._pattern.isEmpty())return null;if(this.iteratePath)var e=
this._pattern.nextValue();else{this._endings=this._originalEndings===n.PlacementEndings.WithFullGap&&this.isClosed?n.PlacementEndings.WithMarkers:this._originalEndings;this._pattern.extPtGap=0;let d=!0;switch(this._endings){case n.PlacementEndings.NoConstraint:e=-this._position;e=this._adjustPosition(e);d=!1;break;default:e=-this._pattern.lastValue()/2;break;case n.PlacementEndings.WithFullGap:e=-this._pattern.lastValue();this._pattern.extPtGap=this._pattern.lastValue();break;case n.PlacementEndings.WithMarkers:e=
0;break;case n.PlacementEndings.Custom:e=-this._position,e=this._adjustPosition(e),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(g,this._pattern,d))return null;this._pattern.reset();for(g=0;e>g;)e-=g,g=this._pattern.nextValue();e=g-e;this.iteratePath=!0}g=new h.Pos;if(!this._geometryWalker.nextPointAndAngle(e,g)||this._endings===n.PlacementEndings.WithFullGap&&this._geometryWalker.isPathEnd())return this.iteratePath=!1,null;if(this._endings===n.PlacementEndings.WithMarkers&&
this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed))return null;this.internalPlacement.setTranslate(g.pt[0]-this._offset*g.sa,g.pt[1]+this._offset*g.ca);this._angleToLine&&this.internalPlacement.setRotateCS(g.ca,g.sa);return this.internalPlacement}_adjustPosition(g){g/=this._pattern.length();g-=Math.floor(g);return g*this._pattern.length()}}a.PlacementAlongLineSameSize=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports",
"../CIMCursor","../CurveHelper","../enums"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends b.PathTransformationCursor{constructor(g,e,d){super(g,!1,!0);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==e.angleToLine?e.angleToLine:!0;this._offset=void 0!==e.offset?e.offset*d:0;this._type=e.extremityPlacement;this._position=void 0!==e.offsetAlongLine?e.offsetAlongLine*
d:0;this._beginProcessed=!1}processPath(g){let e;switch(this._type){default:this._beginProcessed?(e=this._atExtremities(g,this._position,!1),this.iteratePath=this._beginProcessed=!1):(e=this._atExtremities(g,this._position,!0),this.iteratePath=this._beginProcessed=!0);break;case h.ExtremityPlacement.JustBegin:e=this._atExtremities(g,this._position,!0);break;case h.ExtremityPlacement.JustEnd:e=this._atExtremities(g,this._position,!1);case h.ExtremityPlacement.None:}return e}_atExtremities(g,e,d){d||
g.seekPathEnd();if(d?g.nextPoint():g.prevPoint()){let c=0,[l,f]=[0,0],[r,x]=[g.x,g.y];for(;d?g.nextPoint():g.prevPoint();){l=r;f=x;r=g.x;x=g.y;const w=this._curveHelper.getLength(l,f,r,x);if(c+w>e){g=(e-c)/w;const [p,t]=this._curveHelper.getAngleCS(l,f,r,x,g);g=this._curveHelper.getCoord2D(l,f,r,x,g);this.internalPlacement.setTranslate(g[0]-this._offset*t,g[1]+this._offset*p);this._angleToLine&&this.internalPlacement.setRotateCS(-p,-t);return this.internalPlacement}c+=w}}return null}}a.PlacementAtExtremities=
k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(a,b,n){class h{static local(){null===h.instance&&(h.instance=new h);return h.instance}execute(m,g,e,d,c){return new k(m,g,e)}}h.instance=null;class k extends b.PathTransformationCursor{constructor(m,g,e){super(m);this._walker=new n.GeometryWalker;this._walker.updateTolerance(e);this._angleToLine=void 0!==
g.angleToLine?g.angleToLine:!0;this._offset=void 0!==g.offset?g.offset*e:0;this._beginGap=void 0!==g.beginPosition?g.beginPosition*e:0;this._endGap=void 0!==g.endPosition?g.endPosition*e:0;this._flipFirst=void 0!==g.flipFirst?g.flipFirst:!0;this._pattern=new n.DashPattern;this._pattern.init(g.positionArray,!1,!1);this._subPathLen=0;this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0}processPath(m){if(this._pattern.isEmpty())return null;if(this.iteratePath){m=this._pattern.nextValue()*
this._subPathLen;var g=this._beginGap+m;m=g-this._prevPos;this._prevPos=g}else{this._posCount=this._pattern.size();this._isFirst=!0;this._prevPos=0;this._subPathLen=m.pathLength()-this._beginGap-this._endGap;if(0>this._subPathLen)return this.iteratePath=!1,null;if(!this._walker.init(m,this._pattern,!1))return null;this._pattern.reset();m=this._pattern.nextValue()*this._subPathLen;g=this._beginGap+m;m=g-this._prevPos;this._prevPos=g;this.iteratePath=!0}g=new n.Pos;if(!this._walker.nextPointAndAngle(m,
g,n.EndType.END))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(g.pt[0]-this._offset*g.sa,g.pt[1]+this._offset*g.ca);m=this._isFirst&&this._flipFirst;let e;this._angleToLine?(e=g.ca,g=g.sa):(e=1,g=0);m&&(e=-e,g=-g);this.internalPlacement.setRotateCS(e,g);this._isFirst=!1;this._posCount--;0===this._posCount&&(this.iteratePath=!1);return this.internalPlacement}}a.PlacementAtRatioPositions=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports",
"../../../core/RandomLCG","../CIMPlacements","../enums"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d,c,l)}}k.instance=null;class m{constructor(g,e,d,c,l){this._currentY=this._currentX=this._yMax=this._yMin=this._xMax=this._xMin=0;this._accelerationMap=null;this._testInsidePolygon=!1;this._verticalSubdivision=!0;this._stepX=Math.abs(e.stepX??16)*d;this._stepY=Math.abs(e.stepY??16)*d;this._stepX=Math.round(128*
this._stepX)/128;this._stepY=Math.round(128*this._stepY)/128;if(0!==this._stepX&&0!==this._stepY){this._gridType=e.gridType??h.PlacementGridType.Fixed;if(this._gridType===h.PlacementGridType.Random)this._randomLCG=new b(1*(e.seed??13)),this._randomness=(e.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._offsetY=this._offsetX=this._sinAngle=0,this._buildRandomValues();else{this._randomness=0;this._gridAngle=e.gridAngle??0;this._shiftOddRows=e.shiftOddRows??!1;this._offsetX=
(e.offsetX??0)*d;this._offsetY=(e.offsetY??0)*d;this._cosAngle=Math.cos(this._gridAngle/180*Math.PI);this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI);if(this._stepX)if(0>this._offsetX)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(0>this._offsetY)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginY=
this._graphicOriginX=0;if(null!=c){const [f,r,x,w]=c.split("/");e=parseFloat(f);d=parseFloat(r);c=parseFloat(x);this._graphicOriginX=512*-(parseFloat(w)*2**e+c);this._graphicOriginY=512*d;this._testInsidePolygon=!0}this._internalPlacement=new n.Placement;this._calculateMinMax(g);this._geometryCursor=g}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!m._randValues){m._randValues=[];for(let g=0;24>g;g++)for(let e=0;24>e;e++)m._randValues.push(this._randomLCG.getFloat()),
m._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(g){this._yMax=this._yMin=this._xMax=this._xMin=0;let e,d,c,l,f,r,x,w;e=d=x=f=Number.MAX_VALUE;c=l=w=r=-Number.MAX_VALUE;var p=1!==this._cosAngle;for(g.reset();g.nextPath();)for(;g.nextPoint();){var t=g.x;var q=g.y;var u=t-this._graphicOriginX-this._offsetX;var v=q-this._graphicOriginY-this._offsetY;if(p){var y=this._cosAngle*u-this._sinAngle*v;u=this._sinAngle*u+this._cosAngle*v}else y=u,u=v;e=Math.min(e,y);c=Math.max(c,y);d=Math.min(d,
u);l=Math.max(l,u);f=Math.min(f,q);r=Math.max(r,q);x=Math.min(x,t);w=Math.max(w,t)}f=f!==Number.MAX_VALUE?f:-512-this._stepY;r=r!==-Number.MAX_VALUE?r:this._stepY;x=x!==Number.MAX_VALUE?x:-this._stepX;w=w!==-Number.MAX_VALUE?w:512+this._stepX;this._polygonMin=(this._verticalSubdivision=r-f>=w-x)?f:x;if(this._testInsidePolygon){y=0-this._graphicOriginX-this._offsetX-this._stepX;q=512-this._graphicOriginX-this._offsetX+this._stepX;t=-512-this._graphicOriginY-this._offsetY-this._stepY;u=0-this._graphicOriginY-
this._offsetY+this._stepY;if(p){p=[[y,t],[y,u],[q,t],[q,u]];y=t=Number.MAX_VALUE;q=u=-Number.MAX_VALUE;for(const D of p)p=this._cosAngle*D[0]-this._sinAngle*D[1],v=this._sinAngle*D[0]+this._cosAngle*D[1],y=Math.min(y,p),q=Math.max(q,p),t=Math.min(t,v),u=Math.max(u,v)}e=e!==Number.MAX_VALUE?Math.max(e,y):y;d=d!==Number.MAX_VALUE?Math.max(d,t):t;c=c!==-Number.MAX_VALUE?Math.min(c,q):q;l=l!==-Number.MAX_VALUE?Math.min(l,u):u}this._xMin=Math.round(e/this._stepX);this._xMax=Math.round(c/this._stepX);this._yMin=
Math.round(d/this._stepY);this._yMax=Math.round(l/this._stepY);this._currentX=this._xMax+1;this._currentY=this._yMin-1;this._buildAccelerationMap(g,x,w,f,r)}_buildAccelerationMap(g,e,d,c,l){g.reset();const f=new Map,r=this._verticalSubdivision;d=r?l-c:d-e;l=Math.ceil(d/10);if(!(1>=l)){d=Math.floor(d/l);l++;this._delta=d;var x,w;if(r){l=-512-2*this._stepY;var p=2*this._stepY;var t=c}else l=-2*this._stepX,p=512+2*this._stepX,t=e;for(;g.nextPath();)if(!(2>g.pathSize)&&g.nextPoint()){var q=g.x;for(x=
g.y;g.nextPoint();q=e,x=c){e=g.x;c=g.y;if(r){if(x===c||x<l&&c<l||x>p&&c>p)continue;var u=Math.min(x,c);var v=Math.max(x,c)}else{if(q===e||q<l&&e<l||q>p&&e>p)continue;u=Math.min(q,e);v=Math.max(q,e)}for(;u<v;){var y=w=Math.floor((u-t)/d),D=q,G=x,A=e,C=c,E=f;let I=E.get(y);I||(I=[],E.set(y,I));I.push([[D,G],[A,C]]);u+=d}u=Math.floor((v-t)/d);u>w&&(v=e,y=c,D=f,G=D.get(u),G||(G=[],D.set(u,G)),G.push([[q,x],[v,y]]))}}this._accelerationMap=f}}_nextInside(){for(;;){if(this._currentX>this._xMax){this._currentY++;
if(this._currentY>this._yMax)return null;this._currentX=this._xMin;this._shiftOddRows&&this._currentY%2&&this._currentX--}var g=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(g+=.5*this._stepX);const e=this._currentY*this._stepY+this._offsetY;this._currentX++;let d;if(this._gridType===h.PlacementGridType.Random){const c=(this._currentX%24+24)%24,l=(this._currentY%24+24)%24;d=this._graphicOriginX+g+this._stepX*this._randomness*(.5-m._randValues[24*l+c])*2/3;g=this._graphicOriginY+
e+this._stepY*this._randomness*(.5-m._randValues[24*l+c+1])*2/3}else d=this._graphicOriginX+this._cosAngle*g+this._sinAngle*e,g=this._graphicOriginY-this._sinAngle*g+this._cosAngle*e;if(!this._testInsidePolygon||this._isInsidePolygon(d,g,this._geometryCursor))return this._internalPlacement.setTranslate(d,g),this._internalPlacement}}_isInsidePolygon(g,e,d){if(null==this._accelerationMap){var c=0,l;let x;g+=1E-6;e+=1E-6;for(d.reset();d.nextPath();)if(d.nextPoint()){var f=d.x;for(l=d.y;d.nextPoint();f=
r,l=x){var r=d.x;x=d.y;l>e!==x>e&&(0<(r-f)*(e-l)-(x-l)*(g-f)?c++:c--)}}return 0!==c}g+=1E-6;e+=1E-6;d=this._verticalSubdivision;l=this._accelerationMap.get(Math.floor(((d?e:g)-this._polygonMin)/this._delta));if(!l)return!1;f=0;for(c of l){l=c[0];r=c[1];if(d){if(l[1]>e===r[1]>e)continue;l=(r[0]-l[0])*(e-l[1])-(r[1]-l[1])*(g-l[0])}else{if(l[0]>g===r[0]>g)continue;l=(r[1]-l[1])*(g-l[0])-(r[0]-l[0])*(e-l[1])}0<l?f++:f--}return 0!==f}}a.PlacementInsidePolygon=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper","../enums"],function(a,b,n,h){class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends b.PathTransformationCursor{constructor(g,e,d){super(g);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==e.angleToLine?e.angleToLine:!0;this._offset=void 0!==e.offset?e.offset*d:0;
this._relativeTo=e.relativeTo;this._position=void 0!==e.startPointOffset?e.startPointOffset*d:0;this._epsilon=.001*d}processPath(g){var e=this._position;if(this._relativeTo===h.PlacementOnLineRelativeTo.SegmentMidpoint){this.iteratePath||(this.iteratePath=!0);if(g.nextPoint()){let [d,c]=[g.x,g.y],[l,f]=[0,0];for(;g.nextPoint();){l=g.x;f=g.y;e=this._curveHelper.getLength(d,c,l,f);if(e<this._epsilon){d=l;c=f;continue}g=.5+this._position/e;const [r,x]=this._curveHelper.getAngleCS(d,c,l,f,g);g=this._curveHelper.getCoord2D(d,
c,l,f,g);this.internalPlacement.setTranslate(g[0]-this._offset*x,g[1]+this._offset*r);this._angleToLine&&this.internalPlacement.setRotateCS(r,x);return this.internalPlacement}}this.iteratePath=!1;return null}return this.onLine(g,e,this._relativeTo===h.PlacementOnLineRelativeTo.LineEnd)}onLine(g,e,d){let c=!1;switch(this._relativeTo){default:g.seekPathStart();e=g.pathLength()/2+e;break;case h.PlacementOnLineRelativeTo.LineBeginning:break;case h.PlacementOnLineRelativeTo.LineEnd:c=!0}d?g.seekPathEnd():
g.seekPathStart();let l=0;if(d?g.prevPoint():g.nextPoint()){let [f,r]=[g.x,g.y],[x,w]=[0,0];for(;d?g.prevPoint():g.nextPoint();){x=g.x;w=g.y;const p=this._curveHelper.getLength(f,r,x,w);if(l+p>e){g=(e-l)/p;const [t,q]=this._curveHelper.getAngleCS(f,r,x,w,g);g=this._curveHelper.getCoord2D(f,r,x,w,g);d=c?-this._offset:this._offset;this.internalPlacement.setTranslate(g[0]-d*q,g[1]+d*t);this._angleToLine&&(c?this.internalPlacement.setRotateCS(-t,-q):this.internalPlacement.setRotateCS(t,q));return this.internalPlacement}f=
x;r=w;l+=p}}return null}}a.PlacementOnLine=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(a,b,n){function h(g,e){const d=Math.PI;for(;Math.abs(e-g)>d+2E-15;)e=e-g>d?e-2*d:e+2*d;return(g+e)/2}class k{static local(){null===k.instance&&(k.instance=new k);return k.instance}execute(g,e,d,c,l){return new m(g,e,d)}}k.instance=null;class m extends b.PathTransformationCursor{constructor(g,
e,d){super(g);this._curveHelper=new n.CurveHelper;this._angleToLine=void 0!==e.angleToLine?e.angleToLine:!0;this._offset=void 0!==e.offset?e.offset*d:0;this._endPoints=void 0!==e.placeOnEndPoints?e.placeOnEndPoints:!0;this._controlPoints=void 0!==e.placeOnControlPoints?e.placeOnControlPoints:!0;this._regularVertices=void 0!==e.placeOnRegularVertices?e.placeOnRegularVertices:!0;this._tags=[];this._tagIterator=0}processPath(g){this.iteratePath||(this._preparePath(g),this.iteratePath=!0);if(this._tagIterator>=
this._tags.length)return this._tagIterator=this._tags.length=0,this.iteratePath=!1,null;g=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(g[2]);let e=g[0],d=g[1];if(0!==this._offset){const c=Math.cos(g[2]);e-=this._offset*Math.sin(g[2]);d+=this._offset*c}this.internalPlacement.setTranslate(e,d);this._tagIterator++;return this.internalPlacement}_preparePath(g){this._tagIterator=this._tags.length=0;g.seekPathStart();const e=g.isClosed();let d=0,c=!1,l=0,f=0;g.seekPathStart();
if(g.nextPoint()){let r=g.x,x=g.y,w=g.getControlPoint(),p=!0,t=g.nextPoint();for(;t;){const q=g.x,u=g.y,v=g.getControlPoint();if(this._angleToLine||0!==this._offset)l=this._curveHelper.getAngle(r,x,q,u,0);p?(p=!1,e?(d=l,c=w):(this._endPoints||this._controlPoints&&w)&&this._tags.push([r,x,l])):w?this._controlPoints&&this._tags.push([r,x,h(f,l)]):this._regularVertices&&this._tags.push([r,x,h(f,l)]);if(this._angleToLine||0!==this._offset)f=this._curveHelper.getAngle(r,x,q,u,1);(t=g.nextPoint())||(e?
v||c?this._controlPoints&&this._tags.push([q,u,h(f,d)]):this._regularVertices&&this._tags.push([q,u,h(f,d)]):(this._endPoints||this._controlPoints&&v)&&this._tags.push([q,u,f]));r=q;x=u;w=v}}this._tagIterator=0}}a.PlacementOnVertices=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define("exports ../../../geometry/support/boundsUtils ../../../geometry/support/centroid ../../../geometry/support/labelPoint ../CIMPlacements ../enums".split(" "),
function(a,b,n,h,k,m){class g{static local(){null===g.instance&&(g.instance=new g);return g.instance}execute(d,c,l,f,r){return new e(d,c,l)}}g.instance=null;class e{constructor(d,c,l){this._geometryCursor=d;this._offsetX=void 0!==c.offsetX?c.offsetX*l:0;this._offsetY=void 0!==c.offsetY?c.offsetY*l:0;this._method=void 0!==c.method?c.method:m.PlacementPolygonCenterMethod.OnPolygon;this._internalPlacement=new k.Placement}next(){const d=this._geometryCursor;this._geometryCursor=null;return d?this._polygonCenter(d):
null}_polygonCenter(d){let c=!1;switch(this._method){case m.PlacementPolygonCenterMethod.CenterOfMass:if(d=n.weightedAreaCentroid(d))this._internalPlacement.setTranslate(d[0]+this._offsetX,d[1]+this._offsetY),c=!0;break;case m.PlacementPolygonCenterMethod.BoundingBoxCenter:if(d=b.getCursorBoundsXY(d))this._internalPlacement.setTranslate((d[2]+d[0])/2+this._offsetX,(d[3]+d[1])/2+this._offsetY),c=!0;break;default:d=h.getLabelPoint(d),null!==d&&(this._internalPlacement.setTranslate(d[0]+this._offsetX,
d[1]+this._offsetY),c=!0)}return c?this._internalPlacement:null}}a.PlacementPolygonCenter=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define("exports ../../core/PriorityQueue ./aaBoundingRect ./boundsUtils ./centroid ./coordsUtils ./intersectsBase".split(" "),function(a,b,n,h,k,m,g){function e(w,p){let t=0,q,u,v,y;for(p.reset();p.nextPath()&&p.nextPoint();)for(q=p.x,u=p.y;p.nextPoint();q=v,u=y)v=p.x,y=p.y,u>w[1]!==y>w[1]&&(0<(v-q)*
(w[1]-u)-(y-u)*(w[0]-q)?t++:t--);return 0!==t}function d(w,p,t){if(t&&e(w,p))return{coord:w,distance:0};t=Infinity;let q=0,u=0;var v=[0,0];let y=[0,0];const D=[0,0];for(p.reset();p.nextPath()&&p.nextPoint();)if(!(2>p.pathSize))for(v[0]=p.x,v[1]=p.y;p.nextPoint();v=y)y=[p.x,p.y],m.projectPointOnLineSeg(D,w,v,y),v=f(w,D),v<t&&(t=v,q=D[0],u=D[1]);return{coord:[q,u],distance:Math.sqrt(t)}}function c(w,p,t,q){t=[p,0];let u=Infinity,v=Infinity,y=!1,D=!1;p=[[p,q[1]-1],[p,q[3]+1]];q=[0,0];const G=[0,0],A=
[0,0],C=[[0,0],[0,0]],E=n.create();for(w.reset();w.nextPath()&&w.nextPoint();)if(!(2>w.pathSize))for(C[0][0]=w.x,C[0][1]=w.y;w.nextPoint();C[0][0]=C[1][0],C[0][1]=C[1][1]){C[1][0]=w.x;C[1][1]=w.y;a:{var I=E;var H=C;if(2>H.length){I=null;break a}I||=n.create();const [B,z]=H[0],[K,L]=H[1];I[0]=Math.min(B,K);I[1]=Math.min(z,L);I[2]=Math.max(B,K);I[3]=Math.max(z,L)}if(null!==I){G[0]=p[0][0];G[1]=p[0][1];A[0]=p[1][0];A[1]=p[1][1];a:{I=E;H=G;var J=A;let B=l(H,I),z=l(J,I);const K=I[0],L=I[1],F=I[2],M=I[3];
if(B&z){I=0;break a}if(!(B|z)){I=4;break a}const S=(B?1:0)|(z?2:0);do{const N=J[0]-H[0],P=J[1]-H[1];if(N>P)B&3?(B&1?(H[1]+=P*(K-H[0])/N,H[0]=K):(H[1]+=P*(F-H[0])/N,H[0]=F),B=l(H,I)):z&3?(z&1?(J[1]+=P*(K-J[0])/N,J[0]=K):(J[1]+=P*(F-J[0])/N,J[0]=F),z=l(J,I)):B?(B&4?(H[0]+=N*(L-H[1])/P,H[1]=L):(H[0]+=N*(M-H[1])/P,H[1]=M),B=l(H,I)):(z&4?(J[0]+=N*(L-J[1])/P,J[1]=L):(J[0]+=N*(M-J[1])/P,J[1]=M),z=l(J,I));else if(B&12?(B&4?(H[0]+=N*(L-H[1])/P,H[1]=L):(H[0]+=N*(M-H[1])/P,H[1]=M),B=l(H,I)):z&12?(z&4?(J[0]+=
N*(L-J[1])/P,J[1]=L):(J[0]+=N*(M-J[1])/P,J[1]=M),z=l(J,I)):B?(B&1?(H[1]+=P*(K-H[0])/N,H[0]=K):(H[1]+=P*(F-H[0])/N,H[0]=F),B=l(H,I)):(z&1?(J[1]+=P*(K-J[0])/N,J[0]=K):(J[1]+=P*(F-J[0])/N,J[0]=F),z=l(J,I)),B&z){I=0;break a}}while(B|z);I=S}0!==I&&g.segmentIntersects(p[0],p[1],C[0],C[1],q)&&(I=q[1],u>v?I<u&&(u=I,y=!0):I<v&&(v=I,D=!0))}}y&&D?t[1]=(u+v)/2:t[0]=t[1]=NaN;return t}function l(w,p){return(w[0]<p[0]?1:0)|(w[0]>p[2]?1:0)<<1|(w[1]<p[1]?1:0)<<2|(w[1]>p[3]?1:0)<<3}function f(w,p){return(w[0]-p[0])*
(w[0]-p[0])+(w[1]-p[1])*(w[1]-p[1])}function r(w,p){if(w<p)return-1;if(w>p)return 1;if(w===p)return 0;w=isNaN(w);p=isNaN(p);return w<p?-1:w>p?1:0}class x{constructor(w,p,t,q){this.x=w;this.y=p;this.cellSize=t;this.distancefromCellCenter=m.distanceFromPointToPolygon(w,p,q);this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}a.getLabelPoint=function(w){if(0===w.totalSize)return null;var p=h.getCursorBoundsXY(w);if(!p)return null;var t=8.8818E-14*(Math.abs(p[0])+Math.abs(p[2])+
Math.abs(p[1])+Math.abs(p[3])+1),q=0,u=0;w.reset();for(var v=0;w.nextPath();v++){var y=w.getCurrentRingArea();y>u&&(u=y,q=v)}w.seekPath(q);if(0===w.pathSize)return null;w.seekPathStart();y=h.getCursorPathBounds(w);if(Math.abs(u)<=2*t*t)return[(y[0]+y[2])/2,(y[1]+y[3])/2];w.seekPathStart();var D=k.ringCentroidCursorXY(w,n.create());if(null===D)return null;if(4>w.totalPoints)return D;u=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]];q=[NaN,NaN,NaN,NaN];v=[NaN,NaN,NaN,NaN];var G=!1,A=d(D,w,!0);0===A.distance&&
(G=!0,u[0][0]=D[0],u[0][1]=D[1],A=d(D,w,!1));q[0]=A.distance;v[0]=0;var C=[NaN,NaN];let E=!1,I=.25,H=-1;A=NaN;do{A=NaN;var J=y[0];u[1]=c(w,J+(y[2]-J)*I,t,p);isNaN(u[1][0])||isNaN(u[1][1])||(A=d(u[1],w,!1),A=A.distance);if(!isNaN(A)&&A>t&&e(u[1],w))E=!0,q[1]=A,v[1]=f(u[1],D);else if(!isNaN(A)&&A>H&&(H=A,C[0]=u[1][0],C[1]=u[1][1]),I-=.01,.1>I)if(0<=H)E=!0,q[1]=H,u[1][0]=C[0],u[1][1]=C[1],v[1]=f(u[1],D);else break}while(!E);E=!1;I=.5;H=-1;J=.01;let B=1;do{A=NaN;var z=y[0];u[2]=c(w,z+(y[2]-z)*I,t,p);
isNaN(u[2][0])||isNaN(u[2][1])||(A=d(u[2],w,!1),A=A.distance);if(!isNaN(A)&&A>t&&e(u[2],w))E=!0,q[2]=A,v[2]=f(u[2],D);else if(!isNaN(A)&&A>H)H=A,C[0]=u[2][0],C[1]=u[2][1];else if(A>H&&(H=A,C[0]=u[2][0],C[1]=u[2][1]),I=.5+J*B,J+=.01,B*=-1,.3>I||.7<I)if(0<=H)E=!0,q[2]=H,u[2][0]=C[0],u[2][1]=C[1],v[2]=f(u[2],D);else break}while(!E);E=!1;I=.75;H=-1;do if(A=NaN,J=y[0],u[3]=c(w,J+(y[2]-J)*I,t,p),isNaN(u[3][0])||isNaN(u[3][1])||(A=d(u[3],w,!1),A=A.distance),!isNaN(A)&&A>t&&e(u[3],w))E=!0,q[3]=A,v[3]=f(u[3],
D);else if(A>H&&(H=A,C[0]=u[3][0],C[1]=u[3][1]),I+=.01,.9<I)if(0<=H)E=!0,q[3]=H,u[3][0]=C[0],u[3][1]=C[1],v[3]=f(u[3],D);else break;while(!E);w=[0,1,2,3];p=G?0:1;for(y=p;4>y;y++)for(G=p;3>G;G++)D=v[G],C=v[G+1],0<r(D,C)&&(t=w[G],w[G]=w[G+1],w[G+1]=t,v[G]=C,v[G+1]=D);v=p;for(y=t=0;4>p;p++){switch(p){case 0:y=2*q[w[p]];break;case 1:y=1.66666666*q[w[p]];break;case 2:y=1.33333333*q[w[p]];break;case 3:y=q[w[p]]}y>t&&(t=y,v=w[p])}return u[v]};a.getPolylabelPoint=function(w){if(!w.nextPath()||!w.pathSize)return null;
var p=h.getCursorPathBounds(w),t=p[2]-p[0],q=p[3]-p[1];if(0===t||0===q)return[p[0]+t/2,p[1]+q/2];const u=Math.max(Math.min(t,q)/100,1),v=new b((G,A)=>A.maxDistanceToPolygon-G.maxDistanceToPolygon);q=Math.min(t,q);t=q/2;let y=0,D=0;for(y=p[0];y<p[2];y+=q)for(D=p[1];D<p[3];D+=q)v.enqueue(new x(y+t,D+t,t,w));w.reset();w.nextPath();p=k.ringsCentroidCursor(w);if(null===p)return null;for(p=new x(p[0],p[1],0,w);0<v.size;)q=v.dequeue(),q.distancefromCellCenter>p.distancefromCellCenter&&(p=q),q.maxDistanceToPolygon-
p.distancefromCellCenter<=u||(t=q.cellSize/2,v.enqueue(new x(q.x-t,q.y-t,t,w)),v.enqueue(new x(q.x+t,q.y-t,t,w)),v.enqueue(new x(q.x-t,q.y+t,t,w)),v.enqueue(new x(q.x+t,q.y+t,t,w)));return[p.x,p.y]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){class a{constructor(n=b){this._data=[];this._compare=n}get size(){return this._data.length}enqueue(n){if(null!=n){var {_data:h,_compare:k}=this;h.push(n);n=h.length-1>>>0;for(var m=h[n];0<
n;){const g=n-1>>1,e=h[g];if(0>=k(e,m))h[g]=m,h[n]=e,n=g;else break}}}dequeue(){const {_data:n,_compare:h}=this,k=n[0];var m=n.pop();if(0===n.length)return k;n[0]=m;m=0;const g=n.length,e=n[0];let d;let c=null;for(;;){var l=2*m+1;const f=2*m+2;c=null;l<g&&(d=n[l],0<h(d,e)&&(c=l));f<g&&(l=n[f],null===c&&0>=h(l,e)||null!==c&&0>=h(l,d))&&(c=f);if(null===c)break;n[m]=n[c];n[c]=e;m=c}return k}}const b=(n,h)=>n<h?-1:n>h?1:0;return a})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(a){a.getFirstFrame=
function(b){const n=b.getFrame(0);if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement)return n;const h=document.createElement("canvas");h.width=b.width;h.height=b.height;b=h.getContext("2d");n instanceof ImageData?b.putImageData(n,0,0):b.drawImage(n,0,0);return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){class a{constructor(b=0,n=0,h=0,k=0){this.x=b;this.y=n;this.width=h;this.height=k}static fromExtent(b){return new a(b.xmin,
-b.ymax,b.xmax-b.xmin,b.ymax-b.ymin)}get isEmpty(){return 0>=this.width||0>=this.height}union(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.width=Math.max(this.width,b.width);this.height=Math.max(this.height,b.height)}}return a})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(a,b){function n(k){return`rgba(${k.slice(0,3).toString()},${k[3]})`}class h{constructor(k){k&&(this._textRasterizationCanvas=k)}rasterizeText(k,
m){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const g=this._textRasterizationCanvas;var e=g.getContext("2d",{willReadFrequently:!0});this._setFontProperties(e,m);this._parameters=m;this._textLines=k.split(/\r?\n/);this._lineHeight=this._computeLineHeight();const {decoration:d,weight:c}=m.font;this._lineThroughWidthOffset=d&&"line-through"===d?.1*this._lineHeight:0;var l=(k=null!=m.backgroundColor||null!=m.borderLine)?b.backgroundPadding:0,f=this._computeTextWidth(e,
m)+2*l,r=this._lineHeight*this._textLines.length+2*l;g.width=f+2*this._lineThroughWidthOffset;g.height=r;if(0===g.width||0===g.height)return g.width=g.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:g};this._renderedLineHeight=Math.round(this._lineHeight*m.pixelRatio);this._renderedHaloSize=a.pt2px(m.halo.size)*m.pixelRatio;this._renderedWidth=f*m.pixelRatio;this._renderedHeight=r*m.pixelRatio;this._lineThroughWidthOffset*=m.pixelRatio;f=m.halo&&m.halo.color?
m.halo.color:[0,0,0,0];this._fillStyle=n(m.color??[0,0,0,0]);this._haloStyle=`rgb(${f.slice(0,3).toString()})`;f=this._renderedLineHeight;var x=this._renderedHaloSize;e.save();e.clearRect(0,0,g.width,g.height);this._setFontProperties(e,m);r=l*m.pixelRatio;l=e.textAlign;var w=this._renderedWidth-2*r;l=("center"===l?.5*w:"right"===l?w:0)+x+r;r=x+r;x=0<x;w=this._lineThroughWidthOffset;let p=0;if(k){e.save();k=m.backgroundColor??[0,0,0,0];const q=m.borderLine?.color??[0,0,0,0],u=2*a.pt2px(m.borderLine?.size??
0);e.fillStyle=n(k);e.strokeStyle=n(q);e.lineWidth=u;e.fillRect(0,0,g.width,g.height);e.strokeRect(0,0,g.width,g.height);e.restore()}x&&this._renderHalo(e,l,r,w,p,m);p+=r;w+=l;for(var t of this._textLines)x&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",e.fillText(t,w,p),e.globalCompositeOperation="source-over"),e.fillStyle=this._fillStyle,e.fillText(t,w,p),d&&"none"!==d&&this._renderDecoration(e,w,p,d,c),p+=f;e.restore();t=this._renderedWidth+2*this._lineThroughWidthOffset;
k=this._renderedHeight;e=e.getImageData(0,0,t,k);e=new Uint8Array(e.data);if(m.premultiplyColors)for(l=0;l<e.length;l+=4)f=e[l+3]/255,e[l]*=f,e[l+1]*=f,e[l+2]*=f;switch(m.horizontalAlignment){case "left":f=-.5;break;case "right":f=.5;break;default:f=0}switch(m.verticalAlignment){case "bottom":m=-.5;break;case "top":m=.5;break;case "baseline":m=-1/6;break;default:m=0}return{size:[t,k],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1,anchorX:f,anchorY:m,canvas:g}}_renderHalo(k,m,g,e,d,c){const l=
this._renderedWidth,f=this._renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=l;this._haloRasterizationCanvas.height=f;const r=this._haloRasterizationCanvas,x=r.getContext("2d");x.clearRect(0,0,l,f);this._setFontProperties(x,c);const {decoration:w,weight:p}=c.font;x.fillStyle=this._haloStyle;x.strokeStyle=this._haloStyle;x.lineJoin="round";this._renderHaloNative(x,m,g,w,p);k.globalAlpha=this._parameters.halo.color[3];
k.drawImage(r,0,0,l,f,e,d,l,f);k.globalAlpha=1}_renderHaloNative(k,m,g,e,d){const c=this._renderedLineHeight,l=this._renderedHaloSize;for(const f of this._textLines){const r=2*l;for(let x=0;5>x;x++){const w=(.6+.1*x)*r;k.lineWidth=w;k.strokeText(f,m,g);e&&"none"!==e&&this._renderDecoration(k,m,g,e,d,w)}g+=c}}_setFontProperties(k,m){var g=m.font;g=`${g.style} ${g.weight} ${a.pt2px(Math.max(m.size,.5)*m.pixelRatio).toFixed(1)}px ${g.family}, sans-serif`;k.font=g;k.textBaseline="top";switch(m.horizontalAlignment){case "left":m=
"left";break;case "right":m="right";break;case "center":m="center";break;default:m="left"}k.textAlign=m}computeTextSize(k,m){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const g=this._textRasterizationCanvas;var e=g.getContext("2d");this._setFontProperties(e,m);this._parameters=m;this._textLines=k.split(/\r?\n/);this._lineHeight=this._computeLineHeight();k=this._computeTextWidth(e,m);e=this._lineHeight*this._textLines.length;g.width=k;g.height=e;
return[k*m.pixelRatio,e*m.pixelRatio]}_computeTextWidth(k,m){let g=0;for(const e of this._textLines)g=Math.max(g,k.measureText(e).width);m=m.font;if("italic"===m.style||"oblique"===m.style||"string"===typeof m.weight&&("bold"===m.weight||"bolder"===m.weight)||"number"===typeof m.weight&&600<m.weight)g+=.3*k.measureText("w").width;g+=2*a.pt2px(this._parameters.halo.size);return Math.round(g)}_computeLineHeight(){let k=1.275*this._parameters.size;const m=this._parameters.font.decoration;m&&"underline"===
m&&(k*=1.3);return Math.round(k+2*a.pt2px(this._parameters.halo.size))}_renderDecoration(k,m,g,e,d,c){const l=.9*this._lineHeight;switch(k.textAlign){case "center":m-=this._renderedWidth/2;break;case "right":m-=this._renderedWidth}const f=k.textBaseline;if("underline"===e)switch(f){case "top":g+=l;break;case "middle":g+=l/2}else if("line-through"===e)switch(f){case "top":g+=l/1.5;break;case "middle":g+=l/3}e=c?1.5*c:Math.ceil(l*("bold"===d?.06:"bolder"===d?.09:.04));k.save();k.beginPath();k.strokeStyle=
k.fillStyle;k.lineWidth=e;k.moveTo(m-this._lineThroughWidthOffset,g);k.lineTo(m+this._renderedWidth+2*this._lineThroughWidthOffset,g);k.stroke();k.restore()}}return h})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(a){a.AttributeDataType=void 0;var b=a.AttributeDataType||(a.AttributeDataType={});b[b.FilterFlags=0]="FilterFlags";b[b.Animation=1]="Animation";b[b.GPGPU=2]="GPGPU";b[b.VV=3]="VV";b[b.DD0=4]="DD0";b[b.DD1=5]="DD1";b[b.DD2=6]="DD2";a.MAX_TILE_RESHUFFLES_PER_FRAME=
1;a.RESHUFFLING_EXEMPT_DRAW_CALLS=10;a.RESHUFFLING_EXEMPT_MEMORY_BYTES=1048576;a.RESHUFFLING_TARGET_DRAW_EFFICIENCY=.75;a.RESHUFFLING_TARGET_MEMORY_EFFICIENCY=.75;a.angleFactor256=256/360;a.animationUnit=2;a.attributeStoreInitialSize=256;a.attributeStoreTextureSize=1024;a.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.bitsetFillHasPatternHeightPrecisionFactor=32;a.bitsetFillHasPatternWidthPrecisionFactor=64;a.bitsetFillHasUnresolvedReplacementColor=8;a.bitsetFillRandomPatternOffset=
4;a.bitsetGenericConsiderAlphaOnly=16;a.bitsetGenericLockColor=2;a.bitsetLineScaleDash=4;a.bitsetMarkerAlignmentMap=1;a.bitsetMarkerAlignmentScreen=0;a.bitsetMarkerOutlineAllowColorOverride=4;a.bitsetMarkerScaleSymbolsProportionally=8;a.bitsetTypeFillOutline=1;a.bufferDataMinimumSize=128;a.bufferDataPoolSize=4;a.chartMaxFields=10;a.collisionBoxPadding=16;a.collisionBucketSize=128;a.collisionEarlyRejectBucketSize=16;a.collisionMaxZoomDelta=1;a.collisionPlacementPadding=8;a.collisionTileBoxSize=4;a.compressionFactorForU16=
128;a.dataDrivenUnit0=4;a.dataDrivenUnit1=5;a.dataDrivenUnit2=6;a.debugLabels=!1;a.displayRecordIntPerElement=8;a.dotDensityMaxFields=8;a.effectFlag0=16;a.enableEarlyLabelDiscard=!1;a.extrudeScale=64;a.filterFlag0=8;a.filterFlagsUnit=1;a.glyphSize=24;a.gpgpuUnit=12;a.heuristicGlyphsPerFeature=10;a.heuristicGlyphsPerLine=50;a.highlightReasonsCount=3;a.hittestRadius=1;a.labelPlacementOffsetPadding=4;a.magicLabelLineHeight=29;a.maxGeohashLevel=12;a.maxGpuUploadsPerFrame=2;a.maxRepresentableInt=16777216;
a.maxSizeForU16Compression=511;a.minMaxZoomPrecisionFactor=10;a.nanMagicNumber=1E-30;a.patchPixelBufferAllocSize=500;a.patternFillRasterizationScale=2;a.pictureFillColor=4294967295;a.randomInsidePolygonTextureSize=1024;a.rasterTileSize=256;a.sdfTextureSize=124;a.spritePadding=2;a.textureBindingBitmap=0;a.textureBindingGlyphAtlas=0;a.textureBindingHighlight0=5;a.textureBindingHighlight1=6;a.textureBindingRenderer0=5;a.textureBindingRenderer1=6;a.textureBindingSpriteAtlas=0;a.textureUploadManagerBudget=
4;a.textureUploadManagerChunkSize=128;a.thinLineHalfWidthThreshold=1.05;a.tileSize=512;a.visualVariableUnit=3;a.vtlHighResCutoff=1.15;a.vtlTextureBindingUnitGlyphs=6;a.vtlTextureBindingUnitSprites=5;a.webglMaxInnerStops=6;a.webglMaxStops=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/mat2d ../../../../../../core/libs/gl-matrix-2/factories/mat2df32 ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f32 ../../alignmentUtils ../../Rect ../../collisions/BoundingBox".split(" "),
function(a,b,n,h,k,m,g,e){function d(x,w){x.forEach(p=>h.transformMat2d(p,p,w));return{topLeft:x[0],topRight:x[1],bottomLeft:x[2],bottomRight:x[3]}}const c=Math.PI/180;class l{constructor(x,w,p,t){this._rotationT=n.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;this._bounds=null;const q=p.rect,u=new Float32Array(8);x*=t;w*=t;const v=p.code?q.width*t:p.metrics.width,y=p.code?q.height*t:p.metrics.height;this.width=v;this.height=y;u[0]=x;u[1]=w;u[2]=x+v;u[3]=w;u[4]=x;u[5]=w+y;u[6]=
x+v;u[7]=w+y;this._data=u;this._setTextureCoords(q);this._scale=t;this._mosaic=p;this.x=x;this.y=w;this.maxOffset=Math.max(x+v,w+y)}get mosaic(){return this._mosaic}set angle(x){this._angle=x;b.fromRotation(this._rotationT,-x);this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){this._offsets||
this._setOffsets();return this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const {height:q,width:u}=this._mosaic.metrics;var x=u*this._scale,w=Math.abs(q)*this._scale,p=new Float32Array(8);p[0]=this.x;p[1]=this.y;p[2]=this.x+x;p[3]=this.y;p[4]=this.x;p[5]=this.y+w;p[6]=this.x+x;p[7]=this.y+w;x=b.multiply(n.create(),this._rotationT,this._transform);n.transformMany(p,p,x);w=x=Infinity;let v=0;var t=0;for(let y=
0;4>y;y++){const D=p[2*y],G=p[2*y+1];x=Math.min(x,D);w=Math.min(w,G);v=Math.max(v,D);t=Math.max(t,G)}p=v-x;t-=w;this._bounds=new e(x+p/2,w+t/2,p,t)}return this._bounds}setTransform(x){this._transform=x;this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const x=b.multiply(n.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0];this._offsets.topLeft[1]=this._data[1];this._offsets.topRight[0]=this._data[2];
this._offsets.topRight[1]=this._data[3];this._offsets.bottomLeft[0]=this._data[4];this._offsets.bottomLeft[1]=this._data[5];this._offsets.bottomRight[0]=this._data[6];this._offsets.bottomRight[1]=this._data[7];h.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,x);h.transformMat2d(this._offsets.topRight,this._offsets.topRight,x);h.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,x);h.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,x)}_setTextureCoords({x,
y:w,width:p,height:t}){this._texcoords={topLeft:[x,w],topRight:[x+p,w],bottomLeft:[x,w+t],bottomRight:[x+p,w+t]}}}class f{constructor(x,w,p){this._rotation=0;this._decorate(x,w,p);this.glyphs=x;this.bounds=this._createBounds(x);this.isMultiline=1<w.length;this._hasRotation=0!==p.angle;this._transform=this._createGlyphTransform(this.bounds,p);if((this._borderLineSizePx=p.borderLineSizePx)||p.hasBackground)[this.bounds,this.textBox]=this.shapeBackground(this._transform);for(const t of x)t.setTransform(this._transform)}setRotation(x){if(0!==
x||0!==this._rotation){this._rotation=x;var w=this._transform;x=b.fromRotation(n.create(),x);b.multiply(w,x,w);for(const p of this.glyphs)p.setTransform(this._transform)}}_decorate(x,w,p){if(p.decoration&&"none"!==p.decoration&&x.length){var t=p.scale;p="underline"===p.decoration?26:16;var q=x[0].textureBinding;for(const D of w){const G=D.startX*t,A=D.startY*t;w=x;var u=w.push;var v=(D.width+D.glyphWidthEnd)*t;var y=q;v={code:0,page:0,sdf:!0,rect:new g(0,0,11,8),textureBinding:y,metrics:{advance:0,
height:4,width:v,left:0,top:0}};u.call(w,new l(G,A+p*t,v,1))}}}shapeBackground(x){const w=(1.5+(this._borderLineSizePx||0))/2;var p=this._borderLineSizePx?w:0;const {xmin:t,ymin:q,xmax:u,ymax:v,x:y,y:D,width:G,height:A}=this.bounds,C=[t-8,q-8],E=[u+8,q-8],I=[t-8,v+8],H=[u+8,v+8],J=d([[C[0]-w,C[1]-w],[E[0]+w,E[1]-w],[C[0]+p,C[1]+p],[E[0]-p,E[1]+p]],x),B=d([[I[0]+p,I[1]-p],[H[0]-p,H[1]-p],[I[0]-w,I[1]+w],[H[0]+w,H[1]+w]],x),z=d([[C[0]-w,C[1]-w],[C[0]+p,C[1]+p],[I[0]-w,I[1]+w],[I[0]+p,I[1]-p]],x);p=
d([[E[0]-p,E[1]+p],[E[0]+w,E[1]-w],[H[0]-p,H[1]-p],[H[0]+w,H[1]+w]],x);x={main:d([C,E,I,H],x),top:J,bot:B,left:z,right:p};return[new e(y,D,G+2*w,A+2*w),x]}get boundsT(){var x=this.bounds;const w=h.set(k.create(),x.x,x.y);h.transformMat2d(w,w,this._transform);return this._hasRotation?(x=Math.max(x.width,x.height),new e(w[0],w[1],x,x)):new e(w[0],w[1],x.width,x.height)}_createBounds(x){let w=Infinity,p=Infinity,t=0;var q=0;for(const u of x)w=Math.min(w,u.xTopLeft),p=Math.min(p,u.yTopLeft),t=Math.max(t,
u.xBottomRight),q=Math.max(q,u.yBottomRight);x=t-w;q-=p;return new e(w+x/2,p+q/2,x,q)}_createGlyphTransform(x,w){const p=c*w.angle,t=n.create(),q=k.create();b.translate(t,t,h.set(q,w.xOffset,-w.yOffset));w.useCIMAngleBehavior?b.rotate(t,t,p):(b.translate(t,t,h.set(q,x.x,x.y)),b.rotate(t,t,p),b.translate(t,t,h.set(q,-x.x,-x.y)));return t}}class r{constructor(x,w,p,t,q,u){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(w,p));this.end=Math.max(0,Math.max(w,p));this.end<x.length&&
(this.glyphWidthEnd=x[this.end].metrics.width);this.width=t;this.yMin=q;this.yMax=u}}a.ShapedGlyph=l;a.ShapingInfo=f;a.shapeGlyphs=function(x,w){const p=w.scale,t=[],{glyphs:q,isRightToLeft:u}=x;x=[];var v=1/w.scale*w.maxLineWidth;var y=u?q.length-1:0;var D=u?-1:q.length,G=u?-1:1,A=y,C=0,E=0,I=A;let H=I,J=0,B=Infinity,z=0;for(;A!==D;){const {code:L,metrics:F}=q[A];var K=Math.abs(F.top);10!==L&&32!==L&&(B=Math.min(B,K),z=Math.max(z,K+F.height));10===L?(A!==y&&(x.push(new r(q,I,A-G,C,B,z)),B=Infinity,
z=0),C=0,I=A+G,H=A+G,E=0):32===L?(H=A+G,E=0,J=F.advance,C+=F.advance):(C>v&&(H!==I?(K=H-2*G,C-=J,x.push(new r(q,I,K,C-E,B,z)),B=Infinity,z=0,I=H,C=E):(x.push(new r(q,I,A-G,C,B,z)),B=Infinity,z=0,H=I=A,C=0)),C+=F.advance,E+=F.advance);A+=G}v=new r(q,I,A-G,C,B,z);0<=v.start&&v.end<q.length&&x.push(v);for(v=0;v<x.length;v++);D=x[0].yMin;y=x[x.length-1].yMax+w.lineHeight*(x.length-1)+("underline"===w.decoration?4:0)-D;v=m.getXAnchorDirection(w.horizontalAlignment);G=m.getYAnchorDirection(w.verticalAlignment);
A=G===m.VAlign.Baseline?1:0;y=(1-A)*-D+y/2*(A?0:G-1)+-22*(A?1:0);for(D=0;D<x.length;D++){const {start:L,end:F,width:M}=x[D];G=M/2*(v+1)*-1-3;A=D*w.lineHeight+y-3;x[D].startX=G;x[D].startY=A;for(C=L;C<=F;C++)E=q[C],10!==E.code&&(I=new l(G+E.metrics.left,A-E.metrics.top,E,p),G+=E.metrics.advance,t.push(I))}return new f(t,x,w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(a,b){function n(A,C){A[0]=
C[0];A[1]=C[1];A[2]=C[2];A[3]=C[3];A[4]=C[4];A[5]=C[5];return A}function h(A){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=0;A[5]=0;return A}function k(A,C,E,I,H,J,B){A[0]=C;A[1]=E;A[2]=I;A[3]=H;A[4]=J;A[5]=B;return A}function m(A,C){const E=C[0],I=C[1],H=C[2],J=C[3],B=C[4];C=C[5];let z=E*J-I*H;if(!z)return null;z=1/z;A[0]=J*z;A[1]=-I*z;A[2]=-H*z;A[3]=E*z;A[4]=(H*C-J*B)*z;A[5]=(I*B-E*C)*z;return A}function g(A){return A[0]*A[3]-A[1]*A[2]}function e(A,C,E){const I=C[0],H=C[1],J=C[2],B=C[3],z=C[4];C=C[5];const K=
E[0],L=E[1],F=E[2],M=E[3],S=E[4];E=E[5];A[0]=I*K+J*L;A[1]=H*K+B*L;A[2]=I*F+J*M;A[3]=H*F+B*M;A[4]=I*S+J*E+z;A[5]=H*S+B*E+C;return A}function d(A,C,E){const I=C[0],H=C[1],J=C[2],B=C[3],z=C[4];C=C[5];const K=Math.sin(E);E=Math.cos(E);A[0]=I*E+J*K;A[1]=H*E+B*K;A[2]=I*-K+J*E;A[3]=H*-K+B*E;A[4]=z;A[5]=C;return A}function c(A,C,E){const I=C[1],H=C[2],J=C[3],B=C[4],z=C[5],K=E[0];E=E[1];A[0]=C[0]*K;A[1]=I*K;A[2]=H*E;A[3]=J*E;A[4]=B;A[5]=z;return A}function l(A,C,E){const I=C[0],H=C[1],J=C[2],B=C[3],z=C[4];
C=C[5];const K=E[0];E=E[1];A[0]=I;A[1]=H;A[2]=J;A[3]=B;A[4]=I*K+J*E+z;A[5]=H*K+B*E+C;return A}function f(A,C){const E=Math.sin(C);C=Math.cos(C);A[0]=C;A[1]=E;A[2]=-E;A[3]=C;A[4]=0;A[5]=0;return A}function r(A,C){A[0]=C[0];A[1]=0;A[2]=0;A[3]=C[1];A[4]=0;A[5]=0;return A}function x(A,C){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=C[0];A[5]=C[1];return A}function w(A){return"mat2d("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+")"}function p(A){return Math.sqrt(A[0]**2+A[1]**2+A[2]**2+A[3]**2+A[4]**2+
A[5]**2+1)}function t(A,C,E){A[0]=C[0]+E[0];A[1]=C[1]+E[1];A[2]=C[2]+E[2];A[3]=C[3]+E[3];A[4]=C[4]+E[4];A[5]=C[5]+E[5];return A}function q(A,C,E){A[0]=C[0]-E[0];A[1]=C[1]-E[1];A[2]=C[2]-E[2];A[3]=C[3]-E[3];A[4]=C[4]-E[4];A[5]=C[5]-E[5];return A}function u(A,C,E){A[0]=C[0]*E;A[1]=C[1]*E;A[2]=C[2]*E;A[3]=C[3]*E;A[4]=C[4]*E;A[5]=C[5]*E;return A}function v(A,C,E,I){A[0]=C[0]+E[0]*I;A[1]=C[1]+E[1]*I;A[2]=C[2]+E[2]*I;A[3]=C[3]+E[3]*I;A[4]=C[4]+E[4]*I;A[5]=C[5]+E[5]*I;return A}function y(A,C){return A[0]===
C[0]&&A[1]===C[1]&&A[2]===C[2]&&A[3]===C[3]&&A[4]===C[4]&&A[5]===C[5]}function D(A,C){const E=A[0],I=A[1],H=A[2],J=A[3],B=A[4];A=A[5];const z=C[0],K=C[1],L=C[2],F=C[3],M=C[4];C=C[5];const S=b.getEpsilon();return Math.abs(E-z)<=S*Math.max(1,Math.abs(E),Math.abs(z))&&Math.abs(I-K)<=S*Math.max(1,Math.abs(I),Math.abs(K))&&Math.abs(H-L)<=S*Math.max(1,Math.abs(H),Math.abs(L))&&Math.abs(J-F)<=S*Math.max(1,Math.abs(J),Math.abs(F))&&Math.abs(B-M)<=S*Math.max(1,Math.abs(B),Math.abs(M))&&Math.abs(A-C)<=S*Math.max(1,
Math.abs(A),Math.abs(C))}const G=Object.freeze(Object.defineProperty({__proto__:null,add:t,copy:n,determinant:g,equals:D,exactEquals:y,frob:p,fromRotation:f,fromScaling:r,fromTranslation:x,identity:h,invert:m,mul:e,multiply:e,multiplyScalar:u,multiplyScalarAndAdd:v,rotate:d,scale:c,set:k,str:w,sub:q,subtract:q,translate:l},Symbol.toStringTag,{value:"Module"}));a.add=t;a.copy=n;a.determinant=g;a.equals=D;a.exactEquals=y;a.frob=p;a.fromRotation=f;a.fromScaling=r;a.fromTranslation=x;a.identity=h;a.invert=
m;a.mat2d=G;a.mul=e;a.multiply=e;a.multiplyScalar=u;a.multiplyScalarAndAdd=v;a.rotate=d;a.scale=c;a.set=k;a.str=w;a.sub=q;a.subtract=q;a.translate=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(a){function b(){const d=new Float32Array(6);d[0]=1;d[3]=1;return d}function n(d){const c=new Float32Array(6);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];return c}function h(d,c,l,f,r,x){const w=
new Float32Array(6);w[0]=d;w[1]=c;w[2]=l;w[3]=f;w[4]=r;w[5]=x;return w}function k(d,c){return new Float32Array(d,c,6)}function m(d,c,l,f){const r=c[f];c=c[f+1];d[f]=l[0]*r+l[2]*c+l[4];d[f+1]=l[1]*r+l[3]*c+l[5]}function g(d,c,l,f=0,r=0,x=2){for(r=r||c.length/x;f<r;f++)m(d,c,l,f*x)}const e=Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:b,createView:k,fromValues:h,transform:m,transformMany:g},Symbol.toStringTag,{value:"Module"}));a.clone=n;a.create=b;a.createView=k;a.fromValues=h;
a.mat2df32=e;a.transform=m;a.transformMany=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(a,b){a.HAlign=void 0;(function(n){n[n.Left=-1]="Left";n[n.Center=0]="Center";n[n.Right=1]="Right"})(a.HAlign||(a.HAlign={}));a.VAlign=void 0;(function(n){n[n.Top=1]="Top";n[n.Center=0]="Center";n[n.Bottom=-1]="Bottom";n[n.Baseline=2]="Baseline"})(a.VAlign||(a.VAlign={}));a.getAlignmentFromPlacement=
function(n){switch(n){case "above-left":case "esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case "above-center":case "above-along":case "esriServerPointLabelPlacementAboveCenter":case "esriServerLinePlacementAboveAlong":return["center","bottom"];case "above-right":case "esriServerPointLabelPlacementAboveRight":return["left","bottom"];case "center-left":case "esriServerPointLabelPlacementCenterLeft":return["right","middle"];case "center-center":case "center-along":case "esriServerPointLabelPlacementCenterCenter":case "esriServerLinePlacementCenterAlong":return["center",
"middle"];case "center-right":case "esriServerPointLabelPlacementCenterRight":return["left","middle"];case "below-left":case "esriServerPointLabelPlacementBelowLeft":return["right","top"];case "below-center":case "below-along":case "esriServerPointLabelPlacementBelowCenter":case "esriServerLinePlacementBelowAlong":return["center","top"];case "below-right":case "esriServerPointLabelPlacementBelowRight":return["left","top"];case "always-horizontal":case "esriServerPolygonPlacementAlwaysHorizontal":return["center",
"middle"];default:return console.debug(`Found invalid placement type ${n}`),["center","middle"]}};a.getJustification=function(n){switch(n){case "left":return a.HAlign.Left;case "right":return a.HAlign.Right;case "center":return a.HAlign.Center}};a.getXAnchorDirection=function(n){if(!n)return a.HAlign.Center;switch(n){case "Left":case "left":return a.HAlign.Left;case "Right":case "right":return a.HAlign.Right;case "Justify":return b.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),
a.HAlign.Center;case "Center":case "center":return a.HAlign.Center}};a.getXDirection=function(n){switch(n){case a.HAlign.Right:case "right":return-1;case a.HAlign.Center:case "center":return 0;case a.HAlign.Left:case "left":return 1;default:return console.debug(`Found invalid horizontal alignment ${n}`),0}};a.getYAnchorDirection=function(n){if(!n)return a.VAlign.Center;switch(n){case "Top":case "top":return a.VAlign.Top;case "Center":case "middle":return a.VAlign.Center;case "Baseline":case "baseline":return a.VAlign.Baseline;
case "Bottom":case "bottom":return a.VAlign.Bottom}};a.getYDirection=function(n){switch(n){case a.VAlign.Top:case "top":return 1;case a.VAlign.Center:case "middle":return 0;case a.VAlign.Bottom:case a.VAlign.Baseline:case "baseline":case "bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${n}`),0}};a.isMapAligned=function(n){switch(n){case "above-along":case "below-along":case "center-along":case "esriServerLinePlacementAboveAlong":case "esriServerLinePlacementBelowAlong":case "esriServerLinePlacementCenterAlong":return!0;
default:return!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){class a{constructor(b=0,n=0,h=0,k=0){this.x=b;this.y=n;this.width=h;this.height=k}get isEmpty(){return 0>=this.width||0>=this.height}union(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.width=Math.max(this.width,b.width);this.height=Math.max(this.height,b.height)}}return a})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],
function(a){class b{constructor(n,h,k,m){this.computedY=this.computedX=0;this.center=a.fromValues(n,h);this.centerT=a.create();this.halfWidth=k/2;this.halfHeight=m/2;this.width=k;this.height=m}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+
this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(n){this.center[0]=n}set y(n){this.center[1]=n}clone(){return new b(this.x,this.y,this.width,this.height)}serialize(n){n.writeF32(this.center[0]);n.writeF32(this.center[1]);n.push(this.width);n.push(this.height);return n}findCollisionDelta(n,h=4){return Math.log2(Math.min((n.halfWidth+this.halfWidth+h)/Math.abs(n.centerT[0]-this.centerT[0]),(n.halfHeight+this.halfHeight+h)/Math.abs(n.centerT[1]-this.centerT[1])))}extend(n){const h=
Math.min(this.xmin,n.xmin),k=Math.min(this.ymin,n.ymin),m=Math.max(this.xmax,n.xmax)-h;n=Math.max(this.ymax,n.ymax)-k;this.width=m;this.height=n;this.halfWidth=m/2;this.halfHeight=n/2;this.x=h+m/2;this.y=k+n/2}static deserialize(n){const h=n.readF32(),k=n.readF32(),m=n.readInt32();n=n.readInt32();return new b(h,k,m,n)}}return b})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports","../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(a,
b,n){function h(c,l){c%=l;return 0<=c?c:c+l}const k=Number.POSITIVE_INFINITY,m=Math.PI,g=128/m,e=256/360,d=1/Math.LN2;a.between=function(c,l,f){return c>=l&&c<=f||c>=f&&c<=l};a.c2pi=2*m;a.cDegTo256=e;a.cDegToRad=m/180;a.cInfinity=k;a.cPi=m;a.cRadTo256=g;a.degToByte=function(c){return h(c*e,256)};a.distanceFromToPolylineWithinThreshold=function(c,l,f,r){let x,w,p;r*=r;for(const t of f){const q=t.length;if(!(2>q)){f=t[0].x;x=t[0].y;for(let u=1;u<q;++u){w=t[u].x;p=t[u].y;if(b.distanceToSegmentSquared(c,
l,f,x,w,p)<r)return!0;f=w;x=p}}}return!1};a.getTileMargins=function(c){return 8+Math.max(16*(c-14),0)};a.interpolate=function(c,l,f){return c*(1-f)+l*f};a.isCircleOverlapingRect=function(c,l,f,r,x,w,p){l=Math.max(r,Math.min(l,w))-l;f=Math.max(x,Math.min(f,p))-f;return l*l+f*f<=c*c};a.log2=function(c){return Math.log(c)*d};a.offsetLine=function(c,l){if(0===l||Number.isNaN(l))return c;const f=[],r=new n.Point(0,0),x=new n.Point(0,0),w=new n.Point(0,0);for(let t=0;t<c.length;t++){const q=c[t],u=[];for(let v=
0;v<q.length;v++){var p=q[v-1];const y=q[v],D=q[v+1];0===v?r.setCoords(0,0):r.assignSub(y,p).normalize().rightPerpendicular();v===q.length-1?x.setCoords(0,0):x.assignSub(D,y).normalize().rightPerpendicular();w.assignAdd(r,x).normalize();p=w.x*x.x+w.y*x.y;0!==p&&w.scale(1/p);u.push(n.Point.add(y,w.scale(l)))}f.push(u)}return f};a.pointInPolygon=function(c,l,f){let r=0,x,w;for(const p of f){f=p.length;for(let t=1;t<f;++t)x=p[t-1],w=p[t],x.y>l!==w.y>l&&(0<(w.x-x.x)*(l-x.y)-(w.y-x.y)*(c-x.x)?r++:r--)}return 0!==
r};a.positiveMod=h;a.radToByte=function(c){return h(c*g,256)};a.sqr=function(c){return c*c};a.translateAnchor=function(c,l,f,r){c=new n.Point(c[0],c[1]);c.scale(r);"viewport"===l&&(l=Math.PI/180*-f,c.rotate(Math.cos(l),Math.sin(l)));return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,n){function h(f){f=n.toCIMSymbolJSON(f);if("CIMTextSymbol"===f?.type)return f.height??
0;let r=0;if(f?.symbolLayers)for(const x of f.symbolLayers)n.isCIMMarker(x)&&null!=x.size&&x.size>r?r=x.size:n.isCIMStroke(x)&&null!=x.width&&x.width>r?r=x.width:n.isCIMFill(x);return r}function k(f,r,x,w){if(f)if("CIMTextSymbol"===f.type)null!=f.height&&(f.height*=r);else{if(x&&f.effects)for(const p of f.effects)e(p,r);if(f.symbolLayers)for(const p of f.symbolLayers)switch(p.type){case "CIMPictureMarker":case "CIMVectorMarker":m(p,r,w);break;case "CIMPictureStroke":case "CIMSolidStroke":!w?.preserveOutlineWidth&&
p.width&&(p.width*=r);break;case "CIMPictureFill":p.height&&(p.height*=r);p.offsetX&&(p.offsetX*=r);p.offsetY&&(p.offsetY*=r);break;case "CIMHatchFill":k(p.lineSymbol,r,!0,{...w,preserveOutlineWidth:!1}),p.offsetX&&(p.offsetX*=r),p.offsetY&&(p.offsetY*=r),p.separation&&(p.separation*=r)}}}function m(f,r,x){if(f&&(f.markerPlacement&&g(f.markerPlacement,r),f.offsetX&&(f.offsetX*=r),f.offsetY&&(f.offsetY*=r),f.anchorPoint&&"Absolute"===f.anchorPointUnits&&(f.anchorPoint={x:f.anchorPoint.x*r,y:f.anchorPoint.y*
r}),f.size=null!=f.size?f.size*r:0,"CIMVectorMarker"===f.type&&f.markerGraphics))for(const w of f.markerGraphics)f.scaleSymbolsProportionally||k(w.symbol,r,!0,x)}function g(f,r){n.isCIMMarkerStrokePlacement(f)&&f.offset&&(f.offset*=r);switch(f.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":f.customEndingOffset&&(f.customEndingOffset*=r);f.offsetAlongLine&&(f.offsetAlongLine*=r);if(f.placementTemplate&&f.placementTemplate.length){var x=f.placementTemplate.map(w=>
w*r);f.placementTemplate=x}break;case "CIMMarkerPlacementAlongLineVariableSize":f.maxRandomOffset&&(f.maxRandomOffset*=r);f.placementTemplate&&f.placementTemplate.length&&(x=f.placementTemplate.map(w=>w*r),f.placementTemplate=x);break;case "CIMMarkerPlacementOnLine":f.startPointOffset&&(f.startPointOffset*=r);break;case "CIMMarkerPlacementAtExtremities":f.offsetAlongLine&&(f.offsetAlongLine*=r);break;case "CIMMarkerPlacementAtRatioPositions":f.beginPosition&&(f.beginPosition*=r);f.endPosition&&(f.endPosition*=
r);break;case "CIMMarkerPlacementPolygonCenter":f.offsetX&&(f.offsetX*=r);f.offsetY&&(f.offsetY*=r);break;case "CIMMarkerPlacementInsidePolygon":f.offsetX&&(f.offsetX*=r),f.offsetY&&(f.offsetY*=r),f.stepX&&(f.stepX*=r),f.stepY&&(f.stepY*=r)}}function e(f,r){switch(f.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":f.width&&(f.width*=r);break;case "CIMGeometricEffectBuffer":f.size&&(f.size*=r);break;case "CIMGeometricEffectCut":f.beginCut&&(f.beginCut*=r);f.endCut&&(f.endCut*=r);
f.middleCut&&(f.middleCut*=r);break;case "CIMGeometricEffectDashes":f.customEndingOffset&&(f.customEndingOffset*=r);f.offsetAlongLine&&(f.offsetAlongLine*=r);if(f.dashTemplate&&f.dashTemplate.length){const x=f.dashTemplate.map(w=>w*r);f.dashTemplate=x}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":f.length&&(f.length*=r);break;case "CIMGeometricEffectMove":f.offsetX&&(f.offsetX*=r);f.offsetY&&(f.offsetY*=r);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":f.offset&&
(f.offset*=r);break;case "CIMGeometricEffectRegularPolygon":f.radius&&(f.radius*=r);break;case "CIMGeometricEffectTaperedPolygon":f.fromWidth&&(f.fromWidth*=r);f.length&&(f.length*=r);f.toWidth&&(f.toWidth*=r);break;case "CIMGeometricEffectWave":f.amplitude&&(f.amplitude*=r),f.period&&(f.period*=r)}}function d(f,r){if(f){var x="CIMTextSymbol"===f.type?f.symbol:f;f="CIMPolygonSymbol"===f.type;if(x?.symbolLayers)for(const w of x.symbolLayers)if(!(w.colorLocked||f&&(n.isCIMStroke(w)||n.isCIMMarker(w)&&
w.markerPlacement&&n.isCIMMarkerStrokePlacement(w.markerPlacement))))switch(w.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":w.tintColor&&c(r,w.tintColor);break;case "CIMVectorMarker":w.markerGraphics?.forEach(p=>{d(p.symbol,r)});break;case "CIMSolidStroke":case "CIMSolidFill":c(r,w.color);break;case "CIMHatchFill":d(w.lineSymbol,r)}}}function c(f,r){for(const x of f)if(x.join(".")===r.join("."))return;f.push(r)}function l(f,r,x){if(f){var w="CIMTextSymbol"===f.type?f.symbol:
f;f="CIMPolygonSymbol"===w?.type;if(w?.symbolLayers)for(const p of w.symbolLayers)if(!p.colorLocked){if(f)if(x){if({layersToColor:w}=x,(n.isCIMStroke(p)||n.isCIMMarker(p)&&p.markerPlacement&&n.isCIMMarkerStrokePlacement(p.markerPlacement))&&"fill"===w||n.isCIMFill(p)&&"outline"===w)continue}else if(n.isCIMStroke(p)||n.isCIMMarker(p)&&p.markerPlacement&&n.isCIMMarkerStrokePlacement(p.markerPlacement))continue;w=r.toArray();switch(p.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":p.tintColor=
w;break;case "CIMVectorMarker":p.markerGraphics?.forEach(t=>{l(t.symbol,r,x)});break;case "CIMSolidStroke":case "CIMSolidFill":p.color=w;break;case "CIMHatchFill":l(p.lineSymbol,r,x)}}}}a.applyCIMSymbolColor=function(f,r,x){r instanceof b||(r=new b(r));(f=n.toCIMSymbolJSON(f))&&l(f,r,x)};a.applyCIMSymbolRotation=function(f,r,x=!1){f=n.toCIMSymbolJSON(f);x&&0!==r&&(r=360-r);if("CIMTextSymbol"===f?.type)f.angle=r;else if("CIMPointSymbol"===f?.type&&f.symbolLayers){x=r-(f.angle||0);for(const w of f.symbolLayers)if(n.isCIMMarker(w)){let p=
w.rotation||0;p=w.rotateClockwise?p-x:p+x;w.rotation=p}f.angle=r}};a.getCIMSymbolColor=function(f){f=n.toCIMSymbolJSON(f);const r=[];d(f,r);return r.length?new b(n.normalizeAlpha(r[0])):null};a.getCIMSymbolRotation=function(f,r=!1){f=n.toCIMSymbolJSON(f);return"CIMTextSymbol"===f?.type||"CIMPointSymbol"===f?.type?(f=f.angle,null!=f&&0!==f&&r?360-f:f??0):0};a.getCIMSymbolSize=h;a.getCIMSymbolType=function(f){f=n.toCIMSymbolJSON(f);if(!f)return null;switch(f.type){case "CIMPointSymbol":return"CIMPointSymbol";
case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=m;a.scaleCIMSymbol=k;a.scaleCIMSymbolTo=function(f,r,x){if(f){var w=n.toCIMSymbolJSON(f);f=h(f);if(0===f){if(w)if("CIMTextSymbol"===w.type)w.height=r;else if(w.symbolLayers)for(const p of w.symbolLayers)switch(p.type){case "CIMPictureMarker":case "CIMVectorMarker":p.size=r;break;case "CIMPictureStroke":case "CIMSolidStroke":p.width=
r}}else k(w,r/f,!1,x)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/screenUtils ../../core/libs/gl-matrix-2/factories/vec3f64 ../../layers/effects/jsonUtils ./cimSymbolUtils ./gfxUtils ./Symbol3DMaterial".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f){function r(A){A=A.symbolLayers;if(!A)return null;let C=null;A.forEach(E=>{"object"===E.type&&
E.resource?.href||(C="water"===E.type?E.color:E.material?E.material.color:null)});return C?new n(C):null}function x(A,C){if(null==C||null==A)return A;A=A.toRgba();A[3]*=C;return new n(A)}function w(A,C,E){if(A=A.symbolLayers){var I=H=>{C=C??H??(null!=E?G:null);return x(C,E)};A.forEach(H=>{if("object"!==H.type||!H.resource?.href||C)if("water"===H.type)H.color=I(H.color);else{const J=I(null!=H.material?H.material.color:null);null==H.material?H.material=new f.Symbol3DMaterial({color:J}):H.material.color=
J;null!=E&&"outline"in H&&null!=H.outline?.color&&(H.outline.color=x(H.outline.color,E))}})}}async function p(A,C){(A=A.symbolLayers)&&await k.forEach(A,async E=>t(E,C))}async function t(A,C){switch(A.type){case "extrude":A.size="number"===typeof C[2]?C[2]:0;break;case "icon":case "line":case "text":C=q(C);null!=C&&(A.size=C);break;case "path":const E=v(C,e.ONES,[A.width,void 0,A.height]);A.width=D(C[0],A.width,1,E);A.height=D(C[2],A.height,1,E);break;case "object":await u(A,C)}}function q(A){for(const C of A)if("number"===
typeof C)return C;return null}async function u(A,C){const {resourceSize:E,symbolSize:I}=await y(A),H=v(C,E,I);A.width=D(C[0],I[0],E[0],H);A.depth=D(C[1],I[1],E[1],H);A.height=D(C[2],I[2],E[2],H)}function v(A,C,E){for(let I=0;3>I;I++){const H=A[I];switch(H){case "symbol-value":return A=E[I],null!=A?A/C[I]:1;case "proportional":break;default:if(H&&C[I])return H/C[I]}}return 1}async function y(A){var {computeObjectLayerResourceSize:C}=await new Promise((z,K)=>a(["./symbolLayerUtils"],z,K));C=await C(A,
10);const {width:E,height:I,depth:H}=A;A=[E,H,I];let J=1;for(var B=0;3>B;B++){const z=A[B];if(null!=z){J=z/C[B];break}}for(B=0;3>B;B++)null==A[B]&&(A[B]=C[B]*J);return{resourceSize:C,symbolSize:A}}function D(A,C,E,I){switch(A){case "proportional":return E*I;case "symbol-value":return null!=C?C:E;default:return A}}const G=new n("white");b.applyColorToSymbol=function(A,C,E){if(A&&(C||null!=E))if(C&&=new n(C),h.isSymbol3D(A))w(A,C,E);else if(h.isSymbol2D(A)){if(C=C??A.color)A.color=x(C,E);null!=E&&"outline"in
A&&A.outline?.color&&(A.outline.color=x(A.outline.color,E))}};b.applyOpacityToColor=x;b.applyRotationToSymbol=function(A,C,E){A&&null!=C&&(h.isSymbol3D(A)?(A=A.symbolLayers)&&A.forEach(I=>{if(I&&"object"===I.type)switch(E){case "tilt":I.tilt=(I.tilt??0)+C;break;case "roll":I.roll=(I.roll??0)+C;break;default:I.heading=(I.heading??0)+C}}):!h.isSymbol2D(A)||"simple-marker"!==A.type&&"picture-marker"!==A.type&&"text"!==A.type||(A.angle+=C))};b.applySizesToSymbol=async function(A,C){if(A&&C){if(h.isSymbol3D(A))return p(A,
C);if(h.isSymbol2D(A)&&(C=q(C),null!=C))switch(A.type){case "simple-marker":A.size=C;break;case "picture-marker":const E=A.width/A.height;1<E?(A.width=C,A.height=C*E):(A.width=C*E,A.height=C);break;case "simple-line":A.width=C;break;case "text":A.font.size=C}}};b.fetchWebStyleSymbol=async function(A,C){const E=await A.fetchSymbol(C);return E?E:A.fetchCIMSymbol(C)};b.getCSSFilterFromEffectList=function(A){if(!A)return null;A=A.effects.filter(C=>"bloom"!==C.type).map(C=>C.toJSON());return d.effectFunctionsFromJSON(A)};
b.getColorFromSymbol=function(A,C){if(!A)return null;let E=null;h.isSymbol3D(A)?E=r(A):h.isSymbol2D(A)&&(E="cim"===A.type?c.getCIMSymbolColor(A):A.color?new n(A.color):null);return E?x(E,C):null};b.getIconHref=function(A){return A.resource?.href??""};b.getSymbolOutlineSize=function(A){return A?h.isSymbol3D(A)?(A=(A=A.symbolLayers?.at(-1))&&"outline"in A?A?.outline?.size:void 0,null!=A?A:0):g.px2pt(l.getStroke(A)?.width):0};b.isVolumetricSymbol=function(A){if(null==A||!("symbolLayers"in A)||null==
A.symbolLayers)return!1;switch(A.type){case "point-3d":return A.symbolLayers.some(C=>"object"===C.type);case "line-3d":return A.symbolLayers.some(C=>"path"===C.type);case "polygon-3d":return A.symbolLayers.some(C=>"object"===C.type||"extrude"===C.type);default:return!1}};b.symbolHasExtrudeSymbolLayer=function(A){return null!=A&&"polygon-3d"===A.type&&A.symbolLayers.some(C=>"extrude"===C.type)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/LRUCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,b,n,h,k,m,g){function e(r){if(!r)return null;let x=null;switch(r.type){case "simple-fill":case "picture-fill":case "simple-marker":x=e(r.outline);break;case "simple-line":const w=m.pt2px(r.width);null!=r.style&&"none"!==r.style&&0!==w&&(x={color:r.color,style:f(r.style),width:w,cap:r.cap,join:"miter"===r.join?m.pt2px(r.miterLimit):r.join},x.dashArray=d(x).join(",")||"none");break;default:x=null}return x}function d(r){if(!r?.style)return[];const {dashArray:x,style:w,width:p}=r;if("string"===
typeof x&&"none"!==x)return x.split(",").map(u=>Number(u));const t=p??0,q=c.has(w)?c.get(w).map(u=>u*t):[];if("butt"!==r.cap)for(const [u,v]of q.entries())q[u]=1===u%2?v+t:Math.max(v-t,1);return q}const c=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),l=new k.LRUCache(1E3),f=(()=>{const r={};return x=>
{if(r[x])return r[x];const w=x.replaceAll("-","");return r[x]=w}})();n=new n([128,128,128]);a.defaultThematicColor=n;a.dekebabifyLineStyle=f;a.getDashArray=d;a.getFill=function(r){const x=r.style;let w=null;if(r)switch(r.type){case "simple-marker":"cross"!==x&&"x"!==x&&(w=r.color);break;case "simple-fill":x&&"solid"!==x?"none"!==x&&(w={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${x}.png`),width:5,height:5}):w=r.color;break;case "picture-fill":w={type:"pattern",src:r.url,width:m.pt2px(r.width)*
r.xscale,height:m.pt2px(r.height)*r.yscale,x:m.pt2px(r.xoffset),y:m.pt2px(r.yoffset)};break;case "text":w=r.color;break;case "cim":w=g.getCIMSymbolColor(r)}return w};a.getPatternUrlWithColor=function(r,x){const w=r+"-"+x;return void 0!==l.get(w)?Promise.resolve(l.get(w)):h(r,{responseType:"image"}).then(p=>{p=p.data;const t=p.naturalWidth,q=p.naturalHeight,u=document.createElement("canvas");u.width=t;u.height=q;const v=u.getContext("2d");v.fillStyle=x;v.fillRect(0,0,t,q);v.globalCompositeOperation=
"destination-in";v.drawImage(p,0,0);p=u.toDataURL();l.put(w,p);return p})};a.getStroke=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b){b=b.ZEROS;a.labelMarginPx=4;a.suspendResumeExtentOptimism=1.2;a.transparentUnit=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,b,n,h,k,m,g,e){class d{constructor(r,x,w,p){this.graphics3DSymbolLayer=r;this.renderGeometries=x;this.boundingBox=w;this._drapeSourceRenderer=p;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}initialize(r){this.stage=r.stage}setVisibility(r){if(null!=this.stage&&this._visible!==r)if((this._visible=r)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,e.DirtyOperation.ADD);else if(r||this._addedToStage){for(const x of this.renderGeometries)x.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,e.DirtyState.VISIBILITY)}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,e.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null}getCenterObjectSpace(r=n.create()){return b.set(r,0,0,0)}getBoundingBoxObjectSpace(r=h.create()){return h.empty(r)}addObjectState(r,x){r===g.Object3DState.Highlight&&(this.renderGeometries.forEach(w=>{const p=w.geometry.addHighlight();
x.addRenderGeometry(w,p,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,e.DirtyState.HIGHLIGHT))}removeObjectState(r){this.renderGeometries.forEach(x=>{r.removeRenderGeometry(x)})}removeRenderGeometryObjectState(r,x){r.geometry.removeHighlight(x);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,e.DirtyState.HIGHLIGHT)}computeAttachmentOrigin(r){for(const x of this.renderGeometries)x.geometry.computeAttachmentOrigin(f)&&
(r.draped.origin[0]+=f[0],r.draped.origin[1]+=f[1],r.draped.num++)}async getProjectedBoundingBox(r,x,w,p,t){h.empty(t);for(let q=0;q<this.renderGeometries.length;q++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[q],r,c,w),h.expandWithRect(t,c);if(x){h.center(t,f);let q;r=m.demResolutionForBoundingBox(t,x.service.spatialReference,x);try{q=await x.service.queryElevation(f[0],f[1],p,r,"ground")}catch(u){}null!=q&&(t[2]=Math.min(t[2],q),t[5]=Math.max(t[5],q))}return t}_getRenderGeometryProjectedBoundingRect(r,
x,w,p){if(this.boundingBox)h.set(l,this.boundingBox);else{r=r.boundingSphere;const t=r[3];l[0]=r[0]-t;l[1]=r[1]-t;l[2]=r[2]-t;l[3]=r[0]+t;l[4]=r[1]+t;l[5]=r[2]+t}x(l,0,2);this.calculateRelativeScreenBounds&&p.push({location:h.center(l),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return h.toRect(l,w)}}const c=k.create(),l=h.create(),f=n.create();a.Graphics3DDrapedGraphicLayer=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,n,h){const k=Object.freeze({left:0,center:.5,right:1}),m=Object.freeze({"bottom-left":n.fromValues(0,0),bottom:n.fromValues(.5,0),"bottom-right":n.fromValues(1,0),left:n.fromValues(0,.5),center:n.fromValues(.5,.5),right:n.fromValues(1,.5),"top-left":n.fromValues(0,1),top:n.fromValues(.5,1),"top-right":n.fromValues(1,1)});a.anchorFromPlacements=function(g,
e){switch(e){case "bottom":return"left"===g?"bottom-left":"right"===g?"bottom-right":"bottom";case "center":return g;case "top":return"left"===g?"top-left":"right"===g?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(g){switch(g){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX=k;a.namedAnchorToHUDMaterialAnchorPos=m;a.textRenderAlignmentFromHorizontalPlacement=
function(g){switch(g){case "left":return h.TextRenderAlignment.Left;case "right":return h.TextRenderAlignment.Right;default:return h.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(g){return"middle"===g?"center":g};a.verticalPlacementFromAnchor=function(g){switch(g){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};a.verticalScreenOffsetFromAlignment=
function(g,e){switch(g){case "top":return b.set(e,0,h.textVerticalPaddingPx);case "bottom":return b.set(e,0,-h.textVerticalPaddingPx);default:return b.copy(e,n.ZEROS)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(a,b,n,h,k){class m{constructor(c,l,f,r){this.text=c;this._alignment=l;this._parameters=f;this._maxSize=
r;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${c}`;this._lines=c.replaceAll(" ","\u00a0").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let c=this._metrics.firstLineAscent;for(let l=0;l<this._lines.length-1;l++)c+=this._lineSpacing;c+=this._metrics.lastLineDescent;return Math.ceil(c+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+
this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const l=k.getTextHelperCanvas(e,512,512).getContext("2d"),f=this._parameters.definition.pixelRatio;this._parameters.setFontProperties(l,this._fontSize*f);let r=2*this._haloSize;var c=this._parameters.definition.font;if("italic"===c.style||"oblique"===c.style||"bold"===c.weight||"bolder"===c.weight)r+=.3*l.measureText("A").width;this._textWidths.length=0;let x=
this._lineWidths.length=0,w=0,p=0,t=0,q=0;this._lines.forEach((v,y)=>{v=l.measureText(v);const D=v.width/f,G=D+r;this._textWidths.push(D);this._lineWidths.push(G);x=Math.max(x,G);t=Math.max(t,v.actualBoundingBoxAscent/f);q=Math.max(q,v.actualBoundingBoxDescent/f);0===y&&(w=v.actualBoundingBoxAscent/f);y===this._lines.length-1&&(p=v.actualBoundingBoxDescent/f)});c=h.getFontMetrics(this._parameters);const u=Math.max(q,c.maxDescent);this._metricsCached=new d(w,"underline"===this._parameters.definition.font.decoration?
u:p,Math.max(t,c.maxAscent),u,x)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){null==this._renderPixelRatio&&(this._renderPixelRatio=Math.min(this._parameters.definition.pixelRatio,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight)));return this._renderPixelRatio}_getLineXOffset(c){switch(this._alignment){case a.TextRenderAlignment.Left:return this._horizontalPadding;
case a.TextRenderAlignment.Center:return(this.displayWidth-this._lineWidths[c])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[c]}}render(c,l,f){c.save();l/=this.renderPixelRatio;f/=this.renderPixelRatio;const r=l,x=f;var w=this._haloSize;const p=this._firstLineYOffset+this._metrics.firstLineAscent;l+=w;f+=p;const t=0<this._haloSize;t&&this._renderHalo(c,r,x,w,p);this._parameters.setFontProperties(c,this._renderedFontSize);for(w=0;w<this._lines.length;++w){const q=
this._lines[w],u=this._getLineXOffset(w);t&&(c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",this._fillText(c,q,l+u,f),this._renderLineDecoration(c,l+u,f,this._textWidths[w]));c.globalCompositeOperation="source-over";c.fillStyle=this._parameters.textStyle;this._fillText(c,q,l+this._getLineXOffset(w),f);this._renderLineDecoration(c,l+u,f,this._textWidths[w]);f+=this._lineSpacing}if(n.debugFlags.TEXT_SHOW_BASELINE)for(c.strokeStyle="rgb(255, 0, 255, 0.5)",c.setLineDash([2,2]),
c.lineWidth=1,l=x+p,f=0;f<this._lines.length;++f)this._drawLine(c,[r,l],[r+this.displayWidth,l]),l+=this._lineSpacing;n.debugFlags.TEXT_SHOW_BORDER&&(c.strokeStyle="rgb(255, 0, 255, 0.5)",c.setLineDash([]),c.lineWidth=1,this._drawBox(c,[r,x],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(c,r,x,this._parameters.definition.background.borderRadius*this.renderPixelRatio),c.globalCompositeOperation="destination-over",c.fillStyle=this._parameters.backgroundStyle,c.fill());
c.restore()}_renderLineDecoration(c,l,f,r,x=!1){if("none"!==this._parameters.definition.font.decoration&&0!==r){var w=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":f+=2*w;break;case "line-through":f-=.33*this._midLineAscent}var p=x?this._haloSize:0;c.strokeStyle=x?this._parameters.haloStyle:this._parameters.textStyle;c.lineWidth=this._toRenderUnit(w+2*p);c.beginPath();c.moveTo(this._toRenderUnit(l-p),this._toRenderUnit(f));c.lineTo(this._toRenderUnit(l+
r+p),this._toRenderUnit(f));c.stroke()}}_roundedRect(c,l,f,r){l=this._toRenderUnit(l);f=this._toRenderUnit(f);const x=this.renderedWidth,w=this.renderedHeight;0===r?c.rect(l,f,x,w):(r=b.clamp(r,0,Math.floor(w/2)),c.beginPath(),c.moveTo(l,f+r),c.arcTo(l,f,l+r,f,r),c.lineTo(l+x-r,f),c.arcTo(l+x,f,l+x,f+r,r),c.lineTo(l+x,f+w-r),c.arcTo(l+x,f+w,l+x-r,f+w,r),c.lineTo(l+r,f+w),c.arcTo(l,f+w,l,f+w-r,r),c.closePath())}_renderHalo(c,l,f,r,x){const w=this.renderedWidth,p=this.renderedHeight,t=k.getTextHelperCanvas(e,
Math.max(w,512),Math.max(p,512)),q=t.getContext("2d");q.clearRect(0,0,w,p);this._parameters.setFontProperties(q,this._renderedFontSize);q.fillStyle=this._parameters.haloStyle;q.strokeStyle=this._parameters.haloStyle;var u=3>this._renderedHaloSize;q.lineJoin=u?"miter":"round";u?this._renderHaloEmulated(q,r,x):this._renderHaloNative(q,r,x);for(u=0;u<this._lines.length;++u){const v=this._getLineXOffset(u);this._renderLineDecoration(q,r+v,x,this._textWidths[u],!0);x+=this._lineSpacing}c.globalAlpha=this._parameters.definition.halo.color[3];
c.drawImage(t,0,0,w,p,this._toRenderUnit(l),this._toRenderUnit(f),w,p);c.globalAlpha=1}_renderHaloEmulated(c,l,f){for(let r=0;r<this._lines.length;++r){const x=this._lines[r],w=this._getLineXOffset(r);for(const [p,t]of g)this._fillText(c,x,l+w+this._haloSize*p,f+this._haloSize*t);f+=this._lineSpacing}}_renderHaloNative(c,l,f){const r=2*this._haloSize;for(let x=0;x<this._lines.length;++x){const w=this._lines[x],p=this._getLineXOffset(x);for(let t=0;5>t;t++)c.lineWidth=this._toRenderUnit((.6+.1*t)*
r),this._strokeText(c,w,l+p,f);f+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(c){return c*this.renderPixelRatio}_toRoundedRenderUnit(c){return Math.round(c*this.renderPixelRatio)}_fillText(c,l,f,r){c.fillText(l,this._toRenderUnit(f),this._toRenderUnit(r))}_strokeText(c,l,f,r){c.strokeText(l,this._toRenderUnit(f),this._toRenderUnit(r))}_drawLine(c,l,f){c.beginPath();c.moveTo(this._toRoundedRenderUnit(l[0])+.5,this._toRoundedRenderUnit(l[1])+.5);c.lineTo(this._toRoundedRenderUnit(f[0])+
.5,this._toRoundedRenderUnit(f[1])+.5);c.stroke()}_drawBox(c,l,f){var r=this._toRenderUnit(l[0]);l=this._toRenderUnit(l[1]);var x=this._toRenderUnit(f[0]);const w=this._toRenderUnit(f[1]);f=Math.floor(r)+.5;r=Math.ceil(r+x)-.5;x=Math.floor(l)+.5;l=Math.ceil(l+w)-.5;c.beginPath();c.moveTo(f,x);c.lineTo(r,x);c.lineTo(r,l);c.lineTo(f,l);c.lineTo(f,x);c.stroke()}}const g=[];for(let c=0;360>c;c+=22.5)g.push([Math.cos(Math.PI*c/180),Math.sin(Math.PI*c/180)]);a.TextRenderAlignment=void 0;(function(c){c[c.Left=
0]="Left";c[c.Center=1]="Center";c[c.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const e={canvas:null};class d{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(c,l,f,r,x){this.firstLineAscent=c;this.lastLineDescent=l;this.maxLineAscent=f;this.maxLineDescent=r;this.displayWidth=x}}a.TextRenderer=m;a.textVerticalPaddingPx=
1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(a,b){const n=new Map;class h{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(g,e){this.maxAscent=g;this.maxDescent=e}}const k={canvas:null},m=(()=>{let g="";for(let e=32;127>e;e++)g+=String.fromCharCode(e);return g})();a.getFontMetrics=function(g){const {size:e}=g.definition,d=g.fontString(e);var c=n.get(d);c||
(c=b.getTextHelperCanvas(k,0,0).getContext("2d"),g.setFontProperties(c,e),g=c.measureText(m),c=new h(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),n.set(d,c));return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(a){a.getTextHelperCanvas=function(b,n,h){b.canvas||(b.canvas=document.createElement("canvas"));b.canvas.width=n;b.canvas.height=h;return b.canvas};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../core/uid ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/sphere ../../support/mathUtils".split(" "),function(a,b,n,h,k,m,g){class e{constructor(c,l={}){this.geometry=c;this.screenToWorldRatio=1;this._transformation=h.create();this._boundingSphere=this._shaderTransformation=null;this.id=
b.generateUID();this.layerUid=l.layerUid;this.graphicUid=l.graphicUid;this.castShadow=l.castShadow??!1;null!=l.objectShaderTransformation&&this.objectShaderTransformationChanged(l.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(c){n.copy(this._transformation,c);this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(c){null==c?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=
h.create()),n.multiply(this._shaderTransformation,c,this.geometry.transformation));this._boundingSphere=null}get boundingSphere(){if(!this.boundingInfo)return m.NullSphere;null==this._boundingSphere&&(this._boundingSphere??(this._boundingSphere=m.create()),k.transformMat4(m.getCenter(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*g.maxScale(this.shaderTransformation));return this._boundingSphere}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??
this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(c){this.geometry.visible=c}}class d extends e{}a.RenderGeometry=e;a.ValidatedRenderGeometry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../geometry ../../../../core/Error ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){const E=["polyline","polygon","extent"],I=new w.ConvertOptions({size:!0,color:!0,rotation:!1,opacity:!0});class H extends f.Graphics3DSymbolLayer{constructor(z,K,L,F){super(z,K,L,F)}async doLoad(){this._fastUpdates=w.initFastSymbolUpdatesState(this._context.renderer,I);if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:h.px2pt(1)))throw new n("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");
}_getMaterialParameters(z,K=!1){const L=this._getCombinedOpacityAndColor(K&&this._markerColor||this._materialColor);this._patternHidesLine&&!K&&(L[3]=0);z={width:this._computeMaterialWidth(this.symbolLayer?.size),color:L,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:x.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:z,stipplePattern:D.getStipplePatternForLinePattern(this.symbolLayer.pattern)};return this._fastUpdates?.visualVariables?
{...z,...this._fastUpdates.materialParameters}:z}get _materialColor(){return this.symbolLayer.material?.color}get _markerColor(){return this.symbolLayer.marker?.color}get _lineMaterial(){null==this._materials[B.Line]&&(this._materials[B.Line]=new G.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[B.Line]));return this._materials[B.Line]}get _ringMaterial(){null==this._materials[B.Ring]&&(this._materials[B.Ring]=new G.RibbonLineMaterial(this._getMaterialParameters(!0)),
this._context.stage.add(this._materials[B.Ring]));return this._materials[B.Ring]}get _wireframeLineMaterial(){null==this._materials[B.LineWireframe]&&(this._materials[B.LineWireframe]=new G.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._materials[B.LineWireframe]));return this._materials[B.LineWireframe]}get _wireframeRingMaterial(){null==this._materials[B.RingWireframe]&&(this._materials[B.RingWireframe]=new G.RibbonLineMaterial({...this._getMaterialParameters(!0),
wireframe:!0}),this._context.stage.add(this._materials[B.RingWireframe]));return this._materials[B.RingWireframe]}get _markerMaterial(){null==this._materials[B.Marker]&&null!=this.symbolLayer.marker&&(this._materials[B.Marker]=new y.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:x.parseLineMarkerStyle(this.symbolLayer.marker.style)}),this._context.stage.add(this._materials[B.Marker]));return this._materials[B.Marker]}destroy(){super.destroy();
this._forEachMaterial(z=>this._context.stage.remove(z));this._materials.length=0}_getDrivenSize(z){return this._drivenProperties.size&&z.size?h.pt2px(g.getDriverAxisSizeValueAny(z.size)):1}_getDrivenColor(z){const K=k.fromValues(1,1,1,1);this._drivenProperties.color&&z.color&&(K[0]=z.color[0],K[1]=z.color[1],K[2]=z.color[2],0<z.color.length&&(K[3]=z.color[3]));this._drivenProperties.opacity&&z.opacity&&(K[3]=z.opacity);return K}createGraphics3DGraphic(z){const K=z.graphic;if(!this._validateGeometry(K.geometry,
E,this.symbolLayer.type))return null;const L=this.setGraphicElevationContext(K);this.ensureDrapedStatus("on-the-ground"===L.mode);return this.draped?this._createAsOverlay(z,this._context.layer.uid):this._createAs3DShape(z,L,K.uid)}applyRendererDiff(z,K){for(const L in z.diff)switch(L){case "visualVariables":const F=this._fastUpdates;if(w.updateFastSymbolUpdatesState(F,K,I))this._forEachMaterial(M=>M?.setParameters(F.materialParameters));else return r.ApplyRendererDiffResult.RecreateSymbol;break;default:return r.ApplyRendererDiffResult.RecreateSymbol}return r.ApplyRendererDiffResult.FastUpdate}prepareSymbolLayerPatch(z){if("partial"===
z.diff.type){var K=z.diff.diff,L={};"complete"===K.size?.type&&(L.width=this._computeMaterialWidth(K.size.newValue),delete K.size);"complete"===K.cap?.type&&(L.cap=x.parseCapType(K.cap.newValue??"butt"),delete K.cap);var F=this._prepareMarkerPatch(z,K);this._prepareMaterialPatch(z,K,F);z.symbolLayerStatePatches.push(()=>this._forEachMaterial(M=>M?.setParameters(L)))}}layerOpacityChanged(){this._forEachMaterial((z,K)=>this._updateMaterialLayerOpacity(z,K===B.Marker))}_forEachMaterial(z){this._materials.forEach(z)}_updateMaterialLayerOpacity(z,
K=!1){if(null!=z){var L=z.parameters.color,F=this.symbolLayer?.material?.color;K=this._patternHidesLine&&!K?0:this._getCombinedOpacity(F);L=k.fromValues(L[0],L[1],L[2],K);z.setParameters({color:L})}}layerElevationInfoChanged(z,K,L){const F=this._elevationContext.mode;L=d.elevationModeChangeUpdateType(H.elevationModeChangeTypes,L,F);if(L!==d.SymbolUpdateType.UPDATE)return L;const M=d.needsElevationUpdates2D(F);return this.updateGraphics3DGraphicElevationInfo(z,K,()=>M)}slicePlaneEnabledChanged(){const z=
{hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(K=>K?.setParameters(z));return!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(z){switch(z.type){case "extent":if(z instanceof A)return C.fromExtent(z);break;case "polygon":case "polyline":return z}return null}_createAs3DShape(z,K,L){const F=this._getGeometryAsPolygonOrPolyline(z.graphic.geometry);var M="polygon"===F.type?F.rings:F.paths,S=[];const N=m.create(),P=q.geometryToRenderInfo(F,this._context.elevationProvider,
this._context.renderCoordsHelper,K);this._logGeometryCreationWarnings(P,M,"polygon"===F.type?"rings":"paths","LineSymbol3DLayer");for(M=0;M<P.lines.length;M++){var R=P.lines[M],O=R.position;R=R.mapPositions;if(null!=this._context.clippingExtent&&(m.empty(N),m.expandWithBuffer(N,R),!m.intersectsClippingArea(N,this._context.clippingExtent)))continue;O=this._createGeometry("polygon"===F.type?this._ringMaterial:this._lineMaterial,z,O,R,F.type,J.ELEVATED,L);S.push(O);p.debugFlags.LINE_WIREFRAMES&&S.push(O.instantiate({material:"polygon"===
F.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));null!=this._markerMaterial&&S.push(O.instantiate({material:this._markerMaterial}))}if(0===S.length)return null;z=new u.Object3D({geometries:S,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L});S=new l.Graphics3DObject3DGraphicLayer(this,z,S,null,null,e.sharedGeometryElevationAligner,K);S.alignedSampledElevation=P.sampledElevation;S.needsElevationUpdates=d.needsElevationUpdates2D(K.mode);return S}_createGeometry(z,K,L,F,M,
S,N){S=S===J.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null;M="polygon"===M;const P=this._fastUpdates?.visualVariables.color,R=this._fastUpdates?.visualVariables.size,O=this._fastUpdates?.visualVariables.opacity;N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:N,layerUid:this._context.layer.uid});K={position:L,size:R?null:this._getDrivenSize(K.renderingInfo),color:P?null:this._getDrivenColor(K.renderingInfo),sizeFeature:R?
w.getAttributeValue(R.field,K.graphic):null,colorFeature:P?w.getAttributeValue(P.field,K.graphic):null,opacityFeature:O?w.getAttributeValue(O.field,K.graphic):null};return t.createGeometry(z,{overlayInfo:S,removeDuplicateStartEnd:M,mapPositions:F,attributeData:K},N)}_createAsOverlay(z,K){const L=z.graphic,F=this._getGeometryAsPolygonOrPolyline(L.geometry);var M="polygon"===F.type?F.rings:F.paths;const S="polygon"===F.type?this._ringMaterial:this._lineMaterial;S.renderPriority=this._renderPriority;
const N=p.debugFlags.LINE_WIREFRAMES?"polygon"===F.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,P=this._markerMaterial;null!=N&&(N.renderPriority=this._renderPriority-.001);null!=P&&(P.renderPriority=this._renderPriority-.002);const R=[],O=m.create(),T=m.empty();var Q=q.geometryToRenderInfoDraped(F,this._context.overlaySR);this._logGeometryCreationWarnings(Q,M,"polygon"===F.type?"rings":"paths","LineSymbol3DLayer");for(const V of Q.lines)m.empty(O),m.expandWithBuffer(O,V.position),
m.intersectsClippingArea(O,this._context.clippingExtent)&&(m.expandWithAABB(T,O),M=U=>{U=this._createGeometry(U,z,V.position,void 0,F.type,J.DRAPED,L.uid);U=new v.RenderGeometry(U,{layerUid:K,graphicUid:L.uid});R.push(U)},null!=P&&(M(P),Q=this.symbolLayer.marker.placement,"begin"!==Q&&"begin-end"!==Q||m.expandWithBuffer(O,V.position,0,1),"end"!==Q&&"begin-end"!==Q||m.expandWithBuffer(O,V.position,V.position.length-3,1)),M(S),p.debugFlags.LINE_WIREFRAMES&&M(N));return new c.Graphics3DDrapedGraphicLayer(this,
R,T,this._context.drapeSourceRenderer)}get _patternHidesLine(){const z=this.symbolLayer.pattern;return null!=z&&"style"===z.type&&"none"===z.style}_computeMaterialWidth(z){z=z??h.px2pt(1);return this._drivenProperties.size?this._fastUpdates?.visualVariables.size?h.pt2px(1):1:h.pt2px(z)}_prepareMaterialPatch(z,K,L){var F=K.material;null==F?L.changed&&L.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._materials[B.Marker],z):"collection"!==F.type&&
(F=this._getCombinedOpacityAndColor("complete"===F.type?F.newValue?.color:"complete"===F.diff.color?.type?F.diff.color.newValue:null),L.useMaterialColor&&this._patchMaterialColor(k.clone(F),this._materials[B.Marker],z),this._patternHidesLine&&(F[3]=0),this._patchMaterialColor(F,this._materials[B.Line],z),delete K.material)}_prepareMarkerPatch(z,K){const L=K.marker,F=this._markerMaterial;if(null==L||"partial"!==L.type||null==L.diff||null!=L.diff.placement||null!=L.diff.style&&"complete"!==L.diff.style.type||
null!=L.diff.color&&"complete"!==L.diff.color.type||null==F)return{changed:!1,useMaterialColor:null==this._markerColor};var M=L.diff.color;const S=null!=M;M=S?M.newValue:null;const N=null==M&&null==this._markerColor;M&&this._patchMaterialColor(this._getCombinedOpacityAndColor(M),F,z);const P=L.diff.style?.newValue;P&&z.symbolLayerStatePatches.push(()=>F.setParameters({markerPrimitive:x.parseLineMarkerStyle(P)}));delete K.marker;return{changed:S,useMaterialColor:N}}_patchMaterialColor(z,K,L){null!=
K&&L.symbolLayerStatePatches.push(()=>K.setParameters({color:z}))}}H.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.RECREATE,staysOnTheGround:d.SymbolUpdateType.NONE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};var J;(function(z){z[z.DRAPED=0]="DRAPED";z[z.ELEVATED=1]="ELEVATED"})(J||={});var B;(function(z){z[z.Line=0]="Line";z[z.Ring=1]="Ring";z[z.LineWireframe=2]="LineWireframe";z[z.RingWireframe=3]="RingWireframe";z[z.Marker=4]="Marker"})(B||={});a.Graphics3DLineSymbolLayer=H;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,b,n){a.parseCapType=function(h){switch(h){case "butt":return n.CapType.BUTT;case "square":return n.CapType.SQUARE;case "round":return n.CapType.ROUND;default:return null}};a.parseLineMarkerStyle=function(h){return"diamond"===h?"kite":h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){const w=n.create(),p=n.create();a.createGeometry=function(t,q,u=null){const v=[],y=q.mapPositions,{attributeData:{position:D},removeDuplicateStartEnd:G}=q;var A=D.length;A=D[0]===D[A-3]&&D[1]===D[A-2]&&D[2]===D[A-1]&&G;var C=D.length/3-(A?1:0),E=Array(2*(C-1)),I=A?D.slice(0,-3):D,H=0;for(var J=0;J<C-1;J++)E[H++]=J,E[H++]=J+1;v.push([x.VertexAttribute.POSITION,new l.Attribute(I,E,3,A)]);C=v[0][1].data;A=d.getZeroIndexArray(v[0][1].indices.length);null==q.attributeData.colorFeature&&
v.push([x.VertexAttribute.COLOR,new l.Attribute(q.attributeData.color??h.ONES,A,4)]);null==q.attributeData.sizeFeature&&v.push([x.VertexAttribute.SIZE,new l.Attribute([q.attributeData.size??1],A,1,!0)]);q.attributeData.normal&&v.push([x.VertexAttribute.NORMAL,new l.Attribute(q.attributeData.normal,A,3)]);null!=q.attributeData.colorFeature&&v.push([x.VertexAttribute.COLORFEATUREATTRIBUTE,new l.Attribute([q.attributeData.colorFeature],A,1,!0)]);null!=q.attributeData.sizeFeature&&v.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,
new l.Attribute([q.attributeData.sizeFeature],A,1,!0)]);null!=q.attributeData.opacityFeature&&v.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,new l.Attribute([q.attributeData.opacityFeature],A,1,!0)]);if(null!=q.overlayInfo&&q.overlayInfo.renderCoordsHelper.viewingMode===c.ViewingMode.Global&&q.overlayInfo.spatialReference.isGeographic){A=g.newDoubleArray(C.length);q=k.getReferenceEllipsoid(q.overlayInfo.spatialReference);for(E=0;E<A.length;E+=3)m.lonLatToWebMercatorComparable(C,E,A,E,q);q=C.length/
3;C=e.newFloatArray(q+1);E=w;I=p;J=H=0;b.set(E,A[J++],A[J++]);J++;C[0]=0;for(let B=1;B<q+1;++B)B===q&&(J=0),b.set(I,A[J++],A[J++]),J++,H+=b.dist(E,I),C[B]=H,[E,I]=[I,E];v.push([x.VertexAttribute.DISTANCETOSTART,new l.Attribute(C,v[0][1].indices,1,!0)])}return new r.Geometry(t,v,y,f.ContentObjectType.Line,u)};a.lineStripsToParameters=function(t,q){if(null==t||0===t.length)return[];const u=[];t.forEach(v=>{const y=g.newDoubleArray(3*v.length);v.forEach((D,G)=>{y[3*G]=D[0];y[3*G+1]=D[1];y[3*G+2]=D[2]});
u.push({attributeData:{position:y,normal:q},removeDuplicateStartEnd:!1})});return u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../geometry/projection/projectBuffer ../../../../geometry/support/DoubleArray ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),function(a,b,n,h,k,m){function g(e,d,c=null){const l=[];for(const {index:f,
count:r}of e){if(1>=r)continue;e=3*f;const x=3*r;l.push({position:n.doubleSubArray(d,3*f,3*r),mapPositions:null!=c?n.doubleSubArray(c,e,x):void 0})}return l}a.geometryToRenderInfo=function(e,d,c,l){const {position:f,outlines:r}=h.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!!e.hasZ,"polygon"===e.type?h.CounterClockwiseMode.CCW_IS_HOLE:h.CounterClockwiseMode.NONE,e.spatialReference),x=n.newDoubleArray(f.length);e=k.applyPerVertexElevationAlignment(f,e.spatialReference,0,x,0,f,0,f.length/
3,d,c,l);d=null!=e;return{lines:d?g(r,f,x):[],projectionSuccess:d,sampledElevation:e}};a.geometryToRenderInfoDraped=function(e,d){const {position:c,outlines:l}=h.pathsToTriangulationInfo("polygon"===e.type?e.rings:e.paths,!1,"polygon"===e.type?h.CounterClockwiseMode.CCW_IS_HOLE:h.CounterClockwiseMode.NONE);e=b.projectBuffer(c,e.spatialReference,0,c,d,0,c.length/3);for(d=2;d<c.length;d+=3)c[d]=m.drapedZ;return{lines:e?g(l,c):[],projectionSuccess:e}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),function(a,b,n,h,k,m,
g,e,d,c,l,f,r){class x extends g.Material{constructor(v){super(v,new p);this.produces=new Map([[e.RenderSlot.OPAQUE_MATERIAL,y=>y===k.ShaderOutput.Highlight||k.isColorOrAlpha(y)&&this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil],[e.RenderSlot.OPAQUE_NO_SSAO_DEPTH,y=>y===k.ShaderOutput.LinearDepth],[e.RenderSlot.OCCLUDER_MATERIAL,y=>k.isColorAlphaHighlightOrDepth(y)&&this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil],[e.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,
y=>k.isColorAlphaHighlightOrDepth(y)&&this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil],[e.RenderSlot.TRANSPARENT_MATERIAL,y=>k.isColorOrAlpha(y)&&this.parameters.writeDepth],[e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,y=>k.isColorOrAlpha(y)&&!this.parameters.writeDepth],[e.RenderSlot.DRAPED_MATERIAL,y=>y===k.ShaderOutput.Color||y===k.ShaderOutput.Highlight]]);this._vertexAttributeLocations=l.vertexAttributeLocations;this._configuration=new f.LineMarkerTechniqueConfiguration;
this._layout=this.createLayout()}getConfiguration(v,y){this._configuration.output=v;this._configuration.space=y.slot===e.RenderSlot.DRAPED_MATERIAL?f.LineMarkerSpace.Draped:this.parameters.worldSpace?f.LineMarkerSpace.World:f.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==r.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=
this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.occluder=this.parameters.renderOccluded===g.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=y.transparencyPassType;this._configuration.multipassEnabled=
y.multipassEnabled;this._configuration.cullAboveGround=y.multipassTerrain.cullAboveGround;return this._configuration}intersect(){}createLayout(){const v=h.newLayout().vec3f(d.VertexAttribute.POSITION).vec3f(d.VertexAttribute.PREVPOSITION).vec2f(d.VertexAttribute.UV0);this.parameters.worldSpace&&v.vec3f(d.VertexAttribute.NORMAL);this.parameters.vvSize?v.f32(d.VertexAttribute.SIZEFEATUREATTRIBUTE):v.f32(d.VertexAttribute.SIZE);this.parameters.vvColor?v.f32(d.VertexAttribute.COLORFEATUREATTRIBUTE):v.vec4f(d.VertexAttribute.COLOR);
this.parameters.vvOpacity&&v.f32(d.VertexAttribute.OPACITYFEATUREATTRIBUTE);return v}createBufferWriter(){return new t(this._layout,this.parameters)}createGLMaterial(v){return new w(v)}}class w extends m.GLTextureMaterial{constructor(){super(...arguments);this._markerPrimitive=null}dispose(){super.dispose();this._markerTextureRepository.release(this._markerPrimitive);this._markerPrimitive=null}_updateParameters(v){const y=this._material.parameters.markerPrimitive;y!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(y,
this._markerPrimitive)}),this._markerPrimitive=y);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(l.LineMarkerTechnique,v)}_updateOccludeeState(v){v.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:v.hasOccludees})}beginSlot(v){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(v);return this._updateParameters(v)}}class p extends c.VisualVariablePassParameters{constructor(){super(...arguments);
this.width=0;this.color=[1,1,1,1];this.markerPrimitive="arrow";this.placement="end";this.cap=r.CapType.BUTT;this.anchor=f.LineMarkerAnchor.Center;this.hideOnShortSegments=this.worldSpace=this.hasTip=!1;this.writeDepth=!0;this.hasOccludees=this.vvFastUpdate=this.hasSlicePlane=!1;this.markerTexture=null}}class t{constructor(v,y){this.vertexBufferLayout=v;this._parameters=y}elementCount(){return"begin-end"===this._parameters.placement?12:6}write(v,y,D,G,A){const C=D.attributes.get(d.VertexAttribute.POSITION).data,
E=C.length/3;let I=[1,0,0];y=D.attributes.get(d.VertexAttribute.NORMAL);this._parameters.worldSpace&&null!=y&&(I=y.data);let H=1,J=0;this._parameters.vvSize?J=D.attributes.get(d.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:D.attributes.has(d.VertexAttribute.SIZE)&&(H=D.attributes.get(d.VertexAttribute.SIZE).data[0]);let B=[1,1,1,1],z=0;this._parameters.vvColor?z=D.attributes.get(d.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:D.attributes.has(d.VertexAttribute.COLOR)&&(B=D.attributes.get(d.VertexAttribute.COLOR).data);
let K=0;this._parameters.vvOpacity&&(K=D.attributes.get(d.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const L=new Float32Array(G.buffer);let F=this.vertexBufferLayout.stride/4*A;const M=(N,P,R,O)=>{L[F++]=N[0];L[F++]=N[1];L[F++]=N[2];L[F++]=P[0];L[F++]=P[1];L[F++]=P[2];L[F++]=R[0];L[F++]=R[1];this._parameters.worldSpace&&(L[F++]=I[0],L[F++]=I[1],L[F++]=I[2]);this._parameters.vvSize?L[F++]=J:L[F++]=H;this._parameters.vvColor?L[F++]=z:(N=Math.min(4*O,B.length-4),L[F++]=B[N],L[F++]=B[N+1],L[F++]=
B[N+2],L[F++]=B[N+3]);this._parameters.vvOpacity&&(L[F++]=K)};let S;(function(N){N[N.ASCENDING=1]="ASCENDING";N[N.DESCENDING=-1]="DESCENDING"})(S||={});D=(N,P)=>{const R=b.set(q,C[3*N],C[3*N+1],C[3*N+2]),O=u;let T=N+P;do b.set(O,C[3*T],C[3*T+1],C[3*T+2]),T+=P;while(b.equals(R,O)&&0<=T&&T<E);v&&(b.transformMat4(R,R,v),b.transformMat4(O,O,v));M(R,O,[-1,-1],N);M(R,O,[1,-1],N);M(R,O,[1,1],N);M(R,O,[-1,-1],N);M(R,O,[1,1],N);M(R,O,[-1,1],N)};G=this._parameters.placement;"begin"!==G&&"begin-end"!==G||D(0,
S.ASCENDING);"end"!==G&&"begin-end"!==G||D(E-1,S.DESCENDING)}}const q=n.create(),u=n.create();a.LineMarkerMaterial=x;a.Parameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ./LineMarkerTechniqueConfiguration ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){const x=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.PREVPOSITION,1],[c.VertexAttribute.UV0,2],[c.VertexAttribute.NORMAL,3],[c.VertexAttribute.COLOR,4],[c.VertexAttribute.COLORFEATUREATTRIBUTE,4],[c.VertexAttribute.SIZE,5],[c.VertexAttribute.SIZEFEATUREATTRIBUTE,5],[c.VertexAttribute.OPACITYFEATUREATTRIBUTE,6]]);class w extends k.ShaderTechnique{initializeProgram(p){return new g.Program(p.rctx,w.shader.get().build(this.configuration),x)}_makePipelineState(p,
t){const q=this.configuration,u=p===d.TransparencyPassType.NONE;return r.makePipelineState({blending:q.output===n.ShaderOutput.Color||q.output===n.ShaderOutput.Alpha?u?m.blendingDefault:m.oitBlending(p):null,depthTest:q.space===f.LineMarkerSpace.Draped?null:{func:m.oitDepthTest(p)},depthWrite:q.space===f.LineMarkerSpace.Draped?null:u?q.writeDepth?r.defaultDepthWriteParams:null:m.oitDepthWrite(p),colorWrite:r.defaultColorWriteParams,stencilWrite:q.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:q.hasOccludees?
t?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){this.configuration.occluder&&(this._occluderPipelineTransparent=r.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:r.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=r.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,depthWrite:null,
colorWrite:r.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=r.makePipelineState({blending:null,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(p,
t,q){return p?this._occludeePipelineState:this.configuration.occluder?q?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}w.shader=new h.ReloadableShaderModule(l.LineMarker,()=>new Promise((p,t)=>a(["./LineMarker.glsl"],p,t)));b.LineMarkerTechnique=w;b.vertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(E){const I=new u.ShaderBuilder,H=E.multipassEnabled&&(E.output===h.ShaderOutput.Color||E.output===h.ShaderOutput.Alpha),J=E.space===G.LineMarkerSpace.World;I.include(m.RibbonVertexPosition,E);I.include(e.MarkerSizing,E);E.output===h.ShaderOutput.LinearDepth&&I.include(g.OutputDepth,E);const {vertex:B,fragment:z}=I;z.include(f.RgbaFloatEncoding);r.addProjViewLocalOrigin(B,E);I.attributes.add(D.VertexAttribute.POSITION,"vec3");I.attributes.add(D.VertexAttribute.PREVPOSITION,
"vec3");I.attributes.add(D.VertexAttribute.UV0,"vec2");I.varyings.add("vColor","vec4");I.varyings.add("vpos","vec3");I.varyings.add("vUV","vec2");I.varyings.add("vSize","float");n.addLinearDepth(I);H&&I.varyings.add("depth","float");E.hasTip&&I.varyings.add("vLineWidth","float");B.uniforms.add(new x.Float2PassUniform("nearFar",(K,L)=>L.camera.nearFar),new w.Float4PassUniform("viewport",(K,L)=>L.camera.fullViewport));B.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);B.code.add(t.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);J?(I.attributes.add(D.VertexAttribute.NORMAL,"vec3"),r.addViewNormal(B),B.constants.add("tiltThreshold","float",.7),B.code.add(t.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):B.code.add(t.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);B.code.add(t.glsl`
      #define vecN ${J?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${J?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${E.anchor===G.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);E.space===G.LineMarkerSpace.Screen&&(B.uniforms.add(new q.Matrix4PassUniform("inverseProjectionMatrix",(K,L)=>L.camera.inverseProjectionMatrix)),B.code.add(t.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),B.code.add(t.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),B.uniforms.add(new p.FloatPassUniform("perScreenPixelRatio",(K,L)=>L.camera.perScreenPixelRatio)),B.code.add(t.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${E.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));r.addPixelRatio(B);n.addCalculateLinearDepth(I);B.code.add(t.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position, 1.0);
vec4 prev = view * vec4(prevPosition, 1.0);
clip(pos, prev);`);J?(E.hideOnShortSegments&&B.code.add(t.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),B.code.add(t.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(B.code.add(t.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),E.space===G.LineMarkerSpace.Screen&&B.code.add(t.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));B.code.add(t.glsl`
        ${H?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${J?"":"vUV *\x3d displacedPosScreen.w;"}

        ${E.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);H&&I.include(d.multipassTerrainTest,E);I.include(k.SliceDraw,E);z.uniforms.add(new w.Float4PassUniform("intrinsicColor",K=>K.color),new v.Texture2DPassUniform("tex",K=>K.markerTexture));z.include(l.ColorConversion);I.constants.add("texelSize","float",1/b.markerTextureSize);z.code.add(t.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);E.hasTip&&(I.constants.add("relativeMarkerSize","float",b.markerSymbolSize/b.markerTextureSize),I.constants.add("relativeTipLineWidth","float",b.markerTipThicknessFactor),z.code.add(t.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${J?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));I.constants.add("symbolAlphaCutoff","float",c.symbolAlphaCutoff);z.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${H?"terrainDepthTest(depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${J?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${E.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${E.output===h.ShaderOutput.ObjectAndLayerIdColor?t.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${E.output===h.ShaderOutput.Alpha?t.glsl`fragColor = vec4(finalColor.a);`:""}
    ${E.output===h.ShaderOutput.Color?t.glsl`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${E.output===h.ShaderOutput.Color&&E.transparencyPassType===y.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
    ${E.output===h.ShaderOutput.Highlight?t.glsl`fragColor = vec4(1.0);`:""}
    ${E.output===h.ShaderOutput.LinearDepth?t.glsl`outputDepth(linearDepth);`:""}
  }
  `);return I}const C=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.LineMarker=C;a.build=A})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports"],function(a){function b(k){null!=k?(k=h[k],k=null==k?k:{pattern:k.slice(),pixelRatio:8}):k=null;return k}const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},h={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],
"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};a.createStipplePatternSimple=function(k){return{pattern:[k,k],pixelRatio:2}};a.getStipplePatternForLinePattern=function(k){return null!=k&&"style"===k.type?b(k.style):null};a.getStipplePatternForPatternStyle=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToPoint ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshTextureTransform ../../../../geometry/support/meshVertexSpaceUtils ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/vec3 ../../../../geometry/support/meshUtils/georeference ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedPoint ../../../../layers/graphics/sources/interfaces ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DMeshObject3DGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./MeshFastUpdateProcessor ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa){const ea=["mesh"];class ha extends N.Graphics3DSymbolLayer{constructor(ra,ua,Ea,Ka){super(ra,ua,Ea,Ka);this._materialInfoCache=new P.MaterialInfoCache;this._fastUpdateProcessor=new P.MeshFastUpdateProcessor;this._textures=new Map;this.ensureDrapedStatus(!1)}async doLoad(){T.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new fa.NativeLineMaterial({color:[1,
0,1,1]}),this._debugFaceNormalMaterial=new fa.NativeLineMaterial({color:[0,1,1,1]}))}destroy(){super.destroy();this._textures.forEach(ra=>ra.unload());this._context.stage.removeMany(this._materialInfoCache.materials);this._context.stage.removeMany(Array.from(this._textures.values()));this._materialInfoCache.clear();this._textures.clear();this._fastUpdateProcessor.destroy(this._context.stage)}get materials(){return this._materialInfoCache.materials}createGraphics3DGraphic(ra){const ua=ra.graphic;if(!this._validateGeometry(ua.geometry,
ea,"fill on mesh-3d"))return null;const Ea=this.setGraphicElevationContext(ua);return this._createAs3DShape(ua,ra.renderingInfo,Ea,ua.uid)}onRemoveGraphic(ra){this._fastUpdateProcessor.onRemoveGraphic(ra,this._materialInfoCache,this._context)}layerOpacityChanged(ra,ua){const Ea=this._getLayerOpacity();this._updateMaterialParameters(Ka=>{Ka.material.setParameters({layerOpacity:Ea});const Ma=Ka.material.parameters;this._setMaterialTransparentParameter(Ma,Ka);Ka.material.setParameters({transparent:Ma.transparent})});
ra.forEach(Ka=>ua(Ka)?.layerOpacityChanged(Ea,this._context.isAsync))}layerElevationInfoChanged(ra,ua){return this.updateGraphics3DGraphicElevationInfo(ra,ua,F.needsElevationUpdates3D)}slicePlaneEnabledChanged(ra,ua){this._updateMaterialParameters(({material:Ea})=>{Ea.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});ra.forEach(Ea=>ua(Ea)?.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync));return!0}physicalBasedRenderingChanged(){const ra=this._usePBR();
this._updateMaterialParameters(({material:ua})=>ua.setParameters({usePBR:ra}));return!0}updateTransform(ra,ua,Ea,Ka){var Ma=ra.fastTransformUpdatesEnabled;switch(Ka){case J.MeshTransformUpdateAction.EnableFastUpdates:if(Ma)return!0;break;case J.MeshTransformUpdateAction.DisableFastUpdates:if(!Ma)return!0;break;default:if(!Ma)return!1}Ma=this._context.renderCoordsHelper.spatialReference;const Ua=ma,{origin:Ga,transform:Na}=Ea;if(!x.computeTranslationToOriginAndRotation(ua,c.set(ja,Ga.x,Ga.y,Ga.z??
0),Ua,Ma))return!1;switch(Ka){case J.MeshTransformUpdateAction.EnableFastUpdates:this._fastUpdateProcessor.enable(ra,this._materialInfoCache,this._context);break;case J.MeshTransformUpdateAction.DisableFastUpdates:this._fastUpdateProcessor.disable(ra,this._materialInfoCache,this._context);break;case J.MeshTransformUpdateAction.UpdateFastLocalOrigin:ra.updateFastLocalOrigin(Ua,Na,this._context.localOriginFactory)}const {elevationContext:Va}=ra;Va.centerPointInElevationSR=this._getCenterPointInElevationSR(Ua);
const {elevationProvider:Xa,renderCoordsHelper:Pa}=this._context;ra.alignedSampledElevation=L.perObjectElevationAligner(ra,Va,Xa.spatialReference,(bb,gb)=>F.evaluateElevationInfoAtPoint(bb,Xa,Va,Pa,gb),Pa,Ua);ra.updateTransform(Ua,Na,this._context.isAsync);return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(ra){return null==ra?"-":ra instanceof b?ra.toHex():ra.contentHash}_materialPropertiesDefault(ra,ua){const Ea=this._requiresSymbolVertexColors(),
Ka=!!ra.vertexAttributes.color;ra=!!ra.vertexAttributes.tangent;return{hasSymbolVertexColors:Ea,hasVertexColors:Ka,hasVertexTangents:ra,uid:`vc:${Ka},vt:${ra},vct${ua},svc:${Ea}`}}_textureTransformUid(ra){const {offset:ua,scale:Ea,rotation:Ka}=ra??pa;return`${ua[0]},${ua[1]},${Ka},${Ea[0]},${Ea[1]}`}_materialProperties(ra,ua,Ea){ra=this._materialPropertiesDefault(ra,Ea);if(!ua.material)return ra;const {color:Ka,colorTexture:Ma,colorTextureTransform:Ua,normalTexture:Ga,normalTextureTransform:Na,doubleSided:Va,
alphaCutoff:Xa,alphaMode:Pa}=ua.material;Ea=this._colorOrTextureUid(Ka);var bb=this._colorOrTextureUid(Ma),gb=this._textureTransformUid(Ua),cb=this._colorOrTextureUid(Ga),ka=this._textureTransformUid(Na);ra.color=Ka;ra.colorTexture=Ma;ra.normalTexture=Ga;ra.uid=`${ra.uid},cmuid:${Ea},ctmuid:${bb},cttuid:${gb},ntmuid:${cb},nttuid:${ka},ds:${Va},ac:${Xa},am:${Pa}`;if(ua.material instanceof y){const {metallic:mb,roughness:qb,metallicRoughnessTexture:tb,metallicRoughnessTextureTransform:xa,emissiveColor:Ia,
emissiveTexture:na,emissiveTextureTransform:ya,occlusionTexture:Da,occlusionTextureTransform:Oa}=ua.material;ua=this._colorOrTextureUid(tb);Ea=this._textureTransformUid(xa);bb=this._colorOrTextureUid(Ia);gb=this._colorOrTextureUid(na);cb=this._textureTransformUid(ya);ka=this._colorOrTextureUid(Da);const Wa=this._textureTransformUid(Oa);ra.metallic=mb;ra.roughness=qb;ra.metallicRoughnessTexture=tb;ra.emissiveColor=Ia;ra.emissiveTexture=na;ra.occlusionTexture=Da;ra.colorTextureTransform=this._convertTextureTransform(Ua);
ra.normalTextureTransform=this._convertTextureTransform(Na);ra.emissiveTextureTransform=this._convertTextureTransform(ya);ra.occlusionTextureTransform=this._convertTextureTransform(Oa);ra.metallicRoughnessTextureTransform=this._convertTextureTransform(xa);ra.uid=`${ra.uid},mrm:${mb},mrr:${qb},mrt:${ua},mrtt:${Ea},emuid:${bb},etmuid:${gb},ett:${cb},otmuid:${ka},ott:${Wa}`}return ra}_convertTextureTransform(ra){if(!ra)return null;const {scale:ua,offset:Ea,rotation:Ka}=ra;return{scale:ua,offset:Ea,rotation:h.deg2rad(Ka)}}_setInternalColorValueParameters(ra,
ua){ua.diffuse=b.toUnitRGB(ra);ua.opacity=ra.a}_getLoadableTextureResource(ra){return ra.data??ra.url}_getInternalTextureId(ra){return this._getInternalTexture(ra,V.AlphaDiscardMode.Opaque)?.id}_getInternalTexture(ra,ua){const Ea=this._getLoadableTextureResource(ra);if(!Ea)return null;const Ka=`${ra.contentHash}/${ua}`;var Ma=this._textures.get(Ka);Ma||(Ma=null,Ma=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,ra={wrap:this._castTextureWrap(ra.wrap),noUnpackFlip:!0,maxAnisotropy:Ma,
mipmap:1<Ma},z.isEncodedMeshTexture(Ea)?(Ma=Ea.data,ra.preMultiplyAlpha=!1,ra.encoding=Ea.encoding):(Ma=Ea,ra.preMultiplyAlpha=ua!==V.AlphaDiscardMode.Opaque,ra.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),Ma=new X.Texture(Ma,ra),this._textures.set(Ka,Ma),Ma.load(this._context.stage.renderView.renderingContext),this._context.stage.add(Ma));return Ma}_castTextureWrap(ra="repeat"){return"string"===typeof ra?(ra=this._castTextureWrapIndividual(ra),
{s:ra,t:ra}):{s:this._castTextureWrapIndividual(ra.horizontal),t:this._castTextureWrapIndividual(ra.vertical)}}_castTextureWrapIndividual(ra){switch(ra){case "clamp":return aa.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return aa.TextureWrapMode.MIRRORED_REPEAT;default:return aa.TextureWrapMode.REPEAT}}_setInternalMaterialParameters(ra,ua){null!=ra.color&&this._setInternalColorValueParameters(ra.color,ua);if(null!=ra.colorTexture){var Ea=this._getInternalTexture(ra.colorTexture,ua.textureAlphaMode);
Ea?(ua.textureId=Ea.id,ua.textureAlphaPremultiplied=!!Ea.parameters.preMultiplyAlpha):ua.textureId=void 0}ra.normalTexture&&(ua.normalTextureId=this._getInternalTextureId(ra.normalTexture));ra.emissiveColor&&(ua.emissiveFactor=b.toUnitRGB(ra.emissiveColor));ra.emissiveTexture&&(ua.emissiveTextureId=this._getInternalTextureId(ra.emissiveTexture));ra.occlusionTexture&&(ua.occlusionTextureId=this._getInternalTextureId(ra.occlusionTexture));ra.metallicRoughnessTexture&&(ua.metallicRoughnessTextureId=
this._getInternalTextureId(ra.metallicRoughnessTexture));ua.colorTextureTransformMatrix=K.getTransformMatrix(ra.colorTextureTransform);ua.normalTextureTransformMatrix=K.getTransformMatrix(ra.normalTextureTransform);Ea=null!=ra.normalTextureTransform?.scale?ra.normalTextureTransform?.scale:d.ONES;ua.scale=[Ea[0],Ea[1]];ua.occlusionTextureTransformMatrix=K.getTransformMatrix(ra.occlusionTextureTransform);ua.emissiveTextureTransformMatrix=K.getTransformMatrix(ra.emissiveTextureTransform);ua.metallicRoughnessTextureTransformMatrix=
K.getTransformMatrix(ra.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(ra){let ua=this.symbolLayer.material?.colorMixMode??null;if(this._drivenProperties.color)ra.externalColor=f.ONES;else{const Ea=this.symbolLayer.material?.color??null;Ea?ra.externalColor=b.toUnitRGBA(Ea):(ua=null,ra.externalColor=f.ONES)}ua&&(ra.colorMixMode=ua);ra.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(ra){ra=ra.vertexAttributes.color;if(null==ra)return!1;for(let ua=3;ua<ra.length;ua+=
4)if(255!==ra[ua])return!0;return!1}_getOrCreateMaterial(ra,ua){var Ea=ua.material?.color,Ka=ua.material?.colorTexture,Ma=ua.material?.alphaMode;const Ua="blend"===Ma;Ea="opaque"!==Ma&&(this._hasTransparentVertexColors(ra)||null!=Ea&&1>Ea.a||Ka?.transparent||Ua);ra=this._materialProperties(ra,ua,Ea);if(Ka=this._materialInfoCache.byUid(ra.uid))return Ka.material;Ea={uid:ra.uid,material:null,isComponentTransparent:Ea,alphaMode:ua.material?ua.material.alphaMode:"opaque"};Ka=da.useSchematicPBR({normalTexture:ra.normalTexture,
metallicRoughnessTexture:ra.metallicRoughnessTexture,metallicFactor:ra.metallic,roughnessFactor:ra.roughness,emissiveTexture:ra.emissiveTexture,emissiveFactor:b.toUnitRGB(ra.emissiveColor),occlusionTexture:ra.occlusionTexture});Ma={usePBR:this._usePBR(),isSchematic:Ka,hasVertexColors:ra.hasVertexColors,hasSymbolColors:ra.hasSymbolVertexColors,hasVertexTangents:ra.hasVertexTangents,ambient:l.ZEROS,diffuse:l.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:V.CullFaceOptions.None,
layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Ma.mrrFactors=Ka?[...da.defaultSchematicMRRFactors]:[ra.metallic,ra.roughness,da.defaultAdvancedMRRFactors[2]];ua.material&&(Ma.doubleSided=ua.material.doubleSided,Ma.cullFace=ua.material.doubleSided?V.CullFaceOptions.None:V.CullFaceOptions.Back,Ma.textureAlphaCutoff=ua.material.alphaCutoff);this._setExternalMaterialParameters(Ma);this._setMaterialTransparentParameter(Ma,Ea);this._setInternalMaterialParameters(ra,
Ma);ua=new ia.DefaultMaterial(Ma);Ea.material=ua;this._materialInfoCache.set(ra.uid,Ea);this._context.stage.add(ua);return ua}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(ra,ua){ra.transparent=this.needsDrivenTransparentPass||ua.isComponentTransparent||1>ra.layerOpacity||1>ra.opacity||ra.externalColor&&1>ra.externalColor[3];ra.textureAlphaMode="auto"===ua.alphaMode?ra.transparent?V.AlphaDiscardMode.MaskBlend:V.AlphaDiscardMode.Opaque:"opaque"===ua.alphaMode?
V.AlphaDiscardMode.Opaque:"mask"===ua.alphaMode?V.AlphaDiscardMode.Mask:V.AlphaDiscardMode.Blend}_addDebugNormals(ra,ua){var Ea=ua.length,Ka=ra.spatialReference.isGeographic?20015077/180:1;const Ma=.1*Math.max(ra.extent.width*Ka,ra.extent.height*Ka,ra.extent.zmax-ra.extent.zmin);var Ua=[];const Ga=[];ra=[];Ka=[];for(let gb=0;gb<Ea;gb++){var Na=ua[gb],Va=Na.attributes.get(ba.VertexAttribute.POSITION),Xa=Na.attributes.get(ba.VertexAttribute.NORMAL);Na=Va.data;Va=Va.indices;const cb=Xa.data;Xa=Xa.indices;
for(let ka=0;ka<Va.length;ka++){var Pa=3*Va[ka];const mb=3*Xa[ka];for(var bb=0;3>bb;bb++)Ua.push(Na[Pa+bb]);for(bb=0;3>bb;bb++)Ua.push(Na[Pa+bb]+cb[mb+bb]*Ma);Ga.push(Ga.length);Ga.push(Ga.length);if(0===ka%3){this._calculateFaceNormal(Na,Va,ka,ta);this._getFaceVertices(Na,Va,ka,ja,oa,qa);c.add(ja,ja,oa);c.add(ja,ja,qa);c.scale(ja,ja,1/3);for(Pa=0;3>Pa;Pa++)ra.push(ja[Pa]);for(Pa=0;3>Pa;Pa++)ra.push(ja[Pa]+ta[Pa]*Ma);Ka.push(Ka.length);Ka.push(Ka.length)}}}Ea=ua[0].transformation;Ua=new W.Geometry(this._debugVertexNormalMaterial,
[[ba.VertexAttribute.POSITION,new Q.Attribute(Ua,Ga,3,!0)]],null,U.ContentObjectType.Line);ua.push(Ua);Ua.transformation=Ea;ra=new W.Geometry(this._debugFaceNormalMaterial,[[ba.VertexAttribute.POSITION,new Q.Attribute(ra,Ka,3,!0)]],null,U.ContentObjectType.Line);ra.transformation=Ea;ua.push(ra)}_createAs3DShape(ra,ua,Ea,Ka){ra=ra.geometry;if("mesh"!==ra.type)return null;ua=this._createGeometryInfo(ra,ua,Ka);if(null==ua)return null;const {geometries:Ma,objectTransformation:Ua}=ua;T.debugFlags.DRAW_MESH_GEOMETRY_NORMALS&&
this._addDebugNormals(ra,Ma);Ka=new ca.Object3D({geometries:Ma,layerUid:this._context.layer.uid,graphicUid:Ka,isElevationSource:!0});Ka.transformation=Ua;ua=(ua=R.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()}))?new S.Object3DEdgeState(Ma[0].material,[ua],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;ua=new M.Graphics3DMeshObject3DGraphicLayer(this,Ka,Ma,null,null,L.perObjectElevationAligner,Ea,ua);this._fastUpdateProcessor.onAddGraphic();ua.needsElevationUpdates=
F.needsElevationUpdates3D(Ea.mode);ua.useObjectOriginAsAttachmentOrigin=!0;Ea.centerPointInElevationSR=this._getCenterPointInElevationSR(Ka.transformation);const {elevationProvider:Ga,renderCoordsHelper:Na}=this._context;ua.alignedSampledElevation=L.perObjectElevationAligner(ua,Ea,Ga.spatialReference,(Va,Xa)=>F.evaluateElevationInfoAtPoint(Va,Ga,Ea,Na,Xa),Na);return ua}_getCenterPointInElevationSR(ra){const ua=H.makeDehydratedPoint(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:
null);p.projectVectorToPoint([ra[12],ra[13],ra[14]],this._context.renderCoordsHelper.spatialReference,ua);return ua}_createComponentNormals(ra,ua,Ea,Ka){switch(Ea.shading||"flat"){default:case "source":return this._createComponentNormalsSource(ra,ua,Ea,Ka);case "flat":return this._createComponentNormalsFlat(ra,Ka);case "smooth":return this._createComponentNormalsSmooth(ra,Ka)}}_createComponentNormalsSource(ra,ua,Ea,Ka){if(null==ua)return this._createComponentNormalsFlat(ra,Ka);let Ma=!1;if(!Ea.trustSourceNormals)for(Ea=
0;Ea<Ka.length;Ea+=3){this._calculateFaceNormal(ra,Ka,Ea,ta);for(let Ua=0;3>Ua;Ua++){const Ga=3*Ka[Ea+Ua];ja[0]=ua[Ga];ja[1]=ua[Ga+1];ja[2]=ua[Ga+2];0>c.dot(ta,ja)&&(ua[Ga]=-ua[Ga],ua[Ga+1]=-ua[Ga+1],ua[Ga+2]=-ua[Ga+2],Ma=!0)}}return new Y(ua,Ka,Ma)}_createComponentNormalsFlat(ra,ua){const Ea=q.newFloatArray(ua.length),Ka=Array(3*ua.length);for(let Ma=0;Ma<ua.length;Ma+=3){const Ua=this._calculateFaceNormal(ra,ua,Ma,ta);for(let Ga=0;3>Ga;Ga++)Ea[Ma+Ga]=Ua[Ga],Ka[Ma+Ga]=Ma/3}return new Y(Ea,Ka,!1)}_createComponentNormalsSmooth(ra,
ua){const Ea={};for(var Ka=0;Ka<ua.length;Ka+=3){var Ma=this._calculateFaceNormal(ra,ua,Ka,ta);for(var Ua=0;3>Ua;Ua++){var Ga=ua[Ka+Ua];let Na=Ea[Ga];Na||(Na={normal:l.create(),count:0},Ea[Ga]=Na);c.add(Na.normal,Na.normal,Ma);Na.count++}}ra=q.newFloatArray(3*ua.length);Ka=Array(3*ua.length);for(Ma=0;Ma<ua.length;Ma++){Ua=Ea[ua[Ma]];1!==Ua.count&&(c.normalize(Ua.normal,Ua.normal),Ua.count=1);for(Ga=0;3>Ga;Ga++)ra[3*Ma+Ga]=Ua.normal[Ga];Ka[Ma]=Ma}return new Y(ra,Ka,!1)}_getFaceVertices(ra,ua,Ea,Ka,
Ma,Ua){const Ga=3*ua[Ea],Na=3*ua[Ea+1];ua=3*ua[Ea+2];Ka[0]=ra[Ga];Ka[1]=ra[Ga+1];Ka[2]=ra[Ga+2];Ma[0]=ra[Na];Ma[1]=ra[Na+1];Ma[2]=ra[Na+2];Ua[0]=ra[ua];Ua[1]=ra[ua+1];Ua[2]=ra[ua+2]}_calculateFaceNormal(ra,ua,Ea,Ka){this._getFaceVertices(ra,ua,Ea,ja,oa,qa);c.subtract(oa,oa,ja);c.subtract(qa,qa,ja);c.cross(ja,oa,qa);c.normalize(Ka,ja);return Ka}_getOrCreateComponents(ra){return ra.components??Ba}_createPositionBuffer(ra,ua){let Ea=ra.vertexAttributes.position;const Ka=ua.reprojection===Aa.RENDER?ua.transformBeforeProject:
null;Ka&&(Ea=C.transformMat4(new Float64Array(Ea.length),Ea,Ka));if(ua.reprojection===Aa.NONE)return ua.needsBufferCopy?new Float64Array(Ea):Ea;ua=Ka?Ea:new Float64Array(Ea.length);w.projectBuffer(Ea,ra.spatialReference,0,ua,this._context.renderCoordsHelper.spatialReference,0,Ea.length/3);return ua}_createNormalBuffer(ra,ua,Ea){let Ka=ra.vertexAttributes.normal;if(null==Ka)return null;var Ma=Ea.reprojection===Aa.RENDER?Ea.transformBeforeProject:null;Ma&&(Ka=I.transformNormal(Ka,new Float32Array(Ka.length),
Ma));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Ea.reprojection===Aa.NONE)return Ea.needsBufferCopy&&ra.vertexAttributes.normal===Ka?new Float32Array(Ka):Ka;Ea=ra.vertexAttributes.position;Ma=Ma?Ka:new Float32Array(Ka.length);return I.projectNormalToPCPF(Ka,Ea,ua,ra.spatialReference,Ma)}_createTangentBuffer(ra,ua,Ea){let Ka=ra.vertexAttributes.tangent;if(null==Ka)return null;var Ma=Ea.reprojection===Aa.RENDER?Ea.transformBeforeProject:null;Ma&&(Ka=I.transformTangent(Ka,new Float32Array(Ka.length),
Ma));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Ea.reprojection===Aa.NONE)return Ea.needsBufferCopy&&ra.vertexAttributes.normal===Ka?new Float32Array(Ka):Ka;Ea=ra.vertexAttributes.position;Ma=Ma?Ka:new Float32Array(Ka.length);return I.projectTangentToPCPF(Ka,Ea,ua,ra.spatialReference,Ma)}_createColorBuffer(ra){return ra.vertexAttributes.color}_createSymbolColorBuffer(ra){if(this._requiresSymbolVertexColors()){ra=this._getVertexOpacityAndColor(ra);const ua=O.parseColorMixMode(this.symbolLayer?.material?.colorMixMode),
Ea=new Uint8Array(4);O.encodeSymbolColor(ra,ua,Ea);return Ea}return null}_createBuffers(ra,ua){var Ea=ra.vertexAttributes&&ra.vertexAttributes.position;if(!Ea)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var Ka=ra.vertexAttributes.normal;const Ma=ra.vertexAttributes.uv;var Ua=ra.vertexAttributes.tangent;if(Ka&&Ka.length!==Ea.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(Ua&&
Ua.length/4!==Ea.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(Ma&&Ma.length/2!==Ea.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;Ua=this._computeReprojectionInfo(ra);Ea=this._createPositionBuffer(ra,Ua);Ka=this._createColorBuffer(ra);ua=this._createSymbolColorBuffer(ua);const Ga=this._createNormalBuffer(ra,Ea,Ua),Na=this._createTangentBuffer(ra,
Ea,Ua);ra=Ua.reprojection===Aa.NONE&&Ua.objectTransformation?Ua.objectTransformation:this._transformOriginLocal(ra,Ea,Ga,Na);Ua=Ua.reprojection===Aa.NONE&&Ua.geometryTransformation?Ua.geometryTransformation:e.create();return{positionBuffer:Ea,normalBuffer:Ga,tangentBuffer:Na,uvBuffer:Ma,colorBuffer:Ka,symbolColorBuffer:ua,objectTransformation:ra,geometryTransformation:Ua}}_computeReprojectionInfo(ra){var {vertexSpace:ua}=ra;const Ea="georeferenced"===ua.type?A.equals(this._context.renderCoordsHelper.spatialReference,
ra.spatialReference)?Aa.NONE:Aa.RENDER:Aa.NONE;if(G.isRelativeVertexSpace(ua)){const Ka=ua.origin;ua=e.create();const Ma=ra.transform?.localMatrix??e.IDENTITY;if(Ea===Aa.NONE)return x.computeTranslationToOriginAndRotation(ra.spatialReference,Ka,ua,this._context.renderCoordsHelper.spatialReference),ra=e.clone(Ma),{reprojection:Ea,objectTransformation:ua,geometryTransformation:ra,needsBufferCopy:!1};ra=g.fromTranslation(e.create(),Ka);g.multiply(ra,ra,Ma);return{reprojection:Ea,transformBeforeProject:ra,
needsBufferCopy:!0}}return{reprojection:Ea,needsBufferCopy:!0}}_transformOriginLocal(ra,ua,Ea,Ka){const Ma=this._context.renderCoordsHelper.spatialReference;var Ua=ra.anchor;Z[0]=Ua.x;Z[1]=Ua.y;Z[2]=Ua.z??0;Ua=e.create();x.computeTranslationToOriginAndRotation(ra.spatialReference,Z,Ua,Ma);g.invert(va,Ua);C.transformMat4(ua,ua,va);if(Ea||Ka)k.fromMat4(Ca,Ua),k.transpose(Ca,Ca),Ea&&C.transformMat3(Ea,Ea,Ca),Ka&&C.transformMat3(Ka,Ka,Ca,4);return Ua}_validateFaces(ra,ua){ra=ra.vertexAttributes.position.length/
3;if(ua=ua.faces){let Ea=-1;for(let Ka=0;Ka<ua.length;Ka++){const Ma=ua[Ka];Ma>Ea&&(Ea=Ma)}if(ra<=Ea)return this.logger.warn(`Vertex index ${Ea} is out of bounds of the mesh position buffer`),!1}else if(0!==ra%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(ra,ua){return ua.faces??u.getContinuousIndexArray(ra.vertexAttributes.position.length/3)}_isOutsideClippingArea(ra){if(!this._context.clippingExtent)return!1;
var ua=ra.vertexAttributes?.position;if(!ua)return!1;ra=E.project({positions:ua,transform:ra.transform,vertexSpace:ra.vertexSpace,inSpatialReference:ra.spatialReference,outSpatialReference:this._context.elevationProvider.spatialReference??ra.spatialReference,localMode:this._context.stage.viewingMode===B.ViewingMode.Local});ua=ra.length/3;t.empty(wa);t.expandWithBuffer(wa,ra,0,ua);return!t.intersectsClippingArea(wa,this._context.clippingExtent)}_createGeometryInfo(ra,ua,Ea){if(!r.canProjectWithoutEngine(ra.spatialReference,
this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(ra)||this._isOutsideClippingArea(ra))return null;ua=this._createBuffers(ra,ua);if(null==ua)return null;const {positionBuffer:Ka,uvBuffer:Ma,colorBuffer:Ua,symbolColorBuffer:Ga,normalBuffer:Na,tangentBuffer:Va,objectTransformation:Xa,geometryTransformation:Pa}=ua;var bb=this._getOrCreateComponents(ra);ua=[];let gb=!1;var cb=g.getTranslation(ja,
Xa);cb=this._context.localOriginFactory.getOrigin(cb);for(const mb of bb){if(!this._validateFaces(ra,mb))return null;var ka=this._getOrCreateFaces(ra,mb);if(0===ka.length)continue;bb=this._createComponentNormals(Ka,Na,mb,ka);bb.didFlipNormals&&(gb=!0);bb=[[ba.VertexAttribute.POSITION,new Q.Attribute(Ka,ka,3,!0)],[ba.VertexAttribute.NORMAL,new Q.Attribute(bb.normals,bb.indices,3,!0)]];Ua&&bb.push([ba.VertexAttribute.COLOR,new Q.Attribute(Ua,ka,4,!0)]);Ga&&bb.push([ba.VertexAttribute.SYMBOLCOLOR,new Q.Attribute(Ga,
u.getZeroIndexArray(ka.length),4,!0)]);Ma&&bb.push([ba.VertexAttribute.UV0,new Q.Attribute(Ma,ka,2,!0)]);Va&&bb.push([ba.VertexAttribute.TANGENT,new Q.Attribute(Va,ka,4,!0)]);ka=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:Ea,layerUid:this._context.layer.uid});const qb=this._getOrCreateMaterial(ra,mb);bb=new W.Geometry(qb,bb,null,U.ContentObjectType.Mesh,ka);bb.transformation=Pa;bb.localOrigin=cb;ua.push(bb)}gb&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:ua,objectTransformation:Xa}}_updateMaterialParameters(ra){this._materialInfoCache.forEachMaterialInfo(ra);this._fastUpdateProcessor.forEachMaterialInfo(ra);this._fastUpdateProcessor.forEachClonedMaterial((ua,Ea)=>{Ea.setParameters(ua.parameters)})}_validateVertexSpace(ra){const {_context:{graphicsCoreOwner:{view:{state:{viewingMode:ua}}}}}=this;({vertexSpace:ra}=ra);return ua===B.ViewingMode.Local&&"local"===ra.type?(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),
!1):!0}test(){return{...super.test(),materials:this._materialInfoCache.materials}}}class Y{constructor(ra,ua,Ea){this.normals=ra;this.indices=ua;this.didFlipNormals=Ea}}const Z=l.create(),ja=l.create(),oa=l.create(),qa=l.create(),ta=l.create(),va=e.create(),Ca=m.create(),ma=e.create(),wa=t.create(),Ba=[new v],pa=new D;var Aa;(function(ra){ra[ra.NONE=0]="NONE";ra[ra.RENDER=1]="RENDER"})(Aa||={});a.Graphics3DMeshFillSymbolLayer=ha;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){var f;b=f=class extends b.JSONSupport{static from(r){return e.ensureClass(f,r)}constructor(r){super(r);this.material=this.faces=null;this.name=void 0;this.shading="source";this.trustSourceNormals=!1}castFaces(r){return l.castArray(r,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},h.getLogger(this))}castMaterial(r){return r&&"object"===typeof r&&("metallic"in r||"roughness"in r||"metallicRoughnessTexture"in r)?e.ensureClass(c,r):e.ensureClass(d,r)}clone(){return new f({faces:n.clone(this.faces),
shading:this.shading,material:n.clone(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}cloneWithDeduplication(r,x){r={faces:n.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(r,x):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new f(r)}get memoryUsage(){let r=0;null!=this.faces&&(r+=this.faces.byteLength);null!=this.material&&(r+=this.material.memoryUsage);return r}};a.__decorate([k.property({json:{write:!0}})],
b.prototype,"faces",void 0);a.__decorate([m.cast("faces")],b.prototype,"castFaces",null);a.__decorate([k.property({type:d,json:{write:!0}})],b.prototype,"material",void 0);a.__decorate([m.cast("material")],b.prototype,"castMaterial",null);a.__decorate([k.property()],b.prototype,"name",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);a.__decorate([k.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=f=a.__decorate([g.subclass("esri.geometry.support.MeshComponent")],
b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,n,h,k,m,g,e,d,c){var l;n=l=class extends n.JSONSupport{constructor(f){super(f);this.colorTextureTransform=this.colorTexture=this.color=null;this.normalTextureTransform=this.normalTexture=
void 0;this.alphaMode="auto";this.alphaCutoff=.5;this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(f,r){const x=null!=f?f.get(this):null;if(x)return x;r=new l(this.clonePropertiesWithDeduplication(r));null!=f&&f.set(this,r);return r}clonePropertiesWithDeduplication(f){return{color:null!=this.color?this.color.clone():null,colorTexture:this.colorTexture?.cloneWithDeduplication(f),normalTexture:this.normalTexture?.cloneWithDeduplication(f),alphaMode:this.alphaMode,
alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:this.colorTextureTransform?.clone(),normalTextureTransform:this.normalTextureTransform?.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let f;f=null!=this.color?16:0;null!=this.colorTexture&&(f+=this.colorTexture.memoryUsage);f+=null!=this.colorTextureTransform?20:0;null!=this.normalTexture&&(f+=this.normalTexture.memoryUsage);return f+=null!=this.normalTextureTransform?20:0}};a.__decorate([h.property({type:b,
json:{write:!0}})],n.prototype,"color",void 0);a.__decorate([h.property({type:d,json:{write:!0}})],n.prototype,"colorTexture",void 0);a.__decorate([h.property({type:c,json:{write:!0}})],n.prototype,"colorTextureTransform",void 0);a.__decorate([h.property({type:d,json:{write:!0}})],n.prototype,"normalTexture",void 0);a.__decorate([h.property({type:c,json:{write:!0}})],n.prototype,"normalTextureTransform",void 0);a.__decorate([h.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaMode",void 0);
a.__decorate([h.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaCutoff",void 0);a.__decorate([h.property({nonNullable:!0,json:{write:!0}})],n.prototype,"doubleSided",void 0);return n=l=a.__decorate([e.subclass("esri.geometry.support.MeshMaterial")],n)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){var f;const r=new WeakMap;let x=0;b=f=class extends h.JSONSupport{constructor(w){super(w);this.wrap="repeat"}get url(){return this._get("url")||null}set url(w){this._set("url",w);w&&this._set("data",null)}get data(){return this._get("data")||null}set data(w){this._set("data",w);w&&this._set("url",null)}writeData(w,p,t,q){w instanceof HTMLImageElement?(w={type:"image-element",src:l.toJSON(w.src,q),crossOrigin:w.crossOrigin},p[t]=w):w instanceof HTMLCanvasElement?(w=
w.getContext("2d").getImageData(0,0,w.width,w.height),w={type:"canvas-element",imageData:this._encodeImageData(w)},p[t]=w):w instanceof HTMLVideoElement?(w={type:"video-element",src:l.toJSON(w.src,q),autoplay:w.autoplay,loop:w.loop,muted:w.muted,crossOrigin:w.crossOrigin,preload:w.preload},p[t]=w):w instanceof ImageData&&(w={type:"image-data",imageData:this._encodeImageData(w)},p[t]=w)}readData(w){switch(w.type){case "image-element":var p=new Image;p.src=w.src;p.crossOrigin=w.crossOrigin;return p;
case "canvas-element":return w=this._decodeImageData(w.imageData),p=document.createElement("canvas"),p.width=w.width,p.height=w.height,p.getContext("2d").putImageData(w,0,0),p;case "image-data":return this._decodeImageData(w.imageData);case "video-element":return p=document.createElement("video"),p.src=w.src,p.crossOrigin=w.crossOrigin,p.autoplay=w.autoplay,p.loop=w.loop,p.muted=w.muted,p.preload=w.preload,p}}get transparent(){var w=this.data,p=this.url;return w instanceof HTMLCanvasElement?this._imageDataContainsTransparent(w.getContext("2d").getImageData(0,
0,w.width,w.height)):w instanceof ImageData?this._imageDataContainsTransparent(w):p&&(w=p.substr(p.length-4,4).toLowerCase(),p=p.substr(0,15).toLocaleLowerCase(),".png"===w||"data:image/png;"===p)?!0:!1}set transparent(w){this._overrideIfSome("transparent",w)}get contentHash(){const w="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",p=(t="")=>`d:${t},t:${this.transparent},w:${w}`;if(null!=this.url)return p(this.url);if(null!=this.data){if(this.data instanceof
HTMLImageElement||this.data instanceof HTMLVideoElement)return p(this.data.src);r.has(this.data)||r.set(this.data,++x);return p(r.get(this.data))}return p()}get memoryUsage(){let w;w=0+(null!=this.url?this.url.length:0);if(null!=this.data){const p=this.data;"data"in p?w+=p.data.byteLength:p instanceof HTMLImageElement?w+=p.naturalWidth*p.naturalHeight*3:p instanceof HTMLCanvasElement&&(w+=p.width*p.height*3)}return w}clone(){const w={url:this.url,data:this.data,wrap:this._cloneWrap()};return new f(w)}cloneWithDeduplication(w){var p=
w.get(this);if(p)return p;p=this.clone();w.set(this,p);return p}_cloneWrap(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(w){let p="";for(let t=0;t<w.data.length;t++)p+=String.fromCharCode(w.data[t]);return{data:btoa(p),width:w.width,height:w.height}}_decodeImageData(w){const p=atob(w.data),t=new Uint8ClampedArray(p.length);for(let q=0;q<p.length;q++)t[q]=p.charCodeAt(q);return n.wrapImageData(t,w.width,w.height)}_imageDataContainsTransparent(w){for(let p=
3;p<w.data.length;p+=4)if(255!==w.data[p])return!0;return!1}static from(w){return"string"===typeof w?new f({url:w}):w instanceof HTMLImageElement||w instanceof HTMLCanvasElement||w instanceof ImageData||w instanceof HTMLVideoElement?new f({data:w}):m.ensureClass(f,w)}};a.__decorate([k.property({type:String,json:{write:l.write}})],b.prototype,"url",null);a.__decorate([k.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),k.property()],b.prototype,"data",null);a.__decorate([c.writer("data")],
b.prototype,"writeData",null);a.__decorate([e.reader("data")],b.prototype,"readData",null);a.__decorate([k.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"wrap",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"contentHash",null);return b=f=a.__decorate([d.subclass("esri.geometry.support.MeshTexture")],b)})},"esri/core/imageUtils":function(){define("require exports ../request ./Error ./promiseUtils ./urlUtils ../support/base64Utils".split(" "),
function(a,b,n,h,k,m,g){function e(r,x,w){w||(l||(l=document.createElement("canvas"),l.width=1,l.height=1),w=l);return w.getContext("2d").createImageData(r,x)}async function d(r,x){r=window.URL.createObjectURL(r);try{const {data:w}=await n(r,{...x,responseType:"image"});return w}catch(w){if(!k.isAbortError(w))throw new h("invalid-image",`Could not fetch requested image at ${r}`);throw w;}finally{window.URL.revokeObjectURL(r)}}async function c(r,x){const w=m.dataComponents(r);if(w?.isBase64)return{arrayBuffer:g.base64ToArrayBuffer(w.data),
mediaType:w.mediaType};x=await n(r,{responseType:"array-buffer",...x});r=x.data;x=x.getHeader?.("Content-Type")??"";return{arrayBuffer:r,mediaType:x}}let l=null,f=!0;b.createEmptyImageData=function(r,x,w){if(!r||!x)throw Error("Cannot construct image data without dimensions");if(f)try{return new ImageData(r,x)}catch(p){f=!1}return e(r,x,w)};b.getImageData=async function(r,x){const {arrayBuffer:w,mediaType:p}=await c(r,x);r="image/png"===p;if("image/gif"===p){const {isAnimatedGIF:t,parseGif:q}=await new Promise((u,
v)=>a(["./image/gif"],u,v));if(t(w))return q(w,x)}if(r){const {isAnimatedPNG:t,parseApng:q}=await new Promise((u,v)=>a(["./image/apng"],u,v));if(t(w))return q(w,x)}r=new Blob([w],{type:p});return d(r,x)};b.wrapImageData=function(r,x,w,p){if(!x||!w)throw Error("Cannot construct image data without dimensions");if(f)try{return new ImageData(r,x,w)}catch(t){f=!1}x=e(x,w,p);x.data.set(r,0);return x};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTextureTransform":function(){define("../../chunks/tslib.es6 ../../core/Clonable ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){b=class extends b.ClonableMixin(n.JSONSupport){constructor(d){super(d);this.offset=[0,0];this.rotation=0;this.scale=[1,1]}};a.__decorate([h.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"offset",void 0);a.__decorate([h.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotation",void 0);a.__decorate([h.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);return b=a.__decorate([e.subclass("esri.geometry.support.MeshTextureTransform")],
b)})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture ./MeshTextureTransform".split(" "),function(a,b,n,h,k,m,g,e,d,c){var l;h=l=class extends e{constructor(f){super(f);this.emissiveTexture=this.emissiveColor=null;this.emissiveTextureTransform=void 0;this.occlusionTexture=
null;this.occlusionTextureTransform=void 0;this.roughness=this.metallic=1;this.metallicRoughnessTexture=null;this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(f,r){const x=null!=f?f.get(this):null;if(x)return x;r=new l(this.clonePropertiesWithDeduplication(r));null!=f&&f.set(this,r);return r}getMemoryUsage(){let f=super.getMemoryUsage();f+=null!=this.emissiveColor?16:0;null!=this.emissiveTexture&&(f+=this.emissiveTexture.memoryUsage);
f+=null!=this.emissiveTextureTransform?20:0;null!=this.occlusionTexture&&(f+=this.occlusionTexture.memoryUsage);f+=null!=this.occlusionTextureTransform?20:0;null!=this.metallicRoughnessTexture&&(f+=this.metallicRoughnessTexture.memoryUsage);return f+=null!=this.metallicRoughnessTextureTransform?20:0}clonePropertiesWithDeduplication(f){return{...super.clonePropertiesWithDeduplication(f),emissiveColor:this.emissiveColor?.clone(),emissiveTexture:this.emissiveTexture?.cloneWithDeduplication(f),emissiveTextureTransform:this.emissiveTextureTransform?.clone(),
occlusionTexture:this.occlusionTexture?.cloneWithDeduplication(f),occlusionTextureTransform:this.occlusionTextureTransform?.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?.cloneWithDeduplication(f),metallicRoughnessTextureTransform:this.metallicRoughnessTextureTransform?.clone()}}};a.__decorate([n.property({type:b,json:{write:!0}})],h.prototype,"emissiveColor",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],h.prototype,"emissiveTexture",
void 0);a.__decorate([n.property({type:c,json:{write:!0}})],h.prototype,"emissiveTextureTransform",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],h.prototype,"occlusionTexture",void 0);a.__decorate([n.property({type:c,json:{write:!0}})],h.prototype,"occlusionTextureTransform",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],h.prototype,"metallic",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,
max:1}})],h.prototype,"roughness",void 0);a.__decorate([n.property({type:d,json:{write:!0}})],h.prototype,"metallicRoughnessTexture",void 0);a.__decorate([n.property({type:c,json:{write:!0}})],h.prototype,"metallicRoughnessTextureTransform",void 0);return h=l=a.__decorate([g.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],h)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){function d(r,x,w,p){const {loggerTag:t,stride:q}=x;return 0!==r.length%q?(p.error(t,`Invalid array length, expected a multiple of ${q}`),new w([])):r}function c(r,x,w,p,t){if(!r)return r;if(r instanceof x)return d(r,p,x,t);for(const q of w)if(r instanceof q)return d(new x(r),p,x,t);if(Array.isArray(r))return d(new x(r),p,x,t);w=w.map(q=>`'${q.name}'`);t.error(`Failed to set property, expected one of ${w}, but got ${r.constructor.name}`);return new x([])}function l(r,x,w){const p=
Array(r.length);for(let t=0;t<r.length;t++)p[t]=r[t];x[w]=p}var f;a.MeshVertexAttributes=f=class extends n.JSONSupport{constructor(r){super(r);this.color=null;this.position=new Float64Array(0);this.tangent=this.normal=this.uv=null}castColor(r){return c(r,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},k.getLogger(this))}castPosition(r){r&&r instanceof Float32Array&&k.getLogger(this).warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return c(r,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},k.getLogger(this))}castUv(r){return c(r,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},k.getLogger(this))}castNormal(r){return c(r,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},k.getLogger(this))}castTangent(r){return c(r,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},k.getLogger(this))}clone(){const r={position:h.clone(this.position),uv:h.clone(this.uv),normal:h.clone(this.normal),
tangent:h.clone(this.tangent),color:h.clone(this.color)};return new f(r)}clonePositional(){const r={position:h.clone(this.position),normal:h.clone(this.normal),tangent:h.clone(this.tangent),uv:this.uv,color:this.color};return new f(r)}get memoryUsage(){let r;r=0+this.position.byteLength;null!=this.uv&&(r+=this.uv.byteLength);null!=this.normal&&(r+=this.normal.byteLength);null!=this.tangent&&(r+=this.tangent.byteLength);null!=this.color&&(r+=this.color.byteLength);return r}};b.__decorate([m.property({json:{write:l}})],
a.MeshVertexAttributes.prototype,"color",void 0);b.__decorate([g.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([m.property({nonNullable:!0,json:{write:l}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([g.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([m.property({json:{write:l}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([g.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([m.property({json:{write:l}})],
a.MeshVertexAttributes.prototype,"normal",void 0);b.__decorate([g.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([m.property({json:{write:l}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([g.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=f=b.__decorate([e.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/georeference":function(){define("exports ../../../core/unitUtils ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../DoubleArray ../MeshTransform ../meshVertexSpaceUtils ../../../chunks/vec3 ./geographicUtils ./projection".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){function u(z,K,L){if(t.isGlobal(K.spatialReference,L?.geographic))z=G(z,K,!1,L);else{const F=new Float64Array(z.position.length),M=z.position,S=K.x,N=K.y,P=K.z??0;K=I(L?L.unit:null,K.spatialReference);for(L=0;L<M.length;L+=3)F[L]=M[L]*K+S,F[L+1]=M[L+1]*K+N,F[L+2]=M[L+2]*K+P;z={position:F,normal:z.normal,tangent:z.tangent}}return z}function v(z,K=k.IDENTITY){const {position:L,normal:F,tangent:M}=z;z=p.transformMat4(new Float64Array(L.length),L,K);const S=
null!=F?q.transformNormal(F,new Float32Array(F.length),K):null;K=null!=M?q.transformTangent(M,new Float32Array(M.length),K):null;return{position:z,normal:S,tangent:K}}function y(z,K,L,F){const {position:M,normal:S,tangent:N}=z;if(!w.isRelativeVertexSpace(K))return{position:M,normal:S,tangent:N};F=w.vertexSpaceOriginToPoint(K,F);z=v(z,L?.localMatrix);return u(z,F,{geographic:"local"===K.type})}function D(z,K,L){return t.isGlobal(K.spatialReference,L?.geographic)?C(z,K,L):A(z,K,L)}function G(z,K,L,
F){var M=K.spatialReference,S=E(K,F,H);F=new Float64Array(z.position.length);var N=z.position;p.transformMat4(F,N,S);N=new Float64Array(N.length);N=q.projectFromPCPF(F,N,M);S=e.normalFromMat4(B,S);var P=z.normal;if(null==P)P=null;else{var R=new Float32Array(P.length);p.transformMat3(R,P,S);q.projectNormalFromPCPF(R,N,F,M,R);P=R}z=z.tangent;if(null==z)M=null;else{R=new Float32Array(z.length);p.transformMat3(R,z,S,4);for(S=3;S<R.length;S+=4)R[S]=z[S];q.projectTangentFromPCPF(R,N,F,M,R);M=R}if(L){const {x:O,
y:T,z:Q}=K;p.translate(N,N,[-O,-T,-(Q??0)])}return{position:N,normal:P,tangent:M}}function A(z,K,L){const F=new Float64Array(z.position.length),M=z.position,S=K.x,N=K.y,P=K.z??0;K=I(L?L.unit:null,K.spatialReference);for(L=0;L<M.length;L+=3)F[L]=(M[L]-S)/K,F[L+1]=(M[L+1]-N)/K,F[L+2]=(M[L+2]-P)/K;return{position:F,normal:z.normal,tangent:z.tangent}}function C(z,K,L){const F=K.spatialReference;E(K,L,H);var M=h.invert(J,H);L=new Float64Array(z.position.length);var S=q.projectToPCPF(z.position,F,L);K=
new Float64Array(S.length);p.transformMat4(K,S,M);M=e.normalFromMat4(B,M);S=z.normal;null==S?S=null:(S=q.projectNormalToPCPF(S,z.position,L,F,new Float32Array(S.length)),p.transformMat3(S,S,M));var N=z.tangent;null==N?z=null:(z=q.projectTangentToPCPF(N,z.position,L,F,new Float32Array(N.length)),p.transformMat3(z,z,M,4));return{position:K,normal:S,tangent:z}}function E(z,K,L){l.computeTranslationToOriginAndRotation(z.spatialReference,[z.x,z.y,z.z??0],L,c.getSphericalPCPF(z.spatialReference));z=I(K?
K.unit:null,z.spatialReference);h.scale(L,L,[z,z,z]);return L}function I(z,K){if(null==z)return 1;K=b.getMetersPerCartesianUnitForSR(K);return 1/b.convertUnit(K,"meters",z)}const H=k.create(),J=k.create(),B=n.create();a.applyTransform=v;a.georeference=u;a.georeferenceApplyTransform=y;a.georeferenceByTransform=function(z,K,L){const F=w.selectVertexSpace(K,L);var M=K.spatialReference;const S=w.isRelativeVertexSpace(F);if(!S)return{vertexAttributes:u(z,K,L),vertexSpace:F,transform:null};const {position:N,
normal:P,tangent:R}=z;M=t.usesLocalTangentPlaneOnECEF(F,M);switch(F.type){case "georeferenced":return M?{vertexAttributes:G(z,K,S,L),vertexSpace:F,transform:null}:{vertexAttributes:{position:N,normal:P,tangent:R},vertexSpace:F,transform:new x};case "local":return{vertexAttributes:{position:N,normal:P,tangent:R},vertexSpace:F,transform:new x}}};a.georeferenceGlobal=G;a.getUnitScale=I;a.project=function({positions:z,transform:K,vertexSpace:L,inSpatialReference:F,outSpatialReference:M,outPositions:S,
localMode:N}){const P=L.origin??g.ZEROS;K=null!=L.origin?K?.localMatrix??k.IDENTITY:k.IDENTITY;if("georeferenced"===L.type){S=S??r.newDoubleArray(z.length);h.equals(K,k.IDENTITY)?r.copyInto(S,z):p.transformMat4(S,z,K);if(!m.exactEquals(P,g.ZEROS)){const [O,T,Q]=P;for(z=0;z<S.length;z+=3)S[z]+=O,S[z+1]+=T,S[z+2]+=Q}f.projectBuffer(S,F,0,S,M,0,S.length/3);return S}L=F;const R=c.getSphericalPCPF(F);L=M.isWebMercator&&N||!d.canProjectWithoutEngine(F,R)?L:R;l.computeTranslationToOriginAndRotation(F,P,
H,L);h.multiply(H,H,K);F=S??r.newDoubleArray(z.length);p.transformMat4(F,z,H);f.projectBuffer(F,L,0,F,M,0,F.length/3);return F};a.ungeoreference=D;a.ungeoreferenceByTransform=function(z,K,L,F,M){if(!w.isRelativeVertexSpace(K))return D(z,F,M);const {spatialReference:S}=F;z=y(z,K,L,S);return F.equals(w.vertexSpaceOriginToPoint(K,S))?A(z,F,M):D(z,F,M)};a.ungeoreferenceGlobal=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshTransform":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/math/mat4 ../../core/libs/gl-matrix-2/factories/mat4f64 ../../core/libs/gl-matrix-2/math/quat ../../core/libs/gl-matrix-2/factories/quatf64 ../../chunks/vec32 ../../core/libs/gl-matrix-2/factories/vec3f64 ./axisAngleDegrees".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){var w;b=w=class extends b.JSONSupport{constructor(t){super(t);this.translation=r.create();this.rotationAxis=r.fromArray(x.up);this.rotationAngle=0;this.scale=r.fromValues(1,1,1)}get rotation(){return x.fromAxisAndAngle(this.rotationAxis,this.rotationAngle)}set rotation(t){this.rotationAxis=r.clone(x.axis(t));this.rotationAngle=x.angle(t)}get localMatrix(){const t=d.create();c.setAxisAngle(p,x.axis(this.rotation),x.angleRad(this.rotation));e.fromRotationTranslationScale(t,
p,this.translation,this.scale);return t}get localMatrixInverse(){return e.invert(d.create(),this.localMatrix)}applyLocal(t,q){return f.transformMat4(q,t,this.localMatrix)}applyLocalInverse(t,q){return f.transformMat4(q,t,this.localMatrixInverse)}equals(t){return this===t||null!=t&&e.exactEquals(this.localMatrix,t.localMatrix)}clone(){const t={translation:r.clone(this.translation),rotationAxis:r.clone(this.rotationAxis),rotationAngle:this.rotationAngle,scale:r.clone(this.scale)};return new w(t)}};
a.__decorate([n.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"translation",void 0);a.__decorate([n.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAxis",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"rotationAngle",void 0);a.__decorate([n.property({type:[Number],nonNullable:!0,json:{write:!0}})],b.prototype,"scale",void 0);a.__decorate([n.property()],b.prototype,"rotation",null);a.__decorate([n.property()],
b.prototype,"localMatrix",null);a.__decorate([n.property()],b.prototype,"localMatrixInverse",null);b=w=a.__decorate([g.subclass("esri.geometry.support.MeshTransform")],b);const p=l.create();return b})},"esri/geometry/support/meshUtils/geographicUtils":function(){define(["exports","../../../core/deprecate","../../../core/Logger","../meshVertexSpaceUtils"],function(a,b,n,h){function k(m,g){switch(m.type){case "georeferenced":return g.isGeographic;case "local":return g.isGeographic||g.isWebMercator}}
a.isGlobal=function(m,g){return m.isGeographic||m.isWebMercator&&(g??!0)};a.usesLocalTangentPlaneOnECEF=k;a.usesLocalTangentPlaneOnECEFForOperations=function(m,g,e,d){if(void 0!==d){b.deprecated(n.getLogger(m),"option: geographic",{replacement:"use mesh vertexSpace and spatial reference to control how operations are performed",version:"4.29",warnOnce:!0});const c="local"===g.type;if(h.isRelativeVertexSpace(g)&&d!==c)n.getLogger(m).warnOnce(`Specifying the 'geographic' parameter (${d}) for a Mesh vertex space of type "${g.type}" is not supported. This parameter will be ignored.`);
else return e.isGeographic||e.isWebMercator&&d}return k(g,e)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectBuffer ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec3".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(A,C,E,I,H,J){if(C){var B=E.count,z=e.getSphericalPCPF(H);if(t(H))for(E=0;E<B;E++)I.getVec(E,v),C.getVec(E,y),d.computeTranslationToOriginAndRotation(z,v,D,z),n.fromMat4(G,D),A===u.FROM_PCPF&&n.transpose(G,G),m.transformMat3(y,y,G),J.setVec(E,y);else for(H=0;H<B;H++){I.getVec(H,v);C.getVec(H,y);d.computeTranslationToOriginAndRotation(z,v,D,z);n.fromMat4(G,D);var K=f.y2lat(E.get(H,1));K=Math.cos(K);A===u.TO_PCPF&&(K=1/K);G[0]*=K;G[1]*=K;G[2]*=K;G[3]*=
K;G[4]*=K;G[5]*=K;A===u.FROM_PCPF&&n.transpose(G,G);m.transformMat3(y,y,G);m.normalize(y,y);J.setVec(H,y)}return J}}function p(A){return t(A)||A.isWebMercator}function t(A){return A.isWGS84||l.isCGCS2000(A)||l.isMars(A)||l.isMoon(A)}const q=()=>b.getLogger("esri.geometry.support.meshUtils.normalProjection");var u;(function(A){A[A.TO_PCPF=0]="TO_PCPF";A[A.FROM_PCPF=1]="FROM_PCPF"})(u||={});const v=g.create(),y=g.create(),D=k.create(),G=h.create();a.projectFromPCPF=function(A,C,E){c.projectBuffer(A,
e.getSphericalPCPF(E),0,C,E,0,A.length/3);return C};a.projectNormalFromPCPF=function(A,C,E,I,H){if(!p(I))return q().error("Cannot convert to spatial reference from PCPF"),H;w(u.FROM_PCPF,r.BufferViewVec3f.fromTypedArray(A),r.BufferViewVec3f64.fromTypedArray(C),r.BufferViewVec3f64.fromTypedArray(E),I,r.BufferViewVec3f.fromTypedArray(H));return H};a.projectNormalToPCPF=function(A,C,E,I,H){if(!p(I))return q().error("Cannot convert spatial reference to PCPF"),H;w(u.TO_PCPF,r.BufferViewVec3f.fromTypedArray(A),
r.BufferViewVec3f64.fromTypedArray(C),r.BufferViewVec3f64.fromTypedArray(E),I,r.BufferViewVec3f.fromTypedArray(H));return H};a.projectTangentFromPCPF=function(A,C,E,I,H){if(!p(I))return q().error("Cannot convert to spatial reference from PCPF"),H;w(u.FROM_PCPF,r.BufferViewVec3f.fromTypedArray(A,16),r.BufferViewVec3f64.fromTypedArray(C),r.BufferViewVec3f64.fromTypedArray(E),I,r.BufferViewVec3f.fromTypedArray(H,16));for(C=3;C<A.length;C+=4)H[C]=A[C];return H};a.projectTangentToPCPF=function(A,C,E,I,
H){if(!p(I))return q().error("Cannot convert spatial reference to PCPF"),H;w(u.TO_PCPF,r.BufferViewVec3f.fromTypedArray(A,4*Float32Array.BYTES_PER_ELEMENT),r.BufferViewVec3f64.fromTypedArray(C),r.BufferViewVec3f64.fromTypedArray(E),I,r.BufferViewVec3f.fromTypedArray(H,4*Float32Array.BYTES_PER_ELEMENT));for(C=3;C<A.length;C+=4)H[C]=A[C];return H};a.projectToPCPF=function(A,C,E){c.projectBuffer(A,C,0,E,e.getSphericalPCPF(C),0,A.length/3);return E};a.transformNormal=function(A,C,E){n.normalFromMat4(G,
E);x.transformMat3(C,A,G);n.isOrthoNormal(G)||x.normalize(C,C);return C};a.transformTangent=function(A,C,E){n.normalFromMat4(G,E);x.transformMat3(C,A,G,4);n.isOrthoNormal(G)||x.normalize(C,C,4);if(A!==C)for(E=3;E<A.length;E+=4)C[E]=A[E];return C};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/interfaces":function(){define(["exports"],function(a){a.MeshTransformUpdateAction=void 0;var b=a.MeshTransformUpdateAction||(a.MeshTransformUpdateAction={});b[b.EnableFastUpdates=
0]="EnableFastUpdates";b[b.DisableFastUpdates=1]="DisableFastUpdates";b[b.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/basicInterfaces"],function(a,b,n){class h{constructor(k){this.data=k;this.type="encoded-mesh-texture";this.encoding=n.TextureEncodingMimeType.KTX2_ENCODING}}a.EncodedMeshTexture=h;a.imageFromBinaryData=
async function(k,m){if(m===n.TextureEncodingMimeType.KTX2_ENCODING)return new h(k);k=new Blob([k],{type:m});const g=URL.createObjectURL(k),e=new Image;if(b("esri-iPhone"))return new Promise((d,c)=>{const l=()=>{r();d(e)},f=x=>{r();c(x)},r=()=>{URL.revokeObjectURL(g);e.removeEventListener("load",l);e.removeEventListener("error",f)};e.addEventListener("load",l);e.addEventListener("error",f);e.src=g});try{e.src=g,await e.decode()}catch(d){console.warn("Failed decoding HTMLImageElement")}URL.revokeObjectURL(g);
return e};a.isEncodedMeshTexture=function(k){return"encoded-mesh-texture"===k?.type};a.jsonFromBinaryData=async function(k){k=await (new Blob([k])).text();return JSON.parse(k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../core/libs/gl-matrix-2/math/mat3"],function(a,b,n,h){a.getTransformMatrix=
function(k){if(null==k)return null;var m=null!=k.offset?k.offset:n.ZEROS,g=null!=k.rotation?k.rotation:0;k=null!=k.scale?k.scale:n.ONES;m=b.fromValues(1,0,0,0,1,0,m[0],m[1],1);g=b.fromValues(Math.cos(g),-Math.sin(g),0,Math.sin(g),Math.cos(g),0,0,0,1);k=b.fromValues(k[0],0,0,0,k[1],0,0,0,1);const e=b.create();h.multiply(e,g,k);h.multiply(e,m,e);return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshObject3DGraphicLayer":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./ElevationAligners ./elevationAlignmentUtils ./featureExpressionInfoUtils ./Graphics3DObject3DGraphicLayer".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends d.Graphics3DObject3DGraphicLayer{constructor(){super(...arguments);this._originalGeometries=[];this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(u,v){if(!this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!0;var {stageObject:y}=this,D=y.geometries.slice();y.removeAllGeometries();var G=b.getTranslation(l,y.transformation);v=v.getOrigin(G);for(const A of D)G=
u(A.material),G=A.instantiate({material:G}),G.localOrigin=v,y.addGeometry(G);this._originalGeometries=D}}disableFastTransformUpdates(u){if(this._fastTransformUpdatesEnabled){this._fastTransformUpdatesEnabled=!1;var {stageObject:v}=this,y=v.geometries.map(D=>u(D.material));v.removeAllGeometries();for(let D=0;D<this._originalGeometries.length;D++){const G=this._originalGeometries[D],A=y[D];A.setParameters({modelTransformation:null});A===G.material?v.addGeometry(G):v.addGeometry(G.instantiate({material:A}))}this._originalGeometries.length=
0}}updateFastLocalOrigin(u,v,y){if(this._fastTransformUpdatesEnabled){var {stageObject:D}=this;if(0!==D.geometries.length){var G=D.geometries[0].localOrigin,A=b.getTranslation(l,u),C=y.getOrigin(A);if(C!==G){var E=v?.localMatrix??n.IDENTITY;D.shaderTransformation=null;D.transformation=u;D.geometries.forEach(I=>{I.transformation=E;I.localOrigin=C})}}}}updateTransform(u,v,y){const {stageObject:D}=this,G=v?.localMatrix??n.IDENTITY;if(this._fastTransformUpdatesEnabled){var A=D.geometries[0].transformation;
v=b.multiply(f,D.transformation,A);u=b.multiply(r,u,G);A=b.multiply(w,u,b.invert(w,A));D.shaderTransformation=A;this._setFastMaterialTransformation({matA:v,matB:u})}else D.shaderTransformation=null,D.transformation=u,D.geometries.forEach(C=>{C.transformation=G});this._fastUpdateEdgeTransform()||this.resetEdgeObject(y)}alignWithElevation(u,v,y,D){if(this._fastTransformUpdatesEnabled){null!=y&&e.setContextFeature(this.elevationContext.featureExpressionInfoContext,y);var {stageObject:G}=this;if(G.geometries[0].material.parameters.modelTransformation){y=
b.multiply(f,G.transformation,G.geometries[0].transformation);var A=b.copy(x,G.effectiveTransformation);this.alignedSampledElevation=m.perObjectElevationAligner(this,this.elevationContext,u.spatialReference,(C,E)=>g.evaluateElevationInfoAtPoint(C,u,this.elevationContext,v,E),v,A);G.shaderTransformation=A;G=b.multiply(r,A,G.geometries[0].transformation);this._setFastMaterialTransformation({matA:y,matB:G});this._fastUpdateEdgeTransform()||this.resetEdgeObject(D)}}else super.alignWithElevation(u,v,y,
D)}_setFastMaterialTransformation({matA:u,matB:v}){const {stageObject:y}=this;if(0!==y.geometries.length){var D=b.fromTranslation(q,h.scale(l,y.geometries[0].localOrigin.vec3,-1));u=b.multiply(p,D,u);v=b.multiply(t,D,v);D=b.invert(p,u);v=b.multiply(t,v,D);for(const G of y.geometries)G.material.setParameters({modelTransformation:v})}}_fastUpdateEdgeTransform(){return this._stageLayer.stage.renderer.ensureEdgeView().fastUpdateObject3DEdgesTransform(this.stageObject)}}const l=k.create(),f=n.create(),
r=n.create(),x=n.create(),w=n.create(),p=n.create(),t=n.create(),q=n.create();a.Graphics3DMeshObject3DGraphicLayer=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/MeshFastUpdateProcessor":function(){define(["exports","../../webgl-engine/materials/DefaultMaterial"],function(a,b){class n{constructor(){this._fastTransformOriginalMaterials=new Map;this._fastTransformClonedMaterials=new Map;this._graphicReferenceCount=0}enable(k,m,g){k.enableFastTransformUpdates(e=>
{if(1>=this._graphicReferenceCount){if(this._fastTransformOriginalMaterials.has(e))return e;var d=m.byMaterial(e);this._fastTransformOriginalMaterials.set(e,d);m.delete(e);return e}d=new b.DefaultMaterial(e.parameters);g.stage.add(d);this._fastTransformClonedMaterials.set(d,e);return d},g.localOriginFactory)}disable(k,m,g){const e=new Set,d=new Set;k.disableFastTransformUpdates(c=>{if(!this._fastTransformClonedMaterials.has(c)){var l=this._fastTransformOriginalMaterials.get(c);if(m.has(l.uid))return e.add(c),
m.byUid(l.uid).material;d.add(c);return l.material}l=this._fastTransformClonedMaterials.get(c);this._fastTransformClonedMaterials.delete(c);g.stage.remove(c);return l});for(const c of e)this._fastTransformOriginalMaterials.delete(c),g.stage.remove(c);for(const c of d)k=this._fastTransformOriginalMaterials.get(c),this._fastTransformOriginalMaterials.delete(c),m.set(k.uid,k)}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(k,m,g){this._graphicReferenceCount--;this.disable(k,m,g)}forEachMaterialInfo(k){this._fastTransformOriginalMaterials.forEach(k)}forEachClonedMaterial(k){this._fastTransformClonedMaterials.forEach(k)}destroy(k){k.removeMany(Array.from(this._fastTransformClonedMaterials.keys()));
k.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:m})=>m));this._fastTransformClonedMaterials.clear();this._fastTransformOriginalMaterials.clear()}}class h{constructor(){this._byUid=new Map;this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),k=>k.material)}byUid(k){return this._byUid.get(k)}byMaterial(k){return this._byMaterial.get(k)}set(k,m){this._byUid.set(k,m);this._byMaterial.set(m.material,m)}delete(k){const m=this._byMaterial.get(k)?.uid;
m&&(this._byUid.delete(m),this._byMaterial.delete(k))}has(k){return this._byUid.has(k)}forEachMaterialInfo(k){this._byUid.forEach(k)}clear(){this._byUid.clear();this._byMaterial.clear()}}a.MaterialInfoCache=h;a.MeshFastUpdateProcessor=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){class D extends x.Material{constructor(Q){super(Q,new A);this._configuration=new y.NativeLineTechniqueConfiguration;this.produces=new Map([[w.RenderSlot.OPAQUE_MATERIAL,V=>V===f.ShaderOutput.Color||V===f.ShaderOutput.Highlight||V===f.ShaderOutput.ObjectAndLayerIdColor]])}getConfiguration(Q){this._configuration.output=Q;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.hasOccludees=this.parameters.hasOccludees;return this._configuration}intersect(Q,V,U,W,ca,X){if(U.options.selectionMode&&Q.visible)if(p.isTranslationMatrix(V)){ca=Q.attributes.get(t.VertexAttribute.POSITION).data;var ba=U.camera,ia=M;k.copy(ia,U.point);m.set(S[0],ia[0]-2,ia[1]+2,0);m.set(S[1],ia[0]+2,ia[1]+2,0);m.set(S[2],ia[0]+2,ia[1]-2,0);m.set(S[3],ia[0]-2,ia[1]-2,0);for(Q=0;4>Q;Q++)if(!ba.unprojectFromRenderScreen(S[Q],
N[Q]))return;l.fromPoints(ba.eye,N[0],N[1],P);l.fromPoints(ba.eye,N[1],N[2],R);l.fromPoints(ba.eye,N[2],N[3],O);l.fromPoints(ba.eye,N[3],N[0],T);W=Number.MAX_VALUE;Q=0;for(let da=0;da<ca.length-5;da+=3)if(C[0]=ca[da]+V[12],C[1]=ca[da+1]+V[13],C[2]=ca[da+2]+V[14],E[0]=ca[da+3]+V[12],E[1]=ca[da+4]+V[13],E[2]=ca[da+5]+V[14],!(0>l.signedDistance(P,C)&&0>l.signedDistance(P,E)||0>l.signedDistance(R,C)&&0>l.signedDistance(R,E)||0>l.signedDistance(O,C)&&0>l.signedDistance(O,E)||0>l.signedDistance(T,C)&&0>
l.signedDistance(T,E))){ba.projectToRenderScreen(C,J);ba.projectToRenderScreen(E,B);if(0>J[2]&&0<B[2]){m.subtract(I,C,E);var fa=ba.frustum;fa=-l.signedDistance(fa[d.PlaneIndex.NEAR],C)/m.dot(I,l.getNormal(fa[d.PlaneIndex.NEAR]));m.scale(I,I,fa);m.add(C,C,I);ba.projectToRenderScreen(C,J)}else if(0<J[2]&&0>B[2])m.subtract(I,E,C),fa=ba.frustum,fa=-l.signedDistance(fa[d.PlaneIndex.NEAR],E)/m.dot(I,l.getNormal(fa[d.PlaneIndex.NEAR])),m.scale(I,I,fa),m.add(E,E,I),ba.projectToRenderScreen(E,B);else if(0>
J[2]&&0>B[2])continue;J[2]=0;B[2]=0;fa=c.distance2(c.fromPoints(J,B,L),ia);fa<W&&(W=fa,m.copy(z,C),m.copy(K,E),Q=da/3)}V=U.rayBegin;U=U.rayEnd;4>W&&(W=Number.MAX_VALUE,c.closestLineSegmentPoint(c.fromPoints(z,K,L),c.fromPoints(V,U,F),H)&&(m.subtract(H,H,V),W=m.length(H),m.scale(H,H,1/W),W/=m.distance(V,U)),X(W,H,Q,!1))}else b.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}intersectDraped(Q,V,U,W,ca,X){if(U.options.selectionMode){V=
Q.attributes.get(t.VertexAttribute.POSITION).data;var ba=Q.attributes.get(t.VertexAttribute.SIZE);U=W[0];W=W[1];Q=(((ba?ba.data[0]:0)+1)/2+4)*Q.screenToWorldRatio;ba=Number.MAX_VALUE;var ia=0;for(let ha=0;ha<V.length-5;ha+=3){var fa=V[ha],da=V[ha+1],aa=U-fa,ea=W-da;fa=V[ha+3]-fa;da=V[ha+4]-da;const Y=n.clamp((fa*aa+da*ea)/(fa*fa+da*da),0,1);aa=fa*Y-aa;ea=da*Y-ea;ea=aa*aa+ea*ea;ea<ba&&(ba=ea,ia=ha/3)}ba<Q*Q&&ca(X.dist,X.normal,ia,!1)}}createGLMaterial(Q){return new G(Q)}createBufferWriter(){return new q.DefaultBufferWriter(this.parameters.hasVertexColors?
u.PositionColorLayout:u.PositionLayout)}}class G extends r{_updateOccludeeState(Q){Q.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Q.hasOccludees})}beginSlot(Q){this._output===f.ShaderOutput.Color&&this._updateOccludeeState(Q);return this.ensureTechnique(v.NativeLineTechnique,Q)}}class A extends x.MaterialParameters{constructor(){super(...arguments);this.color=e.ONES;this.hasSlicePlane=this.hasVertexColors=!1;this.width=1;this.hasOccludees=!1}}const C=
g.create(),E=g.create(),I=g.create(),H=g.create(),J=h.createRenderScreenPointArray3(),B=h.createRenderScreenPointArray3(),z=g.create(),K=g.create(),L=c.create(),F=c.create(),M=g.create(),S=[h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3()],N=[g.create(),g.create(),g.create(),g.create()],P=l.create(),R=l.create(),O=l.create(),T=l.create();a.NativeLineMaterial=D;a.Parameters=A;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(a,b,n){const h=b.newLayout().vec3f(n.VertexAttribute.POSITION),k=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec2f(n.VertexAttribute.UV0),m=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec4u8(n.VertexAttribute.COLOR),g=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec4u8(n.VertexAttribute.OBJECTANDLAYERIDCOLOR),
e=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec2f(n.VertexAttribute.UV0).vec4u8(n.VertexAttribute.OBJECTANDLAYERIDCOLOR);b=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec4u8(n.VertexAttribute.COLOR).vec4u8(n.VertexAttribute.OBJECTANDLAYERIDCOLOR);a.PositionColorLayout=m;a.PositionColorLayoutObjectAndLayerId=b;a.PositionLayout=h;a.PositionLayoutObjectAndLayerId=g;a.PositionUVLayout=k;a.PositionUVLayoutObjectAndLayerId=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends k.ShaderTechnique{initializeProgram(r){return new g.Program(r.rctx,f.shader.get().build(this.configuration),m.Default3D)}initializePipeline(){const r=this.configuration,x=l.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),w=(p,t=null,q=null)=>l.makePipelineState({blending:t,depthTest:e.depthCompareLess,depthWrite:q,colorWrite:l.defaultColorWriteParams,stencilWrite:r.hasOccludees?
e.stencilWriteMaskOn:null,stencilTest:r.hasOccludees?p?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null});return r.output===n.ShaderOutput.Color?(this._occludeePipelineState=w(!0,r.transparent?x:null,l.defaultDepthWriteParams),w(!1,r.transparent?x:null,l.defaultDepthWriteParams)):w(!1)}get primitiveType(){return c.PrimitiveType.LINES}getPipeline(r){return r?this._occludeePipelineState:super.getPipeline()}}f.shader=new h.ReloadableShaderModule(d.NativeLine,()=>new Promise((r,x)=>a(["./NativeLine.glsl"],
r,x)));b.NativeLineTechnique=f;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(p){const t=new f.ShaderBuilder,{vertex:q,fragment:u}=t;t.include(h.Transform,p);t.include(k.VertexColor,p);e.addProjViewLocalOrigin(q,p);t.attributes.add(r.VertexAttribute.POSITION,"vec3");t.varyings.add("vpos","vec3");q.code.add(l.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);
}`);p.output===b.ShaderOutput.Highlight&&t.include(m.OutputHighlight,p);t.include(n.SliceDraw,p);u.uniforms.add(new c.FloatPassUniform("alphaCoverage",(v,y)=>Math.min(1,v.width*y.camera.pixelRatio)));p.hasVertexColors||u.uniforms.add(new d.Float4PassUniform("constantColor",v=>v.color));u.code.add(l.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${p.hasVertexColors?"vColor":"constantColor"};

    ${p.output===b.ShaderOutput.ObjectAndLayerIdColor?l.glsl`color.a = 1.0;`:""}

    if (color.a < ${l.glsl.float(g.symbolAlphaCutoff)}) {
      discard;
    }

    ${p.output===b.ShaderOutput.Color?l.glsl`fragColor = highlightSlice(color, vpos);`:""}
    ${p.output===b.ShaderOutput.Highlight?l.glsl`outputHighlight();`:""}
  }
  `);return t}const w=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.NativeLine=w;a.build=x})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,h,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=n.ShaderOutput.Color;this.hasOccludees=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([h.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],m.prototype,"hasVertexColors",void 0);b.__decorate([h.parameter()],m.prototype,"transparent",void 0);b.__decorate([h.parameter()],m.prototype,"hasOccludees",void 0);a.NativeLineTechniqueConfiguration=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/projection/computeTranslationToOriginAndRotation ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./defaultSymbolComplexity ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./SymbolComplexity ./webStyleUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N){class P{constructor(W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z){this.lodResources=W;this.lodRenderer=ca;this.stageResources=X;this.originalMaterialParameters=ba;this.resourceSize=ia;this.isEsriSymbolResource=fa;this.isWosr=da;this.resourceBoundingBox=aa;this.symbolSize=ea;this.extentPadding=ha;this.physicalBasedRenderingEnabled=Y;this.pivotOffset=Z}}class R extends y.Graphics3DSymbolLayer{getCachedSize(){const [W,ca,X]=null!=
this._resources?this._resources.symbolSize:[1,1,1];return{width:W,depth:ca,height:X}}constructor(W,ca,X,ba){super(W,ca,X,ba);this._resources=null;this._optionalFields=[];this._instanceIndexToGraphicUid=new Map;this._hasLoadedPBRTextures=!1;this._disposeResourceHandles=[];this.skipHighSymbolLodsChanged=!1;this.ensureDrapedStatus(!1);this._hasLoadedPBRTextures=X.physicalBasedRenderingEnabled}async doLoad(W){if(!this._drivenProperties.size&&D.validateSymbolLayerSize(this.symbolLayer))throw Error();if(this._isPrimitive){var ca=
this.symbolLayer.resource;ca=ca&&H.isValidPrimitive(ca.primitive)?ca.primitive:w.defaultPrimitive;this._resources=await this._createResourcesForPrimitive(ca,W)}else ca=(await B.getResourceUrlFromSymbolStyle(this.symbol.styleOrigin))?.href??this.symbolLayer.resource.href,this._resources=await this._createResourcesForUrl(ca,W);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()}get extentPadding(){return null!=this._resources?
this._resources.extentPadding:0}get _isPrimitive(){return!this.symbolLayer.resource?.href}get lodRenderer(){return this._resources?.lodRenderer}get materials(){return this._resources?.stageResources.materials??[]}_setMaterialTransparencyParameters(W,ca=this.symbolLayer?.material?.color){ca=this._getCombinedOpacity(ca);const X=1>ca||this.needsDrivenTransparentPass;W.transparent=X;W.opacity=ca;W.cullFace=X?K.CullFaceOptions.None:K.CullFaceOptions.Back;return W}async _createResourcesForPrimitive(W,ca){var X=
this.symbolLayer;const ba=x.create(p.objectSymbolLayerPrimitiveBoundingBox(W)),ia=c.fromArray(x.size(ba)),fa=c.fromArray(p.objectSymbolLayerSizeWithResourceSize(ia,X)),da=d.length(fa);var aa={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...N.defaultSchematicMRRFactors],ambient:c.ONES,diffuse:c.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ea=
!!aa.usePBR;this._setMaterialTransparencyParameters(aa);const ha=this.symbol;if("point-3d"===ha.type&&ha.verticalOffset){const {screenLength:Y,minWorldLength:Z,maxWorldLength:ja}=ha.verticalOffset;aa.verticalOffset={screenLength:k.pt2px(Y),minWorldLength:Z||0,maxWorldLength:null!=ja?ja:Infinity};aa.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(aa.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?aa.externalColor=l.ONES:(X=
null!=X.material?X.material.color:null,X=null!=X?b.toUnitRGBA(X):l.ONES,aa.externalColor=X);this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(ba,fa,ia,null));aa.isInstanced=!0;this._fastUpdates?(Object.assign(aa,this._fastUpdates.materialParameters),this._optionalFields.push(L.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(aa.hasInstancedColor=!0,this._optionalFields.push(L.VertexAttribute.COLOR));n("enable-feature:objectAndLayerId-rendering")&&
this._optionalFields.push(L.VertexAttribute.OBJECTANDLAYERIDCOLOR);aa=new S.DefaultMaterial(aa);aa=H.primitiveLodResources(W,aa);if(!aa)throw Error(`Unknown object symbol primitive: ${W}`);W=M.materialsFromLodResources(aa).map(Y=>({opacity:1,transparent:Y.parameters.transparent}));X=await this._createStageResources(aa,ea,ca);ca=await this._createLodRenderer(aa,ca);return new P(aa,ca,X,W,ia,!1,!1,ba,fa,da,ea,null)}async _createResourcesForUrl(W,ca){var X={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};(this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)))?(Object.assign(X.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(L.VertexAttribute.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(X.materialParameters.hasInstancedColor=!0,this._optionalFields.push(L.VertexAttribute.COLOR));
n("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(L.VertexAttribute.OBJECTANDLAYERIDCOLOR);var ba=this.symbol;if("point-3d"===ba.type&&ba.verticalOffset){const {screenLength:Ca,minWorldLength:ma,maxWorldLength:wa}=ba.verticalOffset;X.materialParameters.verticalOffset={screenLength:k.pt2px(Ca),minWorldLength:ma||0,maxWorldLength:null!=wa?wa:Infinity};X.materialParameters.castShadows=!1}ba=this._context.physicalBasedRenderingEnabled;X.signal=ca;X.usePBR=ba;X.skipHighLods=this._context.skipHighSymbolLods;
var ia=await E.fetch(W,X);W=ia.isEsriSymbolResource;X=ia.isWosr;const fa=C.makeLodResources(ia.lods),da=this._context,aa=this._getExternalColorParameters(this.symbolLayer.material),ea=this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:!0}),ha=this.needsDrivenTransparentPass;var Y=M.materialsFromLodResources(fa);const Z=M.materialsFromLodResources(fa).map(Ca=>({opacity:Ca.parameters.opacity||1,transparent:Ca.parameters.transparent}));Y.forEach(Ca=>{const ma=Ca.parameters;
Ca.setParameters(aa);const wa=ma.opacity*ea;Ca.setParameters({opacity:wa,transparent:1>wa||ha||ma.transparent});da.screenSizePerspectiveEnabled&&Ca.setParameters({screenSizePerspective:da.sharedResources.screenSizePerspectiveSettings})});ia=ia.referenceBoundingBox;const ja=c.fromArray(x.size(ia)),oa=c.fromArray(fa.levels[0].pivotOffset),qa=c.fromArray(p.objectSymbolLayerSizeWithResourceSize(ja,this.symbolLayer)),ta=d.length(qa),va=this._fastUpdates;z.updateFastSymbolUpdatesState(va,this._context.renderer,
this._fastVisualVariableConvertOptions(ia,qa,ja,oa))&&Y.forEach(Ca=>Ca.setParameters(va.materialParameters));Y=await this._createStageResources(fa,ba,ca);ca=await this._createLodRenderer(fa,ca);return new P(fa,ca,Y,Z,ja,W,X,ia,qa,ta,ba,oa)}_addDisposeResource(W){this._disposeResourceHandles.push(W)}async _createStageResources(W,ca,X){const ba=this._context.stage,ia=M.materialsFromLodResources(W);ca!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();ba.addMany(ia);
this._addDisposeResource(()=>ba.removeMany(ia));const fa=M.texturesFromLodResources(W);ba.addMany(fa);this._addDisposeResource(()=>{fa.forEach(aa=>aa.unload());ba.removeMany(fa)});await Promise.all(fa.map(aa=>this._context.stage.schedule(()=>aa.load(ba.renderView.renderingContext),X)));h.throwIfAborted(X);const da=M.geometriesFromLodResources(W);ba.addMany(da);this._addDisposeResource(()=>ba.removeMany(da));return{materials:ia,textures:fa,geometries:da}}async _createLodRenderer(W,ca){const X=this._context.stage,
ba=this._fastUpdates,ia=new F.LodRenderer({symbol:W,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:fa=>this._instanceIndexToGraphicUid.get(fa),notifyGraphicGeometryChanged:fa=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(fa)),notifyGraphicVisibilityChanged:fa=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(fa))},shaderTransformation:ba?{applyTransform:(fa,da,aa)=>{fa.getFeatureAttribute(da,
V);g.copy(aa,z.evaluateModelTransform(ba.materialParameters,V,aa))},scaleFactor:(fa,da,aa)=>{da.getFeatureAttribute(aa,V);z.evaluateModelTransformScale(fa,ba.materialParameters,V)}}:null},this._context.scheduler);ia.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{X.removeRenderPlugin(ia);ia.destroy()});await X.addRenderPlugin(ia,ca);return ia}_getExternalColorParameters(W){const ca={};this._drivenProperties.color?ca.externalColor=l.ONES:null!=W?.color?ca.externalColor=
b.toUnitRGBA(W.color):(ca.externalColor=l.ONES,ca.colorMixMode="ignore");return ca}destroy(){super.destroy();this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(W=>W());this._disposeResourceHandles.length=0;this._resources=null}createGraphics3DGraphic(W){const ca=W.graphic;if(!this._validateGeometry(ca.geometry))return null;const X=I.placePointOnGeometry(ca.geometry);if(null==X)return this.logger.warn(`unsupported geometry type for icon symbol: ${ca.geometry.type}`),
null;const ba=this.setGraphicElevationContext(ca);return this._createAs3DShape(ca,X,W.renderingInfo,ba,ca.uid,W.layer.uid)}notifyDestroyGraphicLayer(W){this._instanceIndexToGraphicUid.delete(W.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(null!=this._resources){var W=this._drivenProperties.opacity,ca=!this._isPrimitive,X=this._resources.stageResources.materials,ba=this._resources.originalMaterialParameters;for(let fa=0;fa<X.length;fa++){const da=X[fa];var ia=ba[fa];const aa=
this._getCombinedOpacity(this.symbolLayer?.material?.color,{hasIntrinsicColor:ca})*ia.opacity;ia=1>aa||W||ia.transparent;da.setParameters({opacity:aa,transparent:ia});this._isPrimitive&&da.setParameters({cullFace:ia?K.CullFaceOptions.None:K.CullFaceOptions.Back})}}}layerElevationInfoChanged(W,ca){return this.updateGraphics3DGraphicElevationInfo(W,ca,u.needsElevationUpdates3D)}slicePlaneEnabledChanged(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;
for(const W of this._resources.stageResources.materials)W.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(null==this._resources)return!0;const {stageResources:W,isWosr:ca}=this._resources;for(const X of W.materials)this._isPrimitive?X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):ca||X.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&
!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0}applyRendererDiff(W,ca){if(null==this._resources)return G.ApplyRendererDiffResult.RecreateSymbol;const {stageResources:{materials:X},lodRenderer:ba,resourceBoundingBox:ia,symbolSize:fa,resourceSize:da,pivotOffset:aa}=this._resources;for(const ea in W.diff)switch(ea){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,ca,this._fastVisualVariableConvertOptions(ia,fa,da,aa))){for(const ha of X)ha.setParameters(this._fastUpdates.materialParameters);
ba.notifyShaderTransformationChanged()}else return G.ApplyRendererDiffResult.RecreateSymbol;break;default:return G.ApplyRendererDiffResult.RecreateSymbol}return G.ApplyRendererDiffResult.FastUpdate}computeComplexity(){if(null==this._resources)return super.computeComplexity();var W=this._resources.lodResources;const ca=t.estimateNumVerticesForLods(W.levels),X=ia=>Array.from(ia.attributes.values()).reduce((fa,da)=>fa+m.estimateSize(da.data,da.indices),0),ba=M.geometriesFromLodResources(W).reduce((ia,
fa)=>ia+X(fa),0);W=M.texturesFromLodResources(W).reduce((ia,fa)=>ia+fa.memoryEstimate,0)+ba;W={...t.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:W};return new J.SymbolComplexity({verticesPerFeature:ca,memory:W})}_hasLodRenderer(){return null!=this._resources}_createAs3DShape(W,ca,X,ba,ia,fa){if(!this._hasLodRenderer()||null==this._resources)return null;W=this.getFastUpdateAttrValues(W);var da=this._context.clippingExtent;r.projectPointToVector(ca,O,this._context.elevationProvider.spatialReference);
if(null!=da&&!x.containsPoint(da,O))return null;da=this._requiresTerrainElevation(ba);const aa=this._computeGlobalTransform(ca,ba,Q,U),ea=this._computeLocalTransform(this._resources,this.symbolLayer,X,T),ha=this._resources.lodRenderer.instanceData,Y=ha.addInstance();this._instanceIndexToGraphicUid.set(Y,ia);ha.setLocalTransform(Y,ea,!1);ha.setGlobalTransform(Y,aa);W&&ha.setFeatureAttribute(Y,W);null==this._fastUpdates&&this._hasPerInstanceColor()&&ha.setColor(Y,D.mixinColorAndOpacity(X.color,X.opacity,
255));null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&ha.setObjectAndLayerIdColor(Y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ia,layerUid:fa}));X=new v.Graphics3DLodInstanceGraphicLayer(this,Y,q.perLodInstanceElevationAligner,ba);da&&(X.alignedSampledElevation=U.sampledElevation);X.needsElevationUpdates=u.needsElevationUpdates3D(ba.mode);I.extendPointGraphicElevationContext(X,ca,this._context.elevationProvider);return X}_computeGlobalTransform(W,
ca,X,ba){u.evaluateElevationInfoAtPoint(W,this._context.elevationProvider,ca,this._context.renderCoordsHelper,ba);O[0]=W.x;O[1]=W.y;O[2]=ba.z;f.computeTranslationToOriginAndRotation(W.spatialReference,O,X,this._context.renderCoordsHelper.spatialReference);return X}_computeLocalTransform(W,ca,X,ba){g.identity(ba);this._applyObjectRotation(X,!1,ba);this._applyObjectRotation(ca,!0,ba);this._applyObjectScale(W,X,ba);this._applyAnchor(W,ca,ba);return ba}_applyObjectScale(W,ca,X){this._fastUpdates?.requiresShaderTransformation||
(W=D.computeObjectScale(this._drivenProperties.size&&ca.size?ca.size:W.symbolSize,W.symbolSize,W.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===W[0]&&1===W[1]&&1===W[2]||g.scale(X,X,W))}prepareSymbolLayerPatch(W){if("partial"===W.diff.type){var ca=W.diff.diff;this._preparePatchTransform(W,ca);this._preparePatchColor(W,ca)}}updateGeometry(W,ca){if(null==this._resources)return!0;const X=ca&&I.placePointOnGeometry(ca);if(null==X)return!1;ca=this.getGeometryElevationMode(ca);if(W.elevationContext.mode!==
ca)return!1;this._computeGlobalTransform(X,W.elevationContext,Q,U);this._requiresTerrainElevation(W.elevationContext)&&(W.alignedSampledElevation=U.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(W.instanceIndex,Q,!0);I.extendPointGraphicElevationContext(W,X,this._context.elevationProvider);return!0}_preparePatchTransform(W,ca){if((ca.heading||ca.tilt||ca.roll||ca.width||ca.height||ca.depth||ca.anchor||ca.anchorPosition)&&null!=this._resources){var X=(ja,oa,qa)=>(null!=
ja&&"complete"===ja.type?ja.newValue:oa)??qa,ba=X(ca.heading,this.symbolLayer.heading,0),ia=X(ca.tilt,this.symbolLayer.tilt,0),fa=X(ca.roll,this.symbolLayer.roll,0),da=X(ca.width,this.symbolLayer.width,void 0),aa=X(ca.height,this.symbolLayer.height,void 0),ea=X(ca.depth,this.symbolLayer.depth,void 0),ha=X(ca.anchor,this.symbolLayer.anchor,void 0);X=X(ca.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete ca.heading;delete ca.tilt;delete ca.roll;delete ca.width;delete ca.height;delete ca.depth;
delete ca.anchor;delete ca.anchorPosition;var Y={heading:ba,tilt:ia,roll:fa,anchor:ha,anchorPosition:X},Z=this._resources;this.loadStatus===A.LoadStatus.LOADED&&W.symbolLayerStatePatches.push(()=>{Z.symbolSize=c.fromArray(p.objectSymbolLayerSizeWithResourceSize(Z.resourceSize,{width:da,height:aa,depth:ea,isPrimitive:this.symbolLayer.isPrimitive}))});W.graphics3DGraphicPatches.push((ja,oa)=>{oa=this._computeLocalTransform(Z,Y,oa,T);Z.lodRenderer.instanceData.setLocalTransform(ja.instanceIndex,oa,!0)})}}_preparePatchColor(W,
ca){if(ca.material&&"partial"===ca.material.type&&(ca=ca.material.diff,ca.color&&"complete"===ca.color.type&&null!=ca.color.newValue&&null!=ca.color.oldValue)){var X=ca.color.newValue,ba=null!=X?b.toUnitRGBA(X):l.ONES;delete ca.color;var ia=this._resources;null!=ia&&W.graphics3DGraphicPatches.push(fa=>{this._hasPerInstanceColor()?(ia.lodRenderer.instanceData.setColor(fa.instanceIndex,ba),fa=this._setMaterialTransparencyParameters({},X)):fa=this._setMaterialTransparencyParameters({externalColor:ba},
X);for(const da of ia.stageResources.materials)da.setParameters(fa)})}}_requiresTerrainElevation(W){return"absolute-height"!==W.mode}_applyObjectRotation(W,ca,X){if(!this._fastUpdates?.requiresShaderTransformation||!ca)return D.computeObjectRotation(W.heading,W.tilt,W.roll,X)}_computeAnchor(W,ca,X){const ba=c.create();switch(X.anchor){case "center":d.copy(ba,x.center(W));d.negate(ba,ba);break;case "top":ca=x.center(W);d.set(ba,-ca[0],-ca[1],-W[5]);break;case "bottom":ca=x.center(W);d.set(ba,-ca[0],
-ca[1],-W[2]);break;case "relative":ca=x.center(W);W=x.size(W);X=(X=X.anchorPosition)?c.fromValues(X.x,X.y,X.z):c.ZEROS;d.multiply(ba,W,X);d.add(ba,ba,ca);d.negate(ba,ba);break;default:null!=ca?d.negate(ba,ca):d.copy(ba,c.ZEROS)}return ba}_applyAnchor(W,ca,X){this._fastUpdates?.requiresShaderTransformation||(W=this._computeAnchor(W.resourceBoundingBox,W.pivotOffset,ca))&&g.translate(X,X,W)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(W,
ca,X,ba){const ia=null!=W?c.fromArray(x.size(W)):c.ONES;W=null!=W?this._computeAnchor(W,ba,this.symbolLayer):c.ZEROS;ba=this._context.renderCoordsHelper.unitInMeters;X=D.computeObjectScale(null!=ca?ca:void 0,ca,X,ba);const fa=c.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new z.ConvertOptions({size:!0,color:!0,rotation:!0,opacity:!1},ia,ca??c.ONES,ba,W,X,fa)}}const O=c.create(),T=e.create(),Q=e.create(),V=l.create(),U=new u.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=
R;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),function(a,
b,n,h,k,m,g,e,d,c){class l{constructor(t,q,u,v){this.graphics3DSymbolLayer=t;this.instanceIndex=q;this.elevationAligner=u;this.elevationContext=v;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}initialize(){}setVisibility(t){const q=this._lodRenderer.instanceData;t!==q.getVisible(this.instanceIndex)&&q.setVisible(this.instanceIndex,t)}destroy(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),
this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,q,u){this.elevationAligner&&(g.setContextFeature(this.elevationContext.featureExpressionInfoContext,u),u=this.elevationAligner(this,this.elevationContext,t.spatialReference,(v,y)=>m.evaluateElevationInfoAtPoint(v,t,this.elevationContext,q,y),q),null!=u&&(this.alignedSampledElevation=u))}getCenterObjectSpace(t=h.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,p);return n.transformMat4(t,
this._lodRenderer.baseBoundingSphere.center,p)}getBoundingBoxObjectSpace(t=k.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,p);const q=this._lodRenderer.baseBoundingBox;k.empty(t);for(let u=0;8>u;++u)n.set(r,0===(u&1)?q[0]:q[3],0===(u&2)?q[1]:q[4],0===(u&4)?q[2]:q[5]),n.transformMat4(r,r,p),k.expandWithVec3(t,r);return t}computeAttachmentOrigin(t){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,p);t.render.origin[0]+=p[12];t.render.origin[1]+=
p[13];t.render.origin[2]+=p[14];t.render.num++}async getProjectedBoundingBox(t,q,u,v,y){y=this.getBoundingBoxObjectSpace(y);var D=w;const G=k.isPoint(y)?1:D.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,p);for(var A=0;A<G;A++){const C=D[A];r[0]=y[C[0]];r[1]=y[C[1]];r[2]=y[C[2]];n.transformMat4(r,r,p);f[3*A]=r[0];f[3*A+1]=r[1];f[3*A+2]=r[2]}if(!t(f,0,G))return null;k.empty(y);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(D=0;D<
3*G;D+=3){for(A=0;3>A;A++)y[A]=Math.min(y[A],f[D+A]),y[A+3]=Math.max(y[A+3],f[D+A]);t&&u.push({location:f.slice(D,D+3),screenSpaceBoundingRect:t})}if(q&&(k.center(y,x),"absolute-height"!==this.elevationContext.mode)){let C;u=e.demResolutionForBoundingBox(y,q.service.spatialReference,q);try{C=await q.service.queryElevation(x[0],x[1],v,u,"ground")}catch(E){}null!=C&&k.offset(y,0,0,-this.alignedSampledElevation+C)}return y}addObjectState(t,q){t===d.Object3DState.Highlight&&(t=new c.Object3DStateID(t),
this._addHighlightId(t),q.addExternal(u=>{this._removeHighlightId(u)},t))}removeObjectState(t){this._highlights.forEach(q=>t.remove(q))}_addHighlightId(t){this._highlights.add(t);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this._highlights.size)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],r=h.create(),x=h.create(),w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],p=b.create();a.Graphics3DLodInstanceGraphicLayer=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function n(k,m){const g=k.stageResources.geometries.map(e=>new b.LodComponentResources(e,k.stageResources.textures));m=null==k.lodThreshold||0===
k.lodThreshold&&0<m?h(g):k.lodThreshold;return new b.LodLevelResources(g,m,k.pivotOffset)}function h(k){k=k.reduce((m,{geometry:g})=>m+g.indexCount/3,0);return Math.sqrt(20*k/Math.PI)}a.makeLodResources=function(k){return new b.LodResources(k.map((m,g)=>n(m,g)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/devEnvironmentUtils ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/FloatArray ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec2 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../webgl-engine/materials/pbrUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L){function F(P){const R=P.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return R?{fileType:"gltf",url:R[1],specifiedLodIndex:null!=R[4]?Number(R[4]):null}:P.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:P,specifiedLodIndex:null}:{fileType:"unknown",url:P,specifiedLodIndex:null}}function M(P,R,O,T){const Q=P.model,V=[],U=new Map,W=new Map,ca=Q.lods.length,X=c.empty();Q.lods.forEach((ba,ia)=>{const fa=!0===T.skipHighLods&&
(1<ca&&0===ia||3<ca&&1===ia)||!1===T.skipHighLods&&null!=T.singleLodIndex&&ia!==T.singleLodIndex;if(!fa||0===ia){var da=new G.ProcessedObjectResource(ba.name,ba.lodThreshold,[0,0,0]);ba.parts.forEach(aa=>{const ea=fa?new z.DefaultMaterial({}):S(Q,aa,da,R,O,U,W);var ha=null!=ea?ea:new z.DefaultMaterial({});const Y=aa.attributes.position.count,Z=v.convertPrimitiveToTriangles(aa.indices||Y,aa.primitiveType);var ja=l.newFloatArray(3*Y);const {typedBuffer:oa,typedBufferStride:qa}=aa.attributes.position;
r.transformMat4(ja,oa,aa.transform,3,qa);ja=[[B.VertexAttribute.POSITION,new E.Attribute(ja,Z,3,!0)]];if(null!=aa.attributes.normal){var ta=l.newFloatArray(3*Y);const {typedBuffer:ma,typedBufferStride:wa}=aa.attributes.normal;n.normalFromMat4(N,aa.transform);r.transformMat3(ta,ma,N,3,wa);ja.push([B.VertexAttribute.NORMAL,new E.Attribute(ta,Z,3,!0)])}if(null!=aa.attributes.tangent){ta=l.newFloatArray(4*Y);const {typedBuffer:ma,typedBufferStride:wa}=aa.attributes.tangent;n.normalFromMat4(N,aa.transform);
x.transformMat3(ta,ma,N,4,wa);ja.push([B.VertexAttribute.TANGENT,new E.Attribute(ta,Z,4,!0)])}if(null!=aa.attributes.texCoord0){ta=l.newFloatArray(2*Y);const {typedBuffer:ma,typedBufferStride:wa}=aa.attributes.texCoord0;w.normalizeIntegerBuffer(ta,ma,2,wa);ja.push([B.VertexAttribute.UV0,new E.Attribute(ta,Z,2,!0)])}null!=aa.attributes.color&&(ta=new Uint8Array(4*Y),4===aa.attributes.color.elementCount?aa.attributes.color instanceof f.BufferViewVec4f?x.scale(ta,aa.attributes.color,255):aa.attributes.color instanceof
f.BufferViewVec4u8?t.copy(ta,aa.attributes.color):aa.attributes.color instanceof f.BufferViewVec4u16&&x.scale(ta,aa.attributes.color,1/256):(ta.fill(255),aa.attributes.color instanceof f.BufferViewVec3f?r.scale(ta,aa.attributes.color,255,4):aa.attributes.color instanceof f.BufferViewVec3u8?p.copy(ta,aa.attributes.color.typedBuffer,4,aa.attributes.color.typedBufferStride):aa.attributes.color instanceof f.BufferViewVec3u16&&r.scale(ta,aa.attributes.color,1/256,4)),ja.push([B.VertexAttribute.COLOR,new E.Attribute(ta,
Z,4,!0)]));aa={geometry:new H.Geometry(ha,ja),vertexCount:Y};const {geometry:va,vertexCount:Ca}=aa;aa=va.boundingInfo;null!=aa&&0===ia&&(c.expandWithVec3(X,aa.bbMin),c.expandWithVec3(X,aa.bbMax));null!=ea&&(da.stageResources.geometries.push(va),da.numberOfVertices+=Ca)});fa||V.push(da)}});return{engineResources:V,referenceBoundingBox:X}}function S(P,R,O,T,Q,V,U){const W=R.material+(R.attributes.normal?"_normal":"")+(R.attributes.color?"_color":"")+(R.attributes.texCoord0?"_texCoord0":"")+(R.attributes.tangent?
"_tangent":""),ca=P.materials.get(R.material);var X=null!=R.attributes.texCoord0;const ba=null!=R.attributes.normal;if(null==ca)return null;a:{switch(ca.alphaMode){case "BLEND":var ia=I.AlphaDiscardMode.Blend;break a;case "MASK":ia=I.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ia=I.AlphaDiscardMode.Opaque;break a}ia=void 0}if(!V.has(W)){if(X){var fa=(qa,ta=!1)=>{if(null!=qa&&!U.has(qa)){const va=P.textures.get(qa);if(null!=va){const Ca=va.data;U.set(qa,new J.Texture(y.isEncodedMeshTexture(Ca)?
Ca.data:Ca,{...va.parameters,preMultiplyAlpha:y.isEncodedMeshTexture(Ca)?!1:ta,encoding:y.isEncodedMeshTexture(Ca)&&null!=Ca.encoding?Ca.encoding:void 0}))}}};fa(ca.textureColor,ia!==I.AlphaDiscardMode.Opaque);fa(ca.textureNormal);fa(ca.textureOcclusion);fa(ca.textureEmissive);fa(ca.textureMetallicRoughness)}fa=ca.color[0]**(1/K.colorGamma);const da=ca.color[1]**(1/K.colorGamma),aa=ca.color[2]**(1/K.colorGamma),ea=ca.emissiveFactor[0]**(1/K.colorGamma),ha=ca.emissiveFactor[1]**(1/K.colorGamma),Y=
ca.emissiveFactor[2]**(1/K.colorGamma),Z=null!=ca.textureColor&&X?U.get(ca.textureColor):null,ja=L.useSchematicPBR({normalTexture:ca.textureNormal,metallicRoughnessTexture:ca.textureMetallicRoughness,metallicFactor:ca.metallicFactor,roughnessFactor:ca.roughnessFactor,emissiveTexture:ca.textureEmissive,emissiveFactor:ca.emissiveFactor,occlusionTexture:ca.textureOcclusion}),oa=null!=ca.normalTextureTransform?.scale?ca.normalTextureTransform?.scale:g.ONES;V.set(W,new z.DefaultMaterial({...T,transparent:ia===
I.AlphaDiscardMode.Blend,customDepthTest:I.DepthTestFunction.Lequal,textureAlphaMode:ia,textureAlphaCutoff:ca.alphaCutoff,diffuse:[fa,da,aa],ambient:[fa,da,aa],opacity:ca.opacity,doubleSided:ca.doubleSided,doubleSidedType:"winding-order",cullFace:ca.doubleSided?I.CullFaceOptions.None:I.CullFaceOptions.Back,hasVertexColors:!!R.attributes.color,hasVertexTangents:!!R.attributes.tangent,normalType:ba?C.NormalType.Attribute:C.NormalType.ScreenDerivative,castShadows:!0,receiveShadows:ca.receiveShadows,
receiveAmbientOcclusion:ca.receiveAmbientOcclustion,textureId:null!=Z?Z.id:void 0,colorMixMode:ca.colorMixMode,normalTextureId:null!=ca.textureNormal&&X?U.get(ca.textureNormal).id:void 0,textureAlphaPremultiplied:null!=Z&&!!Z.parameters.preMultiplyAlpha,occlusionTextureId:null!=ca.textureOcclusion&&X?U.get(ca.textureOcclusion).id:void 0,emissiveTextureId:null!=ca.textureEmissive&&X?U.get(ca.textureEmissive).id:void 0,metallicRoughnessTextureId:null!=ca.textureMetallicRoughness&&X?U.get(ca.textureMetallicRoughness).id:
void 0,emissiveFactor:[ea,ha,Y],mrrFactors:ja?[...L.defaultSchematicMRRFactors]:[ca.metallicFactor,ca.roughnessFactor,T.mrrFactors[2]],isSchematic:ja,colorTextureTransformMatrix:D.getTransformMatrix(ca.colorTextureTransform),normalTextureTransformMatrix:D.getTransformMatrix(ca.normalTextureTransform),scale:[oa[0],oa[1]],occlusionTextureTransformMatrix:D.getTransformMatrix(ca.occlusionTextureTransform),emissiveTextureTransformMatrix:D.getTransformMatrix(ca.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:D.getTransformMatrix(ca.metallicRoughnessTextureTransform),
...Q}))}R=V.get(W);O.stageResources.materials.push(R);X&&(X=da=>{null!=da&&O.stageResources.textures.push(U.get(da))},X(ca.textureColor),X(ca.textureNormal),X(ca.textureOcclusion),X(ca.textureEmissive),X(ca.textureMetallicRoughness));return R}const N=h.create();a.fetch=async function(P,R){P=F(b.adjustStaticAGOUrl(P));if("wosr"===P.fileType){P=await (R.cache?R.cache.loadWOSR(P.url,R):A.load(P.url,R));const {engineResources:ba,referenceBoundingBox:ia}=A.processLoadResult(P,R);return{lods:ba,referenceBoundingBox:ia,
isEsriSymbolResource:!1,isWosr:!0}}const O=await (R.cache?R.cache.loadGLTF(P.url,R,!!R.usePBR):u.loadGLTF(new q.DefaultLoadingContext(R.streamDataRequester),P.url,R,R.usePBR)),T=O.model.meta?.ESRI_proxyEllipsoid,Q=O.meta.isEsriSymbolResource&&null!=T&&"EsriRealisticTreesStyle"===O.meta.ESRI_webstyle;if(Q&&!O.customMeta.esriTreeRendering){O.customMeta.esriTreeRendering=!0;a:for(let ba=0;ba<O.model.lods.length;++ba){var V=O.model.lods[ba];for(var U of V.parts){V=U.attributes.normal;if(null==V)break a;
const ia=U.attributes.position,fa=ia.count,da=d.create(),aa=d.create(),ea=d.create(),ha=new Uint8Array(4*fa),Y=new Float64Array(3*fa),Z=k.invert(m.create(),U.transform);let ja=0,oa=0;for(let qa=0;qa<fa;qa++){ia.getVec(qa,aa);V.getVec(qa,da);e.transformMat4(aa,aa,U.transform);e.subtract(ea,aa,T.center);e.divide(ea,ea,T.radius);const ta=ea[2];var W=e.length(ea);W=Math.min(.45+.55*W*W,1);e.divide(ea,ea,T.radius);null!==Z&&e.transformMat4(ea,ea,Z);e.normalize(ea,ea);ba+1!==O.model.lods.length&&1<O.model.lods.length&&
(-1<ta?e.lerp(ea,ea,da,.2):e.lerp(ea,ea,da,Math.min(-4*ta-3.8,1)));Y[ja]=ea[0];Y[ja+1]=ea[1];Y[ja+2]=ea[2];ja+=3;ha[oa]=255*W;ha[oa+1]=255*W;ha[oa+2]=255*W;ha[oa+3]=255;oa+=4}U.attributes.normal=new f.BufferViewVec3f(Y);U.attributes.color=new f.BufferViewVec4u8(ha)}}}U=!!R.usePBR;U=O.meta.isEsriSymbolResource?{usePBR:U,isSchematic:!1,treeRendering:Q,mrrFactors:[...L.defaultEsriSymbologyMRRFactors]}:{usePBR:U,isSchematic:!1,treeRendering:!1,mrrFactors:[...L.defaultAdvancedMRRFactors]};const {engineResources:ca,
referenceBoundingBox:X}=M(O,U,{...R.materialParameters,treeRendering:Q},R.skipHighLods&&null==P.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:P.specifiedLodIndex});return{lods:ca,referenceBoundingBox:X,isEsriSymbolResource:O.meta.isEsriSymbolResource,isWosr:!1}};a.gltfToEngineResources=M;a.parseUrl=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const b=/^devext.arcgis.com$/,n=/^qaext.arcgis.com$/,
h=/^[\w-]*\.mapsdevext.arcgis.com$/,k=/^[\w-]*\.mapsqa.arcgis.com$/,m=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,n,/^jsapps.esri.com$/,h,k];a.adjustStaticAGOUrl=function(g,e){return g?(e=e||globalThis.location.hostname)?null!=e.match(b)||null!=e.match(h)?g.replace("static.arcgis.com","staticdev.arcgis.com"):null!=e.match(n)||null!=e.match(k)?g.replace("static.arcgis.com","staticqa.arcgis.com"):g:g:g};a.devHostnames=m;a.isDevEnvironment=function(g){g=g||globalThis.location.hostname;return m.some(e=>
null!=g?.match(e))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec4":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function n(c,l,f){if(c.count!==l.count)b.getMathLogger().error("source and destination buffers need to have the same number of elements");else{var r=c.count,x=f[0],w=f[1],p=f[2],t=f[3],q=f[4],u=f[5],v=f[6],y=f[7],D=f[8],G=f[9],A=f[10],C=f[11],E=f[12],I=f[13],H=f[14];f=f[15];var J=c.typedBuffer;c=c.typedBufferStride;
var B=l.typedBuffer;l=l.typedBufferStride;for(let K=0;K<r;K++){const L=K*c;var z=K*l;const F=B[z],M=B[z+1],S=B[z+2];z=B[z+3];J[L]=x*F+q*M+D*S+E*z;J[L+1]=w*F+u*M+G*S+I*z;J[L+2]=p*F+v*M+A*S+H*z;J[L+3]=t*F+y*M+C*S+f*z}}}function h(c,l,f){k(c.typedBuffer,l.typedBuffer,f,c.typedBufferStride,l.typedBufferStride)}function k(c,l,f,r=4,x=r){if(c.length/r!==l.length/x)b.getMathLogger().error("source and destination buffers need to have the same number of elements");else{var w=c.length/r,p=f[0],t=f[1],q=f[2],
u=f[3],v=f[4],y=f[5],D=f[6],G=f[7];f=f[8];var A=0,C=0;for(let E=0;E<w;E++){const I=l[A],H=l[A+1],J=l[A+2],B=l[A+3];c[C]=p*I+u*H+D*J;c[C+1]=t*I+v*H+G*J;c[C+2]=q*I+y*H+f*J;c[C+3]=B;A+=x;C+=r}}}function m(c,l){const f=Math.min(c.count,l.count),r=c.typedBuffer;c=c.typedBufferStride;const x=l.typedBuffer;l=l.typedBufferStride;for(let t=0;t<f;t++){const q=t*c;var w=t*l;const u=x[w],v=x[w+1];w=x[w+2];var p=u*u+v*v+w*w;0<p&&(p=1/Math.sqrt(p),r[q]=p*u,r[q+1]=p*v,r[q+2]=p*w)}}function g(c,l,f){e(c.typedBuffer,
l,f,c.typedBufferStride)}function e(c,l,f,r=4){const x=Math.min(c.length/r,l.count),w=l.typedBuffer;l=l.typedBufferStride;let p=0,t=0;for(let q=0;q<x;q++)c[t]=f*w[p],c[t+1]=f*w[p+1],c[t+2]=f*w[p+2],c[t+3]=f*w[p+3],p+=l,t+=r}const d=Object.freeze(Object.defineProperty({__proto__:null,normalize:m,scale:e,scaleView:g,transformMat3:k,transformMat3View:h,transformMat4:n},Symbol.toStringTag,{value:"Module"}));a.normalize=m;a.scale=e;a.scaleView=g;a.transformMat3=k;a.transformMat3View=h;a.transformMat4=
n;a.vec4=d})},"esri/chunks/vec2":function(){define(["exports","../core/typedArrayUtil"],function(a,b){function n(g,e){h(g.typedBuffer,e.typedBuffer,g.typedBufferStride,e.typedBufferStride)}function h(g,e,d=2,c=d){const l=e.length/2;let f=0,r=0;if(b.isArray(e)||b.isFloat(e))for(var x=0;x<l;++x)g[f]=e[r],g[f+1]=e[r+1],f+=d,r+=c;else if(x=b.maximumValue(e),b.isSigned(e))for(var w=0;w<l;++w)g[f]=Math.max(e[r]/x,-1),g[f+1]=Math.max(e[r+1]/x,-1),f+=d,r+=c;else for(w=0;w<l;++w)g[f]=e[r]/x,g[f+1]=e[r+1]/
x,f+=d,r+=c}function k(g,e,d,c){const l=g.typedBuffer,f=g.typedBufferStride;g=c?.count??g.count;c=(c?.dstIndex??0)*f;for(let r=0;r<g;++r)l[c]=e,l[c+1]=d,c+=f}const m=Object.freeze(Object.defineProperty({__proto__:null,fill:k,normalizeIntegerBuffer:h,normalizeIntegerBufferView:n},Symbol.toStringTag,{value:"Module"}));a.fill=k;a.normalizeIntegerBuffer=h;a.normalizeIntegerBufferView=n;a.vec2=m})},"esri/chunks/vec33":function(){define(["exports"],function(a){function b(m,g){n(m.typedBuffer,g.typedBuffer,
m.typedBufferStride,g.typedBufferStride)}function n(m,g,e=3,d=e){const c=g.length/d;let l=0,f=0;for(let r=0;r<c;++r)m[l]=g[f],m[l+1]=g[f+1],m[l+2]=g[f+2],l+=e,f+=d}function h(m,g,e,d,c){const l=m.typedBuffer,f=m.typedBufferStride;m=c?.count??m.count;c=(c?.dstIndex??0)*f;for(let r=0;r<m;++r)l[c]=g,l[c+1]=e,l[c+2]=d,c+=f}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:b,fill:h},Symbol.toStringTag,{value:"Module"}));a.copy=n;a.copyView=b;a.fill=h;a.vec3=k})},"esri/chunks/vec43":function(){define(["exports"],
function(a){function b(m,g){n(m.typedBuffer,g,m.typedBufferStride)}function n(m,g,e=4){const d=g.typedBuffer,c=g.typedBufferStride;g=g.count;let l=0,f=0;for(let r=0;r<g;++r)m[l]=d[f],m[l+1]=d[f+1],m[l+2]=d[f+2],m[l+3]=d[f+3],l+=e,f+=c}function h(m,g,e,d,c,l){const f=m.typedBuffer,r=m.typedBufferStride;m=l?.count??m.count;l=(l?.dstIndex??0)*r;for(let x=0;x<m;++x)f[l]=g,f[l+1]=e,f[l+2]=d,f[l+3]=c,l+=r}const k=Object.freeze(Object.defineProperty({__proto__:null,copy:n,copyView:b,fill:h},Symbol.toStringTag,
{value:"Module"}));a.copy=n;a.copyView=b;a.fill=h;a.vec4=k})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,b,n,h,k,m){class g{constructor(d){this._streamDataRequester=d}async loadJSON(d,c){return this._load("json",d,c)}async loadBinary(d,c){return m.isDataProtocol(d)?(k.throwIfAborted(c),m.dataToArrayBuffer(d)):this._load("binary",d,c)}async loadImage(d,
c){return this._load("image",d,c)}async _load(d,c,l){if(null==this._streamDataRequester)return(await b(c,{responseType:e[d]})).data;d=await n.result(this._streamDataRequester.request(c,d,l));if(!0===d.ok)return d.value;k.throwIfAbortError(d.error);throw new h("",`Request for resource failed: ${d.error}`);}}const e={image:"image",binary:"array-buffer",json:"json","image+type":void 0};a.DefaultLoadingContext=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/factories/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),
function(a,b,n,h,k,m){function g(f){let r=null;f.json.nodes.forEach(x=>{x=x.extras;null!=x&&(x.ESRI_proxyEllipsoid||x.ESRI_lod)&&(r=x)});return r}async function e(f,r){async function x(u,v){const y=w.nodes[u];u=f.getNodeTransform(u);null!=y.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=y.mesh){const D=w.meshes[y.mesh];for(const G of D.primitives)q.push(r(G,u,v,D.name))}for(const D of y.children||[])q.push(x(D,v))}const w=f.json;
var p=w.scenes[w.scene||0].nodes;const t=1<p.length,q=[];for(const u of p)p=w.nodes[u],q.push(x(u,0)),p.extensions?.MSFT_lod&&Array.isArray(p.extensions.MSFT_lod.ids)&&!t&&p.extensions.MSFT_lod.ids.forEach((v,y)=>x(v,y+1));await Promise.all(q)}function d(f,r,x){const w=t=>{const q=`${x}_tex_${t&&t.id}${t?.name?"_"+t.name:""}`;t&&!f.textures.has(q)&&(t=h.makeTextureSource(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:l.has(t.minFilter),noUnpackFlip:!0}),f.textures.set(q,t));return q},p=`${x}_mat_${r.id}_${r.name}`;
f.materials.has(p)||(r=h.makeMaterialParameters({color:[r.color[0],r.color[1],r.color[2]],opacity:r.color[3],alphaMode:r.alphaMode,alphaCutoff:r.alphaCutoff,doubleSided:r.doubleSided,colorMixMode:r.ESRI_externalColorMixMode,textureColor:r.colorTexture?w(r.colorTexture):void 0,textureNormal:r.normalTexture?w(r.normalTexture):void 0,textureOcclusion:r.occlusionTexture?w(r.occlusionTexture):void 0,textureEmissive:r.emissiveTexture?w(r.emissiveTexture):void 0,textureMetallicRoughness:r.metallicRoughnessTexture?
w(r.metallicRoughnessTexture):void 0,emissiveFactor:[r.emissiveFactor[0],r.emissiveFactor[1],r.emissiveFactor[2]],colorTextureTransform:r.colorTextureTransform,normalTextureTransform:r.normalTextureTransform,occlusionTextureTransform:r.occlusionTextureTransform,emissiveTextureTransform:r.emissiveTextureTransform,metallicRoughnessTextureTransform:r.metallicRoughnessTextureTransform,metallicFactor:r.metallicFactor,roughnessFactor:r.roughnessFactor,receiveShadows:r.receiveShadows,receiveAmbientOcclustion:r.receiveAmbientOcclusion}),
f.materials.set(p,r));return p}let c=0;const l=new Set([m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST]);a.loadGLTF=async function(f,r,x={},w=!0){const p=await k.GLTFResource.load(f,r,x),t=`gltf_${c++}`,q={lods:[],materials:new Map,textures:new Map,meta:g(p)};f=!(!p.json.asset.extras||"symbolResource"!==p.json.asset.extras.ESRI_type);r=p.json.asset.extras?.ESRI_webstyleSymbol?.webstyle;const u=new Map;await e(p,async(y,D,G,A)=>{const C=u.get(G)??0;u.set(G,C+
1);var E=void 0!==y.mode?y.mode:m.PrimitiveType.TRIANGLES,I=E===m.PrimitiveType.TRIANGLES||E===m.PrimitiveType.TRIANGLE_STRIP||E===m.PrimitiveType.TRIANGLE_FAN?E:null;if(null==I)b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+m.PrimitiveType[E]+"). Skipping primitive.");else if(p.hasPositions(y)){E=p.getPositionData(y,x);var H=p.getMaterial(y,x,w),J=p.hasNormals(y)?p.getNormalData(y,x):null,B=p.hasTangents(y)?p.getTangentData(y,x):null,z=p.hasTextureCoordinates(y)?
p.getTextureCoordinates(y,x):null,K=p.hasVertexColors(y)?p.getVertexColors(y,x):null;y=p.getIndexData(y,x);D={name:A,transform:n.clone(D),attributes:{position:await E,normal:J?await J:null,texCoord0:z?await z:null,color:K?await K:null,tangent:B?await B:null},indices:await y,primitiveType:I,material:d(q,await H,t)};I=null;null!=q.meta?.ESRI_lod&&"screenSpaceRadius"===q.meta.ESRI_lod.metric&&(I=q.meta.ESRI_lod.thresholds[G]);q.lods[G]=q.lods[G]||{parts:[],name:A,lodThreshold:I};q.lods[G].parts[C]=D}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});
for(var v of q.lods)v.parts=v.parts.filter(y=>!!y);v=await p.getLoadedBuffersSize();return{model:q,meta:{isEsriSymbolResource:f,uri:p.uri,ESRI_webstyle:r},customMeta:{},size:v}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(n={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,
textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...n}};a.makeTextureSource=function(n,h={}){return{data:n,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,t:b.TextureWrapMode.REPEAT,...h.wrap},noUnpackFlip:!0,
mipmap:!1,...h}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/quat ../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ../../../../core/has ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(B){switch(B.componentType){case v.DataType.BYTE:return new f.BufferViewVec2i8(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount);case v.DataType.UNSIGNED_BYTE:return new f.BufferViewVec2u8(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount);case v.DataType.SHORT:return new f.BufferViewVec2i16(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount);case v.DataType.UNSIGNED_SHORT:return new f.BufferViewVec2u16(B.raw,
B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount);case v.DataType.UNSIGNED_INT:return new f.BufferViewVec2u32(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount);case v.DataType.FLOAT:return new f.BufferViewVec2f(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount)}}class D{constructor(B,z,K,L){this._context=B;this.uri=z;this.json=K;this._glbBuffer=L;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu","KHR_texture_transform"];this._baseUri=q.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==K.scenes)throw new b("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==K.meshes)throw new b("gltf-loader-unsupported-feature","Meshes must be defined");if(null==K.nodes)throw new b("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}static async load(B,z,K){if(m.isDataProtocol(z)){var L=m.dataComponents(z);if(L&&"model/gltf-binary"!==L.mediaType)try{const F=JSON.parse(L.isBase64?atob(L.data):L.data);return new D(B,z,F)}catch{}L=m.dataToArrayBuffer(z);if(D._isGLBData(L))return this._fromGLBData(B,z,L)}if(H.test(z)||"gltf"===K?.expectedType)return K=await B.loadJSON(z,K),new D(B,z,K);L=await B.loadBinary(z,K);if(D._isGLBData(L))return this._fromGLBData(B,z,L);if(J.test(z)||"glb"===K?.expectedType)throw new b("gltf-loader-invalid-glb",
"This is not a valid glb file.");K=await B.loadJSON(z,K);return new D(B,z,K)}static _isGLBData(B){if(null==B)return!1;B=new w.BinaryStreamReader(B);return 4<=B.remainingBytes()&&1179937895===B.readUint32()}static async _fromGLBData(B,z,K){K=await D._parseGLBData(K);return new D(B,z,K.json,K.binaryData)}static async _parseGLBData(B){const z=new w.BinaryStreamReader(B);if(12>z.remainingBytes())throw new b("gltf-loader-error","glb binary data is insufficiently large.");var K=z.readUint32(),L=z.readUint32();
const F=z.readUint32();if(1179937895!==K)throw new b("gltf-loader-error","Magic first 4 bytes do not fit to expected glb value.");if(B.byteLength<F)throw new b("gltf-loader-error","glb binary data is smaller than header specifies.");if(2!==L)throw new b("gltf-loader-unsupported-feature","An unsupported glb container version was detected. Only version 2 is supported.");B=0;let M,S;for(;8<=z.remainingBytes();){K=z.readUint32();L=z.readUint32();if(0===B){if(1313821514!==L)throw new b("gltf-loader-error",
"First glb chunk must be JSON.");if(0>K)throw new b("gltf-loader-error","No JSON data found.");M=await u.jsonFromBinaryData(z.readUint8Array(K))}else if(1===B){if(5130562!==L)throw new b("gltf-loader-unsupported-feature","Second glb chunk expected to be BIN.");S=z.readUint8Array(K)}else n.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 glb chunks detected. Skipping.");B+=1}if(!M)throw new b("gltf-loader-error","No glb JSON chunk detected.");return{json:M,binaryData:S}}async getBuffer(B,
z){const K=this.json.buffers[B];if(null==K.uri){if(null==this._glbBuffer)throw new b("gltf-loader-error","glb buffer not present");return this._glbBuffer}B=await this._getBufferLoader(B,z);if(B.byteLength!==K.byteLength)throw new b("gltf-loader-error","Buffer byte lengths should match.");return B}async _getBufferLoader(B,z){const K=this._bufferLoaders.get(B);if(K)return K;z=this._context.loadBinary(this._resolveUri(this.json.buffers[B].uri),z).then(L=>new Uint8Array(L));this._bufferLoaders.set(B,
z);return z}async getAccessor(B,z){if(!this.json.accessors)throw new b("gltf-loader-unsupported-feature","Accessors missing.");B=this.json.accessors[B];if(null==B?.bufferView)throw new b("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(B.type in[p.AttributeType.MAT2,p.AttributeType.MAT3,p.AttributeType.MAT4])throw new b("gltf-loader-unsupported-feature",`AttributeType ${B.type} is not supported`);const K=this.json.bufferViews[B.bufferView];z=await this.getBuffer(K.buffer,
z);const L=E[B.type],F=I[B.componentType],M=L*F,S=K.byteStride||M;return{raw:z.buffer,byteStride:S,byteOffset:z.byteOffset+(K.byteOffset||0)+(B.byteOffset||0),entryCount:B.count,isDenselyPacked:S===M,componentCount:L,componentByteSize:F,componentType:B.componentType,min:B.min,max:B.max,normalized:!!B.normalized}}async getIndexData(B,z){if(null!=B.indices)if(B=await this.getAccessor(B.indices,z),B.isDenselyPacked)switch(B.componentType){case v.DataType.UNSIGNED_BYTE:return new Uint8Array(B.raw,B.byteOffset,
B.entryCount);case v.DataType.UNSIGNED_SHORT:return new Uint16Array(B.raw,B.byteOffset,B.entryCount);case v.DataType.UNSIGNED_INT:return new Uint32Array(B.raw,B.byteOffset,B.entryCount)}else switch(B.componentType){case v.DataType.UNSIGNED_BYTE:return r.makeDense(this._wrapAccessor(f.BufferViewUint8,B));case v.DataType.UNSIGNED_SHORT:return r.makeDense(this._wrapAccessor(f.BufferViewUint16,B));case v.DataType.UNSIGNED_INT:return r.makeDense(this._wrapAccessor(f.BufferViewUint32,B))}}async getPositionData(B,
z){if(null==B.attributes.POSITION)throw new b("gltf-loader-unsupported-feature","No POSITION vertex data found.");B=await this.getAccessor(B.attributes.POSITION,z);if(B.componentType!==v.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+v.DataType[B.componentType]);if(3!==B.componentCount)throw new b("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+B.componentCount.toFixed());
return this._wrapAccessor(f.BufferViewVec3f,B)}async getNormalData(B,z){if(null==B.attributes.NORMAL)throw new b("gltf-loader-error","No NORMAL vertex data found.");B=await this.getAccessor(B.attributes.NORMAL,z);if(B.componentType!==v.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+v.DataType[B.componentType]);if(3!==B.componentCount)throw new b("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+
B.componentCount.toFixed());return this._wrapAccessor(f.BufferViewVec3f,B)}async getTangentData(B,z){if(null==B.attributes.TANGENT)throw new b("gltf-loader-error","No TANGENT vertex data found.");B=await this.getAccessor(B.attributes.TANGENT,z);if(B.componentType!==v.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+v.DataType[B.componentType]);if(4!==B.componentCount)throw new b("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+
B.componentCount.toFixed());return new f.BufferViewVec4f(B.raw,B.byteOffset,B.byteStride,B.byteOffset+B.byteStride*B.entryCount)}async getTextureCoordinates(B,z){if(null==B.attributes.TEXCOORD_0)throw new b("gltf-loader-error","No TEXCOORD_0 vertex data found.");B=await this.getAccessor(B.attributes.TEXCOORD_0,z);if(2!==B.componentCount)throw new b("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+B.componentCount.toFixed());if(B.componentType===v.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec2f,
B);if(!B.normalized)throw new b("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return y(B)}async getVertexColors(B,z){if(null==B.attributes.COLOR_0)throw new b("gltf-loader-error","No COLOR_0 vertex data found.");B=await this.getAccessor(B.attributes.COLOR_0,z);if(4!==B.componentCount&&3!==B.componentCount)throw new b("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+B.componentCount.toFixed());
if(4===B.componentCount){if(B.componentType===v.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec4f,B);if(B.componentType===v.DataType.UNSIGNED_BYTE)return this._wrapAccessor(f.BufferViewVec4u8,B);if(B.componentType===v.DataType.UNSIGNED_SHORT)return this._wrapAccessor(f.BufferViewVec4u16,B)}else if(3===B.componentCount){if(B.componentType===v.DataType.FLOAT)return this._wrapAccessor(f.BufferViewVec3f,B);if(B.componentType===v.DataType.UNSIGNED_BYTE)return this._wrapAccessor(f.BufferViewVec3u8,
B);if(B.componentType===v.DataType.UNSIGNED_SHORT)return this._wrapAccessor(f.BufferViewVec3u16,B)}throw new b("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+v.DataType[B.componentType]);}hasPositions(B){return void 0!==B.attributes.POSITION}hasNormals(B){return void 0!==B.attributes.NORMAL}hasVertexColors(B){return void 0!==B.attributes.COLOR_0}hasTextureCoordinates(B){return void 0!==B.attributes.TEXCOORD_0}hasTangents(B){return void 0!==B.attributes.TANGENT}async getMaterial(B,
z,K){var L=B.material?this._materialCache.get(B.material):void 0;if(!L){L=null!=B.material?t.material(this.json.materials[B.material]):t.material();const F=L.pbrMetallicRoughness,M=this.hasVertexColors(B),S=this.getTexture(F.baseColorTexture,z),N=this.getTexture(L.normalTexture,z),P=K?this.getTexture(L.occlusionTexture,z):void 0,R=K?this.getTexture(L.emissiveTexture,z):void 0;z=K?this.getTexture(F.metallicRoughnessTexture,z):void 0;B=null!=B.material?B.material:-1;L={alphaMode:L.alphaMode,alphaCutoff:L.alphaCutoff,
color:F.baseColorFactor,doubleSided:!!L.doubleSided,colorTexture:await S,normalTexture:await N,name:L.name,id:B,occlusionTexture:await P,emissiveTexture:await R,emissiveFactor:L.emissiveFactor,metallicFactor:F.metallicFactor,roughnessFactor:F.roughnessFactor,metallicRoughnessTexture:await z,hasVertexColors:M,ESRI_externalColorMixMode:L.extras.ESRI_externalColorMixMode,colorTextureTransform:F?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:L.normalTexture?.extensions?.KHR_texture_transform,
occlusionTextureTransform:L.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:L.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:F?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:L.extras.ESRI_receiveAmbientOcclusion,receiveShadows:L.extras.ESRI_receiveShadows}}return L}async getTexture(B,z){if(B){if(0!==(B.texCoord||0))throw new b("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");
var K=B.index;B=this.json.textures[K];var L=t.textureSampler(null!=B.sampler?this.json.samplers[B.sampler]:{}),F=this._getTextureSourceId(B),M=this.json.images[F],S=await this._loadTextureImageData(K,B,z);return h.getOrCreateMapValue(this._textureCache,K,()=>{const N=R=>33071===R||33648===R||10497===R,P=R=>{throw new b("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${R}`);};return{data:S,wrapS:N(L.wrapS)?L.wrapS:P(L.wrapS),wrapT:N(L.wrapT)?L.wrapT:P(L.wrapT),minFilter:L.minFilter,name:M.name,
id:K}})}}getNodeTransform(B){if(void 0===B)return G;var z=this._nodeTransformCache.get(B);if(!z){z=this.getNodeTransform(this._getNodeParent(B));const K=this.json.nodes[B];K.matrix?z=e.multiply(d.create(),z,K.matrix):K.translation||K.rotation||K.scale?(z=d.clone(z),K.translation&&e.translate(z,z,K.translation),K.rotation&&(C[3]=c.getAxisAngle(C,K.rotation),e.rotate(z,z,C[3],C)),K.scale&&e.scale(z,z,K.scale)):z=d.clone(z);this._nodeTransformCache.set(B,z)}return z}_wrapAccessor(B,z){return new B(z.raw,
z.byteOffset,z.byteStride,z.byteOffset+z.byteStride*(z.entryCount-1)+z.componentByteSize*z.componentCount)}_resolveUri(B){return m.makeAbsolute(B,this._baseUri)}_getNodeParent(B){return this._nodeParentMap.get(B)}_checkVersionSupported(){const B=g.Version.parse(this.json.asset.version,"glTF");A.validate(B)}_checkRequiredExtensionsSupported(){const B=this.json;if(B.extensionsRequired&&!B.extensionsRequired.every(z=>this._supportedExtensions.includes(z)))throw new b("gltf-loader-unsupported-feature",
"gltf loader was not able to load unsupported feature. Required extensions: "+B.extensionsRequired.join(", "));}_computeNodeParents(){this.json.nodes.forEach((B,z)=>{B.children&&B.children.forEach(K=>{this._nodeParentMap.set(K,z)})})}async _loadTextureImageData(B,z,K){const L=this._textureLoaders.get(B);if(L)return L;z=this._createTextureLoader(z,K);this._textureLoaders.set(B,z);return z}_getTextureSourceId(B){if(void 0!==B.extensions&&null!==B.extensions.KHR_texture_basisu)return B.extensions.KHR_texture_basisu.source;
if(null!==B.source)return B.source;throw new b("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");}async _createTextureLoader(B,z){B=this._getTextureSourceId(B);B=this.json.images[B];if(B.uri)return B.uri.endsWith(".ktx2")?(z=await this._context.loadBinary(this._resolveUri(B.uri),z),new u.EncodedMeshTexture(new Uint8Array(z))):this._context.loadImage(this._resolveUri(B.uri),z);if(null==B.bufferView)throw new b("gltf-loader-unsupported-feature",
"Image bufferView must be defined.");if(null==B.mimeType)throw new b("gltf-loader-unsupported-feature","Image mimeType must be defined.");const K=this.json.bufferViews[B.bufferView];z=await this.getBuffer(K.buffer,z);if(null!=K.byteStride)throw new b("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return u.imageFromBinaryData(new Uint8Array(z.buffer,z.byteOffset+(K.byteOffset||0),K.byteLength),B.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;
const B=await k.allSettledValues(Array.from(this._bufferLoaders.values())),z=await k.allSettledValues(Array.from(this._textureLoaders.values()));return B.reduce((K,L)=>K+(L?.byteLength??0),0)+z.reduce((K,L)=>K+(L?u.isEncodedMeshTexture(L)?L.data.byteLength:L.width*L.height*4:0),0)}}const G=e.fromXRotation(d.create(),Math.PI/2),A=new g.Version(2,0,"glTF"),C=l.create(),E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I={[v.DataType.BYTE]:1,[v.DataType.UNSIGNED_BYTE]:1,[v.DataType.SHORT]:2,[v.DataType.UNSIGNED_SHORT]:2,
[v.DataType.FLOAT]:4,[v.DataType.INT]:4,[v.DataType.UNSIGNED_INT]:4},H=/\.gltf$/i,J=/\.glb$/i;a.GLTFResource=D;a.transformGltfToEngine=G;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(h,k){const m=h.count;k||=new h.TypedArrayConstructor(m);for(let g=0;g<m;g++)k[g]=h.get(g);return k}const n=Object.freeze(Object.defineProperty({__proto__:null,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.makeDense=b;a.scalar=
n})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){class b{constructor(n){this._data=n;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const n=this._offset4;this._offset4+=1;return this._dataUint32[n]}readUint8Array(n){const h=4*this._offset4;this._offset4+=n/4;return new Uint8Array(this._data,h,n)}remainingBytes(){return this._data.byteLength-4*this._offset4}}a.BinaryStreamReader=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,n){const h={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},k={pbrMetallicRoughness:h,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},m={ESRI_externalColorMixMode:"tint",ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},g={magFilter:n.TextureSamplingMode.LINEAR,minFilter:n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,
wrapS:n.TextureWrapMode.REPEAT,wrapT:n.TextureWrapMode.REPEAT};a.material=(e={})=>{const d={...h,...e.pbrMetallicRoughness};var c={...m,...e.extras};switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(c.ESRI_externalColorMixMode),c.ESRI_externalColorMixMode="tint"}return{...k,...e,pbrMetallicRoughness:d,extras:c}};a.textureSampler=e=>({...g,...e});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],
function(a){a.splitURI=function(b){let n,h;b.replace(/^(.*\/)?([^/]*)$/,(k,m,g)=>{n=m||"";h=g||"";return""});return{dirPart:n,filePart:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/Indices","../../../webgl/enums"],function(a,b,n,h){a.convertPrimitiveToTriangles=function(k,m){switch(m){case h.PrimitiveType.TRIANGLES:return k="number"===typeof k?
n.getContinuousIndexArray(k):b.isUint8Array(k)?new Uint16Array(k):k,k;case h.PrimitiveType.TRIANGLE_STRIP:m="number"===typeof k?k:k.length;if(3>m)k=[];else{m-=2;var g=n.newIndexArray(3*m);if("number"===typeof k){k=0;for(var e=0;e<m;e+=1)0===e%2?(g[k++]=e,g[k++]=e+1):(g[k++]=e+1,g[k++]=e),g[k++]=e+2}else{e=0;for(var d=0;d<m;d+=1)0===d%2?(g[e++]=k[d],g[e++]=k[d+1]):(g[e++]=k[d+1],g[e++]=k[d]),g[e++]=k[d+2]}k=g}return k;case h.PrimitiveType.TRIANGLE_FAN:m="number"===typeof k?k:k.length;if(3>m)k=new Uint16Array(0);
else{m-=2;g=65536>=m?new Uint16Array(3*m):new Uint32Array(3*m);if("number"===typeof k)for(k=0,e=0;e<m;++e)g[k++]=0,g[k++]=e+1,g[k++]=e+2;else{e=k[0];d=k[1];var c=0;for(let l=0;l<m;++l){const f=k[l+2];g[c++]=e;g[c++]=d;d=g[c++]=f}}k=g}return k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],function(a){class b{constructor(){this.geometries=[];this.materials=[];this.textures=[]}}class n{constructor(h,
k,m){this.name=h;this.lodThreshold=k;this.pivotOffset=m;this.stageResources=new b;this.numberOfVertices=0}}a.ProcessedObjectResource=n;a.ProcessedObjectStageResources=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/Indices ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){async function y(z,K){const L=K?.streamDataRequester;if(L)return D(z,L,K);z=await n.result(b(z,K));if(!0===z.ok)return z.value.data;e.throwIfAbortError(z.error);G(z.error)}async function D(z,K,L){z=await n.result(K.request(z,"json",L));if(!0===z.ok)return z.value;e.throwIfAbortError(z.error);G(z.error.details.url)}function G(z){throw new k("",`Request for object resource failed: ${z}`);}function A(z){var K=z.params,L=K.topology;let F=!0;K.vertexAttributes||
(J().warn("Geometry must specify vertex attributes"),F=!1);switch(K.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:L=K.faces;if(!L)J().warn("Indexed geometries must specify faces"),F=!1;else if(K.vertexAttributes)for(const M in K.vertexAttributes)K=L[M],K?.values?(null!=K.valueType&&"UInt32"!==K.valueType&&(J().warn(`Unsupported indexed geometry indices type '${K.valueType}', only UInt32 is currently supported`),F=!1),null!=K.valuesPerElement&&1!==K.valuesPerElement&&
(J().warn(`Unsupported indexed geometry values per element '${K.valuesPerElement}', only 1 is currently supported`),F=!1)):(J().warn(`Indexed geometry does not specify face indices for '${M}' attribute`),F=!1);break;default:J().warn(`Unsupported topology '${L}'`),F=!1}z.params.material||(J().warn("Geometry requires material"),F=!1);z=z.params.vertexAttributes;for(const M in z)z[M].values||(J().warn("Geometries with externally defined attributes are not yet supported"),F=!1);return F}function C(z){const K=
l.empty();z.forEach(L=>{L=L.boundingInfo;null!=L&&(l.expandWithVec3(K,L.bbMin),l.expandWithVec3(K,L.bbMax))});return K}async function E(z,K){const L=[];for(const S in z){var F=z[S],M=F.images[0].data;if(!M){J().warn("Externally referenced texture data is not yet supported");continue}M=F.encoding+";base64,"+M;const N="/textureDefinitions/"+S,P="rgba"===F.channels?F.alphaChannelUsage||"transparency":"none",R={noUnpackFlip:!0,wrap:{s:v.TextureWrapMode.REPEAT,t:v.TextureWrapMode.REPEAT},preMultiplyAlpha:I(P)!==
w.AlphaDiscardMode.Opaque};F=null!=K&&K.disableTextures?Promise.resolve(null):r.requestImage(M,K);L.push(F.then(O=>({refId:N,image:O,parameters:R,alphaChannelUsage:P})))}z=await Promise.all(L);K={};for(const S of z)K[S.refId]=S;return K}function I(z){switch(z){case "mask":return w.AlphaDiscardMode.Mask;case "maskAndTransparency":return w.AlphaDiscardMode.MaskBlend;case "none":return w.AlphaDiscardMode.Opaque;case "transparency":return w.AlphaDiscardMode.Blend;default:return w.AlphaDiscardMode.Blend}}
function H(z){z=z.params;return{id:1,material:z.material,texture:z.texture,region:z.texture}}const J=()=>m.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),B=new d.Version(1,2,"wosr");a.createTextureResources=E;a.load=async function(z,K){z=await y(z,K);K=await E(z.textureDefinitions??{},K);let L=0;for(const F in K)if(K.hasOwnProperty(F)){const M=K[F];L+=M?.image?M.image.width*M.image.height*4:0}return{resource:z,textures:K,size:L+h.estimateNestedObjectSize(z)}};a.processLoadResult=function(z,
K){const L=[],F=[],M=[],S=new g.NestedMap,N=z.resource;var P=d.Version.parse(N.version||"1.0","wosr");B.validate(P);P=N.model.name;const R=N.model.geometries,O=N.materialDefinitions??{};z=z.textures;let T=0;const Q=new Map;for(let fa=0;fa<R.length;fa++){const da=R[fa];if(!A(da))continue;var V=H(da),U=da.params.vertexAttributes;const aa=[];var W=ea=>{if("PerAttributeArray"===da.params.topology)return null;const ha=da.params.faces;for(const Y in ha)if(Y===ea)return ha[Y].values;return null},ca=U[q.VertexAttribute.POSITION];
ca=ca.values.length/ca.valuesPerElement;for(const ea in U){var X=U[ea],ba=X.values,ia=W(ea)??f.getContinuousIndexArray(ca);aa.push([ea,new x.Attribute(ba,ia,X.valuesPerElement,!0)])}U=V.texture;if((W=z&&z[U])&&!Q.has(U)){const {image:ea,parameters:ha}=W;ca=new t.Texture(ea,ha);F.push(ca);Q.set(U,ca)}ca=(ca=Q.get(U))?ca.id:void 0;V=V.material;X=S.get(V,U);null==X&&(X=V.substring(V.lastIndexOf("/")+1),X=O[X].params,1===X.transparency&&(X.transparency=0),ba=W&&W.alphaChannelUsage,ba=0<X.transparency||
"transparency"===ba||"maskAndTransparency"===ba,ia=W?I(W.alphaChannelUsage):void 0,W={ambient:c.fromArray(X.diffuse),diffuse:c.fromArray(X.diffuse),opacity:1-(X.transparency||0),transparent:ba,textureAlphaMode:ia,textureAlphaCutoff:.33,textureId:ca,initTextureTransparent:!0,doubleSided:!0,cullFace:w.CullFaceOptions.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:W?.parameters.preMultiplyAlpha??!1},K?.materialParameters&&Object.assign(W,K.materialParameters),X=new u.DefaultMaterial(W),
S.set(V,U,X));M.push(X);U=new p.Geometry(X,aa);T+=aa.find(ea=>ea[0]===q.VertexAttribute.POSITION)?.[1]?.indices.length??0;L.push(U)}return{engineResources:[{name:P,stageResources:{textures:F,materials:M,geometries:L},pivotOffset:N.model.pivotOffset,numberOfVertices:T,lodThreshold:null}],referenceBoundingBox:C(L)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],function(a){a.colorGamma=
2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/webStyleUtils":function(){define(["exports","../../../../core/Error","../../../../symbols/support/styleUtils","../../../../symbols/support/webStyleSymbolUtils"],function(a,b,n,h){a.getResourceUrlFromSymbolStyle=async function(k){if(null===k||null==k.styleName&&null==k.styleUrl)return null;var m=k.name;if(null==m)throw new b("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");
const g={portal:k.portal};k=await n.fetchStyle(k,g).catch(()=>null);if(null===k)return null;const e=h.getStyleItemFromStyle(m,k.data);if(e&&!e.formatInfos?.some(d=>"gltf_basisu"===d.type))return null;m=await h.fetchSymbolFromStyle(k,m,g,"webRef",(d,c)=>n.symbolUrlFromStyleItem(d,c,["gltf_basisu","gltf"])).catch(()=>null);if(null===m||"point-3d"!==m.type)return null;m=m.symbolLayers.items[0];return"object"===m.type?m.resource:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(w,p){return p.items.find(t=>t.name===w)}function r(w,p,t,q,u,v){const y=null!=t?.portal?t.portal:m.getDefault(),D={portal:y,url:k.urlToObject(w.baseUrl),origin:"portal-item"},G=f(p,w.data);if(!G)return Promise.reject(new h("symbolstyleutils:symbol-name-not-found",`The symbol name '${p}' could not be found`,{symbolName:p}));u=g.fromJSON(u(G,q),D);let A=G.thumbnail?.href??null;const C=G.thumbnail?.imageData;n.isDevEnvironment()&&(u=n.adjustStaticAGOUrl(u)??
"",A=n.adjustStaticAGOUrl(A));const E={portal:y,url:k.urlToObject(k.removeFile(u)),origin:"portal-item"};return c.requestJSON(u,v).then(I=>{I="cimRef"===q?c.makeCIMSymbolRef(I.data):I.data;if((I=e.fromJSON(I,E))&&b.isSymbol3D(I)){if(A){const H=g.fromJSON(A,D);I.thumbnail=new l.Thumbnail({url:H})}else C&&(I.thumbnail=new l.Thumbnail({url:`data:image/png;base64,${C}`}));w.styleUrl?I.styleOrigin=new d({portal:t.portal,styleUrl:w.styleUrl,name:p}):w.styleName&&(I.styleOrigin=new d({portal:t.portal,styleName:w.styleName,
name:p}))}return I})}function x(w,p,t){const q=c.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,w),u=null!=p.portal?p.portal:m.getDefault();return c.requestJSON(q,t).then(v=>{v=c.makeCIMSymbolRef(v.data);return e.fromJSON(v,{portal:u,url:k.urlToObject(k.removeFile(q)),origin:"portal-item"})})}a.fetchSymbolFromStyle=r;a.getStyleItemFromStyle=f;a.resolveWebStyleSymbol=function(w,p,t,q){const u=w.name;return null==u?Promise.reject(new h("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):
w.styleName&&"Esri2DPointSymbolsStyle"===w.styleName?x(u,p,q):c.fetchStyle(w,p,q).then(v=>r(v,u,p,t,c.symbolUrlFromStyleItem,q))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/arrayUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../../effects/RenderPlugin ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M){function S(ca,X,ba){const ia=ca.allocateHead();ca=ca.view;K.encodeDoubleVec3(X.modelOrigin,ba,ca.modelOriginHi,ca.modelOriginLo,ia);ca.model.copyFrom(ia,X.model,ba);ca.modelNormal.copyFrom(ia,X.modelNormal,ba);X.color&&ca.color&&ca.color.copyFrom(ia,X.color,ba);X.objectAndLayerIdColor&&ca.objectAndLayerIdColor&&ca.objectAndLayerIdColor.copyFrom(ia,X.objectAndLayerIdColor,ba);X.featureAttribute&&ca.featureAttribute&&ca.featureAttribute.copyFrom(ia,
X.featureAttribute,ba)}function N(ca){let X=p.newLayout().vec3f(C.VertexAttribute.INSTANCEMODELORIGINHI).vec3f(C.VertexAttribute.INSTANCEMODELORIGINLO).mat3f(C.VertexAttribute.INSTANCEMODEL).mat3f(C.VertexAttribute.INSTANCEMODELNORMAL);null!=ca&&ca.includes("featureAttribute")&&(X=X.vec4f(C.VertexAttribute.INSTANCEFEATUREATTRIBUTE));null!=ca&&ca.includes("color")&&(X=X.vec4u8(C.VertexAttribute.INSTANCECOLOR));null!=ca&&ca.includes("objectAndLayerIdColor")&&(X=X.vec4u8(C.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR));
return X}const P=ca=>{const X=ca.baseBoundingSphere.radius;ca=ca.levels.map(ba=>ba.minScreenSpaceRadius);return new H.LevelSelector(X,ca)};a.LodRenderer=class extends q.ASyncPreparesRenderPlugin{constructor(ca,X){super(ca);this.type=y.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[[]];this._highlightRenderInstanceData=[[]];this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]];this._cycleStartIndex=this._instanceIndex=
0;this._slicePlane=!1;this._camera=new u.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.produces=new Map([[G.RenderSlot.OPAQUE_MATERIAL,ba=>this._produces(ba)],[G.RenderSlot.TRANSPARENT_MATERIAL,ba=>this._hasTransparentLevels()?this._produces(ba):!1]]);this._instanceData=new E.InstanceData({shaderTransformation:ca.shaderTransformation},ca.optionalFields);this.addHandles(X.registerTask(F.TaskPriority.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=N(this.optionalFields);
this._glInstanceBufferLayout=w.glLayout(this._instanceBufferLayout,1);this.addHandles([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:ca})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(ca)}),this._instanceData.events.on("instance-visibility-changed",({index:ca})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(ca)}),this._instanceData.events.on("instance-highlight-changed",
()=>this._requestUpdateCycle(!0))])}get _enableLevelSelection(){return 1<this.symbol.levels.length}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(ca){this._slicePlane=ca}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get usedMemory(){return this._allRenderInstanceData.reduce((ca,
X)=>X.reduce((ba,ia)=>ba+ia.usedMemory,ca),0)}get renderStats(){const ca=this._instanceData.size,X=[];this._levels.forEach((ba,ia)=>{ia=this._allRenderInstanceData[0][ia].size+this._allRenderInstanceData[1][ia].size;ba=ba.triangleCount;X.push({renderedInstances:ia,renderedTriangles:ia*ba,trianglesPerInstance:ba})});return{totalInstances:ca,renderedInstances:X.reduce((ba,ia)=>ba+ia.renderedInstances,0),renderedTriangles:X.reduce((ba,ia)=>ba+ia.renderedTriangles,0),levels:X}}async initializeRenderContext(ca,
X){this._context=ca;const ba=ca.renderContext.rctx,ia=await Promise.allSettled(this.symbol.levels.map(da=>{this._defaultRenderInstanceData[0].push(new B.RenderInstanceData(ba,this._instanceBufferLayout));this._highlightRenderInstanceData[0].push(new B.RenderInstanceData(ba,this._instanceBufferLayout));return J.LodLevel.create(ca,da,X)})),fa=ia.map(da=>"fulfilled"===da.status?da.value:null).filter(n.isSome);if(k.isAborted(X)||fa.length!==ia.length){fa.forEach(da=>da.destroy());k.throwIfAborted(X);
for(const da of ia)if("rejected"===da.status)throw da.reason;}this._levels=fa;this._levelSelector=P(this)}uninitializeRenderContext(){this._invalidateOctree();this._levels.forEach(ca=>ca.destroy());this._defaultRenderInstanceData[0].forEach(ca=>ca.destroy());this._highlightRenderInstanceData[0].forEach(ca=>ca.destroy())}_hasTransparentLevels(){return this._levels.some(ca=>ca.components.some(X=>(X=X.material.produces.get(G.RenderSlot.TRANSPARENT_MATERIAL))&&X(t.ShaderOutput.Color)))}hasHighlights(){return this._highlightRenderInstanceData[0].some(ca=>
0<ca.size)}_produces(ca){return ca!==t.ShaderOutput.Highlight&&ca!==t.ShaderOutput.ShadowHighlight||this.hasHighlights()}prepareRender(ca){if(!x.debugFlags.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const X=ca.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(ca.bindParameters.contentCamera);X||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(F.noBudget),this._needFullCycle=!1)}}prepareTechniques(ca){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleForOutput(ca.output))return null;const X=this._getInstanceDatas(ca.output);if(!X)return null;const ba=[];X.forEach(ia=>this.levels.forEach((fa,da)=>{fa.components.forEach(aa=>ba.push(this._beginComponent(ca,ia[da],aa)))}));return ba}renderNode(ca,X){const ba=this._getInstanceDatas(ca.output);if(ba&&null!=X){var ia=0;ca.rctx.bindVAO();ba.forEach(fa=>this.levels.forEach((da,aa)=>{da.components.forEach(ea=>this._renderComponent(ca,X[ia++],fa[aa],ea,aa))}))}}_getInstanceDatas(ca){const X=
ca!==t.ShaderOutput.Highlight&&ca!==t.ShaderOutput.ShadowHighlight;ca=ca!==t.ShaderOutput.ShadowExcludeHighlight;return X&&ca?this._allRenderInstanceData:X?this._defaultRenderInstanceData:ca?this._highlightRenderInstanceData:null}intersect(ca,X,ba,ia){if(this.baseMaterial.isVisible()&&null!=this._octree){var fa=f.create();l.subtract(fa,ia,ba);var da=aa=>{this._instanceData.getCombinedModelTransform(aa,T);ca.transform.set(T);l.transformMat4(Q,ba,ca.transform.inverse);l.transformMat4(V,ia,ca.transform.inverse);
const ea=this._instanceData.getState(aa),ha=this._instanceData.getLodLevel(aa),Y=this._levels.length;A.assert(0!==(ea&E.StateFlags.ACTIVE),"invalid instance state");A.assert(0<=ha&&ha<Y,"invaid lod level");this._levels[ha].intersect(ca,X,Q,V,aa,this.metadata,Y)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(da):this._octree.forEachAlongRay(ba,fa,da)}}notifyShaderTransformationChanged(){this._invalidateOctree();this._requestUpdateCycle()}get _octree(){if(null==this._octreeCached){const ca=
this._instanceData,X=ca.view?.state;if(!X)return null;this._octreeCached=new I.InstanceOctree(ca,this.baseBoundingSphere);for(let ba=0;ba<ca.capacity;++ba)X.get(ba)&E.StateFlags.ACTIVE&&this._octreeCached.addInstance(ba)}return this._octreeCached}_invalidateOctree(){this._octreeCached=h.destroyMaybe(this._octreeCached)}queryDepthRange(ca){if(null==this._octree)return{near:Infinity,far:-Infinity};var X=ca.viewForward,ba=this._octree.findClosest(X,D.DepthOrder.FRONT_TO_BACK,ca.frustum);const ia=this._octree.findClosest(X,
D.DepthOrder.BACK_TO_FRONT,ca.frustum);if(null==ba||null==ia)return{near:Infinity,far:-Infinity};const fa=ca.eye,da=this._instanceData.view;da.boundingSphere.getVec(ba,O);l.subtract(O,O,fa);ba=l.dot(O,X)-O[3];da.boundingSphere.getVec(ia,O);l.subtract(O,O,fa);X=l.dot(O,X)+O[3];return{near:Math.max(ca.near,ba),far:Math.min(ca.far,X)}}_requestUpdateCycle(ca=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;ca&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++;
this._allRenderInstanceData.forEach(ca=>ca.forEach(X=>X.startUpdateCycle()))}get running(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}runTask(ca){const {_enableLevelSelection:X,_camera:ba,_levelSelector:ia}=this;this._allRenderInstanceData.forEach(oa=>oa.forEach(qa=>qa.beginUpdate()));const fa=this._instanceData,da=fa.view;let aa=fa.size;const ea=fa.capacity;let ha=this._instanceIndex;const Y=Math.ceil(ea/500);for(let oa=0;oa<aa&&!ca.done;++oa){ha===this._cycleStartIndex&&
this._startUpdateCycle();const qa=da.state.get(ha);var Z=0;if(qa&E.StateFlags.ALLOCATED){var ja=da.lodLevel.get(ha);qa&E.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][ja].freeTail();qa&E.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][ja].freeTail();qa&E.StateFlags.REMOVE?fa.freeInstance(ha):qa&E.StateFlags.VISIBLE?(ja=0,X&&(da.modelOrigin.getVec(ha,R),ja=ia.selectLevel(R,fa.getCombinedMedianScaleFactor(ha),ba)),Z=qa&~(E.StateFlags.ACTIVE|E.StateFlags.TRANSFORM_CHANGED),
0<=ja&&(qa&E.StateFlags.HIGHLIGHT?(S(this._highlightRenderInstanceData[0][ja],da,ha),Z|=E.StateFlags.HIGHLIGHT_ACTIVE):(S(this._defaultRenderInstanceData[0][ja],da,ha),Z|=E.StateFlags.DEFAULT_ACTIVE)),da.state.set(ha,Z),da.lodLevel.set(ha,ja)):(Z=qa&~(E.StateFlags.ACTIVE|E.StateFlags.TRANSFORM_CHANGED),da.state.set(ha,Z));null!=this._octreeCached&&(ja=!!(qa&E.StateFlags.ACTIVE),Z=!!(Z&E.StateFlags.ACTIVE),!ja&&Z?this._octreeCached.addInstance(ha):ja&&!Z?this._octreeCached.removeInstance(ha):ja&&Z&&
qa&E.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(ha),this._octreeCached.addInstance(ha)));ha=ha+1===ea?0:ha+1;0===ha%Y&&ca.madeProgress()}else ha=ha+1===ea?0:ha+1,aa++}this._instanceIndex=ha;this._allRenderInstanceData.forEach(oa=>oa.forEach(qa=>qa.endUpdate()));this._context.requestRender()}_beginComponent(ca,X,ba){if(0===X.size)return null;X=ba.glMaterials.load(ca.rctx,ca.bindParameters.slot,ca.output);return null!=X?X.beginSlot(ca.bindParameters):null}_renderComponent(ca,X,
ba,ia,fa){if(X){var {bindParameters:da,rctx:aa}=ca;aa.runAppleAmdDriverHelper();var ea=aa.bindTechnique(X,da,ia.material.parameters,W);aa.bindVAO(ia.vao);X.ensureAttributeLocations(ia.vao);x.debugFlags.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&ca.output===t.ShaderOutput.Color&&(ea.setUniform4fv("externalColor",U[Math.min(fa,U.length-1)]),ea.setUniform1i("colorMixMode",z.colorMixModes.replace));ca=ba.capacity;fa=ba.headIndex;ea=ba.tailIndex;var ha=ba.firstIndex,Y=this._glInstanceBufferLayout,Z=(ja,
oa)=>{M.bindVertexBufferLayout(aa,v.Default3D,ba.buffer,Y,ja);aa.drawArraysInstanced(X.primitiveType,0,ia.vertexCount,oa-ja);M.unbindVertexBufferLayout(aa,v.Default3D,ba.buffer,Y)};ia.material.parameters.transparent&&null!=ha?fa>ea?(A.assert(ha>=ea&&ha<=fa,"invalid firstIndex"),Z(ha,fa),Z(ea,ha)):fa<ea&&(ha<=fa?(A.assert(0<=ha&&ha<=fa,"invalid firstIndex"),Z(ha,fa),Z(ea,ca),Z(0,ha)):(A.assert(ha>=ea&&ha<=ca,"invalid firstIndex"),Z(ha,ca),Z(0,fa),Z(ea,ha))):fa>ea?Z(ea,fa):fa<ea&&(Z(0,fa),Z(ea,ca));
aa.bindVAO(null)}}};b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"metadata",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_instanceData",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,
"_cycleStartIndex",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);b.__decorate([m.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"running",null);a.LodRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);const R=f.create(),O=r.create(),T=c.create(),Q=f.create(),V=f.create(),U=[r.fromValues(1,0,1,
1),r.fromValues(0,0,1,1),r.fromValues(0,1,0,1),r.fromValues(1,1,0,1),r.fromValues(1,0,0,1)],W=new L.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Evented ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute ./RenderInstanceData".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){a.StateFlags=void 0;(function(I){I[I.ALLOCATED=1]="ALLOCATED";I[I.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";I[I.VISIBLE=4]="VISIBLE";I[I.HIGHLIGHT=8]="HIGHLIGHT";I[I.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";I[I.REMOVE=32]="REMOVE";I[I.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";I[I.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));class D{constructor(I){this.localTransform=I.getField(v.VertexAttribute.LOCALTRANSFORM,p.BufferViewMat4f64);this.globalTransform=
I.getField(v.VertexAttribute.GLOBALTRANSFORM,p.BufferViewMat4f64);this.modelOrigin=I.getField(v.VertexAttribute.MODELORIGIN,p.BufferViewVec3f64);this.model=I.getField(v.VertexAttribute.INSTANCEMODEL,p.BufferViewMat3f);this.modelNormal=I.getField(v.VertexAttribute.INSTANCEMODELNORMAL,p.BufferViewMat3f);this.modelScaleFactors=I.getField(v.VertexAttribute.MODELSCALEFACTORS,p.BufferViewVec2f);this.boundingSphere=I.getField(v.VertexAttribute.BOUNDINGSPHERE,p.BufferViewVec4f64);this.featureAttribute=I.getField(v.VertexAttribute.FEATUREATTRIBUTE,
p.BufferViewVec4f);this.color=I.getField(v.VertexAttribute.COLOR,p.BufferViewVec4u8);this.objectAndLayerIdColor=I.getField(v.VertexAttribute.OBJECTANDLAYERIDCOLOR,p.BufferViewVec4u8);this.state=I.getField(v.VertexAttribute.STATE,p.BufferViewUint8);this.lodLevel=I.getField(v.VertexAttribute.LODLEVEL,p.BufferViewUint8)}}a.InstanceData=class extends n{constructor(I,H){super(I);this.events=new k;this._next=this._size=this._capacity=0;I=q.newLayout().mat4f64(v.VertexAttribute.LOCALTRANSFORM).mat4f64(v.VertexAttribute.GLOBALTRANSFORM).vec4f64(v.VertexAttribute.BOUNDINGSPHERE).vec3f64(v.VertexAttribute.MODELORIGIN).mat3f(v.VertexAttribute.INSTANCEMODEL).mat3f(v.VertexAttribute.INSTANCEMODELNORMAL).vec2f(v.VertexAttribute.MODELSCALEFACTORS);
H.includes(v.VertexAttribute.FEATUREATTRIBUTE)&&(I=I.vec4f(v.VertexAttribute.FEATUREATTRIBUTE));H.includes(v.VertexAttribute.COLOR)&&(I=I.vec4u8(v.VertexAttribute.COLOR));H.includes(v.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(I=I.vec4u8(v.VertexAttribute.OBJECTANDLAYERIDCOLOR));this._layout=I=I.u8(v.VertexAttribute.STATE).u8(v.VertexAttribute.LODLEVEL);this._capacity=y.initialCapacity;this._buffer=this._layout.createBuffer(this._capacity);this._view=new D(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+
1>this._capacity&&this._grow();const I=this._findSlot();this._view.state.set(I,a.StateFlags.ALLOCATED);this._size++;this.events.emit("instances-changed");return I}removeInstance(I){const H=this._view.state;u.assert(0<=I&&I<this._capacity&&0!==(H.get(I)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(I,a.StateFlags.ACTIVE)?this._setStateFlags(I,a.StateFlags.REMOVE):this.freeInstance(I);this.events.emit("instances-changed")}freeInstance(I){const H=this._view.state;u.assert(0<=
I&&I<this._capacity&&0!==(H.get(I)&a.StateFlags.ALLOCATED),"invalid instance handle");H.set(I,0);this._size--}setLocalTransform(I,H,J=!0){this._view.localTransform.setMat(I,H);J&&this.updateModelTransform(I)}getLocalTransform(I,H){this._view.localTransform.getMat(I,H)}setGlobalTransform(I,H,J=!0){this._view.globalTransform.setMat(I,H);J&&this.updateModelTransform(I)}getGlobalTransform(I,H){this._view.globalTransform.getMat(I,H)}updateModelTransform(I){const H=this._view;var J=G;const B=A;H.localTransform.getMat(I,
C);H.globalTransform.getMat(I,E);const z=f.multiply(E,E,C);x.set(J,z[12],z[13],z[14]);H.modelOrigin.setVec(I,J);c.fromMat4(B,z);H.model.setMat(I,B);J=t.scaleFromMatrix(G,z);J.sort();H.modelScaleFactors.set(I,0,J[1]);H.modelScaleFactors.set(I,1,J[2]);c.invert(B,B);c.transpose(B,B);H.modelNormal.setMat(I,B);this._setStateFlags(I,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:I})}getModelTransform(I,H){const J=this._view;J.model.getMat(I,A);J.modelOrigin.getVec(I,
G);H[0]=A[0];H[1]=A[1];H[2]=A[2];H[3]=0;H[4]=A[3];H[5]=A[4];H[6]=A[5];H[7]=0;H[8]=A[6];H[9]=A[7];H[10]=A[8];H[11]=0;H[12]=G[0];H[13]=G[1];H[14]=G[2];H[15]=1}applyShaderTransformation(I,H){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,I,H)}getCombinedModelTransform(I,H){this.getModelTransform(I,H);null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,I,H);return H}getCombinedLocalTransform(I,H){this._view.localTransform.getMat(I,H);null!=this.shaderTransformation&&
this.shaderTransformation.applyTransform(this,I,H)}getCombinedMaxScaleFactor(I){let H=this._view.modelScaleFactors.get(I,1);null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(G,this,I),H*=Math.max(G[0],G[1],G[2]));return H}getCombinedMedianScaleFactor(I){let H=this._view.modelScaleFactors.get(I,0);if(null!=this.shaderTransformation){this.shaderTransformation.scaleFactor(G,this,I);I=G[0];var J=G[1];H*=Math.max(Math.min(I,J),Math.min(Math.max(I,J),G[2]))}return H}getModel(I,H){this._view.model.getMat(I,
H)}setFeatureAttribute(I,H){this._view.featureAttribute.setVec(I,H)}getFeatureAttribute(I,H){this._view.featureAttribute.getVec(I,H)}setColor(I,H){this._view.color.setVec(I,H)}setObjectAndLayerIdColor(I,H){this._view.objectAndLayerIdColor.setVec(I,H)}setVisible(I,H){H!==this.getVisible(I)&&(this._setStateFlag(I,a.StateFlags.VISIBLE,H),this.events.emit("instance-visibility-changed",{index:I}))}getVisible(I){return this._getStateFlag(I,a.StateFlags.VISIBLE)}setHighlight(I,H){H!==this.getHighlight(I)&&
(this._setStateFlag(I,a.StateFlags.HIGHLIGHT,H),this.events.emit("instance-highlight-changed"))}getHighlight(I){return this._getStateFlag(I,a.StateFlags.HIGHLIGHT)}getState(I){return this._view.state.get(I)}getLodLevel(I){return this._view.lodLevel.get(I)}countFlags(I){let H=0;for(let J=0;J<this._capacity;++J)this.getState(J)&I&&++H;return H}_setStateFlags(I,H){const J=this._view.state;H|=J.get(I);J.set(I,H)}_clearStateFlags(I,H){const J=this._view.state;H=J.get(I)&~H;J.set(I,H)}_setStateFlag(I,H,
J){J?this._setStateFlags(I,H):this._clearStateFlags(I,H)}_getStateFlag(I,H){return!!(this._view.state.get(I)&H)}_grow(){this._capacity=Math.max(y.initialCapacity,Math.floor(this._capacity*h.reallocGrowthFactor));this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer);this._view=new D(this._buffer)}_findSlot(){const I=this._view.state;let H=this._next;for(;I.get(H)&a.StateFlags.ALLOCATED;)H=H+1===this._capacity?0:H+1;this._next=H+1===this._capacity?0:H+1;return H}};b.__decorate([m.property({constructOnly:!0})],
a.InstanceData.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.InstanceData.prototype,"_size",void 0);b.__decorate([m.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const G=w.create(),A=l.create(),C=r.create(),E=r.create();a.InstanceDataView=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../core/arrayUtils ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,n,h,k,m){class g{constructor(d){this.modelOriginHi=d.getField(k.VertexAttribute.INSTANCEMODELORIGINHI,n.BufferViewVec3f);this.modelOriginLo=d.getField(k.VertexAttribute.INSTANCEMODELORIGINLO,n.BufferViewVec3f);this.model=d.getField(k.VertexAttribute.INSTANCEMODEL,n.BufferViewMat3f);this.modelNormal=d.getField(k.VertexAttribute.INSTANCEMODELNORMAL,n.BufferViewMat3f);this.featureAttribute=d.getField(k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,n.BufferViewVec4f);this.color=d.getField(k.VertexAttribute.INSTANCECOLOR,
n.BufferViewVec4u8);this.objectAndLayerIdColor=d.getField(k.VertexAttribute.INSTANCEOBJECTANDLAYERIDCOLOR,n.BufferViewVec4u8)}}class e{constructor(d,c){this._rctx=d;this._instanceBufferLayout=c;this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const d=
this._headIndex,c=this._tailIndex;return d>=c?d-c:d+this._capacity-c}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._tailIndex=this._headIndex=0;this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){h.assert(!this._updating,
"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex}endUpdate(){h.assert(this._updating,"not updating");this.size<b.reallocShrinkThreshold*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1}allocateHead(){h.assert(this._updating,"not updating");this.isFull&&this._grow();const d=this.headIndex;this._captureFirstIndex&&(this._firstIndex=d,this._captureFirstIndex=!1);
this._incrementHead();h.assert(this._headIndex!==this._tailIndex,"invalid pointers");return d}freeTail(){h.assert(this._updating,"not updating");h.assert(0<this.size,"invalid size");const d=this._tailIndex===this._firstIndex;this._incrementTail();d&&(this._firstIndex=this._tailIndex)}_grow(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocGrowthFactor)))}_shrink(){this._resize(Math.max(64,Math.floor(this._capacity*b.reallocShrinkFactor)))}_resize(d){h.assert(this._updating,"not updating");
if(d!==this._capacity){var c=new m(this._rctx,this._instanceBufferLayout.stride,d);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const l=this.size,f=this._compactInstances(c);h.assert(f===l,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=f;this._prevHeadIndex=0}this._resized=!0;this._capacity=d;this._buffer=c;this._view=new g(this._instanceBufferLayout.createView(this._buffer.array))}}_compactInstances(d){const c=
this._headIndex,l=this._tailIndex;return l<c?(this._buffer.copyRange(l,c,d),c-l):l>c?(this._buffer.copyRange(l,this._capacity,d),0<c&&this._buffer.copyRange(0,c,d,this._capacity-l),c+(this._capacity-l)):0}_incrementHead(d=1){this._headIndex=(this._headIndex+d)%this._capacity}_incrementTail(d=1){this._tailIndex=(this._tailIndex+d)%this._capacity}_transferRange(d,c){d<c?this._buffer.transferRange(d,c):d>c&&(0<c&&this._buffer.transferRange(0,c),this._buffer.transferRange(d,this._capacity))}}a.RenderInstanceData=
e;a.RenderInstanceDataView=g;a.initialCapacity=64;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b){class n{constructor(h,k,m){this._elementSize=k;this._buffer=a.BufferObject.createVertex(h,b.Usage.STATIC_DRAW);this.resize(m)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+
this._buffer.usedMemory}copyRange(h,k,m,g=0){h=new Uint8Array(this.array,h*this.elementSize,(k-h)*this.elementSize);(new Uint8Array(m.array,g*this.elementSize)).set(h)}transferAll(){this._buffer.setData(this._array)}transferRange(h,k){h*=this._elementSize;k*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),h,h,k)}resize(h){const k=h*this._elementSize,m=new ArrayBuffer(k);this._array&&(h>=this._capacity?(new Uint8Array(m)).set(new Uint8Array(this._array)):(new Uint8Array(m)).set((new Uint8Array(this._array)).subarray(0,
h*this._elementSize)));this._array=m;this._buffer.setSize(k);this._capacity=h}}return n})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,n,h,k,m){class g extends m{constructor(e,d){super(c=>h.wrap(this._instanceData.view.boundingSphere.getVec(c,this._tmpSphere)),{maximumDepth:25});this._instanceData=
e;this._boundingSphere=d;this._tmpSphere=h.create();this._tmpMat4=b.create()}addInstance(e){const d=this._instanceData.view.boundingSphere,c=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);n.transformMat4(h.getCenter(this._tmpSphere),this._boundingSphere.center,c);this._tmpSphere[3]=this._boundingSphere.radius*k.maxScale(c);d.setVec(e,this._tmpSphere);this.add([e])}removeInstance(e){this.remove([e])}}a.InstanceOctree=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],function(a){class b{constructor(n,h){this._worldSpaceRadius=n;this._minScreenSpaceRadii=h}selectLevel(n,h,k){n=k.computeScreenPixelSizeAt(n);h=this._worldSpaceRadius*h/n;n=0;for(k=1;k<this._minScreenSpaceRadii.length;++k)h>=this._minScreenSpaceRadii[k]&&(n=k);return n}}a.LevelSelector=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),
function(a,b,n,h,k,m){class g{static async create(e,d,c){const l=await Promise.allSettled(d.components.map(r=>e.controller.schedule(()=>new m.LodComponentData(e,r),c))),f=l.map(r=>"fulfilled"===r.status?r.value:null).filter(b.isSome);if(n.isAborted(c)||f.length!==l.length){f.forEach(r=>r.destroy());n.throwIfAborted(c);for(const r of l)if("rejected"===r.status)throw r.reason;}return new g(d.minScreenSpaceRadius,f)}constructor(e,d){this.minScreenSpaceRadius=e;this.components=d}destroy(){this.components.forEach(e=>
e.destroy())}intersect(e,d,c,l,f,r,x){this.components.forEach(w=>w.intersect(e,d,c,l,f,r,this.boundingSphere,x))}get boundingBox(){if(null==this._boundingBox){const e=k.empty();this.components.forEach(d=>{null!=d.boundingInfo&&(k.expandWithVec3(e,d.boundingInfo.bbMin),k.expandWithVec3(e,d.boundingInfo.bbMax))});this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(null==this._boundingSphere){const e=this.boundingBox,d=h.create();k.center(e,d);this._boundingSphere={center:d,radius:.5*
k.diameter(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,d)=>e+d.triangleCount,0)}}a.LodLevel=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(f,r){const x=f.renderContext.rctx;r=r.geometry;this._materialRepository=f.materialRepository;r.material.setParameters({instancedDoublePrecision:!0});f=r.material.createBufferWriter();const w=f.vertexBufferLayout,p=f.elementCount(r),t=w.createBuffer(p);f.write(null,null,r,t,0);this.geometry=r;this.material=r.material;this.glMaterials=new h.GLMaterials(r.material,this._materialRepository);this.vertexBufferLayout=w;this.vbo=d.BufferObject.createVertex(x,
c.Usage.STATIC_DRAW,t.buffer);this.vao=new g.VertexArrayObject(x,n.Default3D,{geometry:b.glLayout(w)},{geometry:this.vbo});this.vertexCount=p}destroy(){this.glMaterials.dispose();this.vbo.dispose();this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(f,r,x,w,p,t,q,u){const v=this.geometry.id;this.material.intersect(this.geometry,f.transform.transform,f,x,w,(y,D,G,A,C)=>{0<=y&&(null==r||r(f.rayBegin,f.rayEnd,y))&&(G=new e.LodTarget(t.layerUid,
t.graphicUid(p),v,G,q,u),(null==f.results.min.drapedLayerOrder||C>=f.results.min.drapedLayerOrder)&&(null==f.results.min.dist||y<f.results.min.dist)&&f.results.min.set(m.IntersectorType.LOD,G,y,D,f.transform.transform,C),f.options.store!==m.StoreResults.MIN&&(null==f.results.max.drapedLayerOrder||C>=f.results.max.drapedLayerOrder)&&(null==f.results.max.dist||y>f.results.max.dist)&&f.results.max.set(m.IntersectorType.LOD,G,y,D,f.transform.transform,C),f.options.store===m.StoreResults.ALL&&(A=k.newIntersectorResult(f.results.min.ray),
A.set(m.IntersectorType.LOD,G,y,D,f.transform.transform,C),f.results.all.push(A)))})}}a.LodComponentData=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],function(a,b,n,h){class k extends n.Graphic3DTarget{constructor(m,g,e,d,c,l){super(m,g);this.layerUid=m;this.graphicUid=g;this.geometryId=e;this.triangleNr=d;this.baseBoundingSphere=
c;this.numLodLevels=l}}a.LodTarget=k;a.isLodIntersectorResult=function(m){return h.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.LOD&&!!m.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../core/has ../../../../core/Error ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../support/ElevationProvider ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Path ../../webgl-engine/lib/PathBuilder ../../webgl-engine/lib/PathCapBuilder ../../webgl-engine/lib/PathExtruder ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/PathGeometryData ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/PathProfile ../../webgl-engine/lib/PathVertex ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M){function S(Q,V,U){const {origin:W,positions:ca}=Q;let X=Q.offset;switch(V){default:case H.UpVectorAlignment.World:for(const ba of Q.vertices)O[0]=ca[X++]+W[0],O[1]=ca[X++]+W[1],O[2]=ca[X++]+W[2],U.worldUpAtPosition(O,O),ba.setFrameFromUpVector(O);break;case H.UpVectorAlignment.Path:O[0]=ca[X]+W[0],O[1]=ca[X+1]+W[1],O[2]=ca[X+2]+W[2],U.worldUpAtPosition(O,O),B.computeMinimumRotationTangentFrame(Q,O)}}function N(Q,V,U){switch(Q){case "symbol-value":return U;
case "proportional":return V;default:return Q}}const P=["polyline"];class R extends p.Graphics3DSymbolLayer{constructor(Q,V,U,W){super(Q,V,U,W);this._intrinsicSize=g.fromValues(1,1);this._upVectorAlignment=H.UpVectorAlignment.Path;this._stencilWidth=.1;this.usedMemory=0;this.ensureDrapedStatus(!1)}async doLoad(){var Q=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height;const V=null!=this.symbolLayer.height?this.symbolLayer.height:Q;this._vvConvertOptions=new u.ConvertOptions({size:!0,
color:!0,rotation:!1,opacity:!0},[1,1,1],[Q,1,V],this._context.renderCoordsHelper.unitInMeters);this._fastUpdates=0<this._context.renderer?.visualVariables?.length?u.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):null;var U=this.symbolLayer.anchor||"center";this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?H.UpVectorAlignment.World:H.UpVectorAlignment.Path;var W=this.symbolLayer.profile||"circle";switch(W){default:case "circle":this._profile=z.circleProfiles[U];
break;case "quad":this._profile=z.quadProfiles[U]}switch(this.symbolLayer.join){case "round":this._extruder=new I.MiterExtruder(0,w.pathNumRoundJoinSubdivisions);break;case "bevel":this._extruder=new I.MiterExtruder(0,1);break;case "miter":this._extruder=new I.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new I.SimpleExtruder}U=this.symbolLayer.cap||"butt";switch(U){case "none":this._startCap=new E.NoCapBuilder;this._endCap=new E.NoCapBuilder;break;default:this._startCap=new E.TriangulationCapBuilder(this._profile,
0);this._endCap=new E.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new E.TriangulationCapBuilder(this._profile,-.5);this._endCap=new E.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":W="quad"===W,this._startCap=new E.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:W,subdivisions:w.pathNumRoundCapExtrusionSubdivisions}),this._endCap=new E.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:W,subdivisions:w.pathNumRoundCapExtrusionSubdivisions})}var ca=
this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);W=d.fromArray(ca);ca=ca[3];const X=1>ca||this.needsDrivenTransparentPass;U={diffuse:W,ambient:W,opacity:ca,transparent:X,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:X||"none"===U?D.CullFaceOptions.None:D.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(m.set(this._intrinsicSize,Q,V),!t.isValidSize(this._intrinsicSize[0])||!t.isValidSize(this._intrinsicSize[1])))throw new n("graphics3dpathsymbollayer:invalid-size",
"Symbol sizes may not be negative values");this._fastUpdates?.visualVariables.size||m.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates?(Q={...U,...this._fastUpdates.materialParameters,size:g.fromArray(this._intrinsicSize)},this._materials[0]=new M.PathMaterial(Q)):(U.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,U.normalType=y.NormalType.Compressed,this._materials[0]=new F.DefaultMaterial(U));this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._context.stage.add(this._materials[0])}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials[0]=null;this._materials.length=0}createGraphics3DGraphic(Q){const V=Q.graphic;if(!this._validateGeometry(V.geometry,P,this.symbolLayer.type))return null;const U=this.setGraphicElevationContext(V);return this._createAs3DShape(V,Q.renderingInfo,U,V.uid)}layerOpacityChanged(){const Q=this._getCombinedOpacity(this.symbolLayer?.material?.color),V=1>Q||this.needsDrivenTransparentPass;
this._materials[0]?.setParameters({opacity:Q,transparent:V})}layerElevationInfoChanged(Q,V){return this.updateGraphics3DGraphicElevationInfo(Q,V,r.needsElevationUpdates3D)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){this._materials[0]?.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0}applyRendererDiff(Q,V){for(const U in Q.diff)switch(U){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,
V,this._vvConvertOptions))this._materials[0]?.setParameters(this._fastUpdates.materialParameters);else return q.ApplyRendererDiffResult.RecreateSymbol;break;default:return q.ApplyRendererDiffResult.RecreateSymbol}return q.ApplyRendererDiffResult.FastUpdate}_getVertexData(Q){let V=0;const U=Q.paths,W=[],ca=Q.spatialReference,X=this._context.elevationProvider.spatialReference,ba=this._context.renderCoordsHelper.spatialReference;for(var ia of U)V+=ia.length;ia=f.newDoubleArray(3*V);let fa=0;for(const da of U){W.push({offset:fa,
numVertices:da.length});for(const aa of da)ia[fa++]=aa[0],ia[fa++]=aa[1],ia[fa++]=Q.hasZ?aa[2]:0}if(null!=X&&!ca.equals(X)&&!c.projectBuffer(ia,ca,0,ia,X,0,V))return null;null==X||X.equals(ba)?Q=f.doubleArrayFrom(ia):(Q=f.newDoubleArray(3*V),c.projectBuffer(ia,X,0,Q,ba,0,V));return{pathVertexDataInfos:W,vertexDataES:ia,vertexDataRS:Q}}_createAs3DShape(Q,V,U,W){this.usedMemory=0;var ca=Q.geometry;const X=this._getVertexData(ca);if(null==X)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===X.pathVertexDataInfos.length)return 0!==ca.paths.length&&ca.paths.some(Z=>0<Z.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var ba=[];ca=ca.spatialReference;const ia=l.create(),fa=this._context.renderCoordsHelper,da=new v.SamplePosition(X.vertexDataES);for(const Z of X.pathVertexDataInfos){var aa=Z.numVertices;if(!(2>aa)){var ea=Z.offset;if(null!=this._context.clippingExtent&&(l.empty(ia),l.expandWithBuffer(ia,X.vertexDataES,
ea,aa),!l.intersectsClippingArea(ia,this._context.clippingExtent)))continue;var ha=[];aa=ea+3*aa;for(var Y=ea;Y<aa;Y+=3){da.offset=Y;const ja=r.evaluateElevationAlignmentAtPoint(da,this._context.elevationProvider,U,fa);e.set(O,X.vertexDataRS[Y],X.vertexDataRS[Y+1],X.vertexDataRS[Y+2]);fa.setAltitude(O,ja);X.vertexDataRS[Y]=O[0];X.vertexDataRS[Y+1]=O[1];X.vertexDataRS[Y+2]=O[2];ha.push(K.newPathVertex(this._upVectorAlignment))}ea=new A.Path(ha,X.vertexDataES,X.vertexDataRS,ea);S(ea,this._upVectorAlignment,
this._context.renderCoordsHelper);ea=new C.PathBuilder(ea,this._profile,this._extruder,this._startCap,this._endCap);ha=null;this._fastUpdates?(Y=this._fastUpdates.visualVariables,ha=u.getAttributeValue(Y.size?.field,Q)??0,aa=u.getAttributeValue(Y.color?.field,Q)??0,Y=u.getAttributeValue(Y.opacity?.field,Q)??0,ha=new J.FastUpdatePathGeometry(ea,ha,aa,Y)):(ha=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(aa=V.size,ha[0]*=N(aa[0],"symbol-value"===aa[2]?this.symbolLayer.height||
0:aa[2],this.symbolLayer.width||0),ha[1]*=N(aa[2],"symbol-value"===aa[0]?this.symbolLayer.width||0:aa[0],this.symbolLayer.height||0)),aa=void 0,this._drivenProperties.color&&(aa=V.color),this._drivenProperties.opacity&&null!=V.opacity&&(aa=aa?[aa[0],aa[1],aa[2],V.opacity]:[1,1,1,V.opacity]),Y=new J.StaticPathGeometry(ea),Y.bake(ha),aa&&Y.bakeVertexColors(aa),ha=Y);aa=ha.createGeometryData();Y=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:W,layerUid:this._context.layer.uid});
ha=new H.PathGeometry(this._materials[0],aa,ha,ca,this._stencilWidth,Y);ha.transformation=h.translate(k.create(),k.IDENTITY,ea.path.origin);ba.push(ha);this.usedMemory+=ea.usedMemory}}if(0===ba.length)return null;Q=new G.Object3D({geometries:ba,layerUid:this._context.layer.uid,graphicUid:W});ba=new x.Graphics3DObject3DGraphicLayer(this,Q,ba,null,null,(Z,ja,oa,qa,ta)=>{ja=this._upVectorAlignment;Z=Z.stageObject;oa=Z.geometries;var va=0;for(const Ba of oa){if(!H.isPathGeometry(Ba))continue;const pa=
Ba.path,Aa=pa.builder.path;var Ca=Aa,ma=qa,wa=ta;let ra=0;const {origin:ua,vertices:Ea,positions:Ka,positionsES:Ma}=Ca,Ua=Ca.offset+3*Ea.length;for(let Ga=Ca.offset;Ga<Ua;Ga+=3)e.set(O,Ma[Ga],Ma[Ga+1],Ma[Ga+2]),ma(O,T),ra+=T.sampledElevation,O[0]=Ka[Ga]+ua[0],O[1]=Ka[Ga+1]+ua[1],O[2]=Ka[Ga+2]+ua[2],wa.setAltitude(O,T.z),Ka[Ga]=O[0]-ua[0],Ka[Ga+1]=O[1]-ua[1],Ka[Ga+2]=O[2]-ua[2];Ca.updatePathVertexInformation();va+=ra/Ea.length;ja!==H.UpVectorAlignment.World&&S(Aa,ja,ta);pa.onPathChanged(Ba);Ba.invalidateBoundingInfo();
Z.geometryVertexAttributeUpdated(Ba,L.VertexAttribute.POSITION)}return va/oa.length},U);ba.alignedSampledElevation=0;ba.needsElevationUpdates=r.needsElevationUpdates3D(U.mode);return ba}}const O=d.create(),T=new r.SampleElevationInfo;a.Graphics3DPathSymbolLayer=R;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Path":function(){define(["exports","../../../../core/typedArrayUtil","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64",
"../../../../geometry/support/FloatArray"],function(a,b,n,h,k){class m{constructor(g,e,d,c){this.vertices=g;this.positionsES=e;this.offset=c;var l=g.length;c=this.offset+3*Math.floor(l/2);g=d[c];e=d[c+1];c=d[c+2];this.origin=h.fromValues(g,e,c);this.positions=k.newFloatArray(3*l);l=this.offset+3*l;for(let f=this.offset;f<l;f+=3)this.positions[f]=d[f]-g,this.positions[f+1]=d[f+1]-e,this.positions[f+2]=d[f+2]-c;this.updatePathVertexInformation()}get usedMemory(){return b.estimateSize(this.positions)}updatePathVertexInformation(){const g=
this.vertices.length;var e=this.vertices[0];let d=this.offset;const c=this.positions;e.vRight[0]=c[d+3]-c[d];e.vRight[1]=c[d+4]-c[d+1];e.vRight[2]=c[d+5]-c[d+2];d+=3;let l=n.length(e.vRight);e.vMinSiblingLength=l;n.normalize(e.vRight,e.vRight);var f=e;for(e=1;e<g;++e){const r=this.vertices[e];r.vLeft=f.vRight;e<g-1?(r.vRight[0]=c[d+3]-c[d],r.vRight[1]=c[d+4]-c[d+1],r.vRight[2]=c[d+5]-c[d+2],f=n.length(r.vRight),r.vMinSiblingLength=Math.min(l,f),l=f,n.normalize(r.vRight,r.vRight)):(n.copy(r.vRight,
r.vLeft),r.vMinSiblingLength=l);f=r;d+=3}}}a.Path=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathBuilder":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices"],function(a,b,n,h){class k{constructor(m,g,e,d,c,l={}){this.path=m;this.profile=g;this.extruder=e;this.startCap=d;this.endCap=c;this.options=l;this._extrusionVertexCount=0;d=this.path.vertices.length-
2;this.numExtrusionProfiles=e.numProfilesPerJoin()*d+2;this.numVerticesTotal=g.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.startCap.numVertices;this.endCap.vertexBufferStart=this.numVerticesTotal;this.numVerticesTotal+=this.endCap.numVertices;this.pathVertexData=h.newIntArray(1*this.numVerticesTotal);this.profileRightAxes=n.newFloatArray(4*this.numVerticesTotal);this.profileUpAxes=n.newFloatArray(4*this.numVerticesTotal);
this.profileVertexAndNormals=n.newFloatArray(4*this.numVerticesTotal);this.positions=n.floatSubArray(m.positions,m.offset,3*m.vertices.length);this._rebuildGeometry();this.buildTopology()}get usedMemory(){return b.estimateSize(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}emitVertex(m,g,e,d,c){const l=4*this._extrusionVertexCount;this.profileRightAxes[l]=g.right[0];this.profileRightAxes[l+1]=g.right[1];this.profileRightAxes[l+
2]=g.right[2];this.profileUpAxes[l]=g.up[0];this.profileUpAxes[l+1]=g.up[1];this.profileUpAxes[l+2]=g.up[2];this.profileVertexAndNormals[l]=e[0];this.profileVertexAndNormals[l+1]=e[1];this.profileVertexAndNormals[l+2]=d[0];this.profileVertexAndNormals[l+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=m;c?(m=this.path.vertices[m],g=m.maxStretchDistance,this.profileRightAxes[l+3]=m.rotationRight[0]*g,this.profileUpAxes[l+3]=m.rotationRight[1]*g):(this.profileRightAxes[l+3]=0,this.profileUpAxes[l+
3]=0);++this._extrusionVertexCount}emitCapVertex(m,g,e,d,c,l){const f=4*this._extrusionVertexCount;this.profileRightAxes[f]=g.right[0];this.profileRightAxes[f+1]=g.right[1];this.profileRightAxes[f+2]=g.right[2];this.profileRightAxes[f+3]=c;this.profileUpAxes[f]=g.up[0];this.profileUpAxes[f+1]=g.up[1];this.profileUpAxes[f+2]=g.up[2];this.profileUpAxes[f+3]=l;this.profileVertexAndNormals[f]=e[0];this.profileVertexAndNormals[f+1]=e[1];this.profileVertexAndNormals[f+2]=d[0];this.profileVertexAndNormals[f+
3]=d[1];this.pathVertexData[this._extrusionVertexCount]=m;++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const {positions:m,offset:g,vertices:e}=this.path;this.positions=n.floatSubArray(m,g,3*e.length);let d=0;const c=(f,r,x,w,p)=>this.emitCapVertex(d,f,r,x,w,p),l=(f,r,x,w)=>this.emitVertex(d,f,r,x,w);this.startCap.rebuildConnectingProfileGeometry(e[d],this.profile,c);for(d=1;d<e.length-1;++d)this.extruder.extrude(e[d],this.profile,l);this.endCap.rebuildConnectingProfileGeometry(e[d],
this.profile,c);d=0;this.startCap.rebuildCapGeometry(e[d],c);d=e.length-1;this.endCap.rebuildCapGeometry(e[d],c)}buildTopology(){const m=this.profile.vertices.length,g=this.profile.numSegments,e=this.numExtrusionProfiles-1;var d=g*e*6;this.startCap.indexBufferStart=d;this.startCap.firstProfileVertexIndex=0;d+=this.startCap.numIndices;this.endCap.indexBufferStart=d;this.endCap.firstProfileVertexIndex=m*(this.numExtrusionProfiles-1);const c=[],l=[],f=[];d=(r,x,w)=>{c.push(r);c.push(x);c.push(w);l.push(r);
l.push(x);l.push(w);f.push(this.pathVertexData[r]);f.push(this.pathVertexData[x]);f.push(this.pathVertexData[w])};for(let r=0;r<g;++r){const x=this.profile.indices[2*r],w=this.profile.indices[2*r+1];for(let p=0;p<e;++p){const t=p*m+x,q=(p+1)*m+w,u=p*m+w;d(t,(p+1)*m+x,q);d(t,q,u)}}this.startCap.buildTopology(this.path.vertices[0],d);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],d);this.vertexIndices=h.compactIndices(c);this.normalIndices=h.compactIndices(l);this.pathVertexIndices=
h.compactIndices(f)}onPathChanged(){this._rebuildGeometry()}}a.PathBuilder=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathCapBuilder":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64"],function(a,b,n){class h{rebuildConnectingProfileGeometry(c,l,f){for(let r=0;r<l.vertices.length;++r)f(c.frame,l.vertices[r],l.normals[r],0,0)}}class k extends h{constructor(){super();
this.numIndices=this.numVertices=0}rebuildCapGeometry(){}buildTopology(){}}class m extends h{constructor(c,l=0,f=!1){super();this.profile=c;this.profilePlaneOffset=l;this.flip=f}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(c,l,f){const r=this.profilePlaneOffset;for(let x=0;x<l.vertices.length;++x)f(c.frame,l.vertices[x],l.normals[x],r,0)}rebuildCapGeometry(c,l){const f=this.profile,r=this.flip?1:-1,x=this.profilePlaneOffset,
w=d;b.set(w,0,0);for(let p=0;p<f.vertices.length;++p)l(c.frame,f.vertices[p],w,x,r)}buildTopology(c,l){c=this.profile;const f=this.vertexBufferStart+c.indices[0];for(let r=1;r<c.numSegments;++r){const x=this.vertexBufferStart+c.indices[2*r],w=this.vertexBufferStart+c.indices[2*r+1];this.flip?l(w,x,f):l(f,x,w)}}}class g extends h{constructor(c){super();this.flip=!1;this.sign=0;this.breakNormals=!1;this.numSegments=3;this.profile=c.profile;this.sign=(this.flip=c.flip)?1:-1;this.breakNormals=c.breakNormals;
this.numSegments=c.subdivisions}get numVertices(){let c=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;this.breakNormals&&(c+=this.profile.vertices.length);return c}get numIndices(){let c;const l=this.profile;c=2*l.numSegments*(this.numSegments-1);for(let f=0;f<l.numSegments;++f)c=l.poleIndices[l.indices[2*f]]===l.poleIndices[l.indices[2*f+1]]?c+1:c+2;return 3*c}rebuildCapGeometry(c,l){const f=this.profile;c=c.frame;const r=.5*this.sign,x=e,w=d;b.set(w,0,0);for(var p of f.poles)p.normal?
l(c,p.position,p.normal,r,0):l(c,p.position,w,r,this.sign);if(this.breakNormals)for(p=0;p<f.vertices.length;++p)l(c,f.vertices[p],f.normals[p],0,0);for(p=0;p<this.numSegments-1;++p){var t=(1-(p+1)/this.numSegments)*Math.PI*.5;const q=Math.sin(t);t=Math.cos(t);for(let u=0;u<f.vertices.length;++u){const v=f.poles[f.poleIndices[u]];b.subtract(x,f.vertices[u],v.position);b.scale(x,x,q);v.normal?(b.add(x,x,v.position),l(c,x,v.normal,r*t,0)):(b.normalize(w,x),b.scale(w,w,q),b.add(x,x,v.position),l(c,x,
w,r*t,this.sign*t))}}}buildTopology(c,l){c=this.profile;const f=this.breakNormals?this.vertexBufferStart+c.poles.length:this.firstProfileVertexIndex,r=this.breakNormals?this.vertexBufferStart+c.poles.length+c.vertices.length:this.vertexBufferStart+c.poles.length;for(let x=0;x<c.numSegments;++x){const w=c.indices[2*x],p=c.indices[2*x+1],t=this.vertexBufferStart+c.poleIndices[w],q=this.vertexBufferStart+c.poleIndices[p];let u=f+w,v=f+p;for(let y=0;y<this.numSegments-1;++y){const D=r+y*c.vertices.length+
w,G=r+y*c.vertices.length+p;this.flip?(l(D,v,u),l(v,D,G)):(l(u,v,D),l(G,D,v));u=D;v=G}this.flip?(l(t,v,u),t!==q&&l(t,q,v)):(l(u,v,t),t!==q&&l(v,q,t))}}}const e=n.create(),d=n.create();a.NoCapBuilder=k;a.PathCapBuilder=h;a.RoundCapBuilder=g;a.TriangulationCapBuilder=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathExtruder":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64".split(" "),
function(a,b,n,h,k,m,g){class e{}class d{numProfilesPerJoin(){return 1}extrude(w,p,t){for(let q=0;q<p.vertices.length;++q)t(w.frame,p.vertices[q],p.normals[q],!1)}}class c{constructor(w,p){this.cutoffAngle=w;this.numBendSubdivisions=p}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(w,p,t){var q=x;const {rotationAngle:u,rotationRight:v,frame:y}=w;if(Math.abs(u)>=this.cutoffAngle){var D=w.rotationFrameUp;for(var G=0;G<this.numBendSubdivisions+1;++G){b.fromRotation(r,.5*-u+G*u/this.numBendSubdivisions,
D);var A=q,C=y,E=r;m.transformMat4(A.up,C.up,E);m.transformMat4(A.right,C.right,E);for(A=0;A<p.vertices.length;++A)0<=h.dot(p.vertices[A],v)*u?t(q,p.vertices[A],p.normals[A],!1):(C=w.applyMiterStretch(f,p.vertices[A]),t(y,C,p.normals[A],!0))}}else for(q=0;q<this.numBendSubdivisions+1;++q)for(D=0;D<p.vertices.length;++D)G=0<=h.dot(p.vertices[D],v)*u,A=w.applyMiterStretch(f,p.vertices[D]),t(y,A,p.normals[D],!G)}}class l{constructor(){this.up=g.create();this.right=g.create()}}const f=k.create(),r=n.create(),
x=new l;a.Frame2D=l;a.MiterExtruder=c;a.PathExtruder=e;a.SimpleExtruder=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","./ContentObjectType","./Geometry"],function(a,b,n){class h extends n.Geometry{constructor(k,m,g,e,d,c){super(k,m,null,b.ContentObjectType.Mesh,c);this.path=g;this.geometrySR=e;this.stencilWidth=d}}a.UpVectorAlignment=void 0;(function(k){k[k.World=0]="World";k[k.Path=1]="Path"})(a.UpVectorAlignment||
(a.UpVectorAlignment={}));a.PathGeometry=h;a.isPathGeometry=function(k){return"path"in k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathGeometryData":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/FloatArray ../../../../geometry/support/Indices ./Attribute ./Normals ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r{constructor(G){this.builder=G}onPathChanged(G){this.builder.onPathChanged()}}class x extends r{constructor(G){super(G);this.vertexAttributeColor=m.fromValues(255,255,255,255);this.size=[];this.vertexAttributePosition=g.newFloatArray(3*this.builder.numVerticesTotal);this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(G){this.vertexAttributeColor[0]=255*G[0];this.vertexAttributeColor[1]=255*G[1];this.vertexAttributeColor[2]=
255*G[2];this.vertexAttributeColor[3]=255*(3<G.length?G[3]:1)}bake(G){this.size=G;const {numVerticesTotal:A,pathVertexData:C,path:E,positions:I,profileRightAxes:H,profileUpAxes:J,profileVertexAndNormals:B}=this.builder;for(let F=0;F<A;++F){var z=C[F],K=0===z||z===E.vertices.length-1;z*=3;const M=v;let S=0,N=0;const P=4*F,R=h.set(y,H[P],H[P+1],H[P+2]),O=h.set(D,J[P],J[P+1],J[P+2]);var L=b.set(p,B[P]*G[0],B[P+1]*G[1]);if(K)h.cross(M,O,R),S=H[P+3]*G[0],N=J[P+3];else{K=t;const T=q;b.set(K,H[P+3],J[P+
3]);const Q=b.length(K);b.normalize(K,K);const V=b.dot(L,K);if(Math.abs(V)>Q){b.set(T,-K[1],K[0]);const U=b.dot(L,T);b.scale(K,K,Q*Math.sign(V));b.scale(T,T,U);b.add(L,K,T)}h.set(M,0,0,0)}L=h.set(u,R[0]*L[0]+O[0]*L[1],R[1]*L[0]+O[1]*L[1],R[2]*L[0]+O[2]*L[1]);K=3*F;this.vertexAttributePosition[K]=I[z]+L[0]+M[0]*S;this.vertexAttributePosition[K+1]=I[z+1]+L[1]+M[1]*S;this.vertexAttributePosition[K+2]=I[z+2]+L[2]+M[2]*S;z=b.set(p,B[P+2],B[P+3]);c.compressNormal(this.vertexAttributeNormal,F,R[0]*z[0]+
O[0]*z[1]+M[0]*N,R[1]*z[0]+O[1]*z[1]+M[1]*N,R[2]*z[0]+O[2]*z[1]+M[2]*N)}}createGeometryData(){const G=this.builder.vertexIndices.length,{normalIndices:A,vertexIndices:C}=this.builder;return[[l.VertexAttribute.POSITION,new d.Attribute(this.vertexAttributePosition,C,3,!0)],[l.VertexAttribute.NORMALCOMPRESSED,new d.Attribute(this.vertexAttributeNormal,A,2,!0)],[l.VertexAttribute.COLOR,new d.Attribute(this.vertexAttributeColor,e.getZeroIndexArray(G),4)]]}onPathChanged(G){super.onPathChanged(G);this.bake(this.size)}intersect(G,
A,C){const E=this.builder.vertexIndices,I=new d.Vertices(this.vertexAttributePosition,3);f.intersectTriangles(G,A,0,E.length/3,E,I,void 0,void 0,C)}}class w extends r{constructor(G,A,C,E){super(G);this.sizeAttributeValue=A;this.colorAttributeValue=C;this.opacityAttributeValue=E;this.vvData=null;this.baked=new x(G);this.vvData=g.newFloatArray(4*this.builder.path.vertices.length);for(G=0;G<this.builder.path.vertices.length;++G)this.vvData[4*G]=A,this.vvData[4*G+1]=C,this.vvData[4*G+2]=E,this.vvData[4*
G+3]=0===G||G===this.builder.path.vertices.length-1?1:0}createGeometryData(){const {positions:G,profileRightAxes:A,profileUpAxes:C,profileVertexAndNormals:E,pathVertexIndices:I,vertexIndices:H}=this.builder;return[[l.VertexAttribute.POSITION,new d.Attribute(G,I,3,!0)],[l.VertexAttribute.PROFILERIGHT,new d.Attribute(A,H,4,!0)],[l.VertexAttribute.PROFILEUP,new d.Attribute(C,H,4,!0)],[l.VertexAttribute.PROFILEVERTEXANDNORMAL,new d.Attribute(E,H,4,!0)],[l.VertexAttribute.FEATUREVALUE,new d.Attribute(this.vvData,
I,4,!0)]]}onPathChanged(G){super.onPathChanged(G);if(G=G.getMutableAttribute(l.VertexAttribute.POSITION))G.data=this.builder.positions}}const p=n.create(),t=n.create(),q=n.create(),u=k.create(),v=k.create(),y=k.create(),D=k.create();a.FastUpdatePathGeometry=w;a.PathGeometryData=r;a.StaticPathGeometry=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil".split(" "),
function(a,b,n,h,k,m){const g=n.create();a.computeMinimumRotationTangentFrame=function(e,d){let c=null;const l=e.vertices.length,f=n.create(),r=n.create(),x=n.create(),w=n.create(),p=n.create(),t=n.create(),q=h.create();let u=e.vertices[0];b.copy(r,d);b.set(f,0,1,0);m.makeOrthoBasisDirUpFallback(u.vRight,r,f,f,x,r,.99619469809);b.copy(u.frame.up,r);b.copy(u.frame.right,x);d=e.positions;let v=e.offset;c=u;for(let D=1;D<l;++D){u=e.vertices[D];b.add(p,u.vLeft,u.vRight);var y=b.length(p);0<y?(y=1/Math.sqrt(y),
p[0]*=y,p[1]*=y,p[2]*=y):(p[0]=u.vRight[0],p[1]=u.vRight[1],p[2]=u.vRight[2]);t[0]=d[v]+c.frame.up[0];t[1]=d[v+1]+c.frame.up[1];t[2]=d[v+2]+c.frame.up[2];v+=3;y=b.set(g,d[v],d[v+1],d[v+2]);h.fromPositionAndNormal(y,p,q);h.intersectRay(q,k.wrap(t,u.vLeft),w)?(w[0]-=d[v],w[1]-=d[v+1],w[2]-=d[v+2],b.normalize(r,w),b.cross(x,p,r),b.normalize(x,x)):m.makeOrthoBasisDirUpFallback(p,c.frame.up,c.frame.right,f,x,r,.99619469809);b.copy(u.frame.up,r);b.copy(u.frame.right,x);c=u}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathProfile":function(){define(["exports","../../../../core/typedArrayUtil","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../layers/graphics/Graphics3DPathSymbolLayerConstants"],function(a,b,n,h){function k(l){const f=h.pathNumCircleProfileSubdivisions,r=new g,x={v0:0,v1:0};r.addPole(n.fromValues(0,0));for(var w=0;w<f;++w){var p=2*w*Math.PI/f,t=Math.cos(p);const q=Math.sin(p);p=n.fromValues(.5*t,.5*q);t=n.fromValues(t,q);r.addVertex(p,
t)}for(w=0;w<f-1;++w)r.addSegment({v0:w,v1:w+1},x);r.addSegment({v0:f-1,v1:0},x);"center"!==l&&(l=e[l],r.translate(l[0],l[1]));return r}function m(l){const f=new g,r=n.fromValues(-.5,-.5),x=n.fromValues(.5,-.5),w=n.fromValues(.5,.5),p=n.fromValues(-.5,.5),t=n.fromValues(0,-1),q=n.fromValues(1,0),u=n.fromValues(0,1),v=n.fromValues(-1,0);f.addPole(n.fromValues(0,.5),u);f.addPole(n.fromValues(0,.5));f.addPole(n.fromValues(0,-.5));f.addPole(n.fromValues(0,-.5),t);f.addVertex(r,t);f.addVertex(x,t);f.addSegment({v0:0,
v1:1},{v0:3,v1:3});f.addVertex(x,q);f.addVertex(w,q);f.addSegment({v0:2,v1:3},{v0:2,v1:1});f.addVertex(w,u);f.addVertex(p,u);f.addSegment({v0:4,v1:5},{v0:0,v1:0});f.addVertex(p,v);f.addVertex(r,v);f.addSegment({v0:6,v1:7},{v0:1,v1:2});"center"!==l&&(l=e[l],f.translate(l[0],l[1]));return f}class g{constructor(){this.vertices=[];this.normals=[];this.indices=[];this.poles=[];this.poleIndices=[]}addVertex(l,f){this.vertices.push(n.clone(l));this.normals.push(n.clone(f));return this.vertices.length-1}addPole(l,
f=null){this.poles.push({position:n.clone(l),normal:f?n.clone(f):null});return this.poles.length-1}addSegment(l,f=null){this.indices.push(l.v0);this.indices.push(l.v1);f&&(this.poleIndices.push(f.v0),this.poleIndices.push(f.v1))}get numSegments(){return this.indices.length/2}translate(l,f){for(const r of this.vertices)r[0]+=l,r[1]+=f;for(const r of this.poles)r.position[0]+=l,r.position[1]+=f}get usedMemory(){return this.vertices.length*b.estimateSize(this.vertices[0])*2+b.estimateSize(this.indices)}}
const e={top:[0,-.5],bottom:[0,.5]},d={center:k("center"),top:k("top"),bottom:k("bottom")},c={center:m("center"),top:m("top"),bottom:m("bottom")};a.PathProfile=g;a.circleProfiles=d;a.quadProfiles=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/PathVertex":function(){define("exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/math/mat2 ../../../../core/libs/gl-matrix-2/factories/mat2f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ./PathExtruder ./PathGeometry".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(){this.vLeft=e.create();this.vRight=e.create();this.vMinSiblingLength=0;this.frame=new d.Frame2D}setFrameFromUpVector(C){g.copy(this.frame.up,C);g.add(D,this.vLeft,this.vRight);g.normalize(D,D);g.scale(y,this.frame.up,g.dot(D,this.frame.up));g.subtract(G,D,y);g.normalize(G,G);g.cross(this.frame.right,G,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class f extends l{get rotationFrameUp(){return this.frame.up}get rotationRight(){return m.UNIT_X}get rotationAngle(){g.scale(u,
this.frame.up,g.dot(this.frame.up,this.vLeft));g.subtract(u,this.vLeft,u);g.negate(u,u);g.normalize(u,u);g.scale(v,this.frame.up,g.dot(this.frame.up,this.vRight));g.subtract(v,this.vRight,v);g.normalize(v,v);g.cross(q,this.rotationFrameUp,this.vLeft);return Math.sign(g.dot(q,this.vRight))*(Math.PI-b.acosClamped(g.dot(u,v)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(C,E){var I=this.rotationAngle;if(0>=Math.abs(I))return E;I=b.reciprocalClamped(Math.cos(.5*
I));return k.set(C,(1+(I-1))*E[0],E[1])}}class r extends l{get rotationFrameUp(){const C=Math.sign(g.dot(this.frame.right,this.vRight));g.cross(x,this.vRight,this.vLeft);g.scale(x,x,C);return g.normalize(x,x)}get rotationRight(){var C=this.rotationFrameUp,E=g.dot(C,this.frame.up);C=g.dot(C,this.frame.right);g.scale(p,this.frame.up,-C);g.scale(t,this.frame.right,E);g.add(p,p,t);g.normalize(p,p);E=this.frame;C=p;k.set(w,g.dot(C,E.right),g.dot(C,E.up));return w}get rotationAngle(){const C=Math.sign(g.dot(this.frame.right,
this.vRight));g.negate(q,this.vLeft);return-C*(Math.PI-b.acosClamped(g.dot(q,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*b.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(C,E){var I=this.rotationAngle;if(0===Math.abs(I))return E;I=b.reciprocalClamped(Math.cos(.5*I));const H=this.rotationRight;I=n.set(A,1+(I-1)*H[0]*H[0],(I-1)*H[0]*H[1],(I-1)*H[0]*H[1],1+(I-1)*H[1]*H[1]);return k.transformMat2(C,E,I)}}const x=e.create(),w=m.create(),p=e.create(),
t=e.create(),q=e.create(),u=e.create(),v=e.create(),y=e.create(),D=e.create(),G=e.create(),A=h.create();a.PathVertex=l;a.newPathVertex=function(C){switch(C){case c.UpVectorAlignment.World:return new f;case c.UpVectorAlignment.Path:return new r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["exports","./common"],function(a,b){function n(C,E){C[0]=E[0];C[1]=E[1];C[2]=E[2];C[3]=E[3];return C}function h(C){C[0]=1;C[1]=0;C[2]=
0;C[3]=1;return C}function k(C,E,I,H,J){C[0]=E;C[1]=I;C[2]=H;C[3]=J;return C}function m(C,E){if(C===E){const I=E[1];C[1]=E[2];C[2]=I}else C[0]=E[0],C[1]=E[2],C[2]=E[1],C[3]=E[3];return C}function g(C,E){const I=E[0],H=E[1],J=E[2];E=E[3];let B=I*E-J*H;if(!B)return null;B=1/B;C[0]=E*B;C[1]=-H*B;C[2]=-J*B;C[3]=I*B;return C}function e(C,E){const I=E[0];C[0]=E[3];C[1]=-E[1];C[2]=-E[2];C[3]=I;return C}function d(C){return C[0]*C[3]-C[2]*C[1]}function c(C,E,I){const H=E[0],J=E[1],B=E[2];E=E[3];const z=I[0],
K=I[1],L=I[2];I=I[3];C[0]=H*z+B*K;C[1]=J*z+E*K;C[2]=H*L+B*I;C[3]=J*L+E*I;return C}function l(C,E,I){const H=E[0],J=E[1],B=E[2];E=E[3];const z=Math.sin(I);I=Math.cos(I);C[0]=H*I+B*z;C[1]=J*I+E*z;C[2]=H*-z+B*I;C[3]=J*-z+E*I;return C}function f(C,E,I){const H=E[1],J=E[2],B=E[3],z=I[0];I=I[1];C[0]=E[0]*z;C[1]=H*z;C[2]=J*I;C[3]=B*I;return C}function r(C,E){const I=Math.sin(E);E=Math.cos(E);C[0]=E;C[1]=I;C[2]=-I;C[3]=E;return C}function x(C,E){C[0]=E[0];C[1]=0;C[2]=0;C[3]=E[1];return C}function w(C){return"mat2("+
C[0]+", "+C[1]+", "+C[2]+", "+C[3]+")"}function p(C){return Math.sqrt(C[0]**2+C[1]**2+C[2]**2+C[3]**2)}function t(C,E,I,H){C[2]=H[2]/H[0];I[0]=H[0];I[1]=H[1];I[3]=H[3]-C[2]*I[1];return[C,E,I]}function q(C,E,I){C[0]=E[0]+I[0];C[1]=E[1]+I[1];C[2]=E[2]+I[2];C[3]=E[3]+I[3];return C}function u(C,E,I){C[0]=E[0]-I[0];C[1]=E[1]-I[1];C[2]=E[2]-I[2];C[3]=E[3]-I[3];return C}function v(C,E){return C[0]===E[0]&&C[1]===E[1]&&C[2]===E[2]&&C[3]===E[3]}function y(C,E){const I=C[0],H=C[1],J=C[2];C=C[3];const B=E[0],
z=E[1],K=E[2];E=E[3];const L=b.getEpsilon();return Math.abs(I-B)<=L*Math.max(1,Math.abs(I),Math.abs(B))&&Math.abs(H-z)<=L*Math.max(1,Math.abs(H),Math.abs(z))&&Math.abs(J-K)<=L*Math.max(1,Math.abs(J),Math.abs(K))&&Math.abs(C-E)<=L*Math.max(1,Math.abs(C),Math.abs(E))}function D(C,E,I){C[0]=E[0]*I;C[1]=E[1]*I;C[2]=E[2]*I;C[3]=E[3]*I;return C}function G(C,E,I,H){C[0]=E[0]+I[0]*H;C[1]=E[1]+I[1]*H;C[2]=E[2]+I[2]*H;C[3]=E[3]+I[3]*H;return C}const A=Object.freeze(Object.defineProperty({__proto__:null,LDU:t,
add:q,adjoint:e,copy:n,determinant:d,equals:y,exactEquals:v,frob:p,fromRotation:r,fromScaling:x,identity:h,invert:g,mul:c,multiply:c,multiplyScalar:D,multiplyScalarAndAdd:G,rotate:l,scale:f,set:k,str:w,sub:u,subtract:u,transpose:m},Symbol.toStringTag,{value:"Module"}));a.LDU=t;a.add=q;a.adjoint=e;a.copy=n;a.determinant=d;a.equals=y;a.exactEquals=v;a.frob=p;a.fromRotation=r;a.fromScaling=x;a.identity=h;a.invert=g;a.mat2=A;a.mul=c;a.multiply=c;a.multiplyScalar=D;a.multiplyScalarAndAdd=G;a.rotate=l;
a.scale=f;a.set=k;a.str=w;a.sub=u;a.subtract=u;a.transpose=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function n(g){return[g[0],g[1],g[2],g[3]]}function h(g,e,d,c){return[g,e,d,c]}function k(g,e){return new Float64Array(g,e,4)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:b,createView:k,fromValues:h},Symbol.toStringTag,{value:"Module"}));
a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.mat2f64=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends e.Material{constructor(q){super(q,new t);this.supportsEdges=!0;this.produces=new Map([[c.RenderSlot.OPAQUE_MATERIAL,u=>(this.parameters.castShadows&&k.isShadowRelatedOutput(u)||k.is3DGeometryOutput(u))&&!this.parameters.transparent],[c.RenderSlot.TRANSPARENT_MATERIAL,u=>(this.parameters.castShadows&&k.isShadowRelatedOutput(u)||k.is3DGeometryOutput(u))&&this.parameters.transparent]]);this._vertexAttributeLocations=r.vertexAttributeLocations;this._configuration=
new r.PathTechniqueConfiguration;this._vertexBufferLayout=w.getVertexBufferLayout()}getConfiguration(q,u){this._configuration.output=q;this._configuration.vvSize=!!this.parameters.vvSize;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.vvOpacity=!!this.parameters.vvOpacity;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(q===k.ShaderOutput.Color||
q===k.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?m.NormalsDoubleSidedMode.WindingOrder:m.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=u.ssao;this._configuration.transparencyPassType=u.transparencyPassType;this._configuration.multipassEnabled=
u.multipassEnabled;this._configuration.cullAboveGround=u.multipassTerrain.cullAboveGround;return this._configuration}isVisibleForOutput(q){return q===k.ShaderOutput.Shadow||q===k.ShaderOutput.ShadowExcludeHighlight||q===k.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0}isVisible(){return super.isVisible()&&0<this.parameters.opacity}intersect(q,u,v,y,D,G){if(d.isPathGeometry(q)){u=q.path;var A=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const {offset:I,
factor:H,minSize:J,maxSize:B}=this.parameters.vvSize;var C=u.sizeAttributeValue;A[0]*=b.clamp(I[0]+C*H[0],J[0],B[0]);A[1]*=b.clamp(I[2]+C*H[2],J[2],B[2])}C=Math.max(A[0],A[1]);q=q.boundingInfo;if(null==q)this._intersectTriangles(u,A,y,D,G);else{q=n.fromValues(q.bbMin[0]-C,q.bbMin[1]-C,q.bbMin[2]-C,q.bbMax[0]+C,q.bbMax[1]+C,q.bbMax[2]+C);C=[D[0]-y[0],D[1]-y[1],D[2]-y[2]];var E=Math.sqrt(C[0]*C[0]+C[1]*C[1]+C[2]*C[2]);x.intersectAabbInvDir(q,y,[E/C[0],E/C[1],E/C[2]],v.tolerance)&&this._intersectTriangles(u,
A,y,D,G)}}}_intersectTriangles(q,u,v,y,D){q.baked.size&&q.baked.size[0]===u[0]&&q.baked.size[1]===u[1]||q.baked.bake(u);q.baked.intersect(v,y,D)}createBufferWriter(){return new f.DefaultBufferWriter(this._vertexBufferLayout)}createGLMaterial(q){return new p(q)}static getVertexBufferLayout(){return h.newLayout().vec3f(l.VertexAttribute.POSITION).vec4f(l.VertexAttribute.PROFILERIGHT).vec4f(l.VertexAttribute.PROFILEUP).vec4f(l.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(l.VertexAttribute.FEATUREVALUE)}}
class p extends g{_updateOccludeeState(q){q.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:q.hasOccludees})}_updateShadowState(q){null!=this.technique&&q.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:q.shadowMap.enabled})}beginSlot(q){if(this._output===k.ShaderOutput.Color||this._output===k.ShaderOutput.Alpha)this._updateShadowState(q),this._updateOccludeeState(q);return this.ensureTechnique(r.PathTechnique,
q)}}class t extends r.PathPassParameters{constructor(){super(...arguments);this.doubleSided=!1;this.doubleSidedType="normal";this.receiveShadows=!1;this.castShadows=!0;this.hasOccludees=this.transparent=this.hasSlicePlane=!1}}a.PathMaterial=w;a.PathMaterialParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){const y=new Map([[t.VertexAttribute.POSITION,0],[t.VertexAttribute.PROFILERIGHT,1],[t.VertexAttribute.PROFILEUP,2],[t.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[t.VertexAttribute.FEATUREVALUE,4]]);class D extends g.PathVertexPositionPassParameters{constructor(){super(...arguments);this.ambient=h.fromValues(.2,.2,.2);this.diffuse=h.fromValues(.8,.8,.8);this.specular=h.fromValues(0,0,0);this.opacity=1;this.origin=h.create();this.modelTransformation=
null}}class G extends l.ShaderTechnique{initializeConfiguration(C,E){E.spherical=C.viewingMode===k.ViewingMode.Global;E.doublePrecisionRequiresObfuscation=C.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(C){return new x.Program(C.rctx,G.shader.get().build(this.configuration),y)}initializePipeline(){const C=this.configuration.transparencyPassType,E=this.configuration,I=C===p.TransparencyPassType.NONE,H=C===p.TransparencyPassType.FrontFace;return v.makePipelineState({blending:E.output!==
m.ShaderOutput.Color&&E.output!==m.ShaderOutput.Alpha||!E.transparent?null:I?r.blendingDefault:r.oitBlending(C),culling:E.hasSlicePlane&&!E.transparent&&E.doubleSidedMode!==e.NormalsDoubleSidedMode.None?v.frontFaceCullingParams:null,depthTest:{func:r.oitDepthTest(C)},depthWrite:I||H?v.defaultDepthWriteParams:null,colorWrite:v.defaultColorWriteParams,stencilWrite:E.hasOccludees?w.stencilWriteMaskOn:null,stencilTest:E.hasOccludees?w.stencilBaseAllZerosParams:null,polygonOffset:I||H?null:r.OITPolygonOffset})}}
G.shader=new c.ReloadableShaderModule(u.Path,()=>new Promise((C,E)=>a(["../shaders/Path.glsl"],C,E)));class A extends q.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=m.ShaderOutput.Color;this.doubleSidedMode=e.NormalsDoubleSidedMode.None;this.transparencyPassType=p.TransparencyPassType.NONE;this.doublePrecisionRequiresObfuscation=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.transparent=this.hasSlicePlane=this.vvOpacity=this.vvColor=this.vvSize=this.receiveAmbientOcclusion=
this.receiveShadows=this.spherical=!1}}n.__decorate([f.parameter({count:m.ShaderOutput.COUNT})],A.prototype,"output",void 0);n.__decorate([f.parameter({count:e.NormalsDoubleSidedMode.COUNT})],A.prototype,"doubleSidedMode",void 0);n.__decorate([f.parameter({count:p.TransparencyPassType.COUNT})],A.prototype,"transparencyPassType",void 0);n.__decorate([f.parameter()],A.prototype,"spherical",void 0);n.__decorate([f.parameter()],A.prototype,"receiveShadows",void 0);n.__decorate([f.parameter()],A.prototype,
"receiveAmbientOcclusion",void 0);n.__decorate([f.parameter()],A.prototype,"vvSize",void 0);n.__decorate([f.parameter()],A.prototype,"vvColor",void 0);n.__decorate([f.parameter()],A.prototype,"vvOpacity",void 0);n.__decorate([f.parameter()],A.prototype,"hasSlicePlane",void 0);n.__decorate([f.parameter()],A.prototype,"transparent",void 0);n.__decorate([f.parameter()],A.prototype,"hasOccludees",void 0);n.__decorate([f.parameter()],A.prototype,"multipassEnabled",void 0);n.__decorate([f.parameter()],
A.prototype,"cullAboveGround",void 0);n.__decorate([f.parameter()],A.prototype,"doublePrecisionRequiresObfuscation",void 0);n.__decorate([f.parameter({constValue:!1})],A.prototype,"occlusionPass",void 0);n.__decorate([f.parameter({constValue:d.PBRMode.Disabled})],A.prototype,"pbrMode",void 0);n.__decorate([f.parameter({constValue:!0})],A.prototype,"hasVvInstancing",void 0);n.__decorate([f.parameter({constValue:!1})],A.prototype,"useCustomDTRExponentForWater",void 0);n.__decorate([f.parameter({constValue:!1})],
A.prototype,"useFillLights",void 0);n.__decorate([f.parameter({constValue:!1})],A.prototype,"hasColorTexture",void 0);b.PathPassParameters=D;b.PathTechnique=G;b.PathTechniqueConfiguration=A;b.vertexAttributeLocations=y;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends c.VisualVariablePassParameters{constructor(){super(...arguments);this.size=b.fromValues(1,1)}}a.PathVertexPosition=function(f,r){const x=d.VertexAttribute.FEATUREVALUE;f.attributes.add(x,"vec4");const w=f.vertex;w.code.add(e.glsl`
  bool isCapVertex() {
    return ${x}.w == 1.0;
  }
  `);w.uniforms.add(new h.Float2PassUniform("size",p=>p.size));r.vvSize?(w.uniforms.add(new k.Float3PassUniform("vvSizeMinSize",p=>p.vvSize.minSize),new k.Float3PassUniform("vvSizeMaxSize",p=>p.vvSize.maxSize),new k.Float3PassUniform("vvSizeOffset",p=>p.vvSize.offset),new k.Float3PassUniform("vvSizeFactor",p=>p.vvSize.factor)),w.code.add(e.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${x}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):w.code.add(e.glsl`vec2 getSize(){
return size;
}`);r.vvOpacity?(w.constants.add("vvOpacityNumber","int",8),w.uniforms.add(new g.FloatsPassUniform("vvOpacityValues",p=>p.vvOpacity.values,8),new g.FloatsPassUniform("vvOpacityOpacities",p=>p.vvOpacity.opacityValues,8)),w.code.add(e.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${x}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):w.code.add(e.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);r.vvColor?(w.constants.add("vvColorNumber","int",c.vvColorNumber),w.uniforms.add(new g.FloatsPassUniform("vvColorValues",p=>p.vvColor.values,c.vvColorNumber),new m.Float4sPassUniform("vvColorColors",p=>p.vvColor.colors,c.vvColorNumber)),w.code.add(e.glsl`
    vec4 getColor() {
      float value = ${x}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):w.code.add(e.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);f.include(n.PositionAttribute);f.attributes.add(d.VertexAttribute.PROFILERIGHT,"vec4");f.attributes.add(d.VertexAttribute.PROFILEUP,"vec4");f.attributes.add(d.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");w.code.add(e.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);w.code.add(e.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);w.code.add(e.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);w.code.add(e.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(C){const E=new y.ShaderBuilder,{vertex:I,fragment:H}=E;t.addProjViewLocalOrigin(I,C);E.varyings.add("vpos","vec3");E.include(m.PathVertexPosition,C);if(C.output===n.ShaderOutput.Color||C.output===n.ShaderOutput.Alpha)E.include(k.Transform,C),E.include(w.ReadShadowMapDraw,C),E.include(b.ForwardLinearDepth,C),E.varyings.add("vnormal","vec3"),E.varyings.add("vcolor","vec4"),C.multipassEnabled&&E.varyings.add("depth","float"),I.code.add(v.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${C.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${C.output===n.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);E.include(f.multipassTerrainTest,C);switch(C.output){case n.ShaderOutput.Alpha:E.include(h.SliceDraw,C);H.uniforms.add(new u.FloatPassUniform("opacity",J=>J.opacity));H.code.add(v.glsl`
      void main() {
        discardBySlice(vpos);
        ${C.multipassEnabled?"terrainDepthTest(depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case n.ShaderOutput.Color:E.include(h.SliceDraw,C);E.include(c.EvaluateSceneLighting,C);E.include(d.EvaluateAmbientOcclusion,C);E.include(w.ReadShadowMapDraw,C);E.include(r.Normals,C);t.addCameraPosition(H,C);c.addAmbientBoostFactor(H);c.addLightingGlobalFactor(H);H.uniforms.add(I.uniforms.get("localOrigin"),new q.Float3PassUniform("ambient",J=>J.ambient),new q.Float3PassUniform("diffuse",J=>J.diffuse),new q.Float3PassUniform("specular",J=>J.specular),new u.FloatPassUniform("opacity",
J=>J.opacity));H.include(p.ColorConversion);l.addMainLightIntensity(H);H.code.add(v.glsl`
        void main() {
          discardBySlice(vpos);
          ${C.multipassEnabled?"terrainDepthTest(depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${C.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":C.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${C.transparencyPassType===D.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
        }
      `);break;case n.ShaderOutput.LinearDepth:case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:E.include(k.Transform,C);b.addNearFar(E);E.varyings.add("depth","float");I.code.add(v.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);E.include(h.SliceDraw,C);E.include(g.OutputDepth,C);H.code.add(v.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case n.ShaderOutput.Normal:E.include(k.Transform,C);E.include(x.NormalUtils,C);t.addViewNormal(I);E.varyings.add("vnormal","vec3");I.code.add(v.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);E.include(h.SliceDraw,C);H.code.add(v.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case n.ShaderOutput.Highlight:E.include(k.Transform,C),E.include(x.NormalUtils,C),E.varyings.add("vnormal","vec3"),I.code.add(v.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),E.include(h.SliceDraw,C),E.include(e.OutputHighlight,C),H.code.add(v.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return E}const A=Object.freeze(Object.defineProperty({__proto__:null,build:G},Symbol.toStringTag,{value:"Module"}));a.Path=A;a.build=G})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(n,h){h.spherical?n.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):n.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);h.spherical?n.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):n.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../Color ../../../../core/screenUtils ../../../../chunks/earcut ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray ../../../../geometry/support/FloatArray ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./lineUtils ./polygonUtils ../support/FastSymbolUpdates ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){const E=["polyline","polygon","extent"],I=new p.ConvertOptions({size:!1,color:!0,rotation:!1,opacity:!1});class H extends l.Graphics3DSymbolLayer{constructor(L,F,M,S){super(L,F,M,S);this._needsUV=!1}async doLoad(){this._fastUpdates=p.initFastSymbolUpdatesState(this._context.renderer,I)}_createMaterials(){if(!(0<this._materials.length)){var L=this._getCombinedOpacityAndColor(this.symbolLayer?.material?.color);this._materials[K.Fill]=t.createMaterial(this.symbolLayer,
{color:L,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...this._fastUpdates?.materialParameters});this._needsUV=this._materials[K.Fill]instanceof A.PatternMaterial;L=this.symbolLayer.outline;if(this._isValidOutline(L)){const F=G.getStipplePatternForLinePattern(L.pattern);this._materials[K.Outline]=new C.RibbonLineMaterial({width:n.pt2px(L.size),color:this._getOutlineColor(),
hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:F,cap:x.parseCapType(L.patternCap||"butt")})}this._context.stage.addMany(this._materials)}}_isValidOutline(L){return null!=L?.size&&0<L.size&&null!=L.color&&(null==L.pattern||"style"!==L.pattern.type||"none"!==L.pattern.style)}destroy(){super.destroy();this._context.stage.removeMany(this._materials);this._materials.length=0}createGraphics3DGraphic(L){const F=L.graphic;if(!this._validateGeometry(F.geometry,
E,this.symbolLayer.type))return null;L=this._getVertexOpacityAndColor(L.renderingInfo,255);const M=this.setGraphicElevationContext(F);this.ensureDrapedStatus("on-the-ground"===M.mode);this._createMaterials();return this.draped?this._createAsOverlay(F,L):this._createAs3DShape(F,L,M)}applyRendererDiff(L,F){for(const M in L.diff)switch(M){case "visualVariables":if(p.updateFastSymbolUpdatesState(this._fastUpdates,F,I))this._materials[K.Fill]?.setParameters(this._fastUpdates.materialParameters);else return r.ApplyRendererDiffResult.RecreateSymbol;
break;default:return r.ApplyRendererDiffResult.RecreateSymbol}return r.ApplyRendererDiffResult.FastUpdate}layerOpacityChanged(){if(null!=this._materials[K.Fill]){var L=this._materials[K.Fill].parameters.color;const F=this._getCombinedOpacity(this.symbolLayer?.material?.color);this._materials[K.Fill].setParameters({color:[L[0],L[1],L[2],F],forceTransparentMode:this.needsDrivenTransparentPass})}null!=this._materials[K.Outline]&&(L=this._materials[K.Outline].parameters.color,this._materials[K.Outline].setParameters({color:[L[0],
L[1],L[2],this._getOutlineOpacity()]}))}layerElevationInfoChanged(L,F,M){const S=this._elevationContext.mode;M=e.elevationModeChangeUpdateType(H.elevationModeChangeTypes,M,S);if(M!==e.SymbolUpdateType.UPDATE)return M;const N=e.needsElevationUpdates2D(S);return this.updateGraphics3DGraphicElevationInfo(L,F,()=>N)}slicePlaneEnabledChanged(){this._materials[K.Fill]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._materials[K.Outline]&&this._materials[K.Outline].setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(L,F,M){const S=w.geometryAsPolygon(L.geometry);if(!S)return null;var N=v.geometryToRenderInfo(S,this._context.elevationProvider,this._context.renderCoordsHelper,M);F=new B(N,F,this._context.layer.uid,L.uid);N=F.renderData.position.length/3;this._needsUV&&(F.uvMapSpace=g.newFloatArray(4*N,!0),F.boundingRect=m.newDoubleArray(9*N,!0),q.createMapSpaceUVCoords(F.uvMapSpace,F.boundingRect,F.renderData.position,this._context.renderCoordsHelper));
F.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(F);this._createAs3DShapeFill(L,F);this._materials[K.Outline]&&this._createAs3DShapeOutline(F);this._logGeometryCreationWarnings(F.renderData,S.rings,"rings","FillSymbol3DLayer");if(0===F.outGeometries.length)return null;L=new y.Object3D({geometries:F.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L.uid});L=new c.Graphics3DObject3DGraphicLayer(this,L,F.outGeometries,null,null,t.uvElevationAligner,
M);L.alignedSampledElevation=F.renderData.sampledElevation;L.needsElevationUpdates=e.needsElevationUpdates2D(M.mode);return L}_createAs3DShapeFill(L,F){var M=F.renderData.polygons;for(const {position:S,mapPositions:N,holeIndices:P,index:R,count:O}of M){if(null!=this._context.clippingExtent&&(k.empty(J),k.expandWithBuffer(J,N),!k.intersectsClippingArea(J,this._context.clippingExtent)))continue;M=w.createIndices3D(N,P,this._context.elevationProvider.spatialReference);if(0===M.length)continue;const T=
this._fastUpdates?.visualVariables.color;M=w.createColorGeometry({material:this._materials[K.Fill],indices:M,mapPositions:N,attributeData:{position:S,color:T?null:F.color,colorFeature:T?p.getAttributeValue(T.field,L):null,uvMapSpace:this._needsUV?g.floatSubArray(F.uvMapSpace,4*R,4*O):null,boundingRect:this._needsUV?m.doubleSubArray(F.boundingRect,9*R,9*O):null,objectAndLayerIdColor:F.objectAndLayerIdColor}});F.outGeometries.push(M)}}_createAs3DShapeOutline(L){if(null!=this._materials[K.Outline]){var F=
L.renderData.outlines;for(const {mapPositions:M,position:S}of F){if(null!=this._context.clippingExtent&&(k.empty(J),k.expandWithBuffer(J,M),!k.intersectsClippingArea(J,this._context.clippingExtent)))continue;F=u.createGeometry(this._materials[K.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:M,attributeData:{position:S}},L.objectAndLayerIdColor);L.outGeometries.push(F)}}}_createAsOverlay(L,F){const M=w.geometryAsPolygon(L.geometry);if(null==M)return null;this._materials[K.Fill].renderPriority=
this._renderPriority+this._renderPriorityStep/2;null!=this._materials[K.Outline]&&(this._materials[K.Outline].renderPriority=this._renderPriority);var S=v.geometryToRenderInfoDraped(M,this._context.overlaySR);F=new z(S,F,this._context.layer.uid,L.uid);S=F.renderData.position.length/3;this._needsUV&&(F.uvMapSpace=g.newFloatArray(4*S,!0),q.createMapSpaceUVCoordsDraped(F.uvMapSpace,F.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));F.outBoundingBox=
k.empty();F.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(F);this._createAsOverlayFill(L,F);this._materials[K.Outline]&&this._createAsOverlayOutline(F);this._logGeometryCreationWarnings(F.renderData,M.rings,"rings","FillSymbol3DLayer");return 0===F.outGeometries.length?null:new d.Graphics3DDrapedGraphicLayer(this,F.outGeometries,F.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(L,F){var M=F.renderData.polygons;for(const {position:N,holeIndices:P,
index:R,count:O}of M){var S=k.empty(J);k.expandWithBuffer(S,N);k.intersectsClippingArea(S,this._context.clippingExtent)&&(M=h.earcut(N,P,3),0!==M.length&&(k.expandWithAABB(F.outBoundingBox,S),S=this._fastUpdates?.visualVariables.color,M=w.createColorGeometry({material:this._materials[K.Fill],indices:M,attributeData:{position:N,color:S?null:F.color,colorFeature:S?p.getAttributeValue(S.field,L):null,uvMapSpace:this._needsUV?g.floatSubArray(F.uvMapSpace,4*R,4*O):null,objectAndLayerIdColor:F.objectAndLayerIdColor}}),
F.outGeometries.push(new D.RenderGeometry(M,F))))}}_createAsOverlayOutline(L){if(null!=this._materials[K.Outline]){var F=L.renderData.outlines;for(let S=0;S<F.length;++S){var {position:M}=F[S];k.empty(J);k.expandWithBuffer(J,M);k.intersectsClippingArea(J,this._context.clippingExtent)&&(k.expandWithAABB(L.outBoundingBox,J),M=u.createGeometry(this._materials[K.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,
attributeData:{position:M}},L.objectAndLayerIdColor),L.outGeometries.push(new D.RenderGeometry(M,L)))}}}_getOutlineOpacity(){const L=this.symbolLayer?.outline?.color;return(this.draped?1:this._getLayerOpacity())*(null!=L?L.a:0)}_getOutlineColor(){const L=this.symbolLayer?.outline?.color,F=this._getOutlineOpacity();return f.mixinColorAndOpacity(null!=L?b.toUnitRGB(L):null,F)}test(){return{...super.test(),createAsOverlay:(L,F)=>this._createAsOverlay(L,F),createAs3DShape:(L,F,M)=>this._createAs3DShape(L,
F,M)}}}H.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.RECREATE,staysOnTheGround:e.SymbolUpdateType.NONE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const J=k.create();class B extends w.PolygonCreationDataBase{constructor(L,F,M,S){super(L,M,S);this.color=F}}class z extends w.PolygonCreationDataBase{constructor(L,F,M,S){super(L,M,S);this.color=F}}var K;(function(L){L[L.Fill=0]="Fill";L[L.Outline=1]="Outline"})(K||={});a.Graphics3DPolygonFillSymbolLayer=H;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),function(a,b,n,h,k,m,g,e,d){function c(r){switch(r){case "horizontal":return d.Style.Horizontal;case "vertical":return d.Style.Vertical;
case "cross":return d.Style.Cross;case "forward-diagonal":return d.Style.ForwardDiagonal;case "backward-diagonal":return d.Style.BackwardDiagonal;case "diagonal-cross":return d.Style.DiagonalCross}}function l(r){return r.material instanceof e.PatternMaterial&&!r.material.parameters.draped}function f(r,x){if(l(r)){const w=r.attributes.get(m.VertexAttribute.POSITION).data,p=r.getMutableAttribute(m.VertexAttribute.UVMAPSPACE).data;r=r.getMutableAttribute(m.VertexAttribute.BOUNDINGRECT).data;k.createMapSpaceUVCoords(p,
r,w,x)}}a.createMaterial=function(r,x){r=r?.pattern??null;if(null==r)return new g.ColorMaterial(x);if("none"===r.style||"solid"===r.style)return"none"===r.style&&(x.color=n.fromValues(0,0,0,0),x.forceTransparentMode=!0),new g.ColorMaterial(x);x.style=c(r.style);return new e.PatternMaterial(x)};a.parsePatternStyle=c;a.requiresUVUpdates=l;a.updateMapSpaceUVCoords=f;a.uvElevationAligner=function(r,x,w,p,t){x=h.perVertexElevationAligner(r,x,w,p,t);r=r.stageObject.geometries;for(const q of r)f(q,t);return x};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectors ../../../../geometry/support/DoubleArray ../../../../geometry/support/plane ../../../ViewingMode".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(J,B,z,K,L,F,M){k.set(J,B*L[0]+z*F[0]+K*M[0],B*L[1]+z*F[1]+K*M[1],B*L[2]+z*F[2]+K*M[2])}const r=m.create(),x=m.create(),w=c.create(),p=m.create(),t=m.create(),q=m.create(),u=h.create(),v=h.create(),y=m.create(),D=m.create(),G=m.create(),A=b.create(),C=m.create(),E=m.create(),I=m.create(),H=m.create();a.createMapSpaceUVCoords=function(J,B,z,K,L=1){k.set(p,1,0,0);k.set(t,0,1,0);k.set(q,0,0,1);k.set(H,0,0,0);for(var F=0;F<z.length-3;F+=3)H[0]+=z[F],H[1]+=z[F+
1],H[2]+=z[F+2];k.scale(r,H,1/(z.length/3-1));if(c.fromArray(w,z)){null!=K?(K.basisMatrixAtPosition(r,A),k.set(C,A[0],A[1],A[2]),k.set(E,A[4],A[5],A[6]),k.set(I,A[8],A[9],A[10])):(k.set(C,1,0,0),k.set(E,0,1,0),k.set(I,0,0,1));K=c.getNormal(w);0>k.dot(K,I)&&k.scale(K,K,-1);k.copy(q,K);F=k.dot(K,E);var M=k.dot(K,C);Math.abs(F)>Math.abs(M)?(k.scaleAndAdd(p,C,K,-M),k.normalize(p,p),k.cross(t,p,K),k.normalize(t,t),k.scale(t,t,-1)):(k.scaleAndAdd(t,E,K,-F),k.normalize(t,t),k.cross(p,t,K),k.normalize(p,
p))}n.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);n.set(v,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(K=0;K<z.length;K+=3)k.set(x,z[K],z[K+1],z[K+2]),F=k.dot(p,x),M=k.dot(t,x),u[0]=Math.min(u[0],F),u[1]=Math.min(u[1],M),v[0]=Math.max(v[0],F),v[1]=Math.max(v[1],M);K=k.dot(q,r);f(y,u[0],u[1],K,p,t,q);f(D,v[0],u[1],K,p,t,q);f(G,u[0],v[1],K,p,t,q);k.subtract(D,D,y);k.scale(D,D,.5);k.subtract(G,G,y);k.scale(G,G,.5);k.add(y,y,D);k.add(y,y,G);K=u[0]-u[0]%L;F=u[1]-u[1]%L;for(M=0;M<
z.length;M+=3){k.set(x,z[M],z[M+1],z[M+2]);var S=M/3,N=4*S;J[N]=(k.dot(p,x)-K)/L;J[N+1]=(k.dot(t,x)-F)/L;J[N+2]=K/L;J[N+3]=F/L;S*=9;for(N=0;3>N;N++)B[S+N]=y[N],B[S+N+3]=D[N],B[S+N+6]=G[N]}};a.createMapSpaceUVCoordsDraped=function(J,B,z,K,L=1){if(z.isGeographic&&K===l.ViewingMode.Global){K=d.newDoubleArray(B.length);var F=B.length;z=g.getReferenceEllipsoid(z);for(var M=0;M<F;M+=3)e.lonLatToWebMercatorComparable(B,M,K,M,z);B=K}n.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(K=0;K<B.length;K+=
3)u[0]=Math.min(u[0],B[K]),u[1]=Math.min(u[1],B[K+1]);K=u[0]-u[0]%L;F=u[1]-u[1]%L;for(z=0;z<B.length;z+=3)M=z/3*4,J[M]=(B[z]-K)/L,J[M+1]=(B[z+1]-F)/L,J[M+2]=K/L,J[M+3]=F/L};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./TriangleMaterial ./VisualVariablePassParameters ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){class p extends f.TriangleMaterial{constructor(u){super(u,new q);this.supportsEdges=!0;this.produces=new Map([[d.RenderSlot.OPAQUE_MATERIAL,v=>v===k.ShaderOutput.Highlight||k.isColorAlphaOrOID(v)&&!this._isTransparent],[d.RenderSlot.OPAQUE_NO_SSAO_DEPTH,v=>v===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth&&!this._isTransparent],[d.RenderSlot.TRANSPARENT_MATERIAL,v=>k.isColorAlphaOrOID(v)&&this._isTransparent&&this.parameters.writeDepth],[d.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,
v=>v===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,v=>(k.isColorAlphaOrOID(v)||v===k.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[d.RenderSlot.DRAPED_MATERIAL,v=>k.is2DGeometryOutput(v)]]);this._configuration=new w.ColorMaterialTechniqueConfiguration}getConfiguration(u,v){this._configuration.output=u;this._configuration.cullFace=
this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this._isTransparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=v.transparencyPassType;this._configuration.enableOffset=
v.camera.relativeElevation<e.OITPolygonOffsetLimit;this._configuration.multipassEnabled=v.multipassEnabled;this._configuration.cullAboveGround=v.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;this._configuration.draped=this.parameters.draped;return this._configuration}createGLMaterial(u){return new t(u)}createBufferWriter(){const u=h.newLayout().vec3f(c.VertexAttribute.POSITION);b("enable-feature:objectAndLayerId-rendering")&&u.vec4u8(c.VertexAttribute.OBJECTANDLAYERIDCOLOR);
this.parameters.vvColor?u.f32(c.VertexAttribute.COLORFEATUREATTRIBUTE):u.vec4u8(c.VertexAttribute.COLOR);return new l.DefaultBufferWriter(u)}get _isTransparent(){return 1>this.parameters.color[3]||this.parameters.forceTransparentMode}}class t extends g{_updateOccludeeState(u){u.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:u.hasOccludees})}beginSlot(u){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(u);
return this.ensureTechnique(x.ColorMaterialTechnique,u)}}class q extends r.VisualVariablePassParameters{constructor(){super(...arguments);this.color=n.ZEROS;this.forceTransparentMode=!1;this.writeDepth=!0;this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=m.CullFaceOptions.None;this.draped=this.hasOccludees=!1}}a.ColorMaterial=p;a.Parameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports",
"../lib/Material","./internal/MaterialUtil"],function(a,b,n){class h extends b.Material{intersect(k,m,g,e,d,c){return n.intersectTriangleGeometry(k,g,e,d,void 0,c)}}a.TriangleMaterial=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../materials/VisualVariablePassParameters ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends f.VisualVariablePassParameters{constructor(){super(...arguments);this.color=n.ZEROS}}class p extends m.ShaderTechnique{initializeProgram(q){return new d.Program(q.rctx,p.shader.get().build(this.configuration),g.Default3D)}_createPipeline(q,u){const v=this.configuration,y=q===l.TransparencyPassType.NONE,D=q===l.TransparencyPassType.FrontFace;return x.makePipelineState({blending:v.output!==h.ShaderOutput.Color&&v.output!==h.ShaderOutput.Alpha||!v.transparent?
null:y?e.blendingDefault:e.oitBlending(q),culling:x.cullingParams(v.cullFace),depthTest:v.draped?null:{func:e.oitDepthTest(q)},depthWrite:v.draped?null:y||D?v.writeDepth?x.defaultDepthWriteParams:null:null,colorWrite:x.defaultColorWriteParams,stencilWrite:v.hasOccludees?c.stencilWriteMaskOn:null,stencilTest:v.hasOccludees?u?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null,polygonOffset:y||D?v.polygonOffset?t:null:e.getOITPolygonOffset(v.enableOffset)})}initializePipeline(){this._occludeePipelineState=
this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(q){return q?this._occludeePipelineState:super.getPipeline()}}p.shader=new k.ReloadableShaderModule(r.ColorMaterial,()=>new Promise((q,u)=>a(["./ColorMaterial.glsl"],q,u)));const t={factor:1,units:1};b.ColorMaterialPassParameters=w;b.ColorMaterialTechnique=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){function v(D){const G=new t.ShaderBuilder,{vertex:A,fragment:C,attributes:E,varyings:I}=G;x.addProjViewLocalOrigin(A,D);G.include(k.Transform,D);G.include(g.VertexColor,D);G.include(l.VisualVariables,D);G.include(m.ObjectAndLayerIdColor,D);E.add(u.VertexAttribute.POSITION,"vec3");D.vvColor&&E.add(u.VertexAttribute.COLORFEATUREATTRIBUTE,"float");I.add("vColor","vec4");I.add("vpos","vec3");const H=D.multipassEnabled&&(D.output===n.ShaderOutput.Color||
D.output===n.ShaderOutput.Alpha);H&&I.add("depth","float");A.uniforms.add(new w.Float4PassUniform("eColor",B=>B.color));var J=D.output===n.ShaderOutput.LinearDepth;J&&(G.include(e.OutputDepth,D),b.addNearFar(G),b.addLinearDepth(G));A.code.add(p.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${D.hasVertexColors?"vColor *\x3d eColor;":D.vvColor?"vColor \x3d eColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d eColor;"}
      ${H?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${J?p.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.glsl`transformPosition(proj, view, vpos);`}
    }
  `);G.include(h.SliceDraw,D);H&&G.include(c.multipassTerrainTest,D);C.include(r.ColorConversion);(J=D.output===n.ShaderOutput.Highlight)&&G.include(d.OutputHighlight,D);C.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);
    ${H?"terrainDepthTest(depth);":""}
    vec4 fColor = vColor;

    ${D.output===n.ShaderOutput.ObjectAndLayerIdColor?p.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${p.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${D.output===n.ShaderOutput.Alpha?p.glsl`fragColor = vec4(fColor.a);`:""}

    ${D.output===n.ShaderOutput.Color?p.glsl`fragColor = highlightSlice(fColor, vpos); ${D.transparencyPassType===q.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
    ${J?p.glsl`outputHighlight();`:""};
    ${D.output===n.ShaderOutput.LinearDepth?p.glsl`outputDepth(linearDepth);`:""};
    ${D.output===n.ShaderOutput.ObjectAndLayerIdColor?p.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return G}const y=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=y;a.build=v})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,n,h,k,m,g){class e extends g.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.output=n.ShaderOutput.Color;this.cullFace=k.CullFaceOptions.None;this.transparencyPassType=m.TransparencyPassType.NONE;this.polygonOffset=this.transparent=this.hasVertexColors=this.hasSlicePlane=!1;this.writeDepth=this.enableOffset=!0;this.draped=this.vvColor=this.objectAndLayerIdColorInstanced=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=!1}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],e.prototype,"output",void 0);b.__decorate([h.parameter({count:k.CullFaceOptions.COUNT})],
e.prototype,"cullFace",void 0);b.__decorate([h.parameter({count:m.TransparencyPassType.COUNT})],e.prototype,"transparencyPassType",void 0);b.__decorate([h.parameter()],e.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],e.prototype,"hasVertexColors",void 0);b.__decorate([h.parameter()],e.prototype,"transparent",void 0);b.__decorate([h.parameter()],e.prototype,"polygonOffset",void 0);b.__decorate([h.parameter()],e.prototype,"enableOffset",void 0);b.__decorate([h.parameter()],e.prototype,
"writeDepth",void 0);b.__decorate([h.parameter()],e.prototype,"hasOccludees",void 0);b.__decorate([h.parameter()],e.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],e.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter()],e.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([h.parameter()],e.prototype,"vvColor",void 0);b.__decorate([h.parameter()],e.prototype,"draped",void 0);b.__decorate([h.parameter({constValue:!1})],e.prototype,"occlusionPass",void 0);b.__decorate([h.parameter({constValue:!0})],
e.prototype,"hasVvInstancing",void 0);b.__decorate([h.parameter({constValue:!1})],e.prototype,"vvSize",void 0);b.__decorate([h.parameter({constValue:!1})],e.prototype,"vvOpacity",void 0);a.ColorMaterialTechniqueConfiguration=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./VisualVariablePassParameters ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){class u extends w.TriangleMaterial{constructor(G){super(G,new D);this.supportsEdges=!0;this.produces=new Map([[c.RenderSlot.OPAQUE_MATERIAL,A=>m.isOIDorHighlight(A)],[c.RenderSlot.TRANSPARENT_MATERIAL,A=>m.isColorOrAlpha(A)],[c.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH,A=>A===m.ShaderOutput.LinearDepth&&this.parameters.writeLinearDepth],[c.RenderSlot.DRAPED_MATERIAL,A=>this.parameters.draped&&A===m.ShaderOutput.Color||m.isOIDorHighlight(A)]]);this._vertexAttributeLocations=
b("enable-feature:objectAndLayerId-rendering")?q.vertexAttributeLocationsOID:q.vertexAttributeLocations;this._configuration=new q.PatternTechniqueConfiguration}getConfiguration(G,A){this._configuration.output=G;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.style=
this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<d.OITPolygonOffsetLimit;this._configuration.multipassEnabled=A.multipassEnabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;this._configuration.vvColor=!!this.parameters.vvColor;
return this._configuration}createGLMaterial(G){return new v(G)}createBufferWriter(){const G=k.newLayout().vec3f(f.VertexAttribute.POSITION).vec4f(f.VertexAttribute.UVMAPSPACE);this.parameters.draped||G.mat3f(f.VertexAttribute.BOUNDINGRECT);this.parameters.vvColor?G.f32(f.VertexAttribute.COLORFEATUREATTRIBUTE):G.vec4u8(f.VertexAttribute.COLOR);b("enable-feature:objectAndLayerId-rendering")&&G.vec4u8(f.VertexAttribute.OBJECTANDLAYERIDCOLOR);return new y(G)}}class v extends e{_updateParameters(G){return this.ensureTechnique(q.PatternTechnique,
G)}_updateOccludeeState(G){G.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:G.hasOccludees})}beginSlot(G){this._output!==m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(G);return this._updateParameters(G)}}class y extends r.DefaultBufferWriter{write(G,A,C,E,I){t.writeDefaultAttributes(C,this.vertexBufferLayout,G,A,E,I);for(const J of this.vertexBufferLayout.fields.keys()){A=C.attributes.get(J);var H=A?.indices;
if(A&&H)switch(J){case f.VertexAttribute.UVMAPSPACE:l.assert(4===A.size);(H=E.getField(J,h.BufferViewVec4f))&&t.writeBufferVec4(A,H,I);break;case f.VertexAttribute.BOUNDINGRECT:l.assert(9===A.size),(H=E.getField(J,h.BufferViewMat3f))&&this.writeBoundingRect(A,G,H,I)}}}writeBoundingRect(G,A,C,E){const {data:I,indices:H}=G;G=C.typedBuffer;C=C.typedBufferStride;const J=H.length;E*=C;for(let z=0;z<J;++z){const K=9*H[z];var B=I[K];const L=I[K+1],F=I[K+2];G[E]=A[0]*B+A[4]*L+A[8]*F+A[12];G[E+1]=A[1]*B+A[5]*
L+A[9]*F+A[13];G[E+2]=A[2]*B+A[6]*L+A[10]*F+A[14];for(B=3;9>B;++B)G[E+B]=I[K+B];E+=C}}}class D extends p.VisualVariablePassParameters{constructor(){super(...arguments);this.color=n.fromValues(1,1,1,1);this.hasSlicePlane=this.polygonOffset=this.hasVertexColors=this.writeLinearDepth=!1;this.cullFace=g.CullFaceOptions.None;this.hasOccludees=!1;this.style=x.Style.Cross;this.patternSpacing=10;this.lineWidth=1;this.draped=!0}}a.Parameters=D;a.PatternMaterial=u;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../core/has ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){class u extends g.ShaderTechnique{initializeProgram(A){return new l.Program(A.rctx,u.shader.get().build(this.configuration),h("enable-feature:objectAndLayerId-rendering")?G:D)}_setPipelineState(A,C){const E=this.configuration,I=A===r.TransparencyPassType.NONE,H=A===r.TransparencyPassType.FrontFace;return q.makePipelineState({blending:E.output===k.ShaderOutput.Color||E.output===k.ShaderOutput.Alpha?I?c.blendingDefault:c.oitBlending(A):null,culling:q.cullingParams(E.cullFace),
depthTest:E.draped?null:{func:c.oitDepthTest(A)},depthWrite:E.draped?null:I?q.defaultDepthWriteParams:c.oitDepthWrite(A),colorWrite:q.defaultColorWriteParams,stencilWrite:E.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:E.hasOccludees?C?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null,polygonOffset:I||H?E.polygonOffset?v:null:c.getOITPolygonOffset(E.enableOffset)})}initializePipeline(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,
!1)}getPipeline(A){return A?this._occludeePipelineState:super.getPipeline()}}u.shader=new m.ReloadableShaderModule(t.Pattern,()=>new Promise((A,C)=>a(["./Pattern.glsl"],A,C)));const v={factor:1,units:1};class y extends w.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.cullFace=d.CullFaceOptions.None;this.transparencyPassType=r.TransparencyPassType.NONE;this.hasOccludees=this.polygonOffset=this.hasVertexColors=this.hasSlicePlane=!1;this.enableOffset=
!0;this.objectAndLayerIdColorInstanced=this.vvColor=this.cullAboveGround=this.multipassEnabled=!1}}n.__decorate([e.parameter({count:k.ShaderOutput.COUNT})],y.prototype,"output",void 0);n.__decorate([e.parameter({count:d.CullFaceOptions.COUNT})],y.prototype,"cullFace",void 0);n.__decorate([e.parameter({count:p.Style.COUNT})],y.prototype,"style",void 0);n.__decorate([e.parameter({count:r.TransparencyPassType.COUNT})],y.prototype,"transparencyPassType",void 0);n.__decorate([e.parameter()],y.prototype,
"hasSlicePlane",void 0);n.__decorate([e.parameter()],y.prototype,"hasVertexColors",void 0);n.__decorate([e.parameter()],y.prototype,"polygonOffset",void 0);n.__decorate([e.parameter()],y.prototype,"hasOccludees",void 0);n.__decorate([e.parameter()],y.prototype,"patternSpacing",void 0);n.__decorate([e.parameter()],y.prototype,"lineWidth",void 0);n.__decorate([e.parameter()],y.prototype,"enableOffset",void 0);n.__decorate([e.parameter()],y.prototype,"draped",void 0);n.__decorate([e.parameter()],y.prototype,
"multipassEnabled",void 0);n.__decorate([e.parameter()],y.prototype,"cullAboveGround",void 0);n.__decorate([e.parameter()],y.prototype,"vvColor",void 0);n.__decorate([e.parameter({constValue:!0})],y.prototype,"writeDepth",void 0);n.__decorate([e.parameter({constValue:!1})],y.prototype,"occlusionPass",void 0);n.__decorate([e.parameter({constValue:!1})],y.prototype,"hasVvInstancing",void 0);n.__decorate([e.parameter({constValue:!1})],y.prototype,"vvSize",void 0);n.__decorate([e.parameter({constValue:!1})],
y.prototype,"vvOpacity",void 0);const D=new Map([[x.VertexAttribute.POSITION,0],[x.VertexAttribute.COLOR,3],[x.VertexAttribute.UVMAPSPACE,4],[x.VertexAttribute.COLORFEATUREATTRIBUTE,5],[x.VertexAttribute.BOUNDINGRECT,6]]),G=new Map([[x.VertexAttribute.POSITION,0],[x.VertexAttribute.COLOR,3],[x.VertexAttribute.UVMAPSPACE,4],[x.VertexAttribute.COLORFEATUREATTRIBUTE,5],[x.VertexAttribute.BOUNDINGRECT,6],[x.VertexAttribute.OBJECTANDLAYERIDCOLOR,9]]);b.PatternTechnique=u;b.PatternTechniqueConfiguration=
y;b.vertexAttributeLocations=D;b.vertexAttributeLocationsOID=G;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y){function D(C){const E=new q.ShaderBuilder,I=C.multipassEnabled&&(C.output===n.ShaderOutput.Color||C.output===n.ShaderOutput.Alpha),{vertex:H,fragment:J,attributes:B,varyings:z}=E;x.addProjViewLocalOrigin(H,C);E.include(k.Transform,C);E.include(g.VertexColor,C);E.include(l.VisualVariables,C);E.include(m.ObjectAndLayerIdColor,C);C.draped?H.uniforms.add(new p.FloatPassUniform("worldToScreenRatio",(L,F)=>1/F.screenToPCSRatio)):B.add(v.VertexAttribute.BOUNDINGRECT,
"mat3");B.add(v.VertexAttribute.POSITION,"vec3");B.add(v.VertexAttribute.UVMAPSPACE,"vec4");C.vvColor&&B.add(v.VertexAttribute.COLORFEATUREATTRIBUTE,"float");z.add("vColor","vec4");z.add("vpos","vec3");z.add("vuv","vec2");I&&z.add("depth","float");H.uniforms.add(new w.Float4PassUniform("uColor",L=>L.color));var K=C.style===y.Style.ForwardDiagonal||C.style===y.Style.BackwardDiagonal||C.style===y.Style.DiagonalCross;K&&H.code.add(t.glsl`
      const mat2 rotate45 = mat2(${t.glsl.float(.70710678118)}, ${t.glsl.float(-.70710678118)},
                                 ${t.glsl.float(.70710678118)}, ${t.glsl.float(.70710678118)});
    `);C.draped||(x.addCameraPosition(H,C),H.uniforms.add(new p.FloatPassUniform("worldToScreenPerDistanceRatio",(L,F)=>1/F.camera.perScreenPixelRatio)),H.code.add(t.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),H.code.add(t.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),H.code.add(t.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${t.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));H.code.add(t.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${K?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${K?" * rotate45":""};

      ${C.draped?"":t.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${t.glsl.float(C.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(K=C.output===n.ShaderOutput.LinearDepth)E.include(e.OutputDepth,C),b.addNearFar(E),b.addLinearDepth(E);H.code.add(t.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${I?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${C.hasVertexColors?"vColor *\x3d uColor;":C.vvColor?"vColor \x3d uColor * interpolateVVColor(colorFeatureAttribute);":"vColor \x3d uColor;"}
      gl_Position = ${K?t.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:t.glsl`transformPosition(proj, view, vpos);`}
    }
  `);E.include(h.SliceDraw,C);J.include(r.ColorConversion);C.draped&&J.uniforms.add(new p.FloatPassUniform("texelSize",(L,F)=>1/F.camera.pixelRatio));C.output===n.ShaderOutput.Highlight&&E.include(d.OutputHighlight,C);I&&E.include(c.multipassTerrainTest,C);C.output!==n.ShaderOutput.Highlight&&(J.code.add(t.glsl`
      const float lineWidth = ${t.glsl.float(C.lineWidth)};
      const float spacing = ${t.glsl.float(C.patternSpacing)};
      const float spacingINV = ${t.glsl.float(1/C.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),C.draped||J.code.add(t.glsl`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));J.code.add(t.glsl`
    void main() {
      discardBySlice(vpos);
      ${I?"terrainDepthTest(depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${C.output!==n.ShaderOutput.Highlight?t.glsl`color.a *= ${G(C)};`:""}

      ${C.output===n.ShaderOutput.ObjectAndLayerIdColor?t.glsl`color.a = 1.0;`:""}

      if (color.a < ${t.glsl.float(f.symbolAlphaCutoff)}) {
        discard;
      }

      ${C.output===n.ShaderOutput.Alpha?t.glsl`fragColor = vec4(color.a);`:""}

      ${C.output===n.ShaderOutput.Color?t.glsl`fragColor = color; ${C.transparencyPassType===u.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}`:""}
      ${C.output===n.ShaderOutput.Highlight?t.glsl`outputHighlight();`:""}
      ${C.output===n.ShaderOutput.LinearDepth?t.glsl`outputDepth(linearDepth);`:""};
      ${C.output===n.ShaderOutput.ObjectAndLayerIdColor?t.glsl`outputObjectAndLayerIdColor();`:""}
    }
  `);return E}function G(C){function E(I){return C.draped?t.glsl`coverage(vuv.${I}, texelSize)`:t.glsl`sampleAA(vuv.${I})`}switch(C.style){case y.Style.ForwardDiagonal:case y.Style.Horizontal:return E("y");case y.Style.BackwardDiagonal:case y.Style.Vertical:return E("x");case y.Style.DiagonalCross:case y.Style.Cross:return t.glsl`
        1.0 - (1.0 - ${E("x")}) * (1.0 - ${E("y")})
      `;default:return"0.0"}}const A=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));a.Pattern=A;a.build=D})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../core/Error ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./LabelParameters ./placementUtils ./pointUtils ../../webgl-engine/lib/FontMetrics ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(H,J,B){H&&H.forEach(z=>{const K=J(z);null!=K&&B(K,z.graphic)})}function A(H,J){if("baseline"===J.verticalPlacement)return k.fromValues(p.horizontalPlacementToAnchorX[J.horizontalPlacement],null!=H?H.baselineAnchorY:0);H=p.anchorFromPlacements(J.horizontalPlacement,J.verticalPlacement);return p.namedAnchorToHUDMaterialAnchorPos[H]}const C=m.fromValues(0,0,1);class E extends r.Graphics3DSymbolLayer{constructor(H,J,B,z){super(H,J,B,z);
this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const H=x.validateSymbolLayerSize(this.symbolLayer.size);if(H)throw new b("graphics3dtextsymbollayer:invalid-size",H);}await this._createTextRenderParameters()}async _createTextRenderParameters(){this._textRenderParameters=await v.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)}destroy(){super.destroy()}createGraphics3DGraphic(H){H=
H.graphic;const J=t.placePointOnGeometry(H.geometry);if(null==J)return this.logger.warn(`unsupported geometry type for text symbol: ${H.geometry.type}`),null;const B=this.symbolLayer.text;if(null==B||""===B)return null;var z=g.hasCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=z&&!g.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+
`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;var {verticalAlignment:K}=this.symbolLayer;z=new w.LabelPlacement(z);p.verticalScreenOffsetFromAlignment(K,z.screenOffset);K=new w.LabelParameters(z,this.symbolLayer.horizontalAlignment,p.verticalPlacementFromAlignment(K));return this._createAs3DShape(H,J,B,K)}createLabel(H,J,B,z,K){H=H.graphic;const L=t.placePointOnGeometry(H.geometry);if(null==L)return this.logger.warn(`unsupported geometry type for label: ${H.geometry.type}`),
null;const F=J.text;return!F||/^\s+$/.test(F)?null:this._createAs3DShape(H,L,F,J,B,z,K)}setGraphicElevationContext(H,J,B=0){super.setGraphicElevationContext(H,J);J.addOffsetRenderUnits(B);return J}layerOpacityChanged(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1}layerElevationInfoChanged(H,J){G(H,J,(B,z)=>{this.updateGraphicElevationContext(z,B)});return d.SymbolUpdateType.UPDATE}slicePlaneEnabledChanged(H,J){G(H,J,B=>{for(const z of B.stageObject.geometries)z.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});
return!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(H,J){const B=J.elevationContext;this.setGraphicElevationContext(H,B,null!=J.metadata?J.metadata.elevationOffset:0);J.needsElevationUpdates=d.needsElevationUpdates2D(B.mode)||"absolute-height"===B.mode}_defaultElevationInfoNoZ(){return I}_createAs3DShape(H,J,B,z,K=null,L=null,F=()=>z.placement.elevationOffset){const M=this.setGraphicElevationContext(H,new c.ElevationContext,z.placement.elevationOffset);
var S="polyline"===H.geometry?.type,N=H.uid;let P=null,R=null;if(null==L){var O=p.textRenderAlignmentFromHorizontalPlacement(z.horizontalPlacement);P=new y(B,O,this._textRenderParameters);let V=null;if(null!=this._context.sharedResources.textures){R=this._context.sharedResources.textures.fromData(P.key,()=>P.create());R.texture.events.on("unloaded",()=>V?.release());O=this._context.stage.renderView.textureRepository.acquire(R.texture.id);if(null==O||n.isPromiseLike(O))return R.release(),null;V=O}}O=
A(P,z);O={occlusionTest:!0,screenOffset:z.placement.screenOffset,anchorPosition:O,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:z.placement.centerOffsetUnits,drawInSecondSlot:!0};L?O.textureId=L.id:R&&(O.textureId=R.texture.id);if(null!=z.placement.verticalOffset){const {screenLength:V,minWorldLength:U,maxWorldLength:W}=z.placement.verticalOffset;O.verticalOffset={screenLength:h.pt2px(V),minWorldLength:U||0,maxWorldLength:null!=W?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:V,
screenSizePerspectiveSettingsLabels:U}=this._context.sharedResources;L=q.getFontMetrics(this._textRenderParameters);O.screenSizePerspective=U.overrideFontHeight(L.maxHeight);O.screenSizePerspectiveAlignment=V}S&&(O.shaderPolygonOffset=1E-4);O.hasSlicePlane=this._context.slicePlaneEnabled;S=(V,U)=>{const W=JSON.stringify(U);let ca=V.get(W);null==ca&&(ca=new D.HUDMaterial(U),V.add(W,ca));return ca};S=K?S(K,O):new D.HUDMaterial(O);L=z.placement.translation;O=P?k.fromValues(P.displayWidth,P.displayHeight):
k.ZEROS;const T=z.placement.centerOffset,Q=k.create();L=u.createPointGeometry(S,C,L,null,O,T,Q,null);N=t.createStageObject(this._context,J,L,M,N);if(null==N)return null;K=new l.Graphics3DObject3DGraphicLayer(this,N.object,[L],null==K?[S]:null,R,(V,U,W,ca,X,ba)=>{const ia=F()||z.placement.elevationOffset;U=this.setGraphicElevationContext(H,U,ia);return e.perObjectElevationAligner(V,U,W,ca,X,ba)},M);K.alignedSampledElevation=N.sampledElevation;K.needsElevationUpdates=d.needsElevationUpdates2D(M.mode)||
"absolute-height"===M.mode;K.getScreenSize=(V=k.create())=>{V[0]=P?P.displayWidth:z.displaySize[0];V[1]=P?P.displayHeight:z.displaySize[1];return V};B=new f.Graphics3DObjectMetadata(z.placement.elevationOffset,B);K.metadata=B;t.extendPointGraphicElevationContext(K,J,this._context.elevationProvider);return K}}const I={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelParameters":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a,b,n,h){class k{constructor(g,e="center",d=!1,c=b.create(),l=h.fromValues(0,0,0,-1),f="world",r=n.create(),x=0){this.verticalOffset=g;this.anchor=e;this.hasLabelVerticalOffset=d;this.screenOffset=c;this.centerOffset=l;this.centerOffsetUnits=f;this.translation=r;this.elevationOffset=x}}class m{constructor(g,e="center",d="center",
c=null,l=b.create()){this.placement=g;this.horizontalPlacement=e;this.verticalPlacement=d;this.text=c;this.displaySize=l}}a.LabelParameters=m;a.LabelPlacement=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../Color ../../../../core/fontUtils ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(a,b,n,h,k,m){class g{constructor(d){this.definition=
d;this.key=JSON.stringify(d);this.haloSize=Math.round(d.halo.size);this.textStyle=this._colorToRGBA(d.color);this.haloStyle=this._colorToRGB(d.halo.color);this.backgroundStyle=0!==d.background.color[3]?this._colorToRGBA(d.background.color):null}fontString(d){const c=this.definition.font;return`${c.style} ${c.weight} ${d}px ${c.family}, ${"sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji"}`}setFontProperties(d,c){d.font=this.fontString(c);d.textAlign="left";d.textBaseline=
"alphabetic"}_colorToRGB(d){return`rgb(${d.slice(0,3).map(c=>Math.floor(255*c)).toString()})`}_colorToRGBA(d){return`rgba(${d.slice(0,3).map(c=>Math.floor(255*c)).toString()},${d[3]})`}static async fromSymbol(d,c){var l=b.toUnitRGBA(d?.material?.color)??m.ZEROS,f=null!=d.size?k.pt2px(d.size):12;const r=d.lineHeight,x=null!=d.background?b.toUnitRGBA(d.background.color):m.ZEROS,w={family:d.font?.family??"sans-serif",decoration:d.font?.decoration??"none",weight:d.font?.weight??"normal",style:d.font?.style??
"normal"};var p=d.halo;p=null!=p?.color&&0<p.size?{size:k.pt2px(p.size),color:b.toUnitRGBA(p.color)}:{size:0,color:m.ZEROS};c=new g({color:l,size:f,background:{color:x,padding:null!=d.background?[.65*f,.5*f]:[0,0],borderRadius:null!=d.background?.375*f:0},lineSpacingFactor:r,font:w,halo:p,pixelRatio:c});if(d.font){l=!1;f=c.fontString(f);try{l=(await document.fonts.load(f)).some(t=>!n.isCachedFontFace(t))}catch(t){h.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}if(!l&&
!e.has(d.font.family))try{await n.loadFont(d.font)}catch(t){}}return c}}const e=new Set("Arial;Times New Roman;Courier New;serif;sans-serif;monospace;cursive;fantasy;system-ui;ui-serif;ui-sans-serif;ui-monospace;ui-rounded;math;emoji;fangsong".split(";"));a.TextRenderParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["./TextHelperCanvas","./TextRenderer","./TextTextureAtlas","./Texture","../../../webgl/enums"],
function(a,b,n,h,k){class m{constructor(e,d,c){this._renderer=new b.TextRenderer(e,d,c,n.TextTextureAtlas.maxSize)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=a.getTextHelperCanvas(g,this._renderer.renderedWidth,this._renderer.renderedHeight),d=e.getContext("2d");d.save();this._renderer.render(d,
0,0);d.restore();return new h.Texture(e,{wrap:{s:k.TextureWrapMode.CLAMP_TO_EDGE,t:k.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}const g={canvas:null};return m})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ./ContentObjectType ./testUtils ./textureUtils ./VertexAttribute ../../../support/Scheduler ../../../support/Yield ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(H,J){H.geometries[0].setAttributeData(t.VertexAttribute.UV0,J.uv);H.geometryVertexAttributeUpdated(H.geometries[0],t.VertexAttribute.UV0,!0)}a.TextTextureAtlas=class extends n{constructor(H){super(H);this.type=x.ContentObjectType.Texture;this.id=m.generateUID();this.events=new h;this._glTexture=null;this._atlas=new C(256,256);this._needsRepack=!1;this._canRepack=!0;this._elementsToRender=new Map;this._elements=new Map;this._stageObjects=
new Map;this.updating=!1}initialize(){this._canvas=document.createElement("canvas");this._canvas.setAttribute("id","textAtlasCanvas");this._canvas.setAttribute("style","display:none");this._ctx=this._canvas.getContext("2d");this._stage=this.view._stage;this._stage.add(this);this._updateCanvasElementSize(this._atlas);this._reset()}unload(){this._glTexture=k.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")}get glTexture(){return this._glTexture}static get maxSize(){I=w.textTextureAtlas.stableRendering?
2:0;return[4094-I,4094-I-2]}load(H){if(this._glTexture)return this._glTexture;const J=new D.TextureDescriptor;J.wrapMode=v.TextureWrapMode.CLAMP_TO_EDGE;J.samplingMode=v.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;J.hasMipmap=!0;J.preMultiplyAlpha=!0;J.maxAnisotropy=H.parameters.maxMaxAnisotropy;this._glTexture=new y.Texture(H,J,this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(q.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture}dispose(){this._elements.clear();
this._elementsToRender.clear();this._frameWorker=k.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=k.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null}_updateCanvasElementSize(H){this._canvas.setAttribute("width",H.width.toString());this._canvas.setAttribute("height",H.height.toString())}_resizeAtlas(H,J){const {width:B,height:z}=this._atlas;if(B!==H||z!==J)this._atlas.width=H,this._atlas.height=J,this._glTexture?.resize(H,
J),this._glTexture?.updateData(0,0,0,B,z,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach(K=>{this._stageObjects.get(K.textRenderer.key)?.forEach(L=>G(L,K))}),this._reset()}_reset(){this._elementsToRender.clear();this._atlas.reset();this._needsRepack=!0;this.setDirty()}_addAtlasElement(H,J,B,z){const K=this._atlas;if(K.width<B||K.height<z)return!1;let L=K.cursors.get(z);if(!L){if(K.height<K.nextY+z)return!1;L=[new E(K.nextY)];K.cursors.set(z,L);K.nextY+=z}let F=L.find(M=>
K.width>=M.x+B);if(null==F){if(K.height<K.nextY+z)return!1;F=new E(K.nextY);K.nextY+=z;L.push(F)}H.setNewPosition(F);this._elements.set(J,H);this._elementsToRender.set(J,H);F.x+=B;return!0}_ensureStageObjects(H){var J=this._stageObjects.get(H);if(J)return J;J=new Set;this._stageObjects.set(H,J);return J}_addStageObject(H,J){this._ensureStageObjects(H).add(J)}_removeStageObject(H,J){this._stageObjects.get(H)?.delete(J)&&(J.geometries[0].setAttributeData(t.VertexAttribute.SIZE,[0,0]),J.geometryVertexAttributeUpdated(J.geometries[0],
t.VertexAttribute.SIZE),this._elementsToRender.delete(H))}_processAddition(H){const J=H.textRenderer.key;if(this._needsRepack)this._elements.set(J,H);else{var B=this._atlas,z=H.textRenderer.renderedWidth+2,K=H.textRenderer.renderedHeight+2+2;this._addAtlasElement(H,J,z,K)||(this._canRepack?this._reset():B.width<z?(z=Math.min(p.applyTextureResizeModulo(Math.max(z,1.5*B.width)),4096),this._resizeAtlas(z,B.height)):(z=Math.min(p.applyTextureResizeModulo(Math.max(B.nextY+K,1.5*B.height)),4096),z>B.height?
this._resizeAtlas(B.width,z):4096>B.width&&(z=Math.min(p.applyTextureResizeModulo(1.5*B.width),4096),this._resizeAtlas(z,B.height))),this._elements.set(J,H))}}_renderElement(H){const J=H.commitNewPosition(),B=H.textRenderer;this._ctx.clearRect(J[0]-2,J[1]-2,B.renderedWidth+4,B.renderedHeight+4);B.render(this._ctx,J[0],J[1]);this._stageObjects.get(B.key)?.forEach(z=>G(z,H))}get running(){return this.updating}runTask(H){if(null==this._glTexture)return u.Yield;for(;this._needsRepack&&(this._canRepack||
4096>this._atlas.height&&4096>this._atlas.height);){this._canRepack=this._needsRepack=!1;const J=this._elements;this._elements=new Map;J.forEach(B=>this._processAddition(B));H.madeProgress()}if(0<this._elementsToRender.size){for(const [J,B]of this._elementsToRender){if(H.done)break;this._renderElement(B);this._elementsToRender.delete(J);H.madeProgress()}this._glTexture.setData(this._canvas)}this.updating=0<this._elementsToRender.size}addTextTexture(H,J){var B=H.key;this._addStageObject(B,J);B=this._elements.get(B);
null==B&&(B=new A(this._atlas,H),this._processAddition(B),this.setDirty());J.geometries[0].setAttributeData(t.VertexAttribute.SIZE,[B.textRenderer.displayWidth,B.textRenderer.displayHeight]);J.geometryVertexAttributeUpdated(J.geometries[0],t.VertexAttribute.SIZE);G(J,B)}removeTextTexture(H,J){H=H.key;this._elements.get(H)&&(this._removeStageObject(H,J),(J=this._stageObjects.get(H))&&0!==J.size||this._elements.delete(H),0===J?.size&&this._stageObjects.delete(H),this._canRepack=!0)}setDirty(){this._glTexture&&
(this.updating=!0)}get test(){const {_elements:H,_stageObjects:J,_atlas:B}=this,z=this;return{elements:H,stageObjects:J,atlas:B,resizeAtlas:(K,L)=>z._resizeAtlas(K,L),run:K=>z.runTask(K)}}};b.__decorate([g.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([g.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],a.TextTextureAtlas);class A{constructor(H,
J){this._atlas=H;this.textRenderer=J;this._uv=r.create();this._newPosition=[0,0]}get uv(){if(null==this._xOffset||null==this._yOffset)return r.ZEROS;const {renderedWidth:H,renderedHeight:J}=this.textRenderer;return f.set(this._uv,this._xOffset/this._atlas.width,(this._yOffset+J)/this._atlas.height,(this._xOffset+H)/this._atlas.width,this._yOffset/this._atlas.height)}setNewPosition(H){this._newPosition[0]=H.x;this._newPosition[1]=H.y}commitNewPosition(){this._xOffset=this._newPosition[0];this._yOffset=
this._newPosition[1];return this._newPosition}get xOffset(){return this._xOffset}get yOffset(){return this._yOffset}}class C{constructor(H,J){this.width=H;this.height=J;this.cursors=new Map;this.nextY=0}reset(){this.cursors.clear();this.nextY=I}}class E{constructor(H){this.y=H;this.x=I}}let I=0;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../Color ../../../../core/unitUtils ../../../../chunks/earcut ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){const G=["polyline","polygon","extent"];class A extends p.Graphics3DSymbolLayer{constructor(z,K,L,F){super(z,K,L,F)}async doLoad(){}destroy(){super.destroy();this._context.stage.remove(this._materials[0]);this._materials.length=0}createGraphics3DGraphic(z){z=z.graphic;if(!this._validateGeometry(z.geometry,G,this.symbolLayer.type))return null;const K=this.setGraphicElevationContext(z);this.ensureDrapedStatus("on-the-ground"===K.mode);this.ensureMaterial();
return this.draped?this._createAsOverlay(z):this._createAs3DShape(z,K,z.uid)}ensureMaterial(){if(!this._materials[0]){var z=new y.WaterMaterialParameters,K=this.symbolLayer.color;null!=K&&(z.color=b.toUnitRGBA(K));K=this._getCombinedOpacity(K,{hasIntrinsicColor:!0});z.color=[z.color[0],z.color[1],z.color[2],K];z.transparent=1>K||this.needsDrivenTransparentPass;z.waveDirection=null!=this.symbolLayer.waveDirection?A.headingVectorFromAngle(this.symbolLayer.waveDirection):m.fromValues(0,0);K=D.wavePresets[this.symbolLayer.waveStrength+
"-"+this.symbolLayer.waterbodySize];z.waveStrength=K.waveStrength;z.waveTextureRepeat=K.textureRepeat;z.waveVelocity=K.waveVelocity;z.flowStrength=K.perturbationStrength;z.hasSlicePlane=this._context.slicePlaneEnabled;z.draped=this.draped;this._materials[0]=new y.WaterMaterial(z);this._context.stage.add(this._materials[0])}}layerOpacityChanged(){if(null!=this._materials[0]){var z=this._materials[0].parameters.color,K=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._materials[0].setParameters({color:[z[0],
z[1],z[2],K],transparent:1>K||this.needsDrivenTransparentPass})}}layerElevationInfoChanged(z,K,L){const F=this._elevationContext.mode;L=r.elevationModeChangeUpdateType(A.elevationModeChangeTypes,L,F);if(L!==r.SymbolUpdateType.UPDATE)return L;const M=r.needsElevationUpdates2D(F);return this.updateGraphics3DGraphicElevationInfo(z,K,()=>M)}slicePlaneEnabledChanged(){this._materials[0]?.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(z,
K,L){const F=t.geometryAsPolygon(z.geometry);if(null==F)return null;const M=q.geometryToRenderInfo(F,this._context.elevationProvider,this._context.renderCoordsHelper,K),S=M.position.length/3,N=l.newDoubleArray(2*S);this._createUVCoordsFromVertices(N,M.mapPositions,S,this._context.elevationProvider.spatialReference);z=new J(M,N,this._context.layer.uid,z.uid);z.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(z);this._create3DShapeGeometries(z);this._logGeometryCreationWarnings(z.renderData,
F.rings,"rings","WaterSymbol3DLayer");if(0===z.outGeometries.length)return null;L=new u.Object3D({geometries:z.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:L});L=new w.Graphics3DObject3DGraphicLayer(this,L,z.outGeometries,null,null,f.perVertexElevationAligner,K);L.alignedSampledElevation=z.renderData.sampledElevation;L.needsElevationUpdates=r.needsElevationUpdates2D(K.mode);return L}_createUVCoordsFromVertices(z,K,L,F){F=n.getMetersPerUnitForSR(F);c.empty(E);for(var M=0;M<
L;M++)k.set(I,K[3*M],K[3*M+1]),c.expandPointInPlace(E,I);g.scale(E,E,F);M=E[1]%A.unitSizeOfTexture;C[0]=E[0]-E[0]%A.unitSizeOfTexture;C[1]=E[1]-M;for(M=0;M<L;M++)z[2*M]=(K[3*M]*F-C[0])/A.unitSizeOfTexture,z[2*M+1]=(K[3*M+1]*F-C[1])/A.unitSizeOfTexture}_create3DShapeGeometries(z){var K=z.renderData.polygons;const L=z.uvCoords;for(const {count:F,index:M,position:S,mapPositions:N,holeIndices:P}of K){if(null!=this._context.clippingExtent&&(d.empty(H),d.expandWithBuffer(H,N),!d.intersectsClippingArea(H,
this._context.clippingExtent)))continue;K=h.earcut(N,P,3);if(0===K.length)continue;const R=l.doubleSubArray(L,2*M,2*F);K=t.createWaterGeometry({material:this._materials[0],indices:K,mapPositions:N,attributeData:{position:S,uv0:R}},z.objectAndLayerIdColor);z.outGeometries.push(K)}}_createAsOverlay(z){const K=t.geometryAsPolygon(z.geometry);if(null==K)return null;this._materials[0].renderPriority=this._renderPriority;const L=q.geometryToRenderInfoDraped(K,this._context.overlaySR),F=L.position.length/
3,M=l.newDoubleArray(2*F);this._createUVCoordsFromVertices(M,L.position,F,this._context.overlaySR);z=new B(L,M,this._context.layer.uid,z.uid);z.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(z);z.outBoundingBox=d.empty();this._createAsOverlayWater(z);this._logGeometryCreationWarnings(z.renderData,K.rings,"rings","WaterSymbol3DLayer");return 0===z.outGeometries.length?null:new x.Graphics3DDrapedGraphicLayer(this,z.outGeometries,z.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(z){const K=
z.uvCoords;var L=z.renderData.polygons;for(const {position:F,holeIndices:M,index:S,count:N}of L){d.empty(H);d.expandWithBuffer(H,F);if(!d.intersectsClippingArea(H,this._context.clippingExtent))continue;d.expandWithAABB(z.outBoundingBox,H);L=h.earcut(F,M,3);if(0===L.length)continue;const P=l.doubleSubArray(K,2*S,2*N);L=t.createWaterGeometry({material:this._materials[0],indices:L,attributeData:{position:F,uv0:P}},z.objectAndLayerIdColor);z.outGeometries.push(new v.RenderGeometry(L,z))}}static headingVectorFromAngle(z){const K=
m.create();z=e.toRadian(z);K[0]=Math.sin(z);K[1]=Math.cos(z);return K}test(){return{...super.test(),create3DShape:z=>this._createAs3DShape(z.graphic,z.elevationContext,z.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}A.unitSizeOfTexture=100;A.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,onTheGroundChanged:r.SymbolUpdateType.RECREATE};const C=m.create(),E=c.create(),I=m.create(),H=d.create();class J extends t.PolygonCreationDataBase{constructor(z,
K,L,F){super(z,L,F);this.uvCoords=K}}class B extends t.PolygonCreationDataBase{constructor(z,K,L,F){super(z,L,F);this.uvCoords=K}}a.Graphics3DWaterSymbolLayer=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../core/has ../../../../core/time ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){class t extends x.TriangleMaterial{constructor(u){super(u,new q);this._configuration=new p.WaterTechniqueConfiguration;this._animation=new e.AnimationTimer;this.produces=new Map([[l.RenderSlot.OPAQUE_MATERIAL,v=>g.isColorOrAlpha(v)&&!this.parameters.transparent||g.isOIDorHighlight(v)],[l.RenderSlot.TRANSPARENT_MATERIAL,v=>g.isColorOrAlpha(v)&&this.parameters.transparent||g.isOIDorHighlight(v)],[l.RenderSlot.DRAPED_MATERIAL,v=>this.parameters.draped&&v===g.ShaderOutput.Color||
g.isOIDorHighlight(v)],[l.RenderSlot.DRAPED_WATER,v=>v===g.ShaderOutput.Normal]])}getConfiguration(u,v){this._configuration.output=u;this._configuration.writeDepth=!0;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;
this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=v.transparencyPassType;this._configuration.enableOffset=v.camera.relativeElevation<c.OITPolygonOffsetLimit;this._configuration.multipassEnabled=v.multipassEnabled;this._configuration.cullAboveGround=v.multipassTerrain.cullAboveGround;return this._configuration}update(u){this._animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(u.camera.relativeElevation,
u.camera.distance);u=this._animation.advance(u);this.setParameters({timeElapsed:n.secondsFromMilliseconds(this._animation.time)*this.parameters.animationSpeed},!1);return this._animation.enabled&&u}createGLMaterial(u){return new w.WaterGLMaterial(u)}createBufferWriter(){return new f.DefaultBufferWriter(b("enable-feature:objectAndLayerId-rendering")?r.PositionUVLayoutObjectAndLayerId:r.PositionUVLayout)}get test(){return{animationEnabled:this._animation.enabled}}}class q extends d.MaterialParameters{constructor(){super(...arguments);
this.waveStrength=.06;this.waveTextureRepeat=32;this.waveDirection=h.fromValues(1,0);this.waveVelocity=.05;this.flowStrength=.015;this.flowOffset=-.5;this.animationSpeed=.35;this.timeElapsed=0;this.color=m.fromValues(0,0,0,0);this.transparent=!0;this.draped=this.hasSlicePlane=!1;this.receiveShadows=!0;this.hasCloudsReflections=this.hasScreenSpaceReflections=!1;this.origin=k.create();this.modelTransformation=null}}a.WaterMaterial=t;a.WaterMaterialParameters=q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","./WaterTechnique"],function(a,b,n,h){class k extends n{_updateShadowState(m){m.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:m.shadowMap.enabled})}_updateSSRState(m){m=null!=m.ssr.lastFrameColor;m!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:m})}_updateCloudsReflectionState(m){m=
null!=m.cloudsFade.data;m!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:m})}ensureResources(m){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(m)}beginSlot(m){this._output===b.ShaderOutput.Color&&(this._updateShadowState(m),this._updateSSRState(m),this._updateCloudsReflectionState(m));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(h.WaterTechnique,
m)}}a.WaterGLMaterial=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){class q extends g.WaterDistortionPassParameters{}class u extends d.ShaderTechnique{initializeConfiguration(y,D){D.spherical=y.viewingMode===h.ViewingMode.Global;D.doublePrecisionRequiresObfuscation=y.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(y){return new r.Program(y.rctx,u.shader.get().build(this.configuration),l.Default3D)}_setPipelineState(y){const D=this.configuration,G=y===x.TransparencyPassType.NONE,A=y===x.TransparencyPassType.FrontFace;
return t.makePipelineState({blending:D.output!==k.ShaderOutput.Normal&&D.output!==k.ShaderOutput.Highlight&&D.output!==k.ShaderOutput.ObjectAndLayerIdColor&&D.transparent?G?f.blendingDefault:f.oitBlending(y):null,depthTest:D.draped?null:{func:f.oitDepthTest(y)},depthWrite:D.draped?null:G?D.writeDepth?t.defaultDepthWriteParams:null:f.oitDepthWrite(y),colorWrite:t.defaultColorWriteParams,polygonOffset:G||A?null:f.getOITPolygonOffset(D.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}
u.shader=new e.ReloadableShaderModule(p.WaterSurface,()=>new Promise((y,D)=>a(["../shaders/WaterSurface.glsl"],y,D)));class v extends w.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.transparencyPassType=x.TransparencyPassType.NONE;this.transparent=this.hasSlicePlane=this.receiveShadows=this.spherical=!1;this.enableOffset=!0;this.cullAboveGround=this.multipassEnabled=this.draped=this.objectAndLayerIdColorInstanced=this.hasCloudsReflections=this.doublePrecisionRequiresObfuscation=
this.hasScreenSpaceReflections=this.writeDepth=!1}}n.__decorate([c.parameter({count:k.ShaderOutput.COUNT})],v.prototype,"output",void 0);n.__decorate([c.parameter({count:x.TransparencyPassType.COUNT})],v.prototype,"transparencyPassType",void 0);n.__decorate([c.parameter()],v.prototype,"spherical",void 0);n.__decorate([c.parameter()],v.prototype,"receiveShadows",void 0);n.__decorate([c.parameter()],v.prototype,"hasSlicePlane",void 0);n.__decorate([c.parameter()],v.prototype,"transparent",void 0);n.__decorate([c.parameter()],
v.prototype,"enableOffset",void 0);n.__decorate([c.parameter()],v.prototype,"writeDepth",void 0);n.__decorate([c.parameter()],v.prototype,"hasScreenSpaceReflections",void 0);n.__decorate([c.parameter()],v.prototype,"doublePrecisionRequiresObfuscation",void 0);n.__decorate([c.parameter()],v.prototype,"hasCloudsReflections",void 0);n.__decorate([c.parameter()],v.prototype,"objectAndLayerIdColorInstanced",void 0);n.__decorate([c.parameter()],v.prototype,"draped",void 0);n.__decorate([c.parameter()],
v.prototype,"multipassEnabled",void 0);n.__decorate([c.parameter()],v.prototype,"cullAboveGround",void 0);n.__decorate([c.parameter({constValue:!1})],v.prototype,"occlusionPass",void 0);n.__decorate([c.parameter({constValue:m.PBRMode.Water})],v.prototype,"pbrMode",void 0);n.__decorate([c.parameter({constValue:!0})],v.prototype,"useCustomDTRExponentForWater",void 0);n.__decorate([c.parameter({constValue:!0})],v.prototype,"highStepCount",void 0);n.__decorate([c.parameter({constValue:!1})],v.prototype,
"useFillLights",void 0);b.WaterMaterialPassParameters=q;b.WaterTechnique=u;b.WaterTechniqueConfiguration=v;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/math/vec2 ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ./FoamRendering.glsl ./ReadShadowMap.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends g.ReadShadowMapPassParameters{}const r=k.create(),x=n.create();a.WaterDistortion=function(w){w.fragment.uniforms.add(new l.Texture2DPassUniform("texWaveNormal",p=>p.waveNormal),new l.Texture2DPassUniform("texWavePerturbation",p=>p.wavePerturbation),new d.Float4PassUniform("waveParams",p=>h.set(r,p.waveStrength,p.waveTextureRepeat,p.flowStrength,p.flowOffset)),new e.Float2PassUniform("waveDirection",p=>b.set(x,p.waveDirection[0]*p.waveVelocity,p.waveDirection[1]*
p.waveVelocity)));w.include(m.FoamIntensity);w.fragment.code.add(c.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){function C(I){const H=new D.ShaderBuilder,{vertex:J,fragment:B}=H;q.addProjViewLocalOrigin(J,I);H.include(k.Transform,I);H.attributes.add(A.VertexAttribute.POSITION,"vec3");H.attributes.add(A.VertexAttribute.UV0,"vec2");const z=new u.Float4PassUniform("waterColor",K=>K.color);if(I.output===n.ShaderOutput.Color&&I.draped)return H.varyings.add("vpos","vec3"),J.uniforms.add(z),J.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),B.uniforms.add(z),B.code.add(y.glsl`void main() {
fragColor = waterColor;
}`),H;if(I.output===n.ShaderOutput.Color||I.output===n.ShaderOutput.Alpha)H.include(l.NormalUtils,I),H.include(b.ForwardLinearDepth,I),H.varyings.add("vuv","vec2"),H.varyings.add("vpos","vec3"),H.varyings.add("vnormal","vec3"),H.varyings.add("vtbnMatrix","mat3"),I.multipassEnabled&&H.varyings.add("depth","float"),J.uniforms.add(z),J.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${I.multipassEnabled?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${I.output===n.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);H.include(c.multipassTerrainTest,I);switch(I.output){case n.ShaderOutput.Alpha:H.include(h.SliceDraw,I);B.uniforms.add(z);B.code.add(y.glsl`
        void main() {
          discardBySlice(vpos);
          ${I.multipassEnabled?"terrainDepthTest(depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case n.ShaderOutput.Color:H.include(d.MainLighting);H.include(e.EvaluateAmbientLighting,{pbrMode:f.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});H.include(w.WaterDistortion);H.include(h.SliceDraw,I);H.include(r.ReadShadowMapDraw,I);H.include(x.Water,I);B.uniforms.add(z,new v.FloatPassUniform("timeElapsed",K=>K.timeElapsed),J.uniforms.get("view"),J.uniforms.get("localOrigin"));q.addCameraPosition(B,I);B.include(t.ColorConversion);d.addMainLightDirection(B);d.addMainLightIntensity(B);
B.code.add(y.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.multipassEnabled?"terrainDepthTest(depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${I.receiveShadows?y.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${I.transparencyPassType===G.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `);break;case n.ShaderOutput.Normal:H.include(l.NormalUtils,I);H.include(w.WaterDistortion,I);H.include(h.SliceDraw,I);H.varyings.add("vpos","vec3");H.varyings.add("vuv","vec2");J.uniforms.add(z);J.code.add(y.glsl`
        void main(void) {
          if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);B.uniforms.add(new v.FloatPassUniform("timeElapsed",K=>K.timeElapsed));B.code.add(y.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case n.ShaderOutput.Highlight:H.include(g.OutputHighlight,I);H.varyings.add("vpos","vec3");J.uniforms.add(z);J.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `);H.include(h.SliceDraw,I);B.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case n.ShaderOutput.ObjectAndLayerIdColor:H.include(m.ObjectAndLayerIdColor,I),H.varyings.add("vpos","vec3"),J.uniforms.add(z),J.code.add(y.glsl`
      void main(void) {
        if (waterColor.a < ${y.glsl.float(p.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),H.include(h.SliceDraw,I),B.code.add(y.glsl`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return H}const E=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=E;a.build=C})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,
textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},
"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["exports",
"./defaultSymbolComplexity","./interfaces","./Loadable"],function(a,b,n,h){class k extends h.Loadable{constructor(m,g,e){super(g);this.symbol=m;this._convert=e;this.symbologySnappingSupported=!1;this.graphics3DSymbol=null;this.referenced=0}getSymbolLayerSize(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(m):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:
0}async doLoad(m){m=await this.symbol.fetchSymbol({signal:m});m.id=this.symbol.id;this.graphics3DSymbol=this._convert(m);null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(m){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(m,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:b.emptySymbolComplexity}globalPropertyChanged(m,g){return null!=this.graphics3DSymbol?this.graphics3DSymbol.globalPropertyChanged(m,
g):!1}applyRendererDiff(m,g){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(m,g):n.ApplyRendererDiffResult.RecreateSymbol}prepareSymbolPatch(m){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(m)}updateGeometry(m,g){return null!=this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(m,g):!1}updateTransform(m,g,e,d){return this.graphics3DSymbol?.updateTransform(m,g,e,d)??!1}onRemoveGraphic(){}getFastUpdateStatus(){return null!=this.graphics3DSymbol?
this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}a.Graphics3DWebStyleSymbol=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ./constants ./graphicSymbolUtils ./LabelParameters ../../webgl-engine/lib/TextRenderer ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(C){C=e.getGraphics3DSymbol(C.graphics3DGraphic.graphics3DSymbol);return null!=C?C.symbol.symbolLayers.at(0):null}function r(C,E){var I=E.graphics3DGraphic.graphic.geometry;if(null==I)return null;if(null!=E.disablePlacement)return E.labelClass.labelPlacement?(v().warnOncePerTick(x(C?.placement,E.disablePlacement.logEntityDescription)),w(E)):C;I=I.type;switch(I){case "polyline":case "polygon":case "extent":case "multipoint":if(E.labelClass.labelPlacement)return v().warnOncePerTick(x(C?.placement,
`'${I}' geometries`)),w(E)}return C}function x(C,E){return`the requested label placement '${C}' is currently unsupported for ${E} in SceneView.`}function w(C){const E=C.graphics3DGraphic.graphic.geometry;if(null==E)return null;switch(E.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};case "polygon":return C=f(C),null!=C&&"extrude"===C.type?D["above-center"]:{placement:"center-center",normalizedOffset:k.ZEROS,anchor:"center"};
case "point":return D["above-center"];case "mesh":return D["above-center"]}}function p(C,E=G){({graphics3DGraphic:C}=C);(C=C.layers[0]?.stageObject.geometries[0].material??null)&&C instanceof l.HUDMaterial?(C=C.parameters.anchorPosition,E[0]=2*(C[0]-.5),E[1]=2*(C[1]-.5)):(E[0]=0,E[1]=0);return E}function t(C,E,I){I=null!=I?I.getBoundingBoxObjectSpace(A):A;I=k.fromValues(I[3]-I[0],I[4]-I[1],I[5]-I[2]);C.centerOffset[0]=Math.sqrt(I[0]*I[0]+I[1]*I[1])/2*E.normalizedOffset[0];const H=C.translation[2],
J=I[2]/2*E.normalizedOffset[1];C.translation[2]=0;C.elevationOffset=H+J;I=h.length(I);C.centerOffset[2]=I/2*E.normalizedOffset[2]}function q(C){const E=C.labelClass.labelPlacement,{labelSymbol:I,graphics3DGraphic:H}=C;var J=e.getGraphics3DSymbol(H.graphics3DSymbol);J="point-3d"===J?.symbol.type?J.symbol:null;C=D[E]||w(C);if(null!=J&&J.supportsCallout()&&J.hasVisibleVerticalOffset()&&!H.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:u(J.verticalOffset),anchor:null,normalizedOffset:null};
if(I&&I.hasVisibleVerticalOffset()&&(null==J||!J.supportsCallout()||!J.verticalOffset||H.isDraped)){if(!(J=!C)){a:switch(C.placement){case "above-center":J=!0;break a;default:J=!1}J=!J}return J?(v().errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+E+" placement)"),null):{placement:"above-center",verticalOffset:u(I.verticalOffset),anchor:"bottom",normalizedOffset:[0,C.normalizedOffset[1],0],hasLabelVerticalOffset:!0}}return{placement:null,
verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function u(C){const {screenLength:E,minWorldLength:I,maxWorldLength:H}=C;return{screenLength:E,minWorldLength:I,maxWorldLength:H}}const v=()=>n.getLogger("esri.views.3d.layers.graphics.labelPlacement");class y{constructor(C,E,I,H=null){this.graphics3DGraphic=C;this.labelSymbol=E;this.labelClass=I;this.disablePlacement=H}}const D={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",
normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",
normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],
"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const C in b){const E=D[C];b[C].forEach(I=>{D[I]=E})}Object.freeze&&(Object.freeze(D),Object.keys(D).forEach(C=>{Object.freeze(D[C]);Object.freeze(D[C]?.normalizedOffset)}));const G=[0,0],A=m.create();a.LabelInfo=y;a.getLabelPlacement=function(C){var E=q(C);if(null==E)return null;if(E.anchor)var I=E;else{I=C.labelClass.labelPlacement;var H=D[I],J=H||w(C);I&&!H&&v().warnOncePerTick(`the requested label placement '${I}' is currently unsupported in SceneView.`);
I=r(J,C)}if(null==I)return null;E=new d.LabelPlacement(E.verticalOffset,I.anchor,!!E.hasLabelVerticalOffset);H=C.graphics3DGraphic.graphic.geometry;if(null==H)C=null;else{switch(H.type){case "point":J=f(C);if(null!=J)switch(H=C.graphics3DGraphic.layers[0],null!=H?H.getCenterObjectSpace(E.translation):h.set(E.translation,0,0,0),J.type){case "icon":case "text":({graphics3DGraphic:J}=C);H=null!=H?H.getScreenSize():null;J.isDraped||null==H?E.hasLabelVerticalOffset||"center"===E.anchor||(D[C.labelClass.labelPlacement]&&
v().warnOncePerTick(`the requested placement '${I.placement}' is currently unsupported for draped graphics`),E.anchor="center"):(C=p(C),E.screenOffset[0]=H[0]/2*(I.normalizedOffset[0]-C[0]),C=H[1]/2*(I.normalizedOffset[1]-C[1]),E.hasLabelVerticalOffset?(E.centerOffset[1]=C,E.centerOffsetUnits="screen"):E.screenOffset[1]=C);break;case "object":t(E,I,H)}break;case "polygon":H=f(C);if(null!=H)switch(H.type){case "extrude":C=C.graphics3DGraphic.layers[0],null!=C?(C.getBoundingBoxObjectSpace(A),m.center(A,
E.translation),E.translation[2]=m.height(A)/2):h.set(E.translation,0,0,0),t(E,I,C)}break;case "mesh":t(E,I,C.graphics3DGraphic.layers[0])}C=g.labelMarginPx-c.textVerticalPaddingPx;E.screenOffset[0]+=C*I.normalizedOffset[0];E.screenOffset[1]+=C*I.normalizedOffset[1];C=E}return C};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){class b{constructor(n){this._stage=n;this._materials=new Map}get(n){return this._materials.get(n)}add(n,
h){this._materials.set(n,h);this._stage.add(h)}dispose(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()}}a.MaterialCollection=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){a.FeatureTileTree3D=class extends n{get tilingScheme(){const y=this.tilingSchemeOwner.tilingScheme;return y?y.clone():null}set filterExtent(y){if(null==y||y.spatialReference.equals(this.viewState.spatialReference)){var D=this._get("filterExtent");D===y||null!=D&&y&&D.equals(y)||(y=null!=y?y.clone():null,this._set("filterExtent",y),this._setDirty())}else m.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view")}get _filterExtentRect(){if(null==
this.filterExtent)return null;const y=w.create();q.toBoundingRect(this.filterExtent,y,this.tilingScheme.spatialReference);return y}get _rootTileIds(){const {tilingScheme:y}=this;return this._filterExtentRect&&y?y.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(y){y!==this._get("suspended")&&(this._set("suspended",y),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(y){super(y);this.tiles=new h;this.tileSize=512;this._idToTile=new Map;this._clients=
new Set;this._dirty=!1;this._pendingTiles=null;this._newTiles=new e}initialize(){this.addHandles([d.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),d.sync),d.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,this.focus?.location],()=>this._setDirty(),d.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.TaskPriority.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=g.removeMaybe(this._frameWorker)}addClient(){const y=
c.generateUID();this._clients.add(y);1===this._clients.size&&this._setDirty();return k.makeHandle(()=>this._removeClient(y))}_removeClient(y){this._clients.delete(y);this._hasClients||this._clear()}get _hasClients(){return 0<this._clients.size}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(u.noBudget))}_clear(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")}get running(){return this.updating}runTask(y){this._dirty=
!1;this._pendingTiles||(this._startUpdate(),null!=this._frameWorker&&(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(y);this._pendingTiles||null==this._frameWorker||(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new t.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,
tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()}_getRootTiles(){const {tilingScheme:y}=this;return this._rootTileIds.map(D=>new p.FeatureTileDescriptor3D(D[0],D[1],D[2],y))}_purgeHorizonTiles(y){y.sort((D,G)=>{D=D.measures.screenRect;G=G.measures.screenRect;
return D[1]+D[3]-(G[1]+G[3])});if(!(50<y.length))return y.toArray();w.empty(v);for(let D=0;D<y.length;D++)if(w.expand(v,y.data[D].measures.screenRect,v),10<w.height(v))return y.data.slice(D,y.length);return[]}_subdivideTilesForView(y){if(this._pendingTiles){for(var {tilingScheme:D}=this;0<this._pendingTiles.length&&!y.done;){const G=this._pendingTiles.pop();y.madeProgress();if(!this._filterExtentRect||w.intersects(this._filterExtentRect,G.extent))this._tileMeasurements.updateTile(G),G.measures.visibility!==
p.Visibility.INVISIBLE&&(G.measures.shouldSplit?(D.ensureMaxLod(G.lij[0]+1),this._pendingTiles.push(...G.getChildren())):this._newTiles.push(G))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(y){for(var D of this.tiles.items)D.used=!1;y=y.filter(G=>{const A=this._idToTile.get(G.id);A?(A.copyMeasurementsFrom(G),A.used=!0):this._idToTile.set(G.id,G);return!A});D=this.tiles.items.filter(G=>
G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(D);this.tiles.addMany(y);this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((y,D)=>y.measures.visibility!==D.measures.visibility?y.measures.visibility===p.Visibility.VISIBLE_ON_SURFACE?-1:1:y.measures.distance-D.measures.distance);this.tiles.forEach((y,D)=>y.loadPriority=D)}};b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([l.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([l.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"terrain",void 0);b.__decorate([l.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);b.__decorate([l.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([l.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([l.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileTree3D.prototype,
"_rootTileIds",null);b.__decorate([l.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);b.__decorate([l.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([x.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);const v=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],
function(a,b){class n{constructor(h,k,m,g=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;g&&this.acquire(h,k,m,g)}acquire(h,k,m,g){this.tilingScheme=g;this.id=n.id(h,k,m);this.lij[0]=h;this.lij[1]=k;this.lij[2]=m;g.getExtent(h,k,m,this.extent);this.resolution=g.resolutionAtLevel(h)}release(){this.tilingScheme=null}getChildren(h){const k=this.lij[0]+
1,m=2*this.lij[1],g=2*this.lij[2];if(!h)return[new n(k,m,g,this.tilingScheme),new n(k,m+1,g,this.tilingScheme),new n(k,m,g+1,this.tilingScheme),new n(k,m+1,g+1,this.tilingScheme)];h[0].acquire(k,m,g,this.tilingScheme);h[1].acquire(k,m+1,g,this.tilingScheme);h[2].acquire(k,m,g+1,this.tilingScheme);h[3].acquire(k,m+1,g+1,this.tilingScheme);return h}copyMeasurementsFrom(h){this.measures.visibility=h.measures.visibility;this.measures.shouldSplit=h.measures.shouldSplit;this.measures.distance=h.measures.distance;
b.copy(h.measures.screenRect,this.measures.screenRect)}static id(h,k,m){return`${h}/${k}/${m}`}}a.Visibility=void 0;(function(h){h[h.INVISIBLE=0]="INVISIBLE";h[h.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";h[h.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ../../../ViewingMode ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(G,A,C,E){const I=g.signedDistance(E,A);E=g.signedDistance(E,C);const H=Math.abs(E-I);n.scale(G,A,Math.abs(E)/H);n.scaleAndAdd(G,G,C,Math.abs(I)/H)}class x{constructor(G){this._camera=new f.Camera;this._focusOnMap=[0,0];this._screenRect=k.create();this._tileSize=G.tileSize;this._renderCoordsHelper=G.renderCoordsHelper;this._tilingScheme=G.tilingScheme;this._visibility=new l.FeatureTileVisibility3D(G.renderCoordsHelper)}begin(G,A,C){this._camera.copyFrom(G);
this._surfaceElevation=C;this._focusOnMap[0]=A.x;this._focusOnMap[1]=A.y;k.fromValues(0,0,G.fullWidth,G.fullHeight,this._screenRect);this._visibility.begin(this._camera,C)}end(){this._visibility.end()}updateTile(G){G.measures.visibility=this._visibility.calculate(G);G.measures.distance=k.distance(G.extent,this._focusOnMap);G.measures.visibility!==c.Visibility.INVISIBLE&&this._updateScreenMeasure(G)}_updateScreenMeasure(G){const A=G.measures.screenRect;k.empty(A);let C=0;var E=G.lij,I=E[0];const H=
I+2,J=E[1]<<2,B=E[2]<<2;var z=this._tileSizeWithBias(G);z*=z;var K=this._camera;const {frustum:L,viewport:F}=K;if(this._renderCoordsHelper.viewingMode===d.ViewingMode.Local||I>l.globalTileLevelThreshold){I=p;this._tilingScheme.getExtent(E[0],E[1],E[2],I);const M=w,S=y;E=k.empty();for(let N=0;4>N;++N)this._toRenderCoords(I,D[N][0],D[N][1],S[N]),K.projectToScreen(S[N],M[N]),k.expandPointInPlace(E,M[N]);K=l.isConvexHullOutsideOfFrustum(L,S,4);I=E[0]>F[2]||E[1]>F[3]||E[2]<F[0]||E[3]<F[1];if(K||I){G.measures.shouldSplit=
!1;return}}for(K=0;4>K;K++)for(I=0;4>I;I++)if(C+=this._computeScreenArea(H,J+K,B+I,A),C>z){G.measures.shouldSplit=!0;return}G.measures.shouldSplit=!1}_tileSizeWithBias(G){return G.measures.visibility===c.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize}_computeScreenArea(G,A,C,E){this._tilingScheme.ensureMaxLod(G);const I=p;this._tilingScheme.getExtent(G,A,C,I);G=q;this._toRenderCoords(I,0,3,G[0]);this._toRenderCoords(I,2,3,G[1]);this._toRenderCoords(I,2,1,G[2]);this._toRenderCoords(I,
0,1,G[3]);return this._computeTriangleScreenArea([G[0],G[1],G[2]],E)+this._computeTriangleScreenArea([G[2],G[1],G[3]],E)}_computeTriangleScreenArea(G,A){const C=this._camera.frustum[m.PlaneIndex.NEAR];var E=0,I=-1,H=-1;for(var J=0;3>J;++J)0<g.signedDistance(C,G[J])?(E++,-1===I&&(I=J)):-1===H&&(H=J);return 0===E?this._computeTriangleScreenAreaInside(G,A):1===E?(H=v,E=(I+1)%3,J=(I+2)%3,n.copy(H[0],G[E]),n.copy(H[1],G[J]),r(H[2],G[J],G[I],C),J=this._computeTriangleScreenAreaInside(H,A),r(H[1],G[E],G[I],
C),G=this._computeTriangleScreenAreaInside(H,A),J+G):2===E?(I=v,E=H,n.copy(I[0],G[E]),J=(H+2)%3,r(I[1],G[E],G[(H+1)%3],C),r(I[2],G[E],G[J],C),this._computeTriangleScreenAreaInside(I,A)):0}_computeTriangleScreenAreaInside(G,A){for(let C=0;3>C;C++)this._camera.projectToRenderScreen(G[C],u),this._camera.renderToScreen(u,w[C]),k.expand(A,w[C],A);return e.areaPoints2d(w[0],w[1],w[2])}_toRenderCoords(G,A,C,E){t[0]=G[A];t[1]=G[C];t[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(t,this._tilingScheme.spatialReference,
E);return E}}const w=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],p=k.create(),t=h.create(),q=[h.create(),h.create(),h.create(),h.create()],u=b.createRenderScreenPointArray3(),v=[h.create(),h.create(),h.create()],y=[h.create(),h.create(),h.create(),h.create()],D=[[0,3],[2,3],[2,1],[0,1]];a.FeatureTileMeasurements3D=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVec3Array ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(pa,Aa,ra){h.cross(pa,Aa,ra);h.normalize(pa,pa);return pa}function t(pa,Aa,ra){h.sub(pa,Aa,ra);h.normalize(pa,pa);return pa}function q(pa,Aa){h.scale(pa,pa,Aa/h.len(pa));return pa}function u(pa,Aa,ra){for(const Ma of I){a:{var ua=pa[Ma];var Ea=Aa,Ka=ra;for(let Ua=0;Ua<Ka;++Ua)if(0>c.signedDistance(ua,Ea[Ua])){ua=!1;break a}ua=!0}if(ua)return!0}return!1}function v(pa,Aa,ra){for(const ua of Aa)if(h.dot(ua,pa)<ra)return!1;return!0}function y(pa,Aa,ra,
ua){var Ea=ja;p(Ea,pa,Aa);pa=Ba;Aa=Infinity;let Ka=-Infinity;for(var Ma of ra)ra=h.dot(Ea,Ma),Aa=Math.min(Aa,ra),Ka=Math.max(Ka,ra);pa[0]=Aa;pa[1]=Ka;a:{Ma=pa[0];ra=pa[1];pa=Infinity;Aa=-Infinity;for(const Ua of ua)if(ua=h.dot(Ea,Ua),pa=Math.min(pa,ua),Aa=Math.max(Aa,ua),pa<=ra&&Aa>=Ma){Ea=!1;break a}Ea=!0}return Ea}class D{constructor(pa){this._renderCoordsHelper=pa;this._surfaceElevation=0;this._cache=new Map;this._frustumBoundingSphereCenter=k.create();this._frustumBoundingSphereRadius=0;this._frustum=
new x.Frustum(pa);this._extendedFrustum=new x.Frustum(pa);this._intersector=new w.FrustumExtentIntersection({renderCoordsHelper:pa});this._renderCoordsHelper=pa}begin(pa,Aa){this._surfaceElevation=Aa;this._aboveGround=this._renderCoordsHelper.getAltitude(pa.eye)>Aa;this._frustum.update(pa);this._shortenFrustumFarPlane(this._frustum);this._updateExtendedFrustum(pa);this._updateFrustumBoundingSphere()}end(){this._cache.clear()}calculate(pa){const Aa=this._renderCoordsHelper.viewingMode===f.ViewingMode.Global&&
2<=pa.lij[0]&&6>pa.lij[0],ra=this._getOrCalculateSingleTileVisibility(pa,!Aa);return ra!==r.Visibility.INVISIBLE&&Aa?this._calculateAggregatedChildrenVisibility(pa):ra}_shortenFrustumFarPlane(pa){var Aa=x.Frustum.nearFarLineIndices;const ra=pa.mutablePoints;for(const ua of Aa){const [Ea,Ka]=ua;Aa=ra[Ea];h.subtract(G,ra[Ka],Aa);h.scale(G,G,.95);h.add(ra[Ka],Aa,G)}pa.updatePoints(ra)}_calculateAggregatedChildrenVisibility(pa){let Aa=r.Visibility.INVISIBLE;var ra=this._cache.get(pa.id);if(null!=ra)return ra;
ra=E.acquire();pa.getChildren(ra);for(const ua of ra){const Ea=this.calculate(ua);if(Ea!==r.Visibility.INVISIBLE&&(Aa=Ea,Ea===r.Visibility.VISIBLE_ON_SURFACE))break}E.release(ra);this._cache.set(pa.id,Aa);return Aa}_getOrCalculateSingleTileVisibility(pa,Aa){var ra=this._cache.get(pa.id);if(null!=ra)return ra;ra=this._calculateSingleTileVisibility(pa);Aa&&this._cache.set(pa.id,ra);return ra}_calculateSingleTileVisibility(pa){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===f.ViewingMode.Global&&
12>pa.lij[0]){if(this._calculateSingleTileVisibilitySided(pa,!1)===r.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(pa,!0)}else return this._calculateSingleTileVisibilitySided(pa,this._aboveGround)}_isTileVisibleInFrustum(pa){return this._renderCoordsHelper.viewingMode===f.ViewingMode.Local?this._isTileVisibleInFrustumLocal(pa):this._isTileVisibleInFrustumGlobal(pa)}_updateFrustumBoundingSphere(){var pa=this._frustum;const Aa=pa.origin,ra=O;h.normalize(ra,pa.direction);var ua=
T;h.sub(ua,pa.points[4],Aa);pa=h.dot(ua,ua);ua=h.dot(ra,ua);ua=.5*pa/ua;h.scaleAndAdd(this._frustumBoundingSphereCenter,Aa,ra,ua);this._frustumBoundingSphereRadius=1+ua}_isTileVisibleInFrustumLocal(pa){var Aa=pa.tilingScheme.spatialReference,ra=pa.extent,ua=this._renderCoordsHelper.spatialReference;pa=J;pa[0]=ra[0];pa[1]=ra[1];pa[2]=0;pa[3]=ra[2];pa[4]=ra[3];pa[5]=0;if(!g.projectBuffer(pa,Aa,0,pa,ua,0,2))return!1;Aa=B;h.set(Aa[0],pa[0],pa[1],0);h.set(Aa[1],pa[3],pa[1],0);h.set(Aa[2],pa[3],pa[4],0);
h.set(Aa[3],pa[0],pa[4],0);var Ea=z;h.set(Ea,.5*(pa[0]+pa[3]),.5*(pa[1]+pa[4]),.5*(pa[2]+pa[5]));pa=K;h.set(pa,0,0,1);var Ka=.5*h.dist(Aa[0],Aa[2]);ra=this._frustum;ua=this._frustumBoundingSphereRadius;const Ma=this._frustumBoundingSphereCenter;var Ua=V;h.sub(Ua,Ma,Ea);Ua=h.dot(pa,Ua);const Ga=Q;h.scaleAndAdd(Ga,Ea,pa,Ua);if(h.dist(Ga,Ma)>Ka+ua)return!1;Ea=H;Ka=Ua+ua;ua=Ua-ua;for(Ua=0;4>Ua;++Ua)h.scaleAndAdd(Ea[Ua],Aa[Ua],pa,Ka),h.scaleAndAdd(Ea[Ua+4],Aa[Ua],pa,ua);return!u(ra.planes,Ea,8)}_isTileVisibleInFrustumGlobal(pa){var Aa=
pa.tilingScheme.spatialReference,ra=pa.extent,ua=this._renderCoordsHelper.spatialReference;if(3>pa.lij[0])return!0;const Ea=B;var Ka=.5*(ra[0]+ra[2]);h.set(Ea[0],ra[0],ra[1],0);h.set(Ea[1],ra[2],ra[1],0);h.set(Ea[2],ra[2],ra[3],0);h.set(Ea[3],ra[0],ra[3],0);h.set(Ea[4],Ka,ra[1],0);h.set(Ea[5],Ka,ra[3],0);if(!e.projectVec3Array(Ea,Aa,0,Ea,ua,0,6))return!1;var Ma=0<Ea[0][2],Ua=0>Ea[3][2];ra=Ma||Ua;ua=m.getReferenceEllipsoid(ua).radius;if(ra){var Ga=k.fromValues(0,0,1);Ka=F;p(Ka,Ga,Ea[0]);ra=M;p(ra,
Ga,Ea[1]);if(Ma){Ma=L;Ua=Ea[4];var Na=S;p(Na,Ua,Ga);p(Ma,Na,Ua);Ga=Ea[0];h.cross(Ga,Ka,Ma);q(Ga,ua);Ka=Ea[1];h.cross(Ka,ra,Ma);q(Ka,ua)}else Ua&&(Ma=L,Ua=Ea[5],Na=S,p(Na,Ua,Ga),p(Ma,Ua,Na),Ga=Ea[3],h.cross(Ga,Ma,Ka),q(Ga,ua),Ka=Ea[2],h.cross(Ka,Ma,ra),q(Ka,ua))}Ga=z;ra=ba;h.sub(ra,Ea[3],Ea[0]);h.normalize(ra,ra);Ka=ia;h.add(Ka,Ea[0],Ea[3]);h.scale(Ka,Ka,.5);Ua=-h.dot(Ka,ra);Ka=fa;Na=da;h.add(Ka,Ea[0],Ea[1]);h.scale(Ka,Ka,.5);h.add(Na,Ea[2],Ea[3]);h.scale(Na,Na,.5);Ma=aa;h.sub(Ma,Na,Ka);h.normalize(Ma,
Ma);ra=-(Ua+h.dot(ra,Ka))/h.dot(ra,Ma);h.scaleAndAdd(Ga,Ka,Ma,ra);q(Ga,ua);Ka=this._frustumBoundingSphereRadius;Ua=this._frustumBoundingSphereCenter;const Va=this._frustum;ra=Va.planes;if(Ea.some(ka=>Va.intersectsPoint(ka))||Va.intersectsPoint(Ga))return!0;Na=N;h.normalize(Na,Ga);Ga=W;h.sub(Ga,Ua,U);Ma=h.dot(Ga,Na);if(Ma<-Ka)return!1;Ga=R;h.normalize(Ga,Ea[0]);Ga=h.dot(Ga,Na);if(0>=Ga)return!0;var Xa=P;h.scale(Xa,Na,Ma);Ua=h.dist(Xa,Ua);Aa=Aa.isWGS84;Na=pa.lij;pa=Aa&&Na[2]===2**Na[0]-1;Na=(Aa=Aa&&
0===Na[2])?Ca:pa?ta:oa;pa=Aa?ma:pa?va:qa;Aa=Va.points;Xa=wa;const Pa=ea,bb=ha,gb=U;for(var cb of Na)if(Na=Ea[cb],t(Pa,Ea[(cb+1)%4],Na),t(bb,gb,Na),p(Xa,bb,Pa),v(Xa,Aa,1))return!1;cb=null;if(Ma<2*Ka){cb=2.5*Ka;if(Ua>Ga*cb+Ka)return!1;Ka=X;cb/=Ga;for(Ga=0;4>Ga;++Ga)h.scale(Ka[Ga],Ea[Ga],cb/ua);h.set(Ka[4],0,0,0);cb=Ka}else{cb=(Ma+Ka)/Ga;Ka=(Ma-Ka)/Ga;Ga=ca;for(Ma=0;4>Ma;++Ma)Ua=Ea[Ma],h.scale(Ga[Ma+4],Ua,Ka/ua),h.scale(Ga[Ma],Ua,cb/ua);cb=Ga}if(u(ra,cb,cb.length))return!1;ua=Va.lines;ra=Y;Ka=Z;for(const ka of pa){h.normalize(ra,
Ea[ka]);for(const mb of ua)if(h.normalize(Ka,mb.direction),y(Ka,ra,cb,Aa))return!1}return!0}_calculateSingleTileVisibilitySided(pa,Aa){return this._isTileVisibleInFrustum(pa)?(this._intersector.update(pa.extent,pa.tilingScheme.spatialReference,this._surfaceElevation,Aa),pa=m.getReferenceEllipsoid(pa.tilingScheme.spatialReference).radius,this._intersector.isVisibleInFrustum(this._frustum,pa,!0)?r.Visibility.VISIBLE_ON_SURFACE:r.Visibility.VISIBLE_WHEN_EXTENDED):r.Visibility.INVISIBLE}_updateExtendedFrustum(pa){this._extendedFrustum.update(pa);
this._shortenFrustumFarPlane(this._extendedFrustum);var Aa=this._renderCoordsHelper.worldUpAtPosition(pa.eye,G);this._aboveGround||h.negate(Aa,Aa);if(this._hasExtendedFrustum=b.acosClamped(-h.dot(Aa,pa.viewForward))>pa.fovY/2){pa=this._extendedFrustumParameters();Aa=this._extendedFrustum.mutablePoints;for(let ra=0;4>ra;ra++){const ua=pa.pointIndices[ra],Ea=Aa[ua],Ka=this._renderCoordsHelper.getAltitude(Ea);if(pa.needsAltitudeAdjustment(Ka)){this._renderCoordsHelper.worldUpAtPosition(Ea,G);switch(ua){case d.PointIndex.FAR_BOTTOM_LEFT:case d.PointIndex.FAR_TOP_LEFT:case d.PointIndex.NEAR_BOTTOM_LEFT:case d.PointIndex.NEAR_TOP_LEFT:c.projectVector(this._extendedFrustum.planes[d.PlaneIndex.LEFT],
G,G);break;case d.PointIndex.FAR_BOTTOM_RIGHT:case d.PointIndex.FAR_TOP_RIGHT:case d.PointIndex.NEAR_BOTTOM_RIGHT:case d.PointIndex.NEAR_TOP_RIGHT:c.projectVector(this._extendedFrustum.planes[d.PlaneIndex.RIGHT],G,G)}h.scale(G,G,pa.direction);this._renderCoordsHelper.intersectInfiniteManifold(l.wrap(Ea,G),pa.zWithMargin,Ea)}}this._extendedFrustum.updatePoints(Aa);c.fromPoints(Aa[d.PointIndex.NEAR_BOTTOM_LEFT],Aa[d.PointIndex.NEAR_BOTTOM_RIGHT],Aa[d.PointIndex.NEAR_TOP_RIGHT],A);c.fromPoints(Aa[d.PointIndex.NEAR_BOTTOM_RIGHT],
Aa[d.PointIndex.NEAR_TOP_RIGHT],Aa[d.PointIndex.NEAR_TOP_LEFT],C);0>h.dot(c.getNormal(A),c.getNormal(C))&&(pa=this._extendedFrustum.mutablePoints,this._aboveGround?[pa[d.PointIndex.NEAR_BOTTOM_LEFT],pa[d.PointIndex.NEAR_BOTTOM_RIGHT]]=[pa[d.PointIndex.NEAR_BOTTOM_RIGHT],pa[d.PointIndex.NEAR_BOTTOM_LEFT]]:[pa[d.PointIndex.NEAR_TOP_LEFT],pa[d.PointIndex.NEAR_TOP_RIGHT]]=[pa[d.PointIndex.NEAR_TOP_RIGHT],pa[d.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(pa))}}_extendedFrustumParameters(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const pa=this._surfaceElevation-1;return{zWithMargin:pa,pointIndices:x.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(Aa){return Aa>pa}}}_extendedFrustumParametersBelowSurface(){const pa=this._surfaceElevation+1;return{zWithMargin:pa,pointIndices:x.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(Aa){return Aa<pa}}}}const G=k.create(),
A=c.create(),C=c.create(),E=new n(Array,pa=>{4!==pa.length&&(pa[0]=new r.FeatureTileDescriptor3D,pa[1]=new r.FeatureTileDescriptor3D,pa[2]=new r.FeatureTileDescriptor3D,pa[3]=new r.FeatureTileDescriptor3D)},pa=>{pa[0].release();pa[1].release();pa[2].release();pa[3].release()}),I=[d.PlaneIndex.LEFT,d.PlaneIndex.RIGHT,d.PlaneIndex.BOTTOM,d.PlaneIndex.TOP,d.PlaneIndex.FAR],H=[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()],J=[0,0,0,0,0,0],B=[k.create(),k.create(),
k.create(),k.create(),k.create(),k.create()],z=k.create(),K=k.create(),L=k.create(),F=k.create(),M=k.create(),S=k.create(),N=k.create(),P=k.create(),R=k.create(),O=k.create(),T=k.create(),Q=k.create(),V=k.create(),U=k.fromValues(0,0,0),W=k.create(),ca=[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()],X=[k.create(),k.create(),k.create(),k.create(),k.create()],ba=k.create(),ia=k.create(),fa=k.create(),da=k.create(),aa=k.create(),ea=k.create(),ha=k.create(),Y=
k.create(),Z=k.create(),ja=k.create(),oa=[0,1,2,3],qa=[0,1,2,3],ta=[0,1,3],va=[0,1,3],Ca=[1,2,3],ma=[1,2,3],wa=k.create(),Ba=[0,0];a.FeatureTileVisibility3D=D;a.globalTileLevelThreshold=3;a.isConvexHullOutsideOfFrustum=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVec3Array":function(){define(["exports","../../chunks/vec32","./projectors"],function(a,b,n){a.projectVec3Array=function(h,k,m,g,e,d,c=1){k=n.getProjector(k,e,n.projectorCache);if(null==
k)return!1;if(k===n.copy3){if(h===g&&m===d)return!0;c=m+c;for(let l=m,f=d;l<c;++l,++f)b.copy(g[f],h[l]);return!0}c=m+c;for(let l=m,f=d;l<c;++l,++f)k(h[l],0,g[f],0);return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/computeTranslationToOriginAndRotation ../../../geometry/projection/projectBoundingRect ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){const v=.5*Math.PI,y=v/Math.PI*180;class D{constructor(B){this._renderCoordsHelper=B.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:g.create(),direction:g.create()};for(B=0;4>B;B++)this._extent[B]={origin:g.create(),direction:g.create(),cap:{next:null,direction:g.create()}},this._planes[B]=p.create();this._planes[x.PlaneIndex.NEAR]=p.create();this._planes[x.PlaneIndex.FAR]=p.create();this._planesWithoutFar=
this._planes.slice(0,5)}update(B,z,K,L=!0){const F=this._extent;this._toRenderBoundingExtent(B,z,K);m.add(this._center.origin,F[0].origin,F[2].origin);m.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);L||m.scale(this._center.direction,this._center.direction,-1);for(K=0;4>K;K++){const M=F[K];this._renderCoordsHelper.worldUpAtPosition(M.origin,M.direction);const S=F[3===K?0:K+1];M.cap.next=S.origin;m.direction(M.cap.direction,
M.origin,S.origin);p.fromVectorsAndPoint(M.direction,M.cap.direction,M.origin,this._planes[K]);L||m.scale(M.direction,M.direction,-1)}p.fromVectorsAndPoint(F[0].cap.direction,F[1].cap.direction,F[0].origin,this._planes[x.PlaneIndex.NEAR]);L?p.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.FAR]):(p.copy(this._planes[x.PlaneIndex.FAR],this._planes[x.PlaneIndex.NEAR]),p.negate(this._planes[x.PlaneIndex.NEAR],this._planes[x.PlaneIndex.NEAR]));this._maxSpan=Math.max(Math.abs(B[0]-B[2]),
Math.abs(B[1]-B[3]));this._maxSpanSpatialReference=z;this._minGlobalAltitude=.9*e.getReferenceEllipsoid(this._maxSpanSpatialReference).radius}isVisibleInFrustum(B,z,K=!1){if(null==B)return!1;if(this._renderCoordsHelper.viewingMode===q.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?y:v*z))return!0;if(null!=B.altitude&&B.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(B)}if(0===this._maxSpan)return z=this._extent[0],!K&&B.intersectsRay(t.wrap(z.origin,
z.direction))?!0:!1;for(z=0;z<this._extent.length;z++){var L=this._extent[z];if(!K&&B.intersectsRay(t.wrap(L.origin,L.direction))||B.intersectsLineSegment(w.fromPoints(L.origin,L.cap.next,J),L.cap.direction))return!0}K=K?this._planes:this._planesWithoutFar;for(z=0;z<B.lines.length;z++)if(L=B.lines[z],u.frustumLineSegment(K,L.origin,L.endpoint,L.direction))return!0;return!1}_toRenderBoundingExtentGlobal(B,z,K){r.center(B,A);A[2]=K;d.computeTranslationToOriginAndRotation(z,A,C,this._renderCoordsHelper.spatialReference);
h.invert(E,C);f.empty(I);for(const {x0:L,x1:F,y0:M,y1:S}of G)for(let N=0;5>N;N++){const P=N/4;A[0]=n.lerp(B[L],B[F],P);A[1]=n.lerp(B[M],B[S],P);A[2]=K;l.projectVectorToVector(A,z,A,this._renderCoordsHelper.spatialReference);m.transformMat4(A,A,E);f.expandWithVec3(I,A)}m.set(this._extent[0].origin,I[0],I[1],I[2]);m.set(this._extent[1].origin,I[3],I[1],I[2]);m.set(this._extent[2].origin,I[3],I[4],I[2]);m.set(this._extent[3].origin,I[0],I[4],I[2]);for(B=0;4>B;++B)m.transformMat4(this._extent[B].origin,
this._extent[B].origin,C)}_toRenderBoundingExtentLocal(B,z,K){c.projectBoundingRect(B,z,H,this._renderCoordsHelper.spatialReference);m.set(this._extent[0].origin,H[0],H[1],K);m.set(this._extent[1].origin,H[2],H[1],K);m.set(this._extent[2].origin,H[2],H[3],K);m.set(this._extent[3].origin,H[0],H[3],K)}_toRenderBoundingExtent(B,z,K){switch(this._renderCoordsHelper.viewingMode){case q.ViewingMode.Global:this._toRenderBoundingExtentGlobal(B,z,K);break;case q.ViewingMode.Local:this._toRenderBoundingExtentLocal(B,
z,K);break;default:b.neverReached(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(B){if(0>p.signedDistance(B.planes[x.PlaneIndex.NEAR],this._center.origin)&&0>m.dot(this._center.direction,B.direction))return!0;for(let z=0;4>z;z++){const K=this._extent[z];if(0>p.signedDistance(B.planes[x.PlaneIndex.NEAR],K.origin)&&0>m.dot(K.direction,B.direction))return!0}return!1}}const G=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],A=g.create(),C=k.create(),
E=k.create(),I=f.create(),H=r.create(),J=w.create();a.FrustumExtentIntersection=D;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/projection/projectBuffer"],function(a,b,n){const h=b.create();a.projectToBoundingBox=function(k,m,g){if(null==k||null==g)return!1;let e;h[0]=null!=k.xmin?k.xmin:0;h[1]=null!=k.ymin?k.ymin:0;h[2]=null!=k.zmin?k.zmin:0;e=n.projectBuffer(h,
k.spatialReference,0,m,g,0,1);h[0]=null!=k.xmax?k.xmax:0;h[1]=null!=k.ymax?k.ymax:0;h[2]=null!=k.zmax?k.zmax:0;e=e&&n.projectBuffer(h,k.spatialReference,0,m,g,3,1);null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.zmin&&(m[2]=-Infinity);null==k.xmax&&(m[3]=Infinity);null==k.ymax&&(m[4]=Infinity);null==k.zmax&&(m[5]=Infinity);return e};a.toBoundingRect=function(k,m,g){if(null==k||null==g)return!1;let e;h[0]=null!=k.xmin?k.xmin:0;h[1]=null!=k.ymin?k.ymin:0;h[2]=null!=k.zmin?k.zmin:
0;e=n.projectBuffer(h,k.spatialReference,0,h,g,0,1);m[0]=h[0];m[1]=h[1];h[0]=null!=k.xmax?k.xmax:0;h[1]=null!=k.ymax?k.ymax:0;h[2]=null!=k.zmax?k.zmax:0;e=e&&n.projectBuffer(h,k.spatialReference,0,h,g,0,1);m[2]=h[0];m[3]=h[1];null==k.xmin&&(m[0]=-Infinity);null==k.ymin&&(m[1]=-Infinity);null==k.xmax&&(m[2]=Infinity);null==k.ymax&&(m[3]=Infinity);return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){b=class extends b{constructor(){super(...arguments);this._propertiesPool=new q.PropertiesPool({camera:u.Camera},this);this._lastSeenCameraProjectionValues=new u.Camera;this.mode=v.RenderState.ANIMATING;this._cssCamera=new u.Camera;this._camera=new u.Camera;this.contentPixelRatio=this.rasterPixelRatio=1;this.events=new n;this.viewingMode=x.ViewingMode.Global;this._cameraChanged=!1;this._updateQueue=[];this._processingUpdates=!1}init(D,G){this._set("viewingMode",
D);this._set("spatialReference",G);this._set("constraints",new w.Constraints({mode:this.viewingMode}))}exit(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new q.PropertiesPool({camera:u.Camera},this)}destroy(){this.cameraController=null;this._propertiesPool?.destroy();this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===x.ViewingMode.Global){const D=f.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new u.Camera({eye:l.fromValues(4*
D,0,0),center:l.fromValues(D,0,0),up:l.fromValues(0,0,1)})}else this.camera=new u.Camera({eye:l.fromValues(0,0,100),center:l.fromValues(0,0,0),up:l.fromValues(0,1,0)})}get animation(){return this.cameraController instanceof p.AnimationController&&null!=this.cameraController.viewAnimation?this.cameraController.viewAnimation:null}get cssCamera(){const D=this._cssCamera.copyFrom(this.camera),{height:G,width:A,pixelRatio:C}=this.camera;D.pixelRatio=1;D.height=Math.round(G/C);D.width=Math.round(A/C);return D}get camera(){return this._camera}set camera(D){D!==
y&&y.copyFrom(D);y.computeUp(this.viewingMode);this.events.emit("before-camera-change",y);D=this._camera;this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,y)&&(this._lastSeenCameraProjectionValues.copyFrom(y),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!D.equals(y)&&(this._camera=this._propertiesPool.get("camera").copyFrom(y),this._cameraChanged=!D.almostEquals(y))){const G=c.afterDispatch(()=>{this._cameraChanged=!1;G.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===
this.rasterPixelRatio&&this.mode===v.RenderState.IDLE}get updating(){return this.mode!==v.RenderState.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(D){this._contentCamera=null!=D?D.clone():null}get fixedContentCamera(){return null!=this._contentCamera}get isGlobal(){return this.viewingMode===x.ViewingMode.Global}get isLocal(){return this.viewingMode===x.ViewingMode.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&
!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(D){this.stopActiveCameraController()?(this.cameraController?.destroy(),D&&(this.removeHandles("ViewStateHandles"),this.addHandles(h.when(()=>D.state===t.State.Finished||D.state===t.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(G=>D.onControllerEnd(G))},{sync:!0,once:!0}),"ViewStateHandles"),D.onControllerStart(this.camera)),this._set("cameraController",D)):D&&(D.state=t.State.Rejected)}switchCameraController(D){this.cameraController=
D;return D.state!==t.State.Rejected}stopActiveCameraController(){return this.cameraController&&!this.cameraController.stopController()?!1:!0}updateCamera(D){this._updateQueue.push(D);this._processUpdateQueue()}_processUpdateQueue(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=!0;var D=this._updateQueue.shift();y.copyFrom(this._get("camera"));D(y);this.camera=y;this._processingUpdates=!1;this._processUpdateQueue()}}_cameraProjectionChanged(D,G){return D.fov!==
G.fov||D.fullViewport[0]!==G.fullViewport[0]||D.fullViewport[1]!==G.fullViewport[1]||D.fullViewport[2]!==G.fullViewport[2]||D.fullViewport[3]!==G.fullViewport[3]||D.padding[u.PaddingSide.TOP]!==G.padding[u.PaddingSide.TOP]||D.padding[u.PaddingSide.RIGHT]!==G.padding[u.PaddingSide.RIGHT]||D.padding[u.PaddingSide.BOTTOM]!==G.padding[u.PaddingSide.BOTTOM]||D.padding[u.PaddingSide.LEFT]!==G.padding[u.PaddingSide.LEFT]?!0:!1}};a.__decorate([k.property()],b.prototype,"mode",void 0);a.__decorate([k.property({readOnly:!0,
type:r})],b.prototype,"animation",null);a.__decorate([k.property({type:u.Camera})],b.prototype,"cssCamera",null);a.__decorate([k.property()],b.prototype,"_cssCamera",void 0);a.__decorate([k.property({type:u.Camera})],b.prototype,"camera",null);a.__decorate([k.property()],b.prototype,"_camera",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"pixelRatio",null);a.__decorate([k.property()],b.prototype,"rasterPixelRatio",void 0);a.__decorate([k.property()],b.prototype,"contentPixelRatio",
void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"alignPixelEnabled",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"updating",null);a.__decorate([k.property({})],b.prototype,"_contentCamera",void 0);a.__decorate([k.property({type:u.Camera})],b.prototype,"contentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"fixedContentCamera",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"constraints",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,
"events",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"isGlobal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"isLocal",null);a.__decorate([k.property({readOnly:!0})],b.prototype,"viewingMode",void 0);a.__decorate([k.property({readOnly:!0})],b.prototype,"spatialReference",void 0);a.__decorate([k.property()],b.prototype,"navigating",null);a.__decorate([k.property()],b.prototype,"stationary",null);a.__decorate([k.property()],b.prototype,"_cameraChanged",void 0);a.__decorate([k.property()],
b.prototype,"cameraController",null);a=b=a.__decorate([d.subclass("esri.views.3d.state.ViewState")],b);const y=new u.Camera;return a})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/PooledArray ../../../../core/screenUtils ../../../../core/unitUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../../support/elevationInfoUtils ../../../ViewingMode ../../support/hitTest ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(E){y&&y.viewingMode===E||(y=x.newIntersector(E));return y}class q{constructor(E,I,H){this.viewingMode=E;this._forEachLayer=I;this._view=H;this._externalIntersectionHandlers=new b;this._tolerance=x.defaultTolerance;this._tmpRay=e.create();this._tmpRegion=g.create();this._validateHUDIntersector=x.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}intersectScreen(E,I,H){return this.intersectRay(this._getPickRay(E,this._tmpRay),
t(this.viewingMode),I,H)}intersectScreenFreePointFallback(E,I,H){return this.intersectRayFreePointFallback(this._getPickRay(E,this._tmpRay),I,H)}intersectRayFreePointFallback(E,I,H){return this.intersectRay(E,t(this.viewingMode),I,H)||this._intersectRayFreePointLocal(E,I)}intersectRay(E,I,H,J){I.options.selectionMode=!1;I.options.store=w.StoreResults.MIN;this.computeIntersection(E,I,J);return I.results.min?I.results.min.getIntersectionPoint(H):!1}getCenterRayWithSubpixelOffset(E,I,H=.5,J=.5){E.getRenderCenter(C,
H,J);C[0]+=.0466;C[1]-=.0123;return r.fromRenderAtEye(E,C,I)}intersectIntersectorScreen(E,I,H){this.computeIntersection(this._getPickRay(E,this._tmpRay),I,H)}intersectToolIntersectorScreen(E,I,H){E=this._getPickRay(E,this._tmpRay);this.intersectToolIntersectorRay(E,I,H)}intersectToolIntersectorRay(E,I,H){I.options.selectionMode=!0;this.computeIntersection(E,I,H);const J=I.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||p.isValidIntersectorResult(J)&&J.intersector!==w.IntersectorType.TERRAIN||
(I.options.selectionMode=!1,this.computeIntersection(E,I,H))}setTolerance(E=x.defaultTolerance){this._tolerance=E}addIntersectionHandler(E){this._externalIntersectionHandlers.push(E);this._externalIntersectionHandlers.sort((I,H)=>I.type===w.IntersectorType.TERRAIN?1:H.type===w.IntersectorType.TERRAIN?-1:0)}removeIntersectionHandler(E){null!=this._externalIntersectionHandlers.removeUnordered(E)&&this._externalIntersectionHandlers.sort((I,H)=>I.type===w.IntersectorType.TERRAIN?1:H.type===w.IntersectorType.TERRAIN?
-1:0)}_getPickRay(E,I){return r.fromScreen(this._view.state.camera,E,I)}_intersectRayFreePointLocal(E,I){if(this.viewingMode!==l.ViewingMode.Local||null==E)return!1;k.add(I,E.origin,k.normalize(d.sv3d.get(),E.direction));return!1}intersectElevationFromScreen(E,I,H=0,J=null){return this._intersectElevation(this._getPickRay(E,this._tmpRay),I,H,J)}_intersectElevation(E,I,H=0,J=null){if(null==E)return null;var B=this._view,{renderCoordsHelper:z}=B,K=h.getMetersPerVerticalUnitForSR(B.spatialReference),
L=null!=I?I.mode:"absolute-height";I=c.getElevationOffsetInMeters(I)/K;const F=("on-the-ground"!==L?I+H:0)*K/z.unitInMeters;({camera:K}=B.state);if("absolute-height"===L)return H=z?.getAltitude(K.eye),L=k.dot(k.normalize(G,E.direction),z.worldUpAtPosition(K.eye,A)),H<F&&0>L||H>=F&&0<L?null:z.intersectInfiniteManifold(E,F,G)?(B=f.computeMapPointFromVec3d(B,G),B.z??(B.z=0),B.z-=I,B):null;const M=n.castRenderScreenPointArray3(d.sv3d.get());K.projectToRenderScreen(E.origin,M);z=new D(null,this._forEachLayer);
({slicePlane:I}=B);const S=null!=I?p.sliceFilterPredicate(I):null,N=x.newIntersector(this.viewingMode);N.options.store=w.StoreResults.MIN;N.options.verticalOffset=F;I=E.origin;E=k.add(d.sv3d.get(),I,E.direction);N.reset(I,E,K);N.point=M;const P=J?"type"in J&&"graphics"===J.type?R=>R.layerUid!==J.uid:R=>R.graphicUid!==J.uid:null;switch(L){case "relative-to-scene":N.intersect(z.layers,M,this._tolerance,null,R=>(!P||P(R))&&!!R.lastValidElevationBB);this._externalIntersectionHandlers.forAll(R=>{R.type!==
w.IntersectorType.I3S&&R.type!==w.IntersectorType.TERRAIN&&R.type!==w.IntersectorType.TILES3D||R.intersect(N,R.slicePlaneEnabled?S:null,N.rayBegin,N.rayEnd,M)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(R=>{R.isGround&&R.intersect(N,R.slicePlaneEnabled?S:null,N.rayBegin,N.rayEnd,M)})}return N.results.min.getIntersectionPoint(G)?(B=f.computeMapPointFromVec3d(B,G),B.z=H,B):null}computeIntersection(E,I,H,J){if(null!=E){var B=this._view.state.camera,
z=n.castRenderScreenPointArray3(d.sv3d.get());B.projectToRenderScreen(E.origin,z);var K=new D(H,this._forEachLayer);I.options.selectOpaqueTerrainOnly=!H||!("include"in H||"exclude"in H);var L=E.origin,F=k.add(d.sv3d.get(),E.origin,E.direction);I.reset(L,F,B);I.intersect(K.layers,z,this._tolerance);E=this._view.slicePlane;var M=null!=E?p.sliceFilterPredicate(E):null;I.intersect(K.sliceableLayers,z,this._tolerance,M);var S=H&&(H.requiresGroundFeedback||H.enableDraped);this._externalIntersectionHandlers.forAll(N=>
{var P=N.layerUid;const R=Array.isArray(P);P=R?P:[P];R&&(I.options.filteredLayerUids=[]);let O=!1;for(const T of P)K.filterLayerUid(T)?O=!0:R&&I.options.filteredLayerUids.push(T);I.options.isFiltered=!O;(N.isGround&&S||!I.options.isFiltered)&&N.intersect(I,N.slicePlaneEnabled?M:null,L,F,z,J)});E=d.sv3d.get();B=this._view.basemapTerrain;if(H&&H.enableDraped&&null!=B.spatialReference&&I.results.ground.getIntersectionPoint(E)){H=B.overlayManager.renderer;const N=this._view.renderCoordsHelper.spatialReference,
P=d.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(E,P,B.spatialReference);P[2]=this._view.elevationProvider?.getElevation(E[0],E[1],E[2],N,"ground")??0;H.intersect(I,P,I.results.ground,R=>K.filterRenderGeometry(R))}I.sortResults();this._processHUDResults(I)}}_processHUDResults(E){var I=E.results.hud;g.copy(this._tmpRegion,g.negativeInfinity);const H=this._view.state.camera,J=[],B=this._tmpRegion;var z=N=>{const P=new v(N);H.projectToRenderScreen(N.target.center,P.screenPoint);P.screenPoint[0]=
Math.floor(P.screenPoint[0]);P.screenPoint[1]=Math.floor(P.screenPoint[1]);J.push(P);g.expandPointInPlace(B,P.screenPoint)};E.sortResults(I.all);null!=I.min.dist&&z(I.min);for(var K of I.all)I.min.target.object!==K.target.object&&I.max.target.object!==K.target.object&&z(K);null!=I.max.dist&&I.max.target.object!==I.min.target.object&&z(I.max);if(J.length){B[0]===B[2]&&(B[2]+=1);B[1]===B[3]&&(B[3]+=1);I=H.fullWidth;z=H.fullHeight;var L=Math.max(0,B[0]-1),F=Math.max(0,B[1]-1);K=Math.min(g.width(B)+2,
I-L);var M=Math.min(g.height(B)+2,z-F);if(!(0>=K||0>=M)){var S=new Uint8Array(K*M*4);this._view._stage.renderer.readHUDVisibility(L,F,K,M,S);L=!0;F=null==E.results.max.dist;M=0;for(const N of J)for(const P of u){const R=4*(Math.min(N.screenPoint[0]+P[0],I)-B[0]+(Math.min(N.screenPoint[1]+P[1],z)-B[1])*K);if(!(0>R||R>=S.length)&&S[R]){L&&(E.results.min.copy(N.result),L=!1);F&&E.results.max.copy(N.result);E.options.store===w.StoreResults.ALL&&E.results.all.splice(M++,0,N.result);break}}}}}}const u=
(()=>{const E=[];for(let I=-1;1>=I;I++)for(let H=-1;1>=H;H++)E.push([H+1,I+1]);return E})();class v{constructor(E){this.result=E;this.screenPoint=n.createRenderScreenPointArray3()}}let y;class D{constructor(E,I){this.layers=[];this.sliceableLayers=[];this.include=E?.include;this.exclude=E?.exclude;I(H=>{H.pickable&&this.filterLayerUid(H.apiLayerUid)&&(H.sliceable?this.sliceableLayers:this.layers).push(H)})}filterLayerUid(E){const {include:I,exclude:H}=this;return null==E?null==I&&null==H:(null==I||
I.has(E))&&(null==H||!H.has(E))}filterRenderGeometry(E){return this.filterLayerUid(E.layerUid)}}const G=m.create(),A=m.create(),C=n.createRenderScreenPointArray3();a.SceneIntersectionHelper=q;a.isIntersectionHandler=function(E){return"object"===typeof E&&"intersect"in E};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../core/unitUtils","../symbols/support/unitConversionUtils"],function(a,b,n){function h(w,p){return p?.mode?
p.mode:(w?r:x).mode}function k(w,p){return null!=p?p:w?r:x}function m(w,p){return h(null!=w?w.hasZ:!1,p)}function g(w){const p=e(w);return m(w.geometry,p)}function e(w){return w.layer&&"elevationInfo"in w.layer?w.layer.elevationInfo:null}function d(w,p){if(!w?.offset)return 0;const {offset:t,unit:q}=w;if("decimal-degrees"===q)return 0;w="unknown"!==q&&q?q:"meters";return(p=b.verticalLengthUnitFromSpatialReference(p))?b.convertUnit(t,w,p):0}function c(w,p,t,q,u,v,y=null){if(null!=v){var D=null!=y?
y.mode:"absolute-height";if("on-the-ground"===D)return 0;({absoluteZ:v}=l(p,t,q,u,w,v));a:{y=d(y,u);switch(D){case "absolute-height":w=v-y;break a;case "relative-to-ground":w=v-((w.elevationProvider.getElevation(p,t,q,u,"ground")??0)+y);break a;case "relative-to-scene":w=v-((w.elevationProvider.getElevation(p,t,q,u,"scene")??0)+y);break a}w=void 0}return w}}function l(w,p,t,q,u,v){const y=d(v,q);switch(v.mode){case "absolute-height":return{absoluteZ:t+y,elevation:0};case "on-the-ground":return t=
u.elevationProvider.getElevation(w,p,0,q,"ground")??0,{absoluteZ:t,elevation:t};case "relative-to-ground":return w=u.elevationProvider.getElevation(w,p,t,q,"ground")??0,{absoluteZ:t+w+y,elevation:w};case "relative-to-scene":return w=u.elevationProvider.getElevation(w,p,t,q,"scene")??0,{absoluteZ:t+w+y,elevation:w}}}function f(w){return(w?.offset??0)*n.getMetersPerUnit(w?.unit)}const r={mode:"absolute-height",offset:0},x={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=r;a.elevationContextAffectsAlignment=
function(w,p){if(null==p)return!1;({mode:p}=p);return null!=p&&("scene"===w&&"relative-to-scene"===p||"ground"===w&&"absolute-height"!==p)};a.elevationModeRequiredMessage=function(w,p,t){return t&&t.mode!==p?`${w} only support ${p} elevation mode`:null};a.elevationModeUnsupportedMessage=function(w,p,t){return t?.mode===p?`${w} do not support ${p} elevation mode`:null};a.featureExpressionUnsupportedMessage=function(w,p){return null!=p?.featureExpressionInfo&&"0"!==p.featureExpressionInfo.expression?
`${w} do not support featureExpressionInfo`:null};a.getConvertedElevation=function(w,p,t,q=null){return c(w,p.x,p.y,p.hasZ?p.z:0,p.spatialReference,t,q)};a.getConvertedElevationFromVector=function(w,p,t,q,u=null){return c(w,p[0],p[1],2<p.length?p[2]:0,t,q,u)};a.getConvertedElevationFromXYZ=c;a.getEffectiveElevationInfo=k;a.getEffectiveElevationMode=h;a.getElevationOffset=d;a.getElevationOffsetInMeters=f;a.getGeometryEffectiveElevationInfo=function(w,p){return k(null!=w?!!w.hasZ:!1,p)};a.getGeometryEffectiveElevationMode=
m;a.getGraphicEffectiveElevationInfo=function(w){var p=e(w);w=m(w.geometry,p);p=null!=p&&"on-the-ground"!==w?f(p):0;return{mode:w,offset:p}};a.getGraphicEffectiveElevationMode=g;a.getZForElevationMode=function(w,p,t){if(t?.mode){var q=w.hasZ?w.z:0,u=d(t,w.spatialReference);switch(t.mode){case "absolute-height":return q-u;case "on-the-ground":return 0;case "relative-to-ground":return w=(p.elevationProvider.getElevation(w.x,w.y,q,w.spatialReference,"ground")??0)+u,q-w;case "relative-to-scene":return w=
(p.elevationProvider.getElevation(w.x,w.y,q,w.spatialReference,"scene")??0)+u,q-w}}};a.hasGraphicFeatureExpressionInfo=function(w){if("on-the-ground"===g(w))return!1;w=e(w);w=w?.featureExpressionInfo?w.featureExpressionInfo.expression:null;return!(!w||"0"===w)};a.logInvalidElevationInfoWarning=function(w,p){p&&w.warn(".elevationInfo\x3d",p)};a.onTheGroundElevationInfo=x;a.zValueInAbsoluteHeightMode=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/hitTest":function(){define("exports ../../../geometry ../../../Graphic ../../../core/iteratorUtils ../../../core/screenUtils ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectVectorToVector ../../../layers/LayerConstants ../../../layers/support/layerUtils ./debugFlags ./ElevationProvider ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/intersectorUtilsConversions ../webgl-engine/lib/verticalOffsetUtils ../../../geometry/SpatialReference ../../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){function u(H,J,B){return J.getIntersectionPoint(E)?(B=D(H,E,B),J.intersector===r.IntersectorType.TERRAIN&&H.basemapTerrain&&(B.z=l.getElevationAtPoint(H.basemapTerrain,B)??0),B):null}function v(H){var J=H.sourceLayer,B=H.layer;if(J=J&&"objectIdField"in J?J:B&&"objectIdField"in B?B:J)if(B=J.objectIdField??e.fallbackObjectIDAttribute,B=H.attributes?.[B])return`o-${J.id}-${B}`;return`u-${H.uid}`}function y(H,J){J=v(J);return null==H||(null==H.include||H.include.has(J))&&
(null==H.exclude||!H.exclude.has(J))}function D(H,J,B){let z=H.spatialReference||t.WGS84;g.projectVectorToVector(J,H.renderSpatialReference,E,z)?J=E:(z=t.WGS84,g.projectVectorToVector(J,H.renderSpatialReference,E,z)&&(J=E));B?(B.x=J[0],B.y=J[1],B.z=J[2],B.spatialReference=z):B=new q(J,z);return B}function G(H,J){const B=A(H,J.include,I.INCLUDE);H=A(H,J.exclude,I.EXCLUDE);return{include:B.layerUids,exclude:H.layerUids,graphics:{include:B.graphicUids,exclude:H.graphicUids}}}function A(H,J,B,z={layerUids:void 0,
graphicUids:void 0}){if(!J)return z;if(J instanceof n){var K=v(J);z.graphicUids||(z.graphicUids=new Set);z.graphicUids.add(K);B===I.INCLUDE&&(null!=H.graphicsView&&J.layer===H?C(z,H.graphicsView.processor.layer.id):J.layer&&C(z,J.layer.uid))}else if(h.isIterable(J))for(K of J)K===H.graphics&&null!=H.graphicsView?C(z,H.graphicsView.processor.layer.id):K===H.map.ground?C(z,p.terrainId):A(H,K,B,z);else"uid"in J&&C(z,J.uid);return z}function C(H,J){H.layerUids||(H.layerUids=new Set);H.layerUids.add(J)}
const E=m.create();var I;(function(H){H[H.INCLUDE=0]="INCLUDE";H[H.EXCLUDE=1]="EXCLUDE"})(I||={});a.computeMapPointFromVec3d=D;a.externalToInternalIntersectOptions=G;a.getGraphicFilterUid=v;a.hitTest=async function(H,J,B,z){z=B?G(H,B):z;var K=k.createScreenPointArray(J.x,J.y);z.requiresGroundFeedback=!0;z.enableDraped=!0;B=f.newIntersector(H.state.viewingMode);B.options.selectionMode=!0;B.options.store=r.StoreResults.ALL;H.sceneIntersectionHelper.intersectIntersectorScreen(K,B,z);K=B.results.all;
var L=z.graphics;z=[];let F=null;for(let P=0;P<K.length;P++){var M=K[P],S=w.toOwner(M,H);if(null!=S&&(S===H.map.ground||"type"in S&&d.isIntegratedMeshLayer(S.type)))break;S=w.toHit(M,H);if(null!=S){if("graphic"===S.type){null==F&&P!==K.length-1&&(F=new Set);if(null!=F){var N=v(S.graphic);if(F.has(N))continue;F.add(N)}if(!y(L,S.graphic))continue}N=u(H,M);M=M.distanceInRenderSpace;if("media"===S.type){const R=S.element.toSource(N);z.push({...S,mapPoint:N,distance:M,sourcePoint:R})}else z.push({...S,
mapPoint:N,distance:M})}}K=B.results.ground;L=w.toOwner(K,H);L=null!=L&&"type"in L&&d.isIntegratedMeshLayer(L.type)?L:null;H={screenPoint:J,results:z,ground:{mapPoint:u(H,K),distance:x.isValidIntersectorResult(K)?K.distanceInRenderSpace:0,layer:L}};c.debugFlags.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(H.intersector=B);return H};a.intersectResultToMapPoint=u;a.toMap=function(H,J,B,z){z=B?G(H,B):z;const K=null!=z.graphics&&(null!=z.graphics.include||null!=z.graphics.exclude);J=k.screenPointObjectToArray(J);
z.enableDraped=z.include&&!z.include.has(p.terrainId)||z.exclude&&z.exclude.has(p.terrainId);const L=H.sceneIntersectionHelper,F=f.newIntersector(H.state.viewingMode);F.options.selectionMode=!0;F.options.store=K?r.StoreResults.ALL:r.StoreResults.MIN;F.options.hud=!B?.excludeHud;L.intersectIntersectorScreen(J,F,z);if(K){for(const M of F.results.all)if(B=w.toHit(M,H),null==B||"graphic"!==B.type||y(z.graphics,B.graphic))return u(H,M);return null}return u(H,F.results.min)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(t,q){return null==t?null:e.isObjectIntersectorResult(t)||e.isHudIntersectorResult(t)?l(t.target?.object,q):m.isPclIntersectorResult(t)?(t=t.target.createGraphic(),{type:"graphic",graphic:t,layer:t.layer}):m.isVoxelIntersectorResult(t)?(t=t.target.createVoxelGraphic(),{type:"graphic",graphic:t,layer:t.layer}):m.isTiles3DIntersectorResult(t)?(t=t.target.createTiles3DGraphic(),{type:"graphic",graphic:t,layer:t.layer}):g.isOverlayIntersectorResult(t)||d.isLodIntersectorResult(t)?
l(t.target,q):m.isI3sIntersectorResult(t)?f(t.target,q):null}function l(t,q){if(null==t?.graphicUid)return null;const u=w(t,q);if(null==u)return null;if(u===q.graphics)return null==q.graphicsView||"number"!==typeof t.graphicUid?null:q.graphicsView.getHit(t.graphicUid);q=q.allLayerViews.find(v=>v.layer===u);return!q||q.suspended||null==t.graphicUid?null:"getHit"in q?q.getHit(t.graphicUid):null}function f(t,q){const u=w(t,q);return null==u?null:(q=q.allLayerViews.find(v=>v.layer===u))&&!q.suspended&&
"getGraphicFromIntersectorTarget"in q?x(q.getGraphicFromIntersectorTarget(t)):null}function r(t,q){const u=w(t,q);return null==u?null:(q=q.allLayerViews.find(v=>v.layer===u))&&!q.suspended&&"getAABBFromIntersectorTarget"in q?q.getAABBFromIntersectorTarget(t):null}function x(t){return null!=t?{type:"graphic",graphic:t,layer:t.layer}:null}function w(t,q){return null==t?.layerUid?null:null!=q.graphicsView&&t.layerUid===q.graphicsView.processor.layer.id?q.graphics:q.map.allLayers.find(u=>u.uid===t.layerUid)}
const p=n.create();a.getIntersectedFeatureBSRadius=function(t,q){return e.isObjectIntersectorResult(t)||e.isHudIntersectorResult(t)?k.getRadius(t.target.object.boundingVolumeWorldSpace.bounds):d.isLodIntersectorResult(t)?(b.getScaling(p,t.transformation),t.target.baseBoundingSphere.radius*Math.max(p[0],p[1],p[2])):m.isI3sIntersectorResult(t)?(t=r(t.target,q))?.5*h.diameter(t):null:null};a.hasLod=function(t){return e.isObjectIntersectorResult(t)||e.isHudIntersectorResult(t)?!1:d.isLodIntersectorResult(t)?
1<t.target.numLodLevels:m.isI3sIntersectorResult(t)?!0:!1};a.toGraphic=function(t,q){t=c(t,q);return null!=t&&"graphic"===t.type?t.graphic:null};a.toHit=c;a.toOwner=function(t,q){return e.isObjectIntersectorResult(t)||e.isHudIntersectorResult(t)?w(t.target?.object,q):g.isTerrainIntersectorResult(t)?q.map?.ground:m.isPclIntersectorResult(t)||m.isI3sIntersectorResult(t)||g.isOverlayIntersectorResult(t)||m.isVoxelIntersectorResult(t)?w(t.target,q):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,b,n,h){class k extends n.Graphic3DTarget{constructor(d,c,l,f){super(c,l);this.point=d;this.createGraphic=f}}class m extends n.LayerTarget{constructor(d,c,l,f,r){super(d);this.layerUid=d;this.sublayerUid=c;this.nodeIndex=l;this.componentIndex=f;this.triangleNr=r}}class g extends n.Graphic3DTarget{constructor(d,
c,l){super(c,null);this.point=d;this.createVoxelGraphic=l}}class e extends n.Graphic3DTarget{constructor(d,c){super(d,null);this.createTiles3DGraphic=c}}a.I3sTarget=m;a.PclTarget=k;a.Tiles3DTarget=e;a.VoxelTarget=g;a.isI3sIntersectorResult=function(d){return h.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.I3S&&!!d.target};a.isPclIntersectorResult=function(d){return h.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.PCL&&!!d.target};a.isTiles3DIntersectorResult=function(d){return h.isValidIntersectorResult(d)&&
d.intersector===b.IntersectorType.TILES3D&&!!d.target};a.isVoxelIntersectorResult=function(d){return h.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.VOXEL&&!!d.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/SpatialReference ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery ./ElevationRange".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(t,q,u,v,y,D,G){for(const A of q)q=A.getElevation(u,v,y,D,G),null!=q&&(t=null!=t?Math.max(q,t):q);return t}a.CombinedElevationProvider=class extends h.EventedMixin(n){get spatialReference(){return this.view?.basemapTerrain?.spatialReference}constructor(t){super(t);this._im=[];this._ground=[];this._scene=[];this.lastElevationQuery=null;this._cacheEnabled=!1}destroy(){this._cachedQuery=k.destroyMaybe(this._cachedQuery)}enableCache(t){t||(this.lastElevationQuery=
null);this._cacheEnabled=t}getElevation(t,q,u,v,y){if(this._cacheEnabled&&null!=this.lastElevationQuery){var D=this.lastElevationQuery;if(t===D.x&&q===D.y&&u===D.z&&r.equals(v,D.spatialReference)&&y===D.queryContext)return D.result}D=p(null,this._im,t,q,u,v,y);null==D&&(D=p(D,this._ground,t,q,u,v,y));"scene"===y&&(D=p(D,this._scene,t,q,u,v,y));this._cacheEnabled&&(this.lastElevationQuery={x:t,y:q,z:u,spatialReference:v,queryContext:y,result:D});return D}getSphereElevationBounds(t,q,u){function v(D){for(const G of D)G.getSphereElevationBounds&&
(D=G.getSphereElevationBounds(t,q,u),null!=D&&y.expandElevationRangeValues(D.elevationRangeMin,D.elevationRangeMax))}const y=new w.ElevationRange;v(this._ground);v(this._im);"scene"===u&&v(this._scene);return y}getRootElevationBounds(){const t=new w.ElevationRange;for(const q of[this._im,this._ground,this._scene])q.forEach(u=>{u.getRootElevationBounds&&(u=u.getRootElevationBounds(),null!=u&&t.expandElevationRangeValues(u.elevationRangeMin,u.elevationRangeMax))});return t}async queryElevation(t,q,
u,v,y,D=null,G=0){const A=this._getElevationQuery(v);try{const C=await A.queryElevation(t,q,D,G);return"scene"===y?p(C,this._scene,t,q,u,v,y):C}catch(C){return m.throwIfAbortError(C),this.getElevation(t,q,u,v,y)}}register(t,q){this.addHandles(q.on("elevation-change",u=>this.emit("elevation-change",u)),q);this._providersFromContext(t).push(q)}unregister(t){this.removeHandles(t);for(const q of[this._im,this._ground,this._scene]){const u=q.indexOf(t);-1<u&&q.splice(u,1)}}_providersFromContext(t){switch(t){case "ground":return this._ground;
case "im":return this._im;case "scene":return this._scene}}_getElevationQuery(t=this.view.spatialReference){const q=this._cachedQuery;if(null!=q&&r.equals(t,q.spatialReference))return q;q?.destroy({completeTasks:!0});const {wkid:u,wkt:v,wkt2:y,latestWkid:D}=t;return this._cachedQuery=t=new x.ElevationQuery(this.view.resourceController.scheduler,new f({wkid:u,wkt:v,wkt2:y,latestWkid:D}),()=>this.view.map?.ground,{maximumAutoTileRequests:4})}};b.__decorate([g.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);b.__decorate([g.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=b.__decorate([l.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../geometry ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,n,h,k,m){class g{constructor(d,c){this.spatialReference=d;this._view=c}getElevation(d,c,l){return this._view.elevationProvider.getElevation(d,c,0,this.spatialReference,l)}async queryElevation(d,c,l,f,r){return this._view.elevationProvider.queryElevation(d,c,0,this.spatialReference,r,l,f)}}class e{constructor(d,c,l,f){this.spatialReference=c;this._getElevationQueryProvider=l;this._queries=[];this._queryOptions={...f,ignoreInvisibleLayers:!0};this._frameTask=d.registerTask(k.TaskPriority.ELEVATION_QUERY,
this)}destroy({completeTasks:d}={completeTasks:!1}){this._frameTask.remove();if(this.running)if(d)this.runTask(k.noBudget);else for(const c of this._queries)c.result.reject(h.createAbortError())}queryElevation(d,c,l,f=0){const r=h.createResolver(),x={x:d,y:c,minDemResolution:f,result:r,signal:l};this._queries.push(x);h.onAbort(l,()=>{n.remove(this._queries,x);r.reject(h.createAbortError())});return r.promise}get running(){return 0<this._queries.length}runTask(d){const c=this._queries;this._queries=
[];const l=this._getElevationQueryProvider();if(l){var f=c.map(p=>[p.x,p.y]),r=c.reduce((p,t)=>Math.min(p,t.minDemResolution),Infinity);f=new m({points:f,spatialReference:this.spatialReference});var x=1<c.length&&c.some(p=>!!p.signal)?new AbortController:null,w=null!=x?x.signal:c[0].signal;if(null!=x){let p=0;c.forEach(t=>h.onAbort(t.signal,()=>{p++;t.result.reject(h.createAbortError());p===c.length&&x.abort()}))}l.queryElevation(f,{...this._queryOptions,minDemResolution:r,signal:w}).then(p=>{c.forEach((t,
q)=>{null!=t.signal&&t.signal.aborted?t.result.reject(h.createAbortError()):t.result.resolve(p.geometry.points[q][2])})}).catch(p=>{c.forEach(t=>t.result.reject(p))})}else c.forEach(p=>p.result.reject());d.madeProgress()}get test(){const d=this;return{update:()=>0<d._queries.length&&d.runTask(k.noBudget)}}}a.ElevationQuery=e;a.ViewElevationProvider=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationRange":function(){define(["exports"],function(a){class b{constructor(n=
Infinity,h=-Infinity){this.elevationRangeMin=n;this.elevationRangeMax=h}get elevationRangeValid(){return!Number.isNaN(this.elevationRangeMin)}invalidateElevationRange(){this.elevationRangeMin=NaN}expandElevationRangeValues(n,h){this.elevationRangeMin=Math.min(this.elevationRangeMin,n);this.elevationRangeMax=Math.max(this.elevationRangeMax,h)}expandElevationRange(n){this.elevationRangeMin=Math.min(this.elevationRangeMin,n.elevationRangeMin);this.elevationRangeMax=Math.max(this.elevationRangeMax,n.elevationRangeMax)}setElevationRange(n){this.elevationRangeMin=
n.elevationRangeMin;this.elevationRangeMax=n.elevationRangeMax}}a.ElevationRange=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has","../../../core/time"],function(a,b){function n(){const m=!!a("esri-mobile"),g=!!a("ios"),e=b.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxNumberOfDrawCalls:8E3,maxTotalNumberOfVertices:255E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,
skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0},fadeDuration:b.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,
reflections:!1,ambientOcclusion:!1,memoryLimit:200+k.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1E5,maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:625E4,polygonLodFactor:m?.8:1,polylineLodFactor:m?1.2:1.5,snapshotAvailable:!g,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:m},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:13E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},
pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:m},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},fadeDuration:e,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:m?600+k.GalaxyS20:750+k.FullHD,additionalCacheMemory:m?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1E5,
maxNumberOfDrawCalls:17E3,maxTotalNumberOfVertices:125E5,polygonLodFactor:m?1.2:2,polylineLodFactor:m?1.2:2,snapshotAvailable:!g,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:23E4},sceneService:{object:{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels")},
fadeDuration:e,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:m?900+k.SurfacePro7:1500+k.FullHDRetina,additionalCacheMemory:m?-150:0,frameRate:0,maximumPixelRatio:m?1:Infinity}}}class h{static isValidProfile(m){return m in h.profiles}static getDefaultProfile(){return a("esri-iPhone")?"low":"medium"}static apply(m,g){m=h.profiles[m];g.graphics3D.maxTotalNumberOfFeatures=m.graphics3D.maxTotalNumberOfFeatures;
g.graphics3D.maxNumberOfDrawCalls=m.graphics3D.maxNumberOfDrawCalls;g.graphics3D.maxTotalNumberOfVertices=m.graphics3D.maxTotalNumberOfVertices;g.graphics3D.polygonLodFactor=m.graphics3D.polygonLodFactor;g.graphics3D.polylineLodFactor=m.graphics3D.polylineLodFactor;g.graphics3D.snapshotAvailable=m.graphics3D.snapshotAvailable;g.graphics3D.skipHighSymbolLods=m.graphics3D.skipHighSymbolLods;g.graphics3D.uncompressedTextureDownsamplingEnabled=m.graphics3D.uncompressedTextureDownsamplingEnabled;g.sceneService.object.lodFactor=
m.sceneService.object.lodFactor;g.sceneService.point.lodFactor=m.sceneService.point.lodFactor;g.sceneService.integratedMesh.lodFactor=m.sceneService.integratedMesh.lodFactor;g.sceneService.pointCloud.lodFactor=m.sceneService.pointCloud.lodFactor;g.sceneService.uncompressedTextureDownsamplingEnabled=m.sceneService.uncompressedTextureDownsamplingEnabled;g.tiledSurface.lodBias=m.tiledSurface.lodBias;g.tiledSurface.angledSplitBias=m.tiledSurface.angledSplitBias;g.tiledSurface.vtlContentZoom=m.tiledSurface.vtlContentZoom;
g.tiledSurface.reduceTileLevelDifferences=m.tiledSurface.reduceTileLevelDifferences;g.heatmap.pixelRatio=m.heatmap.pixelRatio;g.heatmap.maxTotalNumberOfFeatures=m.heatmap.maxTotalNumberOfFeatures;g.fadeDuration=m.fadeDuration;g.antialiasingEnabled=m.antialiasingEnabled;g.physicallyBasedRenderingEnabled=m.physicalBasedRenderingEnabled;g.highQualityTransparency=m.highQualityTransparency;g.highResolutionAtmosphere=m.highResolutionAtmosphere;g.reflections=m.reflections;g.ambientOcclusion=m.ambientOcclusion;
g.memoryLimit=m.memoryLimit;g.additionalCacheMemory=m.additionalCacheMemory;g.frameRate=m.frameRate;g.maximumPixelRatio=m.maximumPixelRatio}}h.test={reset(){const m=n();for(const g of Object.keys(m))h.profiles[g]=m[g]}};const k={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};(h||={}).profiles=n();return h})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../webgl-engine/effects/highlight/HighlightDefaults".split(" "),
function(a,b,n,h,k,m,g,e,d){n=class extends n{constructor(){super(...arguments);this.color=d.defaultColor.clone();this.haloColor=null;this.haloOpacity=d.defaultHaloOpacity;this.fillOpacity=d.defaultFillOpacity;this.shadowOpacity=d.defaultShadowOpacity;this.shadowColor=d.defaultShadowColor.clone();this.shadowDifference=d.defaultShadowDifference}};a.__decorate([h.property({type:b})],n.prototype,"color",void 0);a.__decorate([h.property({type:b})],n.prototype,"haloColor",void 0);a.__decorate([h.property()],
n.prototype,"haloOpacity",void 0);a.__decorate([h.property()],n.prototype,"fillOpacity",void 0);a.__decorate([h.property()],n.prototype,"shadowOpacity",void 0);a.__decorate([h.property({type:b})],n.prototype,"shadowColor",void 0);a.__decorate([h.property()],n.prototype,"shadowDifference",void 0);return n=a.__decorate([e.subclass("esri.views.3d.support.HighlightOptions")],n)})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDefaults":function(){define(["exports","../../../../../Color"],function(a,
b){const n=new b([0,255,255]);b=new b([0,0,0]);a.defaultColor=n;a.defaultFillOpacity=.25;a.defaultHaloOpacity=1;a.defaultShadowColor=b;a.defaultShadowDifference=.2;a.defaultShadowOpacity=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(f,r){this.spatialReference=r;this.unitInMeters=h.getMetersPerUnitForSR(this.spatialReference,k.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=m.getGeometryServiceURL(f&&"portalItem"in f?f.portalItem:void 0).catch(()=>{throw new n("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}async toGeographic(f){var r=await this._geometryServiceURLPromise;let x=!0;Array.isArray(f[0])&&
"number"!==typeof f[0]||(f=[f],x=!1);f=f.map(w=>w instanceof d?w:new d(w,this.spatialReference));f=new e({geometries:f,outSpatialReference:c.WGS84});r=(await g.project(r,f)).map(w=>"point"===w.type?[w.x,w.y]:void 0).filter(w=>!!w);return x?r:r[0]}}a.MapCoordsHelper=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,n,h,k,m){async function g(e=null,d){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!e)throw new n("internal:geometry-service-url-not-configured");e="portal"in e?e.portal||h.getDefault():e;await e.load({signal:d});d=e.helperServices?.geometry?.url;if(!d)throw new n("internal:geometry-service-url-not-configured");return d}a.getGeometryServiceURL=g;a.projectGeometry=async function(e,d,c=null,l){c=await g(c,l);const f=new m;f.geometries=[e];f.outSpatialReference=d;if((e=await k.project(c,
f,{signal:l}))&&Array.isArray(e)&&1===e.length)return e[0];throw new n("internal:geometry-service-projection-failed");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),function(a,b,n,h,k,m,g){const e=n.ensureType(g);a.project=async function(d,c,l){c=e(c);d=k.parseUrl(d);const f=
{...d.query,f:"json",...c.toJSON()},r=c.outSpatialReference,x=h.getJsonType(c.geometries[0]);c=k.asValidOptions(f,l);return b(d.path+"/project",c).then(({data:{geometries:w}})=>m.decodeGeometries(w,x,r))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,n,h,k,m,g,e,d){b=class extends b.JSONSupport{constructor(c){super(c);this.geometries=[];this.transformForward=this.transformation=this.outSpatialReference=null}toJSON(){const c=this.geometries.map(r=>r.toJSON()),l=this.geometries[0],f={};f.outSR=d.srToRESTValue(this.outSpatialReference);f.inSR=d.srToRESTValue(l.spatialReference);f.geometries=JSON.stringify({geometryType:e.getJsonType(l),geometries:c});this.transformation&&(f.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(f.transformForward=this.transformForward);return f}};a.__decorate([n.property()],b.prototype,"geometries",void 0);a.__decorate([n.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);a.__decorate([n.property()],b.prototype,"transformation",void 0);a.__decorate([n.property()],b.prototype,"transformForward",void 0);return b=a.__decorate([g.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/support/popupHitTest":function(){define(["exports",
"../../../layers/support/layerUtils","../terrain/LayerClass","../../support/hitTestSelectUtils"],function(a,b,n,h){function k(e,d){const c=new Set,l=[];var f=e.basemapTerrain.numLayers(n.LayerClass.MAP);for(--f;0<=f;f--){const r=e.basemapTerrain.layerViewByIndex(f,n.LayerClass.MAP);c.add(r.layer.uid);l.push(r)}e=e.basemapTerrain.overlayManager.renderer.layers;for(const {uid:r}of e)if(e=d.get(r))c.add(r),l.push(e);l.reverse();return{layerUids:c,layerViews:l}}function m(e){const d=new Map;for(const c of e.allLayerViews)d.set(c.layer.uid,
c);return d}const g={layerUids:new Set,layerViews:[]};a.popupHitTest=async function(e,d){const {results:c,ground:l}=await h.hitTestSelectSimilarDistance(e,d),f=(!l.layer||!b.isIntegratedMeshLayer(l.layer.type))&&l.mapPoint,r=[];d=m(e);const x=f?k(e,d):g;let w=0,p=0;const t=()=>{const u=x.layerViews[p];f&&u&&"fetchPopupFeaturesAtLocation"in u&&r.push({mapPoint:l.mapPoint,layerView:u});++p};let q=null;for(;w<c.length||p<x.layerViews.length;){const u=c[w];if(u&&"graphic"!==u.type)++w;else if("scene"===
u?.layer?.type&&u?.layer?.parent===e?.map?.basemap)++w;else if(u){const v=x.layerUids.has(u.layer?.uid)&&u.distance===l.distance,y=d.get(u.layer?.uid);q??=u.mapPoint;p<x.layerViews.length&&(v||(u.distance??0)>l.distance)&&x.layerViews[p]!==y?t():(r.push({graphic:u.graphic,layerView:y}),++w)}else t()}q??=l.mapPoint;return{hits:r,location:q}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;
var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(a){function b(n){return"graphic"===n?.type}a.filterGraphicHits=function(n){return n.filter(b)};a.findFirstGraphicHit=function(n){return n.find(b)??null};a.hitTestSelectSimilarDistance=async function(n,h){if("2d"===n.type)return n.hitTest(h);
n=await n.hitTest(h);if(0===n.results.length)return n;h=n.results[0];const k=1.05*(h.distance??0),m=n.results.findIndex(g=>(g.distance??0)>k);-1!==m&&(n.results=n.results.slice(0,m));h&&n.ground.distance>k&&(n.ground.mapPoint=null);return n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){let d=class extends b{constructor(){super(...arguments);this.minTotalNumberOfFeatures=2E3;this.maxTotalNumberOfFeatures=5E4;this.maxNumberOfDrawCalls=17E3;this.maxTotalNumberOfVertices=17E5;this.snapshotAvailable=!0;this.polylineLodFactor=this.polygonLodFactor=1;this.uncompressedTextureDownsamplingEnabled=this.skipHighSymbolLods=!1}};a.__decorate([h.property()],d.prototype,"minTotalNumberOfFeatures",void 0);a.__decorate([h.property()],d.prototype,"maxTotalNumberOfFeatures",
void 0);a.__decorate([h.property()],d.prototype,"maxNumberOfDrawCalls",void 0);a.__decorate([h.property()],d.prototype,"maxTotalNumberOfVertices",void 0);a.__decorate([h.property()],d.prototype,"snapshotAvailable",void 0);a.__decorate([h.property()],d.prototype,"polygonLodFactor",void 0);a.__decorate([h.property()],d.prototype,"polylineLodFactor",void 0);a.__decorate([h.property()],d.prototype,"skipHighSymbolLods",void 0);a.__decorate([h.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",
void 0);d=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],d);let c=class extends b{constructor(){super(...arguments);this.lodFactor=1}};a.__decorate([h.property()],c.prototype,"lodFactor",void 0);c=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c);let l=class extends b{constructor(){super(...arguments);this.object=new c;this.point=new c;this.integratedMesh=new c;this.pointCloud=new c;this.uncompressedTextureDownsamplingEnabled=
!1}};a.__decorate([h.property({type:c})],l.prototype,"object",void 0);a.__decorate([h.property({type:c})],l.prototype,"point",void 0);a.__decorate([h.property({type:c})],l.prototype,"integratedMesh",void 0);a.__decorate([h.property({type:c})],l.prototype,"pointCloud",void 0);a.__decorate([h.property()],l.prototype,"uncompressedTextureDownsamplingEnabled",void 0);l=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],l);let f=class extends b{constructor(){super(...arguments);
this.lodBias=0;this.vtlContentZoom=this.angledSplitBias=1;this.reduceTileLevelDifferences=!0}};a.__decorate([h.property()],f.prototype,"lodBias",void 0);a.__decorate([h.property()],f.prototype,"angledSplitBias",void 0);a.__decorate([h.property()],f.prototype,"vtlContentZoom",void 0);a.__decorate([h.property()],f.prototype,"reduceTileLevelDifferences",void 0);f=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],f);let r=class extends b{constructor(){super(...arguments);
this.pixelRatio=1;this.maxTotalNumberOfFeatures=5E4}};a.__decorate([h.property()],r.prototype,"pixelRatio",void 0);a.__decorate([h.property()],r.prototype,"maxTotalNumberOfFeatures",void 0);r=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],r);b=class extends b{constructor(){super(...arguments);this.graphics3D=new d;this.sceneService=new l;this.tiledSurface=new f;this.heatmap=new r;this.fadeDuration=n.Milliseconds(400);this.antialiasingEnabled=!0;this.physicallyBasedRenderingEnabled=
!1;this.highQualityTransparency=!0;this.ambientOcclusion=this.reflections=this.highResolutionAtmosphere=!1;this.memoryLimit=750;this.additionalCacheMemory=0;this.frameRate=void 0;this.maximumPixelRatio=Infinity}};a.__decorate([h.property({type:d})],b.prototype,"graphics3D",void 0);a.__decorate([h.property({type:l})],b.prototype,"sceneService",void 0);a.__decorate([h.property({type:f})],b.prototype,"tiledSurface",void 0);a.__decorate([h.property({type:r})],b.prototype,"heatmap",void 0);a.__decorate([h.property()],
b.prototype,"fadeDuration",void 0);a.__decorate([h.property()],b.prototype,"antialiasingEnabled",void 0);a.__decorate([h.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);a.__decorate([h.property()],b.prototype,"highQualityTransparency",void 0);a.__decorate([h.property()],b.prototype,"highResolutionAtmosphere",void 0);a.__decorate([h.property()],b.prototype,"reflections",void 0);a.__decorate([h.property()],b.prototype,"ambientOcclusion",void 0);a.__decorate([h.property()],b.prototype,
"memoryLimit",void 0);a.__decorate([h.property()],b.prototype,"additionalCacheMemory",void 0);a.__decorate([h.property()],b.prototype,"frameRate",void 0);a.__decorate([h.property()],b.prototype,"maximumPixelRatio",void 0);return b=a.__decorate([e.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/math/mat4 ../../../chunks/vec32 ../../../geometry/ellipsoidUtils ../../../geometry/spatialReferenceEllipsoidUtils ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToPoint ../../../geometry/projection/projectVectorToVector ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){class q{constructor(u,v,y,D){this.viewingMode=u;this.spatialReference=v;this.unitInMeters=y;this._coordinateSystem=D;this._tmpCoordinateSystem=f.create(D);this.referenceEllipsoid=m.getReferenceEllipsoid(v);this.sphericalPCPF=g.getSphericalPCPF(v)}set extent(u){u&&f.setExtent(this._coordinateSystem,u,this._coordinateSystem)}getAltitude(u){return f.altitudeAt(this._coordinateSystem,u)}setAltitude(u,v,y=u){return f.setAltitudeAt(this._coordinateSystem,y,v,
u)}setAltitudeOfTransformation(u,v){f.setAltitudeOfTransformation(this._coordinateSystem,v,u,v)}worldUpAtPosition(u,v){return f.normalAt(this._coordinateSystem,u,v)}worldBasisAtPosition(u,v,y){return f.axisAt(this._coordinateSystem,u,v,y)}basisMatrixAtPosition(u,v){const y=this.worldBasisAtPosition(u,l.Axis.X,w.sv3d.get()),D=this.worldBasisAtPosition(u,l.Axis.Y,w.sv3d.get());u=this.worldBasisAtPosition(u,l.Axis.Z,w.sv3d.get());h.set(v,y[0],y[1],y[2],0,D[0],D[1],D[2],0,u[0],u[1],u[2],0,0,0,0,1);return v}headingAtPosition(u,
v){const y=this.worldUpAtPosition(u,w.sv3d.get());u=this.worldBasisAtPosition(u,l.Axis.Y,w.sv3d.get());v=x.angleAroundAxis(v,u,y);return b.rad2deg(v)}intersectManifoldClosestSilhouette(u,v,y){f.elevate(this._coordinateSystem,v,this._tmpCoordinateSystem);f.intersectRayClosestSilhouette(this._tmpCoordinateSystem,u,y);return y}intersectManifold(u,v,y){f.elevate(this._coordinateSystem,v,this._tmpCoordinateSystem);v=w.sv3d.get();return f.intersectRay(this._tmpCoordinateSystem,u,v)?k.copy(y,v):null}intersectInfiniteManifold(u,
v,y){if(this.viewingMode===t.ViewingMode.Global)return this.intersectManifold(u,v,y);f.elevate(this._coordinateSystem,v,this._tmpCoordinateSystem);v=this._tmpCoordinateSystem.value;const D=w.sv3d.get();return r.intersectRay(v.plane,u,D)?k.copy(y,D):null}toRenderCoords(u,v,y){return p.isDehydratedPoint(u)?e.projectPointToVector(u,v,this.spatialReference):c.projectVectorToVector(u,v,y,this.spatialReference)}fromRenderCoords(u,v,y=null){return p.isDehydratedPoint(v)?(null!=y&&(v.spatialReference=y),
d.projectVectorToPoint(u,this.spatialReference,v)?v:null):c.projectVectorToVector(u,this.spatialReference,v,y)?v:null}static create(u,v){switch(u){case t.ViewingMode.Local:return new q(t.ViewingMode.Local,v,n.getMetersPerUnitForSR(v),f.createLocal());case t.ViewingMode.Global:return new q(t.ViewingMode.Global,v,1,f.createGlobal(v))}}static renderUnitScaleFactor(u,v){return n.getMetersPerCartesianUnitForSR(u)/n.getMetersPerCartesianUnitForSR(v)}}a.RenderCoordsHelper=q;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/signal ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){n=class extends n{constructor(){super(...arguments);this.updating=!1}};b.__decorate([c.property({readOnly:!0})],n.prototype,"updating",void 0);n=b.__decorate([x.subclass("esri.views.3d.support.ResourceControllerMain")],n);let u=class extends n{constructor(){super(...arguments);this._normalTask=this._immediateTask=q.ImmediateTask;this._updatingObjects=e.signal([]);this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=
q.newScheduler();this._memoryController=p.newMemoryController(this.view);this._streamDataLoader=new t.StreamDataLoader;this._streamDataLoader.setup(w.maxDownloadSlots,w.downloadSlotsPerClient,this._scheduler);this.addHandles([m.watch(()=>this.view.state?.mode,v=>{null!=v&&(this._scheduler.state=v)},m.sync),m.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=g.addFrameTask({update:v=>this._frame(v)});this._immediateTask=this._scheduler.registerTask(q.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(q.TaskPriority.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=k.removeMaybe(this._frameTask);this._streamDataLoader=k.destroyMaybe(this._streamDataLoader);this._memoryController=k.destroyMaybe(this._memoryController);this._scheduler=k.destroyMaybe(this._scheduler);this.view=null}get updating(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)||
this._updatingObjects?.value.some(v=>v.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(v){const y=this._streamDataLoader;return{request(D,G,A){return y.request(D,G,v,A)},get busy(){return!y.hasDownloadSlots(v)}}}addUpdatingObject(v){const y=this._updatingObjects;y.value=[...y.value,v];return h.makeHandle(()=>{y.value=y.value.filter(D=>D!==v)})}_frame(v){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(d.secondsFromMilliseconds(v.deltaTime)),
!this._scheduler))return;this._memoryController.update();this._scheduler.updateBudget(v)&&this._scheduler.frame()}}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:v=>this._streamDataLoader.test.loadQueue.getStatsForType(v)}}};b.__decorate([c.property()],u.prototype,"view",void 0);b.__decorate([c.property()],u.prototype,"_scheduler",void 0);b.__decorate([c.property()],u.prototype,"_memoryController",void 0);b.__decorate([c.property()],u.prototype,
"_streamDataLoader",void 0);b.__decorate([c.property()],u.prototype,"_immediateTask",void 0);b.__decorate([c.property()],u.prototype,"_normalTask",void 0);b.__decorate([c.property()],u.prototype,"_updatingObjects",void 0);b.__decorate([c.property({readOnly:!0})],u.prototype,"updating",null);u=b.__decorate([x.subclass("esri.views.3d.support.ResourceControllerImpl")],u);a.newResourceController=function(v){return new u({view:v})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],
function(a){a.ClientType=void 0;(function(n){n[n.ELEVATION=0]="ELEVATION";n[n.BASEMAP=1]="BASEMAP";n[n.I3S_INDEX=2]="I3S_INDEX";n[n.I3S_DATA=3]="I3S_DATA";n[n.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const n=[];n[a.ClientType.ELEVATION]=10;n[a.ClientType.BASEMAP]=10;n[a.ClientType.I3S_INDEX]=10;n[a.ClientType.I3S_DATA]=10;n[a.ClientType.SYMBOLOGY]=5;return n})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/MemCache ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./MemoryManagedView".split(" "),function(a,b,n,h,k,m,g,e,d,c,l){let f=class extends n{constructor(r){super(r);this._quality=1;this._usedMemory=0;this._updating=!1;this._downscaleMemoryUsed=
this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=0;this._cacheStorage=new k.MemCacheStorage;this._warnMemoryUsage=null;this._numQualityChanges=0;this._maxMemory=750;this._additionalCacheMemory=0;this.addHandles(m.addFrameTask({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(r){null==r||0>=r||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<r&&this._updateQuality(1),this._maxMemory=r)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(r){null!=
r&&(this._additionalCacheMemory=r)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(r,x){return new k.MemCache(r,this._cacheStorage,x)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(!(0>=this._memoryPredicted)||this._updating){var r=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=
this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(r){if(1.1<this._memoryPredicted||1<this._usedMemory)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):.1<this._quality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._usedMemory?(this._stableQuality=0,this._canFastRecover=!1,r=this._updateQuality(this._quality/
1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._usedMemory&&1>this._quality?(this._stableQuality=this._quality,r=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=r}}_updateQuality(r){r=Math.min(Math.max(r,.1),1);if(r===this._quality)return!1;this._quality=r;++this._numQualityChanges;return!0}_layersUpdating(){return this.view.allLayerViews.some(r=>!!r.updating)}_updateMemory(){if(this.view){this.view._stage?.renderer?.tick();
var r=this.view._stage?.renderer?.usedMemory,x=(this.view.basemapTerrain?.usedMemory??0)+(r?r.fbos+r.edges+r.plugins:0),w=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(t=>{if(l.isMemoryManagedView(t)){const q=t.ignoresMemoryFactor?this._quality:1;x+=t.usedMemory*q;w+=t.unloadedMemory*q}});var p=null==this._warnMemoryUsage||Math.round(10*x)!==Math.round(10*this._warnMemoryUsage);r=1048576*this.maxMemory;if(x>r&&p){this._warnMemoryUsage=x;p=q=>(q/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+
" MB";const t=Math.round(100*this._quality);h.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(r)} Current: ${p(x)} Projected: ${p(x+w)} Quality: ${t}%`)}this._usedMemory=x/r;this._memoryPredicted=(x+w)/r;this._cacheStorage.maxSize=Math.max(0,r-x+1048576*this.additionalCacheMemory)}}get test(){const r=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const x=r._numQualityChanges;r._numQualityChanges=0;return x},disableMemCache:()=>r.disableMemCache()}}};b.__decorate([g.property({constructOnly:!0})],
f.prototype,"view",void 0);b.__decorate([g.property()],f.prototype,"maxMemory",null);b.__decorate([g.property()],f.prototype,"additionalCacheMemory",null);b.__decorate([g.property({readOnly:!0})],f.prototype,"memoryFactor",null);b.__decorate([g.property({readOnly:!0})],f.prototype,"updating",null);b.__decorate([g.property({readOnly:!0})],f.prototype,"usedMemory",null);b.__decorate([g.property({readOnly:!0})],f.prototype,"usedCacheMemory",null);b.__decorate([g.property()],f.prototype,"_quality",void 0);
b.__decorate([g.property()],f.prototype,"_usedMemory",void 0);b.__decorate([g.property()],f.prototype,"_updating",void 0);b.__decorate([g.property()],f.prototype,"_stableQuality",void 0);b.__decorate([g.property()],f.prototype,"_maxMemory",void 0);b.__decorate([g.property()],f.prototype,"_additionalCacheMemory",void 0);f=b.__decorate([c.subclass("esri.views.3d.support.MemoryController")],f);a.minQuality=.1;a.newMemoryController=function(r){return new f({view:r})};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/MemoryManagedView":function(){define(["exports"],function(a){a.isMemoryManagedView=function(b){return"usedMemory"in b&&"unloadedMemory"in b&&"ignoresMemoryFactor"in b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(y){if(2>y.byteLength)return"unknown";y=new Uint8Array(y,0,y.byteLength);return 137===y[0]&&80===y[1]?"image/png":71===y[0]&&73===y[1]?"image/gif":66===y[0]&&77===y[1]?"image/bmp":255===y[0]&&216===y[1]?"image/jpeg":"unknown"}a.StreamDataLoader=class extends h{constructor(){super(...arguments);this._tasks=new Map;this._onLoadQueue=[];this._doneQueue=[];this.updating=!1}setup(y,D,G){this._loadQueue=new x.AsyncWorkerQueue((A,C)=>this._startLoading(A,
C),(A,C)=>this._doneLoadingCB(A,C),y,D);G&&(this._frameTask=G.registerTask(p.TaskPriority.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=e.removeMaybe(this._frameTask);this._tasks.forEach(y=>e.abortMaybe(y.abortController));this._loadQueue=e.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null}hasDownloadSlots(y){return this._loadQueue.hasQuota(y)}request(y,D,G,A={}){const C=d.createResolver();C.__signal=null!=A?A.signal:null;const E=this._createOrUpdateTask(y,D,G,
A,C);d.onAbort(A,()=>this._cancelRequest(E,C));return C.promise}_createTask(y,D,G,A,C,E){y=new v(y,D,G,A,C);this._updateTask(y,E);this._tasks.set(C,y);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(y);return y}_cancelRequest(y,D){k.removeUnordered(y.resolvers,D);D.reject(d.createAbortError());0===y.resolvers.length&&(y.status===a.TaskStatus.DOWNLOADING&&(y.status=a.TaskStatus.CANCELLED,this._loadQueue.cancel(y),y.abortController?.abort(),y.request=null,y.abortController=null),
y.status=a.TaskStatus.CANCELLED,this._tasks.delete(y.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(y,D){y.resolvers.push(D)}_createOrUpdateTask(y,D,G,A,C){const E=`${A?.uid||y}:${D}:${G}`,I=this._tasks.get(E);return I?(this._updateTask(I,C),I):this._createTask(y,A,D,G,E,C)}_doneLoadingCB(y,D){this._loadQueue&&(w.assert(y.status===a.TaskStatus.DOWNLOADING),y.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:y,err:D}):this._doneLoading(y,D))}get running(){return 0<
this._doneQueue.length||0<this._onLoadQueue.length}runTask(y){for(;!y.done&&0<this._onLoadQueue.length;){var D=this._onLoadQueue.shift();d.throwIfAborted(D.task.abortController);D.task.abortController=null;D.callback(D.task);y.madeProgress()}for(;!y.done&&0<this._doneQueue.length;)D=this._doneQueue.shift(),D.task.status!==a.TaskStatus.DOWNLOADED&&(D.err=D.err||d.createAbortError()),this._doneLoading(D.task,D.err),y.madeProgress()}_doneLoading(y,D){if(D&&!d.isAbortError(D)&&0<y.numRetries)--y.numRetries,
this._loadQueue.push(y);else{var G=y.result instanceof HTMLImageElement?0:y.resolvers.length;for(const A of y.resolvers)if(D)d.isAbortError(D)?A.reject(D):A.reject(new m("stream-data-loader:request-error",`Failed to request resource at '${y.url}'. ${D}`,{url:y.url,error:D}));else{--G;const C=0<G?g.clone(y.result):y.result;A.resolve(C)}this._tasks.delete(y.key);0===this._tasks.size&&this._set("updating",!1)}}_startLoading(y,D){if(y.status===a.TaskStatus.CANCELLED)return!1;y.startTime=performance.now();
y.status=a.TaskStatus.DOWNLOADING;let G,A;switch(y.docType){case "binary":A="array-buffer";G=0;break;case "image":A="image";break;case "image+type":A="array-buffer";break;default:A="json"}y.abortController=new AbortController;const C=y.abortController.signal;y.request=n(y.url,{...y.options,responseType:A,timeout:G,signal:C});let E=()=>{};const I=J=>{y.duration=performance.now()-y.startTime;y.size=J instanceof ArrayBuffer?J.byteLength:y.size||0;y.result=J;this._frameTask?this._onLoadQueue.push({callback:D,
task:y}):(y.abortController=null,D(y))},H=J=>{y.status===a.TaskStatus.DOWNLOADING&&D(y,J);E()};if("image+type"!==y.docType)return y.request.then(J=>I(J.data),H),!0;y.request.then(J=>{J=J.data;const B=t(J);A="image";y.size=J.byteLength;if("unknown"===B)y.request=n(y.url,{responseType:A,timeout:G,signal:C}),y.request.then(K=>I(K.data),H);else{J=new Blob([J],{type:B});var z=window.URL.createObjectURL(J);E=()=>window.URL.revokeObjectURL(z);y.request=n(z,{responseType:A,timeout:G,signal:C});y.request.then(K=>
I(new u(K.data,B,E)),H)}},H);return!0}get test(){return{loadQueue:this._loadQueue}}};b.__decorate([c.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([r.subclass("esri.views.3d.support.StreamDataLoader")],a.StreamDataLoader);const q={numRetries:0};class u{constructor(y,D,G){this.image=y;this.type=D;this.release=G}get isOpaque(){return"image/jpeg"===this.type}}class v extends x.BaseTask{constructor(y,D,G,A,C){super(A);this.url=y;this.options=
D;this.docType=G;this.key=C;this.result=null;this.status=a.TaskStatus.QUEUED;this.abortController=this.request=null;this.resolvers=[];this.startTime=0;this.numRetries=q.numRetries}}a.TaskStatus=void 0;(function(y){y[y.QUEUED=1]="QUEUED";y[y.DOWNLOADING=2]="DOWNLOADING";y[y.DOWNLOADED=3]="DOWNLOADED";y[y.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=u;a.isImageWithType=function(y){return"image"in y&&"type"in y};a.test=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../webgl-engine/lib/Util"],function(a,b){class n{constructor(g){this.client=g;this._cancelled=!1;this.duration=this.size=0}}class h{constructor(g){this.typeWorkerQuota=g;this.tasks=[];this.numWorkers=0;this.statistics=new k}}class k{constructor(){this.speed=this.duration=this.size=this.requests=0}}class m{constructor(g,e,d,c){this._workerFunc=g;this._callbackFunc=e;this._maxTotalNumWorkers=d;this._totalNumWorkers=0;this._clients=
c.map(l=>new h(l))}destroy(){this._clients.length=0}hasQuota(g){return(g=this._clients[g])?this._totalNumWorkers<this._maxTotalNumWorkers||g.numWorkers+g.tasks.length<g.typeWorkerQuota:!1}push(g){const e=this._clients[g.client];e&&(this._totalNumWorkers<this._maxTotalNumWorkers?(e.numWorkers++,this._totalNumWorkers++,this._workerFunc(g,(d,c)=>this._taskCallback(d,c))):e.tasks.push(g))}cancel(g){this._taskFinished(g);g._cancelled=!0}_taskFinished(g){const e=this._clients[g.client];this._totalNumWorkers--;
e&&(e.numWorkers--,e.statistics.requests++,e.statistics.size+=g.size||0,e.statistics.duration+=g.duration||0,e.statistics.speed=0<e.statistics.duration?e.statistics.size/e.statistics.duration:0,b.assert(0<=e.numWorkers));this._next()}_next(){for(const g of this._clients)if(g&&g.numWorkers<g.typeWorkerQuota&&this._processQueue(g))return;for(const g of this._clients)if(g&&this._processQueue(g))break}_processQueue(g){for(;0<g.tasks.length;)if(this._workerFunc(g.tasks.shift(),(e,d)=>this._taskCallback(e,
d)))return g.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(g,e){g._cancelled||(this._callbackFunc(g,e),this._taskFinished(g))}getStatsForType(g){return(g=this._clients[g])?{quota:g.typeWorkerQuota,workers:g.numWorkers,queueSize:g.tasks.length,requestStats:g.statistics}:null}get test(){const g=this;return{set workerFunc(e){g._workerFunc=e}}}}a.AsyncWorkerQueue=m;a.BaseTask=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/ByteSizeUnit",
"../layers/support/LayerViewPerformanceInfo","./LayerPerformanceInfo"],function(a,b,n){class h{constructor(k){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];this.fboMemory=this.cachedMemory=0;if(null!=k.resourceController){const m=k.resourceController.memoryController;this.totalMemory=(m.maxMemory??0)*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(m.usedMemory*this.totalMemory);this.quality=k.quality;this.load=k.resourceController.scheduler.load;
this.cachedMemory=m.usedCacheMemory}this.terrainMemory=k.basemapTerrain?.usedMemory??0;this.edgesMemory=k._stage.renderer.usedMemory.edges??0;this.fboMemory=k._stage.renderer.usedMemory.fbos??0;k.allLayerViews.items.forEach(m=>{b.isPerformanceInfoLayerView(m)&&this.layerPerformanceInfos.push(new n(m))});this.layerPerformanceInfos.sort((m,g)=>g.memory-m.memory)}}return h})},"esri/core/ByteSizeUnit":function(){define(["exports"],function(a){a.ByteSizeUnit=void 0;var b=a.ByteSizeUnit||(a.ByteSizeUnit=
{});b[b.KILOBYTES=1024]="KILOBYTES";b[b.MEGABYTES=1048576]="MEGABYTES";b[b.GIGABYTES=1073741824]="GIGABYTES";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/LayerViewPerformanceInfo":function(){define(["exports"],function(a){class b{constructor(n,h=0,k=0,m=0,g=0,e=null){this.usedMemory=n;this.displayedFeatures=h;this.totalFeatures=k;this.maximumFeatures=m;this.nodes=g;this.core=e}}a.LayerViewPerformanceInfo=b;a.isPerformanceInfoLayerView=function(n){return"performanceInfo"in
n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(function(){class a{constructor(b){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;b=b.performanceInfo;this.memory=b.usedMemory;this.displayedNumberOfFeatures=b.displayedFeatures;this.maximumNumberOfFeatures=b.maximumFeatures;this.totalNumberOfFeatures=b.totalFeatures}}return a})},
"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(a,b,n,h,k,m,g,e,d,c,l){class f{constructor(x){this.streamDataRequester=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=
null;this._viewState=x.viewState;this._view=x.view;this._pointsOfInterest=x.pointsOfInterest;this.streamDataRequester=x.resourceController.createStreamDataRequester(d.ClientType.SYMBOLOGY);this.objectResourceCache=new e.ObjectResourceCache((p,t)=>x.resourceController.memoryController.newCache(p,t));this.textures=new c.StreamTextureCollection(this.streamDataRequester,x.view._stage,x.resourceController.scheduler);const w=g.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=
l.getSettings(x.viewingMode,w);this.screenSizePerspectiveSettingsLabels=l.getLabelSettings(x.viewingMode,w)}destroy(){this.textures.destroy();this.streamDataRequester=null}addGraphicsOwner(x){if(!x)return h.makeHandle();this._graphicsOwners.push(x);const w=m.watch(()=>x.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return h.makeHandle(()=>{w.remove();b.removeUnordered(this._graphicsOwners,x);this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){var x=
this._graphicsOwners.some(w=>!0===w.layer?.screenSizePerspectiveEnabled);x&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new n,x=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([m.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,x,m.sync),this._viewState.events.on("camera-projection-changed",x)]),this._updateScreenSizePerspectiveSettings()):x||(this._screenSizePerspectiveHandles=k.destroyMaybe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){r.distance=
this._pointsOfInterest.centerOnSurfaceInfrequent.distance;r.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(r);this.screenSizePerspectiveSettingsLabels.update(r);this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}const r={distance:0,fovY:0};a.SharedSymbolResources=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(a,b,n,h,k,m){class g{constructor(e){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=e("gltf-resources",()=>{});this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort());this._wosrLoading.forEach(e=>e.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()}loadGLTF(e,d,c){const l=c?`gltfPBR:${e}`:`gltf:${e}`,f=this._gltfMemCache.get(l);return null!=f?Promise.resolve(f):this._loadOnce(this._gltfLoading,
this._gltfMemCache,l,r=>k.loadGLTF(new h.DefaultLoadingContext(r.streamDataRequester),e,r,c),d)}loadWOSR(e,d){const c=`wosr:${e}:${d.disableTextures}`,l=this._wosrMemCache.get(c);return null!=l?Promise.resolve(l):this._loadOnce(this._wosrLoading,this._wosrMemCache,c,f=>m.load(e,f),d)}async _loadOnce(e,d,c,l,f){n.throwIfAborted(f);const r=n.onAbort(f,()=>this._abortLoad(e,c));var x=e.get(c);x?x.refCount++:(x=new AbortController,l=l({...f,signal:x.signal}),x={refCount:1,abortController:x,promise:l},
e.set(c,x));try{const w=await x.promise;d.put(c,w,w.size);e.delete(c);n.throwIfAborted(f);return w}finally{b.removeMaybe(r)}}_abortLoad(e,d){const c=e.get(d);null!=c&&0<--c.refCount||(e.delete(d),null!=c&&c.abortController.abort())}}a.ObjectResourceCache=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/Texture ../../webgl/enums".split(" "),
function(a,b,n,h,k,m){class g extends h.TextureCollection{constructor(e,d,c){super(d,c);this._streamDataRequester=e}async fromUrl(e,d,c){b.throwIfAborted(c);c=c?.signal;const l=this.makeUid(e,d);let f=this._textureRequests.get(l);if(!f){const r=new AbortController,x=this._streamDataRequester.request(e,"image",{uid:l,signal:r.signal});f=new h.TextureRequest;f.abortController=r;const w=f;this._textureRequests.set(l,f);f.textureAsync=x.then(async p=>{p=this._createTexture(e,p,d);w.texture=p;w.abortController=
null;await p.load(this._stage.renderView.renderingContext);this._stage.add(p);return new h.TextureResult(l,p,()=>this._release(l))},p=>{w.abortController=null;throw p;})}f.referenceCount++;try{return await b.whenOrAbort(f.textureAsync,c)}catch(r){throw this._release(l),r;}}_createTexture(e,d,c){const l={width:d.width,height:d.height,wrap:{s:m.TextureWrapMode.CLAMP_TO_EDGE,t:m.TextureWrapMode.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(n.isSVG(e)){if(c||0===d.width&&0===d.height)e=d.width?
d.height/d.width:1,c=c||64,1<e?(d.width=Math.round(c/e),d.height=c):(d.width=c,d.height=Math.round(c*e));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(l.preMultiplyAlpha=!1)}return new k.Texture(d,l)}}a.StreamTextureCollection=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d){a.TextureCollection=class extends n{constructor(f,r){super({});this._stage=f;this._textureRequests=new Map;this._frameTask=r?.registerTask(d.TaskPriority.TEXTURE_UNLOAD)??d.ImmediateTask}normalizeCtorArgs(){return{}}destroy(){super.destroy();this._frameTask?.remove();this._textureRequests?.forEach(f=>this._releaseTextureRequest(f));this._textureRequests?.clear()}get updating(){return this._frameTask.updating}fromData(f,r){const x=this.makeUid(f);f=this._textureRequests.get(x);
f||(f=new l,f.texture=r(),this._stage&&(f.texture.load(this._stage.renderView.renderingContext),this._stage.add(f.texture)),this._textureRequests.set(x,f));f.referenceCount++;return new c(x,f.texture,()=>this._release(x))}_release(f){const r=this._textureRequests.get(f);r?(1>r.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+f),r.referenceCount--,1>r.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(f))):console.warn(`TextureCollection: texture doesn't exist: '${f}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(f){if(this._textureRequests){var r=
this._textureRequests.get(f);!r||0<r.referenceCount||(r.texture?.unload(),this._releaseTextureRequest(r),this._textureRequests.delete(f))}}_releaseTextureRequest(f){f.texture?this._stage?.remove(f.texture):f.abortController&&(f.abortController.abort(),f.abortController=null)}makeUid(f,r=null){return null!=r?`${f}.${r}px`:f}};b.__decorate([h.property()],a.TextureCollection.prototype,"_frameTask",void 0);b.__decorate([h.property()],a.TextureCollection.prototype,"updating",null);a.TextureCollection=
b.__decorate([e.subclass("esri.views.3d.support.TextureCollection")],a.TextureCollection);class c{constructor(f,r,x){this.uid=f;this.texture=r;this.release=x}}class l{constructor(){this.referenceCount=0}}a.TextureRequest=l;a.TextureResult=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E){a.PointsOfInterest=class extends n{constructor(z){super(z);this.renderPointOfView=l.create();this._pois=[];this._debugCenters=new Map;this._tmpRay=f.create();this._centerRayDirty=!0;this._surfaceAltitudeAtCenter=0;this._surfaceAltitudeAtCenterDirty=!0;this._contentAltitudeAtCenter=0;this._contentAltitudeAtCenterDirty=!0;this._propertiesPool=new w.PropertiesPool({renderPointOfView:I},this)}initialize(){const {state:z,basemapTerrain:K,renderCoordsHelper:L,
map:F}=this.view;this._surfaceIntersector=G.newIntersector(z.viewingMode);this._surfaceIntersector.options.backfacesTerrain=z.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=A.StoreResults.MIN;this._contentIntersector=G.newIntersector(z.viewingMode);var M=()=>this._estimateSurfaceAltitudeAtCenter();const S=this.view.resourceController.scheduler,N=this.view.basemapTerrain?.elevationQueryCache,P={state:z,scheduler:S,surface:K,renderCoordsHelper:L};
this._set("centerOnSurfaceInfrequent",new q.CenterOnSurface({...P,task:E.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:M}));this._set("centerOnSurfaceFrequent",new q.CenterOnSurface({...P,task:E.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:M}));this._set("centerOnContent",new q.CenterOnSurface({...P,task:E.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",
new t.CameraOnSurface({...P,cache:N,task:E.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:F}));this._set("surfaceGeometryUpdates",new D.SurfaceGeometryUpdates({...P,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new u.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:L}));this._set("surfaceOrigin",new y.StableSurfaceCenter({cache:N,view:this.view}));this._set("focus",new v.Focus({state:z,
scheduler:S,surface:K,renderCoordsHelper:L,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(R,O)=>this._estimateSurfaceIntersectionAtRenderPoint(R,this.view.state.contentCamera,O)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);M=this.view.graphics;this._debugCenters.set(this.centerOnContent,new x.PointGraphics(M,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,
new x.PointGraphics(M,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new x.PointGraphics(M,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(M,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new x.PointGraphics(M,"green","Focus"));this.addHandles([h.watch(()=>z.contentCamera,R=>this._cameraChanged(R),h.sync),h.watch(()=>K.extent,()=>this._updateCenterPointsOfInterest()),h.when(()=>!K.updating,()=>this._updateCenterPointsOfInterest(),
h.sync),h.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),h.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),h.when(()=>r.debugFlags.SHOW_POI,R=>this._setDebug(R),h.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const R of this._pois)R.runTask()}destroy(){this._setDebug(!1);this._propertiesPool.destroy();for(const z of this._pois)z.destroy();this.surfaceOrigin.destroy()}get updating(){return!(!this.surfaceGeometryUpdates?.updating&&
!this._pois.some(z=>z.updating))}get _centerRay(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const z=this._centerRay;if(null==z)return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(z,
this._contentIntersector,H,B)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const z=this._centerRay;if(null==z)return this._surfaceAltitudeAtCenter;const K=z.origin,L=c.add(H,z.origin,
z.direction);this._surfaceIntersector.resetWithRay(z,this.view.state.contentCamera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,K,L);this._surfaceIntersector.results.min.getIntersectionPoint(H)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(H));return this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(z,K,L){z=p.fromRenderAtEye(K,z,J);if(null==z)return null;const F=z.origin,M=c.add(H,z.origin,z.direction);this._surfaceIntersector.resetWithRay(z,
K);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,F,M);return this._surfaceIntersector.results.min.getIntersectionPoint(L)?L:null}_cameraChanged(z){this._updateCenterPointsOfInterest();z=z.eye;c.exactEquals(this.renderPointOfView,z)||this._set("renderPointOfView",c.copy(this._propertiesPool.get("renderPointOfView"),z))}_updateCenterPointsOfInterest(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const z of this._pois)z.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=
!0;this.centerOnContent.updateRenderLocation()}_setDebug(z){if(z)for(const K of this._pois)this.addHandles(h.watch(()=>K.renderLocation,L=>this._debugCenters.get(K)?.show(L,K.renderCoordsHelper.spatialReference),h.initial),"debug");else this._debugCenters.forEach(K=>K.hide()),this.removeHandles("debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const z of this._pois)z.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};b.__decorate([k.property()],a.PointsOfInterest.prototype,
"centerOnContent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,
"surfaceOrigin",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);b.__decorate([k.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([k.property()],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([d.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const I=Array,H=l.create(),
J=f.create(),B={exclude:new Set([C.terrainId])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/Collection ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer ../../../geometry/Point".split(" "),function(a,b,n,h,k,m,g,e,d){class c{constructor(l,f,r=""){this.graphics=l;this._symbol=new m({symbolLayers:new k([new g({material:{color:f},
outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new e({text:r,halo:{color:"white",size:1/.75},material:{color:f},size:12})])})}show(l,f){null!=f&&(this.hide(),l=new d({x:l[0],y:l[1],z:l[2],spatialReference:f}),this._graphic=new n({geometry:l,symbol:this._symbol}),this.graphics.add(this._graphic))}hide(){null!=this._graphic&&(this.graphics.remove(this._graphic),this._graphic=null)}}a.PointGraphics=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){const u=Array;a.CameraOnSurface=class extends t.PointOfInterest{constructor(y){super(y);this._dirty=!1;this._propertiesPool=new p.PropertiesPool({location:r,renderLocation:u},this);this._estimatedSurfaceAltitude=0;this._pendingElevationQueryController=null;this.renderLocation=f.create();this._tmpPoint=new r}initialize(){this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this));this.runTask();if(this.map){const y=()=>this._setDirty();
this.addHandles(k.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest();this._propertiesPool=n.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const y=this._propertiesPool.get("location");y.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y);return y}get scale(){const y=this._camera,D=l.distance(y.eye,
this.renderLocation);return w.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},D,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty();this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const y=this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&
this._dirty}runTask(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map?.ground)return this._updateSurfaceAltitude(0),q.Yield;var y=this.state.spatialReference;this._tmpPoint.spatialReference=y;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===x.ViewingMode.Global&&(y.isWGS84||y.isWebMercator);let D=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:D.signal,
cache:this.cache,minDemResolution:y?1E6:0}).then(G=>this._updateSurfaceAltitude(G.geometry.z??0)).catch(G=>{h.isAbortError(G)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===D&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));D=null});this._pendingElevationQueryController=D;return q.Yield}_updateSurfaceAltitude(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(v,
this._estimatedSurfaceAltitude,this._camera.eye);l.exactEquals(this._get("renderLocation"),v)||(this._set("renderLocation",l.copy(this._propertiesPool.get("renderLocation"),v)),this.notifyChange("renderLocation"))}};b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([m.property()],
a.CameraOnSurface.prototype,"location",null);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([m.property()],a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([m.property()],a.CameraOnSurface.prototype,"scale",null);b.__decorate([m.property()],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([c.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const v=f.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e){a.PointOfInterest=class extends n{constructor(d){super(d)}};b.__decorate([h.property({constructOnly:!0})],
a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([h.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([h.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=b.__decorate([e.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){const v=Array;a.CenterOnSurface=class extends q.PointOfInterest{constructor(A){super(A);this._propertiesPool=new t.PropertiesPool({location:r,renderLocation:v},this);this.distance=this._latestSurfaceAltitude=this._currentSurfaceAltitude=0;this.renderLocation=l.create();this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()}destroy(){this._frameWorker=h.removeMaybe(this._frameWorker);this._propertiesPool=
h.destroyMaybe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const A=this._propertiesPool.get("location");A.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,A);return A}updateRenderLocation(){this.updating=!0;this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();
this._updateRenderLocation();this.updating=!1;return u.Yield}_updateRenderLocation(){const A=y;let C=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,A);var E=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!C&&E&&(C=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,A))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);E=D;C&&this._latestSurfaceAltitudeChangesDistanceSignificantly(A,E)&&(c.copy(A,E),this._currentSurfaceAltitude=this._latestSurfaceAltitude);
C?this.distance=c.distance(this._camera.eye,A):(c.scale(A,this._camera.viewForward,this._get("distance")),c.add(A,A,this._camera.eye));c.exactEquals(this._get("renderLocation"),A)||this._set("renderLocation",c.copy(this._propertiesPool.get("renderLocation"),A))}_calculateSurfaceIntersection(A,C){var E=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(E.ray,A,C))return!1;if(this.state.isGlobal){const I=f.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;A=I+A;
const H=c.squaredLength(E.eye),J=H<A*A,B=c.distance(E.eye,C);J&&B>I/4&&(c.scale(C,E.viewForward,A-Math.sqrt(H)),c.add(C,C,E.eye))}else E=this.surface?.ready?this.surface.extent:null,null!=E&&x.projectBoundingRect(E,this.surface?.spatialReference,G,this.renderCoordsHelper.spatialReference)&&(C[0]=n.clamp(C[0],G[0],G[2]),C[1]=n.clamp(C[1],G[1],G[3]));return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(A,C){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==A)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,
C)){if(p.debugFlags.TESTS_DISABLE_OPTIMIZATIONS)return!0;const E=this._camera.eye;A=c.distance(E,A);C=c.distance(E,C);if(.05<Math.abs(C-A)/A)return!0}return!1}};b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([k.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",
void 0);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([k.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([k.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([d.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const y=l.create(),D=l.create(),G=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports",
"../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,b,n,h){class k{constructor(g){this._handles=new n;this.events=new b;this._contentLayerViews=g.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",e=>this._layerViewsChanged(e)));this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=h.destroyMaybe(this._handles);this._contentLayerViews.destroy()}_layerViewsChanged(g){g.added.forEach(e=>
{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this._handles.add(e.on("visible-geometry-changed",()=>this._contentChanged()),e.uid)});g.removed.forEach(e=>this._handles.remove(e.uid))}_contentChanged(){this.events.emit("request-update",m)}}const m={};a.ContentGeometryUpdates=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){const y=Array;a.Focus=class extends t.PointOfInterest{constructor(C){super(C);this._propertiesPool=new p.PropertiesPool({location:x,renderLocation:y},this);this._dirty=!0;this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([k.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),k.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);this.scheduler&&this.addHandles(this.scheduler.registerTask(u.TaskPriority.POINT_OF_INTEREST_FREQUENT,
this))}destroy(){this._propertiesPool=h.destroyMaybe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const C=this._propertiesPool.get("location");C.spatialReference=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this.renderLocation,C);return C}get worldUnitsPerContentPixel(){const {camera:C,contentPixelRatio:E}=this.state;return C.computeRenderPixelSizeAt(this.renderLocation)*(C.pixelRatio/E)}get running(){return this._dirty}runTask(){var C=
this._get("renderLocation");const E=this.centerOnSurface.renderLocation;var I=this.renderCoordsHelper,H=this.state.contentCamera;this._dirty=!1;I.worldUpAtPosition(E,D);I=Math.max(0,(Math.acos(f.dot(D,H.viewForward))-.5*Math.PI)*(H.aboveGround?1:-1));if(Number.isNaN(I))return C&&f.equals(C,E)||(C=this._propertiesPool.get("renderLocation"),f.copy(C,E),this._set("renderLocation",C)),v.Yield;I=1-n.clamp(I/(.5*Math.PI),0,1);I*=I*I;this._calculateScreenHorizontalEdgeOnSurface(A);H=this._propertiesPool.get("renderLocation");
f.lerp(H,E,A,I);C&&f.equals(C,H)||this._set("renderLocation",H);return v.Yield}_calculateScreenHorizontalEdgeOnSurface(C){const E=this.state.contentCamera;var I=E.getRenderCenter(m.createRenderScreenPointArray3());I[1]=E.aboveGround?E.padding[q.PaddingSide.BOTTOM]:E.fullHeight-E.padding[q.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(I,C))return C;const H=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return E.unprojectFromRenderScreen(I,G)&&(f.subtract(G,
G,E.eye),I=f.normalize(G,G),this.renderCoordsHelper.intersectInfiniteManifold(w.wrap(E.eye,I),H,C))?C:this.renderCoordsHelper.setAltitude(C,H,E.eye)}updateRenderLocation(){this._dirty=!0}};b.__decorate([g.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([g.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([g.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);b.__decorate([g.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",
void 0);b.__decorate([g.property()],a.Focus.prototype,"updating",null);b.__decorate([g.property()],a.Focus.prototype,"location",null);b.__decorate([g.property()],a.Focus.prototype,"renderLocation",void 0);b.__decorate([g.property()],a.Focus.prototype,"worldUnitsPerContentPixel",null);a.Focus=b.__decorate([l.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const D=r.create(),G=r.create(),A=r.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.StableSurfaceCenter=class extends n{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const x=l.create();this.view.renderCoordsHelper.toRenderCoords(this.location,x);return x}constructor(x){super(x);this._updateController=this.location=null}initialize(){this.view.state.isLocal&&(this.addHandles([k.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],
()=>this._update()),k.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)this._set("location",null);else{var x=r.center(this.surfaceView.extent);x=new f({x:x[0],y:x[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=
new AbortController,this.surface.queryElevation(x,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(w=>{this._updateController=null;this._set("location",w.geometry)}).catch(w=>{h.isAbortError(w)||w&&"elevation-query:invalid-layer"===w.name||console.error("StableSurfaceCenter failed to update: ",w)})):this._set("location",x)}}};b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([m.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,
"cache",void 0);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surface",null);b.__decorate([m.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"location",void 0);b.__decorate([m.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([c.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.SurfaceGeometryUpdates=class extends n{constructor(q){super(q);this._tileGeometryUpdateExtent=l.empty();this._tileGeometryUpdateSpatialReference=null;this.events=new h;this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",q=>this._tileGeometryChanged(q)),this.scheduler.registerTask(f.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){if(!this.updating)return r.Yield;this._tileGeometryUpdateSpatialReference&&
this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",x);l.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return r.Yield}_tileGeometryChanged(q){this._tileGeometryUpdateSpatialReference=q.spatialReference;l.expand(this._tileGeometryUpdateExtent,q.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)}_furthestCenterOnSurface(){let q=this.centerOnSurfaces[0];for(let u=1;u<this.centerOnSurfaces.length;u++){const v=
this.centerOnSurfaces[u];v.distance>q.distance&&(q=v)}return q}_centerIntersectsExtent(q,u){const v=this.state.contentCamera.eye,y=t,D=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(v,w,u);this.renderCoordsHelper.fromRenderCoords(D.renderLocation,p,u);w[0]<p[0]?(y[0]=w[0],y[2]=p[0]):(y[0]=p[0],y[2]=w[0]);w[1]<p[1]?(y[1]=w[1],y[3]=p[1]):(y[1]=p[1],y[3]=w[1]);return l.intersects(y,q)}};b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",
void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);b.__decorate([k.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([k.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,
"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([d.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const x={},w=c.create(),p=c.create(),t=l.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/support/UpdatingHandles ../../../geometry/ellipsoidUtils ../../../geometry/SpatialReference ../../../geometry/projection/projectors ../../../geometry/projection/projectPointToVector ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../chunks/sphere ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/ElevationRange ../support/ElevationUpdateEvent ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja,oa,qa,ta,va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma){function Ua(xa,Ia,na){for(const ya of xa)if(ya.containsPointXY(Ia,na)){for(xa=ya;xa&&!xa.renderData;)xa=xa.children[(Ia>xa.extentMidX?1:0)+(na<xa.extentMidY?2:0)];return X.sampleElevation(Ia,na,xa?.renderData?.geometryState.samplerData??null)}return null}function Ga(xa,Ia){!xa.isLeaf||xa.level<ja.maxTileNeighborLevelDelta||
Xa(xa,na=>{Ia&&Na(na);var ya=0===na.maxLevelDeltaNeighborCount&&0===na.unmergableChildCount;na.maxLevelDeltaNeighborCount++;if(ya)for(na=na.parent;na;)if(ya=0===na.maxLevelDeltaNeighborCount&&0===na.unmergableChildCount,na.unmergableChildCount++,ya)na=na.parent;else break})}function Na(xa){if(!xa.hasPendingUpdate(ma.TileUpdate.SPLIT)){for(var Ia=xa.parent;Ia&&Ia.resetPendingUpdate(ma.TileUpdate.MERGE);)Ia=Ia.parent;xa.resetPendingUpdate(ma.TileUpdate.MERGE);xa.isLeaf&&xa.setPendingUpdate(ma.TileUpdate.SPLIT);
xa.level<ja.maxTileNeighborLevelDelta||Xa(xa,na=>{Na(na)})}}function Va(xa){xa.level<ja.maxTileNeighborLevelDelta||Xa(xa,Ia=>{Ia.maxLevelDeltaNeighborCount--;if(0===Ia.maxLevelDeltaNeighborCount&&0===Ia.unmergableChildCount)for(Ia=Ia.parent;Ia;)if(Ia.unmergableChildCount--,0===Ia.maxLevelDeltaNeighborCount&&0===Ia.unmergableChildCount)Ia=Ia.parent;else break})}function Xa(xa,Ia){if(!(xa.level<ja.maxTileNeighborLevelDelta)){var na=xa.level-ja.maxTileNeighborLevelDelta,ya=xa.lij[1]>>ja.maxTileNeighborLevelDelta,
Da=xa.lij[2]>>ja.maxTileNeighborLevelDelta,Oa=Wa=>Wa.isLeaf||Wa.level===na;for(let Wa=0;4>Wa;++Wa){const ab=xa.findNeighborTile(ta.neighborEdgeIndices[Wa],Oa);if(!ab||ab.level!==na)continue;const Ja=ab.lij;Ja[1]===ya&&Ja[2]===Da||Ia(ab)}}}var Pa;h=Pa=class extends g.EventedMixin(h){constructor(xa){super(xa);this._scaleRangeQueries=new ha.ScaleRangeQueries;this._iteratorPool=new f(wa.IteratorPreorder,Ia=>Ia.remove=()=>this._iteratorPool.release(Ia));this._postorderIterator=new wa.IteratorPostorder;
this._hasPendingUpdates=!1;this._asyncWorkItems=this._pendingUpdates=0;this._allTilesSorted=this._allTilesDirty=!0;this._usedMemory=null;this._performanceInfo=new qa;this._viewChangeUpdateDirty=this._inFrameTask=this._viewChanged=!1;this._eyePosRenderSR=D.create();this._eyePosSurfaceSR=D.create();this._splitLimits=new Z.SplitLimits;this._frustum=B.create();this._viewProjectionMatrix=v.create();this._layerViews=[[],[]];this._layerIndexByUid=[new Map,new Map];this._basemapLayerViewHandles=new Map;this._watchUpdatingTracking=
new G.UpdatingHandles;this._frameTask=Ka.ImmediateTask;this._allTiles=new r;this._upsampleInfoPool=new f(pa.UpsampleInfo);this._shouldEmitChangeEvent=!1;this._rootTilesExtent=J.create();this.updatingProgress=.5;this._maxNumUpdating=1;this.maxTextureScale=1.2;this._spatialReference=C.WebMercator;this._elevationProjectorCache=new Map;this.visibleElevationBounds=new ca.ElevationBounds(Infinity,-Infinity);this.rootTileElevationBounds=new ca.ElevationBounds(Infinity,-Infinity);this._sebProjectorMap=new Map;
this._sebProjectorCache=E.createEmptyProjectorCache();this._tilingSchemeSpatialReference=null;this._updatingRootTiles=!1;this._pendingTilesForElevationUpdateEvent=new Set;this._pendingTilesToUpdate=new Set;this.totalTileUpdates=this.totalGeometryUpdates=0;this._oneBatchPerFrameTask=!0;this._layerViewsDirty=!1;this.unloadedMemory=0;this._isWebMercatorOnPlateCarree=this._isWebMercator=this.ignoresMemoryFactor=!1;this.overlayManager=new da.OverlayManager({...xa,surface:this});this._isGlobal=!xa.view?.state?.isLocal;
this._isGeographic=this._spatialReference?.isGeographic??!1;this._tileConstructor=this._isGlobal?Y.SphericalPatch:aa.PlanarPatch}initialize(){const xa=this.view,Ia=xa.resourceController;this._lercDecoder=N.acquireDecoder(Ia);const na=Ia.memoryController;this._tileCache=new l.MemCachePool((Wa,ab)=>na.newCache(Wa,ab),"terrain-tile");this._upsampleMapCache=na.newCache("terrain-upsample",Wa=>Wa.unloadMapData());this._elevationQueryCache=new F.ElevationQueryTileCache(na.newCache("elevation-query"));const ya=
this.overlayManager;this._renderer=new oa.TerrainRenderer(ya.renderer,xa._stage,this._allTiles,A.getReferenceEllipsoid(xa.spatialReference).radius,na);this.addHandles([w.watch(()=>ya.renderer.isEmpty,()=>this._evaluateTransparency()),w.watch(()=>this.renderer.visible,Wa=>this.suspended=!Wa)],"overlayManager");this.addHandles([w.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?ia.TextureUpdate.UNFADED:ia.TextureUpdate.IMMEDIATE)},
w.syncAndInitial),w.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ia.TextureUpdate.UNFADED:ia.TextureUpdate.IMMEDIATE),w.syncAndInitial),w.watch(()=>this.backgroundColor,(Wa,ab)=>{Wa?.equals(ab)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(Wa))},w.sync),w.watch(()=>this.snapLevel,()=>this._viewChanged=!0,w.sync),w.watch(()=>this.view.pointsOfInterest,Wa=>{this._renderer.pointsOfInterest=Wa;this._watchUpdatingTracking.removeAll();
Wa&&this._watchUpdatingTracking.add(()=>Wa.focus.renderLocation,()=>this._allTilesSorted=!1)}),w.watch(()=>O.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES,Wa=>{Wa&&!this._treeDebugger?(new Promise((ab,Ja)=>a(["../layers/support/TerrainTileTree3DDebugger"],ab,Ja))).then(({TerrainTileTree3DDebugger:ab})=>{!this._treeDebugger&&O.debugFlags.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new ab({view:xa}))}):Wa||(this._treeDebugger=c.destroyMaybe(this._treeDebugger))},w.initial)]);var {spatialReference:Da}=
xa;this._extentHelper=ba.create(this.viewingMode,{layers:xa.map.allLayers,layerViews:xa.allLayerViews,viewSpatialReference:Da});const Oa=new m({getCollections:()=>xa.defaultsFromMap?.mapCollections?.map(({layers:Wa})=>Wa),getChildrenFunction:Wa=>Wa&&"layers"in Wa?Wa.layers:null});Da=new Ba.TilingSchemeLogic({layers:Oa,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Da});this._set("tilingSchemeLogic",Da);this._updateTilingScheme();this._elevationDataRequester=Ia.createStreamDataRequester(U.ClientType.ELEVATION);
this._mapDataRequester=Ia.createStreamDataRequester(U.ClientType.BASEMAP);this._frameTask=Ia.scheduler.registerTask(Ka.TaskPriority.TERRAIN_SURFACE,this);this.addHandles([w.watch(()=>this._extentHelper.stencilEnabledExtents,Wa=>this._renderer.setStencilEnabledLayerExtents(Wa),w.initial),w.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),w.sync),w.watch(()=>this.extent,()=>this._updateRootTiles(),w.initial),xa.on("resize",()=>this._viewChangeUpdate()),w.watch(()=>{const Wa=
xa.state;return[this._lodBias,this.lodSnapping,xa.quality,Wa.camera,Wa.contentCamera,Wa.fixedContentCamera]},()=>this._viewChangeUpdate(),w.syncAndInitial),w.watch(()=>xa.qualitySettings?.fadeDuration,Wa=>this._renderer.textureFadingEnabled=0<Wa,w.initial),w.watch(()=>xa.qualitySettings?.physicallyBasedRenderingEnabled,Wa=>this._renderer.pbrMode=Wa?ra.PBRMode.Simplified:ra.PBRMode.Disabled,w.initial),w.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),w.sync)]);this.addHandles(xa.allLayerViews.on("after-changes",
()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove();this._watchUpdatingTracking.destroy();this._lercDecoder=c.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._set("tilingSchemeLogic",c.destroyMaybe(this.tilingSchemeLogic));this._basemapLayerViewHandles.forEach((xa,Ia)=>this._unregisterTiledLayerView(Ia));this._mapDataRequester=this._elevationDataRequester=null;
this._set("overlayManager",c.destroyMaybe(this.overlayManager));this._tileCache=c.destroyMaybe(this._tileCache);va.Tile.prune();this._treeDebugger=c.destroyMaybe(this._treeDebugger);this._renderer=c.destroyMaybe(this._renderer);this._iteratorPool=c.destroyMaybe(this._iteratorPool);this._upsampleMapCache=c.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=c.destroyMaybe(this._elevationQueryCache);this._set("view",null);this._extentHelper=c.destroyMaybe(this._extentHelper);this._upsampleInfoPool=
c.destroyMaybe(this._upsampleInfoPool);P.printAllocations();Ca.printAllocations()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){if(this.lodSnapping===ia.LODSnapping.ON){var xa=this.view,Ia=this.tilingScheme;const ya=xa.pointsOfInterest?.cameraOnSurface?.scale;if(Ia&&ya){var na=xa.state.contentCamera;na=R.directionToHeadingTilt(xa,na.eye,na.viewForward,na.up).tilt;90<na&&(na=180-na);na=2*(na/90)**2;Ia=Ia.levelAtScale(ya);xa=Math.min(Ia-na+xa.qualitySettings.tiledSurface.lodBias,
this._splitLimits.maxLod||Infinity);return 0>=xa?null:xa}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?ia.LODSnapping.ON:ia.LODSnapping.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){var {spatialReference:xa}=this,{clippingArea:Ia}=this.view;
if(null==Ia||null==xa)return null;const na=J.create();xa=V.toBoundingRect(Ia,na,xa)?na:null;Ia=this._get("extent");return J.equals(xa,Ia)?Ia:xa}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const xa=J.intersection(this.groundExtent,this._userClippingExtent,J.create()),Ia=this._get("extent");return J.equals(xa,Ia)?Ia:xa}get groundExtent(){return null!=this._tilingSchemeExtent?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){return this.tilingSchemeLogic?.extent}get updating(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking?.updating||0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager?.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-
this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){return this.view?.map?.ground?.opacity??1}set baseOpacity(xa){this.view.map.ground.opacity=xa}get viewingMode(){return this.view.state.viewingMode}get ready(){return null!=this._rootTiles}set renderOrder(xa){this._renderer.renderOrder=xa;this._set("renderOrder",xa)}get rootTiles(){return this._rootTiles}get spatialReference(){return this.tilingScheme?.spatialReference??null}get backgroundColor(){return this.view?.map?.ground?.surfaceColor}set backgroundColor(xa){this.view.map.ground.surfaceColor=
xa}set slicePlaneEnabled(xa){this._renderer.slicePlaneEnabled=xa;this._set("slicePlaneEnabled",xa);this._evaluateTransparency()}get tilingSchemeLocked(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}get wireframe(){return this._renderer?.wireframe}set wireframe(xa){xa!==this._renderer.wireframe&&(this._renderer.wireframe=xa,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===oa.TransparencyMode.Opaque}set suspended(xa){this._set("suspended",xa);this._viewChangeUpdate()}get fadeDuration(){return this.view.qualitySettings.fadeDuration??
0}intersect(xa,Ia,na,ya){this._renderer.intersect(xa,Ia,na,ya)}getElevation(xa,Ia,na,ya){const Da=this._rootTiles;if(!Da?.length||0===Da[0].layerInfo[fa.LayerClass.ELEVATION].length)return null;let Oa=this._elevationProjectorCache.get(ya);void 0===Oa&&(Oa=E.getProjector(ya,this._spatialReference)??null,this._elevationProjectorCache.set(ya,Oa));if(null==Oa)return e.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;xa=y.set(bb,
xa,Ia,na);Oa(xa,0,xa,0);return Ua(Da,xa[0],xa[1])}getElevations(xa,Ia,na){const ya=this._rootTiles;var Da=ya?ya[0].layerInfo[fa.LayerClass.ELEVATION].length:0;if(ya?.length&&0!==Da)for(Da=0;Da<Ia;++Da){var Oa=3*Da;Oa=Ua(ya,xa[Oa],xa[Oa+1]);na(Da,Oa)}else for(xa=0;xa<Ia;++xa)na(xa,null)}getScale(xa){if(!this.tilingScheme)return null;if(!I.projectPointToVector(xa,bb,this.spatialReference))return e.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),
null;xa=this._rootTiles;if(null!=xa)for(var Ia of xa)if(Ia?.containsPoint(bb)){for(;Ia.children[0]&&!Ia.rendered;){xa=Ia.children[0].extent;let na=0;bb[0]>xa[2]&&(na+=1);bb[1]<xa[1]&&(na+=2);Ia=Ia.children[na]}return this._getLodBiasCorrectedScale(Ia.level)}return Infinity}_ensureSEBProject(xa){var Ia=this._sebProjectorMap.get(xa);if(Ia)return Ia;Ia=E.getProjector(xa,this._tilingSchemeSpatialReference,this._sebProjectorCache)??null;this._sebProjectorMap.set(xa,Ia);return Ia}getSphereElevationBounds(xa,
Ia){Ia=this._ensureSEBProject(Ia);if(null==Ia)return e.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;K.copy(xa,gb);xa=K.getCenter(gb);Ia(xa,0,xa,0);xa=new T.ElevationRange;var na=this._rootTiles;if(null!=na){Ia=[];for(var ya of na)Ia.push(ya);for(ya=0;ya<Ia.length;){na=Ia[ya];++ya;if(!J.intersectsSphere(na.extent,gb))continue;const Da=na.children;if(null==Da[0]||na.rendered)xa.expandElevationRangeValues(na.elevationBoundsMin,
na.elevationBoundsMax);else for(const Oa of Da)Ia.push(Oa)}}return xa}getRootElevationBounds(){return new T.ElevationRange(this.rootTileElevationBounds.min,this.rootTileElevationBounds.max)}getSphereScale(xa,Ia){if(!this.tilingScheme)return null;if(!I.projectPointToVector(xa,K.getCenter(gb),this.spatialReference))return e.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;gb[3]=Ia;let na=null;const ya=Da=>{if(Da&&J.intersectsSphere(Da.extent,
gb)){const Oa=Da.children;if(Oa[0]&&!Da.rendered)for(const Wa of Oa)ya(Wa);else Da=this._getLodBiasCorrectedScale(Da.level),na=null==na?Da:Math.min(na,Da)}};xa=this._rootTiles;if(null!=xa)for(const Da of xa)ya(Da);return na}queryVisibleScaleRange(xa,Ia,na,ya){Ia=Ia?this.tilingScheme.levelAtScale(Ia):0;na=na?this.tilingScheme.levelAtScale(na):Infinity;const Da=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(xa,Ia+Da,na+Da,ya)}_evaluateTransparency(){var xa=this.baseOpacity;const Ia=this.overlayManager.renderer.isEmpty;
var na=this._renderer.transparency;xa=this._allSurfaceLayersTransparent()?Ia?oa.TransparencyMode.Empty:oa.TransparencyMode.TransparentWithDraped:1<=xa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?oa.TransparencyMode.Opaque:oa.TransparencyMode.Semitransparent;if(na=na!==xa)this._renderer.transparency=xa,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});return na}_updateTilingScheme(){const xa=this.tilingSchemeLogic.tilingScheme;if(xa!==
this.tilingScheme){ta.weakAssert(!!xa,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var Ia=xa?.spatialReference??C.WebMercator;this._spatialReference=Ia;this._isWebMercatorOnPlateCarree=(this._isWebMercator=!!Ia?.isWebMercator)&&z.isPlateCarree(this.view?.renderSpatialReference);this._isGeographic=Ia?.isGeographic??!1;this._set("tilingScheme",xa);this._tilingSchemeSpatialReference=this.tilingScheme?.spatialReference;
this._sebProjectorMap.clear();this._updateClippingExtent();xa&&(this._updateTiledLayers(),this._renderer.setTileSize(xa.pixelSize),this.overlayManager.setSpatialReference(xa.spatialReference),this._updateRootTiles())}}_acquireTile(xa,Ia,na,ya){const Da=this._tileCache.pop(Pa._tileMemcacheKey);return Da?(Da.init(xa,Ia,na,ya,this),Da):new this._tileConstructor(xa,Ia,na,ya,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const {extent:xa,tilingScheme:Ia}=this;if(Ia){var na=
cb,ya=Ia.rootTilesInExtent(xa,na,5*ja.maxRootTiles);if(null!=this._rootTiles){if(ya.length>ja.maxRootTiles){e.getLogger(this).warn(ja.tooManyRootTilesAfterChangeError);return}const Da=this._rootTiles.map(Wa=>Wa.lij),Oa=k.difference(Da,ya,va.lijEquals);this._updatingRootTiles=!0;if(0<Oa.removed.length||0<Oa.added.length){const Wa=this._rootTiles.filter(ab=>-1<Oa.removed.findIndex(Ja=>va.lijEquals(Ja,ab.lij))?(this._purgeTile(ab),!1):!0);Oa.added.forEach(ab=>Wa.push(this._newRootTile(ab)));this._setRootTiles(Wa)}}else this._updatingRootTiles=
!0,ya.length>ja.maxRootTiles&&(e.getLogger(this).warn(ja.tooManyRootTilesForLayerError),ya=Ia.rootTilesInExtent(xa,na,ja.maxRootTiles)),this._setRootTiles(ya.map(Da=>this._newRootTile(Da)));J.equals(na,this._rootTilesExtent)||(this._rootTilesExtent=J.create(na));this.renderer.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}}_updateAllTileGeometries(){const xa=
this._allTiles.filter(Ia=>Ia.isLoaded&&Ia.intersectsClippingArea);xa.forEach(Ia=>this._renderer.updateTileGeometryState(Ia));xa.forEach(Ia=>Ia.renderData.updateNeighborData());this._updateTilesGeometries(xa);this._pendingTilesToUpdate.clear()}_updateTilesGeometries(xa){if(0!==xa.length){xa.sort(wa.compareTilesByLij);var Ia=this.renderer;xa.forEach(na=>Ia.updateGeometryIfNeeded(na));xa.forEach(na=>this._pendingTilesForElevationUpdateEvent.add(na))}}_shouldSplit(xa){return xa.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.snapLevel)===ma.TileUpdate.SPLIT}_newRootTile(xa){xa=this._acquireTile(0,xa[1],xa[2],null);this._shouldSplit(xa)&&xa.setPendingUpdate(ma.TileUpdate.SPLIT);this._loadTile(xa);this._markTileToUpdate(xa);this._updateRootTileElevationBounds();return xa}_setRootTiles(xa){this._rootTiles=xa;this._allTiles.clear();if(null!=xa){const Ia=this._iteratorPool.acquire();for(Ia.reset(xa);!Ia.done;)this._allTiles.push(Ia.next());Ia.remove()}this._renderer.setRootTiles(this._rootTiles);
this._updateTilesVisibility(xa)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(xa){xa.updateClippingStatus(this.extent)&&xa.resetPendingUpdate(ma.TileUpdate.GEOMETRY)&&
this._updateTileGeometryState(xa)}_updateTilesVisibility(xa){if(null!=xa){var Ia=wa.hasLoadableSiblings(xa),na=this.visibleElevationBounds,ya=Ia?na.min:Infinity;Ia=Ia?na.max:-Infinity;var Da=this.extent,Oa=this._viewProjectionMatrix;this.setTileTreeDirty();var Wa=this._iteratorPool.acquire();for(Wa.reset(xa);!Wa.done;)xa=Wa.next(),xa.updateClippingStatus(Da)&&xa.resetPendingUpdate(ma.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(xa),xa.computeVisibility(),xa.updateScreenDepth(Oa),xa.renderData&&
(ya=Math.min(xa.elevationBoundsMin,ya),Ia=Math.max(xa.elevationBoundsMax,Ia));Wa.remove();this._allTilesDirty=this._viewChanged=!0;this._updatePendingTileGeometries();isFinite(ya)&&isFinite(Ia)&&(na.min!==ya||na.max!==Ia)&&(this.visibleElevationBounds=new ca.ElevationBounds(ya,Ia))}}_updateRootTileElevationBounds(){let xa=Infinity,Ia=-Infinity;var na=this._rootTiles;null!=na&&na.forEach(({elevationBoundsMin:ya,elevationBoundsMax:Da})=>{xa=Math.min(xa,ya);Ia=Math.max(Ia,Da)});na=this.rootTileElevationBounds;
if(na.min!==xa||na.max!==Ia)this.rootTileElevationBounds=new ca.ElevationBounds(xa,Ia)}_updateViewDependentParameters(){const {camera:xa,contentCamera:Ia}=this.view.state,na=Math.tan(.5*Ia.fovX),ya=Math.tan(.5*Ia.fovY),Da=this.tilingScheme.pixelSize,Oa=2**-this._lodBias*xa.pixelRatio;this._splitLimits.aboveGround=xa.aboveGround;this._splitLimits.fovX=na;this._splitLimits.fovY=ya;this._splitLimits.relativeWidthLimit=Da/xa.width*this.maxTextureScale*Oa;this._splitLimits.relativeHeightLimit=Da/xa.height*
this.maxTextureScale*Oa;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this._splitLimits.frustum=this.view.state.fixedContentCamera?B.copy(this._splitLimits.frustum??B.create(),Ia.frustum):null;B.copy(this._frustum,xa.frustum);u.multiply(this._viewProjectionMatrix,Ia.projectionMatrix,Ia.viewMatrix);y.copy(this._eyePosRenderSR,Ia.eye);H.projectVectorToVector(xa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,
this.spatialReference)}_updateTileGeometryState(xa){xa.updateVisibility();this._renderer.updateTileGeometryState(xa)&&this._markTileToUpdate(xa);this._usedMemory=null}_markAllTileNeighborsForUpdate(xa){xa.forEachLoadedNeighbor(Ia=>{this._layerViews[fa.LayerClass.MAP].some(ta.isVectorTileLayerView)&&Ia.setPendingUpdate(ma.TileUpdate.TEXTURE_FADING);this._pendingTilesToUpdate.add(Ia)})}_updateTileTexture(xa,Ia){const na=xa.resetPendingUpdate(ma.TileUpdate.TEXTURE_FADING)?ma.TileUpdate.TEXTURE_FADING:
xa.resetPendingUpdate(ma.TileUpdate.TEXTURE_NOFADING)?ma.TileUpdate.TEXTURE_NOFADING:!1;na&&(this._renderer.updateTileTexture(xa,na),this._usedMemory=null,Ia.madeProgress())}_emitElevationUpdateEventForTiles(){if(this._shouldEmitChangeEvent){var xa=mb.extent;J.empty(xa);this._pendingTilesForElevationUpdateEvent.forEach(Ia=>J.expand(xa,Ia.extent,xa));this._pendingTilesForElevationUpdateEvent.clear();mb.spatialReference=this.spatialReference;this.emit("elevation-change",mb);this._shouldEmitChangeEvent=
!1}}runTask(xa){this._handleLayerViewChanges(xa);this._frameTask.processQueue(xa);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,xa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(xa);this._sortTiles(xa);const Ia=!this.view.state.fixedContentCamera;this._mergeAndSplit(xa,Ia);this._updateElevation(xa);this._updateTextures(xa);Ia||this._mergeAndSplit(xa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._updatePendingTileGeometries();
this._emitElevationUpdateEventForTiles();xa.done&&xa.hasProgressed&&this.requestUpdate();this.notifyChange("updatingProgressValue");ta.enableTerrainInternalChecks&&this._checkTileInvariant();if(!xa.hasProgressed)return Ma.Yield}_checkTileInvariant(){const xa=new Map;this._allTiles.forAll(Ia=>xa.set(Ia,new Set));this._allTiles.forAll(Ia=>{ta.weakAssert(Ia.rendered===Ia.isLeaf,` rendered ${Ia.rendered} != ${Ia.isLeaf} leaf`);if(!Ia.isLeaf){var na=Ia.children.reduce((Oa,Wa)=>Oa+(0===Wa.unmergableChildCount&&
0===Wa.maxLevelDeltaNeighborCount?0:1),0);ta.weakAssert(Ia.unmergableChildCount===na,` Tile[${Ia.lij.toString()}] unmergeable child count mismatch:`+` actual ${Ia.unmergableChildCount} vs ${na}`);if(Ia.hasPendingUpdate(ma.TileUpdate.MERGE)){ta.weakAssert(!Ia.hasPendingUpdate(ma.TileUpdate.SPLIT),"Tile can be both split and merge at the same time");for(var ya of Ia.children)ta.weakAssert(ya.isLeaf||ya.hasPendingUpdate(ma.TileUpdate.MERGE),"Child of tile to merge must also merge")}}for(na=0;4>na;++na){if(Ia.rendered&&
(ya=Ia.renderData?.geometryState.edgePeerNeighbors[na],null!=ya)){var Da=Ia.level-ya.level<=ja.maxTileNeighborLevelDelta;Da||(console.log(`tile level delta [${Ia.lij.toString()}] vs [${ya.lij.toString()}] > ${ja.maxTileNeighborLevelDelta}  (edge[${na}])`),ta.weakAssert(Da,`tile level delta [${Ia.level}] vs [${ya.level}] > ${ja.maxTileNeighborLevelDelta}`));ta.weakAssert(Ia.level-ya.level<=ja.maxTileNeighborLevelDelta,`Max tile lod delta exceeded: [${Ia.lij.toString()}] vs [${ya.lij.toString()}]`)}Da=
Ia.level-ja.maxTileNeighborLevelDelta;ya=Ia.findNeighborTile(ta.neighborEdgeIndices[na],Oa=>Oa.isLeaf||Oa.level===Ia.level);if(null!=ya){if(Ia.isLeaf&&Ia.level>=ja.maxTileNeighborLevelDelta){let Oa=ya;for(;Ia.level-Oa.level<ja.maxTileNeighborLevelDelta;)Oa=Oa.parent;va.lijEquals([Da,Ia.lij[1]>>ja.maxTileNeighborLevelDelta,Ia.lij[2]>>ja.maxTileNeighborLevelDelta],Oa.lij)||(Da=xa.get(Oa),ta.weakAssert(!Da.has(Ia),"Cannot already have neighbor"),Da.add(Ia))}ta.weakAssert(ya.rendered||ya.level===Ia.level,
"Non-same-level-neighbor of rendered must be rendered");ta.weakAssert(Ia.level-ya.level<=ja.maxTileNeighborLevelDelta,`Tile level delta [${Ia.level}] vs [${ya.level}] > ${ja.maxTileNeighborLevelDelta}`)}}});this._allTiles.forAll(Ia=>{const na=Ia.maxLevelDeltaNeighborCount,ya=xa.get(Ia);ta.weakAssert(na===ya.size,`Tile[${Ia.lij.toString()}] merge-blocker mismatch: actual ${na} vs ${ya.size}`)})}_updateAllTilesStatus(xa){if(this._viewChanged&&this._rootTiles&&!xa.done){this._viewChanged=!1;var Ia=new tb(this._allTiles.length);
Ia.pushAll(this._rootTiles);var na=this.snapLevel,ya=this._splitLimits,Da=this._eyePosRenderSR;this._allTiles.forAll(ab=>{ab.maxLevelDeltaNeighborCount=0;ab.unmergableChildCount=0});for(var Oa=this._viewProjectionMatrix;!Ia.empty;){const ab=Ia.pop();var Wa=ab.parent;const Ja=(Wa=null!=Wa&&Wa.hasPendingUpdate(ma.TileUpdate.MERGE))?ma.TileUpdate.MERGE:ab.shouldSplit(ya,Da,na),Ra=Ja===ma.TileUpdate.SPLIT;ab.isLeaf?Ga(ab,Ra):Ia.pushAll(ab.children);Wa?(ab.resetPendingUpdate(ma.TileUpdate.SPLIT),ab.isLeaf||
ab.setPendingUpdate(ma.TileUpdate.MERGE),this._updateClippingStatus(ab),ab.updateVisibility(),ab.updateScreenDepth(Oa)):Ra?(ab.resetPendingUpdate(ma.TileUpdate.MERGE),ab.isLeaf&&ab.setPendingUpdate(ma.TileUpdate.SPLIT)):(ab.resetPendingUpdate(ma.TileUpdate.SPLIT)&&ab.updateAgentSuspension(),Ja===ma.TileUpdate.ELEVATION&&ab.updateAgents(fa.LayerClass.ELEVATION),ab.isLeaf||(ab.setPendingUpdate(ma.TileUpdate.MERGE),ab.resetPendingUpdate(ma.TileUpdate.SPLIT)))}this.requestUpdate();!this._shortBatches&&
this._oneBatchPerFrameTask||this._updatePendingTileGeometries();xa.madeProgress()}}_sortTiles(xa){xa.done||this._allTilesSorted||(wa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),xa.madeProgress())}_markTileToUpdate(xa){ta.internalAssert(xa.isLoaded);xa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(xa),this._markAllTileNeighborsForUpdate(xa))}_updatePendingTileGeometries(){const xa=this._pendingTilesToUpdate,
Ia=Array.from(xa.keys()).filter(Da=>Da.isLoaded&&Da.intersectsClippingArea);if(0===Ia.length)xa.clear();else{var na=(Da,Oa)=>{!Oa?.isLoaded||!Oa.intersectsClippingArea||Oa.level<Da.level||xa.has(Oa)||(xa.add(Oa),Ia.push(Oa),Oa.renderData.updateNeighborData())};Ia.sort(wa.compareTilesByLij);var ya=Ia.length;for(let Da=0;Da<ya;++Da){const Oa=Ia[Da];ta.internalAssert(Oa.isLoaded);ta.internalAssert(Oa.intersectsClippingArea);const Wa=Oa.renderData;Wa.updateNeighborData();const ab=Wa.dirtyEdgeResolutions,
Ja=Wa.geometryState,Ra=Sa=>{const db=ta.neighborCornerIndices[Sa];na(Oa,Ja.cornerPeerNeighbors[Sa]?.findCorner(ta.oppositeCorner(db),eb=>eb.isLoaded))};for(let Sa=0;4>Sa;++Sa)if(ab&1<<Sa){const db=Wa.geometryState.edgePeerNeighbors[Sa];db&&db?.level>=Oa.level&&db.forAllSubtreeOnSide(ta.oppositeEdge(ta.neighborEdgeIndices[Sa]),eb=>eb.isLoaded&&eb.intersectsClippingArea?(ta.internalAssert(xa.has(eb)||0>wa.compareTilesByLij(Oa,eb)),na(Oa,eb),!0):!1);Ra((Sa+1)%4);Ra(Sa)}}xa.clear();this._updateTilesGeometries(Ia);
this._shouldEmitChangeEvent=!0;ta.enableTerrainInternalChecks&&ta.enableWaterproofnessTests&&this.checkAllTilesWaterproofness()}}_mergeAndSplit(xa,Ia){if(!this.suspended&&!xa.done&&this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();for(var na=!1,ya=this.view.state.fixedContentCamera,Da=!1;!xa.done;){Da=!0;let Oa=!1;const Wa=!this._allTiles.some(ab=>{if(!na&&!ya&&!ab.visible)return xa.done;var Ja=ab;if(ab.hasPendingUpdate(ma.TileUpdate.MERGE)){if(!Ia||0<ab.unmergableChildCount)return xa.done;
for(ab.resetPendingUpdate(ma.TileUpdate.MERGE);null!=Ja.parent&&0===Ja.parent.unmergableChildCount&&Ja.parent.resetPendingUpdate(ma.TileUpdate.MERGE);)Ja=Ja.parent;this._mergeTile(Ja);Oa=!0;xa.madeProgress()}else if(ab.resetPendingUpdate(ma.TileUpdate.SPLIT)){Ja=!0;const Ra=ab.level;if(Ra>=ja.maxTileNeighborLevelDelta){const Sa=db=>db.isLeaf||Ra-db.level<ja.maxTileNeighborLevelDelta;for(let db=0;4>db;++db){const eb=ab.findNeighborTile(ta.neighborEdgeIndices[db],Sa);null!=eb&&Ra-eb.level===ja.maxTileNeighborLevelDelta&&
(Ja=!1,ta.enableTerrainInternalChecks&&(ta.internalAssert(eb.isLeaf),ta.internalAssert(eb.hasPendingUpdate(ma.TileUpdate.SPLIT))))}}Ja?(this._splitTile(ab),xa.madeProgress(),Oa=!0):ab.setPendingUpdate(ma.TileUpdate.SPLIT)}return xa.done});Oa&&(this._allTilesSorted=!1,this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries());if(Wa)if(!na)na=!0;else{if(!Oa)break}else this._allTilesDirty=!0}Da?xa.madeProgress():this._allTilesDirty=!0;!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries();
this._sortTiles(xa)}}_updateElevation(xa){xa.done||(this._allTiles.some(Ia=>{Ia.resetPendingUpdate(ma.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Ia),this._shortBatches&&this._updatePendingTileGeometries(),xa.madeProgress());return xa.done}),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(xa){xa.done||this._allTiles.some(Ia=>{this._updateTileTexture(Ia,xa);return xa.done})}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ua.RenderRequestType.UPDATE),
this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.quality)*ja.maxMemoryLodBias}_getLodBiasCorrectedScale(xa){const Ia=this.tilingScheme.levels;xa=d.clamp(xa-this._lodBias,0,Ia.length-1);const na=xa-Math.floor(xa);return Ia[Math.floor(xa)].scale*(1-na)+Ia[Math.ceil(xa)].scale*na}_removeAllTiles(){null!=this._rootTiles&&(this._rootTiles.forEach(xa=>this._purgeTile(xa)),this._setRootTiles(null),this.notifyChange("ready"));
this._allTiles.clear();this.renderer.visible=!1}_purgeDescendantTiles(xa){if(xa.children[0]){var Ia=xa.children.slice();xa.unsetChildren();for(xa=0;4>xa;++xa)this._purgeTile(Ia[xa])}}_purgeTile(xa){xa.isLeaf?Va(xa):this._purgeDescendantTiles(xa);this._allTiles.removeUnordered(xa);this._unloadTile(xa);this._tileCache.put(Pa._tileMemcacheKey,xa)}_unloadTile(xa){this._pendingTilesToUpdate.delete(xa);this._pendingTilesForElevationUpdateEvent.delete(xa);xa.unload(this._renderer)}_splitTile(xa){ta.weakAssert(xa.isLeaf,
"Tile that is already split should not be split again!");ta.weakAssert(xa.rendered,"Tile marked to split is not rendered");Va(xa);var Ia=xa.level+1;const na=2*xa.lij[1],ya=2*xa.lij[2];Ia=xa.setChildren(this._createTile(Ia,na,ya,xa),this._createTile(Ia,na,ya+1,xa),this._createTile(Ia,na+1,ya,xa),this._createTile(Ia,na+1,ya+1,xa));this._allTiles.pushArray(Ia);xa.updateAgentSuspension();ta.weakAssert(xa.rendered,"parent should be rendered");this._unloadTile(xa);Ia.forEach(Da=>this._loadTile(Da));Ia.forEach(Da=>
this._pendingTilesToUpdate.add(Da));this._markAllTileNeighborsForUpdate(xa);this._emitTileScaleChange(xa,xa.level+1);this._allTilesDirty=!0;this._shortBatches&&this._updatePendingTileGeometries();Ia.forEach(Da=>Ga(Da,Da.hasPendingUpdate(ma.TileUpdate.SPLIT)));++this._performanceInfo.numSplit}_emitTileScaleChange(xa,Ia=xa.level){qb.spatialReference=this.spatialReference;qb.extent=xa.extent;qb.scale=this._getLodBiasCorrectedScale(Ia);this.emit("scale-change",qb)}_createTile(xa,Ia,na,ya){ta.weakAssert(!!ya,
"_createTile sanity check");xa=this._acquireTile(xa,Ia,na,ya);xa.updateClippingStatus(this.extent);xa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(xa)&&xa.setPendingUpdate(ma.TileUpdate.SPLIT);return xa}get _shortBatches(){return this.view.state.mode!==Ea.RenderState.IDLE}_mergeTile(xa){ta.weakAssert(!xa.hasPendingUpdate(ma.TileUpdate.SPLIT),"_mergeTile sanity check");ta.weakAssert(!xa.isLeaf,"Cannot merge a leaf");xa.isLeaf||(this._purgeDescendantTiles(xa),ta.weakAssert(!xa.renderData,
"_mergeTile sanity check"),this._loadTile(xa),this._markTileToUpdate(xa),this._emitTileScaleChange(xa),this._shortBatches&&this._updatePendingTileGeometries(),Ga(xa,!1),this._allTilesDirty=!0,++this._performanceInfo.numMerged)}_loadTile(xa){xa.load();this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(xa)}_elevationDataArrived(xa,Ia,na){na=new X.ElevationData(xa.lij,xa.extent,na);xa.dataArrived(Ia,fa.LayerClass.ELEVATION,
na);na=[xa];xa=xa.level;const ya=this._iteratorPool.acquire();for(ya.reset(na);!ya.done;){const Da=ya.next();Da.findElevationBoundsForLayer(Ia,xa);Da.computeElevationBounds()}0===xa&&this._updateRootTileElevationBounds();ya.remove();this._updateTilesVisibility(na)}_handleLayerViewChanges(xa=Ka.noBudget){if(this._layerViewsDirty){var Ia=this._layerViewsDirty=!1,na=new Set,ya=-1;for(let Oa=this.view.allLayerViews.length-1;0<=Oa;Oa--){var Da=this.view.allLayerViews.items[Oa];na.add(Da.uid);if(ta.isSurfaceLayerView(Da)||
ta.isGroupLayerView(Da))if(this._basemapLayerViewHandles.has(Da.uid)&&!ta.isGroupLayerView(Da)){const Wa=this._layerClassFromLayerView(Da);Da=this._getLayerIdxByUID(Wa,Da.uid);if(null!=Da){if(Da<ya||null==ya)Ia=!0;ya=Da}}else this._registerTiledLayerView(Da),Da.layer.loaded&&(Ia=!0)}this._basemapLayerViewHandles.forEach((Oa,Wa)=>{na.has(Wa)||(this._unregisterTiledLayerView(Wa),Ia=!0)});Ia&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();
xa.madeProgress()}}_allSurfaceLayersTransparent(){let xa=0===this.view.map?.ground?.opacity;for(const Ia of this.view.allLayerViews.items)if(ta.isMapTileLayerView(Ia)&&!S.isBaseLayer(Ia.layer)&&0!==Ia.fullOpacity){xa=!1;break}return xa}_hasCompositeBlendMode(){for(const xa of this.view.allLayerViews.items)if((ta.isBlendableLayerView(xa)||ta.isGroupLayerView(xa))&&Aa.isCompositeBlendMode(Aa.blendModeFromString[xa.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(xa){return ta.isElevationLayerView(xa)?
fa.LayerClass.ELEVATION:fa.LayerClass.MAP}_registerTiledLayerView(xa){const Ia=[];(ta.isBlendableLayerView(xa)||ta.isGroupLayerView(xa))&&Ia.push(w.watch(()=>xa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(ia.TextureUpdate.UNFADED)}));if(!ta.isGroupLayerView(xa)){const na=this._layerClassFromLayerView(xa);Ia.push(w.watch(()=>xa.suspended,()=>this._updateTiledLayers()));Ia.push(w.watch(()=>xa.fullOpacity,()=>this._updateTileTextures(ia.TextureUpdate.UNFADED)));
Ia.push(w.watch(()=>"effectiveScaleRange"in xa.layer?xa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(na)));Ia.push(xa.on("data-changed",()=>{const ya=this._getLayerIdxByUID(na,xa.uid);null!=ya&&this._invalidateLayerData(ya,na)}))}this._unregisterTiledLayerView(xa.uid);this._basemapLayerViewHandles.set(xa.uid,Ia)}_unregisterTiledLayerView(xa){const Ia=this._basemapLayerViewHandles.get(xa);if(Ia){for(const na of Ia)na.remove();this._basemapLayerViewHandles.delete(xa)}}_updateTiledLayers(){if(this.tilingScheme&&
!this.view.suspended){var xa=[[],[]],Ia=null;this.view.allLayerViews.forEach(ya=>{if(ya.layer&&!ya.suspended&&ta.isSurfaceLayerView(ya)&&ya.fullExtent){var Da=this._layerClassFromLayerView(ya);if(Da===fa.LayerClass.MAP){const Oa=ya.displayLevelRange.maxLevel;Infinity!==Oa&&(null===Ia||Oa>Ia)&&(Ia=Oa)}xa[Da].push(ya)}});for(const ya of fa.LayerClasses){var na=this._layerViews[ya];const Da=xa[ya];Da.reverse();const Oa=Da.length;let Wa=na.length!==Oa;const ab=Array(Oa),Ja=Array(na.length);this._layerIndexByUid[ya].clear();
for(let Ra=0;Ra<Oa;Ra++){this._layerIndexByUid[ya].set(Da[Ra].uid,Ra);const Sa=na.indexOf(Da[Ra]);ab[Ra]=Sa;Ra!==Sa&&(Wa=!0);-1<Sa&&(Ja[Sa]=Ra)}if(Wa){na=this._postorderIterator;for(na.reset(this._rootTiles);!na.done;)na.next().modifyLayers(Ja,ab,ya);this._layerViews[ya]=Da;this._restartAllAgents(ya);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(Ia)&&this._viewChangeUpdate()}}_restartAllAgents(xa){const Ia=this._postorderIterator;for(Ia.reset(this._rootTiles);!Ia.done;){const na=
Ia.next();na.restartAgents(xa);xa===fa.LayerClass.ELEVATION&&na.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(xa,Ia){return this._layerViews[Ia][xa]}numLayers(xa){return this._layerViews[xa].length}_updateTileTextures(xa){this._allTiles.forAll(Ia=>{Ia.updateAgents(fa.LayerClass.MAP);xa===ia.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ia,ma.TileUpdate.TEXTURE_NOFADING):Ia.updateRenderData(fa.LayerClass.MAP,xa)});this._evaluateTransparency()}_invalidateLayerData(xa,
Ia){this._allTiles.forAll(na=>na.removeLayerAgent(xa,Ia));this._allTiles.forAll(na=>na.invalidateLayerData(xa,Ia))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(xa=ua.RenderRequestType.UPDATE){this.renderer.setNeedsRender(xa)}requestUpdate(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(xa,Ia,na,ya){const Da=this.layerViewByIndex(Ia,na);Ia=Da.layer;if(!Ia.tilemapCache||ta.isVectorTileLayerView(Da))return this._requestTileData(xa,na,Da,ya);++this._asyncWorkItems;
return Ia.tilemapCache.fetchAvailability(xa.lij[0],xa.lij[1],xa.lij[2],{...ya,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Oa=>{--this._asyncWorkItems;x.throwIfAborted(ya);x.isAbortError(Oa)||this._dataMissing(xa,na,Da,{notInTilemap:!0});throw Oa;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(xa,na,Da,ya),ya.signal))}_requestTileData(xa,Ia,na,ya){return Ia===fa.LayerClass.ELEVATION?ta.isElevationLayerView(na)?this._requestElevationTileData(xa,na,ya):Promise.reject():ta.isMapTileLayerView(na)?
this._requestMapTileData(xa,na,ya):Promise.reject()}_requestElevationTileData(xa,Ia,na){++this._asyncWorkItems;const ya=Wa=>{if(!x.isAborted(na)){var ab=this._layerIndexByUid[fa.LayerClass.ELEVATION].get(Ia.uid);null==ab?e.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",fa.LayerClass.ELEVATION,xa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(xa,ab,Wa))}},Da=Wa=>{x.isAbortError(Wa)||(this._dataMissing(xa,fa.LayerClass.ELEVATION,
Ia,Wa),this.requestUpdate())};if(ta.useFetchTileForLayer(Ia.layer))return Ia.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],{noDataValue:ja.elevationNodataValue,signal:na.signal}).then(Wa=>{if(x.isAborted(na))e.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>ya(Wa),na.signal,Da)},Da).finally(()=>{--this._asyncWorkItems});const Oa=Ia.getTileUrl(xa.lij[0],
xa.lij[1],xa.lij[2]);return this._elevationDataRequester.request(Oa,"binary",na).then(Wa=>this._lercDecoder.decode(Wa,{noDataValue:ja.elevationNodataValue},na.signal)).then(Wa=>{Wa?ya(new M.ElevationTileData(Wa)):Da(Error("LERC decoding failed"))},Da).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(xa,Ia,na){++this._asyncWorkItems;const ya=(Ja,Ra)=>{--this._asyncWorkItems;ta.releaseTileData(Ra);x.isAborted(na)||(this._dataMissing(xa,fa.LayerClass.MAP,Ia,Ja),this.requestUpdate())},Da=Ja=>
Ra=>ya(Ra,Ja),Oa=Ja=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();x.isAborted(na)?ta.releaseTileData(Ja):this._mapTileDataArrived(xa,Ia,Ja)},na.signal,Da(Ja)).catch(Da(Ja)),Wa=(Ja,Ra=null)=>this._frameTask.schedule(()=>ya(Ja,Ra));if(ta.isVectorTileLayerView(Ia)){var ab=Ia.schemaHelper.getLevelRowColumn(xa.lij);return Ia.fetchTile(ab[0],ab[1],ab[2],na).then(Oa,Wa)}if(ta.isImageryTileLayerView(Ia))return Ia.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],na).then(Oa,Wa);if(ta.isTileLayerView(Ia)&&
ta.useFetchTileForLayer(Ia.layer))return Ia.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],na).then(Ja=>{x.isAborted(na)?(e.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Wa(x.createAbortError())):Oa(Ja)},Wa);ab=Ia.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);L.isRefreshableLayer(Ia.layer)&&Ia.layer.refreshTimestamp&&(ab+=`${ab.includes("?")?"\x26":"?"}_ts=${Ia.layer.refreshTimestamp}`);return this._mapDataRequester.request(ab,
Ia.hasMixedImageFormats?"image+type":"image",na).then(Oa,Wa)}_mapTileDataArrived(xa,Ia,na){Ia=this._getLayerIdxByUID(fa.LayerClass.MAP,Ia.uid);null!=Ia?xa.dataArrived(Ia,fa.LayerClass.MAP,na):(ta.releaseTileData(na),e.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(xa,Ia){return this._layerIndexByUid[xa].get(Ia)}_dataMissing(xa,Ia,na,ya){na=this._getLayerIdxByUID(Ia,na.uid);null!=na?xa.dataMissing(na,Ia,ya):e.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(xa){this._rootTiles&&
this.overlayManager&&(this._allTiles.forAll(Ia=>{Ia.renderData&&this.overlayManager.setTileParameters(Ia)}),this._renderer.setNeedsRender(xa))}get performanceInfo(){const xa=this._performanceInfo;xa.numNodes=this._allTiles.length;xa.numLeaves=xa.numVisible=xa.numRendered=xa.numLoadedPerLevel.length=xa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ia=>{Ia.isLeaf&&xa.numLeaves++;const na=Ia.level;Ia.renderData&&(xa.numLoadedPerLevel[na]=(xa.numLoadedPerLevel[na]||0)+1);Ia.visible&&(xa.numVisible++,
Ia.rendered&&(xa.numRenderedPerLevel[na]=(xa.numRenderedPerLevel[na]||0)+1,xa.numRendered++))});return xa}get usedMemory(){if(!this.tilingScheme)return 0;null==this._usedMemory&&(this._usedMemory=this._recalculateUsedMemory());return this._usedMemory??0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((xa,Ia)=>xa+Ia.usedMemory,0)):null}getUsedMemoryForLayerView(xa){let Ia=0;const na=this._layerClassFromLayerView(xa),ya=this._getLayerIdxByUID(na,xa.uid);null!=ya&&
this._allTiles.forAll(Da=>Ia+=Da.getUsedMemoryForLayer(na,ya));return Ia}getTile(xa){if(null==xa||null==this._rootTiles)return null;const Ia=xa.split("/").map(Oa=>+Oa);if(0===Ia[0])return this._rootTiles.find(Oa=>Oa.lij[1]===Ia[1]&&Oa.lij[2]===Ia[2]);xa=Ia[0];const na=Ia[1]>>xa,ya=Ia[2]>>xa;let Da;this._rootTiles.some(Oa=>Oa.lij[1]===na&&Oa.lij[2]===ya?(Da=Oa,!0):!1);if(Da){for(xa=1<<Ia[0]-1;Da.lij[0]<Ia[0];){let Oa=Ia[1]&xa?2:0;0<(Ia[2]&xa)&&Oa++;if(!Da.children[Oa])return null;Da=Da.children[Oa];
xa>>=1}ta.weakAssert(Da.lij[0]===Ia[0]&&Da.lij[1]===Ia[1]&&Da.lij[2]===Ia[2],"not the right tile?");return Da}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(xa){this._renderer.renderPatchBorders=xa}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(xa){this._renderer.visualizeNormals=xa}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(xa){this._renderer.renderingDisabled=xa}get test(){const xa=
this;return{renderer:xa._renderer,lercDecoder:xa._lercDecoder,forceReload:()=>{null!=xa._rootTiles&&0<xa._rootTiles.length&&(xa._mergeTile(xa._rootTiles[0]),xa._viewChangeUpdate())},getTiles:()=>xa._allTiles.toArray(),getRenderedTiles(){ka.clear();xa._allTiles.forAll(na=>{na.visible&&na.rendered&&ka.push(na)});const Ia=ka.toArray();wa.sortTiles(xa.renderOrder,Ia);return Ia},lockTilingScheme(Ia,na){xa._extentHelper.defaultTiledLayersExtent=na;xa.tilingSchemeLogic.test.lockTilingScheme(Ia)}}}checkAllTilesWaterproofness(){if(ta.enableWaterproofnessTests){var xa=
this._rootTiles;if(null!=xa){var Ia=Da=>0<Da?.renderData?.geometry?.indices?.length,na=Da=>{if(Da.intersectsClippingArea)if(Da.renderData&&!Da.renderData.geometryState&&console.error("Tile[",Da.lij,"] has renderData but not geometryState"),Da.renderData&&!Da.renderData.geometry&&console.error("Tile[",Da.lij,"] has renderData but not geometryInfo"),!Da.renderData?.geometry||0<(Da.renderData.geometry.indices?.length??0)||console.error("Tile[",Da.lij,"] has renderData but no indices - geometryInfo: ",
Da.renderData.geometry),Ia(Da)){Da.checkGeometryWaterproofness();for(const ab of Da.children){var Oa=ab,Wa=Da;Ia(Oa)&&console.error("Tile[",Oa.lij,"] has geometry although parent[",Wa.lij,"] has geom")}}else if(Da.isLeaf)console.error("Tile[",Da.lij,"] has no geometry and no children, from root to leaf");else for(Oa of Da.children)na(Oa)},ya=Da=>{const Oa=Da.parent?.visible??!0,Wa=Da.visible;Da.computeVisibility();const ab=Da.visible;Wa!==ab&&Oa&&console.error(" Tile[",Da.lij,"] has out of date visibility: ",
Wa," instead of ",ab);if(!Da.isLeaf)for(const Ja of Da.children)ya(Ja)};for(const Da of xa)na(Da),ya(Da)}}}get isGlobal(){return this._isGlobal}get isGeographic(){return this._isGeographic}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateCarree(){return this._isWebMercatorOnPlateCarree}isEastEndWrap(xa){return this._isGlobal&&xa[2]===this.lijEastEnd(xa[0])-1}isWestEndWrap(xa){return this._isGlobal&&0===xa[2]}lijEastEnd(xa){return 1<<xa+(this._isGeographic?1:0)}wrapEastWest(xa){const Ia=
this.lijEastEnd(xa[0]),na=xa[2];return 0<=na&&na<Ia?xa:this._isGlobal?[xa[0],xa[1],(na+(0>na?Ia:0))%Ia]:null}enableInternalChecks(xa){ta.enableInternalTerrainChecks(xa)}enableWaterproofnessChecks(xa){ta.enableTerrainWaterproofnessChecks(xa)}};h._tileMemcacheKey="TerrainTileMemcache";b.__decorate([p.property()],h.prototype,"_renderer",void 0);b.__decorate([p.property({constructOnly:!0})],h.prototype,"_scaleRangeQueries",void 0);b.__decorate([p.property({constructOnly:!0})],h.prototype,"view",void 0);
b.__decorate([p.property({constructOnly:!0})],h.prototype,"overlayManager",void 0);b.__decorate([p.property()],h.prototype,"_hasPendingUpdates",void 0);b.__decorate([p.property()],h.prototype,"_asyncWorkItems",void 0);b.__decorate([p.property()],h.prototype,"_allTilesDirty",void 0);b.__decorate([p.property()],h.prototype,"_allTilesSorted",void 0);b.__decorate([p.property()],h.prototype,"_viewChanged",void 0);b.__decorate([p.property()],h.prototype,"_splitLimits",void 0);b.__decorate([p.property({readOnly:!0})],
h.prototype,"_watchUpdatingTracking",void 0);b.__decorate([p.property()],h.prototype,"_frameTask",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"snapLevel",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"lodSnapping",null);b.__decorate([p.property()],h.prototype,"_userClippingExtent",null);b.__decorate([p.property()],h.prototype,"_rootTilesExtent",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"extent",null);b.__decorate([p.property({readOnly:!0})],h.prototype,
"groundExtent",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"_tilingSchemeExtent",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"updating",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"running",null);b.__decorate([p.property(W.updatingProgress)],h.prototype,"updatingProgress",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"updatingProgressValue",null);b.__decorate([p.property()],h.prototype,"_maxNumUpdating",void 0);b.__decorate([p.property()],
h.prototype,"baseOpacity",null);b.__decorate([p.property()],h.prototype,"hasCompositeBlendMode",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"viewingMode",null);b.__decorate([p.property()],h.prototype,"maxTextureScale",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"ready",null);b.__decorate([p.property({value:ea.RenderOrder.FRONT_TO_BACK})],h.prototype,"renderOrder",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"rootTiles",null);b.__decorate([p.property()],
h.prototype,"_rootTiles",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"spatialReference",null);b.__decorate([p.property({type:n})],h.prototype,"backgroundColor",null);b.__decorate([p.property({value:!1})],h.prototype,"slicePlaneEnabled",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"tilingScheme",void 0);b.__decorate([p.property({readOnly:!0})],h.prototype,"tilingSchemeLocked",null);b.__decorate([p.property({readOnly:!0})],h.prototype,"tilingSchemeLogic",void 0);b.__decorate([p.property()],
h.prototype,"wireframe",null);b.__decorate([p.property({value:!1})],h.prototype,"suspended",null);b.__decorate([p.property()],h.prototype,"fadeDuration",null);b.__decorate([p.property()],h.prototype,"visibleElevationBounds",void 0);b.__decorate([p.property()],h.prototype,"rootTileElevationBounds",void 0);b.__decorate([p.property()],h.prototype,"_layerViewsDirty",void 0);b.__decorate([p.property()],h.prototype,"renderPatchBorders",null);b.__decorate([p.property()],h.prototype,"visualizeNormals",null);
b.__decorate([p.property()],h.prototype,"renderingDisabled",null);b=h=Pa=b.__decorate([q.subclass("esri.views.3d.terrain.TerrainSurface")],h);const bb=D.create(),gb=K.create(),cb=J.create(),ka=new r,mb=new Q.ElevationUpdateEvent("ground"),qb={spatialReference:null,extent:null,scale:0};class tb{constructor(xa){this.capacity=xa;this._tail=this._head=0;this._data=Array(xa)}push(xa){const Ia=this._tail;if(Ia<this.capacity)this._data[Ia]=xa,this._tail=Ia+1;else throw Error("Queue full");}pushAll(xa){const Ia=
xa.length;if(0!==Ia){var na=this._tail;if(na+Ia<=this.capacity){for(let ya=0;ya<Ia;++ya)this._data[na+ya]=xa[ya];this._tail=na+Ia}else throw Error("Queue full");}}pop(){const xa=this._head;if(xa<this._tail){const Ia=this._data[xa];this._head=xa+1;return Ia}}get empty(){return this._head>=this._tail}get full(){return this._tail>=this._data.length}}return b})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){class b{constructor(n){this._store=n}destroy(){this._store.destroy()}get(n){return this._store.get(n)}put(n,
h){this._store.put(n,h,h.values.byteLength+256)}}a.ElevationQueryTileCache=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports"],function(a){class b{constructor(n,h,k,m){this._maxValue=this._minValue=this._hasNoDataValues=null;"pixelData"in n?(this.values=n.pixelData,this.width=n.width,this.height=n.height,this.noDataValue=n.noDataValue):(this.values=n,this.width=h,this.height=k,this.noDataValue=m)}get hasNoDataValues(){null==
this._hasNoDataValues&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}get minValue(){this._ensureBounds();return this._minValue}get maxValue(){this._ensureBounds();return this._maxValue}_ensureBounds(){if(null==this._minValue){var {noDataValue:n,values:h}=this,k=Infinity,m=-Infinity,g=!0;for(const e of h)e===n?this._hasNoDataValues=!0:(k=e<k?e:k,m=e>m?e:m,g=!1);g?this._maxValue=this._minValue=0:(this._minValue=k,this._maxValue=-3E38<m?m:0)}}}a.ElevationTileData=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(k=null){super("LercWorker","_decode",{_decode:m=>[m.buffer]},k,{strategy:"dedicated"});this.schedule=k;this.ref=0}decode(k,m,g){return k&&0!==k.byteLength?this.invoke({buffer:k,options:m},g):Promise.resolve(null)}release(){0>=--this.ref&&(h.forEach((k,m)=>{k===this&&h.delete(m)}),
this.destroy())}}const h=new Map;a.acquireDecoder=function(k=null){let m=h.get(k);m||(null!=k?(m=new n(g=>k.immediate.schedule(g)),h.set(k,m)):(m=new n,h.set(null,m)));++m.ref;return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../arrayUtils ../handleUtils ../Logger ../promiseUtils ./workers".split(" "),function(a,b,n,h,k,m){class g{constructor(e,d,c,l,f={}){this._mainMethod=d;this._transferLists=c;this._listeners=[];
this._promise=m.open(e,{...f,schedule:l}).then(r=>{if(void 0===this._thread){this._thread=r;this._promise=null;f.hasInitialize&&this.broadcast({},"initialize");for(const x of this._listeners)this._connectListener(x)}else r.close()});this._promise.catch(r=>h.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${r}`))}on(e,d){const c={removed:!1,eventName:e,callback:d,threadHandle:null};this._listeners.push(c);this._connectListener(c);return n.makeHandle(()=>{c.removed=
!0;b.remove(this._listeners,c);this._thread&&null!=c.threadHandle&&c.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null;this._listeners.length=0;this._transferLists={}}invoke(e,d){return this.invokeMethod(this._mainMethod,e,d)}invokeMethod(e,d,c){if(this._thread){var l=this._transferLists[e];l=l?l(d):[];return this._thread.invoke(e,d,{transferList:l,signal:c})}return this._promise?this._promise.then(()=>{k.throwIfAborted(c);return this.invokeMethod(e,
d,c)}):Promise.reject(null)}broadcast(e,d){return this._thread?Promise.all(this._thread.broadcast(d,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,d)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(d=>{e.removed||(e.threadHandle=d)})}}a.WorkerHandle=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(a,b,n,h,k,m,g,e){class d extends e.TiledDisplayObject{constructor(l,f,r,x,w,p,t,q=null){super(l,f,r,x,w,p,4096,4096);this.styleRepository=t;this._memCache=q;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=
null;this.triangleCount=0;this._processed=!1;this._referenced=1;this.id=l.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<g.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<g.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(l){this.changeDataImpl(l);
this.requestRender();this.ready();this._processed=!0}deleteLayerData(l){let f=!1;for(const r of l)if(l=this.layerData.get(r))this._memoryUsedByLayerData-=l.memoryUsed,l.type===k.BucketType.SYMBOL&&this.symbols.delete(r)&&(f=!0),l.destroy(),this.layerData.delete(r);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);f&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==
this.status&&(this.featureIndex=null,c.delete(this),d._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(l){this.featureIndex?.clear();let f=!1;if(l){const {bucketsWithData:r,emptyBuckets:x}=l;l=this._createRenderBuckets(r);
if(x&&0<x.byteLength){const w=new Uint32Array(x);for(const p of w)this._deleteLayerData(p)}for(const [w,p]of l)this._deleteLayerData(w),p.type===k.BucketType.SYMBOL&&(this.symbols.set(w,p.symbols),f=!0),this._memoryUsedByLayerData+=p.memoryUsed,this.layerData.set(w,p);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const [,r]of this.layerData)r.type===k.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);f&&this.emit("symbols-changed")}attachWithContext(l){this.stage=
{context:l,trashDisplayObject(f){f.processDetach()},untrashDisplayObject(){return!1}}}setTransform(l){super.setTransform(l);var f=this.resolution/(l.resolution*l.pixelRatio);const r=this.width/this.rangeX*f;f*=this.height/this.rangeY;const x=[0,0];l.toScreen(x,[this.x,this.y]);const w=this.transforms.tileUnitsToPixels;n.identity(w);n.translate(w,w,x);n.rotate(w,w,Math.PI*l.rotation/180);n.scale(w,w,[r,f,1])}_createTransforms(){return{displayViewScreenMat3:h.create(),tileMat3:h.create(),tileUnitsToPixels:h.create()}}static _destroyRenderBuckets(l){if(l){var f=
new Set;for(const r of l.values())f.has(r)||(r.destroy(),f.add(r));l.clear()}}_createRenderBuckets(l){const f=new Map,r=new Map;for(const x of l){l=this._deserializeBucket(x,r);for(const w of l.layerUIDs)f.set(w,l)}return f}_deserializeBucket(l,f){let r=f.get(l);if(r)return r;switch((new Uint32Array(l))[0]){case k.BucketType.FILL:r=new m.FillRenderBucket(l,this.styleRepository);break;case k.BucketType.LINE:r=new m.LineRenderBucket(l,this.styleRepository);break;case k.BucketType.SYMBOL:r=new m.SymbolRenderBucket(l,
this.styleRepository,this);break;case k.BucketType.CIRCLE:r=new m.CircleRenderBucket(l,this.styleRepository)}f.set(l,r);return r}_deleteLayerData(l){if(this.layerData.has(l)){var f=this.layerData.get(l);this._memoryUsedByLayerData-=f.memoryUsed;f.destroy();this.layerData.delete(l)}}}const c=new Map;a.VectorTile=d;a.printAllocations=function(){c.forEach((l,f)=>{console.log(`\n${f.key}:`);l[0].forEach(r=>console.log(r));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");l[1].forEach(r=>console.log(r))})};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["exports"],function(a){function b(){const g=new Float32Array(9);g[0]=1;g[4]=1;g[8]=1;return g}function n(g){const e=new Float32Array(9);e[0]=g[0];e[1]=g[1];e[2]=g[2];e[3]=g[3];e[4]=g[4];e[5]=g[5];e[6]=g[6];e[7]=g[7];e[8]=g[8];return e}function h(g,e,d,c,l,f,r,x,w){const p=new Float32Array(9);p[0]=g;p[1]=e;p[2]=d;p[3]=c;p[4]=l;p[5]=f;p[6]=r;p[7]=x;p[8]=w;return p}function k(g,
e){return new Float32Array(g,e,9)}const m=Object.freeze(Object.defineProperty({__proto__:null,clone:n,create:b,createView:k,fromValues:h},Symbol.toStringTag,{value:"Module"}));a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.mat3f32=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||
(a.BucketType={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=
4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(a,b,n,h,k,m,g,
e,d,c,l,f){class r{constructor(q,u){this.layerUIDs=[];this.isDestroyed=!1;this._data=q;let v=1;q=new Uint32Array(q);this.layerUIDs=[];const y=q[v++];for(let D=0;D<y;D++)this.layerUIDs[D]=q[v++];this.bufferDataOffset=v;u&&(this.layer=u.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(q){null!=
this._data&&(this.doPrepareForRendering(q,this._data,this.bufferDataOffset),this._data=null)}}class x extends r{constructor(q,u){super(q,u);this.type=e.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;q=new Uint32Array(q);u=this.bufferDataOffset;this.lineIndexStart=q[u++];this.lineIndexCount=q[u++];const v=q[u++];if(0<v){this.patternMap=new Map;for(let y=0;y<v;y++){const D=q[u++],G=q[u++],A=q[u++];this.patternMap.set(D,[G,A])}}this.bufferDataOffset=u}get memoryUsed(){return(this.data?.byteLength??
0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=b.disposeMaybe(this.vao)}doPrepareForRendering(q,u,v){var y=new Uint32Array(u);u=new Int32Array(y.buffer);var D=y[v++];u=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*v,D));v+=D;D=y[v++];y=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,D));v+=D;v=this.layer.lineMaterial;this.vao=new f.VertexArrayObject(q,
v.getAttributeLocations(),v.getLayoutInfo(),{geometry:u},y)}}class w extends r{constructor(q,u){super(q,u);this.type=e.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;q=new Uint32Array(q);u=this.bufferDataOffset;this.fillIndexStart=q[u++];this.fillIndexCount=q[u++];this.outlineIndexStart=q[u++];this.outlineIndexCount=q[u++];const v=q[u++];if(0<v){this.patternMap=new Map;for(let y=0;y<v;y++){const D=q[u++],G=q[u++],A=q[u++];this.patternMap.set(D,
[G,A])}}this.bufferDataOffset=u}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=b.disposeMaybe(this.fillVAO);this.outlineVAO=b.disposeMaybe(this.outlineVAO)}doPrepareForRendering(q,u,v){var y=new Uint32Array(u),D=new Int32Array(y.buffer),G=y[v++];u=c.BufferObject.createVertex(q,
l.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*v,G));v+=G;var A=y[v++];G=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,A));v+=A;A=y[v++];D=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*v,A));v+=A;A=y[v++];y=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,A));v+=A;A=this.layer;v=A.fillMaterial;A=A.outlineMaterial;this.fillVAO=new f.VertexArrayObject(q,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:u},
G);this.outlineVAO=new f.VertexArrayObject(q,A.getAttributeLocations(),A.getLayoutInfo(),{geometry:D},y)}}class p extends r{constructor(q,u,v){super(q,u);this.type=e.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];u=new Uint32Array(q);const y=new Int32Array(q);q=new Float32Array(q);let D=this.bufferDataOffset;this.isIconSDF=!!u[D++];var G=u[D++],A=u[D++],
C=u[D++];G=new k(G,A,C,0);A=u[D++];for(C=0;C<A;C++){var E=u[D++],I=u[D++],H=u[D++];this.iconPerPageElementsMap.set(E,[I,H])}A=u[D++];for(C=0;C<A;C++)E=u[D++],I=u[D++],H=u[D++],this.glyphPerPageElementsMap.set(E,[I,H]);A=u[D++];C=u[D++];this.iconOpacity=new Int32Array(A);this.textOpacity=new Int32Array(C);this.bufferDataOffset=D=d.deserializeSymbols(u,y,q,D,this.symbols,v,G)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+n.estimateSize(this.iconOpacity)+
n.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let q=0;for(const [,u]of this.iconPerPageElementsMap)q+=u[1];for(const [,u]of this.glyphPerPageElementsMap)q+=u[1];return q/3}doDestroy(){this.iconVAO=b.disposeMaybe(this.iconVAO);this.textVAO=b.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var q=this.iconOpacity,u=this.iconVAO.vertexBuffers.opacity;0<q.length&&q.byteLength===
u.usedMemory&&u.setSubData(q,0,0,q.length);q=this.textOpacity;u=this.textVAO.vertexBuffers.opacity;0<q.length&&q.byteLength===u.usedMemory&&u.setSubData(q,0,0,q.length)}}doPrepareForRendering(q,u,v){var y=new Uint32Array(u),D=new Int32Array(y.buffer),G=y[v++];u=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*v,G));v+=G;var A=y[v++];G=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,A));v+=A;A=y[v++];D=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,
new Int32Array(D.buffer,4*v,A));v+=A;A=y[v++];y=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,A));v+=A;v=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,this.iconOpacity.buffer);A=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,this.textOpacity.buffer);var C=this.layer;const E=C.iconMaterial;C=C.textMaterial;this.iconVAO=new f.VertexArrayObject(q,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:u,opacity:v},G);this.textVAO=new f.VertexArrayObject(q,C.getAttributeLocations(),
C.getLayoutInfo(),{geometry:D,opacity:A},y)}}class t extends r{constructor(q,u){super(q,u);this.type=e.BucketType.CIRCLE;this.circleIndexCount=this.circleIndexStart=0;q=new Uint32Array(q);u=this.bufferDataOffset;this.circleIndexStart=q[u++];this.circleIndexCount=q[u++];this.bufferDataOffset=u}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=b.disposeMaybe(this.vao)}doPrepareForRendering(q,
u,v){var y=new Uint32Array(u);u=new Int32Array(y.buffer);var D=y[v++];u=c.BufferObject.createVertex(q,l.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*v,D));v+=D;D=y[v++];y=c.BufferObject.createIndex(q,l.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*v,D));v+=D;v=this.layer.circleMaterial;this.vao=new f.VertexArrayObject(q,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:u},y)}}a.CircleRenderBucket=t;a.FillRenderBucket=w;a.LineRenderBucket=x;a.RenderBucketBase=r;a.SymbolRenderBucket=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(a,b,n,h,k){const m=new h("0/0/0/0");class g{static create(c,l){c[1]>l[1]&&([c,l]=[l,c]);const [f,r]=c,[x,w]=l;c=x-f;l=w-r;l=0!==l?c/l:0;const p=(Math.ceil(r)-r)*l,t=(Math.floor(r)-r)*l;return new g(f,Math.floor(r),Math.ceil(w),l,0>c?p:t,0>c?t:p,0>c?x:f,0>c?f:x)}constructor(c,l,f,r,x,w,p,t){this.x=
c;this.ymin=l;this.ymax=f;this.invM=r;this.leftAdjust=x;this.rightAdjust=w;this.leftBound=p;this.rightBound=t}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const e=[[0,0],[0,0],[0,0],[0,0]];class d{constructor(c,l=null,f=c.lods[0].level,r=c.lods[c.lods.length-1].level){this.tileInfo=c;this.fullExtent=l;this.scales=[];this._infoByScale={};this._infoByLevel={};const x=c.lods.filter(p=>
p.level>=f&&p.level<=r);this.minScale=x[0].scale;this.maxScale=x[x.length-1].scale;const w=this._lodInfos=x.map(p=>b.create(c,p,l));x.forEach((p,t)=>{this._infoByLevel[p.level]=w[t];this._infoByScale[p.scale]=w[t];this.scales[t]=p.scale},this);this._wrap=c.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(c){return this._infoByLevel["number"===typeof c?c:c.level]}getTileBounds(c,l,f=!1){m.set(l);return(l=this._infoByLevel[m.level])?l.getTileBounds(c,m,f):c}getTileCoords(c,
l,f=!1){m.set(l);return(l=this._infoByLevel[m.level])?l.getTileCoords(c,m,f):c}getTileCoverage(c,l=192,f=!0,r="closest"){if(!f&&(c.scale>this.minScale||c.scale<this.maxScale))return null;f="closest"===r?this.getClosestInfoForScale(c.scale):this.getSmallestInfoForScale(c.scale);r=n.pool.acquire(f);const x=this._wrap;var w=Infinity;let p=-Infinity;const t=r.spans;e[0][0]=e[0][1]=e[1][1]=e[3][0]=-l;e[1][0]=e[2][0]=c.size[0]+l;e[2][1]=e[3][1]=c.size[1]+l;for(q of e)c.toMap(q,q),q[0]=f.getColumnForX(q[0]),
q[1]=f.getRowForY(q[1]);c=[];var q=3;for(l=0;4>l;l++)e[l][1]===e[q][1]?q=l:(q=g.create(e[l],e[q]),w=Math.min(q.ymin,w),p=Math.max(q.ymax,p),void 0===c[q.ymin]&&(c[q.ymin]=[]),c[q.ymin].push(q),q=l);if(null==w||null==p||100<p-w)return null;for(l=[];w<p;){null!=c[w]&&(l=l.concat(c[w]));q=Infinity;var u=-Infinity;for(var v=l.length-1;0<=v;v--){var y=l[v];q=Math.min(q,y.getLeftCol());u=Math.max(u,y.getRightCol())}q=Math.floor(q);u=Math.floor(u);if(w>=f.first[1]&&w<=f.last[1])if(x)if(f.size[0]<f.worldSize[0])for(v=
Math.floor(u/f.worldSize[0]),y=Math.floor(q/f.worldSize[0]);y<=v;y++)t.push(new k(w,Math.max(f.getFirstColumnForWorld(y),q),Math.min(f.getLastColumnForWorld(y),u)));else t.push(new k(w,q,u));else q>f.last[0]||u<f.first[0]||(q=Math.max(q,f.first[0]),u=Math.min(u,f.last[0]),t.push(new k(w,q,u)));w+=1;for(q=l.length-1;0<=q;q--)u=l[q],u.ymax>=w?u.incrRow():l.splice(q,1)}return r}getTileParentId(c){m.set(c);c=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>c)return null;this._getTileIdAtLOD(m,
this._lodInfos[c],m);return m.id}getTileResolution(c){return(c=this._infoByLevel["object"===typeof c?c.level:c])?c.resolution:-1}getTileScale(c){return(c=this._infoByLevel[c.level])?c.scale:-1}intersects(c,l){m.set(l);l=this._infoByLevel[m.level];const f=c.lodInfo;if(f.resolution>l.resolution){this._getTileIdAtLOD(m,f,m);var r=f.denormalizeCol(m.col,m.world);for(var x of c.spans)if(x.row===m.row&&x.colFrom<=r&&x.colTo>=r)return!0}if(f.resolution<l.resolution){const [p,t,q,u]=c.spans.reduce((v,y)=>
{v[0]=Math.min(v[0],y.row);v[1]=Math.max(v[1],y.row);v[2]=Math.min(v[2],y.colFrom);v[3]=Math.max(v[3],y.colTo);return v},[Infinity,-Infinity,Infinity,-Infinity]);r=l.denormalizeCol(m.col,m.world);c=f.getColumnForX(l.getXForColumn(r));x=f.getRowForY(l.getYForRow(m.row));r=f.getColumnForX(l.getXForColumn(r+1))-1;l=f.getRowForY(l.getYForRow(m.row+1))-1;return!(c>u||r<q||x>t||l<p)}const w=f.denormalizeCol(m.col,m.world);return c.spans.some(p=>p.row===m.row&&p.colFrom<=w&&p.colTo>=w)}normalizeBounds(c,
l,f){c[0]=l[0];c[1]=l[1];c[2]=l[2];c[3]=l[3];this._wrap&&(l=a.getInfo(this.tileInfo.spatialReference),f=-f*(l.valid[1]-l.valid[0]),c[0]+=f,c[2]+=f);return c}getSmallestInfoForScale(c){const l=this.scales;if(this._infoByScale[c])return this._infoByScale[c];if(c>l[0])return this._infoByScale[l[0]];for(let f=1;f<l.length-1;f++)if(c>l[f]+1E-6)return this._infoByScale[l[f-1]];return this._infoByScale[l[l.length-1]]}getClosestInfoForScale(c){const l=this.scales;if(this._infoByScale[c])return this._infoByScale[c];
c=l.reduce((f,r)=>Math.abs(r-c)<Math.abs(f-c)?r:f,l[0]);return this._infoByScale[c]}scaleToLevel(c){const l=this.scales;if(this._infoByScale[c])return this._infoByScale[c].level;for(let f=l.length-1;0<=f;f--)if(c<l[f])return f===l.length-1?this._infoByScale[l[l.length-1]].level:this._infoByScale[l[f]].level+(l[f]-c)/(l[f]-l[f+1]);return this._infoByScale[l[0]].level}scaleToZoom(c){return this.tileInfo.scaleToZoom(c)}_getTileIdAtLOD(c,l,f){const r=this._infoByLevel[f.level];c.set(f);if(l.resolution<
r.resolution)return null;if(l.resolution===r.resolution)return c;c.level=l.level;c.col=Math.floor(f.col*r.resolution/l.resolution+.01);c.row=Math.floor(f.row*r.resolution/l.resolution+.01);return c}}return d})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(a,b){function n(m,g,e){m[0]=g;m[1]=e;return m}const h=new b("0/0/0/0");class k{static create(m,g,e=null){var d=a.getInfo(m.spatialReference);const c=g.origin||[m.origin.x,
m.origin.y],l=[m.size[0]*g.resolution,m.size[1]*g.resolution],f=[-Infinity,-Infinity],r=[Infinity,Infinity],x=[Infinity,Infinity];null!=e&&(n(f,Math.max(0,Math.floor((e.xmin-c[0])/l[0])),Math.max(0,Math.floor((c[1]-e.ymax)/l[1]))),n(r,Math.max(0,Math.floor((e.xmax-c[0])/l[0])),Math.max(0,Math.floor((c[1]-e.ymin)/l[1]))),n(x,r[0]-f[0]+1,r[1]-f[1]+1));const {cols:w,rows:p}=g;!e&&w&&p&&(n(f,w[0],p[0]),n(r,w[1],p[1]),n(x,w[1]-w[0]+1,p[1]-p[0]+1));let t;m.isWrappable?(m=[Math.ceil(Math.round((d.valid[1]-
d.valid[0])/g.resolution)/m.size[0]),x[1]],d=[Math.floor((d.origin[0]-c[0])/l[0]),f[1]],e=[m[0]+d[0]-1,r[1]],t=!0):(d=f,e=r,m=x,t=!1);return new k(g.level,g.resolution,g.scale,c,f,r,x,l,d,e,m,t)}constructor(m,g,e,d,c,l,f,r,x,w,p,t){this.level=m;this.resolution=g;this.scale=e;this.origin=d;this.first=c;this.last=l;this.size=f;this.norm=r;this.worldStart=x;this.worldEnd=w;this.worldSize=p;this.wrap=t}normalizeCol(m){if(!this.wrap)return m;const g=this.worldSize[0];return 0>m?g-1-Math.abs((m+1)%g):m%
g}denormalizeCol(m,g){return this.wrap?this.worldSize[0]*g+m:m}getWorldForColumn(m){return this.wrap?Math.floor(m/this.worldSize[0]):0}getFirstColumnForWorld(m){return m*this.worldSize[0]+this.first[0]}getLastColumnForWorld(m){return m*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(m){return(m-this.origin[0])/this.norm[0]}getXForColumn(m){return this.origin[0]+m*this.norm[0]}getRowForY(m){return(this.origin[1]-m)/this.norm[1]}getYForRow(m){return this.origin[1]-m*this.norm[1]}getTileBounds(m,
g,e=!1){h.set(g);var d=e?h.col:this.denormalizeCol(h.col,h.world),c=h.row;g=this.getXForColumn(d);e=this.getYForRow(c+1);d=this.getXForColumn(d+1);c=this.getYForRow(c);m[0]=g;m[1]=e;m[2]=d;m[3]=c;return m}getTileCoords(m,g,e=!1){h.set(g);g=e?h.col:this.denormalizeCol(h.col,h.world);Array.isArray(m)?n(m,this.getXForColumn(g),this.getYForRow(h.row)):(m.x=this.getXForColumn(g),m.y=this.getYForRow(h.row));return m}}return k})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],
function(a){class b{static getId(n,h,k,m){return"object"===typeof n?`${n.level}/${n.row}/${n.col}/${n.world}`:`${n}/${h}/${k}/${m}`}constructor(n,h,k,m){this.set(n,h,k,m)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(n){this.set(n)}get hash(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}acquire(n,h,k,m){this.set(n,h,k,m)}contains(n){const h=n.level-this.level;return 0<=h&&this.row===n.row>>
h&&this.col===n.col>>h&&this.world===n.world}containsChild(n){const h=n.level-this.level;return 0<h&&this.row===n.row>>h&&this.col===n.col>>h&&this.world===n.world}equals(n){return this.level===n.level&&this.row===n.row&&this.col===n.col&&this.world===n.world}clone(){return new b(this)}release(){this.world=this.col=this.row=this.level=0}set(n,h,k,m){if(null==n)this.world=this.col=this.row=this.level=0;else if("object"===typeof n)this.level=n.level||0,this.row=n.row||0,this.col=n.col||0,this.world=
n.world||0;else if("string"===typeof n){const [g,e,d,c]=n.split("/");this.level=parseFloat(g);this.row=parseFloat(e);this.col=parseFloat(d);this.world=parseFloat(c)}else this.level=+n,this.row=+h,this.col=+k,this.world=+m||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return 0>=this.level?null:new b(this.level-1,this.row>>1,this.col>>1,this.world)}getNeighborId(n,h){return`${this.level}/${this.row+h}/${this.col+n}/${this.world}`}getChildKeys(){const n=
this.level+1,h=this.row<<1,k=this.col<<1,m=this.world;return[new b(n,h,k,m),new b(n,h,k+1,m),new b(n,h+1,k,m),new b(n,h+1,k+1,m)]}compareRowMajor(n){return this.row<n.row?-1:this.row>n.row?1:this.col<n.col?-1:this.col>n.col?1:0}}b.pool=new a(b,null,null,25,50);return b})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool","./TileKey"],function(a,b){class n{constructor(){this.spans=[]}acquire(h){this.lodInfo=h}release(){this.lodInfo=null;this.spans.length=0}*keys(){const h=
this.lodInfo;for(const {row:k,colFrom:m,colTo:g}of this.spans)for(let e=m;e<=g;e++){const d=h.getWorldForColumn(e);yield new b(h.level,k,h.normalizeCol(e),d)}}forEach(h,k){const {spans:m,lodInfo:g}=this,{level:e}=g;if(0!==m.length)for(const {row:d,colFrom:c,colTo:l}of m)for(let f=c;f<=l;f++)h.call(k,e,d,g.normalizeCol(f),g.getWorldForColumn(f))}}n.pool=new a(n);return n})},"esri/views/2d/tiling/TileSpan":function(){define(function(){class a{constructor(b,n,h){this.row=b;this.colFrom=n;this.colTo=
h}}return a})},"esri/views/2d/tiling/TileQueue":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../support/QueueProcessor".split(" "),function(a,b,n,h,k,m,g,e,d,c){function l(p,t){p.length=0;t.forEach(q=>p.push(q));return p}const f=new Set,r=[],x=new Map,
w=[0,0];b=class extends b{constructor(p){super(p);this._keyToItem=new Map;this.concurrency=6;this.strategy="scale-first";this.tileInfoView=null}initialize(){const {concurrency:p,process:t,strategy:q}=this;this._queue=new c.QueueProcessor({concurrency:p,process:(u,v)=>{u=this._keyToItem.get(u);return t(u,{signal:v})},peeker:"scale-first"===q?u=>this._peekByScaleFirst(u):u=>this._peekByCenterFirst(u)})}destroy(){this.clear();this._queue=n.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:
0}get onGoingCount(){return this._keyToItem.size}abort(p){this._queue.abort("string"===typeof p?p:p.id)}clear(){this._queue.clear();this._keyToItem.clear()}has(p){return"string"===typeof p?this._keyToItem.has(p):this._keyToItem.has(p.id)}isOngoing(p){p="string"===typeof p?p:p.id;return this.has(p)&&this._queue.isOngoing(p)}pause(){this._queue.pause()}push(p){const t=p.key.id;if(this._queue.has(t))return this._queue.get(t);const q=this._queue.push(t),u=()=>{this._keyToItem.delete(t)};this._keyToItem.set(t,
p);q.then(u,u);return q}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(p){if(!this.state)return p.values().next().value;const t=this.tileInfoView;let q=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;p.forEach(A=>{A=this._keyToItem.get(A);const C=this.tileInfoView.getTileScale(A.key);x.has(C)||(x.set(C,[]),q=Math.max(C,q),u=Math.min(C,u));x.get(C).push(A.key);f.add(C)});let v=this.state.scale;x.has(v)||(l(r,f),r.sort((A,C)=>A-C),v=r.reduce((A,C)=>Math.abs(C-v)<Math.abs(A-
v)?C:A,r[0]));v=Math.min(v,q);v=Math.max(v,u);p=x.get(v);const y=t.getClosestInfoForScale(v),D=y.getColumnForX(this.state.center[0]),G=y.getRowForY(this.state.center[1]);p.sort((A,C)=>{const E=y.denormalizeCol(A.col,A.world),I=y.denormalizeCol(C.col,C.world);return Math.sqrt((D-E)*(D-E)+(G-A.row)*(G-A.row))-Math.sqrt((D-I)*(D-I)+(G-C.row)*(G-C.row))});f.clear();x.clear();return p[0].id}_peekByCenterFirst(p){if(!this.state)return p.values().next().value;const t=this.tileInfoView,q=this.state.center;
let u=Number.POSITIVE_INFINITY,v;p.forEach(y=>{y=this._keyToItem.get(y);t.getTileCoords(w,y.key);const D=d.distance(w,q);D<u&&(u=D,v=y.key)});return v.id}};a.__decorate([h.property({constructOnly:!0})],b.prototype,"concurrency",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"process",void 0);a.__decorate([h.property()],b.prototype,"state",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,"strategy",void 0);a.__decorate([h.property({constructOnly:!0})],b.prototype,
"tileInfoView",void 0);return b=a.__decorate([e.subclass("esri.views.2d.tiling.TileQueue")],b)})},"esri/views/support/QueueProcessor":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/ReactiveMap ../../core/scheduling ../../core/signal".split(" "),function(a,b,n,h,k,m,g){class e{constructor(c,l){this.item=c;this.controller=l;this.promise=null}}class d{constructor(c){this._task=this._schedule=null;this._deferreds=new k;this._controllers=new k;this._processingItems=
new k;this._pausedSignal=g.signal(!1);this.concurrency=1;c.concurrency&&(this.concurrency=c.concurrency);this._queue=new h(c.peeker);this.process=c.process;const l=c.scheduler;c.priority&&l&&(this._task=l.registerTask(c.priority,this))}destroy(){this.clear();this._schedule=b.removeMaybe(this._schedule);this._task=b.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.running}get length(){return this._processingItems.size+this._queue.length}abort(c){(c=this._controllers.get(c))&&
c.abort()}clear(){this._queue.clear();const c=[];this._controllers.forEach(l=>c.push(l));this._controllers.clear();c.forEach(l=>l.abort());this._processingItems.clear();this._cancelNext()}forEach(c){this._deferreds.forEach((l,f)=>c(f))}get(c){return(c=this._deferreds.get(c))?c.promise:void 0}isOngoing(c){return this._processingItems.has(c)}has(c){return this._deferreds.has(c)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(c,l){const f=this.get(c);if(f)return f;
const r=new AbortController;let x=null;l&&(x=n.onAbort(l,()=>r.abort()));const w=()=>{p.remove();null!=x&&x.remove();this._removeItem(c);this._queue.remove(c);this._scheduleNext()},p=n.onAbortOrThrow(r.signal,()=>{const q=this._processingItems.get(c);q&&q.controller.abort();w();t.reject(n.createAbortError())}),t=n.createResolver();this._deferreds.set(c,t);this._controllers.set(c,r);t.promise.then(w,w);this._queue.push(c);this._scheduleNext();return t.promise}last(){return this._queue.last()}lastPromise(){const c=
this.last();return c?this.get(c):null}peek(){return this._queue.peek()}popLast(){const c=this._queue.popLast();c&&(this._deferreds.get(c)?.reject(n.createAbortError("Removed from queue")),this._removeItem(c));return c}reset(){const c=[];this._processingItems.forEach(l=>c.push(l));this._processingItems.clear();for(const l of c)this._queue.push(l.item),l.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const c=[];
for(;this._queue.length;)c.push(this._queue.pop());this.clear();return c}get running(){return!this._pausedSignal.value&&0<this._queue.length&&this._processingItems.size<this.concurrency}runTask(c){for(;!c.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),c.madeProgress()}_removeItem(c){this._deferreds.delete(c);this._controllers.delete(c);this._processingItems.delete(c)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=
m.schedule(()=>{this._schedule=null;this._next()}))}_next(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(c,l){this._canProcessFulfillment(c)&&(this._scheduleNext(),this._deferreds.get(c.item).resolve(l))}_processError(c,l){this._canProcessFulfillment(c)&&(this._scheduleNext(),this._deferreds.get(c.item).reject(l))}_canProcessFulfillment(c){return this._deferreds.get(c.item)&&
this._processingItems.get(c.item)===c?!0:!1}_process(c){if(null!=c){var l=new AbortController,f=new e(c,l);this._processingItems.set(c,f);try{var r=this.process(c,l.signal)}catch(x){this._processError(f,x)}n.isPromiseLike(r)?(f.promise=r,r.then(x=>this._processResult(f,x),x=>this._processError(f,x))):this._processResult(f,r)}}get test(){return{update:c=>this.runTask(c)}}}a.QueueProcessor=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect",
"./TileCache","./TileCoverage","./TileKey"],function(a,b,n,h){const k=new h(0,0,0,0),m=new Map,g=[],e=[];class d{constructor(c){this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=c.acquireTile;this.releaseTile=c.releaseTile;this.tileInfoView=c.tileInfoView;null!=c.resampling&&(this.resampling=c.resampling);c.cachePolicy&&(this.cachePolicy=c.cachePolicy);c.coveragePolicy&&
(this.coveragePolicy=c.coveragePolicy);null!=c.buffer&&(this.buffer=c.buffer);c.cacheSize&&(this._tileCache=new b(c.cacheSize,this.tileInfoView,l=>{this.releaseTile(l)}))}destroy(){this.tileIndex.clear()}update(c){const {resampling:l,tileIndex:f}=this,{scale:r,center:x,resolution:w}=c.state,{minScale:p,maxScale:t}=this.tileInfoView,q=!c.stationary&&r>this._previousScale;this._previousScale=r;if(!l&&(r>p||r<t))this.tiles.length=0,this.clear();else if(c=this.tileInfoView.getTileCoverage(c.state,this.buffer,
this.resampling,this.coveragePolicy)){var {spans:u,lodInfo:v}=c,{level:y}=v;this.tiles.length=0;f.forEach(C=>C.visible=!0);var D=0,G=0;if(0<u.length)for(const {row:C,colFrom:E,colTo:I}of u)for(var A=E;A<=I;A++){D++;const H=k.set(y,C,v.normalizeCol(A),v.getWorldForColumn(A)).id;let J=f.get(H);if(J)J.isReady?(m.set(H,J),G++):q||this._addParentTile(H,m);else{if(this._tileCache?.has(H)){if(J=this._tileCache.pop(H),this.tileIndex.set(H,J),J.isReady){m.set(H,J);G++;continue}}else J=this.acquireTile(k),
this.tileIndex.set(H,J);q||this._addParentTile(H,m)}}D=G===D;for(const [C,E]of f)m.has(C)||(k.set(C),G=this.tileInfoView.intersects(c,k),A="purge"===this.cachePolicy?k.level!==y:k.level>y,!G||!q&&D?!A&&G||g.push(E):E.isReady?A&&"purge"===this.cachePolicy&&this._hasReadyAncestor(k,y)?g.push(E):e.push(E):A&&g.push(E));for(const C of e)C.isReady&&m.set(C.key.id,C);for(const C of g)this._tileCache?this._tileCache.add(C):this.releaseTile(C),f.delete(C.key.id);for(const C of m.values())this.tiles.push(C);
for(const C of f.values())m.has(C.key.id)||(C.visible=!1);this._tileCache?.prune(y,x,w);n.pool.release(c);e.length=0;g.length=0;m.clear()}else this.tiles.length=0,this.clear()}clear(){const {tileIndex:c}=this;for(const l of c.values())this.releaseTile(l);c.clear()}refresh(c){for(const l of this.tileIndex.values())this.tiles.includes(l)?c(l):g.push(l);for(const l of g)this.releaseTile(l),this.tileIndex.delete(l.key.id);this._tileCache?.clear()}updateCacheSize(c){this._tileCache&&(this._tileCache.maxSize=
c)}_addParentTile(c,l){let f=null;for(;;){c=this.tileInfoView.getTileParentId(c);if(!c)break;if(this.tileIndex.has(c)){if(f=this.tileIndex.get(c),f?.isReady){l.has(f.key.id)||l.set(f.key.id,f);break}}else if(this._tileCache?.has(c)&&(f=this._tileCache.pop(c),this.tileIndex.set(c,f),f?.isReady)){l.has(f.key.id)||l.set(f.key.id,f);break}}}_hasReadyAncestor(c,l){const f=a.create();this.tileInfoView.getTileBounds(f,c,!0);for(const r of this.tileIndex.values())if(r.isReady&&r.key.level>=l&&r.key.level<
c.level){const x=a.create();this.tileInfoView.getTileBounds(x,r.key,!0);if(a.contains(x,f))return!0}return!1}}return d})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(a){class b{constructor(n,h,k){this.maxSize=n;this._tileInfoView=h;this._removedFunc=k;this._tilePerId=new Map;this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear();this._tileKeysPerLevel=[]}has(n){return this._tilePerId.has(n)}get(n){return this._tilePerId.get(n)}pop(n){const h=
this._tilePerId.get(n);if(h){var k=this._tileKeysPerLevel[h.key.level];this._tilePerId["delete"](n);for(let m=0;m<k.length;m++)if(k[m].id===n){k.splice(m,1);break}h.visible=!0;return h}}add(n){n.visible=!1;const h=n.key,k=h.id;this._tilePerId.has(k)||(this._tilePerId.set(k,n),n=h.level,this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(h))}prune(n,h,k){let m=this._tilePerId.size;if(!(m<=this.maxSize)){for(var g=this._tileKeysPerLevel.length-1;m>this.maxSize&&
0<=g;)g!==n&&(m=this._pruneAroundCenterTile(m,h,k,g)),g--;m>this.maxSize&&(m=this._pruneAroundCenterTile(m,h,k,n))}}_pruneAroundCenterTile(n,h,k,m){m=this._tileKeysPerLevel[m];if(!m||0===m.length)return n;const {size:g,origin:e}=this._tileInfoView.tileInfo,d=k*g[0],c=k*g[1],l=[0,0],f=[0,0];for(m.sort((r,x)=>{l[0]=e.x+d*(r.col+.5);l[1]=e.y-c*(r.row+.5);f[0]=e.x+d*(x.col+.5);f[1]=e.y-c*(x.row+.5);return a.squaredDistance(l,h)-a.squaredDistance(f,h)});0<m.length&&(k=m.pop(),this._removeTile(k.id),n--,
n!==this.maxSize););return n}_removeTile(n){const h=this._tilePerId.get(n);this._removedFunc&&h&&this._removedFunc(h);this._tilePerId["delete"](n)}}return b})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../enums","../GeometryUtils","./core"],function(a,b,n,h){class k{constructor(m,g,e){this._rows=Math.ceil(g/e);this._columns=Math.ceil(m/e);this._cellSize=e;this.cells=Array(this._rows);for(m=0;m<this._rows;m++)for(this.cells[m]=Array(this._columns),g=0;g<this._columns;g++)this.cells[m][g]=
[]}getCell(m,g){g=Math.min(Math.max(Math.floor(g/this._cellSize),0),this._rows-1);m=Math.min(Math.max(Math.floor(m/this._cellSize),0),this._columns-1);return this.cells[g]&&this.cells[g][m]||null}getCellSpan(m,g,e,d){return[Math.min(Math.max(Math.floor(m/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(d/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}
a.GridIndex=k;a.deserializeSymbols=function(m,g,e,d,c,l,f){const r=g[d++];for(let p=0;p<r;p++){const t=new h.VTLSymbol(l,f);t.xTile=g[d++];t.yTile=g[d++];t.hash=g[d++];t.priority=g[d++];t.featureIndex=g[d++];var x=g[d++];for(var w=0;w<x;w++){const q=g[d++],u=g[d++],v=g[d++],y=g[d++],D=!!g[d++],G=g[d++],A=e[d++],C=e[d++],E=g[d++],I=g[d++];t.colliders.push({xTile:q,yTile:u,dxPixels:v,dyPixels:y,hard:D,partIndex:G,width:E,height:I,minLod:A,maxLod:C})}x=m[d++];for(w=0;w<x;w++)t.textVertexRanges.push([m[d++],
m[d++]]);x=m[d++];for(w=0;w<x;w++)t.iconVertexRanges.push([m[d++],m[d++]]);c.push(t)}return d};a.isSearchCircleOverlapingSymbol=function(m,g,e,d){var c=m.colliders;let l,f,r;for(const x of c)if(m.unique.show&&m.unique.parts[x.partIndex].show&&(c=x.xScreen-d[0]+x.dxScreen,l=x.yScreen-d[1]+x.dyScreen,f=c+x.width,r=l+x.height,n.isCircleOverlapingRect(e,g.x,g.y,c,l,f,r)))return!0;return!1};a.tileCoordChange=function(m,g,e,d,c,l){e-=c;if(0<=e)return(g>>e)+(d-(l<<e))*(m>>e);e=-e;return g-(l-(d<<e))*(m>>
e)<<e};a.writeOpacityToBuffers=function(m,g,e){for(const [w,p]of m.symbols){{var d=m,c=g,l=e,f=p;const t=d.layerData.get(w);if(t.type===b.BucketType.SYMBOL){for(const q of f){f=q.unique;var r=void 0;if(q.selectedForRendering){var x=f.parts[0];r=x.startOpacity;x=x.targetOpacity;d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===x;r=l?Math.floor(127*r)|x<<7:x?255:0;r|=r<<24|r<<16|r<<8}else r=0;for(const [u,v]of q.iconVertexRanges)for(x=u;x<u+v;x+=4)t.iconOpacity[x/4]=r;q.selectedForRendering?(r=f.parts[1],
f=r.startOpacity,r=r.targetOpacity,d.allSymbolsFadingOut=d.allSymbolsFadingOut&&0===r,f=l?Math.floor(127*f)|r<<7:r?255:0,r=f<<24|f<<16|f<<8|f):r=0;for(const [u,v]of q.textVertexRanges)for(f=u;f<u+v;f+=4)t.textOpacity[f/4]=r}t.lastOpacityUpdate=c;t.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){class b{constructor(h,k){this.sourceTile=k;this.hash=this.yTile=this.xTile=
0;this.priority=1;this.featureIndex=0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=h}}class n{constructor(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}a.VTLSymbol=b;a.VTLUniqueSymbol=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.collisionGridCellSize=
32;a.declutterBudget=1.5;a.declutterTiles=!0;a.fadeDuration=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,n,h){class k extends n.DisplayObject{constructor(m,g,e,d,c,l,f=c,r=l){super();this.tileDebugInfoTexture=null;this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},
memory:{bytesUsed:0,bytesReserved:0}};this._destroyed=!1;this.key=new h(m);this.resolution=g;this.x=e;this.y=d;this.width=c;this.height=l;this.rangeX=f;this.rangeY=r}destroy(){this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null);this._destroyed=!0}get debugSlot(){let m=this;for(;m.parent!==this._stage;){if(!m.parent)return 0;m=m.parent}return this._stage.children.indexOf(m)}setTransform(m){const g=this.resolution/(m.resolution*m.pixelRatio),e=this.transforms.tileMat3,
[d,c]=m.toScreenNoRotation([0,0],[this.x,this.y]);b.set(e,this.width/this.rangeX*g,0,0,0,this.height/this.rangeY*g,0,d,c,1);b.multiply(this.transforms.displayViewScreenMat3,m.displayViewMat3,e)}get destroyed(){return this._destroyed}}a.TiledDisplayObject=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/Evented","../../../core/has","../../../core/promiseUtils"],function(a,b,n,h){const k=0===n("mapview-transitions-duration")?
0:1/n("mapview-transitions-duration");class m extends b{constructor(){super(...arguments);this._clips=this._fadeInResolver=this._fadeOutResolver=null;this.computedVisible=!0;this.computedOpacity=1;this._isReady=this.inFadeTransition=this.fadeTransitionEnabled=!1;this._opacity=1;this._stage=this.parent=null;this._visible=!0}get clips(){return this._clips}set clips(g){this._clips=g;this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(g){this._opacity!==
g&&(this._opacity=Math.min(1,Math.max(g,0)),this.requestRender())}get stage(){return this._stage}set stage(g){if(this._stage!==g){var e=this._stage;(this._stage=g)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e?.trashDisplayObject(this)}}get transforms(){return this._getTransforms()}_getTransforms(){null==this._transforms&&(this._transforms=this._createTransforms());return this._transforms}get visible(){return this._visible}set visible(g){this._visible!==g&&(this._visible=
g,this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}fadeIn(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=h.createResolver();this.requestRender();return this._fadeInResolver.promise}fadeOut(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;
this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=h.createResolver();this.requestRender();return this._fadeOutResolver.promise}endTransitions(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()}beforeRender(g){this.updateTransitionProperties(g.deltaTime,g.state.scale);this.setTransform(g.state)}afterRender(g){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){this.parent?.removeChild(this)}setTransform(g){}processRender(g){this.stage&&this.computedVisible&&this.doRender(g)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),
this._fadeOutResolver=null);this.onDetach();this.emit("detach")}updateTransitionProperties(g,e){if(this.fadeTransitionEnabled&&0!==k){e=this._fadeOutResolver||!this.visible?0:this.opacity;const d=this.computedOpacity;d===e?this.computedVisible=this.visible:(g*=k,this.computedOpacity=d>e?Math.max(e,d-g):Math.min(e,d+g),this.computedVisible=0<this.computedOpacity,g=e===this.computedOpacity,this.inFadeTransition=!g,g||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=
this.visible}onAttach(){}onDetach(){}doRender(g){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}a.DisplayObject=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ElevationUpdateEvent":function(){define(["exports","../../../geometry/support/aaBoundingRect"],function(a,b){class n{constructor(h="scene"){this.context=h;this.extent=b.empty()}}a.ElevationUpdateEvent=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){class b{constructor(n=0,h=0){this.min=n;this.max=h;this.level=0;this.hasNoDataValues=!1}copyFrom(n){this.min=n.min;this.max=
n.max;this.level=n.level;this.hasNoDataValues=n.hasNoDataValues}}a.ElevationBounds=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../layers/support/ElevationSamplerData","../support/mathUtils","./TerrainConst"],function(a,b,n,h,k){class m{constructor(e,d,c){this.type="elevation";this.level=e[0];this.i=e[1];this.j=e[2];this.extent=d;this.samplerData=new n.ElevationSamplerData(c,d)}computeMinMaxValue(e,
d,c,l){l.min=Infinity;l.max=-Infinity;l.hasNoDataValues=!1;e-=this.level;if(0>=e)return l;var f=2**e;if(Math.floor(d/f)!==this.i||Math.floor(c/f)!==this.j)return l;var r=Infinity,x=-Infinity,w=this.samplerData.data.width,p=this.samplerData.data.values,t=.5*k.elevationNodataValue;e=(w-1)/f;c=(c-this.j*f)*e;let q=(d-this.i*f)*e;if(1>e){const y=Math.floor(c),D=Math.floor(q);var u=y+D*w;d=p[u];f=p[u+1];var v=p[u+w];u=p[u+w+1];if(d+f+v+u<t)return r=c-y,t=q-D,x=h.bilerp(d,f,v,u,r,t),w=h.bilerp(d,f,v,u,
r+e,t),p=h.bilerp(d,f,v,u,r,t+e),e=h.bilerp(d,f,v,u,r+e,t+e),l.min=Math.min(x,w,p,e),l.max=Math.max(x,w,p,e),l;c=y;q=D;e=1}else c=Math.floor(c),q=Math.floor(q),e=Math.ceil(e);for(d=c;d<=c+e;d++)for(f=q;f<=q+e;f++)v=p[d+f*w],v<t?(r=Math.min(r,v),x=Math.max(x,v)):l.hasNoDataValues=!0;l.min=r;l.max=x;return l}}const g=.5*k.elevationNodataValue;a.ElevationData=m;a.sampleElevation=function(e,d,c){if(null==c)return null;for(const w of c){if(!w)continue;var l=w.safeWidth;c=b.clamp(w.dy*(w.y1-d),0,l);l=b.clamp(w.dx*
(e-w.x0),0,l);const p=Math.floor(c),t=Math.floor(l);var f=w.data.width,r=p*f+t,x=w.data.values;const q=x[r],u=x[r+1];r+=f;f=x[r];x=x[r+1];if(q+f+u+x<g)return c-=p,l-=t,e=q+(u-q)*l,e+(f+(x-f)*l-e)*c}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){class b{constructor(n,h){this.data=n;this.safeWidth=.99999999*(n.width-1);this.dx=(n.width-1)/(h[2]-h[0]);this.dy=(n.width-1)/(h[3]-h[1]);this.x0=
h[0];this.y1=h[3]}}a.ElevationSamplerData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(q,u){return null==q||q.spatialReference.equals(u)?q:d.projectWithoutEngine(q,q.spatialReference,u)}a.ExtentHelper=class extends n{constructor(q){super(q)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const q=
[];this.layerViews.forEach(u=>{u=u.layer;l.isIntegratedMeshOperationalLayer(u.operationalLayerType)&&null!=this.viewSpatialReference&&(u=w(u.fullExtent,this.viewSpatialReference),null!=u&&q.push(c.fromExtent(u)))});return q}};b.__decorate([h.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([h.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([h.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);
b.__decorate([h.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([h.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([h.property()],a.ExtentHelper.prototype,"defaultTiledLayersExtent",void 0);b.__decorate([h.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([h.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelper")],
a.ExtentHelper);let p=class extends a.ExtentHelper{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?r.webmercatorWorldExtent:r.geographicWorldExtent}};p=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],p);let t=class extends a.ExtentHelper{_computeLayerViewsExtent(){const q=c.empty(),u=this.viewSpatialReference;this.layerViews.forEach(D=>{const G=D.layer;
!D.isResolved()||"graphics"===G.type&&G.internal||(D=w("fullExtentInLocalViewSpatialReference"in D&&D.fullExtentInLocalViewSpatialReference||D.layer.fullExtent,u),c.expand(q,D,q))});const v=c.allFinite(q)?q:null,y=this._get("layerViewsExtent");return c.equals(v,y)?y:v}_computeTiledLayersExtent(){const q=this.tilingScheme;if(!q)return null;const u=this.viewSpatialReference,v=c.empty();this.layers.forEach(G=>{if(G.loaded&&l.isTiledLayer(G)){const E=x.getTiledLayerInfo(G,u,f.ViewingMode.Local);if(null!=
E){var {tileInfo:A,fullExtent:C}=E;null!=A&&null!=C&&(x.isProjectableRasterLayer(G)||q.compatibleWith(A)&&C.spatialReference.equals(q.spatialReference))&&c.expand(v,C,v)}}});c.expand(v,this.defaultTiledLayersExtent,v);const y=c.allFinite(v)?v:null,D=this._get("tiledLayersExtent");return c.equals(y,D)?D:y}};t=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperLocal")],t);a.create=function(q,u){return q===f.ViewingMode.Global?new p(u):new t(u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./ITile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),function(a,b,n,h,k,m,g,e,d){function c(G){return"imagery-tile"===G?.type||"wcs"===G?.type}function l(G){return"imagery-tile-3d"===G?.type}function f(G){return"tile-3d"===G?.type}function r(G){return"vector-tile-3d"===
G?.type}function x(G){return"wmts-3d"===G?.type}function w(G){return"elevation-3d"===G?.type}function p(G){return G&&(f(G)||l(G)||r(G)||x(G))}function t(G){return null!=G?.data&&"type"in G.data&&"vector-tile"===G.data.type}function q(G,A,C,E){return y[E].checkIfTileInfoSupportedForViewSR(G,C,A)}function u(G,A,C){G=h.getTileMaxtrixSetFromActiveLayer(G);if(null!=G)if(b.isCollection(G)){if(G=G.find(E=>null==q(E.tileInfo,E.fullExtent,A,C)))return{tileInfo:G.tileInfo,fullExtent:G.fullExtent}}else return{tileInfo:G.tileInfo,
fullExtent:G.fullExtent};return{tileInfo:null,fullExtent:null}}function v(G){return G.isWGS84||G.isWebMercator||n.isCGCS2000(G)||!n.isEarth(G)}const y={[k.ViewingMode.Global]:d.terrainUtilsSpherical,[k.ViewingMode.Local]:e.terrainUtilsPlanar};a.enableTerrainInternalChecks=!1;a.enableWaterproofnessTests=!1;const D={force512VTL:!1};e=[g.NeighborIndex.NORTH,g.NeighborIndex.EAST,g.NeighborIndex.SOUTH,g.NeighborIndex.WEST];d=[g.NeighborIndex.NORTH_EAST,g.NeighborIndex.SOUTH_EAST,g.NeighborIndex.SOUTH_WEST,
g.NeighborIndex.NORTH_WEST];a.almostEquals=function(G,A,C=1E-5){return Math.abs(G-A)<C};a.checkIfTileInfoSupportedForView=q;a.enableInternalTerrainChecks=function(G){a.enableTerrainInternalChecks=G};a.enableTerrainWaterproofnessChecks=function(G){a.enableWaterproofnessTests=G;a.enableTerrainInternalChecks=a.enableTerrainInternalChecks||G};a.eps=1E-5;a.getLayerWithExtentRange=function(G){return l(G)?{fullExtent:G.fullExtent,minScale:G.layer.minScale,maxScale:G.layer.maxScale,tilemapCache:null}:G.layer};
a.getTileInfoAndExtentFromWMTSLayer=u;a.getTiledLayerInfo=function(G,A,C){var E=null;let I=null;if("wmts"===G?.type)G=u(G,A,C),E=G.tileInfo,I=G.fullExtent;else if(I=c(G)?G.getCompatibleFullExtent(A):G.fullExtent,E=C===k.ViewingMode.Local,c(G))E=G.getCompatibleTileInfo(A,I,E);else if("vector-tile"===G?.type){E=E&&!v(A)||D.force512VTL;const H=G.tileInfo.spatialReference.isGeographic;E=E?G.tileInfo:G.tileInfo.getOrCreateCompatible(256,H?1:2)}else E=G.tileInfo;return null!=E&&null!=I&&null==q(E,I,A,C)?
{tileInfo:E,fullExtent:I}:null};a.internalAssert=function(G,A){if(a.enableTerrainInternalChecks&&!G)throw G=Error().stack?.slice(5),console.warn("Terrain internal: "+(A??"")+" at "+G),Error("Assertion failed"+(A?": "+A:""));};a.isBlendableLayerView=function(G){return G&&(f(G)||x(G)||l(G)||r(G))};a.isEast=function(G){return G===g.NeighborIndex.NORTH_EAST||G===g.NeighborIndex.EAST||G===g.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=w;a.isGroupLayerView=function(G){return"group"===G?.type};a.isImageryTileLayerView=
l;a.isImageryTileRenderInfo=function(G){G=G?.sourceLayerInfo?.data;return null!=G&&"type"in G&&"raster-tile"===G.type};a.isMapTileLayerView=p;a.isNorth=function(G){return G===g.NeighborIndex.NORTH_EAST||G===g.NeighborIndex.NORTH||G===g.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(G){return G===g.NeighborIndex.NORTH_WEST||G===g.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=c;a.isRasterTileRenderInfo=function(G){G=G?.sourceLayerInfo?.data;return G instanceof HTMLImageElement||G instanceof
m.ImageWithType||G instanceof HTMLCanvasElement||G instanceof ImageData};a.isSouth=function(G){return G===g.NeighborIndex.SOUTH_EAST||G===g.NeighborIndex.SOUTH||G===g.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(G){return p(G)||w(G)};a.isTextureTileRenderInfo=function(G){G=G?.sourceLayerInfo?.data;return null!=G&&"type"in G&&"tile-texture"===G.type};a.isTileLayerView=f;a.isVectorTileLayerView=r;a.isVectorTilePerLayerInfo=t;a.isVectorTileRenderInfo=function(G){return t(G?.sourceLayerInfo)||
!!G?.isVTLBackground};a.isWMTSLayerView=x;a.isWest=function(G){return G===g.NeighborIndex.NORTH_WEST||G===g.NeighborIndex.WEST||G===g.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(G){return G===g.NeighborIndex.NORTH_WEST||G===g.NeighborIndex.SOUTH_WEST};a.lij2s=function(G){return"["+G[0]+","+G[1]+","+G[2]+"]"};a.neighborCornerIndices=d;a.neighborEdgeIndices=e;a.oppositeCorner=function(G){return G===g.NeighborIndex.NORTH_EAST?g.NeighborIndex.SOUTH_WEST:G===g.NeighborIndex.NORTH_WEST?g.NeighborIndex.SOUTH_EAST:
G===g.NeighborIndex.SOUTH_WEST?g.NeighborIndex.NORTH_EAST:g.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(G){return G===g.NeighborIndex.NORTH?g.NeighborIndex.SOUTH:G===g.NeighborIndex.EAST?g.NeighborIndex.WEST:G===g.NeighborIndex.SOUTH?g.NeighborIndex.NORTH:g.NeighborIndex.EAST};a.releaseTileData=function(G){null!=G&&"release"in G&&G.release();return null};a.test=D;a.useFetchTileForLayer=function(G){return G.fetchTile&&!1!==G.hasOverriddenFetchTile};a.v32s=function(G){return"("+G[0]+","+G[1]+
","+G[2]+")"};a.vtlAssumes256PixelSizeAsDefault=v;a.weakAssert=function(G,A){G||console.warn("Terrain: "+A)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ITile":function(){define(["exports"],function(a){a.TileFrustumVisibility=void 0;(function(b){b[b.INSIDE=0]="INSIDE";b[b.INTERSECTS=1]="INTERSECTS";b[b.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";
b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,n,h,k,m,g,e){function d(t,q,u=0){t=t.extent;return null==t?!1:0===u?m.containsPoint(t,q):m.containsPointWithMargin(t,q,u*Math.min(t[2]-t[0],t[3]-t[1]))}function c(t,q,u,v){n.copy(r,u);r[v]=q[v];v=n.subtract(r,r,q);var y=n.subtract(x,t,q);y=n.dot(y,v);const D=n.dot(v,v);q=0>=y?q:D<=y?u:n.add(r,q,n.scale(v,v,y/D));t=n.subtract(r,t,q);return Math.PI/2-Math.atan(t[2]/Math.sqrt(t[0]*t[0]+t[1]*t[1]))}function l(t,q,u){t=t.extent;if(null==t)return 0;w[0]=t[0];w[1]=t[1];w[2]=u;p[0]=t[2];p[1]=
t[3];p[2]=u;t=u=Infinity;q[0]<w[0]?u=c(q,w,p,0):q[0]>p[0]&&(u=c(q,p,w,0));q[1]<w[1]?t=c(q,w,p,1):q[1]>p[1]&&(t=c(q,p,w,1));return Math.min(u,t)}function f(t,q,u){if(null==t)return e.getMissingTileInfoError();if(t.spatialReference.isGeographic&&!k.canProjectToWGS84ComparableLonLat(t.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var v=e.TilingScheme.checkUnsupported(t);if(null!=v)return v;if(null==
u)return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var y=t.lods;v=y[0].resolution*2**y[0].level;var D=[v*t.size[0],v*t.size[1]];const G=[t.origin.x,t.origin.y];u=m.fromExtent(u);const A=m.create();e.TilingScheme.computeRowColExtent(u,D,G,A);D=(A[2]-A[0])*(A[3]-A[1]);D>g.maxRootTiles?(y=y[0].scale*2**y[0].level,v=Math.max((u[3]-u[1])/t.size[1],(u[2]-u[0])/t.size[0])*y/v,u=Math.floor(Math.log(v)/Math.log(10)),v=Math.ceil(v/10**u)*10**u,v=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(y).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+v.toLocaleString()+".",{level0Scale:y,suggestedLevel0Scale:v,requiredNumRootTiles:D,allowedNumRootTiles:g.maxRootTiles})):v=null}if(v)return v;t=t.spatialReference;return null==q||t.equals(q)||q.isWGS84&&t.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const r=h.create(),
x=h.create(),w=h.create(),p=h.create();h=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:f,isInsideExtent:d,tiltToExtentEdge:l},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=f;a.isInsideExtent=d;a.terrainUtilsPlanar=h;a.tiltToExtentEdge=l})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports","../core/Error","../geometry/projection","../geometry/support/spatialReferenceUtils","../views/3d/terrain/TilingScheme"],function(a,
b,n,h,k){function m(){return!0}function g(){return 0}function e(c,l){if(null==c)return k.getMissingTileInfoError();const f=c.lods.length-1,r=c.spatialReference,x=n.canProjectToWGS84ComparableLonLat(r)||h.isMars(r)||h.isMoon(r);if(r.isWebMercator){if(!k.TilingScheme.makeWebMercatorAuxiliarySphere(f).compatibleWith(c))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(x){if(!k.TilingScheme.makeGCSWithTileSize(c.spatialReference,
c.size[0],f).compatibleWith(c))return c.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(null!=l&&!c.spatialReference.equals(l))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const d=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:e,isInsideExtent:m,tiltToExtentEdge:g},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=e;a.isInsideExtent=m;a.terrainUtilsSpherical=d;a.tiltToExtentEdge=g})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/vec2 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/textureUtils ../webgl-engine/parts/requireUtils ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R){const O=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let T;a.OverlayManager=class extends n{constructor(fa){super(fa);this._renderSR=this._spatialReference=null;this._overlaySREqualsRenderSR=!0;this._drapeSources=new Set;this._drapeTargets=new Set;this._drawTexturesAnimateDirty=this._drawTexturesDirty=this._contentUpdated=
this._placementDirty=!1;this._longitudeCyclical=null;this._latestOriginId=0;this._maxResolution=k("esri-mobile")?2048:4096;this._animationTimeLast=0}initialize(){const fa=this.view;this.renderer=new B.OverlayRenderer({view:fa,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});fa._stage.renderer.plugins.add(this.renderer);const da=()=>this.setDrawTexturesDirty();this._groundIntersector=K.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this.addHandles([e.watch(()=>this.renderer.hasHighlights,da),this.renderer.events.on("has-water",aa=>fa._stage?.renderer.setParameters({hasOverlayWater:aa})),this.renderer.events.on("content-changed",da),e.watch(()=>fa.state.camera.pixelRatio,da),e.watch(()=>fa.state.alignPixelEnabled,da),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),e.watch(()=>[fa.pointsOfInterest?.renderPointOfView,
fa.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),e.watch(()=>[fa.state?.pixelRatio,fa.state?.contentPixelRatio],()=>this.setPlacementDirty(),e.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),fa.on("resize",()=>this.setPlacementDirty()),fa.resourceController.scheduler.registerTask(P.TaskPriority.OVERLAY,this),fa._stage.renderView.events.on("force-camera-for-screenshot",aa=>{this._updateOverlays(P.noBudget,aa.camera,z.RenderRequestType.BACKGROUND);
this.renderer.hasOverlays&&this._drawOverlays(z.RenderRequestType.BACKGROUND,aa)})]);fa._stage.renderer.renderOverlay=aa=>this._renderOverlay(aa)}destroy(){this.view?._stage&&(this.view._stage.renderer.plugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{});T&&(T.hide(),T=null);this.renderer=g.destroyMaybe(this.renderer)}get running(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||I.debugFlags.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&
!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return null!=this._spatialReference&&this._spatialReference.isGeographic&&!this.view.state.isLocal?u.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return 1.3/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccludedDraped(){return this.renderer.rendersOccludedDraped}_renderOverlay(fa){this._contentUpdated=
!1;this.renderer.processSyncDrapeSources();if(this.renderer.hasOverlays)return this._dispatchAnimationUpdate(fa),this._drawOverlays(z.RenderRequestType.UPDATE,this.view.state)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(fa){this._spatialReference=fa;this.renderer.spatialReference=fa;this._longitudeCyclical=null;const da=this.view.renderSpatialReference;null!=fa&&null!=da?(this._renderSR=da,this._overlaySREqualsRenderSR=fa.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=
fa.isWebMercator?new h.Cyclical(-2.0037508342787E7,2.0037508342787E7):new h.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(fa,da,aa){this._drapeSources.add(fa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);da=this.renderer.createDrapeSourceRenderer(fa,da,aa);this._updateDrapeSourceExtent(fa);this._setContentDirty();this.notifyChange("running");
return da}registerGeometryDrapeSource(fa){return this.registerDrapeSource(fa,M.SortedRenderGeometryRenderer)}_updateDrapeSourceExtent(fa){2===this.renderer.overlays.length&&null!=fa.setDrapingExtent&&null!=this._spatialReference&&fa.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(fa){this._drapeSources.has(fa)&&(this._drapeSources.delete(fa),this.renderer.removeDrapeSourceRenderer(fa),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),
this.notifyChange("running"))}registerDrapeTarget(fa){this._drapeTargets.add(fa);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(fa){this._drapeTargets.delete(fa);this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty();this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(fa){return this._updateOverlays(fa,this.view.state.contentCamera,z.RenderRequestType.UPDATE)}_updateOverlays(fa,da,aa){if(!this._spatialReference)return R.Yield;
var ea=this._computeOverlayResolution(da);this._computeOverlayExtents(da,ea,W);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,W.stretch);da=this._updateOverlay(J.OverlayIndex.INNER,W.inner,ea,1*W.pixelRatioAdjustment,W.mapUnitsPerPixel);const ha=y.width(W.inner)/y.width(W.outer);ea=this._updateOverlay(J.OverlayIndex.OUTER,W.outer,ea,ha*W.pixelRatioAdjustment,W.mapUnitsPerPixel);if(da===ia.EXTENT||ea===ia.EXTENT)this._drapeSources.forEach(Y=>this._updateDrapeSourceExtent(Y)),this.surface.updateTileOverlayParams(aa);
da===ia.NONE&&ea===ia.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;fa.madeProgress()}_computeOverlayResolution(fa){const da=this.view.state.contentPixelRatio*this.view.resolutionScale;return Math.min(S.applyTextureResizeModulo(Math.ceil(1.5*Math.max(fa.fullWidth/fa.pixelRatio*da,fa.fullHeight/fa.pixelRatio*da))),this._maxResolution)}_updateOverlay(fa,da,aa,ea,ha){if(0===this.renderer.overlays.length)return ia.NONE;fa=this.renderer.overlays[fa];const Y=fa.mapUnitsPerPixel;fa.mapUnitsPerPixel=
ha;fa.pixelRatio=ea;ea=fa.extent;const Z=I.debugFlags.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(da[2]-da[0],da[3]-da[1],ea[2]-ea[0],ea[3]-ea[1]);if(Math.abs(ea[0]-da[0])<=Z&&Math.abs(ea[1]-da[1])<=Z&&Math.abs(ea[2]-da[2])<=Z&&Math.abs(ea[3]-da[3])<=Z&&aa===fa.resolution)return Y===ha?ia.NONE:ia.RERENDER_ONLY;y.copy(fa.extent,da);fa.resolution=aa;da=y.center(fa.extent);fa.renderLocalOrigin=L.fromValues(da[0],da[1],0,`OV_${this._latestOriginId++}`);return ia.EXTENT}setTileParameters(fa){const da=
fa.renderData.overlay;if(0<this.renderer.overlays.length){const aa=this.renderer.overlays[J.OverlayIndex.INNER],ea=this.renderer.overlays[J.OverlayIndex.OUTER];fa=fa.extent;this._rectInsideRect(aa.extent,fa)||this._rectanglesOverlap(fa,aa.extent)||this._rectanglesOverlap(fa,ea.extent)?(this._setTileOverlayData(fa,J.OverlayIndex.INNER,da),this._setTileOverlayData(fa,J.OverlayIndex.OUTER,da)):(this._clearTileOverlayData(J.OverlayIndex.INNER,da),this._clearTileOverlayData(J.OverlayIndex.OUTER,da))}else this._clearTileOverlayData(J.OverlayIndex.INNER,
da),this._clearTileOverlayData(J.OverlayIndex.OUTER,da)}overlayPixelSizeInMapUnits(fa,da){if(0===this.renderer.overlays.length)return da();da=this.renderer.overlays[J.OverlayIndex.INNER];const aa=this.renderer.overlays[J.OverlayIndex.OUTER];fa=this._pointIsInExtent(fa,da.extent)?da:aa;return(fa.extent[2]-fa.extent[0])/fa.resolution}_setTileOverlayData(fa,da,aa){if(0!==this.renderer.overlays.length){var ea=this.renderer.overlays[da].extent,ha=y.width(ea),Y=y.height(ea),Z=fa[0];if(this._longitudeCyclical){Z=
this._longitudeCyclical.minimalMonotonic(ea[0],Z);const ja=this._longitudeCyclical.minimalMonotonic(ea[0],fa[2]);Z>ja&&(Z=ja-(fa[2]-fa[0]))}aa.setScale(da,y.width(fa)/ha,y.height(fa)/Y);aa.setOffset(da,(Z-ea[0])/ha,(fa[1]-ea[1])/Y)}}_clearTileOverlayData(fa,da){da.setScale(fa,-1,-1);da.setOffset(fa,-1,-1)}async reloadShaders(){N.removeLoadedShaderModules();await this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(P.noBudget)}_dispatchAnimationUpdate(fa){var da=d.Milliseconds(fa-
this._animationTimeLast);if(da>=this.surface.view._stage.renderer.animationTimestep||null!=this.view.state.forcedAnimationTime||this._drawTexturesDirty||this._drawTexturesAnimateDirty)da=d.Milliseconds(da/this.surface.view._stage.renderer.animationTimeDilation),da=new F.UpdateParameters(this.view.state.camera,da,this.view.state.forcedAnimationTime),this.renderer.updateAnimation(da)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=fa}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._drawTexturesDirty=
this._contentUpdated=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(fa,da,aa,ea){aa=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(fa,ba,da,aa);if(null==aa)return!1;da=aa.origin;aa=w.add(U,aa.origin,aa.direction);this._groundIntersector.reset(da,aa,fa);this._groundIntersector.intersect([]);this.view.basemapTerrain.intersect(this._groundIntersector,null,da,aa);return this._groundIntersector.results.min.getIntersectionPoint(ea)}_findHorizonBasedPointOfInterest(fa,
da){var aa=.5;aa=this.view.renderCoordsHelper.getAltitude(fa.eye);const ea=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ha=m.clamp(ea.estimatedSurfaceAltitude,fa.aboveGround?-Infinity:aa+1E-5,fa.aboveGround?aa-1E-5:Infinity);aa=fa.aboveGround;if("global"===this.view.viewingMode){var Y=U;G.closestPointOnSilhouette(G.fromRadius(G.tmpSphere,u.getReferenceEllipsoid(this.view.spatialReference).radius+ha),D.wrap(fa.eye,fa.viewForward),Y);w.subtract(Y,Y,fa.eye);ha=h.cyclicalPI.normalize(A.angleAroundAxis(fa.viewForward,
Y,fa.viewRight))/fa.fovY+.5;Y=0>=ha||1<=ha?.5:.55;aa=aa?Y*ha:ha+Y*(1-ha)}else ha=q.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-fa.viewForward[2])),1,0),ha=t.transformMat4(ha,ha,fa.projectionMatrix)[1],ha=m.clamp(.5+.5*ha,0,1),aa=1===ha||0===ha?.5:aa?.55*ha:1-.55*(1-ha);return this._intersectGroundFromView(fa,.5,aa,da)?w.sqrDist(da,fa.eye)<ea.distance*ea.distance:!1}_computeOverlayExtents(fa,da,aa){var ea=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ha=p.create();this._findHorizonBasedPointOfInterest(fa,
ha)||w.copy(ha,ea);I.debugFlags.OVERLAY_SHOW_CENTER?(null==T&&(T=new H.PointGraphics(this.view.graphics,"red")),T.show(ha,this._renderSR)):null!=T&&T.hide();var Y=Math.max(.1,w.distance(fa.eye,ha));const Z=E.viewAngle(this.view.renderCoordsHelper,ea,fa.eye);this._overlaySREqualsRenderSR||v.projectVectorToVector(ha,this._renderSR,ha,this._spatialReference);ea=this.surface.extent;var ja=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,oa=ja&&this._spatialReference?1/u.getReferenceEllipsoid(this._spatialReference).metersPerDegree:
1;Y=fa.perScreenPixelRatio/this.view.state.contentPixelRatio*Y*oa;aa.mapUnitsPerPixel=Y/this._worldToPCSRatio;aa.stretch=this._overlayStretch;Y=da*Y/2*aa.stretch;var qa=!1;ja=ja?90:Infinity;this._isSpherical&&ea&&this._spatialReference&&(this._spatialReference.isWebMercator?(Y/=Math.cos(C.y2lat(ha[1])),ja=ea[3]):(qa=!0,Y/=u.getReferenceEllipsoid(this._spatialReference).metersPerDegree,ja=90),Y>=ja&&(Y=ja,ha[1]=0,this._spatialReference.isWebMercator&&(ha[0]=0)));oa=1;qa&&(oa=1/Math.max(.2,Math.cos(Math.abs(m.deg2rad(ha[1])))),
180<Y*oa&&(oa=180/Y),aa.mapUnitsPerPixel*=oa);qa=Math.log(2)/12;Y=Math.exp(Math.round(Math.log(Y)/qa)*qa);const ta=Y*oa;qa=.5*da/(32*ta);var va=.5*da/(32*Y);ha[0]=Math.round(ha[0]*qa)/qa;ha[1]=Math.round(ha[1]*va)/va;qa=aa.inner;qa[0]=ha[0]-ta;qa[1]=ha[1]-Y;qa[2]=ha[0]+ta;qa[3]=ha[1]+Y;this._isSpherical&&this._shiftExtentToFitBounds(qa,Infinity,ja);va=aa.outer;6*ta>y.width(ea)?y.copy(va,ea):Math.PI/2-Math.abs(Z-Math.PI/2)<=.25*Math.PI?(va[0]=qa[0]-ta,va[1]=qa[1]-Y,va[2]=qa[2]+ta,va[3]=qa[3]+Y):(v.projectVectorToVector(fa.eye,
this._renderSR,U,this._spatialReference),x.subtract(V,ha,U),fa=-Math.atan2(V[1],V[0])+.125*Math.PI,0>fa&&(fa+=2*Math.PI),t.scale(V,O[Math.floor(fa/(.25*Math.PI))],2*Y),V[0]*=oa,V[2]*=oa,t.add(va,qa,V));this._isSpherical?(va[0]=this._longitudeCyclical.clamp(va[0]),va[2]=this._longitudeCyclical.clamp(va[2]),va[1]=Math.max(va[1],-ja),va[3]=Math.min(va[3],ja)):(fa=y.intersection(qa,ea,ca),ea=y.intersection(va,ea,X),y.contains(fa,ea)&&(va[2]=va[0],va[3]=va[1]));da=Math.abs(qa[2]-qa[0])/da;aa.mapUnitsPerPixel=
Math.max(aa.mapUnitsPerPixel,da);aa.pixelRatioAdjustment=aa.mapUnitsPerPixel/da}_drawOverlays(fa,da){if(this.renderer.hasOverlays){if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;var aa=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;var ea=this.renderer.computeValidity();this.renderer.releaseRenderTargets();this.renderer.drawOverlays(da);da=this.renderer.computeValidity();ea!==da&&this.surface.updateTileOverlayParams(z.RenderRequestType.UPDATE);
aa?(this.surface.requestRender(fa),fa===z.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(z.RenderRequestType.BACKGROUND);return this.renderer}}_rectanglesOverlap(fa,da){return null==fa?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(da[0],da[2],fa[0])||this._longitudeCyclical.contains(da[0],da[2],fa[2])||this._longitudeCyclical.contains(fa[0],fa[2],da[0]))&&!(fa[1]>da[3]||fa[3]<da[1]):y.intersects(fa,da)}_rectInsideRect(fa,da){return null==da?!1:this._longitudeCyclical?
this._longitudeCyclical.contains(fa[0],fa[2],da[0])&&this._longitudeCyclical.contains(fa[0],fa[2],da[2])&&da[1]>fa[1]&&da[3]<fa[3]:y.contains(fa,da)}_pointIsInExtent(fa,da){if(this._longitudeCyclical)return this._longitudeCyclical.contains(da[0],da[2],fa.x)&&fa.y>=da[1]&&fa.y<=da[3];const aa=fa.x;fa=fa.y;return aa>da[0]&&aa<da[2]&&fa>da[1]&&fa<da[3]}_shiftExtentToFitBounds(fa,da,aa){let ea=0,ha=0;fa[0]<-da?ea=fa[0]+da:fa[2]>da&&(ea=da-fa[2]);fa[1]<-aa?ha=fa[1]+aa:fa[3]>aa&&(ha=aa-fa[3]);y.offset(fa,
ea,ha)}get test(){return{renderer:this.renderer,update:()=>this.runTask(P.noBudget)}}};b.__decorate([c.property()],a.OverlayManager.prototype,"_spatialReference",void 0);b.__decorate([c.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);b.__decorate([c.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([c.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);b.__decorate([c.property()],a.OverlayManager.prototype,"_isSpherical",null);b.__decorate([c.property()],
a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([c.property()],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([c.property({constructOnly:!0})],a.OverlayManager.prototype,"view",void 0);b.__decorate([c.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);b.__decorate([c.property()],a.OverlayManager.prototype,"suspended",null);b.__decorate([c.property()],a.OverlayManager.prototype,"updating",null);b.__decorate([c.property({type:Boolean})],a.OverlayManager.prototype,
"rendersOccludedDraped",null);a.OverlayManager=b.__decorate([r.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);class Q{constructor(){this.inner=y.create();this.outer=y.create();this.mapUnitsPerPixel=0;this.pixelRatioAdjustment=1;this.stretch=1.3}}const V=q.create(),U=p.create(),W=new Q,ca=y.create(),X=y.create(),ba=D.create();var ia;(function(fa){fa[fa.NONE=0]="NONE";fa[fa.EXTENT=1]="EXTENT";fa[fa.RERENDER_ONLY=2]="RERENDER_ONLY"})(ia||={});Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){const b=globalThis.require?.modules;if(b){const n=Object.keys(b);for(const h of n)h.includes(".glsl")&&delete b[h]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/SpatialReference ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./ITile ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends c.Tile{constructor(x,w,p,t,q){super();this._horizontalScaleFactor=1;this._extentInRenderSR=m.create();this._baseUsedMemory=900;this.init(x,w,p,t,q)}init(x,w,p,t,q){super.init(x,w,p,t,q);x=q.view.renderSpatialReference;w=q.spatialReference;this._horizontalScaleFactor=x=null!=x&&g.isPlateCarree(x)&&null!=w&&w.isGeographic?this.ellipsoid.radius*Math.PI/180:1;({isWebMercatorOnPlateCarree:p}=q);q=this._extentInRenderSR;w=this.extent;if(p)x=b.fromValues(w[0],
w[1],0),h.projectVectorToVector(x,n.WebMercator,x,n.PlateCarree),w=b.fromValues(w[2],w[3],0),h.projectVectorToVector(w,n.WebMercator,w,n.PlateCarree),q[0]=x[0],q[1]=x[1],q[2]=w[0],q[3]=w[1];else for(p=0;4>p;++p)q[p]=w[p]*x;this.centerAtSeaLevel[0]=.5*(q[0]+q[2]);this.centerAtSeaLevel[1]=.5*(q[1]+q[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(q[2]-q[0],q[3]-q[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();var x=this._extentInRenderSR;
const w=.5*(x[2]-x[0]);x=.5*(x[3]-x[1]);this._center[c.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(w*w+x*x),.5*(this.elevationBoundsMax-this.elevationBoundsMin))}_calculateFrustumVisibilityStatus(x){var w=this._aabb();const p=w[0],t=w[1],q=w[2],u=w[3],v=w[4];w=w[5];let y=!0;for(let G=0;6>G;G++){var D=x[G];const A=D[0],C=D[1],E=D[2];D=D[3];if(0<=A*(0<A?p:u)+C*(0<C?t:v)+E*(0<E?q:w)+D)return e.TileFrustumVisibility.OUTSIDE;y=y&&0>=A*(0>A?p:u)+C*(0>C?t:v)+E*(0>E?q:w)+D}return y?e.TileFrustumVisibility.INSIDE:
e.TileFrustumVisibility.INTERSECTS}_aabb(){const x=this._extentInRenderSR;return k.wrap(x[0],x[1],this.elevationBoundsMin,x[2],x[3],this.elevationBoundsMax)}intersectsRay(x,w,p,t){r[0]=1/w[0];r[1]=1/w[1];r[2]=1/w[2];return l.intersectAabbInvDirBefore(this._aabb(),x,r,p,t)}createGeometry(){d.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()}getDefaultVerticesPerSide(){return 9>this.level?3:2}updateCornerElevations(){d.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){d.updateEdgesAndCornersPlanar(this.renderData,
this._horizontalScaleFactor)}updateEdgeElevationsAndResolutions(){d.updateEdgeElevationsAndResolutionsPlanar(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}}const r=b.create();a.PlanarPatch=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./ITile ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(X,ba,ia){const {tile:fa,localOrigin:da,geometry:aa}=X,{extent:ea,ellipsoid:ha}=fa,{boundingBox:Y,numVerticesPerSide:Z,vertexAttributes:ja,poleVerticesStartIndex:oa}=aa,qa=Z-1,ta=da[0],va=da[1],Ca=da[2],ma=ha.radius,wa=ea[1],Ba=ea[3],pa=[];let Aa=oa;X=(ra,ua)=>{ua*=Z;N(-ta,-va,-Ca+ra*ma,Y);pa.push({connectedRowOffset:ua,connectedOuterEdgeOffset:1===ra?0:2,rowOffset:Aa,latitudeResolution:6});ua=Math.PI/2-2*Math.atan(Math.exp(-(-1===ra?wa:Ba)/ma));const Ea=
ra*Math.PI/2-ua;ra=.99*(1===ra?1:-1);const Ka=ma+0,{position:Ma,uv0:Ua}=ja,{typedBuffer:Ga,typedBufferStride:Na}=ja.normalCompressed;for(let Xa=1;6>=Xa;++Xa){var Va=ua+Xa/6*Ea;const Pa=Math.cos(Va);Va=Math.sin(Va);for(let bb=0;bb<=qa;bb++){const gb=bb/qa,cb=Q.cosLonLUT[bb]*Pa,ka=Q.sinLonLUT[bb]*Pa,mb=Va,qb=cb*Ka-ta,tb=ka*Ka-va,xa=mb*Ka-Ca;N(qb,tb,xa,Y);Ma.setValues(Aa,qb,tb,xa);e.encodeUVInBuffer(Ua,Aa,gb,ra);x.compressNormal(Ga,Aa,cb,ka,mb,Na);++Aa}}};ba&&X(-1,0);ia&&X(1,qa);return pa}function p(X){X.tile.intersectsClippingArea&&
(K(X),t(X))}function t(X,ba=!1){const {geometry:ia,geometryState:fa,tile:da,localOrigin:aa}=X,{level:ea,extent:ha,extentInRadians:Y,ellipsoid:Z}=da,ja=Z.radius,oa=Y[0],qa=Y[2],ta=Y[1],va=Y[3],{samplerData:Ca}=fa,ma=ha[0],wa=ha[2],Ba=ha[1],pa=ha[3],Aa=q(X),{boundingBox:ra,vertexAttributes:ua}=ia,Ea=aa[0],Ka=aa[1],Ma=aa[2];var Ua=ua.position;const Ga=Ua.typedBuffer,Na=Ua.typedBufferStride,Va=ua.uv0;for(let cb=0;4>cb;++cb){const ka=1===cb||3===cb;Ua=fa.edgeResolutions[cb];l.internalAssert(b.isPowerOfTwo(Ua));
const mb=Ua+1;var Xa=c.neighborTileIfLoadedOrSelf(da,fa.edgePeerNeighbors[cb]);if(S(da,Xa,cb)){z(X,cb,Xa);continue}const qb=null!=Xa;l.internalAssert(!qb||Xa.level===da.level);l.internalAssert(!qb||0>=r.compareTilesByLij(da,Xa));var Pa=Xa?.renderData?.geometryState;if(l.enableTerrainInternalChecks){var bb=da.surface;if(!Xa&&bb&&!bb.updatingRootTiles){var gb=l.neighborEdgeIndices[cb];const rb=da.findNeighborTile(gb,Eb=>Eb.isLoaded||Eb.isLeaf||Eb.level===da.level);rb?rb.intersectsClippingArea&&(l.internalAssert(!rb.isLoaded),
l.internalAssert(!rb.isLeaf),l.internalAssert(rb.level===ea)):l.internalAssert(null==bb?.rootTiles||!da.shouldHaveNeighbor(gb))}}const tb=1===cb?ha[2]:ha[0],xa=(Xa=Xa?.extent)&&ka?1===cb?Xa[0]:Xa[2]:tb,Ia=0===cb?ha[3]:ha[1],na=1===cb?1:0,ya=0===cb?1:0,Da=1===cb?qa:oa,Oa=0===cb?va:ta,Wa=Math.sin(Da),ab=Math.cos(Da),Ja=Math.sin(Oa),Ra=Math.cos(Oa),Sa=Pa?.samplerData;Pa=(rb,Eb,Lb)=>k.sampleElevation(rb,Eb,Ca);bb=(rb,Eb,Lb)=>.5*(k.sampleElevation(rb,Eb,Ca)+k.sampleElevation(Lb,Eb,Sa));const db=qb?bb:
Pa;Pa=ia.outerEdgesOffsetAndLength[2*cb];const eb=ba&&3<mb?mb-3:1;bb=null!=Ca&&Ca.some(rb=>null!=rb);gb=null!=Sa&&Sa.some(rb=>null!=rb);const lb=bb||gb,sb=1/Ua,vb=Pa;l.internalAssert(!Xa||l.almostEquals(Xa[2]-Xa[0],ha[2]-ha[0]));(()=>{const rb=1===cb?-1:3===cb?1:0,Eb=0===cb?-1:2===cb?1:0,Lb=(ha[2]-ha[0])*sb,Yb=rb*Lb,bc=Eb*Lb,fc=qa-oa,kc=ka?rb*fc*sb:0,Cb=ka?0:Eb*sb,Ib=ya,Ub=ka?Da+kc:Da,Sb=ka?Math.sin(Ub):Wa,jb=ka?Math.cos(Ub):ab,sa=ka?Da-kc:Da,Ha=ka?Math.sin(sa):Wa,Qa=ka?Math.cos(sa):ab,Ta=ka?Oa:Aa(Ib+
Cb),Za=ka?Ja:Math.sin(Ta),hb=ka?Ra:Math.cos(Ta),ib=ka?Oa:Aa(Ib-Cb),pb=ka?Ja:Math.sin(ib),ob=ka?Ra:Math.cos(ib);let yb=0,wb=0,Fb=0;const zb=0*sb,Tb=ka?tb:ma*(1-zb)+wa*zb,nb=ka?xa:Tb,xb=ka?Ba*(1-zb)+pa*zb:Ia,Ab=ka?Da:oa*(1-zb)+qa*zb,Mb=ka?Wa:Math.sin(Ab),gc=ka?ab:Math.cos(Ab),Vb=ka?Aa(zb):Oa,Zb=ka?Math.sin(Vb):Ja,hc=ka?Math.cos(Vb):Ra,Qb=ja+db(Tb,xb,nb);yb=gc*hc*Qb;wb=Mb*hc*Qb;Fb=Zb*Qb;let Nb=0,Wb=0,Hb=0;const Gb=1*sb,Xb=ka?tb:ma*(1-Gb)+wa*Gb,$b=ka?xa:Xb,Db=ka?Ba*(1-Gb)+pa*Gb:Ia,Jb=ka?Da:oa*(1-Gb)+
qa*Gb,ic=ka?Wa:Math.sin(Jb),ac=ka?ab:Math.cos(Jb),mc=ka?Aa(Gb):Oa,Rb=ka?Math.sin(mc):Ja,cc=ka?Math.cos(mc):Ra,rc=ja+db(Xb,Db,$b);Nb=ac*cc*rc;Wb=ic*cc*rc;Hb=Rb*rc;for(let oc=1;oc<mb-1;oc+=eb){let Bc=0,Cc=0,vc=0;const nc=(oc+1)*sb,wc=ka?tb:ma*(1-nc)+wa*nc,xc=ka?xa:wc,Fc=ka?Ba*(1-nc)+pa*nc:Ia,Mc=ka?Da:oa*(1-nc)+qa*nc,Yc=ka?Wa:Math.sin(Mc),Uc=ka?ab:Math.cos(Mc),Dc=ka?Aa(nc):Oa,yc=ka?Math.sin(Dc):Ja,pc=ka?Math.cos(Dc):Ra,zc=ja+db(wc,Fc,xc);Bc=Uc*pc*zc;Cc=Yc*pc*zc;vc=yc*zc;const hd=Bc,Bd=Cc,Zc=vc,Cd=Nb,
Dd=Wb,$c=Hb;Nb=hd;Wb=Bd;Hb=Zc;const id=vb+oc,vd=id*Na,ee=Cd-Ea,Ed=Dd-Ka,fe=$c-Ma;Ga[vd]=ee;Ga[vd+1]=Ed;Ga[vd+2]=fe;N(ee,Ed,fe,ra);const Fd=oc*sb;e.encodeUVInBuffer(Va,id,ka?na:Fd,ka?Fd:ya);const Gd=yb,jd=wb,wd=Fb;yb=Cd;wb=Dd;Fb=$c;const Ec=Cd,ad=Dd,Rc=$c,bd=1/Math.sqrt(Ec*Ec+ad*ad+Rc*Rc),kd=Rc*bd;let Vc=0,Sc=0,uc=0;if(lb&&.999>kd*kd){let Tc=0,Wc=0,cd=0;const ld=0===cb?-1:1;Tc=ld*(hd-Gd);Wc=ld*(Bd-jd);cd=ld*(Zc-wd);const Nc=oc*sb,dd=ka?tb:ma*(1-Nc)+wa*Nc,ge=ka?xa:dd,xd=ka?Ba*(1-Nc)+pa*Nc:Ia,md=ka?
Da:oa*(1-Nc)+qa*Nc,Hd=ka?Wa:Math.sin(md),he=ka?ab:Math.cos(md),ie=ka?Aa(Nc):Oa,yd=ka?Math.sin(ie):Ja,Oc=ka?Math.cos(ie):Ra;let Xc=Ec,Pc=ad,nd=Rc;if(qb){const Lc=ja+k.sampleElevation(ge-Yb,xd-bc,Sa),$e=ka?Ha:Hd,af=ka?yd:pb,ze=ka?Oc:ob;Xc=(ka?Qa:he)*ze*Lc;Pc=$e*ze*Lc;nd=af*Lc}const zd=ja+k.sampleElevation(dd+Yb,xd+bc,Ca),je=ka?Oc:hb,ke=(ka?jb:he)*je*zd,od=(ka?Sb:Hd)*je*zd,Ad=(ka?yd:Za)*zd;qb||(Xc=2*Ec-ke,Pc=2*ad-od,nd=2*Rc-Ad);const Id=3===cb?-1:1,Jd=Id*(Xc-ke),Bb=Id*(Pc-od),jc=Id*(nd-Ad);Vc=cd*Bb-
Wc*jc;Sc=Tc*jc-cd*Jd;uc=Wc*Jd-Tc*Bb;const qc=1/Math.sqrt(Vc*Vc+Sc*Sc+uc*uc);Vc*=qc;Sc*=qc;uc*=qc}else Vc=Ec*bd,Sc=ad*bd,uc=Rc*bd;ia.setEdgeNormalFromValues(cb,oc,Vc,Sc,uc)}})()}}function q(X){({tile:X}=X);if(X.surface.isWebMercator){const ia=X.extent,fa=X.ellipsoid.radius;return da=>Math.PI/2-2*Math.atan(Math.exp(-(ia[1]*(1-da)+ia[3]*da)/fa))}const ba=X.extentInRadians;return ia=>ba[1]*(1-ia)+ba[3]*ia}function u(X,ba){X.tile.intersectsClippingArea&&(K(X),v(X,!1))}function v(X,ba){const {geometry:ia,
geometryState:fa,tile:da,localOrigin:aa}=X,{surface:ea,extent:ha}=da,{clippingArea:Y,samplerData:Z}=fa,ja=null!=Y?Y:V,oa=ha[0],qa=ha[2],ta=ha[1],va=ha[3],Ca=[va>ja[3],qa>ja[2],ta<ja[1],oa<ja[0]],ma=da.horizontalScale,wa=y(ea.isWebMercatorOnPlateCarree,da.ellipsoid.radius,ma),{minu:Ba,minv:pa,maxu:Aa,maxv:ra,boundingBox:ua}=ia,Ea=Math.max(oa,ja[0]),Ka=Math.min(qa,ja[2]),Ma=Math.max(ta,ja[1]),Ua=Math.min(va,ja[3]),Ga=aa[0],Na=aa[1],Va=aa[2];for(let Xa=0;4>Xa;++Xa){const Pa=1===Xa||3===Xa,bb=fa.edgeResolutions[Xa];
l.internalAssert(b.isPowerOfTwo(bb));const gb=bb+1,cb=Ca[Xa],ka=c.neighborTileIfLoadedOrSelf(da,fa.edgePeerNeighbors[Xa]);if(!cb&&S(da,ka,Xa)){z(X,Xa,ka);continue}const mb=null!=ka&&!cb,qb=ka?.renderData?.geometryState;if(l.enableTerrainInternalChecks&&(l.internalAssert(!mb||ka.level===da.level),l.internalAssert(!mb||0>=r.compareTilesByLij(da,ka)),da&&!ka&&!ea.updatingRootTiles)){const Qa=l.neighborEdgeIndices[Xa],Ta=da.findNeighborTile(Qa,Za=>Za.isLoaded||Za.isLeaf||Za.level===da.level);ea.updatingRootTiles||
(Ta?Ta.intersectsClippingArea&&(l.internalAssert(!Ta.isLoaded),l.internalAssert(!Ta.isLeaf),l.internalAssert(Ta.level===da.level)):l.internalAssert(null==ea?.rootTiles||!da.shouldHaveNeighbor(Qa)))}const tb=b.clamp(1===Xa?qa:oa,Ea,Ka),xa=b.clamp(0===Xa?va:ta,Ma,Ua),Ia=qb?.samplerData,na=ba&&3<gb?gb-3:1,ya=b.clamp(1===Xa?1:0,Ba,Aa),Da=b.clamp(0===Xa?1:0,pa,ra),Oa=(Qa,Ta)=>k.sampleElevation(Qa,Ta,Z),Wa=(Qa,Ta)=>.5*(k.sampleElevation(Qa,Ta,Ia)+k.sampleElevation(Qa,Ta,Z)),ab=mb?Wa:Oa,Ja=(qa-oa)/bb,Ra=
Pa?1===Xa?Ja:-Ja:0,Sa=Pa?0:0===Xa?Ja:-Ja,db=-Ra,eb=-Sa;let lb=0,sb=0,vb=0;const rb=0/bb,Eb=Pa?tb:b.clamp(oa*(1-rb)+qa*rb,Ea,Ka),Lb=Pa?b.clamp(ta*(1-rb)+va*rb,Ma,Ua):xa,Yb=ab(Eb,Lb);lb=Eb*ma;sb=wa(Lb);vb=Yb;let bc=0,fc=0,kc=0;const Cb=1/bb,Ib=Pa?tb:b.clamp(oa*(1-Cb)+qa*Cb,Ea,Ka),Ub=Pa?b.clamp(ta*(1-Cb)+va*Cb,Ma,Ua):xa,Sb=ab(Ib,Ub),jb=Ib*ma,sa=wa(Ub),Ha=Sb;bc=jb;fc=sa;kc=Ha;for(let Qa=1;Qa<gb-1;Qa+=na){const Ta=Qa/bb,Za=bc,hb=fc,ib=kc,pb=Pa?ya:b.clamp(Ta,Ba,Aa),ob=Pa?b.clamp(Ta,pa,ra):Da,yb=Za-Ga,wb=
hb-Na,Fb=ib-Va;N(Za,wb,Fb,ua);ia.setEdgeVertexFromValuesRawPositionUV(Xa,Qa,yb,wb,Fb,pb,ob);const zb=(Qa+1)/bb,Tb=Pa?tb:b.clamp(oa*(1-zb)+qa*zb,Ea,Ka),nb=Pa?b.clamp(ta*(1-zb)+va*zb,Ma,Ua):xa,xb=ab(Tb,nb);bc=Tb*ma;fc=wa(nb);kc=xb;const Ab=bc,Mb=fc,gc=kc,Vb=lb,Zb=sb,hc=vb;lb=Za;sb=hb;vb=ib;let Qb=0,Nb=0,Wb=0;if(Pa){const Gb=Mb-hb,Xb=gc-ib,$b=Zb-hb,Db=hc-ib,Jb=b.clamp(ta*(1-Ta)+va*Ta,Ma,Ua),ic=tb+db,ac=ic*ma,mc=k.sampleElevation(ic,Jb,Z),Rb=ac-Za,cc=mc-ib,rc=3===Xa?-1:1;Qb=rc*(-$b+Gb)*cc;Nb=rc*Rb*(-Db+
Xb);Wb=-rc*Rb*(-$b+Gb);if(mb){const oc=tb+Ra,Bc=oc*ma,Cc=k.sampleElevation(oc,Jb,Ia),vc=Bc-Za;Qb=(-$b+Gb)*(cc-(Cc-ib));Nb=(Rb-vc)*(-Db+Xb);Wb=-(Rb-vc)*(-$b+Gb)}}else{const Gb=Ab-Za,Xb=gc-ib,$b=Vb-Za,Db=hc-ib,Jb=b.clamp(oa*(1-Ta)+qa*Ta,Ea,Ka),ic=xa+eb,ac=k.sampleElevation(Jb,ic,Z)-ib,mc=wa(ic)-hb,Rb=2===Xa?-1:1;Qb=Rb*mc*(-Db+Xb);Nb=Rb*(-$b+Gb)*ac;Wb=-Rb*mc*(-$b+Gb);if(mb){const cc=Jb,rc=xa+Sa,oc=wa(rc),Bc=k.sampleElevation(cc,rc,Ia)-ib,Cc=oc-hb;Qb=(-mc+Cc)*(-Db+Xb);Nb=(-$b+Gb)*(-ac+Bc);Wb=-(-mc+Cc)*
(-$b+Gb)}}const Hb=1/Math.sqrt(Qb*Qb+Nb*Nb+Wb*Wb);ia.setEdgeNormalFromValues(Xa,Qa,Qb*Hb,Nb*Hb,Wb*Hb)}}}function y(X,ba,ia){return X?fa=>(Math.PI/2-2*Math.atan(Math.exp(-fa/ba)))*ba:fa=>fa*ia}function D(X,ba,ia){const {numVerticesPerSide:fa,vertexAttributes:da,maxEdgeVertexCount:aa}=X,ea=fa-1;var ha=da.count;const Y=2*(fa-3)*(fa-3);var Z=4*(ea+aa-3);const ja=c.zeroToFour.reduce((ta,va)=>ta+(ea+X.getEdgeCount(va)-3),0),oa=ba.reduce((ta,va)=>ta+ea*(2*(va.latitudeResolution-1)+1),0),qa=3*(ia?2:1);Z=
(Y+Z+oa)*qa;ha=65536<=ha?new Uint32Array(Z):new Uint16Array(Z);for(let ta=0;ta<Z;++ta)ha[ta]=0;X.indices=ha;X.indexCount=(Y+ja+oa)*qa;X.poleIndicesStartIndex=Y*qa;X.edgeIndicesStartIndex=(Y+oa)*qa;ia?(E(X),I(X,ba),H(X)):(G(X),A(X,ba),C(X))}function G(X){const {numVerticesPerSide:ba,indices:ia,vertexAttributes:fa}=X;({position:X}=fa);const {typedBuffer:da,typedBufferStride:aa}=X;X=ba-2;const ea=ba-3,ha=ba-3;let Y=0;for(let Z=0;Z<ea;++Z){const ja=Z*X;for(let oa=0;oa<ha;++oa){const qa=ja+oa,ta=qa+1,
va=ta+X,Ca=va-1;R(qa,ta,va,Ca,aa,da)?(ia[Y]=qa,ia[Y+1]=ta,ia[Y+2]=va,ia[Y+3]=va,ia[Y+4]=Ca,ia[Y+5]=qa):(ia[Y]=qa,ia[Y+1]=ta,ia[Y+2]=Ca,ia[Y+3]=Ca,ia[Y+4]=ta,ia[Y+5]=va);Y+=6}}}function A(X,ba){const {numVerticesPerSide:ia,indices:fa,poleIndicesStartIndex:da}=X,aa=ia-1;let ea=da;for(const ha of ba){ba=X.getEdgeVertexIndex(ha.connectedOuterEdgeOffset,0);let Y=1;for(let Z=0;Z<ha.latitudeResolution;++Z){const ja=0===Z?ha.rowOffset:ba+ia;for(let oa=0;oa<aa;oa++){const qa=ja+oa;fa[ea]=ba;fa[ea+1]=ba+1;
fa[ea+2]=qa;Z<ha.latitudeResolution-1?(fa[ea+3]=ba+1,fa[ea+4]=qa+1,fa[ea+5]=qa,ea+=6):ea+=3;ba+=Y}ba=ja;Y=1}}}function C(X){const {indices:ba,numVerticesPerSide:ia,edgeIndicesStartIndex:fa}=X,da=ia-1,aa=da-2;let ea=fa;for(let ja=0;4>ja;++ja){var ha=ca[ja];let oa=0,qa=0;const ta=X.getEdgeCount(ja),va=ha.count;l.internalAssert(va===da-1);var Y=1===ja||2===ja;const Ca=Y?1:2;Y=Y?2:1;const ma=X.getEdgeFirstVertexIndex(ja),wa=ha.vertex0Index;for(ha=ha.stride;oa<ta-1||qa<va-1;){const Ba=wa+qa*ha,pa=ma+1*
oa;var Z=oa<ta-1;const Aa=qa<va-1,ra=Z?da*(oa+.5)/(ta-1):0,ua=Aa?1+aa*(qa+.5)/(va-1):0;(Z=Z&&(!Aa||ra<=ua))?++oa:++qa;Z=Z?pa+1:Ba+ha;ba[ea]=Ba;ba[ea+Ca]=pa;ba[ea+Y]=Z;ea+=3}}X.indexCount=ea}function E(X){const {indices:ba,numVerticesPerSide:ia,vertexAttributes:fa}=X;({position:X}=fa);const {typedBuffer:da,typedBufferStride:aa}=X;X=ia-2;let ea=0;for(let ha=0;ha<ia-3;++ha){const Y=ha*X;for(let Z=0;Z<ia-3;++Z){const ja=ha*X+Z,oa=ja+1,qa=oa+X,ta=qa-1,va=Y+Z,Ca=va+1,ma=Ca+X;R(va,Ca,ma,ma-1,aa,da)?(O(ba,
ea,ja,oa,qa),ea+=6,O(ba,ea,qa,ta,ja)):(O(ba,ea,ja,oa,ta),ea+=6,O(ba,ea,ta,qa,oa));ea+=6}}}function I(X,ba){const {indices:ia,numVerticesPerSide:fa,poleIndicesStartIndex:da}=X,aa=fa-1;let ea=da;for(const ha of ba){ba=X.getEdgeVertexIndex(ha.connectedOuterEdgeOffset,0);let Y=1;for(let Z=0;Z<ha.latitudeResolution;++Z){const ja=0===Z?ha.rowOffset:ba+fa;for(let oa=0;oa<aa;oa++)O(ia,ea,ba,ba+1,ja+oa),ea+=6,Z<ha.latitudeResolution-1&&(O(ia,ea,ba+1,ja+oa+1,ja+oa),ea+=6),ba+=Y;ba=ja;Y=1}}}function H(X){const {indices:ba,
numVerticesPerSide:ia,edgeIndicesStartIndex:fa}=X,da=ia-1,aa=da-2;let ea=fa;for(let ja=0;4>ja;++ja){var ha=ca[ja];let oa=0,qa=0;const ta=X.getEdgeCount(ja),va=ha.count;l.internalAssert(va===da-1);var Y=1===ja||2===ja;const Ca=Y?1:3;Y=Y?3:1;const ma=X.getEdgeFirstVertexIndex(ja),wa=ha.vertex0Index;for(ha=ha.stride;oa<ta-1||qa<va-1;){const Ba=wa+qa*ha,pa=ma+1*oa;var Z=oa<ta-1;const Aa=qa<va-1,ra=Z?da*(oa+.5)/(ta-1):0,ua=Aa?1+aa*(qa+.5)/(va-1):0;(Z=Z&&(!Aa||ra<=ua))?++oa:++qa;Z=Z?pa+1:Ba+ha;ba[ea]=Ba;
ba[ea+Ca]=pa;ba[ea+Ca+1]=pa;ba[ea+Y]=Z;ba[ea+Y+1]=Z;ba[ea+5]=Ba;ea+=6}}X.indexCount=ea}function J(X){const {geometry:ba,geometryState:ia}=X;({edgeResolutions:X}=ia);const {numVerticesPerSide:fa,edgeVerticesStartIndex:da}=ba,aa=fa-2;let ea=da;for(let Y=0;4>Y;++Y){var ha=0===Y||2===Y;ha=(ha?0:1)*aa+(ha?1:0);const Z=ca[Y];Z.vertex0Index=(0===Y?aa-1:0)*aa+(1===Y?aa-1:0);Z.stride=ha;Z.count=aa;ha=X[Y]+1;ba.outerEdgesOffsetAndLength[2*Y]=ea;ba.outerEdgesOffsetAndLength[2*Y+1]=ha;ea+=ha}}function B(X){J(X);
X.geometryState.wireframe?H(X.geometry):C(X.geometry)}function z(X,ba,ia){var fa=(ba+2)%4;const {geometryState:da,geometry:aa,tile:ea,localOrigin:ha}=X;var Y=ea.level-ia.level;X=1===ba||3===ba;const Z=da.edgeResolutions[ba];l.internalAssert(b.isPowerOfTwo(Z));const ja=Z+1,{boundingBox:oa,minu:qa,minv:ta,maxu:va,maxv:Ca,vertexAttributes:ma}=aa,wa=b.clamp(1===ba?1:0,qa,va),Ba=b.clamp(0===ba?1:0,ta,Ca);var pa=ia.renderData,Aa=pa.geometryState,ra=pa.geometry,ua=ra.getEdgeCount(fa);ia=ea.getNeighborEdgeStartVertexIndex(ba,
ia)*Z;Y=Z*2**Y;l.internalAssert(Aa.edgeResolutions[fa]===Y);l.internalAssert(ua-1===Y);Aa=pa.localOrigin[0]-ha[0];ua=pa.localOrigin[1]-ha[1];pa=pa.localOrigin[2]-ha[2];ba=aa.getEdgeFirstVertexIndex(ba);var Ea=ma.position;Y=Ea.typedBuffer;Ea=Ea.typedBufferStride;var Ka=ma.normalCompressed;const Ma=Ka.typedBuffer;Ka=Ka.typedBufferStride;const Ua=ma.uv0;var Ga=ra.vertexAttributes;fa=ra.getEdgeFirstVertexIndex(fa);ra=Ga.position.typedBuffer;const Na=Ga.position.typedBufferStride,Va=Ga.normalCompressed.typedBuffer;
Ga=Ga.normalCompressed.typedBufferStride;for(let gb=1;gb<ja-1;++gb){const cb=ba+gb;var Xa=fa+(ia+gb),Pa=cb*Ea,bb=Xa*Na;const ka=ra[bb]+Aa,mb=ra[bb+1]+ua;bb=ra[bb+2]+pa;Y[Pa]=ka;Y[Pa+1]=mb;Y[Pa+2]=bb;N(ka,mb,bb,oa);Pa=cb*Ka;Xa*=Ga;Ma[Pa]=Va[Xa];Ma[Pa+1]=Va[Xa+1];Pa=gb/Z;Xa=X?wa:b.clamp(Pa,qa,va);Pa=X?b.clamp(Pa,ta,Ca):Ba;e.encodeUVInBuffer(Ua,cb,Xa,Pa)}}function K(X){const {geometry:ba,geometryState:ia,localOrigin:fa,tile:da}=X,{clippingArea:aa,samplerData:ea}=ia,{minu:ha,minv:Y,maxu:Z,maxv:ja,boundingBox:oa,
vertexAttributes:qa}=ba,{surface:ta,ellipsoid:va,extent:Ca,extentInRadians:ma,horizontalScale:wa}=da,Ba="local"===ta.view?.viewingMode,pa=va.radius;let Aa=0,ra=0,ua=0;const Ea=()=>{const Sa=null!=aa&&(Ca[3]>aa[3]||Ca[2]>aa[2]||Ca[1]<aa[1]||Ca[0]<aa[0]),db=y(ta.isWebMercatorOnPlateCarree,pa,wa);return(eb,lb,sb)=>{eb=0===eb?Ca[0]:Ca[2];lb=0===lb?Ca[1]:Ca[3];eb=Sa?b.clamp(eb,aa[0],aa[2]):eb;lb=Sa?b.clamp(lb,aa[1],aa[3]):lb;Aa=eb*wa;ra=db(lb);ua=sb}},Ka=(Sa,db,eb)=>{var lb=ma[0===db?1:3];Sa=ma[0===Sa?
0:2];db=Math.cos(lb);lb=Math.sin(lb);const sb=Math.sin(Sa);eb=pa+eb;Aa=Math.cos(Sa)*db*eb;ra=sb*db*eb;ua=lb*eb},Ma=Ba?Ea():Ka;let Ua=0,Ga=0,Na=0,Va=0,Xa=0,Pa=0,bb=0,gb=0,cb=0;const ka=Ba&&ta.isWebMercatorOnPlateCarree,mb=(Sa,db,eb,lb,sb)=>{var vb=0,rb=0;let Eb=0;Ba?(eb=ka?(Math.PI/2-2*Math.atan(Math.exp(-eb/pa)))*pa:eb*wa,vb=db*wa-Aa,rb=eb-ra,Eb=lb-ua):(vb=q(Sa),Sa=Sa.tile,rb=Sa.extent,Sa=Sa.extentInRadians,db=(db-rb[0])/(rb[2]-rb[0]),db=Sa[0]*(1-db)+Sa[2]*db,vb=vb((eb-rb[1])/(rb[3]-rb[1])),eb=Math.cos(vb),
Sa=Math.sin(vb),rb=Math.sin(db),lb=pa+lb,vb=Math.cos(db)*eb*lb-Aa,rb=rb*eb*lb-ra,Eb=Sa*lb-ua);switch(sb){case 0:bb+=vb;gb+=rb;cb+=Eb;break;case 1:Va-=vb;Xa-=rb;Pa-=Eb;break;case 2:bb-=vb;gb-=rb;cb-=Eb;break;case 3:Va+=vb,Xa+=rb,Pa+=Eb}},qb=aa??V,tb=Ca[0],xa=Ca[2],Ia=Ca[1],na=Ca[3],ya=[na>qb[3],xa>qb[2],Ia<qb[1],tb<qb[0]],Da=Math.max(tb,qb[0]),Oa=Math.min(xa,qb[2]),Wa=Math.max(Ia,qb[1]),ab=Math.min(na,qb[3]),Ja=Sa=>{var db=ia.cornerNeighborCornerTiles;Ga=Ua=0;Na=1;cb=gb=bb=Pa=Xa=Va=0;var eb=Infinity;
for(var lb=0;4>lb;++lb)eb=Math.min(eb,db[4*Sa+lb]?.level??Infinity);for(lb=0;4>lb;++lb){var sb=db[4*Sa+lb];U[lb]=sb?.level===eb?sb:null}Sa=1;db=0;for(eb=0;4>eb;++eb)if(lb=U[eb])Sa=Math.max(Sa,lb?.renderData.geometryState.numVerticesPerSide),db=lb.extent[2]-lb.extent[0];l.internalAssert(1<Sa);Sa=db/Sa;for(db=0;4>db;++db){sb=U[(db+3)%4];var vb=U[db%4];if(sb||vb){lb=0===db?1:1===db?2:2===db?3:0;var rb=0===db?2:1===db?3:2===db?0:1;if(sb&&vb){var Eb=T[db][0]*Sa,Lb=T[db][1]*Sa,Yb=sb.extent;eb=Math.max(qb[0],
Math.min(qb[2],Yb[0===lb||1===lb?2:0]+Eb));lb=Math.max(qb[1],Math.min(qb[3],Yb[0===lb||3===lb?3:1]+Lb));Yb=vb.extent;Eb=Math.max(qb[0],Math.min(qb[2],Yb[0===rb||1===rb?2:0]+Eb));rb=Math.max(qb[1],Math.min(qb[3],Yb[0===rb||3===rb?3:1]+Lb));sb=sb.renderData;Lb=vb.renderData;vb=k.sampleElevation(eb,lb,sb.geometryState.samplerData);rb=k.sampleElevation(Eb,rb,Lb.geometryState.samplerData);mb(sb,eb,lb,.5*(vb+rb),db)}else eb=sb??vb,sb=sb?lb:rb,vb=eb.extent,rb=T[db],lb=Math.max(qb[0],Math.min(qb[2],vb[0===
sb||1===sb?2:0]+rb[0]*Sa)),sb=Math.max(qb[1],Math.min(qb[3],vb[0===sb||3===sb?3:1]+rb[1]*Sa)),eb=eb.renderData,vb=k.sampleElevation(lb,sb,eb.geometryState.samplerData),mb(eb,lb,sb,vb,db)}}Ba||(Sa=Math.sqrt(Aa*Aa+ra*ra+ua*ua),Ua=Aa/Sa,Ga=ra/Sa,Na=ua/Sa);if(Ba||.999>Na*Na)Sa=Math.sqrt(Va*Va+Xa*Xa+Pa*Pa),Va/=Sa,Xa/=Sa,Pa/=Sa,Sa=Math.sqrt(bb*bb+gb*gb+cb*cb),bb/=Sa,gb/=Sa,cb/=Sa,Ua=Pa*gb-Xa*cb,Ga=Va*cb-Pa*bb,Na=Xa*bb-Va*gb,Sa=1/Math.sqrt(Ua*Ua+Ga*Ga+Na*Na),Ua*=Sa,Ga*=Sa,Na*=Sa},Ra=ia.cornerNeighborCornerTiles;
for(let Sa=0;4>Sa;++Sa){const db=Sa,eb=(Sa+1)%4,lb=0===Sa||1===Sa?1:0,sb=0===Sa||3===Sa?1:0,vb=b.clamp(lb,ha,Z),rb=b.clamp(sb,Y,ja),Eb=ba.getEdgeFirstVertexIndex(db),Lb=ba.getEdgeCount(db),Yb=0===Sa||3===Sa?Lb-1:0,bc=ba.getEdgeFirstVertexIndex(eb),fc=ba.getEdgeCount(eb),kc=0===Sa||1===Sa?fc-1:0;let Cb=-1;for(let Sb=0;4>Sb;++Sb){const jb=Ra[4*Sa+Sb],sa=Ra[4*Sa+Cb];jb&&(-1===Cb||0<r.compareTilesByLij(sa,jb))&&(Cb=Sb)}const Ib=Cb,Ub=Ra[4*Sa+Ib];if(Ub!==da){const Sb=da.level-Ub.level,jb=2**Sb,sa=[Ub.lij[0]+
Sb,Ub.lij[1]*jb,Ub.lij[2]*jb],Ha=[sa[1]+jb===da.lij[1],0===Sa&&(1===Ib||0===Ib&&Ub!==Ra[4*Sa+3])||1===Sa&&(0===Ib||1===Ib&&Ub!==Ra[4*Sa+2]),sa[1]===da.lij[1]+1,2===Sa&&(3===Ib||2===Ib&&Ub!==Ra[4*Sa+1])||3===Sa&&(2===Ib||3===Ib&&Ub!==Ra[4*Sa])],Qa=Ha.reduce((Db,Jb)=>Db+(Jb?1:0),0);l.internalAssert(1===Qa||2===Qa);let Ta=-1,Za=-1;const hb=Ub.renderData;if(1===Qa){const Db=Ha.findIndex(ic=>ic);l.internalAssert(0<=Db&&3>=Db);Ta=(Db+2)%4;const Jb=ia.edgeResolutions[Db];Za=da.getNeighborEdgeStartVertexIndex(Db,
Ub)*Jb+Jb*(0===Db&&0===Sa||1===Db&&0===Sa||2===Db&&1===Sa||3===Db&&3===Sa?1:0)}else{l.internalAssert(Ha[1]||Ha[3]);Ta=Ha[1]?3:1;const Db=hb.geometryState.edgeResolutions[Ta];Za=0===Sa||3===Sa?0:Db}const ib=hb.geometry,pb=Eb+Yb,ob=bc+kc,yb=ib.getEdgeFirstVertexIndex(Ta)+Za,wb=ib.vertexAttributes,Fb=hb.localOrigin,zb=wb.position,Tb=zb.typedBuffer,nb=yb*zb.typedBufferStride,xb=Tb[nb]+Fb[0]-fa[0],Ab=Tb[nb+1]+Fb[1]-fa[1],Mb=Tb[nb+2]+Fb[2]-fa[2];N(xb,Ab,Mb,oa);const gc=qa.position,Vb=gc.typedBuffer,Zb=
pb*gc.typedBufferStride;Vb[Zb]=xb;Vb[Zb+1]=Ab;Vb[Zb+2]=Mb;const hc=ob*gc.typedBufferStride;Vb[hc]=xb;Vb[hc+1]=Ab;Vb[hc+2]=Mb;const Qb=qa.uv0;e.encodeUVInBuffer(Qb,pb,vb,rb);e.encodeUVInBuffer(Qb,ob,vb,rb);const Nb=wb.normalCompressed.typedBuffer,Wb=yb*wb.normalCompressed.typedBufferStride,Hb=qa.normalCompressed,Gb=Hb.typedBuffer,Xb=pb*Hb.typedBufferStride;Gb[Xb]=Nb[Wb];Gb[Xb+1]=Nb[Wb+1];const $b=ob*Hb.typedBufferStride;Gb[$b]=Nb[Wb];Gb[$b+1]=Nb[Wb+1]}else{const Sb=ya[eb];let jb=void 0;if(ya[db]||
Sb){const Ta=b.clamp(tb*(1-lb)+xa*lb,Da,Oa),Za=b.clamp(Ia*(1-sb)+na*sb,Wa,ab);jb=k.sampleElevation(Ta,Za,ea)}else jb=L(Ra,Sa);Ma(lb,sb,jb);Ja(Sa);const sa=Aa-fa[0],Ha=ra-fa[1],Qa=ua-fa[2];N(sa,Ha,Qa,oa);ba.setEdgeVertexFromValuesRawPositionUVNormal(db,Yb,sa,Ha,Qa,vb,rb,Ua,Ga,Na);ba.setEdgeVertexFromValuesRawPositionUVNormal(eb,kc,sa,Ha,Qa,vb,rb,Ua,Ga,Na)}}for(let Sa=0;4>Sa;++Sa)U[Sa]=null}function L(X,ba){const ia=4*ba;ba=c.zeroToFour.reduce((ea,ha)=>Math.min(ea,X[ia+ha]?.level??Infinity),Infinity);
l.enableTerrainInternalChecks&&(l.internalAssert(!X[ia+0]||!X[ia+2]||f.isCornerNeighbor(X[ia+0],X[ia+2],g.NeighborIndex.SOUTH_WEST)),l.internalAssert(!X[ia+1]||!X[ia+3]||f.isCornerNeighbor(X[ia+1],X[ia+3],g.NeighborIndex.NORTH_WEST)));let fa=0,da=0;for(let ea=0;4>ea;++ea){var aa=X[ia+ea];if(aa&&aa.level===ba){const ha=aa.extent;aa=k.sampleElevation(ha[0===ea||1===ea?0:2],ha[0===ea||3===ea?1:3],aa.renderData?.geometryState?.samplerData);da+=aa;fa++}}ba=fa?da/fa:0;l.internalAssert(null!=ba);return ba}
function F(X){const {vao:ba,geometry:ia}=X,{vertexAttributes:fa,edgeVerticesStartIndex:da}=ia;X=fa.position.typedBuffer;ba.vertexBuffers.geometry.setSubData(X,da,da,X.length)}function M(X){const {vao:ba,geometry:ia}=X,{indices:fa,indexCount:da,edgeIndicesStartIndex:aa}=ia;ba.indexBuffer.setSubData(fa,aa,aa,da)}function S(X,ba,ia){if(!ba)return!1;X=r.compareTilesByLij(X,ba);return 0<X||0===X&&2<=ia}function N(X,ba,ia,fa){X<fa[0]?fa[0]=X:X>fa[3]&&(fa[3]=X);ba<fa[1]?fa[1]=ba:ba>fa[4]&&(fa[4]=ba);ia<
fa[2]?fa[2]=ia:ia>fa[5]&&(fa[5]=ia)}function P(X){const {edgeResolutions:ba,numVerticesPerSide:ia}=X;X=1+Math.max(...ba);return Math.max(ia,X)}function R(X,ba,ia,fa,da,aa){var ea=X*da;X=aa[ea];const ha=aa[ea+1];ea=aa[ea+2];var Y=ba*da;ba=aa[Y];const Z=aa[Y+1];Y=aa[Y+2];var ja=ia*da;ia=aa[ja];const oa=aa[ja+1];ja=aa[ja+2];const qa=fa*da;fa=aa[qa];da=aa[qa+1];aa=aa[qa+2];return(ba-fa)*(ba-fa)+(Z-da)*(Z-da)+(Y-aa)*(Y-aa)>(X-ia)*(X-ia)+(ha-oa)*(ha-oa)+(ea-ja)*(ea-ja)}function O(X,ba,ia,fa,da){X[ba]=ia;
X[ba+1]=fa;X[ba+2]=fa;X[ba+3]=da;X[ba+4]=da;X[ba+5]=ia}const T=[[0,1],[1,0],[0,-1],[-1,0]],Q=new d.PatchGeometryLUT,V=h.fromValues(-Infinity,-Infinity,Infinity,Infinity),U=[null,null,null,null];class W{constructor(){this.vertex0Index=0;this.stride=1;this.count=0}getVertexIndex(X){l.internalAssert(0<=X&&X<this.count);return this.vertex0Index+this.stride*X}}const ca=[new W,new W,new W,new W];a.createPlanarGlobePatch=function(X,ba){const {tile:ia,geometryState:fa,geometry:da}=X,{extent:aa,surface:ea}=
ia,{wireframe:ha}=fa,Y=aa[0],Z=aa[1],ja=aa[2]-Y,oa=aa[3]-Z,{numVerticesPerSide:qa,clippingArea:ta}=fa,va=null!=ta?Math.max(0,(ta[0]-Y)/ja):0,Ca=null!=ta?Math.max(0,(ta[1]-Z)/oa):0,ma=null!=ta?Math.min(1,(ta[2]-Y)/ja):1,wa=null!=ta?Math.min(1,(ta[3]-Z)/oa):1,Ba=(qa-2)**2,pa=P(fa),Aa=ea.renderer.tileGeometryCache.acquire(Ba+4*pa),{boundingBox:ra}=da;n.empty(ra);da.numVerticesPerSide=qa;da.vertexAttributes=Aa;da.maxEdgeVertexCount=pa;da.minu=va;da.minv=Ca;da.maxu=ma;da.maxv=wa;{const {tile:jb}=X;if(jb.intersectsClippingArea){var {geometry:ua,
geometryState:Ea,localOrigin:Ka}=X,{samplerData:Ma,clippingArea:Ua,numVerticesPerSide:Ga}=Ea,{surface:Na,extent:Va,ellipsoid:Xa}=jb,{isWebMercatorOnPlateCarree:Pa}=Na,bb=null!=Ua?Ua:V,gb=Va[0],cb=Va[1],ka=Va[2],mb=Va[3],qb=Math.max(gb,bb[0]),tb=Math.min(ka,bb[2]),xa=Math.max(cb,bb[1]),Ia=Math.min(mb,bb[3]),na=Xa.radius,ba=jb.horizontalScale,ya=Ga-1,Da=Ga-2,{minu:Oa,minv:Wa,maxu:ab,maxv:Ja,boundingBox:Ra,vertexAttributes:Sa}=ua,db=Sa.position,eb=Sa.uv0,{typedBuffer:lb,typedBufferStride:sb}=Sa.normalCompressed,
vb=Ka[0],rb=Ka[1],Eb=Ka[2],Lb=db.typedBuffer,Yb=db.typedBufferStride,bc=0,fc=b.clamp(cb,xa,Ia),kc=Pa?(Math.PI/2-2*Math.atan(Math.exp(-fc/na)))*na:fc*ba,Cb=1/ya,Ib=b.clamp(cb*(1-Cb)+mb*Cb,xa,Ia),Ub=kc,Sb=Pa?(Math.PI/2-2*Math.atan(Math.exp(-Ib/na)))*na:Ib*ba;for(let sa=1;sa<=Da;sa++){const Ha=sa/ya,Qa=b.clamp(cb*(1-Ha)+mb*Ha,xa,Ia),Ta=b.clamp(Ha,Wa,Ja),Za=Sb,hb=(sa-1)/ya,ib=b.clamp(cb*(1-hb)+mb*hb,xa,Ia),pb=Ub,ob=(sa+1)/ya,yb=b.clamp(cb*(1-ob)+mb*ob,xa,Ia),wb=Pa?(Math.PI/2-2*Math.atan(Math.exp(-yb/
na)))*na:yb*ba,Fb=b.clamp(ob,Wa,Ja);Ub=Sb;Sb=wb;const zb=b.clamp(gb,qb,tb);let Tb=zb*ba,nb=k.sampleElevation(zb,Qa,Ma);const xb=1/ya,Ab=b.clamp(xb,Oa,ab),Mb=b.clamp(gb*(1-Ab)+ka*Ab,qb,tb);let gc=Ab,Vb=Mb,Zb=Mb*ba,hc=k.sampleElevation(Mb,Qa,Ma);if(1===sa){const Qb=Zb-vb,Nb=Ub-rb,Wb=hc-Eb,Hb=0*Yb;Lb[Hb]=Qb;Lb[Hb+1]=Nb;Lb[Hb+2]=Wb;N(Qb,Nb,Wb,Ra);const Gb=b.clamp(xb,Oa,ab);e.encodeUVInBuffer(eb,bc,Gb,Ta)}for(let Qb=1;Qb<=Da;Qb++){const Nb=Zb,Wb=hc,Hb=(Qb+1)/ya,Gb=b.clamp(Hb,Oa,ab),Xb=b.clamp(gb*(1-Hb)+
ka*Hb,qb,tb),$b=Vb;Vb=Xb;const Db=bc+1,Jb=Db*Yb;if(1===sa||Qb===Da){const Fc=k.sampleElevation(Xb,Qa,Ma),Mc=Xb*ba,Yc=Za,Uc=Fc;if(1===sa&&Qb<Da){const Dc=Mc-vb,yc=Yc-rb,pc=Uc-Eb;Lb[Jb]=Dc;Lb[Jb+1]=yc;Lb[Jb+2]=pc;N(Dc,yc,pc,Ra);e.encodeUVInBuffer(eb,Db,Gb,Ta)}Zb=Mc;hc=Uc}else Zb=Lb[Jb]+vb,hc=Lb[Jb+2]+Eb;const ic=Zb,ac=hc,mc=Tb,Rb=nb;Tb=Nb;nb=Wb;const cc=(bc-Da)*Yb,rc=1===sa?k.sampleElevation($b,ib,Ma):Lb[cc+2]+Eb,oc=k.sampleElevation($b,yb,Ma);if(sa<Da){const Fc=bc+Da,Mc=Fc*Yb,Yc=Nb-vb,Uc=wb-rb,Dc=
oc-Eb;Lb[Mc]=Yc;Lb[Mc+1]=Uc;Lb[Mc+2]=Dc;N(Yc,Uc,Dc,Ra);const yc=gc;gc=Gb;e.encodeUVInBuffer(eb,Fc,yc,Fb)}const Bc=ic-mc,Cc=pb-wb,vc=Cc*(ac-Rb),nc=Bc*(rc-oc),wc=-Cc*Bc,xc=vc*vc+nc*nc+wc*wc;if(0===xc)x.compressNormal(lb,bc,0,0,1,sb);else{const Fc=1/Math.sqrt(xc);x.compressNormal(lb,bc,vc*Fc,nc*Fc,wc*Fc,sb)}++bc}}}}da.edgeVerticesStartIndex=Ba;J(X);u(X);D(da,[],ha);X.intersectionData=null};a.createSphericalGlobePatch=function(X,ba){const {tile:ia,geometry:fa,geometryState:da}=X,{extentInRadians:aa,surface:ea}=
ia,{isWebMercator:ha,renderer:Y}=ea,{numVerticesPerSide:Z,wireframe:ja}=da,oa=Z-1,qa=(Z-2)**2,ta=ha&&(ba===m.PatchType.HAS_SOUTH_POLE||ba===m.PatchType.HAS_BOTH_POLES),va=ha&&(ba===m.PatchType.HAS_NORTH_POLE||ba===m.PatchType.HAS_BOTH_POLES),Ca=6*((ta?1:0)+(va?1:0))*Z,ma=P(da),wa=Y.tileGeometryCache.acquire(qa+Ca+4*ma);fa.numVerticesPerSide=Z;fa.vertexAttributes=wa;fa.maxEdgeVertexCount=ma;const {boundingBox:Ba}=fa;n.empty(Ba);const pa=q(X);Q.update(oa,aa,pa);{const {tile:Ja}=X;if(Ja.intersectsClippingArea){var {geometry:Aa,
geometryState:ra,localOrigin:ua}=X,{numVerticesPerSide:Ea,samplerData:Ka}=ra,Ma=Ea-2,Ua=Ea-1,{vertexAttributes:Ga,boundingBox:Na}=Aa,Va=Ga.position,Xa=Ga.uv0,{typedBuffer:Pa,typedBufferStride:bb}=Ga.normalCompressed,{extent:gb}=Ja,cb=gb[0],ka=gb[2],mb=gb[1],qb=gb[3],tb=Ja.ellipsoid.radius,xa=ua[0],Ia=ua[1],na=ua[2],ya=Va.typedBuffer,Da=Va.typedBufferStride,Oa=1/Ua,Wa=0;if(1<=Ma){const Ra=mb*(1-Oa)+qb*Oa,Sa=Q.sinLatLUT[1],db=Q.cosLatLUT[1];for(let eb=1;eb<=Ma;eb++){const lb=eb*Oa,sb=Q.sinLonLUT[eb],
vb=Q.cosLonLUT[eb],rb=tb+k.sampleElevation(cb*(1-lb)+ka*lb,Ra,Ka),Eb=-xa+rb*vb*db,Lb=-Ia+rb*sb*db,Yb=-na+rb*Sa;N(Eb,Lb,Yb,Na);const bc=(eb-1)*Da;ya[bc]=Eb;ya[bc+1]=Lb;ya[bc+2]=Yb;e.encodeUVInBuffer(Xa,eb-1,lb,Oa)}}for(let Ra=1;Ra<=Ma;Ra++){const Sa=Ra*Oa,db=mb*(1-Sa)+qb*Sa,eb=Q.sinLatLUT[Ra],lb=Q.cosLatLUT[Ra],sb=Ra+1,vb=sb*Oa,rb=mb*(1-vb)+qb*vb,Eb=Q.sinLatLUT[sb],Lb=Q.cosLatLUT[sb],Yb=Q.sinLonLUT[0],bc=Q.cosLonLUT[0],fc=tb+k.sampleElevation(cb,db,Ka);let kc=bc*lb*fc-xa,Cb=Yb*lb*fc-Ia,Ib=eb*fc-na;
const Ub=Wa*Da;let Sb=ya[Ub],jb=ya[Ub+1],sa=ya[Ub+2];for(let Ha=1;Ha<=Ma;Ha++){const Qa=Ha*Oa,Ta=cb*(1-Qa)+ka*Qa,Za=Q.sinLonLUT[Ha],hb=Q.cosLonLUT[Ha];let ib=0,pb=0,ob=0;if(Ha<Ma){const Db=(Wa+1)*Da;ib=ya[Db];pb=ya[Db+1];ob=ya[Db+2]}else{const Db=Q.sinLonLUT[Ua],Jb=Q.cosLonLUT[Ua],ic=tb+k.sampleElevation(ka,db,Ka);ib=Jb*lb*ic-xa;pb=Db*lb*ic-Ia;ob=eb*ic-na}const yb=kc,wb=Cb,Fb=Ib;kc=Sb;Cb=jb;Ib=sa;Sb=ib;jb=pb;sa=ob;const zb=ib-yb,Tb=pb-wb,nb=ob-Fb;let xb=0,Ab=0,Mb=0;if(1<Ra){const Db=(Wa-Ma)*Da;xb=
ya[Db];Ab=ya[Db+1];Mb=ya[Db+2]}else{const Db=Q.sinLatLUT[0],Jb=Q.cosLatLUT[0],ic=tb+k.sampleElevation(Ta,mb,Ka);xb=hb*Jb*ic-xa;Ab=Za*Jb*ic-Ia;Mb=Db*ic-na}const gc=tb+k.sampleElevation(Ta,rb,Ka),Vb=hb*Lb*gc-xa,Zb=Za*Lb*gc-Ia,hc=Eb*gc-na;if(Ra<Ma){const Db=Wa+Ma,Jb=Db*Da;ya[Jb]=Vb;ya[Jb+1]=Zb;ya[Jb+2]=hc;N(Vb,Zb,hc,Na);e.encodeUVInBuffer(Xa,Db,Qa,vb)}const Qb=xb-Vb,Nb=Ab-Zb,Wb=Mb-hc;let Hb=hb*lb,Gb=Za*lb,Xb=eb;.999>Xb*Xb&&(Hb=nb*Nb-Tb*Wb,Gb=zb*Wb-nb*Qb,Xb=Tb*Qb-zb*Nb);const $b=1/Math.sqrt(Hb*Hb+Gb*
Gb+Xb*Xb);x.compressNormal(Pa,Wa,Hb*$b,Gb*$b,Xb*$b,bb);++Wa}}}}fa.poleVerticesStartIndex=qa;const ab=w(X,ta,va);fa.edgeVerticesStartIndex=qa+Ca;J(X);p(X);D(fa,ab,ja);X.intersectionData=null};a.updateCornerSpherical=function(X){X.tile.intersectsClippingArea&&(K(X),t(X,!0),F(X),X.intersectionData=null)};a.updateCornersPlanar=function(X,ba){X.tile.intersectsClippingArea&&(K(X),v(X,!0),F(X),X.intersectionData=null)};a.updateEdgeElevationsAndResolutionsPlanar=function(X,ba){X.tile.intersectsClippingArea&&
(B(X),u(X),F(X),M(X),X.intersectionData=null)};a.updateEdgeElevationsAndResolutionsSpherical=function(X){X.tile.intersectsClippingArea&&(B(X),p(X),F(X),M(X),X.intersectionData=null)};a.updateEdgesAndCornersPlanar=function(X,ba){X.tile.intersectsClippingArea&&(u(X),F(X),X.intersectionData=null)};a.updateEdgesAndCornersSpherical=function(X){X.tile.intersectsClippingArea&&(p(X),F(X),X.intersectionData=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/maybe ../../../chunks/vec32 ../../../geometry/support/aaBoundingBox ./terrainUtils ../webgl-engine/lib/Normals".split(" "),
function(a,b,n,h,k,m){function g(d,c,l,f){d.setValues(c,16384*l,16384*f)}class e{constructor(){this.indices=null;this.poleIndicesStartIndex=this.edgeIndicesStartIndex=this.indexCount=0;this.vertexAttributes=null;this.maxEdgeVertexCount=this.poleVerticesStartIndex=this.edgeVerticesStartIndex=0;this.boundingBox=h.empty();this.minv=this.minu=this.numVerticesPerSide=0;this.maxv=this.maxu=1;this.outerEdgesOffsetAndLength=[0,0,0,0,0,0,0,0]}release(){this.vertexAttributes=b.releaseMaybe(this.vertexAttributes);
this.indices=null}reset(){this.vertexAttributes=this.indices=null;h.empty(this.boundingBox);this.numVerticesPerSide=0}getEdgeFirstVertexIndex(d){return this.outerEdgesOffsetAndLength[2*d]}getEdgeCount(d){return this.outerEdgesOffsetAndLength[2*d+1]}getEdgeVertexIndex(d,c){return this.getEdgeAttributeIndex(d,c)}getEdgeVertexPosition(d,c,l,f){this._getEdgeVertexRaw(this.getEdgeAttributeIndex(d,f),c);n.add(c,c,l)}getEdgeNormal(d,c,l){const {typedBuffer:f,typedBufferStride:r}=this.vertexAttributes.normalCompressed;
m.decompressNormal(c,f,this.getEdgeAttributeIndex(d,l),r)}setEdgeNormalFromValues(d,c,l,f,r){this._setNormal(this.getEdgeAttributeIndex(d,c),l,f,r)}setEdgeVertexFromValuesRawPositionUV(d,c,l,f,r,x,w){d=this.getEdgeAttributeIndex(d,c);this.vertexAttributes.position.setValues(d,l,f,r);this._setUV(d,x,w)}setEdgeVertexFromValuesRawPositionUVNormal(d,c,l,f,r,x,w,p,t,q){d=this.getEdgeAttributeIndex(d,c);this.vertexAttributes.position.setValues(d,l,f,r);this._setUV(d,x,w);this._setNormal(d,p,t,q)}_getEdgeVertexRaw(d,
c){this.vertexAttributes.position.getVec(d,c)}_setNormal(d,c,l,f){const {typedBuffer:r,typedBufferStride:x}=this.vertexAttributes.normalCompressed;m.compressNormal(r,d,c,l,f,x)}_setUV(d,c,l){g(this.vertexAttributes.uv0,d,c,l)}getEdgeAttributeIndex(d,c){k.internalAssert(0<=c&&c<this.getEdgeCount(d));return this.getEdgeFirstVertexIndex(d)+c}}a.PatchGeometry=e;a.encodeUVInBuffer=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports",
"./TerrainConst"],function(a,b){class n{constructor(){this.sinLonLUT=Array(b.maxPatchTesselation+1);this.cosLonLUT=Array(b.maxPatchTesselation+1);this.sinLatLUT=Array(b.maxPatchTesselation+1);this.cosLatLUT=Array(b.maxPatchTesselation+1)}update(h,k,m){const g=k[0];k=k[2];for(let d=0;d<=h;d++){var e=d/h;const c=g*(1-e)+k*e;this.sinLonLUT[d]=Math.sin(c);this.cosLonLUT[d]=Math.cos(c);e=m(e);this.sinLatLUT[d]=Math.sin(e);this.cosLatLUT[d]=Math.cos(e)}}}a.PatchGeometryLUT=n;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./ITile ./LayerClass ./PatchGeometry ./TerrainConst ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(F,M){return M?.isLoaded||M===F?M:null}class C{constructor(){this.geometry=new r.PatchGeometry;this._texture=this._vao=this.geometryState=this.intersectionData=null;this._textureRef=new p.TextureFader(()=>this.tile.surface.fadeDuration);this.overlay=new q;this._localOrigin=null;this._geometryStateChangedSinceLastUpdate=!0;this._hasGeometry=!1;this._modifiedFlags=0}get tile(){return this._tile}get localOrigin(){return this._localOrigin}init(F,
M){this.clear();this._tile=F;this.geometry.reset();this.intersectionData=null;this.geometryState=new c.GeometryState;this._localOrigin=M;this.overlay.clear()}clear(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=null}updateGeometryIfNeeded(F){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this.wireframeChanged||this.clippingAreaChanged||this.samplerDataChanged||this.numVerticesPerSideChanged||this.dirtyCorners||
this.dirtyEdgeResolutions||this.dirtyEdges)this._updateGeometry(F),this._geometryStateChangedSinceLastUpdate=!1;if(w.enableTerrainInternalChecks&&this.tile.intersectsClippingArea)for(F=0;4>F;++F)w.internalAssert(this.geometry.getEdgeCount(F)===this.geometryState.edgeResolutions[F]+1)}_calculateEdgeResolution(F,M){const S=this.tile,N=this.geometryState.numVerticesPerSide-1;if(!S.surface.isGlobal){var P=S.surface.extent;if(null!=P&&(0===F&&S.extent[3]>P[3]||1===F&&S.extent[2]>P[2]||2===F&&S.extent[1]<
P[1]||3===F&&S.extent[0]<P[0]))return N}const R=S.level;P=w.neighborEdgeIndices[F];if(!M)return w.internalAssert(null==S.surface?.rootTiles||S.surface.updatingRootTiles||!S.shouldHaveNeighbor(P)),N;if(M.isLoaded)return P=M.renderData.geometryState,M=R-M.level,w.internalAssert(0<=M),0===M?Math.max(P.numVerticesPerSide-1,N):Math.max(1,P.edgeResolutions[(F+2)%4]/2**M);w.internalAssert(!M.isLeaf);let O=N;M.forAllSubtreeOnSide(w.oppositeEdge(P),T=>{if(T===S)return!0;if(T.isLoaded)return O=Math.max(O,2**
(T.level-R)),!0;w.internalAssert(!T.isLeaf);return!1});return O}updateNeighborData(){const F=this.tile;if(F.intersectsClippingArea){var M=F.renderData.geometryState,S=U=>(U.isLoaded||U.level===F.level)&&U?.intersectsClippingArea,N=M.edgePeerNeighbors,P=M.edgePeerNeighborSamplerVersions;for(var R=0;4>R;++R){var O=F.findNeighborTile(w.neighborEdgeIndices[R],S),T=A(F,O),Q=T?.renderData?.geometryState.samplerDataVersion??-1,V=A(F,N[R]);T=T!==V;V=P[R]!==Q;w.enableTerrainInternalChecks&&O&&(w.internalAssert(F.level>=
O.level),w.internalAssert(F.level-O.level<=x.maxTileNeighborLevelDelta));N[R]=O;if(T||V)P[R]=Q,this._markEdgeDirty(R);Q=M.edgeResolutions[R];O=this._calculateEdgeResolution(R,O);w.internalAssert(n.isPowerOfTwo(O));w.internalAssert(1<=O);M.edgeResolutions[R]=O;Q!==O&&this._markEdgeResolutionDirty(R)}for(let U=0;4>U;++U){O=F.findNeighborTile(w.neighborCornerIndices[U],S);M.cornerPeerNeighbors[U]=O;P=A(F,N[U]);R=A(F,N[(U+1)%4]);O=A(F,O);K[U]=O;K[(U+1)%4]=R;K[(U+2)%4]=F;K[(U+3)%4]=P;w.internalAssert(K.some(X=>
X?.isLoaded||X===F));const W=K.reduce((X,ba)=>Math.min(X,ba?.level??Infinity),Infinity);K.forEach((X,ba)=>{X&&X?.level>W&&(K[ba]=null)});w.internalAssert(K.some(X=>X?.isLoaded||X===F));const ca=M.cornerNeighborCornerTiles;P=M.cornerNeighborCornerTileSamplerVersions;for(R=0;4>R;++R){O=K[R];Q=O?.renderData.geometryState.samplerDataVersion??-1;T=4*U+R;V=ca[T]!==O;const X=!V&&P[T]!==Q;if(V||X)ca[T]=O,P[T]=Q,this._markCornerDirty(U)}w.enableTerrainInternalChecks&&w.internalAssert(L.some(X=>ca[4*U+X]?.isLoaded||
ca[4*U+X]===F))}w.enableTerrainInternalChecks&&w.internalAssert(this.geometryState.edgeResolutions.every(U=>0<U));for(M=0;4>M;++M)K[M]=null}}_updateGeometry(F){if(this.tile.intersectsClippingArea){w.enableTerrainInternalChecks&&w.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.edgeResolutions.every(V=>0<V));this.intersectionData=null;var {tile:M,_vao:S,geometry:N,geometryState:P}=this,R={geometry:N},O=!S||!R||this.wireframeChanged||this.samplerDataChanged||this.clippingAreaChanged||
this.numVerticesPerSideChanged;R=0!==this.dirtyEdgeResolutions;var T=P.edgeResolutions.reduce((V,U)=>V+U+1,0);O=O||R&&T>(N?.maxEdgeVertexCount??0);T=!O&&R;R=!T&&(0!==this.dirtyEdges||R);var Q=!R&&0!==this.dirtyCorners;O?(this.releaseGeometry(),this._createGeometry(F)):T?M.updateEdgeElevationsAndResolutions():R||Q?M.updateEdgeElevations():Q?M.updateCornerElevations():console.warn("Update for no reason?");this._modifiedFlags=0}}get hasGeometry(){return this._hasGeometry}releaseGeometry(){this._hasGeometry=
!1;this.intersectionData=null;if(!this._vao)return!1;this._vao=h.disposeMaybe(this._vao);this.geometry.release();return!0}ensureTexture(F,M,S){M=M?G.PixelFormat.RGBA:G.PixelFormat.RGB;null==this._texture||this._texture.descriptor.width===F&&this._texture.descriptor.pixelFormat===M||this.releaseTexture();null==this._texture&&(this._texture=S(),this.tile.setMemoryDirty());return this._texture}releaseTexture(){null!=this._texture&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}get numVerticesPerSideChanged(){return 0!==
(this._modifiedFlags&1)}get samplerDataChanged(){return 0!==(this._modifiedFlags&2)}get clippingAreaChanged(){return 0!==(this._modifiedFlags&4)}get wireframeChanged(){return 0!==(this._modifiedFlags&8)}get dirtyEdges(){return this._modifiedFlags>>4&15}get dirtyCorners(){return this._modifiedFlags>>8&15}get dirtyEdgeResolutions(){return this._modifiedFlags>>12&15}_markCornerDirty(F){this._modifiedFlags|=1<<F<<8}_markEdgeDirty(F){this._modifiedFlags|=1<<F<<4;this._markCornerDirty((F+0)%4);this._markCornerDirty((F+
3)%4)}_markEdgeResolutionDirty(F){this._modifiedFlags|=1<<F<<12;this._markEdgeDirty(F)}_markAllEdgesAndCornersDirty(){this._modifiedFlags|=65520}updateGeometryState(){var F=this._getElevationInfo();const M=this.tile;var S=F.samplerData?M.getElevationVerticesPerSide(F.maxTileLevel):M.getDefaultVerticesPerSide();const N=Math.max(S,5);let P=M.clippingArea;if(!M.intersectsClippingArea||M.isWithinClippingArea)P=null;S=this.geometryState;let R=!1;S.numVerticesPerSide!==N&&(this._modifiedFlags|=1,S.numVerticesPerSide=
N,S.samplerDataVersion++,R=!0);F.changed&&(this._modifiedFlags|=2,S.samplerData=F.samplerData,S.samplerDataVersion++,R=!0);b.equals(S.clippingArea,P)||(this._modifiedFlags=4,S.clippingArea=P,R=!0);F=M.surface.wireframe;S.wireframe!==F&&(this._modifiedFlags=8,S.wireframe=F,R=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=R);R&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate}_createGeometry(F){this.tile.createGeometry();
const M=this.geometry.vertexAttributes,S=this.geometry.indices,N=F.gl;this._vao=new v.VertexArrayObject(F,y.terrainVertexAttributeLocations,{geometry:d.glLayout(M.layout)},{geometry:D.BufferObject.createVertex(F,N.STATIC_DRAW,M.buffer)},D.BufferObject.createIndex(F,N.STATIC_DRAW,S));this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(F,M=p.ActivationTime.Immediate){null!=F&&F.texture!==this._texture&&this.releaseTexture();this._textureRef.push(F,M)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){var F=
this.geometryState.samplerData;const M=this.tile.layerInfo[f.LayerClass.ELEVATION],S=M.length,N=Array(S);let P=0;var R=0;let O=!1;for(let V=0;V<S;V++){var T=M[V];if(null!=T.upsampleInfo){T=T.upsampleInfo.tile;var Q=T.layerInfo[f.LayerClass.ELEVATION][V].data;Q=Q&&Q.samplerData;F&&F[P]===Q||(O=!0);N[P++]=Q;R=Math.max(R,T.lij[0])}else T.data&&(Q=this.tile.surface.layerViewByIndex(V,f.LayerClass.ELEVATION),u.fallsWithinLayer(this.tile,Q.layer,!1)&&(R=T.data,F&&F[P]===R.samplerData||(O=!0),N[P++]=R.samplerData,
R=this.tile.level))}null!=F&&F.length!==P&&(O=!0);if(F=0<P)N.length=P;return{changed:O,samplerData:F?N:null,maxTileLevel:R}}get estimatedGeometryMemoryUsage(){return(this.geometry.indices?.byteLength??0)+(this.geometry.vertexAttributes?.byteLength??0)+(this.intersectionData?.estimatedMemoryUsage??0)}get texture(){return this._texture}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){if(w.enableTerrainInternalChecks){var F=this.tile;if(F.isLoaded&&F.intersectsClippingArea&&
0!==F.level){var M=F.surface.extent;if(null==M||F.intersectsExtent(M)){var S=w.neighborEdgeIndices.map((O,T)=>null!=M?0>(2>T?-1:1)*(F.extent[3-T]-M[3-T]):!1),N=F.level;w.internalAssert(0===this.dirtyCorners);w.internalAssert(0===this.dirtyEdges);w.internalAssert(0===this.dirtyEdgeResolutions);w.internalAssert(!this.numVerticesPerSideChanged);w.internalAssert(!this.samplerDataChanged);w.internalAssert(!this.clippingAreaChanged);w.internalAssert(!this.wireframeChanged);var P=w.neighborCornerIndices.map(O=>
F.findNeighborCornerTileExact(O,T=>!T.intersectsClippingArea||T.isLoaded||T.level===F.level)??null).map(O=>O?.intersectsClippingArea?O:null),R=this.geometryState;for(let O=0;4>O;++O){const T=R.cornerPeerNeighbors[O],Q=P[O];w.internalAssert(Q===T,`Tile[${F.lij}].corner[${O}] out of date: cur=[${T?.lij}] exp=[${Q?.lij}]`)}w.neighborEdgeIndices.forEach((O,T)=>{if(!S[T]){var Q=F.findNeighborTile(O,Ba=>(Ba.level===N||Ba?.isLoaded)&&Ba?.intersectsClippingArea);if(Q){w.internalAssert(Q.isLoaded||Q.level===
F.level);w.internalAssert(Q===this.geometryState.edgePeerNeighbors[T]);var V=N-Q.level;if(Q.isLoaded){var U=Q.renderData;w.internalAssert(t.isEdgeNeighbor(F,Q,O));w.internalAssert(0<=V);var W=2**V;if(0>V)w.internalAssert(!1);else{var ca=F.renderData,X=ca.geometry,ba=ca.localOrigin,ia=X.getEdgeCount(T),fa=X.numVerticesPerSide-1,da=U.geometry;if(da){var aa=U.localOrigin,ea=this.geometryState.edgePeerNeighbors[T];ea?.isLoaded&&(ea=ea.renderData,w.internalAssert(ca.geometryState.edgePeerNeighborSamplerVersions[T]===
ea.geometryState.samplerDataVersion),w.internalAssert(this.geometryState.edgePeerNeighborSamplerVersions[T]===ea.geometryState.samplerDataVersion));var ha=(T+2)%4,Y=da.getEdgeCount(ha);ea=ia-1;var Z=Y-1;w.internalAssert(ea*W===Z,`Tile[${F.lij}]:e${T},res=${ea} edgeRes mismatch with`+` Neighbor[${Q.lij}]:e${ha},res=${Z} (expected:${ea*W})`);ea=F.extent;Z=O===l.NeighborIndex.NORTH||O===l.NeighborIndex.SOUTH;var ja=Y-1,oa=ja>>V,qa=ia-1;if(1>oa)w.internalAssert(1===qa);else{w.internalAssert(oa===qa);
w.internalAssert(n.isPowerOfTwo(oa));qa=da.numVerticesPerSide-1;w.internalAssert(0<V||oa===Math.max(qa,fa));V=F.getNeighborEdgeStartVertexIndex(T,Q);w.internalAssert(0<=V&&V<W);W=V*oa;w.internalAssert(0<=W&&W<=ja-oa);var ta=0,va=W;X.getEdgeVertexPosition(T,E,ba,0);X.getEdgeVertexPosition(T,I,ba,ia-1);W=k.distance(E,I);W=Math.max(1,1E-4*W);for(V=0;V<=oa;++V){X.getEdgeVertexPosition(T,E,ba,ta);da.getEdgeVertexPosition(ha,I,aa,va);fa=V/oa;var Ca=Z?ea[0]+fa*(ea[2]-ea[0]):O===l.NeighborIndex.WEST?ea[0]:
ea[2],ma=Z?O===l.NeighborIndex.SOUTH?ea[1]:ea[3]:ea[1]+fa*(ea[3]-ea[1]);const Ba=F.surface.extent;if(null==Ba||g.containsXY(Ba,Ca,ma)){fa=k.dist(E,I);ja=k.len(E)-e.earth.radius;qa=k.len(I)-e.earth.radius;var wa=fa<W;wa||(console.warn("Tile edge vertex position mismatch: between"+` [${F.lij}].edge${T}[${ta}/${ia}] and`+` [${Q.lij}].edge${ha}[${va}/${Y}]`),null!=Ba&&console.warn("  surface extent\x3d ",Ba," x,y\x3d",Ca,",",ma),Ca=m.create(),k.subtract(Ca,ca.localOrigin,U.localOrigin),0<k.len(Ca)&&console.warn(`   localOrigins: ${ca.localOrigin} vs ${U.localOrigin}`+
` d=${k.len(Ca)} [${Ca}]`),(()=>{const Aa=m.clone(E),ra=m.clone(I);F.updateEdgeElevations();Q.updateEdgeElevations();X.getEdgeVertexPosition(T,E,ba,ta);da.getEdgeVertexPosition(ha,I,aa,va);const ua=m.create();k.sub(ua,E,Aa);0<k.len(ua)&&console.warn(`  XXX Tile[${F.lij}] edge out of date: ${Aa} vs ${E} d=${k.len(ua)} [${ua}]`);k.sub(ua,I,ra);0<k.len(ua)&&console.warn(`  XXX Neighbor[${Q.lij}] edge out of date: ${ra} vs ${I} d=${k.len(ua)} [${ua}]`)})(),Ca=X.getEdgeCount(T),ma=da.getEdgeCount(Y),w.internalAssert(wa,
"Mismatch in tile"+` [${F.lij}].edge[${T}][${ta}/${Ca}] vs neighbor`+` [${Q.lij}].edge[${ha}][${va}/${ma}]`+` ${w.v32s(E)} vs ${w.v32s(I)}  dist=${fa} h(t|n|d)=${ja}|${qa}|${qa-ja}`));X.getEdgeNormal(T,H,ta);da.getEdgeNormal(ha,J,va);k.normalize(B,H);k.normalize(z,J);const pa=k.dot(B,z);fa=.01>1-pa||F===Q;if(!fa){const Aa=m.create();k.sub(Aa,H,J);ja=()=>`Mismatch in tile edge normal ${w.lij2s(F.lij)} (${ta}/${ia-1}) edge ${T} vs neighbor ${w.lij2s(Q.lij)}  (${va}/${Y-1}) nedge ${ha} :`+`${w.v32s(H)} vs ${w.v32s(J)}  dot = ${pa} : ${w.v32s(Aa)}`;
console.warn("Mismatch in tile edge normal: ",ja());F.updateEdgeElevations();Q.updateEdgeElevations();qa=m.create();wa=m.create();X.getEdgeNormal(T,qa,ta);da.getEdgeNormal(ha,wa,va);k.equals(H,qa)||console.warn("Missing update in tile normal: ",w.v32s(H)," \x3d\x3e ",w.v32s(qa));k.equals(J,wa)||console.warn("Missing update in neighbor normal: ",w.v32s(J)," \x3d\x3e ",w.v32s(wa));w.internalAssert(fa,ja())}}ta+=1;va+=1}}}else w.internalAssert(!1)}}else w.internalAssert(!Q.isLeaf),w.internalAssert(0===
V)}else O=!F.surface.updatingRootTiles&&null!=F.surface.rootTiles&&0<F.surface.rootTiles.length&&F.shouldHaveNeighbor(O),w.internalAssert(!O)}})}}else w.internalAssert(F?.isLoaded)}}}const E=m.create(),I=m.create(),H=m.create(),J=m.create(),B=m.create(),z=m.create(),K=[null,null,null,null],L=[0,1,2,3];Object.defineProperty(a,"ActivationTime",{enumerable:!0,get:()=>p.ActivationTime});a.PatchRenderData=C;a.neighborTileIfLoadedOrSelf=A;a.zeroToFour=L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){class b{constructor(){this.numVerticesPerSide=0;this.samplerData=null;this.samplerDataVersion=0;this.clippingArea=null;this.wireframe=!1;this.cornerPeerNeighbors=[null,null,null,null];this.cornerNeighborCornerTiles=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];this.cornerNeighborCornerTileSamplerVersions=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.edgeResolutions=[-1,-1,-1,
-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1]}}a.GeometryState=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../core/maybe","./interfaces"],function(a,b,n){class h{constructor(k){this._getFadeDuration=k;this._delayedTime=this._fadeStart=0}clear(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);
this._delayed=b.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){var k=this._delayed||this._waiting||this._next||this._current;k!==this._current&&(this._current=null,this.clear(),this._current=k)}k=h.test.fadeMoment;null!=this._delayed&&(k=k||performance.now(),k>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(null!=this._next){k=k||performance.now();const m=this._next.type!==n.TextureUpdate.FADING,
g=k-this._fadeStart>=this._fadeDuration;if(null!=this._current&&this._next.texture===this._current.texture||m||g)b.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(k)}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;var k=h.test.fadeMoment||performance.now();k=Math.max(0,k-this._fadeStart);const m=this._fadeDuration;return k>m?0:1-k/m}get isFading(){return null!=this._next||
null!=this._delayed}push(k,m=a.ActivationTime.Immediate){this._delayed=b.destroyMaybe(this._delayed);this._push(k,m)}_push(k,m){this._isFadingEnabled||this.clear();if(null==this._current)this._current=k;else{var g=h.test.fadeMoment||performance.now();m!==a.ActivationTime.Immediate?(this._delayed=k,this._delayedTime=g+m):null==this._next?(this._next=k,this._fadeStart=this._alignFadeStart(g)):null!=k&&(b.destroyMaybe(this._waiting),this._waiting=k)}}get _fadeDuration(){return null==this._waiting?this._getFadeDuration():
.5*this._getFadeDuration()}_alignFadeStart(k){const m=this._getFadeDuration();return k+m-k%m}get _isFadingEnabled(){return 0<this._getFadeDuration()}}h.test={fadeMoment:0};a.ActivationTime=void 0;(function(k){k[k.Immediate=0]="Immediate";k[k.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/math/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./ITile ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I){function H(O){O.dispose();O instanceof w.ElevationTileAgent?F.release(O):O instanceof u.MapTileAgent&&L.release(O)}function J(O,T){return O[0]===T[0]&&O[1]===T[1]&&O[2]===T[2]}function B(O,T,Q){return null==O||null==T||T===O?!1:O.level>=T.level?z(O,T,Q):z(T,O,D.oppositeCorner(Q))}function z(O,T,Q){D.internalAssert(O.level>=T.level);var V=D.isWestCorner(Q),U=D.isNorthCorner(Q),W=O.extent;Q=T.extent;var ca=[V?W[0]:W[2],U?W[3]:W[1]];const X=
[V?Q[2]:Q[0],U?Q[1]:Q[3]];V=1E-5*(W[2]-W[0]);U=D.almostEquals(ca[0],X[0],V)||O.surface.isGlobal&&D.almostEquals(ca[0],-X[0],V);ca=D.almostEquals(ca[1],X[1],V);if(U&&ca)return!0;if(O.level===T.level||!U&&!ca)return D.internalAssert(!1),!1;U?(O=W[1],W=W[3],Q=Q[1]-V<=O&&O<=W&&W<=Q[3]+V):(O=W[0],W=W[2],Q=Q[0]-V<=O&&O<=W&&W<=Q[2]+V);D.internalAssert(Q);return Q}class K{constructor(){this._lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this.renderData=null;this._dirty=!0;this._previouslyRendered=
!1;this.extent=d.create();this._elevationBoundsMin=NaN;this._elevationBoundsMax=0;this.layerInfo=[[],[]];this.extentInRadians=d.create();this.centerAtSeaLevel=m.create();this._center=[m.create(),c.create(),m.create()];this.up=m.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=this._mapTileMemoryInternal=
0;this.distanceToPOI=-1;this._lastPOI=m.create();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0}get lij(){return this._lij}static prune(){L.prune(0);F.prune(0);A.TilePerLayerInfo.prune()}get _isCached(){return!this.isLeaf&&0>=this._mapDataRefCount}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBoundsMin(){return this._elevationBoundsMin}get elevationBoundsMax(){return this._elevationBoundsMax}get level(){return this._lij[0]}get key(){return`${this._lij[0]}/${this._lij[1]}/${this._lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[a.CenterPosition.MIDDLE][3]}get visible(){this._dirty&&
this.computeVisibility();return this._visible}get frustumVisibility(){this._dirty&&this.computeVisibility();return this._frustumVisibility}computeVisibility(){this._dirty=!1;var O=this.parent?.frustumVisibility??t.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=O===t.TileFrustumVisibility.INSIDE?t.TileFrustumVisibility.INSIDE:O===t.TileFrustumVisibility.OUTSIDE?t.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);O=this._frustumVisibility!==t.TileFrustumVisibility.OUTSIDE&&
this._intersectsClippingArea;O!==this._visible&&(this._visible=O,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const O=!!this.renderData;O!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=O,this._surface.renderer.setDirty());return O}init(O,T,Q,V,U){this._lij[0]=O;this._lij[1]=T;this._lij[2]=
Q;this.ellipsoid=e.getReferenceEllipsoid(U.tilingScheme.spatialReference);U.tilingScheme.getExtent(O,T,Q,this.extent);U.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;U.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=
0;this.elevationLevel=O;V&&!Number.isNaN(V.elevationBoundsMin)?(this._elevationBoundsMin=V.elevationBoundsMin,this._elevationBoundsMax=V.elevationBoundsMax):this._elevationBoundsMax=this._elevationBoundsMin=0;this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=V;this.unsetChildren();this._surface=U;this.updateVisibility();this.unmergableChildCount=this.maxLevelDeltaNeighborCount=0;for(const W of q.LayerClasses){O=U.numLayers(W);T=this.layerInfo[W];
for(const ca of T)ca.release();T.length=O;for(Q=0;Q<O;Q++)T[Q]=A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),W===q.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(Q,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(U.tilingScheme.pixelSize,y.maxPatchTesselation)}dispose(){D.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(var O of q.LayerClasses){for(const T of this.layerInfo[O])T.release();this.layerInfo[O].length=
0}this._parent=null;for(O=0;4>O;++O)this._children[O]=null;this._surface=null;this.setMemoryDirty()}refMapData(){++this._mapDataRefCount;this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const O=this._cachedMemory;0<O&&this._surface.upsampleMapCache.put(this.key,this,O)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?
this._mapTileMemory:0}get _mapTileMemory(){this._ensureUsedMemory();return this.layerInfo[q.LayerClass.MAP].reduce((O,T)=>O+(T instanceof f.VectorTile?T.usedMemory/T.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const O=this._surface.tilingScheme.pixelSize;return O*O*4}_ensureUsedMemory(){if(null!=this._usedMemory)return this._usedMemory;this._usedMemory=this._baseUsedMemory;let O=this._mapTileMemoryInternal=0;for(var {data:T}of this.layerInfo[q.LayerClass.MAP])T instanceof
f.VectorTile?O+=this._getTerrainDataMemory(T):this._mapTileMemoryInternal+=this._getTerrainDataMemory(T);T=this._cpuImageMemorySize;for(const Q of this.layerInfo[q.LayerClass.ELEVATION])this._usedMemory+=Q.data?T:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=this.renderData.texture?.usedMemory??0);this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+O);return this._usedMemory}getUsedMemoryForLayer(O,
T){T=this.layerInfo[O][T];return T?.data?O===q.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(T.data):O===q.LayerClass.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(O){return O instanceof C?O.texture.usedMemory:O instanceof HTMLImageElement||O instanceof r.ImageWithType?this._cpuImageMemorySize:O instanceof v.RasterTile?O.memoryUsage:O instanceof f.VectorTile?O.usedMemory/O.referenced:0}updateScreenDepth(O){var T=this._center[a.CenterPosition.MIDDLE];const Q=T[0],V=T[1];
T=T[2];const U=O[2]*Q+O[6]*V+O[10]*T+O[14];this.screenDepth=0>U?0:U/(O[3]*Q+O[7]*V+O[11]*T+O[15])}shouldSplit(O,T,Q){if(!this.visible||O.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(O.frustum)===t.TileFrustumVisibility.OUTSIDE))return E.TileUpdate.NONE;const V=this.level;k.subtract(S,c.getCenter(this._center[a.CenterPosition.MIDDLE]),T);var U=k.squaredLength(S),W=S;let ca=c.getCenter(this._center[a.CenterPosition.MIDDLE]);k.subtract(N,this._center[a.CenterPosition.TOP],
T);var X=k.squaredLength(N);X<U&&(U=X,W=N,ca=this._center[a.CenterPosition.TOP]);k.subtract(P,this._center[a.CenterPosition.BOTTOM],T);X=k.squaredLength(P);X<U&&(U=X,W=P,ca=this._center[a.CenterPosition.BOTTOM]);if(this._edgeLen2>U&&V<O.maxLod)return E.TileUpdate.SPLIT;U=Math.sqrt(U);const ba=this._edgeLen/(O.fovX*U*2),ia=()=>{if(V<O.maxLod)return this.elevationLevel=V,E.TileUpdate.NONE;const ea=V+Math.ceil(-Math.log2(O.relativeWidthLimit/ba));return ea!==this.elevationLevel?(this.elevationLevel=
ea,E.TileUpdate.ELEVATION):E.TileUpdate.NONE},fa=null!=Q?Q-V:Infinity;if(.5>=fa)return ia();const da=k.dot(this.up,S);X=this._elevationBoundsMax-this._elevationBoundsMin;const aa=X/this.edgeLen;if(O.aboveGround&&0<da&&.001>aa&&0<da/U-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-aa)return E.TileUpdate.NONE;Q=null!=Q?3-Math.min(fa,2):1;if(ba*Q<O.relativeWidthLimit||V>=O.maxLod)return ia();if(7>V)return E.TileUpdate.SPLIT;k.scale(R,this.up,da);k.subtract(R,R,W);W=k.squaredLength(R);
if(W<=this.radius*this.radius)return E.TileUpdate.SPLIT;k.scale(R,R,this.radius/Math.sqrt(W));k.add(R,R,ca);k.subtract(R,T,R);return Math.min(1,(Math.abs(k.dot(R,this.up))+.5*X+this._curvatureHeight)/k.length(R))*(this._edgeLen/(O.fovY*U*2))*Q<.1/O.angledSplitBias*O.relativeHeightLimit?E.TileUpdate.NONE:E.TileUpdate.SPLIT}setChildren(O,T,Q,V){D.weakAssert(!!(O&&T&&Q&&V),"Null child passed");const U=this._children;U[0]=O;U[1]=T;U[2]=Q;U[3]=V;return U}unsetChildren(){this._children[0]=null;this._children[1]=
null;this._children[2]=null;this._children[3]=null}get isLoaded(){return this.renderData?.hasGeometry??!1}load(){this.refMapData();for(const O of q.LayerClasses)this._createOrUpdateAgents(0,O);this.surface.renderer.loadTile(this)}unload(O){O.unloadTile(this);for(const T of q.LayerClasses){O=this.layerInfo[T];for(const Q of O)Q.loadingAgent&&Q.loadingAgent!==G.tileAgentDone&&(H(Q.loadingAgent),Q.loadingAgent=null),Q.pendingUpdates=0}this.resetPendingUpdate(E.TileUpdate.GEOMETRY);this.resetPendingUpdate(E.TileUpdate.TEXTURE_NOFADING);
this.resetPendingUpdate(E.TileUpdate.TEXTURE_FADING);this.unrefMapData()}unloadMapData(){const O=this.layerInfo[q.LayerClass.MAP];for(const T of O)T.loadingAgent&&T.loadingAgent!==G.tileAgentDone&&(H(T.loadingAgent),T.loadingAgent=null),T.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()}updateClippingStatus(O){if(d.equals(O,this._clippingArea))return!1;var T=this._intersectsClippingArea;const Q=this._isWithinClippingArea;null!=O?(this._intersectsClippingArea=
this.intersectsExtent(O),this._isWithinClippingArea=this._isWithinExtent(O)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=O;this.updateVisibility();O=Q&&this._isWithinClippingArea;T=!Q&&!T&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||O||T||this.setPendingUpdate(E.TileUpdate.GEOMETRY);return!0}updateVisibility(){this._dirty=!0;this._surface.setTileTreeDirty()}getLayerInfo(O,T){return this.layerInfo[T][O]}hasLayerData(O,T){O=this.layerInfo[T][O];
return!(!O?.data||O.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const O of q.LayerClasses){const T=this.layerInfo[O];for(const Q of T)if(Q.loadingAgent&&Q.loadingAgent!==G.tileAgentDone&&Q.loadingAgent.updating)return!0}return!1}_isSuspended(O){return this.hasPendingUpdate(E.TileUpdate.SPLIT)?!0:O===q.LayerClass.ELEVATION?!1:!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(O){return(this._pendingUpdates&O)===O}setPendingUpdate(O){const T=
this._pendingUpdates;this._pendingUpdates|=O;O===E.TileUpdate.SPLIT||O===E.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate();return T!==this._pendingUpdates}resetPendingUpdate(O){return this.hasPendingUpdate(O)?(this._pendingUpdates&=~O,!0):!1}requestLayerData(O,T,Q){const V=this.layerInfo[T][O];if(V.waitingAgents.has(Q))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),Q.tile.lij.toString(),
T,O),!0;V.waitingAgents.push(Q);if(V.data&&!V.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this._lij.toString(),Q.tile.lij.toString(),T,O),Q.dataArrived(this,V.data&&"type"in V.data&&"vector-tile"===V.data.type),!0;if(V.requestPromise)return!0;n.abortMaybe(V.requestAbort);V.requestAbort=new AbortController;const U=this._surface.requestTileData(this,O,T,V.requestAbort);if(!U)return V.requestAbort=null,!1;O=()=>{V.requestPromise===U&&(V.requestPromise=
null,V.requestAbort=null)};V.requestPromise=U;U.then(O,O);return!0}get isLeaf(){return null==this._children[0]}hasLij(O){return this._lij[0]===O[0]&&this._lij[1]===O[1]&&this._lij[2]===O[2]}findByLij(O){if(this.hasLij(O))return this;const T=this._children;return T[0]?T[0].findByLij(O)||T[1].findByLij(O)||T[2].findByLij(O)||T[3].findByLij(O):null}distanceToSquared(O){return k.squaredLength(k.subtract(R,c.getCenter(this._center[a.CenterPosition.MIDDLE]),O))}containsPoint(O){const T=this.extent;return O[0]>=
T[0]&&O[1]>=T[1]&&O[0]<=T[2]&&O[1]<=T[3]}containsPointXY(O,T){const Q=this.extent;return O>=Q[0]&&T>=Q[1]&&O<=Q[2]&&T<=Q[3]}unrequestLayerData(O,T,Q){O=this.layerInfo[T][O];T=O.waitingAgents;Q=null!=T.removeUnordered(Q);D.weakAssert(Q,"agent has not requested this piece of map data");1>T.length&&(O.abortRequest(),this.setMemoryDirty())}dataArrived(O,T,Q){const V=null!=Q&&"type"in Q&&"vector-tile"===Q.type;O=this.layerInfo[T][O];O.data=Q;O.dataInvalidated=!1;O.waitingAgents.forAll(U=>U.dataArrived(this,
V));O.waitingAgents.clear();this.setMemoryDirty()}dataMissing(O,T,Q){Q.notInTilemap||console.error(`Tile ${this._lij.toString()} layer ${T}/${O} error ${Q}`);O=this.layerInfo[T][O];O.dataMissing=!0;O.waitingAgents.forAll(V=>V.dataMissing());O.waitingAgents.clear();this.setMemoryDirty()}updateRenderData(O,T,Q){Q&&this.forEachLoadedNeighbor(V=>V.updateRenderData(O,T));switch(O){case q.LayerClass.MAP:return this._updateTexture(T);case q.LayerClass.ELEVATION:return this._updateGeometry()}}_updateTexture(O){this.renderData&&
(this.resetPendingUpdate(O===p.TextureUpdate.FADING?E.TileUpdate.TEXTURE_NOFADING:E.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(O===p.TextureUpdate.FADING?E.TileUpdate.TEXTURE_FADING:E.TileUpdate.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(E.TileUpdate.GEOMETRY);for(const O of this.layerInfo[q.LayerClass.ELEVATION])O.pendingUpdates|=E.TileUpdate.GEOMETRY}invalidateLayerData(O,T){this.layerInfo[T][O].invalidateSourceData();this.restartAgents(T)}computeElevationBounds(){const O=
this._elevationBoundsMin,T=this._elevationBoundsMax;let Q=Infinity,V=-Infinity;const U=this.layerInfo[q.LayerClass.ELEVATION];let W=!0;for(const ca of U)null!=ca.elevationBounds&&(Q=Math.min(Q,ca.elevationBounds.min),V=Math.max(V,ca.elevationBounds.max),ca.elevationBounds.hasNoDataValues||(W=!1));W&&(Q=Math.min(Q,0),V=Math.max(V,0));if(O!==Q||T!==V)this._elevationBoundsMin=Q,this._elevationBoundsMax=V,this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const O=this._elevationBoundsMin,
T=this._elevationBoundsMax,Q=this._center;k.scale(R,this.up,.5*(O+T));k.add(c.getCenter(Q[a.CenterPosition.MIDDLE]),this.centerAtSeaLevel,R);k.scale(R,this.up,O);k.add(Q[a.CenterPosition.TOP],this.centerAtSeaLevel,R);k.scale(R,this.up,T);k.add(Q[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,R)}findElevationBoundsForLayer(O,T){const Q=this.layerInfo[q.LayerClass.ELEVATION][O],V=y.getElevationDesiredResolutionLevel(this.level),U=Math.max(this.elevationLevel-V,0);var W=Q.elevationBounds;if(!(null!=
W&&W.level>=T&&W.level<=U)&&(T=this._surface.layerViewByIndex(O,q.LayerClass.ELEVATION),T=D.getLayerWithExtentRange(T),I.fallsWithinLayer(this,T,!1))){T=M;W=!1;var ca=Q.data;if(ca&&ca.level<=U)O=Q.data,T.min=O.samplerData.data.minValue,T.max=O.samplerData.data.maxValue,T.hasNoDataValues=O.samplerData.data.hasNoDataValues,T.level=this.level,W=!0;else{ca=0;let X,ba;for(let ia=this._parent;ia&&(!ba||ca<V)&&!(ca=this.elevationLevel-ia.level,X=ba||X,ba=ia.layerInfo[q.LayerClass.ELEVATION][O].data,!ba&&
X&&ia.level<=U);ia=ia.parent);if(ba=ba||X)ba.computeMinMaxValue(this._lij[0],this._lij[1],this._lij[2],T),Infinity!==T.min&&(T.level=ba.level,W=!0)}W&&(null==Q.elevationBounds&&(Q.elevationBounds=new x.ElevationBounds),Q.elevationBounds.copyFrom(T))}}modifyLayers(O,T,Q){Q=this.layerInfo[Q];for(var V of Q)V.loadingAgent&&V.loadingAgent!==G.tileAgentDone&&(H(V.loadingAgent),V.loadingAgent=null),V.waitingAgents.clear();for(V=0;V<Q.length;++V)void 0===O[V]&&Q[V].release();O=Array(...Q);V=T.length;Q.length=
V;for(let U=0;U<V;U++){const W=T[U];Q[U]=-1<W?O[W]:A.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(O){this.renderData&&(this._createOrUpdateAgents(0,O),this.updateRenderData(O,p.TextureUpdate.FADING))}updateAgents(O){if(this.renderData){const T=this.layerInfo[O];for(const Q of T)Q.loadingAgent===G.tileAgentDone&&(Q.loadingAgent=null);this._createOrUpdateAgents(0,O)}}updateAgentSuspension(){for(const O of q.LayerClasses){const T=this._isSuspended(O);for(const Q of this.layerInfo[O])Q.loadingAgent&&
Q.loadingAgent!==G.tileAgentDone&&(Q.loadingAgent.setSuspension(T),Q.loadingAgent===G.tileAgentDone&&this.updateRenderData(O,p.TextureUpdate.FADING))}}removeLayerAgent(O,T){O=this.layerInfo[T][O];O.loadingAgent&&O.loadingAgent!==G.tileAgentDone&&O.loadingAgent.dispose();O.loadingAgent=null}agentDone(O,T){const Q=this.layerInfo[T][O];Q.loadingAgent=G.tileAgentDone;Q.data||null!=Q.upsampleInfo||this._createOrUpdateAgents(O+1,T)}_hasBlendableAncestor(O){return"normal"!==O.blendMode||l.isGroupLayer(O.parent)&&
this._hasBlendableAncestor(O.parent)}_hasBlendModes(O,T,Q){for(;O<T;++O){const V=this._surface.layerViewByIndex(O,Q);if(D.isBlendableLayerView(V)&&"normal"!==V?.layer?.blendMode||l.isGroupLayer(V?.layer?.parent)&&this._hasBlendableAncestor(V?.layer?.parent))return!0}return!1}_createOrUpdateAgents(O,T){const Q=this.layerInfo[T];if(0!==Q.length){var V=this._isSuspended(T);for(let X=O;X<Q.length;++X){const ba=Q[X];var U=!1;const ia=this._surface.layerViewByIndex(X,T);var W=D.getLayerWithExtentRange(ia);
if(ba.loadingAgent)I.fallsWithinLayer(this,W,!1)?(ba.loadingAgent!==G.tileAgentDone&&ba.loadingAgent.setSuspension(V),ba.loadingAgent!==G.tileAgentDone&&(U=ba.loadingAgent.update())):ba.dispose();else if(I.fallsWithinLayer(this,W,!1)){U=X;W=T;var ca=V;const fa=W===q.LayerClass.ELEVATION?F.acquire():L.acquire();fa.init(this,U,W,ca);ba.loadingAgent=fa;(U=ba.loadingAgent.startLoading())?ba.loadingAgent===G.tileAgentDone&&this.setPendingUpdate(E.TileUpdate.GEOMETRY):(H(ba.loadingAgent),ba.loadingAgent=
G.tileAgentDone)}ba.loadingAgent===G.tileAgentDone&&this.updateRenderData(T,p.TextureUpdate.FADING);if(!this._hasBlendModes(O,Q.length,T)&&U&&ia.isOpaque)break}}}_isWithinExtent(O){const T=this.extent;return T[0]>=O[0]&&O[2]>=T[2]&&T[1]>=O[1]&&O[3]>=T[3]}intersectsExtent(O){const T=this.extent;return T[2]>=O[0]&&O[2]>=T[0]&&T[3]>=O[1]&&O[3]>=T[1]}getElevationVerticesPerSide(O){var T=this.elevationLevel-this.level;O=Math.max(this.level-O,y.getElevationDesiredResolutionLevel(this.level)-T);O=b.clamp((this.maxTesselation>>
O)+1,2,this.maxTesselation+1);T=this.getDefaultVerticesPerSide();return Math.max(O,T)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(O,T){if(!O)return null;var Q=this.surface.rootTiles;if(null!=Q)for(var V of Q){{Q=V.lij;const U=O[0]-Q[0];Q=0>U?!1:O[1]>>U===Q[1]&&O[2]>>U===Q[2]}if(Q){for(Q=O[0]-V.level-1;0<=Q&&!V.isLeaf&&!T(V);)V=V.children[2*(O[1]>>Q&1)+(O[2]>>Q&1)],Q--;return T(V)?V:null}}return null}findNeighborTile(O,T){const Q=this._lij;return(O=this.getNeighborLIJ(Q,O))?J(Q,O)?
T(this)?this:null:this._findLIJ(O,T):null}findCorner(O,T){O=O===t.NeighborIndex.NORTH_EAST?1:O===t.NeighborIndex.NORTH_WEST?0:O===t.NeighborIndex.SOUTH_WEST?2:3;let Q=this;for(;Q.children[0]&&(!T||!T(Q));)Q=Q.children[O];return Q}findNeighborCornerTileExact(O,T){return this.findNeighborTile(O,Q=>T(Q)||Q.level===this.level)?.findCorner(D.oppositeCorner(O),T)||null}forAllSubtreeOnSide(O,T){const Q=O===t.NeighborIndex.NORTH?[0,1]:O===t.NeighborIndex.NORTH_EAST?[1]:O===t.NeighborIndex.EAST?[1,3]:O===
t.NeighborIndex.SOUTH_EAST?[3]:O===t.NeighborIndex.SOUTH?[2,3]:O===t.NeighborIndex.SOUTH_WEST?[2]:O===t.NeighborIndex.WEST?[0,2]:[0],V=U=>{const W=U.children;!T(U)&&W[0]&&Q.forEach(ca=>V(W[ca]))};V(this)}getNeighborEdgeStartVertexIndex(O,T){if(!T)return 0;var Q=this.level-T.level;D.internalAssert(!D.enableTerrainInternalChecks||0<=Q);if(0===Q)return 0;Q=2**Q;var V=(O=1===(O&1))?0:1;T=T.lij[V+1]*Q;V=this._lij[V+1];const U=V-T;O=O?Q-1-U:U;D.enableTerrainInternalChecks&&(D.internalAssert(T<=V&&V<T+Q),
D.internalAssert(0<=O&&O<Q));return O}forEachLoadedNeighbor(O){const T=this.level,Q=V=>V.level===T||V.isLoaded;D.neighborEdgeIndices.forEach(V=>{const U=this.findNeighborTile(V,Q);null!=U&&U!==this&&U.forAllSubtreeOnSide(D.oppositeEdge(V),W=>W.isLoaded?(O(W,V),!0):!1)});D.neighborCornerIndices.forEach(V=>{const U=this.findNeighborTile(V,Q)?.findCorner(D.oppositeCorner(V),W=>W.isLoaded);D.internalAssert(!U||B(this,U,V));U?.isLoaded&&O(U,V)})}getNeighborLIJ(O,T){const Q=D.isNorth(T)?-1:D.isSouth(T)?
1:0;T=D.isWest(T)?-1:D.isEast(T)?1:0;O=[O[0],O[1]+Q,O[2]+T];return 0>O[1]?null:this.surface.isGlobal?this.wrapLIJ(O):0>O[2]?null:O}wrapLIJ(O){return!O||0>O[1]||O[1]>=2**O[0]?null:this.surface.wrapEastWest(O)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this._lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this._lij[2]}get isNorthEnd(){return 0===this._lij[1]}get isSouthEnd(){const O=
this.surface.extent?.[1]??null;return null!=O&&this.extent[1]+g.getEpsilon()>=O}checkGeometryWaterproofness(){D.enableWaterproofnessTests&&(D.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())}shouldHaveNeighbor(O){const T=this.extent,Q=this.surface.rootTilesExtent,V=.25*(T[2]-T[0]);if(D.isNorth(O)&&T[3]+V>=Q[3]||D.isSouth(O)&&T[1]-V<=Q[1])return!1;const U=this.surface.isGlobal;return!U&&D.isWest(O)&&T[0]-V<=Q[0]||!U&&D.isEast(O)&&T[2]+V>=Q[2]?!1:!0}updateDistanceToPOI(O){var T=
this._lastPOI;if(!(0<=this.distanceToPOI&&T[0]===O[0]&&T[1]===O[1]&&T[2]===O[2])){k.copy(this._lastPOI,O);var Q=this._center[a.CenterPosition.MIDDLE];T=O[0]-Q[0];var V=O[1]-Q[1];O=O[2]-Q[2];this.distanceToPOI=T*T+V*V+O*O}}}const L=new h(u.MapTileAgent),F=new h(w.ElevationTileAgent),M=new x.ElevationBounds;a.CenterPosition=void 0;(function(O){O[O.TOP=0]="TOP";O[O.MIDDLE=1]="MIDDLE";O[O.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));const S=m.create(),N=m.create(),P=m.create(),R=m.create();
a.Tile=K;a.isCornerNeighbor=B;a.isEdgeNeighbor=function(O,T,Q){if(null==O||null==T)return!1;if(0===O.level&&0===T.level&&(O.isEastEnd&&T.isWestEnd&&Q===t.NeighborIndex.EAST||O.isWestEnd&&T.isEastEnd&&Q===t.NeighborIndex.WEST))return!0;const V=Math.max(1E-6*(O.extent[2]-O.extent[0]),1);switch(Q){case t.NeighborIndex.NORTH:return D.almostEquals(O.extent[3],T.extent[1],V);case t.NeighborIndex.SOUTH:return D.almostEquals(O.extent[1],T.extent[3],V);case t.NeighborIndex.EAST:return D.almostEquals(O.extent[2],
T.extent[0],V)||D.almostEquals(O.extent[2],-T.extent[0],V);case t.NeighborIndex.WEST:return D.almostEquals(O.extent[0],T.extent[2],V)||D.almostEquals(O.extent[0],-T.extent[2],V)}};a.lijEquals=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,b,n){class h extends n.TileAgent{constructor(){super(...arguments);this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return b.getElevationDesiredResolutionLevel(this.tile.level)-
(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}a.ElevationTileAgent=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define(["exports","./interfaces","./TerrainConst","./terrainUtils","./tileUtils"],function(a,b,n,h,k){class m{get updating(){return!!this._tileRequested}init(c,l,f,r){this.tile=c;this._layerIdx=l;this._layerClass=f;this._suspended=r;this._tileLayerInfo=c.getLayerInfo(l,f);this._tileRequested=
null;c=this._findAncestorWithData();this._setUpsampleTile(c)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null}setSuspension(c){c!==this._suspended&&((this._suspended=c)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const c=
this._findAncestorWithData();this._setUpsampleTile(c);return this._requestNext()}dataArrived(c,l){this._setUpsampleTile(c,l);this._tileRequested=null;c===this.tile?this.tile.updateRenderData(this._layerClass,b.TextureUpdate.FADING,l):this._requestNext()}dataMissing(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()}_requestNext(){if(this._suspended)return!0;const c=this._findNextDownload();if(this._tileRequested){if(c===
this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}null!=c?c.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=c):this._agentDone();return!!this._tileRequested}_findNextDownload(){const c=this._layerIdx,l=this._layerClass;var f=this.tile.surface.layerViewByIndex(c,l),r=h.getLayerWithExtentRange(f);const {minLevel:x,maxLevel:w}=f.dataLevelRange,p=this._desiredMinLevelDelta,t=this._progressiveLevelModulo+
p,q=this._scaleRangeEnabled?k.fallsWithinLayer:()=>!0;let u=this.tile;const v=u.level;let y;const D=this._tileLayerInfo.upsampleInfo,G=null!=D?D.tile.level:-1,A=null!=D?G-v>=p:!1,C=r?.tilemapCache;for(f="vector-tile-3d"===f.type?f.schemaHelper:null;u&&q(u,r,!1)&&u.level>=x;){const E=u.level,I=v-E,H=u.layerInfo[l][c];if(H.data&&I>=p){(!A||E>G)&&this._setUpsampleTile(u);H.dataInvalidated&&(y=u);break}const J=f?.getLevelRowColumn(u.lij)??u.lij;if("unavailable"!==C?.getAvailability(J[0],J[1],u.lij[2])&&
E<=w&&!H.data&&!H.dataMissing){if(!y||u.level===x||0===E%n.progressiveLoadingModulo||v-y.level<p)y=u;if(I>=t)break}u=u.parent}null!=y&&v-y.level<p&&(D?y=null:(r=this._findAncestorWithData(),null!=r&&(this._setUpsampleTile(r),y=r.layerInfo[l][c].dataInvalidated?r:null)));return y}_findAncestorWithData(){const c=this.tile.elevationLevel,l=this._desiredMinLevelDelta;let f;for(let r=this.tile;r;r=r.parent)if(r.hasLayerData(this._layerIdx,this._layerClass)){if(c-r.level>=l)return r;f=r}return f}_setUpsampleTile(c,
l){this._tileLayerInfo.setUpsampleInfo(this.tile,c);this.tile.updateRenderData(this._layerClass,b.TextureUpdate.FADING,l)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class g extends m{get _desiredMinLevelDelta(){throw e;}get _progressiveLevelModulo(){throw e;}dispose(){}}const e=Error("Abstract method called on TileAgent"),d=new g;a.TileAgent=m;a.tileAgentDone=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports",
"../../../core/PooledArray","./RenderOrder"],function(a,b,n){function h(x,w){w(x);if(!x.isLeaf)for(const p of x.children)h(p,w)}function k(x,w){x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function m(x,w){const p=w.screenDepth-x.screenDepth;if(0!==p)return p;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function g(x,w){const p=x.screenDepth-w.screenDepth;if(0!==p)return p;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}function e(x,w,p){const t=x.screenDepth,q=w.screenDepth;
return t<q?-p:t>q?p:k(x,w)}function d(x,w,p,t){const q=c(x,t);t=c(w,t);return q===t?e(x,w,p):x?p:-p}function c(x,w){for(const p of w)if(x.intersectsExtent(p))return!0;return!1}function l(x,w){const p=x.distanceToPOI-w.distanceToPOI;if(0!==p)return p;x=x.lij;w=w.lij;return x[0]-w[0]||x[1]-w[1]||x[2]-w[2]}class f{constructor(){this._queue=new b;this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(x){this._queue.clear();this._queue.push(x);this._last=
void 0}reset(x=null){this._queue.clear();null!=x&&this._queue.pushArray(x);this._last=void 0}skipSubtree(){this._last=void 0}next(){const x=this._last?.children;x?.[0]&&this._queue.pushArray(x);return this._last=this._queue.pop()}}class r{constructor(){this._q=new b}get done(){return 0===this._q.length}reset(x){this._q.clear();if(null!=x)for(this._q.pushArray(x),x=0;x<this._q.length;++x){const w=this._q.data[x];w.isLeaf||this._q.pushArray(w.children)}}next(){return this._q.pop()}}a.IteratorPostorder=
r;a.IteratorPreorder=f;a.compareTiles=e;a.compareTilesByLij=k;a.compareTilesWithStencil=d;a.computeUpsampleInfo=function(x,w,p){let t=1,q=0,u=0;for(;x!==w;)if(t*=.5,q*=.5,u*=.5,x.lij[2]&1&&(q+=.5),0===(x.lij[1]&1)&&(u+=.5),x=x.parent,null==x)throw Error("tile was not a descendant of upsampleTile");p.init(w,q,u,t)};a.fallsWithinLayer=function(x,w,p){if(null==w?.fullExtent)return!1;const t=w.fullExtent,q=x.extent;if(p){if(q[0]<t.xmin||q[1]<t.ymin||q[2]>t.xmax||q[3]>t.ymax)return!1}else if(t.xmin>q[2]||
t.ymin>q[3]||t.xmax<q[0]||t.ymax<q[1])return!1;x=x.surface.tilingScheme.levels[x.level].scale;p=w.minScale;if(0<p&&x>1.00000001*p)return!1;w=w.maxScale;return 0<w&&x<.99999999*w?!1:!0};a.hasLoadableSiblings=function(x){for(let w=0;w<x.length;w++){const p=x[w],t=p.parent;if(t)for(let q=0;4>q;q++){const u=t.children[q];if(u&&u!==p)return!0}}return!1};a.sortTiles=function(x,w,p=null){null==p||0===p.length?x===n.RenderOrder.BACK_TO_FRONT?w.sort(m):w.sort(g):w.sort((t,q)=>d(t,q,x,p))};a.sortTilesByPOI=
function(x,w){const p=x.length;for(let t=0;t<p;++t)x.at(t).updateDistanceToPOI(w);x.sort(l)};a.tilesAreRelated=function(x,w){if(!x||!w||x[0]===w[0])return!1;const p=x[0]<w[0],t=p?x:w;x=p?w:x;w=1<<x[0]-t[0];return Math.floor(x[1]/w)===t[1]&&Math.floor(x[2]/w)===t[2]};a.traverseTilesPreorder=function(x,w){if(Array.isArray(x))for(let p=0;p<x.length;p++)h(x[p],w);else h(x,w)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],
function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","./TerrainConst","./TileAgent"],function(a,b,n){class h extends n.TileAgent{constructor(){super();this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return b.progressiveLoadingModulo}}
a.MapTileAgent=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define(["exports","../../../core/maybe","../../../chunks/RasterColorizer.glsl","../../webgl/enums","../../webgl/rasterUtils"],function(a,b,n,h,k){const m={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class g{constructor(e,
d,c=null,l=null){this.lij=e;this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.source=d;this.width=c||d.width;this.height=l||d.height}get source(){return this._source}set source(e){this._source=e;this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?
{...m,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||m}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){null!=e&&0<e.length?this._bandIds&&e.every((d,c)=>this._bandIds?.[c]?d===this._bandIds[c]:!1)||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){this._interpolation=e;null!=this._rasterTexture&&(e=this._getRasterTextureInterpolation(e),this._rasterTexture.setSamplingMode("bilinear"===
e?h.TextureSamplingMode.LINEAR:h.TextureSamplingMode.NEAREST))}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e;this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}bind(e){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;(null==this._rasterTexture||this._dirty)&&this._updateRasterTexture(e,this.bandIds);null!=this._rasterTexture&&(this._updateColormapTexture(e),this.transformGrid&&null==this._transformGridTexture&&
(this._transformGridTexture=k.createTransformTexture(e,this.transformGrid)));return!0}getUniforms(){const {symbolizerParameters:e,transformGrid:d,width:c,height:l,opacity:f}=this,r=k.getCommonUniforms(d,[c,l],[this.source.width,this.source.height],f),x=k.getColormapUniforms(e.colormap,e.colormapOffset),w="stretch"===this.symbolizerParameters.type?k.getStretchUniforms(this.symbolizerParameters):null,p="hillshade"===this.symbolizerParameters.type?k.getShadedReliefUniforms(this.symbolizerParameters):
null;return new n.ColorizerUniforms(r,x,w||p,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const {symbolizerParameters:e}=this;return"bilinear"===this.interpolation&&null!=e.colormap&&"stretch"===e.type}get memoryUsage(){null==this._memoryUsed&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(e=>null!=e?e.descriptor.width*e.descriptor.height*4:0).reduce((e,d)=>e+d,0));return this._memoryUsed}release(){this._rasterTexture=
b.disposeMaybe(this._rasterTexture);this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._colormapTexture=b.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0}_updateRasterTexture(e,d){const c=this.source?this.source.extractBands(d):null;c&&c.pixels&&0<c.pixels.length?(d=null==d&&null==this.bandIds||null!=d&&null!=this.bandIds&&d.join("")===this.bandIds.join(""),null!=this._rasterTexture&&d||(this._rasterTexture=b.disposeMaybe(this._rasterTexture),
d=this._getRasterTextureInterpolation(this.interpolation),this._rasterTexture=k.createRasterTexture(e,c,d,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=b.disposeMaybe(this._rasterTexture)}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(e){return"lut"===this.symbolizerParameters.type||"nearest"===e||"majority"===
e||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const d=this._colormap,c=this.symbolizerParameters.colormap;if(!c)this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!d)this._colormapTexture=k.createColormapTexture(e,c),this._colormap=c;else if(c.length!==d.length||c.some((l,f)=>l!==d[f]))this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormapTexture=k.createColormapTexture(e,c),this._colormap=c}}a.RasterTile=
g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(A){const C=new w.ShaderBuilder;C.include(g.TileComposite);C.include(k.Common,A);C.include(h.Colormap,A);C.include(m.TileBackground,A);C.fragment.code.add(x.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);A.colorizerType===n.RasterColorizerType.Stretch?q(C,A):A.colorizerType===n.RasterColorizerType.Lut?C.fragment.code.add(x.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):A.colorizerType===n.RasterColorizerType.Hillshade&&u(C,A);return C}function q(A,C){A.fragment.uniforms.add(new r.IntegerPassUniform("u_bandCount",I=>I.symbolizer.u_bandCount),new f.FloatsPassUniform("u_minCutOff",I=>I.symbolizer.u_minCutOff,3),new f.FloatsPassUniform("u_maxCutOff",I=>I.symbolizer.u_maxCutOff,3),new f.FloatsPassUniform("u_factor",I=>I.symbolizer.u_factor,3),new l.FloatPassUniform("u_minOutput",I=>I.symbolizer.u_minOutput),new l.FloatPassUniform("u_maxOutput",I=>I.symbolizer.u_maxOutput),
new d.BooleanPassUniform("u_useGamma",I=>I.symbolizer.u_useGamma),new f.FloatsPassUniform("u_gamma",I=>I.symbolizer.u_gamma,3),new f.FloatsPassUniform("u_gammaCorrection",I=>I.symbolizer.u_gammaCorrection,3),new l.FloatPassUniform("u_opacity",I=>I.common.u_opacity));A.fragment.code.add(x.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const E=C.applyColormap?x.glsl`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x.glsl`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;A.fragment.code.add(x.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${C.stretchType===n.RasterColorizerStretchType.Noop?x.glsl`
        fragColor = applyBackgroundBlend(currentPixel);`:x.glsl`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${E}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function u(A,C){A=A.fragment;A.uniforms.add(new p.Texture2DPassUniform("u_image",E=>E.u_image),new r.IntegerPassUniform("u_hillshadeType",E=>E.symbolizer.u_hillshadeType),new f.FloatsPassUniform("u_sinZcosAs",E=>E.symbolizer.u_sinZcosAs,6),new f.FloatsPassUniform("u_sinZsinAs",E=>E.symbolizer.u_sinZsinAs,6),new f.FloatsPassUniform("u_cosZs",E=>E.symbolizer.u_cosZs,6),new f.FloatsPassUniform("u_weights",E=>E.symbolizer.u_weights,6),new c.Float2PassUniform("u_factor",E=>E.symbolizer.u_factor),
new l.FloatPassUniform("u_minValue",E=>E.symbolizer.u_minValue),new l.FloatPassUniform("u_maxValue",E=>E.symbolizer.u_maxValue),new c.Float2PassUniform("u_srcImageSize",E=>E.common.u_srcImageSize));A.include(e.ColorConversion);A.code.add(x.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);A.code.add(x.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);C=C.applyColormap?x.glsl`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x.glsl`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;A.code.add(x.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${C}
    }
  `)}class v extends k.CommonPassParameters{constructor(A,C,E,I,H,J){super(A,I,H);this.colormap=C;this.symbolizer=E;this.u_colormap=J;this.backgroundColor=b.ZEROS;this.fboTexture=null;this.baseOpacity=1}}class y extends v{}class D extends v{}const G=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:D,ColorizerStretchUniforms:y,ColorizerUniforms:v,build:t},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=D;a.ColorizerStretchUniforms=y;a.ColorizerUniforms=
v;a.RasterColorizer=G;a.build=t})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,h){a.Colormap=function(k){k.fragment.uniforms.add(new h.Texture2DPassUniform("u_colormap",m=>m.u_colormap),new b.FloatPassUniform("u_colormapOffset",m=>m.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",m=>m.colormap.u_colormapMaxIndex),
new b.FloatPassUniform("u_opacity",m=>m.common.u_opacity));k.fragment.code.add(n.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m,g){class e extends n.TileCompositePassParameters{constructor(d,c,l){super();this.common=d;this.u_image=c;this.u_transformGrid=
l}}a.Common=function(d,c){d.include(b.Projection);d.fragment.uniforms.add(new g.Texture2DPassUniform("u_image",l=>l.u_image),new h.BooleanPassUniform("u_flipY",l=>l.common.u_flipY),new h.BooleanPassUniform("u_applyTransform",l=>l.common.u_applyTransform));({requireBilinearWithNN:c}=c);c&&d.fragment.uniforms.add(new k.Float2PassUniform("u_srcImageSize",l=>l.common.u_srcImageSize));d.fragment.code.add(m.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`);c?d.fragment.code.add(m.glsl`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):d.fragment.code.add(m.glsl`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)};a.CommonPassParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,n,h){a.Projection=function(k){k.fragment.uniforms.add(new h.Texture2DPassUniform("u_transformGrid",m=>m.u_transformGrid),new b.Float2PassUniform("u_transformSpacing",m=>m.common.u_transformSpacing),
new b.Float2PassUniform("u_targetImageSize",m=>m.common.u_targetImageSize));k.fragment.code.add(n.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,n,h,k,m){class g extends k.NoParameters{constructor(){super(...arguments);this.scale=1;this.offset=b.ZEROS}}a.TileComposite=
function(e){e.attributes.add(m.VertexAttribute.POSITION,"vec2");e.attributes.add(m.VertexAttribute.UV0,"vec2");e.vertex.uniforms.add(new h.FloatPassUniform("scale",d=>d.scale));e.vertex.uniforms.add(new n.Float2PassUniform("offset",d=>d.offset));e.varyings.add("uv","vec2");e.varyings.add("vuv","vec2");e.vertex.code.add(k.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,
b,n,h,k,m,g,e,d){a.BlendLayersOutput=void 0;(function(l){l[l.Composite=0]="Composite";l[l.ColorComposite=1]="ColorComposite";l[l.GridComposite=2]="GridComposite";l[l.GroupBackgroundComposite=3]="GroupBackgroundComposite";l[l.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(l){l[l.NotRequired=0]="NotRequired";l[l.Required=1]="Required";l[l.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;(function(l){l[l.Off=
0]="Off";l[l.On=1]="On";l[l.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));class c extends e.NoParameters{constructor(){super(...arguments);this.baseOpacity=1;this.backgroundColor=b.ZEROS;this.fboTexture=null}}a.TileBackground=function(l,f){const r=f.output===a.BlendLayersOutput.GridComposite,x=f.output===a.BlendLayersOutput.ColorComposite,w=f.output===a.BlendLayersOutput.GroupBackgroundComposite,p=f.output===a.BlendLayersOutput.Composite;r&&l.fragment.include(h.BackgroundGrid);
x&&l.fragment.uniforms.add(new m.Float3PassUniform("backgroundColor",v=>v.backgroundColor));const t=f.baseOpacityMode===a.BaseOpacityMode.Required;t&&l.fragment.uniforms.add(new g.FloatPassUniform("baseOpacity",v=>v.baseOpacity));p&&l.fragment.uniforms.add(new d.Texture2DPassUniform("fboColor",v=>v.fboTexture));const q=f.blendMode!==n.LayerBlendMode.Normal,u=f.premultipliedSource===a.PremultipliedAlphaSource.On;l.fragment.include(k.BlendModes,f);l.fragment.code.add(e.glsl`
    vec4 getBackground(vec2 uv) {
      return ${t?e.glsl`baseOpacity *`:""} ${w?e.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:x?e.glsl`vec4(backgroundColor, 1.0)`:r?e.glsl`vec4(gridColor(uv), 1.0)`:e.glsl`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${q?e.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:e.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!u&&(p&&!t||w)?e.glsl`colorLayer * opacity;`:e.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";
b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=
26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||
b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(n){n.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,n){a.BlendModes=function(h,k){k=k.blendMode;if(k!==b.LayerBlendMode.Normal){k===b.LayerBlendMode.Reflect&&h.code.add(n.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);k!==b.LayerBlendMode.ColorDodge&&k!==b.LayerBlendMode.VividLight||h.code.add(n.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);k!==b.LayerBlendMode.ColorBurn&&k!==b.LayerBlendMode.VividLight||h.code.add(n.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);k===b.LayerBlendMode.Overlay&&h.code.add(n.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);k===b.LayerBlendMode.HardLight&&h.code.add(n.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);k===b.LayerBlendMode.SoftLight&&h.code.add(n.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);k===b.LayerBlendMode.VividLight&&h.code.add(n.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(k===b.LayerBlendMode.Hue||k===b.LayerBlendMode.Saturation||k===b.LayerBlendMode.Color||k===b.LayerBlendMode.Luminosity)h.code.add(n.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),k!==b.LayerBlendMode.Hue&&k!==b.LayerBlendMode.Saturation||h.code.add(n.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);h.code.add(n.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${k===b.LayerBlendMode.Multiply?n.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Average?n.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Lighten?n.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Darken?n.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Lighter?n.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:k===b.LayerBlendMode.Plus?n.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:k===b.LayerBlendMode.Minus?n.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:k===b.LayerBlendMode.Screen?n.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Difference?n.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
k===b.LayerBlendMode.Invert?n.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.DestinationOver?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:k===b.LayerBlendMode.DestinationAtop?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:k===b.LayerBlendMode.DestinationOut?n.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:k===b.LayerBlendMode.SourceAtop?n.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:k===b.LayerBlendMode.SourceOut?
n.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:k===b.LayerBlendMode.Xor?n.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:k===b.LayerBlendMode.DestinationIn?n.glsl`return vec4(cb * ob * ol, ol * ob);`:k===b.LayerBlendMode.SourceIn?n.glsl`return vec4(cl * ol * ob, ol * ob);`:k===b.LayerBlendMode.Hue?n.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Saturation?n.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Color?n.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Luminosity?n.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Exclusion?n.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Reflect?n.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorDodge?n.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.ColorBurn?n.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.Overlay?n.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.SoftLight?n.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.HardLight?n.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:k===b.LayerBlendMode.VividLight?n.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec2f64","./enums","./Texture","./TextureDescriptor"],function(a,b,n,h,k){a.createColormapTexture=function(m,g){const e=new k.TextureDescriptor;e.internalFormat=n.PixelFormat.RGBA;e.width=g.length/4;e.height=1;e.samplingMode=n.TextureSamplingMode.NEAREST;e.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;return new h.Texture(m,e,g)};a.createRasterTexture=
function(m,g,e="nearest",d=!1){const c=(d=!(d&&"u8"===g.pixelType))?n.PixelType.FLOAT:n.PixelType.UNSIGNED_BYTE,l=null==g.pixels||0===g.pixels.length?null:d?g.getAsRGBAFloat():g.getAsRGBA(),f=m.capabilities.textureFloat?.textureFloatLinear,r=new k.TextureDescriptor;r.width=g.width;r.height=g.height;r.internalFormat=d?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA;r.samplingMode=!f||"bilinear"!==e&&"cubic"!==e?n.TextureSamplingMode.NEAREST:n.TextureSamplingMode.LINEAR;r.dataType=c;r.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;
return new h.Texture(m,r,l)};a.createTransformTexture=function(m,g){const {spacing:e,offsets:d,coefficients:c,size:[l,f]}=g;var r=1<e[0];g=new k.TextureDescriptor;g.width=r?4*l:l;g.height=f;g.internalFormat=n.SizedPixelFormat.RGBA32F;g.dataType=n.PixelType.FLOAT;g.samplingMode=n.TextureSamplingMode.NEAREST;g.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;const x=new Float32Array(r?l*f*16:2*d.length);if(r&&null!=c)for(let w=0,p=0;w<c.length;w++)x[p++]=c[w],2===w%3&&(x[p++]=1);else for(r=0;r<f;r++)for(let w=
0;w<l;w++){const p=4*(r*l+w),t=2*(w*f+r);x[p]=d[t];x[p+1]=d[t+1];x[p+3]=-1===d[t]?0:1}return new h.Texture(m,g,x)};a.getBasicGridUniforms=function(m,g){return{u_scale:m,u_offset:g}};a.getColormapUniforms=function(m,g){return{u_colormapOffset:g||0,u_colormapMaxIndex:m?m.length/4-1:0}};a.getCommonUniforms=function(m,g,e,d=1,c=!0){return{u_flipY:c,u_applyTransform:!!m,u_opacity:d,u_transformSpacing:m?m.spacing:b.ZEROS,u_transformGridSize:m?m.size:b.ZEROS,u_targetImageSize:g,u_srcImageSize:e}};a.getShadedReliefUniforms=
function(m){return{u_hillshadeType:m.hillshadeType,u_sinZcosAs:m.sinZcosAs,u_sinZsinAs:m.sinZsinAs,u_cosZs:m.cosZs,u_weights:m.weights,u_factor:m.factor,u_minValue:m.minValue,u_maxValue:m.maxValue}};a.getStretchUniforms=function(m){return{u_bandCount:m.bandCount,u_minOutput:m.outMin,u_maxOutput:m.outMax,u_minCutOff:m.minCutOff,u_maxCutOff:m.maxCutOff,u_factor:m.factor,u_useGamma:m.useGamma,u_gamma:m.gamma,u_gammaCorrection:m.gammaCorrection}};a.getUniformLocationInfos=function(m,g){m=m.gl;g=g.glName;
const e=new Map;if(null==g)return e;const d=m.getProgramParameter(g,m.ACTIVE_UNIFORMS);let c;for(let l=0;l<d;l++)(c=m.getActiveUniform(g,l))&&e.set(c.name,{location:m.getUniformLocation(g,c.name),info:c});return e};a.setTextures=function(m,g,e,d){e.length===d.length&&(d.some(c=>null==c)||e.some(c=>null==c)||e.forEach((c,l)=>{g.setUniform1i(c,l);m.bindTexture(d[l],l)}))};a.setUniforms=function(m,g,e){Object.keys(e).forEach(d=>{var c=g.get(d)||g.get(d+"[0]");if(c){var l=e[d];if(null!==c&&null!=l)switch({info:c}=
c,c.type){case n.UniformType.FLOAT:1<c.size?m.setUniform1fv(d,l):m.setUniform1f(d,l);break;case n.UniformType.FLOAT_VEC2:m.setUniform2fv(d,l);break;case n.UniformType.FLOAT_VEC3:m.setUniform3fv(d,l);break;case n.UniformType.FLOAT_VEC4:m.setUniform4fv(d,l);break;case n.UniformType.FLOAT_MAT3:m.setUniformMatrix3fv(d,l);break;case n.UniformType.FLOAT_MAT4:m.setUniformMatrix4fv(d,l);break;case n.UniformType.INT:1<c.size?m.setUniform1iv(d,l):m.setUniform1i(d,l);break;case n.UniformType.BOOL:m.setUniform1i(d,
l?1:0);break;case n.UniformType.INT_VEC2:case n.UniformType.BOOL_VEC2:m.setUniform2iv(d,l);break;case n.UniformType.INT_VEC3:case n.UniformType.BOOL_VEC3:m.setUniform3iv(d,l);break;case n.UniformType.INT_VEC4:case n.UniformType.BOOL_VEC4:m.setUniform4iv(d,l)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),
function(a,b,n,h,k,m){class g{constructor(){this.waitingAgents=new h;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}static acquire(c){const l=e.acquire();l._init(c);return l}release(){this.dispose();d.delete(this);e.release(this)}dispose(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=k.releaseTileData(this._data)}static prune(){e.prune(0)}_init(c){this.waitingAgents.clear();
this._data=k.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=c;this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){null!=this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),
this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(c,l){if(c===l||null==l)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===l)return;this._upsampleInfo.tile.unrefMapData()}l.refMapData();m.computeUpsampleInfo(c,l,this._upsampleInfo)}}get data(){return this._data}set data(c){k.releaseTileData(this._data);this._data=c}}const e=new n(g,null,()=>{}),d=new Map;a.TilePerLayerInfo=g;a.printAllocations=
function(){0<d.size&&(console.log(`${d.size} live TilePerLayerInfo allocations:`),d.forEach(c=>console.log(c,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(function(){class a{constructor(b,n){this._texture=b;this._cache=n;this.type="tile-texture";this._refCount=1}retain(){++this._refCount}release(){--this._refCount;0===this._refCount&&(this._cache?this._cache.put(`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`,
this):this.dispose())}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.usedMemory}}return a})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.ELEVATION=2]="ELEVATION";b[b.MERGE=4]="MERGE";b[b.GEOMETRY=8]="GEOMETRY";
b[b.TEXTURE_NOFADING=16]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=32]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../core/libs/gl-matrix-2/factories/vec4f64"],function(a){class b{constructor(){this._scales=a.fromValues(-1,-1,-1,-1);this._offsets=a.fromValues(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=
-1}setScale(n,h,k){this._scales[2*n]=h;this._scales[2*n+1]=k}setOffset(n,h,k){this._offsets[2*n]=h;this._offsets[2*n+1]=k}get scales(){return this._scales}get offsets(){return this._offsets}}return b})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r extends m.ShaderTechnique{constructor(){super(...arguments);this.useStencil=!1}initializeConfiguration(w,p){p.spherical=w.viewingMode===n.ViewingMode.Global}initializeProgram(w){return new e.Program(w.rctx,r.shader.get().build(this.configuration),x)}initializePipeline(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)}_createPipeline(w){const p=this.configuration,t=p.backfaceCullingEnabled&&!p.renderOccluded;return f.makePipelineState({blending:p.renderOccluded?
f.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:t?f.backFaceCullingParams:null,depthTest:p.renderOccluded?null:{func:l.CompareFunction.LESS},depthWrite:p.renderOccluded?null:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilTest:w?d.renderWhenBitIsNotSet(g.StencilBits.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}r.shader=new k.ReloadableShaderModule(h.Terrain,()=>
new Promise((w,p)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],w,p)));const x=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.UV0,1],[c.VertexAttribute.NORMALCOMPRESSED,2]]);b.TerrainTechnique=r;b.terrainVertexAttributeLocations=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B){function z(M){const S=new J.ShaderBuilder,{vertex:N,fragment:P,varyings:R}=S;S.include(f.PositionAttribute);S.include(l.NormalAttribute,M);S.include(r.TextureCoordinateAttribute,M);var O=()=>{S.include(v.NormalUtils,M);N.code.add(I.glsl`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};C.addProjViewLocalOrigin(N,M);S.include(c.Transform,M);const T=M.overlayMode!==G.OverlayMode.Disabled;var Q=T&&M.invisible;switch(M.output){case e.ShaderOutput.Color:S.include(A.TerrainTexture,M);S.include(q.EvaluateSceneLighting,M);T&&S.include(G.OverlayTerrain,{...M,pbrMode:M.pbrMode===y.PBRMode.Simplified?y.PBRMode.TerrainWithWater:y.PBRMode.Water});(Q=M.overlayMode===G.OverlayMode.EnabledWithWater)&&S.include(x.VertexTangent,M);R.add("vnormal","vec3");R.add("vpos","vec3");R.add("vup","vec3");
O();M.screenSizePerspective&&C.addViewNormal(N);(O=M.receiveShadows&&!M.renderOccluded)&&S.include(g.ForwardLinearDepth,M);M.screenSizePerspective&&(R.add("screenSizeDistanceToCamera","float"),R.add("screenSizeCosAngle","float"));N.code.add(I.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${Q?I.glsl`forwardVertexTangent(vnormal);`:I.glsl``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${T?I.glsl`setOverlayVTC(uv);`:""}
          ${M.tileBorders?I.glsl`forwardTextureCoordinates();`:""}

          ${M.screenSizePerspective?I.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${O?I.glsl`forwardLinearDepth();`:""}

        }
      `);S.include(d.SliceDraw,M);S.include(q.EvaluateSceneLighting,M);S.include(t.EvaluateAmbientOcclusion,M);S.include(D.ReadShadowMapDraw,M);C.addCameraPosition(P,M);q.addAmbientBoostFactor(P);q.addLightingGlobalFactor(P);P.uniforms.add(N.uniforms.get("localOrigin"),new E.Float3PassUniform("viewDirection",(V,U)=>h.normalize(F,h.set(F,U.camera.viewMatrix[12],U.camera.viewMatrix[13],U.camera.viewMatrix[14]))));Q&&P.uniforms.add(new B.Texture2DPassUniform("ovWaterTex",(V,U)=>U.overlay?.getTexture(m.OverlayContent.WaterNormal)),
new H.Matrix4DrawUniform("view",(V,U)=>b.translate(L,U.camera.viewMatrix,V.origin)));P.code.add(I.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);u.addMainLightDirection(P);u.addMainLightIntensity(P);P.code.add(I.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${M.receiveShadows&&!M.renderOccluded?"readShadowMap(vpos, linearDepth)":M.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${T?I.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${M.invisible?I.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${M.pbrMode===y.PBRMode.Simplified||M.pbrMode===y.PBRMode.TerrainWithWater?I.glsl`fragColor = vec4(evaluatePBRSimplifiedLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:I.glsl`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${Q?I.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${M.screenSizePerspective?I.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${M.visualizeNormals?M.spherical?I.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:I.glsl`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${M.tileBorders?I.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `);break;case e.ShaderOutput.LinearDepth:Q&&S.include(G.OverlayTerrain,M);S.include(w.OutputDepth,M);g.addLinearDepth(S);g.addNearFar(S);N.code.add(I.glsl`
              void main(void) {
                ${Q?I.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);P.code.add(I.glsl`
              void main() {
                ${Q?I.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case e.ShaderOutput.Shadow:case e.ShaderOutput.ShadowHighlight:case e.ShaderOutput.ShadowExcludeHighlight:S.include(w.OutputDepth,M);g.addLinearDepth(S);g.addNearFar(S);N.code.add(I.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);P.code.add(I.glsl`void main() {
outputDepth(linearDepth);
}`);break;case e.ShaderOutput.Normal:Q&&S.include(G.OverlayTerrain,M);R.add("vnormal","vec3");C.addViewNormal(N);O();N.code.add(I.glsl`
        void main(void) {
          ${Q?I.glsl`setOverlayVTC(getUV0());`:""}
          gl_Position = transformPosition(proj, view, position);
          vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
        }
      `);P.code.add(I.glsl`
        void main() {
          ${Q?I.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
      `);break;case e.ShaderOutput.Highlight:T&&S.include(G.OverlayTerrain,M),N.code.add(I.glsl`
          void main() {
            ${T?I.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),S.include(p.OutputHighlight,M),P.code.add(I.glsl`
          void main() {
            ${T?I.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}M.output===e.ShaderOutput.ObjectAndLayerIdColor&&(T?(S.include(G.OverlayTerrain,{...M,pbrMode:y.PBRMode.Disabled}),N.code.add(I.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),P.code.add(I.glsl`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(N.code.add(I.glsl`void main(void) {}`),P.code.add(I.glsl`void main() {
fragColor = vec4(0.0);
}`)));return S}class K extends A.OverlayTerrainPassParameters{}const L=n.create(),F=k.create();n=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:K,build:z},Symbol.toStringTag,{value:"Module"}));a.Terrain=n;a.TerrainPassParameters=K;a.build=z})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.VertexTangent=function(n,h){n.varyings.add("tbnTangent","vec3");n.varyings.add("tbnBiTangent",
"vec3");h.spherical?n.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):n.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);n.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../shading/ReadShadowMap.glsl ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/interfaces ../../shaderModules/Uniform".split(" "),function(a,b,n,h,k,m){class g extends b.ReadShadowMapPassParameters{constructor(){super(...arguments);this.overlayOpacity=1}}class e extends m.Uniform{constructor(f){super(f,"float")}}class d extends m.Uniform{constructor(f){super(f,
"vec3")}}class c extends m.Uniform{constructor(f){super(f,"vec4")}}class l extends m.Uniform{constructor(f){super(f,"sampler2D")}}a.Float3Uniform=d;a.OverlayTerrainPassParameters=g;a.TerrainTexture=function(f,r){const {vertex:x,fragment:w,varyings:p}=f;p.add("vtc","vec2");x.uniforms.add(new c("texOffsetAndScale"));w.uniforms.add(new l("tex"));w.uniforms.add(new d("textureOpacities"));if(f=r.textureFadingEnabled&&!r.renderOccluded)x.uniforms.add(new c("nextTexOffsetAndScale")),p.add("nvtc","vec2"),
w.uniforms.add(new l("texNext")),w.uniforms.add(new d("nextTexOpacities")),w.uniforms.add(new e("fadeFactor"));const t=r.tileBlendInput===h.TileBlendInput.ColorComposite;(r=r.tileBlendInput===h.TileBlendInput.GridComposite)&&w.include(n.BackgroundGrid);t&&w.uniforms.add(new d("backgroundColor"));x.code.add(k.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${f?k.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:k.glsl``}
  }`);w.code.add(k.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${r||t?k.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${t?k.glsl`backgroundColor`:k.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:k.glsl`return color;`}
    }`);f?w.code.add(k.glsl`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):w.code.add(k.glsl`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r{constructor(){this.extent=f.create();this.maxLevel=this.minLevel=0;this.callback=null}}a.ScaleRangeQueries=class extends n{constructor(){super(...arguments);this._queries=new k({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new k({initialSize:30});this._queryPool=new h(r)}queryVisibleLevelRange(x,w,p,t){const q=this._queryPool.acquire();l.copy(q.extent,x);q.minLevel=null==w?-Number.MAX_VALUE:w;q.maxLevel=null==p?Number.MAX_VALUE:p;q.callback=t;this._queryQueue.push(q);
this.notifyChange("updating")}get updating(){return 0!==this._queryQueue.length}prepare(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const x=this._queryQueue.pop();this._queries.push(x)}this._queriesInvPtr=this._queries.length}process(){for(let x=0;x<this._queries.length;x++){const w=this._queries.data[x];this._queryPool.release(w);w.callback(x>=this._queriesInvPtr);w.callback=null}this._queries.clear();this.notifyChange("updating")}queriesForTile(x){const w=
x.level;let p=0;for(;p<this._queriesInvPtr;){const t=this._queries.data[p],q=t.extent;w>=t.minLevel&&w<=t.maxLevel&&q[0]<=x.extent[2]&&q[2]>=x.extent[0]&&q[1]<=x.extent[3]&&q[3]>=x.extent[1]?(this._queries.swapElements(p,this._queriesInvPtr-1),this._queriesInvPtr--):p++}}};b.__decorate([m.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=b.__decorate([c.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../core/mathUtils ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/lonLatToSphericalPCPF ../../../geometry/support/DoubleArray ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./ITile ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(D,G,A,C,E,I){D=C-D;G=E-G;A=I-A;return D*
D+G*G+A*A}class p extends r.Tile{constructor(D,G,A,C,E){super();this._convexHull=Array(24);this._boundingSphere=e.create();this._baseUsedMemory=1816;this.init(D,G,A,C,E)}init(D,G,A,C,E){super.init(D,G,A,C,E);G=this.ellipsoid.radius;A=this.extentInRadians[0];C=this.extentInRadians[1];E=this.extentInRadians[2];const I=this.extentInRadians[3],H=b.lerp(C,I,.5),J=b.lerp(A,E,.5);this._edgeLen=(E-A)*Math.cos(0===D?0:Math.min(Math.abs(C),Math.abs(I)))*G;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=
G-Math.sqrt(G*G-this._edgeLen2/4);k.lonLatToSphericalPCPF(this.centerAtSeaLevel,J,H,this.ellipsoid.radius);n.normalize(this.up,this.centerAtSeaLevel);this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const D=this._center;if(0===this.lij[0])n.set(e.getCenter(D[r.CenterPosition.MIDDLE]),0,0,0),n.set(D[r.CenterPosition.TOP],0,0,0),n.set(D[r.CenterPosition.BOTTOM],0,0,0),D[r.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBoundsMax;else{this._updateCenter();
const H=D[r.CenterPosition.MIDDLE],J=this.convexHull;var G=0;for(let B=0;8>B;++B){var A=Math,C=A.max;var E=e.getCenter(H);var I=3*B;E=w(E[0],E[1],E[2],J[I],J[I+1],J[I+2]);G=C.call(A,G,E)}D[r.CenterPosition.MIDDLE][3]=Math.sqrt(G)}}_calculateFrustumVisibilityStatus(D){if(!g.intersectsSphere(D,this._boundingSphere))return c.TileFrustumVisibility.OUTSIDE;if(10>this.lij[0])return c.TileFrustumVisibility.INTERSECTS;const G=this.convexHull,A=this.surface.view.state.camera.near;let C=!0;for(let I=0;I<g.numPlanes;I++){var E=
D[I];const H=E[0],J=E[1],B=E[2];E=E[3]-(I===g.PlaneIndex.NEAR?A:0);let z=!1;for(let K=0;8>K;++K){const L=3*K;if(0>H*G[L]+J*G[L+1]+B*G[L+2]+E){if(z=!0,!C)break}else C=!1}if(!z)return c.TileFrustumVisibility.OUTSIDE}return C?c.TileFrustumVisibility.INSIDE:c.TileFrustumVisibility.INTERSECTS}computeElevationBounds(){super.computeElevationBounds();this._updateBoundingVolumes()}createGeometry(){l.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull();
this._updateBoundingSphere();f.enableTerrainInternalChecks&&this._checkBVs()}_updateBoundingSphere(){const D=this._boundingSphere,G=e.getCenter(D);var A=this.elevationBoundsMin,C=this.elevationBoundsMax,E=this.ellipsoid.radius;if(0===this.level)n.set(G,0,0,0),D[3]=E+C;else{var I=this.extentInRadians,H=.5*(I[0]+I[2]),J=I[3];q(v,H,I[1],E);q(y,H,J,E);n.add(G,v,y);n.scale(G,G,(E+.5*(A+C))/n.len(G));A=this.convexHull;C=0;for(E=0;8>E;++E)I=G[0]-A[3*E],H=G[1]-A[3*E+1],J=G[2]-A[3*E+2],C=Math.max(C,Math.sqrt(I*
I+H*H+J*J));D[3]=C+2}}_updateConvexHull(){var D=this.extentInRadians,G=this.ellipsoid.radius;if(0!==this.level){var A=this.elevationBoundsMin,C=this.elevationBoundsMax,E=this._getPatchType(),I=this.surface.isWebMercator,H=I&&E===d.PatchType.HAS_NORTH_POLE,J=(E=I&&E===d.PatchType.HAS_SOUTH_POLE)||H;I=Math.PI/2;var B=D[0],z=D[2];E=E?-I:D[1];var K=H?I:D[3],L=.5*(B+z),F=G+(J?Math.min(0,A-1):A);A=h.create();D=h.create();H=h.create();I=h.create();q(A,B,E,F);q(D,B,K,F);q(H,z,K,F);q(I,z,E,F);B=(R,O)=>{for(let T=
0;3>T;++T)this._convexHull[3*O+T]=R[T]};B(A,0);B(D,1);B(H,2);B(I,3);var M=G+(J?Math.max(0,C+1):C),S=h.create();G=h.create();C=h.create();q(G,L,K,F);q(C,L,E,F);n.add(S,G,C);n.normalize(S,S);var N=h.create(),P=h.create();E=(R,O)=>{n.sub(P,R,O);n.normalize(P,P);O=-n.dot(R,N)/n.dot(P,N);f.internalAssert(0<=O);n.scale(P,P,O);n.add(R,R,P)};2**this.lij[0]>2*this.lij[1]?(G=h.create(),n.cross(G,u,C),n.normalize(G,G),n.cross(N,C,G),n.normalize(N,N),f.internalAssert(f.almostEquals(n.dot(N,C)/n.len(C),0)),E(A,
D),E(I,H),B(A,0),B(I,3)):2**this.lij[0]!==2*this.lij[1]&&(C=h.create(),n.cross(C,u,G),n.normalize(C,C),n.cross(N,C,G),n.normalize(N,N),E(D,A),E(H,I),B(D,1),B(H,2));G=(R,O)=>{const T=M/n.dot(O,S);for(let Q=0;3>Q;++Q)this._convexHull[3*R+Q]=O[Q]*T};G(4,A);G(5,D);G(6,H);G(7,I)}}_getPatchType(){const D=this.lij[1],G=D===(1<<this.level)-1;return 0===D?G?d.PatchType.HAS_BOTH_POLES:d.PatchType.HAS_NORTH_POLE:G?d.PatchType.HAS_SOUTH_POLE:d.PatchType.REGULAR}intersectsRay(D,G,A,C){var E=this._boundingSphere;
A=E[3]+A;var I=E[0]-D[0];C=E[1]-D[1];D=E[2]-D[2];E=(I*G[0]+C*G[1]+D*G[2])/(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);I=G[0]*E-I;C=G[1]*E-C;G=G[2]*E-D;return I*I+C*C+G*G<A*A}getDefaultVerticesPerSide(){return this.level<t.length?t[this.level]+1:2}updateCornerElevations(){l.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevations(){l.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()}updateEdgeElevationsAndResolutions(){l.updateEdgeElevationsAndResolutionsSpherical(this.renderData);
this._updateBoundingVolumes()}_checkBVs(){if(f.enableTerrainInternalChecks&&!(2>=this.level)){var D=this._boundingSphere,G=D[3],A=e.getCenter(D);D=h.create();var C=this.ellipsoid.radius,E=this.elevationBoundsMin,I=this.elevationBoundsMax,H=C+E,J=this._center[r.CenterPosition.MIDDLE][3],B=this.convexHull,z=(va,Ca)=>{for(let ma=0;3>ma;++ma)va[ma]=B[3*Ca+ma]},K=h.create(),L=h.create(),F=h.create(),M=h.create(),S=h.create(),N=(va,Ca,ma,wa)=>{z(L,va);z(F,Ca);z(M,ma);n.sub(L,L,F);n.sub(M,M,F);n.cross(K,
L,M);n.normalize(K,K);var Ba=n.dot(K,F);z(S,wa);const pa=n.dot(K,S);Ba=Math.abs(pa-Ba);f.internalAssert(f.almostEquals(Ba,0),`Non coplanar ${va},${Ca},${ma},${wa} diff = ${Ba}`)};N(0,1,2,3);N(4,5,6,7);N(0,1,4,5);N(1,2,5,6);N(2,3,6,7);N(3,0,7,4);var P=m.newDoubleArray(24),R=h.create(),O=h.create(),T=h.create(),Q=h.create();N=(va,Ca,ma,wa)=>{z(R,Ca);z(O,ma);z(T,wa);n.sub(R,R,O);n.normalize(R,R);n.sub(T,T,O);n.normalize(T,T);n.cross(Q,R,T);n.normalize(Q,Q);Ca=n.dot(Q,O);va*=4;for(ma=0;3>ma;++ma)P[va+
ma]=Q[ma];P[va+3]=Ca};N(0,0,1,2);N(1,1,0,4);N(2,1,5,2);N(3,3,2,6);N(4,4,0,3);N(5,4,6,5);var V=(va,Ca,ma,wa)=>{va*=4;return P[va]*Ca+P[va+1]*ma+P[va+2]*wa-P[va+3]},U=(va,Ca,ma,wa)=>-1<=V(va,Ca,ma,wa),W=2**this.lij[0]>2*this.lij[1];N=(va,Ca,ma)=>Math.sqrt(w(va,Ca,ma,A[0],A[1],A[2]))<G;var ca=this.extentInRadians,X=.5*(ca[0]+ca[2]),ba=ca[1],ia=ca[3];ca=h.create();var fa=h.create();q(ca,X,ia,H);q(fa,X,ba,H);H=W?"Upper":"Lower";W=!0;for(X=0;6>X;++X){for(ba=0;8>ba;++ba)ia=3*ba,ia=-1<=V(X,B[ia],B[ia+1],
B[ia+2]),W&&=ia,f.internalAssert(ia,`Tile[${this.lij}] Convex hull point ${ba} outside of plane ${X}`);f.internalAssert(U(X,fa[0],fa[1],fa[2]),`Tile[${this.lij}] (${H}) bottom mid outside of plane ${X}`);f.internalAssert(U(X,ca[0],ca[1],ca[2]),`Tile[${this.lij}] (${H}) top mid outside of plane ${X}`)}f.internalAssert(W,"Not all convex hull points are inside  convex hull polyhedron");f.internalAssert(N(fa[0],fa[1],fa[2]),`Tile[${this.lij}] (${H}) bottom mid outside of bounding sphere`);f.internalAssert(N(ca[0],
ca[1],ca[2]),`Tile[${this.lij}] (${H}) top mid outside of bounding sphere`);for(U=0;8>U;++U)ca=3*U,ca=N(B[ca],B[ca+1],B[ca+2]),f.internalAssert(ca,`Tile[${this.lij}] Convex hull point ${U} outside of bounding sphere`);for(N=0;6>N;++N)for(U=0;8>U;++U)ca=3*U,-1<=V(N,B[ca],B[ca+1],B[ca+2])||console.error(`Tile[${this.lij}] Convex hull point ${U} outside of plane ${N}`);({extentInRadians:N}=this);N=Math.round(Math.max(N[2]-N[0],N[3]-N[1])*C);({renderData:U}=this);if(U){var {geometry:da,geometryState:aa,
localOrigin:ea}=U;if(U=da.vertexAttributes?.position){ca=h.create();fa=da.numVerticesPerSide-2;var {indices:ha,indexCount:Y,edgeVerticesStartIndex:Z,poleVerticesStartIndex:ja}=da;if(ha)for(H=new Set,W=0;W<Y;++W){const va=ha[W];if(H.has(va))continue;H.add(va);const Ca=va<ja,ma=va>=Z;let wa=!1;X=-1;if(ma)for(ba=Z,ia=0;4>ia;++ia){var oa=aa.edgeResolutions[ia];if(va===ba||va===ba+oa-1){wa=!0;break}ba+=oa;if(va<ba){X=ia;break}}X=ma?aa.edgePeerNeighbors[X]:null;const Ba=ma&&X&&0<x.compareTilesByLij(this,
X);U.getVec(va,D);n.add(ca,D,ea);X=n.len(ca)-C;ba=0;ia=!1;oa=E-X;const pa=X-I,Aa=1<oa,ra=1<pa;var qa=Aa||ra;const ua=()=>{const Ea=ma&&!wa;return`Tile[${this.lij}].vertex[${va}]:${Ca?"internal":Ea?"edge":wa?"corner":"pole"}`+(Aa?"(below)":ra?"(above)":"")+(Ba?"(Neighbor)":"")};var ta=n.dist(ca,A);ta>=G+0&&(ta-=G,qa||(console.error(`${ua()} is out of the bounding sphere by ${ta.toFixed(0)} / ${G.toFixed(0)}`+"[tol\x3d0]"+` h=${X.toFixed(0)} / [${E.toFixed(0)}..${I.toFixed(0)}] (${(ta/G).toFixed(0)})`),
ia=!0));for(qa=0;6>qa;++qa)if(!(-1<=V(qa,ca[0],ca[1],ca[2]))){ta=V(qa,ca[0],ca[1],ca[2]);const Ea=va%fa,Ka=(va-Ea)/fa;0===qa&&oa||5===qa&&pa||(console.error(`${ua()} (${Ea},${Ka})|${fa}] is out of the bounding trapezoid plane ${qa}`+` h=${Math.round(X)} / [${Math.round(E)}..${Math.round(I)}] dist=${Math.round(ta)}`+` radii = ${Math.round(G)}/${Math.round(J)}} : maxL = ${N}`),++ba)}if(ia||0<ba)break}}}}}get convexHull(){return this._convexHull}}const t=[128,64,64,32,16,8,8,4],q=(D,G,A,C)=>{const E=
Math.sin(G),I=Math.cos(A);A=Math.sin(A);D[0]=C*I*Math.cos(G);D[1]=C*I*E;D[2]=C*A},u=[0,0,1],v=h.create(),y=h.create();a.SphericalPatch=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/lonLatToSphericalPCPF":function(){define(["exports"],function(a){a.lonLatToSphericalPCPF=function(b,n,h,k){const m=Math.cos(h);b[0]=Math.cos(n)*m*k;b[1]=Math.sin(n)*m*k;b[2]=Math.sin(h)*k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){a.SplitLimits=class extends n{constructor(){super(...arguments);this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}};b.__decorate([h.property()],a.SplitLimits.prototype,"fovX",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"fovY",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"relativeWidthLimit",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"relativeHeightLimit",
void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"maxLod",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"angledSplitBias",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"aboveGround",void 0);b.__decorate([h.property()],a.SplitLimits.prototype,"frustum",void 0);a.SplitLimits=b.__decorate([e.subclass("esri.views.3d.terrain.SplitLimits")],a.SplitLimits);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/tslib.es6 ../../../Color ../../../core/has ../../../core/maybe ../../../core/MemCachePool ../../../core/ObjectPool ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./OverlayContent ./OverlayRenderer ./PatchRenderData ./RenderOrder ./TerrainAttributesCache ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/effects/RenderPlugin ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa){const da=t.create();a.TransparencyMode=void 0;(function(Z){Z[Z.Opaque=0]="Opaque";Z[Z.Semitransparent=1]="Semitransparent";Z[Z.TransparentWithDraped=2]="TransparentWithDraped";Z[Z.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=class extends M.SyncPrepareRenderPlugin{get _isGlobal(){return this._stage.viewingMode===u.ViewingMode.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(Z,
ja,oa,qa,ta){super({});this._overlayRenderer=Z;this._stage=ja;this._allTiles=oa;this._ellipsoidRadius=qa;this.type=O.IntersectorType.TERRAIN;this.isGround=!0;this._tileSize=256;this._techniqueConfiguration=new ia.TerrainTechniqueConfiguration;this._passParameters=new L.TerrainPassParameters;this._drawParameters=new ca.DrawParameters;this._renderDataPool=new g(A.PatchRenderData);this._visiblePatchesByOrigin=new Map;this._allPatchesByOrigin=new Map;this._patchSortingDirty=this._patchesByOriginDirty=
!0;this._tileIterator=new B.IteratorPreorder;this._transparencyState=a.TransparencyMode.Opaque;this._castShadows=!1;this._tileRenderer=this._emptyTex=null;this._stencilEnabledLayerExtents=[];this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;this.renderOccludedFlags=T.RenderOccludedFlag.Occlude;this.produces=new Map([[Q.RenderSlot.OPAQUE_TERRAIN,()=>this._produces()],[Q.RenderSlot.TRANSPARENT_TERRAIN,()=>this._produces()],[Q.RenderSlot.OCCLUDED_TERRAIN,()=>this._produces()]]);
this._tileTextureCache=new m.MemCachePool((va,Ca)=>ta.newCache(va,Ca),"TileTexture");this.tileGeometryCache=new E.TerrainAttributesCache(ta)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this);this.addHandles(e.watch(()=>this._overlayRenderer.rendersOccludedDraped,Z=>{this.renderOccludedFlags=Z?G.overlayRenderOccludedFlag:T.RenderOccludedFlag.Occlude;this.setNeedsRender()},e.sync))}destroy(){this._stage.removeRenderPlugin(this);this._tileTextureCache.destroy();this.tileGeometryCache.destroy()}_produces(){return this.visible&&
!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?M.ConsumesDepth:M.ConsumesNone}set renderingDisabled(Z){this._set("renderingDisabled",!!Z);this.setDirty()}set visible(Z){this._set("visible",!!Z);this.setDirty()}set transparency(Z){this._transparencyState!==Z&&(this._techniqueConfiguration.invisible=Z===a.TransparencyMode.TransparentWithDraped||Z===a.TransparencyMode.Empty,this._transparencyState=Z,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(Z){this._techniqueConfiguration.tileBorders!==
Z&&(this._techniqueConfiguration.tileBorders=Z,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(Z){this._techniqueConfiguration.visualizeNormals!==Z&&(this._techniqueConfiguration.visualizeNormals=Z,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(Z){this._techniqueConfiguration.backfaceCullingEnabled!==
Z&&(this._techniqueConfiguration.backfaceCullingEnabled=Z,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(Z){this._set("renderOrder",Z);this._setSortingDirty()}get layerUid(){return W.terrainId}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(Z){this._techniqueConfiguration.hasSlicePlane!==Z&&(this._techniqueConfiguration.hasSlicePlane=Z,this.setNeedsRender())}set textureFadingEnabled(Z){this._techniqueConfiguration.textureFadingEnabled!==
Z&&(this._techniqueConfiguration.textureFadingEnabled=Z,this.setNeedsRender())}set pbrMode(Z){this._techniqueConfiguration.pbrMode!==Z&&(this._techniqueConfiguration.pbrMode=Z,this.setNeedsRender())}setDebugScreenSizePerspective(Z){this._techniqueConfiguration.screenSizePerspective!==Z&&(this._techniqueConfiguration.screenSizePerspective=Z,this.setNeedsRender())}setRootTiles(Z){this._rootTiles=Z;this.setDirty()}setStencilEnabledLayerExtents(Z){this._stencilEnabledLayerExtents=Z;this._setSortingDirty()}setTileSize(Z){this._tileSize=
Z;null!=this._tileRenderer&&(this._tileRenderer.tileSize=Z);this.setDirty()}_prepareTileForLoading(Z){Z.renderData||(Z.renderData=this._renderDataPool.acquire(),Z.renderData.init(Z,this._getLocalOriginOfTile(Z)))}loadTile(Z){this._prepareTileForLoading(Z);this.updateTileGeometryState(Z);this.updateTileTexture(Z,J.TileUpdate.TEXTURE_FADING)}updateTileTexture(Z,ja){null!=this._tileRenderer&&(this._tileRenderer.updateTileTexture(Z,ja===J.TileUpdate.TEXTURE_FADING?v.TextureUpdate.FADING:v.TextureUpdate.UNFADED),
this.setNeedsRender(),Z.resetPendingUpdate(ja))}updateTileGeometryState(Z){for(const ja of Z.layerInfo[y.LayerClass.ELEVATION])ja.pendingUpdates&=~J.TileUpdate.GEOMETRY;Z.resetPendingUpdate(J.TileUpdate.GEOMETRY);(Z=Z.renderData.updateGeometryState())&&this.setDirty();return Z}updateGeometryIfNeeded(Z){Z.isLoaded&&Z.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(Z){const ja=Z.renderData;ja&&(ja.releaseGeometry(),this._renderDataPool.release(ja),ja.clear(),Z.renderData=null,Z.setMemoryDirty(),
this.setDirty())}_getLocalOriginOfTile(Z){const ja=Math.max(0,7*Math.floor((Z.level-3)/7));if(this._isGlobal&&0===ja)return w.ZEROS;for(;Z.parent&&Z.level>ja;)Z=Z.parent;return Z.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(Z){this._get("wireframe")!==Z&&(this._set("wireframe",Z),this.setNeedsRender())}setDirty(Z=N.RenderRequestType.UPDATE){this._patchesByOriginDirty=!0;this._context.requestRender(Z)}_setSortingDirty(Z=
N.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(Z)}setNeedsRender(Z=N.RenderRequestType.UPDATE){this._context.requestRender(Z)}initializeRenderContext(Z){this._context=Z;this._tileRenderer=new H.TileRenderer(this._rctx,this._tileSize,this._techniques,this._tileTextureCache);this.updateTileBackground();this._emptyTex=P.createEmptyTexture(this._rctx)}uninitializeRenderContext(){this._emptyTex=k.disposeMaybe(this._emptyTex);this._tileRenderer=k.disposeMaybe(this._tileRenderer)}intersect(Z,
ja,oa,qa){if(!(!this._rootTiles||Z.options.selectOpaqueTerrainOnly&&Z.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var ta=aa,va=ea;x.subtract(ta,qa,oa);x.set(va,1/ta[0],1/ta[1],1/ta[2]);var Ca=Z.results.min,ma=Z.results.max,wa=Z.results.ground,Ba=Z.options.store===O.StoreResults.MIN,pa=!!Z.results.ground.target,Aa=W.getVerticalOffsetTerrain(Z.verticalOffset),ra=Z.tolerance,ua,Ea=Ba&&null!=Ca.dist?Ca.dist:Infinity,Ka=Ua=>{var Ga=Ua.renderData;if(Ga?.vao){var Na=Ga.geometry;
t.set(da,Na.boundingBox);var Va=Ga.localOrigin;null!=Aa&&(Aa.localOrigin=Va,Aa.applyToAabb(da));ha[0]=oa[0]-Va[0];ha[1]=oa[1]-Va[1];ha[2]=oa[2]-Va[2];if(X.intersectAabbInvDirBefore(da,ha,va,ra,Ea)){var Xa=(cb,ka,mb)=>{cb.set(this.type,Ua,ka,mb,r.IDENTITY);Ea=Ba&&null!=Ca.dist?Ca.dist:Infinity};Ga=(cb,ka)=>{null!=ka&&0<=cb&&(Z.options.backfacesTerrain||0>x.dot(ka,ta))&&(Z.options.invisibleTerrain||!Z.options.selectionMode||null==ja||ja(oa,qa,cb))&&((null==wa.dist||cb<wa.dist)&&Xa(wa,cb,ka),Z.options.isFiltered||
(Z.options.store===O.StoreResults.ALL&&(null==ua?(ua=R.newIntersectorResult(Z.ray),Xa(ua,cb,ka),Z.results.all.push(ua)):cb<ua.dist&&Xa(ua,cb,ka)),(null==Ca.dist||cb<Ca.dist)&&Xa(Ca,cb,ka),Z.options.store!==O.StoreResults.MIN&&(null==ma.dist||cb>ma.dist)&&Xa(ma,cb,ka)))};var Pa=Y;x.subtract(Pa,qa,Va);var {indices:bb,indexCount:gb}=Na;Na=Na.vertexAttributes;Va=Na.getField(U.VertexAttribute.POSITION,q.BufferViewVec3f);Na=new S.Vertices(Va.typedBuffer,3,Na.stride/4);Va=gb/3;if(!Aa&&Va>z.componentMinimalSizeForIntersectionData){const cb=
Ua.renderData;null==cb.intersectionData&&(cb.intersectionData=new z.ComponentIntersectionData(bb,0,Va,Na));cb.intersectionData.intersectRay(ha,Pa,Ga)}else X.intersectTriangles(ha,Pa,0,Va,bb,Na,null,Aa,Ga)}}},Ma=this._rootTiles;null!=Ma&&(()=>{const Ua=this._tileIterator;Ua.reset(Ma);const Ga=Z.options.invisibleTerrain;for(let Na=Ua.next();Na;Na=Ua.next())!(Na.visible||Ga&&Na.intersectsClippingArea)||null==Aa&&!Na.intersectsRay(oa,ta,ra,Ea)||pa&&this._useStencilForTile(Na)?Ua.skipSubtree():Ka(Na)})()}}processScaleRangeQueries(Z,
ja){if(!ja.done)for(this._updatePatchGroups();Z.updating&&!ja.done;){Z.prepare();for(const oa of this._visiblePatchesByOrigin.values())for(const qa of oa)null!=qa.renderData?.textureReference&&Z.queriesForTile(qa);Z.process();ja.madeProgress()}}prepareTechnique(Z){const ja=h("enable-feature:terrain-shadows")&&Z.bindParameters.shadowMap.enabled;ja!==this._castShadows&&(this._castShadows=ja,this._patchesByOriginDirty=!0);if(Z.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN){if(0===(Z.renderOccludedMask&
G.overlayRenderOccludedFlag))return null}else if(Z.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?Q.RenderSlot.OPAQUE_TERRAIN:Q.RenderSlot.TRANSPARENT_TERRAIN))return null;if(this.transparency===a.TransparencyMode.Empty)return null;switch(Z.output){case K.ShaderOutput.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=null!=Z.bindParameters.ssr.lastFrameColor,this._techniqueConfiguration.hasCloudsReflections=null!=Z.bindParameters.cloudsFade.data,this._techniqueConfiguration.receiveShadows=
Z.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=null!=Z.bindParameters.ssao,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(K.ShaderOutput.Color,Z.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN);case K.ShaderOutput.Shadow:case K.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.ShaderOutput.Shadow,
!1);break;case K.ShaderOutput.LinearDepth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.ShaderOutput.LinearDepth,!1);case K.ShaderOutput.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.ShaderOutput.Normal,!1);case K.ShaderOutput.ObjectAndLayerIdColor:return this._updateTechnique(K.ShaderOutput.ObjectAndLayerIdColor,!1);case K.ShaderOutput.Highlight:if(this._overlayRenderer.hasHighlights)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.ShaderOutput.Highlight,!1)}return null}renderNode(Z,ja){this._updatePatchGroups();ja.useStencil=!1;switch(Z.output){case K.ShaderOutput.Color:this._renderMaterialPass(Z,ja,Z.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN?D.OverlayContent.Occluded:D.OverlayContent.Color);break;case K.ShaderOutput.LinearDepth:case K.ShaderOutput.Normal:this._renderAuxiliaryPass(Z,ja,D.OverlayContent.Color,this._visiblePatchesByOrigin);
break;case K.ShaderOutput.Highlight:this._renderAuxiliaryPass(Z,ja,D.OverlayContent.Highlight,this._visiblePatchesByOrigin);break;case K.ShaderOutput.Shadow:case K.ShaderOutput.ShadowExcludeHighlight:this._renderAuxiliaryPass(Z,ja,null,this._allPatchesByOrigin);break;case K.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(Z,ja,D.OverlayContent.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(Z){if(null!=this._tileRenderer){var ja=this._tileRenderer;if(null!=Z){Z=
n.toUnitRGBA(Z);var oa=w.fromValues(Z[0]||0,Z[1]||0,Z[2]||0)}ja.setBackground(oa);this._allTiles.forAll(qa=>ja.updateTileTexture(qa,v.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=ja.backgroundIsGrid?F.TileBlendInput.GridComposite:null!=ja.backgroundColor?F.TileBlendInput.ColorComposite:F.TileBlendInput.LayerOnly;this.setNeedsRender()}}_updatePatchGroups(){this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&
this.renderOrder!==C.RenderOrder.NONE){const Z=Array.from(this._visiblePatchesByOrigin.values()),ja=this._stencilEnabledLayerExtents;for(const oa of Z)B.sortTiles(this.renderOrder,oa,ja);Z.sort((oa,qa)=>B.compareTiles(oa[0],qa[0],this.renderOrder));this._visiblePatchesByOrigin=new Map(Z.map(oa=>[oa[0].renderData.localOrigin,oa]));this._patchSortingDirty=!1}}_rebuildPatchGroups(){const Z=this._rootTiles;if(null!=Z){Z[0]?.surface.checkAllTilesWaterproofness();this._visiblePatchesByOrigin.clear();this._allPatchesByOrigin.clear();
for(const ja of Z)this._rebuildPatchGroupsForRootTile(ja)}}_rebuildPatchGroupsForRootTile(Z){const ja=this._tileIterator;for(ja.resetOne(Z);!ja.done;){Z=ja.next();var oa=Z.renderData;if(oa){oa=oa.localOrigin;if(this._castShadows){var qa=this._allPatchesByOrigin.get(oa);qa||(qa=[],this._allPatchesByOrigin.set(oa,qa));qa.push(Z)}Z.visible?(qa=this._visiblePatchesByOrigin.get(oa),qa||(qa=[],this._visiblePatchesByOrigin.set(oa,qa)),qa.push(Z),ja.skipSubtree()):(this._numTilesCulled++,ja.skipSubtree())}else this._numTilesCulled++}}_useStencilForTile(Z){for(const ja of this._stencilEnabledLayerExtents)if(Z.intersectsExtent(ja))return!0;
return!1}_renderAuxiliaryPass(Z,ja,oa,qa){const ta=Z.rctx;this._passParameters.overlayContent=oa;ta.bindTechnique(ja,Z.bindParameters,this._passParameters);const va=0<this._stencilEnabledLayerExtents.length;qa.forEach(Ca=>{this._drawParameters.origin=Ca[0].renderData.localOrigin;ja.program.bindDraw(this._drawParameters,Z.bindParameters,this._passParameters);for(let ma=0;ma<Ca.length;ma++)this._renderPatch(Z,ja,Ca[ma],fa.PrimitiveType.TRIANGLES,va,oa)});Z.rctx.bindVAO(null)}_renderMaterialPass(Z,ja,
oa){var {rctx:qa}=Z;this._passParameters.overlayContent=oa;qa.bindTechnique(ja,Z.bindParameters,this._passParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;var ta=Z.bindParameters.camera;qa=ja.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&V.getSettings(this._stage.viewingMode,this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ta.fovY});ta=0<this._stencilEnabledLayerExtents.length;
const va=oa===D.OverlayContent.Occluded;va&&(qa.bindTexture("tex",this._emptyTex),qa.setUniform3fv("textureOpacities",w.ZEROS),qa.setUniform4fv("texOffsetAndScale",p.ZEROS));var Ca=null!=this._tileRenderer?.backgroundColor?this._tileRenderer.backgroundColor:w.ZEROS;this._techniqueConfiguration.tileBlendInput===F.TileBlendInput.ColorComposite&&qa.setUniform3fv("backgroundColor",Ca);Ca=this.wireframe?fa.PrimitiveType.LINES:fa.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&
qa.bindTexture("texNext",this._emptyTex);var ma=this._visiblePatchesByOrigin;for(const wa of ma.values()){ja.program.bindDraw(new ca.DrawParameters(wa[0].renderData.localOrigin),Z.bindParameters,this._passParameters);this._numOriginsRendered++;for(const Ba of wa){ma=Ba.renderData;const pa=ma.textureReference;if(null!=pa){if(!va){qa.setUniform4fv("texOffsetAndScale",pa.offsetAndScale);qa.bindTexture("tex",pa.texture.texture);const Aa=ma.textureFadeFactor,ra=1>Aa?ma.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&
null!=ra&&1>Aa?(qa.setUniform1f("fadeFactor",Aa),qa.setUniform4fv("nextTexOffsetAndScale",ra.offsetAndScale),qa.setUniform3fv("nextTexOpacities",ra.opacities),qa.bindTexture("texNext",ra.texture.texture)):qa.setUniform1f("fadeFactor",1);ma.textureIsFading&&this.setNeedsRender();qa.setUniform3fv("textureOpacities",pa.opacities)}this._renderPatch(Z,ja,Ba,Ca,ta,oa);Ba.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}Z.rctx.bindVAO(null)}_renderPatch(Z,ja,oa,qa,ta,va){const Ca=oa.renderData,
ma=Ca.vao,wa=ma?.indexBuffer;if(ma&&null!=wa){var Ba=ja.program;null==va||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(Ba,Ca.overlay);ta&&(ja.useStencil=this._useStencilForTile(oa),Z.rctx.setPipelineState(ja.getPipeline()));ja=Ca.geometry.indexCount;Z.rctx.bindVAO(ma);Ba.assertCompatibleVertexAttributeLocations(ma);Z.rctx.drawElements(qa,ja,wa.indexType,0)}else I.enableTerrainInternalChecks&&console.error("Rendered tile with no indices: ",oa.lij," : ",Ca)}_bindOverlayPatchData(Z,ja){Z.setUniform4fv("overlayTexOffset",
ja.offsets);Z.setUniform4fv("overlayTexScale",ja.scales)}_updateTechnique(Z,ja){this._techniqueConfiguration.output=Z;this._techniqueConfiguration.renderOccluded=ja;return this._shaderTechnique=this._techniques.releaseAndAcquire(ba.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)}get test(){return{tileRenderer:this._tileRenderer}}};b.__decorate([d.property({readOnly:!0})],a.TerrainRenderer.prototype,"_isGlobal",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"renderOccludedFlags",
void 0);b.__decorate([d.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);b.__decorate([d.property({value:!0})],a.TerrainRenderer.prototype,"visible",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"cullBackFaces",null);b.__decorate([d.property({value:C.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,
"renderOrder",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=b.__decorate([f.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);const aa=w.create(),ea=w.create(),ha=w.create(),Y=w.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributesCache":function(){define(["exports","../../../core/MemCachePool","./TerrainAttributes"],function(a,b,n){class h{constructor(k){this._storage=
new b.MemCachePool((m,g)=>k.newCache(m,g),"TileGeometry")}acquire(k){k=4*Math.ceil(k/4);const m=this._storage,g=k.toString(),e=m.pop(g);if(e)return e;const d=n.terrainAttributesLayout.createBuffer(k);d.release=()=>m.put(g,d);return d}clear(){this._storage.clear()}destroy(){this._storage.destroy()}}a.TerrainAttributesCache=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainAttributes":function(){define(["exports","../support/buffer/InterleavedLayout","../webgl-engine/lib/VertexAttribute"],
function(a,b,n){b=b.newLayout().vec3f(n.VertexAttribute.POSITION).vec2i16(n.VertexAttribute.UV0).vec2i16(n.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});a.terrainAttributesLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../core/maybe ../../../core/libs/gl-matrix-2/math/vec2 ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./ITile ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileRenderInfo ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(F,M,S){z.layerIndex=M;z.vtlNeighborInfos.clear();const N=F.layerInfo[c.LayerClass.MAP][M];n.set(z.offset,0,0);z.tile=F;z.scale=1;z.sourceLod=F.lij;z.sourceLayerInfo=N;z.isVTLBackground=S;if(N.data)return S&&F.forEachLoadedNeighbor((R,O)=>{if(R.level===F.level){var T=R.layerInfo[c.LayerClass.MAP][M];if(l.isVectorTilePerLayerInfo(T)&&N.data!==T.data){var Q=z.vtlNeighborInfos.pushNew();Q.offset=L[O];Q.sourceLod=R.lij;Q.sourceLayerInfo=
T}}}),z;const P=N.upsampleInfo;return P?(S=P.tile.layerInfo[c.LayerClass.MAP][M],z.tile=P.tile,n.copy(z.offset,P.offset),z.scale=P.scale,z.sourceLod=P.tile.lij,z.sourceLayerInfo=S,z):S?z:null}function C(F){let M="normal"!==F.blendMode;k.isGroupLayer(F.parent)&&(M=C(F.parent)||M);return M}function E(F,M){k.isGroupLayer(F.parent)&&E(F.parent,M);const S=F.uid;if(null!=S&&""!==S){const N=J.get(S);N?N.start=M:J.set(S,new I(M,M,F.blendMode,F.opacity,u.BlendLayersOutput.Composite,1))}}class I{constructor(F,
M,S,N,P,R){this.start=F;this.end=M;this.blendMode=S;this.opacity=N;this.output=P;this.baseOpacity=R}}class H{constructor(F,M,S,N){this._rctx=F;this.tileSize=M;this._techniques=S;this._cache=N;this._passParameters=new g.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new x.TileCompositor(this._rctx,this._techniques);this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=
b.disposeMaybe(this._composition);this._backgroundTexture=b.releaseMaybe(this._backgroundTexture)}get backgroundIsGrid(){return null==this._backgroundColor}get backgroundColor(){return this._backgroundColor}updateTileTexture(F,M){if(F.renderData){var S=F.surface,N=S.baseOpacity,P=0,R=0,O=this.tileSize,T=!1,Q=!1,V=S.view.state.contentPixelRatio,U=!1;J.clear();B.length=0;for(var W=F.layerInfo[c.LayerClass.MAP],ca=0,X=null;ca<W.length;ca++){const da=S.layerViewByIndex(ca,c.LayerClass.MAP);var ba=da.layer.opacity;
const aa=da.fullOpacity;Q=Q||k.isBaseLayer(da.layer);if(l.isBlendableLayerView(da)){var ia="normal"!==da.layer.blendMode;if(k.isGroupLayer(da.layer.parent)){var fa=da.layer.parent.uid;null!=fa&&""!==fa&&(ia=C(da.layer.parent)||ia)}ia&&(U=ia,T=!1)}if(0!==ba||U){if(++R,ba=l.isVectorTileLayerView(da),ia=A(F,ca,ba))W[ca].pendingUpdates&=~(t.TileUpdate.TEXTURE_NOFADING&t.TileUpdate.TEXTURE_FADING),k.isGroupLayer(da.layer.parent)&&(fa=da.layer.parent.uid,null!=fa&&""!==fa&&E(da.layer.parent,ca)),ba?O=Math.max(O,
this.tileSize*V):1===N&&1===aa&&(da.isOpaque||this._dataToTexture(ia)&&ia.sourceLayerInfo.data.descriptor.isOpaque)&&(T=!0),++P,null===X&&(X=ca)}else W[ca].pendingUpdates&=~(t.TileUpdate.TEXTURE_NOFADING&t.TileUpdate.TEXTURE_FADING)}S=O/this.tileSize;N=this._ensureBackgroundTexture(this.tileSize);0===P||null===X?this._useBackgroundTexture(F,R,N,M!==e.TextureUpdate.FADING):(1!==P||U||!this._useLayerTexture(F,X))&&this._composeMapLayers(F,M,ca-1,Q,O,S,!T||U,J,U)}}_ensureBackgroundTexture(F){null==this._backgroundTexture&&
(this._backgroundTexture=this._buildTexture(F,!1),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bind(F),this._passParameters.offset=h.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,null!=this.backgroundColor),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1);return this._backgroundTexture}_useBackgroundTexture(F,
M,S,N){const P=F.renderData;M=!N&&null!=P.textureReference&&(F.surface.view.layerViewManager.updating||0<M)?f.ActivationTime.Delayed:f.ActivationTime.Immediate;P.setTextureReference(new r.TextureReference(S,e.TextureUpdate.FADING,K,F.surface.baseOpacity,0,1),M)}_useLayerTexture(F,M){var S=F.surface.layerViewByIndex(M,c.LayerClass.MAP),N=k.isBaseLayer(S.layer);const P=N?F.surface.baseOpacity:1;N=N?1:F.surface.baseOpacity;S=S.fullOpacity;M=A(F,M,!1);return this._dataToTexture(M)?(F.renderData.setTextureReference(new r.TextureReference(M.sourceLayerInfo.data,
e.TextureUpdate.FADING,M,P,N,S)),!0):!1}_composeMapLayers(F,M,S,N,P,R,O,T,Q){this._composition.ensureBuffer(P);const V=F.surface.baseOpacity;let U=!1,W=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ca=!1,X=0;for(let da=S;0<=da;da--){S=F.surface.layerViewByIndex(da,c.LayerClass.MAP);var ba=l.isVectorTileLayerView(S);ba=A(F,da,ba);const aa=S.layer.opacity;if(!ba||0===aa&&!Q)continue;const ea=!k.isBaseLayer(S.layer)&&!U;ea&&(U=!0);let ha=!1;T.forEach(Y=>{Y.start===da&&(Y.output=N?u.BlendLayersOutput.Composite:
O&&ea?this.backgroundIsGrid?u.BlendLayersOutput.GridComposite:u.BlendLayersOutput.ColorComposite:u.BlendLayersOutput.Composite,Y.baseOpacity=ea?V:1,B.push(Y),this._composition.openGroup(P),ha=!0)});this._passParameters.baseOpacity=ea&&!ha&&1>V?V:1;var ia=0===X;ia=ha?u.BlendLayersOutput.GroupBackgroundComposite:O&&ia?this.backgroundIsGrid?u.BlendLayersOutput.GridComposite:u.BlendLayersOutput.ColorComposite:u.BlendLayersOutput.Composite;S=q.blendModeFromString[l.isBlendableLayerView(S)?S.layer.blendMode:
"normal"];this._passParameters.opacity=aa;l.isVectorTileRenderInfo(ba)?ca=this._composition.drawVectorData(this._passParameters,ia,P,S,ba,R,this.tileSize,ca):l.isImageryTileRenderInfo(ba)?(this._composition.drawImageryTileData(this._passParameters,ia,P,S,ba),this._hasNearestInterpolation(ba)&&(W=y.TextureSamplingMode.NEAREST)):this._dataToTexture(ba)&&(this._passParameters.texture=ba.sourceLayerInfo.data.texture,this._passParameters.offset=ba.offset,this._passParameters.scale=ba.scale,this._composition.drawRasterData(this._passParameters,
ia,P,S));for(;0<B.length&&B[B.length-1].end===da;)S=B.pop(),this._passParameters.baseOpacity=S.baseOpacity,this._passParameters.opacity=S.opacity,this._passParameters.offset=h.ZEROS,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,S.output,P,q.blendModeFromString[S.blendMode]);X++}F=F.renderData;const fa=Q||U&&1>V;Q=F.ensureTexture(P,fa,()=>this._buildTexture(P,fa,W));this._composition.copyFBOToTexture(Q);this._composition.unbind();F.setTextureReference(new r.TextureReference(Q,
M,K,U?1:V,0,1))}_hasNearestInterpolation(F){F=F.sourceLayerInfo.data;return F.source?"nearest"===F.interpolation:!1}_dataToTexture(F){if(l.isRasterTileRenderInfo(F)){const M=F.sourceLayerInfo;M.data=this._buildTexture(M.data,!0);F.tile.setMemoryDirty()}return l.isTextureTileRenderInfo(F)}setBackground(F){this._backgroundColor!==F&&(this._backgroundColor=F,this._backgroundDirty=!0)}_buildTexture(F,M,S=y.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(null==F)return null;const N=new G.TextureDescriptor;
N.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;N.samplingMode=S;N.maxAnisotropy=this._maxAnisotropy;N.preMultiplyAlpha=!0;N.flipped=!0;N.hasMipmap=!0;M||(N.pixelFormat=y.PixelFormat.RGB);M=this._rctx;let P;if("number"===typeof F)N.width=N.height=F,(P=this._cache.pop(`${F} ${N.pixelFormat}`))?P.retain():P=new p(new D.Texture(M,N),this._cache);else if(m.isImageWithType(F))N.isOpaque=F.isOpaque,N.isOpaque&&(N.pixelFormat=y.PixelFormat.RGB),(P=this._cache.pop(`${F} ${N.pixelFormat}`))?(P.retain(),P.texture.setData(F.image)):
P=new p(new D.Texture(M,N,F.image),this._cache),F.release();else try{N.width=F.width,N.height=F.height,P=new p(new D.Texture(M,N,F))}catch(R){P=new p(v.createEmptyTexture(M)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}F=M.bindTexture(P.texture,D.Texture.TEXTURE_UNIT_FOR_UPDATES);P.generateMipmap();M.bindTexture(F,D.Texture.TEXTURE_UNIT_FOR_UPDATES);return P}get test(){return{backgroundTexture:this._backgroundTexture}}}const J=new Map,B=[],z=
new w.TileRenderInfo,K={offset:[0,0],scale:1},L=[];L[d.NeighborIndex.NORTH]=[0,-1];L[d.NeighborIndex.NORTH_EAST]=[-1,-1];L[d.NeighborIndex.EAST]=[-1,0];L[d.NeighborIndex.SOUTH_EAST]=[-1,1];L[d.NeighborIndex.SOUTH]=[0,1];L[d.NeighborIndex.SOUTH_WEST]=[1,1];L[d.NeighborIndex.WEST]=[1,0];L[d.NeighborIndex.NORTH_WEST]=[1,-1];a.GroupInfo=I;a.TileRenderer=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../../core/libs/gl-matrix-2/factories/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends m.TileCompositePassParameters{constructor(){super(...arguments);this.baseOpacity=this.opacity=1;this.fboTexture=this.texture=null;this.backgroundColor=h.ZEROS}}class p extends d.ShaderTechnique{initializeProgram(q){return new f.Program(q.rctx,p.shader.get().build(this.configuration),l.Default3D)}initializePipeline(){return x.makePipelineState({blending:x.simpleBlendingParams(r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:x.defaultColorWriteParams})}}
p.shader=new e.ReloadableShaderModule(g.BlendLayers,()=>new Promise((q,u)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],q,u)));class t extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.background=g.BackgroundMode.BelowLayer}}n.__decorate([c.parameter()],t.prototype,"background",void 0);b.BlendLayersPassParameters=w;b.BlendLayersTechnique=p;b.BlendLayersTechniqueConfiguration=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define(["exports",
"../../../chunks/tslib.es6","./BlendModeTechniqueConfiguration","../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n,h,k){class m extends n.BlendModeTechniqueConfiguration{constructor(){super(...arguments);this.output=h.BlendLayersOutput.Composite;this.baseOpacityMode=h.BaseOpacityMode.NotRequired;this.premultipliedSource=h.PremultipliedAlphaSource.Off}}b.__decorate([k.parameter({count:h.BlendLayersOutput.COUNT})],
m.prototype,"output",void 0);b.__decorate([k.parameter({count:h.BaseOpacityMode.COUNT})],m.prototype,"baseOpacityMode",void 0);b.__decorate([k.parameter()],m.prototype,"premultipliedSource",void 0);a.TileBlendTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,n,h){class k extends h.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.blendMode=n.LayerBlendMode.Normal}}b.__decorate([h.parameter({count:n.LayerBlendMode.COUNT})],k.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(f){const r=new e.ShaderBuilder;r.include(h.TileComposite);if(f.background===a.BackgroundMode.Only)return(f=f.output===n.BlendLayersOutput.ColorComposite)?r.fragment.uniforms.add(new k.Float3PassUniform("backgroundColor",x=>x.backgroundColor)):r.fragment.include(b.BackgroundGrid),r.fragment.code.add(g.glsl`
    void main() {
      fragColor = vec4(${f?g.glsl`backgroundColor`:g.glsl`gridColor(uv)`}, 1.0);
    }
  `),r;r.include(n.TileBackground,f);r.fragment.uniforms.add(new d.Texture2DPassUniform("tex",x=>x.texture));r.fragment.uniforms.add(new m.FloatPassUniform("opacity",x=>x.opacity));r.fragment.code.add(g.glsl`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`);return r}a.BackgroundMode=void 0;(function(f){f[f.BelowLayer=0]="BelowLayer";f[f.Only=1]="Only";f[f.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const l=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:c},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=l;a.build=c})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../core/libs/gl-matrix-2/factories/vec4f64"],
function(a,b,n){class h{constructor(k,m,g,e,d,c){this.texture=k;this.type=m;k.retain();this.offsetAndScale=n.fromValues(g.offset[0],g.offset[1],g.scale,g.scale);this.opacities=b.fromValues(e,d,c)}destroy(){this.texture.release()}}a.TextureReference=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../core/libs/gl-matrix-2/factories/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){class v{constructor(y,D){this._rctx=y;this._techniqueRepository=D;this._fbos=[];this._vectorTileHelper=new m.VectorTileRendererHelper3D;this._bindParameters=new x.BindParameters(null,null);this._blendLayersTechniqueConfig=new g.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=p.createQuadVAO(this._rctx,w.Pos2Tex)}dispose(){this._fbos.forEach(n.disposeMaybe);this._fbos=
null;this._vtFBO=n.disposeMaybe(this._vtFBO);this._vaoQuad=n.disposeMaybe(this._vaoQuad);this._vectorTileHelper=n.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=n.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=n.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=n.releaseMaybe(this._blendLayersTechnique)}_getBlendLayersTechnique(y,D,G,A=f.PremultipliedAlphaSource.Off,C=r.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=D;this._blendLayersTechniqueConfig.blendMode=
y;this._blendLayersTechniqueConfig.baseOpacityMode=G;this._blendLayersTechniqueConfig.premultipliedSource=A;this._blendLayersTechniqueConfig.background=C;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(g.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)}drawBackground(y,D){D=this._getBlendLayersTechnique(l.LayerBlendMode.Normal,D?f.BlendLayersOutput.ColorComposite:f.BlendLayersOutput.GridComposite,f.BaseOpacityMode.NotRequired,f.PremultipliedAlphaSource.Off,
r.BackgroundMode.Only);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}_render(y){this._rctx.bindVAO(this._vaoQuad);y.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(this._vaoQuad,"geometry"))}drawGroup(y,D,G,A,C=f.PremultipliedAlphaSource.On){D===f.BlendLayersOutput.Composite&&(y.fboTexture=this._fbos[this.getLastOnHoldId()].get(G).colorTexture);y.texture=this.currentFBO(G).colorTexture;this.closeGroup(G);
D=this._getBlendLayersTechnique(A,D,1>y.baseOpacity?f.BaseOpacityMode.Required:f.BaseOpacityMode.NotRequired,C);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}drawRasterData(y,D,G,A,C=f.PremultipliedAlphaSource.Off){if(null!=y.texture){var E=1>y.baseOpacity?f.BaseOpacityMode.Required:f.BaseOpacityMode.NotRequired;y.fboTexture=D===f.BlendLayersOutput.GroupBackgroundComposite||A===l.LayerBlendMode.Normal&&E===f.BaseOpacityMode.NotRequired&&C===f.PremultipliedAlphaSource.Off?null:
this.switch(G).colorTexture;D=this._getBlendLayersTechnique(A,D,E,C);y=this._rctx.bindTechnique(D,this._bindParameters,y);this._render(y)}}drawImageryTileData(y,D,G,A,C){var E=C.sourceLayerInfo.data;if(E.source&&(C.tile.surface.layerViewByIndex(C.layerIndex,e.LayerClass.MAP).ensureSymbolizerParameters(E),E.bind(this._rctx))){var I=1>y.baseOpacity?f.BaseOpacityMode.Required:f.BaseOpacityMode.NotRequired;y.fboTexture=A===l.LayerBlendMode.Normal&&I===f.BaseOpacityMode.NotRequired?null:this.switch(G).colorTexture;
D=this._getRasterColorizerTechnique(E,D,A,I);E.opacity=y.opacity;E=E.getUniforms();E.scale=C.scale;E.offset=C.offset;E.backgroundColor=y.backgroundColor;E.fboTexture=y.fboTexture;E.baseOpacity=y.baseOpacity;y=this._rctx.bindTechnique(D,null,E);this._render(y)}}_getRasterColorizerTechnique(y,D,G,A){const C=y.symbolizerParameters,E=["stretch","lut","hillshade"].indexOf(C.type);null==this._rasterColorizerConfig&&(this._rasterColorizerConfig=new d.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=D;this._rasterColorizerConfig.blendMode=G;this._rasterColorizerConfig.baseOpacityMode=A;this._rasterColorizerConfig.colorizerType=E;this._rasterColorizerConfig.applyColormap=!!C.colormap;this._rasterColorizerConfig.requireBilinearWithNN=y.isBilinearWithStretchColorRamp;this._rasterColorizerConfig.stretchType=y.hasStretchTypeNone()?k.RasterColorizerStretchType.Noop:k.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=
this._techniqueRepository.releaseAndAcquire(d.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)}drawVectorData(y,D,G,A,C,E,I,H){const J=this._rctx,B=C.sourceLayerInfo.data,z=C.tile.surface.layerViewByIndex(C.layerIndex,e.LayerClass.MAP);var K=1>y.baseOpacity?f.BaseOpacityMode.Required:f.BaseOpacityMode.NotRequired;const L=K===f.BaseOpacityMode.Required||1>y.opacity||A!==l.LayerBlendMode.Normal||D!==f.BlendLayersOutput.Composite,F=L?f.PremultipliedAlphaSource.On:
f.PremultipliedAlphaSource.Off;K=this._getBlendLayersTechnique(A,D,K,F);J.setPipelineState(K.getPipeline());let M=K=null;L?(M=this.currentFBO(G),null==this._vtFBO&&(this._vtFBO=new c.MultiSizeFramebuffer(this._rctx)),K=this._vtFBO.get(G),J.bindFramebuffer(K),this._clearCurrentFBO()):H&&J.clearSafe(t.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(J,C.sourceLod,z.painter,z.layer.styleRepository,z.schemaHelper,Math.round(1/C.scale),C.offset,I,E,z.contentZoom),B&&this._vectorTileHelper.renderContent(J,
C.sourceLod,B,C.vtlNeighborInfos,z.painter,z.layer.styleRepository,z.schemaHelper,Math.round(1/C.scale),C.offset,I,E,z.contentZoom)}catch(S){b.getLogger("esri.views.3d.terrain").warnOnce("A render call containing vector tiles did not resolve correctly.",S)}return null!=K?(J.bindFramebuffer(M),y.texture=K.colorTexture,y.offset=h.ZEROS,y.scale=1,this.drawRasterData(y,D,G,A,F),H):!0}copyFBOToTexture(y){const D=this._rctx,G=D.bindTexture(y.texture,q.Texture.TEXTURE_UNIT_FOR_UPDATES),A=y.descriptor;D.gl.copyTexImage2D(t.TextureType.TEXTURE_2D,
0,A.pixelFormat,0,0,A.width,A.height,0);y.generateMipmap();D.bindTexture(G,q.Texture.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.setClearStencil(0);this._rctx.clearSafe(t.ClearBufferBit.COLOR_BUFFER_BIT|t.ClearBufferBit.DEPTH_BUFFER_BIT|t.ClearBufferBit.STENCIL_BUFFER_BIT)}_initFBO(y,D,G){this._rctx.bindFramebuffer(y);G&&(this._rctx.setViewport(0,0,D,D),this._clearCurrentFBO())}ensureBuffer(y){this._lastUsedIds.length=
0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(y)}bind(y,D=0,G=!0){this._current=D;if(D>=this._fbos.length)for(let A=this._fbos.length;A<=D;A++)this._fbos.push(new c.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[D].get(y),y,G)}_bindNextFreeBuffer(y){0<this._lastUsedIds.length?this.bind(y,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(y,this._lastCreatedBufferId))}openGroup(y){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(y)}switch(y){const D=
this.currentFBO(y),G=this._current;this._bindNextFreeBuffer(y);this._lastUsedIds.push(G);return D}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(y){const D=this._current;this._bindNextFreeBuffer(y);this._lastUsedIds.push(D);this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(y){return this._fbos[this._current].get(y)}}a.TileCompositor=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define("exports ../../../../geometry ../../../../Viewpoint ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../ViewState ./style/StyleDefinition ../webgl/RenderableTile ../webgl/TileReshuffleManager ../../../webgl/enums ../../../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x{constructor(){this._renderParams={reshuffleManager:new l.TileReshuffleManager,context:null,drawPhase:1,state:new e({viewpoint:new n({targetGeometry:new r(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,
timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null};this._backgroundTile=new c.RenderableTile(new k(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(w,p,t,q,u,v,y,D,G,A){const C=this._backgroundTile;this._updateRenderParameters(w,p,C,t,u,v,y,D,G,A);this._renderParams.stencilSymbols=!1;t.drawBackground(this._renderParams,C,q)}renderContent(w,
p,t,q,u,v,y,D,G,A,C,E){this._stencilSymbols(w,p,t,q,u,v,y,Math.round(1/D),G,A,C,E);let I=1;t.stencilRef=I++;w.setStencilFunction(f.CompareFunction.EQUAL,t.stencilRef,255);this._render(w,p,t,u,v,y,D,G,A,C,E);q.forAll(H=>{H.sourceLayerInfo.data.stencilRef=I++;this._renderSymbols(w,H.sourceLod,H.sourceLayerInfo.data,u,v,y,Math.round(1/D),H.offset,A,C,E)})}_stencilSymbols(w,p,t,q,u,v,y,D,G,A,C,E){let I=1;t.stencilRef=I++;w.setDepthTestEnabled(!1);w.setDepthWriteEnabled(!1);w.setStencilTestEnabled(!0);
w.setBlendingEnabled(!1);w.setColorMask(!1,!1,!1,!1);w.setStencilOp(f.StencilOperation.KEEP,f.StencilOperation.KEEP,f.StencilOperation.REPLACE);w.setStencilWriteMask(255);w.setStencilFunction(f.CompareFunction.ALWAYS,t.stencilRef,255);this._stencilTileSymbols(w,p,t,u,v,y,D,G,A,C,E);for(const H of q.toArray()){const {sourceLod:J,offset:B,sourceLayerInfo:z}=H;z.data.stencilRef=I++;w.setStencilFunction(f.CompareFunction.ALWAYS,z.data.stencilRef,255);this._stencilTileSymbols(w,J,z.data,u,v,y,D,B,A,C,
E)}w.setStencilWriteMask(0);w.setBlendingEnabled(!0);w.setDepthTestEnabled(!0);w.setColorMask(!0,!0,!0,!0)}_renderSymbols(w,p,t,q,u,v,y,D,G,A,C){w.setStencilFunction(f.CompareFunction.EQUAL,t.stencilRef,255);this._render(w,p,t,q,u,v,y,D,G,A,C,d.StyleLayerType.SYMBOL)}_render(w,p,t,q,u,v,y,D,G,A,C,E){this._updateRenderParameters(w,p,t,q,v,y,D,G,A,C);this._renderParams.stencilSymbols=!1;q.drawTile(this._renderParams,t,u,E)}_stencilTileSymbols(w,p,t,q,u,v,y,D,G,A,C){this._updateRenderParameters(w,p,
t,q,v,y,D,G,A,C);this._renderParams.stencilSymbols=!0;t.triangleCount=0;q.drawSymbols(this._renderParams,t,u)}_updateRenderParameters(w,p,t,q,u,v,y,D,G,A){"type"in t&&"vector-tile"===t.type&&!t.stage&&t.attachWithContext(w);const C=p[0]-u.getLevelShift(p[0]),E=this._renderParams;E.context=w;E.painter=q;E.glyphMosaic=q.glyphMosaic;E.spriteMosaic=q.spriteMosaic;E.pixelRatio=G*A;E.displayLevel=C;E.requiredLevel=C;w=u.getScale(p[0]);const [I,H]=u.getOffset(p,v*w);p=.125*v*w/D;t=t.transforms.displayViewScreenMat3;
t[0]=p;t[4]=-p;t[6]=-1-I-y[0]*v*2;t[7]=1+H+(1-y[1])*v*2-2;E.state.size[0]=D/A;E.state.size[1]=D/A;E.state.pixelRatio=A}}a.VectorTileRendererHelper3D=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/ViewState":function(){define("../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../core/libs/gl-matrix-2/math/common ../../core/libs/gl-matrix-2/math/mat2d ../../core/libs/gl-matrix-2/factories/mat2df32 ../../core/libs/gl-matrix-2/factories/mat2df64 ../../core/libs/gl-matrix-2/math/mat3 ../../core/libs/gl-matrix-2/factories/mat3f32 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f32 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ../../geometry/support/normalizeUtils ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){var A;const C=[0,0];b=A=class extends h.JSONSupport{constructor(E){super(E);this._viewpoint2D={center:q.create(),rotation:0,scale:0,spatialReference:void 0};this.center=[0,0];this.extent=new D;this.id=0;this.inverseTransform=r.create();this.scale=this.rotation=this.resolution=0;this.transform=r.create();this.transformNoRotation=r.create();this.displayMat3=w.create();this.displayViewMat3=w.create();this.viewMat3=w.create();this.viewMat2d=f.create();
this.worldScreenWidth=0;this.size=[0,0]}set pixelRatio(E){this._set("pixelRatio",E);this._update()}set size(E){this._set("size",E);this._update()}set viewpoint(E){if(E){const I=this._viewpoint2D,H=E.targetGeometry;I.center[0]=H.x;I.center[1]=H.y;I.rotation=E.rotation;I.scale=E.scale;I.spatialReference=H.spatialReference}this._update()}copy(E){const I=this.size,H=this.viewpoint;H&&I?(this.viewpoint=y.copy(H,E.viewpoint),this._set("size",p.copy(I,E.size))):(this.viewpoint=E.viewpoint.clone(),this._set("size",
[E.size[0],E.size[1]]));this._set("pixelRatio",E.pixelRatio);return this}clone(){return new A({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(E,I,H){if(u.isVec2(I))return p.transformMat2d(E,I,this.inverseTransform);C[0]=I;C[1]=H;return p.transformMat2d(E,C,this.inverseTransform)}toScreen(E,I,H){if(u.isVec2(I))return p.transformMat2d(E,I,this.transform);C[0]=I;C[1]=H;return p.transformMat2d(E,C,this.transform)}toScreenNoRotation(E,I,H){if(u.isVec2(I))return p.transformMat2d(E,
I,this.transformNoRotation);C[0]=I;C[1]=H;return p.transformMat2d(E,C,this.transformNoRotation)}toScreenClosest(E,I,H){u.isVec2(I)?(C[0]=I[0],C[1]=I[1]):(C[0]=I,C[1]=H);[I]=C;const {center:J,extent:B,spatialReference:z,transform:K}=this;if(I<B.xmin||I>B.xmax)C[0]=v.getClosestDenormalizedXToReference(I,J[0],z);return p.transformMat2d(E,C,K)}getScreenTransform(E,I){const {center:H}=this._viewpoint2D,J=this._get("pixelRatio")||1,B=this._get("size");y.getMatrix(E,H,B,I,0,J);return E}_update(){const {center:E,
spatialReference:I,scale:H,rotation:J}=this._viewpoint2D,B=this._get("pixelRatio")||1,z=this._get("size"),K=new n({targetGeometry:new G(E[0],E[1],I),scale:H,rotation:J});this._set("viewpoint",K);if(z&&I&&H){this.resolution=y.getResolution(K);this.rotation=J;this.scale=H;this.spatialReference=I;p.copy(this.center,E);x.set(this.displayMat3,0!==z[0]?2/z[0]:0,0,0,0,0!==z[1]?-2/z[1]:0,0,-1,1,1);var L=x.identity(this.viewMat3),F=t.fromValues(z[0]/2,z[1]/2),M=t.fromValues(-z[0]/2,-z[1]/2),S=c.toRadian(J);
x.translate(L,L,F);x.rotate(L,L,S);x.translate(L,L,M);x.multiply(this.displayViewMat3,this.displayMat3,L);L=l.fromTranslation(this.viewMat2d,F);l.rotate(L,L,S);l.translate(L,L,M);y.getExtent(this.extent,K,z);y.getTransform(this.transform,K,z,B);l.invert(this.inverseTransform,this.transform);y.getTransformNoRotation(this.transformNoRotation,K,z,B);this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",this.id+1);return this}}};a.__decorate([k.property({readOnly:!0})],
b.prototype,"id",void 0);a.__decorate([k.property({value:1,json:{write:!0}})],b.prototype,"pixelRatio",null);a.__decorate([k.property({json:{write:!0}})],b.prototype,"size",null);a.__decorate([k.property()],b.prototype,"spatialReference",void 0);a.__decorate([k.property({type:n,json:{write:!0}})],b.prototype,"viewpoint",null);return b=A=a.__decorate([d.subclass("esri.views.2d.ViewState")],b)})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["exports"],function(a){function b(){return[1,
0,0,1,0,0]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function h(e,d,c,l,f,r){return[e,d,c,l,f,r]}function k(e,d){return new Float64Array(e,d,6)}const m=b(),g=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:m,clone:n,create:b,createView:k,fromValues:h},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=m;a.clone=n;a.create=b;a.createView=k;a.fromValues=h;a.mat2df64=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],
function(a){function b(h){return h instanceof Float32Array&&2<=h.length}function n(h){return Array.isArray(h)&&2<=h.length}a.isVec2=function(h){return b(h)||n(h)};a.isVec2f32=b;a.isVec2f64=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../Viewpoint ../../core/Collection ../../core/mathUtils ../../core/unitUtils ../../core/libs/gl-matrix-2/math/common ../../core/libs/gl-matrix-2/math/mat2d ../../core/libs/gl-matrix-2/factories/mat2df64 ../../core/libs/gl-matrix-2/math/vec2 ../../core/libs/gl-matrix-2/factories/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/normalizeUtils ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){function q(W,ca){return ca.type?d.set(W,ca.x,ca.y):d.copy(W,ca)}function u(W,ca,X=0){var ba=W.width,ia=W.height;0!==X&&(ba=h.deg2rad(X),X=Math.abs(Math.cos(ba)),ia=Math.abs(Math.sin(ba)),ba=W.width*X+W.height*ia,ia=W.width*ia+W.height*X);return Math.max(ba/Math.max(1,ca[0]),ia/Math.max(1,ca[1]))*E(W.spatialReference)}async function v(W,ca,X,ba){if(!W||Array.isArray(W)&&!W.length)return null;n.isCollection(W)&&(W=W.toArray());if(Array.isArray(W)&&W.length&&
"object"===typeof W[0]){var ia=W.every(Y=>"attributes"in Y);var fa=W.some(Y=>!Y.geometry),da=W;if(ia&&fa&&ca&&ca.allLayerViews){ia=new Map;for(var aa of W)W=aa.layer,fa=ia.get(W)||[],da=aa.attributes[W.objectIdField],null!=da&&fa.push(da),ia.set(W,fa);const Y=[];ia.forEach((Z,ja)=>{const oa=ca.allLayerViews.find(qa=>qa.layer.id===ja.id);if(oa&&"queryFeatures"in oa){const qa=ja.createQuery();qa.objectIds=Z;qa.returnGeometry=!0;Y.push(oa.queryFeatures(qa))}});aa=await Promise.all(Y);W=[];for(var ea of aa)if(ea&&
ea.features&&ea.features.length)for(var ha of ea.features)null!=ha.geometry&&W.push(ha.geometry);da=W}for(const Y of da)ba=await v(Y,ca,X,ba);return ba}if(Array.isArray(W)&&2===W.length&&"number"===typeof W[0]&&"number"===typeof W[1])ia=new r(W);else if(W instanceof f)ia=W;else if("geometry"in W)if(W.geometry)ia=W.geometry;else if(W.layer){const Y=W.layer;(ea=ca.allLayerViews.find(Z=>Z.layer.id===Y.id))&&"queryFeatures"in ea&&(ha=Y.createQuery(),ha.objectIds=[W.attributes[Y.objectIdField]],ha.returnGeometry=
!0,ia=(await ea.queryFeatures(ha))?.features?.[0]?.geometry)}if(null==ia)return null;switch(ia.type){case "point":ea=new l({xmin:ia.x,ymin:ia.y,xmax:ia.x,ymax:ia.y,spatialReference:ia.spatialReference});break;case "extent":case "multipoint":case "polygon":case "polyline":ea=p.getDenormalizedExtent(ia);break;default:ea=ia.extent}if(!ea)return null;x.isLoaded()||x.canProjectWithoutEngine(ea.spatialReference,X)||await x.load();X=x.project(ea,X);return X?ba=ba?ba.union(X):X:null}function y(W){if(W&&(!Array.isArray(W)||
"number"!==typeof W[0])&&("object"===typeof W||Array.isArray(W)&&"object"===typeof W[0])){if("layer"in W&&null!=W.layer?.minScale&&null!=W.layer.maxScale){var ca=W.layer;return{min:ca.minScale,max:ca.maxScale}}if(Array.isArray(W)&&W.length&&W.every(X=>"layer"in X)){let X=ca=0;for(const ba of W)W=ba.layer,W?.minScale&&W.maxScale&&(ca=W.minScale<ca?W.minScale:ca,X=W.maxScale>X?W.maxScale:X);return ca&&X?{min:ca,max:X}:null}}}function D(W,ca){return t.equals(W.wkid?W:W.spatialReference||w.WGS84,ca)?
W:x.project(W,ca)}function G(W,ca){const X=W.targetGeometry,ba=ca.targetGeometry;X.x=ba.x;X.y=ba.y;X.spatialReference=ba.spatialReference;W.scale=ca.scale;W.rotation=ca.rotation;return W}function A(W,ca,X){return X?d.set(W,.5*(ca[0]-X.right+X.left),.5*(ca[1]-X.bottom+X.top)):d.scale(W,ca,.5)}function C(W){var ca=W.scale;W=W.targetGeometry;W=null!=W&&t.isValid(W.spatialReference)?1/(39.37*k.getMetersPerUnitForSR(W.spatialReference)*96):1;return ca*W}function E(W){return t.isValid(W)?39.37*k.getMetersPerUnitForSR(W)*
96:1}function I(W){return(W=t.getInfo(W))?W.valid[1]-W.valid[0]:0}const H=180/Math.PI,J=function(){const W=c.create();return function(ca,X,ba){const ia=X.targetGeometry;q(W,ia);X=.5*C(X);ca.xmin=W[0]-X*ba[0];ca.ymin=W[1]-X*ba[1];ca.xmax=W[0]+X*ba[0];ca.ymax=W[1]+X*ba[1];ca.spatialReference=ia.spatialReference;return ca}}(),B=function(){const W=c.create();return function(ca,X,ba){return d.sub(ca,d.scale(ca,X,.5),A(W,X,ba))}}(),z=function(){const W=e.create(),ca=c.create();return function(X,ba,ia,fa){const da=
C(ba);ba=m.toRadian(ba.rotation)||0;d.set(ca,da,da);g.fromScaling(W,ca);g.rotate(W,W,ba);g.translate(W,W,B(ca,ia,fa));g.translate(W,W,[0,fa.top-fa.bottom]);return d.set(X,W[4],W[5])}}(),K=function(){const W=c.create(),ca=c.create(),X=c.create();return function(ba,ia,fa,da,aa,ea){d.negate(W,ia);d.scale(ca,fa,.5*ea);d.set(X,1/da*ea,-1/da*ea);g.fromTranslation(ba,ca);aa&&g.rotate(ba,ba,aa);g.scale(ba,ba,X);g.translate(ba,ba,W);return ba}}(),L=function(){const W=c.create();return function(ca,X,ba,ia){const fa=
C(X),da=m.toRadian(X.rotation)||0;q(W,X.targetGeometry);return K(ca,W,ba,fa,da,ia)}}(),F=function(){const W=c.create();return function(ca,X,ba,ia){const fa=C(X);q(W,X.targetGeometry);return K(ca,W,ba,fa,0,ia)}}(),M=function(){const W=c.create(),ca=c.create(),X=[0,0,0];return function(ba,ia,fa){d.subtract(W,ba,ia);d.normalize(W,W);d.subtract(ca,ba,fa);d.normalize(ca,ca);d.cross(X,W,ca);ba=Math.acos(d.dot(W,ca)/(d.length(W)*d.length(ca)))*H;0>X[2]&&(ba=-ba);isNaN(ba)&&(ba=0);return ba}}(),S=function(){const W=
c.create();return function(ca,X,ba,ia){const fa=ca.targetGeometry;G(ca,X);z(W,X,ba,ia);fa.x+=W[0];fa.y+=W[1];return ca}}(),N=function(){return function(W,ca,X){G(W,ca);ca=W.targetGeometry;ca.x=X.x;ca.y=X.y;ca.spatialReference=X.spatialReference;return W}}(),P=function(){const W=c.create();return function(ca,X,ba,ia,fa){fa||="center";d.sub(W,ba,ia);d.scale(W,W,.5);ba=W[0];ia=W[1];switch(fa){case "center":d.set(W,0,0);break;case "left":d.set(W,-ba,0);break;case "top":d.set(W,0,ia);break;case "right":d.set(W,
ba,0);break;case "bottom":d.set(W,0,-ia);break;case "top-left":d.set(W,-ba,ia);break;case "bottom-left":d.set(W,-ba,-ia);break;case "top-right":d.set(W,ba,ia);break;case "bottom-right":d.set(W,ba,-ia)}U(ca,X,W);return ca}}(),R=function(){const W=c.create();return function(ca,X,ba,ia,fa){G(ca,X);isNaN(ba)||0===ba||(Q(W,ia,X,fa),ca.scale=X.scale*ba,V(W,W,ca,fa),U(ca,ca,d.set(W,W[0]-ia[0],ia[1]-W[1])));return ca}}(),O=function(){const W=c.create();return function(ca,X,ba,ia,fa,da){G(ca,X);isNaN(ba)||
0===ba||(Q(W,fa,X,da),ca.scale=X.scale*ba,ca.rotation+=ia,V(W,W,ca,da),U(ca,ca,d.set(W,W[0]-fa[0],fa[1]-W[1])));return ca}}(),T=function(){const W=c.create(),ca=c.create();return function(X,ba,ia,fa,da,aa,ea){B(ca,aa,ea);d.add(W,da,ca);return fa?O(X,ba,ia,fa,W,aa):R(X,ba,ia,W,aa)}}(),Q=function(){const W=e.create();return function(ca,X,ba,ia){var fa=d.transformMat2d;L(W,ba,ia,1);ba=g.invert(W,W);return fa.call(d,ca,X,ba)}}(),V=function(){const W=e.create();return function(ca,X,ba,ia){return d.transformMat2d(ca,
X,L(W,ba,ia,1))}}(),U=function(){const W=c.create(),ca=e.create();return function(X,ba,ia){G(X,ba);const fa=C(ba),da=X.targetGeometry;g.fromRotation(ca,m.toRadian(ba.rotation)||0);g.scale(ca,ca,c.fromValues(fa,fa));d.transformMat2d(W,ia,ca);da.x+=W[0];da.y+=W[1];return X}}();a.addPadding=S;a.angleBetween=M;a.centerAt=N;a.copy=G;a.create=async function(W,ca){if(!W||!ca)return new b({targetGeometry:new r,scale:0,rotation:0});let X=ca.spatialReference;const {constraints:ba,padding:ia,viewpoint:fa,size:da}=
ca,aa=[ia?da[0]-ia.left-ia.right:da[0],ia?da[1]-ia.top-ia.bottom:da[1]];var ea=null;W instanceof b?ea=W:W.viewpoint?ea=W.viewpoint:W.target&&"esri.Viewpoint"===W.target.declaredClass&&(ea=W.target);let ha=null;if(ea?.targetGeometry)ha=ea.targetGeometry;else if(W instanceof l)ha=W;else if(W||W&&("center"in W||"extent"in W||"target"in W))ha=await v(W.center,ca,X)||await v(W.extent,ca,X)||await v(W.target,ca,X)||await v(W,ca,X);!ha&&fa?.targetGeometry?ha=fa.targetGeometry:!ha&&ca.extent&&(ha=ca.extent);
if(!X){var Y=ca.spatialReference||ca.extent||ha;X=Y.wkid?Y:Y.spatialReference||w.WGS84}x.isLoaded()||t.equals(ha.spatialReference,X)||x.canProjectWithoutEngine(ha.spatialReference,X)||await x.load();Y=D(ha,X);Y="center"in Y?Y.center:Y;!1!==ca.pickClosestTarget&&"point"===Y.type&&"point"===fa.targetGeometry?.type&&(Y.x=p.getClosestDenormalizedXToReference(Y.x,fa.targetGeometry.x,Y.spatialReference));let Z=0;ea?Z=ea.rotation:W.hasOwnProperty("rotation")?Z=W.rotation:fa&&(Z=fa.rotation);let ja=0;null!=
ea?.targetGeometry&&"point"===ea.targetGeometry.type?ja=ea.scale:"scale"in W&&W.scale?ja=W.scale:"zoom"in W&&-1!==W.zoom&&ba&&ba.effectiveLODs?ja=ba.zoomToScale(W.zoom):Array.isArray(ha)||"point"===ha.type||"extent"===ha.type&&0===ha.width&&0===ha.height?(ea=D(ca.extent,X),ja=null!=ea?u(ea,aa,Z):ca.extent?u(ca.extent,aa,Z):fa.scale):ja=u(D(ha.extent,X),aa,Z);if(W=y(W.target??W))W.min&&W.min<ja?ja=W.min:W.max&&W.max>ja&&(ja=W.max);W=new b({targetGeometry:Y,scale:ja,rotation:Z});ba&&(W=ba.fit(W),ba.constrainByGeometry(W),
ba.rotationEnabled||(W.rotation=fa.rotation));return W};a.extentToScale=u;a.getAnchor=A;a.getExtent=J;a.getMatrix=K;a.getPaddingMapTranslation=z;a.getPaddingScreenTranslation=B;a.getResolution=C;a.getResolutionToScaleFactor=E;a.getTransform=L;a.getTransformNoRotation=F;a.getWorldScreenWidth=function(W,ca){return Math.round(I(W)/ca)};a.getWorldWidth=I;a.padAndScaleAndRotateBy=T;a.resize=P;a.rotateBy=function(W,ca,X){G(W,ca);W.rotation+=X;return W};a.rotateTo=function(W,ca,X){G(W,ca);W.rotation=X;return W};
a.scaleAndRotateBy=O;a.scaleTo=function(W,ca,X){G(W,ca);W.scale=X;return W};a.setExtent=function(W,ca,X,ba,ia){N(W,ca,X.center);W.scale=u(X,ba);ia?.constraints?.constrain(W);return W};a.toMap=Q;a.toScreen=V;a.translateBy=U;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports","../../../../../symbols/cim/enums"],function(a,b){a.StyleLayerType=void 0;(function(h){h[h.BACKGROUND=0]="BACKGROUND";h[h.FILL=1]=
"FILL";h[h.LINE=2]="LINE";h[h.SYMBOL=3]="SYMBOL";h[h.CIRCLE=4]="CIRCLE"})(a.StyleLayerType||(a.StyleLayerType={}));a.Visibility=void 0;(function(h){h[h.VISIBLE=0]="VISIBLE";h[h.NONE=1]="NONE"})(a.Visibility||(a.Visibility={}));a.SymbolPlacement=void 0;(function(h){h[h.POINT=0]="POINT";h[h.LINE=1]="LINE";h[h.LINE_CENTER=2]="LINE_CENTER"})(a.SymbolPlacement||(a.SymbolPlacement={}));a.RotationAlignment=void 0;(function(h){h[h.MAP=0]="MAP";h[h.VIEWPORT=1]="VIEWPORT";h[h.AUTO=2]="AUTO"})(a.RotationAlignment||
(a.RotationAlignment={}));a.TextJustification=void 0;(function(h){h[h.AUTO=0]="AUTO";h[h.LEFT=1]="LEFT";h[h.CENTER=2]="CENTER";h[h.RIGHT=3]="RIGHT"})(a.TextJustification||(a.TextJustification={}));a.SymbolAnchor=void 0;(function(h){h[h.CENTER=0]="CENTER";h[h.LEFT=1]="LEFT";h[h.RIGHT=2]="RIGHT";h[h.TOP=3]="TOP";h[h.BOTTOM=4]="BOTTOM";h[h.TOP_LEFT=5]="TOP_LEFT";h[h.TOP_RIGHT=6]="TOP_RIGHT";h[h.BOTTOM_LEFT=7]="BOTTOM_LEFT";h[h.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"})(a.SymbolAnchor||(a.SymbolAnchor={}));a.TextTransform=
void 0;(function(h){h[h.NONE=0]="NONE";h[h.UPPERCASE=1]="UPPERCASE";h[h.LOWERCASE=2]="LOWERCASE"})(a.TextTransform||(a.TextTransform={}));a.TranslateAnchor=void 0;(function(h){h[h.MAP=0]="MAP";h[h.VIEWPORT=1]="VIEWPORT"})(a.TranslateAnchor||(a.TranslateAnchor={}));a.TextWritingMode=void 0;(function(h){h[h.HORIZONTAL=0]="HORIZONTAL";h[h.VERTICAL=1]="VERTICAL"})(a.TextWritingMode||(a.TextWritingMode={}));class n{}n.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};
n.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};n.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:b.CapType.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:b.JoinType.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};n.symbolLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:a.Visibility.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:a.SymbolPlacement.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},
"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",
default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:a.SymbolAnchor.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:a.TextJustification.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",
default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:a.RotationAlignment.AUTO},"text-size":{type:"number",
minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:a.TextTransform.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[a.TextWritingMode.HORIZONTAL]}};n.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:a.Visibility.VISIBLE}};n.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};
n.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};n.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",
default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"line-width":{type:"number",minimum:0,default:1}};n.symbolPaintDefinition={"icon-color":{type:"color",
default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},
"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};n.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};n.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:a.TranslateAnchor.MAP}};a.StyleDefinition=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(a,b,n){class h extends n.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:b.create(),tileMat3:b.create()}}}a.RenderableTile=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(a){class b{constructor(){this._candidateTiles=[]}schedule(n){this._candidateTiles.includes(n)||this._candidateTiles.push(n)}reshuffle(n){const h=
[];for(const k of this._candidateTiles)0<n?(k.reshuffle(),n--):h.push(k);this._candidateTiles=h}}a.TileReshuffleManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x extends e.ShaderTechnique{initializeProgram(p){return new l.Program(p.rctx,x.shader.get().build(this.configuration),c.Default3D)}initializePipeline(){return r.makePipelineState({blending:r.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:r.defaultColorWriteParams})}}x.shader=new g.ReloadableShaderModule(m.RasterColorizer,()=>new Promise((p,t)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],p,t)));
class w extends k.TileBlendTechniqueConfiguration{constructor(){super(...arguments);this.colorizerType=h.RasterColorizerType.Stretch;this.stretchType=h.RasterColorizerStretchType.Noop;this.applyColormap=!0;this.requireBilinearWithNN=!1}}n.__decorate([d.parameter({count:h.RasterColorizerType.COUNT})],w.prototype,"colorizerType",void 0);n.__decorate([d.parameter({count:h.RasterColorizerStretchType.COUNT})],w.prototype,"stretchType",void 0);n.__decorate([d.parameter()],w.prototype,"applyColormap",void 0);
n.__decorate([d.parameter()],w.prototype,"requireBilinearWithNN",void 0);b.RasterColorizerTechnique=x;b.RasterColorizerTechniqueConfiguration=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(a,b,n,h,k){class m{constructor(g){this._rctx=g;this._fbos=new Map}get(g){return this._getPool(g)}dispose(){this._fbos.forEach(g=>
g.dispose());this._fbos.clear()}_getPool(g){var e=this._fbos.get(g);if(e)return e;e=new n.FramebufferObject(this._rctx,new k.TextureDescriptor(g),new h.RenderbufferDescriptor(b.RenderbufferFormat.DEPTH24_STENCIL8,g));this._fbos.set(g,e);return e}}a.MultiSizeFramebuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderInfo":function(){define(["exports","../../../core/PooledArray"],function(a,b){class n{constructor(){this.sourceLod=[0,0,0];this.offset=
[0,0];this.scale=1;this.layerIndex=0;this.isVTLBackground=!1;this.vtlNeighborInfos=new b({allocator:k=>k||new h})}}class h{constructor(){this.sourceLayerInfo=null;this.sourceLod=[0,0,0];this.offset=[-1,0]}}a.TileRenderInfo=n;a.VTLNeighhborInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/factories/vec3f64",
"../../../../../geometry/support/aaBoundingBox","../../materials/internal/MaterialUtil"],function(a,b,n,h,k){function m(t,q,u){let v=0,y=Infinity;for(let G=0;3>G;++G){var D=t[G];if(q[G]<D){if(1E-6>=u[G])return!1;v=Math.max(v,(D-q[G])/u[G])}else-1E-6>=u[G]&&(y=Math.min(y,(D-q[G])/u[G]));if(v>y)return!1;D=t[G+3];if(q[G]>D){if(-1E-6<=u[G])return!1;v=Math.max(v,(D-q[G])/u[G])}else 1E-6<=u[G]&&(y=Math.min(y,(D-q[G])/u[G]));if(v>y)return!1}return!0}function g(t,q,u,v,y,D){let G=v;for(;u<G;){var A=t[u];
q[6*A+y+3]<=D?++u:(--G,t[u]=t[G],t[G]=A)}A=u;for(G=v;A<G;)v=t[G-1],q[6*v+y]>=D?--G:(t[G-1]=t[A],t[A]=v,++A);return{next:u,mid:A}}function e(t,q,u,v){if(v<=u)return h.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var y=6*t[u];for(var D=0;3>D;++D)w[D]=q[y+0+D],p[D]=q[y+3+D];for(u+=1;u<v;++u)for(y=6*t[u],D=0;3>D;++D)w[D]=Math.min(w[D],q[y+0+D]),p[D]=Math.max(p[D],q[y+3+D]);return h.fromValues(w[0],w[1],w[2],p[0],p[1],p[2])}function d(t){var q=t[3]-t[0];const u=t[4]-t[1],v=t[5]-t[2];q=q>u?q>v?0:u>v?1:2:u>v?1:v>
q?2:0;return{axis:q,midValue:(t[q]+t[q+3])/2}}function c(t,q,u,v,y){u-=q;const D=new Float32Array(6*u);for(let A=0;A<u;++A){var G=3*(A+q);const C=t[G]*y,E=t[G+1]*y;G=t[G+2]*y;for(let I=0;3>I;++I){const H=v[C+I],J=v[E+I],B=v[G+I];D[6*A+I]=Math.min(H,J,B);D[6*A+3+I]=Math.max(H,J,B)}}return D}function l(t,q,u,v){const y=v-u;var D=0;for(var G=u;G<v;++G)for(var A=0;3>A;++A)D=Math.max(q[3*G+A],D);v=65535>=D?new Uint16Array(3*y):new Uint32Array(3*y);for(D=0;D<y;++D)for(G=3*(t[D]+u),A=0;3>A;++A)v[3*D+A]=
q[G+A];return v}class f{constructor(t,q,u,v,y){this.aabb=t;this.axis=q;this.d=u;this.midStartIndex=v;this.rightStartIndex=y}}class r{constructor(t,q,u,v){this.globalTriangleVertexIndices=t;this.firstTriangleIndex=q;this.positions=v;this._rayDirection=n.create();this.bspNodeTree=[];const y=u-q,D=65535>=y?new Uint16Array(y):new Uint32Array(y);this.indices=D;for(let E=0;E<y;++E)D[E]=E;const G=c(t,q,u,v.data,v.stride),A=b.clamp(Math.log2(y/40),2,10),C=(E,I,H)=>{var J=e(D,G,E,I);const B=I-E;if(40>=B)return E=
new f(J,void 0,0,E,I),this.bspNodeTree.push(E),E;const {axis:z,midValue:K}=d(J),L=g(D,G,E,I,z,K),F=(M,S)=>{if(!(H>A)){var N=S-M;if(!(40>N||N>=.8*B))return C(M,S,H+1)}};J=new f(J,z,K,L.next,L.mid);this.bspNodeTree.push(J);J.leftNode=F(E,L.next);J.rightNode=F(L.mid,I);return J};C(0,y,0);this.triangleVertexIndices=l(D,t,q,u)}intersectRayTriangleRange(t,q){if(!(t>=q)){var u=this.triangleVertexIndices,v=this.positions.data,y=this.positions.stride,D=this._rayOrigin,G=D[0],A=D[1];D=D[2];var C=this._rayDirection,
E=C[0],I=C[1];C=C[2];for(let R=t,O=3*t;R<q;++R){var H=u[O]*y,J=v[H],B=v[H+1],z=v[H+2],K=u[O+1]*y;H=v[K];var L=v[K+1];K=v[K+2];var F=u[O+2]*y,M=v[F],S=v[F+1];F=v[F+2];O+=3;H-=J;L-=B;K-=z;M-=J;S-=B;F-=z;var N=I*F-S*C,P=C*M-F*E;const T=E*S-M*I,Q=H*N+L*P+K*T;if(!(Math.abs(Q)<=Number.EPSILON)){J=G-J;B=A-B;z=D-z;N=J*N+B*P+z*T;if(0<Q){if(0>N||N>Q)continue}else if(0<N||N<Q)continue;P=B*K-L*z;z=z*H-K*J;B=J*L-H*B;J=E*P+I*z+C*B;if(0<Q){if(0>J||N+J>Q)continue}else if(0<J||N+J<Q)continue;B=(M*P+S*z+F*B)/Q;0<=
B&&(z=this.indices[R]+this.firstTriangleIndex,H=k.computeNormal(H,L,K,M,S,F,x),this._callback(B,H,z,!1))}}r.numFacesTested+=q-t}}intersectRay(t,q,u){r.numFacesTested=0;var v=q[0]-t[0];const y=q[1]-t[1];q=q[2]-t[2];1E-6>v*v+y*y+q*q||(this._rayOrigin=t,t=this._rayDirection,t[0]=v,t[1]=y,t[2]=q,v=this.triangleVertexIndices.length/3,this._callback=u,this.intersectRayBSP(this.bspNodeTree[0],0,v))}intersectRayBSP(t,q,u){const v=this._rayOrigin,y=this._rayDirection;if(m(t.aabb,v,y)){var D=t.axis,G=t.d;if(v[D]<
G||0>y[D]){const A=t.midStartIndex;if(q<A){const C=t.leftNode;void 0!==C?this.intersectRayBSP(C,q,A):this.intersectRayTriangleRange(q,A)}}this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex);if(v[D]>G||0<y[D])q=t.rightStartIndex,q<u&&(t=t.rightNode,void 0!==t?this.intersectRayBSP(t,q,u):this.intersectRayTriangleRange(q,u))}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}r.numFacesTested=0;const x=n.create(),w=[Infinity,Infinity,Infinity],
p=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=r;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends c.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.overlayMode=g.OverlayMode.Disabled;this.tileBlendInput=e.TileBlendInput.LayerOnly;this.receiveAmbientOcclusion=this.screenSizePerspective=this.visualizeNormals=this.tileBorders=this.invisible=this.hasCloudsReflections=this.hasScreenSpaceReflections=this.renderOccluded=this.textureFadingEnabled=this.backfaceCullingEnabled=this.hasSlicePlane=this.receiveShadows=
this.doublePrecisionRequiresObfuscation=this.spherical=!1;this.pbrMode=m.PBRMode.Simplified}}b.__decorate([d.parameter({count:n.ShaderOutput.COUNT})],l.prototype,"output",void 0);b.__decorate([d.parameter({count:g.OverlayMode.COUNT})],l.prototype,"overlayMode",void 0);b.__decorate([d.parameter({count:e.TileBlendInput.COUNT})],l.prototype,"tileBlendInput",void 0);b.__decorate([d.parameter()],l.prototype,"spherical",void 0);b.__decorate([d.parameter()],l.prototype,"doublePrecisionRequiresObfuscation",
void 0);b.__decorate([d.parameter()],l.prototype,"receiveShadows",void 0);b.__decorate([d.parameter()],l.prototype,"hasSlicePlane",void 0);b.__decorate([d.parameter()],l.prototype,"backfaceCullingEnabled",void 0);b.__decorate([d.parameter()],l.prototype,"textureFadingEnabled",void 0);b.__decorate([d.parameter()],l.prototype,"renderOccluded",void 0);b.__decorate([d.parameter()],l.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([d.parameter()],l.prototype,"hasCloudsReflections",void 0);b.__decorate([d.parameter()],
l.prototype,"invisible",void 0);b.__decorate([d.parameter()],l.prototype,"tileBorders",void 0);b.__decorate([d.parameter()],l.prototype,"visualizeNormals",void 0);b.__decorate([d.parameter()],l.prototype,"screenSizePerspective",void 0);b.__decorate([d.parameter()],l.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([d.parameter({count:m.PBRMode.COUNT})],l.prototype,"pbrMode",void 0);b.__decorate([d.parameter({constValue:h.NormalType.Compressed})],l.prototype,"normalType",void 0);b.__decorate([d.parameter({constValue:k.TextureCoordinateAttributeType.Compressed})],
l.prototype,"textureCoordinateType",void 0);b.__decorate([d.parameter({constValue:!1})],l.prototype,"highStepCount",void 0);b.__decorate([d.parameter({constValue:!1})],l.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([d.parameter({constValue:!1})],l.prototype,"useFillLights",void 0);b.__decorate([d.parameter({constValue:!0})],l.prototype,"hasColorTexture",void 0);a.TerrainTechniqueConfiguration=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){class a{constructor(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}}return a})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){a.TilingSchemeLogic=class extends n{constructor(t){super(t)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),h.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]);this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null;this.layers.destroy()}_update(){this._waitTask=null;if(!this.tilingSchemeLocked){var t;this.layers.some(u=>!r.isTiledLayer(u)||u.isRejected()?!1:
u.isFulfilled()&&null==w.getTiledLayerInfo(u,this.viewSpatialReference,this.viewingMode)?!1:(t=u,"vector-tile"!==u?.type&&!w.isProjectableRasterLayer(u)));if(t)if(t.isResolved()){var q=w.getTiledLayerInfo(t,this.viewSpatialReference,this.viewingMode);null!=q&&(q=new p.TilingScheme(q.tileInfo),this._lockTilingScheme(q))}else this._updateWhen(t)}}_updateWhen(t){const q=t.when().catch(()=>{}).then(()=>{q!==this._waitTask||this.destroyed||this._update()});this._waitTask=q}_lockTilingScheme(t){if(this.viewingMode===
x.ViewingMode.Global){const q=t.levels.length-1;t.spatialReference.isWebMercator?t=p.TilingScheme.makeWebMercatorAuxiliarySphere(q):c.canProjectToWGS84ComparableLonLat(t.spatialReference)&&(t=p.TilingScheme.makeGCSWithTileSize(t.spatialReference,t.pixelSize,q))}this.tilingSchemeLocked=!0;this.tilingScheme=t;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this.removeAllHandles();this.addHandles(h.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",
this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===x.ViewingMode.Global){var t=this.extentHelper.viewSpatialReference;const q=c.canProjectToWGS84ComparableLonLat(t)||f.isMars(t)||f.isMoon(t);t.isWebMercator?this.tilingScheme=p.TilingScheme.WebMercatorAuxiliarySphere:q&&(this.tilingScheme=p.TilingScheme.makeGCSWithTileSize(t,256));this._set("extent",this.extentHelper.layerViewsExtent)}else t=this.extentHelper.layerViewsExtent,null==t||l.equals(t,this.extent)||(this.tilingScheme=
p.TilingScheme.fromExtent(t,this.extentHelper.viewSpatialReference),this._set("extent",t))}get test(){return{lockTilingScheme:t=>this._lockTilingScheme(t),done:!this._waitTask}}};b.__decorate([k.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);b.__decorate([k.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([k.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,
"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([k.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([d.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports",
"../../../core/libs/gl-matrix-2/factories/vec2f64"],function(a,b){class n{constructor(){this.offset=b.create();this.scale=0;this.tile=null}init(h,k,m,g){this.tile=h;this.offset[0]=k;this.offset[1]=m;this.scale=g}dispose(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0}}a.UpsampleInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler ../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){a.Stage=class extends n{constructor(u){super(u);this._model=new w.Model;this._layers=new h;this._asyncChangeSet=new f.ChangeSet;this._syncChangeSet=new f.ChangeSet;this._layerSyncSet=new Set}initialize(){this._set("renderView",new p.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(t.TaskPriority.STAGE,this);this.addHandles(this._frameTask)}destroy(){this.renderView.destroy()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||
this.renderView.updating||this._frameTask.updating}get renderer(){return this.renderView?.renderer}add(u){this._model.add(u);x.isWebGLLayer(u)&&this._addLayer(u);this.renderView.requestRender()}remove(u){null!=u&&!this.destroyed&&this._model.remove(u)&&(x.isWebGLLayer(u)&&this._removeLayer(u),this.renderView.requestRender())}addMany(u){null!=u&&(this._model.addMany(u),this.renderView.requestRender())}removeMany(u){null!=u&&(this._model?.removeMany(u),this.renderView?.requestRender())}forEachOfType(u,
v){this._model.forEachOfType(u,v)}handleEvent(u,v){this.destroyed||(this._model.dirtySet[u](v),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(u){this._frameTask.processQueue(u);this._commit(u);if(!u.hasProgressed)return q.Yield}_commit(u){const v=this._model.dirtySet;this._asyncChangeSet.empty||u.done||(this.renderer.modify(this._asyncChangeSet,u),this.renderView.requestRender(),u.madeProgress());this._layers.forAll(y=>{if(!u.done){var D=
this._layerSyncSet.has(y.id)||y.updatePolicy===r.UpdatePolicy.SYNC,G=D?this._syncChangeSet:this._asyncChangeSet;v.commitLayer(y.id,G);this._layerSyncSet.delete(y.id);G.empty||(this.renderer.modify(G,D?t.noBudget:u),this.renderView.requestRender(),u.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender(),u.madeProgress());this._layers.forAll(y=>{u.done||this._layerSyncSet.has(y.id)||y.updatePolicy!==r.UpdatePolicy.ASYNC||(v.commitLayer(y.id,
this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,u),this.renderView.requestRender(),u.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")}commitSyncLayers(){const u=this._model.dirtySet;this._layers.forAll(v=>{this._layerSyncSet.has(v.id)||v.updatePolicy===r.UpdatePolicy.SYNC?(u.commitLayer(v.id,this._syncChangeSet),this._layerSyncSet.delete(v.id)):u.commitSyncUpdates(v.id,this._syncChangeSet)});for(const v of this._layerSyncSet)u.commitLayer(v,
this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender())}_commitLayer(u){this._model.dirtySet.commitLayer(u.id,this._syncChangeSet);this._layerSyncSet.delete(u.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,t.noBudget),this.renderView.requestRender())}schedule(u,v){return this._frameTask.schedule(u,v)}reschedule(u,v){return this._frameTask.reschedule(u,v)}syncLayer(u){this._layerSyncSet.add(u);
this.renderView.requestRender()}getObject(u){return this._model.getObject(u)}get layers(){return this._layers}_addLayer(u){this._layers.includes(u)||this._layers.push(u)}_removeLayer(u){this._commitLayer(u);null!=this._layers.removeUnordered(u)&&(this._model.dirtySet.getResidentRenderGeometries(u.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,t.noBudget))}addRenderPlugin(u,v){v=this.renderer.plugins.add(u,v);const y=()=>{l.isIntersectionHandler(u)&&this.view.sceneIntersectionHelper.addIntersectionHandler(u)};
if(k.isPromiseLike(v))return v.then(y);y()}removeRenderPlugin(u){this.destroyed||(l.isIntersectionHandler(u)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(u),this.renderer.plugins.remove(u))}get performanceInfo(){return this._model.getStats()}get test(){const u=this;return{getCount(v){return u._model.test.content.filter(y=>y.type===v).length},model:u._model}}};a.Stage.DebugSettings={endFrameContentValidation:!1};b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"view",
void 0);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([m.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([m.property()],a.Stage.prototype,"renderView",void 0);b.__decorate([m.property({readOnly:!0})],
a.Stage.prototype,"renderer",null);b.__decorate([m.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=b.__decorate([c.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/sphere ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){a.Model=class extends n{constructor(){super(...arguments);this.dirtySet=new r({model:this});this._content=new Map;this._originFactory=new f.GridLocalOriginFactory(null)}getObject(q){return this._content.get(q)}add(q){const u=q.id;w.assert(!this._content.has(u),"Model/Stage already contains object to be added");this._content.set(u,q);p.isWebGLLayer(q)&&this.dirtySet.layerAdded(q)}remove(q){if(!this._content.has(q.id))return!1;this._content.delete(q.id);p.isWebGLLayer(q)&&
this.dirtySet.layerRemoved(q);return!0}addMany(q){for(const u of q)u&&(w.assert(!this._content.has(u.id),"Model/Stage already contains object to be added"),this._content.set(u.id,u))}removeMany(q){for(const u of q)u&&(w.assert(this._content.has(u.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(u.id))}has(q){return this._content.has(q.id)}forEachOfType(q,u){this._content.forEach(v=>{v.type===q&&u(v)})}getRenderGeometry(q,u){const v=new x.RenderGeometry(u,{castShadow:q.castShadow,
objectShaderTransformation:q.shaderTransformation});v.transformation=q.getCombinedStaticTransformation(u,t);({localOrigin:q}=u);v.localOrigin=null!=q?q:this._originFactory.getOrigin(c.getCenter(v.boundingSphere));return v}updateRenderGeometryTransformation(q,u,v){if(null==q)return!1;v.transformation=q.getCombinedStaticTransformation(u,t);q=this._originFactory.getOrigin(c.getCenter(v.boundingSphere));return v.localOrigin!==q}getStats(){const q={},u=Array.from(this._content.values());for(let v=0;v<
l.ContentObjectType.COUNT;++v)q[v]=u.filter(y=>y.type===v).length;return{contentTypes:q,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};b.__decorate([h.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([e.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);const t=d.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f{constructor(r,x,w,p){this.operation=r;this.geometry=x;this.states=w;this.sync=p}}b=class extends b{constructor(r){super(r);this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this.dirty=!1}commitLayer(r,x){const w=this._dirtyGeomRecords.get(r);w&&(w.forEach((p,t)=>{const q=this._ensureGeomRecord(r,t);p.forEach(({geometry:u,operation:v,states:y},D)=>{let G=!1;if(v===c.DirtyOperation.UPDATE){const A=q.get(D);if(A){if(y&c.DirtyState.TRANSFORMATION){const C=
this.model.getObject(t);this.model.updateRenderGeometryTransformation(C,u,A)&&(G=!0)}G||x.updates.push({renderGeometry:A,updateType:y})}else l.assert(!1,"ModelDirtySet.commitLayer: invalid update")}if(v===c.DirtyOperation.REMOVE||G)(y=q.get(D))?(x.removes.push(y),q.delete(D)):v===c.DirtyOperation.REMOVE&&l.assert(!1,"ModelDirtySet.commitLayer: invalid remove");if(v===c.DirtyOperation.ADD||G)v=this.model.getObject(t),null!=v&&(u=this.model.getRenderGeometry(v,u),x.adds.push(u),q.set(D,u))});0===q.size&&
this._residentGeomRecords.get(r).delete(t)}),0===this._residentGeomRecords.get(r).size&&this._residentGeomRecords.delete(r),this._dirtyGeomRecords.delete(r),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(r,x){const w=this._dirtyGeomRecords.get(r);w&&w.forEach((p,t)=>{const q=this._ensureGeomRecord(r,t);p.forEach(({geometry:u,operation:v,states:y,sync:D},G)=>{let A=!1;v===c.DirtyOperation.UPDATE&&D&&((v=q.get(G))?(y&c.DirtyState.TRANSFORMATION&&(D=this.model.getObject(t),this.model.updateRenderGeometryTransformation(D,
u,v)&&(A=!0)),A||x.updates.push({renderGeometry:v,updateType:y})):l.assert(!1,"ModelDirtySet.commitSyncUpdates: invalid update"))})})}getResidentRenderGeometries(r,x){(r=this._residentGeomRecords.get(r))&&r.forEach(w=>w.forEach(p=>x.push(p)))}_objectStateChanged(r,x){for(const w of x.geometries)this._updateOrCreateDirtyRecord(x,w,null,c.DirtyOperation.UPDATE,r)}visibilityChanged(r){this._objectStateChanged(c.DirtyState.VISIBILITY,r)}highlightChanged(r){this._objectStateChanged(c.DirtyState.HIGHLIGHT,
r)}occlusionChanged(r){this._objectStateChanged(c.DirtyState.OCCLUDEE,r)}attributesChanged({object:r,geometry:x,sync:w}){this._updateOrCreateDirtyRecord(r,x,null,c.DirtyOperation.UPDATE,c.DirtyState.GEOMETRY,w)}layerAdded(r){r.objects.forAll(x=>this._layerObjectAdded(r,x))}layerRemoved(r){r.objects.forAll(x=>this._layerObjectRemoved(r,x))}layerObjectAdded(r){this._layerObjectAdded(r.layer,r.object)}_layerObjectAdded(r,x){r=r.id;for(const w of x.geometries)this._geometryAdded(x,w,r)}layerObjectRemoved(r){this._layerObjectRemoved(r.layer,
r.object)}layerObjectsAdded(r){for(const x of r.objects)this._layerObjectAdded(r.layer,x)}layerObjectsRemoved(r){for(const x of r.objects)this._layerObjectRemoved(r.layer,x)}_layerObjectRemoved(r,x){r=r.id;for(const w of x.geometries)this._geometryRemoved(x,w,r)}transformationChanged(r){const x=this._getParentLayerId(r);this._ensureGeomRecord(x,r.id).forEach(w=>{this._updateOrCreateDirtyRecord(r,w.geometry,x,c.DirtyOperation.UPDATE,c.DirtyState.TRANSFORMATION)})}shaderTransformationChanged(r){const x=
this._getParentLayerId(r);this._ensureGeomRecord(x,r.id).forEach(w=>{w.objectShaderTransformationChanged(r.shaderTransformation)})}geometryAdded(r){this._geometryAdded(r.object,r.geometry)}_geometryAdded(r,x,w=null){this._updateOrCreateDirtyRecord(r,x,w,c.DirtyOperation.ADD)}geometryRemoved(r){this._geometryRemoved(r.object,r.geometry)}_geometryRemoved(r,x,w=null){this._updateOrCreateDirtyRecord(r,x,w,c.DirtyOperation.REMOVE)}_updateOrCreateDirtyRecord(r,x,w,p,t=c.DirtyState.NONE,q=!1){w=w??this._getParentLayerId(r);
const u=x.id;r=this._ensureDirtyRecord(w,r.id);(w=r.get(u))?(x=w.operation,x===c.DirtyOperation.REMOVE&&p===c.DirtyOperation.ADD&&w.states!==c.DirtyState.NONE?w.operation=c.DirtyOperation.UPDATE:x===c.DirtyOperation.REMOVE&&p===c.DirtyOperation.ADD||x===c.DirtyOperation.ADD&&p===c.DirtyOperation.REMOVE?r.delete(u):(x!==c.DirtyOperation.UPDATE||p!==c.DirtyOperation.REMOVE&&p!==c.DirtyOperation.UPDATE?l.assert((x===c.DirtyOperation.REMOVE||x===c.DirtyOperation.ADD)&&p===c.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
w.operation=p,w.states|=t),w.sync=w.sync||q):r.set(u,new f(p,x,t,q));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(r,x){let w=this._residentGeomRecords.get(r);w||(w=new Map,this._residentGeomRecords.set(r,w));r=w.get(x);r||(r=new Map,w.set(x,r));return r}get _hasDirtyGeometryRecords(){return n.someMap(this._dirtyGeomRecords,r=>n.someMap(r,x=>x&&0<x.size))}_ensureDirtyRecord(r,x){let w=this._dirtyGeomRecords.get(r);w||(w=new Map,this._dirtyGeomRecords.set(r,w));r=w.get(x);r||(r=new Map,
w.set(x,r));return r}_getParentLayerId(r){return r.parentLayer?r.parentLayer.id:h.nullUid}formatDebugInfo(){const r=["ADD","UPD",void 0,"REM"];let x="";this._dirtyGeomRecords.forEach((w,p)=>{w.forEach((t,q)=>{0<x.length&&(x+="\n");x+=p+"."+q;const u=[];t.forEach(v=>{const y=v.operation;u[y]||(u[y]=[]);u[y].push(v.geometry.id)});for(t=0;t<u.length;t++)if(u[t])for(x+=" "+r[t-1]+": ",q=0;q<u[t].length;q++)x+=u[t][q]+", "})});return x}get test(){const r=this;return{get residentLayerCount(){return r._residentGeomRecords.size},
get residentObjectCount(){return Array.from(r._residentGeomRecords.values()).reduce((x,w)=>x+w.size,0)},commit:x=>r._dirtyGeomRecords.forEach((w,p)=>r.commitLayer(p,x))}}};a.__decorate([k.property({constructOnly:!0})],b.prototype,"model",void 0);a.__decorate([k.property()],b.prototype,"dirty",void 0);return b=a.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/markerTextureRepository ../materials/stippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/contextUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F){a.RenderView=class extends n{constructor(S){super({});this.events=new h;this.waterTextures=new H.WaterTextureRepository;this._magnifierHelper=new v.MagnifierHelper;this.objectAndLayerIdRenderHelper=k("enable-feature:objectAndLayerId-rendering")?new D.ObjectAndLayerIdRenderHelper:null;this._idleSuspend=this._needsRender=this._needsUpdate=!0;this._needsWaterReflectionUpdate=!1;this._lastAnimationUpdate=0;this._container=S.container;
this._viewingMode=S.viewingMode;try{this._initializeContext(S)}catch(P){console.error("Failed to initialize context",P);return}this.addHandles([e.watch(()=>this.waterTextures?.updating,()=>this.requestRender(),e.initial),e.watch(()=>S.view.qualityProfile,P=>this.renderer?.updateRenderFeatures(P),e.syncAndInitial),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const {memoryController:N}=S.view.resourceController;this.stippleTextures=I.createStippleTextureRepository(this._rctx,
N);this.markerTextures=E.createMarkerTextureRepository(this._rctx,N);this._shaderTechniques=new w.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:S.viewingMode,stippleTextureRepository:this.stippleTextures,waterTextureRepository:this.waterTextures,markerTextureRepository:this.markerTextures});this._textures=new C.TextureRepository(S,this._shaderTechniques,this._rctx);this.addHandles(this._textures.events.on("changed",P=>this.requestRender(P)));this._materialRepository=new u.GLMaterialRepository(this._textures,
this._shaderTechniques,()=>this.requestRender(),()=>this.requestRender());this._compositingHelper=new t(this._rctx,this._shaderTechniques);this.renderer=new G.Renderer(S,this._materialRepository,this._textures,this._shaderTechniques,this._rctx,this._compositingHelper,this._magnifierHelper,P=>this.requestRender(P));this._screenshotManager=new z.ScreenshotManager(this._rctx,{renderScene:(P,R,O,T)=>this.renderer.render(P,R,O,T),requestRenderScene:P=>this.requestRender(P),prepareOverlay:()=>S.options.screenshot.prepareOverlay(),
renderOverlay:(P,R,O)=>S.options.screenshot.renderOverlay(P,R,O)},P=>this.events.emit("force-camera-for-screenshot",P));this._registerFrameTask(S)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=g.removeMaybe(this._frameTask);this._shaderTechniques=g.destroyMaybe(this._shaderTechniques);this._componentObjects=g.destroyMaybe(this._componentObjects);this._screenshotManager=g.destroyMaybe(this._screenshotManager);
g.destroyMaybe(this.renderer);this._textures=g.destroyMaybe(this._textures);g.destroyMaybe(this._magnifierHelper);g.destroyMaybe(this.waterTextures);g.destroyMaybe(this.markerTextures);g.destroyMaybe(this.stippleTextures);this._container=this._canvas=null;this._rctx=g.destroyMaybe(this._rctx)}requestRender(S=p.RenderRequestType.UPDATE){this._needsRender=!0;S===p.RenderRequestType.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||
this._textures.updating||this.waterTextures.updating||this._magnifierHelper.updating}get textureRepository(){return this._textures}get compositingHelper(){return this._compositingHelper}set magnifier(S){this._magnifierHelper.magnifier=S}setIdleSuspend(S){this._idleSuspend!==S&&(this._idleSuspend=S,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(S){return this._screenshotManager.takeScreenshot(S).then(N=>
N[0])}takeScreenshotWithOID(S){S.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(S)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(S,N,P,R,O,T=O){T=R.constrainWindowSize(N,P,O*R.pixelRatio,T*R.pixelRatio);const Q=this._ensureDepthBuffer(T);this.renderer.readDepthPixels(R,T,Q);O=Number.MAX_VALUE;for(let V=0;V<T[2]*T[3];V++){const U=q.textureToDepth(4*V,Q,R.nearFar);O>U&&U!==R.nearFar[0]&&U!==R.nearFar[1]&&(O=U)}S&&(S=S.pickDepth(N*R.pixelRatio,P*
R.pixelRatio,R),null!=S&&O>S&&S!==R.nearFar[0]&&S!==R.nearFar[1]&&(O=S));return O===Number.MAX_VALUE?void 0:O}_ensureDepthBuffer(S){S=4*S[2]*S[3];if(null==this._tmpDepthBuffer||this._tmpDepthBuffer.byteLength<S)this._tmpDepthBuffer=new Uint8Array(S);return this._tmpDepthBuffer}async reloadShaders(){B.removeLoadedShaderModules();await this._shaderTechniques.reloadAll();this.requestRender()}_registerFrameTask(S){const N=S.view.state;let P=!1,R=p.RenderRequestType.BACKGROUND,O=!1;this._frameTask=d.addFrameTask({preRender:({time:T})=>
{P=this.updating;R=this._needsUpdate?p.RenderRequestType.UPDATE:p.RenderRequestType.BACKGROUND;S.commitSyncLayers();var Q=c.Milliseconds(T-this._lastAnimationUpdate);if(Q>this.renderer.animationTimestep||null!=N.forcedAnimationTime||P||this._needsRender)Q=c.Milliseconds(Q/this.renderer.animationTimeDilation),Q=new y.UpdateParameters(N.camera,Q,N.forcedAnimationTime),this.renderer.updateAnimation(Q)&&this.requestRender(p.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=T},render:({time:T})=>
{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<N.camera.fullWidth&&0<N.camera.fullHeight){const Q=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(N,T);O=!0;Q&&this.renderer.hasReflections&&(this.requestRender(p.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:T})=>{const Q=new z.ScreenshotContext(N,
this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,this.renderer.fboCache);this._textures.update();this._screenshotManager.update(Q,T)},finish:()=>{O&&(this.renderer.finish(N.mode===L.RenderState.IDLE?R:p.RenderRequestType.UPDATE),O=!1)}})}_initializeContext(S){const N=S.options;this._canvas=N.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");
const P=F.createContext(this._canvas,{alpha:N.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:N.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:N.preserveDrawingBuffer??!1});null==P?m.getLogger(this).error("A WebGL2 context could not be created."):(this._rctx=this._newRenderingContext(P,S),this._loadShaderOnlyExtensions(),!N.alpha&&this._rctx.contextAttributes.alpha&&m.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),
!this._rctx.contextAttributes.alpha&&11<=k("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))}_newRenderingContext(S,N){const P={disabledExtensions:N.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:N.options.debugWebGLExtensions||{},maxAnisotropy:8},R=(O,T)=>N.view.resourceController.memoryController.newCache(O,T);if(K.contextCache.enabled){let O=M.get(S);if(O)return O.configure(P),O.newCache=R,O.ref(),O;O=new A.RenderingContext(S,P,R);
M.set(S,O);O.ref();return O}return new A.RenderingContext(S,P,R)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(S){return null!=this.objectAndLayerIdRenderHelper?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(S):null}get componentObjectCollection(){null==this._componentObjects&&(this._componentObjects=new x.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjects}set componentObjectCollection(S){this._componentObjects=
S}};b.__decorate([l.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);b.__decorate([l.property()],a.RenderView.prototype,"_rctx",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_container",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_canvas",void 0);b.__decorate([l.property()],a.RenderView.prototype,"stippleTextures",void 0);b.__decorate([l.property()],a.RenderView.prototype,"markerTextures",void 0);b.__decorate([l.property()],a.RenderView.prototype,
"waterTextures",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_magnifierHelper",void 0);b.__decorate([l.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_textures",void 0);b.__decorate([l.property({readOnly:!0})],a.RenderView.prototype,"renderer",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_screenshotManager",void 0);b.__decorate([l.property()],a.RenderView.prototype,"componentObjectCollection",
null);b.__decorate([l.property()],a.RenderView.prototype,"_componentObjects",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_needsUpdate",void 0);b.__decorate([l.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=b.__decorate([r.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const M=J.getContextCache();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../core/has ../../../../../core/Logger ../../../../../core/PooledArray ../../../../../core/typedArrayUtil ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/Indices ../../../../../chunks/vec3 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N){function P(V,U){return V===U?C.ComponentParameterSummary.All:0===V?C.ComponentParameterSummary.None:C.ComponentParameterSummary.Some}const R=()=>n.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class O{constructor(V,U){this._renderManager=V;this._viewingMode=U;this._elevationRangeCacheMax=this._elevationRangeCacheMin=this._elevationRangeCacheVerticalOffset=NaN;this._visible=
new h;this._hidden=new h;this._renderSubmit=new D.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._hasObjectAndLayerId=b("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new F.BufferManager(V.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){J.assert(0===this._hidden.length&&0===this._visible.length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy();this._visible.forAll(V=>V.destroy());this._hidden.forAll(V=>
V.destroy());this._visible.clear();this._hidden.clear()}createObject(V){var U=V.geometry;const W=new t(this._componentBufferManager,d.compactIndices(U.componentOffsets)),ca=this._createRenderable(V,W);U=new u(this._viewingMode,U.positionData,W);V=new q.ComponentObject(V.transform,V.toMapSpace,V.obb.clone(),W,ca,U);(V.visible?this._visible:this._hidden).push(V);return V}destroyObject(V){(V.visible?this._visible:this._hidden).removeUnordered(V);V.destroy();this._notifyDirty()}setObjectVisibility(V,
U){U!==V.visible&&(U?(this._hidden.removeUnordered(V),this._visible.push(V)):(this._visible.removeUnordered(V),this._hidden.push(V)),V.visible=U,this._notifyDirty())}preSubmit(V){const U=V.camera.eye;this.visibleObjects.forAll(W=>W.renderable.meta.cameraDepthSquared=m.squaredDistance(U,W.obb.center))}getMaterial(V){return V.renderable.material}updateMaterial(V,U){V=V.renderable.material;U(V);V.dirty&&this._notifyDirty()}setAllComponentVisibilities(V,U){V.components.visibility.reset(U);V.components.visibilityDirty();
this._notifyDirty()}forEachVisibleComponent(V,U){return V.components.visibility.forEachComponent(U)}getComponentCount(V){const U=V.components.visibility.componentCount;return{visible:U,invisible:V.components.count-U}}setComponentData(V,U){const W=V.renderable.material,ca=V.components;var X=ca.materialDataBuffer;const ba=ca.materialDataIndices,ia=new A.UniformComponentParameters;X=X.textureBuffer;const fa=new Uint8Array(4),da=new Uint32Array(fa.buffer);let aa=0,ea=0,ha=0,Y=ca.verticalOffsets,Z=Infinity,
ja=-Infinity,oa=!1,qa=!1,ta=0;for(let va=0;va<ca.count;va++){U(va,ia);aa+=+(1>ia.externalColor[3]);ea+=+(ia.externalColorMixMode===r.ColorMixModeEnum.Replace&&1===ia.externalColor[3]);ha+=+ia.castShadows;r.encodeSymbolColor(ia.externalColor,ia.externalColorMixMode,fa);fa[2]=fa[2]&254|+ia.castShadows;X.setData(ba[va],0,fa[0],fa[1],fa[2],fa[3]);oa||=0<va&&ta!==da[0];ta=da[0];qa||=0!==ia.elevationOffset;qa&&null==Y&&(Y=Array(va).fill(0));null!=Y&&(Y[va]=ia.elevationOffset);Z=Math.min(Z,ia.elevationOffset);
ja=Math.max(ja,ia.elevationOffset);I.encodeElevationOffset(ia.elevationOffset,fa);X.setData(ba[va],1,fa[0],fa[1],fa[2],fa[3]);const Ca=ia.objectAndLayerIdColor;null!=Ca&&X.setData(ba[va],2,Ca[0],Ca[1],Ca[2],Ca[3]);ia.pickable!==H.getVisibility(ca.pickability,va)&&(ca.pickability=H.updateVisibilityWithCount(ca.pickability,ca.count,va,ia.pickable))}ca.verticalOffsets=qa?Y:null;V.offsetObb=qa?x.computeOffsetObb(V.obb,Z,ja,this._viewingMode,V.offsetObb??V.obb.clone()):null;oa||qa||this._hasObjectAndLayerId?
(W.componentParameters=new C.ComponentParametersVarying,W.componentParameters.castShadows=P(ha,ca.count),W.componentParameters.transparent=P(aa,ca.count),W.componentParameters.opaqueOverride=P(ea,ca.count),W.componentParameters.texture=X,X.updateTexture()):(W.componentParameters=new C.ComponentParametersUniform,W.componentParameters.castShadows=ia.castShadows?C.ComponentParameterSummary.All:C.ComponentParameterSummary.None,W.componentParameters.externalColor=ia.externalColor,W.componentParameters.externalColorMixMode=
ia.externalColorMixMode);this._elevationRangeCacheVerticalOffset=NaN;this._notifyDirty()}getComponentAabb(V,U,W,ca=!1){V.intersectionGeometry.getComponentAabb(U,W);const X=V.components.verticalOffsets;if(ca||null==X)return W;U=X[U];if(this._viewingMode===f.ViewingMode.Local||0===U)return W[2]+=U,W[5]+=U,W;U=z.getVerticalOffsetI3S(U);U.localOrigin=V.transform.position;return U.applyToAabb(W)}getComponentObb(V){return V.obb}getObjectTransform(V){return V.transform}getComponentPositions(V,U,W){return V.intersectionGeometry.getComponentPositions(U,
W)}expandRangeWithComponentObjectElevationRange(V,U,W,ca){Number.isNaN(this._elevationRangeCacheVerticalOffset)||this._elevationRangeCacheVerticalOffset!==U||ca.expandElevationRangeValues(this._elevationRangeCacheMin,this._elevationRangeCacheMax);var X=V.components;const ba=X.count;X=X.verticalOffsets;const ia=this._viewingMode===f.ViewingMode.Local,fa=V.intersectionGeometry.getComponentAabbs(),da=Q;let aa=Infinity,ea=-Infinity;for(let Z=0;Z<ba;Z++){var ha=6*Z,Y=X?.[Z]??0;let ja=Infinity,oa=-Infinity;
if(ia)ja=fa[ha+2]+Y+U,oa=fa[ha+5]+Y+U;else{da[0]=fa[ha];da[1]=fa[ha+1];da[2]=fa[ha+2];da[3]=fa[ha+3];da[4]=fa[ha+4];da[5]=fa[ha+5];0!==Y&&(ha=z.getVerticalOffsetI3S(Y),ha.localOrigin=V.transform.position,ha.applyToAabb(da));ha=Math.max(Math.abs(da[3]),Math.abs(da[0]));Y=Math.max(Math.abs(da[4]),Math.abs(da[1]));const qa=U+da[5]+W;ca.expandElevationRangeValues(U+da[2],Math.sqrt(ha*ha+Y*Y+qa*qa)-W)}ca.expandElevationRangeValues(ja,oa);aa=Math.min(aa,ja);ea=Math.max(ea,oa)}this._elevationRangeCacheVerticalOffset=
U;this._elevationRangeCacheMin=aa;this._elevationRangeCacheMax=ea}intersect(V,U,W,ca,X,ba,ia){const {transform:fa}=V,{position:da}=fa;null!=X&&(X.localOrigin=da);return V.intersectionGeometry.intersect(U,W,ca,X,V.components.verticalOffsets,ba,fa,ia??!1)}addEdges(V,U,W,ca){const {indices:X,positions:ba}=V.intersectionGeometry;return U.addComponentObject(V,ba,X,V.components.offsets,W,ca)}async extractEdgeInformation(V,U,W){var ca=V.components.visibility;if(ca.allInvisible())return{buffer:L.extractComponentsEdgeLocationsLayout.createBuffer(0),
origin:[0,0,0]};const {indices:X,positions:ba}=V.intersectionGeometry,ia=V.components.offsets,fa=K.EdgeInputBufferLayout.createBuffer(ba.length/3);l.copy(fa.position.typedBuffer,ba,fa.position.typedBufferStride,3);c.transformMat3View(fa.position,fa.position,V.transform.rotationScale);this._setComponentIndices(fa.componentIndex,X,ia);ca=this._computeVisibilityIndices(X,ca,ia,fa.count);V=g.clone(V.transform.position);U=await U.extractComponentsEdgeLocations({indices:ca,indicesLength:ca.length,skipDeduplicate:!0,
data:fa,writerSettings:{reducedPrecision:!1,variants:0}},W);return{origin:V,buffer:U}}_setComponentIndices(V,U,W){let ca=0;for(let ba=0;ba<W.length-1;ba++){var X=W[ba];const ia=W[ba+1];for(;X<ia;X++)V.set(U?U[X]:X,ca);ca++}}_computeVisibilityIndices(V,U,W,ca){if(V&&U.allVisible())return V;let X=0;U.forEachComponentRange((fa,da)=>{X+=W[da]-W[fa];return!0});const ba=k.isArray(V)?Array(X):2===V?.BYTES_PER_ELEMENT||65536>=ca?new Uint16Array(X):new Uint32Array(X);let ia=0;U.forEachComponentRange((fa,da)=>
{fa=W[fa];for(da=W[da];fa<da;fa++)ba[ia++]=V?V[fa]:fa;return!0});return ba}addComponentHighlight(V,U){V=V.components;null==V.highlightCounts&&(V.highlightCounts=new Uint32Array(V.count+1));0===V.highlightCounts[U]++&&(V.highlightsDirty(),this._notifyDirty());V.highlightCounts[V.count]++}removeComponentHighlight(V,U){V=V.components;if(null==V.highlightCounts)R().warn("Removing non-existing highlight.");else{var W=V.highlightCounts[U],ca=V.highlightCounts[V.count];0===W?R().warn("Removing non-existing highlight."):
1<W?(V.highlightCounts[U]=W-1,V.highlightCounts[V.count]=ca-1):(V.highlightCounts[U]=0,V.highlightsDirty(),this._notifyDirty(),1===ca?V.highlightCounts=null:V.highlightCounts[V.count]=ca-1)}}clearHighlights(V){V=V.components;null!=V.highlightCounts&&(V.highlightCounts=null,V.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(V){return V.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._visible}_createRenderable(V,U){var W=this._renderManager.rctx;const ca=V.geometry;
var X=ca.vertices.layoutParameters;const ba=M.BufferObject.createVertex(W,S.Usage.STATIC_DRAW,ca.vertices.data),ia=ca.indices?M.BufferObject.createIndex(W,S.Usage.STATIC_DRAW,ca.indices):null,fa=w.glLayout(G.createVertexBufferLayout(X)),da=new Uint16Array(ca.vertices.count);for(let ea=0;ea<U.count;ea++){var aa=U.offsets[ea];const ha=U.offsets[ea+1],Y=U.materialDataIndices[ea];if(null!=ca.indices)for(;aa<ha;aa++)da[ca.indices[aa]]=Y;else for(;aa<ha;aa++)da[aa]=Y}U=M.BufferObject.createVertex(W,S.Usage.STATIC_DRAW,
da.buffer);V=new C.ComponentMaterial(V.transform,V.toMapSpace);W=new N.VertexArrayObject(W,E.attributeLocations,{data:fa,componentIndices:T},{data:ba,componentIndices:U},ia);X=new y.RenderGeometry(W,S.PrimitiveType.TRIANGLES,X,null!=ia);return new v.Renderable(V,X,{cameraDepthSquared:.5,gpuMemoryEstimate:ba.usedMemory+U.usedMemory+(null!=ia?ia.usedMemory:0)})}_notifyDirty(){this._renderManager.notifyDirty()}}const T=w.glLayout(p.newLayout().u16(B.VertexAttribute.COMPONENTINDEX)),Q=e.create();a.ComponentObjectCollection=
O;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["./IndexRange/ComponentRangeRunLengthEncoded"],function(a){function b(h,k,m){const g=[],e=[];let d=m.length,c=m.length;k.forEachComponent(l=>{0<h[l]?(d!==l-1&&(g.length&&g.push(m[d+1]-g[g.length-1]),g.push(m[l])),d=l):(c!==l-1&&(e.length&&e.push(m[c+1]-e[e.length-1]),e.push(m[l])),c=l);return!0});g.length&&g.push(m[d+1]-g[g.length-1]);e.length&&e.push(m[c+
1]-e[e.length-1]);return{highlightRanges:g,defaultRanges:e}}class n{constructor(h,k){this.offsets=k;this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=this.highlightCounts=this.pickability=null;k=this.count;this.visibility=new a.ComponentRangeRunLengthEncoded(k);this.materialDataBuffer=h.getBuffer(k);this.materialDataIndices=new Uint16Array(k);for(h=0;h<k;h++)this.materialDataIndices[h]=this.materialDataBuffer.acquireIndex()}destroy(){for(let h=0;h<
this.count;h++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[h])}get count(){return this.offsets.length-1}get geometryRanges(){null==this.cachedGeometryRanges&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}get highlightRanges(){if(null==this.highlightCounts)return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}get defaultShadowMapRanges(){if(null==this.highlightCounts)return this.geometryRanges;
this._updateCachedHighlightRanges();return this.cachedDefaultRanges}highlightsDirty(){this.cachedDefaultRanges=this.cachedHighlightRanges=null}visibilityDirty(){this.cachedGeometryRanges=null;this.highlightsDirty()}_updateCachedHighlightRanges(){if((null==this.cachedHighlightRanges||null==this.cachedDefaultRanges)&&null!=this.highlightCounts){const {highlightRanges:h,defaultRanges:k}=b(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=h;this.cachedDefaultRanges=k}}}return n})},
"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){class b{constructor(n){this._totalCount=n;this._componentCountCache=-1;this._indexRanges=[0,n]}allVisible(){return this.componentCount===this._totalCount}allInvisible(){return 0===this._indexRanges.length}isVisible(n){if(0>n||n>=this._totalCount)return!1;if(this.allVisible())return!0;const h=this._indexRanges;let k=0,m=h.length/2;if(n<h[2*k]||n>h[2*m]+h[2*m+1])return!1;
for(;0<m-k;){const g=Math.floor(.5*(k+m)),e=h[2*g];if(n<e){if(1===m-k)break;m=g}else{if(n<e+h[2*g+1])return!0;if(1===m-k)break;k=g+1}}return!1}get componentCount(){if(-1===this._componentCountCache){const n=this._indexRanges;let h=0;for(let k=0;k<n.length;k+=2)h+=n[k+1];this._componentCountCache=h}return this._componentCountCache}reset(n){if("all"===n||n.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const m=[];if(0!==n.length){var h=n[0],k=1;for(let g=1;g<n.length;g++){const e=
n[g];h+k===e?k+=1:(m.push(h),m.push(k),h=e,k=1)}m.push(h);m.push(k)}n=m}this._indexRanges=n}this._componentCountCache=-1}forEachComponent(n){const h=this._indexRanges;for(let m=0;m<h.length;m+=2){var k=h[m];const g=k+h[m+1];for(;k<g;k++)if(!n(k))return!1}return!0}forEachComponentRange(n){const h=this._indexRanges;for(let k=0;k<h.length;k+=2){const m=h[k];if(!n(m,m+h[k+1]))return!1}return!0}computeOffsetRanges(n){const h=Array(this._indexRanges.length),k=this._indexRanges;for(let g=0;g<k.length;g+=
2){var m=k[g];const e=n[m];m=n[m+k[g+1]];h[g]=e;h[g+1]=m-e}return h}}a.ComponentRangeRunLengthEncoded=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../core/maybe"],function(a,b){class n{constructor(h,k,m,g,e,d){this.transform=h;this.toMapSpace=k;this.obb=m;this.components=g;this.renderable=e;this.intersectionGeometry=d;this.visible=!1;this.offsetObb=null}destroy(){this.intersectionGeometry=
b.destroyMaybe(this.intersectionGeometry);this.renderable=b.destroyMaybe(this.renderable);this.components=b.destroyMaybe(this.components)}}a.ComponentObject=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/FloatArray ../../../../../geometry/support/Indices ../../../../ViewingMode ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x{constructor(K,L,F){this.viewingMode=K;this.positionData=L;this._components=F;this._planetCenter=h.create();this._planetNorth=h.create();this._componentIndicesForBsp=null;this._componentBspNodes=[];this._aabb=[0,0,0,0,0,0];this._indices=L.indices?e.compactIndices(L.indices):e.getContinuousIndexArray(L.positions.length/3);this._positions=L.positions;this._componentIntersectionData=Array(F.count)}destroy(){this._indices=this._positions=null;this._componentIntersectionData.length=
0;this._perComponentAabbs=null}getComponentAabb(K,L){const F=this._ensureComponentAabbs();K*=6;L[0]=F[K];L[1]=F[K+1];L[2]=F[K+2];L[3]=F[K+3];L[4]=F[K+4];L[5]=F[K+5];return L}getComponentAabbs(){return this._ensureComponentAabbs()}_ensureComponentAabbs(){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());return this._perComponentAabbs}getComponentPositions(K,L){L.indices=this._indices;L.data=this._positions;L.stride=3;L.startIndex=this._components.offsets[K];L.endIndex=
this._components.offsets[K+1]}intersect(K,L,F,M,S,N,P,R){var {position:O}=P;const T=n.sub(u,K,O),Q=n.sub(v,L,O);K=a.invert(y,P.rotationScale);n.transformMat3(T,T,K);n.transformMat3(Q,Q,K);const V=a.transpose(D,K),U=new l.Vertices(this._positions,3),W=this._indices,ca=this._components.offsets,X=r.computeInvDir(T,Q,p);this.viewingMode===d.ViewingMode.Global&&(L=this._planetCenter,n.negate(L,O),n.transformMat3(L,L,K),O=this._planetNorth,n.set(O,0,0,1),n.transformMat3(O,O,K),n.normalize(O,O));const ba=
n.copy(G,T),ia=n.copy(A,Q);O=n.sub(C,Q,T);n.normalize(O,O);this._intersectComponents(fa=>{var da=this.getComponentAabb(fa,t);if(null!=S){var aa=S[fa];null==M||R?(T[2]=ba[2]-aa,Q[2]=ia[2]-aa):M.componentOffset=aa}null==M||R||M.applyToAabb(da);if(r.intersectAabbInvDir(da,T,X,F)){da=ca[fa]/3;aa=ca[fa+1]/3;var ea=(ha,Y,Z)=>N(fa,ha,n.transformMat3(Y,Y,V),Z);(null==M||R)&&aa-da>c.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[fa]&&(this._componentIntersectionData[fa]=new c.ComponentIntersectionData(this._indices,
da,aa,U)),this._componentIntersectionData[fa].intersectRay(T,Q,ea)):r.intersectTriangles(T,Q,da,aa,W,U,void 0,M,ea)}},R,T,Q)}_intersectComponents(K,L,F,M){const S=this._components.pickability,N=this._components.visibility;if(7>this._components.visibility.componentCount)N.forEachComponent(O=>{f.getVisibility(S,O)&&K(O);return!0});else{0===this._componentBspNodes.length&&this._generateComponentBspRoot();var P=this._componentIndicesForBsp,R=(O,T)=>{for(let Q=O;Q<T;++Q)O=P[Q],f.getVisibility(S,O)&&N.isVisible(O)&&
K(O)};if(L)for(L=0;0<=L;)if(L=this._componentBspNodes[L],M=L.plane,!M||-1===L.child0&&-1===L.child1){R(L.minComponentIndexIndex,L.maxComponentIndexIndex);break}else if(R(L.minMidComponentIndexIndex,L.maxMidComponentIndexIndex),M=n.dot(M,F)-M[3],0>M){if(-1===L.child0){R(L.minComponentIndexIndex,L.minMidComponentIndexIndex);break}L=L.child0}else if(0<M){if(-1===L.child1){R(L.maxMidComponentIndexIndex,L.maxComponentIndexIndex);break}L=L.child1}else break;else{const O=z;n.sub(O,M,F);n.normalize(O,O);
const T=this._componentBspNodes,Q=V=>{V=T[V];var U=V.plane;if(!U||-1===V.child0&&-1===V.child1)R(V.minComponentIndexIndex,V.maxComponentIndexIndex);else{const W=n.dot(U,F)-U[3];U=n.dot(U,O);V.minComponentIndexIndex<V.minMidComponentIndexIndex&&(0>=W||0>U)&&(-1!==V.child0?Q(V.child0):R(V.minComponentIndexIndex,V.minMidComponentIndexIndex));R(V.minMidComponentIndexIndex,V.maxMidComponentIndexIndex);V.maxMidComponentIndexIndex<V.maxComponentIndexIndex&&(0<=W||0<U)&&(-1!==V.child1?Q(V.child1):R(V.maxMidComponentIndexIndex,
V.maxComponentIndexIndex))}};Q(0)}}}_generateComponentBspRoot(){const K=this._components.count,L=new Uint16Array(K);this._componentIndicesForBsp=L;for(var F=0;F<K;++F)L[F]=F;const M=this._ensureComponentAabbs(),S=this._planetCenter,N=this._planetNorth;F=H;n.negate(F,S);n.normalize(F,F);n.cross(J,N,F);var P=this._aabb;F=P[2];const R=[];let O=0;const T=this._componentBspNodes;T.length=0;const Q=(X,ba)=>{X*=6;var ia=M[X],fa=M[X+1],da=M[X+2];const aa=M[X+3],ea=M[X+4],ha=M[X+5];X=n.set(B,.5*(ia+aa),.5*
(fa+ea),.5*(da+ha));ia=.5*(aa-ia);fa=.5*(ea-fa);da=.5*(ha-da);da=Math.sqrt(ia*ia+fa*fa+da*da);fa=ba[3];ba=n.dot(ba,X)-fa;return Math.abs(ba)>da?Math.sign(ba):0},V=(X,ba,ia)=>{let fa=Infinity,da=Infinity,aa=Infinity,ea=-Infinity,ha=-Infinity,Y=-Infinity;for(;ba<ia;++ba){const Z=6*L[ba];fa=Math.min(fa,M[Z]);ea=Math.max(ea,M[Z+3]);da=Math.min(da,M[Z+1]);ha=Math.max(ha,M[Z+4]);aa=Math.min(aa,M[Z+2]);Y=Math.max(Y,M[Z+5])}X[0]=fa;X[1]=da;X[2]=aa;X[3]=ea;X[4]=ha;X[5]=Y},U=this.viewingMode===d.ViewingMode.Local;
let W=!1;U||(P=n.set(B,.5*(P[0]+P[3]),.5*(P[1]+P[4]),.5*(P[2]+P[5])),P=n.dist(S,P),W=F>.5*P);const ca=(X,ba,ia,fa,da)=>{const aa=T.length;if(W||10<=ia||5>ba-X)var ea=new w(X,ba,ba,ba,null);else{V(q,X,ba);var ha=q[0],Y=q[1],Z=q[2];const ja=q[3],oa=q[4],qa=ja-ha,ta=oa-Y;ea=k.create();if(U)qa>=ta?(n.set(ea,1,0,0),ea[3]=-.5*(ha+ja)):(n.set(ea,0,1,0),ea[3]=-.5*(Y+oa));else{const ma=E,wa=I;n.set(ma,.5*(ha+ja),.5*(Y+oa),Z);n.sub(ma,ma,S);n.normalize(ma,ma);n.cross(wa,ma,N);n.normalize(wa,wa);qa>=ta?n.copy(ea,
wa):(n.cross(ea,wa,ma),n.normalize(ea,ea));ea[3]=n.dot(ea,S)}let va,Ca;Y=X;for(ha=ba;Y<ha;)Z=L[Y],0>Q(Z,ea)?++Y:(--ha,L[Y]=L[ha],L[ha]=Z);va=Y;for(ha=ba;Y<ha;)Z=L[ha-1],0<Q(Z,ea)?--ha:(L[ha-1]=L[Y],L[Y]=Z,++Y);Ca=ha;ea=new w(X,va,Ca,ba,ea);va>=X+5&&R.push(()=>ca(X,va,ia+1,aa,!0));ba>=Ca+5&&R.push(()=>ca(Ca,ba,ia+1,aa,!1))}T.push(ea);-1!==fa&&(fa=T[fa],da?fa.child0=aa:fa.child1=aa)};for(R.push(()=>ca(0,K,0,-1,!1));O<R.length;)(0,R[O])(),++O}_computePerComponentAabbs(){const K=this._components.count,
L=g.newFloatArray(6*K),F=this._indices,M=this._positions,S=this._components.offsets;let N=0,P=Infinity,R=Infinity,O=Infinity,T=-Infinity,Q=-Infinity,V=-Infinity;for(let ca=0;ca<K;ca++){var U=S[ca];const X=S[ca+1];let ba=Infinity,ia=Infinity,fa=Infinity,da=-Infinity,aa=-Infinity,ea=-Infinity;for(;U<X;U++){var W=3*F[U];const ha=M[W],Y=M[W+1];W=M[W+2];ba=Math.min(ba,ha);ia=Math.min(ia,Y);fa=Math.min(fa,W);da=Math.max(da,ha);aa=Math.max(aa,Y);ea=Math.max(ea,W)}L[N++]=ba;L[N++]=ia;L[N++]=fa;L[N++]=da;
L[N++]=aa;L[N++]=ea;P=Math.min(P,ba);R=Math.min(R,ia);O=Math.min(O,fa);T=Math.max(T,da);Q=Math.max(Q,aa);V=Math.max(V,ea)}this._aabb[0]=P;this._aabb[1]=R;this._aabb[2]=O;this._aabb[3]=T;this._aabb[4]=Q;this._aabb[5]=V;return L}get positions(){return this._positions}get indices(){return this._indices}get aabb(){this._ensureComponentAabbs();return this._aabb}}class w{constructor(K,L,F,M,S){this.minComponentIndexIndex=K;this.minMidComponentIndexIndex=L;this.maxMidComponentIndexIndex=F;this.maxComponentIndexIndex=
M;this.plane=S;this.child1=this.child0=-1}}const p=h.create(),t=m.create(),q=[0,0,0,0,0,0],u=h.create(),v=h.create(),y=b.create(),D=b.create(),G=h.create(),A=h.create(),C=h.create(),E=h.create(),I=h.create(),H=h.create(),J=h.create(),B=h.create(),z=h.create();return x})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports","../../../../core/arrayUtils"],function(a,b){function n(h=!0){return{isVisibleBit:!h,data:new Uint32Array(0)}}a.defaultVisibilities=n;a.getVisibility=function(h,
k){if(null==h)return!0;const {isVisibleBit:m,data:g}=h,e=8*g.BYTES_PER_ELEMENT;return k<g.length*e?(h=k/e|0,0!==(g[h]&1<<k-h*e)===m):!h.isVisibleBit};a.updateVisibilityWithCount=function(h,k,m,g){if(m>=k)return h;null==h&&(h=n());let e=h.data;const d=8*e.BYTES_PER_ELEMENT,c=m/d|0,l=m-d*c,f=e;g=g===h.isVisibleBit;m<f.length*d||!g||(m=Math.max(c+1,Math.ceil(f.length*b.reallocGrowthFactor)),m=Math.min(m,((k-1)/d|0)+1),e=new Uint32Array(m),e.set(f));c<e.length&&(e[c]=e[c]&~(1<<l)|(g?1:0)<<l);h.data=e;
return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){class b{constructor(n,h,k){this.material=n;this.geometry=h;this.meta=k}destroy(){this.material.dispose();this.geometry.dispose()}}a.Renderable=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(a){class b{constructor(n,
h,k,m){this.vao=n;this.primitiveType=h;this.parameters=k;this.indexed=m}dispose(){this.vao.dispose()}}a.RenderGeometry=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){class n{constructor(h){this._objects=h}submit(h,k){this._objects.preSubmit(k);this._objects.visibleObjects.forAll(m=>m.renderable.material.submit(h,k,m))}queryShadowCasterDepthRange(h){return this._objects.visibleObjects.length?
b.computeDepthRange(h,this._objects.visibleObjects):null}}a.RenderSubmitSystem=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/quat ../../../../../core/libs/gl-matrix-2/factories/quatf64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../geometry/support/plane ../../lib/depthRange".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(H,J,B){return g.set(H,J.data[B],J.data[B+1],J.data[B+2])}function f(H,J){H.push(J[0]);H.push(J[1]);H.push(J[2])}function r(H,J,B,z){k.conjugate(D,H.quaternion);g.sub(G,J,H.center);g.transformQuat(G,G,D);J=H.halfSize;const K=8*((G[0]<-J[0]?-1:G[0]>J[0]?1:0)+3*(G[1]<-J[1]?-1:G[1]>J[1]?1:0)+9*(G[2]<-J[2]?-1:G[2]>J[2]?1:0)+13);J=v[K];if(0===J)return J;n.fromQuat(y,H.quaternion);n.scale(y,y,H.halfSize);const L=(F,M)=>{M=v[K+M+1];g.set(F,((M&1)<<1)-1,(M&2)-1,((M&
4)>>1)-1);g.transformMat3(F,F,y);return g.add(F,H.center,F)};B.length=0;f(B,L(A,0));f(B,L(C,1));f(B,L(G,2));f(B,L(E,3));z(B);if(1===J)return J;B.length=0;f(B,A);f(B,E);f(B,L(G,4));f(B,L(I,5));z(B);if(2===J)return J;B.length=0;f(B,A);f(B,I);f(B,L(G,6));f(B,C);z(B);return J}const x=new b({allocator:H=>H||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:H=>{H.object=null;return H}}),w=c.empty(),p=e.create(),t=e.create(),q=new b({deallocator:null}),u=new b({deallocator:null}),v=(()=>{const H=
Array(216);let J=0;const B=z=>{for(let K=0;K<z.length;K++)H[J+K]=z[K];J+=8};B([3,0,6,2,3,1,5,4]);B([2,0,2,3,1,5,4,0]);B([3,1,0,2,3,7,5,4]);B([2,0,1,3,2,6,4,0]);B([1,0,1,3,2,0,0,0]);B([2,1,5,7,3,2,0,0]);B([3,2,0,1,3,7,6,4]);B([2,2,0,1,3,7,6,0]);B([3,3,0,1,5,7,6,2]);B([2,0,1,5,4,6,2,0]);B([1,0,1,5,4,0,0,0]);B([2,1,3,7,5,4,0,0]);B([1,0,2,6,4,0,0,0]);B([0,0,0,0,0,0,0,0]);B([1,1,3,7,5,0,0,0]);B([2,2,3,7,6,4,0,0]);B([1,2,3,7,6,0,0,0]);B([2,3,1,5,7,6,2,0]);B([3,4,0,1,5,7,6,2]);B([2,5,7,6,4,0,1,0]);B([3,
5,0,1,3,7,6,4]);B([2,4,5,7,6,2,0,0]);B([1,4,5,7,6,0,0,0]);B([2,5,1,3,7,6,4,0]);B([3,6,0,2,3,7,5,4]);B([2,6,2,3,7,5,4,0]);B([3,7,6,2,3,1,5,4]);return H})(),y=h.create(),D=m.create(),G=e.create(),A=e.create(),C=e.create(),E=e.create(),I=e.create();a.computeDepthRange=function(H,J){const B=c.empty(),{eye:z,frustum:K,viewForward:L}=H;J.forAll(F=>{var M=null!=F.offsetObb?F.offsetObb:F.obb;const S=g.dot(g.sub(G,M.center,z),L),N=M.projectedRadius(L);if(!c.within(B,S-N)||!c.within(B,S+N)){a:{var P=0;for(let R=
0;4>R;R++){const O=M.intersectPlane(K[R]);if(0<O){M=-1;break a}0===O&&(P|=1<<R)}M=P}-1!==M&&(0===M?(w.far=S+N,w.near=S-N,c.union(B,w)):(P=x.pushNew(),P.near=S-N,P.far=S+N,P.mask=M,P.object=F))}});for(H=0;H<x.length;H++){const F=x.data[H];c.within(B,F.near)&&c.within(B,F.far)||(w.far=F.far,w.near=Infinity,0===r(null!=F.object.offsetObb?F.object.offsetObb:F.object.obb,z,q,M=>{var S=u;for(var N=0;4>N&&0<M.length;N++){if(0===(F.mask&1<<N))continue;var P=K[N],R=M,O=S;O.length=0;const T=R.length-3;l(p,
R,T);const Q=d.signedDistance(P,p);0>=Q&&(O.push(p[0]),O.push(p[1]),O.push(p[2]));let V=0,U=Q;for(V;V<T;V+=3){l(t,R,V);const W=d.signedDistance(P,t);0>U*W&&(g.lerp(p,t,p,W/(W-U)),f(O,p));0>=W&&f(O,t);U=W;g.copy(p,t)}0>U*Q&&(l(t,R,T),g.lerp(p,t,p,Q/(Q-U)),f(O,p));P=M;M=S;S=P}for(S=0;S<M.length;S+=3)g.set(p,M.data[S],M.data[S+1],M.data[S+2]),N=g.dot(g.sub(p,p,z),L),w.near=Math.min(w.near,N)})&&(w.near=0),c.union(B,w))}x.length=0;return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(k,m){return{near:k,far:m}}function n(k,m,g){k.near=m;k.far=g;return k}class h{constructor(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE}}a.DepthRange=h;a.create=b;a.empty=function(k){return k?n(k,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=n;a.union=function(k,m){null!=m&&(k.near=Math.min(k.near,m.near),k.far=Math.max(k.far,m.far))};a.within=function(k,m){return k.near<=m&&m<=k.far};a.zero=
{near:0,far:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,n,h){a.createVertexBufferLayout=function(k){const m=b.newLayout().vec3f(h.VertexAttribute.POSITION);k.hasNormals&&m.vec2i16(h.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});
k.textureCoordinates===n.TextureCoordinateAttributeType.Default?m.vec2f(h.VertexAttribute.UV0):k.textureCoordinates===n.TextureCoordinateAttributeType.Atlas&&(m.vec2f(h.VertexAttribute.UV0),m.vec4u16(h.VertexAttribute.UVREGION,{glNormalized:!0}));k.colors&&m.vec4u8(h.VertexAttribute.COLOR,{glNormalized:!0});return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec4f64",
"../../../layers/support/symbolColorUtils"],function(a,b,n){class h{constructor(){this.externalColor=b.create();this.externalColorMixMode=n.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0}}a.UniformComponentParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/tslib.es6 ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../../chunks/vec32 ../../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../../chunks/vec42 ../../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../terrain/OverlayContent ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType ../../../materials/pbrUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H){class J extends t.MaterialBase{constructor(F,M){super();this.toMapSpace=M;this.baseColor=c.fromValues(1,1,1,1);this.hasParametersFromSource=this.usePBR=!1;this.mrrFactors=e.fromArray(H.defaultAdvancedMRRFactors);this.emissiveFactor=e.fromValues(0,0,0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null;this.objectOpacity=1;this.commonMaterialParameters=new z;this.componentParameters=
new K;this.textureAlphaCutoff=G.defaultMaskAlphaCutoff;this.alphaDiscardMode=E.AlphaDiscardMode.Opaque;this.polygonOffsetEnabled=this.isIntegratedMesh=!1;this.ellipsoidMode=A.EllipsoidMode.Earth;this.hasOccludees=!1;this._techniqueConfiguration=new x.ComponentTechniqueConfiguration;M=new C.TwoVectorPosition(F.position);const S=m.clone(F.rotationScale);k.invert(S,S);k.transpose(S,S);this.transformNormalGlobalFromModel=S;this.transformWorldFromModelTL=M.low;this.transformWorldFromModelTH=M.high;this.transformWorldFromModelRS=
F.rotationScale}dispose(){this._technique=h.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null}get texture(){return null!=this.baseColorTexture?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return null!=this.metallicRoughnessTexture?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return null!=this.emissionTexture?this.emissionTexture.glTexture:null}get textureOcclusion(){return null!=
this.occlusionTexture?this.occlusionTexture.glTexture:null}get textureNormal(){return null!=this.normalTexture?this.normalTexture.glTexture:null}prepareTechnique(F,M,S,N){const P=this._techniqueConfiguration;P.hasVertexColors=N.colors;P.hasNormals=N.hasNormals;P.textureCoordinateType=N.textureCoordinates;P.hasMetallicRoughnessTexture=null!=this.metallicRoughnessTexture;P.hasEmissionTexture=null!=this.emissionTexture;P.hasOcclusionTexture=null!=this.occlusionTexture;P.hasNormalTexture=null!=this.normalTexture;
P.transparencyPassType=M.identifier===q.RenderPassIdentifier.Material&&null!=S.transparencyPassType?S.transparencyPassType:I.TransparencyPassType.NONE;P.multipassEnabled=M.identifier===q.RenderPassIdentifier.Material&&S.multipassEnabled;P.cullAboveGround=M.identifier===q.RenderPassIdentifier.Material?S.multipassTerrain.cullAboveGround:!1;P.ellipsoidMode=this.ellipsoidMode;P.componentData=this.componentParameters.type;P.cullFace=this.commonMaterialParameters.cullFace;P.doubleSidedMode=this.commonMaterialParameters.doubleSided?
y.NormalsDoubleSidedMode.View:y.NormalsDoubleSidedMode.None;P.hasColorTexture=null!=this.baseColorTexture;const R=this._computeWhichMaterialPass();P.blendingEnabled=R===B.Transparent||R===B.OpaqueAndTransparent;P.alphaDiscardMode=this.alphaDiscardMode;P.integratedMeshMode=this.isIntegratedMesh?null!=S.overlay?.getTexture(f.OverlayContent.ColorNoRasterImage)?null!=S.overlay?.getTexture(f.OverlayContent.WaterNormal)?x.IntegratedMeshMode.ColorOverlayWithWater:x.IntegratedMeshMode.ColorOverlay:x.IntegratedMeshMode.NoOverlay:
x.IntegratedMeshMode.None;P.hasPolygonOffset=this.polygonOffsetEnabled;P.pbrMode=P.integratedMeshMode===x.IntegratedMeshMode.ColorOverlayWithWater?D.PBRMode.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?n("enable-feature:im-shading")&&this.isIntegratedMesh?D.PBRMode.Simplified:D.PBRMode.Schematic:D.PBRMode.Normal:D.PBRMode.Disabled;P.normalType=N.needsNormals?P.hasNormals?v.NormalType.Compressed:v.NormalType.ScreenDerivative:v.NormalType.Ground;P.hasSlicePlane=null!=S.slicePlane&&
this.commonMaterialParameters.hasSlicePlane;if(M.identifier===q.RenderPassIdentifier.ShadowMap)P.output=u.ShaderOutput.Shadow,P.vertexDiscardMode=p.VertexDiscardMode.None;else if(M.identifier===q.RenderPassIdentifier.Highlight)P.output=u.ShaderOutput.Highlight,P.vertexDiscardMode=p.VertexDiscardMode.None;else{P.vertexDiscardMode=R===B.OpaqueAndTransparent?M.transparent?p.VertexDiscardMode.Opaque:p.VertexDiscardMode.Transparent:p.VertexDiscardMode.None;P.output=M.output;P.receiveAmbientOcclusion=!1;
P.receiveShadows=!1;switch(M.output){case u.ShaderOutput.Color:P.receiveAmbientOcclusion=null!=S.ssao;P.hasOccludees=S.hasOccludees;P.receiveShadows=S.shadowMap.ready;P.hasScreenSpaceReflections=null!=S.ssr.lastFrameColor;P.hasCloudsReflections=null!=S.cloudsFade.data;break;case u.ShaderOutput.Alpha:P.hasOccludees=S.hasOccludees;break;case u.ShaderOutput.ObjectAndLayerIdColor:P.objectAndLayerIdColor=!0}P.snowCover=this.hasSnowCover(S)}this._technique=F.releaseAndAcquire(r.ComponentTechnique,P,this._technique);
this._setClean();return this._technique}hasSnowCover(F){return null!=F.weather&&F.weatherVisible&&"snowy"===F.weather.type&&"enabled"===F.weather.snowCover}submit(F,M,S){if(0!==this.objectOpacity){var N=S.renderable.geometry,P=S.components;S=S.renderable.meta.cameraDepthSquared;var R=P.geometryRanges,O=P.highlightRanges;P=P.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case B.Opaque:F.materialOpaque.submitDraw(this,N,R,S);break;case B.Transparent:F.materialTransparent.submitDraw(this,
N,R,S);break;case B.OpaqueAndTransparent:F.materialOpaque.submitDraw(this,N,R,S);F.materialTransparent.submitDraw(this,N,R,S);break;case B.IntegratedMesh:F.materialIntegratedMesh.submitDraw(this,N,R,S),null!=M.overlay?.getTexture(f.OverlayContent.Highlight)&&F.highlightIntegratedMesh.submitDraw(this,N,R,S)}(M=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&F.shadowMap.submitDraw(this,N,R,S);null!=O&&(F.highlight.submitDraw(this,N,O,S),M&&F.highlightShadowMap.submitDraw(this,
N,O,S));M&&null!=P&&F.defaultShadowMap.submitDraw(this,N,P,S)}}_computeWhichMaterialPass(){return this.isIntegratedMesh?B.IntegratedMesh:1>this.objectOpacity?B.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?B.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===E.AlphaDiscardMode.Blend||this.alphaDiscardMode===E.AlphaDiscardMode.MaskBlend?B.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?B.Opaque:this.componentParameters.transparent===
a.ComponentParameterSummary.All?B.Transparent:B.OpaqueAndTransparent}}b.__decorate([t.parameter({vectorOps:d.vec4})],J.prototype,"baseColor",void 0);b.__decorate([t.parameter()],J.prototype,"usePBR",void 0);b.__decorate([t.parameter()],J.prototype,"hasParametersFromSource",void 0);b.__decorate([t.parameter({vectorOps:g.vec3})],J.prototype,"mrrFactors",void 0);b.__decorate([t.parameter({vectorOps:g.vec3})],J.prototype,"emissiveFactor",void 0);b.__decorate([t.parameter({dispose:!0})],J.prototype,"baseColorTexture",
void 0);b.__decorate([t.parameter({dispose:!0})],J.prototype,"metallicRoughnessTexture",void 0);b.__decorate([t.parameter({dispose:!0})],J.prototype,"emissionTexture",void 0);b.__decorate([t.parameter({dispose:!0})],J.prototype,"occlusionTexture",void 0);b.__decorate([t.parameter({dispose:!0})],J.prototype,"normalTexture",void 0);b.__decorate([t.parameter()],J.prototype,"objectOpacity",void 0);b.__decorate([t.parameterBlock()],J.prototype,"commonMaterialParameters",void 0);b.__decorate([t.parameterBlock()],
J.prototype,"componentParameters",void 0);b.__decorate([t.parameter()],J.prototype,"textureAlphaCutoff",void 0);b.__decorate([t.parameter()],J.prototype,"alphaDiscardMode",void 0);b.__decorate([t.parameter()],J.prototype,"isIntegratedMesh",void 0);b.__decorate([t.parameter()],J.prototype,"polygonOffsetEnabled",void 0);b.__decorate([t.parameter()],J.prototype,"ellipsoidMode",void 0);b.__decorate([t.parameter()],J.prototype,"hasOccludees",void 0);var B;(function(F){F[F.Opaque=0]="Opaque";F[F.Transparent=
1]="Transparent";F[F.OpaqueAndTransparent=2]="OpaqueAndTransparent";F[F.IntegratedMesh=3]="IntegratedMesh"})(B||={});class z extends t.MaterialParameterBlock{constructor(){super(...arguments);this.doubleSided=!1;this.cullFace=E.CullFaceOptions.Back;this.hasSlicePlane=!0}}b.__decorate([t.parameter()],z.prototype,"doubleSided",void 0);b.__decorate([t.parameter()],z.prototype,"cullFace",void 0);b.__decorate([t.parameter()],z.prototype,"hasSlicePlane",void 0);class K extends t.MaterialParameterBlock{constructor(){super(...arguments);
this.externalColor=c.fromValues(1,1,1,1);this.externalColorMixMode=l.ColorMixModeEnum.Multiply;this.castShadows=a.ComponentParameterSummary.All}get transparent(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get opaqueOverride(){return this.externalColorMixMode===l.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}get visible(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:
a.ComponentParameterSummary.None}get type(){return w.ComponentDataType.Uniform}}b.__decorate([t.parameter({vectorOps:d.vec4})],K.prototype,"externalColor",void 0);b.__decorate([t.parameter()],K.prototype,"externalColorMixMode",void 0);b.__decorate([t.parameter()],K.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(F){F[F.All=0]="All";F[F.Some=1]="Some";F[F.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));class L extends t.MaterialParameterBlock{constructor(){super(...arguments);
this.texture=null;this.castShadows=this.opaqueOverride=this.transparent=a.ComponentParameterSummary.None}get type(){return w.ComponentDataType.Varying}}b.__decorate([t.parameter()],L.prototype,"texture",void 0);b.__decorate([t.parameter()],L.prototype,"transparent",void 0);b.__decorate([t.parameter()],L.prototype,"opaqueOverride",void 0);b.__decorate([t.parameter()],L.prototype,"castShadows",void 0);a.CommonMaterialParameters=z;a.ComponentMaterial=J;a.ComponentParametersUniform=K;a.ComponentParametersVarying=
L;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){class p extends e.ShaderTechnique{initializeConfiguration(q,u){u.spherical=q.viewingMode===n.ViewingMode.Global;u.doublePrecisionRequiresObfuscation=q.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(q){return new l.Program(q.rctx,p.shader.get().build(this.configuration),t)}_setPipelineState(q){const u=this.configuration,v=u.integratedMeshMode!==h.IntegratedMeshMode.None,y=q===r.TransparencyPassType.NONE,D=q===r.TransparencyPassType.FrontFace;
return w.makePipelineState({blending:u.output!==m.ShaderOutput.Color&&u.output!==m.ShaderOutput.Alpha||!u.blendingEnabled?null:y?c.blendingDefault:c.oitBlending(q),culling:w.cullingParams(u.cullFace),depthTest:{func:c.oitDepthTest(q)},depthWrite:y||D?w.defaultDepthWriteParams:null,colorWrite:w.defaultColorWriteParams,stencilWrite:v||u.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:v?f.replaceBitWhenDepthTestPasses(d.StencilBits.IntegratedMeshMaskExcluded):u.hasOccludees?f.stencilBaseAllZerosParams:
null,polygonOffset:y||D?u.hasPolygonOffset?{factor:2,units:2}:null:c.OITPolygonOffset})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}p.shader=new g.ReloadableShaderModule(k.ComponentShader,()=>new Promise((q,u)=>a(["./shader/ComponentShader.glsl"],q,u)));const t=new Map([[x.VertexAttribute.POSITION,0],[x.VertexAttribute.NORMAL,1],[x.VertexAttribute.NORMALCOMPRESSED,1],[x.VertexAttribute.COLOR,2],[x.VertexAttribute.UV0,3],[x.VertexAttribute.UVREGION,
4],[x.VertexAttribute.COMPONENTINDEX,5]]);b.ComponentTechnique=p;b.attributeLocations=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){a.IntegratedMeshMode=void 0;(function(p){p[p.None=0]="None";p[p.NoOverlay=1]="NoOverlay";p[p.ColorOverlay=2]="ColorOverlay";p[p.ColorOverlayWithWater=3]="ColorOverlayWithWater";p[p.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));class w extends f.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.output=k.ShaderOutput.Color;this.textureCoordinateType=g.TextureCoordinateAttributeType.None;this.componentData=n.ComponentDataType.Uniform;
this.cullFace=r.CullFaceOptions.Back;this.vertexDiscardMode=h.VertexDiscardMode.None;this.doubleSidedMode=e.NormalsDoubleSidedMode.WindingOrder;this.alphaDiscardMode=r.AlphaDiscardMode.Opaque;this.integratedMeshMode=a.IntegratedMeshMode.None;this.transparencyPassType=x.TransparencyPassType.NONE;this.ellipsoidMode=c.EllipsoidMode.Earth;this.pbrMode=d.PBRMode.Disabled;this.normalType=m.NormalType.Attribute;this.hasColorTexture=this.hasSlicePlane=this.hasNormals=this.hasVertexColors=this.doublePrecisionRequiresObfuscation=
this.spherical=!1;this.blendingEnabled=this.receiveShadows=this.receiveAmbientOcclusion=!0;this.hasNormalTextureTransform=this.cullAboveGround=this.multipassEnabled=this.hasOccludees=this.hasNormalTexture=this.hasOcclusionTexture=this.hasEmissionTexture=this.hasMetallicRoughnessTexture=this.hasPolygonOffset=this.hasScreenSpaceReflections=!1;this.hasCloudsReflections=!0;this.objectAndLayerIdColor=this.snowCover=!1}}b.__decorate([f.parameter({count:k.ShaderOutput.COUNT})],w.prototype,"output",void 0);
b.__decorate([f.parameter({count:g.TextureCoordinateAttributeType.COUNT})],w.prototype,"textureCoordinateType",void 0);b.__decorate([f.parameter({count:n.ComponentDataType.COUNT})],w.prototype,"componentData",void 0);b.__decorate([f.parameter({count:r.CullFaceOptions.COUNT})],w.prototype,"cullFace",void 0);b.__decorate([f.parameter({count:h.VertexDiscardMode.COUNT})],w.prototype,"vertexDiscardMode",void 0);b.__decorate([f.parameter({count:e.NormalsDoubleSidedMode.COUNT})],w.prototype,"doubleSidedMode",
void 0);b.__decorate([f.parameter({count:r.AlphaDiscardMode.COUNT})],w.prototype,"alphaDiscardMode",void 0);b.__decorate([f.parameter({count:a.IntegratedMeshMode.COUNT})],w.prototype,"integratedMeshMode",void 0);b.__decorate([f.parameter({count:x.TransparencyPassType.COUNT})],w.prototype,"transparencyPassType",void 0);b.__decorate([f.parameter({count:c.EllipsoidMode.COUNT})],w.prototype,"ellipsoidMode",void 0);b.__decorate([f.parameter({count:d.PBRMode.COUNT})],w.prototype,"pbrMode",void 0);b.__decorate([f.parameter({count:m.NormalType.COUNT})],
w.prototype,"normalType",void 0);b.__decorate([f.parameter()],w.prototype,"spherical",void 0);b.__decorate([f.parameter()],w.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([f.parameter()],w.prototype,"hasVertexColors",void 0);b.__decorate([f.parameter()],w.prototype,"hasNormals",void 0);b.__decorate([f.parameter()],w.prototype,"hasSlicePlane",void 0);b.__decorate([f.parameter()],w.prototype,"hasColorTexture",void 0);b.__decorate([f.parameter()],w.prototype,"receiveAmbientOcclusion",
void 0);b.__decorate([f.parameter()],w.prototype,"receiveShadows",void 0);b.__decorate([f.parameter()],w.prototype,"blendingEnabled",void 0);b.__decorate([f.parameter()],w.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([f.parameter()],w.prototype,"hasPolygonOffset",void 0);b.__decorate([f.parameter()],w.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([f.parameter()],w.prototype,"hasEmissionTexture",void 0);b.__decorate([f.parameter()],w.prototype,"hasOcclusionTexture",void 0);
b.__decorate([f.parameter()],w.prototype,"hasNormalTexture",void 0);b.__decorate([f.parameter()],w.prototype,"hasOccludees",void 0);b.__decorate([f.parameter()],w.prototype,"multipassEnabled",void 0);b.__decorate([f.parameter()],w.prototype,"cullAboveGround",void 0);b.__decorate([f.parameter()],w.prototype,"hasNormalTextureTransform",void 0);b.__decorate([f.parameter()],w.prototype,"hasCloudsReflections",void 0);b.__decorate([f.parameter()],w.prototype,"snowCover",void 0);b.__decorate([f.parameter()],
w.prototype,"objectAndLayerIdColor",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"occlusionPass",void 0);b.__decorate([f.parameter({constValue:l.BindType.Draw})],w.prototype,"pbrTextureBindType",void 0);b.__decorate([f.parameter({constValue:!0})],w.prototype,"hasSliceHighlight",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([f.parameter({constValue:!1})],
w.prototype,"hasVertexTangents",void 0);b.__decorate([f.parameter({constValue:!0})],w.prototype,"supportsTextureAtlas",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"highStepCount",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"instancedDoublePrecision",void 0);b.__decorate([f.parameter({constValue:!1})],w.prototype,"hasModelTransformation",void 0);b.__decorate([f.parameter({constValue:!0})],w.prototype,"useFillLights",void 0);b.__decorate([f.parameter({constValue:!1})],
w.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(p,t){const {vertex:q,fragment:u}=p;q.include(g.RgbaFloatEncoding);q.uniforms.add(new l.Texture2DDrawUniform("componentColorTex",v=>v.componentParameters.texture.texture));p.attributes.add(f.VertexAttribute.COMPONENTINDEX,"float");p.varyings.add("vExternalColorMixMode","mediump float");p.varyings.add("vExternalColor","vec4");(t=t.output===m.ShaderOutput.ObjectAndLayerIdColor)&&p.varyings.add("vObjectAndLayerIdColor","vec4");p.include(k.DecodeSymbolColor);
q.constants.add("elevationScale","float",2*w);q.constants.add("stride","float",h("enable-feature:objectAndLayerId-rendering")?3:2);q.code.add(c.glsl`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`);q.code.add(c.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${t?c.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:c.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);u.code.add(c.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${t?c.glsl`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function x(p,t){const {vertex:q,fragment:u}=p;q.uniforms.add(new e.Float4DrawUniform("externalColor",v=>v.componentParameters.externalColor));u.uniforms.add(new d.IntegerDrawUniform("externalColorMixMode",v=>v.componentParameters.externalColorMixMode));p.varyings.add("vExternalColor","vec4");q.code.add(c.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);u.code.add(c.glsl`
  void readExternalColor(out vec4 color, out int colorMixMode) {
    color = vExternalColor;
    colorMixMode = externalColorMixMode;
  }

  void outputObjectAndLayerIdColor() {
    ${t.output===m.ShaderOutput.ObjectAndLayerIdColor?c.glsl`fragColor = vec4(0,0,0,0);`:""}
 }
`)}a.ComponentDataType=void 0;(function(p){p[p.Uniform=0]="Uniform";p[p.Varying=1]="Varying";p[p.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const w=2**32/1E4;a.ComponentData=function(p,t){switch(t.componentData){case a.ComponentDataType.Varying:return r(p,t);case a.ComponentDataType.Uniform:return x(p,t);case a.ComponentDataType.COUNT:break;default:b.neverReached(t.componentData)}};a.encodeElevationOffset=function(p,t){n.packFloatRGBA(p/w*.5+.5,t)};a.maxElevationOffset=w;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","./Uniform","../shaderTechnique/BindType"],function(a,b,n){class h extends b.Uniform{constructor(k,m){super(k,"int",n.BindType.Draw,(g,e,d)=>g.setUniform1i(k,m(e,d)))}}a.IntegerDrawUniform=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../../../../core/compilerUtils","../../../../core/shaderModules/interfaces"],function(a,b,n){a.VertexDiscardMode=void 0;(function(h){h[h.None=0]="None";h[h.Transparent=1]="Transparent";h[h.Opaque=2]="Opaque";h[h.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(h,k){h=h.vertex;h.code.add(n.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(k.vertexDiscardMode){case a.VertexDiscardMode.None:h.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);
break;case a.VertexDiscardMode.Opaque:h.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.Transparent:h.code.add(n.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case a.VertexDiscardMode.COUNT:break;default:b.neverReached(k.vertexDiscardMode)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(n){n[n.Earth=1]="Earth";n[n.Mars=2]="Mars";n[n.Moon=3]="Moon";n[n.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(n){return n&&b.isMars(n)?a.EllipsoidMode.Mars:n&&b.isMoon(n)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/OverlayContent ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F){function M(N){const P=new K.ShaderBuilder;P.include(x.VertexPosition,N);P.include(r.VertexNormal,N);P.include(f.VertexColor,N);P.include(l.TextureCoordinateAttribute,N);P.include(g.ForwardLinearDepth,N);P.include(k.ComponentData,N);P.include(J.DiscardOrAdjustAlphaDraw,N);P.include(d.SlicePass,N);P.include(C.ReadBaseColorTexture,N);P.include(m.VertexDiscardByOpacity,N);const {vertex:R,fragment:O}=P;if(N.pbrMode===A.PBRMode.Normal||
N.pbrMode===A.PBRMode.Schematic)P.include(A.PhysicallyBasedRenderingParameters,N),N.hasNormalTexture&&P.include(u.ComputeNormalTexture,N);const T=N.output===e.ShaderOutput.Shadow||N.output===e.ShaderOutput.ShadowHighlight||N.output===e.ShaderOutput.ShadowExcludeHighlight;T&&N.componentData===k.ComponentDataType.Varying?R.code.add(z.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):R.code.add(z.glsl`#define discardShadows(castShadows) {}`);
const Q=N.integratedMeshMode===h.IntegratedMeshMode.ColorOverlay||N.integratedMeshMode===h.IntegratedMeshMode.ColorOverlayWithWater,V=Q&&N.output===e.ShaderOutput.Color&&N.pbrMode===A.PBRMode.WaterOnIntegratedMesh;Q&&(P.include(y.EvaluateSceneLighting,N),P.include(I.OverlayIM,N),N.spherical?R.code.add(z.glsl`
      const float invEllipsoidRadius = ${z.glsl.float(1/(N.ellipsoidMode===B.EllipsoidMode.Earth?b.earth.radius:N.ellipsoidMode===B.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):R.code.add(z.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));V&&(P.varyings.add("tbnTangent","vec3"),P.varyings.add("tbnBiTangent","vec3"),P.varyings.add("groundNormal","vec3"));R.code.add(z.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${N.output===e.ShaderOutput.ObjectAndLayerIdColor?z.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${z.glsl.float(H.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${N.output===e.ShaderOutput.ObjectAndLayerIdColor?z.glsl`forwardObjectAndLayerIdColor();`:""}
      ${V?N.spherical?z.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:z.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${Q?z.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);N.output===e.ShaderOutput.Alpha&&(O.include(t.ReadLinearDepth),P.include(G.multipassTerrainTest,N),P.include(q.ComputeMaterialColor,N),Q&&O.uniforms.add(new L.Texture2DPassUniform("ovColorTex",(U,W)=>I.getIMColorTexture(U,W))),O.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${N.multipassEnabled?z.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Q?z.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `));N.output===e.ShaderOutput.Color&&(O.include(t.ReadLinearDepth),P.include(G.multipassTerrainTest,N),P.include(q.ComputeMaterialColor,N),P.include(v.ComputeShadingNormal,N),P.include(y.EvaluateSceneLighting,N),N.receiveShadows?(P.include(E.ReadShadowMapPass,N),O.code.add(z.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):O.code.add(z.glsl`float evaluateShadow() { return 0.0; }`),Q&&O.uniforms.add(new L.Texture2DPassUniform("ovColorTex",(U,W)=>I.getIMColorTexture(U,W))),O.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${N.multipassEnabled?z.glsl`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Q?z.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),N.pbrMode===A.PBRMode.Normal||N.pbrMode===A.PBRMode.Schematic||N.pbrMode===A.PBRMode.Simplified?(D.addMainLightIntensity(O),O.code.add(z.glsl`
        ${N.pbrMode===A.PBRMode.Normal?z.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),N.hasNormalTexture?O.code.add(z.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):O.code.add(z.glsl`vec3 shadingNormal = normalVertex;`),O.code.add(z.glsl`${N.spherical?z.glsl`vec3 normalGround = normalize(positionWorld());`:z.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),O.code.add(z.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        ${N.pbrMode===A.PBRMode.Simplified?z.glsl` float ssao = 1.0 - evaluateAmbientOcclusionInverse();`:z.glsl` float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();`}
        ${N.snowCover?z.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1.1), snow);
                ssao = mix(ssao, 0.5 * ssao, snow);
                shadingNormal = mix(shadingNormal, surfaceNormal, snow);`:""}

        ${Q?z.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        ${N.pbrMode===A.PBRMode.Simplified?z.glsl` vec4 shadedColor = vec4(evaluatePBRSimplifiedLighting(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround), materialColor.a);`:"vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);"}
        `)):(N.receiveShadows?O.code.add(z.glsl`float shadow = evaluateShadow();`):N.spherical?(y.addLightingGlobalFactor(O),O.code.add(z.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):O.code.add(z.glsl`float shadow = 0.0;`),V&&O.uniforms.add(new L.Texture2DPassUniform("ovNormalTex",(U,W)=>W.overlay?.getTexture(n.OverlayContent.WaterNormal))),N.snowCover&&O.code.add(z.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),O.code.add(z.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${Q?z.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${V?z.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),O.code.add(z.glsl`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${N.transparencyPassType===F.TransparencyPassType.Color?"fragColor \x3d premultiplyAlpha(fragColor);":""}
      }
    `));if(N.output===e.ShaderOutput.LinearDepth||T)P.include(w.OutputDepth,N),O.code.add(z.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);N.output===e.ShaderOutput.Normal&&(P.include(v.ComputeShadingNormal,N),O.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${N.normalType===c.NormalType.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));N.output===e.ShaderOutput.ObjectAndLayerIdColor&&P.fragment.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Q?z.glsl`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);N.output===e.ShaderOutput.Highlight&&(P.include(p.OutputHighlight),O.code.add(z.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Q?z.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return P}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=S;a.build=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(a,b,n,h,k,m){a.ComputeMaterialColor=function(g,
e){g.include(b.VertexColor,e);g.fragment.include(n.MixExternalColor);g=g.fragment;g.uniforms.add(new h.Float4DrawUniform("baseColor",d=>d.baseColor));g.uniforms.add(new k.FloatDrawUniform("objectOpacity",d=>d.objectOpacity));e.hasVertexColors?g.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):g.code.add(m.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);g.code.add(m.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,n,h,k,m,g){a.ComputeShadingNormal=function(e,d){const c=e.fragment;switch(d.doubleSidedMode){case m.NormalsDoubleSidedMode.None:c.code.add(g.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case m.NormalsDoubleSidedMode.View:e.include(k.VertexPosition,d);c.code.add(g.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case m.NormalsDoubleSidedMode.WindingOrder:c.code.add(g.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(d.doubleSidedMode);case m.NormalsDoubleSidedMode.COUNT:}switch(d.normalType){case n.NormalType.Attribute:case n.NormalType.Compressed:e.include(h.VertexNormal,d);c.code.add(g.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case n.NormalType.ScreenDerivative:e.include(k.VertexPosition,d);c.code.add(g.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case n.NormalType.Ground:d.spherical?(e.include(k.VertexPosition,d),c.code.add(g.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):c.code.add(g.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);c.code.add(g.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(d.normalType);case n.NormalType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../../lib/basicInterfaces".split(" "),function(a,
b,n,h,k,m,g,e){a.ReadBaseColorTexture=function(d,c){const l=d.fragment;!c.hasColorTexture||c.output!==b.ShaderOutput.Color&&c.alphaDiscardMode===e.AlphaDiscardMode.Opaque?l.code.add(m.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`):(d.include(h.VertexTextureCoordinates,c),c=c.textureCoordinateType===n.TextureCoordinateAttributeType.Atlas,l.uniforms.add(new g.Texture2DDrawUniform("baseColorTexture",f=>f.texture)),c?(d.include(k.TextureAtlasLookup),l.code.add(m.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):l.code.add(m.glsl`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../shaderModules/interfaces"],function(a,b){class n extends b.NoParameters{constructor(){super(...arguments);this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1;if(null!=this._parameterBlocks)for(const k of this._parameterBlocks)this[k]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==
this._parameterBlocks)return!1;for(const k of this._parameterBlocks)if(this[k].dirty)return!0;return!1}}class h{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}a.MaterialBase=n;a.MaterialParameterBlock=h;a.parameter=function(k={}){return(m,g)=>{const e=m._parameterCount??0;m._parameterCount=e+1;if(k.vectorOps){const d=k.vectorOps;Object.defineProperty(m,g,{get(){return this[e]},set(c){const l=this[e];if(null==l)this[e]=c;else{if(d.equals(l,
c))return;d.copy(l,c)}this._setDirty()}})}else Object.defineProperty(m,g,{get(){return this[e]},set(d){this[e]!==d&&(k.dispose&&this[e]&&this[e].dispose(),this[e]=d,this._setDirty())}})}};a.parameterBlock=function(){return(k,m)=>{const g=k._parameterCount??0;k._parameterCount=g+1;k._parameterBlocks=k._parameterBlocks||[];k._parameterBlocks.push(g);Object.defineProperty(k,m,{get(){return this[g]},set(e){this[g]!==e&&(this[g]=e,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(a,b,n,h){class k{constructor(g){this._low=h.create();this._high=h.create();g&&this.set(g)}get low(){return this._low}get high(){return this._high}set(g){b.copy(this._low,b.copy(m,g));g=b.sub(m,g,this._low);b.copy(this._high,g)}get(g){return b.add(g,this._low,this._high)}getLowScaled(g){return b.scale(g,
this._low,1)}}const m=n.create();a.TwoVectorPosition=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,n,h){const k=n.newLayout().vec3f(h.VertexAttribute.POSITION).u16(h.VertexAttribute.COMPONENTINDEX),m=n.newLayout().vec2u8(h.VertexAttribute.SIDENESS);b=b.glLayout(m);const g=n.newLayout().vec3f(h.VertexAttribute.POSITION0).vec3f(h.VertexAttribute.POSITION1).vec2i16(h.VertexAttribute.NORMALCOMPRESSED).u16(h.VertexAttribute.COMPONENTINDEX).u8(h.VertexAttribute.VARIANTOFFSET,
{glNormalized:!0}).u8(h.VertexAttribute.VARIANTSTROKE).u8(h.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});n=n.newLayout().vec3f(h.VertexAttribute.POSITION0).vec3f(h.VertexAttribute.POSITION1).vec2i16(h.VertexAttribute.NORMALCOMPRESSED).vec2i16(h.VertexAttribute.NORMAL2COMPRESSED).u16(h.VertexAttribute.COMPONENTINDEX).u8(h.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(h.VertexAttribute.VARIANTSTROKE).u8(h.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0});h=new Map([[h.VertexAttribute.POSITION0,
0],[h.VertexAttribute.POSITION1,1],[h.VertexAttribute.COMPONENTINDEX,2],[h.VertexAttribute.VARIANTOFFSET,3],[h.VertexAttribute.VARIANTSTROKE,4],[h.VertexAttribute.VARIANTEXTENSION,5],[h.VertexAttribute.NORMALCOMPRESSED,6],[h.VertexAttribute.NORMAL2COMPRESSED,7],[h.VertexAttribute.SIDENESS,8]]);a.EdgeInputBufferLayout=k;a.EdgeShaderAttributeLocations=h;a.RegularEdgeInstancesLayout=g;a.SilhouetteEdgeInstancesLayout=n;a.VertexLayout=m;a.glVertexLayout=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(a,b,n,h,k,m,g,e){function d(r,x,w,p){if(x)return x=n.computeNeighbors(w,p,r.count),new c(w,p,x,r);r=b.deduplicate(r.buffer,r.stride/4,{originalIndices:w,originalIndicesLength:p});p=n.computeNeighbors(r.indices,
p,r.uniqueCount);return{faces:r.indices,facesLength:r.indices.length,neighbors:p,vertices:m.EdgeInputBufferLayout.createView(r.buffer)}}class c{constructor(r,x,w,p){this.faces=r;this.facesLength=x;this.neighbors=w;this.vertices=p}}const l=new g.RegularEdgeBufferWriter,f=new g.SilhouetteEdgeBufferWriter;g=h.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1);h=h.newLayout().vec3f(k.VertexAttribute.POSITION0).vec3f(k.VertexAttribute.POSITION1).u16(k.VertexAttribute.COMPONENTINDEX);
a.extract=function(r){const x=d(r.data,r.skipDeduplicate,r.indices,r.indicesLength);l.updateSettings(r.writerSettings);f.updateSettings(r.writerSettings);return e.extractEdges(x,l,f)};a.extractComponentsEdgeLocationsLayout=h;a.extractEdgeInformation=d;a.extractEdgeLocationsLayout=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,n,h){n/=3;const k=new Uint32Array(h+1),m=new Uint32Array(h+
1);var g=(p,t)=>{p<t?k[p+1]++:m[t+1]++};for(var e=0;e<n;e++){var d=b[3*e],c=b[3*e+1],l=b[3*e+2];g(d,c);g(c,l);g(l,d)}e=g=0;for(d=0;d<h;d++)c=k[d+1],l=m[d+1],k[d+1]=g,m[d+1]=e,g+=c,e+=l;const f=new Uint32Array(6*n),r=k[h];g=(p,t,q)=>{p<t?(p=k[p+1]++,f[2*p]=t,f[2*p+1]=q):(t=m[t+1]++,f[2*r+2*t]=p,f[2*r+2*t+1]=q)};for(e=0;e<n;e++)d=b[3*e],c=b[3*e+1],l=b[3*e+2],g(d,c,e),g(c,l,e),g(l,d,e);g=(p,t)=>{const q=2*p;p=t-p;for(t=1;t<p;t++){const u=f[q+2*t],v=f[q+2*t+1];let y=t-1;for(y;0<=y&&f[q+2*y]>u;y--)f[q+
2*y+2]=f[q+2*y],f[q+2*y+3]=f[q+2*y+1];f[q+2*y+2]=u;f[q+2*y+3]=v}};for(e=0;e<h;e++)g(k[e],k[e+1]),g(r+m[e],r+m[e+1]);const x=new Int32Array(3*n),w=(p,t)=>p===b[3*t]?0:p===b[3*t+1]?1:p===b[3*t+2]?2:-1;n=(p,t)=>{p=w(p,t);x[3*t+p]=-1};g=(p,t,q,u)=>{p=w(p,t);x[3*t+p]=u;q=w(q,u);x[3*u+q]=t};for(e=0;e<h;e++){d=k[e];c=k[e+1];l=m[e];const p=m[e+1];for(;d<c&&l<p;){const t=f[2*d],q=f[2*r+2*l];t===q?(g(e,f[2*d+1],q,f[2*r+2*l+1]),d++,l++):t<q?(n(e,f[2*d+1]),d++):(n(q,f[2*r+2*l+1]),l++)}for(;d<c;)n(e,f[2*d+1]),
d++;for(;l<p;)n(f[2*r+2*l],f[2*r+2*l+1]),l++}return x};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../support/buffer/glUtil ../Normals ./bufferLayouts".split(" "),function(a,b,n,h,k,m,g){function e(u){const v=f;v[0]=u.position0[0];v[1]=u.position0[1];v[2]=u.position0[2];
v[3]=u.position1[0];v[4]=u.position1[1];v[5]=u.position1[2];x[0]=5381;for(u=0;u<r.length;u++)x[0]=31*x[0]+r[u];return x[0]}function d(u){const v=f;v[0]=c(u.position0[0]);v[1]=c(u.position0[1]);v[2]=c(u.position0[2]);v[3]=c(u.position1[0]);v[4]=c(u.position1[1]);v[5]=c(u.position1[2]);x[0]=5381;for(u=0;u<r.length;u++)x[0]=31*x[0]+r[u];return x[0]}function c(u){return Math.round(1E4*u)/1E4}class l{updateSettings(u){this.settings=u;this._edgeHashFunction=u.reducedPrecision?d:e}write(u,v,y){var D=this._edgeHashFunction(y);
q.seed=D;D=q.getIntRange(0,255);const G=q.getIntRange(0,this.settings.variants-1);var A=q.getFloat();A=-(1-Math.min(A/.7,1))+Math.max(0,A-.7)/(1-.7);A=255*(Math.abs(A)**1.2*(0>A?-1:1)*.5+.5);u.position0.setVec(v,y.position0);u.position1.setVec(v,y.position1);u.componentIndex.set(v,y.componentIndex);u.variantOffset.set(v,D);u.variantStroke.set(v,G);u.variantExtension.set(v,A)}trim(u,v){return u.slice(0,v)}}const f=new Float32Array(6),r=new Uint32Array(f.buffer),x=new Uint32Array(1);class w{constructor(){this._commonWriter=
new l}updateSettings(u){this._commonWriter.updateSettings(u)}allocate(u){return g.RegularEdgeInstancesLayout.createBuffer(u)}write(u,v,y){this._commonWriter.write(u,v,y);n.add(t,y.faceNormal0,y.faceNormal1);n.normalize(t,t);const {typedBuffer:D,typedBufferStride:G}=u.normalCompressed;m.compressNormal(D,v,t[0],t[1],t[2],G)}trim(u,v){return this._commonWriter.trim(u,v)}}w.Layout=g.RegularEdgeInstancesLayout;w.glLayout=k.glLayout(g.RegularEdgeInstancesLayout,1);class p{constructor(){this._commonWriter=
new l}updateSettings(u){this._commonWriter.updateSettings(u)}allocate(u){return g.SilhouetteEdgeInstancesLayout.createBuffer(u)}write(u,v,y){this._commonWriter.write(u,v,y);const {typedBuffer:D,typedBufferStride:G}=u.normalCompressed;m.compressNormal(D,v,y.faceNormal0[0],y.faceNormal0[1],y.faceNormal0[2],G);const {typedBuffer:A,typedBufferStride:C}=u.normal2Compressed;m.compressNormal(A,v,y.faceNormal1[0],y.faceNormal1[1],y.faceNormal1[2],C)}trim(u,v){return this._commonWriter.trim(u,v)}}p.Layout=
g.SilhouetteEdgeInstancesLayout;p.glLayout=k.glLayout(g.SilhouetteEdgeInstancesLayout,1);const t=h.create(),q=new b;a.CommonBufferWriter=l;a.RegularEdgeBufferWriter=w;a.SilhouetteEdgeBufferWriter=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64"],
function(a,b,n,h,k){function m(f,r){const x=n.acosClamped(f.cosAngle),w=d.fwd,p=d.ortho;h.direction(w,f.position1,f.position0);f=0<h.dot(h.cross(p,f.faceNormal0,f.faceNormal1),w)?-1:1;return x*f>r}function g(f){const r=f.faces.length/3,x=f.faces;f=f.neighbors;var w=0;for(var p=0;p<r;p++){var t=f[3*p+1],q=f[3*p+2],u=x[3*p],v=x[3*p+1],y=x[3*p+2];w+=-1===f[3*p]||u<v?1:0;w+=-1===t||v<y?1:0;w+=-1===q||y<u?1:0}w=new Int32Array(4*w);p=0;for(t=0;t<r;t++){q=f[3*t];u=f[3*t+1];v=f[3*t+2];y=x[3*t];const D=x[3*
t+1],G=x[3*t+2];if(-1===q||y<D)w[p++]=y,w[p++]=D,w[p++]=t,w[p++]=q;if(-1===u||D<G)w[p++]=D,w[p++]=G,w[p++]=t,w[p++]=u;if(-1===v||G<y)w[p++]=G,w[p++]=y,w[p++]=t,w[p++]=v}return w}function e(f){const r=f.faces.length/3,x=f.vertices.position;f=f.faces;const w=c.v0,p=c.v1,t=c.v2,q=new Float32Array(3*r);for(let u=0;u<r;u++){const v=f[3*u+1],y=f[3*u+2];x.getVec(f[3*u],w);x.getVec(v,p);x.getVec(y,t);h.subtract(p,p,w);h.subtract(t,t,w);h.cross(w,p,t);h.normalize(w,w);q[3*u]=w[0];q[3*u+1]=w[1];q[3*u+2]=w[2]}return q}
a.EdgeType=void 0;(function(f){f[f.SOLID=0]="SOLID";f[f.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const d={edge:{position0:k.create(),position1:k.create(),faceNormal0:k.create(),faceNormal1:k.create(),componentIndex:0,cosAngle:0},ortho:k.create(),fwd:k.create()},c={v0:k.create(),v1:k.create(),v2:k.create()},l={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(f,r,x,w=l){const p=f.vertices.position;var t=f.vertices.componentIndex,q=n.deg2rad(w.anglePlanar);w=n.deg2rad(w.angleSignificantEdge);
const u=Math.cos(w),v=Math.cos(q),y=d.edge,D=y.position0,G=y.position1,A=y.faceNormal0,C=y.faceNormal1,E=e(f),I=g(f),H=I.length/4;f=r.allocate(H);w=0;const J=x.allocate(H);let B=0,z=0,K=0;const L=b.range(0,H),F=new Float32Array(H);F.forEach((P,R,O)=>{p.getVec(I[4*R],D);p.getVec(I[4*R+1],G);O[R]=h.distance(D,G)});L.sort((P,R)=>F[R]-F[P]);const M=[],S=[];for(let P=0;P<H;P++){var N=L[P];const R=F[N],O=I[4*N],T=I[4*N+1],Q=I[4*N+2];N=I[4*N+3];const V=-1===N;p.getVec(O,D);p.getVec(T,G);if(V)h.set(A,E[3*
Q],E[3*Q+1],E[3*Q+2]),h.copy(C,A),y.componentIndex=t.get(O),y.cosAngle=h.dot(A,C);else{h.set(A,E[3*Q],E[3*Q+1],E[3*Q+2]);h.set(C,E[3*N],E[3*N+1],E[3*N+2]);y.componentIndex=t.get(O);y.cosAngle=h.dot(A,C);if(y.cosAngle>v)continue;-.9999>y.cosAngle&&h.copy(C,A)}z+=R;K++;V||y.cosAngle<u?(r.write(f,w++,y),M.push(R)):m(y,q)&&(x.write(J,B++,y),S.push(R))}t=new Float32Array(M.reverse());q=new Float32Array(S.reverse());return{regular:{instancesData:r.trim(f,w),lodInfo:{lengths:t}},silhouette:{instancesData:x.trim(J,
B),lodInfo:{lengths:q}},averageEdgeLength:z/K}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){class n{constructor(h,k=1){this._rctx=h;this._fieldCount=k;this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(h=>0===h.activeCount?(h.dispose(),!1):!0)}destroy(){this._buffers.forEach(h=>h.dispose());this._buffers=[]}getBuffer(h){for(const k of this._buffers)if(k.availableCount>=
h)return k;if(h>b.maxIndexCount)return null;h=new b.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(h);return h}updateTextures(){for(const h of this._buffers)h.textureBuffer.updateTexture()}}a.BufferManager=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,n){class h{constructor(k,m=1){this.textureBuffer=
new n.TextureBackedBuffer(k,m);this._indexManager=new b.SimpleIndexManager(65536)}dispose(){this.textureBuffer.dispose();this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const k=this._indexManager.acquire();this.textureBuffer.resizeToFit(k);return k}releaseIndex(k){this._indexManager.release(k)}}a.ManagedTextureBackedBuffer=h;a.maxIndexCount=65536;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports"],function(a){class b{constructor(n){this._maxCount=n;this._nextIndex=0;this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++}release(n){this._recycledIndices.push(n)}}
a.SimpleIndexManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(a,b,n,h,k){class m{constructor(g,e=1){this._rctx=g;this._fieldCount=e;this.textureWidth=4096;this._dirty=!0;g=new k.TextureDescriptor(this.textureWidth,1);g.samplingMode=
n.TextureSamplingMode.NEAREST;g.wrapMode=n.TextureWrapMode.CLAMP_TO_EDGE;this._texture=new h.Texture(this._rctx,g);this._data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose();this._data=this._texture=void 0}setData(g,e,d,c,l,f){g=g*this._fieldCount+e;this._dirty=!0;this._data.set(g,0,d);this._data.set(g,1,c);this._data.set(g,2,l);this._data.set(g,3,f)}setDataElement(g,e,d,c){g=g*this._fieldCount+e;this._dirty=!0;this._data.set(g,d,c)}getDataElement(g,
e,d){g=g*this._fieldCount+e;this._dirty=!0;return this._data.get(g,d)}resizeToFit(g){g=(g+1)*this._fieldCount;g>this._data.count&&(g=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil(g/this.textureWidth)*this.textureWidth*4)),g.typedBuffer.set(this._data.typedBuffer),this._data=g)}updateTexture(){if(this._dirty){var g=this._texture.descriptor.width;this._data.count>g*this._texture.descriptor.height&&this._texture.resize(g,this._data.count/g);this._texture.setData(this._data.typedBuffer);this._dirty=
!1}}get texture(){return this._texture}}a.TextureBackedBuffer=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique".split(" "),function(a,b,n,h,k,m,g){class e{constructor(d,
c){this._rctx=d;this._techniqueRepository=c;this._configuration=new n.CompositingTechniqueConfiguration;this._passParameters=new a.CompositingPassParameters;this._oitParameters=new m.OITCompositingPassParameters;this._hudParameters=new h.HUDCompositingPassParameters}compositeOIT(d,c,l,f){this._oitParameters.colorTexture=c;this._oitParameters.alphaTexture=l;this._oitParameters.frontFaceTexture=f;c=this._techniqueRepository.acquire(g.OITCompositingTechnique);this._rctx.bindTechnique(c,d,this._oitParameters);
this._rctx.screen.draw();c.release()}compositeHUD(d,c){this._hudParameters.texture=c;c=this._techniqueRepository.acquire(k.HUDCompositingTechnique);this._rctx.bindTechnique(c,d,this._hudParameters);this._rctx.screen.draw();c.release()}composite(d,c,l=n.AlphaMode.None,f=1){this._configuration.alphaMode=l;this._configuration.hasOpacityFactor=1!==f;this._passParameters.texture=c;this._passParameters.opacity=f;c=this._techniqueRepository.acquire(b.CompositingTechnique,this._configuration);this._rctx.bindTechnique(c,
d,this._passParameters);this._rctx.screen.draw();c.release()}}return e})},"esri/chunks/Compositing.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m){function g(c){const l=new k.ShaderBuilder;
l.include(b.ScreenSpacePass);l.fragment.uniforms.add(new m.Texture2DPassUniform("tex",f=>f.texture));c.hasOpacityFactor&&l.fragment.uniforms.add(new n.FloatPassUniform("opacity",f=>f.opacity));l.fragment.code.add(h.glsl`
    void main() {
      fragColor = texture(tex, uv) ${c.hasOpacityFactor?"* opacity":""};
    }`);return l}class e extends h.NoParameters{constructor(){super(...arguments);this.opacity=1}}const d=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:e,build:g},Symbol.toStringTag,{value:"Module"}));a.Compositing=d;a.CompositingPassParameters=e;a.build=g})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends h.ShaderTechnique{initializeProgram(f){return new m.Program(f.rctx,l.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){switch(this.configuration.alphaMode){case e.AlphaMode.None:return c.makePipelineState({colorWrite:c.defaultColorWriteParams});case e.AlphaMode.Alpha:return c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),
colorWrite:c.defaultColorWriteParams});case e.AlphaMode.PremultipliedAlpha:case e.AlphaMode.COUNT:return c.makePipelineState({blending:c.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:c.defaultColorWriteParams})}}}l.shader=new n.ReloadableShaderModule(g.Compositing,()=>new Promise((f,r)=>a(["./Compositing.glsl"],f,r)));b.CompositingTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){a.AlphaMode=void 0;(function(k){k[k.None=0]="None";k[k.Alpha=1]="Alpha";k[k.PremultipliedAlpha=2]="PremultipliedAlpha";k[k.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.alphaMode=a.AlphaMode.None;this.hasOpacityFactor=!1}}b.__decorate([n.parameter({count:a.AlphaMode.COUNT})],h.prototype,"alphaMode",void 0);
b.__decorate([n.parameter()],h.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,h,
k){function m(){const d=new h.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new k.Texture2DPassUniform("tex",c=>c.texture));d.fragment.code.add(n.glsl`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`);return d}class g extends n.NoParameters{}const e=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:g,build:m},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=e;a.HUDCompositingPassParameters=g;a.build=m})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}}d.shader=new n.ReloadableShaderModule(g.HUDCompositing,()=>new Promise((c,l)=>a(["./HUDCompositing.glsl"],c,l)));b.HUDCompositingTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){function m(){const d=new h.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",c=>c.colorTexture),new k.Texture2DPassUniform("alphaTexture",c=>c.alphaTexture),new k.Texture2DPassUniform("frontFaceTexture",c=>c.frontFaceTexture));d.fragment.code.add(n.glsl`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb / srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return d}class g extends n.NoParameters{}const e=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:g,build:m},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=e;a.OITCompositingPassParameters=g;a.build=m})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends h.ShaderTechnique{initializeProgram(l){return new m.Program(l.rctx,c.shader.get().build(),k.Default3D)}initializePipeline(){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}}c.shader=new n.ReloadableShaderModule(g.OITCompositing,()=>new Promise((l,f)=>a(["./OITCompositing.glsl"],l,f)));b.OITCompositingTechnique=
c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../core/floatRGBA ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(z,K){if(K.visible){var L=f.empty(),F=K.getSpatialQueryAccelerator();F?p(L,z,F):t(L,z,K.objects);return L}}function p(z,K,L){var F=K.eye;const M=K.viewForward,S=K.frustum,N=R=>R.visible;var P=L.objectCount;500>P?(f.set(I,K.near,Math.min(z.near,K.far)),L.forEachInDepthRange(F,M,r.DepthOrder.FRONT_TO_BACK,I,(R,O)=>{q(z,K,R);I.far=z.near;O.setRange(I)},S,N),f.set(I,Math.max(z.far,K.near),K.far),L.forEachInDepthRange(F,M,r.DepthOrder.BACK_TO_FRONT,I,(R,
O)=>{q(z,K,R);I.near=z.far;O.setRange(I)},S,N)):(P=Math.max(Math.min(P,500),Math.ceil(.1*P)),F=L.findClosest(M,r.DepthOrder.FRONT_TO_BACK,S,N,P),L=L.findClosest(M,r.DepthOrder.BACK_TO_FRONT,S,N,P),F&&L&&(v(z,K,F.boundingVolumeWorldSpace.bounds),v(z,K,L.boundingVolumeWorldSpace.bounds)))}function t(z,K,L){H.clear();L.forAll(F=>{F.visible&&0!==F.geometries.length&&H.add(F)});H.empty||(H.sort(K),f.set(I,K.near,Math.min(z.near,K.far)),H.forEachInDepthRange(I,r.DepthOrder.FRONT_TO_BACK,(F,M)=>{M<z.near&&
q(z,K,F)}),f.set(I,Math.max(z.far,K.near),K.far),H.forEachInDepthRange(I,r.DepthOrder.BACK_TO_FRONT,(F,M,S)=>{z.far=Math.max(z.far,S)}))}function q(z,K,L){if(L.visible&&d.intersectsSphere(K.frustum,L.boundingVolumeWorldSpace.bounds)){var F=L.transformation,M=E;L.geometries.forEach(S=>{h.multiply(M,F,S.transformation);const N=l.maxScale(M);u(z,K,S.boundingInfo,M,N)})}}function u(z,K,L,F,M){if(null!=L){m.transformMat4(c.getCenter(C),L.center,F);var {eye:S,viewForward:N}=K,P=N[0]*(C[0]-S[0])+N[1]*(C[1]-
S[1])+N[2]*(C[2]-S[2]);C[3]=L.radius*M;if(!(P-C[3]>z.near&&P+C[3]<z.far)&&d.intersectsSphere(K.frustum,C))if(100<L.radius&&L.getChildren())for(const R of L.getChildren())u(z,K,R,F,M);else B.unionDepthRangeWithAABB(z,K.viewProjectionMatrix,F,L.bbMin,L.bbMax)}}function v(z,K,L){var F=K.eye;K=K.viewForward;F=(L[0]-F[0])*K[0]+(L[1]-F[1])*K[1]+(L[2]-F[2])*K[2];z.near=Math.min(z.near,F-L[3]);z.far=Math.max(z.far,F+L[3])}class y{constructor(){this._items=new n({allocator:z=>z||{object:null,distance:0,near:0,
far:0},deallocator:z=>{z.object=null;z.distance=0;z.near=0;z.far=0;return z}})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(z){this._items.pushNew().object=z}sort(z){const K=z.eye,L=z.viewForward;this._items.forAll(F=>{const M=F.object.boundingVolumeWorldSpace.bounds,S=(M[0]-K[0])*L[0]+(M[1]-K[1])*L[1]+(M[2]-K[2])*L[2];F.distance=S;F.near=S-M[3];F.far=S+M[3]});this._items.sort((F,M)=>F.distance-M.distance)}forEachInDepthRange(z,K,
L){if(K===r.DepthOrder.FRONT_TO_BACK)for(K=0;K<this._items.length;++K){var F=this._items.data[K];F.far<z.near||F.near>z.far||L(F.object,F.near,F.far)}else for(K=this._items.length-1;0<=K;--K)F=this._items.data[K],F.far<z.near||F.near>z.far||L(F.object,F.near,F.far)}}class D{constructor(){this._view=k.create();this._viewProj=k.create();this._frustum=d.create();this._geometries=[];this._near=[];this._far=[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}compute(z,K){this._reset();
h.copy(this._view,z.viewMatrix);h.multiply(this._viewProj,z.projectionMatrix,this._view);d.copy(this._frustum,z.frustum);z=this._view;const L=z[2],F=z[6],M=z[10],S=z[14];K.forAll(R=>{R.materialReference&&R.forEachGeometry&&R.forEachGeometry(O=>{if(O.visible&&O.castShadow){var T=O.boundingSphere,Q=L*T[0]+F*T[1]+M*T[2]+S,V=Q-T[3];T=Q+T[3];this._geometries.push(O);this._near.push(-T);this._far.push(-V)}})});K=new f.DepthRange;if(0===this._geometries.length)return K;for(z=0;z<this._geometries.length;++z)this._near[z]>
K.far&&(K.far=this._near[z]),2<this._near[z]&&this._far[z]<K.near&&(K.near=this._far[z]);z=this._looseRange;z.near=Math.max(.5*K.near,2);z.far=2*K.far;var N=0;let P=0;for(let R=0;R<this._geometries.length;++R)this._near[R]<K.near&&(this._near[R]>=z.near?K.near=this._near[R]:this._nearCandidates[N++]=R),this._far[R]>K.far&&(this._far[R]<=z.far?K.far=this._far[R]:this._farCandidates[P++]=R);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return K;this._nearCandidates.sort((R,O)=>
this._near[R]<this._near[O]?-1:this._near[R]>this._near[O]?1:0);this._farCandidates.sort((R,O)=>this._far[R]<this._far[O]?1:this._far[R]>this._far[O]?-1:0);for(z=0;z<this._nearCandidates.length;++z)N=this._nearCandidates[z],this._near[N]<K.near&&(N=this._geometries[N],this._includeNearBoundingInfoRec(N.boundingInfo,N.shaderTransformation,K));for(z=0;z<this._farCandidates.length;++z)N=this._farCandidates[z],this._far[N]>K.far&&(N=this._geometries[N],this._includeFarBoundingInfoRec(N.boundingInfo,N.shaderTransformation,
K));this._reset();return K}_reset(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0}_includeNearBoundingInfoRec(z,K,L){if(null!=z){var F=z.center;m.transformMat4(c.getCenter(C),F,K);F=l.maxScale(K);var M=C[0],S=C[1],N=C[2];F*=z.radius;var P=this._frustum;if(!(P[0][0]*M+P[0][1]*S+P[0][2]*N+P[0][3]>F||P[1][0]*M+P[1][1]*S+P[1][2]*N+P[1][3]>F||P[2][0]*M+P[2][1]*S+P[2][2]*N+P[2][3]>F||P[3][0]*M+P[3][1]*S+P[3][2]*N+P[3][3]>F||(M=
this._view[2]*M+this._view[6]*S+this._view[10]*N+this._view[14],S=M+F,2>-(M-F)||-S>=L.near)))if(-S>this._looseRange.near)L.near=-S;else{if(100<F&&(F=z.getChildren(),void 0!==F)){for(const R of F)this._includeNearBoundingInfoRec(R,K,L);return}B.unionDepthRangeWithAABB(L,this._viewProj,K,z.bbMin,z.bbMax)}}}_includeFarBoundingInfoRec(z,K,L){if(null!=z){var F=z.radius,M=z.center;m.transformMat4(c.getCenter(C),M,K);var S=l.maxScale(K);M=C[0];var N=C[1],P=C[2];F*=S;S=this._frustum;if(!(S[0][0]*M+S[0][1]*
N+S[0][2]*P+S[0][3]>F||S[1][0]*M+S[1][1]*N+S[1][2]*P+S[1][3]>F||S[2][0]*M+S[2][1]*N+S[2][2]*P+S[2][3]>F||S[3][0]*M+S[3][1]*N+S[3][2]*P+S[3][3]>F||(M=this._view[2]*M+this._view[6]*N+this._view[10]*P+this._view[14]-F,-M<=L.far)))if(-M<this._looseRange.far)L.far=-M;else{if(100<F&&(F=z.getChildren(),void 0!==F)){for(const R of F)this._includeFarBoundingInfoRec(R,K,L);return}B.unionDepthRangeWithAABB(L,this._viewProj,K,z.bbMin,z.bbMax)}}}}class G{constructor(){this._modelViewProj=k.create();this._clipPosition=
[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}unionDepthRangeWithAABB(z,K,L,F,M){var S=this._modelViewProj;h.multiply(S,K,L);K=!1;for(L=0;8>L;++L){const N=this._clipPosition[L],P=0===L||3===L||4===L||7===L?F[0]:M[0],R=0===L||1===L||4===L||5===L?F[1]:M[1],O=4>L?F[2]:M[2];N[0]=S[0]*P+S[4]*R+S[8]*O+S[12];N[1]=S[1]*P+S[5]*R+S[9]*O+S[13];N[2]=S[2]*P+S[6]*R+S[10]*O+S[14];N[3]=S[3]*P+S[7]*R+S[11]*O+S[15]}for(F=0;12>F;++F){M=this._clipTriangle(this._clipPosition[A[F][0]],
this._clipPosition[A[F][1]],this._clipPosition[A[F][2]]);S=!0;for(L=0;L<M.length;++L)if(2<=M[L][3]){S=!1;break}if(!S)for(K=!0,S=0;S<M.length;++S)L=M[S][3],Number.isFinite(L)&&(z.near=Math.min(L,z.near),z.far=Math.max(L,z.far))}return K}_inside(z,K){if(0===K)return z[0]>=-z[3];if(1===K)return z[1]>=-z[3];if(2===K)return z[0]<=z[3];if(3===K)return z[1]<=z[3];x.assert(!1)}_intersect(z,K,L){let F=0;0===L?F=(-z[3]-z[0])/(K[0]-z[0]+K[3]-z[3]):1===L?F=(-z[3]-z[1])/(K[1]-z[1]+K[3]-z[3]):2===L?F=(z[3]-z[0])/
(K[0]-z[0]-K[3]+z[3]):3===L&&(F=(z[3]-z[1])/(K[1]-z[1]-K[3]+z[3]));return g.lerp(e.create(),z,K,F)}_clipTriangle(z,K,L){z=[z,K,L];for(K=0;4>K;++K){L=z;z=[];for(let F=0;F<L.length;++F){const M=L[F],S=L[(F+1)%L.length];this._inside(S,K)?(this._inside(M,K)||z.push(this._intersect(M,S,K)),z.push(S)):this._inside(M,K)&&z.push(this._intersect(M,S,K))}}return z}}const A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],C=c.create(),E=k.create(),I=f.empty(),
H=new y,J=new D,B=new G;a.DepthRangeFromRenderGeometries=D;a.depthRangeFromLayer=w;a.depthRangeFromScene=function(z,K,L){let F=0;if(!K.some(S=>{if(!S.materialReference)return!1;F+=S.numGeometries;return 1E4<=F}))return J.compute(z,K);const M=f.empty();L.forAll(S=>f.union(M,w(z,S)));return M};a.textureToDepth=function(z,K,L){return b.unpackFloatRGBA(K,z)*(L[1]-L[0])+L[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){a.MagnifierHelper=class extends n{constructor(){super(...arguments);this._resources=this._imageLoadTask=this._imageSources=this._magnifier=null;this._passParameters=new v.MagnifierPassParameters;this.events=new k;this.attributeLocations=new Map([[u.VertexAttribute.POSITION,0]]);this._tmpScreenPoint=e.createScreenPointArray();this._tmpRenderPoint=e.createRenderScreenPointArray()}get updating(){return null==this._imageSources&&null!=this._imageLoadTask&&
!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(E){E!==this._magnifier&&(this.removeAllHandles(),this._magnifier=E,E=()=>{this._updateResourceLoading();this.events.emit("request-render")},null!=this._magnifier&&this.addHandles(g.watch(()=>this._magnifier?.version,E)),E())}get enabled(){return null!=this._validMagnifier}get _validMagnifier(){return null!=this._magnifier&&this._magnifier.visible&&null!=this._magnifier.position&&0<this._magnifier.size?this._magnifier:
null}get _factor(){return null!=this._magnifier?this._magnifier.factor||1:1}destroy(){this._magnifier=null;null!=this._imageLoadTask&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()}render(E,I){const H=this._validMagnifier;if(null!=H){var J=Math.ceil(I.camera.pixelRatio*H.size);this._updateResources(E,J);if(null!=this._resources){var B=this._passParameters.textures;J=Math.ceil(1/this._factor*J);B.input.resize(J,J);e.screenPointObjectToArray(H.position,this._tmpScreenPoint);
var z=I.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),K=I.camera.fullHeight,L=.5*J,F=.5*J;z[0]=m.clamp(z[0],L,I.camera.fullWidth-L-1);z[1]=m.clamp(z[1],F,K-F-1);K=Math.floor(z[0]-L);z=Math.floor(z[1]-F);F=this._resources.program;F.bindTexture("textureInput",B.input);E.gl.copyTexImage2D(B.input.descriptor.target,0,B.input.descriptor.pixelFormat,K,z,J,J,0);this._passParameters.magnifier=H;E.useProgram(F);F.bindPass(this._passParameters,I);E.bindVAO(this._resources.vao);E.setPipelineState(this._resources.pipelineState);
E.drawArrays(D.PrimitiveType.TRIANGLE_STRIP,0,4)}}}_updateResourceLoading(){const E=this._validMagnifier;if(null!=E){var I=E.maskUrl,H=E.overlayUrl;null==this._imageLoadTask||this._imageLoadTask.maskUrl===I&&this._imageLoadTask.overlayUrl===H||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);null==this._imageSources&&null==this._imageLoadTask&&(this._imageLoadTask={maskUrl:I,overlayUrl:H,task:h.createTask(async J=>{const B=null==I||null==H?y.loadMagnifierResources(J):
null,z=null!=I?w.requestImage(I,{signal:J}):B.then(K=>K.mask);J=null!=H?w.requestImage(H,{signal:J}):B.then(K=>K.overlay);this._imageSources={mask:await z,overlay:await J};this._disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}}_updateResources(E,I){this.enabled?null!=this._resources?this._passParameters.textures.size!==I&&(E=this._createTextureResources(E,I),null==E?this._disposeResources():
(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=E)):(I=this._createTextureResources(E,I),null!=I&&(this._resources={program:this._createProgram(E),vao:t.createQuadVAO(E,p.Pos2,this.attributeLocations,0,1),pipelineState:G.makePipelineState({blending:G.simpleBlendingParams(D.BlendFactor.ONE,D.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:G.defaultColorWriteParams})},this._passParameters.textures=I)):this._disposeResources()}_disposeResources(){null!=
this._resources&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(E){E.mask.dispose();E.overlay.dispose();E.input.dispose()}_createTextureResources(E,I){if(null==this._imageSources)return null;this._imageSources.overlay.width=I;this._imageSources.overlay.height=I;this._imageSources.mask.width=I;this._imageSources.mask.height=I;const H=new C.TextureDescriptor;H.internalFormat=
D.PixelFormat.RGBA;H.wrapMode=D.TextureWrapMode.CLAMP_TO_EDGE;H.flipped=!0;H.preMultiplyAlpha=!d.isSVG(this._imageSources.overlay.src)||!E.driverTest.svgPremultipliesAlpha.result;const J=new A.Texture(E,H,this._imageSources.overlay);H.pixelFormat=H.internalFormat=D.PixelFormat.ALPHA;H.preMultiplyAlpha=!1;const B=new A.Texture(E,H,this._imageSources.mask);H.pixelFormat=H.internalFormat=D.PixelFormat.RGBA;H.flipped=!1;return{input:new A.Texture(E,H),mask:B,overlay:J,size:I}}_createProgram(E){return new q.Program(E,
v.build(),this.attributeLocations)}};b.__decorate([c.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);b.__decorate([c.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([c.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=b.__decorate([x.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{}class f extends g.NoParameters{constructor(){super(...arguments);this.textures=new l}}const r=b.createScreenPointArray(),x=b.createRenderScreenPointArray(),w=h.create();a.MagnifierPassParameters=f;a.TextureResources=l;a.build=function(){const p=new e.ShaderBuilder;p.attributes.add(c.VertexAttribute.POSITION,"vec2");p.vertex.uniforms.add(new m.Float4PassUniform("drawPosition",(t,q)=>{var u=q.camera.pixelRatio;const v=t.magnifier.offset.x*u,y=t.magnifier.offset.y*
u;b.screenPointObjectToArray(t.magnifier.position,r);const D=q.camera.screenToRender(r,x);t=Math.ceil(u*t.magnifier.size);u=q.camera.fullWidth;q=q.camera.fullHeight;return n.set(w,-1+(D[0]+v)/u*2,-1+(D[1]-y)/q*2,t/u*2,t/q*2)}));p.varyings.add("vUV","vec2");p.vertex.code.add(g.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);p.fragment.uniforms.add(new d.Texture2DPassUniform("textureInput",t=>t.textures.input));p.fragment.uniforms.add(new d.Texture2DPassUniform("textureMask",t=>t.textures.mask));p.fragment.uniforms.add(new d.Texture2DPassUniform("textureOverlay",t=>t.textures.overlay));p.fragment.uniforms.add(new k.BooleanPassUniform("maskEnabled",t=>t.magnifier.maskEnabled));p.fragment.uniforms.add(new k.BooleanPassUniform("overlayEnabled",t=>t.magnifier.overlayEnabled));p.fragment.code.add(g.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,n,h){const k=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=async function(m){var g=new Promise((d,c)=>a(["./mask-svg"],l=>d(k(l)),c)),e=new Promise((d,c)=>a(["./overlay-svg"],l=>d(k(l)),c));g=h.requestImage((await g).default,
{signal:m});e=h.requestImage((await e).default,{signal:m});e={mask:await g,overlay:await e};n.throwIfAborted(m);return e};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/Logger","../../../../core/NestedMap","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],function(a,b,n,h,k){class m{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";
this.colorZero=new k.BufferViewVec4u8(new ArrayBuffer(4));this._layerToOidToColor=new n.NestedMap;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new n.NestedMap;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(g,e,d,c,l,f=null,r=null,x=null){g&&e&&d&&c&&(this._layerUidToId.set(c,d),this._layerUidToPopupEnabled.set(c,l),l&&this._layerUidToGraphicsUidToObjectId.set(c,e,{objectId:g,attributeNodeId:f,attributeIndex:r,subLayerId:x}))}getObjectAndLayerIdColor(g){g=
this.getObjectAndLayerIdColorArray(g);return h.fromValues(g.get(0,1),g.get(0,2),g.get(0,3),255)}getObjectAndLayerIdColorArray(g){if(!g.layerUid||!g.graphicUid)return this.colorZero;var e=this._layerUidToPopupEnabled.get(g.layerUid);if(void 0===e)return b.getLogger(this).warn("popupEnabled is undefined for layerUid "+g.layerUid),this.colorZero;if(!1===e)return this.colorZero;const d=this._layerUidToGraphicsUidToObjectId.get(g.layerUid,g.graphicUid)?.objectId;if(!d)return this.colorZero;e=this._layerToOidToColor.get(g.layerUid,
d);if(!e){for(;!e;){const c=Math.floor(16777214*Math.random())+1;this._colorToUID.has(c)||(e=c)}if(16777215<e)throw Error("Object ID Overflow");this._layerToOidToColor.set(g.layerUid,d,e);this._colorToUID.set(e,g)}g=new ArrayBuffer(4);(new DataView(g)).setUint32(0,e,!1);return new k.BufferViewVec4u8(g)}getColorToObjectAndLayerIdMapping(){const g=new Map;for(const [e,d]of this._colorToUID.entries()){const c=this._layerUidToGraphicsUidToObjectId.get(d.layerUid,d.graphicUid);c||b.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+
d.graphicUid);const l=this._layerUidToId.get(d.layerUid);l||b.getLogger(this).warn("no layerId found for uid "+d.layerUid);c&&l&&g.set(e,c.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:c.objectId,lid:l,attrId:c.attributeNodeId,attrIdx:c.attributeIndex,subLayerId:c.subLayerId}:{type:"object-and-layer-id",oid:c.objectId,lid:l})}return g}}a.ObjectAndLayerIdRenderHelper=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/arrayUtils ../../../../core/colorUtils ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/signal ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/accessorSupport/interfaces ../../../../core/accessorSupport/tracking/Flags ../../../../core/Warning ../../../../core/Error ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../../webgl/formats ../core/FBOCache ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDRenderStyle ../effects/RenderNodes ../effects/RenderPlugin ../effects/RenderPluginManager ../effects/blit/Blit ../effects/highlight/Highlight ../effects/highlight/ShadowHighlight ../effects/smaa/SMAA ../effects/ssao/SSAO ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderSlot ./ShadowAccumulator ./ShadowMap ./SliceHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja){function oa(pa){return Aa=>pa.immediate.schedule(Aa)}class qa{constructor(pa,Aa,ra,ua,Ea,Ka,Ma,Ua){this._stage=pa;this._techniqueRepository=ua;this._rctx=Ea;this._compositingHelper=Ka;this._magnifierHelper=Ma;this._requestRender=Ua;this._pluginsHas={hudElements:!1,water:!1};this._hasOverlayWater=!1;this.renderOverlay=Ga=>{};this._isRendering=!1;this._backgroundColor=
u.fromValues(0,0,0,1);this._sliceHelper=new ia;this._state=d.signal(Z.RenderState.IDLE);this._highQualityTransparencyEnabled=!0;this._terrainTransparency=D.TransparencyMode.Opaque;this._hasAnimations=this._ssrEnabled=!1;this._animationTimestep=new S.AnimationTimeStep;this._reprojectionMatrixVersion=d.signal(0);this._renderHiddenTransparentEdges=()=>{};this._pluginInput=new Map;this._releaseNormals=Ga=>{Ga.find(({name:Na})=>"normals"===Na)?.release()&&this._pluginInput.delete("normals")};this._debugLinearDepth=
!1;this.fboCache=new A.FBOCache(Ea);this._renderStateFeatures=d.signal(W.setupFeatureDefaults(!k("disable-feature:high-quality-idle"),pa.view.qualityProfile));this._offscreen=new Q.OffscreenRendering(this.fboCache,this._compositingHelper);this.performanceInfo=new Y.RendererPerformanceInfo(this._rctx);this._shadowMap=new ba.ShadowMap(this.fboCache,pa.viewingMode);this._highlight=new K.Highlight({view:pa.view});this._shadowHighlight=new L.ShadowHighlight({view:pa.view,viewingMode:pa.viewingMode});this._shadowAccumulator=
new X.ShadowAccumulator(this.fboCache,ua,pa,Ga=>{const Na=this.shadowsEnabled;this._shadowMap.enabled=!0;this._ensureBindParametersCamera(Ga.camera,Ga.contentCamera);this._plugins.prepareRender();this._shadowMap.enabled=Na},(Ga,Na,Va)=>{Ga.shadowMap.start(Ga.camera,Na,Va,!0,this._stage.view.qualitySettings.maximumPixelRatio);this._renderShadowCascades(E.ShaderOutput.Shadow,Ga.shadowMap);Ga.shadowMap.finish();Ga.camera.setGLViewport(this._rctx);this._ensureBindParametersCamera(Ga.camera,Ga.contentCamera)},
Ua);this._ssao=new M.SSAO({view:this._stage.view});this._renderContext=new V.RenderContext(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper);this._nodes=new H.RenderNodes(this._renderContext);this._plugins=new B.RenderPluginManager({renderContext:this._renderContext,techniqueRepository:ua,textureRepository:ra,materialRepository:Aa,requestRender:Ua,controller:pa,fbos:this.fboCache,isFeatureEnabled:Ga=>this.isFeatureEnabled(Ga)});this.renderPassManager=new C.RenderPassManager;this._plugins.add(this.renderPassManager);
this._smaa=new F.SMAA({view:this._stage.view});this._plugins.add(this._smaa);this._blit=new z.Blit({opacity:1,alphaMode:ha.AlphaMode.None});this._plugins.add(this._blit);this._plugins.add(this._ssao);this._plugins.add(this._highlight);this._plugins.add(this._shadowHighlight);this._handles=[e.watch(()=>this._stage.view.state.camera,()=>Ua(),e.syncAndInitial),e.watch(()=>y.debugFlags.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Ga=>{this._renderHiddenTransparentEdges=Ga?()=>this._renderEdges(aa.Transparency.TRANSPARENT):
()=>{};Ua()},e.initial),e.watch(()=>this._stage.view.environment.background?.color,Ga=>{Ga=Ga?h.unitRGBAFromColor(Ga):u.ZEROS;q.set(this._backgroundColor,Ga[0]*Ga[3],Ga[1]*Ga[3],Ga[2]*Ga[3],Ga[3]);Ua()},e.syncAndInitial)]}destroy(){this._handles.forEach(pa=>pa.remove());this._gpuTimerHandle=m.removeMaybe(this._gpuTimerHandle);this._nodes.destroy();this._offscreen.dispose();this._shadowMap.dispose();this._highlight.dispose();this._shadowAccumulator.dispose();this._edgeView=m.destroyMaybe(this._edgeView);
this.renderPassManager.dispose();this._releaseFBOs();this._disposeOffscreenBuffers();this.fboCache.destroy();this._plugins.destroy();P.BoundingInfo.prune()}get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(pa=null,Aa=!k("disable-feature:high-quality-idle")){this._renderStateFeatures.value=W.setupFeatureDefaults(Aa,pa);this._plugins.renderFeatureChanged();this._requestRender()}isFeatureEnabled(pa,Aa=this._state.value){return this._renderStateFeatures.value.get(Aa,
pa)??!1}setFeatureEnabled(pa,Aa,ra){this._renderStateFeatures.mutate(ua=>ua.set(Aa,pa,ra));this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(W.RenderFeature.HighQualityTransparency)}get hasReflections(){return(this._pluginsHas.water||this._hasOverlayWater)&&(this._ssrEnabled||this.isFeatureEnabled(W.RenderFeature.WaterReflection))}get hasDecorations(){return this._plugins.hasDecorations}get hasHighlights(){return this._plugins.produces(ca.RenderSlot.OPAQUE_MATERIAL,
E.ShaderOutput.Highlight)||this._plugins.produces(ca.RenderSlot.TRANSPARENT_MATERIAL,E.ShaderOutput.Highlight)||this._plugins.produces(ca.RenderSlot.DRAPED_MATERIAL,E.ShaderOutput.Highlight)}get _magnifierEnabled(){return this._bindParameters.decorations===N.Decorations.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(W.RenderFeature.HighResolutionAtmosphere)}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=
m.releaseMaybe(this._bindParameters.ssr.lastFrameColor);this._bindParameters.multipassTerrain.linearDepth=m.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth);this._bindParameters.multipassGeometry.linearDepth=m.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose();this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers();this._bindParameters.linearDepth=m.releaseMaybe(this._bindParameters.linearDepth);
this._bindParameters.hudVisibility=m.releaseMaybe(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||null!=this._edgeView&&this._edgeView.updating||this._shadowAccumulator.running||this._plugins.updating||!this.isCameraFinal}ensureEdgeView(){null==this._edgeView&&(this._edgeView=new da.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),
schedule:oa(this._stage.view.resourceController)}),this._handles.push(e.watch(()=>this._edgeView?.updating,()=>this._requestRender(),e.sync)),this._requestRender());return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return 0<=this._reprojectionMatrixVersion.value&&p.equals(this._bindParameters.ssr.reprojectionMatrix,t.IDENTITY)}set _reprojectionMatrix(pa){n.update(this._bindParameters.ssr.reprojectionMatrix,pa)&&this._reprojectionMatrixVersion.value++}get shadowsEnabled(){return!!this._shadowMap?.enabled}setParameters(pa){const {_shadowMap:Aa,
_bindParameters:ra}=this;void 0!==pa.qualitySettings?.reflections&&this._ssrEnabled!==pa.qualitySettings.reflections&&(this._ssrEnabled=pa.qualitySettings.reflections,this._requestRender());void 0!==pa.shadowMap&&this._shadowMap.enabled!==pa.shadowMap&&(this._shadowMap.enabled=pa.shadowMap,this._requestRender());void 0!==pa.shadowMapMaxCascades&&Aa.maxCascades!==pa.shadowMapMaxCascades&&(Aa.maxCascades=pa.shadowMapMaxCascades,this._requestRender());if(null!=pa.environment){null!=pa.environment.weather&&
(this._bindParameters.weather=pa.environment.weather,this._bindParameters.weatherVisible=!!pa.weatherVisible);const ua="virtual"!==pa.environment.lighting.type;ra.enableFillLights!==ua&&(ra.enableFillLights=ua,this._requestRender())}void 0!==pa.highQualityTransparency&&this._highQualityTransparencyEnabled!==pa.highQualityTransparency&&(this._highQualityTransparencyEnabled=pa.highQualityTransparency,this._requestRender());void 0!==pa.hasOverlayWater&&this._hasOverlayWater!==pa.hasOverlayWater&&(this._hasOverlayWater=
pa.hasOverlayWater,this._requestRender());void 0!==pa.slicePlane&&this._sliceHelper.plane!==pa.slicePlane&&(this._sliceHelper.plane=pa.slicePlane,this._requestRender());void 0!==pa.terrainTransparency&&this._terrainTransparency!==pa.terrainTransparency&&(this._terrainTransparency=pa.terrainTransparency,this._requestRender());void 0!==pa.shadowCastOptions&&this._shadowAccumulator.setOptions(pa.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get plugins(){return this._plugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&
this._hasOITSupport}modify(pa,Aa){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:ra,removes:ua,updates:Ea}=pa;if(0!==ra.length||0!==ua.length||0!==Ea.length){var Ka=!1;U.splitRenderGeometryChangeSetByMaterial(pa).forEach((Ma,Ua)=>{if(!Aa.done){var Ga=this._plugins.getMaterialRenderer(Ua);null==Ga&&0<Ma.adds.length&&(Ua=new ea.MergedRenderer({material:Ua}),Ua.initializeRenderContext(this._plugins._context),Ga=Ua,this._plugins.add(Ga));Ga&&(Ga.modify(Ma),0===Ga.numGeometries&&
(Ka=!0));Ma.removes.forEach(Na=>pa.removes.removeUnordered(Na));Ma.adds.forEach(Na=>pa.adds.removeUnordered(Na));Ma.updates.forEach(Na=>pa.updates.removeUnordered(Na));Aa.madeProgress()}});Ka&&this._plugins.removeEmptyMaterialRenderers();this._updateHasFlags();this._requestRender()}}_updateHasFlags(){const pa=this._pluginsHas;pa.hudElements=this._plugins.produces(ca.RenderSlot.LINE_CALLOUTS_HUD_DEPTH)||this._plugins.produces(ca.RenderSlot.HUD_MATERIAL)||this._plugins.produces(ca.RenderSlot.LABEL_MATERIAL);
pa.water=this._plugins.produces(ca.RenderSlot.DRAPED_WATER,E.ShaderOutput.Normal);this._bindParameters.hasOccludees=this._plugins.hasOccludees}updateAnimation(pa){const Aa=this._hasAnimations;this._hasAnimations=this._plugins.updateAnimation(pa);this._hasAnimations=this._nodes.updateAnimation()||this._hasAnimations;this._hasAnimations!==Aa&&(this._gpuTimerHandle=Aa?m.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());return this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(pa,
Aa,ra=U.RendererTarget.Default,ua=N.Decorations.ON){this._isRendering=!0;this.performanceInfo.startFrame();this.fboCache.frameStart();this._disposeBindBuffers();var Ea=this._offscreen;const {camera:Ka,contentCamera:Ma,mode:Ua,alignPixelEnabled:Ga}=pa;this._state.value=Ua;this._bindParameters.overlay=this.renderOverlay(Aa);this.performanceInfo.advance(Y.PerformanceCategory.OVERLAY);this._renderContext.time=Aa;this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE;this._bindParameters.alignPixelEnabled=
Ga;this._bindParameters.decorations=ua;this._bindParameters.mainColor=this._bindParameters.mainDepth=null;pa=v.create(this._sliceHelper.plane);ua===N.Decorations.OFF&&(this._sliceHelper.plane=null);Ka.setGLViewport(this._rctx);ua=Ea.initializeFrame(Ka,this._backgroundColor,ra);this.hasReflections?this._bindParameters.ssr.lastFrameColor=ua:ua?.release();this._ensureBindParametersCamera(Ka,Ma);this._plugins.prepareRender();this.performanceInfo.advance(Y.PerformanceCategory.PREPARE);var Na=this._computeDepthRange(Ka);
this._renderShadowMap(Ka,this._bindParameters.lighting.mainLight.direction,Na);this.performanceInfo.advance(Y.PerformanceCategory.SHADOW_MAP);this._ensureBindParametersCamera(Ka,Ma);var Va=this._plugins.produces(ca.RenderSlot.OPAQUE_TERRAIN)&&(this._terrainTransparency===D.TransparencyMode.Semitransparent||this._terrainTransparency===D.TransparencyMode.TransparentWithDraped);ua=this._highQualityTransparency&&Va;var Xa=this._plugins.produces(ca.RenderSlot.TRANSPARENT_MATERIAL,E.ShaderOutput.Color);
this._prepareShaders(ua,Xa);this._pluginInput.set("normals",this._renderNormals());this.performanceInfo.advance(Y.PerformanceCategory.NORMALS);this._renderSSAO();this.performanceInfo.advance(Y.PerformanceCategory.SSAO);this._renderLinearDepth();this.performanceInfo.advance(Y.PerformanceCategory.LINEAR_DEPTH);this._renderShadowAccumulation(Na,Ka,Ma);this.performanceInfo.advance(Y.PerformanceCategory.ACCUMULATED_SHADOWS);this._ensureBindParametersSSR(Aa);this._renderContext.output=E.ShaderOutput.Color;
Ea.bindFbo();this._bindParameters.mainColor=Ea.colorTexture;this._bindParameters.mainDepth=Ea.depthTexture;this._renderOpaqueGeometry();this._offscreen.updateColor(Pa=>this._invokeRenderNodes(Pa),"opaque-color");this._plugins.render(ca.RenderSlot.ENVIRONMENT_OPAQUE);this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE);this.fboCache.debugCallback&&this.fboCache.debugCallback("opaque-color",this._offscreen.color.fbo);this._renderTerrainLinearDepth(ua);this._setMultipassTerrain(ua);this._renderEdges(aa.Transparency.OPAQUE);
this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE_EDGES);Ea.bindFbo();this._plugins.render(ca.RenderSlot.VOXEL);this.performanceInfo.advance(Y.PerformanceCategory.VOXEL);this._renderHiddenTransparentEdges();Xa&&(this._oitEnabled?this._renderOITPass(ta.Geometry):this._renderTransparentMaterial());this._offscreen.updateColor(Pa=>this._invokeRenderNodes(Pa),"transparent-color");this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT);Na=this._renderGeometryLinearDepth(ua);this._renderHUDVisibility(Na);
ua||this._plugins.render(ca.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(Y.PerformanceCategory.HUD_VISIBILITY);Aa=ra===U.RendererTarget.ObjectAndLayerID?this._renderObjectAndLayerIdColor():null;this.performanceInfo.advance(Y.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(aa.Transparency.TRANSPARENT,Na);Na?.release();this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_EDGES);(Va=Va?this._renderTransparentTerrain():null)&&this._bindParameters.hudVisibility&&(ua?
this._renderLineCallouts(I.HUDRenderStyle.Occluded):Ea.compositeToHUDVisibility(this._bindParameters,Va.getTexture()),this._renderHUD(I.HUDRenderStyle.Occluded,Ea.color),this.performanceInfo.advance(Y.PerformanceCategory.HUD_OCCLUDED));this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);Va&&(Ea.compositeToFramebuffer(this._bindParameters,Va.getTexture(),ha.AlphaMode.PremultipliedAlpha,1),Va.release(),ua&&(this._renderEdges(aa.Transparency.OPAQUE),this.performanceInfo.advance(Y.PerformanceCategory.OPAQUE_EDGES),
Xa&&(this._oitEnabled?this._renderOITPass(ta.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT),this._renderEdges(aa.Transparency.TRANSPARENT),this.performanceInfo.advance(Y.PerformanceCategory.TRANSPARENT_EDGES)));this._bindParameters.ssao=m.releaseMaybe(this._bindParameters.ssao);ua&&this._renderLineCallouts(I.HUDRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);Ea.bindFbo();this._plugins.render(ca.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);
this._plugins.render(ca.RenderSlot.ENVIRONMENT_TRANSPARENT);this.performanceInfo.advance(Y.PerformanceCategory.ENVIRONMENT);this._renderLaserlines();this.performanceInfo.advance(Y.PerformanceCategory.LASER_LINES);this._renderOccluded();this.performanceInfo.advance(Y.PerformanceCategory.OCCLUDED);(Ea=this._renderHighlightPrepass())&&this._renderShadowHighlights(Ea,this._bindParameters);ua=this._magnifierEnabled&&ra===U.RendererTarget.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,
"magnifier"):null;Xa=ra!==U.RendererTarget.Default?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"screenshot"):null;Va=this._renderComposite(ua??Xa,Ea)??Xa;this.performanceInfo.advance(Y.PerformanceCategory.ANTIALIASING);this._renderHUD(I.HUDRenderStyle.NotOccluded,Va);this.performanceInfo.advance(Y.PerformanceCategory.HUD);Ea&&(this._renderHighlights(Va,Ea,this._bindParameters),Ea=m.releaseMaybe(Ea));this.performanceInfo.advance(Y.PerformanceCategory.HIGHLIGHTS);this._magnifierEnabled&&
this._magnifierHelper.render(this._rctx,this._bindParameters);Va!==Xa&&(this._rctx.bindFramebuffer(Xa?.fbo),this._compositingHelper.composite(this._bindParameters,ua?.getTexture(),ha.AlphaMode.None));ra===U.RendererTarget.Default&&ua?.release();if(this.onPostRender)this.onPostRender();this._releaseFBOs();this._offscreen.releaseBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=pa;this._isRendering=!1;this.fboCache.frameEnd();this.performanceInfo.finishFrame();
ra!==U.RendererTarget.Default&&(this._releaseFBOs(),this._disposeOffscreenBuffers());return{screen:Xa,oid:Aa}}_prepareShaders(pa,Aa){this._renderContext.output=E.ShaderOutput.Color;this._prepareOpaqueGeometry();this._setMultipassTerrain(pa);this._plugins.prepare(ca.RenderSlot.TRANSPARENT_TERRAIN);this._setMultipassTerrain(!1);pa||this._plugins.prepare(ca.RenderSlot.LINE_CALLOUTS);Aa&&this._prepareTransparencySlots();this._plugins.prepare(ca.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._plugins.prepare(ca.RenderSlot.ENVIRONMENT_TRANSPARENT);
this._plugins.prepare(ca.RenderSlot.LASERLINES);this._rctx.gl.flush()}_renderObjectAndLayerIdColor(){if(k("enable-feature:objectAndLayerId-rendering")){var pa=this._renderContext.output,Aa=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oid");Aa.acquireDepth(G.DepthFormat.DEPTH_STENCIL_TEXTURE);this._rctx.bindFramebuffer(Aa.fbo);this.fboCache.rctx.clearFramebuffer([0,0,0,0],!0,!0);this._renderAllGeometry(E.ShaderOutput.ObjectAndLayerIdColor);this._rctx.bindFramebuffer(Aa.fbo);
this.fboCache.rctx.clearFramebuffer(void 0,!0,!0);this._bindParameters.hudRenderStyle=I.HUDRenderStyle.NotOccluded;this._plugins.render(ca.RenderSlot.HUD_MATERIAL);this._renderContext.output=pa;return Aa}}finish(pa){this._hasAnimations||this._animationTimestep.clear();var Aa=this.performanceInfo.gpuSamplingEnabled;if((pa=pa===N.RenderRequestType.BACKGROUND)||Aa){const ra=pa?this.performanceInfo.elapsedTime:0;Aa=Aa?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(ra,
Aa),pa)}}readDepthPixels(pa,Aa,ra){var ua=this._bindParameters.linearDepth?.fbo;ua?.colorTexture?ua.readPixels(Aa[0],Aa[1],Aa[2],Aa[3],ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,ra):(ua=this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"depth").acquireDepth(G.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(ua.fbo),this._ensureBindParametersCamera(pa,pa),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ja.ClearBufferBit.COLOR_BUFFER_BIT|
ja.ClearBufferBit.DEPTH_BUFFER_BIT|ja.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderAllGeometry(E.ShaderOutput.LinearDepth),ua.fbo.readPixels(Aa[0],Aa[1],Aa[2],Aa[3],ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,ra),ua.release())}readHUDVisibility(pa,Aa,ra,ua,Ea){this._bindParameters.hudVisibility?.fbo.readPixels(pa,Aa,ra,ua,ja.PixelFormat.RGBA,ja.PixelType.UNSIGNED_BYTE,Ea)}readAccumulatedShadow(pa){return this._shadowAccumulator.readAccumulatedShadow(pa[0],pa[1])}_setMultipassTerrain(pa){this._setMultipassEnabled(pa);
this._setTerrainCulling(pa)}_setMultipassEnabled(pa){this._bindParameters.multipassEnabled=pa}_setTerrainCulling(pa){this._bindParameters.multipassTerrain.cullAboveGround=pa}_renderEdges(pa,Aa){const ra=this._edgeView;if(ra?.shouldRender()){const {width:ua,height:Ea,depth:Ka}=this._offscreen,Ma=this.fboCache.acquire(ua,Ea,"edges");this._offscreen.renderToTargets(()=>ra.render(this._bindParameters,pa),Ma,Aa??Ka,va);this._offscreen.compositeToFramebuffer(this._bindParameters,Ma.getTexture(),ha.AlphaMode.Alpha,
1);Ma.release()}}_renderShadowMap(pa,Aa,ra){const ua=this._shadowMap;ua.enabled&&(ua.start(pa,Aa,ra,this.isFeatureEnabled(W.RenderFeature.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(pa,Aa),this._needsShadowHighlight?(this._renderShadowCascades(E.ShaderOutput.ShadowHighlight,this._shadowMap),ua.moveSnapshot(ba.SnapshotSlot.Highlight),this._renderShadowCascades(E.ShaderOutput.ShadowExcludeHighlight,this._shadowMap),ua.copySnapshot(ba.SnapshotSlot.ExcludeHighlight),
this._renderShadowCascades(E.ShaderOutput.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(E.ShaderOutput.Shadow),ua.finish(),pa.setGLViewport(this._rctx))}_renderShadowCascades(pa,Aa=this._shadowMap){for(const ra of Aa.cascades)ra.camera.setGLViewport(this._rctx),this._ensureBindParametersCamera(ra.camera,ra.camera),this._renderAllGeometry(pa)}get _needsLinearDepth(){return this._plugins.consumes(E.ShaderOutput.LinearDepth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast||
this._debugLinearDepth}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,"linear-depth",()=>this._renderAllGeometry(E.ShaderOutput.LinearDepth),[0,0,0,0],G.ColorFormat.RGBA,G.DepthFormat.DEPTH_STENCIL_TEXTURE),this._bindParameters.linearDepth.detachDepth()):this._bindParameters.linearDepth=m.releaseMaybe(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(pa){pa?(pa=this._renderContext.output,this._renderContext.output=
E.ShaderOutput.LinearDepth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,"terrain depth",()=>this._renderTransparentTerrain(),[-1E10,-1E10,-1E10,1]),this._bindParameters.multipassTerrain.linearDepth.detachDepth(),this._renderContext.output=pa):this._bindParameters.multipassTerrain.linearDepth=m.releaseMaybe(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(pa){if(pa)return pa=this._renderContext.output,
this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,"geometry depth",()=>this._renderOpaqueGeometryAndTransparentMaterial(E.ShaderOutput.LinearDepth),[1,1,1,1]),this._renderContext.output=pa,pa=this._bindParameters.multipassGeometry.linearDepth.getAttachment(ja.DepthStencilAttachment),pa?.retain(),this._bindParameters.multipassGeometry.linearDepth.detachDepth(),pa;this._bindParameters.multipassGeometry.linearDepth=
m.releaseMaybe(this._bindParameters.multipassGeometry.linearDepth)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(pa){if(!this._needsDepthRange)return R.zero;const Aa=O.depthRangeFromScene(pa,this._plugins.plugins,this._stage.layers);R.union(Aa,this._plugins.queryDepthRange(pa));Aa.near=Math.max(pa.near,Aa.near);Aa.far=Math.min(pa.far,Aa.far);return Aa}_renderNormals(){var pa=this._plugins.produces(ca.RenderSlot.SSAO),Aa=this._nodes.require("normals",
"composite-color")+this._nodes.require("normals","opaque-color")+this._nodes.require("normals","transparent-color");pa=(pa?1:0)+Aa+(pa||0<Aa?this._nodes.optional("normals","composite-color")+this._nodes.optional("normals","opaque-color")+this._nodes.optional("normals","transparent-color"):0);if(0!==pa){for(Aa=this._offscreen.renderToCachedFBO(null,"normals",()=>this._renderGeometryForSSAO(E.ShaderOutput.Normal),[0,0,0,0],G.ColorFormat.RGBA,G.DepthFormat.DEPTH_STENCIL_TEXTURE);0<--pa;)Aa.retain();
return Aa}}_renderSSAO(){const pa=this._pluginInput.get("normals");this._plugins.produces(ca.RenderSlot.SSAO)&&pa&&(this._bindParameters.ssao=this._plugins.render(ca.RenderSlot.SSAO,this._pluginInput),pa.detachDepth(),pa.release()&&this._pluginInput.delete("normals"))}_renderAllGeometry(pa){this._renderContext.output=pa;this._plugins.prepare(ca.RenderSlot.TRANSPARENT_TERRAIN);this._renderOpaqueGeometryAndTransparentMaterial(pa);this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(pa){this._renderContext.output=
pa;this._plugins.prepare(ca.RenderSlot.TRANSPARENT_MATERIAL);this._plugins.prepare(ca.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH);this._renderOpaqueGeometry();this._renderTransparentMaterial()}_renderGeometryForSSAO(pa){this._renderContext.output=pa;this._plugins.render(ca.RenderSlot.INTEGRATED_MESH);this._plugins.render(ca.RenderSlot.OPAQUE_TERRAIN);this._plugins.render(ca.RenderSlot.OPAQUE_MATERIAL);this._plugins.render(ca.RenderSlot.TRANSPARENT_MATERIAL);this._renderTransparentTerrain()}_prepareOpaqueGeometry(){this._plugins.prepare(ca.RenderSlot.INTEGRATED_MESH);
this._plugins.prepare(ca.RenderSlot.OPAQUE_TERRAIN);this._plugins.prepare(ca.RenderSlot.OPAQUE_MATERIAL);this._plugins.prepare(ca.RenderSlot.OPAQUE_NO_SSAO_DEPTH);this._plugins.prepare(ca.RenderSlot.ENVIRONMENT_OPAQUE)}_renderOpaqueGeometry(){this._plugins.render(ca.RenderSlot.INTEGRATED_MESH);this._plugins.render(ca.RenderSlot.OPAQUE_TERRAIN);this._plugins.render(ca.RenderSlot.OPAQUE_MATERIAL);this._plugins.render(ca.RenderSlot.OPAQUE_NO_SSAO_DEPTH)}_renderTransparentMaterial(){this._plugins.render(ca.RenderSlot.TRANSPARENT_MATERIAL);
this._plugins.render(ca.RenderSlot.TRANSPARENT_NO_SSAO_DEPTH)}_renderTransparentTerrain(){if(this._plugins.produces(ca.RenderSlot.TRANSPARENT_TERRAIN)){var pa=()=>this._plugins.render(ca.RenderSlot.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==E.ShaderOutput.Color)pa();else{var {width:Aa,height:ra,depth:ua}=this._offscreen,Ea=this.fboCache.acquire(Aa,ra,"transparent terrain");this._offscreen.renderToTargets(pa,Ea,ua,[0,0,0,0]);return Ea}}}_renderHUDVisibility(pa){this._plugins.produces(ca.RenderSlot.OCCLUSION_PIXELS)?
(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._plugins.render(ca.RenderSlot.OCCLUSION_PIXELS),pa),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=m.releaseMaybe(this._bindParameters.hudVisibility)}_renderLineCallouts(pa){this._bindParameters.hudRenderStyle=pa;if(pa===I.HUDRenderStyle.Occluded){const {width:Aa,height:ra,color:ua}=this._offscreen;pa=this.fboCache.acquireDepth(G.DepthFormat.DEPTH16_BUFFER,Aa,ra,"line callouts");
this._offscreen.renderToTargets(()=>{this._plugins.render(ca.RenderSlot.LINE_CALLOUTS)},ua,pa,void 0,!0,!0);pa.release()}else this._plugins.render(ca.RenderSlot.LINE_CALLOUTS)}_renderLaserlines(){this._plugins.render(ca.RenderSlot.LASERLINES);if(this._plugins.produces(ca.RenderSlot.LASERLINES_CONTRAST_CONTROL)){const pa=this._offscreen,{width:Aa,height:ra,depth:ua}=pa,Ea=this.fboCache.acquire(Aa,ra,"laser lines");pa.renderToTargets(()=>this._plugins.render(ca.RenderSlot.LASERLINES_CONTRAST_CONTROL),
Ea,ua,va);pa.compositeToFramebuffer(this._bindParameters,Ea.getTexture(),ha.AlphaMode.PremultipliedAlpha,1);Ea.release()}}_renderHUD(pa,Aa){if(this._pluginsHas.hudElements)if(this._oitEnabled){const ra=this._renderOITPass(ta.HUD,pa);this._rctx.bindFramebuffer(Aa?.fbo);this._compositingHelper.composite(this._bindParameters,ra.getTexture(),ha.AlphaMode.PremultipliedAlpha);ra.release()}else if(pa===I.HUDRenderStyle.Occluded){this._renderContext.output=E.ShaderOutput.Color;const {width:ra,height:ua,color:Ea}=
this._offscreen;Aa=this.fboCache.acquireDepth(G.DepthFormat.DEPTH16_BUFFER,ra,ua,"hud");this._offscreen.renderToTargets(()=>this._renderHUDElements(pa),Ea,Aa,void 0,!0,!0);Aa.release()}else this._renderContext.output=E.ShaderOutput.Color,this._rctx.bindFramebuffer(null),Aa?.acquireDepth(G.DepthFormat.DEPTH16_BUFFER),this._rctx.bindFramebuffer(Aa?.fbo),this._renderHUDElements(pa),Aa?.detachDepth()}_renderHUDElements(pa){this._bindParameters.hudRenderStyle=pa;this._plugins.prepare(ca.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);
this._plugins.prepare(ca.RenderSlot.HUD_MATERIAL);this._plugins.prepare(ca.RenderSlot.LABEL_MATERIAL);this._plugins.render(ca.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._plugins.render(ca.RenderSlot.HUD_MATERIAL);this._plugins.render(ca.RenderSlot.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._plugins.produces(ca.RenderSlot.SHADOW_HIGHLIGHT)&&this._plugins.produces(ca.RenderSlot.OPAQUE_MATERIAL,E.ShaderOutput.ShadowHighlight)}_renderHighlightPrepass(){if(this.hasHighlights){var pa=
this._offscreen.renderToCachedFBO(null,"highlights",()=>{this._renderAllGeometry(E.ShaderOutput.Highlight);this._rctx.clearSafe(ja.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(I.HUDRenderStyle.Both)},[0,0,0,0],G.ColorFormat.RGBA4,G.DepthFormat.DEPTH_STENCIL_TEXTURE);pa.detachDepth();return pa}}_renderShadowHighlights(pa,Aa){this.hasHighlights&&Aa.decorations!==N.Decorations.OFF&&this._needsShadowHighlight&&this._offscreen.updateColor(ra=>{this._pluginInput.set("highlights",pa);this._plugins.render(ca.RenderSlot.SHADOW_HIGHLIGHT,
this._pluginInput,ra);return ra},"transparent-color")}_renderHighlights(pa,Aa,ra){this.hasHighlights&&ra.decorations!==N.Decorations.OFF&&this._plugins.produces(ca.RenderSlot.HIGHLIGHT)&&(this._pluginInput.set("highlights",Aa),this._plugins.render(ca.RenderSlot.HIGHLIGHT,this._pluginInput,pa))}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(pa,Aa,ra){this._needsShadowCast&&this._bindParameters.linearDepth?.getTexture()&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,
pa,Aa,ra)}_prepareTransparencySlots(){this._renderContext.output=E.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Alpha;this._plugins.prepare(ca.RenderSlot.TRANSPARENT_MATERIAL);this._renderContext.output=E.ShaderOutput.Color;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Color;this._plugins.prepare(ca.RenderSlot.TRANSPARENT_MATERIAL);this._bindParameters.transparencyPassType=fa.TransparencyPassType.FrontFace;this._plugins.prepare(ca.RenderSlot.TRANSPARENT_MATERIAL);
this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE}_renderOITPass(pa,Aa=I.HUDRenderStyle.Both){var ra=pa===ta.HUD;pa=ra?this.fboCache.acquire(this._offscreen.width,this._offscreen.height,"oit hud composite"):null;const ua=ra?()=>this._renderHUDElements(Aa):()=>this._renderTransparentMaterial(),Ea=this._renderContext.output;this._renderContext.output=E.ShaderOutput.Alpha;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Alpha;const Ka=this._offscreen.renderOITPass(ua,
fa.TransparencyPassType.Alpha,ra);this._renderContext.output=E.ShaderOutput.Color;this._bindParameters.transparencyPassType=fa.TransparencyPassType.Color;const Ma=this._offscreen.renderOITPass(ua,fa.TransparencyPassType.Color,ra);this._bindParameters.transparencyPassType=fa.TransparencyPassType.FrontFace;ra=this._offscreen.renderOITPass(ua,fa.TransparencyPassType.FrontFace,ra);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,Ma,Ka,ra,pa);pa?.detachDepth();ra.release();Ma.release();
Ka.release();this._bindParameters.transparencyPassType=fa.TransparencyPassType.NONE;this._renderContext.output=Ea;return pa}_renderOccluded(){let pa=0;Ca.clear();this._plugins.plugins.forAll(Ma=>{Ma.materialReference&&Ma.queryRenderOccludedState(T.RenderOccludedFlag.OccludeAndTransparentStencil)&&(pa|=T.RenderOccludedFlag.OccludeAndTransparentStencil,Ca.push(Ma))});const Aa=this._offscreen,ra=(Ma,Ua,Ga,Na,Va)=>{if(0!==(pa&Ua)){var {width:Xa,height:Pa,depth:bb}=Aa;Ua=this.fboCache.acquire(Xa,Pa,"tmp color");
Aa.renderToTargets(Ga,Ua,bb,[0,0,0,0],Na,Va);Aa.compositeToFramebuffer(this._bindParameters,Ua.getTexture(),ha.AlphaMode.PremultipliedAlpha,Ma);Ua.release()}},ua=(Ma,Ua)=>{this._bindParameters.slot=Ma;Ua.forAll(Ga=>{if(J.isPrepareRenderPlugin(Ga)){const Na=Ga.prepareTechnique(this._renderContext);Na&&Ga.renderNode(this._renderContext,Na)}})};0!==Ca.length&&(ua(ca.RenderSlot.OCCLUDER_MATERIAL,Ca),ra(.5,T.RenderOccludedFlag.OccludeAndTransparentStencil,()=>ua(ca.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,
Ca),!1,!1));Ca.clear();this._plugins.plugins.forAll(Ma=>{if(Ma.materialReference){var Ua=Ma.queryRenderOccludedState(T.RenderOccludedFlag.OccludeAndTransparent),Ga=Ma.queryRenderOccludedState(T.RenderOccludedFlag.Transparent),Na=Ma.queryRenderOccludedState(T.RenderOccludedFlag.Opaque);if(Ua||Ga||Na)pa|=Ua?T.RenderOccludedFlag.OccludeAndTransparent:Ga?T.RenderOccludedFlag.Transparent:T.RenderOccludedFlag.Opaque,Ca.push(Ma)}});const Ea=this._plugins.renderOccludedFlags;if(pa|=Ea){var Ka=Ma=>{this._renderContext.renderOccludedMask=
Ma;Ea>T.RenderOccludedFlag.Occlude&&this._plugins.render(ca.RenderSlot.OCCLUDED_TERRAIN);ua(ca.RenderSlot.OPAQUE_MATERIAL,Ca);ua(ca.RenderSlot.TRANSPARENT_MATERIAL,Ca);ua(ca.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ca);this._renderContext.renderOccludedMask=V.defaultRenderOccludedMask};this._renderContext.output=E.ShaderOutput.Color;ra(.5,T.RenderOccludedFlag.OccludeAndTransparent,()=>Ka(T.RenderOccludedFlag.OccludeAndTransparent),!0,N.StencilBits.OutlineVisualElementMask);ra(.5,T.RenderOccludedFlag.Transparent,
()=>Ka(T.RenderOccludedFlag.Transparent),!0,N.StencilBits.OutlineVisualElementMask);ra(1,T.RenderOccludedFlag.Opaque,()=>Ka(T.RenderOccludedFlag.Opaque),!0,N.StencilBits.OutlineVisualElementMask);Ca.clear()}}_invokeRenderNodes(pa){return this._nodes.render(pa,this._pluginInput,this._releaseNormals)}_renderComposite(pa,Aa){this._offscreen.updateColor(ua=>{this._pluginInput.set("highlights",Aa);ua=this._nodes.render(ua,this._pluginInput,this._releaseNormals);this._pluginInput.set(ua.name,ua);this._pluginInput.delete("highlights");
return ua},"composite-color");const ra=this._plugins.produces(ca.RenderSlot.ANTIALIASING);return this._plugins.render(ra?ca.RenderSlot.ANTIALIASING:ca.RenderSlot.BLIT,this._pluginInput,pa)}_ensureBindParametersCamera(pa,Aa){this._bindParameters.camera=pa;this._bindParameters.contentCamera=Aa}_ensureBindParametersSSR(pa){if(this._bindParameters.ssr.lastFrameColor){null==this._ssrEnableTime&&(this._ssrEnableTime=pa);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=
t.IDENTITY:(p.invert(wa,this._bindParameters.camera.viewMatrix),p.invert(ma,this._bindParameters.camera.projectionMatrix),p.multiply(Ba,wa,ma),p.multiply(Ba,this._renderContext.lastFrameCamera.viewMatrix,Ba),p.multiply(Ba,this._renderContext.lastFrameCamera.projectionMatrix,Ba),this._reprojectionMatrix=Ba);const Aa=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=0<Aa?Math.min(Aa,pa-this._ssrEnableTime)/Aa:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._reprojectionMatrix=
t.IDENTITY,this._ssrEnableTime=null}addRenderNode(pa){this._nodes.add(pa);this._requestRender()}removeRenderNode(pa){this._nodes.remove(pa);this._requestRender()}get usedMemory(){return{fbos:this.fboCache.usedMemory,plugins:this._plugins.usedMemory,edges:this.edgeView?.usedMemory??0}}get test(){return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,renderPlugins:this._plugins,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,
resetRenderStateFeatures:()=>{this._renderStateFeatures.value=W.setupFeatureDefaults();this._plugins.renderFeatureChanged();this._requestRender()},getFramebufferTexture:pa=>{switch(pa){case a.FramebufferId.Color:return this._offscreen.colorTexture;case a.FramebufferId.LinearDepth:return this._bindParameters.linearDepth?.getTexture();case a.FramebufferId.ShadowMap:return this._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return this._bindParameters.hudVisibility?.getTexture()}},debugLinearDepth:pa=>
{this._debugLinearDepth=pa;this._requestRender()}}}}b.__decorate([c.property({readOnly:!0})],qa.prototype,"fullResolutionAtmosphere",null);b.__decorate([c.property()],qa.prototype,"_smaa",void 0);b.__decorate([c.property()],qa.prototype,"_blit",void 0);b.__decorate([c.property()],qa.prototype,"_edgeView",void 0);b.__decorate([c.property()],qa.prototype,"updating",null);var ta;(function(pa){pa[pa.Geometry=0]="Geometry";pa[pa.HUD=1]="HUD"})(ta||={});a.FramebufferId=void 0;(function(pa){pa[pa.Color=
0]="Color";pa[pa.LinearDepth=1]="LinearDepth";pa[pa.ShadowMap=2]="ShadowMap";pa[pa.HudVisibility=3]="HudVisibility"})(a.FramebufferId||(a.FramebufferId={}));const va=[0,0,0,0],Ca=new g,ma=t.create(),wa=t.create(),Ba=t.create();a.Renderer=qa;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/FBOCache":function(){define("exports ../../webgl/formats ../../webgl/ManagedColorAttachment ../../webgl/ManagedDepthAttachment ../../webgl/ManagedFBO ../../webgl/ManagedFBObject ./FBOPool ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/RenderbufferDescriptor ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x{constructor(A){this.rctx=A;this._acquired=new Set;this._cache=new g.FBOPool(A.newCache,"FBOCache");this._depthCache=new g.FBOPool(A.newCache,"DepthAttachmentCache");this._colorCache=new g.FBOPool(A.newCache,"ColorAttachmentCache")}destroy(){this._cache.destroy();this._depthCache.destroy();this._colorCache.destroy()}clean(){this._cache.clean();this._colorCache.clean();this._depthCache.clean()}frameStart(){this._cache.frame();this._colorCache.frame();this._depthCache.frame();
this.debugCallback&&this.debugCallback()}frameEnd(){const A=this.debugCallback;A&&this._acquired.forEach(C=>C.type===m.AttachmentType.FBO&&A(C.name,C.fbo))}get usedMemory(){return Array.from(this._acquired.values()).reduce((A,C)=>A+("getTexture"in C?C.getTexture()?.usedMemory??0:C.usedMemory),this._cache.usedMemory+this._colorCache.usedMemory+this._depthCache.usedMemory)}set interactive(A){this._cache.interactive=this._colorCache.interactive=this._depthCache.interactive=A}acquire(A,C,E,I=b.ColorFormat.RGBA){const H=
`${I}x${A}x${C}`;let J=this._cache.pop(H);J?(J.retain(),J.setName(E)):J=new k(H,E,new d.FramebufferObject(this.rctx,{...D[I],width:A,height:C}),B=>{B??=b.DepthFormat.DEPTH_STENCIL_TEXTURE;B=this._acquireDepth(B,J.fbo.width,J.fbo.height,`${J.name} depth`);J.attachDepth(B);B.release();return J},(B,z)=>{z??=b.ColorFormat.RGBA;z=this._acquireColor(z,A,C,`${J.name} color ${B}`);J.attachColor(z,B);z.release();return J},()=>{this.debugCallback&&this.debugCallback(J.name,J.fbo);this._acquired.delete(J);J.detachAll();
this._cache.put(J)});return this._trackHandle(J)}acquireDepth(A,C,E,I){return this._acquireDepth(A,C,E,I)}_acquireDepth(A,C,E,I){const H=`${A}x${C}x${E}`,J=this._depthCache.pop(H);if(J)return J.retain(),J.name=I,this._trackHandle(J);const B=A===b.DepthFormat.DEPTH_STENCIL_TEXTURE?new h.ManagedDepthAttachment(H,new f.Texture(this.rctx,{...G[A],width:C,height:E}),()=>{this._acquired.delete(B);this._depthCache.put(B)}):new h.ManagedDepthAttachment(H,new c.Renderbuffer(this.rctx,{...G[A],width:C,height:E}),
()=>{this._acquired.delete(B);this._depthCache.put(B)});B.name=I;return this._trackHandle(B)}_acquireColor(A,C,E,I){const H=`${A}x${C}x${E}`,J=this._colorCache.pop(H);if(J)return J.retain(),J.name=I,this._trackHandle(J);const B=new n.ManagedColorAttachment(H,new f.Texture(this.rctx,{...D[A],width:C,height:E}),()=>{this._acquired.delete(B);this._colorCache.put(B)});B.name=I;return this._trackHandle(B)}_trackHandle(A){this._acquired.add(A);return A}}const w=new r.TextureDescriptor;w.pixelFormat=e.PixelFormat.RED;
w.internalFormat=e.SizedPixelFormat.R8;w.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;const p=new r.TextureDescriptor;p.pixelFormat=e.PixelFormat.RG;p.internalFormat=e.SizedPixelFormat.RG8;p.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;const t=new r.TextureDescriptor;t.internalFormat=e.SizedPixelFormat.RGBA4;t.dataType=e.PixelType.UNSIGNED_SHORT_4_4_4_4;t.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;const q=new r.TextureDescriptor;q.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;const u=new r.TextureDescriptor;u.wrapMode=
e.TextureWrapMode.CLAMP_TO_EDGE;u.samplingMode=e.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;u.hasMipmap=!0;u.maxAnisotropy=8;const v=new r.TextureDescriptor;v.pixelFormat=e.PixelFormat.RED;v.dataType=e.PixelType.HALF_FLOAT;v.internalFormat=e.SizedPixelFormat.R16F;v.samplingMode=e.TextureSamplingMode.NEAREST;const y=new r.TextureDescriptor;y.dataType=e.PixelType.HALF_FLOAT;y.internalFormat=e.SizedPixelFormat.RGBA16F;y.samplingMode=e.TextureSamplingMode.NEAREST;const D={[b.ColorFormat.RED]:w,[b.ColorFormat.RG]:p,
[b.ColorFormat.RGBA4]:t,[b.ColorFormat.RGBA]:q,[b.ColorFormat.RGBA_MIPMAP]:u,[b.ColorFormat.R16F]:v,[b.ColorFormat.RGBA16F]:y};r=new r.TextureDescriptor;r.pixelFormat=e.PixelFormat.DEPTH_STENCIL;r.dataType=e.PixelType.UNSIGNED_INT_24_8;r.samplingMode=e.TextureSamplingMode.NEAREST;r.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;const G={[b.DepthFormat.DEPTH_STENCIL_TEXTURE]:r,[b.DepthFormat.DEPTH16_BUFFER]:new l.RenderbufferDescriptor(e.RenderbufferFormat.DEPTH_COMPONENT16,4)};a.FBOCache=x;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedColorAttachment":function(){define(["exports","./ManagedFBOAttachment","./ManagedFBObject"],function(a,b,n){class h extends b.ManagedFBOAttachment{constructor(k,m,g){super(k,m,g);this.attachment=m;this.type=n.AttachmentType.COLOR}}a.ManagedColorAttachment=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBOAttachment":function(){define(["exports","./ManagedFBObject"],function(a,b){class n extends b.ManagedFBObject{constructor(h,
k,m){super(h,m);this.attachment=k;this.name=""}dispose(){this.attachment.dispose()}get usedMemory(){return this.attachment.usedMemory}}a.ManagedFBOAttachment=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBObject":function(){define(["exports"],function(a){class b{constructor(n,h){this.key=n;this.free=h;this.incarnation=0;this._refCount=1}retain(){++this._refCount}release(){if(0===this._refCount)return console.log(`Releasing already released FBO attachment in ${Error().stack}`),
!0;--this._refCount;return 0===this._refCount?(this.free(),!0):!1}}a.AttachmentType=void 0;(function(n){n[n.FBO=0]="FBO";n[n.DEPTH=1]="DEPTH";n[n.COLOR=2]="COLOR"})(a.AttachmentType||(a.AttachmentType={}));a.ManagedFBObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedDepthAttachment":function(){define(["exports","./ManagedFBOAttachment","./ManagedFBObject"],function(a,b,n){class h extends b.ManagedFBOAttachment{constructor(){super(...arguments);this.type=
n.AttachmentType.DEPTH}}a.ManagedDepthAttachment=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/ManagedFBO":function(){define(["../../../core/maybe","./ManagedFBObject","../../webgl/enums"],function(a,b,n){class h extends b.ManagedFBObject{constructor(k,m,g,e,d,c){super(k,c);this.type=b.AttachmentType.FBO;this._colors=new Map;this._name="composite-color";this.acquireColor=this.acquireDepth=null;this._name=m;this.fbo=g;this.acquireDepth=e;this.acquireColor=d}dispose(){this.fbo.dispose()}get usedMemory(){return this.fbo.usedMemory}get name(){return this._name}setName(k){this._name=
k}getTexture(k=n.ColorAttachment.COLOR_ATTACHMENT0){return k===n.DepthStencilAttachment?this.fbo?.depthStencilTexture:this.fbo?.getColorTexture(k)}getAttachment(k=n.ColorAttachment.COLOR_ATTACHMENT0){return k===n.DepthStencilAttachment?this._depth:this._colors.get(k)}attachDepth(k){k?.retain();this.detachDepth();k&&this.fbo.attachDepthStencil(k.attachment);this._depth=k;return this}detachDepth(){this.fbo.detachDepthStencilTexture();this.fbo.detachDepthStencilBuffer();this._depth=a.releaseMaybe(this._depth)}attachColor(k,
m){k.retain();this.detachColor(m);this.fbo.attachColorTexture(k.attachment,m);this._colors.set(m,k);return this}detachColor(k){this.fbo.detachColorTexture(k);const m=this._colors.get(k);this._colors.delete(k);m?.release()}detachAll(){this._colors.forEach((k,m)=>this.detachColor(m));this.detachDepth()}}return h})},"esri/views/3d/webgl-engine/core/FBOPool":function(){define(["exports","../../../../core/MemCachePool","../../../../core/PooledArray"],function(a,b,n){class h{constructor(k,m){this._last=
new n;this._incarnation=0;this._cache=new b.MemCachePool(k,m)}destroy(){this._last?.forAll(k=>k.dispose());this._last=null;this._cache.destroy()}set interactive(k){k&&!this._last?this._last=new n:k||(this._last?.forAll(m=>m.dispose()),this._last=null)}clean(){this._last?.filterInPlace(k=>k.incarnation<this._incarnation?(this._cache.put(k.key,k),!1):!0)}frame(){++this._incarnation}pop(k){if(this._last){const m=this._last.find(g=>g.key===k);if(m)return this._last.removeUnordered(m),m}return this._cache.pop(k)}put(k){k.incarnation=
this._incarnation;this._last?this._last.push(k):this._cache.put(k.key,k)}get usedMemory(){return this._last?.reduce((k,m)=>k+m.usedMemory,0)??0}}a.FBOPool=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/Error ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/math/mat4 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../effects/RenderPlugin ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){a.RenderPassManager=class extends t.SyncPreparesRenderPlugin{constructor(){super({});this._passes=null;this.produces=new Map([[u.RenderSlot.OPAQUE_MATERIAL,G=>this._produces(G)],[u.RenderSlot.TRANSPARENT_MATERIAL,G=>this._passes&&0<this._passes.materialTransparent.count?this._produces(G):!1],[u.RenderSlot.INTEGRATED_MESH,G=>this._produces(G)]]);this._materialPassParameters=new r.MaterialPassParameters;this._shadowPassParameters=new r.ShadowMapPassParameters;
this._highlightPassParameters=new r.HighlightPassParameters;this._systems=new Set}initializeRenderContext(G){this._context=G;const A=G.renderContext.rctx;G=G.techniqueRepository;this._passes={materialOpaque:new x.RenderPass(A,G),materialTransparent:new x.RenderPass(A,G,x.RenderPassSorting.BackToFront),materialIntegratedMesh:new x.RenderPass(A,G),shadowMap:new x.RenderPass(A,G),highlight:new x.RenderPass(A,G),highlightIntegratedMesh:new x.RenderPass(A,G),highlightShadowMap:new x.RenderPass(A,G),defaultShadowMap:new x.RenderPass(A,
G)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null;this._systems.clear()}register(G){this._systems.add(G)}_produces(G){return 0===this._systems.size||null===this._passes?!1:G===w.ShaderOutput.Highlight?0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count:G===w.ShaderOutput.ShadowHighlight?0<this._passes.highlight.count:!0}prepareRender(G){if(0!==this._systems.size&&null!==this._passes){for(const A of Object.values(this._passes))A.prepareSubmit();
this._systems.forEach(A=>A.submit(this._passes,G.bindParameters));for(const A of Object.values(this._passes))A.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(G){if(0===this._systems.size)return null;const A=G.bindParameters;this._updateParameters(A.camera,G.output===w.ShaderOutput.Shadow||G.output===w.ShaderOutput.ShadowHighlight||G.output===w.ShaderOutput.ShadowExcludeHighlight?this._shadowPassParameters:G.output===w.ShaderOutput.Highlight?this._highlightPassParameters:
this._materialPassParameters,A.slot===u.RenderSlot.TRANSPARENT_MATERIAL);this._materialPassParameters.output=G.output;return this._invoke(G,(C,E)=>C.prepare(E,G.bindParameters))}renderNode(G,A){this._invoke(G,(C,E)=>C.dispatch(E,G.bindParameters,A))}_invoke(G,A){if(null===this._passes)return null;switch(G.bindParameters.slot){case u.RenderSlot.OPAQUE_MATERIAL:switch(G.output){case w.ShaderOutput.Color:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialOpaque,
this._materialPassParameters);case w.ShaderOutput.Highlight:return A(this._passes.highlight,this._highlightPassParameters);case w.ShaderOutput.Shadow:return A(this._passes.shadowMap,this._shadowPassParameters);case w.ShaderOutput.ShadowHighlight:return A(this._passes.highlightShadowMap,this._shadowPassParameters);case w.ShaderOutput.ShadowExcludeHighlight:return A(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case u.RenderSlot.TRANSPARENT_MATERIAL:switch(G.output){case w.ShaderOutput.Color:case w.ShaderOutput.Alpha:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialTransparent,
this._materialPassParameters)}break;case u.RenderSlot.INTEGRATED_MESH:switch(G.output){case w.ShaderOutput.Color:case w.ShaderOutput.LinearDepth:case w.ShaderOutput.Normal:case w.ShaderOutput.ObjectAndLayerIdColor:return A(this._passes.materialIntegratedMesh,this._materialPassParameters);case w.ShaderOutput.Highlight:return A(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(G){const A=new q.DepthRange;this._systems.forEach(C=>
q.union(A,C.queryShadowCasterDepthRange(G)));return A}_updateParameters(G,A,C){const E=G.viewInverseTransposeMatrix;l.set(v,E[3],E[7],E[11]);D.set(v);l.copy(A.transformWorldFromViewTH,D.high);l.copy(A.transformWorldFromViewTL,D.low);l.copy(A.slicePlaneLocalOrigin,v);e.fromMat4(A.transformViewFromCameraRelativeRS,G.viewMatrix);c.copy(A.transformProjFromView,G.projectionMatrix);A.identifier===r.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=C,e.transpose(y,A.transformViewFromCameraRelativeRS),
e.invert(A.transformNormalViewFromGlobal,y))}};a.RenderPassManager=b.__decorate([g.subclass("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],a.RenderPassManager);const v=f.create(),y=d.create(),D=new p.TwoVectorPosition;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../core/PooledArray","../../lib/TransparencyPassType","../../../../webgl/enums"],function(a,b,n,h){a.RenderPassSorting=
void 0;(function(g){g[g.FrontToBack=0]="FrontToBack";g[g.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));class k{constructor(g,e,d=a.RenderPassSorting.FrontToBack){this._rctx=g;this._techniqueRepository=e;this._sorting=d;this._draws=new b({initialSize:32,allocator:c=>c||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}submitDraw(g,e,d,c){const l=this._draws.pushNew();l.geometry=e;
l.geometryRanges=d;l.material=g;l.depthSquaredHint=c;l.indexType=(e.indexed?e.vao.indexBuffer.indexType:null)??0}prepare(g,e){return this._draws.map(d=>d.material.prepareTechnique(this._techniqueRepository,g,e,d.geometry.parameters))}dispatch(g,e,d){const c=this._rctx;this._previouslyBoundDraw.clear();let l=null;const f=this._draws.length;for(let w=0;w<f;w++){var r=d[w];if(r!==l||r.configuration.transparencyPassType!==n.TransparencyPassType.NONE)c.bindTechnique(r,e,g),l=r;var x=this._draws.data[w];
const p=x.geometry;c.bindVAO(p.vao);this._previouslyBoundDraw.get(r)!==x.material&&(r.program.bindDraw(x.material,e,g),this._previouslyBoundDraw.set(r,x.material));r=x.geometryRanges;const t=r.length;if(0!==x.indexType){const q=m.get(x.indexType);for(let u=0;u<t;u+=2)c.drawElements(p.primitiveType,r[u+1],x.indexType,r[u]*q)}else for(x=0;x<t;x+=2)c.drawArrays(p.primitiveType,r[x],r[x+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const g=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;
this._draws.sort((e,d)=>{const c=g*(e.depthSquaredHint-d.depthSquaredHint);return 0!==c?c:e.geometry.vao.byteSize-d.geometry.vao.byteSize})}get count(){return this._draws.length}}const m=new Map;m.set(h.DataType.UNSIGNED_BYTE,1);m.set(h.DataType.UNSIGNED_SHORT,2);m.set(h.DataType.UNSIGNED_INT,4);a.RenderPass=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderNodes":function(){define(["exports","../../../../core/Logger","../../../../core/PooledArray",
"../../../webgl/checkWebGLError"],function(a,b,n,h){class k{constructor(m){this._context=m;this._nodes=new n}destroy(){this._nodes.forEach(m=>m.destroy());this._nodes.clear()}add(m){this._nodes.push(m);h.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:g})=>g).join(", ")}`)}remove(m){this._nodes.remove(m);h.hasFeatureFlagWebGLDebug&&console.log(`Registered render nodes: ${this._nodes.map(({declaredClass:g})=>g).join(", ")}`)}produces(m){return this._nodes.some(({produces:g})=>
g===m)}require(m,g){return this._nodes.reduce((e,{consumes:d,produces:c})=>e+(d.required.includes(m)&&c===g?1:0),0)}optional(m,g){return this._nodes.reduce((e,{consumes:d,produces:c})=>e+(d.optional?.includes(m)&&c===g?1:0),0)}updateAnimation(){return this._nodes.reduce((m,g)=>g.updateAnimation()||m,!1)}render(m,g,e){const d=m.name,c=this._nodes.filter(({produces:l})=>l===d);if(0===c.length)return m;c.forEach(l=>{const f=[m];for(var r of l.consumes.required){if(r===d)continue;const x=g.get(r);if(!x){e(f);
return}f.push(x)}if(l.consumes.optional)for(const x of l.consumes.optional)x!==d&&(r=g.get(x))&&f.push(r);try{const x=l.doRender(f,this._context);x&&x!==m&&(m.release(),m=x,g.set(d,m))}catch(x){b.getLogger(l).errorOnce(x)}e(f)});this._context.rctx.enforceState();return m}}a.RenderNodes=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/RenderPluginManager":function(){define("exports ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/signal ../core/shaderLibrary/ShaderOutput ./RenderPlugin ../lib/basicInterfaces ../lib/depthRange ../lib/Material ../lib/RenderSlot".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(f){this._context=f;this._renderPlugins=new b;this._slots=[];this._renderVersion=h.signal(0);for(f=0;f<c.RenderSlot.MAX_SLOTS;++f)this._slots[f]=[]}destroy(){this._renderPlugins.forEach(f=>f.destroy());this._renderPlugins.clear()}get plugins(){return this._renderPlugins}add(f,r){const x=()=>{if(r?.aborted)throw f.uninitializeRenderContext(),n.createAbortError();this._renderPlugins.push(f);f.produces.forEach((p,t)=>{this._slots[t].push(f)});this._context.requestRender();
this._renderVersion.value++},w=f.initializeRenderContext(this._context,r);if(n.isPromiseLike(w))return w.then(x);x()}remove(f){if(null!=this._renderPlugins.removeUnordered(f)){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(x=>x!==f);f.uninitializeRenderContext();this._context.requestRender();this._renderVersion.value++}}prepareRender(){this._renderPlugins.forAll(f=>{f.prepareRender&&f.prepareRender(this._context.renderContext)})}updateAnimation(f){let r=!1;this._renderPlugins.forAll(x=>
{x.updateAnimation&&(r=x.updateAnimation(f)||r)});return r}renderFeatureChanged(){this._renderPlugins.forAll(f=>{f.renderFeatureChanged&&f.renderFeatureChanged()})}prepare(f){this._context.renderContext.bindParameters.slot=f;this._slots[f].forEach(r=>{const x=r.produces.get(f);x&&x(k.ShaderOutput.Color)&&(m.isPrepareRenderPlugin(r)&&r.prepareTechnique(this._context.renderContext),m.isPreparesRenderPlugin(r)&&r.prepareTechniques(this._context.renderContext))})}_getRenderables(f){this._context.renderContext.bindParameters.slot=
f;const r=this._context.renderContext.output??k.ShaderOutput.Color,x=new Map;this._slots[f].forEach(w=>{var p=w.produces.get(f);!p||!p(r)||w.isDecoration&&this._context.renderContext.bindParameters.decorations===g.Decorations.OFF||(m.isPrepareRenderPlugin(w)?(p=w.prepareTechnique(this._context.renderContext),null!=p&&x.set(w,p)):m.isPreparesRenderPlugin(w)?(p=w.prepareTechniques(this._context.renderContext),null!=p&&x.set(w,p)):x.set(w,null))});return x}render(f,r=null,x=null){this._getRenderables(f).forEach((w,
p)=>x=p.renderNode(this._context.renderContext,w,r,x));return x}queryDepthRange(f){const r=new e.DepthRange;this._renderPlugins.forAll(x=>{x=x.queryDepthRange?.(f);e.union(r,x)});return r}get updating(){return 0<=this._renderVersion.value&&this._renderPlugins.some(f=>f.running)}produces(f,r=k.ShaderOutput.Color){return this._slots[f].some(x=>(x=x.produces.get(f))?x(r):!1)}consumes(f){return this._renderPlugins.some(r=>r.consumes().required.includes(f))}getMaterialRenderer(f){return this._renderPlugins.find(r=>
r.materialReference===f)}removeEmptyMaterialRenderers(){this._renderPlugins.filterInPlace(f=>f.materialReference&&0===f.numGeometries?(f.destroy(),!1):!0)}get hasDecorations(){return this._renderPlugins.some(f=>f.isDecoration)}get hasOccludees(){return this._renderPlugins.some(f=>f.hasOccludees)}get renderOccludedFlags(){return this._renderPlugins.reduce((f,r)=>f|r.renderOccludedFlags,d.RenderOccludedFlag.None)}get usedMemory(){return this._renderPlugins.reduce((f,r)=>null!==r.materialReference?f:
f+(r.usedMemory??0),0)}get test(){return{plugins:this._renderPlugins}}}a.RenderPluginManager=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/blit/Blit":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../RenderPlugin ../../lib/RenderSlot ../../../../../chunks/Compositing.glsl ../../shaders/CompositingTechnique ../../shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){a.Blit=class extends e.SyncRenderPlugin{constructor(r){super(r);this._context=null;this.opacity=1;this.alphaMode=f.AlphaMode.None;this._blitConfiguration=new f.CompositingTechniqueConfiguration;this._blitParameters=new c.CompositingPassParameters;this.produces=new Map([[d.RenderSlot.BLIT,()=>null!=this._context]])}consumes(){return e.ConsumesCompositeColor}initializeRenderContext(r){this._context=r}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(r,
x,w,p){x=w?.get("composite-color")?.getTexture();if(!this._context||!x)return p;w=this._context.techniqueRepository.acquire(l.CompositingTechnique,this._blitConfiguration);if(!w?.compiled)return this._context.requestRender(),p;r.rctx.bindFramebuffer(p?.fbo);this._blitParameters.texture=x;this._blitParameters.opacity=this.opacity;r.rctx.bindTechnique(w,r.bindParameters,this._blitParameters);r.rctx.screen.draw();w.release();return p}};b.__decorate([n.property()],a.Blit.prototype,"_context",void 0);
b.__decorate([n.property()],a.Blit.prototype,"opacity",void 0);b.__decorate([n.property()],a.Blit.prototype,"alphaMode",void 0);a.Blit=b.__decorate([g.subclass("esri.views.3d.webgl-engine.effects.blit.Blit")],a.Blit);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/Highlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/has ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/vec2 ../../../webgl/formats ../RenderPlugin ./HighlightApplyTechnique ./HighlightBlurTechnique ./HighlightDefaults ./HighlightDownsampleTechnique ./HighlightPassParameters ../../lib/DefaultVertexAttributeLocations ../../lib/DefaultVertexBufferLayouts ../../lib/RenderSlot ../../lib/VertexArrayObject ../../../../../chunks/HighlightBlur.glsl ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I){a.Highlight=class extends r.SyncRenderPlugin{constructor(H){super(H);this._context=null;this._passParameters=new q.HighlightPassParameters;this._downsampleDrawParameters=new A.HighlightDownsampleDrawParameters;this._blurDrawParameters=new G.HighlightBlurDrawParameters;this._blurColorFormat=h("mac")?f.ColorFormat.RGBA:f.ColorFormat.RGBA4;this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0};
this.produces=new Map([[y.RenderSlot.HIGHLIGHT,()=>!0]])}consumes(){return r.ConsumesHighlight}initializeRenderContext(H){this._context=H;null==this._blurTechnique&&(this._blurTechnique=this._context.techniqueRepository.acquire(w.HighlightBlurTechnique));null==this._downsampleTechnique&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(t.HighlightDownsampleTechnique));null==this._applyTechnique&&(this._applyTechnique=this._context.techniqueRepository.acquire(x.HighlightApplyTechnique));
this.addHandles([m.watch(()=>this.view.highlightOptions.color,J=>{this._passParameters.color=n.unitRGBAFromColor(J??p.defaultColor);this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color);this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloColor,J=>{this._passParameters.haloColor=null!=J?n.unitRGBAFromColor(J):this._passParameters.color;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.haloOpacity,
J=>{this._passParameters.haloOpacity=J??p.defaultHaloOpacity;this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity;this._context.requestRender()},m.syncAndInitial),m.watch(()=>this.view.highlightOptions.fillOpacity,J=>{this._passParameters.fillOpacity=J??p.defaultFillOpacity;this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity;this._context.requestRender()},m.syncAndInitial)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=
k.releaseMaybe(this._blurTechnique);this._downsampleTechnique=k.releaseMaybe(this._downsampleTechnique);this._applyTechnique=k.releaseMaybe(this._applyTechnique);this._grid.coverage=k.releaseMaybe(this._grid.coverage);this._grid.vao=k.disposeMaybe(this._grid.vao)}renderNode(H,J,B,z){var K=B?.get("highlights")?.getTexture();if(this._context&&K)if(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled){J=H.bindParameters.camera;var L=J.pixelRatio;B=Math.ceil(J.fullWidth/
L);L=Math.ceil(J.fullHeight/L);var F=this._context.fbos,M=F.rctx;this._gridUpdateResources(K);this._gridComputeCoverage(K,H.bindParameters);this._passParameters.highlightTexture=K;this._passParameters.coverageTexture=this._grid.coverage?.getTexture();var {width:S,height:N}=K.descriptor;l.set(this._passParameters.coverageRounding,S/(Math.ceil(S/A.gridCellPixelSize)*A.gridCellPixelSize),N/(Math.ceil(N/A.gridCellPixelSize)*A.gridCellPixelSize));var P=this._grid.vao;M.bindVAO(P);var R=F.acquire(B,L,"highlight blur",
this._blurColorFormat);M.unbindTexture(R.fbo.colorTexture);M.bindFramebuffer(R.fbo);M.setClearColor(0,0,0,0);M.clearSafe(E.ClearBufferBit.COLOR_BUFFER_BIT);M.setViewport(0,0,B,L);this._blurDrawParameters.blurInputTexture=K;l.set(this._blurDrawParameters.blurSize,1/B,0);K=M.bindTechnique(this._blurTechnique,H.bindParameters,this._passParameters,this._blurDrawParameters);M.drawArrays(this._blurTechnique.primitiveType,0,I.vertexCount(P,"geometry"));B=F.acquire(B,L,"highlight blur",this._blurColorFormat);
M.unbindTexture(B.fbo.colorTexture);M.bindFramebuffer(B.fbo);M.setClearColor(0,0,0,0);M.clearSafe(E.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=R.getTexture();l.set(this._blurDrawParameters.blurSize,0,1/L);K.bindDraw(this._blurDrawParameters,H.bindParameters,this._passParameters);M.drawArrays(this._blurTechnique.primitiveType,0,I.vertexCount(P,"geometry"));M.bindFramebuffer(z?.fbo);M.setViewport4fv(J.fullViewport);this._passParameters.blurTexture=B.getTexture();M.bindTechnique(this._applyTechnique,
H.bindParameters,this._passParameters);M.drawArrays(this._applyTechnique.primitiveType,0,I.vertexCount(P,"geometry"));R.release();B.release()}else this._context.requestRender()}_gridUpdateResources(H){if(this._context){var J=this._context.fbos.rctx,B=this._grid,z=Math.ceil(H.descriptor.height/A.gridCellPixelSize),K=Math.ceil(H.descriptor.width/A.gridCellPixelSize);if(!B.vao||B.verticalCellCount!==z||B.horizontalCellCount!==K){B.verticalCellCount=z;B.horizontalCellCount=K;H=z+1;var L=K+1;z=1/z;K=1/
K;var F=new Float32Array(24*H*L),M=0;for(let S=0;S<H;S++)for(let N=0;N<L;N++)F[M++]=(N-.5)*K*2-1,F[M++]=(S-.5)*z*2-1,F[M++]=N*K,F[M++]=S*z,F[M++]=(N+.5)*K*2-1,F[M++]=(S-.5)*z*2-1,F[M++]=N*K,F[M++]=S*z,F[M++]=(N-.5)*K*2-1,F[M++]=(S+.5)*z*2-1,F[M++]=N*K,F[M++]=S*z,F[M++]=(N-.5)*K*2-1,F[M++]=(S+.5)*z*2-1,F[M++]=N*K,F[M++]=S*z,F[M++]=(N+.5)*K*2-1,F[M++]=(S-.5)*z*2-1,F[M++]=N*K,F[M++]=S*z,F[M++]=(N+.5)*K*2-1,F[M++]=(S+.5)*z*2-1,F[M++]=N*K,F[M++]=S*z;B.vao?.dispose();B.vao=new D.VertexArrayObject(J,u.Default3D,
{geometry:v.Pos2Tex},{geometry:C.BufferObject.createVertex(J,E.Usage.STATIC_DRAW,F)})}}}_gridComputeCoverage(H,J){if(this._context){var B=this._context.fbos.rctx,z=this._grid,K=H.descriptor,L=Math.ceil(K.width/A.gridCellPixelSize);K=Math.ceil(K.height/A.gridCellPixelSize);this._downsampleDrawParameters.input=H;z.coverage?.release();z.coverage=this._context.fbos.acquire(L,K,"highlight coverage",f.ColorFormat.RG);B.unbindTexture(z.coverage.fbo.colorTexture);B.bindFramebuffer(z.coverage.fbo);B.bindTechnique(this._downsampleTechnique,
J,this._passParameters,this._downsampleDrawParameters);B.setViewport(0,0,L,K);B.screen.draw()}}get test(){return{coverage:this._grid.coverage}}};b.__decorate([g.property()],a.Highlight.prototype,"_context",void 0);b.__decorate([g.property()],a.Highlight.prototype,"view",void 0);a.Highlight=b.__decorate([c.subclass("esri.views.3d.webgl-engine.effects.highlight.Highlight")],a.Highlight);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightApplyTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightApply.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends h.ShaderTechnique{initializeProgram(l){return new m.Program(l.rctx,c.shader.get().build(),k.Default3D)}initializePipeline(){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}}c.shader=new n.ReloadableShaderModule(g.HighlightApply,()=>new Promise((l,f)=>a(["../../shaders/HighlightApply.glsl"],l,
f)));b.HighlightApplyTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec42 ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ./HighlightDownsample.glsl".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(){const r=new g.ShaderBuilder,{vertex:x,fragment:w}=r,p=x.code,t=w.code;r.attributes.add(d.VertexAttribute.POSITION,"vec2");r.varyings.add("uv","vec2");r.attributes.add(d.VertexAttribute.UV0,"vec2");x.uniforms.add(new e.Texture2DPassUniform("coverageTex",q=>q.coverageTexture),new h.Float2PassUniform("coverageRounding",q=>q.coverageRounding));p.add(m.glsl`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);w.uniforms.add(new e.Texture2DPassUniform("tex",q=>q.blurTexture),new e.Texture2DPassUniform("highlightTexture",q=>q.highlightTexture),new k.Float4PassUniform("uColor",q=>q.color),new k.Float4PassUniform("haloColor",q=>q.haloColor),new k.Float4PassUniform("opacities",q=>b.set(f,q.haloOpacity,q.haloOpacityOccluded,q.fillOpacity,q.fillOpacityOccluded)));w.constants.add("inner","float",1-(c.outlineSize-c.blurSize)/c.outlineSize);t.add(m.glsl`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return r}const f=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:l},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=n;a.build=l})},"esri/chunks/HighlightDownsample.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform"],function(a,b,n,h,
k){function m(){const d=new h.ShaderBuilder,{outputs:c,fragment:l}=d;d.include(b.ScreenSpacePass);l.uniforms.add(new k.Texture2DDrawUniform("textureInput",f=>f.input));l.constants.add("sampleArea","int",5);c.add("fragGrid","vec2");l.code.add(n.glsl`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${n.glsl.int(32)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -sampleArea; x < cellSize + sampleArea; x += 2) {
        for(int y = -sampleArea; y < cellSize + sampleArea; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`);return d}class g extends n.NoParameters{}const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:g,blurSize:.4,build:m,gridCellPixelSize:32,outlineSize:9},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=e;a.HighlightDownsampleDrawParameters=g;a.blurSize=.4;a.build=m;a.gridCellPixelSize=32;a.outlineSize=9})},"esri/views/3d/webgl-engine/effects/highlight/HighlightBlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightBlur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.HighlightBlur,()=>new Promise((c,l)=>a(["../../shaders/HighlightBlur.glsl"],c,l)));b.HighlightBlurTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d){function c(){const r=new m.ShaderBuilder,{attributes:x,varyings:w,vertex:p,fragment:t}=r;x.add(d.VertexAttribute.POSITION,"vec2");x.add(d.VertexAttribute.UV0,"vec2");w.add("blurCoordinate","vec3");p.uniforms.add(new e.Texture2DPassUniform("coverageTex",q=>q.coverageTexture),new h.Float2PassUniform("coverageRounding",q=>q.coverageRounding));p.code.add(k.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`);t.uniforms.add(new n.Float2DrawUniform("blurSize",q=>q.blurSize),new g.Texture2DDrawUniform("tex",q=>q.blurInputTexture));t.code.add(k.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`);return r}class l extends k.NoParameters{constructor(){super(...arguments);this.blurSize=b.create()}}const f=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:l,build:c},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=f;a.HighlightBlurDrawParameters=l;a.build=c})},"esri/views/3d/webgl-engine/effects/highlight/HighlightDownsampleTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/HighlightDownsample.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.HighlightDownsample,()=>new Promise((c,l)=>a(["../../shaders/HighlightDownsample.glsl"],c,l)));b.HighlightDownsampleTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/HighlightPassParameters":function(){define(["exports",
"../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../core/shaderModules/interfaces"],function(a,b,n,h){class k extends h.NoParameters{constructor(){super(...arguments);this.color=n.fromValues(1,0,1,1);this.haloColor=n.fromValues(1,0,1,1);this.haloOpacity=1;this.haloOpacityOccluded=.25;this.fillOpacity=.2;this.fillOpacityOccluded=.05;this.coverageRounding=b.fromValues(1,1)}}a.HighlightPassParameters=k;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlight":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/colorUtils ../../../../../core/mathUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../ViewingMode ../RenderPlugin ./HighlightDefaults ./ShadowHighlightTechnique ../../lib/RenderSlot".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){a.ShadowHighlight=class extends x.SyncRenderPlugin{constructor(u){super(u);this._maxOpacity=1;this._passParameters=new p.ShadowHighlightPassParameters;this._shadowDifference=.2;this._context=null;this.produces=new Map([[t.RenderSlot.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return x.ConsumesHighlight}initializeRenderContext(u){this._context=u;this.addHandles([k.watch(()=>this.view.highlightOptions.shadowOpacity,v=>{this._passParameters.shadowOpacity=
v??w.defaultShadowOpacity;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowDifference,v=>{this._shadowDifference=v??w.defaultShadowDifference;this._updateOccludedShadowOpacity();this._updateMaxOpacity()},k.syncAndInitial),k.watch(()=>this.view.highlightOptions.shadowColor,v=>{this._passParameters.shadowColor=n.unitRGBAFromColor(v??w.defaultShadowColor);this._updateMaxOpacity()},k.syncAndInitial)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=
this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&null==this._technique&&(this._technique=this._context.techniqueRepository.acquire(p.ShadowHighlightTechnique))}renderNode(u,v,y,D){y=y?.get("highlights")?.getTexture();this._context&&y&&this._isVisible&&(this._technique?.compiled?
(v=u.bindParameters,v.shadowMap.enabled&&v.linearDepth&&(this._passParameters.highlight=y,this._passParameters.origin=v.camera.center,u=u.rctx,u.bindFramebuffer(D?.fbo),u.bindTechnique(this._technique,v,this._passParameters),u.screen.draw())):this._context.requestRender())}updateParameters(u,v){this._passParameters.opacityElevation=1-h.smoothstep(4E4,5E4,u.relativeElevation);u=this.viewingMode===r.ViewingMode.Global?l.normalize(q,u.center):l.set(q,0,0,1);v=l.dot(u,v);this._passParameters.dayNightTerminator=
h.smoothstep(0,1,h.clamp(30*v,0,1));this._isVisible&&this.enable()}get _isVisible(){const {opacityElevation:u,dayNightTerminator:v}=this._passParameters;return.001953125<=this._maxOpacity*u*v}};b.__decorate([m.property()],a.ShadowHighlight.prototype,"_context",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"view",void 0);b.__decorate([m.property()],a.ShadowHighlight.prototype,"viewingMode",void 0);a.ShadowHighlight=b.__decorate([c.subclass("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],
a.ShadowHighlight);const q=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/highlight/ShadowHighlightTechnique":function(){define("require exports ../../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../shaders/ShadowConfiguration ../../../../../chunks/ShadowHighlight.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){class r extends h.ReadShadowMapPassParameters{constructor(){super(...arguments);this.shadowColor=n.fromValues(1,0,1,1);this.shadowOpacity=.2;this.occludedShadowOpacity=.1;this.dayNightTerminator=this.opacityElevation=1}}class x extends m.ShaderTechnique{constructor(w){super(w,new d.ShadowConfiguration,()=>this.destroy())}initializeProgram(w){return new e.Program(w.rctx,x.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){return f.makePipelineState({blending:f.separateBlendingParams(l.BlendFactor.SRC_ALPHA,
l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return l.PrimitiveType.TRIANGLE_STRIP}}x.shader=new k.ReloadableShaderModule(c.ShadowHighlight,()=>new Promise((w,p)=>a(["../../shaders/ShadowHighlight.glsl"],w,p)));b.ShadowHighlightPassParameters=r;b.ShadowHighlightTechnique=x;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports",
"../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.receiveShadows=!0}}b.__decorate([n.parameter()],h.prototype,"receiveShadows",void 0);a.ShadowConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(A){const C=new q.ShaderBuilder;C.include(d.ReadShadowMapPass,A);C.include(c.CameraSpace);C.include(m.ScreenSpacePass);A=C.fragment;A.include(l.RgbaFloatEncoding);A.include(e.ReadLinearDepth);A.uniforms.add(new u.Texture2DPassUniform("defaultDepthTex",(E,I)=>I.shadowMap.getSnapshot(v.SnapshotSlot.ExcludeHighlight)),new u.Texture2DPassUniform("highlightDepthTex",(E,I)=>I.shadowMap.getSnapshot(v.SnapshotSlot.Highlight)),new u.Texture2DPassUniform("depthMap",
(E,I)=>I.linearDepth?.getTexture()),new u.Texture2DPassUniform("highlightTexture",E=>E.highlight),new x.Float4PassUniform("uColor",E=>E.shadowColor),new f.Float2PassUniform("nearFar",(E,I)=>I.camera.nearFar),new w.FloatPassUniform("opacity",E=>E.shadowOpacity),new w.FloatPassUniform("occludedOpacity",E=>E.occludedShadowOpacity),new w.FloatPassUniform("terminationFactor",E=>E.opacityElevation*E.dayNightTerminator),new r.Float3PassUniform("lightingMainDirectionView",(E,I)=>h.normalize(G,h.transformMat4(G,
I.lighting.mainLight.direction,I.camera.viewInverseTransposeMatrix))),new t.Matrix4PassUniform("inverseViewMatrix",(E,I)=>b.invert(D,b.translate(D,I.camera.viewMatrix,I.camera.center))));A.constants.add("unoccludedHighlightFlag","vec4",g.unoccludedHighlightFlag);A.code.add(p.glsl`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${p.glsl.float(.99999)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);
      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;
      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${p.glsl.float(.025)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `);return C}const D=n.create(),G=k.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=n;a.build=y})},"esri/views/3d/webgl-engine/effects/smaa/SMAA":function(){define("require exports ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/Logger ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../../webgl/formats ../RenderPlugin ./SMAABlendWeightsTechnique ./SMAABlurTechnique ./SMAAEdgeDetectTechnique ./SMAAPassParameters ../../lib/RenderFeature ../../lib/RenderSlot ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(C,E,I,H){const J=new G.TextureDescriptor;J.pixelFormat=I;J.wrapMode=y.TextureWrapMode.CLAMP_TO_EDGE;J.width=H.width;J.height=H.height;J.samplingMode=E;return new D.Texture(C,J,H)}b.SMAA=class extends x.SyncRenderPlugin{constructor(C){super(C);this._searchTexture=this._areaTexture=this._context=null;this._isEnabled=!1;this._smaaParameters=new q.SMAAPassParameters;this.produces=new Map([[v.RenderSlot.ANTIALIASING,()=>this._isEnabled&&
null!=this._context]])}consumes(){return x.ConsumesCompositeColor}get updating(){return null!=this._abortController}initializeRenderContext(C){this._context=C;this.addHandles([m.watch(()=>this.view.qualitySettings.antialiasingEnabled,()=>this.renderFeatureChanged(),m.syncAndInitial)])}renderFeatureChanged(){this.view.qualitySettings.antialiasingEnabled||this._context?.isFeatureEnabled(u.RenderFeature.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable();this._context=
null}async enable(){if(!this._isEnabled&&this._context&&!this._abortController)if(this._edgeTechnique??(this._edgeTechnique=this._context.techniqueRepository.acquire(t.SMAAEdgeDetectTechnique)),this._blendTechnique??(this._blendTechnique=this._context.techniqueRepository.acquire(w.SMAABlendWeightsTechnique)),this._blurTechnique??(this._blurTechnique=this._context.techniqueRepository.acquire(p.SMAABlurTechnique)),this._areaTexture&&this._searchTexture)this._isEnabled=!0;else{this._abortController=
new AbortController;var C=this._abortController.signal;try{const E=await new Promise((I,H)=>a(["./SMAAData"],I,H));await this._loadTextures(this._context,E,C);this._context?.requestRender()}catch{}this._abortController=null}}async _loadTextures(C,E,I){k.throwIfAborted(I);if(!C)throw k.createAbortError();const [H,J]=await Promise.allSettled([f.requestImage(E.areaTexture,{signal:I}),f.requestImage(E.searchTexure,{signal:I})]);k.throwIfAborted(I);"fulfilled"===H.status&&"fulfilled"===J.status&&(this._areaTexture=
A(C.fbos.rctx,y.TextureSamplingMode.LINEAR,y.PixelFormat.RGB,H.value),this._searchTexture=A(C.fbos.rctx,y.TextureSamplingMode.NEAREST,y.PixelFormat.LUMINANCE,J.value),this._isEnabled=!0)}_disposeTextures(){this._areaTexture=h.disposeMaybe(this._areaTexture);this._searchTexture=h.disposeMaybe(this._searchTexture)}disable(){this._abortController=h.abortMaybe(this._abortController);this._isEnabled=!1}destroy(){this.disable();this._disposeTextures()}renderNode(C,E,I,H){E=I?.get("composite-color")?.getTexture();
if(!(this._isEnabled&&this._context&&I&&E))return H;if(!(this._edgeTechnique?.compiled&&this._blendTechnique?.compiled&&this._blurTechnique?.compiled))return this._context.requestRender(),H;I=E.descriptor.width;const J=E.descriptor.height,B=this._context.fbos;C=C.rctx;C.setViewport(0,0,I,J);const z=B.acquire(I,J,"smaa edges",r.ColorFormat.RG);C.unbindTexture(z.fbo.colorTexture);C.bindFramebuffer(z.fbo);C.setClearColor(0,0,0,1);C.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.color=
E;C.bindTechnique(this._edgeTechnique,null,this._smaaParameters);C.screen.draw();E=B.acquire(I,J,"smaa blend");C.unbindTexture(E.fbo.colorTexture);C.bindFramebuffer(E.fbo);C.setClearColor(0,0,1,1);C.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=z.getTexture();this._smaaParameters.areaTexture=this._areaTexture;this._smaaParameters.searchTexture=this._searchTexture;C.bindTechnique(this._blendTechnique,null,this._smaaParameters);C.screen.draw();C.bindFramebuffer(H?.fbo);
z.release();C.setClearColor(0,1,0,1);C.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._smaaParameters.inputTexture=E.getTexture();C.bindTechnique(this._blurTechnique,null,this._smaaParameters);C.screen.draw();E.release();return H}};n.__decorate([g.property()],b.SMAA.prototype,"view",void 0);n.__decorate([g.property()],b.SMAA.prototype,"_context",void 0);n.__decorate([g.property()],b.SMAA.prototype,"_abortController",void 0);n.__decorate([g.property({readOnly:!0})],b.SMAA.prototype,"updating",null);
b.SMAA=n.__decorate([l.subclass("esri.views.3d.webgl-engine.effects.smaa.SMAA")],b.SMAA);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlendWeightsTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/BlendWeights.glsl ../../../../webgl/renderState".split(" "),function(a,
b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.BlendWeights,()=>new Promise((c,l)=>a(["../../shaders/BlendWeights.glsl"],c,l)));b.SMAABlendWeightsTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){function m(){const d=new h.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new k.Texture2DPassUniform("edgesTexture",c=>c.inputTexture),new k.Texture2DPassUniform("areaTexture",c=>c.areaTexture),new k.Texture2DPassUniform("searchTexture",c=>c.searchTexture));d.fragment.code.add(n.glsl`
    #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
    #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

    vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
      return texture(tex, coord + offset.x * resolution, 0.0);
    }

    float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
      e.r = bias + e.r * scale;
      return 255.0 * texture( searchTex, e, 0.0 ).r;
    }

    float searchLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${n.glsl.int(g.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x += 0.25 * resolution.x;
      texcoord.x += resolution.x;
      texcoord.x += 2.0 * resolution.x;
      texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
      return texcoord.x;
    }

    float searchRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 0.0, 1.0 );
      for ( int i = 0; i < ${n.glsl.int(g.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 2.0, 0.0 ) * resolution;
        if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
      }
      texcoord.x -= 0.25 * resolution.x;
      texcoord.x -= resolution.x;
      texcoord.x -= 2.0 * resolution.x;
      texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
      return texcoord.x;
    }

    float searchUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${n.glsl.int(g.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord += vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y -= 0.25 * resolution.y;
      texcoord.y -= resolution.y;
      texcoord.y -= 2.0 * resolution.y;
      texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
      return texcoord.y;
    }

    float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
      vec2 e = vec2( 1.0, 0.0 );
      for ( int i = 0; i < ${n.glsl.int(g.maxSearchSteps)}; i ++ ) {
        e = texture( edgesTex, texcoord, 0.0 ).rg;
        texcoord -= vec2( 0.0, 2.0 ) * resolution;
        if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
      }
      texcoord.y += 0.25 * resolution.y;
      texcoord.y += resolution.y;
      texcoord.y += 2.0 * resolution.y;
      texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
      return texcoord.y;
    }

    vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
      vec2 texcoord = float( ${n.glsl.int(g.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
      texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
      texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
      return texture( areaTex, texcoord, 0.0 ).rg;
    }

    void main() {
      vec2 size = vec2(textureSize(edgesTexture, 0));
      vec2 resolution = 1.0 / size;
      vec2 pixelCoord = uv * size;
      vec4 offsets[2];
      offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
      offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
      vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${n.glsl.int(g.maxSearchSteps)} );

      ivec4 subsampleIndices = ivec4(0.0);
      vec4 weights = vec4(0.0);
      vec2 e = texture( edgesTexture, uv ).rg;
      if ( e.g > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.x = searchLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
        coords.y = offsets[1].y;
        d.x = coords.x;
        float e1 = texture( edgesTexture, coords, 0.0 ).r;
        coords.x = searchRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
        d.y = coords.x;
        d = d * size.x - pixelCoord.x;
        vec2 sqrt_d = sqrt( abs(d) );
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
        weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
      }

      if ( e.r > 0.0 ) {
        vec2 d;
        vec2 coords;
        coords.y = searchUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
        coords.x = offsets[0].x;
        d.x = coords.y;
        float e1 = texture( edgesTexture, coords, 0.0 ).g;
        coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
        d.y = coords.y;
        d = d * size.y - pixelCoord.y;
        vec2 sqrt_d = sqrt(abs(d));
        coords.y -= 1.0 * resolution.y;
        float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
        weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

        // for some reason the following lines are necessary to prevent
        // texture lookup precision issues on some Intel integrated graphics chips
        vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
        weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
      }
      fragColor = weights;
    }`);return d}const g={maxSearchSteps:8,maxDistanceAreaTex:16},e=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=e;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAABlurTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/Blur.glsl ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.Blur,()=>new Promise((c,l)=>a(["../../shaders/Blur.glsl"],c,l)));b.SMAABlurTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){function m(){const e=new h.ShaderBuilder;e.include(b.ScreenSpacePass);e.fragment.uniforms.add(new k.Texture2DPassUniform("blendWeightsTexture",d=>d.inputTexture),new k.Texture2DPassUniform("colorTexture",d=>d.color));e.fragment.code.add(n.glsl`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`);return e}const g=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.Blur=g;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAEdgeDetectTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../lib/DefaultVertexAttributeLocations ../../lib/Program ../../../../../chunks/EdgeDetect.glsl ../../../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e){class d extends h.ShaderTechnique{initializeProgram(c){return new m.Program(c.rctx,
d.shader.get().build(),k.Default3D)}initializePipeline(){return e.makePipelineState({colorWrite:e.defaultColorWriteParams})}}d.shader=new n.ReloadableShaderModule(g.EdgeDetect,()=>new Promise((c,l)=>a(["../../shaders/EdgeDetect.glsl"],c,l)));b.SMAAEdgeDetectTechnique=d;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform"],function(a,b,n,h,k){function m(){const d=new h.ShaderBuilder;d.include(b.ScreenSpacePass);d.fragment.uniforms.add(new k.Texture2DPassUniform("colorTexture",c=>c.color));d.outputs.add("fragEdges","vec2");d.fragment.code.add(n.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${n.glsl.float(g.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${n.glsl.float(g.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `);return d}const g={threshold:.05,localConstrastAdaption:2},e=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=e;a.build=m})},"esri/views/3d/webgl-engine/effects/smaa/SMAAPassParameters":function(){define(["exports","../../core/shaderModules/interfaces"],function(a,b){class n extends b.NoParameters{}a.SMAAPassParameters=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,b,n,h){class k{constructor(){this._step=e;this._dilation=1;this._firstIdleTime=h.Milliseconds(0)}frame(c,l){l?0===this._firstIdleTime&&(this._firstIdleTime=h.Milliseconds(performance.now())):this._firstIdleTime=h.Milliseconds(0);if(b("disable-feature:high-quality-idle"))this._dilation=1;else{l=l?performance.now()-this._firstIdleTime:0;if(l>=m+g){this._step=h.Milliseconds(Infinity);this._dilation=1;return}this._dilation=
l>=m?10:1}c=n.clamp(c/.5,e,d);this._step=Infinity===this._step?h.Milliseconds(c):h.Milliseconds(.9*this._step+c*(1-.9))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=h.Milliseconds(0)}}const m=h.Milliseconds(12E4),g=h.Milliseconds(1E4),e=h.Milliseconds(1E3),d=h.Milliseconds(1E3/30);a.AnimationTimeStep=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../webgl/formats ./rendererUtils ./TransparencyPassType ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l{constructor(r,x){this._fbos=r;this.compositingHelper=x;this._height=this._width=4;this._clearColor=k.create()}dispose(){this._color=n.releaseMaybe(this._color);this.releaseBuffers()}get framebuffer(){this.color.attachDepth(this.depth);return this.color.fbo}get colorTexture(){return this.color.getTexture()}get depthTexture(){return this.depth.attachment}initializeFrame(r,x,w){this._fbos.interactive=w===g.RendererTarget.Default;w=this._fbos.rctx;this._width=r.fullWidth;
this._height=r.fullHeight;c.ensureAttachmentMaxSize(this,w.parameters.maxTextureSize);r=this._color;this._color=null;this.releaseBuffers();h.copy(this._clearColor,x);return r}releaseBuffers(){this._color?.detachDepth();this._depth=n.releaseMaybe(this._depth)}renderHUDVisibility(r,x,w){if(r?.fbo.width!==this._width||r?.fbo.height!==this._height)r?.release(),r=this._fbos.acquire(this._width,this._height,"hud visibility",m.ColorFormat.RGBA4);r.attachDepth(w||this.depth);this._fbos.rctx.bindFramebuffer(r.fbo);
this._fbos.rctx.clearFramebuffer(f);x();r.detachDepth();return r}compositeToHUDVisibility(r,x){this._fbos.rctx.bindFramebuffer(r.hudVisibility?.fbo);this.compositingHelper.compositeHUD(r,x)}renderOITPass(r,x,w){let p,t;const {_width:q,_height:u}=this;switch(x){case e.TransparencyPassType.Color:p=this._fbos.acquire(q,u,w?"oit hud color":"oit color",m.ColorFormat.RGBA16F);t=[0,0,0,0];break;case e.TransparencyPassType.Alpha:p=this._fbos.acquire(q,u,w?"oit hud alpha":"oit alpha",m.ColorFormat.R16F);t=
[1,1,1,1];break;case e.TransparencyPassType.FrontFace:p=this._fbos.acquire(q,u,w?"oit hud front":"oit front"),t=[0,0,0,0]}w?p.acquireDepth(m.DepthFormat.DEPTH16_BUFFER):p.attachDepth(this.depth);this._fbos.rctx.bindFramebuffer(p.fbo);this._fbos.rctx.clearFramebuffer(t,w,w);r();p.detachDepth();return p}compositeToFramebuffer(r,x,w,p){this.bindFbo();this.compositingHelper.composite(r,x,w,p)}compositeTransparentOntoOpaque(r,x,w,p,t){t?(this._fbos.rctx.bindFramebuffer(t.fbo),this._fbos.rctx.setClearColor(0,
0,0,1E-13),this._fbos.rctx.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFbo();this.compositingHelper.compositeOIT(r,x.getTexture(),w.getTexture(),p.getTexture())}renderDepthDetached(r){this._bindTarget(this.color);r();this._bindTarget(this.color,this.depth)}renderToCachedFBO(r,x,w,p,t=m.ColorFormat.RGBA,q=m.DepthFormat.DEPTH16_BUFFER,u=this._width,v=this._height,y=null){if(r?.fbo.width!==u||r?.fbo.height!==v)r=n.releaseMaybe(r);r=r??this._fbos.acquire(u,v,x,t);y?.forEach(D=>r.acquireColor(D.attachment,
D.format));null!=q&&r.acquireDepth(q);this._fbos.rctx.bindFramebuffer(r.fbo);this._fbos.rctx.clearFramebuffer(p,!0,!0);w();return r}renderToTargets(r,x,w,p,t=!1,q=!1){this._bindTarget(x,w);this._fbos.rctx.clearFramebuffer(p,t,q);r();x.detachDepth()}bindFbo(){var r=null==this._color;this._bindTarget(this.color,this.depth);r&&(r=this._fbos.rctx,r.setClearStencil(0),r.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),r.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT|
d.ClearBufferBit.DEPTH_BUFFER_BIT|d.ClearBufferBit.STENCIL_BUFFER_BIT))}_bindTarget(r,x){r.attachDepth(x);this._fbos.rctx.bindFramebuffer(r.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._ensureColor()}_ensureColor(){this._color||(this._color=this._fbos.acquire(this._width,this._height,"composite-color"));return this._color}updateColor(r,x){const w=this._ensureColor();w.attachDepth(this.depth);w.setName(x);this._color=r(w)}get depth(){this._depth||(this._depth=
this._fbos.acquireDepth(m.DepthFormat.DEPTH_STENCIL_TEXTURE,this._width,this._height,"depth"));return this._depth}}const f=[0,1,0,1];a.OffscreenRendering=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../core/shaderLibrary/shading/ReadShadowMap.glsl ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E){a.ShadowAccumulator=class extends n{constructor(H,J,B,z,K,L){super({});this.fbos=H;this._stage=B;this._prepareForShadowMapPass=z;this._renderToShadowMap=K;this._requestRender=L;this._sampleCount=this._progress=0;this._passParameters=new x.ReadShadowMapPassParameters;this._cachedLightDirections=[];this._depthRange=p.zero;this._cameraForcedForScreenshot=this._previewing=!1;this._shadowAccumulatorKey="shadowAccumulator";this._rctx=H.rctx;
this._bindParameters=new w.BindParameters(new u.ShadowMap(H,B.viewingMode),null);this._bindParameters.shadowMap.enabled=!0;this._vao=t.createQuadVAO(this._rctx);this._accumulationRenderer=new q.ShadowCastRenderer(J,this._rctx,this,L);this.addHandles([this._stage.view.resourceController.scheduler.registerTask(D.TaskPriority.SHADOW_ACCUMULATOR,this),g.watch(()=>B.renderView,F=>{this.removeHandles("renderView");null!=F&&this.addHandles(F.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=
!0),"renderView")},g.syncAndInitial),g.watch(()=>this._previewing,()=>this._requestRenderIfEnabled(),g.sync)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable();this.removeHandles(this._shadowAccumulatorKey);this._accumulationRenderer=m.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=m.disposeMaybe(this._fbo);this._vao=m.disposeMaybe(this._vao);this._accumulationTechniqueCached=m.releaseMaybe(this._accumulationTechniqueCached);
this._sampleCount=this._cachedLightDirections.length=0}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo?.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){null==this._accumulationTechniqueCached&&(this._accumulationTechniqueCached=new y.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&
!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return null!=this._fbo&&0<this._sampleCount}get canAccumulate(){return null!==this._bindParameters.linearDepth?.getTexture()&&this._depthRange!==p.zero&&this._opacityFromElevation>q.shadowCastDisabledElevationThreshold}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(H){const J=this._cachedLightDirections;if(!h.equals(J,
H,f.equals)){var B=Math.min(v.ShadowCastMaxSamples,H.length);this._sampleCount=J.length=B;for(let z=0;z<B;++z)J[z]=f.copy(J[z]??r.create(),H[z]);this._invalidate()}}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(H){this._accumulationRenderer.opacityFromElevation=H}get running(){return this._isRefining&&this.canAccumulate&&0<this._progress}runTask(H){for(this._prepareForShadowMapPass(this._bindParameters);!H.done&&!this._isDoneAccumulating;)this._accumulateShadow(),
H.madeProgress();this._requestRender()}renderAccumulation(H,J,B,z){this._depthRange=J;this._updateCamera(B);this._bindParameters.contentCamera=z;this._bindParameters.linearDepth=H;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();H=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);
for(J=0;J<H;++J)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}}render(H){this._accumulationRenderer.render(H)}setOptions(H){void 0!==H.enabled&&H.enabled!==(null!=this._fbo)&&(H.enabled?this._enable():this._disable());void 0!==H.previewing&&(this._previewing=H.previewing);void 0!==H.lightDirections&&(this._lightDirections=H.lightDirections);this._accumulationRenderer.setOptions(H)}readAccumulatedShadow(H,J){if(!this._isActive||!this._fbo||1>this._progress||0>H||
H>=this._fbo.width||0>J||J>=this._fbo.height)return 0;this._fbo.readPixels(H,J,1,1,G.PixelFormat.RED,G.PixelType.UNSIGNED_BYTE,I);return I[0]/this._progress}_enable(){this._progress=0;const H=new C.TextureDescriptor;H.pixelFormat=G.PixelFormat.RED;H.internalFormat=G.SizedPixelFormat.R8;H.wrapMode=G.TextureWrapMode.CLAMP_TO_EDGE;this._fbo=new A.FramebufferObject(this._rctx,H);this._requestRender()}_disable(){this._fbo=m.disposeMaybe(this._fbo);this._requestRender()}_invalidate(){this._progress=0;this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo);
this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(G.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const H=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(H,this._bindParameters,this._passParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(H.primitiveType,0,E.vertexCount(this._vao,"geometry"))}_updateCamera(H){const J=
this._fbo;if(null!=J){var B=this._bindParameters.camera;H.equals(B)||B.copyFrom(H);J.resize(H.fullWidth,H.fullHeight);this._opacityFromElevation=1-k.smoothstep(q.shadowCastDisableElevationMin,q.shadowCastDisableElevationMax,H.relativeElevation)}}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const H=this;return{lightDirections:this._lightDirections,get isDone(){return H._isDoneAccumulating},get isActive(){return H._isActive}}}};b.__decorate([e.property()],a.ShadowAccumulator.prototype,
"_progress",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_fbo",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isRefining",null);
b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isActive",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_opacityFromElevation",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],
a.ShadowAccumulator);const I=new Uint8Array(1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec42 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){const p=1/512;a.ShadowCastRenderer=class extends n{constructor(t,q,u,v){super({});this._techniqueRepository=t;this._rctx=q;this._data=u;this._requestRender=v;this._passParameters=new f.ShadowCastVisualizePassParameters(this._data);this._techniqueConfig=new x.ShadowCastVisualizeTechniqueConfiguration;this._enabled=!1;this._vao=l.createQuadVAO(q)}normalizeCtorArgs(){return{}}dispose(){this._stop();this._vao=h.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);
this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(r.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}render(t){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var q=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(q,t,this._passParameters);this._rctx.drawArrays(q.primitiveType,0,w.vertexCount(this._vao,"geometry"))}}setOptions(t){void 0!==
t.enabled&&this._setEnabled(t.enabled);void 0!==t.color&&this._setColor(t.color);void 0!==t.threshold&&(this._threshold=t.threshold);void 0!==t.visualization&&(this._visualization=t.visualization);void 0!==t.bandSize&&(this._bandSize=t.bandSize);void 0!==t.bandsEnabled&&(this._bandsEnabled=t.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(t){this._passParameters.opacityFromElevation!==t&&(this._passParameters.opacityFromElevation=
t,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>p}get _threshold(){return this._passParameters.threshold}set _threshold(t){this._threshold!==t&&(this._passParameters.threshold=t,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(t){t!==this._visualization&&(this._techniqueConfig.visualization=t,this._techniqueRepository.release(this._technique),
this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(t){t!==this._bandSize&&(this._passParameters.bandSize=t,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(t){t!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=t,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(t){c.exactEquals(t,this._passParameters.color)||
(c.copy(this._passParameters.color,t),this._requestRenderIfRunning())}_setEnabled(t){t!==this._enabled&&(t?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0;this._requestRender()}_stop(){this._enabled=!1;this._requestRender()}};b.__decorate([k.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);
a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../core/libs/gl-matrix-2/factories/vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(q){const u=new c.ShaderBuilder,v=u.fragment;v.include(m.RgbaFloatEncoding);v.include(h.ReadLinearDepth);u.include(k.CameraSpace);u.include(n.ScreenSpacePass);const {visualization:y,bandsEnabled:D}=q;v.constants.add("inverseSampleValue","float",f.ShadowCastMaxSamples);v.uniforms.add(new l.Texture2DPassUniform("shadowCastMap",A=>A.shadowCastMap),new e.FloatPassUniform("sampleScale",A=>A.sampleScale),new e.FloatPassUniform("opacityFromElevation",A=>A.opacityFromElevation),
new g.Float4PassUniform("uColor",A=>A.color));q=y===r.ShadowCastVisualization.Gradient;const G=y===r.ShadowCastVisualization.Threshold;q&&D?v.uniforms.add(new e.FloatPassUniform("bandSize",A=>A.bandSize)):G&&v.uniforms.add(new e.FloatPassUniform("threshold",A=>A.threshold));v.code.add(d.glsl`
    void main(void) {
      float record = texture(shadowCastMap, uv).r;
      float pixelSamples = record * inverseSampleValue;
      if (pixelSamples < 1.0) {
        discard;
      }

      float strength = pixelSamples * sampleScale;

      ${G?d.glsl`
          if (strength <= threshold) {
            discard;
          }`:""}

      ${q&&D?d.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

      fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${q?d.glsl`* strength`:""});
    }
  `);return u}class w extends d.NoParameters{constructor(q){super();this._data=q;this.sampleScale=0;this.opacityFromElevation=1;this.color=b.clone(p);this.bandSize=.1;this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}}const p=b.fromValues(.01,0,.25,1),t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:w,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=t;a.ShadowCastVisualizePassParameters=w;a.build=x})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(t){const q=new f.ShaderBuilder,u=q.fragment;u.include(e.RgbaFloatEncoding);u.include(k.ReadLinearDepth);q.include(g.CameraSpace);q.include(h.ScreenSpacePass);q.include(m.ReadShadowMapPass,t);u.uniforms.add(new r.Texture2DPassUniform("shadowMap",(v,y)=>y.shadowMap.depthTexture),new r.Texture2DPassUniform("depthMap",(v,y)=>y.linearDepth?.getTexture()),new l.Matrix4PassUniform("inverseViewMatrix",(v,y)=>b.invert(p,b.translate(p,y.camera.viewMatrix,y.camera.center))),
new d.Float2PassUniform("nearFar",(v,y)=>y.camera.nearFar));u.constants.add("sampleValue","float",w);q.outputs.add("sampleCount","float");u.code.add(c.glsl`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMap, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMap);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`);return q}const w=1/255,p=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:255,build:x},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=n;a.ShadowCastMaxSamples=255;a.build=x})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,n){a.ShadowCastVisualization=void 0;(function(k){k[k.Gradient=
0]="Gradient";k[k.Threshold=1]="Threshold";k[k.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));class h extends n.ShaderTechniqueConfiguration{constructor(){super(...arguments);this.visualization=a.ShadowCastVisualization.Gradient;this.bandsEnabled=!1}}b.__decorate([n.parameter({count:a.ShadowCastVisualization.COUNT})],h.prototype,"visualization",void 0);b.__decorate([n.parameter()],h.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=h;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends h.ShaderTechnique{constructor(f,r){super(f,
r,()=>this.destroy())}initializeProgram(f){return new g.Program(f.rctx,l.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return c.makePipelineState({blending:m.blendingDefault,colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return d.PrimitiveType.TRIANGLE_STRIP}}l.shader=new n.ReloadableShaderModule(e.ShadowCastVisualize,()=>new Promise((f,r)=>a(["./ShadowCastVisualize.glsl"],f,r)));b.ShadowCastVisualizeTechnique=l;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends h.ShaderTechnique{constructor(f){super(f,new e.ShadowConfiguration,
()=>this.destroy())}initializeProgram(f){return new m.Program(f.rctx,l.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return c.makePipelineState({blending:c.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE,d.BlendFactor.ONE),colorWrite:c.defaultColorWriteParams,depthTest:null,depthWrite:null})}get primitiveType(){return d.PrimitiveType.TRIANGLE_STRIP}}l.shader=new n.ReloadableShaderModule(g.ShadowCastAccumulate,()=>new Promise((f,r)=>a(["./ShadowCastAccumulate.glsl"],
f,r)));b.ShadowCastAccumulateTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/boundedPlane"],function(a){const b=a.create();class n{constructor(){this._plane=a.create()}get isEnabled(){return!a.equals(this.plane,b)}get plane(){return this._plane}set plane(h){a.copy(h||b,this._plane)}}return n})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../../chunks/vec32 ../../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../../core/support/UpdatingHandles ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../Attribute ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T){function Q(Y){null!=Y&&(Y.vao.vertexBuffers.instances.dispose(),Y.vao.disposeVAOOnly(),Y.vao=null)}function V(Y){let Z=null,ja=null;for(let oa=0;oa<Y.geometries.length;oa++){const qa=Y.geometries[oa];if(qa.material.supportsEdges){if(!Z)Z=qa.transformation;else if(!h.equals(Z,qa.transformation))return!1;if(!ja&&null!=qa.localOrigin)ja=qa;else if(null!=ja?.localOrigin&&null!=qa.localOrigin&&ja.localOrigin.id!==
qa.localOrigin.id)return!1}}return!0}function U(Y,Z,ja){Z*=ja;ja=h.binaryIndexOf(Y,Z,!0);return-1===ja?Z<Y[0]?Y.length:0:Y.length-ja}a.EdgeView=class extends n{constructor(Y){super(Y);this._updatingHandles=new p.UpdatingHandles;this._perObjectData=new Map;this._perObjectDataEvictionCache=new Set;this._renderers=new Map;this._gpuMemoryUsage=0;this._workerAbort=new AbortController;this._tmpModelPosition=w.create();this._localOrigins=new C.LocalOriginManager(new G.GridLocalOriginFactory(Y.renderSR))}initialize(){this._worker=
new F.EdgeWorkerHandle(this.schedule);this._componentColorManager=new P.BufferManager(this.rctx,3);const Y=J.VertexLayout.createBuffer(4);for(let Z=0;4>Z;Z++)Y.sideness.set(Z,0,0===Z||3===Z?0:1),Y.sideness.set(Z,1,0===Z||1===Z?0:1);this._verticesBufferObject=O.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,Y.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(Y=>this._discardObjectEntry(Y)),this._perObjectData.clear(),this._strokesTexture=g.disposeMaybe(this._strokesTexture),this._componentColorManager=
g.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=g.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",ha))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return 0<this._renderers.size}async addComponentObject(Y,Z,ja,oa,qa,ta){if(this.hasObject(Y))return this.getObjectMemoryUsage(Y);let va;const Ca=
new W(new Promise(ma=>va=ma),Y.obb.center,Y.obb.radius);this._perObjectData.set(Y,Ca);Y=await this._updatingHandles.addPromise(this._addComponentGeometry(Y.transform,Ca,Z,ja,oa,qa,ta));this.setNeedsRender();va();return Y}async addOrUpdateObject3D(Y,Z,ja,oa){if(this.destroyed)k.getLogger(this).warn("Attempt to add an object to a destroyed instance");else{var qa=this._perObjectData.get(Y);0<qa?.renderables.length&&this._perObjectDataEvictionCache.add(qa);var ta,va=Y.boundingVolumeWorldSpace.bounds;
va=new W(new Promise(ma=>ta=ma),t.getCenter(va),t.getRadius(va));this._perObjectData.set(Y,va);var Ca=[];if(ja.mergeGeometries&&1<Y.geometries.length&&V(Y))Ca.push(this._addObjectMergedGeometries(Y,va,Z,ja,oa));else for(let ma=0;ma<Y.geometries.length;ma++){const wa=Y.geometries[ma];wa.material.supportsEdges&&Ca.push(this._addGeometry(Y,va,wa,Z[0],ja,oa))}await this._updatingHandles.addPromise(Promise.all(Ca));this._perObjectDataEvictionCache.delete(va);this._discardObjectEntry(qa);this.setNeedsRender();
ta()}}fastUpdateObject3DEdgesTransform(Y){if(this.destroyed)return!1;var Z=this._perObjectData.get(Y);if(!Z)return!1;var {geometries:ja}=Y;({renderables:Z}=Z);if(0===ja.length||0===Z.length)return!0;if(1<Z.length)return!1;[Z]=Z;var oa=Z.transform;if(!(oa instanceof ba))return!1;[ja]=ja;if(ja.localOrigin!==oa.origin.origin)return!1;oa=r.create();Y=this._computeModelTransformWithLocalOrigin(Y,ja,oa);Z.transform=new ba(oa,Y);this.setNeedsRender();return!0}_discardObjectEntry(Y){Y&&(Y.renderables.length&&
(Y.renderables.forEach(Z=>this._removeRenderable(Z)),this.setNeedsRender()),Y.loaded=null)}hasObject(Y){return this._perObjectData.has(Y)}async updateAllComponentOpacities(Y,Z){Y=await this._updatingHandles.addPromise(this._getObjectEntry(Y));if(null!=Y){var ja=Z instanceof Array?oa=>Z[oa]:()=>Z;Y.renderables.forEach(oa=>{const qa=oa.components.meta.length;for(let ta=0;ta<qa;ta++){const va=ja(ta),Ca=oa.components.meta[ta],ma=Ca.index;Ca.material.opacity=va;oa.components.buffer.textureBuffer.setDataElement(ma,
1,3,255*va)}this._updateTransparency(oa)});this.setNeedsRender()}}async getObjectMemoryUsage(Y){Y=await this._getObjectEntry(Y);return null!=Y?Y.renderables.reduce((Z,ja)=>Z+ja.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(Y,Z,ja,oa){const qa=Y instanceof E.Object3D,ta=!!ja.hasSlicePlane,va=N.determineRendererType(Z),Ca=K.EdgeRenderer.getKey(va,ta,qa);Y=await this._updatingHandles.addPromise(this._getObjectEntry(Y));null!=Y&&(Y.renderables.forEach(ma=>{if(Ca!==ma.rendererKey){var wa=
this._renderers.get(ma.rendererKey);const Ba=this._acquireRenderer(va,ta,qa);wa.removeRenderable(ma);--wa.refCount;ma.rendererKey=Ca;Ba.addRenderable(ma)}for(wa=0;wa<Z.length;wa++)ma.components.meta[wa].material=Z[wa];oa&&this._updateComponentBuffer(ma.components);this._updateTransparency(ma)}),this.setNeedsRender())}async updateAllVerticalOffsets(Y,Z){Y=await this._updatingHandles.addPromise(this._getObjectEntry(Y));null!=Y&&(Y.renderables.forEach(ja=>{const oa=ja.components.meta;for(let qa=0;qa<
oa.length;qa++)ja.components.meta[qa].verticalOffset=Z?.[qa]??0;this._updateComponentBuffer(ja.components)}),this.setNeedsRender())}async updateObjectVisibility(Y,Z){Y=await this._updatingHandles.addPromise(this._getObjectEntry(Y));null!=Y&&(Y.renderables.forEach(ja=>ja.visible=Z),this.setNeedsRender())}removeObject(Y){const Z=this._perObjectData.get(Y);Z&&(this._perObjectData.delete(Y),this._discardObjectEntry(Z))}async _getObjectEntry(Y){Y=this._perObjectData.get(Y);if(!Y)throw Error("no object");
await Y.loaded;return null==Y.loaded?null:Y}render(Y,Z){if(null!=this._componentColorManager){this._localOrigins.updateViewMatrices(Y.camera.viewMatrix);var ja=Y.camera.viewInverseTransposeMatrix,oa=w.create(),qa=new y.TwoVectorPosition,ta=0,va=0;this._renderers.forEach(ma=>{if(0===ma.refCount)this._renderers.delete(ma.key),ma.dispose();else{var wa=!0,Ba=!0;ma.forEachRenderable(pa=>{pa.visible&&(ta+=pa.statistics.averageEdgeLength,va++,wa&&pa.regular&&(ma.updateTechnique(Y,!1),wa=!1),Ba&&pa.silhouette&&
(ma.updateTechnique(Y,!0),Ba=!1))},Z)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==va){var Ca=new L.EdgePassParameters(40*ta/va,Z);x.set(oa,ja[3],ja[7],ja[11]);qa.set(oa);x.copy(Ca.transformWorldFromViewTH,qa.high);x.copy(Ca.transformWorldFromViewTL,qa.low);l.fromMat4(Ca.transformViewFromCameraRelativeRS,Y.camera.viewMatrix);l.transpose(ea,Ca.transformViewFromCameraRelativeRS);l.invert(Ca.transformNormalViewFromGlobal,ea);Ca.transformProjFromView=
Y.camera.projectionMatrix;this._updateObjectCameraDistances(Y);this._renderers.forEach(ma=>{this._renderRegularEdges(ma,Y,Ca);this._renderSilhouetteEdges(ma,Y,Ca)})}}}_updateTransparency(Y){const Z=N.determineEdgeTransparency(Y.components.meta),ja=N.determineObjectTransparency(Y.components.meta);if(Z!==Y.edgeTransparency||ja!==Y.objectTransparency)Y.edgeTransparency=Z,Y.objectTransparency=ja,this._renderers.get(Y.rendererKey).setRenderablesDirty()}_computeModelTransformWithLocalOrigin(Y,Z,ja){Y.getCombinedShaderTransformation(Z,
ja);Y=null!=Z.localOrigin?this._localOrigins.register(Z.localOrigin):this._localOrigins.acquire(x.set(this._tmpModelPosition,ja[12],ja[13],ja[14]));Z.localOrigin=Y.origin;A.applyToModelMatrix(Y.origin.vec3,ja);return Y}_updateComponentBuffer(Y){const {meta:Z,buffer:ja}=Y;Y=new Uint8Array(4);for(let qa=0;qa<Z.length;qa++){var oa=Z[qa].material;const ta=Z[qa].index,va=m.clamp(Math.round(oa.size*K.lineWidthFractionFactor),0,255),Ca=m.clamp(oa.extensionLength,-K.extensionLengthOffset,255-K.extensionLengthOffset)+
K.extensionLengthOffset,ma="solid"===oa.type?z.EdgeType.SOLID:z.EdgeType.SKETCH,wa=255*oa.opacity;oa=oa.color;ja.textureBuffer.setData(ta,0,255*oa[0],255*oa[1],255*oa[2],255*oa[3]);ja.textureBuffer.setData(ta,1,va,Ca,ma,wa);v.encodeElevationOffset(Z[qa].verticalOffset,Y);ja.textureBuffer.setData(ta,2,Y[0],Y[1],Y[2],Y[3])}}_createComponentBuffers(Y){if(null==this._componentColorManager)return null;const Z=[],ja=this._componentColorManager.getBuffer(Y.length);for(let oa=0;oa<Y.length;oa++){const qa=
Y[oa],ta=ja.acquireIndex();Z.push({index:ta,verticalOffset:0,material:qa})}Y=new ca(ja,Z);this._updateComponentBuffer(Y);return Y}_extractEdges(Y,Z,ja,oa,qa,ta=qa.length){return this._worker.process({data:Z,indices:qa,indicesLength:ta,writerSettings:Y,skipDeduplicate:ja},this._workerAbort.signal,oa)}_createRenderable(Y,Z,ja,oa,qa){var ta=Ca=>null!=this._verticesBufferObject?new X(new I.VertexArrayObject(this.rctx,J.EdgeShaderAttributeLocations,{vertices:J.glVertexLayout,instances:Ca===R.EdgeSilhouette.REGULAR?
B.RegularEdgeBufferWriter.glLayout:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:O.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,Ca===R.EdgeSilhouette.REGULAR?Y.regular.instancesData.buffer:Y.silhouette.instancesData.buffer)}),Ca===R.EdgeSilhouette.REGULAR?Y.regular.lodInfo:Y.silhouette.lodInfo):null;const va=0<Y.regular.lodInfo.lengths.length?ta(R.EdgeSilhouette.REGULAR):null;ta=0<Y.silhouette.lodInfo.lengths.length?ta(R.EdgeSilhouette.SILHOUETTE):
null;return new ia(va,ta,{gpuMemoryUsage:(va?.vao.usedMemory??0)+(ta?.vao.usedMemory??0),externalMemoryUsage:qa,averageEdgeLength:Y.averageEdgeLength},ja,N.determineEdgeTransparency(Z.meta),N.determineObjectTransparency(Z.meta),Z,oa)}async _addGeometry(Y,Z,ja,oa,qa,ta){if(!(0>=ja.edgeIndicesLength)){var va=ja.attributes.get(H.VertexAttribute.POSITION),Ca=r.create();Y=this._computeModelTransformWithLocalOrigin(Y,ja,Ca);va=new aa(va,Ca,Y);return this._addPositionData(Z,va,ja.edgeIndicesLength,oa,qa,
ta)}}async _addPositionData(Y,Z,ja,oa,qa,ta=!1){if(null!=Y.loaded){var va=this._createComponentBuffers([oa]);if(null!=va){oa=this._acquireRenderer(oa.type,!!qa.hasSlicePlane,!0);var {modelTransform:Ca,origin:ma}=Z;qa=Z.position.indices;Z=Z.position;var wa=Z.data.length/Z.size,Ba=J.EdgeInputBufferLayout.createBuffer(wa);for(let pa=0;pa<wa;pa++)Ba.position.set(pa,0,Z.data[pa*Z.size]),Ba.position.set(pa,1,Z.data[pa*Z.size+1]),Ba.position.set(pa,2,Z.data[pa*Z.size+2]);N.fillComponenBufferIndices(va.meta,
[0,Ba.componentIndex.count],Ba.componentIndex);ja=await this._updatingHandles.addPromise(this._extractEdges(oa.writerSettings,Ba,!1,ta,qa,ja));null!=Y.loaded&&(va=this._createRenderable(ja,va,new ba(Ca,ma),oa.key,!1),Y.renderables.push(va),oa.addRenderable(va),this._gpuMemoryUsage+=va.statistics.gpuMemoryUsage)}}}async _addComponentGeometry(Y,Z,ja,oa,qa,ta,va){if(null==Z.loaded)return 0;const Ca=this._createComponentBuffers(ta);if(null==Ca)return 0;ta=N.determineRendererType(ta);va=this._acquireRenderer(ta,
va.hasSlicePlane||!1,!1);ta=J.EdgeInputBufferLayout.createBuffer(ja.length/3);q.copy(ta.position.typedBuffer,ja,ta.position.typedBufferStride,3);N.fillComponenBufferIndices(Ca.meta,qa,ta.componentIndex,oa);ja=await this._updatingHandles.addPromise(this._extractEdges(va.writerSettings,ta,!0,!1,oa));if(null==Z.loaded)return 0;Y=this._createRenderable(ja,Ca,Y,va.key,!0);Z.renderables.push(Y);va.addRenderable(Y);return Y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(Y,Z,ja,oa,qa){const ta=
new Map;let va=0,Ca=null,ma=0;var wa=Y.geometries.filter(ua=>{if(0>=ua.edgeIndicesLength||!ua.material.supportsEdges)return!1;!Ca&&ua.localOrigin&&(Ca=ua);const Ea=ua.attributes.get(H.VertexAttribute.POSITION);ma+=Ea.data.length/Ea.size;va+=ua.edgeIndicesLength;return!0});if(0!==wa.length){var Ba=65536<=ma?Uint32Array:Uint16Array,pa=va?new Ba(va):null,Aa=[],ra=0;wa.forEach(ua=>{var Ea=ua.attributes.get(H.VertexAttribute.POSITION);const Ka=Ea.indices;let Ma=ta.get(Ea.data);if(null==Ma){Ma=Aa.length/
3;for(let Ua=0;Ua<Ea.data.length;Ua+=Ea.size)Aa.push(Ea.data[Ua]),Aa.push(Ea.data[Ua+1]),Aa.push(Ea.data[Ua+2]);ta.set(Ea.data,Ma)}for(Ea=0;Ea<ua.edgeIndicesLength;Ea++)pa[ra++]=Ma+Ka[Ea]});Ba=Ca||Y.geometries[0];wa=r.create();Ba=this._computeModelTransformWithLocalOrigin(Y,Ba,wa);for(let ua=0;ua<Y.geometries.length;ua++)Y.geometries[ua].localOrigin=Ba.origin;Y=new aa(new D.Attribute(Aa,pa,3),wa,Ba);await this._updatingHandles.addPromise(this._addPositionData(Z,Y,pa.length,ja[0],oa,qa))}}_acquireRenderer(Y,
Z,ja){const oa=K.EdgeRenderer.getKey(Y,Z,ja);let qa=this._renderers.get(oa);null==this._strokesTexture&&(this._strokesTexture=S.generateStrokesTexture(this.rctx));qa||(qa=new K.EdgeRenderer(this.rctx,this.techniqueRepository,{type:Y,hasSlicePlane:Z,strokesTexture:this._strokesTexture,legacy:ja,spherical:this.viewingMode===u.ViewingMode.Global}),this._renderers.set(oa,qa));++qa.refCount;return qa}_removeRenderable(Y){Q(Y.regular);Q(Y.silhouette);const Z=this._renderers.get(Y.rendererKey);if(Z){Z.removeRenderable(Y);
--Z.refCount;"origin"in Y.transform&&this._localOrigins.release(Y.transform.origin);this._gpuMemoryUsage-=Y.statistics.externalMemoryUsage?0:Y.statistics.gpuMemoryUsage;for(const ja of Y.components.meta)Y.components.buffer.releaseIndex(ja.index)}}_updateObjectCameraDistances(Y){const Z=Y.camera.eye,ja=Y.camera.viewForward,oa=w.create();Y=qa=>{x.sub(oa,qa.center,Z);const ta=x.dot(oa,ja),va=qa.radius,Ca=ta<-va?Infinity:ta<va?0:ta-va;qa.renderables.forEach(ma=>ma.distanceToCamera=Ca)};this._perObjectData.forEach(Y);
this._perObjectDataEvictionCache.forEach(Y)}_renderRegularEdges(Y,Z,ja){const oa=Y.bindRegularEdges(ja,Z),qa=Z.camera.perScreenPixelRatio;Y.forEachRenderable(ta=>{if(null!=ta.regular&&ta.visible){var va=U(ta.regular.lod.lengths,ta.distanceToCamera,qa);Y.renderRegularEdges(oa,ta,ja,Z,va)}},ja.transparency)}_renderSilhouetteEdges(Y,Z,ja){const oa=Y.bindSilhouetteEdges(ja,Z),qa=Z.camera.perScreenPixelRatio;Y.forEachRenderable(ta=>{if(null!=ta.silhouette&&ta.visible){var va=U(ta.silhouette.lod.lengths,
ta.distanceToCamera,qa);Y.renderSilhouetteEdges(oa,ta,ja,Z,va)}},ja.transparency)}get test(){return{hasRenderedPrimitives:Y=>{let Z=!1;const ja=Y.perScreenPixelRatio,oa=(qa,ta)=>qa.forEachRenderable(va=>{va.visible&&!Z&&(null!=va.regular&&(Z=0<U(va.regular.lod.lengths,va.distanceToCamera,ja)),Z||null==va.silhouette||(Z=0<U(va.silhouette.lod.lengths,va.distanceToCamera,ja)))},ta);this._renderers.forEach(qa=>{Z||(oa(qa,M.Transparency.OPAQUE),oa(qa,M.Transparency.TRANSPARENT))});return Z},getObjectData:Y=>
this._perObjectData.get(Y)}}};b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([e.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([e.property({constructOnly:!0})],
a.EdgeView.prototype,"schedule",void 0);b.__decorate([e.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);b.__decorate([e.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);class W{constructor(Y,Z,ja){this.radius=ja;this.renderables=[];this.loaded=Y;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)});this.center=w.clone(Z)}}class ca{constructor(Y,Z){this.buffer=
Y;this.meta=Z}}class X{constructor(Y,Z){this.vao=Y;this.lod=Z}}class ba{constructor(Y,Z){this.modelMatrix=Y;this.origin=Z}}class ia{constructor(Y,Z,ja,oa,qa,ta,va,Ca){this.regular=Y;this.silhouette=Z;this.statistics=ja;this.transform=oa;this.edgeTransparency=qa;this.objectTransparency=ta;this.components=va;this.rendererKey=Ca;this.distanceToCamera=0;this.visible=!0}}class fa extends ia{}class da extends ia{}class aa{constructor(Y,Z,ja){this.position=Y;this.modelTransform=Z;this.origin=ja}}const ea=
f.create(),ha=()=>Promise.reject();a.LegacyTransform=ba;a.RegularRenderable=fa;a.Renderable=ia;a.SilhouetteRenderable=da;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,n){const h=-b[0],k=-b[1];b=-b[2];const m=n[3],g=n[7],e=n[11],d=n[15];n[0]+=m*h;n[1]+=m*k;n[2]+=m*b;n[4]+=g*h;n[5]+=g*k;n[6]+=g*b;n[8]+=e*h;n[9]+=e*k;n[10]+=e*b;n[12]+=d*h;n[13]+=d*k;n[14]+=d*
b};a.applyToViewMatrix=function(b,n){const h=b[0],k=b[1];b=b[2];n[12]+=h*n[0]+k*n[4]+b*n[8];n[13]+=h*n[1]+k*n[5]+b*n[9];n[14]+=h*n[2]+k*n[6]+b*n[10];n[14]+=h*n[3]+k*n[7]+b*n[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","./localOriginHelper"],function(a,b,n,h){class k{constructor(g){this._factory=
g;this._originData=new Map}acquire(g){return this.register(this._factory.getOrigin(g))}register(g){g=this._originData.get(g.id)||new m(g);g.refCount++;this._originData.has(g.origin.id)||this._originData.set(g.origin.id,g);return g}release(g){g.refCount--;0===g.refCount&&this._originData.delete(g.origin.id)}updateViewMatrices(g){this._originData.forEach(e=>{b.copy(e.viewMatrix,g);h.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})}}class m{constructor(g){this.origin=g;this.refCount=0;this.viewMatrix=
n.create()}}a.LocalOriginManager=k;a.OriginData=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/math/mat3 ../../../../../core/libs/gl-matrix-2/factories/mat3f32 ../../../../../chunks/vec32 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){const w={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},p={solid:r.EdgeUtilMode.SOLID,sketch:r.EdgeUtilMode.SKETCH,uber:r.EdgeUtilMode.MIXED};class t{constructor(u,v,y){this._rctx=u;this._shaderTechniqueRepository=v;this._configuration=new l.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[f.Transparency.TRANSPARENT]:{[f.Transparency.TRANSPARENT]:new n,[f.Transparency.OPAQUE]:new n},
[f.Transparency.OPAQUE]:{[f.Transparency.TRANSPARENT]:new n,[f.Transparency.OPAQUE]:new n}};this._renderablesDirty=!1;this._drawParameters=new d.EdgeDrawParameters;this._settings={...w,...y};this.key=t.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:g.debugFlags.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=p[this._settings.type];
this._configuration.silhouette=!1;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=u.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=y.spherical}dispose(){this._technique=b.releaseMaybe(this._technique)}addRenderable(u){this._renderables.add(u);this._renderablesDirty=!0}removeRenderable(u){this._renderables.delete(u);this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(u,
v){this._renderablesDirty&&this._sortRenderables();v=this._sortedRenderables[v];v[f.Transparency.TRANSPARENT].forAll(u);v[f.Transparency.OPAQUE].forAll(u)}updateTechnique(u,v){this._configuration.multipassEnabled=!!u.multipassEnabled;this._configuration.cullAboveGround=!!u.multipassTerrain.cullAboveGround;this._configuration.silhouette=v;return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(c.EdgeShaderTechnique,this._configuration,this._technique)}bindRegularEdges(u,v){this._lastOriginId=
null;return this._rctx.bindTechnique(this.updateTechnique(v,!1),v,u)}bindSilhouetteEdges(u,v){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(v,!0),v,u)}renderRegularEdges(u,v,y,D,G){this._render(u,v,v.regular.vao,y,D,G)}renderSilhouetteEdges(u,v,y,D,G){this._render(u,v,v.silhouette.vao,y,D,G)}_render(u,v,y,D,G,A){0<A&&(this._bindDraw(u,v,D,G),this._rctx.bindVAO(y),this._rctx.drawArraysInstanced(x.PrimitiveType.TRIANGLE_FAN,0,4,A))}_bindDraw(u,v,y,D){this._drawParameters.componentDataTexture=
v.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in v.transform)this._lastOriginId!==v.transform.origin.origin.id&&(u.setUniformMatrix4fv("localView",v.transform.origin.viewMatrix),this._lastOriginId=v.transform.origin.origin.id),u.setUniformMatrix4fv("model",v.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=v.transform.origin.origin.vec3;else{const G=new e.TwoVectorPosition(v.transform.position),A=h.transpose(q,
h.invert(q,v.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=G.low;this._drawParameters.transformWorldFromModelTH=G.high;this._drawParameters.transformWorldFromModelRS=v.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=A;v=D.camera.viewInverseTransposeMatrix;m.set(this._drawParameters.slicePlaneLocalOrigin,v[3],v[7],v[11])}u.bindDraw(this._drawParameters,D,y)}_sortRenderables(){this._renderablesDirty=!1;this._sortedRenderables[f.Transparency.TRANSPARENT][f.Transparency.TRANSPARENT].clear();
this._sortedRenderables[f.Transparency.TRANSPARENT][f.Transparency.OPAQUE].clear();this._sortedRenderables[f.Transparency.OPAQUE][f.Transparency.TRANSPARENT].clear();this._sortedRenderables[f.Transparency.OPAQUE][f.Transparency.OPAQUE].clear();this._renderables.forEach(v=>{v.objectTransparency!==f.Transparency.INVISIBLE&&v.edgeTransparency!==f.Transparency.INVISIBLE&&this._sortedRenderables[v.objectTransparency][v.edgeTransparency].push(v)});const u=(v,y)=>"origin"in v.transform?"origin"in y.transform?
v.transform.origin.origin.id<y.transform.origin.origin.id?-1:v.transform.origin.origin.id>y.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[f.Transparency.TRANSPARENT][f.Transparency.TRANSPARENT].sort(u);this._sortedRenderables[f.Transparency.TRANSPARENT][f.Transparency.OPAQUE].sort(u);this._sortedRenderables[f.Transparency.OPAQUE][f.Transparency.TRANSPARENT].sort(u);this._sortedRenderables[f.Transparency.OPAQUE][f.Transparency.OPAQUE].sort(u)}static getKey(u,v,y){return`edges-t:${u}:${v}:${y}`}}
const q=k.create();a.EdgeRenderer=t;a.extensionLengthOffset=128;a.lineWidthFractionFactor=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,n,h){class k extends h.VertexPositionPassParameters{constructor(g,
e){super();this.distanceFalloffFactor=g;this.transparency=e;this.transformNormalViewFromGlobal=b.create()}}class m extends h.VertexPositionDrawParameters{constructor(){super(...arguments);this.transformNormalViewFromGlobal=b.create();this.slicePlaneLocalOrigin=n.create();this.transformNormalGlobalFromModel=b.create()}}a.EdgeDrawParameters=m;a.EdgePassParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends h.ShaderTechnique{initializeProgram(l){return new k.Program(l.rctx,c.shader.get().build(this.configuration),m.EdgeShaderAttributeLocations)}initializePipeline(l){return d.makePipelineState({blending:d.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE,e.BlendOperation.ADD,l.rctx.gl.MAX),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})}}c.shader=new n.ReloadableShaderModule(g.EdgeShader,
()=>new Promise((l,f)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],l,f)));b.EdgeShaderTechnique=c;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){function v(G){const A=new c.ShaderBuilder,{vertex:C,fragment:E}=A;G.legacy&&C.uniforms.add(new D("model"),new D("localView"));A.include(r.AdjustProjectedPosition,G);A.include(p.EdgeUtil,G);A.include(t.LineAmplitude,G);A.include(u.UnpackAttributes,G);A.include(q.LineOffset,G);A.include(h.SliceDraw,G);A.include(w.DiscardNonSilhouetteEdges,G);A.include(x.DiscardByCoverage,G);A.include(k.multipassTerrainTest,G);A.varyings.add("vColor","vec4");A.varyings.add("vRadius",
"float");A.varyings.add("vPosition","vec3");A.varyings.add("vWorldPosition","vec3");G.multipassEnabled&&A.varyings.add("vViewPos","vec3");A.varyings.add("vLineLengthPixels","float");A.varyings.add("vSizeFalloffFactor","float");C.uniforms.add(new m.Float2PassUniform("pixelToNDC",(I,H)=>b.set(y,2/H.camera.fullViewport[2],2/H.camera.fullViewport[3])),new g.Float4PassUniform("viewport",(I,H)=>H.camera.fullViewport),new e.FloatPassUniform("pixelRatio",(I,H)=>H.camera.pixelRatio));A.attributes.add(f.VertexAttribute.POSITION0,
"vec3");A.attributes.add(f.VertexAttribute.POSITION1,"vec3");A.attributes.add(f.VertexAttribute.VARIANTOFFSET,"float");A.attributes.add(f.VertexAttribute.VARIANTSTROKE,"float");A.attributes.add(f.VertexAttribute.VARIANTEXTENSION,"float");C.code.add(d.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${G.multipassEnabled?"vViewPos \x3d viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${G.mode===p.EdgeUtilMode.SKETCH?d.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:G.mode===p.EdgeUtilMode.MIXED?d.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0, component)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(component), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);E.code.add(d.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${G.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return A}const y=n.create();class D extends l.Uniform{constructor(G){super(G,"mat4")}}n=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=n;a.build=v})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,b,n,h,k,m,g){const e=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(d,c){d=d.vertex;d.include(n.IsNaN);d.constants.add("depthBias","vec2",e);d.uniforms.add(new h.Float2PassUniform("inverseViewport",(l,f)=>f.inverseViewport));c.legacy?(d.uniforms.add(new g.Matrix4PassUniform("proj",(l,f)=>f.camera.projectionMatrix)),d.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(d.uniforms.add(new m.Matrix3PassUniform("transformNormalViewFromGlobal",l=>l.transformNormalViewFromGlobal),new g.Matrix4PassUniform("transformProjFromView",l=>l.transformProjFromView)),d.code.add(k.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));d.code.add(k.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(n){const h=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;n.code.add(h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(n){n=n.fragment;n.constants.add("coverageTestThreshold","float",.01);n.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(n,h){n=n.vertex;h.silhouette?(n.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),h.legacy?n.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 viewNormalA = _modelToViewNormal(data.normal);
vec3 viewNormalB = _modelToViewNormal(data.normal2);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):n.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
vec3 worldNormalA = _modelToWorldNormal(data.normal);
vec3 worldNormalB = _modelToWorldNormal(data.normal2);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):n.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos, ComponentData data) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){a.EdgeUtilMode=void 0;(function(w){w[w.SOLID=0]="SOLID";w[w.SKETCH=1]="SKETCH";w[w.MIXED=2]="MIXED";w[w.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(w){w[w.REGULAR=0]="REGULAR";w[w.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(w,p){const t=w.vertex;t.include(k.RgbaFloatEncoding);w.include(n.NormalAttribute,p);t.uniforms.add(new e.FloatPassUniform("distanceFalloffFactor",q=>
q.distanceFalloffFactor));t.code.add(d.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);t.uniforms.add(new r.Texture2DDrawUniform("componentDataTex",q=>q.componentDataTexture));w.attributes.add(x.VertexAttribute.COMPONENTINDEX,"float");t.constants.add("componentColorFieldOffset","float",0);t.constants.add("componentOtherFieldOffset","float",1);t.constants.add("componentVerticalOffsetFieldOffset","float",2);t.constants.add("componentFieldCount","float",3);t.constants.add("lineWidthFractionFactor","float",8);t.constants.add("extensionLengthOffset","float",128);t.constants.add("verticalOffsetScale",
"float",2*b.maxElevationOffset);t.code.add(d.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
      float texSize = float(textureSize(componentDataTex, 0).x);
      float colIndex = mod(fieldIndex, texSize);
      float rowIndex = floor(fieldIndex / texSize);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      vec3 normal;
      vec3 normal2;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
      vec3 normal = normalModel();
      vec3 normal2 = ${p.silhouette?d.glsl`decompressNormal(normal2Compressed)`:d.glsl`normal`};

      vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
      vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
      float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        normal, normal2,
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `);p.legacy?t.code.add(d.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(t.uniforms.add(new c.Matrix3DrawUniform("transformNormalGlobalFromModel",q=>q.transformNormalGlobalFromModel)),t.code.add(d.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));p.silhouette?(w.attributes.add(x.VertexAttribute.NORMAL2COMPRESSED,"vec2"),t.code.add(d.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(normalize(data.normal + data.normal2));
}`)):t.code.add(d.glsl`vec3 worldNormal(ComponentData data) {
return _modelToWorldNormal(data.normal);
}`);p.legacy?t.code.add(d.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(t.include(h.DoublePrecision,p),t.uniforms.add(new l.Matrix3PassUniform("transformViewFromCameraRelativeRS",q=>q.transformViewFromCameraRelativeRS),new c.Matrix3DrawUniform("transformWorldFromModelRS",q=>q.transformWorldFromModelRS),new m.Float3DrawUniform("transformWorldFromModelTL",q=>q.transformWorldFromModelTL),new m.Float3DrawUniform("transformWorldFromModelTH",q=>q.transformWorldFromModelTH),new g.Float3PassUniform("transformWorldFromViewTL",q=>q.transformWorldFromViewTL),new g.Float3PassUniform("transformWorldFromViewTH",
q=>q.transformWorldFromViewTH)),t.code.add(d.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${p.spherical?d.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:d.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));t.uniforms.add(new f.Matrix4PassUniform("transformProjFromView",(q,u)=>u.camera.projectionMatrix));t.code.add(d.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);t.code.add(d.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(w){return w.mode===a.EdgeUtilMode.SKETCH||w.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(w){return w.mode===a.EdgeUtilMode.SOLID||w.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,b,n,h,k){a.LineAmplitude=function(m,g){const e=m.vertex;m.include(k.UnpackAttributes,g);switch(g.mode){case h.EdgeUtilMode.SOLID:e.code.add(n.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case h.EdgeUtilMode.SKETCH:e.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",d=>d.strokesTexture.amplitude));e.code.add(n.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case h.EdgeUtilMode.MIXED:e.uniforms.add(new b.FloatDrawUniform("strokesAmplitude",d=>d.strokesTexture.amplitude)),e.code.add(n.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,n,h,k){a.UnpackAttributes=function(m,g){const e=m.vertex;m.attributes.add(h.VertexAttribute.SIDENESS,"vec2");g.mode===k.EdgeUtilMode.MIXED?e.code.add(n.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):e.code.add(n.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(g.mode){case k.EdgeUtilMode.MIXED:e.code.add(n.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case k.EdgeUtilMode.SKETCH:e.code.add(n.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.SOLID:e.code.add(n.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case k.EdgeUtilMode.COUNT:break;default:b.neverReached(g.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(a,b,n,h,k,m,
g){class e extends h.NoParameters{}a.LineOffset=function(d,c){d.include(g.UnpackAttributes,c);const {vertex:l,fragment:f}=d;m.usesSketchLogic(c)&&(l.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",r=>r.strokesTexture.texture)),l.uniforms.add(new n.FloatDrawUniform("strokesLog2Resolution",r=>Math.log2(r.strokesTexture.resolution)),new n.FloatDrawUniform("strokeVariants",r=>r.strokesTexture.variants)),d.varyings.add("vStrokeUV","vec2"),f.uniforms.add(new k.Texture2DDrawUniform("strokesTexture",
r=>r.strokesTexture.texture),new n.FloatDrawUniform("strokesNormalizationScale",r=>r.strokesTexture.normalizationScale)),l.code.add(h.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),d.fragment.include(b.RgbaFloatEncoding),f.code.add(h.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(c.mode){case m.EdgeUtilMode.SOLID:l.code.add(h.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);f.code.add(h.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case m.EdgeUtilMode.SKETCH:l.code.add(h.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);f.code.add(h.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case m.EdgeUtilMode.MIXED:d.varyings.add("vType","float"),l.code.add(h.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),f.code.add(h.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/tslib.es6 ../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,n,h,k,m){class g extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);
this.mode=m.EdgeUtilMode.SOLID;this.spherical=this.cullAboveGround=this.multipassEnabled=this.doublePrecisionRequiresObfuscation=this.legacy=this.silhouette=this.hasSlicePlane=!1}}b.__decorate([h.parameter({count:m.EdgeUtilMode.COUNT})],g.prototype,"mode",void 0);b.__decorate([h.parameter()],g.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],g.prototype,"silhouette",void 0);b.__decorate([h.parameter()],g.prototype,"legacy",void 0);b.__decorate([h.parameter()],g.prototype,"doublePrecisionRequiresObfuscation",
void 0);b.__decorate([h.parameter()],g.prototype,"multipassEnabled",void 0);b.__decorate([h.parameter()],g.prototype,"cullAboveGround",void 0);b.__decorate([h.parameter()],g.prototype,"spherical",void 0);b.__decorate([h.parameter({constValue:!1})],g.prototype,"occlusionPass",void 0);b.__decorate([h.parameter({constValue:n.NormalType.Compressed})],g.prototype,"normalType",void 0);a.EdgeShaderTechniqueConfiguration=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["exports",
"../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./edgeProcessing"],function(a,b,n,h,k){class m extends n.WorkerHandle{constructor(e){super("EdgeProcessingWorker","extract",{extract:d=>[d.dataBuffer],extractComponentsEdgeLocations:d=>[d.dataBuffer],extractEdgeLocations:d=>[d.dataBuffer]},e)}async process(e,d,c){if(c)return k.extract(e);e=await this.invoke(new g(e),d);return this._unpackOutput(e)}async extractEdgeLocations(e,d){e=
await this.invokeMethod("extractEdgeLocations",new g(e),d);return h.unpackInterleavedBuffer(e)}async extractComponentsEdgeLocations(e,d){e=await this.invokeMethod("extractComponentsEdgeLocations",new g(e),d);return h.unpackInterleavedBuffer(e)}_unpackOutput(e){return{regular:{instancesData:h.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:h.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},
averageEdgeLength:e.averageEdgeLength}}}class g{constructor(e){this.dataBuffer=e.data.buffer;this.writerSettings=e.writerSettings;this.skipDeduplicate=e.skipDeduplicate;this.indices=b.isArray(e.indices)?e.indices:e.indices.buffer;this.indicesType=b.isArray(e.indices)?"Array":b.isUint32Array(e.indices)?"Uint32Array":"Uint16Array";this.indicesLength=e.indicesLength}}a.EdgeWorkerHandle=m;a.PackedInput=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports",
"./InterleavedLayout"],function(a,b){a.packInterleavedBuffer=function(n,h){h.push(n.buffer);return{buffer:n.buffer,layout:new b.PackedLayout(n.layout)}};a.unpackInterleavedBuffer=function(n){return(new b.InterleavedLayout(n.layout)).createView(n.buffer)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports","../../../../../core/floatRGBA","../../../../../core/maybe","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],
function(a,b,n,h,k){function m(c,l){if(!c)return null;var f=c.length/2;const r=.1*f;f=Array(f);let x=0;l=l===g.PRESSURE;for(let w=0;w<c.length;w+=2){const p=(c[w]+c[w+1])/2;l?f[x++]=Math.min(r,1-.5*(1-p)):f[x++]=Math.min(r,.5*p)}return f}var g;(function(c){c[c.DISTANCE=0]="DISTANCE";c[c.PRESSURE=1]="PRESSURE"})(g||={});class e{constructor(c,l,f,r,x){this.resolution=c;this.normalizationScale=l;this.amplitude=f;this.variants=r;this.texture=x}dispose(){this.texture=n.disposeMaybe(this.texture)}}const d=
{amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,
-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,
.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,
-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,
.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,
.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,
.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,
-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,
-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,
1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,
.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,
-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,
.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,
.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,
.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,
.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,
4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,
3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,
1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],
pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,
.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,
.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,
.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,
2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,
-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,
.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,
2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,
.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,
.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,
.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,
-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,
.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,
.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,
-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,
.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,
.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,
.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,
.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,
6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,
.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,
-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,
3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,
.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,
.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,
.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=e;a.generateStrokesTexture=function(c){const l=d.resolution;var f=l/2;const r=new Uint8Array(4*
l*l),x=4*l*f;f=d.amplitude;const w=2*f,p=4*l,t=Math.log2(l)+1,q=d.strokes.length;let u=(t-1)*q*p;for(const {distance:v,pressure:y}of d.strokes){let D=v,G=y,A=u;for(let C=0;C<t;C++){0!==C&&(D=m(D,g.DISTANCE),G=m(G,g.PRESSURE));for(let E=0;E<d.resolution;E++){const I=G?G[E%G.length]:1;b.packFloatRGBA((D?D[E%D.length]/w:0)+.5,r,A);b.packFloatRGBA(I,r,A+x);A+=4}A-=p*(q+1)}u+=p}c=new h.Texture(c,new k.TextureDescriptor(l),r);return new e(l,w,f,q,c)};a.strokesDefinition=d;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","./interfaces"],function(a,b){a.determineEdgeTransparency=function(n){let h=b.Transparency.INVISIBLE;for(const {material:k}of n)if(0<k.size*k.color[3]*k.opacity){if(1>k.color[3]*k.opacity)return b.Transparency.TRANSPARENT;h=b.Transparency.OPAQUE}return h};a.determineObjectTransparency=function(n){let h=b.Transparency.INVISIBLE;for(const {material:k}of n)if(0<k.size*k.color[3]*k.opacity){switch(k.objectTransparency){case b.Transparency.TRANSPARENT:case b.Transparency.INVISIBLE:return b.Transparency.TRANSPARENT;
case b.Transparency.OPAQUE:if(1>k.opacity)return b.Transparency.TRANSPARENT}h=b.Transparency.OPAQUE}return h};a.determineRendererType=function(n){let h=null;for(const k of n)if(n=k.type,0<k.size*k.color[3])if(null==h)h=n;else if(h!==n)return"uber";return null!=h?h:"uber"};a.fillComponenBufferIndices=function(n,h,k,m){for(let e=0;e<n.length;e++){const d=n[e].index;var g=h[e];const c=h[e+1];if(m)for(;g<c;g++)k.set(m[g],d);else for(;g<c;g++)k.set(g,d)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define(["exports","../../../../core/maybe","../../../../core/PerformanceSampler","../../../../core/time","../../../webgl/TimerPool"],function(a,b,n,h,k){a.PerformanceCategory=void 0;(function(g){g.OVERLAY="overlay";g.PREPARE="prepare";g.SHADOW_MAP="shadow map";g.LINEAR_DEPTH="linear depth";g.ACCUMULATED_SHADOWS="accumulated shadows";g.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";g.NORMALS="normals";g.SSAO="SSAO";g.OPAQUE=
"opaque";g.OPAQUE_EDGES="opaque edges";g.VOXEL="voxel";g.TRANSPARENT="transparent";g.TRANSPARENT_EDGES="transparent edges";g.HUD_VISIBILITY="HUD visibility";g.TRANSPARENT_TERRAIN="transparent terrain";g.ENVIRONMENT="environment";g.LASER_LINES="laser lines";g.OCCLUDED="occluded";g.ANTIALIASING="antialiasing";g.HIGHLIGHTS="highlights";g.HUD="HUD";g.HUD_OCCLUDED="HUD occluded";g.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));class m{constructor(g){this._rctx=g;this._startTimeStampCPU=
h.Milliseconds(0);this._lastTimeStampCPU=h.Milliseconds(0);this._totalCPUTime=new n("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new n(e)]));this._enableGPUTimer=0;this._totalGPUTime=new n("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(e=>[e,new n(e)]));this._totalTime=h.Milliseconds(0);this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return null!=
this._gpuTimerPool}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return h.Milliseconds(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(null==this._gpuTimerPool){const e=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=k.createElapsedTimerPool(this._rctx,e)}if(null==this._gpuTimerPool)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let g=!1;return{hasGPUTimerSupport:!0,remove:()=>
{g||(g=!0,--this._enableGPUTimer,0===this._enableGPUTimer&&(this._gpuTimerPool=b.disposeMaybe(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=h.Milliseconds(performance.now());this._gpuTimerPool&&this._gpuTimerPool.start()}advance(g){var e=h.Milliseconds(performance.now());this._cpuTimeSamplers.get(g).record(e-this._lastTimeStampCPU);this._lastTimeStampCPU=e;this._gpuTimerPool&&(e=this._gpuTimerPool.stop(g),this._gpuTimeSamplers.get(g).record(e),this._gpuTimerPool.start())}finishFrame(){if(this._gpuTimerPool){var g=
this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(g);this._rctx.gl.flush()}g=h.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=h.Milliseconds(this._totalTime+g);this._totalCPUTime.record(g);this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((e,d)=>e+(d.last||0),0));++this._totalFrameCount}}a.RendererPerformanceInfo=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports",
"./capabilities/DisjointTimerQuery"],function(a,b){class n{constructor(h,k){this._timer=h;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;k.forEach(m=>{const g=this._timer.createQuery(),e=this._timer.createQuery();this._queryPool.push(g,e);this._queryResults.set(m,null)})}start(){b.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),null!=this._currentQuery&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(h){if(this._timer.disjoint()||
null==this._currentQuery||!this._queryResults.has(h))return this.abort(),null;this._timer.endTimeElapsed();const k=this._queryResults.get(h);if(null==k)return this._queryResults.set(h,this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(k))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const m=this._timer.getResult(k)/1E6;this._queryPool.unshift(k);this._queryResults.set(h,this._currentQuery);this._currentQuery=null;return m}abort(){null!=this._currentQuery&&
(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){null!=this._currentQuery&&this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(h=>{this._timer.deleteQuery(h)});this._queryResults.forEach(h=>{null!=h&&this._timer.deleteQuery(h)})}}a.createElapsedTimerPool=function(h,k){h=h.capabilities.disjointTimerQuery;return null==h?null:new n(h,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],
function(a){class b{constructor(n,h,k,m,g,e,d,c,l){this.createQuery=n;this.deleteQuery=h;this.resultAvailable=k;this.getResult=m;this.disjoint=g;this.beginTimeElapsed=e;this.endTimeElapsed=d;this.createTimestamp=c;this.timestampBits=l}}a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(n,h){if(h.disjointTimerQuery)return null;let k=n.getExtension("EXT_disjoint_timer_query_webgl2");return k?new b(()=>n.createQuery(),m=>{n.deleteQuery(m);a.hasRunningElapsedTimer=
!1},m=>n.getQueryParameter(m,n.QUERY_RESULT_AVAILABLE),m=>n.getQueryParameter(m,n.QUERY_RESULT),()=>n.getParameter(k.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,n.beginQuery(k.TIME_ELAPSED_EXT,m))},()=>{n.endQuery(k.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>k.queryCounterEXT(m,k.TIMESTAMP_EXT),()=>n.getQuery(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):(k=n.getExtension("EXT_disjoint_timer_query"))?new b(()=>k.createQueryEXT(),m=>{k.deleteQueryEXT(m);a.hasRunningElapsedTimer=
!1},m=>k.getQueryObjectEXT(m,k.QUERY_RESULT_AVAILABLE_EXT),m=>k.getQueryObjectEXT(m,k.QUERY_RESULT_EXT),()=>n.getParameter(k.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,k.beginQueryEXT(k.TIME_ELAPSED_EXT,m))},()=>{k.endQueryEXT(k.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>k.queryCounterEXT(m,k.TIMESTAMP_EXT),()=>k.getQueryEXT(k.TIMESTAMP_EXT,k.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports",
"../effects/ScreenSpaceGeometry","../../../webgl/AppleAmdDriverHelper","../../../webgl/RenderingContext"],function(a,b,n,h){class k extends h.RenderingContext{constructor(m,g,e){super(m,g);this.gl=m;this.newCache=e;this._appleAmdDriverHelper=null;this._refCount=1;this.screen=new b.ScreenSpaceGeometry(this)}destroy(){0<--this._refCount||this.dispose()}ref(){++this._refCount}dispose(){super.dispose();this._appleAmdDriverHelper?.dispose();this.screen.destroy()}bindTechnique(m,g,e,d,c){this.useProgram(m.program);
this.setPipelineState(m.getPipeline(!!c));m.program.bindPass(e,g);d&&m.program.bindDraw(d,g,e);return m.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new n.AppleAmdDriverHelper(this)),this._appleAmdDriverHelper.run())}get test(){return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(this._appleAmdDriverHelper?.test.cachedWebGLObjects??0)}}}
a.RenderingContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ScreenSpaceGeometry":function(){define("exports ../../../../core/maybe ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../lib/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),function(a,b,n,h,k,m,g){function e(c,l=h.Pos2,f=n.Default3D){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new k.VertexArrayObject(c,f,{geometry:l},
{geometry:m.BufferObject.createVertex(c,g.Usage.STATIC_DRAW,r)})}class d{constructor(c){this._rctx=c;this._vao=e(c)}destroy(){this._vao=b.disposeMaybe(this._vao)}draw(){null!=this._vao&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(g.PrimitiveType.TRIANGLES,0,3))}get test(){return{cachedWebGLObjects:(null!=this._vao?.glName?1:0)+(null!=this._vao?.indexBuffer?.glName?1:0)+(null!=this._vao?.vertexBuffers.geometry?1:0)}}}a.ScreenSpaceGeometry=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","./BufferObject","./enums"],function(a,b,n){class h{constructor(k){this._rctx=k;this._indexBuffer=this._createIndexbuffer();this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const k=
h.getShaderSources();return this._rctx.programCache.acquire(k.vertex,k.fragment,new Map([]))}_createIndexbuffer(){return b.BufferObject.createIndex(this._rctx,n.Usage.STATIC_DRAW,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,n.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(n.PrimitiveType.POINTS,1,n.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose();this._indexBuffer.dispose()}get test(){return{cachedWebGLObjects:this._indexBuffer?.glName?
1:0}}}a.AppleAmdDriverHelper=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./ContextState ./enums ./InstanceCounter ./Parameters ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(q,u,v,y){u?y!==u&&q.bindBuffer(v,u.glName):q.bindBuffer(v,null);
return u}function t(q,u){switch(q){case g.PrimitiveType.POINTS:return 2*u;case g.PrimitiveType.TRIANGLES:return u/3;case g.PrimitiveType.TRIANGLE_STRIP:return u-2;case g.PrimitiveType.TRIANGLE_FAN:return u-2;default:return 0}}a.RenderingContext=class{constructor(q,u){this.gl=q;this.instanceCounter=new e.InstanceCounter;this.programCache=new c.ProgramCache(this);this._transformFeedbackRequestInfo=null;this._state=new m.ContextState;this._numOfTriangles=this._numOfDrawCalls=0;this._loadExtensions();
this.configure(u)}configure(q){this._capabilities=new w.Capabilities(this.gl,q);this._parameters=new d.Parameters(this.gl,this._capabilities,q);f.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;q=this.gl.getParameter(this.gl.VIEWPORT);this._state=new m.ContextState;this._state.viewport={x:q[0],y:q[1],width:q[2],height:q[3]};this._stateTracker=new l.StateTracker({setBlending:u=>{u?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(u.opRgb,u.opAlpha),this.setBlendFunctionSeparate(u.srcRgb,
u.dstRgb,u.srcAlpha,u.dstAlpha),u=u.color,this.setBlendColor(u.r,u.g,u.b,u.a)):this.setBlendingEnabled(!1)},setCulling:u=>{u?(this.setFaceCullingEnabled(!0),this.setCullFace(u.face),this.setFrontFace(u.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:u=>{u?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(u.factor,u.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:u=>{u?(this.setDepthTestEnabled(!0),this.setDepthFunction(u.func)):this.setDepthTestEnabled(!1)},setStencilTest:u=>
{if(u){this.setStencilTestEnabled(!0);const v=u.function;this.setStencilFunction(v.func,v.ref,v.mask);u=u.operation;this.setStencilOp(u.fail,u.zFail,u.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:u=>{u?(this.setDepthWriteEnabled(!0),this.setDepthRange(u.zNear,u.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:u=>{u?this.setColorMask(u.r,u.g,u.b,u.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:u=>{u?this.setStencilWriteMask(u.mask):this.setStencilWriteMask(0)},setDrawBuffers:u=>
{const {gl:v}=this;u?v.drawBuffers(u.buffers):({drawFramebuffer:u}=this._state,null===u||0===u.colorAttachments.length?v.drawBuffers([g.SpecialDrawBuffers.BACK]):v.drawBuffers([g.ColorAttachment.COLOR_ATTACHMENT0]))}});this.enforceState();b.disposeMaybe(this._driverTest);this._driverTest=new x.WebGLDriverTest(this)}dispose(){b.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);
this.unbindBuffer(g.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(g.BufferType.COPY_READ_BUFFER);this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER);this._state.textureUnitMap.length=0;k.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(q){this._stateTracker.setPipeline(q)}setBlendingEnabled(q){this._state.blend!==
q&&(!0===q?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=q,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop();this._state.program=null}externalTextureUnitUpdate(q,u){for(let v=0;v<q.length;++v)this._state.textureUnitMap[q[v]]=null;0<=u&&(this._state.activeTexture=u)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null);this._state.vertexArrayObject=null;this._state.vertexBuffer=null;this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=
null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(q,u,v,y){if(q!==this._state.blendColor.r||u!==this._state.blendColor.g||v!==this._state.blendColor.b||y!==this._state.blendColor.a)this.gl.blendColor(q,u,v,y),this._state.blendColor.r=q,this._state.blendColor.g=u,this._state.blendColor.b=v,this._state.blendColor.a=y,this._stateTracker.invalidateBlending()}setBlendFunction(q,u){if(q!==this._state.blendFunction.srcRGB||u!==this._state.blendFunction.dstRGB)this.gl.blendFunc(q,
u),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=q,this._state.blendFunction.dstRGB=u,this._state.blendFunction.dstAlpha=u,this._stateTracker.invalidateBlending()}setBlendFunctionSeparate(q,u,v,y){if(this._state.blendFunction.srcRGB!==q||this._state.blendFunction.srcAlpha!==v||this._state.blendFunction.dstRGB!==u||this._state.blendFunction.dstAlpha!==y)this.gl.blendFuncSeparate(q,u,v,y),this._state.blendFunction.srcRGB=q,this._state.blendFunction.srcAlpha=v,this._state.blendFunction.dstRGB=
u,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()}setBlendEquation(q){this._state.blendEquation.mode!==q&&(this.gl.blendEquation(q),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=q,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(q,u){if(this._state.blendEquation.mode!==q||this._state.blendEquation.modeAlpha!==u)this.gl.blendEquationSeparate(q,u),this._state.blendEquation.mode=q,this._state.blendEquation.modeAlpha=u,this._stateTracker.invalidateBlending()}setColorMask(q,
u,v,y){if(this._state.colorMask.r!==q||this._state.colorMask.g!==u||this._state.colorMask.b!==v||this._state.colorMask.a!==y)this.gl.colorMask(q,u,v,y),this._state.colorMask.r=q,this._state.colorMask.g=u,this._state.colorMask.b=v,this._state.colorMask.a=y,this._stateTracker.invalidateColorWrite()}setClearColor(q,u,v,y){if(this._state.clearColor.r!==q||this._state.clearColor.g!==u||this._state.clearColor.b!==v||this._state.clearColor.a!==y)this.gl.clearColor(q,u,v,y),this._state.clearColor.r=q,this._state.clearColor.g=
u,this._state.clearColor.b=v,this._state.clearColor.a=y}setFaceCullingEnabled(q){this._state.faceCulling!==q&&(!0===q?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=q,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(q){this._state.polygonOffsetFill!==q&&(!0===q?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=q,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(q,
u){if(this._state.polygonOffset[0]!==q||this._state.polygonOffset[1]!==u)this._state.polygonOffset[0]=q,this._state.polygonOffset[1]=u,this.gl.polygonOffset(q,u),this._stateTracker.invalidatePolygonOffset()}setCullFace(q){this._state.cullFace!==q&&(this.gl.cullFace(q),this._state.cullFace=q,this._stateTracker.invalidateCulling())}setFrontFace(q){this._state.frontFace!==q&&(this.gl.frontFace(q),this._state.frontFace=q,this._stateTracker.invalidateCulling())}setScissorTestEnabled(q){this._state.scissorTest!==
q&&(!0===q?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=q)}setScissorRect(q,u,v,y){if(this._state.scissorRect.x!==q||this._state.scissorRect.y!==u||this._state.scissorRect.width!==v||this._state.scissorRect.height!==y)this.gl.scissor(q,u,v,y),this._state.scissorRect.x=q,this._state.scissorRect.y=u,this._state.scissorRect.width=v,this._state.scissorRect.height=y}setDepthTestEnabled(q){this._state.depthTest!==q&&(!0===q?this.gl.enable(this.gl.DEPTH_TEST):
this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=q,this._stateTracker.invalidateDepthTest())}setClearDepth(q){this._state.clearDepth!==q&&(this.gl.clearDepth(q),this._state.clearDepth=q)}setDepthFunction(q){this._state.depthFunction!==q&&(this.gl.depthFunc(q),this._state.depthFunction=q,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(q){this._state.depthWrite!==q&&(this.gl.depthMask(q),this._state.depthWrite=q,this._stateTracker.invalidateDepthWrite())}setDepthRange(q,u){if(this._state.depthRange.zNear!==
q||this._state.depthRange.zFar!==u)this.gl.depthRange(q,u),this._state.depthRange.zNear=q,this._state.depthRange.zFar=u,this._stateTracker.invalidateDepthWrite()}setStencilTestEnabled(q){this._state.stencilTest!==q&&(!0===q?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=q,this._stateTracker.invalidateStencilTest())}setClearStencil(q){q!==this._state.clearStencil&&(this.gl.clearStencil(q),this._state.clearStencil=q)}setStencilFunction(q,u,v){if(this._state.stencilFunction.func!==
q||this._state.stencilFunction.ref!==u||this._state.stencilFunction.mask!==v)this.gl.stencilFunc(q,u,v),this._state.stencilFunction.face=g.Face.FRONT_AND_BACK,this._state.stencilFunction.func=q,this._state.stencilFunction.ref=u,this._state.stencilFunction.mask=v,this._stateTracker.invalidateStencilTest()}setStencilFunctionSeparate(q,u,v,y){if(this._state.stencilFunction.face!==q||this._state.stencilFunction.func!==u||this._state.stencilFunction.ref!==v||this._state.stencilFunction.mask!==y)this.gl.stencilFuncSeparate(q,
u,v,y),this._state.stencilFunction.face=q,this._state.stencilFunction.func=u,this._state.stencilFunction.ref=v,this._state.stencilFunction.mask=y,this._stateTracker.invalidateStencilTest()}setStencilWriteMask(q){this._state.stencilWriteMask!==q&&(this.gl.stencilMask(q),this._state.stencilWriteMask=q,this._stateTracker.invalidateStencilWrite())}setStencilOp(q,u,v){if(this._state.stencilOperation.face!==g.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==q||this._state.stencilOperation.zFail!==
u||this._state.stencilOperation.zPass!==v)this.gl.stencilOp(q,u,v),this._state.stencilOperation.face=g.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=q,this._state.stencilOperation.zFail=u,this._state.stencilOperation.zPass=v,this._stateTracker.invalidateStencilTest()}setStencilOpSeparate(q,u,v,y){if(this._state.stencilOperation.face!==q||this._state.stencilOperation.fail!==u||this._state.stencilOperation.zFail!==v||this._state.stencilOperation.zPass!==y)this.gl.stencilOpSeparate(q,u,v,y),
this._state.stencilOperation.face=q,this._state.stencilOperation.fail=u,this._state.stencilOperation.zFail=v,this._state.stencilOperation.zPass=y,this._stateTracker.invalidateStencilTest()}setActiveTexture(q,u=!1){const v=this._state.activeTexture;0<=q&&(u||q!==this._state.activeTexture)&&(this.gl.activeTexture(g.baseTextureUnit+q),this._state.activeTexture=q);return v}clear(q){q&&this.gl.clear(q)}clearSafe(q,u=255){q&&(q&g.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),q&g.ClearBufferBit.DEPTH_BUFFER_BIT&&
this.setDepthWriteEnabled(!0),q&g.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(u),this.gl.clear(q))}clearFramebuffer(q,u=!1,v=!1){let y=0;q&&(this.setClearColor(q[0],q[1],q[2],Math.max(1E-13,q[3])),y|=g.ClearBufferBit.COLOR_BUFFER_BIT);u&&(y|=g.ClearBufferBit.DEPTH_BUFFER_BIT);!1===v?v=0:(!0===v&&(v=255),y|=g.ClearBufferBit.STENCIL_BUFFER_BIT);y&&this.clearSafe(y,v)}drawArrays(q,u,v){if(this._transformFeedbackRequestInfo){if(q!==this._transformFeedbackRequestInfo.primitiveType)throw Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");
if(null==this._state.program?.hasTransformFeedbackVaryings)throw Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying");}if(k.webglDebugEnabled()){this._numOfDrawCalls++;this._numOfTriangles+=t(q,v);const y=this._state.textureUnitMap;for(let D=0;D<y.length;D++){const G=y[D];if(null!=G&&G===this._state.drawFramebuffer?.colorTexture)throw Error(`Detected readWrite. Texture already bound at index ${D}`);}}this.gl.drawArrays(q,u,v);
k.checkWebGLError(this.gl)}drawArraysInstanced(q,u,v,y){this.gl.drawArraysInstanced(q,u,v,y);k.checkWebGLError(this.gl)}drawElements(q,u,v,y){if(this._transformFeedbackRequestInfo)throw Error("Cannot called drawElements during a transform feedback request");k.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=t(q,u));this.gl.drawElements(q,u,v,y);if(k.webglDebugEnabled()){const D=r.getErrorString(this);if(D){const G=this.getBoundVAO(),A=G?.indexBuffer,C=A?.size??0,E=y+u;console.error(`drawElements: ${D}${C<
E?`. Buffer is too small. Attempted to draw index ${E} of ${C}`:""}`,{args:{mode:q,count:u,type:v,offset:y},vao:{indexBuffer:A,vertexBuffers:G?.vertexBuffers}})}}}logInfo(){k.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){k.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)}get capabilities(){return this._capabilities}setViewport(q,u,v,y){v=Math.max(Math.round(v),1);y=Math.max(Math.round(y),1);const D=this._state.viewport;
if(D.x!==q||D.y!==u||D.width!==v||D.height!==y)D.x=q,D.y=u,D.width=v,D.height=y,this.gl.viewport(q,u,v,y)}setViewport4fv(q){this.setViewport(q[0],q[1],q[2],q[3])}restoreViewport({x:q,y:u,width:v,height:y}){this.setViewport(q,u,v,y)}getViewport(){const q=this._state.viewport;return{x:q.x,y:q.y,width:q.width,height:q.height}}useProgram(q){this._state.program!==q&&(this._state.program?.stop(),this._state.program=q,this.gl.useProgram(q?.glName??null))}bindTexture(q,u,v=!1){(u>=this.parameters.maxTextureImageUnits||
0>u)&&console.error("Input texture unit is out of range of available units!");const y=this._state.textureUnitMap[u];if(null==q?.glName)return null!=y&&(this.setActiveTexture(u,v),this.gl.bindTexture(y.descriptor.target,null)),this._state.textureUnitMap[u]=null,y;if(!v&&y===q)return q.isDirty&&(this.setActiveTexture(u,v),q.applyChanges()),y;this.setActiveTexture(u,v);this.gl.bindTexture(q.descriptor.target,q.glName);q.applyChanges();this._state.textureUnitMap[u]=q;return y}unbindTexture(q){if(null!=
q)for(let u=0;u<this.parameters.maxTextureImageUnits;u++)this._state.textureUnitMap[u]===q&&(this.bindTexture(null,u),this._state.textureUnitMap[u]=null)}bindFramebuffer(q,u=!1){if(u||this._state.readFramebuffer!==q||this._state.drawFramebuffer!==q)this._stateTracker.invalidateDrawBuffers(),null==q?(this.gl.bindFramebuffer(g.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=this._state.drawFramebuffer=null):(q.initializeAndBind(g.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=
q,this._state.drawFramebuffer=q)}bindFramebufferSeparate(q,u,v=!1){const y=u===g.FramebufferTarget.READ_FRAMEBUFFER,D=y?this._state.readFramebuffer:this._state.drawFramebuffer;if(v||D!==q)null==q?this.gl.bindFramebuffer(u,null):q.initializeAndBind(u),y?this._state.readFramebuffer=q??null:this._state.drawFramebuffer=q??null}blitFramebuffer(q,u,v=0,y=0,D=q.width,G=q.height,A=0,C=0,E=u.width,I=u.height,H=g.ClearBufferBit.COLOR_BUFFER_BIT,J=g.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(q,
g.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(u,g.FramebufferTarget.DRAW_FRAMEBUFFER);this.gl.blitFramebuffer(v,y,D,G,A,C,E,I,H,J)}bindBuffer(q,u){if(q)switch(u??=q.bufferType,u){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=p(this.gl,q,u,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=p(this.gl,q,u,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=p(this.gl,q,u,this._state.uniformBuffer);
break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=p(this.gl,q,u,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=p(this.gl,q,u,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=p(this.gl,q,u,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=p(this.gl,q,u,this._state.copyWriteBuffer);break;case g.BufferType.TRANSFORM_FEEDBACK_BUFFER:this._state.transformFeedbackBuffer=
p(this.gl,q,u,this._state.transformFeedbackBuffer)}}bindRenderbuffer(q){const u=this.gl;q||(u.bindRenderbuffer(u.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==q&&(u.bindRenderbuffer(u.RENDERBUFFER,q.glName),this._state.renderbuffer=q)}_getBufferBinding(q,u){if(u>=this.parameters.maxUniformBufferBindings||0>u)return console.error("Uniform buffer binding point is out of range!"),null;q=q===g.BufferType.UNIFORM_BUFFER?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;
let v=q[u];null==v&&(v={buffer:null,offset:0,size:0},q[u]=v);return v}bindBufferBase(q,u,v){const y=this._getBufferBinding(q,u);null==y||y.buffer===v&&0===y.offset&&0===y.size||(this.gl.bindBufferBase(q,u,v?v.glName:null),y.buffer=v,y.offset=0,y.size=0)}bindBufferRange(q,u,v,y,D){const G=this._getBufferBinding(q,u);null==G||G.buffer===v&&G.offset===y&&G.size===D||(0!==y%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):
(this.gl.bindBufferRange(q,u,v.glName,y,D),G.buffer=v,G.offset=y,G.size=D))}bindUBO(q,u,v,y){null==u?this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,q,null):(k.webglDebugEnabled()&&(y??u.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),u.initialize(),void 0!==v&&void 0!==y?this.bindBufferRange(g.BufferType.UNIFORM_BUFFER,q,u.buffer,v,y):this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,q,u.buffer))}unbindUBO(q){for(let u=
0,v=this._state.uniformBufferBindingPoints.length;u<v;u++){const y=this._state.uniformBufferBindingPoints[u];null!=y&&y.buffer===q.buffer&&this.bindBufferBase(g.BufferType.UNIFORM_BUFFER,u,null)}}unbindBuffer(q){switch(q){case g.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=p(this.gl,null,q,this._state.vertexBuffer);break;case g.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=p(this.gl,null,q,this._state.indexBuffer);break;case g.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=p(this.gl,
null,q,this._state.uniformBuffer);break;case g.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=p(this.gl,null,q,this._state.pixelPackBuffer);break;case g.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=p(this.gl,null,q,this._state.pixelUnpackBuffer);break;case g.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=p(this.gl,null,q,this._state.copyReadBuffer);break;case g.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=p(this.gl,null,q,this._state.copyWriteBuffer)}}bindVAO(q=
null){null==q?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==q&&(q.bind(),this._state.vertexArrayObject=q)}bindTransformFeedback(q){const {gl:u}=this;u.bindTransformFeedback(u.TRANSFORM_FEEDBACK,q.glName)}beginTransformFeedback(q,u){if(this._transformFeedbackRequestInfo)throw Error("Already in a transform feedback request");const {gl:v}=this;v.bindTransformFeedback(v.TRANSFORM_FEEDBACK,q.glName);v.beginTransformFeedback(u);
this._transformFeedbackRequestInfo={primitiveType:u}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw Error("Not in a transform feedback request");const {gl:q}=this;q.endTransformFeedback();q.bindTransformFeedback(q.TRANSFORM_FEEDBACK,null);this._transformFeedbackRequestInfo=null}async clientWaitAsync(q=h.Milliseconds(10)){const {gl:u}=this,v=u.fenceSync(g.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!v)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(g.ResourceType.Sync,
v);u.flush();let y;do await n.after(q),y=u.clientWaitSync(v,0,0);while(y===g.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(g.ResourceType.Sync,v);u.deleteSync(v);if(y===g.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");}getBoundFramebufferObject(q=g.FramebufferTarget.FRAMEBUFFER){return q===g.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null);
this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(g.BufferType.ARRAY_BUFFER);this.unbindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER);this.unbindBuffer(g.BufferType.UNIFORM_BUFFER);this._state.uniformBufferBindingPoints.length=0;this.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);this.unbindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER);this.unbindBuffer(g.BufferType.COPY_READ_BUFFER);this.unbindBuffer(g.BufferType.COPY_WRITE_BUFFER);for(let q=0;q<this.parameters.maxTextureImageUnits;++q)this.bindTexture(null,
q);this.setBlendingEnabled(!1);this.setBlendFunction(g.BlendFactor.ONE,g.BlendFactor.ZERO);this.setBlendEquation(g.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(g.Face.BACK);this.setFrontFace(g.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(g.CompareFunction.LESS);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(g.CompareFunction.ALWAYS,0,0);this.setStencilOp(g.StencilOperation.KEEP,g.StencilOperation.KEEP,g.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const {gl:q}=this;q.bindVertexArray(null);for(var u=0;u<this.parameters.maxVertexAttributes;u++)q.disableVertexAttribArray(u);
this._state.vertexBuffer?q.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):q.bindBuffer(g.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?q.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):q.bindBuffer(g.BufferType.ELEMENT_ARRAY_BUFFER,null);this._state.uniformBuffer?q.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):q.bindBuffer(g.BufferType.UNIFORM_BUFFER,null);for(u=0;u<this._parameters.maxUniformBufferBindings;u++){var v=
this._state.uniformBufferBindingPoints[u];if(null!=v){const {buffer:y,offset:D,size:G}=v;null!==y?0===D&&0===G?q.bindBufferBase(g.BufferType.UNIFORM_BUFFER,u,y.glName):q.bindBufferRange(g.BufferType.UNIFORM_BUFFER,u,y.glName,D,G):q.bindBufferBase(g.BufferType.UNIFORM_BUFFER,u,null)}}this._state.pixelPackBuffer?q.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):q.bindBuffer(g.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?q.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):q.bindBuffer(g.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?q.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):q.bindBuffer(g.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?q.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):q.bindBuffer(g.BufferType.COPY_WRITE_BUFFER,null);q.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,null);q.readBuffer(q.BACK);this._state.readFramebuffer&&
(q.bindFramebuffer(g.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),q.readBuffer(g.ColorAttachment.COLOR_ATTACHMENT0));q.bindFramebuffer(g.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(this._state.vertexArrayObject){if(u=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null;this.bindVAO(u)}q.useProgram(this._state.program?.glName??null);q.blendColor(this._state.blendColor.r,this._state.blendColor.g,
this._state.blendColor.b,this._state.blendColor.a);q.bindRenderbuffer(q.RENDERBUFFER,this._state.renderbuffer?.glName??null);!0===this._state.blend?q.enable(this.gl.BLEND):q.disable(this.gl.BLEND);q.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);q.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);q.clearColor(this._state.clearColor.r,this._state.clearColor.g,
this._state.clearColor.b,this._state.clearColor.a);q.clearDepth(this._state.clearDepth);q.clearStencil(this._state.clearStencil);q.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);q.cullFace(this._state.cullFace);q.depthFunc(this._state.depthFunction);q.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST);q.depthMask(this._state.depthWrite);q.frontFace(this._state.frontFace);
q.lineWidth(1);!0===this._state.faceCulling?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE);q.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?q.enable(q.POLYGON_OFFSET_FILL):q.disable(q.POLYGON_OFFSET_FILL);q.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?q.enable(q.SCISSOR_TEST):q.disable(q.SCISSOR_TEST);q.stencilFunc(this._state.stencilFunction.func,
this._state.stencilFunction.ref,this._state.stencilFunction.mask);q.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST);q.stencilMask(this._state.stencilWriteMask);for(u=0;u<this.parameters.maxTextureImageUnits;u++)q.activeTexture(g.baseTextureUnit+u),q.bindTexture(g.TextureType.TEXTURE_2D,null),q.bindTexture(g.TextureType.TEXTURE_CUBE_MAP,
null),q.bindTexture(g.TextureType.TEXTURE_3D,null),q.bindTexture(g.TextureType.TEXTURE_2D_ARRAY,null),v=this._state.textureUnitMap[u],null!=v&&q.bindTexture(v.descriptor.target,v.glName);q.activeTexture(g.baseTextureUnit+this._state.activeTexture);u=this._state.viewport;q.viewport(u.x,u.y,u.width,u.height);this.resetInfo()}_loadExtensions(){this.gl.getExtension("KHR_parallel_shader_compile")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports",
"./enums"],function(a,b){class n{constructor(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=
b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.transformFeedbackBuffer=
this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.transformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null}}a.ContextState=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports",
"./AllocationTracer","./enums"],function(a,b,n){const h={RECORD_ALLOCATIONS:!1};class k{constructor(){this._current=[];for(this._allocations=h.RECORD_ALLOCATIONS?new b.AllocationTracer("WebGLObject"):null;this._current.length<n.ResourceType.COUNT;)this._current.push(0)}increment(m,g,e=1){this._current[m]+=e;this._allocations?.add(g)}decrement(m,g,e=1){this._current[m]-=e;this._allocations?.remove(g)}get current(){return this._current}get total(){return this.current.reduce((m,g,e)=>m+(e<n.ResourceType.UNCOUNTED?
g:0),0)}get resourceInformation(){let m="";if(0<this.total){m+="Live objects:\n";for(let g=0;g<n.ResourceType.COUNT;++g){const e=this._current[g];0<e&&(m+=`${n.ResourceType[g]}: ${e}\n`)}}return m+=this._allocations?.resetLog()}}a.InstanceCounter=k;a.test=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(a){class b{constructor(n){this._objectType=n;this._active=new Map}add(n){const h=Error().stack.split("\n");
h.shift();h.shift();this._active.set(n,h.join("\n"))}remove(n){this._active.delete(n)}resetLog(){const n=new Map;this._active.forEach((m,{usedMemory:g})=>{n.has(m)||n.set(m,new Map);m=n.get(m);m.set(g??0,m.get(g??0)??1)});this._active.clear();let h=0;const k=[];n.forEach((m,g)=>{let e=0;m.forEach((d,c)=>e+=d*c);m.set(-1,e);h+=e;k.push([g,m])});n.clear();k.sort((m,g)=>g[1].get(-1)-m[1].get(-1));return k.reduce((m,[g,e])=>{const d=Math.round(e.get(-1)/1024);e.delete(-1);e=Array.from(e.values()).reduce((c,
l)=>c+l,0);return m+=`  ${d}KB from ${e} allocations at ${g}\n`},`Total unestimated ${this._objectType} memory: ${Math.round(h/1024)}KB\n`)}}a.AllocationTracer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(a){class b{constructor(n,h,k){h=h.textureFilterAnisotropic;k=k.maxAnisotropy??Infinity;this.versionString=n.getParameter(n.VERSION);this.maxVertexTextureImageUnits=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
this.maxVertexAttributes=n.getParameter(n.MAX_VERTEX_ATTRIBS);this.maxMaxAnisotropy=h?Math.min(n.getParameter(h.MAX_TEXTURE_MAX_ANISOTROPY),k):1;this.maxTextureImageUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE);this.maxRenderbufferSize=n.getParameter(n.MAX_RENDERBUFFER_SIZE);this.maxViewportDims=n.getParameter(n.MAX_VIEWPORT_DIMS);this.maxUniformBufferBindings=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);this.maxVertexUniformBlocks=n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS);
this.maxFragmentUniformBlocks=n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS);this.maxUniformBlockSize=n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE);this.uniformBufferOffsetAlignment=n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT);this.maxArrayTextureLayers=n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS);this.maxSamples=n.getParameter(n.MAX_SAMPLES)}}a.Parameters=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/NestedMap",
"./Program"],function(a,b,n){class h{constructor(k){this._rctx=k;this._store=new b.NestedMap}dispose(){this._store.forEach(k=>k.forEach(m=>m.dispose()));this._store.clear()}acquire(k,m,g,e){const d=this._store.get(k,m);if(null!=d)return d.ref(),d;g=new n.Program(this._rctx,k,m,g,e);g.ref();this._store.set(k,m,g);return g}get test(){let k=0;this._store.forEach(m=>m.forEach(g=>k+=g.hasGLName?2:1));return{cachedWebGLProgramObjects:k}}}a.ProgramCache=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(a,b,n,h,k){function m(l,f,r){l=l.gl;const x=l.createShader(f);l.shaderSource(x,r);l.compileShader(x);n.webglValidateShadersEnabled()&&!l.getShaderParameter(x,l.COMPILE_STATUS)&&(console.error("Compile error in ".concat(f===h.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(l.getShaderInfoLog(x)),console.error(g(r)));return x}function g(l){let f=
2;return l.replaceAll("\n",()=>{var r=f++;r=1E3<=r?r.toString():("  "+r).slice(-3);return"\n"+r+":"})}function e(l,f,r){const x=l.get(f);if(!x)return l.set(f,Array.from(r)),!0;const w=r.length;if(x.length!==w)return l.set(f,Array.from(r)),!0;for(l=0;l<w;++l)if(f=r[l],x[l]!==f){for(x[l]=f;l<w;++l)x[l]=r[l];return!0}return!1}class d{constructor(l,f,r,x,w=new Map,p=[]){this._context=l;this._locations=x;this._uniformBlockBindings=w;this._transformFeedbackVaryings=p;this._refCount=1;this._compiled=!1;
this._linesOfCode=0;this._nameToUniformLocation=new Map;this._nameToUniform1=new Map;this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;l||console.error("RenderingContext isn't initialized!");0===f.length&&console.error("Shaders source should not be empty!");f=k.transpileShader(f,h.ShaderType.VERTEX_SHADER);r=k.transpileShader(r,h.ShaderType.FRAGMENT_SHADER);this._vShader=
m(this._context,h.ShaderType.VERTEX_SHADER,f);this._fShader=m(this._context,h.ShaderType.FRAGMENT_SHADER,r);c.enabled&&(this._linesOfCode=f.match(/\n/g).length+r.match(/\n/g).length+2,this._context.instanceCounter.increment(h.ResourceType.LinesOfCode,this._vShader,this._linesOfCode));this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(h.ResourceType.Shader,this);n.webglValidateShadersEnabled()&&(this.vertexShader=f,this.fragmentShader=r);this.usedMemory=
f.length+r.length;const t=this._context.gl,q=t.createProgram();t.attachShader(q,this._vShader);t.attachShader(q,this._fShader);this._locations.forEach((u,v)=>t.bindAttribLocation(q,u,v));this._transformFeedbackVaryings?.length&&t.transformFeedbackVaryings(q,this._transformFeedbackVaryings,t.SEPARATE_ATTRIBS);t.linkProgram(q);n.webglValidateShadersEnabled()&&!t.getProgramParameter(q,t.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${t.getProgramParameter(q,t.VALIDATE_STATUS)}`+`, gl error ${t.getError()}`+
`, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}`+`, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}`+`, info log: ${t.getProgramInfoLog(q)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);for(const [u,v]of this._uniformBlockBindings)l=t.getUniformBlockIndex(q,u),4294967295>l&&t.uniformBlockBinding(q,l,v);this._glName=q;this._context.instanceCounter.increment(h.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=
this._glName}get hasTransformFeedbackVaryings(){return!!this._transformFeedbackVaryings?.length}get compiled(){if(this._compiled)return!0;const l=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==l||null==this.glName?this._compiled=!0:this._compiled=!!this._context.gl.getProgramParameter(this.glName,l.COMPLETION_STATUS_KHR)}dispose(){if(!(0<--this._refCount)){var l=this._context.gl,f=this._context.instanceCounter;this._nameToUniformLocation.forEach(r=>r&&f.decrement(h.ResourceType.Uniform,
r));this._nameToUniformLocation.clear();this._vShader&&(0<this._linesOfCode&&(f.decrement(h.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),l.deleteShader(this._vShader),this._vShader=null,f.decrement(h.ResourceType.Shader,this));this._fShader&&(l.deleteShader(this._fShader),this._fShader=null);this._glName&&(l.deleteProgram(this._glName),this._glName=null,f.decrement(h.ResourceType.Program,this))}}ref(){++this._refCount}_getUniformLocation(l){var f=this._nameToUniformLocation.get(l);
return void 0!==f?f:this.glName?(f=this._context.gl.getUniformLocation(this.glName,l),this._nameToUniformLocation.set(l,f),f&&this._context.instanceCounter.increment(h.ResourceType.Uniform,f),f):null}hasUniform(l){return null!=this._getUniformLocation(l)}setUniform1i(l,f){const r=this._nameToUniform1.get(l);if(void 0===r||f!==r)this._context.gl.uniform1i(this._getUniformLocation(l),f),this._nameToUniform1.set(l,f)}setUniform1iv(l,f){e(this._nameToUniform1v,l,f)&&this._context.gl.uniform1iv(this._getUniformLocation(l),
f)}setUniform2iv(l,f){e(this._nameToUniform2,l,f)&&this._context.gl.uniform2iv(this._getUniformLocation(l),f)}setUniform3iv(l,f){e(this._nameToUniform3,l,f)&&this._context.gl.uniform3iv(this._getUniformLocation(l),f)}setUniform4iv(l,f){e(this._nameToUniform4,l,f)&&this._context.gl.uniform4iv(this._getUniformLocation(l),f)}setUniform1f(l,f){const r=this._nameToUniform1.get(l);if(void 0===r||f!==r)this._context.gl.uniform1f(this._getUniformLocation(l),f),this._nameToUniform1.set(l,f)}setUniform1fv(l,
f){e(this._nameToUniform1v,l,f)&&this._context.gl.uniform1fv(this._getUniformLocation(l),f)}setUniform2f(l,f,r){const x=this._nameToUniform2.get(l);if(void 0===x)this._context.gl.uniform2f(this._getUniformLocation(l),f,r),this._nameToUniform2.set(l,[f,r]);else if(f!==x[0]||r!==x[1])this._context.gl.uniform2f(this._getUniformLocation(l),f,r),x[0]=f,x[1]=r}setUniform2fv(l,f){e(this._nameToUniform2,l,f)&&this._context.gl.uniform2fv(this._getUniformLocation(l),f)}setUniform3f(l,f,r,x){const w=this._nameToUniform3.get(l);
if(void 0===w)this._context.gl.uniform3f(this._getUniformLocation(l),f,r,x),this._nameToUniform3.set(l,[f,r,x]);else if(f!==w[0]||r!==w[1]||x!==w[2])this._context.gl.uniform3f(this._getUniformLocation(l),f,r,x),w[0]=f,w[1]=r,w[2]=x}setUniform3fv(l,f){const r=this._getUniformLocation(l);null!=r&&e(this._nameToUniform3,l,f)&&this._context.gl.uniform3fv(r,f)}setUniform4f(l,f,r,x,w){const p=this._nameToUniform4.get(l);if(void 0===p)this._context.gl.uniform4f(this._getUniformLocation(l),f,r,x,w),this._nameToUniform4.set(l,
[f,r,x,w]);else if(void 0===p||f!==p[0]||r!==p[1]||x!==p[2]||w!==p[3])this._context.gl.uniform4f(this._getUniformLocation(l),f,r,x,w),p[0]=f,p[1]=r,p[2]=x,p[3]=w}setUniform4fv(l,f){const r=this._getUniformLocation(l);null!=r&&e(this._nameToUniform4,l,f)&&this._context.gl.uniform4fv(r,f)}setUniformMatrix3fv(l,f,r=!1){const x=this._getUniformLocation(l);null!=x&&e(this._nameToUniformMatrix3,l,f)&&this._context.gl.uniformMatrix3fv(x,r,f)}setUniformMatrix4fv(l,f,r=!1){const x=this._getUniformLocation(l);
null!=x&&e(this._nameToUniformMatrix4,l,f)&&this._context.gl.uniformMatrix4fv(x,r,f)}stop(){}}const c={enabled:!1};a.Program=d;a.test=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,b,n,h,k,m){function g(){function t(P){P.length&&B.push({type:x[E],data:P,position:L,line:z,column:K})}function q(){J=J.length?[]:J;if("/"===
H&&"*"===I)return L=C+A-1,E=0,H=I,A+1;if("/"===H&&"/"===I)return L=C+A-1,E=1,H=I,A+1;if("#"===I)return E=2,L=C+A,A;if(/\s/.test(I))return E=9,L=C+A,A;F=/\d/.test(I);M=/[^\w_]/.test(I);L=C+A;E=F?4:M?3:9999;return A}function u(){if(("\r"===I||"\n"===I)&&"\\"!==H)return t(J.join("")),E=999,A;J.push(I);H=I;return A+1}function v(){if("."===H&&/\d/.test(I))return E=5,A;if("/"===H&&"*"===I)return E=0,A;if("/"===H&&"/"===I)return E=1,A;if("."===I&&J.length){for(;y(J););E=5;return A}if(";"===I||")"===I||"("===
I){if(J.length)for(;y(J););t(I);E=999;return A+1}var P=2===J.length&&"\x3d"!==I;if(/[\w_\d\s]/.test(I)||P){for(;y(J););E=999;return A}J.push(I);H=I;return A+1}function y(P){var R=0;do{var O=m.operators.indexOf(P.slice(0,P.length+R).join(""));var T=m.operators[O];if(-1===O){if(0<R--+P.length)continue;T=P.slice(0,1).join("")}t(T);L+=T.length;J=J.slice(T.length);return J.length}while(1)}function D(){if("."===I||/[eE]/.test(I))return J.push(I),E=5,H=I,A+1;if("x"===I&&1===J.length&&"0"===J[0])return E=
11,J.push(I),H=I,A+1;if(/[^\d]/.test(I))return t(J.join("")),E=999,A;J.push(I);H=I;return A+1}function G(){"f"===I&&(J.push(I),H=I,A+=1);if(/[eE]/.test(I)||"-"===I&&/[eE]/.test(H))return J.push(I),H=I,A+1;if(/[^\d]/.test(I))return t(J.join("")),E=999,A;J.push(I);H=I;return A+1}var A=0,C=0,E=999,I,H,J=[],B=[],z=1,K=0,L=0,F=!1,M=!1,S="",N;return function(P){B=[];if(null!==P){P=P.replace?P.replace(/\r\n/g,"\n"):P;A=0;S+=P;for(N=S.length;I=S[A],A<N;){P=A;switch(E){case 0:"/"===I&&"*"===H?(J.push(I),t(J.join("")),
E=999):(J.push(I),H=I);A+=1;break;case 1:A=u();break;case 2:A=u();break;case 3:A=v();break;case 4:A=D();break;case 11:/[^a-fA-F0-9]/.test(I)?(t(J.join("")),E=999):(J.push(I),H=I,A+=1);break;case 5:A=G();break;case 9999:if(/[^\d\w_]/.test(I)){var R=J.join("");E=-1<m.literals.indexOf(R)?8:-1<m.builtins.indexOf(R)?7:6;t(J.join(""));E=999}else J.push(I),H=I,A+=1;break;case 9:/[^\s]/g.test(I)?(t(J.join("")),E=999):(J.push(I),H=I,A+=1);break;case 999:A=q()}if(P!==A)switch(S[P]){case "\n":K=0;++z;break;
default:++K}}C+=A;S=S.slice(A);return B}J.length&&t(J.join(""));E=10;t("(eof)");return B}}function e(t){return t.map(q=>"eof"!==q.type?q.data:"").join("")}function d(t,q="100",u="300 es"){const v=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const y of t)if("preprocessor"===y.type){const D=v.exec(y.data);if(D){t=D[1].replaceAll(/\s\s+/g," ");if(t===u)return t;if(t===q)return y.data="#version "+u,q;throw Error("unknown glsl version: "+t);}}t.splice(0,0,{type:"preprocessor",data:"#version "+u},{type:"whitespace",
data:"\n"});return null}function c(t,q,u,v){v=v||u;for(const y of t)if("ident"===y.type&&y.data===u)return v in q?q[v]++:q[v]=0,c(t,q,v+"_"+q[v],v);return u}function l(t,q,u="afterVersion"){const v={data:"\n",type:"whitespace"},y=G=>G<t.length?/[^\r\n]$/.test(t[G].data):!1;let D=function(G){let A=-1,C=0,E=-1;for(let H=0;H<G.length;H++){var I=G[H];"preprocessor"===I.type&&(/#(if|ifdef|ifndef)\s+.+/.test(I.data)?++C:/#endif\s*.*/.test(I.data)&&--C);("afterVersion"===u||"afterPrecision"===u)&&"preprocessor"===
I.type&&I.data.startsWith("#version")&&(E=Math.max(E,H));if("afterPrecision"===u&&"keyword"===I.type&&"precision"===I.data){a:{for(I=H;I<G.length;I++){const J=G[I];if("operator"===J.type&&";"===J.data)break a}I=null}if(null===I)throw Error("precision statement not followed by any semicolons!");E=Math.max(E,I)}A<E&&0===C&&(A=H)}return A+1}(t);y(D-1)&&t.splice(D++,0,v);for(const G of q)t.splice(D++,0,G);y(D-1)&&y(D)&&t.splice(D,0,v)}function f(t,q,u,v="lowp"){l(t,[{type:"keyword",data:"out"},{type:"whitespace",
data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"ident",data:q},{type:"operator",data:";"}],"afterPrecision")}function r(t,q,u,v,y="lowp"){l(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:v.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",
data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"keyword",data:u},{type:"whitespace",data:" "},{type:"ident",data:q},{type:"operator",data:";"}],"afterPrecision")}var x="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const w=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]),p=new Map;a.transpileShader=function(t,q){if(t.startsWith("#version 300"))return t;
var u=k.shaderTranspiler.enableCache?p.get(t):null;if(null!=u)return u;u=g();var v=[];v=v.concat(u(t));u=v=v.concat(u(null));if("300 es"===d(u,"100","300 es"))return t;var y=v=null;const D={},G={};for(let I=0;I<u.length;++I){const H=u[I];switch(H.type){case "keyword":q===n.ShaderType.VERTEX_SHADER&&"attribute"===H.data?H.data="in":"varying"===H.data&&(H.data=q===n.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(H.data.trim())&&(H.data=H.data.replaceAll(/(2D|Cube|EXT)/g,
""));q===n.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===H.data&&(v||(v=c(u,D,"fragColor"),f(u,v,"vec4")),H.data=v);if(q===n.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===H.data){var A=void 0;let J=void 0;var C=u,E=I+1;let B=-1;for(;E<C.length;E++){const z=C[E];if("operator"===z.type&&("["===z.data&&(J=E),"]"===z.data)){A=E;break}"integer"===z.type&&(B=parseInt(z.data,10))}J&&A&&C.splice(J,A-J+1);C=B;A=c(u,D,"fragData");r(u,A,"vec4",C,"mediump");H.data=A}else q===n.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===
H.data&&(y||=c(u,D,"gl_FragDepth"),H.data=y);break;case "ident":if(h.includes(H.data)){if(C=q===n.ShaderType.VERTEX_SHADER)a:{for(C=I-1;0<=C;C--)if(A=u[C],"whitespace"!==A.type&&"block-comment"!==A.type)if("keyword"===A.type){if("attribute"===A.data||"in"===A.data){C=!0;break a}}else break;C=!1}if(C)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");H.data in G||(G[H.data]=c(u,D,H.data));H.data=G[H.data]}}}for(q=u.length-1;0<=q;--q)v=u[q],"preprocessor"===
v.type&&((y=v.data.match(/#extension\s+(.*):/))&&y[1]&&w.has(y[1].trim())&&(y=u[q+1],u.splice(q,y&&"whitespace"===y.type?2:1)),(y=v.data.match(/#ifdef\s+(.*)/))&&y[1]&&w.has(y[1].trim())&&(v.data="#if 1"),(y=v.data.match(/#ifndef\s+(.*)/))&&y[1]&&w.has(y[1].trim())&&(v.data="#if 0"));u=e(u);k.shaderTranspiler.enableCache&&p.set(t,u);return u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports","./_commonjsHelpers"],function(a,b){var n={exports:{}};(function(m){(function(g){g=g();void 0!==g&&(m.exports=g)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(n);
n=b.getDefaultExportFromCjs(n.exports);var h={exports:{}};(function(m){(function(g){g=g();void 0!==g&&(m.exports=g)})(function(){return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(h);h=b.getDefaultExportFromCjs(h.exports);var k={exports:{}};(function(m){(function(g){g=g();void 0!==g&&(m.exports=g)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})(k);
b=b.getDefaultExportFromCjs(k.exports);a.builtins=b;a.literals=n;a.operators=h})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,n,h,k,m){class g{constructor(e){this.rctx=e;this.floatBufferBlend=new h.FloatBufferBlend(e);this.svgPremultipliesAlpha=new m.SVGPremultipliedAlpha(e);this.doublePrecisionRequiresObfuscation=new n.DoublePrecisionRequiresObfuscation(e);
this.ignoresSamplerPrecision=new k.IgnoresSamplerPrecision(e);this.drawArraysRequiresIndicesTypeReset=new b.DrawArraysRequiresIndicesTypeReset(e)}dispose(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()}}a.WebGLDriverTest=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./AppleAmdDriverHelper ./BufferObject ./enums ./FramebufferObject ./TextureDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,h,k,m,g,e,d){class c extends d.WebGLDriverTestModule{constructor(l){super();this._rctx=l;this._helperProgram=null;b("mac")&&b("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose();this._helperProgram?.dispose();this._helperProgram=null}_test(l){const f=this._rctx,r=f.getBoundFramebufferObject(),{x,y:w,width:p,height:t}=f.getViewport();f.resetState();var q=new e.TextureDescriptor(1);q.wrapMode=m.TextureWrapMode.CLAMP_TO_EDGE;
q.samplingMode=m.TextureSamplingMode.NEAREST;q=new g.FramebufferObject(f,q);const u=k.BufferObject.createIndex(this._rctx,m.Usage.STATIC_DRAW,new Uint8Array([0]));f.bindFramebuffer(q);f.setViewport(0,0,1,1);f.useProgram(this._helperProgram);f.bindBuffer(u,m.BufferType.ELEMENT_ARRAY_BUFFER);f.drawElements(m.PrimitiveType.POINTS,1,m.DataType.UNSIGNED_BYTE,0);f.useProgram(l);f.bindVAO(null);f.drawArrays(m.PrimitiveType.TRIANGLES,0,258);l=new Uint8Array(4);q.readPixels(0,0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,
l);f.setViewport(x,w,p,t);f.bindFramebuffer(r);q.dispose();u.dispose();return 255===l[0]}_prepareProgram(){const l=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${n.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
f=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${n.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(l,f,new Map([]))}_prepareHelperProgram(){const l=h.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(l.vertex,l.fragment,new Map([]))}}a.DrawArraysRequiresIndicesTypeReset=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(a,b){class n{constructor(){this._result=!1}dispose(){this._program=b.disposeMaybe(this._program)}get result(){null!=this._program&&(this._result=this._test(this._program),this.dispose());return this._result}}a.WebGLDriverTestModule=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../core/has ../../core/maybe ../../core/libs/gl-matrix-2/factories/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(p,t){return p.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}class w extends r.WebGLDriverTestModule{constructor(p){super();this._rctx=p;this._program=x(this._rctx,!1);this._obfuscated=x(this._rctx,!0)}dispose(){super.dispose();this._obfuscated=h.disposeMaybe(this._obfuscated)}_test(p){if(n("force-double-precision-obfuscation"))return!0;if(null==this._obfuscated)return!1;const t=this._rctx,q=t.getBoundFramebufferObject(),
{x:u,y:v,width:y,height:D}=t.getViewport();p=this._runProgram(p);const G=this._runProgram(this._obfuscated);t.setViewport(u,v,y,D);t.bindFramebuffer(q);return 0!==p&&(0===G||5<p/G)}_runProgram(p){var t=this._rctx;t.resetState();var q=new c.TextureDescriptor(1);q.wrapMode=e.TextureWrapMode.CLAMP_TO_EDGE;q.samplingMode=e.TextureSamplingMode.NEAREST;q=new d.FramebufferObject(t,q);var u=m.BufferObject.createVertex(t,e.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));u=new l.VertexArrayObject(t,new Map([["position",
0]]),{geometry:[new f.VertexElementDescriptor("position",2,e.DataType.UNSIGNED_SHORT,0,4)]},{geometry:u});const v=k.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),y=k.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),D=new Float32Array(6);g.encodeDoubleArray(v,D,3);const G=new Float32Array(6);g.encodeDoubleArray(y,G,3);t.useProgram(p);p.setUniform3f("u_highA",D[0],D[2],D[4]);p.setUniform3f("u_lowA",D[1],D[3],D[5]);p.setUniform3f("u_highB",G[0],G[2],G[4]);p.setUniform3f("u_lowB",
G[1],G[3],G[5]);t.bindFramebuffer(q);t.setViewport(0,0,1,1);t.bindVAO(u);t.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,4);p=new Uint8Array(4);q.readPixels(0,0,1,1,e.PixelFormat.RGBA,e.PixelType.UNSIGNED_BYTE,p);u.dispose();q.dispose();t=(v[2]-y[2])/25;p=b.unpackFloatRGBA(p);return Math.abs(t-p)}}a.DoublePrecisionRequiresObfuscation=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./enums ./FramebufferObject ./renderState ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends c.WebGLDriverTestModule{constructor(f){super();this._rctx=f;f.gl&&f.capabilities.colorBufferFloat?.textureFloat&&f.capabilities.colorBufferFloat?.floatBlend&&(this._program=f.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",
new Map([["a_pos",0]])))}_test(f){const r=this._rctx;var x=new g.TextureDescriptor(1);x.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;x.dataType=h.PixelType.FLOAT;x.internalFormat=h.SizedPixelFormat.RGBA32F;x.samplingMode=h.TextureSamplingMode.NEAREST;x=new k.FramebufferObject(r,x);var w=n.BufferObject.createVertex(r,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));w=new e.VertexArrayObject(r,new Map([["a_pos",0]]),{geometry:[new d.VertexElementDescriptor("a_pos",2,h.DataType.UNSIGNED_SHORT,0,4)]},
{geometry:w});r.useProgram(f);f=r.getBoundFramebufferObject();const {x:p,y:t,width:q,height:u}=r.getViewport();r.bindFramebuffer(x);r.setViewport(0,0,1,1);r.bindVAO(w);r.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);var v=m.makePipelineState({blending:b.blendingAlpha});r.setPipelineState(v);r.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);v=r.gl.getError();r.setViewport(p,t,q,u);r.bindFramebuffer(f);w.dispose();x.dispose();return 1282===v?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),
!1):!0}}a.FloatBufferBlend=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l extends c.WebGLDriverTestModule{constructor(f){super();this._rctx=f;this._program=f.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]))}_test(f){const r=this._rctx;var x=new g.TextureDescriptor(1);x.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=h.TextureSamplingMode.NEAREST;const w=new k.FramebufferObject(r,x),p=new Uint8Array(4);var t=n.BufferObject.createVertex(r,h.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new e.VertexArrayObject(r,new Map([["a_position",
0]]),{geometry:[new d.VertexElementDescriptor("a_position",2,h.DataType.SHORT,0,4)]},{geometry:t});r.useProgram(f);x=new m.Texture(r,x,new Uint8Array([2,255,0,0]));f.setUniform1i("u_texture",0);r.bindTexture(x,0);x=r.getBoundFramebufferObject();r.bindFramebuffer(w);r.useProgram(f);const {x:q,y:u,width:v,height:y}=r.getViewport();r.setViewport(0,0,1,1);r.bindVAO(t);r.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);r.setViewport(q,u,v,y);w.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,
p);t.dispose();w.dispose();(f=255!==p[0]||255!==p[1]||255!==p[2]||255!==p[3])&&b.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${p[0]}.${p[1]}.${p[2]}.${p[3]}]`);r.bindFramebuffer(x);return f}}
a.IgnoresSamplerPrecision=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./TextureDescriptor ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,b,n,h,k,m,g,e,d){class c extends d.WebGLDriverTestModule{constructor(f){super();this._rctx=f;this._program=f.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(f){const r=this._rctx;if(!r.gl)return f.dispose(),!0;var x=new g.TextureDescriptor(1);x.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;x.samplingMode=h.TextureSamplingMode.NEAREST;x=new k.FramebufferObject(r,x);var w=n.BufferObject.createVertex(r,h.Usage.STATIC_DRAW,new Uint16Array([0,
0,1,0,0,1,1,1]));w=new e.VertexArrayObject(r,new Map([["a_pos",0]]),b.Pos2us,{geometry:w});var p=new g.TextureDescriptor;p.samplingMode=h.TextureSamplingMode.LINEAR;p.wrapMode=h.TextureWrapMode.CLAMP_TO_EDGE;p=new m.Texture(r,p,l);r.useProgram(f);r.bindTexture(p,0);f.setUniform1i("u_texture",0);f=r.getBoundFramebufferObject();const {x:t,y:q,width:u,height:v}=r.getViewport();r.bindFramebuffer(x);r.setViewport(0,0,1,1);r.setClearColor(0,0,0,0);r.setBlendingEnabled(!1);r.clearSafe(h.ClearBufferBit.COLOR_BUFFER_BIT);
r.bindVAO(w);r.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);x.readPixels(0,0,1,1,h.PixelFormat.RGBA,h.PixelType.UNSIGNED_BYTE,y);w.dispose();x.dispose();p.dispose();r.setViewport(t,q,u,v);r.bindFramebuffer(f);return 255!==y[0]}}const l=new Image;l.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
l.width=5;l.height=5;l.decode();a.SVGPremultipliedAlpha=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,n){const h={geometry:[new n.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},k={geometry:[new n.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new n.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,
2,4)]};b={geometry:[new n.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=h;a.Pos2us=b;a.PosTex2b=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports","./DisjointTimerQuery","./load","./LoseContext"],function(a,b,n,h){class k{constructor(m,g){this._gl=m;this._textureFloatLinear=this._depthTexture=this._textureNorm16=this._loseContext=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=
this._compressedTextureS3TC=this._compressedTextureETC=null;this._disabledExtensions=g.disabledExtensions||{};this._debugWebGLExtensions=g.debugWebGLExtensions||{}}get compressedTextureETC(){this._compressedTextureETC||(this._compressedTextureETC=n.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}get compressedTextureS3TC(){this._compressedTextureS3TC||(this._compressedTextureS3TC=n.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}get textureFilterAnisotropic(){this._textureFilterAnisotropic||
(this._textureFilterAnisotropic=n.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions));return this._textureFilterAnisotropic}get disjointTimerQuery(){this._disjointTimerQuery||(this._disjointTimerQuery=b.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}get textureFloat(){if(!this._textureFloat){const {textureFloatLinear:m}=this._disabledExtensions;this._textureFloat={textureFloatLinear:!m&&!!this._gl.getExtension("OES_texture_float_linear")}}return this._textureFloat}get colorBufferFloat(){this._colorBufferFloat||
(this._colorBufferFloat=n.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}get depthTexture(){null===this._depthTexture&&(this._depthTexture=n.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}get loseContext(){this._loseContext||(this._loseContext=h.load(this._gl,this._debugWebGLExtensions));return this._loseContext}get textureNorm16(){this._textureNorm16||
(this._textureNorm16=n.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}get textureFloatLinear(){null===this._textureFloatLinear&&(this._textureFloatLinear=n.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}enable(m){return this[m]}}a.Capabilities=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],
function(a){a.loadBooleanExtension=function(b,n,h,k,m){if(k)return!0;if(n[h])return!1;for(const g of m)if(b.getExtension(g))return!0;return!1};a.loadColorBufferFloat=function(b,n){const h=!n.colorBufferHalfFloat&&b.getExtension("EXT_color_buffer_half_float")||!n.colorBufferFloat&&b.getExtension("EXT_color_buffer_float"),k=!n.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");n=!n.floatBlend&&!n.colorBufferFloat&&b.getExtension("EXT_float_blend");return h||k||n?{textureFloat:!!k,textureHalfFloat:!!h,
floatBlend:!!n,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null};a.loadCompressedTextureETC=function(b,n){return n.compressedTextureETC?null:(b=b.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:b.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:b.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:b.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:b.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:b.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:b.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:b.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(b,n){return n.compressedTextureS3TC?null:(b=b.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:b.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:b.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:b.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:b.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(b,n){return n.textureFilterAnisotropic?null:(b=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:b.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:b.TEXTURE_MAX_ANISOTROPY_EXT}:
null};a.loadTextureNorm16=function(b,n){return n.textureNorm16?null:(b=b.getExtension("EXT_texture_norm16"))?{R16:b.R16_EXT,RG16:b.RG16_EXT,RGB16:b.RGB16_EXT,RGBA16:b.RGBA16_EXT,R16_SNORM:b.R16_SNORM_EXT,RG16_SNORM:b.RG16_SNORM_EXT,RGB16_SNORM:b.RGB16_SNORM_EXT,RGBA16_SNORM:b.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,n){const h=n.loseContext&&b.getExtension("WEBGL_lose_context");
return h?{loseRenderingContext:()=>h.loseContext()}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./ITexture ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){a.TextureRepository=class extends n{constructor(u,v,y){super({});this._stage=u;this._techniqueRepository=v;this._rctx=y;this._textures=new Map;this._loadingCount=0;this._frameUpdates=new Map;this.events=new h;this._frameTask=u.view.resourceController.scheduler.registerTask(t.TaskPriority.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove();this._stage.forEachOfType(f.ContentObjectType.Texture,u=>u.unload())}get updating(){return 0<
this._loadingCount||this._frameTask.updating}get textureTechnique(){null==this._textureTechnique&&(this._textureTechnique=this._techniqueRepository.acquire(x.TextureTechnique,new w.TextureTechniqueConfiguration));return this._textureTechnique}acquire(u){const v=this._textures.get(u);return v?(v.ref(),v.loadingPromise??v):this._createNewRef(u)}update(){let u=!1;this._frameUpdates.forEach(v=>{const y=v.texture.frameUpdate(v.previousToken);0<=y&&y!==v.previousToken&&(v.previousToken=y,u=!0)});u&&this.events.emit("changed",
l.RenderRequestType.BACKGROUND)}_createNewRef(u){const v=this._stage.getObject(u);if(null==v)return p.assert(void 0!==v),null;const y=v.events.on("unloaded",()=>{y.remove();this._onTextureUnloaded(u)}),D=new q(u,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&v.unload()})});this._textures.set(u,D);D.ref();if(v.glTexture)return this._updateGLTexture(D,v.glTexture),r.isFrameUpdateTexture(v)&&this._frameUpdates.set(u,{texture:v,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>
{const G=v.load(this._rctx),A=E=>{this._loadingCount--;D.loadingPromise=null;this._updateGLTexture(D,E);r.isFrameUpdateTexture(v)&&this._frameUpdates.set(u,{texture:v,previousToken:-1});return D},C=E=>{this._loadingCount--;D.loadingPromise=null;m.isAbortError(E)||k.getLogger(this).error(E);return null};return m.isPromiseLike(G)?G.then(A,C):A(G)});return D.loadingPromise}_updateGLTexture(u,v){u.glTexture=v;this.events.emit("changed",l.RenderRequestType.UPDATE)}_onTextureUnloaded(u){this._textures.delete(u);
this._frameUpdates.delete(u)}};b.__decorate([g.property()],a.TextureRepository.prototype,"_loadingCount",void 0);b.__decorate([g.property()],a.TextureRepository.prototype,"_frameTask",void 0);b.__decorate([g.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=b.__decorate([c.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);class q{constructor(u,v){this.id=u;this._release=v;this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount;
0<this._refCount||(0===this._refCount?this._release():(k.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0))}}Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ITexture":function(){define(["exports"],function(a){a.isFrameUpdateTexture=function(b){return!!b.frameUpdate};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/markerTextureRepository":function(){define(["exports",
"../../support/engineContent/marker","./ProceduralTextureRepository"],function(a,b,n){a.createMarkerTextureRepository=function(h,k){return new n.ProceduralTextureRepository(m=>b.createMarkerTexture(m,h),m=>m,k)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/RandomLCG ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/TextureDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){a.WaterTextureRepository=class extends h{constructor(){super(...arguments);this._passParameters=new u;this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=g.abortMaybe(this._resourcesTask);this._passParameters.waveNormal=g.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePerturbation=g.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&
!this._resourcesTask.finished}ensureResources(v){this._resourcesTask||(this._resourcesTask=k.createTask(async y=>{await Promise.allSettled([this._loadImageResource(v,n.getAssetUrl("esri/images/materials/water/normals.jpg"),D=>this._passParameters.waveNormal=D,y),this._loadImageResource(v,n.getAssetUrl("esri/images/materials/water/perturbation.jpg"),D=>this._passParameters.wavePerturbation=D,y)])}));return this._resourcesTask.finished?w.ResourceState.LOADED:w.ResourceState.LOADING}async _loadImageResource(v,
y,D,G){try{const A=await r.requestImage(y,{signal:G});e.throwIfAborted(G);const C=new q.TextureDescriptor(A.width,A.height);C.pixelFormat=p.PixelFormat.RGB;C.samplingMode=p.TextureSamplingMode.LINEAR_MIPMAP_LINEAR;C.hasMipmap=!0;C.maxAnisotropy=8;D(new t.Texture(v,C,A))}catch(A){m.getLogger(this).error("Failed to load water material normal texture.",A)}}};b.__decorate([d.property()],a.WaterTextureRepository.prototype,"_resourcesTask",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,
"updating",null);a.WaterTextureRepository=b.__decorate([f.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);class u extends x.NoParameters{}a.WaterTexturePassParameters=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../lib/basicInterfaces ../lib/rendererUtils ../../../support/RenderState ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),function(a,b,n,h,k,m,g,e,d,c){class l{constructor(r,x,w){this.parameters=r;this.frameHasDecorations=x;this.fbos=w}}class f{constructor(r,x,
w){this._rctx=r;this._renderFunctions=x;this._forceCameraHook=w;this.supersample=!0;this._screenshotQueue=[]}destroy(){this._rctx=null}async takeScreenshot(r){await this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(h.RenderRequestType.BACKGROUND);const x=b.createResolver();this._screenshotQueue.push({settings:r,resolver:x});return x.promise}update(r,x){for(const w of this._screenshotQueue){if(null==this._rctx){w.resolver.reject();continue}const p=this._renderScreenshot(r,
{...w.settings,pixelRatio:w.settings.pixelRatio*r.parameters.camera.pixelRatio},x);w.resolver(p)}this._screenshotQueue.length=0}_renderScreenshotOverlay(r,x,w){r.width=x.width;r.height=x.height;const p=r.getContext("2d"),t=w.pixelRatio;p.save();p.translate(0,x.height);p.scale(1,-1);w.region&&p.translate(-w.region.x,-w.region.y);p.scale(t,t);x=this._renderFunctions.renderOverlay(r,w.disableDecorations?h.Decorations.OFF:h.Decorations.ON,x);p.restore();return x}_readbackScreenshot(r,x){return r.resample?
this._readbackScreenshotResampled({...r,resample:r.resample},x):this._readbackScreenshotImmediate(r,x)}_readbackScreenshotResampled(r,x){const {framebufferWidth:w,framebufferHeight:p,region:t,resample:q}=r,u=this._ensureScreenshotEncodeCanvas();let v=c.createEmptyImageData(w,p,u);this._rctx.gl.readPixels(0,0,w,p,e.PixelFormat.RGBA,e.DataType.UNSIGNED_BYTE,new Uint8Array(v.data.buffer));x();v=this._renderScreenshotOverlay(u,v,{...r,region:void 0});r=c.createEmptyImageData(t.width,t.height,u);return g.resampleHermite(v,
r,!0,q.region.x,p-(q.region.y+q.region.height),q.region.width,q.region.height)}_readbackScreenshotImmediate(r,x){const {framebufferHeight:w,region:p}=r,t=this._ensureScreenshotEncodeCanvas(),q=c.createEmptyImageData(p.width,p.height,t);this._rctx.gl.readPixels(p.x,w-(p.y+p.height),p.width,p.height,e.PixelFormat.RGBA,e.DataType.UNSIGNED_BYTE,new Uint8Array(q.data.buffer));x();return this._renderScreenshotOverlay(t,q,r)}_renderScreenshot(r,x,w){var p=r.parameters.camera,t={width:x.framebufferWidth,
height:x.framebufferHeight};d.ensureAttachmentMaxSize(t,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));var q=!1,u=x.disableDecorations&&r.frameHasDecorations,v=x.ignorePadding&&p.pixelRatio!==x.pixelRatio;u=t.width!==p.fullWidth||t.height!==p.fullHeight||u||v||x.objectAndLayerIdColor;let y=null,D=null;if(u){q=p.clone();if(x.ignorePadding){v=n.clone(q.padding);for(let G=0;4>G;G++)v[G]=Math.round(v[G]/q.pixelRatio*x.pixelRatio);q.padding=v}q.fullWidth=t.width;
q.fullHeight=t.height;q.pixelRatio=x.pixelRatio;t=p.fovX-q.fovX;v=p.fovY-q.fovY;0>t&&t<v?q.fovX=p.fovX:0>v&&v<t&&(q.fovY=p.fovY);p={camera:q,contentCamera:q,mode:m.RenderState.IDLE,alignPixelEnabled:!0,contentPixelRatio:q.pixelRatio};this._forceCameraHook(p);q=!0;w=this._renderFunctions.renderScene(p,w,x.objectAndLayerIdColor?k.RendererTarget.ObjectAndLayerID:k.RendererTarget.Screenshot,x.disableDecorations?h.Decorations.OFF:h.Decorations.ON);D=w.screen;y=w.oid}this._rctx.bindFramebuffer(D?.fbo);
w=this._readbackScreenshot(x,()=>{this._rctx.bindFramebuffer(null);D?.release()});p=null;x.objectAndLayerIdColor&&(this._rctx.bindFramebuffer(y?.fbo),p=this._readbackScreenshot(x,()=>{this._rctx.bindFramebuffer(null);y?.release()}),this._rctx.bindFramebuffer(null));if(u&&!this._rctx.contextAttributes.alpha)for(x=3;x<w.data.length;x+=4)w.data[x]=255;if(p&&!this._rctx.contextAttributes.alpha)for(x=3;x<p.data.length;x+=4)p.data[x]=255;q&&this._forceCameraHook(r.parameters);return[w,p]}_ensureScreenshotEncodeCanvas(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas}}a.ScreenshotContext=l;a.ScreenshotManager=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/imageUtils"],function(a,b,n,h){function k(p,t){const {format:q,quality:u,rotation:v,disableDecorations:y}=p||{};var D=c(p,t.padding);var G=t.width-D.left-D.right;t=t.height-D.top-
D.bottom;D={x:0,y:0,width:G,height:t};if(p?.area){null!=p.area.x&&(D.x=Math.floor(p.area.x));null!=p.area.y&&(D.y=Math.floor(p.area.y));var A=null!=p.area.width?Math.floor(p.area.width):null,C=null!=p.area.height?Math.floor(p.area.height):null;D.width=G-D.x;D.height=t-D.y;null!=A&&null!=C?(D.width=Math.min(D.width,A),D.height=Math.min(D.height,C)):null==A&&null!=C?(A=Math.min(D.width,A),D.height*=A/D.width,D.width=A):null!=A&&null==C&&(A=Math.min(D.height,C),D.width*=A/D.height,D.height=A)}D=d(D,
p);A=Math.floor(Math.max(D.x,0));C=Math.floor(Math.max(D.y,0));G={x:A,y:C,width:Math.floor(Math.min(D.width,G-A)),height:Math.floor(Math.min(D.height,t-C))};t=G.width/G.height;D=D.width/D.height;D!==t&&(D>t?(t=Math.floor(G.width/D),G={x:G.x,y:Math.floor(G.y+(G.height-t)/2),width:G.width,height:t}):(t=Math.floor(G.height*D),G={x:Math.floor(G.x+(G.width-t)/2),y:G.y,width:t,height:G.height}));const {width:E,height:I}=e(p,G);t=l(q);D=x[t];D=n.clamp(null!=u?u:D,0,100);return{format:t,quality:D,area:G,
width:E,height:I,rotation:v,disableDecorations:!!y,ignoreBackground:!!p?.ignoreBackground,ignorePadding:!!p?.ignorePadding}}function m(p,t){null==f&&(f=document.createElement("canvas"));var q=f;if(t.premultipliedAlpha){var u=p.data;const y=u.length;for(let D=0;D<y;D+=4){var v=u[D+3];255!==v&&0<v&&(v=255/v,u[D]*=v,u[D+1]*=v,u[D+2]*=v)}}q.width=p.width;q.height=p.height;u=q.getContext("2d",{willReadFrequently:!0});u.putImageData(p,0,0);t.flipY&&(u.save(),u.globalCompositeOperation="copy",u.scale(1,
-1),u.translate(0,-u.canvas.height),u.drawImage(u.canvas,0,0),u.restore());return{ctx:u,canvas:q}}function g(p,t){return p.toDataURL(r[t.format],t.quality/100)}function e(p,t){if(!p)return t;const q=p.width;p=p.height;if(null!=q&&null!=p)return{width:Math.floor(q),height:Math.floor(p)};if(null==q&&null==p)return t;t=t.width/t.height;return null==p?{width:Math.floor(q),height:Math.floor(q/t)}:{width:Math.floor(p*t),height:Math.floor(p)}}function d(p,t){if(null==t?.width||null==t.height)return p;t=
t.width/t.height;const q=p.width/p.height;if(q===t)return p;if(q<t)return t=Math.floor(p.height*t),p.x-=(t-p.width)/2,p.width=t,p;t=Math.floor(p.width/t);p.y-=(t-p.height)/2;p.height=t;return p}function c(p,t){return!t||p&&p.ignorePadding?w:t}function l(p){switch(p){case "png":case "jpg":case "jpeg":return p;case null:case void 0:return"png";default:return"png"}}let f=null;const r={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},x={png:100,jpg:98,jpeg:98},w={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=
h.createEmptyImageData;a.completeUserSettings=k;a.encode=function(p,t,q){const {ctx:u,canvas:v}=m(p,q);p=u.getImageData(0,0,p.width,p.height);t=g(v,t);v.width=0;v.height=0;return{dataUrl:t,data:p}};a.encodeData=function(p,t){const {ctx:q,canvas:u}=m(p,t);p=q.getImageData(0,0,p.width,p.height);u.width=0;u.height=0;return p};a.getFormatAndQuality=function(p,t){p=l(p);const q=x[p];t=n.clamp(null!=t?t:q,0,100);return{format:p,quality:t}};a.getMaximumResolutionScale=function(p,t){return t/Math.max(p[0],
p[1])};a.resampleHermite=function(p,t,q,u=0,v=0,y=p.width-u,D=p.height-v,G=!1){const {data:A}=p,{width:C,height:E,data:I}=t;y/=C;D/=E;const H=Math.ceil(y/2),J=Math.ceil(D/2);p=p.width;for(let K=0;K<E;K++)for(let L=0;L<C;L++){const F=4*(L+(G?E-K-1:K)*C);let M=0,S=0,N=0,P=0,R=0,O=0;const T=(K+.5)*D;for(let Q=Math.floor(K*D);Q<(K+1)*D;Q++){var B=Math.abs(T-(Q+.5))/J;const V=(L+.5)*y;B*=B;for(let U=Math.floor(L*y);U<(L+1)*y;U++){var z=Math.abs(V-(U+.5))/H;z=Math.sqrt(B+z*z);if(1<=z)continue;z=2*z*z*z-
3*z*z+1;const W=4*(u+U+(v+Q)*p);O+=z*A[W+3];S+=z;!q&&255>A[W+3]&&(z=z*A[W+3]/255);N+=z*A[W];P+=z*A[W+1];R+=z*A[W+2];M+=z}}I[F]=N/M;I[F+1]=P/M;I[F+2]=R/M;I[F+3]=O/S}return t};a.screenshotSuperSampleSettings=function(p,t,q){if(!t)return p;const {framebufferWidth:u,framebufferHeight:v,pixelRatio:y,region:D}=p;t=c(p,q);q=t.left+t.right;const G=t.top+t.bottom,A=u-q,C=v-G,E=Math.min(8,Math.min((2048-q)/A,(2048-G)/C));return 1.5>E?p:{...p,framebufferWidth:Math.round(A*E)+q,framebufferHeight:Math.round(C*
E)+G,pixelRatio:y*E,resample:{region:{x:Math.round((D.x-t.left)*E)+t.left,y:Math.round((D.y-t.top)*E)+t.top,width:Math.round(D.width*E),height:Math.round(D.height*E)},width:u,height:v}}};a.toDataUrl=g;a.toRenderSettings=function(p,t){const q=k(p,t),u=q.area,v=q.width/u.width,y=c(q,t.padding),D=y.left+y.right,G=y.top+y.bottom;return{framebufferWidth:Math.floor((t.width-D)*v+D),framebufferHeight:Math.floor((t.height-G)*v+G),region:{x:Math.floor(u.x*v)+y.left,y:Math.floor(u.y*v)+y.top,width:q.width,
height:q.height},format:q.format,quality:q.quality,rotation:q.rotation,pixelRatio:v,layers:p?.layers??[],disableDecorations:q.disableDecorations,ignoreBackground:q.ignoreBackground,ignorePadding:q.ignorePadding,objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const n=b.getContextCache();n.forEach(h=>
h.dispose());n.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/contextUtils":function(){define(["exports"],function(a){a.createContext=function(b,n={}){return(b=b.getContext("webgl2",n))?b:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports"],function(a){a.extractSafeScaleBounds=function(b){b=b.effectiveScaleRange;return{minScale:b?.minScale??0,maxScale:b?.maxScale??0}};a.highlightsSupported=
function(b){return b&&"function"===typeof b.highlight};a.isScaleRangeActive=function(b,n){return null!=b&&0<b||null!=n&&0<n};a.isSelectableLayerView2D=function(b){return null!=b&&"object"===typeof b&&"createQuery"in b&&"queryFeatures"in b&&"layer"in b&&"view"in b};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};a.scaleBoundsPredicate=function(b,n,h){return null==b||b>h&&(0===n||b<n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports",
"../../core/Error","../webgl/capabilities"],function(a,b,n){a.check=function(h){const k=n.getWebGLCapabilities();return k.available?"3d"===h&&k.majorPerformanceCaveat?new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):k.supportsHighPrecisionFragment?k.supportsVertexShaderSamplers?null:new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):
new b("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new b("webgl:required","WebGL2 is required but not supported.",Error().stack)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","./contextUtils"],function(a,b){function n(m){if("undefined"===typeof WebGL2RenderingContext)return null;var g=document.createElement("canvas");if(!g)return null;let e=
b.createContext(g,{failIfMajorPerformanceCaveat:!0});null==e&&(e=b.createContext(g),null!=e&&(m.majorPerformanceCaveat=!0));if(null==e)return e;m.available=!0;m.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE);m.supportsVertexShaderSamplers=0<e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(g=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT))m.supportsHighPrecisionFragment=0<g.precision;return e}let h;class k{constructor(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=
0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1}}a.getWebGLCapabilities=function(){if(!h){{const m=new k,g=n(m);null!=g&&(m.supportsColorBufferFloat=null!==g.getExtension("EXT_color_buffer_float"),m.supportsColorBufferFloatBlend=null!==g.getExtension("EXT_float_blend"),m.supportsColorBufferHalfFloat=m.supportsColorBufferFloat||null!==g.getExtension("EXT_color_buffer_half_float"));
h=m}}return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/DefaultUI":function(){define("../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f,r){b=class extends d{constructor(x){super(x);
this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};this.components=[];this._updateViewAwareWidgets=w=>{this.components.forEach(p=>{p=this._find(p)?.widget;void 0!==p?.view&&(p.view=w)})};this._componentsWatcher=(w,p)=>{this._removeComponents(p);this._addComponents(w);this._adjustPadding(w)}}initialize(){this.addHandles([h.watch(()=>this.components,this._componentsWatcher,h.initial),h.watch(()=>this.view,this._updateViewAwareWidgets,
h.initial)])}_add(x,w,p,t,q){let u=x;if("string"===typeof x&&this._defaultPositionLookup[x]){if(this._find(x))return;u=this._createComponent(x)}super._add(u,w,p,t,q)}_removeComponents(x){x.forEach(w=>{if(w=this._find(w))this.remove(w),w.destroy()})}_adjustPadding(x){x.includes("attribution")||this._isOverridden("padding")||({top:x}=this.padding,this.padding=x)}_addComponents(x){this.constructed&&x.forEach(w=>this.add(this._createComponent(w),this._defaultPositionLookup[w]))}_createComponent(x){const w=
this._createWidget(x);return new e({id:x,node:w})}_createWidget(x){const {view:w}=this;switch(x){case "attribution":return new c({view:w});case "compass":return new l({view:w});case "navigation-toggle":return new f({view:w});case "zoom":return new r({view:w})}}};a.__decorate([k.property()],b.prototype,"components",void 0);return b=a.__decorate([g.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/RandomLCG ../../core/has ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){b=class extends b{constructor(){super(...arguments);this.widget=null}destroy(){this.node=null;this.widget?.destroy()}get id(){return this._get("id")??this.widget?.id??this.node?.id}set id(d){this._set("id",d)}set node(d){const c=this._get("node");d!==c&&(d&&d.classList.add("esri-component"),c&&c.classList.remove("esri-component"),this._set("node",d))}castNode(d){this.widget?.destroy();if(!d)return this._set("widget",null),null;if("string"===typeof d||d&&"nodeType"in d)return this._set("widget",
null),n.byId(d);d&&"function"===typeof d.render&&!d.domNode&&(d.domNode=document.createElement("div"));this._set("widget",d);return d.domNode}};a.__decorate([h.property()],b.prototype,"id",null);a.__decorate([h.property()],b.prototype,"node",null);a.__decorate([k.cast("node")],b.prototype,"castNode",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"widget",void 0);return b=a.__decorate([e.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/tslib.es6 ../../intl ../../core/arrayUtils ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/has ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(v){return 0===v?"0":`${v}px`}function p(v){const y="object"===typeof v&&null!==v&&Object.getPrototypeOf(v);return null!==y&&y!==Object.prototype||!("component"in v||"index"in v||"position"in v)?null:v}function t(v,{top:y,bottom:D,left:G,right:A}){v.style.top=y;v.style.bottom=D;v.style.left=G;v.style.right=A}const q={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};b=class extends k.EventedAccessor{constructor(v){super(v);this._cornerNameToContainerLookup=
{};this._positionNameToContainerLookup={};this._components=[];this._componentMap=new Map;this._locale=x.getLocale();this.view=null;this._applyViewPadding=()=>{const y=this.container;y&&t(y,this._toPixelPosition(this._getViewPadding()))};this._applyUIPadding=()=>{const y=this._innerContainer;y&&t(y,this._toPixelPosition(this.padding))};this._initContainers()}initialize(){this.addHandles([m.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,m.initial),m.watch(()=>this.padding,this._applyUIPadding,
m.initial),m.watch(()=>[this.container,this._locale],([v,y])=>{v&&v.setAttribute("lang",y)},m.initial),x.onLocaleChange(v=>{this._locale=v})])}destroy(){this.container=null;for(const v of this._components)v.destroy();this._components.length=0;this._componentMap.clear()}set container(v){const y=this._get("container");v!==y&&(v&&(v.classList.add("esri-ui"),l.setCalciteThemeClass(v),this._attachContainers(v)),y&&(y.classList.remove("esri-ui"),t(y,{top:"",bottom:"",left:"",right:""}),h.empty(y)),this._set("container",
v))}get height(){const v=this.view?.height??0;if(0===v)return v;const y=this._getViewPadding(),{top:D,bottom:G}=y;return Math.max(v-D-G,0)}get padding(){return this._get("padding")}set padding(v){this._overrideIfSome("padding",v)}castPadding(v){return"number"===typeof v?{bottom:v,top:v,right:v,left:v}:{...u,...v}}get width(){const v=this.view?.width??0;if(0===v)return v;const y=this._getViewPadding(),{left:D,right:G}=y;return Math.max(v-D-G,0)}add(v,y){let D,G,A;if(Array.isArray(v))v.forEach(E=>this.add(E,
y));else{var C=p(v);C&&({index:D,position:y,component:v,key:G}=C);y&&"object"===typeof y&&({index:D,key:G,position:y,internal:A}=y);!v||y&&!this._isValidPosition(y)||this._add(v,y,D,G,A)}}remove(v,y){if(v){if(Array.isArray(v))return v.map(G=>this.remove(G,y));if((v=this._find(v))&&(!this._componentMap.has(v)||this._componentMap.get(v)?.key===y)){var D=this._components.indexOf(v);v.node.parentNode?.removeChild(v.node);this._componentMap.delete(v);return this._components.splice(D,1)[0]}}}empty(v,y=
{removeInternal:!1}){if(Array.isArray(v))for(const D of v)this.empty(D,y);else{v=Array.prototype.slice.call(this._positionNameToContainerLookup[v??"manual"].children).map(D=>this._findByNode(D)).filter(D=>null==D?!1:!(this._componentMap.get(D)?.internal??!1)||y.removeInternal);for(const D of v)this.remove(D)}}move(v,y){Array.isArray(v)&&v.forEach(A=>this.move(A,y));if(v){var D=p(v)||p(y);if(D){var G=D.index;y=D.position;v=D.component||v}(!y||this._isValidPosition(y))&&(v=this.remove(v))&&this.add(v,
{position:y,index:G})}}find(v){return v?(v=this._findById(v))&&(v.widget||v.node):null}getComponents(v,y={includeInternal:!1}){return v?Array.isArray(v)?v.flatMap(D=>this._getComponentsAtPosition(D,y)):this._getComponentsAtPosition(v,y):this._components.filter(D=>y.includeInternal||!(this._componentMap.get(D)?.internal??!1)).map(({widget:D,node:G})=>D??G)}getPosition(v){for(const y in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[y].contains(v))return y;return null}_add(v,
y,D,G,A){v instanceof f||(v=new f({node:v}));this._place({component:v,position:y,index:D});this._components.push(v);this._componentMap.set(v,{key:G,internal:A})}_find(v){return v?v instanceof f?this._findByComponent(v):"string"===typeof v?this._findById(v):this._findByNode(v.domNode||v):null}_getViewPadding(){return this.view?.padding??q}_attachContainers(v){v.appendChild(this._innerContainer);v.appendChild(this._manualContainer)}_initContainers(){var v=document.createElement("div");v.classList.add("esri-ui-inner-container",
"esri-ui-corner-container");const y=document.createElement("div");y.classList.add("esri-ui-inner-container","esri-ui-manual-container");const D=document.createElement("div");D.classList.add("esri-ui-top-left","esri-ui-corner");v.appendChild(D);const G=document.createElement("div");G.classList.add("esri-ui-top-right","esri-ui-corner");v.appendChild(G);const A=document.createElement("div");A.classList.add("esri-ui-bottom-left","esri-ui-corner");v.appendChild(A);const C=document.createElement("div");
C.classList.add("esri-ui-bottom-right","esri-ui-corner");v.appendChild(C);this._innerContainer=v;this._manualContainer=y;v=r.isRTL();this._cornerNameToContainerLookup={"top-left":D,"top-right":G,"bottom-left":A,"bottom-right":C,"top-leading":v?G:D,"top-trailing":v?D:G,"bottom-leading":v?C:A,"bottom-trailing":v?A:C};this._positionNameToContainerLookup={manual:y,...this._cornerNameToContainerLookup}}_isValidPosition(v){return!!this._positionNameToContainerLookup[v]}_place(v){var y=v.position??"manual";
const {component:D,index:G}=v;v=this._positionNameToContainerLookup[y];y=null!=G&&-1<G;var A=D.widget;A&&!A._started&&"function"===typeof A.postMixInProperties&&"function"===typeof A.buildRendering&&"function"===typeof A.postCreate&&"function"===typeof A.startup&&D.widget.startup();y?(y=Array.from(v.children),0===G?v.firstChild?h.insertBefore(D.node,v.firstChild):v.appendChild(D.node):G>=y.length?v.appendChild(D.node):h.insertBefore(D.node,y[G])):v.appendChild(D.node)}_toPixelPosition(v){return{top:w(v.top),
left:w(v.left),right:w(v.right),bottom:w(v.bottom)}}_findByComponent(v){return this._components.find(y=>y===v)??null}_findById(v){return this._components.find(({id:y})=>y===v)??null}_findByNode(v){return this._components.find(({node:y})=>y===v)??null}_getComponentsAtPosition(v,y){return Array.prototype.slice.call(this._positionNameToContainerLookup[v].children).map(D=>this._findByNode(D)).filter(n.isSome).filter(D=>y.includeInternal||!(this._componentMap.get(D)?.internal??!1)).map(({widget:D,node:G})=>
D??G)}};a.__decorate([g.property()],b.prototype,"_locale",void 0);a.__decorate([g.property()],b.prototype,"container",null);a.__decorate([g.property()],b.prototype,"height",null);a.__decorate([g.property({value:u})],b.prototype,"padding",null);a.__decorate([e.cast("padding")],b.prototype,"castPadding",null);a.__decorate([g.property()],b.prototype,"view",void 0);a.__decorate([g.property()],b.prototype,"width",null);return b=a.__decorate([c.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/globalCss ./support/legacyIcon ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){var p=l.legacyIcon.description;h=class extends e{constructor(t,q){super(t,q);this._attributionTextOverflowed=this._isOpen=!1;this._prevSourceNodeHeight=0;this._resizeObserver=new ResizeObserver(u=>u.forEach(({target:v})=>this._checkSourceTextOverflow(v)));this.iconClass=p;this.icon=null;this.itemDelimiter=" | ";this.messages=null;this.viewModel=new d}initialize(){this.addHandles(b.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))}destroy(){this._resizeObserver?.disconnect()}get _isInteractive(){return this._isOpen||
this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((t,q)=>{t.includes(q.text)||t.push(q.text);return t},[]).join(this.itemDelimiter)}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){return x.tsx("div",{bind:this,class:this.classes("esri-attribution",c.globalCss.widget,{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,
onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return x.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",x.tsx("a",{class:"esri-attribution__link",href:"https://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const t=this._isOpen,q=this._isInteractive,u=q?0:void 0,{attributionText:v}=this;return x.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",
{["esri-attribution__sources--open"]:t,[c.globalCss.interactive]:q}),innerHTML:v,tabIndex:u})}_afterSourcesNodeCreate(t){this._prevSourceNodeHeight=t.clientWidth;this._resizeObserver.observe(t)}_checkSourceTextOverflow(t){let q=!1;const {clientHeight:u,clientWidth:v,scrollWidth:y}=t;t=y>v;const D=this._attributionTextOverflowed!==t;this._attributionTextOverflowed=t;D&&(q=!0);this._isOpen&&(t=u<this._prevSourceNodeHeight,this._prevSourceNodeHeight=u,t&&(this._isOpen=!1,q=!0));q&&this.scheduleRender()}_toggleState(){this._isInteractive&&
(this._isOpen=!this._isOpen)}};a.__decorate([n.property()],h.prototype,"_isOpen",void 0);a.__decorate([n.property()],h.prototype,"_isInteractive",null);a.__decorate([n.property()],h.prototype,"_attributionTextOverflowed",void 0);a.__decorate([n.property()],h.prototype,"_prevSourceNodeHeight",void 0);a.__decorate([n.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],h.prototype,"attributionText",null);a.__decorate([n.property()],h.prototype,"iconClass",void 0);a.__decorate([n.property()],
h.prototype,"icon",void 0);a.__decorate([n.property()],h.prototype,"itemDelimiter",void 0);a.__decorate([n.property()],h.prototype,"label",null);a.__decorate([n.property(),r.messageBundle("esri/widgets/Attribution/t9n/Attribution")],h.prototype,"messages",void 0);a.__decorate([n.property()],h.prototype,"view",null);a.__decorate([n.property({type:d})],h.prototype,"viewModel",void 0);a.__decorate([f.accessibleHandler()],h.prototype,"_toggleState",null);return h=a.__decorate([g.subclass("esri.widgets.Attribution")],
h)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/asyncUtils ../../core/Collection ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../views/3d/layers/Lyr3DWasm".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(v,y){return v&&"copyright"in v&&(!y||"function"===typeof v.originOf&&"user"===v.originOf("copyright"))}function t(v,y){return v.length!==y.length||v.some((D,G)=>D.text!==y[G].text)}function q(v,y,D){D&&y&&(v.find(G=>G.layerView===y&&G.text===D)||v.push({text:D,layerView:y}))}const u=[];b=class extends b{constructor(v){super(v);this._clear=()=>{this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.removeHandles("suspension");
this.notifyChange("state")};this._pendingAttributions=new Set;this._fetchedAttributionData=new Map;this.items=new h;this.view=null;this._allLayerViewsChange=y=>{this.removeHandles("suspension");this.removeHandles("visible-geometry-changed");const D=this.view?.allLayerViews;D&&(this.addHandles(D.map(G=>k.watch(()=>[G.suspended,G.layer?.attributionVisible],()=>this._updateAttributionItems())).toArray(),"suspension"),D.forEach(G=>{"esri.views.3d.layers.Tiles3DLayerView3D"===G.declaredClass&&this.addHandles(G.on("visible-geometry-changed",
()=>this._updateAttributionItems()),"visible-geometry-changed")}));y?.removed&&y.removed.forEach(G=>{this._pendingAttributions.delete(G);this._fetchedAttributionData.delete(G)});this._updateAttributionItems()};this.addHandles([k.on(()=>this.view?.allLayerViews,"change",y=>this._allLayerViewsChange(y),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),k.when(()=>!0===this.view?.stationary,()=>this._updateAttributionItems())])}destroy(){this.view=null;this._fetchedAttributionData.clear();
this._pendingAttributions.clear();this.items.removeAll()}get state(){return this.view?.ready?0<this._pendingAttributions.size?"loading":"ready":"disabled"}_updateAttributionItems(){const v=this.view;var y=v?.allLayerViews;u.length=0;if(v&&y){y.forEach(G=>{if(!G.suspended&&G.layer?.attributionVisible){var A=G.layer;if(p(A,"user"))q(u,G,A.copyright);else if(A.hasAttributionData)if(this._fetchedAttributionData.has(G)){var C=this._fetchedAttributionData.get(G);C?q(u,G,this._getDynamicAttribution(C,v,
A)):p(A)&&q(u,G,A.copyright)}else this._fetchAttributionData(G);else(C="portalItem"in A?A.portalItem?.accessInformation:void 0)?q(u,G,C):q(u,G,A.copyright)}});y=y.find(G=>"integrated-mesh-3dtiles"===G.layer?.type);if(this.view&&y){var D=w.getLyr3DWasm(this.view);if(D){D=D.getAttributionText();for(let G=0;G<D.length;++G)q(u,y,D[G])}}t(this.items,u)&&(this.items.removeAll(),this.items.addMany(u));u.length=0;this.notifyChange("state")}else this._clear()}async _fetchAttributionData(v){if(!this._pendingAttributions.has(v)){this._pendingAttributions.add(v);
var y=await n.result(v.layer.fetchAttributionData());this._pendingAttributions.has(v)&&(y=y.ok?this._createContributionIndex(y.value,"bing-maps"===v.layer.type):null,this._pendingAttributions.delete(v),this._fetchedAttributionData.set(v,y));this._updateAttributionItems()}}_createContributionIndex(v,y){v=v.contributors;const D={};if(!v)return D;for(let E=0;E<v.length;E++){const I=v[E];var G=I.coverageAreas;if(!G)return;for(const H of G){var A=H.bbox,C=H.zoomMin-(y&&H.zoomMin?1:0);G=H.zoomMax-(y&&H.zoomMax?
1:0);A=new l({xmin:A[1],ymin:A[0],xmax:A[3],ymax:A[2],spatialReference:f.WGS84});for(A={extent:x.geographicToWebMercator(A),attribution:I.attribution||"",score:null!=H.score?H.score:100,id:E};C<=G;C++){let J,B;(J=D)[B=C]??(J[B]=[]);D[C].push(A)}}}D.maxKey=Math.max.apply(null,Object.keys(D));return D}_getDynamicAttribution(v,y,D){const {extent:G,scale:A}=y;D=D.tileInfo?.scaleToZoom(A)??0;D=Math.min(v.maxKey??0,Math.round(D));if(!G||null==D||-1>=D)return"";v=v[D];const C=x.project(G.center.clone().normalize(),
y.spatialReference),E=new Set;return v?v.filter(I=>{const H=I.id;(I=!E.has(H)&&C&&I.extent&&r.extentContainsPoint(I.extent,C))&&E.add(H);return I}).sort((I,H)=>H.score-I.score||I.objectId-H.objectId).map(I=>I.attribution).join(", "):""}};a.__decorate([m.property({readOnly:!0,type:h})],b.prototype,"items",void 0);a.__decorate([m.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([m.property()],b.prototype,"view",void 0);return b=a.__decorate([c.subclass("esri.widgets.Attribution.AttributionViewModel")],
b)})},"esri/views/3d/layers/Lyr3DWasm":function(){define(["require","exports"],function(a,b){let n,h=null;const k=new Map;b.addLayerViewToWasm=async function(m){null==h&&(null==n&&(n=new Promise((d,c)=>a(["../../../layers/Lyr3DWasmPerSceneView"],l=>d(Object.freeze(Object.defineProperty({__proto__:null,default:l},Symbol.toStringTag,{value:"Module"}))),c))),h=await n);const g=m.view;let e=k.get(g);e||(e=new h.default({view:g}),k.set(g,e));await e.initializeWasm();return e.add3DTilesLayerView(m)};b.getLyr3DWasm=
function(m){return k.get(m)};b.removeLayerViewFromWasm=function(m){const g=m.view,e=k.get(g);e&&1>e.remove3DTilesLayerView(m)&&(k.delete(g),0===k.size&&(h=n=null))};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(a){a.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",
buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",disabledElement:"esri-disabled-element",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",
menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",noBookmarksIcon:"esri-widget__no-bookmark-icon",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",
widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){h=class extends e{constructor(p,t){super(p,t);this.iconClass=c.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new d;this._reset=()=>{this.viewModel.reset()};this._toRotationTransform=q=>({transform:`rotateZ(${q.z}deg)`})}loadDependencies(){return l.loadCalciteComponents({button:()=>new Promise((p,t)=>a(["../chunks/calcite-button"],p,t)),icon:()=>new Promise((p,t)=>a(["../chunks/calcite-icon"],p,t))})}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(p){this.viewModel.goToOverride=
p}get label(){return this.messages?.widgetLabel??""}set label(p){this._overrideIfSome("label",p)}get view(){return this.viewModel.view}set view(p){this.viewModel.view=p}reset(){return this.viewModel.reset()}render(){const {orientation:p,state:t}=this.viewModel,q=this.icon??("rotation"===t?"arrow-up":"compass-needle"),{messages:u}=this;return w.tsx("div",{class:this.classes(c.css.base,f.globalCss.widget)},w.tsx("calcite-button",{class:f.globalCss.widgetButton,disabled:"disabled"===t,kind:"neutral",
label:u.reset,onclick:this._reset,round:!0,scale:"s",title:u.reset},w.tsx("div",{"aria-hidden":"true",class:c.css.iconContainer,title:u.reset},w.tsx("calcite-icon",{icon:q,scale:"m",styles:this._toRotationTransform(p)}))))}};b.__decorate([n.property()],h.prototype,"goToOverride",null);b.__decorate([n.property()],h.prototype,"iconClass",void 0);b.__decorate([n.property()],h.prototype,"icon",void 0);b.__decorate([n.property()],h.prototype,"label",null);b.__decorate([n.property(),x.messageBundle("esri/widgets/Compass/t9n/Compass")],
h.prototype,"messages",void 0);b.__decorate([n.property()],h.prototype,"view",null);b.__decorate([n.property({type:d})],h.prototype,"viewModel",void 0);return h=b.__decorate([g.subclass("esri.widgets.Compass")],h)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./utils ../support/GoTo".split(" "),
function(a,b,n,h,k,m,g,e,d,c){b=class extends c.GoToMixin(b){constructor(l){super(l);this.orientation={x:0,y:0,z:0};this.view=null;this._updateForCamera=this._updateForCamera.bind(this);this._updateForRotation=this._updateForRotation.bind(this);this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this.addHandles(n.watch(()=>this.view,this._updateRotationWatcher,n.initial))}destroy(){this.view=null}get canShowNorth(){return d.canShowNorth(this.view)}get state(){return!this.view?.ready||
"2d"===this.view.type&&!this.view.constraints.rotationEnabled?"disabled":this.canShowNorth?"compass":"rotation"}reset(){if(this.view?.ready){var l={};"2d"===this.view?.type?l.rotation=0:l.heading=0;this.callGoTo({target:l})}}_updateForRotation(l){void 0!==l&&null!==l&&(this.orientation={z:l})}_updateForCamera(l){l&&(this.orientation={x:0,y:0,z:-l.heading})}_updateRotationWatcher(l){this.removeAllHandles();l&&this.addHandles("2d"===l.type?n.watch(()=>l?.rotation,this._updateForRotation,n.initial):
n.watch(()=>l?.camera,this._updateForCamera,n.initial))}};a.__decorate([h.property({readOnly:!0})],b.prototype,"canShowNorth",null);a.__decorate([h.property()],b.prototype,"orientation",void 0);a.__decorate([h.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([h.property()],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/Compass/utils":function(){define(["exports"],function(a){a.canShowNorth=function(b){return b?.spatialReference?.isWebMercator||
b?.spatialReference?.isGeographic||!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e){a.GoToMixin=d=>{d=class extends d{constructor(...c){super(...c);this.view=this.goToOverride=null}callGoTo(c){const {view:l}=
this;n.assertIsSome(l);return this.goToOverride?this.goToOverride(l,c):l.goTo(c.target,c.options)}};b.__decorate([h.property()],d.prototype,"goToOverride",void 0);b.__decorate([h.property()],d.prototype,"view",void 0);return d=b.__decorate([e.subclass("esri.widgets.support.GoTo")],d)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Compass/css":function(){define(["exports","../support/legacyIcon"],function(a,b){a.css={base:"esri-compass",widgetIcon:b.legacyIcon.locateCircled,
iconContainer:"esri-compass__icon-container"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ../chunks/componentsUtils ./support/globalCss ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){h=class extends e{constructor(p,t){super(p,t);this.iconClass=d.css.widgetIcon;this.messages=this.icon=null;this.viewModel=new c;this.toggle=()=>this.viewModel.toggle();this._rotateButton=this._panButton=null;this._toggle=()=>{("pan"===this.viewModel?.navigationMode?this._rotateButton:this._panButton)?.setFocus();this.toggle()}}loadDependencies(){return l.loadCalciteComponents({button:()=>new Promise((p,t)=>a(["../chunks/calcite-button"],p,t))})}get label(){return this.messages?.widgetLabel??
""}set label(p){this._overrideIfSome("label",p)}set layout(p){"horizontal"!==p&&(p="vertical");this._set("layout",p)}get view(){return this.viewModel.view}set view(p){this.viewModel.view=p}render(){const p="disabled"===this.viewModel?.state,t="pan"===this.viewModel?.navigationMode,q=this.messages.toggle;return w.tsx("div",{class:this.classes(d.css.base,f.globalCss.widget,{[d.css.isLayoutHorizontal]:"horizontal"===this.layout})},w.tsx("calcite-button",{afterCreate:u=>{this._panButton=u},appearance:t?
"outline-fill":"solid",class:f.globalCss.widgetButton,disabled:p,iconStart:"move",kind:"neutral",label:q,onclick:this._toggle,tabIndex:t?void 0:-1,title:q}),w.tsx("calcite-button",{afterCreate:u=>{this._rotateButton=u},appearance:t?"solid":"outline-fill",class:f.globalCss.widgetButton,disabled:p,iconStart:"rotate",kind:"neutral",label:q,onclick:this._toggle,tabIndex:t?-1:void 0,title:q}))}};b.__decorate([n.property()],h.prototype,"iconClass",void 0);b.__decorate([n.property()],h.prototype,"icon",
void 0);b.__decorate([n.property()],h.prototype,"label",null);b.__decorate([n.property({value:"vertical"})],h.prototype,"layout",null);b.__decorate([n.property(),x.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],h.prototype,"messages",void 0);b.__decorate([n.property()],h.prototype,"view",null);b.__decorate([n.property({type:c})],h.prototype,"viewModel",void 0);return h=b.__decorate([g.subclass("esri.widgets.NavigationToggle")],h)})},"esri/widgets/NavigationToggle/css":function(){define(["exports",
"../support/legacyIcon"],function(a,b){a.css={base:"esri-navigation-toggle",widgetIcon:b.legacyIcon.pan2,isLayoutHorizontal:"esri-navigation-toggle--horizontal"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){b=class extends b{constructor(d){super(d);this.navigationMode="pan";this.view=null}initialize(){this.addHandles(n.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){return this.view?.ready&&"3d"===this.view?.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){const d=this.view?.inputManager;d&&(d.primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate")}};a.__decorate([h.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([h.property()],b.prototype,"navigationMode",void 0);a.__decorate([h.property()],b.prototype,"view",void 0);return b=a.__decorate([e.subclass("esri.widgets.NavigationToggleViewModel")],b)})},"esri/widgets/Zoom":function(){define("require ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/RandomLCG ../core/accessorSupport/decorators/subclass ./Widget ../chunks/componentsUtils ./support/globalCss ./support/legacyIcon ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/ZoomViewModel".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){var p=l.legacyIcon.zoomInMagnifyingGlass;h=class extends e{constructor(t,q){super(t,q);this.iconClass=p;this.messages=this.icon=null;this.viewModel=new w;this.zoomIn=()=>this.viewModel.zoomIn();this.zoomOut=()=>this.viewModel.zoomOut()}loadDependencies(){return d.loadCalciteComponents({button:()=>new Promise((t,q)=>a(["../chunks/calcite-button"],t,q))})}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}set layout(t){"horizontal"!==
t&&(t="vertical");this._set("layout",t)}set view(t){this.viewModel.view=t}get view(){return this.viewModel.view}render(){const t={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:q,canZoomOut:u}=this.viewModel,{zoomIn:v,zoomOut:y}=this.messages;return x.tsx("div",{class:this.classes("esri-zoom",c.globalCss.widget,t)},x.tsx("calcite-button",{class:c.globalCss.widgetButton,disabled:!q,iconStart:"plus",kind:"neutral",label:v,onclick:this.zoomIn,title:v}),x.tsx("calcite-button",{class:c.globalCss.widgetButton,
disabled:!u,iconStart:"minus",kind:"neutral",label:y,onclick:this.zoomOut,title:y}))}};b.__decorate([n.property()],h.prototype,"iconClass",void 0);b.__decorate([n.property()],h.prototype,"icon",void 0);b.__decorate([n.property()],h.prototype,"label",null);b.__decorate([n.property({value:"vertical"})],h.prototype,"layout",null);b.__decorate([n.property(),r.messageBundle("esri/widgets/Zoom/t9n/Zoom")],h.prototype,"messages",void 0);b.__decorate([n.property()],h.prototype,"view",null);b.__decorate([n.property({type:w})],
h.prototype,"viewModel",void 0);return h=b.__decorate([g.subclass("esri.widgets.Zoom")],h)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,n,h,k,m,g,e,d,c){b=class extends b{constructor(l){super(l)}destroy(){this.view=
null}get canZoomIn(){return null!=this._zoomConditions&&this._zoomConditions.canZoomIn}get canZoomOut(){return null!=this._zoomConditions&&this._zoomConditions?.canZoomOut}get state(){return this.view?.ready?"ready":"disabled"}set view(l){l?"2d"===l.type?this._zoomConditions=new d({view:l}):"3d"===l.type&&(this._zoomConditions=new c({view:l})):this._zoomConditions=null;this._set("view",l)}zoomIn(){if(this.canZoomIn){var l=this.view;"2d"===l.type?l.mapViewNavigation.zoomIn():n.ignoreAbortErrors(l.goTo({zoomFactor:2}))}}zoomOut(){if(this.canZoomOut){var l=
this.view;"2d"===l.type?l.mapViewNavigation.zoomOut():n.ignoreAbortErrors(l.goTo({zoomFactor:.5}))}}};a.__decorate([h.property()],b.prototype,"_zoomConditions",void 0);a.__decorate([h.property()],b.prototype,"canZoomIn",null);a.__decorate([h.property()],b.prototype,"canZoomOut",null);a.__decorate([h.property({readOnly:!0})],b.prototype,"state",null);a.__decorate([h.property()],b.prototype,"view",null);return b=a.__decorate([e.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){b=class extends b{get canZoomIn(){if(!this.view?.ready)return!1;const e=this.view?.constraints?.effectiveMaxScale;return 0===e||this._scale>e}get canZoomOut(){var {view:e}=this;if(!e?.ready)return!1;e=e.constraints?.effectiveMinScale;return 0===e||this._scale<e}get _scale(){const e=this.view?.animation?.target;return(e&&"then"in e?void 0:e?.scale)??this.view?.scale??0}};a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([n.property({readOnly:!0})],
b.prototype,"canZoomOut",null);a.__decorate([n.property()],b.prototype,"view",void 0);a.__decorate([n.property()],b.prototype,"_scale",null);return b=a.__decorate([g.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g){b=
class extends b{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomIn",null);a.__decorate([n.property({readOnly:!0})],b.prototype,"canZoomOut",null);a.__decorate([n.property()],b.prototype,"view",void 0);return b=a.__decorate([g.subclass("esri.widgets.Zoom.ZoomConditions3D")],b)})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,n,h,k,m,g){n=class extends g{constructor(e){super(e);this.components=["attribution","zoom","navigation-toggle","compass"]}};a.__decorate([b.property()],n.prototype,"components",void 0);return n=a.__decorate([m.subclass("esri.views.ui.3d.DefaultUI3D")],n)})},"esri/layers/SceneLayer":function(){define("require ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Clonable ../core/Collection ../core/Error ../core/Logger ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ../geometry/Mesh ../geometry/Point ./Layer ./graphics/sources/support/uploadAssetErrors ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/CustomParametersMixin ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./mixins/TemporalSceneLayer ./support/arcgisLayerUrl ./support/associatedFeatureServiceUtils ./support/capabilities ./support/commonProperties ./support/featureLayerUtils ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/infoFor3D ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/lazyLayerLoader ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/elevationInfoUtils ../support/featureFlags ../support/popupUtils ../support/zipUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja,oa,qa,ta,va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea){const Ka=new Set(["3DObject","Point"]);k=da.defineFieldProperties();p=class extends V.TemporalSceneLayer(P.EditBusLayer(Q.SceneService(S.ArcGISService(R.OperationalLayer(O.PortalLayer(T.ScaleRangeLayer(v.MultiOriginJSONMixin(N.CustomParametersMixin(M.APIKeyMixin(p.ClonableMixin(L))))))))))){constructor(...Ga){super(...Ga);this.rangeInfos=
this.featureReduction=null;this.operationalLayerType="ArcGISSceneServiceLayer";this.type="scene";this.serviceUpdateTimeStamp=this.geometryDefinitions=this.textureSetDefinitions=this.materialDefinitions=this.nodePages=this.outFields=this.floorInfo=this.fields=null;this.excludeObjectIds=new t;this.path=this.filter=this.definitionExpression=null;this.labelsVisible=!0;this.labelingInfo=null;this.legendEnabled=!0;this.semantic=this.priority=null;this.cachedDrawingInfo={color:!1};this.popupEnabled=!0;this.globalIdField=
this.objectIdField=this.popupTemplate=null;this._fieldUsageInfo={};this.screenSizePerspectiveEnabled=!0;this.serviceItemId=void 0}normalizeCtorArgs(Ga,Na){return"string"===typeof Ga?{url:Ga,...Na}:Ga}destroy(){this._set("renderer",null)}getField(Ga){return this.fieldsIndex.get(Ga)}getFieldDomain(Ga,Na){return(Na=this.getFeatureType(Na?.feature)?.domains?.[Ga])&&"inherited"!==Na.type?Na:this.getField(Ga)?.domain??null}getFeatureType(Ga){return Ga&&this.associatedLayer?this.associatedLayer.getFeatureType(Ga):
null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new aa(this.fields)}readNodePages(Ga,Na,Va){"Point"===Na.layerType&&(Ga=Na.pointNodePages);return null==Ga||"object"!==typeof Ga?null:ha.I3SNodePageDefinition.fromJSON(Ga,Va)}set elevationInfo(Ga){this._set("elevationInfo",Ga);
this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return null!=this.associatedLayer&&ba.computeEffectiveEditingEnabled(this.associatedLayer)}get geometryType(){return Ua[this.profile]||"mesh"}set renderer(Ga){ea.fixRendererFields(Ga,this.fieldsIndex);this._set("renderer",Ga)}readCachedDrawingInfo(Ga){if(null==Ga||"object"!==typeof Ga)Ga={};null==Ga.color&&
(Ga.color=!1);return Ga}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(Ga){Ga=null!=Ga?Ga:ca.zeroCapabilities;const {query:Na,queryRelated:Va,editing:{supportsGlobalId:Xa,supportsRollbackOnFailure:Pa,supportsUploadWithItemId:bb,supportsGeometryUpdate:gb,supportsReturnServiceEditsInSourceSpatialReference:cb},data:{supportsZ:ka,supportsM:mb,isVersioned:qb,supportsAttachment:tb},operations:{supportsEditing:xa,
supportsAdd:Ia,supportsUpdate:na,supportsDelete:ya,supportsQuery:Da,supportsQueryAttachments:Oa,supportsAsyncConvert3D:Wa}}=Ga;Ga=Ga.operations.supportsChangeTracking;const ab=!!this.associatedLayer?.infoFor3D&&Ba.sceneLayerEditingEnabled();return{query:Na,queryRelated:Va,editing:{supportsGlobalId:Xa,supportsReturnServiceEditsInSourceSpatialReference:cb,supportsRollbackOnFailure:Pa,supportsGeometryUpdate:ab&&gb,supportsUploadWithItemId:bb},data:{supportsAttachment:tb,supportsZ:ka,supportsM:mb,isVersioned:qb},
operations:{supportsQuery:Da,supportsQueryAttachments:Oa,supportsEditing:xa&&Ga,supportsAdd:ab&&Ia&&Ga,supportsDelete:ab&&ya&&Ga,supportsUpdate:na&&Ga,supportsAsyncConvert3D:Wa}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.associatedLayer?.editingEnabled??!1}set editingEnabled(Ga){this._overrideIfSome("editingEnabled",Ga)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||
this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(Ga,Na){!Ga&&Na.fields&&Na.fields.some(Va=>{"esriFieldTypeOID"===Va.type&&(Ga=Va.name);return!!Ga});return Ga||void 0}readGlobalIdField(Ga,Na){!Ga&&Na.fields&&Na.fields.some(Va=>{"esriFieldTypeGlobalID"===Va.type&&(Ga=Va.name);return!!Ga});return Ga||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(Ga,Na){Ga=Na.store.profile;if(null!=Ga&&Ma[Ga])return Ma[Ga];u.getLogger(this).error("Unknown or missing profile",
{profile:Ga,layer:this});return"mesh-pyramids"}load(Ga){this.addResolvingPromise(this._load(Ga));return Promise.resolve(this)}async _load(Ga){const Na=null!=Ga?Ga.signal:null;await this.loadFromPortal({supportedTypes:["Scene Service"]},Ga).catch(y.throwIfAbortError);await this._fetchService(Na);await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Na),this._setAssociatedFeatureLayer(Na),this._loadFilterGeometries()]);this._validateElevationInfo();this._applyAssociatedLayerOverrides();
this._populateFieldUsageInfo();await Ca.loadStyleRenderer(this,{origin:"service"},Na);ea.fixRendererFields(this.renderer,this.fieldsIndex);await this.finishLoadEditablePortalLayer(Ga)}async beforeSave(){null!=this.filter&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(Ga){u.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",
{error:Ga}),this.filter=null}}createQuery(){const Ga=new ma;"mesh"!==this.geometryType&&(Ga.returnGeometry=!0,Ga.returnZ=!0);Ga.where=this.definitionExpression||"1\x3d1";Ga.sqlFormat="standard";Ga.outFields=["*"];return Ga}queryExtent(Ga,Na){return this._getAssociatedLayerForQuery().then(Va=>Va.queryExtent(Ga||this.createQuery(),Na))}queryFeatureCount(Ga,Na){return this._getAssociatedLayerForQuery().then(Va=>Va.queryFeatureCount(Ga||this.createQuery(),Na))}queryFeatures(Ga,Na){return this._getAssociatedLayerForQuery().then(Va=>
Va.queryFeatures(Ga||this.createQuery(),Na)).then(Va=>{if(Va?.features)for(const Xa of Va.features)Xa.layer=this,Xa.sourceLayer=this;return Va})}async queryRelatedFeatures(Ga,Na){await this.load();if(!this.associatedLayer)throw new q("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeatures(Ga,Na)}async queryRelatedFeaturesCount(Ga,Na){await this.load();if(!this.associatedLayer)throw new q("scenelayer:query-not-available",
"SceneLayer queries are not available without an associated feature layer",{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(Ga,Na)}async queryCachedAttributes(Ga,Na){const Va=ea.unpackFieldNames(this.fieldsIndex,await ua.getRequiredFields(this,ua.getFetchPopupTemplate(this)));return ra.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo??[],Ga,Na,Va,this.apiKey,this.customParameters)}async queryCachedFeature(Ga,Na){Ga=await this.queryCachedAttributes(Ga,
[Na]);if(!Ga||0===Ga.length)throw new q("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Na=new n;Na.attributes=Ga[0];Na.layer=this;Na.sourceLayer=this;return Na}queryObjectIds(Ga,Na){return this._getAssociatedLayerForQuery().then(Va=>Va.queryObjectIds(Ga||this.createQuery(),Na))}queryAttachments(Ga,Na){return this._getAssociatedLayerForQuery().then(Va=>Va.queryAttachments(Ga,Na))}getFieldUsageInfo(Ga){const Na={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Ga]||Na:(u.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Na)}createPopupTemplate(Ga){return pa.createPopupTemplate(this,Ga)}_getAssociatedLayerForQuery(){const Ga=this.associatedLayer;return Ga?.loaded?Promise.resolve(Ga):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){await this.load();if(!this.associatedLayer)throw new q("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",
{layer:this});try{await this.associatedLayer.load()}catch(Ga){throw new q("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:Ga});}return this.associatedLayer}hasCachedStatistics(Ga){return null!=this.statisticsInfo&&this.statisticsInfo.some(Na=>Na.name===Ga)}async queryCachedStatistics(Ga,Na){await this.load(Na);if(!this.statisticsInfo)throw new q("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Va=
this.fieldsIndex.get(Ga);if(!Va)throw new q("scenelayer:field-unexisting",`Field '${Ga}' does not exist on the layer`);for(const Xa of this.statisticsInfo)if(Xa.name===Va.name)return Ga=G.join(this.parsedUrl.path,Xa.href),w(Ga,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:Na?Na.signal:null}).then(Pa=>Pa.data);throw new q("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");}async saveAs(Ga,Na){return this._debouncedSaveOperations(Q.SaveOperationType.SAVE_AS,
{...Na,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},Ga)}async save(){return this._debouncedSaveOperations(Q.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})}async applyEdits(Ga,Na){const {applyEdits:Va}=await new Promise((cb,ka)=>a(["./graphics/editingSupport"],cb,ka));await this.load();const Xa=this.associatedLayer;if(!Xa)throw new q(`${this.type}-layer:not-editable`,"Service is not editable");await Xa.load();const {globalIdField:Pa}=
Xa,bb=!!Xa.infoFor3D,gb=Na?.globalIdUsed??!0;if(bb&&null==Pa)throw new q(`${this.type}-layer:not-editable`,"Valid globalIdField expected on editable SceneLayer");if(bb&&!gb)throw new q(`${this.type}-layer:globalid-required`,"globalIdUsed must not be false for SceneLayer editing as globalIds are required.");U.isHostedAgolService(Xa.url)&&bb&&null!=Ga.deleteFeatures&&null!=Pa&&(Na={...Na,globalIdToObjectId:await ba.getGlobalIdToObjectIdMap(Xa,Ga.deleteFeatures,Pa)});return Va(this,Xa.source,Ga,Na)}async uploadAssets(Ga,
Na){await this.load();if(null==this.associatedLayer)throw new q(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return this.associatedLayer.uploadAssets(Ga,Na)}on(Ga,Na){return super.on(Ga,Na)}async convertMesh(Ga,Na){var Va=Pa=>{u.getLogger(this).error(".convertMesh()",Pa.message);throw Pa;};await this.load();this.infoFor3D||Va(new q("invalid:layer","SceneLayer has no capability for mesh conversion"));Ga=await this.extractAndFilterFiles(Ga);const Xa=
Ga.reduce((Pa,bb)=>Y.isFileEditFormat(this.infoFor3D,bb)?Pa+1:Pa,0);0===Xa&&Va(new F.NoModelError);1<Xa&&Va(new F.MultipleModelsError);Va=this.spatialReference;Va=Na?.location??new K({x:0,y:0,z:0,spatialReference:Va});Ga=z.createWithExternalSource(Va,Ga,{vertexSpace:Va.spatialReference.isGeographic?"local":"georeferenced"});[Na]=await this.uploadAssets([Ga],Na);return Na}async extractAndFilterFiles(Ga){await this.load();const Na=this.infoFor3D;return Na?(await Aa.extractZipFiles(Ga)).filter(Va=>Y.isFileSupported(Na,
Va)):Ga}validateLayer(Ga){if(Ga.layerType&&!Ka.has(Ga.layerType))throw new q("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:Ga.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new q("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new q("layer:service-version-too-new","Service version is too new.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});Ga=this.normalReferenceFrame;var Na=this.spatialReference;let Va=!1,Xa=!1;if(null==Ga)Xa=Va=!0;else switch(Na=Na&&Na.isGeographic,Ga){case "east-north-up":case "earth-centered":Va=!0;Xa=Na;break;case "vertex-reference-frame":Va=!0;Xa=!Na;break;default:Va=!1}if(!Va)throw new q("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Xa)throw new q("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");}_getTypeKeywords(){const Ga=[];if("points"===this.profile)Ga.push("Point");else if("mesh-pyramids"===this.profile)Ga.push("3DObject");else throw new q("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return Ga}_populateFieldUsageInfo(){this._fieldUsageInfo={};if(this.fields)for(const Ga of this.fields){const Na=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Xa=>
Xa.name===Ga.name)),Va=!!this.associatedLayer?.fields?.some(Xa=>Xa&&Ga.name===Xa.name);this._fieldUsageInfo[Ga.name]={supportsLabelingInfo:Na,supportsRenderer:Na,supportsPopupTemplate:Na||Va,supportsLayerQuery:Va}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides();this._applyAssociatedLayerExtentOverride();this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(this.associatedLayer?.fields){var Ga=null;
for(const Na of this.associatedLayer.fields){const Va=this.getField(Na.name);Va?(!Va.domain&&Na.domain&&(Va.domain=Na.domain.clone()),Va.editable=Na.editable,Va.nullable=Na.nullable,Va.length=Na.length):(Ga||=this.fields?this.fields.slice():[],Ga.push(Na.clone()))}Ga&&this._set("fields",Ga)}}_applyAssociatedLayerPopupOverrides(){if(this.associatedLayer){var Ga=["popupTemplate","popupEnabled"],Na=I.getProperties(this);for(let Va=0;Va<Ga.length;Va++){const Xa=Ga[Va],Pa=this.originIdOf(Xa),bb=this.associatedLayer.originIdOf(Xa);
Pa<bb&&(bb===B.OriginId.SERVICE||bb===B.OriginId.PORTAL_ITEM)&&Na.setAtOrigin(Xa,this.associatedLayer[Xa],bb)}}}_applyAssociatedLayerExtentOverride(){const Ga=this.associatedLayer?.editingInfo?.lastEditDate,Na=this.associatedLayer?.serverGens,Va=this.associatedLayer?.getAtOrigin("fullExtent","service");Ba.sceneLayerEditingEnabled()&&null!=this.associatedLayer?.infoFor3D&&Va&&U.isHostedAgolService(this.associatedLayer?.url)&&Ga&&this.serviceUpdateTimeStamp?.lastUpdate!==Ga.getTime()&&(this.serviceUpdateTimeStamp||
Na?.minServerGen!==Na?.serverGen)&&I.getProperties(this).setAtOrigin("fullExtent",Va.clone(),B.OriginId.SERVICE)}_applyAssociatedLayerPrivileges(){const Ga=this.associatedLayer;Ga&&(this._set("userHasEditingPrivileges",Ga.userHasEditingPrivileges),this._set("userHasFullEditingPrivileges",Ga.userHasFullEditingPrivileges),this._set("userHasUpdateItemPrivileges",Ga.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(Ga){if(["mesh-pyramids","points"].includes(this.profile))try{const {serverUrl:Na,
layerId:Va,portalItem:Xa}=await W.findAssociatedFeatureService(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:Ga});this.associatedLayer=new (await qa.layerLookupMap.FeatureLayer())({url:Na,customParameters:this.customParameters,layerId:Va,portalItem:Xa});await this.associatedLayer.load()}catch(Na){y.isAbortError(Na)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await D.whenOnce(()=>this.popupEnabled&&
null!=this.popupTemplate);const Ga=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?u.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Ga}`):u.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Ga}`)}_validateElevationInfo(){const Ga=this.elevationInfo;"mesh-pyramids"===this.profile&&wa.logInvalidElevationInfoWarning(u.getLogger(this),wa.elevationModeUnsupportedMessage("Mesh scene layers",
"relative-to-scene",Ga));wa.logInvalidElevationInfoWarning(u.getLogger(this),wa.featureExpressionUnsupportedMessage("Scene layers",Ga))}};b.__decorate([A.property({types:{key:"type",base:ia.FeatureReduction,typeMap:{selection:fa}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],p.prototype,"featureReduction",void 0);b.__decorate([A.property({type:[ta.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",
write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],p.prototype,"rangeInfos",void 0);b.__decorate([A.property({json:{read:!1}})],p.prototype,"associatedLayer",void 0);b.__decorate([A.property({type:["show","hide"]})],p.prototype,"listMode",void 0);b.__decorate([A.property({type:["ArcGISSceneServiceLayer"]})],p.prototype,"operationalLayerType",void 0);b.__decorate([A.property({json:{read:!1},readOnly:!0})],p.prototype,"type",void 0);b.__decorate([A.property({...k.fields,readOnly:!0,
json:{read:!1,origins:{service:{read:!0}}}})],p.prototype,"fields",void 0);b.__decorate([A.property()],p.prototype,"types",null);b.__decorate([A.property()],p.prototype,"typeIdField",null);b.__decorate([A.property()],p.prototype,"templates",null);b.__decorate([A.property()],p.prototype,"formTemplate",null);b.__decorate([A.property({readOnly:!0,clonable:!1})],p.prototype,"fieldsIndex",null);b.__decorate([A.property({type:oa,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],
p.prototype,"floorInfo",void 0);b.__decorate([A.property(k.outFields)],p.prototype,"outFields",void 0);b.__decorate([A.property({type:ha.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],p.prototype,"nodePages",void 0);b.__decorate([H.reader("service","nodePages",["nodePages","pointNodePages"])],p.prototype,"readNodePages",null);b.__decorate([A.property({type:[ha.I3SMaterialDefinition],readOnly:!0})],p.prototype,"materialDefinitions",void 0);b.__decorate([A.property({type:[ha.I3STextureSetDefinition],
readOnly:!0})],p.prototype,"textureSetDefinitions",void 0);b.__decorate([A.property({type:[ha.I3SGeometryDefinition],readOnly:!0})],p.prototype,"geometryDefinitions",void 0);b.__decorate([A.property({readOnly:!0})],p.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([A.property({readOnly:!0})],p.prototype,"attributeStorageInfo",void 0);b.__decorate([A.property({readOnly:!0})],p.prototype,"statisticsInfo",void 0);b.__decorate([A.property({type:t.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,
write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],p.prototype,"excludeObjectIds",void 0);b.__decorate([A.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],p.prototype,"definitionExpression",void 0);b.__decorate([A.property({type:va,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],p.prototype,"filter",void 0);b.__decorate([A.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0);b.__decorate([A.property(X.elevationInfo)],p.prototype,"elevationInfo",null);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],p.prototype,"effectiveCapabilities",null);b.__decorate([A.property({readOnly:!0})],p.prototype,"effectiveEditingEnabled",null);b.__decorate([A.property({type:String})],p.prototype,"geometryType",null);b.__decorate([A.property(X.labelsVisible)],p.prototype,"labelsVisible",void 0);b.__decorate([A.property({type:[Z],
json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ja.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ja.reader},write:!0}})],p.prototype,"labelingInfo",void 0);b.__decorate([A.property(X.legendEnabled)],p.prototype,"legendEnabled",void 0);b.__decorate([A.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],
reader(Ga,Na){if("number"===typeof Ga&&0<=Ga&&1>=Ga)return Ga;Ga=Na.layerDefinition?.drawingInfo?.transparency;return void 0!==Ga?Ea.transparencyToOpacity(Ga):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],p.prototype,"opacity",void 0);b.__decorate([A.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],p.prototype,"priority",void 0);b.__decorate([A.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],p.prototype,"semantic",
void 0);b.__decorate([A.property({types:x.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],p.prototype,"renderer",null);b.__decorate([A.property({json:{read:!1}})],p.prototype,"cachedDrawingInfo",void 0);b.__decorate([H.reader("service","cachedDrawingInfo")],p.prototype,"readCachedDrawingInfo",null);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],p.prototype,"capabilities",null);b.__decorate([A.property({type:Boolean,
json:{read:!1}})],p.prototype,"editingEnabled",null);b.__decorate([A.property({readOnly:!0,json:{write:!1,read:!1}})],p.prototype,"infoFor3D",null);b.__decorate([A.property({readOnly:!0,json:{write:!1,read:!1}})],p.prototype,"relationships",null);b.__decorate([A.property(X.popupEnabled)],p.prototype,"popupEnabled",void 0);b.__decorate([A.property({type:h,json:{name:"popupInfo",write:!0}})],p.prototype,"popupTemplate",void 0);b.__decorate([A.property({readOnly:!0,json:{read:!1}})],p.prototype,"defaultPopupTemplate",
null);b.__decorate([A.property({type:String,json:{read:!1}})],p.prototype,"objectIdField",void 0);b.__decorate([H.reader("service","objectIdField",["objectIdField","fields"])],p.prototype,"readObjectIdField",null);b.__decorate([A.property({type:String,json:{read:!1}})],p.prototype,"globalIdField",void 0);b.__decorate([H.reader("service","globalIdField",["globalIdField","fields"])],p.prototype,"readGlobalIdField",null);b.__decorate([A.property({readOnly:!0,type:String,json:{read:!1}})],p.prototype,
"displayField",null);b.__decorate([A.property({type:String,json:{read:!1}})],p.prototype,"profile",void 0);b.__decorate([H.reader("service","profile",["store.profile"])],p.prototype,"readProfile",null);b.__decorate([A.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],p.prototype,"normalReferenceFrame",void 0);b.__decorate([A.property(X.screenSizePerspectiveEnabled)],p.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([A.property({json:{read:!1,
origins:{service:{read:!0}}}})],p.prototype,"serviceItemId",void 0);p=b.__decorate([J.subclass("esri.layers.SceneLayer")],p);const Ma={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Ua={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return p})},"esri/geometry/Mesh":function(){define("require ../chunks/tslib.es6 ../core/deprecate ../core/Error ../core/Loadable ../core/Logger ../core/Promise ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/has ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/libs/gl-matrix-2/factories/vec3f64 ./Extent ./Geometry ./Point ./Polygon ./support/axisAngleDegrees ./support/MeshComponent ./support/meshErrors ./support/MeshGeoreferencedVertexSpace ./support/MeshLocalVertexSpace ./support/MeshTransform ./support/MeshVertexAttributes ./support/meshVertexSpaceUtils ./support/triangulationUtils ./support/meshUtils/bounds ./support/meshUtils/centerAt ./support/meshUtils/loadExternal ./support/meshUtils/Metadata ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F){function M(){return m.getLogger("esri.geometry.Mesh")}var S;l={base:null,key:"type",defaultKeyValue:"georeferenced",typeMap:{georeferenced:D,local:G}};k=S=class extends k.LoadableMixin(g.EsriPromiseMixin(p)){constructor(P){super(P);this.components=null;this.vertexSpace=new D;this.transform=null;this.metadata=new z.Metadata;this.hasZ=!0;this.hasM=!1;this.vertexAttributes=new C.MeshVertexAttributes;this.type="mesh"}initialize(){if(0===
this.metadata.externalSources.length||this.vertexAttributes.position.length)this.loadStatus="loaded";this.when(()=>{this.addHandles(d.watch(()=>({vertexAttributes:this.vertexAttributes,components:this.components?.map(P=>P.clone())}),()=>this._clearSources(),{once:!0,sync:!0}))})}get hasExtent(){return this.loaded?0<this.vertexAttributes.position.length&&(!this.components||0<this.components.length):null!=this.metadata.displaySource?.extent}get _transformedExtent(){const {components:P,spatialReference:R,
vertexAttributes:O,vertexSpace:T}=this,Q=O.position;if(0===Q.length||P&&0===P.length)return new w({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:R});if(E.isRelativeVertexSpace(T)){const {_untransformedBounds:V,transform:U}=this;return H.getExtentFromBounds(V,U,T,R)}return H.getExtentFromPositions(Q,R)}get _untransformedBounds(){return H.getBoundsFromPositions(this.vertexAttributes.position)}get anchor(){const P=E.vertexSpaceOriginToPoint(this.vertexSpace,this.spatialReference);if(null!=
P)return P;const {center:R,zmin:O}=this._transformedExtent;return new t({x:R.x,y:R.y,z:O,spatialReference:this.spatialReference})}get origin(){const P=E.vertexSpaceOriginToPoint(this.vertexSpace,this.spatialReference);return null!=P?P:this._transformedExtent.center}get extent(){return this.loaded||null==this.metadata?.displaySource?.extent?this._transformedExtent:this.metadata.displaySource.extent.clone()}addComponent(P){this._checkIfLoaded("addComponent()")&&(this.components||(this.components=[]),
this.components.push(v.from(P)),this.notifyChange("components"))}removeComponent(P){if(this._checkIfLoaded("removeComponent()")){if(this.components&&(P=this.components.indexOf(P),-1!==P)){this.components.splice(P,1);this.notifyChange("components");return}M().error("removeComponent()",y.componentNotFoundMessage)}}rotate(P,R,O,T){u.composeAxes(P,R,O,N);L.rotate(this,N,T);return this}offset(P,R,O){if(!this._checkIfLoaded("offset()"))return this;const {vertexSpace:T,vertexAttributes:Q}=this,V=Q?.position;
if(!V)return this;if(E.isRelativeVertexSpace(T)){const [U,W,ca]=T.origin;T.origin=x.fromValues(U+P,W+R,ca+O)}else{for(let U=0;U<V.length;U+=3)V[U]+=P,V[U+1]+=R,V[U+2]+=O;this.vertexAttributesChanged()}return this}scale(P,R){if(!this._checkIfLoaded("scale()"))return this;F.scale(this,P,R);return this}centerAt(P,R){if(!this._checkIfLoaded("centerAt()"))return this;J.centerAt(this,P,R);return this}load(P){const {metadata:{displaySource:R}}=this;R&&this.addResolvingPromise(B.loadExternal(this,R,P));return Promise.resolve(this)}addExternalSources(P){this.metadata.externalSources.addMany(P)}updateDisplaySource(P){this.metadata.displaySource=
P}clone(){return this.cloneWithVertexSpace(this.vertexSpace.clone())}cloneWithVertexSpace(P){let R=null;if(this.components){const O=new Map,T=new Map;R=this.components.map(Q=>Q.cloneWithDeduplication(O,T))}P={components:R,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),vertexSpace:P,transform:this.transform?.clone()??null,metadata:this.metadata.clone()};return new S(P)}cloneShallow(){return new S({components:this.components,spatialReference:this.spatialReference,
vertexAttributes:this.vertexAttributes,vertexSpace:this.vertexSpace.clone(),transform:this.transform,metadata:this.metadata})}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(P){var R=new Promise((T,Q)=>a(["./support/meshUtils/exporters/gltf/gltfexport"],T,Q));const O=this.load();R=await Promise.all([R,O]);({toBinaryGLTF:R}=R[0]);return R(this,P)}get memoryUsage(){let P;P=0+this.vertexAttributes.memoryUsage;if(null!=this.components)for(const R of this.components)P+=
R.memoryUsage;return P}_clearSources(){this.metadata.clearSources()}_checkIfLoaded(P){return this.loaded?!0:(M().error(P,y.meshNotLoadedMessage),!1)}static createBox(P,R){if(!(P instanceof t))return M().error(".createBox()",y.invalidLocationMessage),null;P=new S(K.convertUnitGeometry(K.createUnitSizeBox(),P,R));return R?.imageFace&&"all"!==R.imageFace?K.extractSingleFaceOfBox(P,R.imageFace):P}static createSphere(P,R){return P instanceof t?new S(K.convertUnitGeometry(K.createUnitSizeSphere(R?.densificationFactor||
0),P,R)):(M().error(".createSphere()",y.invalidLocationMessage),null)}static createCylinder(P,R){return P instanceof t?new S(K.convertUnitGeometry(K.createUnitSizeCylinder(R?.densificationFactor||0),P,R)):(M().error(".createCylinder()",y.invalidLocationMessage),null)}static createPlane(P,R){if(!(P instanceof t))return M().error(".createPlane()",y.invalidLocationMessage),null;const O=R?.facing??"up",T=K.convertPlaneSizeParameter(O,R?.size);return new S(K.convertUnitGeometry(K.createUnitSizePlane(O),
P,{...R,size:T}))}static createFromPolygon(P,R){if(!(P instanceof q))return M().error(".createFromPolygon()",y.invalidPolygonMessage),null;const O=I.triangulate(P);return new S({vertexAttributes:new C.MeshVertexAttributes({position:O.position}),components:[new v({faces:O.faces,shading:"flat",material:R?.material??null})],spatialReference:P.spatialReference,vertexSpace:new D})}static async createFromGLTF(P,R,O){if(!(P instanceof t))throw P=new y.InvalidLocationError,M().error(".createfromGLTF()",P.message),
P;const {loadGLTFMesh:T}=await e.whenOrAbort(new Promise((Q,V)=>a(["./support/meshUtils/loadGLTFMesh"],Q,V)),O);return new S(await T(P,R,O))}static async createFromFiles(P,R,O){n.deprecatedFunction(M(),"`Mesh.createFromFiles` is deprecated in favor of 'SceneLayer.convertMesh'",{replacement:"SceneLayer.convertMesh",version:"4.29"});if(!(P instanceof t))throw P=R=new y.InvalidLocationError,M().error(".createFromFiles()",P.message),R;if(!O?.layer)throw new h("invalid:no-layer","SceneLayer required for file to mesh conversion.");
return O.layer.convertMesh(R,{location:P,...O})}static createWithExternalSource(P,R,O){var T=O?.extent??null;const {x:Q,y:V,z:U,spatialReference:W}=P;P=O?.transform?.clone()??new A;const ca=x.fromValues(Q,V,U??0);O=E.createVertexSpace(O?.vertexSpace??E.preferredVertexSpaceTypeForSR(W),ca);R={source:R,extent:T};T=new z.Metadata;T.externalSources.push(R);return new S({metadata:T,transform:P,vertexSpace:O,spatialReference:W})}static createIncomplete(P,R){const {x:O,y:T,z:Q,spatialReference:V}=P;P=R?.transform?.clone()??
new A;const U=x.fromValues(O,T,Q??0);R=E.createVertexSpace(R?.vertexSpace??E.preferredVertexSpaceTypeForSR(V),U);R=new S({transform:P,vertexSpace:R,spatialReference:V});R.addResolvingPromise(Promise.reject(new h("mesh-incomplete","Mesh resources are not complete")));return R}};b.__decorate([c.property({type:[v],json:{write:!0}})],k.prototype,"components",void 0);b.__decorate([c.property({nonNullable:!0,types:l,constructOnly:!0,json:{write:!0}})],k.prototype,"vertexSpace",void 0);b.__decorate([c.property({type:A,
json:{write:!0}})],k.prototype,"transform",void 0);b.__decorate([c.property({constructOnly:!0})],k.prototype,"metadata",void 0);b.__decorate([c.property()],k.prototype,"hasExtent",null);b.__decorate([c.property()],k.prototype,"_transformedExtent",null);b.__decorate([c.property()],k.prototype,"_untransformedBounds",null);b.__decorate([c.property()],k.prototype,"anchor",null);b.__decorate([c.property()],k.prototype,"origin",null);b.__decorate([c.property({readOnly:!0,json:{read:!1}})],k.prototype,"extent",
null);b.__decorate([c.property({readOnly:!0,json:{read:!1,write:!0,default:!0}})],k.prototype,"hasZ",void 0);b.__decorate([c.property({readOnly:!0,json:{read:!1,write:!0,default:!1}})],k.prototype,"hasM",void 0);b.__decorate([c.property({type:C.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],k.prototype,"vertexAttributes",void 0);k=S=b.__decorate([r.subclass("esri.geometry.Mesh")],k);const N=u.create();return k})},"esri/geometry/support/meshErrors":function(){define(["exports","../../core/Error"],
function(a,b){class n extends b{constructor(){super("invalid-input:location","Expected location to be a Point instance")}}a.InvalidLocationError=n;a.componentNotFoundMessage="Provided component is not part of the list of components";a.invalidLocationMessage="Expected location to be a Point instance";a.invalidPolygonMessage="Expected polygon to be a Polygon instance";a.meshNotLoadedMessage="Mesh must be loaded before applying operations";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/meshUtils/bounds":function(){define(["exports","../../Extent","../aaBoundingBox","./georeference"],function(a,b,n,h){function k(e){if(0===e.length)return n.zero;const d=n.create([Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY,-Number.POSITIVE_INFINITY]);n.expandWithBuffer(d,e);return d}function m(e,d){const [c,l,f,r,x,w]=k(e);return new b({xmin:c,ymin:l,zmin:f,xmax:r,ymax:x,zmax:w,spatialReference:d})}
let g=null;a.getBoundsFromPositions=k;a.getExtentFromBounds=function([e,d,c,l,f,r],x,w,p){g??=new Float64Array(24);const t=g;t[0]=e;t[1]=d;t[2]=c;t[3]=e;t[4]=f;t[5]=c;t[6]=l;t[7]=f;t[8]=c;t[9]=l;t[10]=d;t[11]=c;t[12]=e;t[13]=d;t[14]=r;t[15]=e;t[16]=f;t[17]=r;t[18]=l;t[19]=f;t[20]=r;t[21]=l;t[22]=d;t[23]=r;h.project({positions:t,transform:x,vertexSpace:w,inSpatialReference:p,outSpatialReference:p,outPositions:t});return m(t,p)};a.getExtentFromPositions=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/meshUtils/centerAt":function(){define("exports ../../../core/Logger ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../projection/projectPointToVector ../meshVertexSpaceUtils ./geographicUtils ./georeference".split(" "),function(a,b,n,h,k,m,g,e){const d=h.create(),c=h.create(),l=h.create();a.centerAt=function(f,r,x){if(f.vertexAttributes?.position){var {vertexSpace:w}=f,p=x?.origin??f.anchor;x=g.usesLocalTangentPlaneOnECEFForOperations("esri.geometry.support.meshUtils.centerAt",
w,p.spatialReference,x?.geographic);if(m.isRelativeVertexSpace(w))({vertexSpace:w}=f),m.isRelativeVertexSpace(w)&&(k.projectPointToVector(r,d,f.spatialReference)?(k.projectPointToVector(p,c,f.spatialReference)||(r=f.origin,c[0]=r.x,c[1]=r.y,c[2]=r.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${p.spatialReference.wkid}) to mesh spatial reference (wkid:${f.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),
f=n.subtract(l,d,c),w.origin=n.add(h.create(),w.origin,f)):b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${f.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));else if(x){p=e.ungeoreferenceGlobal(f.vertexAttributes,p);const {position:t,normal:q,tangent:u}=e.georeferenceGlobal(p,r,!1);f.vertexAttributes.position=t;f.vertexAttributes.normal=q;
f.vertexAttributes.tangent=u;f.vertexAttributesChanged()}else if(k.projectPointToVector(r,d,f.spatialReference)){k.projectPointToVector(p,c,f.spatialReference)||(r=f.origin,c[0]=r.x,c[1]=r.y,c[2]=r.z,b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project specified origin (wkid:${p.spatialReference.wkid}) to mesh spatial reference (wkid:${f.spatialReference.wkid}). `+"Projection may be possible after calling projection.load()."));if(p=f.vertexAttributes.position)for(r=0;r<
p.length;r+=3)for(w=0;3>w;w++)p[r+w]+=d[w]-c[w];f.vertexAttributesChanged()}else b.getLogger("esri.geometry.support.meshUtils.centerAt").error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${f.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/loadExternal":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils ../../Point".split(" "),
function(a,b,n,h,k,m){function g(u){const v=k.removeFile(u.url);return y=>{var D=k.makeRelative(y,v,v);return((D=D?D.replace(/^ *\.\//,""):null)?u.files.get(D):null)??y}}async function e(u,v){if(Array.isArray(u)){if(!u.length)throw new n("mesh-load-external:missing-assets","There must be at least one file to load");return u[0]instanceof File?c(u):l(u,v)}return q.fromBlob(u,r(u.name,u.type))}async function d(u,v){const {parts:y,assetMimeType:D,assetName:G}=u;if(1===y.length)return new q(y[0].partUrl);
u=await u.toBlob(v);h.throwIfAborted(v);return q.fromBlob(u,r(G,D))}function c(u){u=u.map(v=>({name:v.name,mimeType:v.type,source:q.fromBlob(v,r(v.name,v.type))}));return f(u)}async function l(u,v){u=await h.allSettledValues(u.map(async y=>{const D=await d(y);h.throwIfAborted(v);return{name:y.assetName,mimeType:y.assetMimeType,source:D}}));if(h.isAborted(v))throw u.forEach(y=>y.source.dispose()),h.createAbortError();return f(u)}function f(u){const v=new Map;let y=null,D=void 0;for(const {name:G,mimeType:A,
source:C}of u){if(null===y)if(x.test(A)||p.test(G))y=C.url,D="gltf";else if(w.test(A)||t.test(G))y=C.url,D="glb";v.set(G,C.url);C.files.forEach((E,I)=>v.set(I,E))}if(null==y)throw new n("mesh-load-external:missing-files","Missing files to load external mesh source");return new q(y,()=>u.forEach(({source:G})=>G.dispose()),v,D)}function r(u,v){return x.test(v)||p.test(u)?"gltf":w.test(v)||p.test(u)?"glb":void 0}const x=/^model\/gltf\+json$/,w=/^model\/gltf-binary$/,p=/\.gltf$/i,t=/\.glb$/i;class q{constructor(u,
v=()=>{},y=new Map,D){this.url=u;this.dispose=v;this.files=y;this.type=D}static fromBlob(u,v){const y=URL.createObjectURL(u);return new q(y,()=>URL.revokeObjectURL(y),void 0,v)}}b.loadExternal=async function(u,v,y){({source:v}=v);const {loadGLTFMesh:D}=await h.whenOrAbort(new Promise((E,I)=>a(["./loadGLTFMesh"],E,I)),y),G=await e(v,y);h.throwIfAborted(y);y=D(new m({x:0,y:0,z:0,spatialReference:u.spatialReference}),G.url,{resolveFile:g(G),signal:y?.signal,expectedType:G.type});y.then(()=>G.dispose(),
()=>G.dispose());const {vertexAttributes:A,components:C}=await y;u.vertexAttributes=A;u.components=C};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/Metadata":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Clonable ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./External".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.Metadata=class extends n.Clonable{constructor(){super();this.externalSources=new h;this._explicitDisplaySource=null;this.addHandles(k.on(()=>this.externalSources,"after-remove",({item:f})=>{f===this._explicitDisplaySource&&(this._explicitDisplaySource=null)},{sync:!0,onListenerRemove:()=>this._explicitDisplaySource=null}))}get displaySource(){return this._explicitDisplaySource??this._implicitDisplaySource}set displaySource(f){if(null!=f&&!l.isDisplayExternal(f))throw Error("Cannot use this source for display: it is not in a supported format.");
(this._explicitDisplaySource=f)&&this.externalSources.every(r=>!l.externalSourcesAreEqual(r,f))&&this.externalSources.add(f)}clearSources(){this.externalSources.removeAll()}getExternalSourcesOnService(f){return this.externalSources.items.filter(r=>l.externalIsOnService(r,f))}get _implicitDisplaySource(){return this.externalSources.find(l.isDisplayExternal)}};b.__decorate([m.property()],a.Metadata.prototype,"externalSources",void 0);b.__decorate([m.property()],a.Metadata.prototype,"displaySource",
null);b.__decorate([m.property()],a.Metadata.prototype,"_implicitDisplaySource",null);b.__decorate([m.property()],a.Metadata.prototype,"_explicitDisplaySource",void 0);a.Metadata=b.__decorate([c.subclass("esri.geometry.support.meshUtils.Metadata")],a.Metadata);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/primitives":function(){define("exports ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../MeshComponent ../MeshVertexAttributes ./georeference".split(" "),
function(a,b,n,h,k,m,g){var e=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],d=[0,0,1,0,0,1,0,0,1,0,0,1],c=[0,1,1,1,1,0,0,0],l=[0,1,2,0,2,3],f={east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]};const r={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,
-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},x={south:0,east:1,north:2,west:3,up:4,down:5},w=h.create(),p=b.create();a.boxFaceOrder=x;a.convertPlaneSizeParameter=function(t,q){const u="number"===typeof q?q:null!=q?q.width:1;q="number"===typeof q?q:null!=q?q.height:1;switch(t){case "up":case "down":return{width:u,
depth:q};case "north":case "south":return{width:u,height:q};case "east":case "west":return{depth:u,height:q}}};a.convertUnitGeometry=function(t,q,u){if(!t.isPlane)for(var v=0;v<t.position.length;v+=3)t.position[v+2]+=.5;v=u?.size;var y=g.getUnitScale(u?.unit,q.spatialReference);null==v&&1===y?v=null:null==v?v=[y,y,y]:"number"===typeof v?(v*=y,v=[v,v,v]):v=[null!=v.width?v.width*y:y,null!=v.depth?v.depth*y:y,null!=v.height?v.height*y:y];if(null!=v){p[0]=v[0];p[4]=v[1];p[8]=v[2];for(y=0;y<t.position.length;y+=
3){for(var D=0;3>D;D++)w[D]=t.position[y+D];n.transformMat3(w,w,p);for(D=0;3>D;D++)t.position[y+D]=w[D]}if(v[0]!==v[1]||v[1]!==v[2])for(p[0]=1/v[0],p[4]=1/v[1],p[8]=1/v[2],v=0;v<t.normal.length;v+=3){for(y=0;3>y;y++)w[y]=t.normal[v+y];n.transformMat3(w,w,p);n.normalize(w,w);for(y=0;3>y;y++)t.normal[v+y]=w[y]}}const {vertexAttributes:G,vertexSpace:A,transform:C}=g.georeferenceByTransform(t,q,{vertexSpace:u?.vertexSpace,geographic:u?.geographic});return{vertexAttributes:new m.MeshVertexAttributes({...G,
uv:t.uv}),vertexSpace:A,transform:C,components:[new k({faces:t.faces,material:u?.material||null})],spatialReference:q.spatialReference}};a.createUnitSizeBox=function(){const {faceDescriptions:t,faceVertexOffsets:q,uvScales:u}=r;var v=4*t.length;const y=new Float64Array(3*v),D=new Float32Array(3*v);v=new Float32Array(2*v);const G=new Uint32Array(6*t.length);let A=0,C=0,E=0,I=0;for(let J=0;J<t.length;J++){const B=t[J];var H=A/3;for(const z of q)G[I++]=H+z;H=B.corners;for(let z=0;4>z;z++){const K=H[z];
let L=0;v[E++]=.25*u[z][0]+B.uvOrigin[0];v[E++]=B.uvOrigin[1]-.25*u[z][1];for(let F=0;3>F;F++)0!==B.axis[F]?(y[A++]=.5*B.axis[F],D[C++]=B.axis[F]):(y[A++]=.5*K[L++],D[C++]=0)}}return{position:y,normal:D,uv:v,faces:G}};a.createUnitSizeCylinder=function(t=0){t=Math.round(16*2**t);var q=4*(t+1)+2*t;const u=new Float64Array(3*q),v=new Float32Array(3*q);q=new Float32Array(2*q);const y=new Uint32Array(12*t);let D=0,G=0,A=0,C=0,E=0;for(let H=0;5>=H;H++){const J=0===H||5===H,B=1>=H||4<=H,z=2===H||4===H,K=
J?t-1:t;for(let L=0;L<=K;L++){var I=L/K*2*Math.PI;const F=J?0:.5;w[0]=F*Math.sin(I);w[1]=F*-Math.cos(I);w[2]=2>=H?.5:-.5;for(I=0;3>I;I++)u[D++]=w[I],B?v[G++]=2===I?1>=H?1:-1:0:v[G++]=2===I?0:w[I]/F;q[A++]=(L+(J?.5:0))/t;1>=H?q[A++]=1*H/3:3>=H?q[A++]=(H-2)/3+1/3:q[A++]=(H-4)/3+2/3;z||0===H||L===t||(5!==H&&(y[C++]=E,y[C++]=E+1,y[C++]=E-t),1!==H&&(y[C++]=E,y[C++]=E-t,y[C++]=E-t-1));E++}}return{position:u,normal:v,uv:q,faces:y}};a.createUnitSizePlane=function(t){t=f[t];const q=new Float64Array(e.length),
u=new Float32Array(d.length);let v=0;for(let D=0;4>D;D++){const G=v;for(let A=0;3>A;A++){var y=t[A];const C=Math.abs(y)-1;y=0<=y?1:-1;q[v]=e[G+C]*y;u[v]=d[G+C]*y;v++}}return{position:q,normal:u,uv:new Float32Array(c),faces:new Uint32Array(l),isPlane:!0}};a.createUnitSizeSphere=function(t=0){t=Math.round(8*2**t);const q=2*t;var u=(t-1)*(q+1)+2*q;const v=new Float64Array(3*u),y=new Float32Array(3*u);u=new Float32Array(2*u);const D=new Uint32Array((t-1)*q*6);let G=0,A=0,C=0,E=0;for(let J=0;J<=t;J++){var I=
J/t*Math.PI+.5*Math.PI;const B=Math.cos(I);w[2]=Math.sin(I);const z=(I=0===J||J===t)?q-1:q;for(let K=0;K<=z;K++){var H=K/z*2*Math.PI;w[0]=-Math.sin(H)*B;w[1]=Math.cos(H)*B;for(H=0;3>H;H++)v[G]=.5*w[H],y[G]=w[H],++G;u[A++]=(K+(I?.5:0))/q;u[A++]=J/t;0!==J&&K!==q&&(J!==t&&(D[C++]=E,D[C++]=E+1,D[C++]=E-q),1!==J&&(D[C++]=E,D[C++]=E-q,D[C++]=E-q-1));E++}}return{position:v,normal:y,uv:u,faces:D}};a.extractSingleFaceOfBox=function(t,q){const u=t.components[0];var v=u.faces,y=x[q],D=6*y;q=Array(6);const G=
Array(v.length-6);var A=0;let C=0;for(let E=0;E<v.length;E++)E>=D&&E<D+6?q[A++]=v[E]:G[C++]=v[E];if(null!=t.vertexAttributes.uv){v=new Float32Array(t.vertexAttributes.uv);y*=8;D=[0,1,1,1,1,0,0,0];for(A=0;A<D.length;A++)v[y+A]=D[A];t.vertexAttributes.uv=v}t.components=[new k({faces:q,material:u.material}),new k({faces:G})];return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/rotate":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/math/quat ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){function y(J,B,z,K=c.ZEROS){if(null!=J)for(k.fromRotation(C,w.angleRad(B),w.axis(B)),B=0;B<J.length;B+=z){for(var L=0;3>L;L++)D[L]=J[B+L]-K[L];d.transformMat4(D,D,C);for(L=0;3>L;L++)J[B+L]=D[L]+K[L]}}const D=c.create(),G=m.create(),A=w.create(),C=m.create(),E=h.create(),I=c.create(),H=e.create();a.rotate=function(J,B,z){if(J.vertexAttributes?.position&&0!==B[3]){var {spatialReference:K,vertexSpace:L}=J,F=z?.origin??J.anchor;z=q.usesLocalTangentPlaneOnECEFForOperations("esri.geometry.support.meshUtils.rotate",
L,K,z?.geographic);if(t.isMeshWithRelativeVertexSpace(J))a:{J.transform??(J.transform=new p);const {vertexSpace:S,transform:N,spatialReference:P}=J,[R,O,T]=S.origin;z=new l({x:R,y:O,z:T,spatialReference:P});var M=D;if(z.equals(F))d.set(M,0,0,0);else if(!v.projectPointToVertexSpace(M,F,J)){b.getLogger("esri.geometry.support.meshUtils.rotate").error(`Failed to project specified origin (wkid:${F.spatialReference.wkid}) to mesh (wkid:${P.wkid}) ${S.type} vertex space. Projection may be possible after calling projection.load().`);
break a}g.setAxisAngle(H,w.axis(B),w.angleRad(B));J=k.fromRotationTranslationScaleOrigin(G,H,c.ZEROS,c.ONES,M);({localMatrix:B}=N);J=k.multiply(G,J,B);N.scale=k.getScaling(c.create(),J);k.scale(J,J,d.inverse(D,N.scale));N.rotation=w.fromMatrix(J);N.translation=k.getTranslation(c.create(),J)}else{if(z){z=J.spatialReference;M=f.getSphericalPCPF(z);x.projectPointToVector(F,I,M)||x.projectPointToVector(J.origin,I,M);F=J.vertexAttributes.position;const S=J.vertexAttributes.normal,N=J.vertexAttributes.tangent,
P=new Float64Array(F.length),R=null!=S?new Float32Array(S.length):null,O=null!=N?new Float32Array(N.length):null;r.computeTranslationToOriginAndRotation(M,I,C,M);n.fromMat4(E,C);d.transformMat3(w.axis(A),w.axis(B),E);A[3]=B[3];u.projectToPCPF(F,z,P);null!=S&&null!=R&&u.projectNormalToPCPF(S,F,P,z,R);null!=N&&null!=O&&u.projectTangentToPCPF(N,F,P,z,O);y(P,A,3,I);u.projectFromPCPF(P,F,z);null!=S&&null!=R&&(y(R,A,3),u.projectNormalFromPCPF(R,F,P,z,S));null!=N&&null!=O&&(y(O,A,4),u.projectTangentFromPCPF(O,
F,P,z,N))}else x.projectPointToVector(F,I,J.spatialReference)||(z=J.origin,I[0]=z.x,I[1]=z.y,I[2]=z.z,b.getLogger("esri.geometry.support.meshUtils.rotate").error(`Failed to project specified origin (wkid:${F.spatialReference.wkid}) to mesh spatial reference (wkid:${J.spatialReference.wkid}). `+"Projection may be possible after calling projection.load().")),y(J.vertexAttributes.position,B,3,I),y(J.vertexAttributes.normal,B,3),y(J.vertexAttributes.tangent,B,4);J.vertexAttributesChanged()}}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/vertexSpaceConversion":function(){define("exports ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../chunks/vec32 ../../spatialReferenceEllipsoidUtils ../../projection/computeTranslationToOriginAndRotation ../../projection/projectPointToVector".split(" "),function(a,b,n,h,k,m,g){const e=n.create();a.projectPointToVertexSpace=function(d,c,{vertexSpace:l,spatialReference:f}){if("georeferenced"===
l.type){if(!g.projectPointToVector(c,d,f))return!1;({origin:f}=l);h.subtract(d,d,f);return!0}const r=k.getSphericalPCPF(f);if(!g.projectPointToVector(c,d,r))return!1;({origin:c}=l);if(!m.computeTranslationToOriginAndRotation(f,c,e,r))return!1;f=b.invert(e,e);if(null==f)return!1;h.transformMat4(d,d,f);return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/scale":function(){define("exports ../../../core/Logger ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../Point ../../spatialReferenceEllipsoidUtils ../../projection/projectPointToVector ../axisAngleDegrees ../MeshTransform ../meshVertexSpaceUtils ./geographicUtils ./projection ./vertexSpaceConversion".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){function t(D,G,A=g.ZEROS){if(D)for(let E=0;E<D.length;E+=3){for(var C=0;3>C;C++)q[C]=D[E+C]-A[C];m.scale(q,q,G);for(C=0;3>C;C++)D[E+C]=q[C]+A[C]}}const q=g.create(),u=g.create(),v=h.create(),y=g.create();a.scale=function(D,G,A){if(D.vertexAttributes?.position){var {vertexSpace:C,spatialReference:E}=D,I=A?.origin??D.anchor;A=x.usesLocalTangentPlaneOnECEFForOperations("esri.geometry.support.meshUtils.scale",C,E,A?.geographic);if(r.isMeshWithRelativeVertexSpace(D))a:{D.transform??
(D.transform=new f);const {vertexSpace:J,transform:B,spatialReference:z}=D,[K,L,F]=J.origin;var H=new e({x:K,y:L,z:F,spatialReference:z});A=q;if(H.equals(I))m.set(A,0,0,0);else if(!p.projectPointToVertexSpace(A,I,D)){b.getLogger("esri.geometry.support.meshUtils.scale").error(`Failed to project specified origin (wkid:${I.spatialReference.wkid}) to mesh (wkid:${z.wkid}) ${J.type} vertex space. Projection may be possible after calling projection.load().`);break a}D=m.set(u,G,G,G);D=n.fromRotationTranslationScaleOrigin(v,
k.IDENTITY,g.ZEROS,D,A);({localMatrix:G}=B);D=n.multiply(v,D,G);B.scale=n.getScaling(g.create(),D);n.scale(D,D,m.inverse(q,B.scale));B.rotation=l.fromMatrix(D);B.translation=n.getTranslation(g.create(),D)}else{if(A){A=D.spatialReference;H=d.getSphericalPCPF(A);c.projectPointToVector(I,y,H)||c.projectPointToVector(D.origin,y,H);I=D.vertexAttributes.position;H=D.vertexAttributes.normal;const J=D.vertexAttributes.tangent,B=new Float64Array(I.length),z=null!=H?new Float32Array(H.length):null,K=null!=
J?new Float32Array(J.length):null;w.projectToPCPF(I,A,B);null!=H&&null!=z&&w.projectNormalToPCPF(H,I,B,A,z);null!=J&&null!=K&&w.projectTangentToPCPF(J,I,B,A,K);t(B,G,y);w.projectFromPCPF(B,I,A);null!=H&&null!=z&&w.projectNormalFromPCPF(z,I,B,A,H);null!=J&&null!=K&&w.projectTangentFromPCPF(K,I,B,A,J)}else c.projectPointToVector(I,y,D.spatialReference)||(A=D.origin,y[0]=A.x,y[1]=A.y,y[2]=A.z,b.getLogger("esri.geometry.support.meshUtils.scale").error(`Failed to project specified origin (wkid:${I.spatialReference.wkid}) to mesh spatial reference (wkid:${D.spatialReference.wkid}). `+
"Projection may be possible after calling projection.load().")),t(D.vertexAttributes.position,G,y);D.vertexAttributesChanged()}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/uploadAssetErrors":function(){define(["exports","../../../../core/Error"],function(a,b){class n extends b{constructor(){super("upload-assets:unsupported","Layer does not support asset uploads.",Error())}}class h extends b{constructor(){super("upload-assets:no-glb-support",
"Layer does not support glb.",Error())}}class k extends b{constructor(){super("upload-assets:no-supported-source","No supported external source found",Error())}}class m extends b{constructor(){super("upload-assets:not-base-64","Expected gltf data in base64 format after conversion.",Error())}}class g extends b{constructor(){super("upload-assets:unable-to-prepare-options","Unable to prepare uploadAsset request options.",Error())}}class e extends b{constructor(x,w){super("upload-assets:bad-response",
`Bad response. Uploaded ${x} items and received ${w} results.`,Error())}}class d extends b{constructor(x,w){super("upload-assets-layer:upload-failed",`Failed to upload mesh file ${x}. Error code: ${w?.code??"-1"}. Error message: ${w?.messages??"unknown"}`,Error())}}class c extends b{constructor(x){super("upload-assets-layer:unsupported-format",`The service allowed us to upload an asset of FormatID ${x}, but it does not list it in its supported formats.`,Error())}}class l extends b{constructor(){super("upload-assets:convert3D-failed",
"convert3D failed.")}}class f extends b{constructor(){super("invalid-input:no-model","No supported model found")}}class r extends b{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}a.BadResponseError=e;a.Convert3DFailedError=l;a.MultipleModelsError=r;a.NoGlbSupportError=h;a.NoModelError=f;a.NoSupportedSourceError=k;a.NotBase64Error=m;a.UnableToPrepareOptionsError=g;a.UnsupportedError=n;a.UnsupportedFormatUploadedError=c;a.UploadFailedError=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../portal/support/jsonContext ../../webdoc/support/resourceUtils ../../webdoc/support/saveAPIKeyUtils ../../webdoc/support/saveUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I){var H;(function(B){B[B.existingItem=0]="existingItem";B[B.newItem=1]="newItem"})(H||={});const J={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(B){B[B.SAVE=0]="SAVE";B[B.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SceneService=B=>{B=class extends B{constructor(){super(...arguments);this.heightModelInfo=
this.fullExtent=this.spatialReference=null;this.maxScale=this.minScale=0;this.version={major:Number.NaN,minor:Number.NaN,versionString:""};this.copyright=null;this.sublayerTitleMode="item-title";this.indexInfo=this.layerId=this.title=null;this._debouncedSaveOperations=m.debounce(async(z,K,L)=>{switch(z){case a.SaveOperationType.SAVE:return this._save(K);case a.SaveOperationType.SAVE_AS:return this._saveAs(L,K)}})}readSpatialReference(z,K){return this._readSpatialReference(K)}_readSpatialReference(z){if(null!=
z.spatialReference)return t.fromJSON(z.spatialReference);z=z.store;z=(z=z.indexCRS||z.geographicCRS)&&parseInt(z.substring(z.lastIndexOf("/")+1,z.length),10);return null!=z?new t(z):null}readFullExtent(z,K,L){if(null!=z&&"object"===typeof z)return K=null==z.spatialReference?{...z,spatialReference:this._readSpatialReference(K)}:z,w.fromJSON(K,L);L=K.store;K=this._readSpatialReference(K);return null==K||null==L?.extent||!Array.isArray(L.extent)||L.extent.some(F=>-1E38>F)?null:new w({xmin:L.extent[0],
ymin:L.extent[1],xmax:L.extent[2],ymax:L.extent[3],spatialReference:K})}parseVersionString(z){const K={major:Number.NaN,minor:Number.NaN,versionString:z};z=z.split(".");2<=z.length&&(K.major=parseInt(z[0],10),K.minor=parseInt(z[1],10));return K}readVersion(z,K){z=K.store;return this.parseVersionString(null!=z.version?z.version.toString():"")}readTitlePortalItem(z){return"item-title"!==this.sublayerTitleMode?void 0:z}readTitleService(z,K){z=this.portalItem?.title;if("item-title"===this.sublayerTitleMode)return q.titleFromUrlAndName(this.url,
K.name);K=K.name;if(!K&&this.url){const L=q.parse(this.url);null!=L&&(K=L.title)}"item-title-and-service-name"===this.sublayerTitleMode&&z&&(K=z+" - "+K);return q.cleanTitle(K)}set url(z){z=q.sanitizeUrlWithLayerId({layer:this,url:z,nonStandardUrlAllowed:!1,logger:k.getLogger(this)});this._set("url",z.url);null!=z.layerId&&this._set("layerId",z.layerId)}writeUrl(z,K,L,F){q.writeUrlWithLayerId(this,z,"layers",K,F)}get parsedUrl(){var z=this._get("url");z=g.urlToObject(z);null!=this.layerId&&(z.path=
`${z.path}/layers/${this.layerId}`);return z}async _fetchIndexAndUpdateExtent(z,K){this.indexInfo=v.fetchIndexInfo(this.parsedUrl.path,this.rootNode,z,this.customParameters,this.apiKey,k.getLogger(this),K);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(z){if("page"===z?.type){var K=z.rootIndex%z.pageSize;K=z.rootPage?.nodes?.[K];if(null==K?.obb?.center||null==K.obb.halfSize)throw new h("sceneservice:invalid-node-page","Invalid node page.");-1E38>
K.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(z=K.obb.halfSize,K=K.obb.center[2],z=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),this.fullExtent.zmin=K-z,this.fullExtent.zmax=K+z)}else if("node"===z?.type&&(K=z.rootNode?.mbs,Array.isArray(K)&&4===K.length&&!(-1E38>K[0]))){z=K[2];K=K[3];var {fullExtent:L}=this;L&&(L.zmin=z-K,L.zmax=z+K)}}async _fetchService(z){if(null==this.url)throw new h("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==
this.layerId&&/SceneServer\/*$/i.test(this.url)){const K=await this._fetchFirstLayerId(z);null!=K&&(this.layerId=K)}return this._fetchServiceLayer(z)}async _fetchFirstLayerId(z){z=await n(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:z});if(z.data&&Array.isArray(z.data.layers)&&0<z.data.layers.length)return z.data.layers[0].id}async _fetchServiceLayer(z){z=await n(this.parsedUrl?.path??"",{query:{f:"json",...this.customParameters,token:this.apiKey},
responseType:"json",signal:z});z.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let K=!1;z.data.layerType&&"Voxel"===z.data.layerType&&(K=!0);if(K)return this._fetchVoxelServiceLayer();z=z.data;this.read(z,this._getServiceContext());this.validateLayer(z)}async _fetchVoxelServiceLayer(z){z=(await n(this.parsedUrl?.path+"/layer",{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:z})).data;this.read(z,this._getServiceContext());this.validateLayer(z)}_getServiceContext(){return{origin:"service",
portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()}validateLayer(z){}_updateTypeKeywords(z,K,L){z.typeKeywords||(z.typeKeywords=[]);K=K.getTypeKeywords();for(const F of K)z.typeKeywords.push(F);z.typeKeywords&&(z.typeKeywords=z.typeKeywords.filter((F,M,S)=>S.indexOf(F)===M),L===H.newItem&&(z.typeKeywords=z.typeKeywords.filter(F=>"Hosted Service"!==
F)))}async _saveAs(z,K){K={...J,...K};z=G.from(z);if(!z)throw new h("sceneservice:portal-item-required","_saveAs() requires a portal item to save to");E.validateSaveAPIKey(z);z.id&&(z=z.clone(),z.id=null);const L=z.portal||D.getDefault();await this._ensureLoadBeforeSave();z.type="Scene Service";z.portal=L;const F=A.createForItemWrite(z,"portal-item",!0),M={layers:[this.write({},F)]};await Promise.all(F.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(M,F,K);z.url=this.url;z.title||
(z.title=this.title);this._updateTypeKeywords(z,K,H.newItem);await L.signIn();await L.user?.addItem({item:z,folder:K?.folder,data:M});await C.saveResources(this.resourceReferences,F);this.portalItem=z;x.updateOrigins(F);return F.portalItem=z}async _save(z){z={...J,...z};if(!this.portalItem)throw new h("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");E.validateSaveAPIKey(this.portalItem);if("Scene Service"!==this.portalItem.type)throw new h("sceneservice:portal-item-wrong-type",
'Portal item needs to have type "Scene Service"');await this._ensureLoadBeforeSave();const K=A.createForItemWrite(this.portalItem,"portal-item",!0),L={layers:[this.write({},K)]};await Promise.all(K.resources.pendingOperations??[]);await this._validateAgainstJSONSchema(L,K,z);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,z,H.existingItem);await C.updateItemWithResources(this.portalItem,L,this.resourceReferences,K);x.updateOrigins(K);
return this.portalItem}async _validateAgainstJSONSchema(z,K,L){var F=L?.validationOptions;I.evaluateWriteErrors(K,{errorName:"sceneservice:save"},{ignoreUnsupported:F?.ignoreUnsupported,supplementalUnsupportedErrors:["scenemodification:unsupported"]});K=F?.enabled;const M=y.getLoader();if(K&&M&&(L=(await M()).validate(z,L.portalItemLayerType),L.length&&(z=`Layer item did not validate:\n${L.join("\n")}`,k.getLogger(this).error(`_validateAgainstJSONSchema(): ${z}`),"throw"===F.failPolicy)))throw F=
L.map(S=>new h("sceneservice:schema-validation",S)),new h("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{validationErrors:F});}};b.__decorate([e.property(u.id)],B.prototype,"id",void 0);b.__decorate([e.property({type:t})],B.prototype,"spatialReference",void 0);b.__decorate([l.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],B.prototype,"readSpatialReference",null);b.__decorate([e.property({type:w})],
B.prototype,"fullExtent",void 0);b.__decorate([l.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],B.prototype,"readFullExtent",null);b.__decorate([e.property({readOnly:!0,type:p})],B.prototype,"heightModelInfo",void 0);b.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],B.prototype,"minScale",void 0);b.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",
write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],B.prototype,"maxScale",void 0);b.__decorate([e.property({readOnly:!0})],B.prototype,"version",void 0);b.__decorate([l.reader("version",["store.version"])],B.prototype,"readVersion",null);b.__decorate([e.property({type:String,json:{read:{source:"copyrightText"}}})],B.prototype,"copyright",void 0);b.__decorate([e.property({type:String,json:{read:!1}})],B.prototype,"sublayerTitleMode",void 0);b.__decorate([e.property({type:String})],
B.prototype,"title",void 0);b.__decorate([l.reader("portal-item","title")],B.prototype,"readTitlePortalItem",null);b.__decorate([l.reader("service","title",["name"])],B.prototype,"readTitleService",null);b.__decorate([e.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],B.prototype,"layerId",void 0);b.__decorate([e.property(u.url)],B.prototype,"url",null);b.__decorate([r.writer("url")],B.prototype,"writeUrl",
null);b.__decorate([e.property()],B.prototype,"parsedUrl",null);b.__decorate([e.property({readOnly:!0})],B.prototype,"store",void 0);b.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],B.prototype,"rootNode",void 0);return B=b.__decorate([f.subclass("esri.layers.mixins.SceneService")],B)};a.sceneServiceItemType="Scene Service";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports",
"../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(n){n?.writtenProperties&&n.writtenProperties.forEach(({target:h,propName:k,newOrigin:m})=>{b.isMultiOriginJSONMixin(h)&&m&&h.originOf(k)!==m&&h.updateOrigin(k,m)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../request","../../core/Error"],function(a,b,n){a.fetchIndexInfo=async function(h,k,m,g,e,d,c){var l=null;if(null!=m){l=`${h}/nodepages/`;const f=l+Math.floor(m.rootIndex/m.nodesPerPage);try{return{type:"page",rootPage:(await b(f,{query:{f:"json",...g,token:e},responseType:"json",signal:c})).data,rootIndex:m.rootIndex,pageSize:m.nodesPerPage,lodMetric:m.lodSelectionMetricType,urlPrefix:l}}catch(r){null!=d&&d.warn("#fetchIndexInfo()",
"Failed to load root node page. Falling back to node documents.",f,r),l=r}}if(!k)return null;k=k?.split("/").pop();h=`${h}/nodes/`;k=h+k;try{return{type:"node",rootNode:(await b(k,{query:{f:"json",...g,token:e},responseType:"json",signal:c})).data,urlPrefix:h}}catch(f){throw new n("sceneservice:root-node-missing","Root node missing.",{pageError:l,nodeError:f,url:k});}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],
function(a){let b=null;a.getLoader=function(){return b};a.registerLoader=function(n){b=n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(a,b,n){function h(k,m){return{origin:m,url:b.urlToObject(k.itemUrl),portal:k.portal||n.getDefault(),portalItem:k}}a.createForItemRead=function(k,m){return{...h(k,m),readResourcePaths:[]}};a.createForItemWrite=function(k,m,g){const e=b.urlToObject(k.itemUrl);
return{...h(k,m),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:e?{rootPath:e.path,writtenUrls:[]}:null,resources:g?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/resourceUtils":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),function(a,b,n,h,k,m){async function g(d,c,l){if(c?.resources){var f=
c.portalItem===d.portalItem?new Set(d.paths):new Set;d.paths.length=0;d.portalItem=c.portalItem;var r=new Set(c.resources.toKeep.map(u=>u.resource.path)),x=new Set,w=[];r.forEach(u=>{f.delete(u);d.paths.push(u)});var p=[],t=[],q=[];for(const u of c.resources.toUpdate)if(f.delete(u.resource.path),r.has(u.resource.path)||x.has(u.resource.path)){const {resource:v,content:y,finish:D}=u,G=m.getSiblingOfSameTypeI(v,k.generateUUID());d.paths.push(G.path);p.push({resource:G,content:await m.contentToBlob(y),
compress:u.compress});D&&q.push(()=>D(G))}else{d.paths.push(u.resource.path);t.push({resource:u.resource,content:await m.contentToBlob(u.content),compress:u.compress});const v=u.finish;v&&q.push(()=>v(u.resource));x.add(u.resource.path)}for(const u of c.resources.toAdd)if(d.paths.push(u.resource.path),f.has(u.resource.path))f.delete(u.resource.path);else{p.push({resource:u.resource,content:await m.contentToBlob(u.content),compress:u.compress});const v=u.finish;v&&q.push(()=>v(u.resource))}if(p.length||
t.length)({addOrUpdateResources:r}=await new Promise((u,v)=>a(["../../portal/support/resourceUtils"],u,v))),await r(c.portalItem,p,"add",l),await r(c.portalItem,t,"update",l);q.forEach(u=>u());if(0===w.length)return f;c=await h.allSettledErrors(w);h.throwIfAborted(l);if(0<c.length)throw new n("save:resources","Failed to save one or more resources",{errors:c});return f}}async function e(d,c,l){if(d&&c.portalItem){var f=[];for(const r of d)d=c.portalItem.resourceFromPath(r),f.push(d.portalItem.removeResource(d,
l));await h.eachAlways(f)}}b.saveResources=async function(d,c,l){d=await g(d,c,l);await e(d,c,l)};b.updateItemWithResources=async function(d,c,l,f,r){l=await g(l,f,r);await d.update({data:c});await e(l,f,r)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(a,b,n,h){function k(g){const e=g.lastIndexOf("/");return-1===e?[".",g]:[g.slice(0,e),g.slice(e+1)]}
function m(g){{const f=h.getPathExtension(g);g=null==f?[g,""]:[g.slice(0,g.length-f.length-1),`.${f}`]}const [e,d]=g,[c,l]=k(e);return[c,l,d]}a.addOrUpdateResources=async function(g,e,d,c){var l=new Map;for(const {resource:f,content:r,compress:x,access:w}of e){if(!f.hasPath())throw new n(`portal-item-resource-${d}:invalid-path`,"Resource does not have a valid path");const [p,t]=k(f.path);e=`${p}/${x??""}/${w??""}`;l.has(e)||l.set(e,{prefix:p,compress:x,access:w,files:[]});l.get(e).files.push({fileName:t,
content:r})}await g.load(c);d=h.join(g.userItemUrl,"add"===d?"addResources":"updateResources");for(const {prefix:f,compress:r,access:x,files:w}of l.values())for(l=0;l<w.length;l+=25){e=w.slice(l,l+25);const p=new FormData;f&&"."!==f&&p.append("resourcesPrefix",f);r&&p.append("compress","true");x&&p.append("access",x);let t=0;for(const {fileName:q,content:u}of e)p.append(`file${++t}`,u,q);p.append("f","json");await g.portal.request(d,{method:"post",body:p,signal:c?.signal})}};a.contentToBlob=async function(g){return"blob"===
g.type?g.blob:"json"===g.type?new Blob([g.jsonString],{type:"application/json"}):(await b(g.url,{responseType:"blob"})).data};a.fetchResources=async function(g,e={},d){await g.load(d);const c=h.join(g.itemUrl,"resources"),{start:l=1,num:f=10,sortOrder:r="asc",sortField:x="resource"}=e;e=await g.portal.request(c,{query:{start:l,num:f,sortOrder:r,sortField:x,token:g.apiKey},signal:d?.signal});return{total:e.total,nextStart:e.nextStart,resources:e.resources.map(({created:w,size:p,resource:t})=>({created:new Date(w),
size:p,resource:g.resourceFromPath(t)}))}};a.getSiblingOfSameType=function(g,e){if(!g.hasPath())return null;const [d,,c]=m(g.path);return g.portalItem.resourceFromPath(h.join(d,e+c))};a.getSiblingOfSameTypeI=function(g,e){if(!g.hasPath())return null;const [d,,c]=m(g.path);return g.portalItem.resourceFromPath(h.join(d,e+c))};a.removeAllResources=async function(g,e){await g.load(e);const d=h.join(g.userItemUrl,"removeResources");return g.portal.request(d,{method:"post",query:{deleteAll:!0},signal:e?.signal})};
a.removeResource=async function(g,e,d){if(!e.hasPath())throw new n("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await g.load(d);const c=h.join(g.userItemUrl,"removeResources");await g.portal.request(c,{method:"post",query:{resource:e.path},signal:d?.signal});e.portalItem=null};a.splitPrefixFileNameAndExtension=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveAPIKeyUtils":function(){define(["exports","../../config","../../core/Error",
"../../support/apiKeyUtils"],function(a,b,n,h){a.validateSaveAPIKey=function(k){if(b.apiKey&&h.supportsApiKey(k.portal.url))throw new n("save-api-key-utils:api-key-not-supported",`Saving is not supported on ${k.portal.url} when using an api key`);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define(["exports","../../core/Error"],function(a,b){const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported",
"url:unsupported"]);a.beforeSave=async function(h){const k=[];for(const m of h.allLayers)"beforeSave"in m&&"function"===typeof m.beforeSave&&(h=m.beforeSave())&&k.push(h);await Promise.allSettled(k)};a.evaluateWriteErrors=function(h,k,m){let g=(h.messages??[]).filter(({type:e})=>"error"===e).map(({name:e,message:d,details:c})=>new b(e,d,c));h.blockedRelativeUrls&&(g=g.concat(h.blockedRelativeUrls.map(e=>new b("url:unsupported",`Relative url '${e}' is not supported`))));if(m){const {ignoreUnsupported:e,
supplementalUnsupportedErrors:d=[],requiredPropertyChecksDisabled:c}=m;e&&(g=g.filter(({name:l})=>!(n.has(l)||d.includes(l))));c&&(g=g.filter(l=>"web-document-write:property-required"!==l.name))}if(0<g.length)throw new b(k.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:g});};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/TemporalSceneLayer":function(){define("exports ../../chunks/tslib.es6 ../../TimeExtent ../../TimeInterval ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../support/fieldUtils ../support/TimeInfo".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.TemporalSceneLayer=f=>{f=class extends f{get timeInfo(){var r=this.associatedLayer?.timeInfo;if(null==r)return r;r=r.clone();c.fixTimeInfoFields(r,this.fieldsIndex);return r}set timeInfo(r){c.fixTimeInfoFields(r,this.fieldsIndex);this._override("timeInfo",r)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(r){this._override("timeExtent",r)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(r){this._override("timeOffset",
r)}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(r){this._override("useViewTime",r)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(r){this._override("datesInUnknownTimezone",r)}};b.__decorate([k.property({type:l})],f.prototype,"timeInfo",null);b.__decorate([k.property({type:n})],f.prototype,"timeExtent",null);b.__decorate([k.property({type:h})],f.prototype,"timeOffset",null);b.__decorate([k.property({type:Boolean,
nonNullable:!0})],f.prototype,"useViewTime",null);b.__decorate([k.property({type:Boolean,nonNullable:!0})],f.prototype,"datesInUnknownTimezone",null);return f=b.__decorate([d.subclass("esri.layers.mixins.TemporalSceneLayer")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,
supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1,zDefault:void 0},metadata:{supportsAdvancedFieldProperties:!1},
operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},
query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,
supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e,d){a.I3SNodePageDefinition=class extends n.JSONSupport{constructor(){super(...arguments);this.nodesPerPage=null;this.rootIndex=0;this.lodSelectionMetricType=null}};b.__decorate([h.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([h.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([h.property({type:String})],a.I3SNodePageDefinition.prototype,"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=
b.__decorate([d.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=class extends n.JSONSupport{constructor(){super(...arguments);this.factor=1}};b.__decorate([h.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([h.property({type:Number})],a.I3SMaterialTexture.prototype,"factor",void 0);a.I3SMaterialTexture=b.__decorate([d.subclass("esri.layer.support.I3SMaterialTexture")],
a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=class extends n.JSONSupport{constructor(){super(...arguments);this.baseColorFactor=[1,1,1,1];this.metallicRoughnessTexture=this.baseColorTexture=null;this.roughnessFactor=this.metallicFactor=1}};b.__decorate([h.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",void 0);b.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([h.property({type:a.I3SMaterialTexture})],
a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([h.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([h.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=b.__decorate([d.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=class extends n.JSONSupport{constructor(){super(...arguments);
this.alphaMode="opaque";this.alphaCutoff=.25;this.doubleSided=!1;this.cullFace="none";this.pbrMetallicRoughness=this.emissiveFactor=this.emissiveTexture=this.occlusionTexture=this.normalTexture=null}};b.__decorate([e.enumeration({opaque:"opaque",mask:"mask",blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([h.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([h.property({type:Boolean})],a.I3SMaterialDefinition.prototype,
"doubleSided",void 0);b.__decorate([e.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);b.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([h.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([h.property({type:[Number]})],
a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([h.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([d.subclass("esri.layer.support.I3SMaterialDefinition")],a.I3SMaterialDefinition);a.I3STextureFormat=class extends n.JSONSupport{};b.__decorate([h.property({type:String,json:{read:{source:["name","index"],reader:(c,l)=>null!=c?c:`${l.index}`}}})],a.I3STextureFormat.prototype,
"name",void 0);b.__decorate([e.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([d.subclass("esri.layer.support.I3STextureFormat")],a.I3STextureFormat);a.I3STextureSetDefinition=class extends n.JSONSupport{constructor(){super(...arguments);this.atlas=!1}};b.__decorate([h.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([h.property({type:Boolean})],
a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([d.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);a.I3SGeometryAttribute=class extends n.JSONSupport{};b.__decorate([e.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([h.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=
b.__decorate([d.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);a.I3SGeometryCompressedAttributes=class extends n.JSONSupport{};b.__decorate([e.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([h.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([d.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=class extends n.JSONSupport{constructor(){super(...arguments);this.offset=0}};b.__decorate([h.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([h.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([h.property({type:a.I3SGeometryCompressedAttributes})],a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=
b.__decorate([d.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=class extends n.JSONSupport{};b.__decorate([e.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([h.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=b.__decorate([d.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e){a.RangeInfo=class extends n.JSONSupport{constructor(){super(...arguments);this.fullRangeExtent=this.currentRangeExtent=this.field=this.name=null;this.type="rangeInfo"}};b.__decorate([h.property({type:String,json:{read:!0,
write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([h.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);b.__decorate([h.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([h.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);
a.RangeInfo=b.__decorate([e.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/tslib.es6 ../../request ../../core/JSONSupport ../../core/lang ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){var x;n=x=class extends n.JSONSupport{constructor(w){super(w);this.spatialRelationship="disjoint";this.geometries=new f;this._geometriesSource=null}initialize(){this.addHandles(k.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,k.sync))}readGeometries(w,p,t){Array.isArray(w)?this.geometries=f.fromJSON(w,t):this._geometriesSource={url:r.fromJSON(w,t),context:t}}async loadGeometries(w,p){if(null!=this._geometriesSource){var {url:t,context:q}=
this._geometriesSource;p=await b(t,{responseType:"json",signal:p?.signal});var u=w.toJSON();w=p.data.map(v=>({...v,spatialReference:u}));this.geometries=f.fromJSON(w,q);this._geometriesSource=null}}clone(){const w=new x({geometries:h.clone(this.geometries),spatialRelationship:this.spatialRelationship});w._geometriesSource=this._geometriesSource;return w}};a.__decorate([m.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],n.prototype,"spatialRelationship",void 0);a.__decorate([m.property({type:f,
nonNullable:!0,json:{write:!0}}),l.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries",contentAddressed:!0})],n.prototype,"geometries",void 0);a.__decorate([d.reader(["web-scene","portal-item"],"geometries")],n.prototype,"readGeometries",null);return n=x=a.__decorate([c.subclass("esri.layers.support.SceneFilter")],n)})},"esri/core/accessorSupport/decorators/persistable":function(){define("exports ../../Error ../../MD5 ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(t,q,u){const v=g.getPropertyMetadata(q,u);return{type:String,read:(y,D,G)=>{y=l.read(y,D,G);if(v.type===String)return y;if("function"===typeof v.type)return new v.type({url:y})},write:{writer(y,D,G,A){if(A?.resources){var C=null==y?null:"string"===typeof y?y:y.url;C=l.toJSON(C,{...A,verifyItemRelativeUrls:A?.verifyItemRelativeUrls?{writtenUrls:A.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},l.MarkKeep.NO);var E=v.type!==String&&(!h.isMultiOriginJSONMixin(this)||
A?.origin&&this.originIdOf(u)>e.nameToId(A.origin));y={object:this,propertyName:u,value:y,targetUrl:C,dest:D,targetPropertyName:G,context:A,params:t};if(A?.portalItem&&C&&!k.isAbsolute(C))if(E&&t?.contentAddressed)r(y);else if(E){{const {context:I,targetUrl:H,params:J,value:B,dest:z,targetPropertyName:K}=y;I.portalItem&&(D=I.portalItem.resourceFromPath(H),G=p(B,H,I),A=c.getResourceContentExtension(G),C=k.getPathExtension(D.path),E=J?.compress??!1,A!==C?r(y):(I.resources&&w({...y,resource:D,content:G,
compress:E,updates:I.resources.toUpdate}),z[K]=H))}}else x(y);else A?.portalItem&&(null==C||null!=l.itemIdFromResourceUrl(C)||k.isBlobProtocol(C)||E)?r(y):D[G]=C}else D[G]="string"===typeof y?l.toJSON(y,A):y.write({},A)}}}}function r(t){const {targetUrl:q,params:u,value:v,context:y,dest:D,targetPropertyName:G}=t;if(y.portalItem){var A=l.prefixAndFilenameFromResourceUrl(q),C=p(v,q,y);if(u?.contentAddressed&&"json"!==C.type)y.messages?.push(new b("persistable:contentAddressingUnsupported",`Property "${G}" is trying to serializing a resource with content of type ${C.type} with content addressing. Content addressing is only supported for json resources.`,
{content:C}));else{var E=u?.contentAddressed&&"json"===C.type?n.createMD5Hash(C.jsonString):A?.filename??m.generateUUID(),I=k.join(u?.prefix??A?.prefix,E),H=`${I}.${c.getResourceContentExtension(C)}`;if(u?.contentAddressed&&y.resources&&"json"===C.type&&(A=y.resources.toKeep.find(({resource:B})=>B.path===H)??y.resources.toAdd.find(({resource:B})=>B.path===H))){D[G]=A.resource.itemRelativeUrl;return}var J=y.portalItem.resourceFromPath(H);k.isBlobProtocol(q)&&y.resources&&y.resources.pendingOperations.push(k.blobUrlToBlob(q).then(B=>
{J.path=`${I}.${c.getResourceContentExtension({type:"blob",blob:B})}`;D[G]=J.itemRelativeUrl}).catch(()=>{}));y.resources&&w({...t,resource:J,content:C,compress:u?.compress??!1,updates:y.resources.toAdd});D[G]=J.itemRelativeUrl}}}function x({context:t,targetUrl:q,dest:u,targetPropertyName:v}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(q),compress:!1}),u[v]=q)}function w({object:t,propertyName:q,updates:u,resource:v,content:y,compress:D}){u.push({resource:v,
content:y,compress:D,finish:G=>{"string"===typeof t[q]?t[q]=G.url:t[q].url=G.url}})}function p(t,q,u){return"string"===typeof t?{type:"url",url:q}:{type:"json",jsonString:JSON.stringify(t.toJSON(u))}}a.persistable=function(t){const q=t?.origins??[void 0];return(u,v)=>{a:if("resource"===t?.type)var y=f(t,u,v);else{switch(t?.type??"other"){case "other":y={read:!0,write:!0};break a;case "url":const {read:D,write:G}=l.persistableUrlUtils;y={read:D,write:G};break a}y=void 0}for(const D of q){const G=d.propertyJSONMeta(u,
D,v);for(const A in y)G[A]=y[A]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,b){const n={},h=n["text/plain"],k={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};
for(const m in k)n[k[m]]=m;a.getResourceContentExtension=function(m){"json"===m.type?m="application/json":"blob"===m.type?m=m.blob.type:(m=b.getPathExtension(m.url),m=k[m]||"text/plain");return n[m]||h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PolygonCollection":function(){define("../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){var f;b=f=class extends n.JSONSupportMixin(b.ofType(c)){constructor(r){super(r)}clone(){return new f(this.items.map(r=>r.clone()))}write(r,x){return this.toJSON(x)}toJSON(r){const x=r?.layer?.spatialReference;return x?this.toArray().map(w=>{if(!x.equals(w.spatialReference)){if(!l.canProjectWithoutEngine(w.spatialReference,x))return r?.messages&&r.messages.push(new h("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,
spatialReference:r.layer.spatialReference,context:r})),null;const p=new c;l.projectPolygon(w,p,x);w=p}w=w.toJSON(r);delete w.spatialReference;return w}).filter(w=>null!=w):(r?.messages&&r.messages.push(new h("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:r.layer.spatialReference,context:r})),this.toArray().map(w=>w.toJSON(r)))}static fromJSON(r,x){const w=new f;r.forEach(p=>w.add(c.fromJSON(p,x)));return w}};return b=f=
a.__decorate([d.subclass("esri.layers.support.PolygonCollection")],b)})},"esri/support/zipUtils":function(){define(["require","exports"],function(a,b){async function n(h){const {BlobReader:k,ZipReader:m,BlobWriter:g}=await new Promise((d,c)=>a(["./zipjs-wrapper"],d,c)),e=[];h=new k(h);(await (new m(h)).getEntries()).forEach(d=>{if(!d.directory&&!/^__MACOS/i.test(d.filename)){var c=new g;(c=d.getData?.(c).then(l=>new File([l],d.filename)))&&e.push(c)}});return Promise.all(e)}b.extractZipFile=n;b.extractZipFiles=
async function(h){const k=[];for(const m of h)m.name.toLowerCase().endsWith(".zip")?k.push(n(m)):k.push(Promise.resolve(m));return(await Promise.all(k)).flat()};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../geometry ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(X){return X?parseInt(X.substring(X.lastIndexOf("/")+1,X.length),10):void 0}function C(X,ba){var ia=ba[0],fa=ba[1];ba=ba[3];const da=X[0]-ia;ia-=X[2];const aa=X[1]-fa;X=fa-X[3];fa=Math.max(da,ia,0);const ea=Math.max(aa,X,0);fa=fa*fa+ea*ea;return fa>ba*ba?a.MbsIntersectResult.OUTSIDE:0<fa?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(da,ia,aa,X)>ba?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function E(X,ba,ia){const fa=[],da=ia?.missingFields;ia=ia?.originalFields;for(const aa of X){X=aa.toLowerCase();let ea=!1;for(const ha of ba)if(X===ha.name.toLowerCase()){fa.push(ha.name);ea=!0;ia&&ia.push(aa);break}!ea&&da&&da.push(aa)}return fa}function I(X,ba,ia){const fa=new Map,da=[];ia=ia();for(const ha of X){var aa=ha.attributes[ba];for(var ea=0;ea<ia.length;ea++){X=ia[ea];const Y=X.featureIds.indexOf(aa);if(0<=Y){aa=fa.get(X.node);aa||(aa={node:X.node,indices:[],graphics:[]},da.push(aa),
fa.set(X.node,aa));aa.indices.push(Y);for(aa.graphics.push(ha);0<ea;ea--)ia[ea]=ia[ea-1];ia[0]=X;break}}}return da}async function H(X,ba,ia,fa,da){ba.sort((ha,Y)=>ha.attributes[ia]-Y.attributes[ia]);var aa=ba.map(ha=>ha.attributes[ia]);const ea=[];fa=E(fa,X.fields,{originalFields:ea});X=await J(X,aa,fa,da);for(da=0;da<ba.length;da++){aa=ba[da];const ha=X[da],Y={};if(aa.attributes)for(const Z in aa.attributes)Y[Z]=aa.attributes[Z];for(let Z=0;Z<ea.length;Z++)Y[ea[Z]]=ha[fa[Z]];aa.attributes=Y}return ba}
function J(X,ba,ia,fa){var da=X.capabilities.query.maxRecordCount;if(null!=da&&ba.length>da)return da=h.splitIntoChunks(ba,da),Promise.all(da.map(aa=>J(X,aa,ia,fa))).then(aa=>aa.flat());da=new t({objectIds:ba,outFields:ia,orderByFields:[X.objectIdField]});return X.queryFeatures(da,fa).then(aa=>{if(aa&&aa.features&&aa.features.length===ba.length)return aa.features.map(ea=>ea.attributes);throw new k("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}async function B(X,
ba,ia,fa,da,aa,ea,ha){const Y=[];for(const Z of ba)Z&&da.includes(Z.name)&&Y.push({url:`${X}/nodes/${ia}/attributes/${Z.key}/0`,storageInfo:Z});X=await Promise.allSettled(Y.map(Z=>n(Z.url,{responseType:"array-buffer",query:{...ea,token:aa},signal:ha?.signal}).then(ja=>q.readBinaryAttribute(Z.storageInfo,ja.data))));ba=[];for(const Z of fa){fa={};for(ia=0;ia<X.length;ia++)da=X[ia],"fulfilled"===da.status&&(fa[Y[ia].storageInfo.name]=z(da.value,Z));ba.push(fa)}return ba}function z(X,ba){if(!X)return null;
ba=X[ba];return g.isInt16Array(X)?-32768===ba?null:ba:g.isInt32Array(X)?ba===P?null:ba:ba!==ba?null:ba}function K(X){var ba=X.store,ia=ba.indexCRS||ba.geographicCRS;if(ba=void 0===ia?ba.indexWKT:void 0)if(X.spatialReference){if(ba!==X.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-index-incompatible","The indexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new k("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indexWKT in the scene layer store but no layer spatial reference",{});ia=ia?new G(A(ia)):X.spatialReference;return ia.equals(X.spatialReference)?X.spatialReference:ia}function L(X){var ba=X.store,ia=ba.vertexCRS||ba.projectedCRS;if(ba=void 0===ia?ba.vertexWKT:void 0)if(X.spatialReference){if(ba!==X.spatialReference.wkt)throw new k("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new k("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});ia=ia?new G(A(ia)):X.spatialReference;return ia.equals(X.spatialReference)?X.spatialReference:ia}function F(X,ba,ia){if(!f.canProjectWithoutEngine(X,ba))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===ia&&!M(X,ba))throw new k("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});}function M(X,ba){return X.equals(ba)||X.isWGS84&&ba.isWebMercator||X.isWebMercator&&ba.isWGS84}function S(X,ba,ia){const fa=K(X);X=L(X);F(fa,ba,ia);F(X,ba,ia)}const N=w.create();a.MbsIntersectResult=void 0;(function(X){X[X.OUTSIDE=0]="OUTSIDE";X[X.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";X[X.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";X[X.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const P=-(2**31);b=v.createSolidEdgeMaterial({color:[0,0,0,
0],opacity:0});class R{constructor(){this.material=this.edgeMaterial=null;this.castShadows=!0}}const O=[l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create()],T=w.create(),Q=w.create(),V=new D.Obb,U=l.create(),W={data:Array(72),size:3,exclusive:!0,stride:3},ca=d.create();a.SymbolInfo=R;a.addWraparound=function(X,ba){return(X|0)+(ba|0)|0};a.checkPointCloudLayerCompatibleWithView=function(X,ba){F(X.spatialReference,ba.spatialReference,ba.viewingMode)};a.checkPointCloudLayerValid=
function(X){var ba;(ba=null==X.store?.defaultGeometrySchema)||(X=X.store.defaultGeometrySchema,ba=!!(null==X.geometryType||"points"!==X.geometryType||null!=X.topology&&"PerAttributeArray"!==X.topology||null!=X.encoding&&""!==X.encoding&&"lepcc-xyz"!==X.encoding||null==X.vertexAttributes?.position));if(ba)throw new k("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(X,ba,ia){if(X.serviceUpdateTimeStamp?.lastUpdate!==
ba.serviceUpdateTimeStamp?.lastUpdate||!ia.isEmpty||X.associatedLayer?.url!==ba.associatedLayer?.url)throw new k("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=function(X,ba){S(X,ba.spatialReference,ba.viewingMode)};a.checkSceneLayerValid=function(X){var ba;(ba=null==X.store?.defaultGeometrySchema)||(ba=X.store.defaultGeometrySchema,ba=!!(null!=ba.geometryType&&"triangles"!==ba.geometryType||null!=ba.topology&&"PerAttributeArray"!==ba.topology||null==ba.vertexAttributes?.position));
if(ba)throw new k("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:X.parsedUrl.path});};a.checkSpatialReference=F;a.checkSpatialReferences=S;a.computeVisibilityObb=function(X,ba,ia,fa,da,aa,ea){if(!aa||0===aa.length||null==ba||!X.serviceMbsInIndexSR)return null;const ha=u.computeGlobalTransformation(X.serviceMbsInIndexSR,da,ia,ba);e.invert(ca,ha);let Y=null;const Z=()=>{if(!Y)if(Y=O,w.empty(Q),null!=X.serviceObbInIndexSR){X.serviceObbInIndexSR.transform(V,
ia,ba,da,ea);V.getCorners(Y);for(var ta of Y)c.transformMat4(ta,ta,ca),w.expandPointInPlace(Q,ta)}else{var va=X.serviceMbsInIndexSR;if(va)for(ta=va[3],x.projectVectorToVector(p.getCenter(va),ia,U,ba),c.transformMat4(U,U,ca),U[2]+=da,va=0;8>va;++va){const Ca=Y[va];c.copy(Ca,[U[0]+(va&1?ta:-ta),U[1]+(va&2?ta:-ta),U[2]+(va&4?ta:-ta)]);w.expandPointInPlace(Q,Ca)}}};let ja=Infinity,oa=-Infinity;const qa=ta=>{if("replace"===ta.type&&(ta=ta.geometry,ta?.hasZ)){w.empty(T);var va=ta.spatialReference||fa;ta=
ta.rings.reduce((Ca,ma)=>ma.reduce((wa,Ba)=>{c.set(U,Ba[0],Ba[1],Ba[2]);x.projectVectorToVector(U,va,U,ba);c.transformMat4(U,U,ca);w.expandPointInPlace(T,U);return Math.min(U[2],wa)},Ca),Infinity);Z();w.intersects(Q,T)&&(ja=Math.min(ja,ta),oa=Math.max(oa,ta))}};aa.forEach(ta=>qa(ta));if(Infinity===ja)return null;aa=(ta,va,Ca)=>{c.transformMat4(U,Ca,ha);ta[va]=U[0];ta[va+1]=U[1];ta[va+2]=U[2];va+=24;Ca[2]=ja;c.transformMat4(U,Ca,ha);ta[va]=U[0];ta[va+1]=U[1];ta[va+2]=U[2];va+=24;Ca[2]=oa;c.transformMat4(U,
Ca,ha);ta[va]=U[0];ta[va+1]=U[1];ta[va+2]=U[2]};for(let ta=0;8>ta;++ta)aa(W.data,3*ta,Y[ta]);return D.compute(W)};a.containsDraco=function(X){if(m("disable-feature:i3s-draco")||!X)return!1;for(const ba of X)for(const ia of ba.geometryBuffers)if("draco"===ia.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=A;a.filterInPlace=function(X,ba,ia){let fa=0,da=0;for(let aa=0;aa<ba.length&&fa<X.length;aa++)X[fa]===ba[aa]&&(ia(aa)&&(X[da]=X[fa],da++),fa++);X.length=da};a.findFieldsCaseInsensitive=
E;a.findIntersectingNodes=function(X,ba,ia,fa){ia.traverse(ba,da=>{const aa=da.serviceMbsInIndexSR;if((null!=aa&&C(X,aa))===a.MbsIntersectResult.OUTSIDE)return!1;fa(da);return!0})};a.getCacheKeySuffix=function(X,ba){return null==ba?"@null":ba===r.getSphericalPCPF(ba)?"@ECEF":X.equals(ba)?"":null!=ba.wkid?"@"+ba.wkid:null};a.getCachedAttributeValue=z;a.getClipRect=function(X,ba){if(0===ba.rotationScale[1]&&0===ba.rotationScale[2]&&0===ba.rotationScale[3]&&0===ba.rotationScale[5]&&0===ba.rotationScale[6]&&
0===ba.rotationScale[7])return N[0]=(X[0]-ba.position[0])/ba.rotationScale[0],N[1]=(X[1]-ba.position[1])/ba.rotationScale[4],N[2]=(X[2]-ba.position[0])/ba.rotationScale[0],N[3]=(X[3]-ba.position[1])/ba.rotationScale[4],N};a.getIndexCrs=K;a.getSymbolInfo=function(X){const ba=new R;var ia=!1;let fa=!1;for(const aa of X.symbolLayers.items)if("fill"===aa.type&&aa.enabled){var da=aa.material;X=aa.edges;null==da||ia||(ia=da.color,da=y.parseColorMixMode(da.colorMixMode),ba.material=null!=ia?{color:[ia.r/
255,ia.g/255,ia.b/255],alpha:ia.a,colorMixMode:da}:{color:[1,1,1],alpha:1,colorMixMode:y.ColorMixModeEnum.Multiply},ba.castShadows=aa.castShadows,ia=!0);null==X||fa||(ba.edgeMaterial=v.createMaterialFromEdges(X,{}),fa=!0)}ba.material||(ba.material={color:[1,1,1],alpha:1,colorMixMode:y.ColorMixModeEnum.Multiply});return ba};a.getVertexCrs=L;a.intersectBoundingRectWithMbs=C;a.invalidateMbs=function(X){null!=X&&(X[3]=-1)};a.isSupportedLocalModeProjection=M;a.isValidMbs=function(X){return 0<=X[3]};a.objectIdFilter=
function(X,ba,ia){let fa=0,da=0;for(;fa<ia.length;)0<=h.binaryIndexOf(X,ia[fa])===ba&&(ia[da]=ia[fa],da++),fa++;ia.length=da};a.queryAttributesFromCachedAttributesId=B;a.rendererNeedsTextures=function(X){if(null==X||"simple"!==X.type&&"class-breaks"!==X.type&&"unique-value"!==X.type||("unique-value"===X.type||"class-breaks"===X.type)&&null==X.defaultSymbol)return!0;X=X.getSymbols();if(0===X.length)return!0;for(const ba of X){if("mesh-3d"!==ba.type||0===ba.symbolLayers.length)return!0;for(const ia of ba.symbolLayers.items)if("fill"!==
ia.type||null==ia.material?.color||"replace"!==ia.material.colorMixMode)return!0}return!1};a.transparentEdgeMaterial=b;a.whenGraphicAttributes=async function(X,ba,ia,fa,da,aa){if(0===ba.length)return[];const ea=X.attributeStorageInfo;if(null!=X.associatedLayer)try{return await H(X.associatedLayer,ba,ia,fa,aa)}catch(ha){if(X.associatedLayer.loaded)throw ha;}if(ea){ba=I(ba,ia,da);if(null==ba)throw new k("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const ha=X.parsedUrl.path;
return(await Promise.all(ba.map(Y=>B(ha,ea,Y.node.resources.attributes,Y.indices,fa,X.apiKey,X.customParameters,aa).then(Z=>{for(let ja=0;ja<Y.graphics.length;ja++){const oa=Y.graphics[ja],qa=Z[ja];if(oa.attributes)for(const ta in oa.attributes)ta in qa||(qa[ta]=oa.attributes[ta]);oa.attributes=qa}return Y.graphics})))).flat()}throw new k("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,n,h,k,m){function g(G,A){const C={byteOffset:0,byteCount:0,fields:Object.create(null)};let E=0;for(let I=0;I<A.length;I++){const H=A[I],J=H.valueType||H.type;C.fields[H.property]=(0,D[J])(G,E);E+=y[J].BYTES_PER_ELEMENT}C.byteCount=E;return C}function e(G,A,C){return d(G,A,C).map(E=>(E=E?Date.parse(E):
null)&&!Number.isNaN(E)?E:null)}function d(G,A,C){const E=[];let I,H=0,J;for(J=0;J<G;J+=1){I=A[J];if(0<I){var B=E,z=B.push,K=C,L=H,F=I-1;let S="",N=0;for(;N<F;){var M=K[L+N];if(128>M)S+=String.fromCharCode(M),N++;else if(192<=M&&224>M){if(N+1>=F)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");S+=String.fromCharCode((M&31)<<6|K[L+N+1]&63);N+=2}else if(224<=M&&240>M){if(N+2>=F)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
S+=String.fromCharCode((M&15)<<12|(K[L+N+1]&63)<<6|K[L+N+2]&63);N+=3}else if(240<=M&&248>M){if(N+3>=F)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");M=(M&7)<<18|(K[L+N+1]&63)<<12|(K[L+N+2]&63)<<6|K[L+N+3]&63;S=65536<=M?S+String.fromCharCode((M-65536>>10)+55296,(M&1023)+56320):S+String.fromCharCode(M);N+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}z.call(B,S);if(0!==C[H+I-1])throw new b("string-array-error",
"Invalid string array: missing null termination.");}else E.push(null);H+=I}return E}function c(G,A){return new y[A.valueType](G,A.byteOffset,A.count*A.valuesPerElement)}function l(G,A){return new Uint8Array(G,A.byteOffset,A.byteCount)}function f(G,A,C){G=null!=A.header?g(G,A.header):{byteOffset:0,byteCount:0,fields:{count:C}};C={header:G,byteOffset:G.byteCount,byteCount:0,entries:Object.create(null)};let E=G.byteCount;for(let I=0;I<A.ordering.length;I++){const H=A.ordering[I],J=n.clone(A[H]);J.count=
G.fields.count??0;if("String"===J.valueType){J.byteOffset=E;J.byteCount=G.fields[H+"ByteCount"];if("UTF-8"!==J.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:J.encoding});if(J.timeEncoding&&"ECMA_ISO8601"!==J.timeEncoding)throw new b("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:J.timeEncoding});}else if(t(J.valueType)){const B=q(J.valueType);E+=0!==E%B?B-E%B:0;J.byteOffset=E;J.byteCount=B*J.valuesPerElement*J.count}else throw new b("unsupported-value-type",
"Unsupported binary valueType",{valueType:J.valueType});E+=J.byteCount??0;C.entries[H]=J}C.byteCount=E-C.byteOffset;return C}function r(G,A,C){A!==G&&u().error(`Invalid ${C} buffer size\n expected: ${G}, actual: ${A})`);if(A<G)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:G,actualSize:A});}function x(G){return{isDraco:!1,isLegacy:!1,color:null!=G.color,normal:null!=G.normal,uv0:null!=G.uv0,uvRegion:null!=G.uvRegion,featureIndex:null!=G.faceRange&&null!=G.featureId}}function w(G){const A=
{isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of G.ordering)if(G.vertexAttributes[C])switch(C){case "normal":A.normal=!0;break;case "color":A.color=!0;break;case "uv0":A.uv0=!0;break;case "region":A.uvRegion=!0}G.featureAttributes&&G.featureAttributeOrder&&(A.featureIndex=!0);return A}function p(G){const A={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of G)switch(C){case "normal":A.normal=!0;break;case "uv0":A.uv0=
!0;break;case "color":A.color=!0;break;case "uv-region":A.uvRegion=!0;break;case "feature-index":A.featureIndex=!0}return A}function t(G){return y.hasOwnProperty(G)}function q(G){return t(G)?y[G].BYTES_PER_ELEMENT:0}const u=()=>h.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),v={position:m.VertexAttribute.POSITION,normal:m.VertexAttribute.NORMAL,color:m.VertexAttribute.COLOR,uv0:m.VertexAttribute.UV0,region:m.VertexAttribute.UVREGION},y={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,
Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},D={Float32:(G,A)=>(new DataView(G,0)).getFloat32(A,!0),Float64:(G,A)=>(new DataView(G,0)).getFloat64(A,!0),UInt8:(G,A)=>(new DataView(G,0)).getUint8(A),Int8:(G,A)=>(new DataView(G,0)).getInt8(A),UInt16:(G,A)=>(new DataView(G,0)).getUint16(A,!0),Int16:(G,A)=>(new DataView(G,0)).getInt16(A,!0),UInt32:(G,A)=>(new DataView(G,0)).getUint32(A,!0),Int32:(G,A)=>(new DataView(G,0)).getInt32(A,!0)};a.createAttributeDataIndex=
f;a.createGeometryDescriptor=function(G,A){return G&&G.compressedAttributes&&"draco"===G.compressedAttributes.encoding?p(G.compressedAttributes.attributes):G?x(G):w(A)};a.createGeometryDescriptorForDraco=p;a.createGeometryDescriptorFromDefinition=x;a.createGeometryDescriptorFromSchema=w;a.createGeometryIndexFromSchema=function(G,A){var C=g(G,A&&A.header);let E=C.byteCount;const I={isDraco:!1,header:C,byteOffset:C.byteCount,byteCount:0,vertexAttributes:{}};C=C.fields;var H=null!=C.vertexCount?C.vertexCount:
C.count;for(var J of A.ordering){if(!A.vertexAttributes[J])continue;const z={...A.vertexAttributes[J],byteOffset:E,count:H};I.vertexAttributes[v[J]||"_"+J]=z;E+=q(z.valueType)*z.valuesPerElement*H}J=C.faceCount;if(A.faces&&J){I.faces={};for(var B of A.ordering)A.faces[B]&&(H={...A.faces[B],byteOffset:E,count:J},I.faces[B]=H,E+=q(H.valueType)*H.valuesPerElement*J)}B=C.featureCount;if(A.featureAttributes&&A.featureAttributeOrder&&B){I.featureAttributes={};for(const z of A.featureAttributeOrder)A.featureAttributes[z]&&
(C={...A.featureAttributes[z],byteOffset:E,count:B},I.featureAttributes[z]=C,J="UInt64"===C.valueType?8:q(C.valueType),E+=J*C.valuesPerElement*B)}r(E,G.byteLength,"geometry");I.byteCount=E-I.byteOffset;return I};a.createRawView=l;a.createTypedView=c;a.getBytesPerValue=q;a.isValueType=t;a.readBinaryAttribute=function(G,A,C){if("lepcc-rgb"===G.encoding)return k.decodeRGB(A);if("lepcc-intensity"===G.encoding)return k.decodeIntensity(A);if(null!=G.encoding&&""!==G.encoding)throw new b("unknown-attribute-storage-info-encoding",
"Unknown Attribute Storage Info Encoding");G["attributeByteCounts "]&&!G.attributeByteCounts&&(u().warn("Warning: Trailing space in 'attributeByteCounts '."),G.attributeByteCounts=G["attributeByteCounts "]);"ObjectIds"===G.ordering[0]&&G.hasOwnProperty("objectIds")&&(u().warn("Warning: Case error in objectIds"),G.ordering[0]="objectIds");C=f(A,G,C);r(C.byteOffset+C.byteCount,A.byteLength,"attribute");if(G=C.entries.attributeValues||C.entries.objectIds){if("String"===G.valueType){C=C.entries.attributeByteCounts;
const E=c(A,C);A=l(A,G);return G.timeEncoding?e(C.count,E,A):d(C.count,E,A)}return c(A,G)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=e;a.readHeader=g;a.readStringArray=d;a.valueType2ArrayBufferReader=D;a.valueType2TypedArrayClassMap=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function n(g,e,d){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(g,d+m.identifierOffset,m.identifierLength)),version:e.getUint16(d+m.versionOffset,!0),checksum:e.getUint32(d+m.checksumOffset,!0)}}function h(g,e,d){const c=[];e=k(g,e,c);const l=[];for(let f=0;f<c.length;f++){l.length=0;e=k(g,e,l);for(let r=0;r<l.length;r++)d.push(l[r]+c[f])}return e}function k(g,e,d){var c=new DataView(g,e),l=c.getUint8(0);const f=l&31;var r=!!(l&32),x=(l&192)>>6;l=0;if(0===x)l=c.getUint32(1,!0),e+=5;else if(1===x)l=c.getUint16(1,!0),e+=3;else if(2===x)l=c.getUint8(1),
e+=2;else throw new b("lepcc-decode-error","Bad count type");if(r)throw new b("lepcc-decode-error","LUT not implemented");g=new Uint8Array(g,e,Math.ceil(l*f/8));x=r=c=0;const w=-1>>>32-f;for(let p=0;p<l;p++){for(;r<f;)c|=g[x]<<r,r+=8,x+=1;d[p]=c&w;c>>>=f;r-=f;32<r+f&&(c|=g[x-1]>>8-r)}return e+x}const m={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(g){const e=new DataView(g,0);var d=0;const {identifier:c,version:l}=n(g,e,d);d+=m.byteCount;
if("Intensity "!==c)throw new b("lepcc-decode-error","Bad identifier");if(1<l)throw new b("lepcc-decode-error","Unknown version");var f=d;var r=e.getUint32(f+0,!0);var x=e.getUint32(f+4,!0);var w=e.getUint32(f+8,!0);var p=e.getUint16(f+12,!0);var t=e.getUint8(f+14);e.getUint8(f+15);d+=16;if(x*2**32+r!==g.byteLength)throw new b("lepcc-decode-error","Bad size");r=new Uint16Array(w);if(8===t){if(w+d!==g.byteLength)throw new b("lepcc-decode-error","Bad size");g=new Uint8Array(g,d,w);for(d=0;d<w;d++)r[d]=
g[d]*p}else if(16===t){if(2*w+d!==g.byteLength)throw new b("lepcc-decode-error","Bad size");g=new Uint16Array(g,d,w);for(d=0;d<w;d++)r[d]=g[d]*p}else{t=[];if(k(g,d,t)!==g.byteLength)throw new b("lepcc-decode-error","Bad size");for(g=0;g<w;g++)r[g]=t[g]*p}return r};a.decodeRGB=function(g){var e=new DataView(g,0),d=0;const {identifier:c,version:l}=n(g,e,d);d+=m.byteCount;if("ClusterRGB"!==c)throw new b("lepcc-decode-error","Bad identifier");if(1<l)throw new b("lepcc-decode-error","Unknown version");
var f=d;var r=e.getUint32(f+0,!0);var x=e.getUint32(f+4,!0);var w=e.getUint32(f+8,!0);var p=e.getUint16(f+12,!0);var t=e.getUint8(f+14);f=e.getUint8(f+15);d+=16;if(x*2**32+r!==g.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===t||1===t)&&0===f){if(3*p+w+d!==g.byteLength||256<p)throw new b("lepcc-decode-error","Bad count");e=new Uint8Array(g,d,3*p);d=new Uint8Array(g,d+3*p,w);g=new Uint8Array(3*w);for(p=0;p<w;p++)r=d[p],g[3*p]=e[3*r],g[3*p+1]=e[3*r+1],g[3*p+2]=e[3*r+2];return g}if(0===
t&&0===f){if(3*w+d!==g.byteLength||0!==p)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(g,d)).slice()}if(2>=t&&1===f){if(d+3!==g.byteLength||1!==p)throw new b("lepcc-decode-error","Bad count");g=e.getUint8(d);p=e.getUint8(d+1);d=e.getUint8(d+2);e=new Uint8Array(3*w);for(r=0;r<w;r++)e[3*r]=g,e[3*r+1]=p,e[3*r+2]=d;return e}throw new b("lepcc-decode-error","Bad method "+t+","+f);};a.decodeXYZ=function(g){var e=new DataView(g,0),d=0;const {identifier:c,version:l}=n(g,e,d);d+=m.byteCount;
if("LEPCC     "!==c)throw new b("lepcc-decode-error","Bad identifier");if(1<l)throw new b("lepcc-decode-error","Unknown version");var f=d;var r=e.getUint32(f+0,!0);var x=e.getUint32(f+4,!0);var w=e.getFloat64(f+8,!0);var p=e.getFloat64(f+16,!0);var t=e.getFloat64(f+24,!0);var q=e.getFloat64(f+32,!0);var u=e.getFloat64(f+40,!0);var v=e.getFloat64(f+48,!0);var y=e.getFloat64(f+56,!0);var D=e.getFloat64(f+64,!0);var G=e.getFloat64(f+72,!0);var A=e.getUint32(f+80,!0);e.getUint32(f+84,!0);d+=88;if(x*2**
32+r!==g.byteLength)throw new b("lepcc-decode-error","Bad size");r=new Float64Array(3*A);x=[];A=[];e=[];f=[];d=h(g,d,x);d=h(g,d,A);d=h(g,d,e);d=h(g,d,f);if(d!==g.byteLength)throw new b("lepcc-decode-error","Bad length");d=g=0;for(let C=0;C<x.length;C++){d+=x[C];let E=0;for(let I=0;I<A[C];I++){E+=e[g];const H=f[g];r[3*g]=Math.min(q,w+2*y*E);r[3*g+1]=Math.min(u,p+2*D*d);r[3*g+2]=Math.min(v,t+2*G*H);g++}}return{errorX:y,errorY:D,errorZ:G,result:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/computeTranslationToOriginAndRotation"],function(a,b,n,h,k){function m(g,e,d){const c=n.create(),l=2**(4*Math.ceil(Math.log(g[3])*Math.LOG2E/4)+1);if(d.isGeographic){var f=l/h.getReferenceEllipsoid(d).radius*180/Math.PI;d=Math.max(-90,Math.min(90,Math.round(g[1]/
f)*f));f/=Math.cos((Math.abs(d)-f/2)/180*Math.PI);c[0]=Math.round(g[0]/f)*f;c[1]=d}else d=Math.round(g[1]/l),c[0]=Math.round(g[0]/l)*l,c[1]=d*l;c[2]=Math.round((g[2]+e)/l)*l;return c}a.computeGlobalTransformation=function(g,e,d,c){g=m(g,e,d);e=b.create();k.computeTranslationToOriginAndRotation(d,g,e,c);return e};a.getLocalOrigin=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],
function(a,b){function n(h,k){return h.popupTemplate?h.popupTemplate:null!=k&&k.defaultPopupTemplateEnabled&&null!=h.defaultPopupTemplate?h.defaultPopupTemplate:null}a.getFetchPopupTemplate=n;a.getRequiredFields=async function(h,k=h.popupTemplate){if(null==k)return[];const m=await k.getRequiredFields(h.fieldsIndex);({lastEditInfoEnabled:k}=k);const {objectIdField:g,typeIdField:e,globalIdField:d,relationships:c}=h;if(m.includes("*"))return["*"];k=k?b.getFeatureEditFields(h):[];const l=b.fixFields(h.fieldsIndex,
[...m,...k]);e&&l.push(e);l&&g&&h.fieldsIndex?.has(g)&&!l.includes(g)&&l.push(g);l&&d&&h.fieldsIndex?.has(d)&&!l.includes(d)&&l.push(d);c&&c.forEach(f=>{({keyField:f}=f);l&&f&&h.fieldsIndex?.has(f)&&!l.includes(f)&&l.push(f)});return l};a.hasPopupTemplate=function(h,k){return null!=n(h,{defaultPopupTemplateEnabled:k})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,n,h,k,m,g,e,d,c){h=class extends d.TiledLayerView3D(e.LayerView3D(c)){constructor(){super(...arguments);this.type="elevation-3d"}get tileInfo(){return this.layer.tileInfo}initialize(){var l=this.view?.map?.allLayers;l=l&&l.includes(this.layer);var f=this.view?.map?.ground?.layers;f=f&&f.includes(this.layer);l&&!f&&(l=new b("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(l)));this._addTilingSchemeMatchPromise()}};
a.__decorate([n.property()],h.prototype,"layer",void 0);a.__decorate([n.property()],h.prototype,"tileInfo",null);return h=a.__decorate([g.subclass("esri.views.3d.layers.ElevationLayerView3D")],h)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.LayerView3D=f=>{f=class extends f{constructor(){super(...arguments);this.supportsHeightUnitConversion=this.slicePlaneEnabled=!1}postscript(r){super.postscript(r);l.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const r=new AbortController;var x=r.signal;this.addHandles(n.makeHandle(()=>r.abort()));await k.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,x);h.throwIfAborted(x);
if(x=l.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw x;}canResume(){const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!r?.minScale||!r.maxScale||r.minScale>=r.maxScale)}getSuspendInfo(){const r=super.getSuspendInfo(),x=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;x&&x.minScale&&x.maxScale&&x.minScale<x.maxScale&&(r.outsideScaleRange=!0);return r}};
b.__decorate([m.property()],f.prototype,"view",void 0);b.__decorate([m.property()],f.prototype,"slicePlaneEnabled",void 0);return f=b.__decorate([c.subclass("esri.views.3d.layers.LayerView3D")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./support/LayerViewPerformanceInfo ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){a.TiledLayerView3D=r=>{r=class extends r{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}get dataScaleRange(){var x=this.tileInfo.lods;let w=x[0].scale;x=x[x.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const {effectiveMinLOD:p,effectiveMaxLOD:t}=this.layer.tilemapCache;w=this.tileInfo.lodAt(p).scale;x=this.tileInfo.lodAt(t).scale}return{minScale:w,
maxScale:x}}get dataLevelRange(){const {minScale:x,maxScale:w}=this.dataScaleRange;return this.levelRangeFromScaleRange(x,w)}get displayLevelRange(){const x=this.levelRangeFromScaleRange(this.layer.minScale||this.dataScaleRange.minScale,this.layer.maxScale||this.dataScaleRange.maxScale);this.layer.maxScale&&x.maxLevel++;return x}get performanceInfo(){return new c.LayerViewPerformanceInfo(this.view.basemapTerrain.getUsedMemoryForLayerView(this))}getTileUrl(x,w,p){return this.layer.getTileUrl(x,w,p)}_addTilingSchemeMatchPromise(){if(null==
this.fullExtent)return this.addResolvingPromise(Promise.reject(new n("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var x=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(x)return this.addResolvingPromise(Promise.reject(x));x=h.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const w=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(w)throw w;});this.addResolvingPromise(x)}_getTileInfoSupportError(x,
w){if(x=f.checkIfTileInfoSupportedForView(x,w,this.view.spatialReference,this.view.state.viewingMode)){w={layer:this.layer,error:x};switch(x.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":x=new n("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",w);break;default:x=new n("layerview:tiling-scheme-unsupported",
"The tiling scheme of this layer is not supported by SceneView",w)}return x}return null}_getTileInfoCompatibilityError(x,w){return null!=x&&w.compatibleWith(x)?null:new n("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(x,w){const p={minLevel:0,maxLevel:Infinity};var t=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!t)return p;const q=t.levels[0];t=u=>{u=Math.log(q.scale/
u)/Math.LN2;return 1E-9>.5-Math.abs(.5-u%1)?Math.round(u):Math.ceil(u)};null!=x&&0<x&&(p.minLevel=Math.max(0,t(x)));null!=w&&0<w&&(p.maxLevel=Math.max(0,t(w)));return p}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};b.__decorate([k.property({readOnly:!0})],r.prototype,"imageFormatIsOpaque",null);b.__decorate([k.property({readOnly:!0})],r.prototype,"updating",void 0);b.__decorate([k.property(l.updatingProgress)],r.prototype,"updatingProgress",void 0);
b.__decorate([k.property(l.updatingProgressValue)],r.prototype,"updatingProgressValue",void 0);b.__decorate([k.property()],r.prototype,"fullExtent",null);b.__decorate([k.property({readOnly:!0})],r.prototype,"isOpaque",null);b.__decorate([k.property()],r.prototype,"dataScaleRange",null);b.__decorate([k.property({readOnly:!0})],r.prototype,"dataLevelRange",null);b.__decorate([k.property({readOnly:!0})],r.prototype,"displayLevelRange",null);b.__decorate([k.property()],r.prototype,"layer",void 0);return r=
b.__decorate([d.subclass("esri.views.3d.layers.TiledLayerView3D")],r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){h=class extends l{constructor(){super(...arguments);this.type="feature-3d";this.direct3DObjectFeatureLayerDisplayEnabled=c.direct3DObjectFeatureLayerDisplayEnabled()}initialize(){const {layer:f,view:r}=this;d.getEffectiveLayerCapabilities(f)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new b("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:f})));null!=f.infoFor3D&&(this.direct3DObjectFeatureLayerDisplayEnabled?
this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${f.geometryType}`))));"mesh"!==f.geometryType||e.canProjectWithoutEngine(f.spatialReference,r.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))}get featureSpatialReference(){return this.view.featureTiles?.tilingScheme?.spatialReference}};
a.__decorate([n.property({constructOnly:!0})],h.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);a.__decorate([n.property()],h.prototype,"layer",void 0);return h=a.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],h)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLayerViewPerformanceInfo ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){m=class extends D(x.FeatureLikeLayerView3D(v(w.LayerView3D(y)))){constructor(A){super(A);this._processorTotal=this._controllerTotal=0;this._needsRefresh=!1;this.suspendResumeExtentMode="data"}initialize(){this.addHandles([h.watch(()=>this._updatingRequiredFieldsPromise,A=>this._updatingHandles.addPromise(A),h.syncAndInitial),h.watch(()=>({controller:this.controller,suspended:this.suspended}),({controller:A,suspended:C})=>{A&&!C&&this._needsRefresh&&
(A.refetch(),this._needsRefresh=!1)})])}destroy(){this._updatingHandles.removeAll();this._fetcherContext=n.destroyMaybe(this._fetcherContext)}get maximumNumberOfFeatures(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")}set maximumNumberOfFeatures(A){this._set("maximumNumberOfFeatures",A);this.controller&&(this.controller.maximumNumberOfFeatures=A)}get maximumNumberOfFeaturesExceeded(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):
!1}get updatingProgressValue(){let A=0;if(this.controller?.updating){var C=this.controller.updatingRemaining,E=Math.max(this.controller.updatingTotal,this._controllerTotal);0<E&&(A=(E-C)/E,this._controllerTotal=E)}C=0;if(this.processor?.updating){E=this.processor.updatingRemaining;const I=Math.max(E,this._processorTotal);0<I&&(C=(I-E)/I,this._processorTotal=I)}return.5*(A+C)}get updatePolicy(){if(!this.controller)return u.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const A=G.get(this.layer.geometryType);
return null==A||this.controller.serviceDataCount>A?u.UpdatePolicy.ASYNC:u.UpdatePolicy.SYNC;case "tiles":return u.UpdatePolicy.ASYNC}}get hasZ(){const A=this.layer,C=A.capabilities&&A.capabilities.data;return C&&C.supportsZ?"returnZ"in A&&null!=A.returnZ?A.returnZ:C.supportsZ:!1}get hasM(){const A=this.layer,C=A.capabilities&&A.capabilities.data;return C&&C.supportsM?"returnM"in A&&null!=A.returnM?A.returnM:!1:!1}setVisibility(A,C){this.processor?.setObjectIdVisibility(A,C)}createQuery(){return super.createQuery()}queryFeatures(A,
C){const E=()=>super.queryFeatures(A,C);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(A),E):E()}beforeSetController(A){A.maximumNumberOfFeatures=this.maximumNumberOfFeatures}createController(){this._fetcherContext=new p.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const A=new f.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new t.EventedSet,extent:this.clippingExtent});this._updatingHandles.add(()=>
A.serviceDataExtent,C=>{this.processor&&(this.processor.dataExtent=C)},h.initial);this.addHandles(h.watch(()=>this.suspended,C=>{C?A.suspend():A.resume()},h.syncAndInitial));this._updatingHandles.add(()=>this.processor?.displayFeatureLimit,C=>A.displayFeatureLimit=C,h.initial);this.addHandles(h.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return A}async doRefresh(A){const {controller:C,processor:E,suspended:I}=this;A&&C&&(I?this._needsRefresh=!0:(C.refetch(),this._needsRefresh=
!1));E.refreshFilter()}_popupFeatureHasRequiredFields(A,C){if(!super._popupFeatureHasRequiredFields(A,C))return!1;A=c.getObjectId(A,this.layer.objectIdField);if(null==A)return!0;A=this.controller.getMissingAttributesForFeature(A);if(null==A)return!0;for(const E of C)if(A.has(E))return!1;return!0}get usedMemory(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)}get unloadedMemory(){const A=this.controller?.expectedFeatureDiff??0,C=this.processor?.loadedFeatures??
0;return(this.processor?.unprocessedMemoryEstimate??0)+A*(this.processor?.usedMemoryPerFeature??0)*(0<C+A?C/(C+A):1)}get ignoresMemoryFactor(){return this.controller?.hasMaximumNumberOfFeaturesOverride}async _queryFeaturesMesh(A,C){await this._validateQueryFeaturesMesh(A);C=await C();if(A?.outStatistics||null==this.graphics3DProcessor)return C;A=this.layer.objectIdField;const E=this.graphics3DProcessor.graphics3DGraphicsByObjectID,I=[];for(const H of C.features)if(H.geometry){const J=E.get(H.attributes[A]);
J&&(H.geometry=l.hydrateGeometry(J.graphic.geometry),I.push(H))}else I.push(H);C.features=I;return C}async _validateQueryFeaturesMesh(A){if(A){var C=I=>{throw new b("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${I}'`);},E=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const I of E)null!=A[I]&&C(I);"returnM"in A&&A.returnM&&C("returnM");"returnCentroid"in A&&A.returnCentroid&&C("returnCentroid");null==A.outSpatialReference||
A.outSpatialReference.equals(this.view.spatialReference)||C("outSpatialReference")}}get performanceInfo(){var A=this.controller?.displayFeatureLimit;A=null!=A?A.averageSymbolComplexity:void 0;return new r.FeatureLayerViewPerformanceInfo(super.performanceInfo,this.controller?.performanceInfo?.storedFeatures??0,this.controller?.performanceInfo?.totalVertices??0,this.maximumNumberOfFeaturesExceeded,this.controller?.mode??"n/a",null!=A?`f:${A.verticesPerFeature},v:${A.verticesPerCoordinate}`:"n/a")}get test(){return{updatePolicy:this.updatePolicy,
controller:this.controller,loadedGraphics:this.controller?.graphics,...this.getTest()}}};a.__decorate([k.property()],m.prototype,"layer",void 0);a.__decorate([k.property()],m.prototype,"controller",void 0);a.__decorate([k.property()],m.prototype,"_controllerTotal",void 0);a.__decorate([k.property()],m.prototype,"_processorTotal",void 0);a.__decorate([k.property()],m.prototype,"_needsRefresh",void 0);a.__decorate([k.property()],m.prototype,"maximumNumberOfFeatures",null);a.__decorate([k.property()],
m.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([k.property(q.updatingProgress)],m.prototype,"updatingProgress",void 0);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"updatePolicy",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"hasZ",null);a.__decorate([k.property({readOnly:!0})],m.prototype,"hasM",null);a.__decorate([k.property()],m.prototype,"suspendResumeExtentMode",void 0);m=
a.__decorate([d.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],m);const G=new Map([["point",5E3],["polygon",500],["polyline",1E3]]);return m})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/support/UpdatingHandles ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){function A(C,E){if(!E)return!1;for(const I of E)if(!C.has(I))return!0;return!1}a.FeatureTileController3D=class extends l.EsriPromiseMixin(n){get dataUpdating(){return this._tileFetcher?.dataUpdating??!1}set extent(C){if(null==C||C.spatialReference.equals(this.layerView.view.spatialReference)){var E=this._get("extent");E===C||null!=E&&C&&E.equals(C)||(C=null!=C?C.clone():null,this._set("extent",C))}else d.getLogger(this).error("#extent\x3d","extent needs to be in the same spatial reference as the view")}get updating(){return!!(null!=
this._tileFetcher&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._updatingHandles&&this._updatingHandles.updating)}get updatingTotal(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}get updatingRemaining(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}get expectedFeatureDiff(){return this.updating&&null!=this._tileFetcher?
this._tileFetcher.expectedFeatureDiff:0}get memoryForUnusedFeatures(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}get maximumNumberOfFeaturesExceeded(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}get maximumNumberOfFeatures(){return this.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(C){C!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",C)}get hasMaximumNumberOfFeaturesOverride(){return this._isOverridden("maximumNumberOfFeatures")}get hasAllFeatures(){return this.serviceDataCount===
a.FeatureTileController3DConstants.noServiceDataCount&&"snapshot"===this.mode&&this.hasAllFeaturesInView||this.serviceDataCount===this.graphics.length}get hasAllFeaturesInView(){return this._tileFetcher?.hasAllFeatures??!1}get hasFullGeometries(){return this._tileFetcher?.hasFullGeometries??!1}get mode(){var C=this.layerView.layer;if("feature"===C.type&&null!=C.infoFor3D)return"snapshot";if(this._forceTilesMode)return"tiles";var E=this.layerView.view;if(!1===E.qualitySettings?.graphics3D?.snapshotAvailable||
this.serviceDataCount===a.FeatureTileController3DConstants.noServiceDataCount||this._snapshotLimitExceeded||this.maximumNumberOfFeaturesExceeded||1>E.quality)return"tiles";E=(E=E&&E.featureTiles)&&E.tilingScheme;return C&&C.minScale&&this.serviceDataExtent&&E&&(C=this._approximateExtentSizeAtScale(C.minScale,E),(this.serviceDataExtent.width/C+this.serviceDataExtent.height/C)/2>a.FeatureTileController3DConstants.maxSnapshotMinScaleFactor)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=
this.maximumNumberOfFeatures?"snapshot":"tiles"}get maxTotalSnapshotVertices(){const C=this._get("maxTotalSnapshotVertices")||0;return Math.max(C,"snapshot"===this.mode&&this._tileFetcher?.totalVertices||0)}_approximateExtentSizeAtScale(C,E){const I=this.layerView.view,H=E.levels[0];return(H.tileSize[0]/(H.scale/C)+H.tileSize[1]/(H.scale/C))/2*Math.ceil((I.width/E.pixelSize+I.height/E.pixelSize)/2)}get tileDescriptors(){const C=this.layerView.view.featureTiles;return"snapshot"===this.mode?new k([{id:"dummy-tile-full-extent",
lij:[0,0,0]}]):C?C.tiles:new k}get test(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}constructor(C){super(C);this.type="feature-tile-3d";this._updatingHandles=new p.UpdatingHandles;this.serviceDataExtent=null;this.serviceDataCount=a.FeatureTileController3DConstants.noServiceDataCount;this._snapshotLimitExceeded=!1;this.displayFeatureLimit=null;this._suspended=this._forceTilesMode=!1;this._fetchDataInfoAbortController=this._fetchDataInfoPromise=this._tileFetcher=
null;this._lifeCycleAbortController=new AbortController}initialize(){this._updatingHandles.add(()=>this.displayFeatureLimit,C=>this._updatingHandles.addPromise(this._updateSnapshotLimit(C,null,this._lifeCycleAbortController.signal)));this._updatingHandles.add(()=>this.mode,()=>this._modeChanged(),r.initial);this._updatingHandles.add(()=>this.mode,(C,E)=>{"tiles"===C&&"snapshot"===E&&(this._forceTilesMode=!0)},r.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>
this._updatingHandles.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))}_verifyCapabilities(){const C=this.layerView.layer;if("ogc-feature"!==C.type&&!q.getEffectiveLayerCapabilities(C)?.operations.supportsQuery)throw new g("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:C});}destroy(){this._cancelFetchServiceDataInfo();this._tileFetcher=c.destroyMaybe(this._tileFetcher);this._tilesHandle=c.removeMaybe(this._tilesHandle);
this._lifeCycleAbortController=c.abortMaybe(this._lifeCycleAbortController);this._updatingHandles.destroy();this._set("_updatingHandles",null)}suspend(){this._suspended||(this._suspended=!0,null!=this._tileFetcher&&this._tileFetcher.suspend())}resume(){this._suspended&&(this._suspended=!1,null!=this._tileFetcher&&this._tileFetcher.resume())}restart(){const C=()=>{null!=this._tileFetcher&&this._tileFetcher.restart()};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(C,C))}refetch(){this._refetch({resetForceTilesMode:!1})}getMissingAttributesForFeature(C){return this._tileFetcher?.getMissingAttributesForFeature(C)}_refetch(C){const E=
()=>{null!=this._tileFetcher&&(C.resetForceTilesMode&&(this._forceTilesMode=!1),this._tileFetcher.refetch())};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(E,E))}_initializeTileFetcher(){const C=this.layerView.view;if(C){var E=r.whenOnce(()=>C.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._updatingHandles.addPromise(E);E.then(()=>{const {layerView:I,tileDescriptors:H}=this,J=I.layer,B=new y.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,
tileDescriptors:H,features:this.graphics});this._tileFetcher=B;this._suspended?B.suspend():B.resume();const z=this.layerView.view;z&&this.addHandles(r.watch(()=>z.quality,L=>B.memoryFactor=L,r.syncAndInitial));const K="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;K&&this.addHandles(r.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[K],L=>B.lodFactor=L||1,r.initial));"ogc-feature"!==J.type&&this._updatingHandles.add(()=>
J.createQueryVersion,()=>this._dataFilterChanged());this._updatingHandles.add(()=>I.availableFields,(L,F)=>this._availableFieldsChanged(F,L));this._updatingHandles.add(()=>I.requiredFields,(L,F)=>this._requiredFieldsChanged(F,L));"customParameters"in J&&this._updatingHandles.add(()=>J.customParameters,()=>this.restart());this.addHandles([J.on("apply-edits",L=>this._applyEdits(L)),r.watch(()=>this.extent,L=>B.filterExtent=L,r.sync),r.watch(()=>this.tileDescriptors,L=>B.tileDescriptors=L,r.sync),r.watch(()=>
this.maximumNumberOfFeatures,L=>{B.maximumNumberOfFeatures=L;B.useTileCount=this.serviceDataCount>L},r.syncAndInitial),r.watch(()=>this.serviceDataCount,L=>{B.useTileCount=L>this.maximumNumberOfFeatures},r.syncAndInitial),r.watch(()=>G.debugFlags.FEATURE_TILE_FETCH_SHOW_TILES,L=>{L&&B&&!B.debugger?(B.debugger=new D.FeatureTileFetcher3DDebugger(B,z.featureTiles.tilingScheme.toTileInfo(),z),B.debugger.update()):!L&&this._tileFetcher&&B.debugger&&(B.debugger.destroy(),B.debugger=null)},r.syncAndInitial)]);
this._supportsExceedsLimitQuery||this._updatingHandles.add(()=>this.maxTotalSnapshotVertices,()=>this._updatingHandles.addPromise(this._updateSnapshotLimit(this.displayFeatureLimit,null,this._lifeCycleAbortController.signal)))}).catch(()=>{})}}_modeChanged(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:d.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case "snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),
this._tilesHandle=null)}}_dataFilterChanged(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this._refetch({resetForceTilesMode:!0})}_applyEdits(C){null!=this._tileFetcher&&this._tileFetcher.applyEdits(C).then(E=>{if(E){if(!this._lifeCycleAbortController)throw f.createAbortError();E.exceededTransferLimit?this.layerView.layer.refresh():(E.deletedFeatures.length||E.updatedFeatures.length||E.addedFeatures.length)&&this._updatingHandles.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(E=>
{if(!f.isAbortError(E))throw E;})}_availableFieldsChanged(C,E){null!=this._tileFetcher&&A(this._tileFetcher.availableFields,E)&&this._refetch({resetForceTilesMode:!1})}_requiredFieldsChanged(C,E){null!=this._tileFetcher&&A(this._tileFetcher.availableFields,E)&&this.restart()}_createVertexLimitExceededQuery(C){const E=this.layerView.layer,I=E.createQuery();I.returnGeometry=!1;I.outStatistics=[new v({statisticType:"exceedslimit",maxVertexCount:C,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,
maxRecordCount:1E8})];E.capabilities?.query.supportsCacheHint&&(I.cacheHint=!0);return I}_createDataInfoQuery(){const C=this.layerView.layer,E=C.createQuery();E.returnGeometry=!1;E.outSpatialReference=this.layerView.view.spatialReference;C.capabilities?.query.supportsCacheHint&&(E.cacheHint=!0);return E}_fullExtentIsAccurate(){const C=this.layerView.layer;if("definitionExpression"in C&&C.definitionExpression)return!1;switch(C.type){case "feature":case "oriented-imagery":return t.isHostedAgolService(C.url);
case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}}async _updateServiceDataExtent(C){try{await this._tryUpdateServiceDataExtent(C)}catch(E){f.isAbortError(E)||this._set("serviceDataExtent",e.clone(this.layerView.fullExtentInLocalViewSpatialReference))}}async _tryUpdateServiceDataExtent(C){var E=this.layerView;const I=E.layer,H=I.capabilities?.query.supportsExtent??!1,J=e.clone(E.fullExtentInLocalViewSpatialReference),B=I.fullExtent,z=this._fullExtentIsAccurate(),K=this.serviceDataCount;
H&&K<=a.FeatureTileController3DConstants.maxFeatureCountForExtent&&(!J||!z)&&"queryExtent"in I?(E=this._createDataInfoQuery(),C=await I.queryExtent(E,{timeout:a.FeatureTileController3DConstants.queryExtentTimeout,signal:C}),this._set("serviceDataExtent",C.extent)):J?this._set("serviceDataExtent",J):null!=B?(C=await u.projectGeometry(B,E.view.spatialReference,"portalItem"in I?I.portalItem:null,C),this._set("serviceDataExtent",C)):this._set("serviceDataExtent",null)}async _updateServiceDataCount(C){const E=
this.layerView.layer;if("queryFeatureCount"in E&&m("featurelayer-snapshot-enabled"))if(C=await h.result(E.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:C})),!0===C.ok)this._set("serviceDataCount",C.value);else{if(f.isAbortError(C.error))throw C.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.noServiceDataCount)}get _supportsExceedsLimitQuery(){const C=
this.layerView.layer;return null!=C.capabilities&&C.capabilities.operations&&C.capabilities.operations.supportsExceedsLimitStatistics}get _minimumNumberOfVerticesForGeometry(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}async _updateSnapshotLimit(C,E,I){if(null==C?.averageSymbolComplexity)this._snapshotLimitExceeded=!1;else{var {maximumTotalNumberOfVertices:H,
averageSymbolComplexity:J}=C,{verticesPerFeature:B,verticesPerCoordinate:z}=J;C=1<this._minimumNumberOfVerticesForGeometry;if(0>=B||C){0!==B&&null!=E&&await E;var K=Math.min(H,1E6);E=this.serviceDataCount;var L=E!==a.FeatureTileController3DConstants.noServiceDataCount;K=L?Math.ceil((K-E*B)/(z||1)):Math.ceil(K/(z||1));C&&(K=Math.min(K,5E6));if(L&&this._minimumNumberOfVerticesForGeometry*E>K)this._snapshotLimitExceeded=!0;else if(this._supportsExceedsLimitQuery&&m("featurelayer-snapshot-enabled"))if(I=
await h.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(K),{timeout:a.FeatureTileController3DConstants.queryStatisticsTimeout,signal:I})),!1===I.ok){if(f.isAbortError(I.error))throw I.error;this._snapshotLimitExceeded=!1}else I=I.value.features[0],this._snapshotLimitExceeded=I?.attributes?!!I.attributes.exceedslimit:!1;else this._snapshotLimitExceeded=this.maxTotalSnapshotVertices>K}else this._snapshotLimitExceeded=!1}}async _fetchServiceDataInfo(){this._cancelFetchServiceDataInfo();
let C=new AbortController;const E=C.signal;var I=this._updateServiceDataCount(E);I=Promise.allSettled([I,this._updateSnapshotLimit(this.displayFeatureLimit,I,E)]);const H=I.then(()=>this._updateServiceDataExtent(E)).catch(J=>{f.isAbortError(J)||d.getLogger(this).error("#fetchServiceDataInfo()",J)}).then(()=>{H===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);C=null});C&&(this._fetchDataInfoPromise=H);this._fetchDataInfoAbortController=C;return I.then(()=>
{},()=>{})}_cancelFetchServiceDataInfo(){const C=this._fetchDataInfoAbortController;C&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=null,C.abort())}get performanceInfo(){return{storedFeatures:this._tileFetcher?.storedFeatures??0,totalFeatures:this._tileFetcher?.totalFeatures??0,totalVertices:this._tileFetcher?.totalVertices??0,missingTiles:this._tileFetcher?.missingTiles??0}}};b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([x.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([x.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"context",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"dataUpdating",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"extent",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updating",
null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_updatingHandles",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([x.property()],
a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_snapshotLimitExceeded",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([x.property({type:Number})],
a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeatures",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasAllFeaturesInView",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"hasFullGeometries",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_forceTilesMode",void 0);b.__decorate([x.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"mode",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([x.property({readOnly:!0})],a.FeatureTileController3D.prototype,"tileDescriptors",null);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);b.__decorate([x.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);a.FeatureTileController3D=b.__decorate([w.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(C){C.noServiceDataCount=Infinity;C.maxSnapshotMinScaleFactor=5;C.reset=function(){C.maxFeatureCountForExtent=1E4;C.queryStatisticsTimeout=12E3;C.queryExtentTimeout=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/ReactiveMap ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(z){return"dummy-tile-full-extent"===z.id}function A(z){let K=0;for(const L of z)L.features&&0<L.features.length&&L.alive&&(K=Math.max(K,L.descriptor.lij[0]));return K}function C(z){z.setFeatures([],0,null,void 0);z.featuresMissing=!1;return v.FetchStatus.DONE}function E(z){return null==z?new Set:new Set(z.map(K=>K.name))}function I(z,K){if(null==z||null==K)return E(K);const L=new Set;for(const {name:F}of K)z.has(F)&&L.add(F);return L}
function H(z,K){if(!K?.length)return z;z??=new Map;const L=()=>new Set;for(const {objectId:F,attribute:M}of K)k.getOrCreateMapValue(z,F,L).add(M);return z}a.FeatureTileFetcher3D=class extends n{set maximumNumberOfFeatures(z){z=z||Infinity;const K=this._get("maximumNumberOfFeatures");z===K||1>z||(this._set("maximumNumberOfFeatures",z),this._maximumFeaturesUpdated(K,z))}set memoryFactor(z){this.memoryFactor!==z&&(this._set("memoryFactor",z),this._setDirty())}set lodFactor(z){this.lodFactor!==z&&(this._set("lodFactor",
z),this._supportsResolution&&this.refetch())}get useTileCount(){return this._useTileCount&&null!=this.context.query.queryFeatureCount}set useTileCount(z){this._useTileCount=z;this.notifyChange("useTileCount")}get updating(){return this._dirty||!!this._pendingEdits||this._isFetching||(this.tileDescriptors?.updating??!1)}get memoryForUnusedFeatures(){let z=0;this._featureTiles.forEach(K=>z+=K.estimatedUnusedSize);return z}get totalVertices(){let z=0;this._featureTiles.forEach(K=>z+=K.numVertices);return z}get totalFeatures(){let z=
0;this._featureTiles.forEach(K=>z+=K.numFeatures);return z}get hasAllFeatures(){if(this._paused||this.dataUpdating)return!1;for(const [,z]of this._featureTiles)if(!this.hasFullGeometries&&0!==z.emptyFeatureRatio||!z.hasAllFeatures)return!1;return!0}get hasFullGeometries(){return this._supportsResolution?!this.tileDescriptors.find(z=>null!=z.resolution)||!this.context.capabilities.supportsQuantization&&"polyline"!==this.context.geometryType:!0}set filterExtent(z){if(null!=z&&this.context.tilingScheme&&
!z.spatialReference.equals(this.context.tilingScheme.spatialReference))h.getLogger(this).error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var K=this._get("filterExtent");K===z||null!=K&&z&&K.equals(z)||(z=null!=z?z.clone():null,this._set("filterExtent",z),this._reclip(z,K))}}constructor(z){super(z);this.running=this.dataUpdating=this._useTileCount=!1;this.expectedFeatureDiff=this.updatingRemaining=this.updatingTotal=0;this.maximumNumberOfFeaturesExceeded=
!1;this._farRatio=this._fullRatio=1;this._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};this._frameTask=D.ImmediateTask;this._dirty=!1;this._featureTiles=new g;this._displayingFeatureReferences=new Map;this._numDisplayingFeatureReferences=0;this._suspended=!0;this._pendingEdits=null;this._isFetching=this._applyEditsTilesUpdated=!1}initialize(){this.addHandles(e.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{sync:!0,onListenerAdd:()=>this._setDirty()}));this._objectIdField=
this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?u.MultiFeatureReference:u.SingleFeatureReference;const z=this.context.scheduler;null!=z&&(this._frameTask=z.registerTask(D.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()}destroy(){this._frameTask.remove();this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._removeTile(z)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();
this._pendingEdits=null}get _paused(){return this._suspended||!!this._pendingEdits}restart(){this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._clearTile(z);this._resetFetchTile(z)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}refetch(){this._featureTiles.forEach(z=>{this._cancelFetchTile(z);this._resetFetchTile(z)});null!=this.context.memoryCache&&this.context.memoryCache.clear();this._setDirty()}suspend(){this._suspended||(this._suspended=!0,this._pause(),
this._setDirty())}resume(){this._suspended&&(this._suspended=!1,this._unpause())}getMissingAttributesForFeature(z){for(const [,K]of this._featureTiles){const L=K.missingAttributes?.get(z);if(null!=L)return L}}_pause(){this._paused&&(this._featureTiles.forEach(z=>this._cancelFetchTile(z)),this._updated())}_unpause(){this._paused||(this._setDirty(),this._updated())}get availableFields(){let z=null;this._featureTiles.forEach(K=>{null!=K.displayingFeatures&&0!==K.displayingFeatures.length&&(null==z?z=
new Set(K.availableFields):z.forEach(L=>{K.availableFields.has(L)||z.delete(L)}))});return null!=z?z:new Set}applyEdits(z){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const K=this._pendingEdits;K.count++;const L=K.edits.then(()=>z.result.catch(F=>{if(m.isAbortError(F))throw F;return null}).then(F=>{if(!F)return F;this._applyEditsDeleteFeatures(F.deletedFeatures);return this._applyEditsAddUpdateFeatures(F.addedFeatures,F.updatedFeatures,
K.controller.signal).then(()=>F)}).then(F=>{0===--K.count&&(this._pendingEdits===K&&(this._pendingEdits=null),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._applyEditsTilesUpdated=!1,this._unpause());return F}));K.edits=L;this._updated();return L}_applyEditsDeleteFeatures(z){if(0!==z.length){var K=this.context.globalIdField,L=K&&this.availableFields.has(K),F=new Set,M=this._objectIdField;z.forEach(({objectId:S,globalId:N})=>{(!S||0>S)&&K&&N&&(L||h.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${K} to be included the layer's outFields for updates to be reflected in the view`),
S=this._objectIdFromGlobalId(N,M,K));null!=S&&0<=S&&F.add(S)});this._featureTiles.forEach(S=>{if(S.features){var N=S.features.filter(P=>!F.has(w.getObjectId(P,this._objectIdField)));N.length!==S.features.length&&(this._applyEditsTileUpdated(),S.setFeatures(N,0,S.availableFields,S.missingAttributes),this._invalidateCounts())}})}}_objectIdFromGlobalId(z,K,L){if(null==z)return null;const F=this.features.find(M=>M.attributes?.[L]===z);return F?w.getObjectId(F,K):null}async _applyEditsAddUpdateFeatures(z,
K,L){const {objectIdField:F,globalIdField:M}=this.context,S=M&&this.availableFields.has(M),N=new Set,P=new Set;for(const O of z)z=O.objectId,null!=z&&N.add(z);for(const {objectId:O,globalId:T}of K)K=O,(null==K||0>K)&&M&&(S||h.getLogger(this).errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${M} to be included the layer's outFields for updates to be reflected in the view`),K=this._objectIdFromGlobalId(T,F,M)),null!=K&&0<=K&&(N.add(K),P.add(K));if(0!==N.size){var R=
[];this._featureTiles.forEach(O=>{(O=this._applyEditsAddUpdateTile(O,N,P,L))&&R.push(O)});this._updated();await Promise.allSettled(R)}}async _applyEditsAddUpdateTile(z,K,L,F){if(z.features){var M=this._createQuery(z);M.resultType=void 0;M.cacheHint=!1;M.objectIds=Array.from(K);K=await this._queryFeatures(M,F);F=null;0<L.size&&(M=z.features.filter(S=>!L.has(w.getObjectId(S,this._objectIdField))),M.length!==z.features.length&&(F=M));if(0<K.features.length){F||=z.features.slice();for(const S of K.features)F.push(S)}F&&
(z.hasPreciseFeatureCount&&(z.numFeatures=Math.max(z.numFeatures,F.length)),this._applyEditsTileUpdated(),z.setFeatures(F,0,I(z.availableFields,K.fields),H(z.missingAttributes,K.missingAttributes)),this._invalidateCounts())}}_applyEditsTileUpdated(){this._applyEditsTilesUpdated||(this._applyEditsTilesUpdated=!0,this._updated())}_queryFeatures(z,K){return this.context.query.queryFeaturesDehydrated(z,{signal:K,timeout:6E5})}_setDirty(){this._dirty=!0;this._updated()}runTask(z){const K=this._frameTask.processQueue(z);
if(!this._dirty||!this.initialized)return K;this._dirty=!1;const L=this._getListOfTiles();this._markTilesNotAlive(L);if(z.run(()=>this._addTiles(L,z))&&z.run(()=>this._filterExtentTiles(L,z))&&z.run(()=>this._removeTiles(L,z))&&!z.done){var F=this._sortTiles(L);z.run(()=>this._showTiles(F,z))&&z.run(()=>this._fetchTiles(F,z))&&z.run(()=>this._updateMemoryEstimates(F,z))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}_markTilesNotAlive(z){for(const K of z)K.alive=
!1}_addTiles(z,K){if(this._suspended||!this.tileDescriptors)return!1;this.tileDescriptors.forEach(L=>{const F=this._featureTiles.get(L.id);F?F.alive=!0:K.done||(z.push(this._addTile(L)),K.madeProgress())});return K.hasProgressed}_filterExtentTiles(z,K){for(const L of z){if(K.done)break;L.alive&&(L.filtered=!L.intersects(this.filterExtent),L.filtered&&(this._clearTile(L),K.madeProgress()))}return K.hasProgressed}_removeTiles(z,K){for(let L=z.length-1;0<=L&&!K.done;L--){const F=z[L];F.alive||(this._removeTile(F),
L!==z.length-1&&(z[L]=z[z.length-1]),z.pop(),K.madeProgress())}return K.hasProgressed}_sortTiles(z){z.sort((K,L)=>(K.descriptor.loadPriority??0)-(L.descriptor.loadPriority??0));return z}_showTiles(z,K){const L=this._updateRatio(z),F=M=>{const S=1>this._fullRatio?L(M)*this._farRatio:1;M.reduceFeatures(S,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(M)};for(const M of z)if(!K.run(()=>F(M))){this._setDirty();break}return K.hasProgressed}_fetchTiles(z,K){if(this._paused)return!1;
var L=!1;for(const M of z)if(M.needsFetching){var F=null!=this.context.memoryCache?this.context.memoryCache.pop(M.id):null;if(null!=F)M.cache=F,this._setDirty(),this._scheduleUpdated(),K.madeProgress();else if(this._needsNumFeatures(M)&&(L=new AbortController,F=this._fetchTileCount(M,L.signal),this._handleRequest(M,F,L,()=>M.numFeatures=v.failedFeatureCount),L=!0,K.madeProgress()),K.done)return!0}if(L)return K.hasProgressed;for(const M of z)if(M.needsFetching&&(z=new AbortController,L=this._fetchTile(M,
z.signal),this._handleRequest(M,L,z,S=>{M.setFeatures([],0,null,void 0);this._invalidateCounts();M.featuresMissing=!1;M.fetchFailed=!0;this.context.logFetchError(h.getLogger(this),S)}),K.madeProgress()))return!0;return K.hasProgressed}_updateMemoryEstimates(z,K){z.some(L=>K.run(()=>L.updateMemoryEstimates())?!1:(this._setDirty(),!0));return K.hasProgressed}_reclip(z,K){if(this.initialized){var L=[];this._featureTiles.forEach(F=>{null!=F.displayingFeatures&&0!==F.displayingFeatures.length&&(F.intersectionIncludingBorrowed(K,
J),F.intersectionIncludingBorrowed(z,B),x.equals(J,B)||L.push(F))});this._refreshDisplayingFeatures(L);this._updated()}}_refreshDisplayingFeatures(z){const K=new Set,L=this._changes.updates;for(const F of z)if(null!=F.displayingFeatures)for(const M of F.displayingFeatures)z=w.getObjectId(M,this._objectIdField),K.has(z)||(K.add(z),z=this._displayingFeatureReferences.get(z).feature,L.removes.push(z),L.adds.push(z));this._applyChanges()}_updated(){let z=0;this._paused||this._featureTiles.forEach(K=>
K.isFetching?++z:0);this._isFetching=0<z;this._set("running",this._dirty);0<z||this._applyEditsTilesUpdated?this._set("dataUpdating",!0):this._dirty||this._set("dataUpdating",!1);if(this.updating){let K=0,L=0,F=0,M=0,S=0;const N=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(O=>{++L;if(O.isFetching&&O.hasPreciseFeatureCount){const T=this._maximumFeaturesForTile(O)*(1-O.emptyFeatureRatio);S+=T-(null!=O.displayingFeatures?O.displayingFeatures.length*
N:0)}O.needsFetching?++M:0<O.numFeatures&&(++F,K+=O.numFeatures)});M+=z;let P=0,R=0;K?(R=K,P=Math.min(M*K/F,K)):(R=L,P=M);S=Math.min(this.maximumNumberOfFeatures-this.features.length,S);this._set("updatingTotal",R);this._set("updatingRemaining",P);this._set("expectedFeatureDiff",S)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}_updateMaximumNumberOfFeaturesExceeded(){const z=k.someMap(this._featureTiles,
K=>K.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",z)}_updateRatio(z){const K=A(z),L=S=>1/(1<<Math.max(0,K-S.descriptor.lij[0]));let F=0,M=0;for(const S of z)z=S.numFeatures,F+=z,M+=z*L(S);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/F);this._farRatio=this.maximumNumberOfFeatures/M;this._scheduleUpdated();return L}_maximumFeaturesUpdated(z,K){z!==K&&(K>z&&this._featureTiles.forEach(L=>{if(L.featuresMissing){var F=this._maximumFeaturesForTile(L);L.features&&
(L.features.length>=F||L.fetchStatus===v.FetchStatus.FULL)||(this._cancelFetchTile(L),this._resetFetchTile(L))}}),this._setDirty())}_addTile(z){z=new v.FeatureTile(z);this._featureTiles.set(z.id,z);this._resetFetchTile(z);this._referenceDisplayingFeaturesFromRelatedTiles(z);return z}_referenceDisplayingFeaturesFromRelatedTiles(z){const K=z.descriptor.resolution;this._featureTiles.forEach(L=>{if(!(null==L.displayingFeatures||z===L||z.descriptor.lij&&L.descriptor.lij&&!y.tilesAreRelated(z.descriptor.lij,
L.descriptor.lij))){null==z.displayingFeatures&&(z.displayingFeatures=[]);z.descriptor.extent&&L.descriptor.extent&&(null==z.extentIncludingBorrowedFeatures&&(z.extentIncludingBorrowedFeatures=x.clone(z.descriptor.extent)),x.expand(z.extentIncludingBorrowedFeatures,L.descriptor.extent,z.extentIncludingBorrowedFeatures));for(const F of L.displayingFeatures)z.displayingFeatures.push(F),L=this._displayingFeatureReferences.get(w.getObjectId(F,this._objectIdField)),L.ref(L.feature,K),this._numDisplayingFeatureReferences++}});
z.featureLimit=null!=z.displayingFeatures?z.displayingFeatures.length:0}_removeTile(z){this._clearTile(z);this._featureTiles.delete(z.id)}_resetFetchTile(z){z.filtered=!z.intersects(this.filterExtent);z.filtered?z.needsFetching&&(z.fetchStatus=v.FetchStatus.DONE):z.fetchStatus=v.FetchStatus.FETCH_NEEDED}_cancelFetchTile(z){const K=z.requestController;null!=K&&(z.requestController=null,z.resetFetching(),K.abort())}async _fetchTileCount(z,K){z.numFeatures=await this._fetchCount(z,K);this._updateRatio(this._getListOfTiles());
return z.fetchStatus===v.FetchStatus.REFETCHING?v.FetchStatus.REFETCH_NEEDED:v.FetchStatus.FETCH_NEEDED}async _fetchTile(z,K){z.fetchFailed=!1;var L=this._maximumFeaturesForTile(z);if(0>=L)return z.hasPreciseFeatureCount&&0===z.numFeatures||(z.fetchFailed=!0),C(z);const F=this._getMaxRecordCount(z);var M=Math.ceil(L/F);if(G(z)||!this.context.capabilities.supportsMaxRecordCountFactor||z.numFeatures<=L&&M>t.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(z,K);M=this._createQuery(z);M.maxRecordCountFactor=
Math.ceil(L/F);z.isRefetching&&z.features&&0<z.features.length&&(M.maxRecordCountFactor=Math.max(Math.ceil(z.features.length/(1-z.emptyFeatureRatio)/F)+1,M.maxRecordCountFactor));const {features:S,exceededTransferLimit:N,fields:P,missingAttributes:R}=await this._queryFeatures(M,K);L=N?M.maxRecordCountFactor>=t.MAX_MAX_RECORD_COUNT_FACTOR?v.FetchStatus.FULL:v.FetchStatus.DONE:v.FetchStatus.FULL;await this._frameTask.schedule(()=>{z.featuresMissing=z.hasPreciseFeatureCount&&S.length<z.numFeatures||
!!N;const O=this._removeEmptyFeatures(S);z.setFeatures(S,O,E(P),H(void 0,R))},K);m.throwIfAborted(K);this._invalidateCounts();return L}async _fetchCount(z,K){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(z),{signal:K})}async _fetchPagedTile(z,K){let L=0,F=0,M,S=0,N=this._maximumFeaturesForTile(z)-S;const P=this._getMaxRecordCount(z);let R=null,O;for(;;){const T=this._createQuery(z),Q=this._setPagingParameters(T,L,N,P),{features:V,exceededTransferLimit:U,fields:W,missingAttributes:ca}=
await this._queryFeatures(T,K);await this._frameTask.schedule(()=>{Q&&(L+=T.num);S+=V.length;F+=this._removeEmptyFeatures(V);z.featuresMissing=Q&&z.hasPreciseFeatureCount&&L<z.numFeatures||!!U;M=M?M.concat(V):V;R=I(R,W);O=H(O,ca);z.setFeatures(M,F,R,O)},K);m.throwIfAborted(K);this._invalidateCounts();this._setDirty();N=this._maximumFeaturesForTile(z)-S;if(!Q||!U||0>=N)return U?v.FetchStatus.DONE:v.FetchStatus.FULL}}_createFeatureCountQuery(z){z=this._createQuery(z);this.context.capabilities.supportsCacheHint&&
(z.resultType=void 0,z.cacheHint=!0);return z}_createQuery(z){const K=this.context.createQuery(),L=z.descriptor.extent;L&&(K.geometry=x.toExtent(L,this.context.tilingScheme.spatialReference));this._setResolutionParams(K,z);this._useTileQuery(z)?K.resultType="tile":this.context.capabilities.supportsCacheHint&&(K.cacheHint=!0);return K}_setPagingParameters(z,K,L,F){if(!this.context.capabilities.supportsPagination)return!1;z.start=K;0<L&&this.context.capabilities.supportsMaxRecordCountFactor?(z.maxRecordCountFactor=
Math.ceil(L/F),z.num=Math.min(z.maxRecordCountFactor*F,L)):z.num=Math.min(F);return!0}_getEffectiveTileResolution(z){if(null==z.descriptor.resolution)return null;const K=this.context.viewingMode===q.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(z.descriptor.resolution,K)/this.lodFactor}get _supportsResolution(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}_setResolutionParams(z,K){this._supportsResolution&&
(K=this._getEffectiveTileResolution(K),null!=K&&(this.context.capabilities.supportsQuantization?z.quantizationParameters=new p({mode:"view",originPosition:"upper-left",tolerance:K,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(z.maxAllowableOffset=K)))}_removeEmptyFeatures(z){const K=z.length;for(let L=0;L<z.length;)w.hasVertices(z[L].geometry)?++L:(z[L]=z[z.length-1],--z.length);return K-z.length}_needsNumFeatures(z){return this.useTileCount&&z.needsFeatureCount&&!G(z)}_getMaxRecordCount(z){const {tileMaxRecordCount:K,
maxRecordCount:L}=this.context;return this._useTileQuery(z)&&null!=K&&0<K&&this.context.capabilities.supportsResultType?K:null!=L&&0<L?L:2E3}_useTileQuery(z){return G(z)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType}_handleRequest(z,K,L,F){z.fetchStatus=z.needsRefetching?v.FetchStatus.REFETCHING:v.FetchStatus.FETCHING;z.requestController=L;let M=!1;K.then(S=>{z.requestController=null;z.fetchStatus=S}).catch(S=>{z.requestController===L&&(z.requestController=
null,z.fetchStatus=v.FetchStatus.DONE);m.isAbortError(S)?M=!0:F(S)}).then(()=>{M||this._setDirty();this._scheduleUpdated()})}_scheduleUpdated(){this.hasHandles("scheduleUpdated")||this.addHandles(d.schedule(()=>{this.removeHandles("scheduleUpdated");this._updated()}),"scheduleUpdated")}_showTile(z){if(null!=z.displayingFeatures&&!z.needsDisplayUpdate)return!1;var K=z.features;if(0===z.featureLimit||!K)return K=null!=z.displayingFeatures&&0<z.displayingFeatures.length,this._hideTileFeatures(z),z.displayingFeatures=
[],K;const L=z.descriptor.resolution,F=this._changes.updates,M=this._changes.adds,S=Math.min(z.featureLimit,K.length);z.featureLimit=S;for(let P=0;P<S;++P){var N=K[P];const R=w.getObjectId(N,this._objectIdField),O=this._displayingFeatureReferences.get(R);O?(N=O.ref(N,L),N.oldVersion!==N.newVersion&&(N.oldVersion&&F.removes.push(N.oldVersion),N.newVersion&&F.adds.push(N.newVersion))):(this._displayingFeatureReferences.set(R,new this.FeatureReferenceClass(N,L)),M.push(N));this._numDisplayingFeatureReferences++}this._hideTileFeatures(z);
this._applyChanges();z.displayingFeatures=K.slice(0,S);return!0}_hideTile(z){this._cancelFetchTile(z);this._hideTileFeatures(z)}_hideTileFeatures(z){if(null!=z.displayingFeatures){var K=this._changes.updates,L=this._changes.removes;for(const M of z.displayingFeatures){const S=w.getObjectId(M,this._objectIdField);var F=this._displayingFeatureReferences.get(S);F&&((F=F.unref(z.descriptor.resolution),this._numDisplayingFeatureReferences--,F)?F.oldVersion!==F.newVersion&&(null==F.newVersion?(this._displayingFeatureReferences.delete(S),
F.oldVersion&&L.push(F.oldVersion)):(K.adds.push(F.newVersion),F.oldVersion&&K.removes.push(F.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();z.displayingFeatures=null}}_applyChanges(){var z=this._changes.updates;0<z.removes.length&&(this.features.removeMany(z.removes),z.removes.length=0);0<z.adds.length&&(this.features.addMany(z.adds),z.adds.length=0);z=this._changes.adds;const K=this._changes.removes,L=Math.min(z.length,K.length);let F=0;for(;F<L;){const M=Math.min(F+
200,L);this.features.addMany(z.slice(F,M));this.features.removeMany(K.slice(F,M));F=M}z.length>L&&this.features.addMany(0===F?z:z.slice(F));K.length>L&&this.features.removeMany(0===F?K:K.slice(F));z.length=0;K.length=0}_clearTile(z){this._hideTile(z);z.features&&null!=this.context.memoryCache&&this.context.memoryCache.put(z.id,z.cache,16+z.estimatedSize);z.setFeatures(null,0,null,void 0);this._invalidateCounts()}_invalidateCounts(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");
this.notifyChange("memoryForUnusedFeatures")}_getListOfTiles(){return Array.from(this._featureTiles.values())}get storedFeatures(){return this._getListOfTiles().reduce((z,K)=>z+(K.features?K.features.length:0),0)}get missingTiles(){return Array.from(this._featureTiles.values()).reduce((z,K)=>z+(K.needsFetching||K.isFetching?1:0),0)}_maximumFeaturesForTile(z){const K=z.hasPreciseFeatureCount?z.numFeatures:Infinity;return Math.min(Math.ceil((z.hasPreciseFeatureCount?K:this.maximumNumberOfFeatures)*
(1>this._fullRatio?this._farRatio:1)/(1-z.emptyFeatureRatio)),K)}get test(){return{process:z=>this.runTask(z),getFeatureTileById:z=>this._featureTiles.get(z),forEachFeatureTile:z=>this._featureTiles.forEach(z)}}};b.__decorate([c.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([c.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",
null);b.__decorate([c.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);b.__decorate([c.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"dataUpdating",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"running",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasAllFeatures",null);b.__decorate([c.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"hasFullGeometries",null);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",
null);b.__decorate([c.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"_dirty",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"_suspended",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"_pendingEdits",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"_applyEditsTilesUpdated",void 0);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,
"_paused",null);b.__decorate([c.property()],a.FeatureTileFetcher3D.prototype,"_isFetching",void 0);a.FeatureTileFetcher3D=b.__decorate([r.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const J=x.create(),B=x.create();a.contextCapabilitiesFromLayer=function(z){const K=z.capabilities.query;a:switch(z.geometryType){case "polyline":z=!0;break a;case "polygon":z=z.capabilities&&z.capabilities.query&&z.capabilities.query.supportsQuantization;break a;default:z=!1}return{supportsMultipleResolutions:z,
supportsPagination:!(!K||!K.supportsPagination),supportsResultType:!(!K||!K.supportsResultType),supportsCacheHint:!(!K||!K.supportsCacheHint),supportsQuantization:!(!K||!K.supportsQuantization),supportsQuantizationEditMode:!(!K||!K.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!K||!K.supportsMaxRecordCountFactor),supportsFormatPBF:!(!K||!K.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w{get isReferenced(){return 0!==this.versions.length}get isSingle(){return 1===this.versions.length&&1===this.versions[0].refCount}constructor(q,u){this._highestResolutionVersion=null;this.versions=[];this.ref(q,u)}ref(q,u){const v=this.feature;t.oldVersion=v;this.feature&&Object.defineProperty(q,"uid",{value:this.feature.uid,configurable:!0});for(var y of this.versions)if(y.resolution===u){y.refCount++;if((u=this._highestResolutionVersion===y&&!x.equals(q,
y.feature))||this._highestResolutionVersion!==y)y.feature=q;t.newVersion=u?q:v;return t}y={feature:q,resolution:u,refCount:1};this.versions.push(y);!this._highestResolutionVersion||u<this._highestResolutionVersion.resolution?(t.newVersion=q,this._highestResolutionVersion=y):t.newVersion=v;return t}unref(q){for(let u=0;u<this.versions.length;u++){const v=this.versions[u];if(v.resolution===q)return v.refCount--,t.oldVersion=this.feature,0===v.refCount&&(this.versions[u]=this.versions[this.versions.length-
1],this.versions.length--,this._highestResolutionVersion===v&&(this._recalculateHighestResolutionVersion(),t.oldVersion=v.feature)),t.newVersion=this.feature,t}return null}get feature(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}_recalculateHighestResolutionVersion(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var q=this.versions[0];for(let u=1;u<this.versions.length;u++){const v=this.versions[u];v.resolution<q.resolution&&(q=v)}this._highestResolutionVersion=
q}}}class p{get isReferenced(){return 0!==this._refCount}get isSingle(){return 1===this._refCount}constructor(q){this._feature=q;this._refCount=1}ref(q){++this._refCount;t.oldVersion=this._feature;this.feature&&Object.defineProperty(q,"uid",{value:this.feature.uid,configurable:!0});x.equals(this._feature,q)||(this._feature=q);t.newVersion=this._feature;return t}unref(){t.oldVersion=this._feature;if(0<this._refCount&&(this._refCount--,!this.isReferenced))return t.newVersion=null,t;t.newVersion=this._feature;
return t}get feature(){return this._feature}}const t={oldVersion:null,newVersion:null};a.MultiFeatureReference=w;a.SingleFeatureReference=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define(["exports","../../../../core/arrayUtils","../../../../core/signal","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(a,b,n,h,k){const m=new Set;class g{get featuresMissing(){return this._featuresMissing.value}set featuresMissing(d){this._featuresMissing.value=
d}get missingAttributes(){return this._missingAttributes}get fetchFailed(){return this._fetchFailed.value}set fetchFailed(d){this._fetchFailed.value=d}get displayingFeatures(){return this._displayingFeatures}set displayingFeatures(d){this._displayingFeatures=d;this.extentIncludingBorrowedFeatures=null}get perTileMaximumNumberOfFeaturesExceeded(){const d=(this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL)&&this.featuresMissing;return!this.filtered&&(d||this.hasFeatureLimit)}get features(){return this._features}get featureLimit(){return this._featureLimit.value}set featureLimit(d){this._featureLimit.value!==
d&&(this._featureLimit.value=d,this._estimatedUnusedSizeDirty=!0)}get hasFeatureLimit(){return this.featureLimit!==this._featuresLength.value}get hasAllFeatures(){return!(this.featuresMissing||this.fetchFailed||this.hasFeatureLimit)}get availableFields(){return this._availableFields}setFeatures(d,c,l,f){this._availableFields=l??m;this._features=d;this._featuresLength.value=d?.length??0;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;this._missingAttributes=f;d&&0<d.length?
(this._emptyFeatureRatio.value=c/(d.length+c),this._numVertices=d.reduce((r,x)=>r+k.numVertices(x.geometry),0)):this._numVertices=this._emptyFeatureRatio.value=0}get emptyFeatureRatio(){return this._emptyFeatureRatio.value}get numFeatures(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0}set numFeatures(d){this._numFeatures=d}get hasPreciseFeatureCount(){return-1<this._numFeatures}get needsFeatureCount(){return-1===this._numFeatures}get numVertices(){return this._numVertices}constructor(d){this.descriptor=
d;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featuresLength=n.signal(0);this._numVertices=0;this._featureLimit=n.signal(0);this._featuresMissing=n.signal(!0);this._fetchFailed=n.signal(!1);this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=n.signal(0);this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=m;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}get id(){return this.descriptor.id}get estimatedSize(){this.updateMemoryEstimates();
return this._estimatedSize}get estimatedUnusedSize(){return this._estimatedUnusedSize}updateMemoryEstimates(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var d=0;d<this._features.length;++d){const c=k.estimateSize(this._features[d]);this._estimatedSize+=c;d>=this.featureLimit&&(this._estimatedUnusedSize+=c)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(d=this.featureLimit;d<
this._features.length;++d)this._estimatedUnusedSize+=k.estimateSize(this._features[d]);return!0}return!1}get isFetching(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}get isRefetching(){return this.fetchStatus===a.FetchStatus.REFETCHING}get needsFetching(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get needsRefetching(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}get isFetched(){return this.fetchStatus===
a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}resetFetching(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED}get needsDisplayUpdate(){var d;if(d=!!this._features){a:{d=this._features;var c=this.displayingFeatures,l=this.featureLimit;if(null==c||null==d||l!==c.length||l>d.length)d=!1;else{for(let f=0;f<l;++f)if(d[f]!==c[f]){d=!1;break a}d=!0}}d=!d}return d}intersects(d){if(null==d||!this.descriptor.extent)return!0;h.fromExtent(d,
e);return h.intersects(this.descriptor.extent,e)}intersectionIncludingBorrowed(d,c){const l=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!d&&!l)return h.copy(c,h.positiveInfinity),c;null!=d?(h.fromExtent(d,c),h.intersection(c,l,c)):h.copy(c,l);return c}_shuffle(d){this._features&&(this._features.sort((c,l)=>k.getObjectId(c,d)-k.getObjectId(l,d)),b.shuffle(this._features,16438),this._estimatedUnusedSizeDirty=this._shuffled=!0)}reduceFeatures(d,
c,l){if(0>=d)return!1;if(!this._features)return this.featureLimit=0,!1;let f=!1;this.featureLimit=Math.ceil(this.numFeatures*d);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,f=!0));!this._shuffled&&1>d&&this._shuffle(l);d=Math.max(this.featureLimit,Math.ceil(c*this.numFeatures));this._features.length>d&&(this._features.length=d,this._featuresLength.value=
d,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return f}get cache(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio.value,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}}set cache(d){this.requestController=null;this._availableFields=d.availableFields;this._features=d.features;this._featuresLength.value=d.features?.length??0;this._numFeatures=
d.numFeatures;this._emptyFeatureRatio.value=d.emptyFeatureRatio;this.fetchStatus=d.fetchStatus;this.featuresMissing=d.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}a.FetchStatus=void 0;(function(d){d[d.FETCH_NEEDED=0]="FETCH_NEEDED";d[d.REFETCH_NEEDED=1]="REFETCH_NEEDED";d[d.FETCHING=2]="FETCHING";d[d.REFETCHING=3]="REFETCHING";d[d.DONE=4]="DONE";d[d.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const e=h.create();a.FeatureTile=g;a.failedFeatureCount=-2;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../Graphic ../../../../symbols ../../../../core/Collection ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../../../symbols/support/Symbol3DVerticalOffset ../../terrain/TilingScheme ../../../../symbols/callouts/LineCallout3D".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){const r=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];class x{constructor(w,p,t){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=w;this._view=t;this._tilingScheme=new l.TilingScheme(p);
this._loadedSymbols=r.map(q=>new e({symbolLayers:new h([new m({material:{color:[q[0],q[1],q[2],.6]},outline:{color:"black",size:1}})])}));this._loadingSymbols=[new e({symbolLayers:new h([new m({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}})])})];this._pendingSymbols=[new e({symbolLayers:new h([new m({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}})])})];this._dataExtentSymbol=new e({symbolLayers:new h([new m({material:{color:[0,0,0,0]},outline:{color:"green",
size:4}})])})}destroy(){this.enabled=!1}get enabled(){return this._enabled}set enabled(w){this._enabled=w;this.update()}update(){this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:w=>w.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:w=>!w.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:w=>!w.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(w=>
{this._view.graphics.removeMany(w)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(w=>{this._view.graphics.removeMany(w)}),this._loadedGraphics.clear(),this._pendingGraphics.forEach(w=>{this._view.graphics.removeMany(w)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}showDataExtent(w){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);null!=
w&&(w=k.fromExtent(w),this._dataExtentGraphic=new b({geometry:w,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))}_synchronizeMaps(w,p){const t=[];w.forEach((q,u)=>{const v=this._tileFetcher.test.getFeatureTileById(u);v&&p.filter(v)||(this._view.graphics.removeMany(q),t.push(u))});t.forEach(q=>w.delete(q));this._tileFetcher.test.forEachFeatureTile(q=>{if(p.filter(q)&&!w.has(q.id)){const [y,D,G]=q.descriptor.lij;this._tilingScheme.ensureMaxLod(y);var u=this._tilingScheme.getExtentGeometry(y,
D,G),v=new b({geometry:u,symbol:p.symbols[y%p.symbols.length]});u=new b({geometry:u.center,symbol:new g({verticalOffset:new c({screenLength:40/.75}),callout:new f({color:"white",border:{color:"black"}}),symbolLayers:new h([new d({text:`${y}/${D}/${G}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})])})});v=[v,u];w.set(q.id,v);this._view.graphics.addMany(v)}})}}a.FeatureTileFetcher3DDebugger=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerViewPerformanceInfo":function(){define(["exports",
"./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(h,k,m,g,e,d){super(h.usedMemory,h.displayedFeatures,h.totalFeatures,h.maximumFeatures,h.nodes,h.core);this.storedFeatures=k;this.totalVertices=m;this.partial=g;this.mode=e;this.symbolComplexity=d}}a.FeatureLayerViewPerformanceInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/LayerViewPerformanceInfo ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G){var A;(function(C){C[C.NONE=0]="NONE";C[C.CONTROLLER=1]="CONTROLLER";C[C.CORE=2]="CORE"})(A||={});a.FeatureLikeLayerView3D=C=>{C=class extends C{constructor(){super(...arguments);this._dataUpdatingState=A.NONE;this.controller=null;this.updatePolicy=D.UpdatePolicy.SYNC;this.suspendResumeExtentMode="computed";this.slicePlaneEnabled=!1;this.suspendResumeExtent=this.fullExtentInLocalViewSpatialReference=null;this._controllerCreated=!1;this.supportsHeightUnitConversion=
!0;this.queryEngine=this._pendingController=null}initialize(){const E=this.layer;if("isTable"in E&&E.isTable)this.addResolvingPromise(Promise.reject(new n("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:E})));else{this.addResolvingPromise(this._validateGeometryType());this._updatingHandles.add(()=>this.layer.renderer,H=>this._recreateProcessor(H),k.initial);this.addResolvingPromise((async()=>{this.fullExtentInLocalViewSpatialReference=await y.toViewIfLocal(this);
await this._initializeController()})());this._updatingHandles.add(()=>this.updatePolicy,H=>this.processor.preferredUpdatePolicy=H);var I=()=>this.processor.featureStore;this.queryEngine=new t.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return I()},hasZ:this.hasZ,hasM:this.hasM},priority:G.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}}destroy(){this._destroyPendingController();
this.controller=h.destroyMaybe(this.controller);this._set("processor",h.destroyMaybe(this.processor));this.queryEngine=h.destroyMaybe(this.queryEngine);this.loadedGraphics=null}_destroyPendingController(){this._pendingController=h.destroyMaybe(this._pendingController)}get dataUpdating(){return this._dataUpdatingState!==A.NONE}get legendEnabled(){return this.canResume()&&this.processor?.legendEnabled}get graphics3DProcessor(){return"graphics-3d"===this.processor?.type?this.processor:null}get heatmapProcessor(){return"heatmap"===
this.processor?.type?this.processor:null}get symbologySnappingSupported(){return this.layer?.renderer?.getSymbols()?.some(x.symbolHasExtrudeSymbolLayer)??!1}get hasAllFeatures(){return this.controller&&"hasAllFeatures"in this.controller?this.controller.hasAllFeatures:!1}get hasAllFeaturesInView(){return this.controller&&"hasAllFeaturesInView"in this.controller?this.controller.hasAllFeaturesInView:!1}get hasFullGeometries(){return this.controller&&"hasFullGeometries"in this.controller?this.controller.hasFullGeometries:
!1}getHit(E){let I;this.loadedGraphics?.forEach(H=>{H.uid===E&&(I=l.hydrateGraphic(H,this.layer))});return I?{type:"graphic",graphic:I,layer:I.layer}:null}whenGraphicBounds(E,I){return this.processor?.whenGraphicBounds(E,I)}computeAttachmentOrigin(E,I){return this.processor?.computeAttachmentOrigin(E,I)}async elevationAlignPointsInFeatures(E,I){const H=this.graphics3DProcessor;if(null==H)throw new n("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");
return w.elevationAlignPointsInFeatures(this.view,this.layer,J=>H.getGraphics3DGraphicByObjectId(J),E,I)}async queryForSymbologySnapping(E,I){return this.symbologySnappingSupported?q.queryForSymbologySnapping(this.graphics3DProcessor,E,I):{candidates:[],sourceCandidateIndices:[]}}queryFeatures(E,I){return this.queryEngine.executeQuery(this._ensureQuery(E),I?.signal)}queryObjectIds(E,I){return this.queryEngine.executeQueryForIds(this._ensureQuery(E),I?.signal)}queryFeatureCount(E,I){return this.queryEngine.executeQueryForCount(this._ensureQuery(E),
I?.signal)}queryExtent(E,I){return this.queryEngine.executeQueryForExtent(this._ensureQuery(E),I?.signal)}_ensureQuery(E){return null==E?this.createQuery():r.from(E)}highlight(E){return this.processor.highlight(E,this.layer.objectIdField)}maskOccludee(E){return this.processor.maskOccludee(E)}canResume(){return super.canResume()&&!this.processor?.scaleVisibilitySuspended}getSuspendInfo(){const E=super.getSuspendInfo();return this.processor?{...E,...this.processor.suspendInfo}:E}isUpdating(){return!this.processor||
this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)}async _initializeController(){const E=this.createController();this._pendingController=E;this._setupDataUpdating(E);await E.when();this._setControllerWhenInitialized(E)}_setupDataUpdating(E){"dataUpdating"in E&&this.addHandles([k.watch(()=>E.dataUpdating,I=>{I&&this._dataUpdatingState===A.NONE?this._dataUpdatingState=A.CONTROLLER:I||this._dataUpdatingState!==
A.CONTROLLER||(this._dataUpdatingState=A.NONE)},k.sync),k.watch(()=>!!this.graphics3DProcessor?.dataUpdating,I=>{I&&this._dataUpdatingState===A.CONTROLLER?this._dataUpdatingState=A.CORE:I||this._dataUpdatingState!==A.CORE||(this._dataUpdatingState=E.dataUpdating?A.CONTROLLER:A.NONE)},k.sync)])}async _setControllerWhenInitialized(E){try{await this.when()}catch(I){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(await k.whenOnce(()=>
this.view?.basemapTerrain?.ready),this.beforeSetController(E),this._pendingController=null,this.controller=E,this.loadedGraphics=E.graphics,this.notifyChange("updating"))}_updateClippingExtent(E){this.clippingExtent=E;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=E,!0}}async _validateGeometryType(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new n("featurelayerview3d:unsupported-geometry-type",
"Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}}_recreateProcessor(E){var I="heatmap"===E?.type;const H="heatmap"===this.processor?.type;E=this.processor;E&&I===H||(I=I?new u.HeatmapFeatureProcessor({owner:this}):new p.Graphics3DFeatureProcessor({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,
updateClippingExtent:J=>this._updateClippingExtent(J)}),this._set("processor",I),E?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(I.initializePromise))}get performanceInfo(){const E=this.controller instanceof f.FeatureTileController3D?this.controller:null;return new v.LayerViewPerformanceInfo(this.processor.usedMemory,this.loadedGraphics?.length,E?.serviceDataCount??-1,E?.maximumNumberOfFeatures??-1,0,this.processor.performanceInfo)}};b.__decorate([m.property()],C.prototype,"loadedGraphics",
void 0);b.__decorate([m.property()],C.prototype,"_dataUpdatingState",void 0);b.__decorate([m.property({readOnly:!0})],C.prototype,"dataUpdating",null);b.__decorate([m.property()],C.prototype,"suspended",void 0);b.__decorate([m.property({readOnly:!0})],C.prototype,"legendEnabled",null);b.__decorate([m.property()],C.prototype,"updating",void 0);b.__decorate([m.property()],C.prototype,"controller",void 0);b.__decorate([m.property()],C.prototype,"processor",void 0);b.__decorate([m.property({readOnly:!0})],
C.prototype,"updatePolicy",void 0);b.__decorate([m.property({readOnly:!0})],C.prototype,"suspendResumeExtentMode",void 0);b.__decorate([m.property({type:Boolean})],C.prototype,"slicePlaneEnabled",void 0);b.__decorate([m.property({readOnly:!0})],C.prototype,"suspendInfo",void 0);b.__decorate([m.property()],C.prototype,"graphics3DProcessor",null);b.__decorate([m.property()],C.prototype,"heatmapProcessor",null);b.__decorate([m.property()],C.prototype,"symbologySnappingSupported",null);b.__decorate([m.property({readOnly:!0})],
C.prototype,"hasAllFeatures",null);b.__decorate([m.property({readOnly:!0})],C.prototype,"hasAllFeaturesInView",null);b.__decorate([m.property({readOnly:!0})],C.prototype,"hasFullGeometries",null);return C=b.__decorate([c.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],C)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../geometry ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectPointToVector ../../../../layers/graphics/dehydratedPoint ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.elevationAlignPointsInFeatures=async function(f,r,x,w,p){const {elevationProvider:t,renderCoordsHelper:q}=f,{elevationInfo:u}=r,{pointsInFeatures:v,spatialReference:y}=w;var D=l.fromJSON(y);w=c.extractExpressionInfo(u,!0);w=await c.createContext(w,D,p);n.throwIfAborted(p);const G=[],A=new Set,C=new Set,E=new d.ElevationContext,I=m.makeDehydratedPoint(0,0,0,l.WGS84),H=new e.SampleElevationInfo,J=h.create();I.spatialReference=D;f=f.elevationProvider.spatialReference??
f.spatialReference;for(const {objectId:B,points:z}of v)if(D=x(B),null==D){for(const K of z)G.push(K.z??0);A.add(B)}else{D.isDraped&&C.add(B);E.setFromElevationInfo(g.getGeometryEffectiveElevationInfo(D.graphic.geometry,u));E.updateFeatureExpressionInfoContext(w,D.graphic,r);for(const {x:K,y:L,z:F}of z)I.x=K,I.y=L,I.z=F??0,await k.projectPointToVectorAsync(I,J,f,0,{signal:p}),e.evaluateElevationInfoAtPoint(J,t,E,q,H),G.push(H.z)}return{elevations:G,drapedObjectIds:C,failedObjectIds:A}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../core/support/UpdatingHandles ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./DisplayFeatureLimit ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L){a.Graphics3DFeatureProcessor=class extends k{constructor(F){super(F);this.type="graphics-3d";this._randomRotationRenderers=null;this._updatingHandles=new p.UpdatingHandles;this.timeExtentEnabled=this.elevationAlignmentEnabled=this.frustumVisibilityEnabled=this.filterVisibilityEnabled=this.scaleVisibilityEnabled=this.elevationFeatureExpressionEnabled=!1;this.setUidToIdOnAdd=!0;this.dataExtent=null;this.drapeSourceType=y.DrapeSourceType.Features;
this.preferredUpdatePolicy=L.UpdatePolicy.ASYNC;this._suspendResumeExtent=null}initialize(){const F=this.owner,M=new A.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:F.hasZ,hasM:F.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:S=>F.view.deconflictor.addGraphicsOwner(S),labeler:(S,N)=>F.view.labeler.addGraphicsOwner(S,N),elevationAlignment:this.elevationAlignmentEnabled?
(S,N)=>new C.Graphics3DElevationAlignment({graphicsCoreOwner:this,graphicsCore:S,queryGraphicUIDsInExtent:N,elevationProvider:F.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(S,N)=>new H.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:N,graphicsCore:S,basemapTerrain:F.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==F.layer.geometryType?S=>new z.FeatureVisibilityFilter({context:{layerView:F,
...S}}):null,objectStates:S=>new I.Graphics3DObjectStates(S)}});this._set("graphicsCore",M);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new E.Graphics3DFrustumVisibility({graphicsCoreOwner:this}));this.elevationAlignment&&this._updatingHandles.add(()=>this.layer.elevationInfo,(S,N)=>{w.diff(S,N)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this._updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this._updatingHandles.add(()=>
this.layer.labelingInfo,(S,N)=>{w.diff(S,N)&&this.graphicsCore.updateLabelingInfo()});this._updatingHandles.add(()=>this.preferredUpdatePolicy,S=>this.graphicsCore.preferredUpdatePolicy=S);this._set("initializePromise",this._initializeAsync());this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){await d.logOnError(this.graphicsCore.initializePromise);const F=this.owner;this._updatingHandles.add(()=>this.renderer,M=>this._updatingHandles.addPromise(this.graphicsCore.rendererChange(M)));
this._updatingHandles.add(()=>F.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this._updatingHandles.add(()=>F.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await d.logOnError(this.graphicsCore.updateLabelingInfo())}destroy(){this._updatingHandles.destroy();this._set("frustumVisibility",e.destroyMaybe(this.frustumVisibility));
this._set("graphicsCore",e.destroyMaybe(this.graphicsCore));this._set("owner",null)}get layer(){return this.owner.layer}get dataUpdating(){return this.graphicsCore?.dataUpdating??!1}get renderer(){const {renderer:F,objectIdField:M}=this.layer;if(!F||!M||"heatmap"===F.type||!F.visualVariables)return F;const S=F.visualVariables.findIndex(P=>"rotation"===P.type&&null!=P.valueExpression&&q.matchRandomRotationExpression(P.valueExpression)===M&&(null==P.axis||"heading"===P.axis)&&"geographic"===P.rotationType);
if(0>S)return F;const N=F.clone();N.visualVariables.splice(S,1);this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(N,M);return N}get scaleVisibility(){return this.graphicsCore?.scaleVisibility}get filterVisibility(){return this.graphicsCore?.filterVisibility}get elevationAlignment(){return this.graphicsCore?.elevationAlignment}get objectStates(){return this.graphicsCore?.objectStates}get suspendResumeExtentMode(){return"suspendResumeExtentMode"in
this.owner?this.owner.suspendResumeExtentMode:"computed"}get scaleVisibilitySuspended(){return null!=this.scaleVisibility&&this.scaleVisibility.suspended}get suspended(){return this.owner.suspended}get legendEnabled(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}get suspendInfo(){const F={};this.scaleVisibilitySuspended&&(F.outsideScaleRange=!0);null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(F.outsideOfView=!0);return F}get updating(){return!!(this.graphicsCore?.updating||
this.frustumVisibility?.updating||this._updatingHandles.updating)}get updatingRemaining(){return this.graphicsCore?.updatingRemaining??0}get featureStore(){return this.graphicsCore?.featureStore}get view(){return this.owner.view}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){return this.owner?.fullOpacity}get filter(){return"filter"in this.owner?this.owner.filter:null}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}get featureSpatialReference(){return"featureSpatialReference"in
this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}get graphics3DGraphics(){return this.graphicsCore?.graphics3DGraphics}get graphics3DGraphicsByObjectID(){return this.graphicsCore?.graphics3DGraphicsByObjectID}get symbolUpdateType(){return this.graphicsCore?.symbolUpdateType}get displayFeatureLimit(){const F=this.view.quality,M=this.graphicsCore?.displayFeatureLimit;return 1===F?M:new G.DisplayFeatureLimit(M.maximumTotalNumberOfVertices,Math.ceil(M.maximumNumberOfFeatures*
F),M.averageSymbolComplexity)}get usedMemory(){return this.graphicsCore?.usedMemory??0}get loadedFeatures(){return this.graphicsCore?.numberOfGraphics??0}get usedMemoryPerFeature(){return this.graphicsCore?.usedMemoryPerGraphic??0}get unprocessedMemoryEstimate(){return this.graphicsCore?.unprocessedMemoryEstimate??0}get performanceInfo(){return this.graphicsCore.performanceInfo}maskOccludee(F){const {set:M,handle:S}=this.objectStates.acquireSet(K.Object3DState.MaskOccludee,null);this.objectStates.setUid(M,
F.uid);return S}highlight(F,M){if(F instanceof v){const {set:S,handle:N}=this.objectStates.acquireSet(K.Object3DState.Highlight,M);this.owner.queryObjectIds(F).then(P=>this.objectStates.setObjectIds(S,P));return N}if("number"===typeof F||"string"===typeof F||F instanceof n)return this.highlight([F],M);"toArray"in F&&(F=F.toArray());if(Array.isArray(F)&&0<F.length){if(F[0]instanceof n)if(null!=B.attributeLookup(this.layer.fieldsIndex,F[0].attributes,M))F=F.map(S=>B.attributeLookup(this.layer.fieldsIndex,
S.attributes,M));else{F=F.map(P=>P.uid);const {set:S,handle:N}=this.objectStates.acquireSet(K.Object3DState.Highlight,null);this.objectStates.setUids(S,F);return N}if(Array.isArray(F)&&("number"===typeof F[0]||"string"===typeof F[0])){const {set:S,handle:N}=this.objectStates.acquireSet(K.Object3DState.Highlight,M);this.objectStates.setObjectIds(S,F);return N}}return g.makeHandle()}resetObjectStates(){this.objectStates.reset()}whenGraphicBounds(F,M){return this.graphicsCore?.whenGraphicBounds(F,M)}computeAttachmentOrigin(F,
M){return this.graphicsCore?.computeAttachmentOrigin(F,M)}notifyGraphicGeometryChanged(F){this.graphicsCore.notifyGraphicGeometryChanged(F)}notifyGraphicVisibilityChanged(F){this.graphicsCore.notifyGraphicVisibilityChanged(F)}getRenderingInfo(F,M,S){S=u.getRenderingInfo(F,{renderer:M,arcade:S});if(S?.color){const N=S.color;N[0]/=255;N[1]/=255;N[2]/=255}null!=S&&null!=M&&this._randomRotationRenderers?.has(M)&&(M=this._randomRotationRenderers.get(M),F=F.attributes[M],M=new h.XXH(0),M.updateFloatArray([F]),
M.updateUint8Array([173]),S.heading=8.381E-8*M.digest());return S}getRenderingInfoAsync(F,M,S,N){return u.getRenderingInfoAsync(F,{renderer:M,arcade:S,...N})}getSymbolLayerSize(F,M){return this.graphicsCore?.getSymbolLayerSize(F,M)}setObjectIdVisibility(F,M){this.graphicsCore?.setObjectIdVisibility(F,M)}refreshFilter(){null!=this.filterVisibility&&this.filterVisibility.reapply()}getGraphics3DGraphicByObjectId(F){return this.graphicsCore?.getGraphics3DGraphicByObjectId(F)}_updateClippingExtent(){const F=
this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(F,this.owner.view.spatialReference)&&(this.updateClippingExtent(F)||this.graphicsCore.recreateAllGraphics())}_setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this.addHandles(c.watch(()=>this.suspendResumeExtentMode,()=>{this.removeHandles("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.addHandles([c.watch(()=>this.graphicsCore.computedExtent,F=>this._updateSuspendResumeExtent(F),
c.initial),c.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.addHandles([c.when(()=>this.dataExtent,F=>this._updateSuspendResumeExtent(F),c.initial),c.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:m.neverReached(this.suspendResumeExtentMode)}},c.initial))}_updateSuspendResumeExtent(F){F?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(F,
this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}_extentToSuspendResumeRect(F,M){const S=this.owner.view.spatialReference;if(!F.spatialReference.equals(S)){if(!t.canProject(F,S))return;F=t.project(F,S)}return J.enlargeExtent(F,M,D.suspendResumeExtentOptimism,this.graphicsCore.extentPadding)}_suspendResumeExtentChanged(F){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(F);null!=this.scaleVisibility&&this.scaleVisibility.setExtent(F)}};b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,
"type",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"owner",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"layer",null);b.__decorate([l.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"dataUpdating",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"renderer",null);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"updateClippingExtent",void 0);b.__decorate([l.property({constructOnly:!0})],
a.Graphics3DFeatureProcessor.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"graphicsCore",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilityEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"filterVisibilityEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,
"frustumVisibilityEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"elevationAlignmentEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"timeExtentEnabled",void 0);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"setUidToIdOnAdd",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibility",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,
"filterVisibility",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"elevationAlignment",null);b.__decorate([l.property({constructOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"frustumVisibility",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"objectStates",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"initializePromise",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"suspendResumeExtentMode",
null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"suspended",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,
"updating",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"featureStore",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"view",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"loadedGraphics",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,
"filter",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"slicePlaneEnabled",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([l.property()],a.Graphics3DFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([l.property({readOnly:!0})],a.Graphics3DFeatureProcessor.prototype,"displayFeatureLimit",null);a.Graphics3DFeatureProcessor=
b.__decorate([x.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],a.Graphics3DFeatureProcessor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function b(h){const k=[];for(let m=0,g=h.length;m<g;m++){let e=h.charCodeAt(m);128>e?k.push(e):2048>e?k.push(192|e>>6,128|e&63):55296>e||57344<=e?k.push(224|e>>12,128|e>>6&63,128|e&63):(m++,e=65536+((e&1023)<<10|h.charCodeAt(m)&1023),k.push(240|e>>18,
128|e>>12&63,128|e>>6&63,128|e&63))}return new Uint8Array(k)}class n{constructor(h){this._seed=h;this._totallen=0;this._bufs=[];this.init()}init(){this._bufs=[];this._totallen=0;return this}updateFloatArray(h){const k=[];for(const m of h)isNaN(m)?k.push("NaN"):Infinity===m?k.push("Infinity"):-Infinity===m?k.push("-Infinity"):0===m?k.push("0"):k.push(m.toString(16));this.update(b(k.join("")))}updateIntArray(h){h=Int32Array.from(h);this.update(new Uint8Array(h.buffer))}updateUint8Array(h){this.update(Uint8Array.from(h))}updateWithString(h){return this.update(b(h))}update(h){this._bufs.push(h);
this._totallen+=h.length;return this}digest(){const h=new Uint8Array(this._totallen);let k=0;for(const m of this._bufs)h.set(m,k),k+=m.length;this.init();return this._xxHash32(h,this._seed)}_xxHash32(h,k=0){var m=k+374761393&4294967295;let g=0;if(16<=h.length){m=[k+2654435761+2246822519&4294967295,k+2246822519&4294967295,k+0&4294967295,k-2654435761&4294967295];k=h.length-16;var e=0;for(g=0;(g&4294967280)<=k;g+=4){var d=g;d=m[e]+(2246822519*(h[d]+(h[d+1]<<8))+(2246822519*(h[d+2]+(h[d+3]<<8))<<16))&
4294967295;d=d<<13|d>>>19;m[e]=2654435761*(d&65535)+(2654435761*(d>>>16)<<16)&4294967295;e=e+1&3}m=(m[0]<<1|m[0]>>>31)+(m[1]<<7|m[1]>>>25)+(m[2]<<12|m[2]>>>20)+(m[3]<<18|m[3]>>>14)&4294967295}m=m+h.length&4294967295;for(k=h.length-4;g<=k;g+=4)e=g,m=m+(3266489917*(h[e]+(h[e+1]<<8))+(3266489917*(h[e+2]+(h[e+3]<<8))<<16))&4294967295,m=m<<17|m>>>15,m=668265263*(m&65535)+(668265263*(m>>>16)<<16)&4294967295;for(;g<h.length;++g)m+=374761393*h[g],m=m<<11|m>>>21,m=2654435761*(m&65535)+(2654435761*(m>>>16)<<
16)&4294967295;m^=m>>>15;m=(2246822519*(m&65535)&4294967295)+(2246822519*(m>>>16)<<16);m^=m>>>13;m=(3266489917*(m&65535)&4294967295)+(3266489917*(m>>>16)<<16);m^=m>>>16;return 0>m?m+4294967296:m}}a.XXH=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/DisplayFeatureLimit":function(){define(["exports"],function(a){class b{constructor(n,h,k){this.maximumTotalNumberOfVertices=n;this.maximumNumberOfFeatures=h;this.averageSymbolComplexity=k}}a.DisplayFeatureLimit=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../core/Logger ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/has ../../../../core/Error ../../../../core/handleUtils ../../../../core/MapUtils ../../../../core/maybe ../../../../core/MemCache ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection ../../../../geometry/projection/projectBuffer ../../../../geometry/projection/projectVectorToVector ../../../../geometry/projection/projectXYZToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/PromiseQueue ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../support/basemapUtils ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./defaultSymbolComplexity ./DisplayFeatureLimit ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicsCorePerformanceInfo ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolMemory ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/WebGLLayer ../../../layers/support/popupUtils ../../../support/Scheduler ../../../support/Yield ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja,oa,qa,ta,va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma,Ua,Ga,Na,Va,Xa,Pa,bb){var gb;const cb=z.create(),ka=S.create();a.Graphics3DCore=gb=class extends w{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){this._spatialIndex||(this._spatialIndex=new ma.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,
hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?ua.UpdatePolicy.ASYNC:this._forcedUpdatePolicy??this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){return!!(this.dataUpdating||
this._elevationAlignment?.updating||this._scaleVisibility?.updating||this._filterVisibility?.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}get dataUpdating(){return!!(0<this._graphicsWaitingForSymbol.size||0<this._pendingUpdates.size||this._spatialIndex?.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||0<this._loadingSymbols)}get running(){return 0<this._pendingUpdates.size||
!!this._spatialIndex?.updating||this._dataUpdateQueue.running||this._updateQueue.running}get suspendedOrOutsideOfView(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}get updatingRemaining(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}get displayFeatureLimit(){var na=this.owner&&this.owner.view&&this.owner.view.qualitySettings,ya=na?.graphics3D.maxTotalNumberOfFeatures??0;const Da=
na?.graphics3D.maxNumberOfDrawCalls??0,Oa=na?.graphics3D.maxTotalNumberOfVertices??0,Wa=this.averageSymbolComplexity;na=Math.max(na?.graphics3D.minTotalNumberOfFeatures??0,Math.min(ya,Math.ceil(Oa/Math.max(1,Wa?.verticesPerFeature??1)),Wa&&0<Wa.drawCallsPerFeature&&0<Da?Da/Wa.drawCallsPerFeature:ya));return(ya=this._get("displayFeatureLimit"))&&ya.maximumTotalNumberOfVertices===Oa&&ya.averageSymbolComplexity===Wa&&ya.maximumNumberOfFeatures===na?ya:new ia.DisplayFeatureLimit(Oa,na,Wa)}get averageSymbolComplexity(){const na=
ba.averageSymbolComplexities(this._symbolComplexities),ya=this._get("averageSymbolComplexity");return 0===na.numComplexities||null!=ya&&(na.estimated&&(ya.verticesPerFeature>=na.verticesPerFeature||ya.verticesPerCoordinate>=na.verticesPerCoordinate||ya.drawCallsPerFeature>=na.drawCallsPerFeature)||ya.verticesPerFeature===na.verticesPerFeature&&ya.verticesPerCoordinate===na.verticesPerCoordinate&&ya.drawCallsPerFeature===na.drawCallsPerFeature)?ya:na}get usedMemory(){const na=null!=this.averageSymbolComplexity&&
this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,ya=this._getSymbolComplexitiesUsed().reduce((ab,Ja)=>ab+Ja.memory.resourceBytes,0),Da=this.owner.view._stage.renderer,Oa=this.owner.view.basemapTerrain.overlayManager.renderer,Wa=Array.from(this._symbols.values()).reduce((ab,Ja)=>ab+(Ja?.symbolLayers.reduce((Ra,Sa)=>Ra+(Sa?.materials.reduce((db,eb)=>eb?db+(Da.plugins.getMaterialRenderer(eb)?.usedMemory??0)+Oa.getMemoryForMaterial(eb):db,0)??0),0)??
0),0);return this._usedMemory+na+ya+Wa}get usedMemoryPerGraphic(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):null!=this.averageSymbolComplexity?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*
this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(na){if("web-style"===na.type)return na.clone();var ya=this._symbolConversionCache.get(na.id);if(null!=ya)return ya;ya=X.to3D(na,{geometryType:this.layer?.geometryType??void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(na)});const Da=ya.symbol||null;null==
Da&&ya.error&&r.getLogger(this).error(ya.error.message);this._symbolConversionCache.set(na.id,Da);return Da}_getSymbolComplexitiesUsedOrRenderer(na){if(null==na)return[];var ya=na.getSymbols(),Da="backgroundFillSymbol"in na?na.backgroundFillSymbol:null;if(!Da&&!ya?.length)return[];na=[];Da=this._getSymbolComplexityUsedOrRenderer(Da);null!=Da&&na.push(Da);for(const Oa of ya)ya=this._getSymbolComplexityUsedOrRenderer(Oa),null!=ya&&na.push(ya);return na}_getSymbolComplexityUsedOrRenderer(na){if(null==
na)return null;const ya=this._symbols.get(na.id);if(null!=ya)return ya.complexity;na=this._getConvertedSymbol(na);return null!=na?ba.defaultSymbolComplexity(na):null}_getSymbolComplexitiesUsed(){const na=[];this._symbols.forEach(ya=>{null!=ya&&na.push(ya.complexity)});return na}get _objectIdField(){return this.layer.objectIdField}constructor(na){super(na);this._propertiesPool=new Aa.PropertiesPool({computedExtent:Na},this);this.currentRenderer=this.computedExtent=null;this.rendererHasGeometryOperations=
!1;this._graphicStateTracking=null;this.graphics3DGraphics=new Map;this.stage=this.stageLayer=null;this._graphicsDrapedUids=new Set;this._graphicsBySymbol=new Map;this._symbolConversionCache=new Map;this._symbols=new Map;this._graphicsWithoutSymbol=new Map;this._graphicsWaitingForSymbol=new Map;this._graphicsUpdateId=0;this._frameTaskHandle=Ua.ImmediateTask;this._dataUpdateQueue=new Q.PromiseQueue;this._updateQueue=new Q.PromiseQueue;this._suspendSymbolCleanup=!1;this._spatialIndex=this._filterVisibility=
this._scaleVisibility=this._initializeAbortController=this._elevationInfoChangeAbortController=this._rendererChangeAbortController=this._arcadeOnDemand=null;this.extentPadding=0;this._sharedSymbolResourcesOwnerHandle=this._stageLayerElevationProvider=this._viewElevationProvider=this._objectStates=this._labeler=this._deconflictor=this._featureStore=this._updatingPendingLoadedGraphicsChange=null;this._whenGraphics3DGraphicRequests={};this._pendingUpdates=new Map;this._pendingRemoves=this._pendingAdds=
this._numberOfGraphicsProvidingElevation=this._numberOfGraphics=0;this._applyPendingRemovesFirst=!1;this._loadingSymbols=0;this._pendingUpdatesPool=new G({allocator:ya=>ya||new qb,deallocator:ya=>{ya.clear();return ya}});this._geometryWarningLogged=this._symbolWarningLogged=!1;this._objectIdInvisibleSet=new Set;this._whenSymbolRemoved=new G;this.preferredUpdatePolicy=ua.UpdatePolicy.SYNC;this._forcedUpdatePolicy=null;this.elevationFeatureExpressionEnabled=!0;this.layer=this.owner=null;this.graphicSymbolSupported=
!0;this.getRenderingInfoWithoutRenderer=!1;this.setUidToIdOnAdd=!0;this.hasM=this.hasZ=null;this._usedMemory=0;this._startCreateGraphics=this._visible=!1;this._unusedSymbolsCache=na.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",ya=>ya.destroy());this.symbolCreationContext=new Y.Graphics3DSymbolCreationContext(na.owner.view.resourceController.scheduler,(ya,Da)=>this._updateQueue.push(ya,Da))}initialize(){this._featureStore=new ea.Graphics3DFeatureStore({objectIdField:this.owner.layer?.objectIdField,
hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Da=>this.graphics3DGraphics.forEach(Da)});const na=(Da,Oa,Wa)=>this.spatialIndex.queryGraphicUIDsInExtent(Da,Oa,Wa),{componentFactories:ya}=this;null!=ya.elevationAlignment&&(this._elevationAlignment=ya.elevationAlignment(this,na));null!=ya.scaleVisibility&&(this._scaleVisibility=ya.scaleVisibility(this,na));null!=
ya.filterVisibility&&(this._filterVisibility=ya.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Da=>this.modifyGraphics3DGraphicVisibilities(Oa=>Oa.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,da.VisibilityFlag.FILTER,Da(O.getObjectId(Oa.graphic,this._objectIdField)))),setAllFeaturesVisibility:Da=>this.modifyGraphics3DGraphicVisibilities(Oa=>Oa.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,da.VisibilityFlag.FILTER,Da)),clearFeaturesVisibility:()=>
this.modifyGraphics3DGraphicVisibilities(Da=>Da.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,da.VisibilityFlag.FILTER,!0))}));null!=ya.deconflictor&&(this._deconflictor=ya.deconflictor(this));null!=ya.labeler&&null!=this._scaleVisibility&&(this._labeler=ya.labeler(this,this._scaleVisibility));null!=ya.objectStates&&(this._objectStates=ya.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()}async _initializeAsync(){const na=this._initializeAbortController?.signal,
ya=this.owner.view;this._viewElevationProvider=new fa.ViewElevationProvider(this._viewSpatialReference,ya);this._initializeStage(ya,this.layer.uid);var Da=ya.sharedSymbolResources;this.symbolCreationContext.sharedResources=Da;this._sharedSymbolResourcesOwnerHandle=Da.addGraphicsOwner(this.owner);null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Da.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=
ya.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new ra.GridLocalOriginFactory(ya.renderSpatialReference);this.symbolCreationContext.elevationProvider=ya.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=Oa=>this.notifyGraphicGeometryChanged(Oa);this.symbolCreationContext.notifyGraphicVisibilityChanged=Oa=>this.notifyGraphicVisibilityChanged(Oa);Da=aa.extractExpressionInfo(this.layer.elevationInfo,
this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await aa.createContext(Da,this._viewSpatialReference,na,r.getLogger(this));A.throwIfAborted(na);this.symbolCreationContext.screenSizePerspectiveEnabled=ya.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;
this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Oa}=this;this.symbolCreationContext.drapeSourceRenderer=ya.basemapTerrain.overlayManager.registerGeometryDrapeSource(Oa);this.addHandles(u.makeHandle(()=>ya.basemapTerrain.overlayManager.unregisterDrapeSource(Oa)))}this.addHandles([C.watch(()=>this.suspendedOrOutsideOfView,()=>this._updateQueue.unshift(()=>this._updateLayerVisibility(),null)),
C.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view?.screenSizePerspectiveEnabled],()=>{const Oa=ya.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Oa!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Oa,this._labeler?.reset(),this.recreateAllGraphicsAndSymbols())}),C.watch(()=>this.owner.slicePlaneEnabled,Oa=>this._slicePlaneEnabledChange(!!Oa)),C.watch(()=>this.owner.view.state?.rasterPixelRatio,
()=>this._pixelRatioChange()),C.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Oa=>this._physicalBasedRenderingChange(Oa)),C.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Oa=>this._skipHighSymbolLoDsChange(Oa)),C.when(()=>ya.basemapTerrain?.tilingScheme,Oa=>{Oa.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==ya.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=ya.basemapTerrain.spatialReference);
this.hasHandles("loaded-graphics")?this.recreateAllGraphics():this.addHandles([C.on(()=>this.owner?.loadedGraphics,"change",Wa=>{this._graphicsCollectionChanged(Wa);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),C.watch(()=>this.effectiveUpdatePolicy,Oa=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=Oa);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===
ua.UpdatePolicy.ASYNC;Oa===ua.UpdatePolicy.SYNC&&this.runTask(Ua.noBudget)},C.syncAndInitial)]);this._frameTaskHandle=ya.resourceController.scheduler.registerTask(Ua.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this.addHandles(C.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController&&
(this._initializeAbortController.abort(),this._initializeAbortController=null)}destroy(){this._unusedSymbolsCache.destroy();this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTaskHandle.remove();this._frameTaskHandle=Ua.ImmediateTask;this._dataUpdateQueue.cancelAll();this._updateQueue.cancelAll();this.owner.view?.deconflictor?.removeGraphicsOwner(this);this.owner.view?.labeler?.removeGraphicsOwner(this);this._elevationAlignment=y.destroyMaybe(this._elevationAlignment);
this._scaleVisibility=y.destroyMaybe(this._scaleVisibility);this._filterVisibility=y.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=null;this._objectStates=y.destroyMaybe(this._objectStates);this.clear();this._featureStore=y.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=y.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=y.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stageLayer=y.destroyMaybe(this.stageLayer),
this.stage=null);this._set("owner",null);for(const na in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[na].reject(new q("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=y.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=y.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=
y.destroyMaybe(this._spatialIndex)}clear(){this._objectStates?.allGraphicsDeleted();null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(na=>na.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();this._symbols.forEach(y.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();
this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("dataUpdating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")}_initializeStage(na,ya){this.stage=na._stage;this.stageLayer=new Ka.WebGLLayer(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},ya);na=this.stageLayer.events;na.on("transformationChanged",
Da=>this.notifyGraphicGeometryChanged(Da.graphicUid));na.on("shaderTransformationChanged",Da=>this.notifyGraphicGeometryChanged(Da.graphicUid));na.on("visibilityChanged",Da=>this.notifyGraphicVisibilityChanged(Da.graphicUid));na.on("geometryAdded",Da=>this.notifyGraphicGeometryChanged(Da.object.graphicUid));na.on("geometryRemoved",Da=>this.notifyGraphicGeometryChanged(Da.object.graphicUid));na.on("attributesChanged",Da=>Ea.affectsGeometry(Da.attribute)&&this.notifyGraphicGeometryChanged(Da.object.graphicUid))}notifyGraphicGeometryChanged(na){null!=
this._graphicStateTracking&&null!=na&&(na=this.graphics3DGraphics.get(na))&&this._graphicStateTracking.updateGraphicGeometry(na)}notifyGraphicVisibilityChanged(na){null!=this._graphicStateTracking&&null!=na&&(na=this.graphics3DGraphics.get(na))&&this._graphicStateTracking.updateGraphicVisibility(na)}_updateLayerVisibility(){var na=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;na=!this.suspendedOrOutsideOfView&&!na;na!==this._visible&&((this._visible=na)?(this.stageLayer.pickable=
!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}_updateStageLayerVisibility(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)}getGraphics3DGraphicById(na){return null!=na?this.graphics3DGraphics.get(na):void 0}getGraphics3DGraphicByObjectId(na){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(na):null}_getGraphicObjectID(na,ya=this.owner.layer?.objectIdField){return O.getObjectId(na,
ya)}get graphics3DGraphicsByObjectID(){const na=this.owner.layer?.objectIdField;if(na){var ya=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var Oa=this._getGraphicObjectID(Da.graphic,na);null!=Oa&&ya.set(Oa,Da)}});return ya}}get labelsEnabled(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}async updateLabelingInfo(na){const ya=this._deconflictor&&this._deconflictor.labelingInfoChange(na);na=this._labeler&&this._labeler.labelingInfoChange(na);await Promise.allSettled([ya,na])}updateVisibilityInfo(){this._deconflictor&&
this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()}get symbolUpdateType(){if(0<this._pendingUpdates.size)return"unknown";let na=0,ya=0;return v.someMap(this._symbols,(Da,Oa)=>{if(null!=Da){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this._graphicsBySymbol.has(Oa)&&(ya+=Da.fast,na+=Da.slow)}return!1})?"unknown":0<=ya&&0===na?"fast":0<=na&&0===ya?"slow":"mixed"}runTask(na){this._dataUpdateQueue.runTask(na);this._updateQueue.runTask(na);this._applyPendingUpdates(na);
this.notifyChange("running");this.running||this.notifyChange("dataUpdating");this.notifyChange("updatingRemaining");if(!na.hasProgressed)return Ga.Yield}setObjectIdVisibility(na,ya){ya?this._objectIdInvisibleSet.delete(na):this._objectIdInvisibleSet.add(na);na=this._findGraphics3DGraphicByObjectId(na);null!=na&&this._updateUserVisibility(na)}_findGraphics3DGraphicByObjectId(na){return v.findInMap(this.graphics3DGraphics,ya=>this._getGraphicObjectID(ya.graphic)===na)}_updateUserVisibility(na){if(null==
na)return!1;var ya=na.graphic;const Da=this._getGraphicObjectID(ya);ya=ya.visible&&!this.owner.suspended&&(null==Da||!this._objectIdInvisibleSet.has(Da));return na.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,da.VisibilityFlag.USER,ya)}_whenGraphics3DGraphic(na){var ya=this.graphics3DGraphics.get(na.uid);if(ya)return Promise.resolve(ya);if(ya=this._whenGraphics3DGraphicRequests[na.uid])return ya.promise;ya=A.createResolver();this._whenGraphics3DGraphicRequests[na.uid]=ya;return ya.promise}async _boundsForGraphics3DGraphic(na,
ya){const Da=this._viewSpatialReference,Oa=this.owner.view.renderSpatialReference,Wa=this.owner.view.basemapTerrain.spatialReference;na=await na.getProjectedBoundingBox((Ja,Ra,Sa)=>L.projectBuffer(Ja,Oa,Ra,Ja,Da,Ra,Sa),(Ja,Ra,Sa)=>L.projectBuffer(Ja,Wa,Ra,Ja,Da,Ra,Sa),this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=ya?!!ya.useViewElevation:!1,minDemResolution:null!=ya?ya.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,ya?.signal);
if(!na)return null;ya=na.boundingBox;if(na.requiresDrapedElevation){var ab=this.symbolCreationContext.elevationProvider;ab&&(S.center(ya,cb),ab=ab.getElevation(cb[0],cb[1],0,Da,"ground")??0,ya[2]=Math.min(ya[2],ab),ya[5]=Math.max(ya[5],ab))}return{boundingBox:ya,screenSpaceObjects:na.screenSpaceObjects}}async whenGraphicBounds(na,ya){await C.whenOnce(()=>this.owner?.loadedGraphics);const Da=this.owner.layer?.objectIdField;var Oa=this.owner.loadedGraphics.find(Wa=>Wa===na?!0:null!=Da&&null!=Wa.attributes&&
na.attributes&&Wa.attributes[Da]===na.attributes[Da]);if(!Oa)throw new q("internal:graphic-not-part-of-view","Graphic is not part of this view");Oa=await this._whenGraphics3DGraphic(Oa);return this._boundsForGraphics3DGraphic(Oa,ya)}computeAttachmentOrigin(na,ya){na=this.graphics3DGraphics.get(na.uid);if(!na)return null;var Da=na.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;B.set(tb,0,0,0);na=0;if(0<Da.render.num){if(!F.projectVectorToVector(Da.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,
xa,ya))return null;B.add(tb,tb,xa);na++}if(0<Da.draped.num){const [Oa,Wa]=Da.draped.origin;Da=this._viewElevationProvider.getElevation(Oa,Wa,"ground")??0;B.set(xa,Oa,Wa,Da);if(!F.projectVectorToVector(xa,this._viewElevationProvider.spatialReference,xa,ya))return null;B.add(tb,tb,xa);na++}1<na&&B.scale(tb,tb,1/na);return new Va({x:tb[0],y:tb[1],z:tb[2],spatialReference:ya})}getSymbolLayerSize(na,ya){var Da=this._symbols.get(na.id);if(null==Da)throw new q("internal:symbol-not-part-of-view","Symbol is not part of this view");
na=na.symbolLayers.indexOf(ya);if(-1===na)throw new q("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(na);if(null==Da)throw new q("internal:missing-size","Symbol layer has no valid size");return Da}_graphicsCollectionChanged(na){this._startCreateGraphics&&(this.add(na.added),this.remove(na.removed))}graphicUpdateHandler(na){const ya=na.graphic.uid,Da=this.graphics3DGraphics.get(ya);if(null!=Da||null!=this._graphicsWithoutSymbol.get(ya))switch(na.property){case "visible":this._graphicUpdateVisibleHandler(Da);
break;case "geometry":this._graphicUpdateGeometryHandler(Da,na);break;case "symbol":this._graphicUpdateSymbolHandler(Da,na);break;case "origin-transform":this._graphicUpdateTransformHandler(Da,na)}}_graphicUpdateGeometryHandler(na,ya){this._graphicUpdateGeometryOrTransformHandler(na,ya,()=>null!=ya.newValue&&null!=na&&na.graphics3DSymbol.updateGeometry(na,ya.newValue));const Da=ya.graphic.geometry;null!=Da&&this._expandComputedExtent(Da)}_graphicUpdateTransformHandler(na,ya){const Da=ya.graphic.geometry;
this._graphicUpdateGeometryOrTransformHandler(na,ya,()=>null!=ya.newValue&&null!=na&&null!=Da&&na.graphics3DSymbol.updateTransform(na,Da.spatialReference,ya.newValue,ya.action))}_graphicUpdateGeometryOrTransformHandler(na,ya,Da){if(null==ya.graphic.geometry)this._recreateGraphic(ya.graphic);else if(null==na){if(na=ya.graphic.symbol?.id)if(na=this._symbols.get(na),null!=na&&na.loadStatus===Ca.LoadStatus.LOADING)return;this._recreateGraphic(ya.graphic)}else Da()||this._recreateGraphic(na.graphic)}_graphicUpdateSymbolHandler(na,
ya){var Da=ya.graphic;const Oa=null!=na?na.graphics3DSymbol:null!=ya.oldValue?this._symbols.get(ya.oldValue.id):null;if(null==Oa||null==ya.newValue)this._recreateGraphic(Da);else{var Wa=Oa.symbol;ya=this._getConvertedSymbol(ya.newValue);if(null!=ya&&(ya.type!==Wa.type||"web-style"===ya.type)||"web-style"===Wa.type)this._recreateGraphic(Da);else{var ab=this._graphicsBySymbol.get(Wa.id);if(ab&&1!==ab.size)this._recreateGraphic(Da);else if(ab=J.diff(Wa,ya),null==ab)this._updateSymbolMapping(Wa.id,ya);
else if(ab={diff:ab,graphics3DGraphicPatches:[],symbolStatePatches:[]},Oa.prepareSymbolPatch(ab),J.isEmpty(ab.diff)){var Ja=this._getRenderingInfo(Da);if(null==Ja)this._recreateGraphic(Da);else{Da=Oa.extentPadding;for(const Ra of ab.symbolStatePatches)Ra();Da!==Oa.extentPadding&&this._recomputeExtentPadding();if(null!=na)for(const Ra of ab.graphics3DGraphicPatches)Ra(na,Ja);this._updateSymbolMapping(Wa.id,ya)}}else this._recreateGraphic(Da)}}}_graphicUpdateVisibleHandler(na){this._updateUserVisibility(na)&&
(this._labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}recreateGraphics(na){this._suspendSymbolCleanup=!0;this.remove(na);this.add(na);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===ua.UpdatePolicy.SYNC&&this._cleanupSymbols()}_recreateGraphic(na){this.recreateGraphics([na])}_beginGraphicUpdate(na){const ya=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(na.uid,ya);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating");
return ya}_endGraphicUpdate(na){na&&(this._graphicsWaitingForSymbol.delete(na.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let na=0;this._symbols.forEach(ya=>{null!=ya&&(na=Math.max(na,ya.extentPadding))});this._set("extentPadding",na)}_expandComputedExtent(na){var ya=na.spatialReference;O.computeAABB(na,ka);na=this._viewSpatialReference;var Da=gb.tmpVec;!P.equals(ya,na)&&M.projectXYZToVector(ka[0],ka[1],0,ya,Da,
na)&&(ka[0]=Da[0],ka[1]=Da[1],M.projectXYZToVector(ka[3],ka[4],0,ya,Da,na),ka[3]=Da[0],ka[4]=Da[1]);if(isFinite(ka[0])&&isFinite(ka[3])&&isFinite(ka[1])&&isFinite(ka[4])){ya=this.computedExtent;Da=null;var Oa=isFinite(ka[2])&&isFinite(ka[5]),Wa=Oa&&(null==ya?.zmin||ka[2]<ya.zmin);Oa=Oa&&(null==ya?.zmax||ka[5]>ya.zmax);if(ya){if(ka[0]<ya.xmin||ka[1]<ya.ymin||ka[3]>ya.xmax||ka[4]>ya.ymax||Wa||Oa)Da=this._propertiesPool.get("computedExtent"),Da.xmin=Math.min(ka[0],ya.xmin),Da.ymin=Math.min(ka[1],ya.ymin),
Da.xmax=Math.max(ka[3],ya.xmax),Da.ymax=Math.max(ka[4],ya.ymax),Da.spatialReference=na}else Da=this._propertiesPool.get("computedExtent"),Da.xmin=ka[0],Da.ymin=ka[1],Da.xmax=ka[3],Da.ymax=ka[4],Da.spatialReference=na;Da&&(Wa&&(Da.zmin=ka[2]),Oa&&(Da.zmax=ka[5]),this._set("computedExtent",Da))}}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){this._abortElevationInfoChange();
const na=new AbortController;this._elevationInfoChangeAbortController=na;const ya=aa.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await aa.createContext(ya,this._viewSpatialReference,na.signal,r.getLogger(this));A.throwIfAborted(na.signal);this._elevationInfoChangeAbortController=null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((Da,Oa,Wa)=>{Da.globalPropertyChanged("elevationInfo",
Oa)?Oa.forEach(ab=>{const Ja=ab.graphic;ab=ab.labelLayers;for(const Ra of ab)Ra.graphics3DSymbolLayer.updateGraphicElevationContext(Ja,Ra)}):this._recreateSymbol(Wa)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()}updateStageLayerElevationProvider(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),
this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new Ba.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){this.clear();
null!=this._filterVisibility&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=y.disposeMaybe(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0;this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(na=
!1){if(this._startCreateGraphics){var {loadedGraphics:ya,view:Da}=this.owner,Oa=Da.basemapTerrain.tilingScheme&&ya?.length?ya.toArray():null;!na&&Oa||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Oa&&(na?this.add(Oa):this.recreateGraphics(Oa))}}_recreateSymbol(na){var ya=
this._graphicsBySymbol.get(na);const Da=[];ya&&(ya.forEach((Oa,Wa)=>{const ab=Oa.usedMemory;this._conditionalRemove(Oa,Wa);this._spatialIndex?.remove(Oa);Da.push(Oa.graphic);Oa.destroy();this._removeGraphics3DGraphic(Wa,ab);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(na,new Map));ya=this._symbols.get(na);y.destroyMaybe(ya);this._symbols.delete(na);this.add(Da)}_recreateGraphicsForSymbol(na){if(na=this._graphicsBySymbol.get(na)){const ya=[];
na.forEach(Da=>ya.push(Da.graphic));this.recreateGraphics(ya)}}_conditionalRemove(na,ya){this._graphicsDrapedUids.delete(ya);this._objectStates?.removeGraphic(na);this._labeler?.removeGraphic(na);this._deconflictor?.removeGraphic(na);null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(na)}add(na){na&&0!==na.length&&(this.owner.view.basemapTerrain?.tilingScheme?(this._updatePolicyForGraphics(na)===ua.UpdatePolicy.ASYNC?this._addDelayed(na):this._addImmediate(na),this.notifyChange("dataUpdating")):
r.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(na){if(this.effectiveUpdatePolicy===ua.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const ya of na)if(null!=ya.geometry&&"mesh"===ya.geometry.type&&!ya.geometry.loaded)return ua.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy}_addImmediate(na){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const ya of na)this._addGraphic(ya,
this._getRenderingInfo(ya,r.getLogger(this)),ua.UpdatePolicy.SYNC);this._cleanupSymbols();this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()}_addDelayed(na){for(const ya of na){na=ya.uid;let Da=this._pendingUpdates.get(na);Da?Da.add?Da.state!==mb.NEW&&Da.abortController?.abort():this._pendingAdds++:(Da=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(na,Da));Da.add=ya}this.notifyChange("running");this.notifyChange("updatingRemaining");
this.notifyChange("dataUpdating")}remove(na){this.effectiveUpdatePolicy===ua.UpdatePolicy.ASYNC?this._removeDelayed(na):this._removeImmediate(na);this.notifyChange("dataUpdating")}_removeImmediate(na){for(const ya of na)this._removeGraphic(ya);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_removeDelayed(na){for(const Da of na){na=Da.uid;var ya=this._pendingUpdates.get(na);ya?ya.add&&(ya.remove?ya.add=null:this._pendingUpdates.delete(na),
ya.state===mb.LOADING&&ya.abortController?.abort(),this._pendingAdds--):(ya=this._pendingUpdatesPool.pushNew(),ya.remove=Da,this._pendingUpdates.set(na,ya),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining");this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&r.getLogger(this).warn("pendingAdds/Removes in inconsistent state!");
this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1}_applyPendingUpdates(na){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),na.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [ya,Da]of this._pendingUpdates){if(na.done){this._applyPendingRemovesFirst=!0;break}if(Da.remove&&!Da.add&&(this._pendingRemoves--,na.madeProgress(),this._removeGraphic(Da.remove),
Da.remove=null,this._pendingUpdates.delete(ya),0===this._pendingRemoves))break}}for(const [ya,Da]of this._pendingUpdates){if(na.done)break;Da.add&&Da.state===mb.NEW&&this._processPendingUpdateNew(Da);let Oa=this.effectiveUpdatePolicy;!Da.remove||Da.add&&Da.state!==mb.READY||(this._pendingRemoves--,na.madeProgress(),this._removeGraphic(Da.remove),Da.remove=null,Oa=ua.UpdatePolicy.SYNC);if(Da.add)switch(Da.state){case mb.READY:this._addGraphic(Da.add,Da.renderingInfo,Oa);Da.add=null;this._pendingAdds--;
na.madeProgress();break;case mb.REJECTED:Da.add=null,this._pendingAdds--}null==Da.remove&&null==Da.add&&this._pendingUpdates.delete(ya)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}}_processPendingUpdateNew(na){if(na.add){var ya=na.add.geometry;null==ya||"mesh"!==ya.type||ya.loaded?this._processPendingUpdateNewRenderingInfo(na):this._processPendingUpdateNewMesh(na,ya)}else na.state=mb.READY}async _processPendingUpdateNewMesh(na,
ya){na.state=mb.LOADING;na.abortController=new AbortController;const Da=na.abortController.signal;try{await ya.load({signal:Da})}catch(Oa){return this._processPendingUpdateNewError(na,Oa)}na.abortController=null;this._processPendingUpdateNewRenderingInfo(na)}_processPendingUpdateNewError(na,ya){na.abortController=null;A.isAbortError(ya)?na.state=mb.NEW:na.state=mb.REJECTED}async _processPendingUpdateNewRenderingInfo(na){if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)na.renderingInfo=
this._getRenderingInfo(na.add,r.getLogger(this));else{na.state=mb.LOADING;na.abortController=new AbortController;var ya=null;try{ya=await this._getRenderingInfoAsync(na.add,{signal:na.abortController.signal})}catch(Da){na.abortController=null;A.isAbortError(Da)?na.state=mb.NEW:na.state=mb.REJECTED;return}null==ya?.symbol?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,r.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),na.renderingInfo=null):na.renderingInfo=
ya}na.state=mb.READY}_addGraphic(na,ya,Da){this._graphicsWithoutSymbol.set(na.uid,na);if(null!=ya?.symbol&&O.hasGeometry(na)){if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){const eb=W.isBasemapLayer(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(na.objectId,na.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!eb&&Ma.hasPopupTemplate(this.layer,this.owner.view.popup?.defaultPopupTemplateEnabled))}var Oa=
this.getOrCreateGraphics3DSymbol(ya.symbol,ya.renderer);if(null!=Oa){this._expandComputedExtent(na.geometry);var Wa=this._beginGraphicUpdate(na),ab=new ha.Graphics3DGraphicCreationContext(na,ya,this.layer),Ja=!1,Ra=eb=>{eb===Oa.symbol.id&&(Ja=!0)};this._whenSymbolRemoved.push(Ra);var Sa=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(Ra);if(this._graphicsWaitingForSymbol.get(na.uid)!==Wa||Ja||Oa.destroyed||this.graphicSymbolSupported&&na.symbol&&na.symbol.id!==
Oa.symbol.id)--Oa.referenced,this._cleanupSymbols();else{const eb=this._createGraphics3DGraphic(Oa,ab);this._spatialIndex&&null!=eb&&this._spatialIndex.add(eb);--Oa.referenced;this._endGraphicUpdate(na)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},db=eb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(Ra),Ja||(A.isAbortError(eb)?this.add([na]):Oa.destroyed||this._endGraphicUpdate(na)))};++this._loadingSymbols;Da===ua.UpdatePolicy.ASYNC?
Oa.load(()=>this._dataUpdateQueue.push(Sa,null),eb=>this._dataUpdateQueue.push(()=>db(eb),null)):Oa.load(Sa,db)}}}_removeGraphic(na){na=na.uid;const ya=this.graphics3DGraphics.get(na);if(ya){ya.graphics3DSymbol.onRemoveGraphic(ya);const Da=ya.usedMemory,Oa=ya.isElevationSource;this._conditionalRemove(ya,na);this._spatialIndex?.remove(ya);this._graphicsBySymbol.get(ya.graphics3DSymbol.symbol.id)?.delete(na);this._graphicsWithoutSymbol.delete(na);this._removeGraphics3DGraphic(na,Da,Oa);ya.destroy();
this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(na),this._graphicsWaitingForSymbol.delete(na),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(na){if(na instanceof Xa||na instanceof Pa){const ya=this.symbolCreationContext.layer;return ya.labelingInfo?ya.labelingInfo.some(Da=>Da.symbol===na):!1}return!1}_hasValidSymbolCreationContext(na){return na instanceof Xa&&!this._hasLabelingContext(na)?(r.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0}_getRenderingInfo(na,ya){const Da=na.geometry;if(null==Da)return ya&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!K.canProjectWithoutEngine(Da.spatialReference,this._viewSpatialReference))return ya&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&
null!=na.symbol)return ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;na=this.rendererHasGeometryOperations?T.hydrateGraphic(na,this.layer):na;na=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(na,this.currentRenderer,this._arcadeOnDemand):{symbol:na.symbol||ca.getDefaultSymbol3D(na.geometry)};return null==
na?.symbol?(ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):na}_getRenderingInfoAsync(na,ya){if(null==na.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,r.getLogger(this).warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&null!=na.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,r.getLogger(this).warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),
null;na=this.rendererHasGeometryOperations?T.hydrateGraphic(na,this.layer):na;return this.owner.getRenderingInfoAsync(na,this.currentRenderer,this._arcadeOnDemand,ya)}_createGraphics3DSymbol(na,ya){if(!this._hasValidSymbolCreationContext(na))return null;na=this._getConvertedSymbol(na);if(!na)return null;let Da;null!=ya&&"backgroundFillSymbol"in ya&&ya.backgroundFillSymbol&&(ya=X.to3D(ya.backgroundFillSymbol,{ignoreDrivers:!0}),null!=ya.symbol&&"web-style"!==ya.symbol.type&&"cim"!==ya.symbol.type&&
(Da=ya.symbol.symbolLayers));const Oa=Z.make(na,this.symbolCreationContext,Da);Oa.load(()=>{const Wa=Oa.extentPadding;Wa>this.extentPadding&&this._set("extentPadding",Wa);this.notifyChange("averageSymbolComplexity")},()=>{});return Oa}getOrCreateGraphics3DSymbol(na,ya){var Da=this._symbols.get(na.id);void 0===Da&&(Da=this._unusedSymbolsCache.pop(na.id),Da=null!=Da?Da:na instanceof bb?new ja.Graphics3DWebStyleSymbol(na,Oa=>this._dataUpdateQueue.push(Oa,null),Oa=>this._createGraphics3DSymbol(Oa,ya)):
this._createGraphics3DSymbol(na,ya),this._symbols.set(na.id,Da));null!=Da&&++Da.referenced;return Da}trackGraphicState(na){null==this._graphicStateTracking&&(this._graphicStateTracking=new qa.GraphicStateTracking(this));return this._graphicStateTracking.add(na)}_addGraphics3DGraphic(na){this._usedMemory+=na.usedMemory;this.graphics3DGraphics.set(na.graphic.uid,na);this._numberOfGraphics++;na.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_removeGraphics3DGraphic(na,
ya,Da=!1){this._usedMemory-=ya;this.graphics3DGraphics.delete(na);this._numberOfGraphics--;Da&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()}_createGraphics3DGraphic(na,ya){const Da=ya.graphic;this._graphicsWithoutSymbol.delete(Da.uid);if(!this._symbols.has(na.symbol.id))return this.add([Da]),null;if(this.graphics3DGraphics.has(Da.uid))return null;ya=na.createGraphics3DGraphic(ya);if(null==ya)return null;this._addGraphics3DGraphic(ya);
na=na.symbol.id;this._graphicsBySymbol.has(na)||this._graphicsBySymbol.set(na,new Map);this._graphicsBySymbol.get(na).set(Da.uid,ya);ya.isDraped&&this._graphicsDrapedUids.add(Da.uid);ya.centroid=null;null!=Da.geometry&&"point"!==Da.geometry.type&&(ya.centroid=ta.computeCentroid(Da.geometry,this._viewSpatialReference));this._updateUserVisibility(ya);null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(ya);null!=this._filterVisibility&&({defaultVisibility:na}=this._filterVisibility,ya.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,
da.VisibilityFlag.FILTER,na),na||this._filterVisibility.reapply());this._deconflictor?.addGraphic(ya);this._labeler?.addGraphic(ya);this._objectStates?.addGraphic(ya);this._deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ya);ya.initialize(this.stageLayer,this.owner);null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(ya);if(na=this._whenGraphics3DGraphicRequests[Da.uid])delete this._whenGraphics3DGraphicRequests[Da.uid],na.resolve(ya);return ya}_abortRendererChange(){this._rendererChangeAbortController&&
(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)}async rendererChange(na){this._abortRendererChange();if(na!==this.currentRenderer)if(this._validateRenderer(na),null==na&&this._currentRendererChange(null,!1),V.isSupportedRenderer3D(na))if(null!=na&&na.arcadeRequired){var ya=new AbortController;this._rendererChangeAbortController=ya;const {arcadeUtils:Da}=await this._ensureArcade();A.throwIfAborted(ya);const Oa=Da.hasGeometryOperations(na);Oa&&(await Da.enableGeometryOperations(),
A.throwIfAborted(ya));this.effectiveUpdatePolicy===ua.UpdatePolicy.ASYNC?await this._updateQueue.push(()=>this._currentRendererChange(na,Oa),ya.signal):this._currentRendererChange(na,Oa);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===ua.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=ya=new AbortController,await this._updateQueue.push(()=>this._currentRendererChange(na,!1),ya.signal),this._rendererChangeAbortController=null):this._currentRendererChange(na,!1);else this._currentRendererChange(na,
!1)}async _ensureArcade(){null==this._arcadeOnDemand&&(this._arcadeOnDemand=await U.loadArcade());return this._arcadeOnDemand}_currentRendererChange(na,ya){this.currentRenderer=na;this.rendererHasGeometryOperations=ya;this.symbolCreationContext.arcade=this._arcadeOnDemand;ya=this.symbolCreationContext.renderer;if(na!==ya)if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==na)this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Da=J.diff(ya,
na);this._updateUnchangedSymbolMappings(Da,na,ya);this.symbolCreationContext.renderer=na;null!=Da&&("complete"===Da.type?this.recreateAllGraphicsAndSymbols():"partial"===Da.type&&(this._applyRendererDiff(Da,na,ya)?this._labeler?.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}}_diffHasSymbolChange(na){for(const ya in na.diff)switch(ya){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete na.diff[ya];
break;default:return!0}return!1}_applySymbolSetDiff(na,ya,Da){na=na||[];ya=ya||[];const Oa=[];for(const Wa of ya){const ab=this._graphicsBySymbol.get(Wa.id);ab&&ab.forEach((Ja,Ra)=>{var Sa=Ja.graphic,db=this.layer instanceof R?this.layer:null;const eb=this._arcadeOnDemand;if(Wa!==Da.defaultSymbol||Da.getSymbol(T.hydrateGraphic(Sa,db),{arcade:eb})!==Da.defaultSymbol)db=Ja.usedMemory,na.length||Da.defaultSymbol?Oa.push(Sa):this._graphicsWithoutSymbol.set(Ra,Sa),Sa=this.graphics3DGraphics.get(Ra),this._conditionalRemove(Sa,
Ra),Ja.destroy(),ab.delete(Ra),this._removeGraphics3DGraphic(Ra,db),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(Ja=>Ja(Wa.id))}if(na.length||Oa.length)this._graphicsWithoutSymbol.forEach(Wa=>Oa.push(Wa)),this._graphicsWithoutSymbol.clear(),this.add(Oa);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()}_applyUniqueValueRendererDiff(na,ya,Da){const Oa=na.diff.defaultSymbol,Wa=na.diff.uniqueValueInfos;if(Oa||Wa){const ab=
Wa?Wa.added.map(Ra=>Ra.symbol).filter(p.isSome):[],Ja=Wa?Wa.removed.map(Ra=>Ra.symbol).filter(p.isSome):[];if(Wa)for(let Ra=0;Ra<Wa.changed.length;Ra++)ab.push(Wa.changed[Ra].newValue.symbol),Ja.push(Wa.changed[Ra].oldValue.symbol);Oa?(Da.defaultSymbol&&Ja.push(Da.defaultSymbol),ya.defaultSymbol&&ab.push(ya.defaultSymbol)):Da.defaultSymbol&&ab.length&&Ja.push(ya.defaultSymbol);this._applySymbolSetDiff(ab,Ja,ya);delete na.diff.defaultSymbol;delete na.diff.uniqueValueInfos;return!0}return!1}_calculateUnchangedSymbolMapping(na,
ya,Da){if("unique-value"!==ya?.type||"unique-value"!==Da?.type||null!=na&&"partial"!==na.type)return[];const Oa=ab=>null!=ab?ab.id:null;var Wa=na&&na.diff;na=Wa?.defaultSymbol;if(Wa=Wa&&Wa.uniqueValueInfos)Wa=Wa.unchanged.map(ab=>({oldId:Oa(ab.oldValue.symbol),newId:Oa(ab.newValue.symbol)}));else{Wa=[];for(const ab of Da.uniqueValueInfos??[]){const Ja=Oa(ab.symbol),Ra=ya.uniqueValueInfos?.find(Sa=>Sa.value===ab.value);Ra&&Ja!==Oa(Ra.symbol)&&Wa.push({oldId:Ja,newId:Oa(Ra.symbol)})}}!na&&Da.defaultSymbol&&
Wa.push({oldId:Oa(Da.defaultSymbol),newId:Oa(ya.defaultSymbol)});return Wa}_updateSymbolMapping(na,ya){const Da=null!=ya&&ya?"string"===typeof ya?ya:ya.id:null;if(null!=na&&na!==Da){var Oa=this._graphicsBySymbol.get(na);this._graphicsBySymbol.delete(na);void 0!==Oa&&this._graphicsBySymbol.set(Da,Oa);Oa=this._symbols.get(na);void 0!==Oa&&(this._symbols.delete(na),this._symbols.set(Da,Oa),null!=Oa&&(na="string"===typeof ya?null:ya,null!=na?Oa.symbol=na:Oa.symbol.id=Da))}}_updateUnchangedSymbolMappings(na,
ya,Da){na=this._calculateUnchangedSymbolMapping(na,ya,Da);for(const {oldId:Oa,newId:Wa}of na)this._updateSymbolMapping(Oa,Wa)}_applyRendererDiff(na,ya,Da){if(this._diffHasSymbolChange(na))return!1;if(ya instanceof l&&Da instanceof l&&this._applyUniqueValueRendererDiff(na,ya,Da)&&0===Object.keys(na.diff).length)return!0;for(const [Oa]of this._graphicsBySymbol)if(Da=this._symbols.get(Oa),null!=Da)switch(Da.applyRendererDiff(na,ya)){case va.ApplyRendererDiffResult.RecreateSymbol:this._recreateSymbol(Oa);
break;case va.ApplyRendererDiffResult.RecreateGraphics:this._recreateGraphicsForSymbol(Oa)}return!0}opacityChange(){this.forEachGraphics3DSymbol((na,ya)=>na.globalPropertyChanged("opacity",ya));this._updateStageLayerVisibility()}_slicePlaneEnabledChange(na){na!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=na,this.stageLayer.sliceable=na,this.forEachGraphics3DSymbol((ya,Da)=>ya.globalPropertyChanged("slicePlaneEnabled",Da)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),
this._labeler&&this._labeler.slicePlaneEnabledChange())}_physicalBasedRenderingChange(na){this.symbolCreationContext.physicalBasedRenderingEnabled=na;this.forEachGraphics3DSymbol((ya,Da,Oa)=>{ya.globalPropertyChanged("physicalBasedRenderingEnabled",Da)||this._recreateSymbol(Oa)})}_skipHighSymbolLoDsChange(na){this.symbolCreationContext.skipHighSymbolLods=na;this.forEachGraphics3DSymbol((ya,Da,Oa)=>{ya.globalPropertyChanged("skipHighSymbolLods",Da)||this._recreateSymbol(Oa)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((na,
ya,Da)=>{na.globalPropertyChanged("pixelRatio",ya)||this._recreateSymbol(Da)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=E.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(na,ya){const Da=this.symbolCreationContext.clippingExtent,Oa=N.create();pa.toBoundingRect(na,Oa,ya)?this.symbolCreationContext.clippingExtent=S.fromRect(S.create(),
Oa):this.symbolCreationContext.clippingExtent=null;return!S.equals(this.symbolCreationContext.clippingExtent,Da)}modifyGraphics3DGraphicVisibilities(na){if(!this.destroyed){var ya=!1;this.graphics3DGraphics.forEach(Da=>{na(Da)&&(ya=!0)});ya&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor?.setDirty())}}forEachGraphics3DSymbol(na){for(const [ya,Da]of this._symbols){if(null==Da)break;const Oa=this._graphicsBySymbol.get(ya);na(Da,Oa||Ia,ya)}}updateAllGraphicsVisibility(){null!=this._filterVisibility&&
this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(na=>{const ya=this._updateUserVisibility(na);na=null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(na);return ya||na})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(na=>na.setVisibilityFlag(da.VisibilityGroup.GRAPHIC,da.VisibilityFlag.USER,!1))}_validateRenderer(na){if(na=V.validateTo3D(na,{geometryType:this.layer?.geometryType})){const ya=`Renderer for layer '${this.layer.title?`${this.layer.title}, `:
""}, id:${this.layer.id}' is not supported in a SceneView`;r.getLogger(this).warn(ya,na.message)}}_cleanupSymbols(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var na=!1;this._symbols.forEach((ya,Da)=>{if(!(null==ya||0<ya.referenced)){var Oa=this._graphicsBySymbol.get(Da);Oa&&0!==Oa.size||(this._graphicsBySymbol.delete(Da),this._symbols.delete(Da),this._unusedSymbolsCache.put(Da,ya,wa.getSymbolMemorySize(ya),D.MinPriority),na=!0)}});na&&(this._recomputeExtentPadding(),
this.notifyChange("averageSymbolComplexity"))}}get test(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(na=>({symbolId:na,graphics:[...this._graphicsBySymbol.get(na).keys()].sort()})),graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,
filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:na=>{this._forcedUpdatePolicy=na}}}get performanceInfo(){return new oa.GraphicsCorePerformanceInfo(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}};a.Graphics3DCore.tmpVec=z.create();b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);b.__decorate([I.property()],
a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_frameTaskHandle",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_dataUpdateQueue",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_updateQueue",void 0);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);
b.__decorate([I.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_initializeAbortController",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_initializePromise",
void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_labeler",
void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"elevationFeatureExpressionEnabled",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"componentFactories",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"featureStore",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,"initializePromise",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,
"objectStates",null);b.__decorate([I.property()],a.Graphics3DCore.prototype,"filterVisibility",null);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"dataUpdating",null);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([I.property({readOnly:!0,dependsOn:[]})],
a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([I.property({readOnly:!0})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([I.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([I.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);b.__decorate([I.property()],a.Graphics3DCore.prototype,"_objectIdField",
null);a.Graphics3DCore=gb=b.__decorate([H.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var mb;(function(na){na[na.NEW=0]="NEW";na[na.LOADING=1]="LOADING";na[na.READY=2]="READY";na[na.REJECTED=3]="REJECTED"})(mb||={});class qb{constructor(){this.renderingInfo=this.add=null;this.state=mb.NEW;this.remove=this.abortController=null}clear(){this.renderingInfo=this.add=null;this.state=mb.NEW;this.remove=this.abortController=null}}const tb=z.create(),xa=z.create(),Ia=new Map;
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(a,b,n,h,k){function m(c){return null==c||"simple"===c.type||"unique-value"===c.type||"class-breaks"===c.type||"dictionary"===c.type||"heatmap"===c.type}function g(c,l){if(!l)return null;l=Array.isArray(l)?l:[l];if(0<l.length){const f=l.map(x=>x.details.symbol.type||
x.details.symbol.declaredClass).filter(x=>!!x);f.sort();const r=[];f.forEach((x,w)=>{0!==w&&x===f[w-1]||r.push(x)});return new h("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:c,symbolErrors:l})}return null}function e(c,l){const f={...k.defaultTo3DOptions,...l};l=c.uniqueValueInfos?.map(x=>k.to3D(x.symbol,f).error).filter(b.isSome);const r=k.to3D(c.defaultSymbol,f);r.error&&l?.unshift(r.error);return g(c,l)}function d(c){const l=
c.classBreakInfos.map(r=>k.to3D(r.symbol).error).filter(b.isSome),f=k.to3D(c.defaultSymbol);f.error&&l.unshift(f.error);return g(c,l)}a.isSupportedRenderer3D=m;a.validateTo3D=function(c,l){if(null==c)return null;if(!m(c))return new h("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${c.type||c.declaredClass}'`,{renderer:c});switch(c.type){case "simple":return g(c,k.to3D(c.symbol).error);case "unique-value":return e(c,l);case "class-breaks":return d(c)}return null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/Collection ../../core/has ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,n,h,k,m,g,e,d,c,l){const f=g.fromSimpleMarkerSymbol(c.defaultPointSymbol2D),r=k.fromSimpleLineSymbol(c.defaultPolylineSymbol2D),x=e.fromSimpleFillSymbol(c.defaultPolygonSymbol2D),w=new m({symbolLayers:new b([new h({material:{color:l.defaultColor},
edges:new d({size:"1px",color:l.defaultOutlineColor})})])});a.getDefaultSymbol3D=function(p){if(null==p)return null;switch(p.type){case "mesh":return w;case "point":case "multipoint":return f;case "polyline":return r;case "polygon":case "extent":return x}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){const p=l.create();a.Graphics3DFeatureStore=class extends n{constructor(q){super(q);this.events=new h;this.objectIdField=this.hasM=this.hasZ=null;this.featureAdapter={getAttribute(u,v){return"graphic"in u?u.graphic.attributes[v]:w.optimizedFeatureQueryEngineAdapter.getAttribute(u,v)},getAttributes(u){return"graphic"in u?u.graphic.attributes:w.optimizedFeatureQueryEngineAdapter.getAttributes(u)},getObjectId:u=>"graphic"in u?f.getObjectId(u.graphic,this.objectIdField)??
void 0:w.optimizedFeatureQueryEngineAdapter.getObjectId(u),getGeometry:u=>"graphic"in u?u.getAsOptimizedGeometry(this.hasZ,this.hasM):w.optimizedFeatureQueryEngineAdapter.getGeometry(u),getCentroid:(u,v)=>{if("graphic"in u){let y=null;null!=u.centroid?y=u.centroid:"point"===u.graphic.geometry.type&&c.projectPoint(u.graphic.geometry,t,this.viewSpatialReference)&&(y=t);u=Array(2+(v.hasZ?1:0)+(v.hasM?1:0));null==y?(u[0]=0,u[1]=0,u[2]=0,u[3]=0):(u[0]=y.x,u[1]=y.y,v.hasZ&&(u[2]=y.hasZ?y.z:0),v.hasM&&(u[v.hasZ?
3:2]=y.hasM?y.m:0));return new x([],u)}return w.optimizedFeatureQueryEngineAdapter.getCentroid(u,v)},cloneWithGeometry:(u,v)=>"graphic"in u?new r.OptimizedFeature(v,this.featureAdapter.getAttributes(u),null,this.featureAdapter.getObjectId(u)):w.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(u,v)}}forEachInBounds(q,u){this.getSpatialIndex().forEachInBounds(q,u)}forEachBounds(q,u){const v=this.getSpatialIndex();for(const y of q)q=this.featureAdapter.getObjectId(y),null!=v.getBounds(q,p)&&u(p)}};
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);
b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const t={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports",
"../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,n,h){a.optimizedFeatureQueryEngineAdapter={getObjectId(k){return k.objectId},getAttributes(k){return k.attributes},getAttribute(k,m){return k.attributes[m]},cloneWithGeometry(k,m){return new n.OptimizedFeature(m,k.attributes,null,k.objectId)},getGeometry(k){return k.geometry},getCentroid(k,m){null==k.centroid&&(k.centroid=b.getCentroidOptimizedGeometry(new h,k.geometry,m.hasZ,m.hasM));return k.centroid}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(a){function b(h,k,m,g,e,d){d=e?d?4:3:d?3:2;let c=m,l=m+d,f=0,r=0,x=m=0,w=0;for(let p=0,t=g-1;p<t;p++,c+=d,l+=d){g=k[c];const q=k[c+1],u=k[c+2],v=k[l],y=k[l+1],D=k[l+2];let G=g*y-v*q;x+=G;f+=(g+v)*G;r+=(q+y)*G;e&&(G=g*D-v*u,m+=(u+D)*G,w+=G);g<h[0]&&(h[0]=g);g>h[1]&&(h[1]=g);q<h[2]&&(h[2]=q);q>h[3]&&(h[3]=q);e&&(u<h[4]&&(h[4]=u),u>h[5]&&(h[5]=u))}0<x&&(x*=-1);0<w&&(w*=-1);if(!x)return null;
h=[f,r,.5*x];e&&(h[3]=m,h[4]=.5*w);return h}function n(h,k,m,g,e){e=g?e?4:3:e?3:2;let d=k,c=k+e,l=0,f=0,r=0,x=0;for(let q=0,u=m-1;q<u;q++,d+=e,c+=e){var w=h[d];const v=h[d+1],y=h[d+2],D=h[c],G=h[c+1],A=h[c+2];if(g){var p=D-w;var t=G-v;const C=A-y;p=Math.sqrt(p*p+t*t+C*C)}else p=D-w,t=G-v,p=Math.sqrt(p*p+t*t);p&&(l+=p,g?(w=[w+.5*(D-w),v+.5*(G-v),y+.5*(A-y)],f+=p*w[0],r+=p*w[1],x+=p*w[2]):(w=[w+.5*(D-w),v+.5*(G-v)],f+=p*w[0],r+=p*w[1]))}return 0<l?g?[f/l,r/l,x/l]:[f/l,r/l]:0<m?g?[h[k],h[k+1],h[k+2]]:
[h[k],h[k+1]]:null}a.getCentroidOptimizedGeometry=function(h,k,m,g){if(!k?.lengths.length)return null;h.lengths.length&&(h.lengths.length=0);h.coords.length&&(h.coords.length=0);const e=h.coords,d=[],c=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:f}=k;var r=m?g?4:3:g?3:2;
let x=0;for(const w of l){const p=b(c,f,x,w,m,g);p&&d.push(p);x+=w*r}d.sort((w,p)=>{let t=w[2]-p[2];0===t&&m&&(t=w[4]-p[4]);return t});d.length&&(r=6*d[0][2],e[0]=d[0][0]/r,e[1]=d[0][1]/r,m&&(r=6*d[0][4],e[2]=0!==r?d[0][3]/r:0),e[0]<c[0]||e[0]>c[1]||e[1]<c[2]||e[1]>c[3]||m&&(e[2]<c[4]||e[2]>c[5]))&&(e.length=0);if(!e.length)if(k=k.lengths[0]?n(f,0,l[0],m,g):null)e[0]=k[0],e[1]=k[1],m&&2<k.length&&(e[2]=k[2]);else return null;return h};a.lineCentroid=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,n){a.make=function(h,k,m){switch(h.type){case "point-3d":return new b.Graphics3DPointSymbol(h,k,m);default:return new n.Graphics3DSymbol(h,k,m)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("exports ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,b,n,h,k,m,g){class e extends g.Graphics3DSymbol{constructor(d,c,l){super(d,c,l);this._calloutSymbolLayer=null;this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=k.make(this.symbol,c))}async doLoad(d){const c=this._calloutSymbolLayer?b.result(this._calloutSymbolLayer.load()):null;try{await super.doLoad(d),h.throwIfAborted(d)}catch(l){throw this._calloutSymbolLayer?.abortLoad(),l;}c&&await c}destroy(){super.destroy();this._calloutSymbolLayer=n.destroyMaybe(this._calloutSymbolLayer)}createGraphics3DGraphic(d,
c){c=super.createGraphics3DGraphic(d,c);null!=this._calloutSymbolLayer&&null!=c&&(d=this._createCalloutGraphic(d))&&c.setCalloutGraphic(d);return c}globalPropertyChanged(d,c){return super.globalPropertyChanged(d,c)?this._calloutSymbolLayer?this._calloutSymbolLayer.globalPropertyChanged(d,c,l=>l.calloutLayer):!0:!1}updateGeometry(d,c){const l=super.updateGeometry(d,c);return l&&this._calloutSymbolLayer&&(d=d.calloutLayer)?this._calloutSymbolLayer.updateGeometry(d,c):l}_createCalloutGraphic(d){const c=
d.renderingInfo;d.renderingInfo=new m.LineCalloutSymbolLayerRenderingInfo(c.renderer,c.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(d)}}a.Graphics3DPointSymbol=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsCorePerformanceInfo":function(){define(["exports"],function(a){class b{constructor(n,h,k){this.visible=n;this.missing=h;this.pending=k}}a.GraphicsCorePerformanceInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../layers/graphics/dehydratedFeatures"],function(a,b,n,h){class k{constructor(m){this._graphicsCore=m;this._idToState=new Map;this._states=new Set;const g=m.owner.layer?.objectIdField;g?(this._getGraphicId=e=>h.getObjectId(e,g),this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicByObjectId(e)):(this._getGraphicId=e=>e.uid,this._getGraphics3DGraphicById=
e=>this._graphicsCore.getGraphics3DGraphicById(e))}destroy(){this._idToState.clear();this._states.forEach((m,g)=>this.remove(g))}add(m){const g=n.makeHandle(()=>this.remove(m));if(this._states.has(m))return g;const e=this._getGraphicId(m.graphic),d=this._getGraphics3DGraphicById(e);this._states.has(m)||this._states.add(m);this._ensureStateList(e).push(m);m.displaying=null!=d?d.isVisible():!1;m.isDraped=null!=d?d.isDraped:!1;m.tracking=!0;null!=d&&m.emit("changed");return g}remove(m){if(this._states.has(m)){if(this._idToState.size){const g=
this._getGraphicId(m.graphic),e=this._idToState.get(g);e&&(b.remove(e,m),0===e.length&&this._idToState.delete(g))}this._states.delete(m);m.tracking=!1;m.displaying=!1}}addGraphic(m){this._forEachState(m,g=>{g.displaying=m.isVisible();g.isDraped=m.isDraped;g.emit("changed")})}removeGraphic(m){this._forEachState(m,g=>{g.displaying=!1;g.isDraped=!1})}updateGraphicGeometry(m){this._forEachState(m,g=>g.emit("changed"))}updateGraphicVisibility(m){this._forEachState(m,g=>g.displaying=m.isVisible())}allGraphicsDeleted(){this._states.forEach(m=>
m.displaying=!1)}_ensureStateList(m){var g=this._idToState.get(m);if(g)return g;g=[];this._idToState.set(m,g);return g}_forEachState(m,g){0!==this._states.size&&0!==this._idToState.size&&(m=this._getGraphicId(m.graphic),m=this._idToState.get(m),null!=m&&m.forEach(g))}}a.GraphicStateTracking=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){a.SpatialIndex2D=class extends n{constructor(x){super(x);this._index=new c.PooledRBush(9,h("esri-csp-restrictions")?w=>({minX:w.extent[0],minY:w.extent[1],maxX:w.extent[2],maxY:w.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);this._missing=new Set;this._boundsByFeature=new Map;this.objectIdField=this.hasM=this.hasZ=this.spatialReference=null;this.updating=!1}setup(x){this._addMany(x)}destroy(){this._missing.clear();this._index=k.destroyMaybe(this._index);
this._boundsByFeature.clear();this._boundsByFeature=null}update(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(x,w,p){null!=w&&w.equals(this.spatialReference)&&(r.minX=x[0],r.minY=x[1],r.maxX=x[2],r.maxY=x[3],this.update(),this._index.search(r,t=>p(t.graphic.uid)))}add(x){this._missing.add(x);this.updating=!0}remove(x){this._missing.delete(x)?this.updating=
0<this._missing.size:(this._index.remove(x),x=f.getObjectId(x.graphic,this._get("objectIdField")),null!=x&&this._boundsByFeature.delete(x))}_addMany(x){if(0!==x.length){var w=this._get("objectIdField");for(const p of x){p.computeExtent(this.spatialReference);const t=f.getObjectId(p.graphic,w);null!=t&&this._boundsByFeature.set(t,p.extent)}this._index.load(x)}}clear(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();this.updating=!1}forEachInBounds(x,w){r.minX=x[0];r.minY=x[1];
r.maxX=x[2];r.maxY=x[3];this.update();this._index.search(r,p=>{w(p)})}getBounds(x,w){this.update();return(x=this._boundsByFeature.get(x))?l.fromRect(w,x):null}};b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasZ",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"objectIdField",void 0);b.__decorate([m.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([m.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([d.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const r={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../PooledArray",
"../../../chunks/quickselect"],function(a,b,n,h){function k(A,C){m(A,0,A.children.length,C,A)}function m(A,C,E,I,H){H||=new D([]);H.minX=Infinity;H.minY=Infinity;H.maxX=-Infinity;H.maxY=-Infinity;for(let J=C,B;J<E;J++)B=A.children[J],g(H,A.leaf?I(B):B);return H}function g(A,C){A.minX=Math.min(A.minX,C.minX);A.minY=Math.min(A.minY,C.minY);A.maxX=Math.max(A.maxX,C.maxX);A.maxY=Math.max(A.maxY,C.maxY)}function e(A,C){return A.minX-C.minX}function d(A,C){return A.minY-C.minY}function c(A){return(A.maxX-
A.minX)*(A.maxY-A.minY)}function l(A){return A.maxX-A.minX+(A.maxY-A.minY)}function f(A,C){return A.minX<=C.minX&&A.minY<=C.minY&&C.maxX<=A.maxX&&C.maxY<=A.maxY}function r(A,C){return C.minX<=A.maxX&&C.minY<=A.maxY&&C.maxX>=A.minX&&C.maxY>=A.minY}function x(A,C,E,I,H){for(C=[C,E];C.length;){E=C.pop();const J=C.pop();if(E-J<=I)continue;const B=J+Math.ceil((E-J)/I/2)*I;h.quickselect(A,B,J,E,H);C.push(J,B,B,E)}}class w{constructor(A=9,C){this._compareMinX=e;this._compareMinY=d;this._toBBox=E=>E;this._maxEntries=
Math.max(4,A||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));C&&("function"===typeof C?this._toBBox=C:this._initFormat(C));this.clear()}destroy(){this.clear();p.prune();t.prune();q.prune();u.prune()}all(A){this._all(this._data,A)}search(A,C){let E=this._data;const I=this._toBBox;if(r(A,E))for(p.clear();E;){for(let H=0,J=E.children.length;H<J;H++){const B=E.children[H],z=E.leaf?I(B):B;r(A,z)&&(E.leaf?C(B):f(A,z)?this._all(B,C):p.push(B))}E=p.pop()}}collides(A){let C=this._data;const E=
this._toBBox;if(!r(A,C))return!1;for(p.clear();C;){for(let I=0,H=C.children.length;I<H;I++){const J=C.children[I],B=C.leaf?E(J):J;if(r(A,B)){if(C.leaf||f(A,B))return!0;p.push(J)}}C=p.pop()}return!1}load(A){if(!A.length)return this;if(A.length<this._minEntries){for(let C=0,E=A.length;C<E;C++)this.insert(A[C]);return this}A=this._build(A.slice(0,A.length),0,A.length-1,0);if(this._data.children.length)if(this._data.height===A.height)this._splitRoot(this._data,A);else{if(this._data.height<A.height){const C=
this._data;this._data=A;A=C}this._insert(A,this._data.height-A.height-1,!0)}else this._data=A;return this}insert(A){A&&this._insert(A,this._data.height-1);return this}clear(){this._data=new D([]);return this}remove(A){if(!A)return this;let C=this._data,E=null,I=0,H=!1,J;const B=this._toBBox(A);q.clear();for(u.clear();C||0<q.length;){C||(C=q.pop(),E=q.data[q.length-1],I=u.pop()??0,H=!0);if(C.leaf&&(J=b.indexOf(C.children,A,C.children.length,C.indexHint),-1!==J)){C.children.splice(J,1);q.push(C);this._condense(q);
break}H||C.leaf||!f(C,B)?E?(I++,C=E.children[I],H=!1):C=null:(q.push(C),u.push(I),I=0,E=C,C=C.children[0])}return this}toJSON(){return this._data}fromJSON(A){this._data=A;return this}_all(A,C){for(t.clear();A;){if(!0===A.leaf)for(const E of A.children)C(E);else t.pushArray(A.children);A=t.pop()??null}}_build(A,C,E,I){var H=E-C+1,J=this._maxEntries;if(H<=J)return A=new D(A.slice(C,E+1)),k(A,this._toBBox),A;I||(I=Math.ceil(Math.log(H)/Math.log(J)),J=Math.ceil(H/J**(I-1)));const B=new G([]);B.height=
I;H=Math.ceil(H/J);J=H*Math.ceil(Math.sqrt(J));for(x(A,C,E,J,this._compareMinX);C<=E;C+=J){const z=Math.min(C+J-1,E);x(A,C,z,H,this._compareMinY);for(let K=C;K<=z;K+=H)B.children.push(this._build(A,K,Math.min(K+H-1,z),I-1))}k(B,this._toBBox);return B}_chooseSubtree(A,C,E,I){for(;;){I.push(C);if(!0===C.leaf||I.length-1===E)break;let H=Infinity,J=Infinity,B=void 0;for(let z=0,K=C.children.length;z<K;z++){const L=C.children[z],F=c(L),M=(Math.max(L.maxX,A.maxX)-Math.min(L.minX,A.minX))*(Math.max(L.maxY,
A.maxY)-Math.min(L.minY,A.minY))-F;M<J?(J=M,H=F<H?F:H,B=L):M===J&&F<H&&(H=F,B=L)}C=B||C.children[0]}return C}_insert(A,C,E){var I=this._toBBox;E=E?A:I(A);q.clear();I=this._chooseSubtree(E,this._data,C,q);I.children.push(A);for(g(I,E);0<=C;)if(q.data[C].children.length>this._maxEntries)this._split(q,C),C--;else break;this._adjustParentBBoxes(E,q,C)}_split(A,C){const E=A.data[C];var I=E.children.length;const H=this._minEntries;this._chooseSplitAxis(E,H,I);(I=this._chooseSplitIndex(E,H,I))?(I=E.children.splice(I,
E.children.length-I),I=E.leaf?new D(I):new G(I),I.height=E.height,k(E,this._toBBox),k(I,this._toBBox),C?A.data[C-1].children.push(I):this._splitRoot(E,I)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(A,C){this._data=new G([A,C]);this._data.height=A.height+1;k(this._data,this._toBBox)}_chooseSplitIndex(A,C,E){let I,H,J=void 0;I=H=Infinity;for(let z=C;z<=E-C;z++){var B=m(A,0,z,this._toBBox);const K=m(A,z,E,this._toBBox),L=Math.max(0,Math.min(B.maxX,
K.maxX)-Math.max(B.minX,K.minX))*Math.max(0,Math.min(B.maxY,K.maxY)-Math.max(B.minY,K.minY));B=c(B)+c(K);L<I?(I=L,J=z,H=B<H?B:H):L===I&&B<H&&(H=B,J=z)}return J}_chooseSplitAxis(A,C,E){const I=A.leaf?this._compareMinX:e,H=A.leaf?this._compareMinY:d,J=this._allDistMargin(A,C,E,I);C=this._allDistMargin(A,C,E,H);J<C&&A.children.sort(I)}_allDistMargin(A,C,E,I){A.children.sort(I);I=this._toBBox;var H=m(A,0,C,I);const J=m(A,E-C,E,I);let B=l(H)+l(J);for(let z=C;z<E-C;z++){const K=A.children[z];g(H,A.leaf?
I(K):K);B+=l(H)}for(E=E-C-1;E>=C;E--)H=A.children[E],g(J,A.leaf?I(H):H),B+=l(J);return B}_adjustParentBBoxes(A,C,E){for(;0<=E;E--)g(C.data[E],A)}_condense(A){for(let C=A.length-1;0<=C;C--){const E=A.data[C];if(0===E.children.length)if(0<C){const I=A.data[C-1],H=I.children;H.splice(b.indexOf(H,E,H.length,I.indexHint),1)}else this.clear();else k(E,this._toBBox)}}_initFormat(A){const C=["return a"," - b",";"];this._compareMinX=new Function("a","b",C.join(A[0]));this._compareMinY=new Function("a","b",
C.join(A[1]));this._toBBox=new Function("a","return {minX: a"+A[0]+", minY: a"+A[1]+", maxX: a"+A[2]+", maxY: a"+A[3]+"};")}}const p=new n,t=new n,q=new n,u=new n({deallocator:void 0});class v{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class y extends v{constructor(){super(...arguments);this.height=1;this.indexHint=new b.PositionHint}}class D extends y{constructor(A){super();this.children=A;this.leaf=!0}}class G extends y{constructor(A){super();this.children=A;this.leaf=
!1}}a.BBox=v;a.PooledRBush=w;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(a,b){var n={exports:{}};(function(h){(function(k){k=k();void 0!==k&&(h.exports=k)})(function(){function k(e,d,c,l,f){for(;l>c;){if(600<l-c){var r=l-c+1,x=d-c+1,w=Math.log(r),p=.5*Math.exp(2*w/3);w=.5*Math.sqrt(w*p*(r-p)/r)*(0>x-r/2?-1:1);k(e,d,Math.max(c,Math.floor(d-x*p/r+w)),Math.min(l,Math.floor(d+(r-x)*p/r+w)),f)}r=e[d];
x=c;p=l;m(e,c,d);for(0<f(e[l],r)&&m(e,c,l);x<p;){m(e,x,p);x++;for(p--;0>f(e[x],r);)x++;for(;0<f(e[p],r);)p--}0===f(e[c],r)?m(e,c,p):(p++,m(e,p,l));p<=d&&(c=p+1);d<=p&&(l=p-1)}}function m(e,d,c){var l=e[d];e[d]=e[c];e[c]=l}function g(e,d){return e<d?-1:e>d?1:0}return function(e,d,c,l,f){k(e,d,c||0,l||e.length-1,f||g)}})})(n);b=b.getDefaultExportFromCjs(n.exports);a.quickselect=b})},"esri/views/3d/layers/graphics/symbolMemory":function(){define(["exports"],function(a){a.getSymbolMemorySize=function(b){return 2216+
4096*b.symbolLayers.length+b.complexity.memory.resourceBytes};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/unitConversionUtils ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){const u=Symbol("layerHandles");a.StageLayerElevationProvider=class extends h.EventedMixin(n){get spatialReference(){return this.view?.spatialReference}constructor(C){super(C);this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=p.newIntersector(this.view.state.viewingMode);this._intersector.options.store=t.StoreResults.MIN;var C=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=C[2];this._zmax=C[5];C=this.stageLayer.events;this.addHandles([C.on(["layerObjectAdded","layerObjectRemoved","geometryAdded","geometryRemoved"],({object:E})=>this._objectChanged(E)),C.on("attributesChanged",({attribute:E,object:I})=>q.affectsGeometry(E)&&this._objectChanged(I)),C.on(["transformationChanged","shaderTransformationChanged"],E=>this._objectChanged(E))],u)}dispose(){this.removeHandles(u)}elevationInfoChanged(){const C=null!=this.layer?this.layer.elevationInfo:
null;if(null!=C&&"on-the-ground"!==C.mode){const E=m.getMetersPerVerticalUnitForSR(this.layer.spatialReference),I=x.getMetersPerUnit(C.unit??"meters");this._elevationOffset=(C.offset??0)*I/E}else this._elevationOffset=0}getElevation(C,E,I,H){D[0]=C;D[1]=E;D[2]=I;if(!this._renderCoordsHelper.toRenderCoords(D,H,D))return k.getLogger(this).error("could not project point for elevation alignment"),null;C=this._elevationOffset;E=this._zmin+C;this._renderCoordsHelper.setAltitude(G,this._zmax+C,D);this._renderCoordsHelper.setAltitude(A,
E,D);this._intersector.reset(G,A,null);this._intersector.intersect(this._intersectLayers,null,1,null,J=>!!J.lastValidElevationBB);return this._intersector.results.min.getIntersectionPoint(D)?this._renderCoordsHelper.getAltitude(D):null}_objectChanged(C){const E=this.spatialReference;if(C.lastValidElevationBB&&E){r.empty(v);var I=C.lastValidElevationBB;I.isEmpty()||this._expandExtent(E,I.min,I.max,v);var {min:H,max:J}=C.boundingVolumeWorldSpace;this._expandExtent(E,H,J,v);r.toRect(v,y.extent);this._zmin=
Math.min(this._zmin,v[2]);this._zmax=Math.max(this._zmax,v[5]);y.spatialReference=E;this.emit("elevation-change",y);l.copy(I.min,H);l.copy(I.max,J)}}_computeLayerExtent(C,E){r.empty(v);null!=C&&E.objects.forAll(I=>this._expandExtent(C,I.boundingVolumeWorldSpace.min,I.boundingVolumeWorldSpace.max,v));return v}_expandExtent(C,E,I,H){for(let J=0;8>J;++J)D[0]=J&1?E[0]:I[0],D[1]=J&2?E[1]:I[1],D[2]=J&4?E[2]:I[2],this._renderCoordsHelper.fromRenderCoords(D,D,C),r.expandWithVec3(H,D);return H}};b.__decorate([g.property({constructOnly:!0})],
a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([g.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"stageLayer",void 0);b.__decorate([g.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([g.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=b.__decorate([c.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);
const v=r.empty(),y=new w.ElevationUpdateEvent,D=f.create(),G=f.create(),A=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(w){return null==w?r.TaskPriority.ELEVATION_ALIGNMENT:"relative-to-scene"===w?r.TaskPriority.ELEVATION_ALIGNMENT_SCENE:r.TaskPriority.ELEVATION_ALIGNMENT}a.Graphics3DElevationAlignment=class extends n{constructor(w){super(w);this._dirtyExtents=new l.ExtentSet;this._globalDirty=!1;this._averageExtentUpdateSize=0;this._dirtyGraphicsSet=new Set;this._updateElevation=!1;this.graphicsCore=this.graphicsCoreOwner=null;this.events=new h}initialize(){const w=this.elevationProvider;
this._task=this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x(this.graphicsCore.layer.elevationInfo?.mode),this);this.addHandles([w.on("elevation-change",p=>this._elevationChanged(p)),k.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,k.watch(()=>x(this.graphicsCore.layer.elevationInfo?.mode),p=>this._task.priority=p)])}destroy(){this._dirtyGraphicsSet.clear();this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=
null}clear(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0;this.notifyChange("updating")}get updating(){return this.running}get running(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+
this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(w){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,w.madeProgress());for(w.run(()=>this._dirtyExtents.merge(w));this.running&&!w.done;)this._updateDirtyGraphics(w),this._updateDirtyExtents(w);this.notifyChange("updating")}_updateDirtyGraphics(w){const p=this.graphicsCoreOwner.view.renderCoordsHelper,t=this.graphicsCore.effectiveUpdatePolicy===f.UpdatePolicy.ASYNC;for(const q of this._dirtyGraphicsSet.keys()){const u=
this.graphicsCore.getGraphics3DGraphicById(q);this._dirtyGraphicsSet.delete(q);null!=u&&(u.alignWithElevation(this.elevationProvider,p,t),this.graphicsCoreOwner.view.deconflictor.setDirty(),w.madeProgress());if(w.done)break}}_updateDirtyExtents(w){for(;!this._dirtyExtents.empty&&!w.done;){const p=this._dirtyExtents.pop(),t=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:p,spatialReference:t});const q=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(p,
t,u=>{const v=this.graphicsCore.getGraphics3DGraphicById(u);null!=v&&v.needsElevationUpdates()&&this._dirtyGraphicsSet.add(u)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-q)+.9*this._averageExtentUpdateSize;w.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear();this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((w,p)=>this._dirtyGraphicsSet.add(p))}_elevationChanged(w){if("scene"!==w.context||this.graphicsCore.layer.elevationInfo&&
"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var p=w.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const t=this.graphicsCore.computedExtent;t&&p[2]>t.xmin&&p[0]<t.xmax&&p[3]>t.ymin&&p[1]<t.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",w)}else-Infinity===p[0]?this._globalDirty=!0:this._dirtyExtents.add(p),this.notifyChange("updating")}}};b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCoreOwner",
void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"graphicsCore",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([m.property()],a.Graphics3DElevationAlignment.prototype,"elevationProvider",void 0);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updating",null);b.__decorate([m.property({readOnly:!0})],a.Graphics3DElevationAlignment.prototype,"updatingRemaining",
null);a.Graphics3DElevationAlignment=b.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],a.Graphics3DElevationAlignment);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,n,h){class k{constructor(){this._extents=new b({allocator:m=>m||n.create()});this._tmpExtent=
n.create();this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(m){this._contains(m)||(this._removeContained(m),n.copy(this._extents.pushNew(),m),this._dirty=!0)}pop(){this._dirty&&this._mergeTight();return this._extents.pop()}merge(m){this._mergeTight(m);return m.hasProgressed}_mergeTight(m=h.noBudget){const g=this._extents,e=new Set;let d=0;for(;d!==g.length;){g.sort((c,l)=>c[0]-l[0]);d=g.length;e.clear();for(let c=0;c<
g.length;++c){if(m.done)return;const l=g.at(c);if(l){for(let f=c+1;f<g.length;++f){const r=g.at(f);if(null==r||r[0]>=l[2])break;e.add(r)}e.forEach(f=>{if(l!==f)if(f[2]<=l[0])e.delete(f);else{var r=n.area(l),x=n.area(f),w=this._tmpExtent;n.expand(l,f,w);r+=x;.05>(n.area(w)-r)/r&&(n.copy(l,w),e.delete(f),g.remove(f),m.madeProgress())}});e.add(l)}}}this._dirty=!1}_contains(m){return this._extents.some(g=>n.contains(g,m))}_removeContained(m){this._extents.filterInPlace(g=>!n.contains(m,g))}get test(){const m=
this;return{containsPoint:g=>m._extents.some(e=>n.containsPoint(e,g))}}}a.ExtentSet=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){a.Graphics3DFrustumVisibility=class extends n{constructor(x){super(x);this.suspended=!1;this._extent=null;this._extentIntersectionDirty=!0;this._isVisibleBelowSurfaceInternal=!1;this.graphicsCoreOwner=null;this.updating=!0}initialize(){var {graphicsCoreOwner:x}=this;this._extentIntersection=new l.FrustumExtentIntersection({renderCoordsHelper:x.view.renderCoordsHelper});const w=x.view,p=w.basemapTerrain;x=w.resourceController.scheduler;this.addHandles([w.on("resize",
()=>this._viewChange()),h.watch(()=>w.state.camera,()=>this._viewChange(),h.sync),x.registerTask(f.TaskPriority.FRUSTUM_VISIBILITY,this),h.watch(()=>p.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===w.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([h.watch(()=>[p.baseOpacity,p.wireframe,w.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),h.initial)])}destroy(){this._set("graphicsCoreOwner",null);this._extentIntersection=this._extent=
null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(x){this._extent=x;this._extentIntersectionDirty=!0;this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty();this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(x){this._isVisibleBelowSurfaceInternal=x;this._setDirty();this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){const x=this.graphicsCoreOwner.view,w=x.basemapTerrain,p="none"===x.map.ground?.navigationConstraint?.type;this._isVisibleBelowSurface=
"local"===x.viewingMode||!w.opaque||p}_updateExtentIntersection(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var x=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var w=-.3*c.getReferenceEllipsoid(x.spatialReference).radius;else{const {min:p,max:t}=x.basemapTerrain.visibleElevationBounds;w=p-Math.max(1,(t-p)*(1.2-1))}this._extentIntersection.update(this._extent,x.spatialReference,w)}}get running(){return this.updating}runTask(x){this._set("updating",!1);
if(!this._extent)return this._set("suspended",!1),r.Yield;this._updateExtentIntersection();const w=this.graphicsCoreOwner.view.frustum,p=c.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(w,p));x.madeProgress()}};b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"suspended",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"graphicsCoreOwner",
void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DFrustumVisibility.prototype,"updating",void 0);a.Graphics3DFrustumVisibility=b.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],a.Graphics3DFrustumVisibility);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,b,n){class h{constructor(k){this._graphicsCore=
k;this._stateSets=[]}destroy(){this.reset();this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(k=>k.objectStateSet.removeAll()),this._stateSets.length=0)}acquireSet(k,m){const g=new n.Graphics3DObjectStateSet(k,m);this._stateSets.push(g);k=b.makeHandle(()=>this.releaseSet(g));return{set:g,handle:k}}releaseSet(k){k.objectStateSet.removeAll();k=this._stateSets?this._stateSets.indexOf(k):-1;-1!==k&&this._stateSets.splice(k,1)}_addObjectStateSet(k,m){k.addObjectStateSet(m.stateType,
m.objectStateSet)}_removeObjectStateSet(k,m){k.removeObjectState(m.objectStateSet)}setUid(k,m){k.ids.add(m);(m=this._graphicsCore.graphics3DGraphics.get(m))&&this._addObjectStateSet(m,k)}setUids(k,m){m.forEach(g=>this.setUid(k,g))}setObjectIds(k,m){m.forEach(g=>k.ids.add(g));this._initializeSet(k)}addGraphic(k){this._stateSets.forEach(m=>{!m.paused&&m.hasGraphic(k)&&this._addObjectStateSet(k,m)})}removeGraphic(k){this._stateSets.forEach(m=>{m.hasGraphic(k)&&this._removeObjectStateSet(k,m)})}allGraphicsDeleted(){this._stateSets&&
this._stateSets.forEach(k=>k.objectStateSet.removeAll())}_initializeSet(k){const m=this._graphicsCore.graphics3DGraphics;k.objectIdField?m.forEach(g=>{g&&k.hasGraphic(g)&&this._addObjectStateSet(g,k)}):k.ids.forEach(g=>{(g=m.get(g))&&this._addObjectStateSet(g,k)})}get test(){return{states:this._stateSets}}}a.Graphics3DObjectStates=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],
function(a,b){class n{constructor(h,k){this.stateType=h;this.objectIdField=k;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}hasGraphic(h){return this.objectIdField?this.ids.has(h.graphic.attributes[this.objectIdField]):this.ids.has(h.graphic.uid)}}a.Graphics3DObjectStateSet=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var n;(function(k){k[k.Object=
0]="Object";k[k.RenderGeometry=1]="RenderGeometry";k[k.External=2]="External";k[k.COUNT=3]="COUNT"})(n||={});class h{constructor(){this._items=[]}addObject(k,m){this._items.push({type:n.Object,objectStateId:m,object:k})}addRenderGeometry(k,m,g){this._items.push({type:n.RenderGeometry,objectStateId:m,renderGeometry:k,owner:g})}addExternal(k,m){this._items.push({type:n.External,objectStateId:m,remove:k})}remove(k){for(let m=this._items.length-1;0<=m;--m){const g=this._items[m];g.objectStateId===k&&
(this._removeObjectStateItem(g),this._items.splice(m,1))}}removeObject(k){for(let m=this._items.length-1;0<=m;--m){const g=this._items[m];g.type===n.Object&&g.object===k&&(this._removeObjectStateItem(g),this._items.splice(m,1))}}removeRenderGeometry(k){for(let m=this._items.length-1;0<=m;--m){const g=this._items[m];g.type===n.RenderGeometry&&g.renderGeometry===k&&(this._removeObjectStateItem(g),this._items.splice(m,1))}}removeAll(){this._items.forEach(k=>{this._removeObjectStateItem(k)});this._items=
[]}_removeObjectStateItem(k){switch(k.type){case n.Object:k.objectStateId.channel===b.Object3DState.Highlight?k.object.removeHighlight(k.objectStateId):k.objectStateId.channel===b.Object3DState.MaskOccludee&&k.object.removeOcclude(k.objectStateId);break;case n.RenderGeometry:k.owner.removeRenderGeometryObjectState(k.renderGeometry,k.objectStateId);break;case n.External:k.remove(k.objectStateId)}}}a.Object3DStateSet=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectBoundingRect ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){a.Graphics3DScaleVisibility=class extends n{constructor(t){super(t);this._layerScaleRangeVisibilityQuery=this._scaleRangeActive=!1;this._extent=null;this._updatingHandles=new d.UpdatingHandles;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=null;this.layerScaleEnabled=!0;this.suspended=!1;this._dirty=!0}initialize(){this.updateScaleRangeActive();this.addHandles(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(x.TaskPriority.SCALE_VISIBILITY,
this));this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy();this.removeHandles();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(t){const q=this.graphicsCoreOwner.view.spatialReference,u=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
if(q===u)this._extent=t??null;else{const v=l.create();c.projectBoundingRect(t,q,v,u)?this._extent=v:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){var t=this.layer,q=t.effectiveScaleRange;q=this.layerScaleEnabled&&null!=q&&(0<q.minScale||0<q.maxScale);t.labelingInfo&&!q&&(q=t.labelingInfo.some(u=>u&&(0<(u.minScale??0)||0<(u.maxScale??0))));t=this._scaleRangeActive!==q;(this._scaleRangeActive=q)&&!this.hasHandles("terrain-events")&&this.basemapTerrain?
(this.addHandles(this.basemapTerrain.on("scale-change",u=>this._scaleUpdateHandler(u)),"terrain-events"),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!q&&this.hasHandles("terrain-events")&&this.removeHandles("terrain-events");return t}get running(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(t){const q=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&q&&q.ready&&this._scaleRangeActive&&
this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return w.Yield;this._layerScaleRangeVisibilityQuery=!0;const {minScale:u,maxScale:v}=this.layer.effectiveScaleRange;q.queryVisibleScaleRange(this._extent,u,v,y=>this._finishUpdate(y))}else this._finishUpdate(!0);t.madeProgress()}_finishUpdate(t){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!t);this._dirty=!1}_visibleAtLayerScale(t){const q=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||r.scaleBoundsPredicate(t,
q.minScale||0,q.maxScale||0)}_visibleAtLabelScale(t,q){return r.scaleBoundsPredicate(t,q.minScale||0,q.maxScale||0)}_graphicScale(t){let q;null!=t.centroid?q=t.centroid:null!=t.graphic.geometry&&"point"===t.graphic.geometry.type&&(q=t.graphic.geometry);return q?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(q):1:null}_graphicVisible(t){if(!this.layerScaleEnabled)return!0;t=this._graphicScale(t);return this._visibleAtLayerScale(t)}updateVisibility(t){if(this._scaleRangeActive){const q=
this._graphicVisible(t);return t.setVisibilityFlag(f.VisibilityGroup.GRAPHIC,f.VisibilityFlag.SCALE_RANGE,q)}return!1}updateGraphicLabelScaleVisibility(t){if(!this._scaleRangeActive||!t.labelLayers||0===t.labelLayers.length)return!1;const q=this._graphicScale(t);if(t=this._updateLabelScaleVisibility(t,q))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();return t}_updateLabelScaleVisibility(t,q){if(!t.labelLayers||0===t.labelLayers.length)return!1;const u=
t.labelLayers[0]._labelClass;return null!=u?.minScale&&null!=u.maxScale&&(q=this._visibleAtLabelScale(q,u),t.setVisibilityFlag(f.VisibilityGroup.LABEL,f.VisibilityFlag.SCALE_RANGE,q))?!0:!1}_scaleUpdateHandler(t){this._setDirty();if(this.graphicsCore.visible){var q=t.extent,u=t.scale,v=this._visibleAtLayerScale(u),y=!1,D=this.graphicsCoreOwner.view.spatialReference;t=t.spatialReference;if(null==t)h.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var G=
!t.equals(D);G&&!c.projectBoundingRect(q,t,p,D)?h.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+t+" to wkid "+D):(this.queryGraphicUIDsInExtent(G?p:q,D,A=>{A=this.graphicsCore.getGraphics3DGraphicById(A);if(null!=A){var C=A.centroid;null!=C&&(q[0]>C.x||q[1]>C.y||q[2]<C.x||q[3]<C.y)||(A.setVisibilityFlag(f.VisibilityGroup.GRAPHIC,f.VisibilityFlag.SCALE_RANGE,v)&&(y=!0),this._updateLabelScaleVisibility(A,u)&&(y=!0))}}),y&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),
this.graphicsCoreOwner.view.labeler.setDirty()))}}}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(f.VisibilityGroup.GRAPHIC,f.VisibilityFlag.SCALE_RANGE,!0)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()}};b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCoreOwner",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,
"layer",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"queryGraphicUIDsInExtent",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"graphicsCore",void 0);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"basemapTerrain",void 0);b.__decorate([k.property({constructOnly:!0})],a.Graphics3DScaleVisibility.prototype,"layerScaleEnabled",void 0);b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"suspended",void 0);
b.__decorate([k.property({readOnly:!0})],a.Graphics3DScaleVisibility.prototype,"updating",null);b.__decorate([k.property()],a.Graphics3DScaleVisibility.prototype,"_dirty",void 0);a.Graphics3DScaleVisibility=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],a.Graphics3DScaleVisibility);const p=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=
function(b,n,h){if(!h||null==n)return null;if(!b){a:{b=h.toLowerCase();for(var k in n)if(k.toLowerCase()===b){n=n[k];break a}n=null}return n}return(k=b.get(h))?n[k.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/support/UpdatingHandles ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler ../../../support/Yield".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){a.FeatureVisibilityFilter=class extends n{constructor(u){super(u);this._queryEngine=this._frameTask=this._updateTask=null;this._updateRequested=!0;this._updatingHandles=new r.UpdatingHandles;this._updateVisibility=async v=>{if(null==this._compositedFeatureFilter&&null==this._sceneFilter||0===this.context.getFeatureCount())return this._frameTask.schedule(()=>this.clear(),v);try{const y=await this._queryEngine.executeQueryForIdSet(this._compositedFeatureFilter,
this._sceneFilter,v);return this._frameTask.schedule(()=>{this.context.updateFeatureVisibilities(D=>y.has(D))},v)}catch(y){return g.throwIfAbortError(y),k.getLogger(this).warn(`FeatureFilter query failed: ${y}`,{error:y}),this._frameTask.schedule(()=>{this.context.setAllFeaturesVisibility(!0)},v)}}}initialize(){const u=t.TaskPriority.FILTER_VISIBILITY,{layer:v,view:y}=this._layerView,{featureStore:D}=this.context;this._queryEngine=new p.QueryEngine({context:{spatialReference:y.spatialReference,layer:v,
scheduler:y.resourceController.scheduler,featureStore:D,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:u});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(u,this);this._updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),e.initial)}destroy(){this._updateRequested=!1;this._updatingHandles.destroy();this.clear();this._updateTask=m.abortMaybe(this._updateTask);
this._frameTask=m.removeMaybe(this._frameTask);this._queryEngine=m.destroyMaybe(this._queryEngine);this._set("context",null)}get updating(){return this.running||this._updatingHandles.updating||null!=this._updateTask&&!this._updateTask.finished}get running(){return this._updateRequested||this._frameTask.updating}get defaultVisibility(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}get _featureFilter(){return"filter"in this._layerView?this._layerView.filter:null}get _sceneFilter(){return"layerFilter"in
this._layerView?this._layerView.layerFilter:null}get _floorFilter(){return w.getFloorFilterClause(this._layerView)}get _timeExtent(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}get _compositedFeatureFilter(){const {_featureFilter:u,_timeExtent:v,_floorFilter:y}=this;if(null==v&&null==y)return u;const D=null!=u?u.clone():new x;null!=v&&(D.timeExtent=null!=D.timeExtent?D.timeExtent.intersection(v):v);null!=y&&(D.where=null==D.where||""===D.where?y:`(${D.where}) AND (${y})`);
return D}get _layerView(){return this.context.layerView}reapply(){this._updateRequested=!0}clear(){this._queryEngine.clear();this.context.clearFeaturesVisibility()}runTask(u){this._updateRequested&&(this._updateTask=m.abortMaybe(this._updateTask),this._updateTask=h.createTask(this._updateVisibility),this._updateRequested=!1,u.madeProgress());this._frameTask.processQueue(u);if(!u.hasProgressed)return q.Yield}};b.__decorate([d.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",
void 0);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"updating",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"running",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",
null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_compositedFeatureFilter",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_layerView",null);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);b.__decorate([d.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=b.__decorate([f.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],
a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(n,h){if(!n?.length)return null;n=n.filter(k=>""!==k).map(k=>`'${k}'`);n.push("''");return`${h} IN (${n.join(",")}) OR ${h} IS NULL`}a.getFloorFilterClause=function(n){const h=n.layer;return"floorInfo"in h&&h.floorInfo?.floorField&&"floors"in n.view?b(n.view.floors,h.floorInfo.floorField):null};a.getLayerFloorFilterClause=
function(n,h){return"floorInfo"in h&&h.floorInfo?.floorField?b(n,h.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){const p=l.QueryEngine;a.QueryEngine=class extends h{get layer(){return this.context.layer}get spatialReference(){return this.context.spatialReference}get _queryGeometryType(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}get defaultQueryJSON(){return(new x({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(t){super(t);
this._dataQueryEngineInstance=null}destroy(){this.clear()}clear(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1}async executeQueryForIdSet(t,q,u){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(t,q),u)}async executeQueryForCount(t,q){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),q)}async executeQueryForExtent(t,q){const {count:u,extent:v}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),
q);t=c.fromJSON(v);return{count:u,extent:t}}async executeQueryForIds(t,q){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),q)}async executeQueryForLatestObservations(t,q){t=await this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(t),q);t=r.fromJSON(t);t.features.forEach(u=>{u.layer=this.layer;u.sourceLayer=this.layer});return t}async executeQuery(t,q){t=await this._dataQueryEngine.executeQuery(this._ensureQueryJSON(t),q);t=r.fromJSON(t);t.features.forEach(u=>
{u.layer=this.layer;u.sourceLayer=this.layer});return t}_ensureQueryJSON(t,q){let u=this.defaultQueryJSON;null!=t&&("outSpatialReference"in t&&!t.outSpatialReference&&(t.outSpatialReference=this.spatialReference),u=t.toJSON());null!=q&&(t=q.geometries.map(v=>v.toJSON()).reduce((v,y)=>{v.rings=v.rings.concat(y.rings);return v}),u={...u,sceneFilter:{...q,geometry:t}});return u}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const t="timeInfo"in this.layer&&
this.layer.timeInfo?.toJSON()||null,q=this.layer.objectIdField,u=w.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),v=this.layer.fieldsIndex?.toJSON()||new f([]),y=this.priority,D=this.spatialReference.toJSON(),{hasZ:G,hasM:A,featureStore:C,scheduler:E}=this.context;return this._dataQueryEngineInstance=new p({hasZ:G,hasM:A,geometryType:u,fieldsIndex:v,timeInfo:t,spatialReference:D,objectIdField:q,featureStore:C,scheduler:E,priority:y})}};b.__decorate([k.property({constructOnly:!0})],
a.QueryEngine.prototype,"context",void 0);b.__decorate([k.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([k.property()],a.QueryEngine.prototype,"layer",null);b.__decorate([k.property()],a.QueryEngine.prototype,"spatialReference",null);b.__decorate([k.property()],a.QueryEngine.prototype,"_queryGeometryType",null);b.__decorate([k.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([d.subclass("esri.views.3d.layers.graphics.QueryEngine")],
a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../core/arrayUtils ../../../core/Error ../../../core/JSONSupport ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./geometryUtils ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./queryUtils ./queryValidationUtils ./spatialQuerySupport ./timeSupport ../../support/FieldsIndex ../../../views/support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H){class J{constructor(L,F=null,M,S,N){this.attributes=L;this.geometry=M;this.centroid=S;this.filterFlags=N;this.groupId=-1;this.displayId=F}}const B=new g.MemCacheStorage(2E6);let z=0;class K{constructor(L){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:y.queryCapabilities};this.geometryType=L.geometryType;this.hasM=!!L.hasM;this.hasZ=!!L.hasZ;this.objectIdField=L.objectIdField;this.spatialReference=L.spatialReference;
this.definitionExpression=L.definitionExpression;this.featureStore=L.featureStore;this.aggregateAdapter=L.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=L.timeInfo;L.cacheSpatialQueries&&(this._geometryQueryCache=new g.MemCache(z++ +"$$",B));this.fieldsIndex=h.isSerializable(L.fieldsIndex)?L.fieldsIndex:I.fromJSON(L.fieldsIndex);this.availableFields=!L.availableFields||1===L.availableFields.length&&"*"===L.availableFields[0]?new Set(this.fieldsIndex.fields.map(F=>
F.name)):new Set(L.availableFields.map(F=>this.fieldsIndex.get(F)?.name).filter(F=>null!=F));L.scheduler&&L.priority&&(this._frameTask=L.scheduler.registerTask(L.priority))}destroy(){this._frameTask=m.removeMaybe(this._frameTask);this.clearCache();m.destroyMaybe(this._geometryQueryCache);this._changeHandle=m.removeMaybe(this._changeHandle)}get featureAdapter(){return this.featureStore.featureAdapter}clearCache(){this._geometryQueryCache?.clear();this._fullExtentPromise=this._timeExtentPromise=this._allFeaturesPromise=
null}async executeQuery(L,F){F=e.signalFromSignalOrOptions(F);try{return(await this._executeQuery(L,{},F)).createQueryResponse()}catch(M){if(M!==G.queryEngineEmptyResult)throw M;return(new D.QueryEngineResult([],L,this)).createQueryResponse()}}async executeQueryForCount(L={},F){F=e.signalFromSignalOrOptions(F);try{return(await this._executeQuery(L,{returnGeometry:!1,returnCentroid:!1,outSR:null},F)).createQueryResponseForCount()}catch(M){if(M!==G.queryEngineEmptyResult)throw M;return 0}}async executeQueryForExtent(L,
F){F=e.signalFromSignalOrOptions(F);const M=L.outSR;try{const S=await this._executeQuery(L,{returnGeometry:!0,returnCentroid:!1,outSR:null},F),N=S.size;if(!N)return{count:0,extent:null};const P=await this._getBounds(S.items,S.spatialReference,M||this.spatialReference);return{count:N,extent:P}}catch(S){if(S===G.queryEngineEmptyResult)return{count:0,extent:null};throw S;}}async executeQueryForIds(L,F){return this.executeQueryForIdSet(L,F).then(M=>Array.from(M))}async executeQueryForIdSet(L,F){F=e.signalFromSignalOrOptions(F);
try{const M=await this._executeQuery(L,{returnGeometry:!0,returnCentroid:!1,outSR:null},F),S=M.items,N=new Set;await this._reschedule(()=>{for(const P of S)N.add(M.featureAdapter.getObjectId(P))},F);return N}catch(M){if(M===G.queryEngineEmptyResult)return new Set;throw M;}}async executeQueryForSnapping(L,F){const M=e.signalFromSignalOrOptions(F),{point:S,distance:N,returnEdge:P,vertexMode:R}=L;if(!P&&"none"===R)return{candidates:[]};let O=k.clone(L.query);O=await this._schedule(()=>G.normalizeQueryLike(O,
this.definitionExpression,this.spatialReference),M);O=await this._reschedule(()=>A.validateQuery(O,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);(F=!p.equals(S.spatialReference,this.spatialReference))&&await v.checkProjectionSupport(S.spatialReference,this.spatialReference);var T="number"===typeof N?N:N.x,Q="number"===typeof N?N:N.y;T={xmin:S.x-T,xmax:S.x+T,ymin:S.y-Q,ymax:S.y+Q,spatialReference:S.spatialReference};
T=F?v.project(T,this.spatialReference):T;if(!T)return{candidates:[]};Q=(await w.normalizeCentralMeridian(x.fromJSON(S),null,{signal:M}))[0];const V=(await w.normalizeCentralMeridian(x.fromJSON(T),null,{signal:M}))[0];if(null==Q||null==V)return{candidates:[]};const U=new D.QueryEngineResult(await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(V.toJSON())),M),O,this);await this._reschedule(()=>this._executeObjectIdsQuery(U),M);await this._reschedule(()=>this._executeTimeQuery(U),M);
await this._reschedule(()=>this._executeAttributesQuery(U),M);await this._reschedule(()=>this._executeGeometryQueryForSnapping(U,M),M);Q=Q.toJSON();Q=F?v.project(Q,this.spatialReference):Q;return U.createSnappingResponse({...L,point:Q,distance:F?Math.max(T.xmax-T.xmin,T.ymax-T.ymin)/2:N},S.spatialReference)}async executeQueryForLatestObservations(L,F){F=e.signalFromSignalOrOptions(F);if(!this.timeInfo?.trackIdField)throw new n("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:L,
timeInfo:this.timeInfo});try{const M=await this._executeQuery(L,{},F);await this._reschedule(()=>this._filterLatest(M),F);return M.createQueryResponse()}catch(M){if(M!==G.queryEngineEmptyResult)throw M;return(new D.QueryEngineResult([],L,this)).createQueryResponse()}}async executeQueryForSummaryStatistics(L={},F,M){M=e.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:P}=F;return(await this._executeQueryForStatistics(L,{field:S,normalizationField:N,valueExpression:P},
M)).createSummaryStatisticsResponse(F)}async executeQueryForUniqueValues(L={},F,M){M=e.signalFromSignalOrOptions(M);const {field:S,field2:N,field3:P,valueExpression:R}=F;return(await this._executeQueryForStatistics(L,{field:S,field2:N,field3:P,valueExpression:R},M)).createUniqueValuesResponse(F)}async executeQueryForClassBreaks(L={},F,M){M=e.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:P}=F;return(await this._executeQueryForStatistics(L,{field:S,normalizationField:N,
valueExpression:P},M)).createClassBreaksResponse(F)}async executeQueryForHistogram(L={},F,M){M=e.signalFromSignalOrOptions(M);const {field:S,normalizationField:N,valueExpression:P}=F;return(await this._executeQueryForStatistics(L,{field:S,normalizationField:N,valueExpression:P},M)).createHistogramResponse(F)}async fetchRecomputedExtents(L){L=e.signalFromSignalOrOptions(L);this._timeExtentPromise||(this._timeExtentPromise=E.getTimeExtent(this.timeInfo,this.featureStore));const [F,M]=await Promise.all([this._getFullExtent(),
this._timeExtentPromise]);e.throwIfAborted(L);return{fullExtent:F,timeExtent:M}}async _getBounds(L,F,M){const S=l.set(l.create(),l.negativeInfinity);await this.featureStore.forEachBounds(L,N=>l.expandWithAABB(S,N));L={xmin:S[0],ymin:S[1],xmax:S[3],ymax:S[4],spatialReference:u.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(S[2])&&isFinite(S[5])&&(L.zmin=S[2],L.zmax=S[5]);F=v.project(L,F,M);F.spatialReference=u.cleanFromGeometryEngine(M);0===F.xmax-F.xmin&&(M=d.getMetersPerUnitForSR(F.spatialReference),
F.xmin-=M,F.xmax+=M);0===F.ymax-F.ymin&&(M=d.getMetersPerUnitForSR(F.spatialReference),F.ymin-=M,F.ymax+=M);this.hasZ&&null!=F.zmin&&null!=F.zmax&&0===F.zmax-F.zmin&&(M=d.getMetersPerUnitForSR(F.spatialReference),F.zmin-=M,F.zmax+=M);return F}_getFullExtent(){this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(L=>this._getBounds(L,this.spatialReference,
this.spatialReference)));return this._fullExtentPromise}async _schedule(L,F){return null!=this._frameTask?this._frameTask.schedule(L,F):L(H.noBudget)}async _reschedule(L,F){return null!=this._frameTask?this._frameTask.reschedule(L,F):L(H.noBudget)}async _getAllFeaturesQueryEngineResult(L){return new D.QueryEngineResult(await this._getAllFeatures(),L,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const M=[];this._allFeaturesPromise=(async()=>{await this.featureStore.forEach(S=>M.push(S))})().then(()=>
M)}const L=this._allFeaturesPromise,F=await L;return L===this._allFeaturesPromise?F.slice():this._getAllFeatures()}async _executeQuery(L,F,M){L=k.clone(L);L=await this._schedule(()=>G.normalizeQuery(L,this.definitionExpression,this.spatialReference),M);L=await this._reschedule(()=>A.validateQuery(L,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);L={...L,...F};const S=await this._reschedule(()=>this._executeSceneFilterQuery(L,
M),M),N=await this._reschedule(()=>this._executeGeometryQuery(L,S,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(N),M);await this._reschedule(()=>this._executeObjectIdsQuery(N),M);await this._reschedule(()=>this._executeTimeQuery(N),M);await this._reschedule(()=>this._executeAttributesQuery(N),M);return N}async _executeSceneFilterQuery(L,F){if(null==L.sceneFilter)return null;const {outSR:M,returnGeometry:S,returnCentroid:N}=L;var P=this.featureStore.featureSpatialReference,R=L.sceneFilter.geometry;
const O=null==P||p.equals(P,R.spatialReference)?R:v.project(R,P);if(!O)return null;P=S||N;P=p.isValid(M)&&!p.equals(this.spatialReference,M)&&P?async U=>this._project(U,M):U=>U;const T=this.featureAdapter;R=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(O)),F);if("disjoint"===L.sceneFilter.spatialRelationship){if(!R.length)return null;const U=new Set;for(var Q of R)U.add(T.getObjectId(Q));const W=await this._reschedule(()=>this._getAllFeatures(),F);Q=await this._reschedule(async()=>
{const ca=await C.getSpatialQueryOperator("esriSpatialRelDisjoint",O,this.geometryType,this.hasZ,this.hasM),X=await this._runSpatialFilter(W,ba=>!U.has(T.getObjectId(ba))||ca(T.getGeometry(ba)),F);return new D.QueryEngineResult(X,L,this)},F);return P(Q)}if(!R.length)return new D.QueryEngineResult([],L,this);if(this._canExecuteSinglePass(O,L))return P(new D.QueryEngineResult(R,L,this));const V=await C.getSpatialQueryOperator("esriSpatialRelContains",O,this.geometryType,this.hasZ,this.hasM);Q=await this._runSpatialFilter(R,
U=>V(T.getGeometry(U)),F);return P(new D.QueryEngineResult(Q,L,this))}async _executeGeometryQuery(L,F,M){if(null!=F&&0===F.items.length)return F;L=null!=F?F.query:L;const {geometry:S,outSR:N,spatialRel:P,returnGeometry:R,returnCentroid:O}=L;var T=this.featureStore.featureSpatialReference;const Q=!S||null==T||p.equals(T,S.spatialReference)?S:v.project(S,T),V=R||O,U=p.isValid(N)&&!p.equals(this.spatialReference,N),W=this._geometryQueryCache&&null==F?U&&V?JSON.stringify({originalFilterGeometry:S,spatialRelationship:P,
outSpatialReference:N}):JSON.stringify({originalFilterGeometry:S,spatialRelationship:P}):null;T=W?this._geometryQueryCache.get(W):null;if(null!=T)return new D.QueryEngineResult(T,L,this);T=async fa=>{U&&V&&await this._project(fa,N);W&&this._geometryQueryCache.put(W,fa.items,fa.items.length+1);return fa};if(!Q)return T(null!=F?F:await this._getAllFeaturesQueryEngineResult(L));const ca=this.featureAdapter;let X=await this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(S)),M);if("esriSpatialRelDisjoint"===
P){if(!X.length)return T(null!=F?F:await this._getAllFeaturesQueryEngineResult(L));const fa=new Set;for(var ba of X)fa.add(ca.getObjectId(ba));const da=null!=F?F.items:await this._reschedule(()=>this._getAllFeatures(),M);ba=await this._reschedule(async()=>{const aa=await C.getSpatialQueryOperator(P,Q,this.geometryType,this.hasZ,this.hasM),ea=await this._runSpatialFilter(da,ha=>!fa.has(ca.getObjectId(ha))||aa(ca.getGeometry(ha)),M);return new D.QueryEngineResult(ea,L,this)},M);return T(ba)}if(null!=
F){const fa=new b.PositionHint;X=X.filter(da=>0<=b.indexOf(F.items,da,F.items.length,fa))}if(!X.length)return T=new D.QueryEngineResult([],L,this),W&&this._geometryQueryCache.put(W,T.items,1),T;if(this._canExecuteSinglePass(Q,L))return T(new D.QueryEngineResult(X,L,this));const ia=await C.getSpatialQueryOperator(P,Q,this.geometryType,this.hasZ,this.hasM);ba=await this._runSpatialFilter(X,fa=>ia(ca.getGeometry(fa)),M);return T(new D.QueryEngineResult(ba,L,this))}async _executeGeometryQueryForSnapping(L,
F){const {query:M}=L,{spatialRel:S}=M;if(L?.items?.length&&M.geometry&&S){var N=await C.getSpatialQueryOperator(S,M.geometry,this.geometryType,this.hasZ,this.hasM);F=await this._runSpatialFilter(L.items,P=>N(P.geometry),F);L.items=F}}_executeAggregateIdsQuery(L){if(0!==L.items.length&&L.query.aggregateIds?.length&&null!=this.aggregateAdapter){var F=new Set;for(const S of L.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(S).forEach(N=>F.add(N));var M=this.featureAdapter.getObjectId;L.items=
L.items.filter(S=>F.has(M(S)))}}_executeObjectIdsQuery(L){if(0!==L.items.length&&L.query.objectIds?.length){var F=new Set(L.query.objectIds),M=this.featureAdapter.getObjectId;L.items=L.items.filter(S=>F.has(M(S)))}}_executeTimeQuery(L){if(0!==L.items.length){var F=E.getTimeOperator(this.timeInfo,L.query.timeExtent,this.featureAdapter);null!=F&&(L.items=L.items.filter(F))}}_executeAttributesQuery(L){if(0!==L.items.length){var F=q.getWhereClause(L.query.where,this.fieldsIndex);if(F){if(!F.isStandardized)throw new TypeError("Where clause is not standardized");
L.items=L.items.filter(M=>F.testFeature(M,this.featureAdapter))}}}async _runSpatialFilter(L,F,M){if(!F)return L;if(null==this._frameTask)return L.filter(R=>F(R));let S=0;const N=[],P=async R=>{for(;S<L.length;){const O=L[S++];F(O)&&(N.push(O),R.madeProgress());R.done&&await this._reschedule(T=>P(T),M)}};return this._reschedule(R=>P(R),M).then(()=>N)}_filterLatest(L){const {trackIdField:F,startTimeField:M,endTimeField:S}=this.timeInfo,N=S||M,P=new Map,R=this.featureAdapter.getAttribute;for(const O of L.items){const T=
R(O,F),Q=R(O,N),V=P.get(T);(!V||Q>R(V,N))&&P.set(T,O)}L.items=Array.from(P.values())}_canExecuteSinglePass(L,F){({spatialRel:F}=F);return C.canQueryWithRBush(L)&&("esriSpatialRelEnvelopeIntersects"===F||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===F||"esriSpatialRelContains"===F))}async _project(L,F){if(!F||p.equals(this.spatialReference,F))return L;const M=this.featureAdapter;let S=void 0;try{const N=await this._getFullExtent();S=c.getTransformation(this.spatialReference,
F,N)}catch{}F=await v.projectMany(L.items.map(N=>u.getGeometry(this.geometryType,this.hasZ,this.hasM,M.getGeometry(N))),this.spatialReference,F,S);L.items=F.map((N,P)=>M.cloneWithGeometry(L.items[P],t.convertFromGeometry(N,this.hasZ,this.hasM)));return L}_getQueryBBoxes(L){if(C.canQueryWithRBush(L)){if(x.isExtent(L))return[f.fromValues(Math.min(L.xmin,L.xmax),Math.min(L.ymin,L.ymax),Math.max(L.xmin,L.xmax),Math.max(L.ymin,L.ymax))];if(x.isPolygon(L))return L.rings.map(F=>f.fromValues(Math.min(F[0][0],
F[2][0]),Math.min(F[0][1],F[2][1]),Math.max(F[0][0],F[2][0]),Math.max(F[0][1],F[2][1])))}return[r.getBoundsXY(f.create(),L)]}async _searchFeatures(L){const F=new Set;await Promise.all(L.map(M=>this.featureStore.forEachInBounds(M,S=>F.add(S))));L=Array.from(F.values());F.clear();return L}async _executeQueryForStatistics(L,F,M){L=k.clone(L);try{L=await this._schedule(()=>G.normalizeQuery(L,this.definitionExpression,this.spatialReference),M);L=await this._reschedule(()=>A.validateStatisticsQuery(L,F,
{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),M);const S=await this._reschedule(()=>this._executeSceneFilterQuery(L,M),M),N=await this._reschedule(()=>this._executeGeometryQuery(L,S,M),M);await this._reschedule(()=>this._executeAggregateIdsQuery(N),M);await this._reschedule(()=>this._executeObjectIdsQuery(N),M);await this._reschedule(()=>this._executeTimeQuery(N),M);await this._reschedule(()=>this._executeAttributesQuery(N),
M);return N}catch(S){if(S!==G.queryEngineEmptyResult)throw S;return new D.QueryEngineResult([],L,this)}}}a.Feature=J;a.QueryEngine=K;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(a,b,n,h){function k(x,w,p={}){const t=m(w,x);if(!t)throw p=l.getError(w,x),new b("unsupported-query","invalid SQL expression",{expression:w,
error:p});x=p.expressionName||"expression";if(p.validateStandardized&&!t.isStandardized)throw new b("unsupported-query",`${x} is not standard`,{expression:w});if(p.validateAggregate&&!t.isAggregate)throw new b("unsupported-query",`${x} does not contain a valid aggregate function`,{expression:w});return t.fieldNames}function m(x,w){return x?l.get(x,w):null}function g(x){return/\((.*?)\)/.test(x)?x:x.split(" as ")[0]}function e(x,w,p,t={}){const q=new Map;d(q,x,w,t.allowedFieldTypes??r,p);if(q.size)throw new b("unsupported-query",
`${t.expressionName??"expression"} contains invalid or missing fields`,{errors:Array.from(q.values()),query:t.query});}function d(x,w,p,t,q){q=q.includes("*")?[...p,...q.filter(u=>"*"!==u)]:q;for(const u of q)if(w.get(u))c(x,w,p,t,u);else try{const v=g(u),y=k(w,v,{validateStandardized:!0});for(const D of y)c(x,w,p,t,D)}catch(v){x.set(u,{type:"expression-error",expression:u,error:v})}}function c(x,w,p,t,q){(w=w.get(q))?p.has(w.name)?"all"!==t&&!1===t?.has(w.type)&&x.set(q,{type:"invalid-type",fieldName:w.name,
fieldType:h.kebabDict.fromJSON(w.type),allowedFieldTypes:Array.from(t,u=>h.kebabDict.fromJSON(u))}):x.set(q,{type:"missing-field",fieldName:w.name}):x.set(q,{type:"invalid-field",fieldName:q})}const l=new n.WhereClauseCache(50,500);n=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeBigInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong".split(" "));const f=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),
r=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...n,...f]);a.allDateAndTimeFieldTypes=f;a.getAliasFromFieldName=function(x){return x.split(" as ")[1]};a.getExpressionFromFieldName=g;a.getWhereClause=m;a.numericFieldTypes=n;a.validateFields=e;a.validateHaving=function(x,w,p,t,q){if(!p)return!0;const u=k(x,p,{validateAggregate:!0,expressionName:"having clause"});e(x,w,u,{expressionName:"having clause",query:q});if(!m(p,x)?.getExpressions().every(v=>{const {aggregateType:y,
field:D}=v,G=x.get(D)?.name;return t.some(A=>{const {onStatisticField:C,statisticType:E}=A;return x.get(C)?.name===G&&E.toLowerCase().trim()===y})}))throw new b("unsupported-query","expressions in having clause should also exist in outStatistics",{having:p});return!0};a.validateWhere=function(x,w,p,t){if(!p)return!0;p=k(x,p,{validateStandardized:!0,expressionName:"where clause"});e(x,w,p,{expressionName:"where clause",query:t});return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(a,b,n){class h{constructor(k,m){this._cache=new b.LRUCache(k);this._invalidCache=new b.LRUCache(m)}get(k,m){const g=`${m.uid}:${k}`,e=this._cache.get(g);if(e)return e;if(null!=this._invalidCache.get(g))return null;try{const d=n.WhereClause.create(k,m);this._cache.put(g,d);return d}catch(d){return this._invalidCache.put(g,d),null}}getError(k,m){return this._invalidCache.get(`${m.uid}:${k}`)??null}}
a.WhereClauseCache=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../arcade/ArcadeDate ../../arcade/featureset/support/errorsupport ../has ./AggregateFunctions ./DateOnly ./sqlArithmeticUtils ./sqlCompareUtils ./sqlDateParsingUtils ./SqlInterval ./SqlTimestampOffset ./StandardizedFunctions ./TimeOnly ./WhereGrammar ../../chunks/datetime".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w){function p(H){return Array.isArray(H)?
H:[H]}function t(H){return null!==H?!0!==H:null}function q(H,J){return null!=H&&null!=J?!0===H&&!0===J:!1===H||!1===J?!1:null}function u(H,J){return null!=H&&null!=J?!0===H||!0===J:!0===H||!0===J?!0:null}function v(H,J){if(null==H)return null;let B=!1;for(const z of J)if(null==z)B=null;else if(H===z){B=!0;break}return B}function y(H,J,B){if(null==H)return null;let z="",K=E.Normal;for(let L=0;L<J.length;L++){const F=J.charAt(L);switch(K){case E.Normal:F===B?K=E.Escaped:z="-[]/{}()*+?.\\^$|".includes(F)?
z+("\\"+F):"%"===F?z+".*":"_"===F?z+".":z+F;break;case E.Escaped:z="-[]/{}()*+?.\\^$|".includes(F)?z+("\\"+F):z+F,K=E.Normal}}return(new RegExp("^"+z+"$","m")).test(H)}function D(H,J,B,z){H=z.getAttribute(H,J);J=B?.get(J);return null==H||"esriFieldTypeDate"!==J?.type&&"date"!==J?.type?null==H||"esriFieldTypeDateOnly"!==J?.type&&"date-only"!==J?.type?null==H||"esriFieldTypeTimeOnly"!==J?.type&&"time-only"!==J?.type?null==H||"esriFieldTypeTimestampOffset"!==J?.type&&"timestamp-offset"!==J?.type?H:new l.SqlTimeStampOffset(H):
r.TimeOnly.fromReader(H):m.DateOnly.fromReader(H):d.convertToExecutingTimeZone(new Date(H),B?.getLuxonTimeZone(J.name)??w.FixedOffsetZone.utcInstance)}const G=new Set(["current_timestamp","current_date","current_time"]);class A{static makeBool(H){return!0===H}static featureValue(H,J,B,z){return D(H,J,B,z)}static equalsNull(H){return null===H}static applyLike(H,J,B){return y(H,J,B)}static ensureArray(H){return p(H)}static applyIn(H,J){return v(H,J)}static currentDate(H){return m.DateOnly.fromNow(H)}static makeSqlInterval(H,
J,B){return c.SqlInterval.createFromValueAndQualifier(H,J,B)}static convertInterval(H){return H instanceof c.SqlInterval?H.valueInMilliseconds():H}static currentTimestamp(H){return d.convertToExecutingTimeZone(new Date,H)}static compare(H,J,B,z){return e.sqlCompare(J,B,H)}static calculate(H,J,B,z){return g.sqlCalculateFunction(H,J,B,z)}static evaluateTime(H){return d.parseTime(H)}static evaluateTimestamp(H,J,B){return d.parseTimestamp(H,J,B)}static evaluateDate(H,J){return d.parseDate(H,J)}static evaluateFunction(H,
J,B){return f.evaluateFunction(H,J,B)}static lookup(H,J){H=J[H];return void 0===H?null:H}static between(H,J,B){return null==H||null==J[0]||null==J[1]?null:e.sqlCompare(H,J[0],"\x3e\x3d")&&e.sqlCompare(H,J[1],"\x3c\x3d")}static notbetween(H,J,B){return null==H||null==J[0]||null==J[1]?null:e.sqlCompare(H,J[0],"\x3c")||e.sqlCompare(H,J[1],"\x3e")}static ternaryNot(H){return t(H)}static ternaryAnd(H,J){return q(H,J)}static ternaryOr(H,J){return u(H,J)}}class C{constructor(H,J,B="UTC"){this.fieldsIndex=
J;this.timeZone=B;this.parameters={};this._hasDateFunctions=void 0;this.parseTree=x.WhereGrammar.parse(H);const {isStandardized:z,isAggregate:K,referencedFieldNames:L}=this._extractExpressionInfo(J);this._referencedFieldNames=L;this.isStandardized=z;this.isAggregate=K}static convertValueToStorageFormat(H,J=null){if(null===J)return d.isDate(H)?H.getTime():d.isDateTime(H)?H.toMillis():d.isTimestampOffset(H)?H.toStorageFormat():d.isTimeOnly(H)?H.toStorageString():d.isDateOnly(H)?H.toStorageFormat():
H;switch(J){case "date":if(d.isDate(H))return H.getTime();if(d.isDateTime(H))return H.toMillis();if(d.isTimestampOffset(H))return H.toMilliseconds();if(d.isDateOnly(H))return H.toNumber();break;case "date-only":if(d.isDate(H))return m.DateOnly.fromDateJS(H).toString();if(d.isTimestampOffset(H))return m.DateOnly.fromSqlTimeStampOffset(H).toString();if(d.isDateTime(H))return m.DateOnly.fromDateTime(H).toString();break;case "time-only":if(d.isDate(H))return r.TimeOnly.fromDateJS(H).toStorageString();
if(d.isDateTime(H))return r.TimeOnly.fromDateTime(H).toStorageString();if(d.isTimestampOffset(H))return r.TimeOnly.fromSqlTimeStampOffset(H).toStorageString();if(d.isTimeOnly(H))return H.toStorageString();break;case "timestamp-offset":if(d.isDate(H))return l.SqlTimeStampOffset.fromJSDate(H).toStorageFormat();if(d.isDateTime(H))return l.SqlTimeStampOffset.fromDateTime(H).toStorageFormat();if(d.isTimestampOffset(H))return H.toStorageFormat()}return H}static create(H,J,B="UTC"){return new C(H,J,B)}get fieldNames(){return this._referencedFieldNames}testSet(H,
J=I){return!!this._evaluateNode(this.parseTree,null,J,H)}calculateValue(H,J=I){H=this._evaluateNode(this.parseTree,H,J,null);return H instanceof c.SqlInterval?H.valueInMilliseconds()/864E5:H}calculateValueCompiled(H,J=I){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(H,this.parameters,J,this.fieldsIndex,this.timeZone);if(h("esri-csp-restrictions"))return this.calculateValue(H,J);this._compileMe();return this.parseTree._compiledVersion(H,this.parameters,J,this.fieldsIndex,
this.timeZone)}testFeature(H,J=I){return!!this._evaluateNode(this.parseTree,H,J,null)}testFeatureCompiled(H,J=I){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(H,this.parameters,J,this.fieldsIndex,this.timeZone);if(h("esri-csp-restrictions"))return this.testFeature(H,J);this._compileMe();return!!this.parseTree._compiledVersion(H,this.parameters,J,this.fieldsIndex,this.timeZone)}get hasDateFunctions(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=
!1;this._visitAll(this.parseTree,H=>{"current-time"===H.type?this._hasDateFunctions=!0:"function"===H.type&&(this._hasDateFunctions=this._hasDateFunctions||G.has(H.name.toLowerCase()))});return this._hasDateFunctions}getFunctions(){const H=new Set;this._visitAll(this.parseTree,J=>{"function"===J.type&&H.add(J.name.toLowerCase())});return Array.from(H)}getExpressions(){const H=new Map;this._visitAll(this.parseTree,J=>{if("function"===J.type){const B=J.name.toLowerCase();J=J.args.value[0];if("column-reference"===
J.type){J=J.column;const z=`${B}-${J}`;H.has(z)||H.set(z,{aggregateType:B,field:J})}}});return[...H.values()]}getVariables(){const H=new Set;this._visitAll(this.parseTree,J=>{"parameter"===J.type&&H.add(J.value.toLowerCase())});return Array.from(H)}_compileMe(){const H="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","fieldsIndex","timeZone",H)).bind(A)}_extractExpressionInfo(H){const J=
[],B=new Set;let z=!0,K=!1;this._visitAll(this.parseTree,L=>{switch(L.type){case "column-reference":var F=H?.get(L.column);let M;F?F=M=F.name??"":(M=L.column,F=M.toLowerCase());B.has(F)||(B.add(F),J.push(M));L.column=M;break;case "function":const {name:S,args:N}=L;L=N.value.length;z&&=f.isStandardized(S,L);!1===K&&(K=k.isAggregate(S,L))}});return{referencedFieldNames:Array.from(J),isStandardized:z,isAggregate:K}}_visitAll(H,J){if(null!=H)switch(J(H),H.type){case "when-clause":this._visitAll(H.operand,
J);this._visitAll(H.value,J);break;case "case-expression":for(const B of H.clauses)this._visitAll(B,J);"simple"===H.format&&this._visitAll(H.operand,J);null!==H.else&&this._visitAll(H.else,J);break;case "expression-list":for(const B of H.value)this._visitAll(B,J);break;case "unary-expression":this._visitAll(H.expr,J);break;case "binary-expression":this._visitAll(H.left,J);this._visitAll(H.right,J);break;case "function":this._visitAll(H.args,J)}}evaluateNodeToJavaScript(H){switch(H.type){case "interval":return"this.makeSqlInterval("+
this.evaluateNodeToJavaScript(H.value)+", "+JSON.stringify(H.qualifier)+","+JSON.stringify(H.op)+")";case "case-expression":var J="";if("simple"===H.format){var B=this.evaluateNodeToJavaScript(H.operand);J="( ";for(let z=0;z<H.clauses.length;z++)J+=" (this.compare('\x3d',"+B+","+this.evaluateNodeToJavaScript(H.clauses[z].operand)+") ? ("+this.evaluateNodeToJavaScript(H.clauses[z].value)+") : "}else for(J="( ",B=0;B<H.clauses.length;B++)J+=" this.makeBool("+this.evaluateNodeToJavaScript(H.clauses[B].operand)+
")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(H.clauses[B].value)+") : ";J=null!==H.else?J+this.evaluateNodeToJavaScript(H.else):J+"null";return J+" )";case "parameter":return"this.lookup("+JSON.stringify(H.value.toLowerCase())+",lookups)";case "expression-list":J="[";for(B of H.value)"["!==J&&(J+=","),J+=this.evaluateNodeToJavaScript(B);return J+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(H.expr)+")";case "binary-expression":switch(H.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+" )";case "IS":if("null"!==H.right.type)throw new n.SqlError(n.SqlErrorCodes.UnsupportedIsRhs);return"this.equalsNull("+this.evaluateNodeToJavaScript(H.left)+")";case "ISNOT":if("null"!==H.right.type)throw new n.SqlError(n.SqlErrorCodes.UnsupportedIsRhs);return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(H.left)+
")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(H.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(H.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(H.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(H.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(H.left)+
","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+","+JSON.stringify(H.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+","+JSON.stringify(H.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(H.operator)+
","+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(H.operator)+","+this.evaluateNodeToJavaScript(H.left)+","+this.evaluateNodeToJavaScript(H.right)+", timeZone)"}throw new n.SqlError(n.SqlErrorCodes.UnsupportedOperator,{operator:H.operator});case "null":case "boolean":case "string":case "number":return JSON.stringify(H.value);case "time":return"this.evaluateTime(JSON.stringify(node.value))";
case "date":return"this.evaluateDate(JSON.stringify(node.value), 'unknown')";case "timestamp":return"this.evaluateTimestamp(JSON.stringify(node.value), 'unknown')";case "current-time":return"date"===H.mode?"this.currentDate(timeZone)":"this.currentTimestamp(timeZone)";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(H.column)+",fieldsIndex,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(H.name)+","+this.evaluateNodeToJavaScript(H.args)+", timeZone)"}throw new n.SqlError(n.SqlErrorCodes.UnsupportedSyntax,
{node:H.type});}_evaluateNode(H,J,B,z){switch(H.type){case "interval":return B=this._evaluateNode(H.value,J,B,z),c.SqlInterval.createFromValueAndQualifier(B,H.qualifier,H.op);case "case-expression":if("simple"===H.format){var K=this._evaluateNode(H.operand,J,B,z);for(var L=0;L<H.clauses.length;L++)if(e.sqlCompare(K,this._evaluateNode(H.clauses[L].operand,J,B,z),"\x3d",this.timeZone))return this._evaluateNode(H.clauses[L].value,J,B,z)}else for(K=0;K<H.clauses.length;K++)if(!0===this._evaluateNode(H.clauses[K].operand,
J,B,z))return this._evaluateNode(H.clauses[K].value,J,B,z);return null!==H.else?this._evaluateNode(H.else,J,B,z):null;case "parameter":return H=this.parameters[H.value.toLowerCase()],d.isDate(H)?w.DateTime.fromJSDate(H):H instanceof b.ArcadeDate?H.toDateTime():H;case "expression-list":K=[];for(var F of H.value)K.push(this._evaluateNode(F,J,B,z));return K;case "unary-expression":return t(this._evaluateNode(H.expr,J,B,z));case "binary-expression":switch(H.operator){case "AND":return q(this._evaluateNode(H.left,
J,B,z),this._evaluateNode(H.right,J,B,z));case "OR":return u(this._evaluateNode(H.left,J,B,z),this._evaluateNode(H.right,J,B,z));case "IS":if("null"!==H.right.type)throw new n.SqlError(n.SqlErrorCodes.UnsupportedIsRhs);return null===this._evaluateNode(H.left,J,B,z);case "ISNOT":if("null"!==H.right.type)throw new n.SqlError(n.SqlErrorCodes.UnsupportedIsRhs);return null!==this._evaluateNode(H.left,J,B,z);case "IN":return K=p(this._evaluateNode(H.right,J,B,z)),v(this._evaluateNode(H.left,J,B,z),K);case "NOT IN":return K=
p(this._evaluateNode(H.right,J,B,z)),t(v(this._evaluateNode(H.left,J,B,z),K));case "BETWEEN":return K=this._evaluateNode(H.left,J,B,z),H=this._evaluateNode(H.right,J,B,z),null==K||null==H[0]||null==H[1]?null:e.sqlCompare(K,H[0],"\x3e\x3d",this.timeZone)&&e.sqlCompare(K,H[1],"\x3c\x3d",this.timeZone);case "NOTBETWEEN":return K=this._evaluateNode(H.left,J,B,z),H=this._evaluateNode(H.right,J,B,z),null==K||null==H[0]||null==H[1]?null:e.sqlCompare(K,H[0],"\x3c",this.timeZone)||e.sqlCompare(K,H[1],"\x3e",
this.timeZone);case "LIKE":return y(this._evaluateNode(H.left,J,B,z),this._evaluateNode(H.right,J,B,z),H.escape);case "NOT LIKE":return t(y(this._evaluateNode(H.left,J,B,z),this._evaluateNode(H.right,J,B,z),H.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return e.sqlCompare(this._evaluateNode(H.left,J,B,z),this._evaluateNode(H.right,J,B,z),H.operator,this.timeZone);case "-":case "+":case "*":case "/":case "||":return g.sqlCalculateFunction(H.operator,
this._evaluateNode(H.left,J,B,z),this._evaluateNode(H.right,J,B,z),this.timeZone)}case "null":case "boolean":case "string":case "number":return H.value;case "date":return H.parsedValue??(H.parsedValue=d.parseDate(H.value,"unknown")),H.parsedValue;case "timestamp":return H.parsedValue??(H.parsedValue=d.parseTimestamp(H.value,"unknown")),H.parsedValue;case "time":return d.parseTime(H.value);case "current-time":return"date"===H.mode?m.DateOnly.fromNow(this.timeZone):d.convertToExecutingTimeZone(new Date,
this.timeZone);case "column-reference":return D(J,H.column,this.fieldsIndex,B);case "data-type":return H.value;case "function":if(this.isAggregate&&k.isAggregate(H.name,H.args.value.length)){J=[];for(K of H.args?.value||[]){F=[];for(L of z||[])F.push(this._evaluateNode(K,L,B,null));J.push(F)}return k.aggregateFunction(H.name,J)}B=this._evaluateNode(H.args,J,B,z);return f.evaluateFunction(H.name,B,this.timeZone)}throw new n.SqlError(n.SqlErrorCodes.UnsupportedSyntax,{node:H.type});}}var E;(function(H){H[H.Normal=
0]="Normal";H[H.Escaped=1]="Escaped"})(E||={});const I={getAttribute(H,J){return(H&&"object"===typeof H.attributes?H.attributes:H)[J]}};a.WhereClause=C;a.defaultAttributeAdapter=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ArcadeDate":function(){define(["exports","../core/string","../core/sql/UnknownTimeZone","../chunks/datetime"],function(a,b,n,h){function k(c,l,f){return c<l?c-l:c>f?c-f:0}function m(c,l=!0){if(c instanceof h.Zone)return c;if("system"===c.toLowerCase())return"system";
if("utc"===c.toLowerCase())return"UTC";if("unknown"===c.toLowerCase())return n.UnknownTimeZone.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(c)){const f=h.FixedOffsetZone.parseSpecifier("UTC"+(c.startsWith("+")||c.startsWith("-")?"":"+")+c);if(f)return f}c=h.IANAZone.create(c);if(!c.isValid){if(l)throw new e(a.ArcadeDateErrorCodes.TimeZoneNotRecognized);return null}return c}a.ArcadeDateErrorCodes=void 0;(a.ArcadeDateErrorCodes||(a.ArcadeDateErrorCodes={})).TimeZoneNotRecognized="TimeZoneNotRecognized";
const g={[a.ArcadeDateErrorCodes.TimeZoneNotRecognized]:"Timezone identifier has not been recognized."};class e extends Error{constructor(c,l){super(b.replace(g[c],l));this.declaredRootClass="esri.arcade.arcadedate.dateerror";Error.captureStackTrace&&Error.captureStackTrace(this,e)}}class d{constructor(c){this._date=c;this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(c=0,l=1,f=1,r=0,x=0,w=0,p=0,t){if(isNaN(c)||isNaN(l)||isNaN(f)||isNaN(r)||isNaN(x)||isNaN(w)||isNaN(p))return null;const q=
h.DateTime.local(c,l).daysInMonth;c=h.DateTime.fromObject({day:1>f?1:f>q?q:f,year:c,month:1>l?1:12<l?12:l,hour:0>r?0:23<r?23:r,minute:0>x?0:59<x?59:x,second:0>w?0:59<w?59:w,millisecond:0>p?0:999<p?999:p},{zone:m(t)});c=c.plus({months:k(l,1,12),days:k(f,1,q),hours:k(r,0,23),minutes:k(x,0,59),seconds:k(w,0,59),milliseconds:k(p,0,999)});return new d(c)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(c,l){l=
m(l);return c.isUnknownTimeZone||l===n.UnknownTimeZone.instance?d.fromParts(c.year,c.monthJS+1,c.day,c.hour,c.minute,c.second,c.millisecond,l):new d(c._date.setZone(l))}static dateJSToArcadeDate(c){return new d(h.DateTime.fromJSDate(c,{zone:"system"}))}static dateJSAndZoneToArcadeDate(c,l="system"){l=m(l);return new d(h.DateTime.fromJSDate(c,{zone:l}))}static unknownEpochToArcadeDate(c){return new d(h.DateTime.fromMillis(c,{zone:n.UnknownTimeZone.instance}))}static unknownDateJSToArcadeDate(c){return new d(h.DateTime.fromMillis(c.getTime(),
{zone:n.UnknownTimeZone.instance}))}static epochToArcadeDate(c,l="system"){l=m(l);return new d(h.DateTime.fromMillis(c,{zone:l}))}static dateTimeToArcadeDate(c){return new d(c)}clone(){return new d(this._date)}changeTimeZone(c){c=m(c);return d.dateTimeToArcadeDate(this._date.setZone(c))}static dateTimeAndZoneToArcadeDate(c,l){l=m(l);return c.zone===n.UnknownTimeZone.instance||l===n.UnknownTimeZone.instance?d.fromParts(c.year,c.month,c.day,c.hour,c.minute,c.second,c.millisecond,l):new d(c.setZone(l))}static nowToArcadeDate(c){c=
m(c);return new d(h.DateTime.fromJSDate(new Date,{zone:c}))}static nowUTCToArcadeDate(){return new d(h.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===d.systemTimeZoneCanonicalName}equals(c){return this.isSystem&&c.isSystem?this.toNumber()===c.toNumber():this.isUnknownTimeZone!==c.isUnknownTimeZone?!1:this._date.equals(c._date)}get isUnknownTimeZone(){return this._date.zone===n.UnknownTimeZone.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let c=
this._date.weekday;6<c&&(c=0);return c}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";
const c=this.zone;return"fixed"===c.type?0===c.fixed?"UTC":c.formatOffset(0,"short"):c.name}stringify(){return JSON.stringify(this.toJSDate())}plus(c){return new d(this._date.plus(c))}diff(c,l="milliseconds"){return this._date.diff(c._date,l)[l]}toISODate(){return this._date.toISODate()}toISOString(c){return c?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toISOTime(c,l){return this._date.toISOTime({suppressMilliseconds:c,
includeOffset:l&&!this.isUnknownTimeZone})}toFormat(c,l){this.isUnknownTimeZone&&(c=c.replaceAll("Z",""));return this._date.toFormat(c,l)}toJSDate(){return this._date.toJSDate()}toSQLValue(){return this._date.toFormat("yyyy-LL-dd HH:mm:ss")}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new d(this._date.toUTC())}toLocal(){return new d(this._date.toLocal())}toString(){return this.toISOString(!0)}static fromReaderAsTimeStampOffset(c){if(!c)return null;
c=h.DateTime.fromISO(c,{setZone:!0});return new d(c)}}a.ArcadeDate=d;a.ArcadeDateError=e;a.arcadeDateErrorMessages=g;a.createDateTimeZone=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../core/string"],function(a,b){a.SqlErrorCodes=void 0;(function(g){g.InvalidFunctionParameters="InvalidFunctionParameters";g.InvalidValueForAggregateFunction="InvalidValueForAggregateFunction";g.UnsupportedSqlFunction=
"UnsupportedSqlFunction";g.UnsupportedOperator="UnsupportedOperator";g.UnsupportedSyntax="UnsupportedSyntax";g.UnsupportedIsRhs="UnsupportedIsRhs";g.UnsupportedIsLhs="UnsupportedIsLhs";g.InvalidDataType="InvalidDataType";g.CannotCastValue="CannotCastValue";g.FunctionNotRecognized="FunctionNotRecognized";g.InvalidTime="InvalidTime";g.InvalidParameterCount="InvalidParameterCount";g.InvalidTimeStamp="InvalidTimeStamp";g.InvalidDate="InvalidDate";g.InvalidOperator="InvalidOperator";g.IllegalInterval=
"IllegalInterval";g.YearMonthIntervals="YearMonthIntervals";g.PrimarySecondaryQualifiers="PrimarySecondaryQualifiers";g.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const n={[a.SqlErrorCodes.InvalidValueForAggregateFunction]:"Invalid value used in aggregate function",[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",
[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",[a.SqlErrorCodes.InvalidDate]:"Invalid date encountered",[a.SqlErrorCodes.InvalidOperator]:"Invalid operator encountered",[a.SqlErrorCodes.InvalidTime]:"Invalid time encountered",
[a.SqlErrorCodes.IllegalInterval]:"Illegal interval",[a.SqlErrorCodes.FunctionNotRecognized]:"Function not recognized",[a.SqlErrorCodes.InvalidTimeStamp]:"Invalid timestamp encountered",[a.SqlErrorCodes.InvalidParameterCount]:"Invalid parameter count for call to {name}",[a.SqlErrorCodes.PrimarySecondaryQualifiers]:"Primary and Secondary SqlInterval qualifiers not supported",[a.SqlErrorCodes.YearMonthIntervals]:"Year-Month Intervals not supported",[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};
class h extends Error{constructor(g,e){super(b.replace(n[g],e));this.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(this,h)}}a.FeatureSetErrorCodes=void 0;(function(g){g.NeverReach="NeverReach";g.NotImplemented="NotImplemented";g.Cancelled="Cancelled";g.InvalidStatResponse="InvalidStatResponse";g.InvalidRequest="InvalidRequest";g.RequestFailed="RequestFailed";g.MissingFeatures="MissingFeatures";g.AggregationFieldNotFound="AggregationFieldNotFound";
g.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const k={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",
[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};class m extends Error{constructor(g,e){super(b.replace(k[g],e));this.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&Error.captureStackTrace(this,m)}}a.FeatureSetError=m;a.SqlError=h;a.featureSetErrorMessages=k;a.sqlErrorMessages=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlTimestampOffset ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,n,h,k,m){function g(l){if(null===l)return null;let f=0,r=0;for(let x=0;x<l.length;x++){const w=l[x];if(null!==w){if("number"!==typeof w)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);r++;f+=w}}return 0===r?null:f/l.length}function e(l,f){if(null===
l)return null;let r=null,x=null;for(const w of l)l=w,l=w instanceof n.DateOnly?w.toNumber():w instanceof k.TimeOnly?w.toNumber():w instanceof m.DateTime?w.toMillis():w instanceof h.SqlTimeStampOffset?w.toMilliseconds():w,null===r?(r=w,x=l):"max"===f&&null!==x&&null!==l&&x<=l?(r=w,x=l):"min"===f&&null!==x&&null!==l&&x>=l&&(r=w,x=l);return r}function d(l){if(null===l)return null;l=l.filter(x=>null!==x);if(0===l.length)return null;const f=g(l);if(null===f)return null;let r=0;for(const x of l){if("number"!==
typeof x)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);r+=(f-x)**2}return r/(l.length-1)}const c={min:{minParams:1,maxParams:1,evaluate:l=>e(l[0],"min")},max:{minParams:1,maxParams:1,evaluate:l=>e(l[0],"max")},avg:{minParams:1,maxParams:1,evaluate:l=>g(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>{l=l[0];if(null===l)l=null;else{var f=0;for(let r=0;r<l.length;r++){const x=l[r];if(null!==x){if("number"!==typeof x)throw new b.SqlError(b.SqlErrorCodes.InvalidValueForAggregateFunction);
f+=x}}l=f}return l}},stddev:{minParams:1,maxParams:1,evaluate:l=>{l=l[0];null===l?l=null:(l=d(l),l=null===l?null:Math.sqrt(l));return l}},count:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>d(l[0])}};a.aggregateFunction=function(l,f){const r=c[l.toLowerCase()];if(null==r)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(f.length<r.minParams||f.length>r.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:l.toUpperCase()});
return r.evaluate(f)};a.isAggregate=function(l,f){l=c[l.toLowerCase()];return null!=l&&f>=l.minParams&&f<=l.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/DateOnly":function(){define(["exports","../../arcade/ArcadeDate","../../intl/locale","../../chunks/datetime"],function(a,b,n,h){function k(g){g=g.replaceAll(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let e="";const d=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const c of g.match(d)||[])switch(c){case "D":e+="d";break;case "DD":e+="dd";break;case "DDD":e+="o";break;case "d":e+="c";break;case "ddd":e+="ccc";break;case "dddd":e+="cccc";break;case "M":e+="L";break;case "MM":e+="LL";break;case "MMM":e+="LLL";break;case "MMMM":e+="LLLL";break;case "YY":e+="yy";break;case "Y":case "YYYY":e+="yyyy";break;case "Q":e+="q";break;case "X":case "x":e+=c;break;default:e=2<=c.length&&"["===c.slice(0,1)&&"]"===c.slice(-1)?e+`'${c.slice(1,-1)}'`:e+`'${c}'`}return e}
class m{constructor(g,e,d){this._year=g;this._month=e;this._day=d;this.declaredRootClass="esri.core.sql.dateonly"}get month(){return this._month}get monthJS(){return this._month-1}get year(){return this._year}get day(){return this._day}get isValid(){return this.toDateTime("unknown").isValid}equals(g){return g instanceof m&&g.day===this.day&&g.month===this.month&&g.year===this.year}clone(){return new m(this._year,this._month,this._day)}toDateTime(g){return h.DateTime.fromObject({day:this.day,month:this.month,
year:this.year},{zone:b.createDateTimeZone(g)})}toDateTimeLuxon(g){return h.DateTime.fromObject({day:this.day,month:this.month,year:this.year},{zone:b.createDateTimeZone(g)})}toString(){return`${this.year.toString().padStart(4,"0")}-${this.month.toString().padStart(2,"0")}-${this.day.toString().padStart(2,"0")}`}toFormat(g=null,e=!0){if(null===g||""===g)return this.toString();e&&(g=k(g));if(!g)return"";e=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(e).toFormat(g,{locale:n.getLocale(),
numberingSystem:"latn"})}toArcadeDate(){const g=this.toDateTime("unknown");return b.ArcadeDate.dateTimeToArcadeDate(g)}toNumber(){return this.toDateTime("unknown").toMillis()}toJSDate(){return this.toDateTime("unknown").toJSDate()}toStorageFormat(){return this.toFormat("yyyy-LL-dd",!1)}toSQLValue(){return this.toFormat("yyyy-LL-dd",!1)}toSQLWithKeyword(){return"date '"+this.toFormat("yyyy-LL-dd",!1)+"'"}plus(g,e){return m.fromDateTime(this.toUTCDateTime().plus({[g]:e}))}toUTCDateTime(){return h.DateTime.utc(this.year,
this.month,this.day,0,0,0,0)}difference(g,e){switch(e.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(g.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===e?this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(g.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(g.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(g.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(g.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds}}static fromMilliseconds(g){g=h.DateTime.fromMillis(g,{zone:h.FixedOffsetZone.utcInstance});
return g.isValid?m.fromParts(g.year,g.month,g.day):null}static fromSeconds(g){g=h.DateTime.fromSeconds(g,{zone:h.FixedOffsetZone.utcInstance});return g.isValid?m.fromParts(g.year,g.month,g.day):null}static fromReader(g){if(!g)return null;g=g.split("-");return 3!==g.length?null:new m(parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10))}static fromParts(g,e,d){g=new m(g,e,d);return!1===g.isValid?null:g}static fromDateJS(g){return m.fromParts(g.getFullYear(),g.getMonth()+1,g.getDay())}static fromDateTime(g){return m.fromParts(g.year,
g.month,g.day)}static fromSqlTimeStampOffset(g){return this.fromDateTime(g.toDateTime())}static fromString(g,e=null){if(""===g||null===g)return null;var d=[];if(e)(e=k(e))&&d.push(e);else if(null===e||""===e)return g=h.DateTime.fromISO(g,{setZone:!0}),g.isValid?m.fromParts(g.year,g.month,g.day):null;for(const c of d)if(d=h.DateTime.fromFormat(g,e??c),d.isValid)return new m(d.year,d.month,d.day);return null}static fromNow(g="system"){g=h.DateTime.fromJSDate(new Date).setZone(b.createDateTimeZone(g));
return new m(g.year,g.month,g.day)}}a.DateOnly=m;a.standardizeDateOnlyFormat=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlTimestampOffset":function(){define(["exports","../../chunks/datetime"],function(a,b){function n(k){return Number.isNaN(k)||0===k?k:Math.trunc(k)}class h{constructor(k){this._timeStampOffset=k;this._date=null}toDateTime(){this._date??(this._date=b.DateTime.fromISO(this._timeStampOffset,{setZone:!0}));return this._date}get isValid(){return this.toDateTime().isValid}get timezoneOffsetHour(){return n(this.toDateTime().offset/
60)}get timezoneOffsetMinutes(){return n(this.toDateTime().offset%60)}toMilliseconds(){return this.toDateTime().toMillis()}get hour(){return this.toDateTime().hour}get minute(){return this.toDateTime().minute}get second(){return this.toDateTime().second}get day(){return this.toDateTime().day}get month(){return this.toDateTime().month}get year(){return this.toDateTime().year}startOfDay(){return h.fromDateTime(this.toDateTime().startOf("day"))}static fromJSDate(k){return new h(b.DateTime.fromJSDate(k).toISO({includeOffset:!0}))}static fromDateTime(k){return new h(k.toISO({includeOffset:!0}))}static fromParts(k,
m,g=0,e=0,d=0,c=0,l=0,f=!1,r=0,x=0){k=`${k.toString().padStart(4,"0")}-${m.toString().padStart(2,"0")}-${g.toString().padStart(2,"0")}`;m="";10>c&&(m="0");e=`${e.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}:${m+c.toString()}`;0!==l&&(e+="."+l.toString().padStart(3,"0"));l=`${f?"-":"+"}${r.toString().padStart(2,"0")}:${x.toString().padStart(2,"0")}`;return new h(k+"T"+e+l)}toStorageFormat(){return this._timeStampOffset}toString(){return this._timeStampOffset}toSQLValue(){let k=this.toDateTime().toSQL({includeOffset:!0,
includeOffsetSpace:!0});k&&=k.replace(".000","");return k}toSQLWithKeyword(){return`timestamp '${this.toSQLValue()}'`}addMilliseconds(k){k=this.toDateTime().plus(k);return h.fromDateTime(k)}}a.SqlTimeStampOffset=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/TimeOnly":function(){define(["exports","../../arcade/kernel","../../intl/locale","../../chunks/datetime"],function(a,b,n,h){function k(g){if(!g)return"";const e=/(a|A|hh?|HH?|mm?|ss?|SSS|S|.)/g;let d="";for(const c of g.match(e)||
[])switch(c){case "SSS":d+=c;break;case "A":case "a":d+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":d+=c;break;default:d+=`'${c}'`}return d}class m{constructor(g,e,d,c){this._hour=g;this._minute=e;this._second=d;this._millisecond=c;this.declaredRootClass="esri.core.sql.timeonly"}get hour(){return this._hour}get minute(){return this._minute}get second(){return this._second}get millisecond(){return this._millisecond}equals(g){return g instanceof m&&g.hour===
this.hour&&g.minute===this.minute&&g.second===this.second&&g.millisecond===this.millisecond}clone(){return new m(this.hour,this.minute,this.second,this.millisecond)}isValid(){return b.isInteger(this.hour)&&b.isInteger(this.minute)&&b.isInteger(this.second)&&b.isInteger(this.millisecond)&&0<=this.hour&&24>this.hour&&0<=this.minute&&60>this.minute&&0<=this.second&&60>this.second&&0<=this.millisecond&&1E3>this.millisecond}toString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,
"0")}:${this.second.toString().padStart(2,"0")}`+(0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):"")}toSQLValue(){return this.toString()}toSQLWithKeyword(){return`time '${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,"0")}${0<this.millisecond?"."+this.millisecond.toString().padStart(3,"0"):""}'`}toStorageString(){return`${this.hour.toString().padStart(2,"0")}:${this.minute.toString().padStart(2,"0")}:${this.second.toString().padStart(2,
"0")}`}toFormat(g=null){return null===g||""===g?this.toString():(g=k(g))?h.DateTime.local(1970,1,1,this._hour,this._minute,this._second,this._millisecond).toFormat(g,{locale:n.getLocale(),numberingSystem:"latn"}):""}toNumber(){return this.millisecond+1E3*this.second+6E4*this.minute+36E5*this.hour}static fromParts(g,e,d,c){g=new m(g,e,d,c);return g.isValid()?g:null}static fromReader(g){if(!g)return null;g=g.split(":");return 3!==g.length?null:new m(parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],
10),0)}static fromMilliseconds(g){return 864E5<g||0>g?null:new m(Math.floor(g/36E5%24),Math.floor(g/6E4%60),Math.floor(g/1E3%60),Math.floor(g%1E3))}static fromDateJS(g){return new m(g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds())}static fromDateTime(g){return new m(g.hour,g.minute,g.second,g.millisecond)}static fromSqlTimeStampOffset(g){return this.fromDateTime(g.toDateTime())}static fromString(g,e=null){if(""===g||null===g)return null;const d=[];if(e)(e=k(e))&&d.push(e);else if(null===
e||""===e)d.push("HH:mm:ss"),d.push("HH:mm:ss.SSS"),d.push("hh:mm:ss a"),d.push("hh:mm:ss.SSS a"),d.push("HH:mm"),d.push("hh:mm a"),d.push("H:mm"),d.push("h:mm a"),d.push("H:mm:ss"),d.push("h:mm:ss a"),d.push("H:mm:ss.SSS"),d.push("h:mm:ss.SSS a");for(const c of d)if(e=h.DateTime.fromFormat(g,c),e.isValid)return new m(e.hour,e.minute,e.second,e.millisecond);return null}plus(g,e){switch(g){case "days":case "years":case "months":return this.clone();case "hours":case "minutes":case "seconds":case "milliseconds":return m.fromDateTime(this.toUTCDateTime().plus({[g]:e}))}return null}toUTCDateTime(){return h.DateTime.utc(1970,
1,1,this.hour,this.minute,this.second,this.millisecond)}difference(g,e){switch(e.toLowerCase()){case "days":case "day":case "d":return this.toUTCDateTime().diff(g.toUTCDateTime(),"days").days;case "months":case "month":return this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months;case "minutes":case "minute":case "m":return"M"===e?this.toUTCDateTime().diff(g.toUTCDateTime(),"months").months:this.toUTCDateTime().diff(g.toUTCDateTime(),"minutes").minutes;case "seconds":case "second":case "s":return this.toUTCDateTime().diff(g.toUTCDateTime(),
"seconds").seconds;case "milliseconds":case "millisecond":case "ms":return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds;case "hours":case "hour":case "h":return this.toUTCDateTime().diff(g.toUTCDateTime(),"hours").hours;case "years":case "year":case "y":return this.toUTCDateTime().diff(g.toUTCDateTime(),"years").years;default:return this.toUTCDateTime().diff(g.toUTCDateTime(),"milliseconds").milliseconds}}}a.TimeOnly=m;a.standardizeTimeFormat=k;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/arcade/kernel":function(){define(["exports","../geometry/Extent"],function(a,b){a.cloneGeometry=function(n){if(null==n)return null;const h=n.clone();void 0!==n.cache._geVersion&&(h.cache._geVersion=n.cache._geVersion);return h};a.convertLinearUnitsToCode=function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 9001;
case "miles":case "mile":case "squaremile":case "squaremiles":return 9093;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 9036;case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 9096;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 9002;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 9030}return null};a.convertSquareUnitsToCode=
function(n){if(null==n)return null;if("number"===typeof n)return n;n=n.toLowerCase();n=n.replaceAll(/\s/g,"");n=n.replaceAll("-","");switch(n){case "meters":case "meter":case "m":case "squaremeters":case "squaremeter":return 109404;case "miles":case "mile":case "squaremile":case "squaremiles":return 109439;case "kilometers":case "kilometer":case "squarekilometers":case "squarekilometer":case "km":return 109414;case "acres":case "acre":case "ac":return 109402;case "hectares":case "hectare":case "ha":return 109401;
case "yard":case "yd":case "yards":case "squareyards":case "squareyard":return 109442;case "feet":case "ft":case "foot":case "squarefeet":case "squarefoot":return 109405;case "nmi":case "nauticalmile":case "nauticalmiles":case "squarenauticalmile":case "squarenauticalmiles":return 109409}return null};a.isInteger=function(n){return"number"===typeof n&&isFinite(n)&&Math.floor(n)===n};a.sameGeomType=function(n,h){return n===h||"point"===n&&"esriGeometryPoint"===h||"polyline"===n&&"esriGeometryPolyline"===
h||"polygon"===n&&"esriGeometryPolygon"===h||"extent"===n&&"esriGeometryEnvelope"===h||"multipoint"===n&&"esriGeometryMultipoint"===h||"point"===h&&"esriGeometryPoint"===n||"polyline"===h&&"esriGeometryPolyline"===n||"polygon"===h&&"esriGeometryPolygon"===n||"extent"===h&&"esriGeometryEnvelope"===n||"multipoint"===h&&"esriGeometryMultipoint"===n?!0:!1};a.shapeExtent=function(n){if(null==n)return null;switch(n.type){case "polygon":case "multipoint":case "polyline":return n.extent;case "point":return new b({xmin:n.x,
ymin:n.y,xmax:n.x,ymax:n.y,spatialReference:n.spatialReference});case "extent":return n}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlArithmeticUtils":function(){define(["exports","../../arcade/featureset/support/errorsupport","./sqlDateParsingUtils","./SqlInterval","./StandardizedFunctions"],function(a,b,n,h,k){function m(Y,Z,ja){switch(ja){case "+":return Y+Z;case "-":return Y-Z;case "*":return Y*Z;case "/":return Y/Z}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function g(Y,Z,ja){switch(ja){case "+":return Z.plus({milliseconds:Y.valueInMilliseconds()});case "-":return Y.valueInMilliseconds()-Z.toMillis()}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function e(Y,Z,ja){switch(ja){case "+":return Z.plus("milliseconds",Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function d(Y,Z,ja){switch(ja){case "+":return Z.plus("milliseconds",Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function c(Y,
Z,ja){switch(ja){case "+":return Y.plus("milliseconds",Z.valueInMilliseconds());case "-":return Y.plus("milliseconds",-1*Z.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function l(Y,Z,ja){switch(ja){case "+":return Z.addMilliseconds(Y.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function f(Y,Z,ja){switch(ja){case "+":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()+Z.valueInMilliseconds());case "-":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()-
Z.valueInMilliseconds());case "*":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()*Z.valueInMilliseconds());case "/":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()/Z.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function r(Y,Z,ja){switch(ja){case "+":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()+Z);case "-":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()-Z);case "*":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()*
Z);case "/":return h.SqlInterval.createFromMilliseconds(Y.valueInMilliseconds()/Z)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function x(Y,Z,ja){switch(ja){case "+":return h.SqlInterval.createFromMilliseconds(Y+Z.valueInMilliseconds());case "-":return h.SqlInterval.createFromMilliseconds(Y-Z.valueInMilliseconds());case "*":return h.SqlInterval.createFromMilliseconds(Y*Z.valueInMilliseconds());case "/":return h.SqlInterval.createFromMilliseconds(Y/Z.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function w(Y,Z,ja){switch(ja){case "+":return Y.plus("milliseconds",Z.valueInMilliseconds());case "-":return Y.plus("milliseconds",-1*Z.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function p(Y,Z,ja){switch(ja){case "+":return Y.plus({milliseconds:Z.valueInMilliseconds()});case "-":return Y.minus({milliseconds:Z.valueInMilliseconds()})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function t(Y,Z,ja){switch(ja){case "+":return Y.addMilliseconds(Z.valueInMilliseconds());
case "-":return Y.addMilliseconds(-1*Z.valueInMilliseconds())}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function q(Y,Z,ja){Z*=864E5;switch(ja){case "+":return Y.plus({milliseconds:Z});case "-":return Y.minus({milliseconds:Z})}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function u(Y,Z,ja){Z*=864E5;switch(ja){case "+":return Y.plus("milliseconds",Z);case "-":return Y.plus("milliseconds",-1*Z)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function v(Y,Z,ja){Z*=864E5;
switch(ja){case "+":return Y.plus("milliseconds",Z);case "-":return Y.plus("milliseconds",-1*Z)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function y(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function D(Y,Z,ja){Z*=864E5;switch(ja){case "+":return Y.addMilliseconds(Z);case "-":return Y.addMilliseconds(-1*Z)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function G(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function A(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function C(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function E(Y,Z,ja){Z=parseFloat(Z);if(isNaN(Z))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(Y,Z,ja)}function I(Y,Z,ja){Y=parseFloat(Y);if(isNaN(Y))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);return m(Y,Z,ja)}function H(Y,Z,ja){switch(ja){case "+":return Y+Z}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function J(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function B(Y,
Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function z(Y,Z,ja){switch(ja){case "-":return Y.toDateTimeLuxon(Z.zone).diff(Z).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function K(Y,Z,ja){switch(ja){case "-":return Y.toDateTimeLuxon(Z.toDateTime().zone).diff(Z.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function L(Y,Z,ja){switch(ja){case "-":return Y.toDateTimeLuxon("UTC").diff(Z.toDateTimeLuxon("UTC")).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function F(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function M(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function S(Y,Z,ja){switch(ja){case "-":return Y.toDateTime().diff(Z.toDateTimeLuxon(Y.toDateTime().zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function N(Y,Z,ja){switch(ja){case "-":return Y.toDateTime().diff(Z).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function P(Y,Z,ja){switch(ja){case "-":return Y.toDateTime().diff(Z.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function R(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function O(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function T(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function Q(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function V(Y,Z,ja){switch(ja){case "-":return Y.diff(Z).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function U(Y,Z,ja){switch(ja){case "-":return Y.diff(Z.toDateTimeLuxon(Y.zone)).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function W(Y,Z,ja){switch(ja){case "-":return Y.diff(Z.toDateTime()).as("days")}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ca(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function X(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ba(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ia(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function fa(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}function da(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function aa(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ea(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}function ha(Y,Z,ja){throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}a.calculateDateOnlyAndDateOnly=L;a.calculateDateOnlyAndDateTime=z;a.calculateDateOnlyAndNumber=u;a.calculateDateOnlyAndSqlInterval=w;a.calculateDateOnlyAndString=X;a.calculateDateOnlyAndTimeOnly=F;a.calculateDateOnlyAndTimestamp=
K;a.calculateDateTimeAndDateOnly=U;a.calculateDateTimeAndDateTime=V;a.calculateDateTimeAndNumber=q;a.calculateDateTimeAndSqlInterval=p;a.calculateDateTimeAndString=ia;a.calculateDateTimeAndTimeOnly=ca;a.calculateDateTimeAndTimestamp=W;a.calculateNumberAndDateOnly=C;a.calculateNumberAndDateTime=y;a.calculateNumberAndNumber=m;a.calculateNumberAndSqlInterval=x;a.calculateNumberAndString=E;a.calculateNumberAndTimeOnly=A;a.calculateNumberAndTimestamp=G;a.calculateSqlIntervalAndDateOnly=d;a.calculateSqlIntervalAndDateTime=
g;a.calculateSqlIntervalAndNumber=r;a.calculateSqlIntervalAndSqlInterval=f;a.calculateSqlIntervalAndString=J;a.calculateSqlIntervalAndTimeOnly=e;a.calculateSqlIntervalAndTimestamp=l;a.calculateStringAndDateOnly=aa;a.calculateStringAndDateTime=ea;a.calculateStringAndNumber=I;a.calculateStringAndSqlInterval=B;a.calculateStringAndString=H;a.calculateStringAndTimeOnly=da;a.calculateStringAndTimestamp=ha;a.calculateTimeOnlyAndDateOnly=O;a.calculateTimeOnlyAndDateTime=R;a.calculateTimeOnlyAndNumber=v;a.calculateTimeOnlyAndSqlInterval=
c;a.calculateTimeOnlyAndString=ba;a.calculateTimeOnlyAndTimeOnly=Q;a.calculateTimeOnlyAndTimestamp=T;a.calculateTimestampAndDateOnly=S;a.calculateTimestampAndDateTime=N;a.calculateTimestampAndNumber=D;a.calculateTimestampAndSqlInterval=t;a.calculateTimestampAndString=fa;a.calculateTimestampAndTimeOnly=M;a.calculateTimestampAndTimestamp=P;a.sqlCalculateFunction=function(Y,Z,ja,oa){if("||"===Y)return k.evaluateFunction("concat",[Z,ja],oa);if(null===Z||null===ja)return null;if(n.isNumber(Z)){if(n.isNumber(ja))return m(Z,
ja,Y);if(n.isSqlInterval(ja))return x(Z,ja,Y);if(n.isTimeOnly(ja))return A();if(n.isDateOnly(ja))return C();if(n.isTimestampOffset(ja))return G();if(n.isDateTime(ja))return y();if(n.isString(ja))return E(Z,ja,Y)}else if(n.isDateOnly(Z)){if(n.isNumber(ja))return u(Z,ja,Y);if(n.isSqlInterval(ja))return w(Z,ja,Y);if(n.isTimeOnly(ja))return F();if(n.isDateOnly(ja))return L(Z,ja,Y);if(n.isTimestampOffset(ja))return K(Z,ja,Y);if(n.isDateTime(ja))return z(Z,ja,Y);if(n.isString(ja))return X()}else if(n.isTimeOnly(Z)){if(n.isNumber(ja))return v(Z,
ja,Y);if(n.isSqlInterval(ja))return c(Z,ja,Y);if(n.isTimeOnly(ja))return Q();if(n.isDateOnly(ja))return O();if(n.isTimestampOffset(ja))return T();if(n.isDateTime(ja))return R();if(n.isString(ja))return ba()}else if(n.isSqlInterval(Z)){if(n.isNumber(ja))return r(Z,ja,Y);if(n.isSqlInterval(ja))return f(Z,ja,Y);if(n.isTimeOnly(ja))return e(Z,ja,Y);if(n.isDateOnly(ja))return d(Z,ja,Y);if(n.isTimestampOffset(ja))return l(Z,ja,Y);if(n.isDateTime(ja))return g(Z,ja,Y);if(n.isString(ja))return J()}else if(n.isDateTime(Z)){if(n.isNumber(ja))return q(Z,
ja,Y);if(n.isSqlInterval(ja))return p(Z,ja,Y);if(n.isTimeOnly(ja))return ca();if(n.isDateOnly(ja))return U(Z,ja,Y);if(n.isTimestampOffset(ja))return W(Z,ja,Y);if(n.isDateTime(ja))return V(Z,ja,Y);if(n.isString(ja))return ia()}else if(n.isTimestampOffset(Z)){if(n.isNumber(ja))return D(Z,ja,Y);if(n.isSqlInterval(ja))return t(Z,ja,Y);if(n.isTimeOnly(ja))return M();if(n.isDateOnly(ja))return S(Z,ja,Y);if(n.isTimestampOffset(ja))return P(Z,ja,Y);if(n.isDateTime(ja))return N(Z,ja,Y);if(n.isString(ja))return fa()}else if(n.isString(Z)){if(n.isNumber(ja))return I(Z,
ja,Y);if(n.isSqlInterval(ja))return B();if(n.isTimeOnly(ja))return da();if(n.isDateOnly(ja))return aa();if(n.isTimestampOffset(ja))return ha();if(n.isDateTime(ja))return ea();if(n.isString(ja))return H(Z,ja,Y)}throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlDateParsingUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./DateOnly ./SqlInterval ./SqlTimestampOffset ./TimeOnly ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,n,h,k,m,g,e){function d(q,u,v){v=x.exec(q);if(null!==v){const [,y,D,G,A,C,E,I]=v;q=e.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(G,10),hour:parseInt(A,10),minute:parseInt(C,10),second:parseInt(E,10),millisecond:I?parseInt(I.replace(".",""),10):0},{zone:g.substituteUnknownTimezone(u)});if(!1===q.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return q}v=w.exec(q);if(null!==v){const [,y,D,G,A,C,E,I,H,J,B]=v;q=k.SqlTimeStampOffset.fromParts(parseInt(y,
10),parseInt(D,10),parseInt(G,10),parseInt(A,10),parseInt(C,10),parseInt(E,10),I?parseInt(I.replace(".",""),10):0,"-"===H,parseInt(J,10),parseInt(B,10));if(!1===q.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return q}v=p.exec(q);if(null!==v){const [,y,D,G,A,C,E,I,H]=v;q=k.SqlTimeStampOffset.fromParts(parseInt(y,10),parseInt(D,10),parseInt(G,10),parseInt(A,10),parseInt(C,10),0,0,"-"===E,parseInt(I,10),parseInt(H,10));if(!1===q.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);
return q}v=t.exec(q);if(null!==v){const [,y,D,G,A,C]=v;q=e.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(G,10),hour:parseInt(A,10),minute:parseInt(C,10),second:0},{zone:g.substituteUnknownTimezone(u)});if(!1===q.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return q}v=r.exec(q);if(null!==v){const [,y,D,G]=v;q=e.DateTime.fromObject({year:parseInt(y,10),month:parseInt(D,10),day:parseInt(G,10),hour:0,minute:0,second:0},{zone:g.substituteUnknownTimezone(u)});
if(!1===q.isValid)throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);return q}throw new b.SqlError(b.SqlErrorCodes.InvalidTimeStamp);}const c=/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/,l=/^(\d{1,2}):(\d{1,2})$/,f=/^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/,r=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$/,
t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;a.convertToExecutingTimeZone=function(q,u){if(u instanceof e.Zone)return u===g.UnknownTimeZone.instance?e.DateTime.fromMillis(q.getTime(),{zone:g.UnknownTimeZone.instance}):e.DateTime.fromJSDate(q,{zone:u});switch(u){case "system":case "local":case null:return e.DateTime.fromJSDate(q);default:return"unknown"===u?.toLowerCase()?e.DateTime.fromMillis(q.getTime(),{zone:g.UnknownTimeZone.instance}):e.DateTime.fromJSDate(q,{zone:u})}};a.isDate=function(q){return q instanceof
Date};a.isDateOnly=function(q){return q instanceof n.DateOnly};a.isDateTime=function(q){return q instanceof e.DateTime};a.isNumber=function(q){return"number"===typeof q};a.isSqlInterval=function(q){return q instanceof h.SqlInterval};a.isString=function(q){return"string"===typeof q||q instanceof String};a.isTimeOnly=function(q){return q instanceof m.TimeOnly};a.isTimestampOffset=function(q){return q instanceof k.SqlTimeStampOffset};a.parseDate=function(q,u){const v=r.exec(q);if(null===v)try{return d(q,
u)}catch{throw new b.SqlError(b.SqlErrorCodes.InvalidDate);}const [,y,D,G]=v;q=n.DateOnly.fromParts(parseInt(y,10),parseInt(D,10),parseInt(G,10));if(null===q)throw new b.SqlError(b.SqlErrorCodes.InvalidDate);return q};a.parseTime=function(q){let u=c.exec(q);if(null!==u){const [,v,y,D]=u;q=m.TimeOnly.fromParts(parseInt(v,10),parseInt(y,10),parseInt(D,10),0);if(null!==q)return q;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}u=l.exec(q);if(null!==u){const [,v,y]=u;q=m.TimeOnly.fromParts(parseInt(v,
10),parseInt(y,10),0,0);if(null!==q)return q;throw new b.SqlError(b.SqlErrorCodes.InvalidTime);}u=f.exec(q);if(null!==u){const [,v,y,D,G]=u;q=m.TimeOnly.fromParts(parseInt(v,10),parseInt(y,10),parseInt(D,10),parseInt(G,10));if(null!==q)return q}throw new b.SqlError(b.SqlErrorCodes.InvalidTime);};a.parseTimestamp=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/SqlInterval":function(){define(["exports","../../arcade/featureset/support/errorsupport"],function(a,b){class n{constructor(){this.op=
"+";this.millis=this.minute=this.year=this.month=this.hour=this.second=this.day=0}static _fixDefaults(h){if(null!==h.precision||null!==h.secondary)throw new b.SqlError(b.SqlErrorCodes.PrimarySecondaryQualifiers);}static _parseSecondsComponent(h,k){k.includes(".")?(k=k.split("."),h.second=parseFloat(k[0]),h.millis=parseInt(k[1],10)):h.second=parseFloat(k)}static createFromMilliseconds(h){const k=new n;k.second=h/1E3;return k}static createFromValueAndQualifier(h,k,m){let g=null;const e=new n;e.op="-"===
m?"-":"+";if("interval-period"===k.type){n._fixDefaults(k);m=RegExp("^[0-9]{1,}$");if("year"===k.period||"month"===k.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);if("second"===k.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(h))n._parseSecondsComponent(e,h);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);else if(m.test(h))e[k.period]=parseFloat(h);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}else{n._fixDefaults(k.start);n._fixDefaults(k.end);if("year"===
k.start.period||"month"===k.start.period||"year"===k.end.period||"month"===k.end.period)throw new b.SqlError(b.SqlErrorCodes.YearMonthIntervals);switch(k.start.period){case "day":switch(k.end.period){case "hour":g=RegExp("^[0-9]{1,} [0-9]{1,}$");if(g.test(h))e[k.start.period]=parseFloat(h.split(" ")[0]),e[k.end.period]=parseFloat(h.split(" ")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "minute":g=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(g.test(h))e[k.start.period]=
parseFloat(h.split(" ")[0]),h=h.split(" ")[1].split(":"),e.hour=parseFloat(h[0]),e.minute=parseFloat(h[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":g=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(g.test(h))e[k.start.period]=parseFloat(h.split(" ")[0]),h=h.split(" ")[1].split(":"),e.hour=parseFloat(h[0]),e.minute=parseFloat(h[1]),n._parseSecondsComponent(e,h[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "hour":switch(k.end.period){case "minute":g=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(g.test(h))e.hour=parseFloat(h.split(":")[0]),e.minute=parseFloat(h.split(":")[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;case "second":g=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(g.test(h))h=h.split(":"),e.hour=parseFloat(h[0]),e.minute=parseFloat(h[1]),n._parseSecondsComponent(e,h[2]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);
}break;case "minute":switch(k.end.period){case "second":g=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(g.test(h))h=h.split(":"),e.minute=parseFloat(h[0]),n._parseSecondsComponent(e,h[1]);else throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}break;default:throw new b.SqlError(b.SqlErrorCodes.IllegalInterval);}}return e}valueInMilliseconds(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*
this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)}}a.SqlInterval=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define("exports ../../arcade/featureset/support/errorsupport ../string ./DateOnly ./sqlCompareUtils ./sqlDateParsingUtils ./TimeOnly ../../chunks/datetime".split(" "),function(a,b,n,h,k,m,g,e){function d(p){return"string"===typeof p||p instanceof String}function c(p){return m.isDate(p)||m.isDateOnly(p)||
m.isDateTime(p)||m.isTimeOnly(p)||m.isTimestampOffset(p)?!1:!0}function l(p){return m.isDateOnly(p)||m.isTimeOnly(p)?p.toString():m.isTimestampOffset(p)?p.toSQLValue():m.isDateTime(p)?0===p.millisecond?p.toFormat("yyyy-LL-dd HH:mm:ss"):p.toSQL({includeOffset:!1}):m.isDate(p)?l(e.DateTime.fromJSDate(p)):p.toString()}function f(p){if(m.isDate(p))return h.DateOnly.fromDateJS(p);if(m.isDateTime(p))return h.DateOnly.fromParts(p.year,p.month,p.day);if(m.isDateOnly(p))return p;if(m.isTimeOnly(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(m.isTimestampOffset(p)&&null===h.DateOnly.fromParts(p.year,p.month,p.day))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(d(p)&&(p=h.DateOnly.fromReader(p),null!==p&&p.isValid))return p;throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function r(p,t,q){if(m.isDate(p))return m.convertToExecutingTimeZone(p,t);if(m.isDateTime(p))return p;if(m.isDateOnly(p))return p.toDateTimeLuxon("unknown");if(m.isTimeOnly(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimestampOffset(p))return p;
if(d(p))return m.parseTimestamp(p,"unknown",q);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}function x(p){if(m.isDate(p))return g.TimeOnly.fromDateJS(p);if(m.isDateTime(p))return g.TimeOnly.fromDateTime(p);if(m.isDateOnly(p))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);if(m.isTimeOnly(p))return p;if(m.isTimestampOffset(p))return g.TimeOnly.fromSqlTimeStampOffset(p);if(d(p))return m.parseTime(p);throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);}const w={extract:{minParams:2,
maxParams:2,evaluate:([p,t])=>{if(null==t)return null;if(m.isDate(t))switch(p.toUpperCase()){case "SECOND":return t.getSeconds();case "MINUTE":return t.getMinutes();case "HOUR":return t.getHours();case "DAY":return t.getDate();case "MONTH":return t.getMonth()+1;case "YEAR":return t.getFullYear();case "TIMEZONE_HOUR":return 0;case "TIMEZONE_MINUTE":return 0}else if(m.isDateTime(t))switch(p.toUpperCase()){case "SECOND":return t.second;case "MINUTE":return t.minute;case "HOUR":return t.hour;case "DAY":return t.day;
case "MONTH":return t.month;case "YEAR":return t.year}else if(m.isDateOnly(t))switch(p.toUpperCase()){case "DAY":return t.day;case "MONTH":return t.month;case "YEAR":return t.year}else if(m.isTimeOnly(t))switch(p.toUpperCase()){case "SECOND":return t.second;case "MINUTE":return t.minute;case "HOUR":return t.hour}else if(m.isTimestampOffset(t))switch(p.toUpperCase()){case "SECOND":return t.second;case "MINUTE":return t.minute;case "HOUR":return t.hour;case "DAY":return t.day;case "MONTH":return t.month;
case "YEAR":return t.year;case "TIMEZONE_HOUR":return t.timezoneOffsetHour;case "TIMEZONE_MINUTE":return t.timezoneOffsetMinutes}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"EXTRACT"});}},substring:{minParams:2,maxParams:3,evaluate:p=>{if(2===p.length){const [t,q]=p;return null==t||null==q?null:t.toString().substring(q-1)}if(3===p.length){const [t,q,u]=p;return null==t||null==q||null==u?null:0>=u?"":t.toString().substring(q-1,q+u-1)}}},position:{minParams:2,maxParams:2,
evaluate:([p,t])=>null==p||null==t?null:t.indexOf(p)+1},trim:{minParams:2,maxParams:3,evaluate:p=>{var t=3===p.length,q=t?p[1]:" ";t=t?p[2]:p[1];if(null==q||null==t)return null;q=`(${n.escapeRegExpString(q)})`;switch(p[0]){case "BOTH":return t.replaceAll(new RegExp(`^${q}*|${q}*$`,"g"),"");case "LEADING":return t.replaceAll(new RegExp(`^${q}*`,"g"),"");case "TRAILING":return t.replaceAll(new RegExp(`${q}*$`,"g"),"")}throw new b.SqlError(b.SqlErrorCodes.InvalidFunctionParameters,{function:"TRIM"});
}},abs:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.abs(p[0])},ceiling:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.ceil(p[0])},floor:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.floor(p[0])},log:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.log(p[0])},log10:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.log(p[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.sin(p[0])},cos:{minParams:1,maxParams:1,evaluate:p=>
null==p[0]?null:Math.cos(p[0])},tan:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.tan(p[0])},asin:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.asin(p[0])},acos:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.acos(p[0])},atan:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.atan(p[0])},sign:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:0<p[0]?1:0>p[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:p=>null==p[0]||null==p[1]?null:p[0]**p[1]},mod:{minParams:2,
maxParams:2,evaluate:p=>null==p[0]||null==p[1]?null:p[0]%p[1]},round:{minParams:1,maxParams:2,evaluate:p=>{const t=p[0];p=2===p.length?10**p[1]:1;return null==t?null:Math.round(t*p)/p}},truncate:{minParams:1,maxParams:2,evaluate:p=>null==p[0]?null:1===p.length?parseInt(p[0].toFixed(0),10):parseFloat(p[0].toFixed(p[1]))},char_length:{minParams:1,maxParams:1,evaluate:p=>d(p[0])?p[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:p=>{let t="";for(let q=0;q<p.length;q++){if(null==p[q])return null;
t+=p[q].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:p[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:p[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:p=>{for(const t of p)if(null!==t)return t;return null}},cosh:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.cosh(p[0])},sinh:{minParams:1,maxParams:1,evaluate:p=>null==p[0]?null:Math.sinh(p[0])},tanh:{minParams:1,maxParams:1,evaluate:p=>
null==p[0]?null:Math.tanh(p[0])},nullif:{minParams:2,maxParams:2,evaluate:(p,t)=>k.sqlCompare(p[0],p[1],"\x3d")?null:p[0]},cast:{minParams:2,maxParams:2,evaluate:(p,t)=>{const q=p[0];p=p[1];if(null===q)return null;switch(p.type){case "integer":if(!c(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);t=parseInt(q,10);if(isNaN(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return t;case "smallint":if(!c(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);t=parseInt(q,10);if(isNaN(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);
if(32767<t||-32767>t)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return t;case "float":case "real":if(!c(q))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);t=parseFloat(q);if(isNaN(t))throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return t;case "time":return x(q);case "date":return f(q);case "timestamp":return r(q,t,!0===p.withtimezone);case "varchar":t=l(q);if(t.length>p.size)throw new b.SqlError(b.SqlErrorCodes.CannotCastValue);return t;default:throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);
}}}};a.evaluateFunction=function(p,t,q){const u=w[p.toLowerCase()];if(null==u)throw new b.SqlError(b.SqlErrorCodes.FunctionNotRecognized);if(t.length<u.minParams||t.length>u.maxParams)throw new b.SqlError(b.SqlErrorCodes.InvalidParameterCount,{name:p.toUpperCase()});return u.evaluate(t,q)};a.isStandardized=function(p,t){p=w[p.toLowerCase()];return null!=p&&t>=p.minParams&&t<=p.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/sqlCompareUtils":function(){define("exports ../../arcade/featureset/support/errorsupport ./sqlDateParsingUtils ./SqlTimestampOffset ./UnknownTimeZone ../../chunks/datetime".split(" "),
function(a,b,n,h,k,m){function g(p){return n.isDateTime(p)||n.isTimestampOffset(p)?!0:!1}function e(p){return n.isDateTime(p)||n.isDateOnly(p)||n.isTimestampOffset(p)||n.isTimeOnly(p)?!0:!1}function d(p){if(n.isDateTime(p))return p.toMillis();if(n.isDateOnly(p))return p.toNumber();if(n.isTimestampOffset(p))return p.toMilliseconds();throw new b.SqlError(b.SqlErrorCodes.InvalidDataType);}function c(p,t,q){switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<
t;case "\x3e\x3d":return p>=t;case "\x3c\x3d":return p<=t}}function l(p,t,q){const u=parseFloat(t);if(!isNaN(u))return c(p,u,q);p=p.toString();switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<t;case "\x3e\x3d":return p>=t;case "\x3c\x3d":return p<=t}}function f(p,t,q){const u=parseFloat(p);if(!isNaN(u))return c(u,t,q);t=t.toString();switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<
t;case "\x3e\x3d":return p>=t;case "\x3c\x3d":return p<=t}}function r(p,t,q){switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<t;case "\x3e\x3d":return p>=t;case "\x3c\x3d":return p<=t}}function x(p,t,q){p instanceof h.SqlTimeStampOffset&&(p=p.toDateTime());t instanceof h.SqlTimeStampOffset&&(t=t.toDateTime());p=w(p);t=w(t);switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<t;case "\x3e\x3d":return p>=
t;case "\x3c\x3d":return p<=t}}function w(p){return 321408E5*p.year+26784E5*p.month+864E5*p.day+36E5*p.hour+6E4*p.minute+1E3*p.second+p.millisecond}a.dateValueInMilliseconds=d;a.isDateOrTimeValue=e;a.isDateTimeComparableValue=g;a.sqlCompare=function(p,t,q,u){if(null==p||null==t)return null;if(n.isNumber(p)){if(n.isNumber(t))return c(p,t,q);if(n.isString(t))return l(p,t,q);if(e(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
}else if(n.isString(p)){if(n.isNumber(t))return f(p,t,q);if(n.isString(t))return r(p,t,q);if(n.isDateTime(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isTimeOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isTimestampOffset(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isDateTime(p)){if(g(t)){if(p instanceof m.DateTime&&k.isUnknownTimeZone(p.zone)){if(t instanceof m.DateTime&&
!1===k.isUnknownTimeZone(t.zone)||t instanceof h.SqlTimeStampOffset)return x(p,t,q)}else if(t instanceof m.DateTime&&k.isUnknownTimeZone(t.zone)&&(p instanceof m.DateTime&&!1===k.isUnknownTimeZone(p.zone)||p instanceof h.SqlTimeStampOffset))return x(p,t,q);return c(d(p),d(t),q)}if(n.isString(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))return t=t.toDateTimeLuxon(p.zone),p=p.startOf("day"),c(p.toMillis(),t.toMillis(),q);if(n.isTimeOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(n.isNumber(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isDateOnly(p)){if(n.isTimestampOffset(t))return p=p.toDateTimeLuxon(t.toDateTime().zone),t=t.startOfDay(),c(p.toMillis(),t.toMilliseconds(),q);if(n.isDateTime(t))return p=p.toDateTimeLuxon(t.zone),t=t.startOf("day"),c(p.toMillis(),t.toMillis(),q);if(n.isString(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))return c(p.toNumber(),t.toNumber(),q);if(n.isTimeOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);
if(n.isNumber(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isTimeOnly(p)){if(n.isTimeOnly(t))return c(p.toNumber(),t.toNumber(),q);if(n.isString(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(g(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}else if(n.isTimestampOffset(p)){if(g(t))return t instanceof m.DateTime&&
k.isUnknownTimeZone(t.zone)?x(p,t,q):c(d(p),d(t),q);if(n.isString(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isDateOnly(t))return t=t.toDateTimeLuxon(p.toDateTime().zone),p=p.startOfDay(),c(p.toMilliseconds(),t.toMillis(),q);if(n.isTimeOnly(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);if(n.isNumber(t))throw new b.SqlError(b.SqlErrorCodes.InvalidOperator);}switch(q){case "\x3c\x3e":return p!==t;case "\x3d":return p===t;case "\x3e":return p>t;case "\x3c":return p<t;case "\x3e\x3d":return p>=
t;case "\x3c\x3d":return p<=t}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var n={exports:{}};(function(m){(function(g,e){m.exports&&(m.exports=e())})(b.commonjsGlobal,function(){function g(d,c,l,f){d=Error.call(this,d);Object.setPrototypeOf&&Object.setPrototypeOf(d,g.prototype);d.expected=c;d.found=l;d.location=f;d.name="SyntaxError";return d}function e(d,c,l){l=l||" ";if(d.length>
c)return d;c-=d.length;l+=l.repeat(c);return d+l.slice(0,c)}(function(d,c){function l(){this.constructor=d}l.prototype=c.prototype;d.prototype=new l})(g,Error);g.prototype.format=function(d){var c="Error: "+this.message;if(this.location){var l=null,f;for(f=0;f<d.length;f++)if(d[f].source===this.location.source){l=d[f].text.split(/\r\n|\n|\r/g);break}d=this.location.start;f=this.location.source&&"function"===typeof this.location.source.offset?this.location.source.offset(d):d;var r=this.location.source+
":"+f.line+":"+f.column;if(l){var x=this.location.end,w=e("",f.line.toString().length," ");l=l[d.line-1];x=(d.line===x.line?x.column:l.length+1)-d.column||1;c+="\n --\x3e "+r+"\n"+w+" |\n"+f.line+" | "+l+"\n"+w+" | "+e("",d.column-1," ")+e("",x,"^")}else c+="\n at "+r}return c};g.buildMessage=function(d,c){function l(p){return p.charCodeAt(0).toString(16).toUpperCase()}function f(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,
"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+l(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+l(t)})}function r(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+l(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+l(t)})}function x(p){return w[p.type](p)}var w={literal:function(p){return'"'+
f(p.text)+'"'},class:function(p){var t=p.parts.map(function(q){return Array.isArray(q)?r(q[0])+"-"+r(q[1]):r(q)});return"["+(p.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};return"Expected "+function(p){p=p.map(x);var t,q;p.sort();if(0<p.length){for(q=t=1;t<p.length;t++)p[t-1]!==p[t]&&(p[q]=p[t],q++);p.length=q}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,
-1).join(", ")+", or "+p[p.length-1]}}(d)+" but "+(c?'"'+f(c)+'"':"end of input")+" found."};return{SyntaxError:g,parse:function(d,c){function l(za,Fa){Fa=void 0!==Fa?Fa:w(fb,la);throw new g(za,null,null,Fa);}function f(za,Fa){return{type:"literal",text:za,ignoreCase:Fa}}function r(za,Fa,La){return{type:"class",parts:za,inverted:Fa,ignoreCase:La}}function x(za){var Fa=Ae[za],La;if(!Fa){for(La=za-1;!Ae[La];)La--;Fa=Ae[La];for(Fa={line:Fa.line,column:Fa.column};La<za;)10===d.charCodeAt(La)?(Fa.line++,
Fa.column=1):Fa.column++,La++;Ae[za]=Fa}return Fa}function w(za,Fa,La){var Ya=x(za),kb=x(Fa);za={source:mb,start:{offset:za,line:Ya.line,column:Ya.column},end:{offset:Fa,line:kb.line,column:kb.column}};La&&mb&&"function"===typeof mb.offset&&(za.start=mb.offset(za.start),za.end=mb.offset(za.end));return za}function p(za){la<ed||(la>ed&&(ed=la,bf=[]),bf.push(za))}function t(){var za=la;Pa();var Fa=u();Fa!==ka?(Pa(),fb=za,za=Fa):(la=za,za=ka);return za}function q(){var za=la;var Fa=u();if(Fa!==ka){var La=
[];var Ya=la;var kb=Pa();var ub=Na();if(ub!==ka){var Kb=Pa();var Ob=u();Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)}else la=Ya,Ya=ka;for(;Ya!==ka;)La.push(Ya),Ya=la,kb=Pa(),ub=Na(),ub!==ka?(Kb=Pa(),Ob=u(),Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)):(la=Ya,Ya=ka);fb=za;za={type:"expression-list"};Fa=[Fa];for(Ya=0;Ya<La.length;Ya++)Fa.push(La[Ya][3]);za.value=Fa}else la=za,za=ka;return za}function u(){var za=la;var Fa=v();if(Fa!==ka){var La=[];var Ya=la;var kb=Pa();var ub=ja();if(ub!==ka){var Kb=Pa();
var Ob=v();Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)}else la=Ya,Ya=ka;for(;Ya!==ka;)La.push(Ya),Ya=la,kb=Pa(),ub=ja(),ub!==ka?(Kb=Pa(),Ob=v(),Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)):(la=Ya,Ya=ka);fb=za;za=cb(Fa,La)}else la=za,za=ka;return za}function v(){var za=la;var Fa=y();if(Fa!==ka){var La=[];var Ya=la;var kb=Pa();var ub=Z();if(ub!==ka){var Kb=Pa();var Ob=y();Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)}else la=Ya,Ya=ka;for(;Ya!==ka;)La.push(Ya),Ya=la,kb=Pa(),ub=Z(),ub!==ka?(Kb=Pa(),Ob=y(),Ob!==
ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)):(la=Ya,Ya=ka);fb=za;za=cb(Fa,La)}else la=za,za=ka;return za}function y(){var za=la;var Fa=Y();if(Fa===ka){Fa=la;if(33===d.charCodeAt(la)){var La=xa;la++}else La=ka,0===$a&&p(yc);if(La!==ka){var Ya=la;$a++;if(61===d.charCodeAt(la)){var kb=Ia;la++}else kb=ka,0===$a&&p(pc);$a--;kb===ka?Ya=void 0:(la=Ya,Ya=ka);Ya!==ka?Fa=La=[La,Ya]:(la=Fa,Fa=ka)}else la=Fa,Fa=ka}Fa!==ka?(La=Pa(),Ya=y(),Ya!==ka?(fb=za,za={type:"unary-expression",operator:"NOT",expr:Ya}):(la=za,za=
ka)):(la=za,za=ka);if(za===ka){Fa=la;za=C();if(za!==ka){Pa();La=la;Ya=[];kb=la;var ub=Pa();var Kb=D();if(Kb!==ka){var Ob=Pa();var Kd=C();Kd!==ka?kb=ub=[ub,Kb,Ob,Kd]:(la=kb,kb=ka)}else la=kb,kb=ka;if(kb!==ka)for(;kb!==ka;)Ya.push(kb),kb=la,ub=Pa(),Kb=D(),Kb!==ka?(Ob=Pa(),Kd=C(),Kd!==ka?kb=ub=[ub,Kb,Ob,Kd]:(la=kb,kb=ka)):(la=kb,kb=ka);else Ya=ka;Ya!==ka&&(fb=La,Ya={type:"arithmetic",tail:Ya});La=Ya;La===ka&&(La=la,Ya=A(),Ya!==ka?(Pa(),kb=Va(),kb!==ka?(Pa(),kb=q(),kb!==ka?(Pa(),ub=Xa(),ub!==ka?(fb=La,
La={op:Ya,right:kb}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,Ya=A(),Ya!==ka?(Pa(),kb=Va(),kb!==ka?(Pa(),kb=Xa(),kb!==ka?(fb=La,La={op:Ya,right:{type:"expression-list",value:[]}}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,Ya=A(),Ya!==ka?(Pa(),kb=S(),kb!==ka?(fb=La,La={op:Ya,right:kb}):(la=La,La=ka)):(la=La,La=ka))),La===ka&&(La=la,ub=Y(),ub!==ka?(Pa(),Ya=oa(),Ya!==ka?(Pa(),kb=C(),kb!==ka?(Pa(),Kb=Z(),Kb!==ka?(Pa(),ub=C(),ub!==ka?(fb=La,La={op:"NOT"+
Ya,right:{type:"expression-list",value:[kb,ub]}}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,ub=oa(),ub!==ka?(Pa(),Ya=C(),Ya!==ka?(Pa(),kb=Z(),kb!==ka?(Pa(),Kb=C(),Kb!==ka?(fb=La,La={op:ub,right:{type:"expression-list",value:[Ya,Kb]}}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)),La===ka&&(La=la,Ya=ea(),Ya!==ka?(Pa(),kb=Y(),kb!==ka?(Pa(),kb=C(),kb!==ka?(fb=La,La={op:Ya+"NOT",right:kb}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),La===ka&&
(La=la,Ya=ea(),Ya!==ka?(Pa(),kb=C(),kb!==ka?(fb=La,La={op:Ya,right:kb}):(la=La,La=ka)):(la=La,La=ka)),La===ka&&(La=la,Ya=G(),Ya!==ka?(Pa(),kb=Q(),kb!==ka?(Pa(),ub=la,d.substr(la,6).toLowerCase()===Ib?(Kb=d.substr(la,6),la+=6):(Kb=ka,0===$a&&p(ge)),Kb!==ka?(Kb=la,$a++,Ob=K(),$a--,Ob===ka?Kb=void 0:(la=Kb,Kb=ka),Kb!==ka?(fb=ub,ub="ESCAPE"):(la=ub,ub=ka)):(la=ub,ub=ka),ub!==ka?(Pa(),ub=V(),ub!==ka?(fb=La,La={op:Ya,right:kb,escape:ub.value}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),
La===ka&&(La=la,Ya=G(),Ya!==ka?(Pa(),kb=Q(),kb!==ka?(fb=La,La={op:Ya,right:kb,escape:""}):(la=La,La=ka)):(la=La,La=ka))))));La===ka&&(La=null);fb=Fa;Fa=La;""==Fa||void 0==Fa||null==Fa?Fa=za:(La=null,Fa=La="arithmetic"==Fa.type?cb(za,Fa.tail):gb(Fa.op,za,Fa.right,Fa.escape))}else la=Fa,Fa=ka;za=Fa}return za}function D(){if(d.substr(la,2)===na){var za=na;la+=2}else za=ka,0===$a&&p(zc);za===ka&&(62===d.charCodeAt(la)?(za=ya,la++):(za=ka,0===$a&&p(hd)),za===ka&&(d.substr(la,2)===Da?(za=Da,la+=2):(za=
ka,0===$a&&p(Bd)),za===ka&&(d.substr(la,2)===Oa?(za=Oa,la+=2):(za=ka,0===$a&&p(Zc)),za===ka&&(60===d.charCodeAt(la)?(za=Wa,la++):(za=ka,0===$a&&p(Cd)),za===ka&&(61===d.charCodeAt(la)?(za=Ia,la++):(za=ka,0===$a&&p(pc)),za===ka&&(d.substr(la,2)===ab?(za=ab,la+=2):(za=ka,0===$a&&p(Dd))))))));return za}function G(){var za;var Fa=za=la;var La=Y();if(La!==ka){var Ya=Pa();var kb=ha();kb!==ka?Fa=La=[La,Ya,kb]:(la=Fa,Fa=ka)}else la=Fa,Fa=ka;Fa!==ka&&(fb=za,Fa=Fa[0]+" "+Fa[2]);za=Fa;za===ka&&(za=ha());return za}
function A(){var za;var Fa=za=la;var La=Y();if(La!==ka){var Ya=Pa();var kb=aa();kb!==ka?Fa=La=[La,Ya,kb]:(la=Fa,Fa=ka)}else la=Fa,Fa=ka;Fa!==ka&&(fb=za,Fa=Fa[0]+" "+Fa[2]);za=Fa;za===ka&&(za=aa());return za}function C(){var za=la;var Fa=I();if(Fa!==ka){var La=[];var Ya=la;var kb=Pa();var ub=E();if(ub!==ka){var Kb=Pa();var Ob=I();Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)}else la=Ya,Ya=ka;for(;Ya!==ka;)La.push(Ya),Ya=la,kb=Pa(),ub=E(),ub!==ka?(Kb=Pa(),Ob=I(),Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)):
(la=Ya,Ya=ka);fb=za;za=cb(Fa,La)}else la=za,za=ka;return za}function E(){if(43===d.charCodeAt(la)){var za=Ja;la++}else za=ka,0===$a&&p($c);za===ka&&(45===d.charCodeAt(la)?(za=Ra,la++):(za=ka,0===$a&&p(id)),za===ka&&(d.substr(la,2)===Sa?(za=Sa,la+=2):(za=ka,0===$a&&p(vd))));return za}function I(){var za=la;var Fa=J();if(Fa!==ka){var La=[];var Ya=la;var kb=Pa();var ub=H();if(ub!==ka){var Kb=Pa();var Ob=J();Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)}else la=Ya,Ya=ka;for(;Ya!==ka;)La.push(Ya),Ya=la,kb=
Pa(),ub=H(),ub!==ka?(Kb=Pa(),Ob=J(),Ob!==ka?Ya=kb=[kb,ub,Kb,Ob]:(la=Ya,Ya=ka)):(la=Ya,Ya=ka);fb=za;za=cb(Fa,La)}else la=za,za=ka;return za}function H(){if(42===d.charCodeAt(la)){var za=db;la++}else za=ka,0===$a&&p(ee);za===ka&&(47===d.charCodeAt(la)?(za=eb,la++):(za=ka,0===$a&&p(Ed)));return za}function J(){var za=V();if(za===ka){var Fa=la;var La=la;var Ya=X();if(Ya!==ka){var kb=ba();if(kb!==ka){var ub=ia();ub!==ka?(fb=La,La=parseFloat(Ya+kb+ub)):(la=La,La=ka)}else la=La,La=ka}else la=La,La=ka;La===
ka&&(La=la,Ya=X(),Ya!==ka?(kb=ba(),kb!==ka?(fb=La,La=parseFloat(Ya+kb)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,Ya=X(),Ya!==ka?(kb=ia(),kb!==ka?(fb=La,La=parseFloat(Ya+kb)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,Ya=X(),Ya!==ka&&(fb=La,Ya=parseFloat(Ya)),La=Ya)));var Kb=La;if(Kb!==ka){var Ob=la;$a++;var Kd=z();$a--;Kd===ka?Ob=void 0:(la=Ob,Ob=ka);Ob!==ka?(fb=Fa,Fa={type:"number",value:Kb}):(la=Fa,Fa=ka)}else la=Fa,Fa=ka;za=Fa;if(za===ka){var Ld=la;var le=la;if(d.substr(la,4).toLowerCase()===
Yb){var Be=d.substr(la,4);la+=4}else Be=ka,0===$a&&p(Wc);if(Be!==ka){var oe=la;$a++;var Uf=K();$a--;Uf===ka?oe=void 0:(la=oe,oe=ka);oe!==ka?le=Be=[Be,oe]:(la=le,le=ka)}else la=le,le=ka;var Md=le;Md!==ka&&(fb=Ld,Md={type:"boolean",value:!0});Ld=Md;if(Ld===ka){Ld=la;var me=la;if(d.substr(la,5).toLowerCase()===bc){var Ce=d.substr(la,5);la+=5}else Ce=ka,0===$a&&p(cd);if(Ce!==ka){var pe=la;$a++;var Vf=K();$a--;Vf===ka?pe=void 0:(la=pe,pe=ka);pe!==ka?me=Ce=[Ce,pe]:(la=me,me=ka)}else la=me,me=ka;Md=me;Md!==
ka&&(fb=Ld,Md={type:"boolean",value:!1});Ld=Md}za=Ld;if(za===ka){var Wf=la;var ne=la;if(d.substr(la,4).toLowerCase()===Lb){var De=d.substr(la,4);la+=4}else De=ka,0===$a&&p(Tc);if(De!==ka){var qe=la;$a++;var Xf=K();$a--;Xf===ka?qe=void 0:(la=qe,qe=ka);qe!==ka?ne=De=[De,qe]:(la=ne,ne=ka)}else la=ne,ne=ka;var cf=ne;cf!==ka&&(fb=Wf,cf={type:"null",value:null});za=cf;if(za===ka){var Nd=la;if(Ca()!==ka){Pa();var Ee=Q();Ee!==ka?(fb=Nd,"string"===Ee.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Ee.value)&&
l("Date literal is invalid"),Nd={type:"date",value:Ee.value}):(la=Nd,Nd=ka)}else la=Nd,Nd=ka;za=Nd;if(za===ka){var Od=la;if(va()!==ka){Pa();var Fe=Q();Fe!==ka?(fb=Od,"string"===Fe.type&&!0!==/^(\d{4})-(\d{1,2})-(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})(\.[0-9]+)?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})?[ ]{0,1}(\+|\-)(\d{1,2}):(\d{1,2})$|^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/.test(Fe.value)&&
l("Timestamp literal is invalid"),Od={type:"timestamp",value:Fe.value}):(la=Od,Od=ka)}else la=Od,Od=ka;za=Od;if(za===ka){var sc=la;var df=wa();if(df!==ka){Pa();if(45===d.charCodeAt(la)){var pd=Ra;la++}else pd=ka,0===$a&&p(id);pd===ka&&(43===d.charCodeAt(la)?(pd=Ja,la++):(pd=ka,0===$a&&p($c)));if(pd!==ka){Pa();var re=Q();if(re!==ka){Pa();var rf=P();rf!==ka?(fb=sc,sc={type:"interval",value:re,qualifier:rf,op:pd}):(la=sc,sc=ka)}else la=sc,sc=ka}else la=sc,sc=ka}else la=sc,sc=ka;sc===ka&&(sc=la,df=wa(),
df!==ka?(Pa(),pd=Q(),pd!==ka?(Pa(),re=P(),re!==ka?(fb=sc,sc={type:"interval",value:pd,qualifier:re,op:""}):(la=sc,sc=ka)):(la=sc,sc=ka)):(la=sc,sc=ka));za=sc;if(za===ka){var Pd=la;if(ma()!==ka){Pa();var Ge=Q();Ge!==ka?(fb=Pd,"string"===Ge.type&&!0!==/^(\d{1,2}):(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2})$|^(\d{1,2}):(\d{1,2}):(\d{1,2}).([0-9]+)$/.test(Ge.value)&&l("Time literal is invalid"),Pd={type:"time",value:Ge.value}):(la=Pd,Pd=ka)}else la=Pd,Pd=ka;za=Pd}}}}}}}var dc=za;if(dc===ka){var Gc=la;var Qd=
la;if(d.substr(la,7).toLowerCase()===Za){var sf=d.substr(la,7);la+=7}else sf=ka,0===$a&&p(Xc);if(sf!==ka){var He=la;$a++;var Yf=K();$a--;Yf===ka?He=void 0:(la=He,He=ka);He!==ka?(fb=Qd,Qd="EXTRACT"):(la=Qd,Qd=ka)}else la=Qd,Qd=ka;if(Qd!==ka){Pa();var Zf=Va();if(Zf!==ka){Pa();var Hc=Ba();if(Hc===ka&&(Hc=pa(),Hc===ka&&(Hc=Aa(),Hc===ka&&(Hc=ra(),Hc===ka&&(Hc=ua(),Hc===ka&&(Hc=Ea(),Hc===ka)))))){var Rd=la;if(d.substr(la,13).toLowerCase()===Nb){var tf=d.substr(la,13);la+=13}else tf=ka,0===$a&&p($f);if(tf!==
ka){var Ie=la;$a++;var ag=K();$a--;ag===ka?Ie=void 0:(la=Ie,Ie=ka);Ie!==ka?(fb=Rd,Rd="TIMEZONE_HOUR"):(la=Rd,Rd=ka)}else la=Rd,Rd=ka;Hc=Rd;if(Hc===ka){var Sd=la;if(d.substr(la,15).toLowerCase()===Wb){var uf=d.substr(la,15);la+=15}else uf=ka,0===$a&&p(bg);if(uf!==ka){var Je=la;$a++;var cg=K();$a--;cg===ka?Je=void 0:(la=Je,Je=ka);Je!==ka?(fb=Sd,Sd="TIMEZONE_MINUTE"):(la=Sd,Sd=ka)}else la=Sd,Sd=ka;Hc=Sd}}var vf=Hc;if(vf!==ka){Pa();var dg=qa();if(dg!==ka){Pa();var wf=u();if(wf!==ka){Pa();var eg=Xa();
eg!==ka?(fb=Gc,Gc={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:vf},wf]}}):(la=Gc,Gc=ka)}else la=Gc,Gc=ka}else la=Gc,Gc=ka}else la=Gc,Gc=ka}else la=Gc,Gc=ka}else la=Gc,Gc=ka;dc=Gc;if(dc===ka){var Ic=la;var Td=la;if(d.substr(la,9).toLowerCase()===Ta){var xf=d.substr(la,9);la+=9}else xf=ka,0===$a&&p(Oc);if(xf!==ka){var Ke=la;$a++;var fg=K();$a--;fg===ka?Ke=void 0:(la=Ke,Ke=ka);Ke!==ka?(fb=Td,Td="SUBSTRING"):(la=Td,Td=ka)}else la=Td,Td=ka;if(Td!==ka){Pa();var gg=
Va();if(gg!==ka){Pa();var ef=u();if(ef!==ka){Pa();var hg=qa();if(hg!==ka){Pa();var ff=u();if(ff!==ka){Pa();var qd=la;var Ud=la;if(d.substr(la,3).toLowerCase()===Qa){var yf=d.substr(la,3);la+=3}else yf=ka,0===$a&&p(yd);if(yf!==ka){var Le=la;$a++;var ig=K();$a--;ig===ka?Le=void 0:(la=Le,Le=ka);Le!==ka?(fb=Ud,Ud="FOR"):(la=Ud,Ud=ka)}else la=Ud,Ud=ka;var se=Ud;if(se!==ka){var jg=Pa();var zf=u();if(zf!==ka){var kg=Pa();qd=se=[se,jg,zf,kg]}else la=qd,qd=ka}else la=qd,qd=ka;qd===ka&&(qd=null);se=Xa();se!==
ka?(fb=Ic,Ic={type:"function",name:"substring",args:{type:"expression-list",value:qd?[ef,ff,qd[2]]:[ef,ff]}}):(la=Ic,Ic=ka)}else la=Ic,Ic=ka}else la=Ic,Ic=ka}else la=Ic,Ic=ka}else la=Ic,Ic=ka}else la=Ic,Ic=ka;dc=Ic;if(dc===ka){var lc=la;var gf=ta();if(gf!==ka){Pa();var hf=Va();if(hf!==ka){Pa();var rd=N();rd===ka&&(rd=null);Pa();var te=u();if(te!==ka){Pa();var jf=qa();if(jf!==ka){Pa();var Af=u();if(Af!==ka){Pa();var lg=Xa();lg!==ka?(fb=lc,lc={type:"function",name:"trim",args:{type:"expression-list",
value:[{type:"string",value:null==rd?"BOTH":rd},te,Af]}}):(la=lc,lc=ka)}else la=lc,lc=ka}else la=lc,lc=ka}else la=lc,lc=ka}else la=lc,lc=ka}else la=lc,lc=ka;lc===ka&&(lc=la,gf=ta(),gf!==ka?(Pa(),hf=Va(),hf!==ka?(Pa(),rd=N(),rd===ka&&(rd=null),Pa(),te=u(),te!==ka?(Pa(),jf=Xa(),jf!==ka?(fb=lc,lc={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==rd?"BOTH":rd},te]}}):(la=lc,lc=ka)):(la=lc,lc=ka)):(la=lc,lc=ka)):(la=lc,lc=ka));dc=lc;if(dc===ka){var Jc=la;var Vd=
la;if(d.substr(la,8).toLowerCase()===ib){var Bf=d.substr(la,8);la+=8}else Bf=ka,0===$a&&p(nd);if(Bf!==ka){var Me=la;$a++;var mg=K();$a--;mg===ka?Me=void 0:(la=Me,Me=ka);Me!==ka?(fb=Vd,Vd="POSITION"):(la=Vd,Vd=ka)}else la=Vd,Vd=ka;if(Vd!==ka){Pa();var ng=Va();if(ng!==ka){Pa();var Cf=u();if(Cf!==ka){Pa();var og=aa();if(og!==ka){Pa();var Df=u();if(Df!==ka){Pa();var pg=Xa();pg!==ka?(fb=Jc,Jc={type:"function",name:"position",args:{type:"expression-list",value:[Cf,Df]}}):(la=Jc,Jc=ka)}else la=Jc,Jc=ka}else la=
Jc,Jc=ka}else la=Jc,Jc=ka}else la=Jc,Jc=ka}else la=Jc,Jc=ka;dc=Jc;if(dc===ka){var Kc=la;var Wd=la;if(d.substr(la,4).toLowerCase()===Tb){var Ef=d.substr(la,4);la+=4}else Ef=ka,0===$a&&p(Jd);if(Ef!==ka){var Ne=la;$a++;var qg=K();$a--;qg===ka?Ne=void 0:(la=Ne,Ne=ka);Ne!==ka?(fb=Wd,Wd="CAST"):(la=Wd,Wd=ka)}else la=Wd,Wd=ka;if(Wd!==ka){Pa();var rg=Va();if(rg!==ka){Pa();var Ff=u();if(Ff!==ka){Pa();var Xd=la;if(d.substr(la,2).toLowerCase()===nb){var Gf=d.substr(la,2);la+=2}else Gf=ka,0===$a&&p(Bb);if(Gf!==
ka){var Oe=la;$a++;var sg=K();$a--;sg===ka?Oe=void 0:(la=Oe,Oe=ka);Oe!==ka?(fb=Xd,Xd="AS"):(la=Xd,Xd=ka)}else la=Xd,Xd=ka;var tg=Xd;if(tg!==ka){Pa();var Pb=la;var Yd=la;if(d.substr(la,7).toLowerCase()===xb){var Hf=d.substr(la,7);la+=7}else Hf=ka,0===$a&&p(jc);if(Hf!==ka){var Pe=la;$a++;var ug=K();$a--;ug===ka?Pe=void 0:(la=Pe,Pe=ka);Pe!==ka?(fb=Yd,Yd="INTEGER"):(la=Yd,Yd=ka)}else la=Yd,Yd=ka;var ec=Yd;ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"integer"}});Pb=ec;if(Pb===ka){Pb=la;var Zd=la;
if(d.substr(la,8).toLowerCase()===Ab){var If=d.substr(la,8);la+=8}else If=ka,0===$a&&p(qc);if(If!==ka){var Qe=la;$a++;var vg=K();$a--;vg===ka?Qe=void 0:(la=Qe,Qe=ka);Qe!==ka?(fb=Zd,Zd="SMALLINT"):(la=Zd,Zd=ka)}else la=Zd,Zd=ka;ec=Zd;ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"smallint"}});Pb=ec;if(Pb===ka){Pb=la;var $d=la;if(d.substr(la,5).toLowerCase()===Mb){var Jf=d.substr(la,5);la+=5}else Jf=ka,0===$a&&p(Lc);if(Jf!==ka){var Re=la;$a++;var wg=K();$a--;wg===ka?Re=void 0:(la=Re,Re=ka);Re!==
ka?(fb=$d,$d="FLOAT"):(la=$d,$d=ka)}else la=$d,$d=ka;ec=$d;ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"float"}});Pb=ec;if(Pb===ka){Pb=la;var ae=la;if(d.substr(la,4).toLowerCase()===gc){var Kf=d.substr(la,4);la+=4}else Kf=ka,0===$a&&p($e);if(Kf!==ka){var Se=la;$a++;var xg=K();$a--;xg===ka?Se=void 0:(la=Se,Se=ka);Se!==ka?(fb=ae,ae="REAL"):(la=ae,ae=ka)}else la=ae,ae=ka;ec=ae;ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"real"}});Pb=ec;if(Pb===ka&&(Pb=la,ec=Ca(),ec!==ka&&(fb=Pb,ec={type:"data-type",
value:{type:"date"}}),Pb=ec,Pb===ka&&(Pb=la,ec=va(),ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"timestamp"}}),Pb=ec,Pb===ka&&(Pb=la,ec=ma(),ec!==ka&&(fb=Pb,ec={type:"data-type",value:{type:"time"}}),Pb=ec,Pb===ka)))){Pb=la;var be=la;if(d.substr(la,7).toLowerCase()===Vb){var Lf=d.substr(la,7);la+=7}else Lf=ka,0===$a&&p(af);if(Lf!==ka){var Te=la;$a++;var yg=K();$a--;yg===ka?Te=void 0:(la=Te,Te=ka);Te!==ka?(fb=be,be="VARCHAR"):(la=be,be=ka)}else la=be,be=ka;ec=be;if(ec!==ka){Pa();var zg=Va();if(zg!==
ka){Pa();var Mf=fa();if(Mf!==ka){Pa();var Ag=Xa();Ag!==ka?(fb=Pb,Pb={type:"data-type",value:{type:"varchar",size:parseInt(Mf)}}):(la=Pb,Pb=ka)}else la=Pb,Pb=ka}else la=Pb,Pb=ka}else la=Pb,Pb=ka}}}}var Nf=Pb;if(Nf!==ka){Pa();var Bg=Xa();Bg!==ka?(fb=Kc,Kc={type:"function",name:"cast",args:{type:"expression-list",value:[Ff,Nf]}}):(la=Kc,Kc=ka)}else la=Kc,Kc=ka}else la=Kc,Kc=ka}else la=Kc,Kc=ka}else la=Kc,Kc=ka}else la=Kc,Kc=ka;dc=Kc;if(dc===ka){var sd=la;var Qc=la;var ue=B();ue!==ka&&(fb=Qc);Qc=ue;if(Qc===
ka)if(Qc=la,96===d.charCodeAt(la)?(ue=Bc,la++):(ue=ka,0===$a&&p(Of)),ue!==ka){var Ue=[];if(Dc.test(d.charAt(la))){var td=d.charAt(la);la++}else td=ka,0===$a&&p(Pf);if(td!==ka)for(;td!==ka;)Ue.push(td),Dc.test(d.charAt(la))?(td=d.charAt(la),la++):(td=ka,0===$a&&p(Pf));else Ue=ka;Ue!==ka?(96===d.charCodeAt(la)?(td=Bc,la++):(td=ka,0===$a&&p(Of)),td!==ka?(fb=Qc,Qc=Ue.join("")):(la=Qc,Qc=ka)):(la=Qc,Qc=ka)}else la=Qc,Qc=ka;var Qf=Qc;if(Qf!==ka){Pa();var Cg=Va();if(Cg!==ka){Pa();var Ve=q();Ve===ka&&(Ve=
null);Pa();var Dg=Xa();Dg!==ka?(fb=sd,sd={type:"function",name:Qf,args:Ve?Ve:{type:"expression-list",value:[]}}):(la=sd,sd=ka)}else la=sd,sd=ka}else la=sd,sd=ka;dc=sd;if(dc===ka){var fd;var tc=la;var kf=Ka();if(kf!==ka){Pa();var ve=u();if(ve!==ka){Pa();var we=[];for(fd=W();fd!==ka;)we.push(fd),fd=W();fd=Pa();var We=Ma();We!==ka?(fb=tc,tc={type:"case-expression",format:"simple",operand:ve,clauses:we,else:null}):(la=tc,tc=ka)}else la=tc,tc=ka}else la=tc,tc=ka;if(tc===ka)if(tc=la,kf=Ka(),kf!==ka)if(Pa(),
ve=u(),ve!==ka){Pa();we=[];for(fd=W();fd!==ka;)we.push(fd),fd=W();fd=Pa();We=ca();if(We!==ka){Pa();var Eg=Ma();Eg!==ka?(fb=tc,tc={type:"case-expression",format:"simple",operand:ve,clauses:we,else:We.value}):(la=tc,tc=ka)}else la=tc,tc=ka}else la=tc,tc=ka;else la=tc,tc=ka;var lf=tc;if(lf===ka){var gd;var Ac=la;var mf=Ka();if(mf!==ka){Pa();var xe=[];for(gd=U();gd!==ka;)xe.push(gd),gd=U();gd=Pa();var Xe=Ma();Xe!==ka?(fb=Ac,Ac={type:"case-expression",format:"searched",clauses:xe,else:null}):(la=Ac,Ac=
ka)}else la=Ac,Ac=ka;if(Ac===ka)if(Ac=la,mf=Ka(),mf!==ka){Pa();xe=[];for(gd=U();gd!==ka;)xe.push(gd),gd=U();gd=Pa();Xe=ca();if(Xe!==ka){Pa();var Fg=Ma();Fg!==ka?(fb=Ac,Ac={type:"case-expression",format:"searched",clauses:xe,else:Xe.value}):(la=Ac,Ac=ka)}else la=Ac,Ac=ka}else la=Ac,Ac=ka;lf=Ac}dc=lf;if(dc===ka){var ce=la;var Gg=la;var Ye;var ye=la;var Rf=z();if(Rf!==ka){var Sf=[];for(Ye=L();Ye!==ka;)Sf.push(Ye),Ye=L();fb=ye;ye=Rf+Sf.join("")}else la=ye,ye=ka;var Tf=ye;Tf!==ka&&(fb=Gg);var ud=Tf;if(ud!==
ka){fb=ce;var nf=ud;ud=/^CURRENT_DATE$/i.test(nf)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(nf)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:nf}}ce=ud;if(ce===ka){ce=la;var de=la;if(M()!==ka){var Ze;var Hg=la;var of=[];for(Ze=F();Ze!==ka;)of.push(Ze),Ze=F();fb=Hg;var Ig=of=of.join("");var Jg=M();Jg!==ka?(fb=de,de=Ig):(la=de,de=ka)}else la=de,de=ka;ud=de;ud!==ka&&(fb=ce,ud={type:"column-reference",table:"",column:ud,delimited:!0});ce=ud}dc=ce;
if(dc===ka&&(dc=S(),dc===ka)){dc=la;var Kg=Va();if(Kg!==ka){Pa();var pf=u();if(pf!==ka){Pa();var Lg=Xa();Lg!==ka?(fb=dc,pf.paren=!0,dc=pf):(la=dc,dc=ka)}else la=dc,dc=ka}else la=dc,dc=ka}}}}}}}}}return dc}function B(){var za;var Fa=la;var La=z();if(La!==ka){var Ya=[];for(za=K();za!==ka;)Ya.push(za),za=K();fb=Fa;Fa=La+Ya.join("")}else la=Fa,Fa=ka;return Fa}function z(){if(Cc.test(d.charAt(la))){var za=d.charAt(la);la++}else za=ka,0===$a&&p(fe);return za}function K(){if(vc.test(d.charAt(la))){var za=
d.charAt(la);la++}else za=ka,0===$a&&p(Fd);return za}function L(){if(nc.test(d.charAt(la))){var za=d.charAt(la);la++}else za=ka,0===$a&&p(Gd);return za}function F(){if(nc.test(d.charAt(la))){var za=d.charAt(la);la++}else za=ka,0===$a&&p(Gd);if(za===ka)if(za=la,M()!==ka){var Fa=M();Fa!==ka?(fb=za,za='"'):(la=za,za=ka)}else la=za,za=ka;return za}function M(){if(wc.test(d.charAt(la))){var za=d.charAt(la);la++}else za=ka,0===$a&&p(jd);return za}function S(){var za;var Fa=za=la;if(64===d.charCodeAt(la)){var La=
lb;la++}else La=ka,0===$a&&p(wd);if(La!==ka){var Ya=B();Ya!==ka?Fa=La=[La,Ya]:(la=Fa,Fa=ka)}else la=Fa,Fa=ka;Fa!==ka&&(fb=za,Fa={type:"parameter",value:Fa[1]});return Fa}function N(){var za=la;if(d.substr(la,7).toLowerCase()===wb){var Fa=d.substr(la,7);la+=7}else Fa=ka,0===$a&&p(od);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="LEADING"):(la=za,za=ka)}else la=za,za=ka;za===ka&&(za=la,d.substr(la,8).toLowerCase()===Fb?(Fa=d.substr(la,8),la+=8):(Fa=ka,0===
$a&&p(Ad)),Fa!==ka?(Fa=la,$a++,La=K(),$a--,La===ka?Fa=void 0:(la=Fa,Fa=ka),Fa!==ka?(fb=za,za="TRAILING"):(la=za,za=ka)):(la=za,za=ka),za===ka&&(za=la,d.substr(la,4).toLowerCase()===zb?(Fa=d.substr(la,4),la+=4):(Fa=ka,0===$a&&p(Id)),Fa!==ka?(Fa=la,$a++,La=K(),$a--,La===ka?Fa=void 0:(la=Fa,Fa=ka),Fa!==ka?(fb=za,za="BOTH"):(la=za,za=ka)):(la=za,za=ka)));return za}function P(){var za=la;var Fa=la;var La=R();if(La!==ka){Pa();var Ya=Va();if(Ya!==ka)if(Pa(),Ya=T(),Ya!==ka){Pa();var kb=Xa();kb!==ka?(fb=Fa,
Fa={type:"interval-period",period:La.value,precision:Ya,secondary:null}):(la=Fa,Fa=ka)}else la=Fa,Fa=ka;else la=Fa,Fa=ka}else la=Fa,Fa=ka;Fa===ka&&(Fa=la,La=R(),La!==ka&&(fb=Fa,La={type:"interval-period",period:La.value,precision:null,secondary:null}),Fa=La);if(Fa!==ka)if(Pa(),La=la,d.substr(la,2).toLowerCase()===Zb?(Ya=d.substr(la,2),la+=2):(Ya=ka,0===$a&&p(ze)),Ya!==ka?(Ya=la,$a++,kb=K(),$a--,kb===ka?Ya=void 0:(la=Ya,Ya=ka),Ya!==ka?(fb=La,La="TO"):(la=La,La=ka)):(la=La,La=ka),La!==ka){Pa();La=la;
Ya=R();Ya!==ka&&(fb=La,Ya={type:"interval-period",period:Ya.value,precision:null,secondary:null});La=Ya;if(La===ka){La=la;Ya=Ea();if(Ya!==ka)if(Pa(),Ya=Va(),Ya!==ka)if(Pa(),Ya=T(),Ya!==ka)if(Pa(),kb=Na(),kb!==ka)if(Pa(),kb=O(),kb!==ka){Pa();var ub=Xa();ub!==ka?(fb=La,La={type:"interval-period",period:"second",precision:Ya,secondary:kb}):(la=La,La=ka)}else la=La,La=ka;else la=La,La=ka;else la=La,La=ka;else la=La,La=ka;else la=La,La=ka;La===ka&&(La=la,Ya=Ea(),Ya!==ka?(Pa(),Ya=Va(),Ya!==ka?(Pa(),Ya=
T(),Ya!==ka?(Pa(),kb=Xa(),kb!==ka?(fb=La,La={type:"interval-period",period:"second",precision:Ya,secondary:null}):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka)):(la=La,La=ka),La===ka&&(La=la,Ya=Ea(),Ya!==ka&&(fb=La,Ya={type:"interval-period",period:"second",precision:null,secondary:null}),La=Ya))}La!==ka?(fb=za,za={type:"interval-qualifier",start:Fa,end:La}):(la=za,za=ka)}else la=za,za=ka;else la=za,za=ka;za===ka&&(za=la,La=R(),La!==ka?(Pa(),Fa=Va(),Fa!==ka?(Pa(),Fa=O(),Fa!==ka?(Pa(),Ya=Xa(),Ya!==ka?
(fb=za,za={type:"interval-period",period:La.value,precision:Fa,secondary:null}):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka),za===ka&&(za=la,La=R(),La!==ka&&(fb=za,La={type:"interval-period",period:La.value,precision:null,secondary:null}),za=La,za===ka&&(za=la,La=Ea(),La!==ka?(Pa(),Fa=Va(),Fa!==ka?(Pa(),Fa=T(),Fa!==ka?(Pa(),Ya=Na(),Ya!==ka?(Pa(),La=O(),La!==ka?(Pa(),Ya=Xa(),Ya!==ka?(fb=za,za={type:"interval-period",period:"second",precision:Fa,secondary:La}):(la=za,za=ka)):(la=za,za=
ka)):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka),za===ka&&(za=la,La=Ea(),La!==ka?(Pa(),Fa=Va(),Fa!==ka?(Pa(),Fa=O(),Fa!==ka?(Pa(),Ya=Xa(),Ya!==ka?(fb=za,za={type:"interval-period",period:"second",precision:Fa,secondary:null}):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka)):(la=za,za=ka),za===ka&&(za=la,La=Ea(),La!==ka&&(fb=za,La={type:"interval-period",period:"second",precision:null,secondary:null}),za=La)))));return za}function R(){var za=la;var Fa=Aa();Fa!==ka&&(fb=za,Fa={type:"string",
value:"day"});za=Fa;za===ka&&(za=la,Fa=ra(),Fa!==ka&&(fb=za,Fa={type:"string",value:"hour"}),za=Fa,za===ka&&(za=la,Fa=ua(),Fa!==ka&&(fb=za,Fa={type:"string",value:"minute"}),za=Fa,za===ka&&(za=la,Fa=pa(),Fa!==ka&&(fb=za,Fa={type:"string",value:"month"}),za=Fa,za===ka&&(za=la,Fa=Ba(),Fa!==ka&&(fb=za,Fa={type:"string",value:"year"}),za=Fa))));return za}function O(){var za=la;var Fa=fa();Fa!==ka&&(fb=za,Fa=parseFloat(Fa));return Fa}function T(){var za=la;var Fa=fa();Fa!==ka&&(fb=za,Fa=parseFloat(Fa));
return Fa}function Q(){var za=V();za===ka&&(za=S());return za}function V(){var za=la;if(39===d.charCodeAt(la)){var Fa=sb;la++}else Fa=ka,0===$a&&p(Ec);Fa===ka&&(d.substr(la,2)===vb?(Fa=vb,la+=2):(Fa=ka,0===$a&&p(ad)));if(Fa!==ka){Fa=[];var La=la;if(d.substr(la,2)===rb){var Ya=rb;la+=2}else Ya=ka,0===$a&&p(Rc);Ya!==ka&&(fb=La,Ya="'");La=Ya;La===ka&&(xc.test(d.charAt(la))?(La=d.charAt(la),la++):(La=ka,0===$a&&p(bd)));for(;La!==ka;)Fa.push(La),La=la,d.substr(la,2)===rb?(Ya=rb,la+=2):(Ya=ka,0===$a&&p(Rc)),
Ya!==ka&&(fb=La,Ya="'"),La=Ya,La===ka&&(xc.test(d.charAt(la))?(La=d.charAt(la),la++):(La=ka,0===$a&&p(bd)));39===d.charCodeAt(la)?(La=sb,la++):(La=ka,0===$a&&p(Ec));La!==ka?(fb=za,za={type:"string",value:Fa.join("")}):(la=za,za=ka)}else la=za,za=ka;return za}function U(){var za=la;if(Ua()!==ka){Pa();var Fa=u();if(Fa!==ka){Pa();var La=Ga();La!==ka?(Pa(),La=u(),La!==ka?(fb=za,za={type:"when-clause",operand:Fa,value:La}):(la=za,za=ka)):(la=za,za=ka)}else la=za,za=ka}else la=za,za=ka;return za}function W(){var za=
la;if(Ua()!==ka){Pa();var Fa=u();if(Fa!==ka){Pa();var La=Ga();La!==ka?(Pa(),La=u(),La!==ka?(fb=za,za={type:"when-clause",operand:Fa,value:La}):(la=za,za=ka)):(la=za,za=ka)}else la=za,za=ka}else la=za,za=ka;return za}function ca(){var za=la;var Fa=la;if(d.substr(la,4).toLowerCase()===Rb){var La=d.substr(la,4);la+=4}else La=ka,0===$a&&p(Mg);if(La!==ka){La=la;$a++;var Ya=K();$a--;Ya===ka?La=void 0:(la=La,La=ka);La!==ka?(fb=Fa,Fa="ELSE"):(la=Fa,Fa=ka)}else la=Fa,Fa=ka;Fa!==ka?(Pa(),Fa=u(),Fa!==ka?(fb=
za,za={type:"else-clause",value:Fa}):(la=za,za=ka)):(la=za,za=ka);return za}function X(){var za=fa();if(za===ka){za=la;if(45===d.charCodeAt(la)){var Fa=Ra;la++}else Fa=ka,0===$a&&p(id);Fa===ka&&(43===d.charCodeAt(la)?(Fa=Ja,la++):(Fa=ka,0===$a&&p($c)));if(Fa!==ka){var La=fa();La!==ka?(fb=za,za=Fa[0]+La):(la=za,za=ka)}else la=za,za=ka}return za}function ba(){var za=la;if(46===d.charCodeAt(la)){var Fa=Eb;la++}else Fa=ka,0===$a&&p(kd);Fa!==ka?(Fa=fa(),Fa===ka&&(Fa=null),fb=za,za="."+(null!=Fa?Fa:"")):
(la=za,za=ka);return za}function ia(){var za;var Fa=za=la;if(Mc.test(d.charAt(la))){var La=d.charAt(la);la++}else La=ka,0===$a&&p(Sc);La!==ka?(Yc.test(d.charAt(la))?(La=d.charAt(la),la++):(La=ka,0===$a&&p(uc)),La===ka&&(La=null),fb=Fa,Fa="e"+(null===La?"":La)):(la=Fa,Fa=ka);Fa!==ka?(La=fa(),La!==ka?(fb=za,za=Fa+La):(la=za,za=ka)):(la=za,za=ka);return za}function fa(){var za=la;var Fa=[];var La=da();if(La!==ka)for(;La!==ka;)Fa.push(La),La=da();else Fa=ka;Fa!==ka&&(fb=za,Fa=Fa.join(""));return Fa}function da(){if(Fc.test(d.charAt(la))){var za=
d.charAt(la);la++}else za=ka,0===$a&&p(Vc);return za}function aa(){var za=la;if(d.substr(la,2).toLowerCase()===fc){var Fa=d.substr(la,2);la+=2}else Fa=ka,0===$a&&p(ld);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="IN"):(la=za,za=ka)}else la=za,za=ka;return za}function ea(){var za=la;if(d.substr(la,2).toLowerCase()===kc){var Fa=d.substr(la,2);la+=2}else Fa=ka,0===$a&&p(Nc);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=
za,za="IS"):(la=za,za=ka)}else la=za,za=ka;return za}function ha(){var za=la;if(d.substr(la,4).toLowerCase()===Cb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(dd);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="LIKE"):(la=za,za=ka)}else la=za,za=ka;return za}function Y(){var za=la;if(d.substr(la,3).toLowerCase()===Ub){var Fa=d.substr(la,3);la+=3}else Fa=ka,0===$a&&p(xd);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=
za,za="NOT"):(la=za,za=ka)}else la=za,za=ka;return za}function Z(){var za=la;if(d.substr(la,3).toLowerCase()===Sb){var Fa=d.substr(la,3);la+=3}else Fa=ka,0===$a&&p(md);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="AND"):(la=za,za=ka)}else la=za,za=ka;return za}function ja(){var za=la;if(d.substr(la,2).toLowerCase()===jb){var Fa=d.substr(la,2);la+=2}else Fa=ka,0===$a&&p(Hd);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=
za,za="OR"):(la=za,za=ka)}else la=za,za=ka;return za}function oa(){var za=la;if(d.substr(la,7).toLowerCase()===sa){var Fa=d.substr(la,7);la+=7}else Fa=ka,0===$a&&p(he);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="BETWEEN"):(la=za,za=ka)}else la=za,za=ka;return za}function qa(){var za=la;if(d.substr(la,4).toLowerCase()===Ha){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(ie);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?
(fb=za,za="FROM"):(la=za,za=ka)}else la=za,za=ka;return za}function ta(){var za=la;if(d.substr(la,4).toLowerCase()===hb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Pc);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="TRIM"):(la=za,za=ka)}else la=za,za=ka;return za}function va(){var za=la;if(d.substr(la,9).toLowerCase()===pb){var Fa=d.substr(la,9);la+=9}else Fa=ka,0===$a&&p(zd);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==
ka?(fb=za,za="TIMESTAMP"):(la=za,za=ka)}else la=za,za=ka;return za}function Ca(){var za=la;if(d.substr(la,4).toLowerCase()===ob){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(je);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="DATE"):(la=za,za=ka)}else la=za,za=ka;return za}function ma(){var za=la;if(d.substr(la,4).toLowerCase()===yb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(ke);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=
ka);Fa!==ka?(fb=za,za="TIME"):(la=za,za=ka)}else la=za,za=ka;return za}function wa(){var za=la;if(d.substr(la,8).toLowerCase()===hc){var Fa=d.substr(la,8);la+=8}else Fa=ka,0===$a&&p(Ng);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="INTERVAL"):(la=za,za=ka)}else la=za,za=ka;return za}function Ba(){var za=la;if(d.substr(la,4).toLowerCase()===Qb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Og);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=
Fa,Fa=ka);Fa!==ka?(fb=za,za="YEAR"):(la=za,za=ka)}else la=za,za=ka;return za}function pa(){var za=la;if(d.substr(la,5).toLowerCase()===Hb){var Fa=d.substr(la,5);la+=5}else Fa=ka,0===$a&&p(Pg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="MONTH"):(la=za,za=ka)}else la=za,za=ka;return za}function Aa(){var za=la;if(d.substr(la,3).toLowerCase()===Gb){var Fa=d.substr(la,3);la+=3}else Fa=ka,0===$a&&p(Qg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:
(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="DAY"):(la=za,za=ka)}else la=za,za=ka;return za}function ra(){var za=la;if(d.substr(la,4).toLowerCase()===Xb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Rg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="HOUR"):(la=za,za=ka)}else la=za,za=ka;return za}function ua(){var za=la;if(d.substr(la,6).toLowerCase()===$b){var Fa=d.substr(la,6);la+=6}else Fa=ka,0===$a&&p(Sg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:
(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="MINUTE"):(la=za,za=ka)}else la=za,za=ka;return za}function Ea(){var za=la;if(d.substr(la,6).toLowerCase()===Db){var Fa=d.substr(la,6);la+=6}else Fa=ka,0===$a&&p(Tg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="SECOND"):(la=za,za=ka)}else la=za,za=ka;return za}function Ka(){var za=la;if(d.substr(la,4).toLowerCase()===Jb){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Ug);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=
void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="CASE"):(la=za,za=ka)}else la=za,za=ka;return za}function Ma(){var za=la;if(d.substr(la,3).toLowerCase()===ic){var Fa=d.substr(la,3);la+=3}else Fa=ka,0===$a&&p(Vg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="END"):(la=za,za=ka)}else la=za,za=ka;return za}function Ua(){var za=la;if(d.substr(la,4).toLowerCase()===ac){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Wg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?
Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="WHEN"):(la=za,za=ka)}else la=za,za=ka;return za}function Ga(){var za=la;if(d.substr(la,4).toLowerCase()===mc){var Fa=d.substr(la,4);la+=4}else Fa=ka,0===$a&&p(Xg);if(Fa!==ka){Fa=la;$a++;var La=K();$a--;La===ka?Fa=void 0:(la=Fa,Fa=ka);Fa!==ka?(fb=za,za="THEN"):(la=za,za=ka)}else la=za,za=ka;return za}function Na(){if(44===d.charCodeAt(la)){var za=cc;la++}else za=ka,0===$a&&p(Yg);return za}function Va(){if(40===d.charCodeAt(la)){var za=rc;la++}else za=ka,0===
$a&&p(Zg);return za}function Xa(){if(41===d.charCodeAt(la)){var za=oc;la++}else za=ka,0===$a&&p($g);return za}function Pa(){var za;var Fa=[];for(za=bb();za!==ka;)Fa.push(za),za=bb();return Fa}function bb(){if(Uc.test(d.charAt(la))){var za=d.charAt(la);la++}else za=ka,0===$a&&p(ah);return za}function gb(za,Fa,La,Ya){za={type:"binary-expression",operator:za,left:Fa,right:La};void 0!==Ya&&(za.escape=Ya);return za}function cb(za,Fa){for(var La=0;La<Fa.length;La++)za=gb(Fa[La][1],za,Fa[La][3]);return za}
c=void 0!==c?c:{};var ka={},mb=c.grammarSource,qb={start:t},tb=t,xa="!",Ia="\x3d",na="\x3e\x3d",ya="\x3e",Da="\x3c\x3d",Oa="\x3c\x3e",Wa="\x3c",ab="!\x3d",Ja="+",Ra="-",Sa="||",db="*",eb="/",lb="@",sb="'",vb="N'",rb="''",Eb=".",Lb="null",Yb="true",bc="false",fc="in",kc="is",Cb="like",Ib="escape",Ub="not",Sb="and",jb="or",sa="between",Ha="from",Qa="for",Ta="substring",Za="extract",hb="trim",ib="position",pb="timestamp",ob="date",yb="time",wb="leading",Fb="trailing",zb="both",Tb="cast",nb="as",xb="integer",
Ab="smallint",Mb="float",gc="real",Vb="varchar",Zb="to",hc="interval",Qb="year",Nb="timezone_hour",Wb="timezone_minute",Hb="month",Gb="day",Xb="hour",$b="minute",Db="second",Jb="case",ic="end",ac="when",mc="then",Rb="else",cc=",",rc="(",oc=")",Bc="`",Cc=/^[A-Za-z_\x80-\uFFFF]/,vc=/^[A-Za-z0-9_]/,nc=/^[A-Za-z0-9_.\x80-\uFFFF]/,wc=/^["]/,xc=/^[^']/,Fc=/^[0-9]/,Mc=/^[eE]/,Yc=/^[+\-]/,Uc=/^[ \t\n\r]/,Dc=/^[^`]/,yc=f("!",!1),pc=f("\x3d",!1),zc=f("\x3e\x3d",!1),hd=f("\x3e",!1),Bd=f("\x3c\x3d",!1),Zc=f("\x3c\x3e",
!1),Cd=f("\x3c",!1),Dd=f("!\x3d",!1),$c=f("+",!1),id=f("-",!1),vd=f("||",!1),ee=f("*",!1),Ed=f("/",!1),fe=r([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Fd=r([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Gd=r([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),jd=r(['"'],!1,!1),wd=f("@",!1),Ec=f("'",!1),ad=f("N'",!1),Rc=f("''",!1),bd=r(["'"],!0,!1),kd=f(".",!1),Vc=r([["0","9"]],!1,!1),Sc=r(["e","E"],!1,!1),uc=r(["+","-"],!1,!1),Tc=f("NULL",!0),Wc=f("TRUE",!0),cd=f("FALSE",!0),
ld=f("IN",!0),Nc=f("IS",!0),dd=f("LIKE",!0),ge=f("ESCAPE",!0),xd=f("NOT",!0),md=f("AND",!0),Hd=f("OR",!0),he=f("BETWEEN",!0),ie=f("FROM",!0),yd=f("FOR",!0),Oc=f("SUBSTRING",!0),Xc=f("EXTRACT",!0),Pc=f("TRIM",!0),nd=f("POSITION",!0),zd=f("TIMESTAMP",!0),je=f("DATE",!0),ke=f("TIME",!0),od=f("LEADING",!0),Ad=f("TRAILING",!0),Id=f("BOTH",!0),Jd=f("CAST",!0),Bb=f("AS",!0),jc=f("INTEGER",!0),qc=f("SMALLINT",!0),Lc=f("FLOAT",!0),$e=f("REAL",!0),af=f("VARCHAR",!0),ze=f("TO",!0),Ng=f("INTERVAL",!0),Og=f("YEAR",
!0),$f=f("TIMEZONE_HOUR",!0),bg=f("TIMEZONE_MINUTE",!0),Pg=f("MONTH",!0),Qg=f("DAY",!0),Rg=f("HOUR",!0),Sg=f("MINUTE",!0),Tg=f("SECOND",!0),Ug=f("CASE",!0),Vg=f("END",!0),Wg=f("WHEN",!0),Xg=f("THEN",!0),Mg=f("ELSE",!0),Yg=f(",",!1),Zg=f("(",!1),$g=f(")",!1),ah=r([" ","\t","\n","\r"],!1,!1),Of=f("`",!1),Pf=r(["`"],!0,!1),la=0,fb=0,Ae=[{line:1,column:1}],ed=0,bf=[],$a=0;if("startRule"in c){if(!(c.startRule in qb))throw Error("Can't start parsing from rule \""+c.startRule+'".');tb=qb[c.startRule]}var qf=
tb();if(qf!==ka&&la===d.length)return qf;qf!==ka&&la<d.length&&p({type:"end"});throw function(za,Fa,La){return new g(g.buildMessage(za,Fa),za,Fa,La)}(bf,ed<d.length?d.charAt(ed):null,ed<d.length?w(ed,ed+1):w(ed,ed));}}})})(n);var h=n.exports;class k{static parse(m){return h.parse(m)}}a.WhereGrammar=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(a,b,
n){const h=new n,k=new n,m=new n,g={esriGeometryPoint:b.convertToPoint,esriGeometryPolyline:b.convertToPolyline,esriGeometryPolygon:b.convertToPolygon,esriGeometryMultipoint:b.convertToMultipoint},e=(d,c)=>"_geVersion"!==d?c:void 0;a.cleanFromGeometryEngine=function(d){return d&&"_geVersion"in d?JSON.parse(JSON.stringify(d,e)):d};a.getGeometry=function(d,c,l,f,r,x,w=c,p=l){const t=c&&w,q=l&&p;f=null!=f?"coords"in f?f:f.geometry:null;if(null==f)return null;if(r)return c=b.generalizeOptimizedGeometry(k,
f,c,l,d,r,w,p),x&&(c=b.quantizeOptimizedGeometry(m,c,t,q,d,x)),g[d]?.(c,t,q)??null;if(x)return x=b.quantizeOptimizedGeometry(m,f,c,l,d,x,w,p),g[d]?.(x,t,q)??null;b.removeZMValues(h,f,c,l,w,p);return g[d]?.(h,t,q)??null};a.transformCentroid=function(d,c,l,f=d.hasZ,r=d.hasM){if(null==c)return null;const x=d.hasZ&&f,w=d.hasM&&r;return l?(d=b.quantizeOptimizedGeometry(m,c,d.hasZ,d.hasM,"esriGeometryPoint",l,f,r),b.convertToPoint(d,x,w)):b.convertToPoint(c,x,w)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/arrayUtils ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,b,n,h,k,m,g){function e(p,t){if(!t)return null;if("x"in t){var q={x:0,y:0};[q.x,q.y]=p(t.x,t.y,l);null!=t.z&&(q.z=t.z);null!=t.m&&(q.m=t.m);return q}return"xmin"in t?(q={xmin:0,
ymin:0,xmax:0,ymax:0},[q.xmin,q.ymin]=p(t.xmin,t.ymin,l),[q.xmax,q.ymax]=p(t.xmax,t.ymax,l),t.hasZ&&(q.zmin=t.zmin,q.zmax=t.zmax,q.hasZ=!0),t.hasM&&(q.mmin=t.mmin,q.mmax=t.mmax,q.hasM=!0),q):"rings"in t?{rings:d(t.rings,p),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:d(t.paths,p),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,p),hasM:t.hasM,hasZ:t.hasZ}:null}function d(p,t){const q=[];for(const u of p)q.push(c(u,t));return q}function c(p,t){const q=[];for(const u of p)p=t(u[0],u[1],[0,0]),
q.push(p),2<u.length&&p.push(u[2]),3<u.length&&p.push(u[3]);return q}const l=[0,0],f=e.bind(null,g.lngLatToXY),r=e.bind(null,g.xyToLngLat);class x{constructor(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}async push(p,t,q,u){if(!p?.length||!t||!q||m.equals(t,q))return p;p={geometries:p,inSpatialReference:t,outSpatialReference:q,geographicTransformation:u,resolve:n.createResolver()};this._jobs.push(p);this._timer??(this._timer=setTimeout(this._process,10));return p.resolve.promise}_process(){this._timer=
null;const p=this._jobs.shift();if(p){var {geometries:t,inSpatialReference:q,outSpatialReference:u,resolve:v,geographicTransformation:y}=p;g.canProject(q,u)?m.isWebMercator(u)?v(t.map(f)):v(t.map(r)):v(h.projectMany(k.jsonAdapter,t,q,u,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}}}const w=new x;a.checkProjectionSupport=async function(p,t){p&&t&&(p=Array.isArray(p)?p.map(q=>null!=q.geometry?q.geometry.spatialReference:null).filter(b.isSome):[p],await h.initializeProjection(p.map(q=>
({source:q,dest:t}))))};a.project=function(p,t,q,u){if(!p)return p;q||(q=t,t=p.spatialReference);return m.isValid(t)&&m.isValid(q)&&!m.equals(t,q)?g.canProject(t,q)?(p=m.isWebMercator(q)?f(p):r(p),p.spatialReference=q,p):h.projectMany(k.jsonAdapter,[p],t,q,null,u)[0]:p};a.projectMany=function(p,t,q,u){return w.push(p,t,q,u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){class b{constructor(g,e,d){this.x=
g;this.y=e;this.spatialReference=d;this.m=this.z=void 0}}class n{constructor(g,e,d,c){this.rings=g;this.spatialReference=e;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class h{constructor(g,e,d,c){this.paths=g;this.spatialReference=e;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class k{constructor(g,e,d,c){this.points=g;this.spatialReference=e;this.hasM=this.hasZ=void 0;d&&(this.hasZ=d);c&&(this.hasM=c)}}class m{constructor(g,e,d,c,l){this.xmin=g;this.ymin=e;this.xmax=
d;this.ymax=c;this.spatialReference=l;this.mmax=this.mmin=this.zmax=this.zmin=void 0}}a.jsonAdapter={convertToGEGeometry:function(g,e){return null==e?null:g.convertJSONToGeometry(e)},exportPoint:function(g,e,d){d=new b(g.getPointX(e),g.getPointY(e),d);const c=g.hasZ(e),l=g.hasM(e);c&&(d.z=g.getPointZ(e));l&&(d.m=g.getPointM(e));return d},exportPolygon:function(g,e,d){return new n(g.exportPaths(e),d,g.hasZ(e),g.hasM(e))},exportPolyline:function(g,e,d){return new h(g.exportPaths(e),d,g.hasZ(e),g.hasM(e))},
exportMultipoint:function(g,e,d){return new k(g.exportPoints(e),d,g.hasZ(e),g.hasM(e))},exportExtent:function(g,e,d){var c=g.hasZ(e);const l=g.hasM(e);d=new m(g.getXMin(e),g.getYMin(e),g.getXMax(e),g.getYMax(e),d);c&&(c=g.getZExtent(e),d.zmin=c.vmin,d.zmax=c.vmax);l&&(g=g.getMExtent(e),d.mmin=g.vmin,d.mmax=g.vmax);return d}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/lang ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./geometryUtils ./projectionSupport ./SnappingCandidate ../../support/fieldUtils ../../../statistics/utils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){function x(q,u,v,y){const D=y.x-v.x;y=y.y-v.y;u=Math.min(1,Math.max(0,((u.x-v.x)*D+(u.y-v.y)*y)/(D*D+y*y)));q.x=v.x+D*u;q.y=v.y+y*u}function w(q,u){return q?u?4:3:u?3:2}class p{constructor(q,u,v){this.items=q;this.query=u;this.geometryType=v.geometryType;this.hasM=v.hasM;this.hasZ=v.hasZ;this.fieldsIndex=v.fieldsIndex;this.objectIdField=v.objectIdField;this.spatialReference=v.spatialReference;this.featureAdapter=v.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const q=
new e(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return q.countDistinctValues(this.items);const {groupByFieldsForStatistics:u,having:v,outStatistics:y}=this.query;if(!u?.length)return 1;const D=new Map,G=new Map,A=new Set;for(const I of y){var {statisticType:C}=I;C="exceedslimit"!==C?I.onStatisticField:void 0;if(!G.has(C)){var E=[];for(const H of u){const J=this._getAttributeValues(q,H,D);E.push(J)}G.set(C,this._calculateUniqueValues(E,q.returnDistinctValues))}C=
G.get(C);for(const H in C){const {data:J,items:B}=C[H];E=J.join(",");v&&!q.validateItems(B,v)||A.add(E)}}return A.size}async createQueryResponse(){let q;q=this.query.outStatistics?this.query.outStatistics.some(u=>"exceedslimit"===u.statisticType)?this._createExceedsLimitQueryResponse(this.query):await this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const u=this.query.geometry;g.isValid(this.query.outSR)&&!g.equals(u.spatialReference,
this.query.outSR)?q.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...c.project(u,u.spatialReference,this.query.outSR)}):q.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...u})}return q}createSnappingResponse(q,u){const v=this.featureAdapter,y=w(this.hasZ,this.hasM),{point:D,mode:G}=q,A="number"===typeof q.distance?q.distance:q.distance.x,C="number"===typeof q.distance?q.distance:q.distance.y,E={candidates:[]},I="esriGeometryPolygon"===this.geometryType;
u=this._getPointCreator(G,this.spatialReference,u);const H=new t(null,0),J=new t(null,0),B={x:0,y:0,z:0};for(const N of this.items){var z=v.getGeometry(N);if(null==z)continue;const {coords:P,lengths:R}=z;H.coords=P;J.coords=P;if(q.returnEdge){z=0;for(var K=0;K<R.length;K++){var L=R[K];for(var F=0;F<L;F++,z+=y){var M=H;M.coordsIndex=z;if(F!==L-1){const O=J;O.coordsIndex=z+y;const T=B;x(B,D,M,O);var S=(D.x-T.x)/A;const Q=(D.y-T.y)/C;S=S*S+Q*Q;1>=S&&E.candidates.push(l.makeEdgeCandidate(v.getObjectId(N),
u(T),Math.sqrt(S),u(M),u(O)))}}}}if("none"!==q.vertexMode)if(z=I?P.length-y:P.length,"all"===q.vertexMode)for(K=0;K<z;K+=y)L=H,L.coordsIndex=K,F=(D.x-L.x)/A,M=(D.y-L.y)/C,F=F*F+M*M,1>=F&&E.candidates.push(l.makeVertexCandidate(v.getObjectId(N),u(L),Math.sqrt(F)));else if("ends"===q.vertexMode){z=[0];I||z.push(P.length-y);for(const O of z)z=H,z.coordsIndex=O,K=(D.x-z.x)/A,L=(D.y-z.y)/C,K=K*K+L*L,1>=K&&E.candidates.push(l.makeVertexCandidate(v.getObjectId(N),u(z),Math.sqrt(K)))}}E.candidates.sort((N,
P)=>N.distance-P.distance);return E}_getPointCreator(q,u,v){const y=null==v||g.equals(u,v)?G=>G:G=>c.project(G,u,v),{hasZ:D}=this;return"3d"===q?D?({x:G,y:A,z:C})=>y({x:G,y:A,z:C}):({x:G,y:A})=>y({x:G,y:A,z:0}):({x:G,y:A})=>y({x:G,y:A})}async createSummaryStatisticsResponse(q){const {field:u,valueExpression:v,normalizationField:y,normalizationType:D,normalizationTotal:G,minValue:A,maxValue:C,scale:E,timeZone:I}=q;var H=this.fieldsIndex.get(u);q=f.isDateField(H)||f.isDateOnlyField(H)||f.isTimestampOffsetField(H);
const J=await this._getDataValues({field:u,valueExpression:v,normalizationField:y,normalizationType:D,normalizationTotal:G,scale:E,timeZone:I}),B=r.isNullCountSupported({normalizationType:D,normalizationField:y,minValue:A,maxValue:C}),z={value:.5,fieldType:H?.type};H=f.isStringField(H)?r.calculateStringStatistics({values:J,supportsNullCount:B,percentileParams:z}):r.calculateStatistics({values:J,minValue:A,maxValue:C,useSampleStdDev:!D,supportsNullCount:B,percentileParams:z});return r.processSummaryStatisticsResult(H,
q)}async createUniqueValuesResponse(q){const {field:u,valueExpression:v,domains:y,returnAllCodedValues:D,scale:G,timeZone:A}=q;var C=await this._getDataValues({field:u,field2:q.field2,field3:q.field3,fieldDelimiter:q.fieldDelimiter,valueExpression:v,scale:G,timeZone:A},!1);C=r.calculateUniqueValuesCount(C);return r.createUVResult(C,y,D,q.fieldDelimiter)}async createClassBreaksResponse(q){const {field:u,valueExpression:v,normalizationField:y,normalizationType:D,normalizationTotal:G,classificationMethod:A,
standardDeviationInterval:C,minValue:E,maxValue:I,numClasses:H,scale:J,timeZone:B}=q;q=await this._getDataValues({field:u,valueExpression:v,normalizationField:y,normalizationType:D,normalizationTotal:G,scale:J,timeZone:B});q=r.calculateClassBreaks(q,{field:u,normalizationField:y,normalizationType:D,normalizationTotal:G,classificationMethod:A,standardDeviationInterval:C,minValue:E,maxValue:I,numClasses:H});return r.resolveCBResult(q,A)}async createHistogramResponse(q){const {field:u,valueExpression:v,
normalizationField:y,normalizationType:D,normalizationTotal:G,classificationMethod:A,standardDeviationInterval:C,minValue:E,maxValue:I,numBins:H,scale:J,timeZone:B}=q;q=await this._getDataValues({field:u,valueExpression:v,normalizationField:y,normalizationType:D,normalizationTotal:G,scale:J,timeZone:B});return r.calculateHistogram(q,{field:u,normalizationField:y,normalizationType:D,normalizationTotal:G,classificationMethod:A,standardDeviationInterval:C,minValue:E,maxValue:I,numBins:H})}_sortFeatures(q,
u,v){if(1<q.length&&u?.length)for(const y of u.reverse()){u=y.split(" ");const D=u[0],G=this.fieldsIndex.get(D);u=u[1]?"desc"===u[1].toLowerCase():!1;const A=r.getAttributeComparator(G?.type,u);q.sort((C,E)=>{C=v(C,D,G);E=v(E,D,G);return A(C,E)})}}_createFeatureQueryResponse(q){const u=this.items,{geometryType:v,hasM:y,hasZ:D,objectIdField:G,spatialReference:A}=this,{outFields:C,outSR:E,quantizationParameters:I,resultRecordCount:H,resultOffset:J,returnZ:B,returnM:z}=q,K=null!=H?u.length>(J||0)+H:
!1,L=C&&(C.includes("*")?[...this.fieldsIndex.fields]:C.map(F=>this.fieldsIndex.get(F)));return{exceededTransferLimit:K,features:this._createFeatures(q,u),fields:L,geometryType:v,hasM:y&&z,hasZ:D&&B,objectIdFieldName:G,spatialReference:d.cleanFromGeometryEngine(E||A),transform:I&&m.toQuantizationTransform(I)||null}}_createFeatures(q,u){const v=new e(q,this.featureAdapter,this.fieldsIndex),{hasM:y,hasZ:D}=this,{orderByFields:G,quantizationParameters:A,returnGeometry:C,returnCentroid:E,maxAllowableOffset:I,
resultOffset:H,resultRecordCount:J,returnZ:B=!1,returnM:z=!1}=q,K=D&&B,L=y&&z;q=[];var F=0;const M=[...u];this._sortFeatures(M,G,(O,T,Q)=>v.getFieldValue(O,T,Q));if(this.geometryType&&(C||E)){var S=m.toQuantizationTransform(A)??void 0;u="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(C&&!E)for(var N of M){var P=this.featureAdapter.getGeometry(N),R={attributes:v.getAttributes(N),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,P,I,S,K,L)};u&&P&&
!R.geometry&&(R.centroid=d.transformCentroid(this,this.featureAdapter.getCentroid(N,this),S));q[F++]=R}else if(!C&&E)for(P of M)q[F++]={attributes:v.getAttributes(P),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(P,this),S)};else for(R of M)q[F++]={attributes:v.getAttributes(R),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(R,this),S),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),I,S,K,L)}}else for(S of M)(N=v.getAttributes(S))&&
(q[F++]={attributes:N});F=H||0;null!=J&&(q=q.slice(F,Math.min(q.length,F+J)));return q}_createExceedsLimitQueryResponse(q){var u=!1;let v=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;u=Number.POSITIVE_INFINITY;for(const D of q.outStatistics??[])if("exceedslimit"===D.statisticType){v=null!=D.maxPointCount?D.maxPointCount:Number.POSITIVE_INFINITY;y=null!=D.maxRecordCount?D.maxRecordCount:Number.POSITIVE_INFINITY;u=null!=D.maxVertexCount?D.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===
this.geometryType)u=this.items.length>v;else if(this.items.length>y)u=!0;else{q=w(this.hasZ,this.hasM);const D=this.featureAdapter;u=this.items.reduce((G,A)=>{A=D.getGeometry(A);return G+(null!=A&&A.coords.length||0)},0)/q>u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(u)}}]}}async _createStatisticsQueryResponse(q){var u={attributes:{}};const v=[],y=new Map,D=
new Map,G=new Map,A=new Map,C=new e(q,this.featureAdapter,this.fieldsIndex);var E=q.outStatistics;const {groupByFieldsForStatistics:I,having:H,orderByFields:J,resultRecordCount:B}=q;q=I?.length;const z=!!q,K=z?I[0]:null,L=z&&!this.fieldsIndex.get(K);for(const P of E??[]){const {outStatisticFieldName:R,statisticType:O}=P;E=P;const T="exceedslimit"!==O?P.onStatisticField:void 0,Q="percentile_disc"===O||"percentile_cont"===O;var F="EnvelopeAggregate"===O||"CentroidAggregate"===O||"ConvexHullAggregate"===
O;const V=z&&1===q&&(T===K||L)&&"count"===O;if(z){if(!G.has(T)){var M=[];for(const U of I){var S=this._getAttributeValues(C,U,y);M.push(S)}G.set(T,this._calculateUniqueValues(M,F?!1:C.returnDistinctValues))}M=G.get(T);if(!M)continue;S=Object.keys(M);for(const U of S){const {count:W,data:ca,items:X,itemPositions:ba}=M[U];S=ca.join(",");if(!H||C.validateItems(X,H)){const ia=A.get(S)||{attributes:{}};if(F){ia.aggregateGeometries||(ia.aggregateGeometries={});const {aggregateGeometries:da,outStatisticFieldName:aa}=
await this._getAggregateGeometry(E,X);ia.aggregateGeometries[aa]=da}else{var N=null;if(V)N=W;else{const da=this._getAttributeValues(C,T,y);N=ba.map(aa=>da[aa]);N=Q&&"statisticParameters"in E?this._getPercentileValue(E,N):this._getStatisticValue(E,N,null,C.returnDistinctValues)}ia.attributes[R]=N}let fa=0;I.forEach((da,aa)=>ia.attributes[this.fieldsIndex.get(da)?da:`EXPR_${++fa}`]=ca[aa]);A.set(S,ia)}}}else if(F){u.aggregateGeometries||(u.aggregateGeometries={});const {aggregateGeometries:U,outStatisticFieldName:W}=
await this._getAggregateGeometry(E,this.items);u.aggregateGeometries[W]=U}else F=this._getAttributeValues(C,T,y),u.attributes[R]=Q&&"statisticParameters"in E?this._getPercentileValue(E,F):this._getStatisticValue(E,F,D,C.returnDistinctValues);E="min"!==O&&"max"!==O||!f.isStringField(this.fieldsIndex.get(T))&&!this._isAnyDateField(T)?null:this.fieldsIndex.get(T)?.type;v.push({name:R,alias:R,type:E||"esriFieldTypeDouble"})}u=z?Array.from(A.values()):[u];this._sortFeatures(u,J,(P,R)=>P.attributes[R]);
B&&(u.length=Math.min(B,u.length));return{fields:v,features:u}}_isAnyDateField(q){q=this.fieldsIndex.get(q);return f.isDateField(q)||f.isDateOnlyField(q)||f.isTimestampOffsetField(q)||f.isTimeOnlyField(q)}async _getAggregateGeometry(q,u){const {convexHull:v,union:y}=await new Promise((B,z)=>a(["../../../geometry/geometryEngineJSON"],B,z)),{statisticType:D,outStatisticFieldName:G}=q,{featureAdapter:A,spatialReference:C,geometryType:E,hasZ:I,hasM:H}=this;u=u.map(B=>d.getGeometry(E,I,H,A.getGeometry(B)));
const J=v(C,u,!0)[0];q={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===D?(u=J?k.getPolygonExtent(J):k.getGeometryExtent(y(C,u)),q.aggregateGeometries={...u,spatialReference:C},q.outStatisticFieldName=G||"extent"):"CentroidAggregate"===D?(u=J?h.polygonCentroid(J):h.extentCentroid(k.getGeometryExtent(y(C,u))),q.aggregateGeometries={x:u[0],y:u[1],spatialReference:C},q.outStatisticFieldName=G||"centroid"):"ConvexHullAggregate"===D&&(q.aggregateGeometries=J,q.outStatisticFieldName=
G||"convexHull");return q}_getStatisticValue(q,u,v,y){const {onStatisticField:D,statisticType:G}=q;q=null;q=v?.has(D)?v.get(D):f.isStringField(this.fieldsIndex.get(D))||this._isAnyDateField(D)?r.calculateStringStatistics({values:u,returnDistinct:y}):r.calculateStatistics({values:y?[...(new Set(u))]:u,minValue:null,maxValue:null,useSampleStdDev:!0});v&&v.set(D,q);return q["var"===G?"variance":G]}_getPercentileValue(q,u){const {onStatisticField:v,statisticParameters:y,statisticType:D}=q,{value:G,orderBy:A}=
y;q=this.fieldsIndex.get(v);return r.calculatePercentile(u,{value:G,orderBy:A,fieldType:q?.type,isDiscrete:"percentile_disc"===D})}_getAttributeValues(q,u,v){if(v.has(u))return v.get(u);const y=this.fieldsIndex.get(u),D=this.items.map(G=>q.getFieldValue(G,u,y));v.set(u,D);return D}_calculateUniqueValues(q,u){const v={},y=this.items,D=y.length;for(let G=0;G<D;G++){const A=y[G],C=[];for(const I of q)C.push(I[G]);const E=C.join(",");null==v[E]?v[E]={count:1,data:C,items:[A],itemPositions:[G]}:(u||v[E].count++,
v[E].items.push(A),v[E].itemPositions.push(G))}return v}async _getDataValues(q,u=!0){const v=new e(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:y,scale:D,timeZone:G}=q;return y?v.getExpressionValues(this.items,y,{viewingMode:"map",scale:D,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},G):v.getDataValues(this.items,n.clone(q),u)}}class t{constructor(q,u){this.coords=q;this.coordsIndex=u}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+
1]}get z(){return this.coords[this.coordsIndex+2]}}b.QueryEngineResult=p;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define("./attributeSupport ./geometryUtils ../../support/fieldUtils ../../../smartMapping/statistics/support/utils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),function(a,b,n,h,k,m){class g{constructor(e,d,c){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=
e.returnDistinctValues??!1;this.fieldsIndex=c;this.featureAdapter=d;if((d=e.outFields)&&!d.includes("*")){this.outFields=d;e=0;for(const f of d){var l=a.getExpressionFromFieldName(f);l=(d=this.fieldsIndex.get(l))?null:a.getWhereClause(l,c);d=d?d.name:a.getAliasFromFieldName(f)||`FIELD_EXP_${e++}`;this._fieldDataCache.set(f,{alias:d,clause:l})}}}countDistinctValues(e){if(!this.returnDistinctValues)return e.length;e.forEach(d=>this.getAttributes(d));return this._returnDistinctMap.size}getAttributes(e){e=
this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(e)}getFieldValue(e,d,c){const l=c?c.name:d;let f=null;this._fieldDataCache.has(l)?f=this._fieldDataCache.get(l)?.clause:c||(f=a.getWhereClause(d,this.fieldsIndex),this._fieldDataCache.set(l,{alias:l,clause:f}));return c?this.featureAdapter.getAttribute(e,l):f?.calculateValue(e,this.featureAdapter)}getDataValues(e,d,c=!0){const l=d.normalizationType,f=d.normalizationTotal,r=this.fieldsIndex.get(d.field),x=n.isDateOnlyField(r)||
n.isTimestampOffsetField(r),w=n.isTimeOnlyField(r);return e.map(p=>{let t=d.field&&this.getFieldValue(p,d.field,this.fieldsIndex.get(d.field));d.field2?(t=`${k.processNullValue(t)}${d.fieldDelimiter}${k.processNullValue(this.getFieldValue(p,d.field2,this.fieldsIndex.get(d.field2)))}`,d.field3&&(t=`${t}${d.fieldDelimiter}${k.processNullValue(this.getFieldValue(p,d.field3,this.fieldsIndex.get(d.field3)))}`)):"string"===typeof t&&c&&(x?t=t?(new Date(t)).getTime():null:w&&(t=t?h.timeOnlyToMilliseconds(t):
null));l&&Number.isFinite(t)&&(p="field"===l&&d.normalizationField?this.getFieldValue(p,d.normalizationField,this.fieldsIndex.get(d.normalizationField)):null,t=k.getNormalizedValue(t,l,p,f));return t})}async getExpressionValues(e,d,c,l,f){const {arcadeUtils:r}=await m.loadArcade(),x=r.hasGeometryOperations(d);x&&await r.enableGeometryOperations();const w=r.createFunction(d),p=r.getViewInfo(c),t={fields:this.fieldsIndex.fields};return e.map(q=>{q={attributes:this.featureAdapter.getAttributes(q),layer:t,
geometry:x?{...b.getGeometry(l.geometryType,l.hasZ,l.hasM,this.featureAdapter.getGeometry(q)),spatialReference:c?.spatialReference}:null};q=r.createExecContext(q,p,f);return r.executeFunction(w,q)})}validateItem(e,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testFeature(e,this.featureAdapter)??!1}validateItems(e,d){this._fieldDataCache.has(d)||this._fieldDataCache.set(d,{alias:d,clause:a.getWhereClause(d,
this.fieldsIndex)});return this._fieldDataCache.get(d)?.clause?.testSet(e,this.featureAdapter)??!1}_processAttributesForOutFields(e){const d=this.outFields;if(!d?.length)return this.featureAdapter.getAttributes(e);const c={};for(const l of d){const {alias:f,clause:r}=this._fieldDataCache.get(l);c[f]=r?r.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,f)}return c}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;var d=this.outFields,c=[];
if(d)for(const f of d){var {alias:l}=this._fieldDataCache.get(f);c.push(e[l])}else for(l in e)c.push(e[l]);d=`${(d||["*"]).join(",")}=${c.join(",")}`;c=this._returnDistinctMap.get(d)||0;this._returnDistinctMap.set(d,++c);return 1<c?null:e}}return g})},"esri/smartMapping/statistics/support/utils":function(){define("exports ../../../geometry ../../../core/Error ../../../core/screenUtils ../../../core/timeUtils ../../../geometry/SpatialReference ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/support/fieldUtils ../../../renderers/support/heatmapUtils ../../support/utils ../../../statistics/utils ../../../support/arcadeOnDemand ../../../geometry/Point".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(y){y=v.exec(y);if(!y)return null;const {hh:D,mm:G,ss:A,ms:C}=y.groups;return Number(D)*k.millisecondsPerTimeUnit.hours+Number(G)*k.millisecondsPerTimeUnit.minutes+Number(A)*k.millisecondsPerTimeUnit.seconds+Number(C||0)}function p(y,D){y=null!=y?y:"";null!=D&&D&&(y=y?"("+y+") AND ("+D+")":D);return y}function t(y){const D=y.layer;return y.fields.filter(G=>!D.getField(G))}function q(y){const D=y.layer;return y.fields.filter(G=>{G=D.getFieldUsageInfo(G);
return!G||!G.supportsStatistics})}let u=null;const v=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;a.calculateHeatmapStats=function(y,D=18,G,A,C){const E=new Float64Array(A*C);D=Math.round(h.pt2px(D));let I=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY;G=c.createValueFunction(G);for(const {geometry:z,attributes:K}of y){const {x:L,y:F}=z;y=Math.max(0,L-D);var J=Math.max(0,F-D);const M=Math.min(C,F+D),S=Math.min(A,L+D),N=+G(K);for(;J<M;J++)for(let P=
y;P<S;P++){var B=J*A+P;const R=c.evaluateDensityKernel(P-L,J-F,D)*N;B=E[B]+=R;I=Math.min(I,B);H=Math.max(H,B)}}return{min:I,max:H}};a.getDataValues=async function(y,D,G=!0){if(!D)return[];const {field:A,field2:C,field3:E,fieldDelimiter:I,fieldInfos:H,timeZone:J}=y;var B=A&&H?.find(T=>T.name.toLowerCase()===A.toLowerCase());const z=B?d.isTimeOnlyField(B):!1,K=B?l.isAnyDateField(B):!1,L=y.valueExpression,F=y.normalizationType,M=y.normalizationField,S=y.normalizationTotal,N=[];B=y.viewInfoParams;let P=
null,R=null;if(L){if(!u){const {arcadeUtils:T}=await r.loadArcade();u=T}u.hasGeometryOperations(L)&&await u.enableGeometryOperations();P=u.createFunction(L);R=B?u.getViewInfo({viewingMode:B.viewingMode,scale:B.scale,spatialReference:new m(B.spatialReference)}):null}y=y.fieldInfos;const O=D[0]&&"declaredClass"in D[0]&&"esri.Graphic"===D[0].declaredClass||!y?null:{fields:y};D.forEach(T=>{var Q=T.attributes;if(L){var V=u.createExecContext(O?{...T,layer:O}:T,R,J);V=u.executeFunction(P,V)}else Q&&(V=Q[A],
C?(V=`${f.processNullValue(V)}${I}${f.processNullValue(Q[C])}`,E&&(V=`${V}${I}${f.processNullValue(Q[E])}`)):"string"===typeof V&&G&&(K?V=V?(new Date(V)).getTime():null:z&&(V=V?w(V):null)));F&&"number"===typeof V&&isFinite(V)&&(Q=Q&&parseFloat(Q[M]),V=f.getNormalizedValue(V,F,Q,S));N.push(V)});return N};a.getRangeExpr=function(y,D,G){D=null!=D?y+" \x3e\x3d "+D:"";y=null!=G?y+" \x3c\x3d "+G:"";G="";return(G=D&&y?p(D,y):D||y)?"("+G+")":""};a.getSQLFilterForNormalization=function(y){const D=y.field,
G=y.normalizationType;y=y.normalizationField;let A;if("field"===G)A="(NOT "+y+" \x3d 0)";else if("log"===G||"natural-log"===G||"square-root"===G)A=`(${D} > 0)`;return A};a.getSumOfAttributesExpr=function(y,D,G){const A=[],C=[],E=[],I=[],H=[];y.forEach((z,K)=>{const L=z.field?"field":"expression",F=z.field||z.valueExpression;z.field?(H.push(F),C.push(`var ${L}${K} = Number($feature["${F}"]);`)):(A.push(`function getValueForExpr${K}() {\n  ${F} \n}`),C.push(`var ${L}${K} = Number(getValueForExpr${K}());`));
G||E.push(`${L}${K} = IIf(${L}${K} < 0, 0, ${L}${K});`);I.push(`${L}${K}`)});y="return sum;";const J=A.length?null:H.reduce((z,K)=>`${z} + ${K}`);let B=null;D||G?D?G||(y="return IIf(sum \x3e\x3d 0, sum, null);",J&&(B=`(( ${J} ) >= 0)`)):(y="return IIf(sum !\x3d 0, sum, null);",J&&(B=`(( ${J} ) <> 0)`)):(y="return IIf(sum \x3e 0, sum, null);",J&&(B=`(( ${J} ) > 0)`));return{valueExpression:[A.length?A.join("\n"):"",C.join("\n"),E.join("\n"),`var sum = ${I.join(" + ")};`,y].filter(Boolean).join("\n\n"),
sqlExpression:J,sqlWhere:B}};a.mergeWhereClauses=p;a.quantizeFeatures=function(y,D,G,A){const C=e.isWrappable(G)?e.getInfo(G):null,E=C?Math.round((C.valid[1]-C.valid[0])/D.scale[0]):null;return y.map(I=>{const H=new x(I.geometry);g.quantizePoint(D,H,H,H.hasZ,H.hasM);if(C){var J=E??0,B=A[0];0>H.x?H.x+=J:H.x>B&&(H.x-=J)}I.geometry=H;return I})};a.timeOnlyToMilliseconds=w;a.verifyBasicFieldValidity=function(y,D,G){const A=t({layer:y,fields:D});if(A.length)return new n(G,"Unknown fields: "+A.join(", ")+
". You can only use fields defined in the layer schema");y=q({layer:y,fields:D});if(y.length)return new n(G,"Unsupported fields: "+y.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")};a.verifyFieldType=function(y,D,G,A){let C;D?D.name!==y.objectIdField&&A.includes(D.type)||(C=new n(G,"'field' should be one of these types: "+A.join(","))):C=new n(G,"'field' is not defined in the layer schema");return C};a.verifyFilterValidty=function(y,
D){if(y&&"intersects"!==y.spatialRelationship)return new n(D,"Only 'intersects' spatialRelationship is supported for featureFilter")};a.verifyNumericField=function(y,D,G){let A;D?D.name!==y.objectIdField&&d.isNumericField(D)||(A=new n(G,"'field' should be one of these numeric types: "+d.numericTypes.join(","))):A=new n(G,"'field' is not defined in the layer schema");return A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define("exports ../../intl/date ../../layers/support/fieldUtils ../../support/arcadeOnDemand ../../support/basemapUtils ../../time/timeZoneUtils".split(" "),
function(a,b,n,h,k,m){function g(x){return String(x).padStart(2,"0")}function e(x,w,p){if("date"===w||"number"===w){"number"===w&&(x=new Date(x));w=p?x.getFullYear():x.getUTCFullYear();const t=g((p?x.getMonth():x.getUTCMonth())+1),q=g(p?x.getDate():x.getUTCDate()),u=g(p?x.getHours():x.getUTCHours()),v=g(p?x.getMinutes():x.getUTCMinutes());x=g(p?x.getSeconds():x.getUTCSeconds());x=`TIMESTAMP'${w}-${t}-${q} ${u}:${v}:${x}'`}return x}function d(x,w){if(w instanceof Date)return"date";if("number"===typeof w)return"number";
if("string"===typeof w&&(x=x.getField(w),"\x3cnow\x3e"!==w.toLowerCase()&&n.isDateField(x)))return"field"}const c={light:"streets gray topo terrain oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector topo-3d navigation-3d streets-3d osm-3d gray-3d arcgis-light-gray arcgis-navigation arcgis-streets arcgis-streets-relief arcgis-topographic arcgis-oceans osm-standard osm-standard-relief osm-streets osm-streets-relief osm-light-gray arcgis-terrain arcgis-charted-territory arcgis-community arcgis-colored-pencil arcgis-modern-antique arcgis-midcentury arcgis-newspaper arcgis-hillshade-light".split(" "),
dark:"satellite hybrid dark-gray dark-gray-vector streets-night-vector navigation-dark-3d streets-dark-3d dark-gray-3d arcgis-imagery arcgis-imagery-standard arcgis-dark-gray arcgis-navigation-night arcgis-streets-night osm-dark-gray arcgis-nova arcgis-hillshade-dark".split(" ")},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5},f=new Set(["integer","small-integer"]);let r=null;a.castIntegerFieldToFloat=function(x){return`cast(${x} as float)`};a.dateTypes=
["date","date-only","timestamp-offset"];a.defaultBasemapGroups=c;a.fieldDelimiter=",";a.formatAnyDate=function(x,w){const {format:p,timeZoneOptions:t,fieldType:q}=w??{};let u;t&&({timeZone:v,timeZoneName:u}=m.getTimeZoneFormattingOptions(t.layerTimeZone,t.datesInUnknownTimezone,t.viewTimeZone,b.convertDateFormatToIntlOptions(p||"short-date-short-time"),q));if("string"===typeof x&&isNaN(Date.parse("time-only"===q?`1970-01-01T${x}Z`:x)))return x;switch(q){case "date-only":var v=b.convertDateFormatToIntlOptions(p||
"short-date");return"string"===typeof x?b.formatDateOnly(x,{...v}):b.formatDate(x,{...v,timeZone:m.utc});case "time-only":return v=b.convertDateFormatToIntlOptions(p||"short-time"),"string"===typeof x?b.formatTimeOnly(x,v):b.formatDate(x,{...v,timeZone:m.utc});case "timestamp-offset":if(!v&&"string"===typeof x&&(new Date(x)).toISOString()!==x)return x;v=(w=p||t?b.convertDateFormatToIntlOptions(p||"short-date-short-time"):void 0)?{...w,timeZone:v,timeZoneName:u}:void 0;return"string"===typeof x?b.formatTimestamp(x,
v):b.formatDate(x,v);default:return w=p||t?b.convertDateFormatToIntlOptions(p||"short-date-short-time"):void 0,b.formatDate("string"===typeof x?new Date(x):x,w?{...w,timeZone:v,timeZoneName:u}:void 0)}};a.getBasemapGroup=function(x,w=c){for(const p in w)if(w[p].includes(x))return p};a.getBasemapId=function(x,w,p=!0){let t=null;x&&("string"===typeof x?w.includes(x)&&(t=x):t=k.getWellKnownBasemapId(x));return p?t||"gray":t};a.getDateDiffSQL=function(x,w,p,t){const {hasQueryEngine:q}=x;p=e(p,d(x,p),
q);x=e(w,d(x,w),q);x=`(${p} - ${x})`;t=l[t];w="/";1>t&&(t=1/t,w="*");return{sqlExpression:1===t?x:`(${x} ${w} ${t})`,sqlWhere:null}};a.getDateType=d;a.getFieldsList=async function(x){const {field:w,field2:p,field3:t,normalizationField:q,valueExpression:u}=x;x=[];u&&(r||({arcadeUtils:x}=await h.loadArcade(),r=x),x=r.extractFieldNames(u));w&&x.push(w);p&&x.push(p);t&&x.push(t);q&&x.push(q);return x};a.getNormalizationType=function(x){let w=x.normalizationType;w||(x.normalizationField?w="field":null!=
x.normalizationTotal&&(w="percent-of-total"));return w??void 0};a.isAnyDateField=function(x){return n.isDateField(x)||n.isDateOnlyField(x)||n.isTimestampOffsetField(x)};a.isIntegerField=function(x,w){x=w&&x.getField(w);return!!x&&f.has(x.type)};a.unitValueInDays=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,b,n){function h(B){return null==
B||"string"===typeof B&&!B?"\x3cNull\x3e":B}function k(B){const z=null!=B.minValue||null!=B.maxValue,K=!!B.sqlExpression&&B.supportsSQLExpression;return!(null!=B.normalizationField||null!=B.normalizationType)&&!z&&!K}function m(B){const {values:z,useSampleStdDev:K,supportsNullCount:L}=B;var F=Number.POSITIVE_INFINITY;let M=Number.NEGATIVE_INFINITY,S=null,N=null;var P=null;let R=null,O=0;const T=null==B.minValue?-Infinity:B.minValue,Q=null==B.maxValue?Infinity:B.maxValue;for(const V of z)Number.isFinite(V)?
V>=T&&V<=Q&&(S=null===S?V:S+V,F=Math.min(F,V),M=Math.max(M,V),O++):"string"===typeof V&&O++;if(O&&null!=S){N=S/O;P=0;for(const V of z)Number.isFinite(V)&&V>=T&&V<=Q&&(P+=(V-N)**2);R=K?1<O?P/(O-1):0:0<O?P/O:0;P=Math.sqrt(R)}else M=F=null;F={avg:N,count:O,max:M,min:F,stddev:P,sum:S,variance:R};L&&(F.nullcount=z.length-O);B.percentileParams&&(F.median=g(z,B.percentileParams));return F}function g(B,z){const {fieldType:K,value:L,orderBy:F,isDiscrete:M}=z,S=e(K,"desc"===F);B=[...B].filter(O=>null!=O).sort((O,
T)=>S(O,T));if(0===B.length)return null;if(0>=L)return B[0];if(1<=L)return B[B.length-1];var N=(B.length-1)*L,P=Math.floor(N);z=P+1;N%=1;P=B[P];const R=B[z];return z>=B.length||M||"string"===typeof P||"string"===typeof R?P:P*(1-N)+R*N}function e(B,z){if(B){if(u.has(B))return z?H:J;if(v.has(B))return d(z,!1);if("esriFieldTypeTimestampOffset"===B)return z?C:A;const M=d(z,!0);if("esriFieldTypeString"===B)return M;if("esriFieldTypeGUID"===B||"esriFieldTypeGlobalID"===B)return(S,N)=>M(c(S),c(N))}const K=
z?1:-1,L=z?H:J,F=d(z,!0);return(M,S)=>"number"===typeof M&&"number"===typeof S?L(M,S):"string"===typeof M&&"string"===typeof S?F(M,S):K}function d(B,z){if(!z)return B?I:E;const K=B?D:G;return B?(L,F)=>{const M=K(L,F);if(null!=M)return M;L=L.toUpperCase();F=F.toUpperCase();return L>F?-1:L<F?1:0}:(L,F)=>{const M=K(L,F);if(null!=M)return M;L=L.toUpperCase();F=F.toUpperCase();return L<F?-1:L>F?1:0}}function c(B){return B.substr(24,12)+B.substr(19,4)+B.substr(16,2)+B.substr(14,2)+B.substr(11,2)+B.substr(9,
2)+B.substr(6,2)+B.substr(4,2)+B.substr(2,2)+B.substr(0,2)}function l(B){return"coded-value"!==B?.type?[]:B.codedValues.map(z=>z.code)}function f(B,z){const K=x({field:z.field,normalizationType:z.normalizationType,normalizationField:z.normalizationField,classificationMethod:z.classificationMethod,standardDeviationInterval:z.standardDeviationInterval,breakCount:z.numClasses||5});B=r(B,z.minValue,z.maxValue);return n.createGenerateRendererClassBreaks({definition:K,values:B,normalizationTotal:z.normalizationTotal})}
function r(B,z,K){const L=null==z?-Infinity:z,F=null==K?Infinity:K;return B.filter(M=>Number.isFinite(M)&&M>=L&&M<=F)}function x(B){const {breakCount:z,field:K,normalizationField:L,normalizationType:F}=B,M=B.classificationMethod||"equal-interval";return new b({breakCount:z,classificationField:K,classificationMethod:M,normalizationField:"field"===F?L:void 0,normalizationType:F,standardDeviationInterval:"standard-deviation"===M?B.standardDeviationInterval||1:void 0})}function w(B,z){const {field:K,
classificationMethod:L,standardDeviationInterval:F,normalizationType:M,normalizationField:S,normalizationTotal:N,minValue:P,maxValue:R}=z,O=z.numBins||10;let T=z=null,Q=null;L&&"equal-interval"!==L||M?({classBreaks:B}=f(B,{field:K,normalizationType:M,normalizationField:S,normalizationTotal:N,classificationMethod:L,standardDeviationInterval:F,minValue:P,maxValue:R,numClasses:O}),z=B[0].minValue,T=B[B.length-1].maxValue,Q=B.map(V=>[V.minValue,V.maxValue])):(null!=P&&null!=R?(z=P,T=R):(B=m({values:B,
minValue:P,maxValue:R,useSampleStdDev:!M,supportsNullCount:k({normalizationType:M,normalizationField:S,minValue:P,maxValue:R})}),z=B.min??null,T=B.max??null),Q=t(z??0,T??0,O));return{min:z,max:T,intervals:Q}}function p(B,z){let K=-1;for(let L=B.length-1;0<=L;L--)if(z>=B[L][0]){K=L;break}return K}function t(B,z,K){const L=(z-B)/K,F=[];let M;for(let S=1;S<=K;S++)M=B+L,M=Number(M.toFixed(16)),F.push([B,S===K?z:M]),B=M;return F}const q=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,u=new Set("esriFieldTypeDate esriFieldTypeInteger esriFieldTypeSmallInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeOID esriFieldTypeBigInteger".split(" ")),
v=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),y="min max avg stddev count sum variance nullcount median".split(" "),D=(B,z)=>null==B?null==z?0:1:null==z?-1:null,G=(B,z)=>null==B?null==z?0:-1:null==z?1:null,A=(B,z)=>G(B,z)??(B===z?0:(new Date(B)).getTime()-(new Date(z)).getTime()),C=(B,z)=>D(B,z)??(B===z?0:(new Date(z)).getTime()-(new Date(B)).getTime()),E=(B,z)=>G(B,z)??(B===z?0:B<z?-1:1),I=(B,z)=>D(B,z)??(B===z?0:B<z?1:-1),H=(B,z)=>D(B,z)??z-B,J=(B,z)=>G(B,z)??B-z;a.calculateClassBreaks=
f;a.calculateHistogram=function(B,z){var K=w(B,z);if(null==K.min&&null==K.max)return{bins:[],minValue:K.min,maxValue:K.max,normalizationTotal:z.normalizationTotal};const L=K.intervals,F=K.min??0;K=K.max??0;const M=L.map((S,N)=>({minValue:L[N][0],maxValue:L[N][1],count:0}));for(const S of B)null!=S&&S>=F&&S<=K&&(B=p(L,S),-1<B&&M[B].count++);return{bins:M,minValue:F,maxValue:K,normalizationTotal:z.normalizationTotal}};a.calculatePercentile=g;a.calculateStatistics=m;a.calculateStringStatistics=function(B){const z=
B.returnDistinct?[...(new Set(B.values))]:B.values;var K=z.filter(F=>null!=F).sort();const L=K.length;K={count:L,min:K[0],max:K[L-1]};B.supportsNullCount&&(K.nullcount=z.length-L);B.percentileParams&&(K.median=g(z,B.percentileParams));return K};a.calculateUniqueValuesCount=function(B){const z={};for(let K of B){if(null==K||"string"===typeof K&&""===K.trim())K=null;null==z[K]?z[K]={count:1,data:K}:z[K].count++}return{count:z}};a.createClassBreaksDefinition=x;a.createUVResult=function(B,z,K,L){B=B.count;
const F=[];if(K&&z){K=[];var M=l(z[0]);for(const S of M)if(z[1]){M=l(z[1]);for(const N of M)if(z[2]){M=l(z[2]);for(const P of M)K.push(`${h(S)}${L}${h(N)}${L}${h(P)}`)}else K.push(`${h(S)}${L}${h(N)}`)}else K.push(S);for(const S of K)B.hasOwnProperty(S)||(B[S]={data:S,count:0})}for(const S in B)z=B[S],F.push({value:z.data,count:z.count,label:z.label});return{uniqueValueInfos:F}};a.getAttributeComparator=e;a.getEqualIntervalBins=t;a.getNormalizedValue=function(B,z,K,L){let F=null;switch(z){case "log":0!==
B&&(F=Math.log(B)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(L)&&0!==L&&(F=B/L*100);break;case "field":Number.isFinite(K)&&0!==K&&(F=B/K);break;case "natural-log":0<B&&(F=Math.log(B));break;case "square-root":0<B&&(F=B**.5)}return F};a.isNullCountSupported=k;a.processNullValue=h;a.processSummaryStatisticsResult=function(B,z){let K;for(K in B)y.includes(K)&&(Number.isFinite(B[K])||(B[K]=null));if(!z)return B;["avg","stddev","variance"].forEach(L=>{null!=B[L]&&(B[L]=Math.ceil(B[L]??
0))});return B};a.resolveCBResult=function(B,z){let K=B.classBreaks;const L=K[0]?.minValue,F=K[K.length-1]?.maxValue,M="standard-deviation"===z;K=K.map(S=>{const N=S.label;S={minValue:S.minValue,maxValue:S.maxValue,label:N};if(M&&N){const P=N.match(q)?.map(R=>+R.trim())??[];2===P.length?(S.minStdDev=P[0],S.maxStdDev=P[1],0>P[0]&&0<P[1]&&(S.hasAvg=!0)):1===P.length&&(N.includes("\x3c")?(S.minStdDev=null,S.maxStdDev=P[0]):N.includes("\x3e")&&(S.minStdDev=P[0],S.maxStdDev=null))}return S});return{minValue:L,
maxValue:F,classBreakInfos:K,normalizationTotal:B.normalizationTotal}};a.statisticTypes=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/RandomLCG ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,n,h,k,m,g,e,d){k=new b.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});b=new b.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});n=class extends n.JSONSupport{constructor(c){super(c);this.type="class-breaks-definition";this.normalizationType=
this.normalizationField=this.classificationMethod=this.classificationField=this.breakCount=null}set standardDeviationInterval(c){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",c)}set definedInterval(c){"defined-interval"===this.classificationMethod&&this._set("definedInterval",c)}};a.__decorate([e.enumeration({classBreaksDef:"class-breaks-definition"})],n.prototype,"type",void 0);a.__decorate([h.property({json:{write:!0}})],n.prototype,"breakCount",void 0);
a.__decorate([h.property({json:{write:!0}})],n.prototype,"classificationField",void 0);a.__decorate([h.property({type:String,json:{read:k.read,write:k.write}})],n.prototype,"classificationMethod",void 0);a.__decorate([h.property({json:{write:!0}})],n.prototype,"normalizationField",void 0);a.__decorate([h.property({json:{read:b.read,write:b.write}})],n.prototype,"normalizationType",void 0);a.__decorate([h.property({value:null,json:{write:!0}})],n.prototype,"standardDeviationInterval",null);a.__decorate([h.property({value:null,
json:{write:!0}})],n.prototype,"definedInterval",null);return n=a.__decorate([d.subclass("esri.rest.support.ClassBreaksDefinition")],n)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,b){function n(f){var r=f.definition;const {classificationMethod:x,normalizationType:w,definedInterval:p}=r;r=r.breakCount??1;const t=[];var q=f.values;if(0===q.length)return[];q=q.sort((A,C)=>A-C);var u=q[0],v=q[q.length-1];if("equal-interval"===x)if(q.length>=
r){q=(v-u)/r;f=u;for(var y=1;y<r;y++){var D=Number((u+y*q).toFixed(6));t.push({minValue:f,maxValue:D,label:h(f,D,w)});f=D}t.push({minValue:f,maxValue:v,label:h(f,v,w)})}else q.forEach(A=>{t.push({minValue:A,maxValue:A,label:h(A,A,w)})});else if("natural-breaks"===x){q=k(q);f=m(q.uniqueValues,f.valueFrequency||q.valueFrequency,r);for(y=1;y<r;y++)q.uniqueValues.length>y&&(D=Number(q.uniqueValues[f[y]].toFixed(6)),t.push({minValue:u,maxValue:D,label:h(u,D,w)}),u=D);t.push({minValue:u,maxValue:v,label:h(u,
v,w)})}else if("quantile"===x)if(q.length>=r&&u!==v){f=Math.ceil(q.length/r);y=0;for(D=1;D<r;D++){var G=f+y-1;G>q.length&&(G=q.length-1);0>G&&(G=0);t.push({minValue:u,maxValue:q[G],label:h(u,q[G],w)});u=q[G];y+=f;f=Math.ceil((q.length-y)/(r-D))}t.push({minValue:u,maxValue:v,label:h(u,v,w)})}else for(r=-1,v=0;v<q.length;v++)u=q[v],u!==r&&(r=u,t.push({minValue:r,maxValue:u,label:h(r,u,w)}),r=u);else if("standard-deviation"===x)if(f=d(q),y=c(q,f),0===y)t.push({minValue:q[0],maxValue:q[0],label:h(q[0],
q[0],w)});else{q=e(u,v,r,f,y)*y;y=0;for(D=r;1<=D;D--)G=Number((f-(D-.5)*q).toFixed(6)),t.push({minValue:u,maxValue:G,label:h(u,G,w)}),u=G,y++;D=Number((f+.5*q).toFixed(6));t.push({minValue:u,maxValue:D,label:h(u,D,w)});u=D;y++;for(G=1;G<=r;G++)D=y===2*r?v:Number((f+(G+.5)*q).toFixed(6)),t.push({minValue:u,maxValue:D,label:h(u,D,w)}),u=D,y++}else if("defined-interval"===x){if(!p)return t;r=q[0];v=q[q.length-1];q=Math.ceil((v-r)/p);u=r;for(f=1;f<q;f++)y=Number((r+f*p).toFixed(6)),t.push({minValue:u,
maxValue:y,label:h(u,y,w)}),u=y;t.push({minValue:u,maxValue:v,label:h(u,v,w)})}return t}function h(f,r,x){let w=null;return w=f===r?x&&"percent-of-total"===x?f+"%":f.toString():x&&"percent-of-total"===x?f+"% - "+r+"%":f+" - "+r}function k(f){const r=[],x=[];let w=Number.MIN_VALUE,p=1,t=-1;for(let q=0;q<f.length;q++){const u=f[q];u===w?(p++,x[t]=p):null!==u&&(r.push(u),w=u,p=1,x.push(p),t++)}return{uniqueValues:r,valueFrequency:x}}function m(f,r,x){var w=f.length;const p=[];x>w&&(x=w);for(var t=0;t<
x;t++)p.push(Math.round(t*w/x-1));p.push(w-1);t=g(p,f,r,x);w=t.mean;t=t.sdcm;var q=x,u=0,v=0;let y=0,D=0,G=!0;for(let C=0;2>C&&G;C++){0===C&&(G=!1);for(var A=0;A<q-1;A++)for(;p[A+1]+1!==p[A+2];)if(p[A+1]+=1,u=l(A,p,f,r),y=u.sbMean,u=u.sbSdcm,v=l(A+1,p,f,r),D=v.sbMean,v=v.sbSdcm,u+v<t[A]+t[A+1])t[A]=u,t[A+1]=v,w[A]=y,w[A+1]=D,G=!0;else{--p[A+1];break}for(A=q-1;0<A;A--)for(;p[A]!==p[A-1]+1;)if(--p[A],u=l(A-1,p,f,r),y=u.sbMean,u=u.sbSdcm,v=l(A,p,f,r),D=v.sbMean,v=v.sbSdcm,u+v<t[A-1]+t[A])t[A-1]=u,t[A]=
v,w[A-1]=y,w[A]=D,G=!0;else{p[A]+=1;break}}G&&(t=g(p,f,r,x));return p}function g(f,r,x,w){let p=[];var t=[],q=[];let u=0;const v=[],y=[];for(var D=0;D<w;D++){var G=l(D,f,r,x);v.push(G.sbMean);y.push(G.sbSdcm);u+=y[D]}G=u;for(D=!0;D||u<G;){D=!1;p=[];for(t=0;t<w;t++)p.push(f[t]);for(q=0;q<w;q++)for(G=f[q]+1;G<=f[q+1];G++)if(t=r[G],0<q&&G!==f[q+1]&&Math.abs(t-v[q])>Math.abs(t-v[q-1]))f[q]=G;else if(q<w-1&&f[q]!==G-1&&Math.abs(t-v[q])>Math.abs(t-v[q+1])){f[q+1]=G-1;break}G=u;u=0;t=[];q=[];for(let A=0;A<
w;A++){t.push(v[A]);q.push(y[A]);const C=l(A,f,r,x);v[A]=C.sbMean;y[A]=C.sbSdcm;u+=y[A]}}if(u>G){for(r=0;r<w;r++)f[r]=p[r],v[r]=t[r],y[r]=q[r];u=G}return{mean:v,sdcm:y}}function e(f,r,x,w,p){f=Math.max(w-f,r-w)/p/x;return 1<=f?1:.5<=f?.5:.25}function d(f){let r=0;for(let x=0;x<f.length;x++)r+=f[x];return r/=f.length}function c(f,r){let x=0;for(let w=0;w<f.length;w++){const p=f[w];x+=(p-r)*(p-r)}x/=f.length;return Math.sqrt(x)}function l(f,r,x,w){var p=0,t=0;for(var q=r[f]+1;q<=r[f+1];q++){const u=
w[q];p+=x[q]*u;t+=u}0>=t&&b.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");p/=t;t=0;for(q=r[f]+1;q<=r[f+1];q++)t+=w[q]*(x[q]-p)**2;return{sbMean:p,sbSdcm:t}}a.createGenerateRendererClassBreaks=function(f){const {normalizationTotal:r}=f;return{classBreaks:n(f),normalizationTotal:r}};a.createGenerateRendererUniqueValues=function(f){f=k(f);const r=[],x=f.uniqueValues.length;for(let w=0;w<x;w++){const p=f.uniqueValues[w];r.push({value:p,count:f.valueFrequency[w],
label:p.toString()})}return{uniqueValues:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define("require exports ../../../core/jsonMap ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ./projectionSupport".split(" "),function(a,b,n,h,k,m,g,e,d,c){async function l(t,
q,u){if(!t)return null;var {where:v}=t;t.where=v=v?.trim();if(!v||/^1 *= *1$/.test(v)||q&&q===v)t.where=null;if(!t.geometry)return t;q=await r(t);t.distance=0;t.units=null;"esriSpatialRelEnvelopeIntersects"===t.spatialRel&&({spatialReference:v}=t.geometry,q=m.getGeometryExtent(q),q.spatialReference=v);if(q){await c.checkProjectionSupport(q.spatialReference,u);v=q.spatialReference;q=f(q,u)&&g.isExtent(q)?{spatialReference:v,rings:[[[q.xmin,q.ymin],[q.xmin,q.ymax],[q.xmax,q.ymax],[q.xmax,q.ymin],[q.xmin,
q.ymin]]]}:q;v=(await e.normalizeCentralMeridian(g.fromJSON(q)))[0];if(null==v)throw p;const y="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0;q=y&&f(q,u)?{densificationStep:8*y}:void 0;v=v.toJSON();q=c.project(v,v.spatialReference,u,q);if(!q)throw p;q.spatialReference=u;t.geometry=q}return t}function f(t,q){if(!t)return!1;const u=t.spatialReference;return(g.isExtent(t)||g.isPolygon(t)||g.isPolyline(t))&&!d.equals(u,q)&&!k.canProjectWithoutEngine(u,
q)}async function r(t){const {distance:q,units:u}=t,v=t.geometry;if(null==q||"vertexAttributes"in v)return v;var y=v.spatialReference;t=u?w.fromJSON(u):h.getUnitString(y);y=y&&(d.isGeographic(y)||d.isWebMercator(y))?v:await c.checkProjectionSupport(y,d.wgs84).then(()=>c.project(v,d.wgs84));return(await x())(y.spatialReference,y,q,t)}async function x(){return(await new Promise((t,q)=>a(["../../../geometry/geometryEngineJSON"],t,q))).geodesicBuffer}const w=new n.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({});b.normalizeQuery=async function(t,q,u){const {outFields:v,orderByFields:y,groupByFieldsForStatistics:D,outStatistics:G}=t;if(v)for(var A=0;A<v.length;A++)v[A]=v[A].trim();if(y)for(A=0;A<y.length;A++)y[A]=y[A].trim();if(D)for(A=0;A<D.length;A++)D[A]=D[A].trim();if(G)for(A=0;A<G.length;A++)G[A].onStatisticField&&(G[A].onStatisticField=G[A].onStatisticField.trim());
t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference);return l(t,q,u)};b.normalizeQueryLike=l;b.queryEngineEmptyResult=p;b.unitsKebabDict=w;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryValidationUtils":function(){define("exports ../../../core/Error ./attributeSupport ./projectionSupport ./spatialQuerySupport ../../../support/arcadeOnDemand".split(" "),function(a,b,n,h,k,m){function g(f,r,x){const {outFields:w,orderByFields:p,returnDistinctValues:t,
outStatistics:q}=x,u=q?q.map(v=>v.outStatisticFieldName&&v.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(p&&0<p.length){const v=p.map(y=>{const D=y.toLowerCase();return D.includes(" asc")?D.split(" asc")[0]:D.includes(" desc")?D.split(" desc")[0]:y}).filter(y=>!u.includes(y));n.validateFields(f,r,v,{expressionName:"orderByFields",query:x})}if(w&&0<w.length)n.validateFields(f,r,w,{expressionName:"outFields",query:x,allowedFieldTypes:"all"});else if(t)throw new b("unsupported-query","outFields should be specified for returnDistinctValues",
{query:x});n.validateWhere(f,r,x.where,x)}function e(f,r,x){const {outStatistics:w,groupByFieldsForStatistics:p,having:t}=x;var q=p?.length,u=w?.length;if(t){if(!q||!u)throw new b("unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:x});n.validateHaving(f,r,t,w,x)}if(u&&c(w)){u=w.map(v=>v.onStatisticField).filter(Boolean);n.validateFields(f,r,u,{expressionName:"onStatisticFields",query:x});q&&n.validateFields(f,r,p,{expressionName:"groupByFieldsForStatistics",
query:x});for(const v of w){const {onStatisticField:y,statisticType:D}=v;if(("percentile_disc"===D||"percentile_cont"===D)&&"statisticParameters"in v){if({statisticParameters:q}=v,!q)throw new b("unsupported-query","statisticParameters should be set for percentile type",{definition:v,query:x});}else f.get(y)&&"count"!==D&&"min"!==D&&"max"!==D&&n.validateFields(f,r,[y],{expressionName:`outStatistics with '${D}' statistic type`,allowedFieldTypes:l,query:x})}}}async function d(f,r,x,w){var p=[];x.valueExpression&&
({arcadeUtils:p}=await m.loadArcade(),p=p.extractFieldNames(x.valueExpression));x.field&&p.push(x.field);x.field2&&p.push(x.field2);x.field3&&p.push(x.field3);x.normalizationField&&p.push(x.normalizationField);if(!p.length&&!x.valueExpression)throw new b("unsupported-query","field or valueExpression is required",{params:x});n.validateFields(f,r,p,{expressionName:"statistics",query:w})}function c(f){return null!=f&&f.every(r=>"exceedslimit"!==r.statisticType)}const l=new Set([...n.numericFieldTypes,
...n.allDateAndTimeFieldTypes]);a.validateQuery=async function(f,{fieldsIndex:r,geometryType:x,spatialReference:w,availableFields:p}){if(0>(f.distance??0)||null!=f.geometryPrecision||f.multipatchOption&&"xyFootprint"!==f.multipatchOption||f.pixelSize||f.relationParam||f.text)throw new b("unsupported-query","Unsupported query options",{query:f});g(r,p,f);e(r,p,f);return Promise.all([k.checkSpatialQuerySupport(f,x,w),h.checkProjectionSupport(w,f.outSR)]).then(()=>f)};a.validateStatisticsQuery=async function(f,
r,{fieldsIndex:x,geometryType:w,spatialReference:p,availableFields:t}){if(0>(f.distance??0)||null!=f.geometryPrecision||f.multipatchOption||f.pixelSize||f.relationParam||f.text||f.outStatistics||f.groupByFieldsForStatistics||f.having||f.orderByFields)throw new b("unsupported-query","Unsupported query options",{query:f});g(x,t,f);return Promise.all([d(x,t,r,f),k.checkSpatialQuerySupport(f,w,p),h.checkProjectionSupport(p,f.outSR)]).then(()=>f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./geometryUtils ./projectionSupport".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f){function r(){return new Promise((q,u)=>a(["../../../geometry/geometryEngineJSON"],q,u))}const x={esriSpatialRelIntersects:"intersects",
esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var w={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,
esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},p={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},t={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.canQueryWithRBush=function(q){if(m.isExtent(q))return!0;if(m.isPolygon(q)){for(const u of q.rings)if(5!==u.length||u[0][0]!==u[1][0]||u[0][0]!==u[4][0]||u[2][0]!==u[3][0]||u[0][1]!==u[3][1]||u[0][1]!==
u[4][1]||u[1][1]!==u[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=async function(q,u,v){const {spatialRel:y,geometry:D}=q;if(D){if(null==y||!0!==w[y])throw new n("unsupported-query","Unsupported query spatial relationship",{query:q});if(g.isValid(D.spatialReference)&&g.isValid(v)){if(null==D||!0!==p[m.getJsonType(D)])throw new n("unsupported-query","Unsupported query geometry type",{query:q});if(null==u||!0!==t[u])throw new n("unsupported-query","Unsupported layer geometry type",{query:q});
if(q.outSR)return f.checkProjectionSupport(q.geometry?.spatialReference,q.outSR)}}};b.getSpatialQueryOperator=function(q,u,v,y,D){if(m.isPolygon(u)&&"esriGeometryPoint"===v&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q)){const G=d.convertFromPolygon(new c,u,!1,!1);return Promise.resolve(A=>e.polygonContainsPoint(G,!1,!1,A))}if(m.isPolygon(u)&&"esriGeometryMultipoint"===v){const G=d.convertFromPolygon(new c,u,!1,!1);if("esriSpatialRelContains"===q)return Promise.resolve(A=>e.polygonContainsMultipoint(G,
!1,!1,A,y,D))}if(m.isExtent(u)&&"esriGeometryPoint"===v&&("esriSpatialRelIntersects"===q||"esriSpatialRelContains"===q))return Promise.resolve(G=>h.extentContainsPoint(u,l.getGeometry(v,y,D,G)));if(m.isExtent(u)&&"esriGeometryMultipoint"===v&&"esriSpatialRelContains"===q)return Promise.resolve(G=>h.extentContainsMultipoint(u,l.getGeometry(v,y,D,G)));if(m.isExtent(u)&&"esriSpatialRelIntersects"===q){const G=k.getExtentIntersector(v);return Promise.resolve(A=>G(u,l.getGeometry(v,y,D,A)))}return r().then(G=>
{const A=G[x[q]].bind(null,u.spatialReference,u);return C=>A(l.getGeometry(v,y,D,C))})};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;
a.getFeatureExtentIntersector=b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(n){return"mesh"===n?b.extentIntersectsExtent:b.getFeatureExtentIntersector(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(n,h,k,m,g){if(!n)return!1;h=h?k?4:3:k?3:2;const {coords:e,lengths:d}=n;k=!1;n=0;for(const l of d){var c=
n;for(let f=n,r=n+l*h;f<r;f+=h){c=f+h;c===r&&(c=n);const x=e[f],w=e[f+1],p=e[c];c=e[c+1];(w<g&&c>=g||c<g&&w>=g)&&x+(g-w)/(c-w)*(p-x)<m&&(k=!k)}n+=l*h}return k}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(n,h,k,m,g,e){g=g?e?4:3:e?3:2;const {coords:d,lengths:c}=m;if(!c)return!1;for(let l=0,f=0;l<c.length;l++,f+=g)if(!b(n,h,k,d[f],d[f+1]))return!1;return!0};a.polygonContainsPoint=function(n,h,k,m){return b(n,h,k,m.coords[0],m.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(k,m,g,e,d){if(null!=e&&null!=d)return c=>{const l=k(c,m);c=k(c,g);return(null==l||l<=d)&&(null==c||c>=e)};if(null!=e)return c=>{c=k(c,g);return null==c||c>=e};if(null!=d)return c=>{c=k(c,m);return null==c||c<=d}}function n(k,m,g,e){if(null!=g&&null!=e&&g===e)return d=>k(d,m)===g;if(null!=g&&null!=e)return d=>{d=k(d,m);return null!=d&&d>=g&&d<=e};if(null!=g)return d=>{d=k(d,m);return null!=d&&d>=g};if(null!=
e)return d=>{d=k(d,m);return null!=d&&d<=e}}function h(){return()=>!1}a.getTimeExtent=async function(k,m){if(!k)return null;const g=m.featureAdapter,{startTimeField:e,endTimeField:d}=k;let c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&d)await m.forEach(f=>{const r=g.getAttribute(f,e);f=g.getAttribute(f,d);null==r||isNaN(r)||(c=Math.min(c,r));null==f||isNaN(f)||(l=Math.max(l,f))});else{const f=e||d;await m.forEach(r=>{r=g.getAttribute(r,f);null==r||isNaN(r)||(c=Math.min(c,r),l=Math.max(l,
r))})}return{start:c,end:l}};a.getTimeOperator=function(k,m,g){if(!m||!k)return null;const {startTimeField:e,endTimeField:d}=k;if(!e&&!d)return null;const {start:c,end:l}=m;if(null===c&&null===l)return null;if(void 0===c&&void 0===l)return h();k=g.getAttributeAsTimestamp?.bind(g)??g.getAttribute.bind(g);return e&&d?b(k,e,d,c,l):n(k,e||d,c,l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../core/promiseUtils",
"../../../../support/arcadeOnDemand"],function(a,b,n){const h={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=async function(k,m,g){if(null==k||0===m.candidates.length)return h;var e=k.graphics3DGraphicsByObjectID??k.graphics3DGraphics,d=[];const c=[],{renderer:l}=k,f=null!=l&&"arcadeRequired"in l&&l.arcadeRequired?n.loadArcade():null;var r=async(q,{graphic:u,graphics3DSymbol:v})=>{const y=await f;u=await k.getRenderingInfoAsync(u,l,y,{signal:g});return null==u?[]:v.queryForSnapping(q,
w,u,g)};const {candidates:x,spatialReference:w}=m;for(m=0;m<x.length;++m){var p=x[m],{objectId:t}=p;t="number"===typeof t?e?.get(t):void 0;if(null==t)continue;const {graphics3DSymbol:q}=t;q.symbologySnappingSupported&&(d.push(r(p,t)),c.push(m))}if(0===d.length)return h;e=await Promise.all(d);b.throwIfAborted(g);d=[];r=[];for(m=0;m<e.length;++m){p=e[m];t=c[m];for(const q of p)d.push(q),r.push(t)}return{candidates:d,sourceCandidateIndices:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/byteSizeEstimations ../../../../core/handleUtils ../../../../core/Logger ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/support/UpdatingHandles ../../../../geometry/projection/projectPointToVector ../../../../geometry/support/Indices ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ../graphics/DisplayFeatureLimit ../graphics/GraphicsCorePerformanceInfo ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T){a.HeatmapFeatureProcessor=class extends n{constructor(Q){super(Q);this.type="heatmap";this.preferredUpdatePolicy=S.UpdatePolicy.ASYNC;this.dataExtent=null;this.drapeSourceType=C.DrapeSourceType.Features;this._renderGeometries=new Map;this._fieldTotal=0;this._drapeSourceRenderer=null;this._dataType=O.PixelType.HALF_FLOAT;this._pixelFormat=O.PixelFormat.RGBA;this._updatingHandles=new x.UpdatingHandles;this.initializePromise=
Promise.resolve()}initialize(){this._featureStore=new D({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:Q,samplingMode:V,pixelFormat:U,internalFormat:W}=T.loadHeatmapTextureConfiguration(this._renderView.renderingContext,g.getLogger(this));this._dataType=Q;this._pixelFormat=U;const ca=Q!==O.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,K.DrapedHeatmapRenderer,{...this._rendererParameters,dataType:Q,samplingMode:V,
pixelFormat:U,internalFormat:W});this._material=new P.HeatmapDensityMaterial({usesHalfFloats:ca});this._materialWithField=new P.HeatmapDensityMaterial({usesHalfFloats:ca,isAttributeDriven:!0});this._filterVisibility=new H.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:X=>this._setAllFeaturesVisibility(X),clearFeaturesVisibility:()=>this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:X=>
this._updateFeatureVisibilities(X)}});this._updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,X=>this._onLoadedFeaturesChange(X),e.initial);this._updatingHandles.addWhen(()=>this._materialParameters,X=>this._forEachMaterial(ba=>ba.setParameters(X)),e.initial);this._updatingHandles.add(()=>this._rendererParameters,X=>this._drapeSourceRenderer.set(X));this._updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},e.sync);this._updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,
numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:X,numeric:ba})=>{if(null!=X&&ba){let ia=0;this._featureStore.forEach(fa=>ia+=fa.attributes[X]??0);this._fieldTotal=ia}else this._fieldTotal=this._featureStore.numFeatures},e.initial);this.addHandles([e.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:X,field:ba})=>{X&&!ba&&g.getLogger(this).warn(`Heatmap renderer field '${X}' for layer '${this.layer.title??this.layer.id}' not found`)}),e.watch(()=>
({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:X,numeric:ba})=>{null==X||ba||g.getLogger(this).warn(`Heatmap renderer field '${X.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),m.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])}destroy(){this._renderGeometries.clear();this._materialWithField=this._material=null;this._featureStore.clear();
this._featureStore=null;this._updatingHandles.destroy()}get layer(){return this.owner.layer}get featureStore(){return this._featureStore}get updating(){return this._updatingHandles.updating||this.filterVisibility.updating}get updatingRemaining(){return 0}get suspendInfo(){return{}}get legendEnabled(){return!0}get filterVisibility(){return this._filterVisibility}get displayFeatureLimit(){var Q=this.owner?.view?.quality??1;const V=this.owner?.view?.qualitySettings;Q=V?Math.ceil(V.heatmap.maxTotalNumberOfFeatures*
Q):0;return new E.DisplayFeatureLimit(6*Q,Q)}get hasZ(){return"hasZ"in this.layer&&this.layer.hasZ}get hasM(){return"hasM"in this.layer&&this.layer.hasM}get view(){return this.owner.view}get fullOpacity(){return this.owner.fullOpacity}get updatePolicy(){return this.owner.updatePolicy}get scaleVisibilitySuspended(){if(!this._isScaleRangeActive)return!1;const {minScale:Q,maxScale:V}=this.layer.effectiveScaleRange,{scale:U}=this.view;return!R.scaleBoundsPredicate(U,Q??0,V??0)}get usedMemory(){const Q=
Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??0)*this._densityMapPixelRatio)??0;return Q*Q*(this._pixelFormat===O.PixelFormat.RED?1:4)*(this._dataType===O.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}get usedMemoryPerFeature(){var Q=this._loadedPointGraphics.find(()=>!0);if(null==Q)return 0;Q=k.estimateAttributesObjectSize(Q);const V=k.estimateNumberByteSize(),U=6*k.estimateFixedArraySize([0,0,0],V),W=6*k.estimateFixedArraySize([0,0],V);return U+W+(this._heatmapRendererFieldIsNumeric?
6*V:0)+Q}get loadedFeatures(){return this._featureStore.numFeatures}get unprocessedMemoryEstimate(){return 0}get performanceInfo(){return new I.GraphicsCorePerformanceInfo(this._visibleFeatures,0,0)}get renderer(){return this._heatmapRenderer}get _overlayRenderer(){return this.view.basemapTerrain.overlayManager.renderer}get _overlaySpatialReference(){return this._overlayRenderer.spatialReference}get _rendererParameters(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,
...this._pixelRatioParameter}}get _materialParameters(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}get _densityParameters(){const Q=this._heatmapRenderer;if(null==Q)return null;const {minDensity:V,maxDensity:U}=Q;return{minDensity:V,maxDensity:U,fieldTotal:this._fieldTotal}}get _radiusParameter(){const Q=this._heatmapRenderer;return Q?{searchRadius:d.pt2px(this._clampSearchRadius(Q.radius))}:null}get _resolutionForScaleParameter(){var Q=this._heatmapRenderer;if(!Q)return null;
({referenceScale:Q}=Q);return{resolutionForScale:0===Q?0:t.getResolutionForScale(Q,this.view.spatialReference)}}get _colorRampParameter(){const Q=this._heatmapRenderer;return Q?{colorRampData:A.generateGradient(Q.colorStops)}:null}get _pixelRatioParameter(){return{pixelRatio:this._densityMapPixelRatio}}get _densityMapPixelRatio(){return this.owner?.view?.qualitySettings.heatmap.pixelRatio??1}get _renderView(){return this.view._stage.renderView}get _featuresArePoints(){return"point"===this.layer.geometryType}get _loadedPointGraphics(){return this.owner.loadedGraphics}get _heatmapRenderer(){const Q=
this.layer.renderer;return"heatmap"===Q?.type?Q:null}get _heatmapRendererFieldName(){return this._heatmapRenderer?.field}get _heatmapRendererField(){const Q=this._heatmapRendererFieldName;return null!=Q?this.layer.fieldsIndex.get(Q):null}get _heatmapRendererFieldIsNumeric(){const Q=this._heatmapRendererField;return null==Q?!1:G.isNumericField(Q)}get _isScaleRangeActive(){const {layer:Q}=this;if(!("effectiveScaleRange"in Q))return!1;const {minScale:V,maxScale:U}=Q.effectiveScaleRange;return R.isScaleRangeActive(V,
U)}get _visibleFeatures(){let Q=0;this._renderGeometries.forEach(V=>{V.visible&&++Q});return Q}async whenGraphicBounds(){return null}computeAttachmentOrigin(){return null}highlight(){return m.makeHandle()}maskOccludee(){return m.makeHandle()}setObjectIdVisibility(){}refreshFilter(){this.filterVisibility.reapply()}_onLoadedFeaturesChange(Q){if(this._featuresArePoints){var {objectIdField:V}=this.layer;this._featureStore.removeManyById(Q.removed.map(W=>q.getObjectId(W,V)));this._featureStore.addMany(Q.added.map(W=>
{const {attributes:ca,centroid:X,geometry:ba}=W,ia=new v.OptimizedFeature(u.convertFromPoint(new y,ba),ca,X?u.convertFromPoint(new y,X):null,q.getObjectId(W,V));ia.displayId=W.uid;return ia}));var U=Q.added;Q=Q.removed;this._fieldTotal+=this._computeFieldTotalChange(U,Q);Q=Q.map(({uid:W})=>{const ca=this._renderGeometries.get(W);this._renderGeometries.delete(W);return ca}).filter(h.isSome);U=U.map(W=>{const ca=this._pointGraphicToRenderGeometry(W);this._renderGeometries.set(W.uid,ca);return ca});
0<Q.length&&this._drapeSourceRenderer.removeGeometries(Q,F.DirtyOperation.REMOVE);0<U.length&&this._drapeSourceRenderer.addGeometries(U,F.DirtyOperation.ADD);if(0<U.length||0<Q.length)this.filterVisibility.reapply(),this._renderView.requestRender()}}_recreate(){if(this._loadedPointGraphics){var Q=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:Q,removed:Q})}}_pointGraphicToRenderGeometry(Q){const V=this._heatmapRendererFieldName,U=null!=V?this._materialWithField:this._material;
var W=r.create();w.projectPointToVector(Q.geometry,W,this._overlaySpatialReference);W[2]=J.drapedZ;const ca=p.getContinuousIndexArray(1);W=[[N.VertexAttribute.POSITION,new B.Attribute(W,ca,W.length)]];const X=this._heatmapRendererFieldIsNumeric;null!=V&&W.push([N.VertexAttribute.FEATUREATTRIBUTE,new B.Attribute([X?Q.attributes[V]??0:0],ca,1)]);Q=new M.RenderGeometry(new L.Geometry(U,W,null,z.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:Q.uid});Q.visible=this.filterVisibility.defaultVisibility;
return Q}_forEachMaterial(Q){Q(this._material);Q(this._materialWithField)}_computeFieldTotalChange(Q,V){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return Q.length-V.length;const U=this._heatmapRendererFieldName,W=(ca,X)=>ca+(X.attributes[U]??0);return Q.reduce(W,0)-V.reduce(W,0)}_clampSearchRadius(Q){112<Q&&g.getLogger(this).warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(Q,112)}_updateFeatureVisibilities(Q){const V=
[];this._featureStore.forEach(({objectId:U,displayId:W})=>{U=Q(U);(W=this._renderGeometries.get(W))&&W.visible!==U&&(V.push(W),W.visible=U)});this._drapeSourceRenderer.modifyGeometries(V,F.DirtyState.VISIBILITY)}_setAllFeaturesVisibility(Q){const V=[];for(const U of this._renderGeometries.values())U.visible!==Q&&(V.push(U),U.visible=Q);this._drapeSourceRenderer.modifyGeometries(V,F.DirtyState.VISIBILITY)}get test(){return{visibleFeatureCount:this._visibleFeatures}}};b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"type",void 0);b.__decorate([c.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"suspendInfo",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"hasM",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"view",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",
null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"renderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"_rendererParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);b.__decorate([c.property()],
a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",
null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,
"_heatmapRendererFieldIsNumeric",null);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);b.__decorate([c.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=b.__decorate([f.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);a.maxRadiusPt=112;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../core/arrayUtils ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./geometryUtils ./optimizedFeatureQueryEngineAdapter".split(" "),function(a,b,n,h,k,m,g,e,d,c){const l=k.create();class f{constructor(r){this.geometryInfo=r;this._boundsStore=new e.BoundsStore;this._featuresById=
new Map;this._markedIds=new Set;this.events=new n;this.featureAdapter=c.optimizedFeatureQueryEngineAdapter}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let r=0;this._featuresById.forEach(x=>{null!=x.geometry&&x.geometry.coords&&(r+=x.geometry.coords.length)});return{featureCount:this._featuresById.size,
vertexCount:r/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(r){if(null==this.fullBounds)return null;const [x,w,p,t]=this.fullBounds;return{xmin:x,ymin:w,xmax:p,ymax:t,spatialReference:d.cleanFromGeometryEngine(r)}}add(r){this._add(r);this._emitChanged()}addMany(r){for(const x of r)this._add(x);this._emitChanged()}upsertMany(r){r=r.map(x=>this._upsert(x));this._emitChanged();return r.filter(a.isSome)}clear(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()}removeById(r){r=
this._featuresById.get(r);if(!r)return null;this._remove(r);this._emitChanged();return r}removeManyById(r){this._boundsStore.invalidateIndex();for(const x of r)(r=this._featuresById.get(x))&&this._remove(r);this._emitChanged()}forEachBounds(r,x){for(const w of r)(r=this._boundsStore.get(w.objectId))&&x(k.fromRect(l,r))}getFeature(r){return this._featuresById.get(r)}has(r){return this._featuresById.has(r)}forEach(r){this._featuresById.forEach(x=>r(x))}forEachInBounds(r,x){this._boundsStore.forEachInBounds(r,
w=>{x(this._featuresById.get(w))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex();this._markedIds.clear()}sweep(){let r=!1;this._featuresById.forEach((x,w)=>{this._markedIds.has(w)||(r=!0,this._remove(x))});this._markedIds.clear();r&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(r){if(r){var x=r.objectId;if(null==x)h.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature","feature id is missing",{feature:r}));else{var w=
this._featuresById.get(x);this._markedIds.add(x);if(w){r.displayId=w.displayId;var p=this._boundsStore.get(x);this._boundsStore.delete(x)}else if(null!=this.onFeatureAdd)this.onFeatureAdd(r);r.geometry?.coords?.length?(p=g.getBoundsOptimizedGeometry(null!=p?p:m.create(),r.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=p&&this._boundsStore.set(x,p)):this._boundsStore.set(x,null);this._featuresById.set(x,r)}}}_upsert(r){const x=r?.objectId;if(null==x)return h.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature",
"feature id is missing",{feature:r})),null;const w=this._featuresById.get(x);if(!w)return this._add(r),r;this._markedIds.add(x);const {geometry:p,attributes:t}=r;for(const q in t)w.attributes[q]=t[q];p&&(w.geometry=p,this._boundsStore.set(x,g.getBoundsOptimizedGeometry(m.create(),p,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null));return w}_remove(r){if(null!=this.onFeatureRemove)this.onFeatureRemove(r);const x=r.objectId;this._markedIds.delete(x);this._boundsStore.delete(x);this._featuresById.delete(x);
return r}}return f})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,b,n,h){function k(e,d,c){m.minX=d[0];m.minY=d[1];m.maxX=d[2];m.maxY=d[3];e.search(m,c)}const m={minX:0,minY:0,maxX:0,maxY:0};class g{constructor(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new n.PooledRBush(9,b("esri-csp-restrictions")?
e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const e=Array(this._idByBounds.size);let d=0;this._idByBounds.forEach((c,l)=>{e[d++]=l});this._indexInvalid=!1;this._index.clear();this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=h.empty();for(const d of this._boundsById.values())d&&
(e[0]=Math.min(d[0],e[0]),e[1]=Math.min(d[1],e[1]),e[2]=Math.max(d[2],e[2]),e[3]=Math.max(d[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()}delete(e){const d=this._boundsById.get(e);this._boundsById.delete(e);d&&(this._idByBounds.delete(d),this._indexInvalid||this._index.remove(d))}forEachInBounds(e,d){this._loadIndex();k(this._index,e,c=>d(this._idByBounds.get(c)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||
(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,d){if(!this._indexInvalid){const c=this._boundsById.get(e);c&&(this._index.remove(c),this._idByBounds.delete(c))}this._boundsById.set(e,d);d&&(this._idByBounds.set(d,e),this._indexInvalid||(this._boundsToLoad.push(d),5E4<this._boundsToLoad.length&&this._loadIndex()))}}a.BoundsStore=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/TextureDescriptor ../../../webgl/Util".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q){a.DrapedHeatmapRenderer=class extends f.SortedRenderGeometryRenderer{constructor(u){super(u);this.pixelRatio=1;this._colorRampData=new Uint8ClampedArray(4);this.type="draped-heatmap";this._heatmapParameters=new r.HeatmapPassParameters;var v=new t.TextureDescriptor;v.pixelFormat=u.pixelFormat;v.internalFormat=u.internalFormat;v.dataType=u.dataType;v.samplingMode=u.samplingMode;v.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;const y=u.rendererContext.rctx;this._densityMap=
new w.FramebufferObject(y,v);this._quad=l.createQuadVAO(y);v=new r.HeatmapTechniqueConfiguration;v.usesHalfFloat=u.dataType!==x.PixelType.FLOAT;this._technique=new r.HeatmapTechnique({rctx:y,viewingMode:c.ViewingMode.Local},v)}initialize(){const u=this._colorRampData,v=new t.TextureDescriptor(u.length/4,1);v.wrapMode=x.TextureWrapMode.CLAMP_TO_EDGE;this._colorRamp=new p.Texture(this.rctx,v,u);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(h.watch(()=>[this.colorRampData,
this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))}destroy(){this._technique=n.releaseMaybe(this._technique);this._densityMap=n.disposeMaybe(this._densityMap);this._quad=n.disposeMaybe(this._quad);this._colorRamp=n.disposeMaybe(this._colorRamp)}get searchRadius(){return this._heatmapParameters.searchRadius}set searchRadius(u){u!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=u,this.notifyChange("searchRadius"))}get minDensity(){return this._heatmapParameters.minDensity}set minDensity(u){u!==
this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=u,this.notifyChange("minDensity"))}get maxDensity(){return this._heatmapParameters.maxDensity}set maxDensity(u){u!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=u,this.notifyChange("maxDensity"))}get fieldTotal(){return this._heatmapParameters.fieldTotal}set fieldTotal(u){this._heatmapParameters.fieldTotal=u;this.notifyChange("fieldTotal")}get colorRampData(){return this._colorRampData}set colorRampData(u){const {colorRamp:v}=
this._heatmapParameters;if(null!=v&&u!==this._colorRampData){const y=u.length/4;y!==v.descriptor.width&&v.resize(y,1);v.setData(u)}this._colorRampData=u}get _colorRamp(){return this._heatmapParameters.colorRamp}set _colorRamp(u){this._heatmapParameters.colorRamp=u}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccludedDraped(){return!1}render(u){const v=this._sortedMaterialRenderers;if(0!==v.length){var y=this.rctx.getBoundFramebufferObject(),D=this.rctx.getViewport(),{pixelRatio:G}=
this,A=Math.ceil(D.width*G);G=Math.ceil(D.height*G);this._densityMap.resize(A,G);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,A,G);this.rctx.clear(x.ClearBufferBit.COLOR_BUFFER_BIT);var C=!1;v.forAll(E=>{const I=E.prepareTechnique(u);null!=I&&(E.renderNode(u,I),C=!0)});this.rctx.bindFramebuffer(y);this.rctx.setViewport(D.x,D.y,D.width,D.height);C&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,u.bindParameters,this._heatmapParameters),this.rctx.drawArrays(this._technique.primitiveType,
0,q.vertexCount(this._quad,"geometry")))}}};b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,
"colorRampData",null);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);b.__decorate([k.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",void 0);b.__decorate([k.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",
void 0);a.DrapedHeatmapRenderer=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){class w extends h.NoParameters{constructor(){super(...arguments);this.densityMap=this.colorRamp=null;this.searchRadius=1;this.minDensity=this.fieldTotal=0;this.maxDensity=100}}class p extends m.ShaderTechnique{constructor(q,u){super(q,u,()=>this.destroy())}initializeProgram(q){return new c.Program(q.rctx,p.shader.get().build(this.configuration),e.Default3D)}initializePipeline(){return x.makePipelineState({blending:d.blendingDefault,colorWrite:x.defaultColorWriteParams,
depthTest:null,depthWrite:null})}get primitiveType(){return r.PrimitiveType.TRIANGLE_STRIP}}p.shader=new k.ReloadableShaderModule(f.HeatmapShader,()=>new Promise((q,u)=>a(["./Heatmap.glsl"],q,u)));class t extends l.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=!1}}n.__decorate([g.parameter()],t.prototype,"usesHalfFloat",void 0);b.HeatmapPassParameters=w;b.HeatmapTechnique=p;b.HeatmapTechniqueConfiguration=t;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,n,h,k,m,g){function e(c){const l=new m.ShaderBuilder;
l.include(b.ScreenSpacePass);l.include(n.DiscardOrAdjustAlphaBlend);({usesHalfFloat:c}=c);l.fragment.uniforms.add(new g.Texture2DPassUniform("densityMap",f=>f.densityMap),new g.Texture2DPassUniform("tex",f=>f.colorRamp),new h.FloatPassUniform("densityNormalizer",f=>1/(f.maxDensity-f.minDensity)),new h.FloatPassUniform("minDensity",f=>f.minDensity),new h.FloatPassUniform("densityMultiplier",f=>3/(f.searchRadius*f.searchRadius*Math.PI)));c&&l.constants.add("compressionFactor","float",4);l.fragment.code.add(k.glsl`
    void main() {
      float density = texture(densityMap, uv).r * densityMultiplier${c?k.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      fragColor = color;
    }
  `);return l}const d=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=d;a.build=e})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../core/libs/gl-matrix-2/math/vec2 ../../../../core/libs/gl-matrix-2/factories/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f extends l.HeatmapDensityPassParameters{constructor(){super(...arguments);this.usesHalfFloats=this.isAttributeDriven=!1}}class r extends g.Material{constructor(u){super(u,new f);this.produces=new Map([[e.RenderSlot.DRAPED_MATERIAL,v=>v===k.ShaderOutput.Color]]);this._configuration=new l.HeatmapDensityTechniqueConfiguration}getConfiguration(){this._configuration.isAttributeDriven=this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;
return this._configuration}createGLMaterial(u){return new x(u)}intersect(){}intersectDraped(u,v,y,D,G,A){v=u.attributes.get(d.VertexAttribute.POSITION);({parameters:y}=this);({searchRadius:y}=y);({screenToWorldRatio:u}=u);u=y*u+2*u;u*=u;y=v.data.length/v.size;for(let E=0;E<y;E++){var C=E*v.size;C=b.set(q,v.data[C],v.data[C+1]);b.squaredDistance(C,D)<u&&G(A.dist,A.normal,-1,!1)}}createBufferWriter(){return new w(this.parameters.isAttributeDriven?t:p)}}class x extends m{beginSlot(u){return this.ensureTechnique(l.HeatmapDensityTechnique,
u)}}class w{constructor(u){this.vertexBufferLayout=u}elementCount(u){return 6*u.attributes.get(d.VertexAttribute.POSITION).indices.length}write(u,v,y,D,G){c.writePosition(y.attributes.get(d.VertexAttribute.POSITION),u,D.position,G,6);u=y.attributes.get(d.VertexAttribute.POSITION).indices.length;v=D.uv0;let A=G;for(let C=0;C<u;++C)v.setValues(A++,-1,-1),v.setValues(A++,1,-1),v.setValues(A++,1,1),v.setValues(A++,1,1),v.setValues(A++,-1,1),v.setValues(A++,-1,-1);(D=d.VertexAttribute.FEATUREATTRIBUTE in
D?D.featureAttribute:null)&&c.writeBufferFloat(y.attributes.get(d.VertexAttribute.FEATUREATTRIBUTE),D,G,6)}}const p=h.newLayout().vec3f(d.VertexAttribute.POSITION).vec2f(d.VertexAttribute.UV0),t=p.clone().f32(d.VertexAttribute.FEATUREATTRIBUTE),q=n.create();a.HeatmapDensityMaterial=r;a.HeatmapDensityMaterialParameters=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){class x extends e.MaterialParameters{constructor(){super(...arguments);this.searchRadius=128;this.resolutionForScale=0}}class w extends k.ShaderTechnique{initializeProgram(t){return new d.Program(t.rctx,w.shader.get().build(this.configuration),g.Default3D)}initializePipeline(){return r.makePipelineState({blending:r.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE,f.BlendOperation.ADD),colorWrite:r.defaultColorWriteParams,depthTest:null,depthWrite:null})}destroy(){super.destroy()}}
w.shader=new h.ReloadableShaderModule(l.HeatmapDensity,()=>new Promise((t,q)=>a(["./HeatmapDensity.glsl"],t,q)));class p extends c.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.usesHalfFloat=this.isAttributeDriven=!1}}n.__decorate([m.parameter()],p.prototype,"isAttributeDriven",void 0);n.__decorate([m.parameter()],p.prototype,"usesHalfFloat",void 0);b.HeatmapDensityPassParameters=x;b.HeatmapDensityTechnique=w;b.HeatmapDensityTechniqueConfiguration=p;Object.defineProperty(b,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,b,n,h,k,m){function g(d){const c=new k.ShaderBuilder,{vertex:l,fragment:f,attributes:r,varyings:x}=
c;b.addProjViewLocalOrigin(l,d);const {isAttributeDriven:w,usesHalfFloat:p}=d;r.add(m.VertexAttribute.POSITION,"vec3");r.add(m.VertexAttribute.UV0,"vec2");w&&(r.add(m.VertexAttribute.FEATUREATTRIBUTE,"float"),x.add("attributeValue","float"));p&&c.constants.add("compressionFactor","float",.25);x.add("unitCirclePos","vec2");l.uniforms.add(new n.FloatPassUniform("radius",({resolutionForScale:t,searchRadius:q},{camera:u,screenToWorldRatio:v,overlayStretch:y})=>2*q*(0===t?1:t/v)*u.pixelRatio/u.fullViewport[2]/
y));l.code.add(h.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${m.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${w?h.glsl`attributeValue = ${m.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);f.code.add(h.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${w?h.glsl` * attributeValue`:""} ${p?h.glsl` * compressionFactor`:""};
      fragColor = vec4(density);
    }
  `);return c}const e=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=e;a.build=g})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(a,b,n){class h{constructor(k,m,g,e){this.dataType=k;this.samplingMode=m;this.pixelFormat=g;this.internalFormat=e}}a.HeatmapTextureConfiguration=h;a.loadHeatmapTextureConfiguration=function(k,m){const {textureFloat:g,colorBufferFloat:e}=k.capabilities,
d=g?.textureFloatLinear,c=e?.textureFloat,l=e?.textureHalfFloat,f=e?.floatBlend;k=k.driverTest.floatBufferBlend.result;if(!c&&!l)throw new b("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(f&&k||l))throw new b("heatmap:missing-float-blend",`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${k?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);
const r=!!e?.R32F,x=!!e?.R16F;if(c&&f&&k&&d)return d||m.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new h(n.PixelType.FLOAT,d?n.TextureSamplingMode.LINEAR:n.TextureSamplingMode.NEAREST,r?n.PixelFormat.RED:n.PixelFormat.RGBA,r?n.SizedPixelFormat.R32F:n.PixelFormat.RGBA);if(l)return new h(n.PixelType.HALF_FLOAT,n.TextureSamplingMode.LINEAR,x?n.PixelFormat.RED:n.PixelFormat.RGBA,x?n.SizedPixelFormat.R16F:n.PixelFormat.RGBA);throw new b("heatmap:missing-hardware-support",
"HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,n){a.toViewIfLocal=function(h){const k=h.view.spatialReference,m=h.layer.fullExtent;var g=null!=m&&m.spatialReference;if(null==m||!g)return Promise.resolve(null);
if(g.equals(k))return Promise.resolve(m.clone());g=b.project(m,k);return null!=g?Promise.resolve(g):h.view.state.isLocal?n.projectGeometry(m,k,h.layer.portalItem).then(e=>!h.destroyed&&e?e:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,n,h){class k{constructor(m){this._capabilities=
this._memoryCache=null;const g=m.layerView.layer;this._layerView=m.layerView;this.objectIdField=g.objectIdField;this.globalIdField="globalIdField"in g?g.globalIdField:null;this._returnZ=m.returnZ;this._returnM=m.returnM;m=this._layerView.view.resourceController;this.query=h.createFeatureTileQuery3D(this._layerView,m.normal);m&&this._memoryCacheEnabled&&(this._memoryCache=m.memoryController.newCache(`fl-${g.uid}`))}get _memoryCacheEnabled(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;
case "csv":case "geojson":case "memory":case "wfs":return!1}}destroy(){this._memoryCache=b.destroyMaybe(this._memoryCache);this.query.destroy()}createQuery(){const m=this._layerView.layer.createQuery();m.outFields=this._layerView.availableFields;m.returnZ=this._returnZ;m.returnM=this._returnM;m.outSpatialReference=this.tilingScheme.spatialReference;return m}get memoryCache(){return this._memoryCache}get viewingMode(){return this._layerView.view.state.viewingMode}get tilingScheme(){return this._layerView.view.featureTiles.tilingScheme}get scheduler(){const m=
this._layerView.view.resourceController;return m?m.scheduler:null}get geometryType(){return this._layerView.layer.geometryType}get fullExtent(){return this._layerView.layer.fullExtent}get tileMaxRecordCount(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}get maxRecordCount(){return this._layerView.layer.capabilities.query.maxRecordCount}get capabilities(){return null!=this._capabilities?this._capabilities:this._capabilities=n.contextCapabilitiesFromLayer(this._layerView.layer)}logFetchError(m,
g){m.error("#fetchTile()",this._layerView.layer,g?.message??g)}}a.FeatureTileFetcher3DLayerViewContext=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/SetUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){let w=class extends n{constructor(u){super(u)}get implicitFields(){if(!this.layer.outFields?.includes("*"))return new Set;const u=new Set(this.layerView.requiredFields),v=new Set(this.layerView.availableFields);return m.difference(v,u)}get queryFeaturesDehydrated(){const {layer:u}=this;var v=u.capabilities;v=v&&v.query;const y=u.parsedUrl;if(v&&v.supportsFormatPBF){null==this._decoder&&(this._decoder=new x.PBFDecoder(this.controller));const D={sourceSpatialReference:u.spatialReference?.toJSON()??
null,applyTransform:!0,maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024};return(G,A)=>r.runQuery(y,G,"pbf",this._createRequestOptions(A)).then(C=>{k.throwIfAborted(A);return null!=this._decoder?this._decoder.invoke({buffer:C.data,options:D},A.signal):Promise.reject(k.createAbortError())})}return(D,G)=>r.executeQuery(y,D,u.spatialReference,this._createRequestOptions(G)).then(A=>f.fromFeatureSetJSON(A.data,{maxStringAttributeFields:this.implicitFields,maxStringAttributeLength:1024}))}queryFeatureCount(u,
v){return this.layer.queryFeatureCount(u,v)}destroy(){this._decoder=h.destroyMaybe(this._decoder)}_createRequestOptions(u){return{...u,query:{...this.layer.customParameters,token:this.layer.apiKey,...u?.query}}}};b.__decorate([g.property({constructOnly:!0})],w.prototype,"layer",void 0);b.__decorate([g.property({constructOnly:!0})],w.prototype,"layerView",void 0);b.__decorate([g.property({constructOnly:!0})],w.prototype,"controller",void 0);b.__decorate([g.property({readOnly:!0})],w.prototype,"implicitFields",
null);b.__decorate([g.property({readOnly:!0})],w.prototype,"queryFeaturesDehydrated",null);w=b.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],w);let p=class extends n{constructor(u){super(u)}queryFeaturesDehydrated(u,v){return this.layer.queryFeatures(u,v)}queryFeatureCount(u,v){return this.layer.queryFeatureCount(u,v)}};b.__decorate([g.property({constructOnly:!0})],p.prototype,"layer",void 0);b.__decorate([g.property({readOnly:!0})],p.prototype,
"queryFeaturesDehydrated",null);p=b.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],p);let t=class extends n{constructor(u){super(u)}queryFeaturesDehydrated(u,v){return this.layer.queryFeatures(u,v)}};b.__decorate([g.property({constructOnly:!0})],t.prototype,"layer",void 0);t=b.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t);let q=class extends n{constructor(u){super(u)}queryFeaturesDehydrated(u,
v){return this.source.queryFeaturesJSON(u,v).then(f.fromFeatureSetJSON,y=>{if(y&&"query-features-json:unsupported"===y.name)return this.layer.queryFeatures(u,v);throw y;})}queryFeatureCount(u,v){return this.layer.queryFeatureCount(u,v)}};b.__decorate([g.property({constructOnly:!0})],q.prototype,"layer",void 0);b.__decorate([g.property({constructOnly:!0})],q.prototype,"source",void 0);q=b.__decorate([l.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],q);a.createFeatureTileQuery3D=
function(u,v){const {layer:y}=u;return"feature"===y.type&&"feature-layer"===y.source.type?null!=y.infoFor3D?new p({layer:y}):new w({layer:y,layerView:u,controller:v}):"feature"===y.type&&"memory"===y.source.type||"csv"===y.type||"geojson"===y.type||"oriented-imagery"===y.type||"wfs"===y.type?new q({layer:y,source:y.source}):"ogc-feature"===y.type?new t({layer:y}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../Graphic ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,n,h,k,m){function g(c){switch(c.type){case "polyline":c.paths.reduce((l,f)=>l+f.length,0)<n.nativeArrayMaxSize&&(c.paths=c.hasZ||c.hasM?c.paths.map(l=>l.map(f=>[f[0],f[1],f[2]])):c.paths.map(l=>l.map(f=>[f[0],f[1]])));break;case "polygon":c.rings.reduce((l,f)=>l+f.length,0)<n.nativeArrayMaxSize&&(c.rings=c.hasZ||c.hasM?c.rings.map(l=>l.map(f=>[f[0],f[1],f[2]])):c.rings.map(l=>l.map(f=>[f[0],f[1]])))}}class e{constructor(c){this._controller=c;this._handle=new d(l=>c.schedule(l))}destroy(){this._handle.destroy()}invoke(c,
l){if(!c.buffer||0===c.buffer.byteLength)return Promise.resolve(null);c.options.sourceSpatialReference&&c.options.sourceSpatialReference instanceof k&&(c.options={...c.options,sourceSpatialReference:c.options.sourceSpatialReference.toJSON()});return this._handle.invoke(c,l).then(f=>{let r=0,x=0;const w=k.fromJSON(f.spatialReference);f.spatialReference=w;const p=async t=>{var q=f.fields;if(q)for(;r<q.length;)if(q[r]=m.fromJSON(q[r]),r++,t.madeProgress())return this._controller.reschedule(v=>p(v));
for(q=f.features;x<q.length;){var u=q[x];++x;u.uid=b.generateUID();u=u.geometry;if(null!=u&&(u.spatialReference=w,g(u),t.madeProgress()))return this._controller.reschedule(v=>p(v))}return f};return this._controller.schedule(t=>p(t))})}}class d extends h.WorkerHandle{constructor(c){super("PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:l=>[l.buffer]},c)}}a.PBFDecoder=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports",
"../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils","../../../core/signal"],function(a,b,n,h,k){class m extends b{constructor(){super(...arguments);this._set=new Set;this._length=k.signal(0)}clear(){if(0<this._set.size){const g=this.toArray();this._set.clear();this.emit("after-changes",{type:n.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:g})}}get length(){return this._length.value}addMany(g){if(0!==g.length){for(const e of g)this._set.add(e);
this._length.value=this._set.size;this.emit("after-changes",{type:n.ObservableChangesType.ADD});this.emit("change",{added:g,removed:[]})}}remove(g){this._set.delete(g)&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[g]}))}removeMany(g){const e=[];for(const d of g)this._set.delete(d)&&e.push(d);0<e.length&&(this._length.value=this._set.size,this.emit("after-changes",{type:n.ObservableChangesType.REMOVE}),this.emit("change",
{added:[],removed:e}))}toArray(){return[...this._set]}find(g){let e;h.someSet(this._set,d=>g(d)?(e=d,!0):!1);return e}forEach(g){this._set.forEach(e=>g(e))}}a.EventedSet=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/RandomLCG ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t){return q=>{q=class extends q{constructor(...u){super(...u);this._updatingRequiredFieldsPromise=null;this.dataUpdating=!1;this.layer=this.timeExtent=this.filter=null;this.requiredFields=[];this.view=null}initialize(){this.addHandles([k.watch(()=>{const u=this.layer;return[u&&"elevationInfo"in u?u.elevationInfo?.featureExpressionInfo:null,u&&"displayField"in u?u.displayField:null,u&&"timeInfo"in u&&u.timeInfo,u&&"renderer"in u&&u.renderer,u&&"labelingInfo"in
u&&u.labelingInfo,u&&"floorInfo"in u&&u.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),k.syncAndInitial),k.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),k.on(()=>{const u=this.layer;return u&&"sublayers"in u?u.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])}get availableFields(){if(!this.layer)return[];const {layer:u,layer:{fieldsIndex:v},requiredFields:y}=this;return"outFields"in u&&u.outFields?r.fixFields(v,
[...r.unpackFieldNames(v,u.outFields),...y]):r.fixFields(v,y)}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(u){this._override("featureEffect",u)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(u){n.getLogger(this).error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(u){throw Error("missing implementation");}createQuery(){var u=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};u=null!=this.filter?this.filter.createQuery(u):new w(u);if("floorInfo"in this.layer&&this.layer.floorInfo){const v=x.getFloorFilterClause(this);null!=v&&(u.where=u.where?`(${u.where}) AND (${v})`:v)}null!=this.timeExtent&&(u.timeExtent=null!=u.timeExtent?u.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return u}createAggregateQuery(){return new w({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryFeatures(u,
v){throw Error("missing implementation");}queryObjectIds(u,v){throw Error("missing implementation");}queryFeatureCount(u,v){throw Error("missing implementation");}queryExtent(u,v){throw Error("missing implementation");}async fetchPopupFeaturesFromGraphics(u,v){this._validateFetchPopupFeatures(u,v);return this._fetchPopupFeatures(u,v)}_loadArcadeModules(u){return u.expressionInfos?.length||Array.isArray(u.content)&&u.content.some(v=>"expression"===v.type)?p.loadArcade():Promise.resolve()}_handleRequiredFieldsChange(){const u=
this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",u);u.then(()=>{this._updatingRequiredFieldsPromise===u&&this._set("_updatingRequiredFieldsPromise",null)})}async _updateRequiredFields(){if(this.layer&&this.view){var u="3d"===this.view.type,{layer:v,layer:{fieldsIndex:y,objectIdField:D}}=this,G="renderer"in v&&v.renderer,A="orderBy"in v&&v.orderBy,C="featureReduction"in v?v.featureReduction:null,E=new Set;G=await Promise.allSettled([G?G.collectRequiredFields(E,y):null,r.collectLabelingFields(E,
v),u&&"elevationInfo"in v?r.collectElevationFields(E,v):null,null!=this.filter?r.collectFilterFields(E,v,this.filter):null,u||null==this.featureEffect?null:r.collectFilterFields(E,v,this.featureEffect.filter),!u&&C?r.collectFeatureReductionFields(E,v,C):null,!u&&A?r.collectOrderByInfos(E,v,A):null]);"timeInfo"in v&&v.timeInfo&&this.timeExtent&&r.collectFields(E,v.fieldsIndex,[v.timeInfo.startField,v.timeInfo.endField]);"floorInfo"in v&&v.floorInfo&&r.collectFields(E,v.fieldsIndex,[v.floorInfo.floorField]);
"feature"===v.type&&u&&null!=v.infoFor3D&&(null==v.globalIdField&&n.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),r.collectFields(E,v.fieldsIndex,[v.globalIdField]));"subtype-group"===v.type&&(r.collectField(E,y,v.subtypeField),A=v.sublayers.map(I=>Promise.all([I.renderer?.collectRequiredFields(E,y),r.collectLabelingFields(E,I)])),await Promise.allSettled(A));"catalog-footprint"===v.type&&r.collectFields(E,y,[v.parent.itemSourceField,v.parent.itemTypeField]);for(const I of G)"rejected"===
I.status&&n.getLogger(this).error(I.reason);r.collectField(E,y,D);u&&"displayField"in v&&v.displayField&&r.collectField(E,y,v.displayField);u=Array.from(E).sort();this._set("requiredFields",u)}}_validateFetchPopupFeatures(u,v){if(null!=v)for(const y of u){u=y.origin&&"layer"in y.origin?y.origin.layer:y.layer;if("popupEnabled"in u&&!u.popupEnabled)throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:u});if(y.isAggregate){const D="featureReduction"in u?u.featureReduction:null;
if(!(D&&"popupTemplate"in D&&D.popupEnabled&&D.popupTemplate))throw new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:u});}else if("popupTemplate"in u&&!t.getFetchPopupTemplate(u,v))throw new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:u});}}_popupFeatureHasRequiredFields(u,v){return r.featureHasFields(v,u)}async _fetchPopupFeatures(u,v){const y=Array(u.length),D=new Map,G=await this._createPopupQuery(u.map(C=>C.origin?.layer??C.layer),
v);for(let C=0;C<u.length;C++){const E=u[C];if(E.isAggregate){y[C]=E;continue}var A=E.origin?.layer??E.layer;if(!(A&&"popupEnabled"in A))continue;const I=r.unpackFieldNames(this.layer.fieldsIndex,G.outFields);A=t.getFetchPopupTemplate(A,v);if(null==A)continue;const H=await this._loadArcadeModules(A);h.throwIfAborted(v);H&&H.arcadeUtils.hasGeometryOperations(A)||!this._popupFeatureHasRequiredFields(E,I)?D.set(E.getObjectId(),{graphic:E,index:C}):y[C]=E}if("stream"===this.layer.type||0===D.size)return y.filter(Boolean);
G.objectIds=Array.from(D.keys());try{const C=await this.layer.queryFeatures(G,v);for(const E of C.features){const {graphic:{geometry:I,origin:H},index:J}=D.get(E.getObjectId());let B;(B=E).geometry||(B.geometry=I);E.origin=H;y[J]=E}}catch{}return y.filter(Boolean)}async _createPopupQuery(u,v){const y=this.layer.createQuery(),D=new Set;var G=!1;u=u??[this.layer];for(const A of u)if("popupEnabled"in A&&(u=t.getFetchPopupTemplate(A,v),null!=u)){G=await this._loadArcadeModules(u);h.throwIfAborted(v);
G=G&&G.arcadeUtils.hasGeometryOperations(u);G=!("point"!==this.layer.geometryType&&!G);u=await t.getRequiredFields(this.layer,u);h.throwIfAborted(v);for(const C of u)D.add(C)}y.returnGeometry=G;y.returnZ=G;y.returnM=G;y.outFields=Array.from(D);y.outSpatialReference=this.view.spatialReference;"floorInfo"in this.layer&&this.layer.floorInfo&&(v=x.getFloorFilterClause(this),null!=v&&(y.where=y.where?`(${y.where}) AND (${v})`:v));return y}canResume(){return!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty?
!1:!0}getTest(){return{createPopupQuery:u=>this._createPopupQuery(void 0,u)}}get test(){return this.getTest()}};a.__decorate([m.property()],q.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([m.property({readOnly:!0})],q.prototype,"availableFields",null);a.__decorate([m.property({readOnly:!0})],q.prototype,"dataUpdating",void 0);a.__decorate([m.property({type:l})],q.prototype,"featureEffect",null);a.__decorate([m.property({type:f})],q.prototype,"filter",void 0);a.__decorate([m.property(c.combinedViewLayerTimeExtentProperty)],
q.prototype,"timeExtent",void 0);a.__decorate([m.property()],q.prototype,"layer",void 0);a.__decorate([m.property({type:Number})],q.prototype,"maximumNumberOfFeatures",null);a.__decorate([m.property({readOnly:!0,type:Boolean})],q.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([m.property({readOnly:!0})],q.prototype,"requiredFields",void 0);a.__decorate([m.property()],q.prototype,"suspended",void 0);a.__decorate([m.property()],q.prototype,"view",void 0);return q=a.__decorate([d.subclass("esri.views.layers.FeatureLayerView")],
q)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/has ../../core/RandomLCG ../../core/Error ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e){return d=>{d=class extends d{initialize(){this.addHandles(h.on(()=>this.layer,"refresh",c=>{this.doRefresh(c.dataChanged).catch(l=>{n.isAbortError(l)||b.getLogger(this).error(l)})}),"RefreshableLayerView")}};
return d=a.__decorate([e.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/handleUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f32 ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedPoint ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudLayerViewPerformanceInfo ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/hitTest ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia){function fa(ea){return ha=>ea.immediate.schedule(ha)}const da=y.create();x=class extends T.PopupSceneLayerView(z.LayerView3D(X)){constructor(){super(...arguments);this.type="point-cloud-3d";this.maximumPointCount=4E6;this.slicePlaneEnabled=!1;this._renderer=null;this._rendererAdded=!1;this._renderedNodes=new Set;this._nodeScales=new Map;this._updateViewNeeded=!0;this._lodFactor=1;this._maxLoggedBoxWarnings=
5;this._pageMultiplier=1;this._nodeLoadEpoch=0;this._indexQueue=[];this._workQueue=[];this._idleQueue=new J.PromiseQueue;this._indexPagesLoading=new Map;this._loadingNodes=new Map;this._recalcWork=!0;this._layerIsVisible=!1;this._codedDomainPopulationAbortController=this._codedDomainPopulationPromise=null;this._totalWork=0;this._index=null;this._loadingInitNodePage=!1;this._nodeIdArray=[];this.ignoresMemoryFactor=!1}get baseUrl(){return this.layer.parsedUrl.path}get pointScale(){const ea=N.getSplatSizeAlgorithm(this.layer?.renderer);
return null!=ea?.scaleFactor?ea.scaleFactor:1}get useRealWorldSymbolSizes(){const ea=N.getFixedSizeAlgorithm(this.layer?.renderer);return null!=ea?.useRealWorldSymbolSizes?ea.useRealWorldSymbolSizes:!1}get pointSize(){const ea=N.getFixedSizeAlgorithm(this.layer?.renderer);return null!=ea?.size?ea.size:0}get inverseDensity(){return this.layer?.renderer?96/this.layer.renderer.pointsPerInch:5}get availableFields(){var ea=N.getRendererInfo(this.layer);const ha=new Set;ea.primaryAttribute&&ha.add(ea.primaryAttribute.name);
ea.modulationAttribute&&ha.add(ea.modulationAttribute.name);if(ea=N.getFilterInfo(this.layer))for(const Y of ea)Y.attributeInfo&&ha.add(Y.attributeInfo.name);if(this.layer.outFields)for(const Y of H.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ha.add(Y);return Array.from(ha)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const ea=u.create();return Q.projectToBoundingBox(this.view.clippingArea,ea,this.view.renderSpatialReference)?ea:null}get _elevationOffset(){const ea=
this.layer&&this.layer.elevationInfo;if(ea&&"absolute-height"===ea.mode){const ha=f.getMetersPerVerticalUnitForSR(this.layer.spatialReference),Y=B.getMetersPerUnit(ea.unit);return(ea.offset??0)*Y/ha}return 0}initialize(){const ea=this.view.resourceController;var ha=fa(ea);this._worker=new L.PointCloudWorkerHandle(ha);this.addResolvingPromise(this._worker.promise);this._tmpPoint=D.makeDehydratedPoint(0,0,0,this.layer.spatialReference);F.checkPointCloudLayerValid(this.layer);F.checkPointCloudLayerCompatibleWithView(this.layer,
this.view);this._indexRequester=ea.createStreamDataRequester(U.ClientType.I3S_INDEX);this._dataRequester=ea.createStreamDataRequester(U.ClientType.I3S_DATA);this._initRenderer();ha=this._initNodePages();this._memCache=this.view.resourceController.memoryController.newCache(`pcl-${this.layer.uid}`);this._updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),d.initial);this._updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),d.initial);this._updatingHandles.add(()=>
this.layer.renderer,()=>this._rendererChanged(),d.initial);this._updatingHandles.add(()=>this.layer.filters,()=>this._reload(),d.initial);this._updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),d.initial);this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this._updatingHandles.add(()=>this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.addHandles([this.view.basemapTerrain.on("scale-change",Y=>this._scaleUpdateHandler(Y)),d.watch(()=>
this.view.quality,()=>this._setUpdateViewNeeded(),d.sync)]);this.addResolvingPromise(ha);this.when(()=>{this.addHandles([ea.scheduler.registerTask(ia.TaskPriority.POINT_CLOUD_LAYER,this),ea.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this._updatingHandles.add(()=>this.suspended,Y=>{Y?this._clearNodeState():this._setUpdateViewNeeded()},d.initial)])},()=>{this._updatingHandles.removeAll();this.removeAllHandles()})}_setUpdateViewNeeded(){this._updateViewNeeded=!0;
this._updateLoading()}destroy(){this.cancelLoading();this._worker=g.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=g.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=g.abortMaybe(this._codedDomainPopulationAbortController);this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new O.PointRenderer({createGraphic:(ea,ha,Y)=>this._createGraphic(ea,ha,Y)});this._renderer.layerUid=this.layer.uid;this._updatingHandles.add(()=>this._clippingBox,ea=>
this._renderer.clippingBox=ea,d.initial);this._updatingHandles.add(()=>this.suspended,ea=>this._setPointsVisible(!ea),d.initial);this._updatingHandles.add(()=>this.pointScale,ea=>this._renderer.scaleFactor=ea,d.initial);this._renderer.minSizePx=Math.sqrt(2);this._updatingHandles.add(()=>this.useRealWorldSymbolSizes,ea=>this._renderer.useRealWorldSymbolSizes=ea,d.initial);this._updatingHandles.add(()=>this.pointSize,ea=>{const ha=c.pt2px(ea);this._renderer.size=ea;this._renderer.sizePx=ha},d.initial);
this._updatingHandles.add(()=>this.slicePlaneEnabled,ea=>this._renderer.slicePlaneEnabled=ea,d.initial);this._updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),d.initial);this._updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),d.initial);this._updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,ea=>{this._lodFactor=ea;this._setUpdateViewNeeded()},d.initial)}_destroyRenderer(){this._renderer.removeAll();this._setPointsVisible(!1)}_createGraphic(ea,
ha,Y){const Z=null!=ea.pointIdFilterMap?ea.pointIdFilterMap[ha]:ha;Y=V.computeMapPointFromVec3d(this.view,Y);const ja=this._createGraphicAttributes(ea,Z);return new R.PointGraphic({pointCloudMetadata:{nodeId:ea.id,pointIndexInNode:ha,attributePointIndexInNode:Z,epoch:this._nodeLoadEpoch},geometry:Y,attributes:ja,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(ea,ha){const Y={};for(const Z of ea.attributes)this._encodeGraphicAttribute(Z.attributeInfo,Z.values,ha,Y);return Y}_encodeGraphicAttribute(ea,
ha,Y,Z){var ja=ea.storageInfo?.attributeValues;const oa=ja?.valuesPerElement??1;if(1===oa)Z[ea.name]=ha[Y];else if("UInt8"===ja?.valueType&&4>=oa){ja=0;Y*=oa;for(let qa=Y;qa<Y+oa;qa++)ja=(ja<<8)+ha[qa];Z[ea.name]=ja}else Z[ea.name]=void 0}_setPointsVisible(ea){ea&&!this._rendererAdded?(this.view._stage.addRenderPlugin(this._renderer),this._rendererAdded=!0):!ea&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=
N.rendererUsesFixedSizes(this.layer.renderer);this._reload()}_reload(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState();this._memCache.clear();this._initNodePages()}_scaleUpdateHandler(ea){const ha=this.layer.effectiveScaleRange;ba.isScaleRangeActive(ha.minScale,ha.maxScale)?q.projectBoundingRect(ea.extent,ea.spatialReference,aa,this.layer.spatialReference)&&(this._nodeScales.forEach((Y,Z)=>{this._renderedNodes.has(Z)?(Y=this._index.getNode(Z),
v.containsPoint(aa,Y.obb.center)&&this._nodeScales.set(Z,ea.scale)):this._nodeScales.delete(Z)}),this._setUpdateViewNeeded()):this._nodeScales.clear()}_displayNodes(ea){this._workQueue=M.nodeDiff([...this._renderedNodes],ea,this._index);M.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);M.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<ea.length||this._loadingInitNodePage;
this.notifyChange("suspended")}cancelLoading(){this._cancelNodeLoading();this._cancelIndexLoading()}_cancelNodeLoading(){const ea=[];this._loadingNodes.forEach(({abortController:ha})=>ea.push(ha));this._loadingNodes.clear();for(const ha of ea)ha.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()}_updateQueues(){const ea=new Set;this._workQueue.forEach(Z=>Z.load.forEach(ja=>ea.add(ja)));const ha=[],Y=new Map;this._loadingNodes.forEach((Z,
ja)=>{ea.has(ja)?Y.set(ja,Z):ha.push(Z)});this._loadingNodes=Y;for(const {abortController:Z}of ha)Z.abort();this._workQueue=this._workQueue.filter(Z=>{for(const ja of Z.load)if(this._loadingNodes.has(ja))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:ea})=>ea.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++;
this._renderedNodes.forEach(ea=>this._removeFromRenderer(ea));this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}runTask(ea){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,ea=this._isRootNodeVisible(),ea!==this._layerIsVisible&&(this._layerIsVisible=ea,this.notifyChange("suspended")),
this._updateLoading());else{for(ea.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&ea.run(()=>this._processIndexQueue()););this._processWorkQueue(ea);this._idleQueue.runTask(ea)}}_processIndexQueue(){const ea=this._indexQueue.shift(),ha=this._loadNodePage(ea);this._indexPagesLoading.set(ea,ha);ha.promise.then(Y=>{this._index.addPage(ea,Y,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(ea)},()=>{this._indexPagesLoading.delete(ea)});return!0}_processWorkQueue(ea){for(;!ea.done;){const ha=
this._scheduleWorkEntry();if(null==ha){ea.madeProgress();break}this._processWorkEntry(ha);ea.madeProgress()}}_scheduleWorkEntry(){let ea=this._workQueue.length;for(;ea--;){const ha=this._workQueue.shift();if(ha.remove.find(Y=>!this._renderedNodes.has(Y)))this._workQueue.push(ha);else return ha}return null}_processWorkEntry(ea){if(0===ea.load.length)for(const ha of ea.remove)this._removeFromRenderer(ha);else Promise.all(ea.load.map(ha=>{const Y=new AbortController,Z=this._memCache.pop(ha.toString());
null!=Z?this._loadingNodes.set(ha,{abortController:Y,promise:Promise.resolve(Z)}):this._loadingNodes.has(ha)||this._loadingNodes.set(ha,{abortController:Y,promise:this._loadNode(ha,Y.signal)});return this._loadingNodes.get(ha).promise})).then(ha=>{for(let Y=0;Y<ea.load.length;Y++)if(ha[Y]){const Z=this._setupRendererData(ea.load[Y],ha[Y]);this._addToRenderer(Z)}for(const Y of ea.remove)this._removeFromRenderer(Y)}).catch(()=>{}).then(()=>{for(const ha of ea.load)this._loadingNodes.delete(ha);this._updateLoading();
this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()}async _populateClassCodeCodedDomain(ea,ha){const Y=this.layer.fieldsIndex.get("CLASS_CODE");Y&&!Y.domain&&ea.includes(Y.name)&&(ea=await n.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ha})),!1!==ea.ok&&(ea=ea.value?.stats?.labels?.labels)&&Array.isArray(ea)&&(Y.domain=new A({name:"CLASS_CODE",codedValues:ea.map(Z=>
new G.CodedValue({code:Z.value,name:Z.label}))})))}async prepareFetchPopupFeatures(ea){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(ea,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise}async whenGraphicAttributes(ea,ha){const Y=this._splitGraphicsPerNode(ea),Z=this.layer.attributeStorageInfo,
ja=ha.map(ta=>N.getAttributeInfo(Z,ta)).filter(b.isSome),oa=async(ta,va)=>{const Ca=this._index.getNode(va);await n.forEach(ja,async ma=>{const wa=ma.useElevation?await this._loadElevationAttributeFromGeometry(Ca.resourceId):await this._loadAndParseAttribute(Ca,ma);if(wa)for(const Ba of ta)this._isValidPointGraphic(Ba)&&this._encodeGraphicAttribute(ma,wa,Ba.pointCloudMetadata.attributePointIndexInNode,Ba.attributes)})},qa=[];Y.forEach((ta,va)=>{qa.push(oa(ta,va))});await Promise.allSettled(qa);return ea}_isValidPointGraphic(ea){return ea instanceof
R.PointGraphic&&ea.pointCloudMetadata?.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(ea){const ha=new Map;for(const Y of ea){if(!this._isValidPointGraphic(Y))continue;ea=Y.pointCloudMetadata;const Z=ha.get(ea.nodeId);Z?Z.push(Y):ha.set(ea.nodeId,[Y])}return ha}async _loadAndParseAttribute(ea,ha){const Y=await this._loadAttribute(ea.resourceId,ha,null);return null!=Y?P.getAttributeValues({attributeInfo:ha,buffer:Y},null,ea.vertexCount):null}async _loadElevationAttributeFromGeometry(ea){ea=P.readGeometry(this.layer.store.defaultGeometrySchema,
await this._loadGeometry(ea,null));return P.elevationFromPositions(ea,ea.length/3)}highlight(ea){if(!ea)return k.makeHandle();ea=h.isCollection(ea)?ea.toArray():Array.isArray(ea)?ea:[ea];return this._renderer.highlight(ea.map(ha=>this._graphicToPointDefinition(ha)))}_graphicToPointDefinition(ea){if(!this._isValidPointGraphic(ea))return null;const {nodeId:ha,pointIndexInNode:Y}=ea.pointCloudMetadata;return null!=ha&&null!=Y?{nodeId:ha,pointId:Y}:null}_computeWork(){let ea=0;for(const ha of this._workQueue)ea+=
ha.load.length+ha.remove.length;ea+=this._loadingNodes.size;ea+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;ea+=this._loadingInitNodePage?100:0;return ea+=this._updateViewNeeded?100:0}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const ea=this._computeWork();return 1-Math.min(this._totalWork,ea)/this._totalWork}_updateLoading(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")}canResume(){return super.canResume()&&
this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:0<this._computeWork()}_initNodePages(){const ea=this.layer.store.index;this._index=new S.PagedNodeIndex(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,ea.nodesPerPage||ea.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=
null!=ea.nodesPerPage?1:ea.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ha=>{this._index.addPage(0,ha,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})}_loadNodePage(ea){const ha=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${ea*this._pageMultiplier}`,ha.signal).then(Y=>Y.nodes.map((Z,ja)=>({resourceId:null!=Z.resourceId?Z.resourceId:ea*this._index.pageSize+ja,obb:W.Obb.fromJSON(Z.obb),obbInRenderSR:new W.Obb,firstChild:Z.firstChild,
childCount:Z.childCount,vertexCount:Z.vertexCount??Z.pointCount,lodThreshold:Z.lodThreshold??Z.effectiveArea}))),abortController:ha}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;var ea=this.view.quality;let ha=this.inverseDensity/this._lodFactor*ea;ea*=this.maximumPointCount*this._lodFactor;let Y=this._computeNodesForMinimumDensity(ha),Z=this._computePointCount(Y),ja=Math.sqrt(Z/(.75*ea));for(;Z>ea;)ha*=ja,Y=this._computeNodesForMinimumDensity(ha),Z=this._computePointCount(Y),ja=Math.sqrt(2);
this._displayNodes(Y);this._updateViewNeeded=!1;this._updateLoading();return!0}_computePointCount(ea){let ha=0;for(let Y=0;Y<ea.length;Y++){const Z=this._index.getNode(ea[Y]);Z&&(ha+=Z.vertexCount)}return ha}_isRootNodeVisible(){let ea=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ha,Y,Z)=>{ea=Z;return!1},pageMiss:()=>{}});return ea}_computeNodesForMinimumDensity(ea){const ha=this.view.state.contentCamera,Y=ha.frustum,Z=this._clippingBox,
ja=ha.viewForward,oa=p.dot(ja,ha.eye),qa=y.fromNormalAndOffset(ja,-oa,da),ta=ha.perScreenPixelRatio/2,va=ea*ea,Ca=this._nodeIdArray;Ca.length=0;const {minScale:ma,maxScale:wa}=ba.extractSafeScaleBounds(this.layer),Ba=0===ma&&0===wa?pa=>Ca.push(pa):pa=>{const Aa=this._getScale(pa);ba.scaleBoundsPredicate(Aa,ma,wa)&&Ca.push(pa)};this._traverseVisible({frustum:Y,clippingBox:Z},{predicate:(pa,Aa,ra)=>{if(!ra)return!1;if(0===Aa.childCount)return Ba(pa),!1;ra=this._index.getRenderObb(pa);return this._computeAveragePixelArea(ra,
Aa.lodThreshold,Aa.vertexCount,qa,ta)<=va?(Ba(pa),!1):!0},pageMiss:(pa,Aa)=>{Ba(pa);this._indexQueue.includes(Aa)||this._indexQueue.push(Aa)}});return Ca}_getScale(ea){var ha=this._nodeScales.get(ea);null==ha&&(ha=this._index.getNode(ea).obb.center,this._tmpPoint.x=ha[0],this._tmpPoint.y=ha[1],this._tmpPoint.z=ha[2],ha=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(ea,ha));return ha}_computeAveragePixelArea(ea,ha,Y,Z,ja){ea=Math.max(1E-7,ea.minimumDistancePlane(Z));return ha/
(ea*ea)/(4*ja*ja)/Y}_loadNode(ea,ha){try{return this._loadNodeAsync(ea,ha)}catch(Y){throw e.isAbortError(Y)||m.getLogger(this).error(Y),Y;}}async _loadAdditionalUserAttributes(ea,ha,Y){var Z=this.layer.outFields;if(!Z)return[];Z=H.unpackFieldNames(this.layer.fieldsIndex,Z);ea=new Set(ea.map(qa=>null!=qa?qa.name:null));const ja=this.layer.attributeStorageInfo,oa=[];for(const qa of Z)ea.has(qa)||(Z=N.getAttributeInfo(ja,qa))&&oa.push(ha(Z));ha=await e.allSettledValues(oa);e.throwIfAborted(Y);return ha.filter(b.isSome)}async _loadNodeAsync(ea,
ha){const Y=this._index.getNode(ea),Z=N.getRendererInfo(this.layer),ja=N.getFilterInfo(this.layer),oa=Y.resourceId,qa=async ta=>{if(!ta)return null;if(ta.useElevation)return{attributeInfo:ta,buffer:null};const va=await this._loadAttribute(oa,ta,ha);return null!=va?{attributeInfo:ta,buffer:va}:null};return this._idleQueue.push(async()=>{var ta=this._loadGeometry(oa,ha);const {primaryAttribute:va,modulationAttribute:Ca}=Z,ma=qa(va),wa=qa(Ca);var Ba=ja.map(Ma=>Ma.attributeInfo);const pa=Ba.map(Ma=>qa(Ma));
Ba=this._loadAdditionalUserAttributes([va,Ca,...Ba],qa,ha);const [Aa,ra,ua,Ea,Ka]=await Promise.all([ta,ma,wa,Promise.all(pa),Ba]);e.throwIfAborted(ha);ta={geometryBuffer:Aa,primaryAttributeData:ra,modulationAttributeData:ua,filterAttributesData:Ea,userAttributesData:Ka,schema:this.layer.store.defaultGeometrySchema,rendererInfo:Z,filterInfo:ja,obbData:this._index.getRenderObb(ea).data,elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};
return this._worker.invoke(ta,ha)},ha)}async _loadGeometry(ea,ha){return this._requestData(`${this.baseUrl}/nodes/${ea}/geometries/0`,ha)}async _loadAttribute(ea,ha,Y){return ha?.storageInfo?this._requestData(`${this.baseUrl}/nodes/${ea}/attributes/${ha.storageInfo.key}`,Y):null}_requestNodePage(ea,ha){return this._indexRequester.request(ea,"json",{query:{f:"json",...this.layer.customParameters,token:this.layer.apiKey},signal:ha})}_requestData(ea,ha){return this._dataRequester.request(ea,"binary",
{query:{...this.layer.customParameters,token:this.layer.apiKey},signal:ha})}_removeFromRenderer(ea){if(this._renderedNodes.has(ea)){const ha=this._renderer.removeNode(ea);this._renderedNodes.delete(ea);this._nodeScales.delete(ea);this._memCache.put(ha.id.toString(),ha,5*ha.coordinates.length+128)}}_addToRenderer(ea){this._renderedNodes.has(ea.id)||(this._renderedNodes.add(ea.id),this._renderer.addNode(ea))}_setupRendererData(ea,ha){const Y=this._index.getNode(ea),Z=Math.sqrt(Y.lodThreshold/Y.vertexCount),
ja=this._index.getRenderObb(ea);if(O.isPointRendererNode(ha))return ha.splatSize=Z,ha.obb=ja,p.copy(ha.origin,ha.obb.center),ha;const oa=W.Obb.fromData(ha.obbData),qa=oa.halfSize,ta=ja.halfSize,va=.01*Math.max(ta[0],ta[1],ta[2]);if(qa[0]>ta[0]+va||qa[1]>ta[1]+va||qa[2]>ta[2]+va)0<this._maxLoggedBoxWarnings&&(m.getLogger(this).warn(`Node ${ea} reported bounding box too small. got ${`[${ja.halfSize[0]}, ${ja.halfSize[1]}, ${ja.halfSize[2]}]`} but points cover ${`[${oa.halfSize[0]}, ${oa.halfSize[1]}, ${oa.halfSize[2]}]`}`),
0===--this._maxLoggedBoxWarnings&&m.getLogger(this).warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(ea,oa);return new O.PointRendererNode(ea,Z,t.clone(ja.center),ja,0===Y.childCount,ha.points,ha.rgb,ha.attributes,ha.pointIdFilterMap)}get usedMemory(){let ea=0;this._renderer.forEachNode(ha=>{ea+=160;ea+=l.estimateSize(ha.coordinates);for(const Y of ha.attributes)ha=Y.values,l.isArrayBuffer(ha.buffer)&&(ea+=l.estimateSize(ha))});return ea}get unloadedMemory(){const ea=
this._renderedNodes.size;if(4>ea)return 0;const ha=[...this._renderedNodes].reduce((Z,ja)=>Z+this._index.getNode(ja).vertexCount);let Y=this._loadingNodes.size;for(let Z=0;Z<this._workQueue.length;Z++)Y+=this._workQueue[Z].load.length,Y-=this._workQueue[Z].remove.length;return 0>Y?0:Y*ha/ea*((this.usedMemory-160*ea)/ha)+160*Y}get performanceInfo(){return new K.PointCloudLayerViewPerformanceInfo(this.usedMemory,this._renderedNodes.size,[...this._renderedNodes].reduce((ea,ha)=>ea+this._index.getNode(ha).vertexCount,
0),this.maximumPointCount,new K.QueuePerformanceInfo(this._loadingNodes.size,this._indexQueue.length,this._workQueue.length,this._idleQueue.length))}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};a.__decorate([r.property()],x.prototype,"layer",void 0);a.__decorate([r.property()],x.prototype,"baseUrl",null);a.__decorate([r.property()],x.prototype,"pointScale",null);a.__decorate([r.property()],x.prototype,"useRealWorldSymbolSizes",null);a.__decorate([r.property()],x.prototype,
"pointSize",null);a.__decorate([r.property()],x.prototype,"inverseDensity",null);a.__decorate([r.property()],x.prototype,"maximumPointCount",void 0);a.__decorate([r.property({readOnly:!0})],x.prototype,"availableFields",null);a.__decorate([r.property({readOnly:!0})],x.prototype,"_clippingBox",null);a.__decorate([r.property({readOnly:!0})],x.prototype,"_elevationOffset",null);a.__decorate([r.property({type:Boolean})],x.prototype,"slicePlaneEnabled",void 0);a.__decorate([r.property()],x.prototype,"updating",
void 0);a.__decorate([r.property(ca.updatingProgress)],x.prototype,"updatingProgress",void 0);a.__decorate([r.property({readOnly:!0})],x.prototype,"updatingProgressValue",null);a=x=a.__decorate([w.subclass("esri.views.3d.layers.PointCloudLayerView3D")],x);const aa=v.create();return a})},"esri/views/3d/layers/PointCloudLayerViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(k,m,g,e,d){super(k,
m,-1,g,e);this.queue=d}}class h{constructor(k,m,g,e){this.loading=k;this.indexLoading=m;this.processing=g;this.idleProcessing=e}}a.PointCloudLayerViewPerformanceInfo=n;a.QueuePerformanceInfo=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(h){super("PointCloudWorker","transform",{transform:k=>this._getTransferList(k)},
h)}_getTransferList(h){const k=[h.geometryBuffer];null!=h.primaryAttributeData&&h.primaryAttributeData.buffer&&k.push(h.primaryAttributeData.buffer);null!=h.modulationAttributeData&&h.modulationAttributeData.buffer&&k.push(h.modulationAttributeData.buffer);if(null!=h.filterAttributesData)for(const m of h.filterAttributesData)null!=m&&m.buffer&&k.push(m.buffer);for(const m of h.userAttributesData)m.buffer&&k.push(m.buffer);return k}}a.PointCloudWorkerHandle=n;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec32"],function(a,b){function n(d,c,l){for(;0<d;){const f=c.indexOf(d);if(0<=f)return f;d=l.getParentId(d)}return c.indexOf(d)}function h(d,c,l){const f=[c.remove[0]],r=[];for(;1===f.length;){const w=f.pop();r.length=0;for(let p=0;p<c.load.length;p++){let t=c.load[p];for(var x=l.getParentId(t);x!==w;)t=x,x=l.getParentId(t);x=f.indexOf(t);0>x&&(x=f.length,f.push(t),r.push([]));r[x].push(c.load[p])}}c.load=
f;for(c=0;c<f.length;c++)1<r[c].length?d.push({remove:[f[c]],load:r[c]}):f[c]=r[c][0]}const k=[!1],m=[null],g=[!1],e=[null];a.nodeDiff=function(d,c,l){for(var f=0;f<c.length;f++)g[f]=!1,e[f]=null;for(f=0;f<d.length;f++)k[f]=!1,m[f]=null;for(f=0;f<c.length;f++){var r=n(c[f],d,l);0<=r&&(g[f]=!0,null!=m[r]?m[r].push(c[f]):m[r]=[c[f]])}for(f=0;f<d.length;f++)r=n(d[f],c,l),0<=r&&(k[f]=!0,null!=e[r]?e[r].push(d[f]):e[r]=[d[f]]);l=[];for(f=0;f<d.length;f++)null!=m[f]||k[f]||l.push({load:[],remove:[d[f]]});
for(f=0;f<c.length;f++)null!=e[f]||g[f]||l.push({load:[c[f]],remove:[]});for(f=0;f<c.length;f++)null!=e[f]&&(1<e[f].length||e[f][0]!==c[f])&&l.push({load:[c[f]],remove:e[f]});for(c=0;c<d.length;c++)null!=m[c]&&(1<m[c].length||m[c][0]!==d[c])&&l.push({load:m[c],remove:[d[c]]});return l};a.sortFrontToBack=function(d,c,l){return d.sort((f,r)=>{if(0===f.load.length&&0===r.load.length)return 0;if(0===f.load.length)return-1;if(0===r.load.length)return 1;if(0===f.remove.length&&0===r.remove.length)return f=
l.getRenderObb(f.load[0]).center,r=l.getRenderObb(r.load[0]).center,b.dot(f,c)-b.dot(r,c);if(0===f.remove.length)return-1;if(0===r.remove.length)return 1;if(1===f.load.length&&1===r.load.length)return f=l.getRenderObb(f.load[0]).center,r=l.getRenderObb(r.load[0]).center,b.dot(f,c)-b.dot(r,c);if(1===f.load.length)return-1;if(1===r.load.length)return 1;f=l.getRenderObb(f.remove[0]).center;r=l.getRenderObb(r.remove[0]).center;return b.dot(f,c)-b.dot(r,c)})};a.splitWorkEntries=function(d,c,l){for(let f=
0;f<d.length;++f){const r=d[f];r.load.length>c&&1===r.remove.length&&h(d,r,l)}};a.splitWorkEntry=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["exports","../../../../geometry/spatialReferenceEllipsoidUtils","../../../../geometry/support/aaBoundingBox"],function(a,b,n){class h{constructor(k,m,g){this._pages=[];this.pageSize=0;this._nodeSR=k;this._renderSR=m;this._renderSRSphericalPCPF=b.getSphericalPCPF(m);this.pageSize=
g}addPage(k,m,g=0){for(;this._pages.length<k;)this._pages.push(null);var e=this._nodeSR,d=this._renderSR,c=this._renderSRSphericalPCPF;for(var l=0;l<m.length;l++){const f=m[l];f.obb.transform(f.obbInRenderSR,e,d,g,c)}this._pages[k]={nodes:m,parents:new Uint32Array(this.pageSize)};k=this._pages;m=this.pageSize;for(g=[0];g.length;)for(e=g.pop(),d=k[e/m|0].nodes[e%m],c=0;c<d.childCount;c++)l=d.firstChild+c,null!=k[l/m|0]&&(k[l/m|0].parents[l%m]=e,g.push(l))}hasPage(k){return!!this._pages[k]}getNode(k){const m=
this.pageSize;return this._pages[k/m|0].nodes[k%m]}getRenderObb(k){const m=this.pageSize;return this._pages[k/m|0].nodes[k%m].obbInRenderSR}setRenderObb(k,m){const g=this.pageSize;this._pages[k/g|0].nodes[k%g].obbInRenderSR.copy(m)}getParentId(k){const m=this.pageSize;return this._pages[k/m|0].parents[k%m]}hasNodes(k,m){var g=k/this.pageSize|0;for(k=(k+m-1)/this.pageSize|0;g<=k;g++)if(null==this._pages[g])return!1;return!0}forEachNodeId(k){for(let m=0;m<this._pages.length;m++){const g=this._pages[m];
if(g)for(let e=0;e<g.nodes.length;e++)k(m*this.pageSize+e)}}createVisibilityTraverse(){var k=this,m=[],g=[],e=n.create();return(d,c)=>{if(k.hasNodes(0,1))for(m.length=0,m.push(0),g.length=0,g.push(0);0<m.length;){var l=m.pop();let t=g.pop();var f=k.getNode(l),r=k.getRenderObb(l),x=!0;if(null!=d.clippingBox){var w=1<<d.frustum.length;0===(t&w)&&(r.toAaBoundingBox(e),n.contains(d.clippingBox,e)?t|=w:n.intersects(d.clippingBox,e)||(x=!1))}for(w=0;w<d.frustum.length&&x;w++){var p=1<<w;if(0===(t&p)){const q=
r.intersectPlane(d.frustum[w]);0<q?x=!1:0>q&&(t|=p)}}if(c.predicate(l,f,x)){r=f.firstChild;f=f.childCount;x=!1;p=r/k.pageSize|0;for(w=(r+f-1)/k.pageSize|0;p<=w;p++)if(!k.hasPage(p)){c.pageMiss(l,p);x=!0;break}if(!x)for(l=0;l<f;l++)m.push(r+l),g.push(t)}}}}}a.PagedNodeIndex=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(h,k){for(const m of h??[])if(m.name===k&&null!=m.attributeValues&&
"UInt8"===m.attributeValues.valueType&&3===m.attributeValues.valuesPerElement)return{name:k,storageInfo:m,useElevation:!1};return null}function n(h,k){for(const m of h??[])if(m.name===k)return(h="embedded-elevation"===m.encoding)?{name:k,storageInfo:null,useElevation:h}:{name:k,storageInfo:m,useElevation:h};return"elevation"===k?.toLowerCase()?{name:k,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=n;a.getFilterInfo=function(h){const k=h.filters;return k?k.map(m=>({filterJSON:m.toJSON(),
attributeInfo:n(h.attributeStorageInfo,m.field)})):[]};a.getFixedSizeAlgorithm=function(h){return(h=h?.pointSizeAlgorithm)&&"fixed-size"===h.type?h:null};a.getRendererInfo=function(h){const k=h.renderer;var m=k?.type;const g=k?.toJSON()??null;let e=null,d=!1;h=h.attributeStorageInfo;"point-cloud-unique-value"===m?e=n(h,k.field):"point-cloud-stretch"===m?e=n(h,k.field):"point-cloud-class-breaks"===m?e=n(h,k.field):(e="point-cloud-rgb"===m?b(h,k.field):b(h,"RGB"),d=null!=e);m=null;k?.colorModulation&&
(m=n(h,k.colorModulation.field));return{rendererJSON:g,isRGBRenderer:d,primaryAttribute:e,modulationAttribute:m}};a.getSplatSizeAlgorithm=function(h){return(h=h?.pointSizeAlgorithm)&&"splat"===h.type?h:null};a.rendererUsesFixedSizes=function(h){h=h?.pointSizeAlgorithm;return h?.type?"fixed-size"===h.type:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/has ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,n,h,k,m,g){function e(l,f){const r=new Float64Array(f);for(let x=0;x<f;x++)r[x]=l[3*x+2];return r}function d(l){switch(l){default:case null:case "none":return f=>f;case "low-four-bit":return f=>f&15;case "high-four-bit":return f=>(f&240)>>4;case "absolute-value":return f=>Math.abs(f);case "modulo-ten":return f=>f%10}}function c(l){let f=0;for(const r of l||[])f|=1<<r;return f}a.elevationFromPositions=e;a.evaluateRenderer=function(l,f,r,x){const {rendererJSON:w,isRGBRenderer:p}=l;var t=
l=null;if(f&&p)l=f;else if(f&&"pointCloudUniqueValueRenderer"===w?.type){t=k.fromJSON(w);var q=t.colorUniqueValueInfos;l=new Uint8Array(3*x);var u=d(t.fieldTransformType);for(var v=0;v<x;v++){var y=(u?u(f[v]):f[v])+"";for(var D=0;D<q.length;D++)if(q[D].values.includes(y)){l[3*v]=q[D].color.r;l[3*v+1]=q[D].color.g;l[3*v+2]=q[D].color.b;break}}}else if(f&&"pointCloudStretchRenderer"===w?.type)for(t=h.fromJSON(w),q=t.stops,l=new Uint8Array(3*x),u=d(t.fieldTransformType),v=0;v<x;v++)if(y=u?u(f[v]):f[v],
D=q.length-1,y<q[0].value)l[3*v]=q[0].color.r,l[3*v+1]=q[0].color.g,l[3*v+2]=q[0].color.b;else if(y>=q[D].value)l[3*v]=q[D].color.r,l[3*v+1]=q[D].color.g,l[3*v+2]=q[D].color.b;else for(D=1;D<q.length;D++){if(y<q[D].value){y=(y-q[D-1].value)/(q[D].value-q[D-1].value);l[3*v]=q[D].color.r*y+q[D-1].color.r*(1-y);l[3*v+1]=q[D].color.g*y+q[D-1].color.g*(1-y);l[3*v+2]=q[D].color.b*y+q[D-1].color.b*(1-y);break}}else if(f&&"pointCloudClassBreaksRenderer"===w?.type)for(t=n.fromJSON(w),q=t.colorClassBreakInfos,
l=new Uint8Array(3*x),u=d(t.fieldTransformType),v=0;v<x;v++)for(y=u?u(f[v]):f[v],D=0;D<q.length;D++){if(y>=q[D].minValue&&y<=q[D].maxValue){l[3*v]=q[D].color.r;l[3*v+1]=q[D].color.g;l[3*v+2]=q[D].color.b;break}}else l=(new Uint8Array(3*x)).fill(255);if(r&&t?.colorModulation)for(f=t.colorModulation.minValue,t=t.colorModulation.maxValue,q=0;q<x;q++)u=r[q],u=u>=t?1:u<=f?.3:.3+.7*(u-f)/(t-f),l[3*q]*=u,l[3*q+1]*=u,l[3*q+2]*=u;return l};a.filterInPlace=function(l,f,r,x,w){const p=l.length/3;let t=0;for(let G=
0;G<p;G++){let A=!0;for(let C=0;C<x.length&&A;C++){var {filterJSON:q}=x[C],u=w[C].values[G];switch(q.type){case "pointCloudValueFilter":var v="exclude"===q.mode;q.values.includes(u)===v&&(A=!1);break;case "pointCloudBitfieldFilter":v=c(q.requiredSetBits);q=c(q.requiredClearBits);if((u&v)!==v||0!==(u&q))A=!1;break;case "pointCloudReturnFilter":var y=u&15,D=u>>>4&15;u=1<D;v=1===y;y=y===D;D=!1;for(const E of q.includedReturns)if("last"===E&&y||"firstOfMany"===E&&v&&u||"lastOfMany"===E&&y&&u||"single"===
E&&!u){D=!0;break}D||(A=!1)}}A&&(r[t]=G,l[3*t]=l[3*G],l[3*t+1]=l[3*G+1],l[3*t+2]=l[3*G+2],f[3*t]=f[3*G],f[3*t+1]=f[3*G+1],f[3*t+2]=f[3*G+2],t++)}return t};a.getAttributeValues=function(l,f,r){return l?.attributeInfo.useElevation?f?e(f,r):null:l?.attributeInfo.storageInfo?m.readBinaryAttribute(l.attributeInfo.storageInfo,l.buffer,r):null};a.readGeometry=function(l,f){if(null==l.encoding||""===l.encoding){l=m.createGeometryIndexFromSchema(f,l);if(null==l.vertexAttributes.position)return;f=m.createTypedView(f,
l.vertexAttributes.position);var r=l.header.fields;l=[r.offsetX,r.offsetY,r.offsetZ];r=[r.scaleX,r.scaleY,r.scaleZ];const x=f.length/3,w=new Float64Array(3*x);for(let p=0;p<x;p++)w[3*p]=f[3*p]*r[0]+l[0],w[3*p+1]=f[3*p+1]*r[1]+l[1],w[3*p+2]=f[3*p+2]*r[2]+l[2];return w}if("lepcc-xyz"===l.encoding)return g.decodeXYZ(f).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,n,h,k,m,g,e,d,c){var l;h=l=class extends e{constructor(f){super(f);this.type="point-cloud-class-breaks";this.colorClassBreakInfos=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new l({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
h.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},type:String})],h.prototype,"field",void 0);a.__decorate([n.property({type:d.LegendOptions,json:{write:!0}})],h.prototype,"legendOptions",void 0);a.__decorate([n.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[c],json:{write:!0}})],
h.prototype,"colorClassBreakInfos",void 0);return h=l=a.__decorate([g.subclass("esri.renderers.PointCloudClassBreaksRenderer")],h)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(a,b,n,h,k,m,g,e,d,c){m=
b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=class extends n.JSONSupport{constructor(l){super(l);this.type=void 0;this.colorModulation=this.pointSizeAlgorithm=null;this.pointsPerInch=10}clone(){console.warn(".clone() is not implemented for "+this.declaredClass);return null}cloneProperties(){return{pointSizeAlgorithm:h.clone(this.pointSizeAlgorithm),
colorModulation:h.clone(this.colorModulation),pointsPerInch:h.clone(this.pointsPerInch)}}};a.__decorate([k.property({type:m.apiValues,readOnly:!0,nonNullable:!0,json:{type:m.jsonValues,read:!1,write:m.write}})],n.prototype,"type",void 0);a.__decorate([k.property({types:c.pointSizeAlgorithmTypes,json:{write:!0}})],n.prototype,"pointSizeAlgorithm",void 0);a.__decorate([k.property({type:d,json:{write:!0}})],n.prototype,"colorModulation",void 0);a.__decorate([k.property({json:{write:!0},nonNullable:!0,
type:Number})],n.prototype,"pointsPerInch",void 0);n=a.__decorate([e.subclass("esri.renderers.PointCloudRenderer")],n);(n||={}).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){var e;b=e=class extends b.JSONSupport{constructor(){super(...arguments);this.field=null;this.minValue=0;this.maxValue=255}clone(){return new e({field:this.field,minValue:this.minValue,maxValue:this.maxValue})}};a.__decorate([n.property({type:String,json:{write:!0}})],b.prototype,"field",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"minValue",void 0);a.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,
"maxValue",void 0);return b=e=a.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorModulation")],b)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,n,h){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":n,splat:h}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){b=new b.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=class extends n.JSONSupport{};a.__decorate([h.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],n.prototype,"type",void 0);return n=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],n)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,n,h,k,m,g,e){var d;n=d=class extends e{constructor(){super(...arguments);this.type="fixed-size";this.size=0;this.useRealWorldSymbolSizes=null}clone(){return new d({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})}};a.__decorate([m.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],n.prototype,"type",void 0);a.__decorate([b.property({type:Number,nonNullable:!0,json:{write:!0}})],n.prototype,"size",void 0);a.__decorate([b.property({type:Boolean,json:{write:!0}})],
n.prototype,"useRealWorldSymbolSizes",void 0);return n=d=a.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],n)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,n,h,k,m,g,e){var d;n=d=class extends e{constructor(){super(...arguments);this.type="splat";this.scaleFactor=1}clone(){return new d({scaleFactor:this.scaleFactor})}};a.__decorate([m.enumeration({pointCloudSplatAlgorithm:"splat"})],n.prototype,"type",void 0);a.__decorate([b.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],n.prototype,"scaleFactor",void 0);return n=d=a.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],n)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){var e;n=e=class extends n.JSONSupport{constructor(){super(...arguments);this.label=this.description=null;this.maxValue=this.minValue=0;this.color=null}clone(){return new e({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:h.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"label",void 0);a.__decorate([k.property({type:Number,
json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],n.prototype,"minValue",void 0);a.__decorate([k.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],n.prototype,"maxValue",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],n.prototype,"color",void 0);return n=e=a.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],n)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,n,h,k,m,g,e,d,c){var l;h=l=class extends e{constructor(f){super(f);this.type="point-cloud-stretch";this.stops=this.fieldTransformType=this.legendOptions=this.field=null}clone(){return new l({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],h.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},
type:String})],h.prototype,"field",void 0);a.__decorate([n.property({type:d.LegendOptions,json:{write:!0}})],h.prototype,"legendOptions",void 0);a.__decorate([n.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[c],json:{write:!0}})],h.prototype,"stops",void 0);return h=l=a.__decorate([g.subclass("esri.renderers.PointCloudStretchRenderer")],
h)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/has ../core/Logger ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),function(a,b,n,h,k,m,g,e,d,c){var l;h=l=class extends e{constructor(f){super(f);this.type="point-cloud-unique-value";this.legendOptions=
this.colorUniqueValueInfos=this.fieldTransformType=this.field=null}clone(){return new l({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})}};a.__decorate([m.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],h.prototype,"type",void 0);a.__decorate([n.property({json:{write:!0},type:String})],h.prototype,"field",void 0);a.__decorate([n.property({type:e.fieldTransformTypeKebabDict.apiValues,
json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);a.__decorate([n.property({type:[c],json:{write:!0}})],h.prototype,"colorUniqueValueInfos",void 0);a.__decorate([n.property({type:d.LegendOptions,json:{write:!0}})],h.prototype,"legendOptions",void 0);return h=l=a.__decorate([g.subclass("esri.renderers.PointCloudUniqueValueRenderer")],h)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g){var e;n=e=class extends n.JSONSupport{constructor(){super(...arguments);this.color=this.values=this.label=this.description=null}clone(){return new e({description:this.description,label:this.label,values:h.clone(this.values),color:h.clone(this.color)})}};a.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"description",void 0);a.__decorate([k.property({type:String,json:{write:!0}})],n.prototype,"label",void 0);a.__decorate([k.property({type:[String],json:{write:!0}})],
n.prototype,"values",void 0);a.__decorate([k.property({type:b,json:{type:[m.Integer],write:!0}})],n.prototype,"color",void 0);return n=e=a.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],n)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,n,h,k,m,g,e){a.PointGraphic=class extends n{constructor(d){super(d);this.pointCloudMetadata=null}};b.__decorate([h.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=b.__decorate([e.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/effects/RenderPlugin ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderSlot ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){function K(O,T,Q,V,U){if(Q.drawScreenSpace)return Q.fixedSize*T*V;U=E.getMaxPointSizeScreenspace(U)*T*V;return Q.useFixedSizes?Math.min(Q.fixedSize/2,U):0<Q.screenMinSize?Math.min(Math.max(Q.screenMinSize*T*V,O/2),U):Math.min(O/2,U)}function L(O,T,Q,V,U){return Q.drawScreenSpace?0:K(O,T,Q,V,U)}function F(O){return null!=O.component?O.component:-1}function M(O,T){if(null==O)return O;O=O.filter(Q=>Q.id!==T);return 0===O.length?
null:O}function S(O){return null!=O.dist&&null!=O.point&&null!=O.pointId&&null!=O.node}const N={positions:[new z.VertexElementDescriptor(C.VertexAttribute.POSITION,3,B.DataType.FLOAT,0,12)],colors:[new z.VertexElementDescriptor(C.VertexAttribute.COLOR,3,B.DataType.UNSIGNED_BYTE,0,3,!0)]};a.PointRenderer=class extends u.SyncPrepareRenderPlugin{constructor(O){super(O);this.type=D.IntersectorType.PCL;this.isGround=!1;this._passParameters=new E.PointRendererPassParameters;this._highlights=new t.PointHighlights({forEachNode:T=>
this.forEachNode(T),addHighlight:(T,Q,V)=>this._addHighlight(T,Q,V),removeHighlight:(T,Q)=>this._removeHighlight(T,Q)});this.produces=new Map([[G.RenderSlot.OPAQUE_MATERIAL,T=>T!==q.ShaderOutput.LinearDepth&&(T!==q.ShaderOutput.Highlight||!this._highlights.empty)],[G.RenderSlot.OPAQUE_NO_SSAO_DEPTH,T=>T===q.ShaderOutput.LinearDepth]]);this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new H.PointRendererTechniqueConfiguration;this._nodes=new h}initializeRenderContext(O){this._context=
O;O.requestRender()}uninitializeRenderContext(){}intersect(O,T,Q,V){const U=l.create(),W=l.create(),ca=l.create(),X=l.create(),ba=x.create(),ia=O.camera.perScreenPixelRatio/2,fa=O.camera.near;c.subtract(W,V,Q);const da=1/c.length(W);c.scale(W,W,da);c.negate(ca,W);f.set(ba,W[0],W[1],W[2],-c.dot(W,Q));const aa=new R,ea=new R,ha=[],Y=r.create(),Z=r.create(this._passParameters.clipBox);r.offset(Z,-Q[0],-Q[1],-Q[2],Z);this._nodes.forAll(ta=>{const va=ta.splatSize*this._passParameters.scaleFactor;var Ca=
ta.obb.minimumDistancePlane(ba),ma=ta.obb.maximumDistancePlane(ba);Ca-=L(va,Ca+fa,this._passParameters,ia,ta.isLeaf);ma-=L(va,ma+fa,this._passParameters,ia,ta.isLeaf);Ca=null!=aa.dist&&null!=ea.dist&&aa.dist<Ca*da&&ea.dist>ma*da;if(!(0>ma||Ca)&&(ma=K(va,ma+fa,this._passParameters,ia,ta.isLeaf),ta.obb.intersectRay(Q,W,ma))){ma*=ma;ta.obb.toAaBoundingBox(Y);r.offset(Y,-Q[0],-Q[1],-Q[2],Y);Ca=!r.contains(Z,Y);c.subtract(X,ta.origin,Q);var wa=ta.coordinates.length/3;for(let ra=0;ra<wa;ra++){U[0]=X[0]+
ta.coordinates[3*ra];U[1]=X[1]+ta.coordinates[3*ra+1];U[2]=X[2]+ta.coordinates[3*ra+2];if(Ca&&!r.containsPoint(Z,U))continue;var Ba=c.dot(U,W),pa=c.squaredLength(U)-Ba*Ba;if(pa>ma)continue;var Aa=Ba+fa;const ua=L(va,Aa,this._passParameters,ia,ta.isLeaf);if(0>Ba-ua)continue;Aa-=ua;Aa=K(va,Aa,this._passParameters,ia,ta.isLeaf);if(pa>Aa*Aa)continue;const Ea=(Ba-ua)*da;Ba=Ka=>{var Ma=ra,Ua=Ka.point;null==Ua&&(Ua=l.create());Ua[0]=ta.origin[0]+ta.coordinates[3*Ma];Ua[1]=ta.origin[1]+ta.coordinates[3*Ma+
1];Ua[2]=ta.origin[2]+ta.coordinates[3*Ma+2];Ka.point=Ua;Ka.dist=Ea;Ka.normal=ca;Ka.node=ta;Ka.pointId=ra;Ka.layerUid=this.layerUid;return Ka};(null==aa.dist||Ea<aa.dist)&&(null==T||T(Q,V,Ea))&&Ba(aa);O.options.store!==D.StoreResults.MIN&&(null==ea.dist||Ea>ea.dist)&&(null==T||T(Q,V,Ea))&&Ba(ea);O.options.store!==D.StoreResults.ALL||null!=T&&!T(Q,V,Ea)||(pa=new R,ha.push(Ba(pa)))}}});const ja=ta=>{const {layerUid:va,node:Ca,pointId:ma}=ta;return new p.PclTarget(ta.point,va,ma,()=>this.createGraphic(Ca,
ma,ta.point))},oa=(ta,va)=>{const Ca=ja(va);ta.set(this.type,Ca,va.dist,va.normal)};if(S(aa)){var qa=O.results.min;(null==qa.dist||aa.dist<qa.dist)&&oa(qa,aa)}S(ea)&&O.options.store!==D.StoreResults.MIN&&(qa=O.results.max,(null==qa.dist||ea.dist>qa.dist)&&oa(qa,ea));if(O.options.store===D.StoreResults.ALL){qa=w.fromPoints(Q,V);for(const ta of ha){const va=y.newIntersectorResult(qa);oa(va,ta);O.results.all.push(va)}}}prepareTechnique(O){if(0===this._nodes.length||O.output!==q.ShaderOutput.Color&&(O.output!==
q.ShaderOutput.LinearDepth||O.bindParameters.slot!==G.RenderSlot.OPAQUE_NO_SSAO_DEPTH)&&O.output!==q.ShaderOutput.Highlight)return null;this._nodes.forAll(T=>{null==T.vao&&this._initNode(O,T)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=O.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=
this._clippingEnabled;this._techniqueConfig.output=O.output;return this._context.techniqueRepository.releaseAndAcquire(I.PointRendererTechnique,this._techniqueConfig,this._technique)}renderNode(O,T){const Q=O.rctx,V=Q.bindTechnique(T,O.bindParameters,this._passParameters),U=O.output===q.ShaderOutput.Highlight;this._nodes.forAll(W=>{0===W.coordinates.length||U&&!W.highlights||(V.bindDraw(W,O.bindParameters,this._passParameters),Q.bindVAO(W.vao),U?this._renderHighlightFragments(Q,W):Q.drawArrays(B.PrimitiveType.POINTS,
0,W.coordinates.length/3))})}_renderHighlightFragments(O,T){var Q=T.highlights;if(null!=Q){T=Q[0].component;var V=T+1;for(let U=1;U<Q.length;U++){const W=Q[U].component;W!==V&&(V-=T,0<V&&O.drawArrays(B.PrimitiveType.POINTS,T,V),T=W);V=W+1}Q=V-T;0<Q&&O.drawArrays(B.PrimitiveType.POINTS,T,Q)}}set useFixedSizes(O){this._passParameters.useFixedSizes!==O&&(this._passParameters.useFixedSizes=O,this._requestRender())}get useFixedSizes(){return this._passParameters.useFixedSizes}set scaleFactor(O){this._passParameters.scaleFactor!==
O&&(this._passParameters.scaleFactor=O,this._requestRender())}get scaleFactor(){return this._passParameters.scaleFactor}set minSizePx(O){this._passParameters.minSizePx!==O&&(this._passParameters.minSizePx=O,this._requestRender())}get minSizePx(){return this._passParameters.minSizePx}set useRealWorldSymbolSizes(O){this._passParameters.useRealWorldSymbolSizes!==O&&(this._passParameters.useRealWorldSymbolSizes=O,this._requestRender())}get useRealWorldSymbolSizes(){return this._passParameters.useRealWorldSymbolSizes}set size(O){this._passParameters.size!==
O&&(this._passParameters.size=O,this._requestRender())}get size(){return this._passParameters.size}set sizePx(O){this._passParameters.sizePx!==O&&(this._passParameters.sizePx=O,this._requestRender())}get sizePx(){return this._passParameters.sizePx}set clippingBox(O){r.set(this._passParameters.clipBox,O||r.positiveInfinity)}get _clippingEnabled(){return!r.equals(this._passParameters.clipBox,r.positiveInfinity,(O,T)=>O===T)}get slicePlaneEnabled(){return this._slicePlaneEnabled}set slicePlaneEnabled(O){this._slicePlaneEnabled!==
O&&(this._slicePlaneEnabled=O,this._requestRender())}addNode(O){this._nodes.push(O);this._highlights.nodeAdded(O);this._requestRender()}removeNode(O){let T=null;this._nodes.filterInPlace(Q=>Q.id===O?(T=Q,Q.vao=n.disposeMaybe(Q.vao),this._highlights.nodeRemoved(Q),!1):!0);this._requestRender();return T}forEachNode(O){this._nodes.forAll(O)}removeAll(){this._nodes.forAll(O=>O.vao=n.disposeMaybe(O.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()}highlight(O){return this._highlights.add(O)}_addHighlight(O,
T,Q){var V=O.highlights;null==V&&(V=[]);T={component:T,id:Q};V.push(T);T=F(T);for(Q=V.length-1;0<Q&&T<F(V[Q-1]);)[V[Q-1],V[Q]]=[V[Q],V[Q-1]],--Q;O.highlights=V;this._requestRender()}_removeHighlight(O,T){O.highlights=M(O.highlights,T);this._requestRender()}_initNode(O,T){O=O.rctx;T.vao=new A.VertexArrayObject(O,v.Default3D,N,{positions:J.BufferObject.createVertex(O,B.Usage.STATIC_DRAW,T.coordinates),colors:J.BufferObject.createVertex(O,B.Usage.STATIC_DRAW,T.rgb)})}_requestRender(){this._context&&
this._context.requestRender()}};b.__decorate([k.property({constructOnly:!0})],a.PointRenderer.prototype,"createGraphic",void 0);a.PointRenderer=b.__decorate([d.subclass("esri.views.3d.layers.i3s.PointRenderer")],a.PointRenderer);class P extends E.PointRendererDrawParameters{constructor(O,T,Q,V,U,W,ca,X,ba=null,ia=null){super(Q,U,T);this.id=O;this.obb=V;this.coordinates=W;this.rgb=ca;this.attributes=X;this.pointIdFilterMap=ba;this.highlights=ia}}class R{constructor(){this.normal=this.dist=this.point=
this.pointId=this.node=null;this.layerUid=""}}a.PointRendererNode=P;a.isPointRendererNode=function(O){return O.hasOwnProperty("splatSize")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../core/handleUtils","../../webgl-engine/lib/basicInterfaces","../../webgl-engine/lib/Object3DStateID"],function(a,b,n,h){class k{constructor(g){this._context=g;this._highlights=new Set}get empty(){return 0===this._highlights.size}destroy(){this._highlights=
null}add(g){const e=new m(g);this._highlights.add(e);this._enableSet(e);return b.makeHandle(()=>this._removeSet(e))}_removeSet(g){this._disableSet(g);this._highlights.delete(g)}_enableSet(g){g.enabled||(g.enabled=!0,this._context.forEachNode(e=>this._enableSetForNode(g,e)))}_enableSetForNode(g,e){if(g.enabled){var d=g.ids.get(e.id);d&&d.forEach(c=>this._context.addHighlight(e,c,g.id))}}_disableSet(g){g.enabled&&(g.enabled=!1,this._context.forEachNode(e=>this._disableSetForNode(g,e)))}_disableSetForNode(g,
e){g.enabled||this._context.removeHighlight(e,g.id)}nodeAdded(g){this._highlights.forEach(e=>this._enableSetForNode(e,g))}nodeRemoved(g){this._highlights.forEach(e=>this._disableSetForNode(e,g))}removeAll(){this._highlights.forEach(g=>this._disableSet(g))}}class m{constructor(g){this.id=new h.Object3DStateID(n.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const e of g)null!=e&&this._add(e.nodeId,e.pointId)}_add(g,e){const d=this.ids.get(g);d?d.add(e):this.ids.set(g,new Set([e]))}}
a.PointHighlights=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../core/mathUtils ../core/libs/gl-matrix-2/math/mat4 ../core/libs/gl-matrix-2/factories/mat4f64 ../core/libs/gl-matrix-2/math/vec2 ../core/libs/gl-matrix-2/factories/vec2f64 ./vec32 ../core/libs/gl-matrix-2/factories/vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D){function G(B){const z=new y.ShaderBuilder,K=B.output===l.ShaderOutput.Color,L=B.output===l.ShaderOutput.LinearDepth,F=B.output===l.ShaderOutput.Highlight,{vertex:M,fragment:S}=z;z.include(f.SliceDraw,B);z.attributes.add(D.VertexAttribute.POSITION,"vec3");z.attributes.add(D.VertexAttribute.COLOR,"vec3");M.uniforms.add(new u.Matrix4DrawUniform("modelView",(N,P)=>n.multiply(I,P.camera.viewMatrix,n.fromTranslation(I,N.origin))),new v.Matrix4PassUniform("proj",
(N,P)=>P.camera.projectionMatrix),new w.Float2DrawUniform("screenMinMaxSize",(N,P,R)=>k.set(J,R.useFixedSizes?0:R.minSizePx*P.camera.pixelRatio,(N.isLeaf?256:64)*P.camera.pixelRatio)),B.useFixedSizes?new p.Float2PassUniform("pointScale",(N,P)=>k.set(J,N.fixedSize*P.camera.pixelRatio,P.camera.fullHeight)):new w.Float2DrawUniform("pointScale",(N,P,R)=>k.set(J,N.splatSize*R.scaleFactor*P.camera.pixelRatio,P.camera.fullHeight/P.camera.pixelRatio)));B.clippingEnabled?M.uniforms.add(new t.Float3DrawUniform("clipMin",
(N,P,R)=>g.set(H,R.clipBox[0]-N.origin[0],R.clipBox[1]-N.origin[1],R.clipBox[2]-N.origin[2])),new t.Float3DrawUniform("clipMax",(N,P,R)=>g.set(H,R.clipBox[3]-N.origin[0],R.clipBox[4]-N.origin[1],R.clipBox[5]-N.origin[2]))):(M.constants.add("clipMin","vec3",[-b.numberMaxFloat32,-b.numberMaxFloat32,-b.numberMaxFloat32]),M.constants.add("clipMax","vec3",[b.numberMaxFloat32,b.numberMaxFloat32,b.numberMaxFloat32]));L?(c.addNearFar(z),c.addCalculateLinearDepth(z),z.varyings.add("depth","float")):B.output!==
l.ShaderOutput.Highlight&&z.varyings.add("vColor","vec3");M.code.add(q.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${B.drawScreenSize?q.glsl`
      float clampedScreenSize = pointSize;`:q.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${L?q.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${K?q.glsl`vColor = color;`:""}
    }
  `);S.include(x.RgbaFloatEncoding,B);F&&z.include(r.OutputHighlight,B);S.code.add(q.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${L?q.glsl`fragColor = float2rgba(depth);`:""}
      ${F?q.glsl`outputHighlight();`:""}
      ${K?q.glsl`fragColor = vec4(vColor, 1.0);`:""}
    }
  `);return z}function A(B){return B?256:64}class C extends q.NoParameters{constructor(){super(...arguments);this.clipBox=d.create(d.positiveInfinity);this.useRealWorldSymbolSizes=this.useFixedSizes=!1;this.scaleFactor=1;this.sizePx=this.size=this.minSizePx=0}get fixedSize(){return this.drawScreenSpace?this.sizePx:this.size}get screenMinSize(){return this.useFixedSizes?0:this.minSizePx}get drawScreenSpace(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}class E extends f.SlicePlaneParameters{constructor(B,
z,K){super(B);this.origin=B;this.isLeaf=z;this.splatSize=K}}const I=h.create(),H=e.create(),J=m.create();h=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:E,PointRendererPassParameters:C,build:G,getMaxPointSizeScreenspace:A},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=E;a.PointRendererPassParameters=C;a.PointRendererShader=h;a.build=G;a.getMaxPointSizeScreenspace=A})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,n,h,k,m,g,e,d,c){class l extends h.ShaderTechnique{constructor(f,r,x){super(f,r,x)}initializeProgram(f){return new m.Program(f.rctx,l.shader.get().build(this.configuration),k.Default3D)}initializePipeline(){return c.makePipelineState({depthTest:{func:d.CompareFunction.LESS},depthWrite:c.defaultDepthWriteParams,colorWrite:c.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?g.stencilBaseAllZerosParams:
null})}}l.shader=new n.ReloadableShaderModule(e.PointRendererShader,()=>new Promise((f,r)=>a(["./PointRenderer.glsl"],f,r)));b.PointRendererTechnique=l;Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(a,b,n,
h,k){class m extends k.DefaultTechniqueConfiguration{constructor(){super(...arguments);this.output=n.ShaderOutput.Color;this.clippingEnabled=this.hasOccludees=this.useFixedSizes=this.drawScreenSize=this.hasSlicePlane=!1}}b.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([h.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([h.parameter()],m.prototype,"drawScreenSize",void 0);b.__decorate([h.parameter()],m.prototype,"useFixedSizes",void 0);
b.__decorate([h.parameter()],m.prototype,"hasOccludees",void 0);b.__decorate([h.parameter()],m.prototype,"clippingEnabled",void 0);b.__decorate([h.parameter({constValue:!0})],m.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/Logger ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,n,h,k,m,g,e,d){a.PopupSceneLayerView=c=>{c=class extends c{_validateFetchPopupFeatures(l){const {layer:f}=this,{popupEnabled:r}=f;if(!r)throw new n("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:f});if(!d.getFetchPopupTemplate(f,l))throw new n("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:f});}async prepareFetchPopupFeatures(l){}async fetchPopupFeaturesFromGraphics(l,f){this._validateFetchPopupFeatures(f);if(0===l.length)return[];
const r="scene"===this.layer.type&&null!=this.layer.associatedLayer?this.layer.associatedLayer:this.layer;var x=[];"fieldsIndex"in this.layer&&(x=e.unpackFieldNames(this.layer.fieldsIndex,await d.getRequiredFields(r,d.getFetchPopupTemplate(this.layer,f))));await this.prepareFetchPopupFeatures(x);f=new Set;const w=[],p=[];for(const q of l)e.populateMissingFields(x,q,f)?p.push(q):w.push(q);if(0===p.length)return w;const t=new Map;for(x=0;x<l.length;x++)t.set(l[x].getObjectId()??0,x);l=await this.whenGraphicAttributes(p,
[...f]).catch(()=>p).then(q=>w.concat(q));l.sort((q,u)=>{q=q.getObjectId()??0;q=t.get(q)??0;u=u.getObjectId()??0;u=t.get(u)??0;return q-u});return l}};return c=b.__decorate([g.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/ReactiveSet ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/featureEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/updatingProperties ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S){e=J.defineFieldProperties();p=class extends p.I3SMeshView3D(K.TemporalSceneLayerView(H.DefinitionExpressionSceneLayerView(B.PopupSceneLayerView(q.LayerView3D(F))))){constructor(){super(...arguments);this.type="scene-layer-3d";this._setVisibilityHiddenObjectIds=new k;this.progressiveLoadFactor=1;this._elevationContext="scene";this._isIntegratedMesh=!1;this._supportsLabeling=!0;this._pendingEditsQueue=Promise.resolve();
this._interactiveEditingSessions=new Map;this._queryEngine=null}get i3slayer(){return this.layer}tryRecycleWith(N,P){return N.url===this.layer.url&&this.i3sOverrides.isEmpty?N.load(P).then(()=>{I.checkRecyclable(this.layer,N,this.i3sOverrides);this.layer=N;this.i3sOverrides.destroy();this.i3sOverrides=new G.I3SOverrides({view:this.view,layer:N,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null}get layerPopupEnabledAndHasTemplate(){return this.layer.popupEnabled&&
M.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled)}get filter(){return this._get("filter")}set filter(N){this._set("filter",y.I3SMeshViewFilter.checkSupport(N)?N:null)}get viewFilter(){const N=this.mergedFilter,P=this.layerFilter;if(null==N&&null==P)return null;const R=this._get("viewFilter");if(null==R)return new y.I3SMeshViewFilter({layerFilter:P,viewFilter:N,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:O=>this._loadAsyncModule(O),addSqlFilter:(O,T)=>this.addSqlFilter(O,
T,this.logError),addTimeFilter:(O,T)=>this.addTimeFilter(O,T)});R.viewFilter=N;R.layerFilter=P;return R}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get _floorFilterClause(){const N=r.getFloorFilterClause(this);return null!=N?l.WhereClause.create(N,this.layer.fieldsIndex):null}get _excludeObjectIdsSorted(){const N=this.layer.excludeObjectIds.toArray();return N.length?N.sort((P,R)=>P-R):null}get _setVisibilityHiddenObjectIdsSorted(){return this._setVisibilityHiddenObjectIds.size?
Array.from(this._setVisibilityHiddenObjectIds).sort((N,P)=>N-P):null}get lodFactor(){return this.view?.qualitySettings?.sceneService?.object?.lodFactor??1}get lodCrossfadeUncoveredDuration(){return this.view?.qualitySettings?.fadeDuration??0}get updatingProgressValue(){return this._controller?.updatingProgress??0}initialize(){this._fieldsHelper=new z.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,P=>this._rangeInfosChanged(P),m.initial);this._updatingHandles.add(()=>
this.layer.renderer,P=>this._updatingHandles.addPromise(this._rendererChange(P)),m.initial);const N=()=>this._filterChange();this._updatingHandles.add(()=>this.parsedDefinitionExpression,N);this._updatingHandles.add(()=>this.mergedFilter,N);this._updatingHandles.add(()=>this._floorFilterClause,N);this._updatingHandles.add(()=>this._excludeObjectIdsSorted,N);this._updatingHandles.add(()=>this._setVisibilityHiddenObjectIdsSorted,N);this._updatingHandles.add(()=>this.viewFilter?.sortedObjectIds,N);this._updatingHandles.add(()=>
this.viewFilter?.parsedWhereClause,N);this._updatingHandles.add(()=>this.getTimeFilterDependencies(),N);this._updatingHandles.add(()=>[this.viewFilter?.parsedGeometry,this.mergedFilter?.spatialRelationship,this.layer.filter?.spatialRelationship],()=>this._geometryFilterChange());w.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&this._updatingHandles.add(()=>this.i3sOverrides.sortedGeometryChangedObjectIds,N);this.addHandles(this.layer.on("apply-edits",P=>this._updatingHandles.addPromise(P.result)));
this.addHandles(this.layer.on("edits",P=>{const R=this._pendingEditsQueue.then(()=>this._handleEdits(P)).then();this._pendingEditsQueue=R;this._updatingHandles.addPromise(R)}))}destroy(){this._fieldsHelper=h.destroyMaybe(this._fieldsHelper)}_rangeInfosChanged(N){null!=N&&0<N.length&&n.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}createQuery(){const N={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};
return this.mergedFilter?.createQuery(N)??new x(N)}queryExtent(N,P){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(N),P?.signal)}queryFeatureCount(N,P){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(N),P?.signal)}queryFeatures(N,P){return this._ensureQueryEngine().executeQuery(this._ensureQuery(N),P?.signal).then(R=>{if(!R?.features)return R;const O=this.layer;for(const T of R.features)T.layer=O,T.sourceLayer=O;return R})}queryObjectIds(N,P){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(N),
P?.signal)}_ensureQueryEngine(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine}_createQueryEngine(){const N=v.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new A.I3SQueryEngine({layerView:this,priority:S.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new E.I3SQueryFeatureStore({featureAdapter:new C.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??
[],getFeatureExtent:N}),forAllFeatures:(P,R)=>this._forAllFeatures((O,T,Q)=>P({id:O,index:T,meta:Q}),R,t.ForAllFeaturesMode.QUERYABLE),getFeatureExtent:N,sourceSpatialReference:I.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})}highlight(N){const P=this._highlights;if(N instanceof x){const {set:R,handle:O}=P.acquireSet();this.queryObjectIds(N).then(T=>P.setFeatureIds(R,T));return O}return super.highlight(N)}createInteractiveEditSession(N){return u.createInteractiveEditSession(this._attributeEditingContext,
N)}_createLayerGraphic(N){N=new b(null,null,N);N.layer=this.layer;N.sourceLayer=this.layer;return N}getFilters(){const N=super.getFilters();w.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.sortedGeometryChangedObjectIds.length&&N.push((O,T)=>{0<=T.node.index&&I.objectIdFilter(this.i3sOverrides.sortedGeometryChangedObjectIds,!1,O)});const P=this._setVisibilityHiddenObjectIdsSorted;null!=P&&N.push(O=>I.objectIdFilter(P,!1,O));const R=this._excludeObjectIdsSorted;null!=R&&
N.push(O=>I.objectIdFilter(R,!1,O));this._floorFilterClause&&this.addSqlFilter(N,this._floorFilterClause,this.logError);this.addSqlFilter(N,this.parsedDefinitionExpression,this.logError);null!=this.viewFilter&&this.viewFilter.addFilters(N,this.view,this._controller.crsIndex,this._collection);return N}setVisibility(N,P){P?this._setVisibilityHiddenObjectIds.delete(N):this._setVisibilityHiddenObjectIds.add(N)}isUpdating(){return super.isUpdating()||this.layerFilterUpdating||null!=this.viewFilter&&this.viewFilter.updating||
null!=this.i3sOverrides&&this.i3sOverrides.updating}_ensureQuery(N){return this._addDefinitionExpressionToQuery(null==N?this.createQuery():x.from(N))}get _attributeEditingContext(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),globalIdField:this._getGlobalIdField(),forEachNode:N=>this._forAllNodes(P=>null!=P?N(P.node,P.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,
getAttributeData:N=>this.getAttributeData(N),setAttributeData:(N,P)=>this.setAttributeData(N,P),clearMemCache:()=>this.clearMemCache()}}async _handleEdits(N){const P=w.sceneLayerEditingEnabled(),R=this._attributeEditingContext;N=await u.normalizeEditResultsEvent(R,N);P&&u.processGeometryEdits(R,N);u.processAttributeEdits(R,N)}get hasGeometryFilter(){return null!=this.viewFilter?.parsedGeometry}computeNodeFiltering(N){const P=this.viewFilter;return null==P||!this.view.spatialReference||P.isMBSGeometryVisible(N,
this.view.spatialReference,this._controller.crsIndex)?D.NodeFilterImpact.Unmodified:D.NodeFilterImpact.Culled}};a.__decorate([g.property()],p.prototype,"i3slayer",null);a.__decorate([g.property(L.updatingProgress)],p.prototype,"updatingProgress",void 0);a.__decorate([g.property({type:f})],p.prototype,"filter",null);a.__decorate([g.property({readOnly:!0})],p.prototype,"viewFilter",null);a.__decorate([g.property(e.requiredFields)],p.prototype,"requiredFields",null);a.__decorate([g.property(e.availableFields)],
p.prototype,"availableFields",void 0);a.__decorate([g.property()],p.prototype,"_fieldsHelper",void 0);a.__decorate([g.property()],p.prototype,"_floorFilterClause",null);a.__decorate([g.property()],p.prototype,"_excludeObjectIdsSorted",null);a.__decorate([g.property()],p.prototype,"_setVisibilityHiddenObjectIds",void 0);a.__decorate([g.property()],p.prototype,"_setVisibilityHiddenObjectIdsSorted",null);a.__decorate([g.property()],p.prototype,"lodFactor",null);a.__decorate([g.property()],p.prototype,
"updatingProgressValue",null);return p=a.__decorate([c.subclass("esri.views.3d.layers.SceneLayerView3D")],p)})},"esri/core/ReactiveSet":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(a,b){class n{constructor(h){this._observable=new b.SimpleObservable;this._set=new Set(h)}get size(){a.trackAccess(this._observable);return this._set.size}add(h){const k=this._set.size;this._set.add(h);this._set.size!==k&&this._observable.notify();return this}clear(){0<
this._set.size&&(this._set.clear(),this._observable.notify())}delete(h){(h=this._set.delete(h))&&this._observable.notify();return h}entries(){a.trackAccess(this._observable);return this._set.entries()}forEach(h,k){a.trackAccess(this._observable);this._set.forEach((m,g)=>h.call(k,m,g,this),k)}has(h){a.trackAccess(this._observable);return this._set.has(h)}keys(){a.trackAccess(this._observable);return this._set.keys()}values(){a.trackAccess(this._observable);return this._set.values()}[Symbol.iterator](){a.trackAccess(this._observable);
return this._set[Symbol.iterator]()}get [Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}return n})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/ByteSizeUnit ../../../core/Collection ../../../core/handleUtils ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../core/libs/gl-matrix-2/math/mat3 ../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../core/libs/gl-matrix-2/math/mat4 ../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../core/libs/gl-matrix-2/factories/quatf64 ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../chunks/vec42 ../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../core/support/UpdatingHandles ../../../geometry/projection/localLinearScaleFactors ../../../geometry/projection/projectBoundingSphere ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectors ../../../geometry/projection/projectVectorToVector ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/DoubleArray ../../../geometry/support/FloatArray ../../../geometry/support/Indices ../../../chunks/sphere ../../../geometry/support/UByteArray ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../support/basemapUtils ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshViewPerformanceInfo ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./i3s/LayerElevationProvider ./support/attributeUtils ./support/makeScheduleFunction ./support/symbolColorUtils ../support/debugFlags ../support/ElevationRange ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja,oa,qa,ta,va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma,Ua,Ga,Na,Va,Xa,Pa,bb,gb,cb,ka,mb,qb,tb,xa){function Ia(jb,sa){w.isAbortError(jb)||l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while processing edges. Edges on this layer might not display correctly",sa,jb)}function na(jb){if(null==jb)return!1;const sa=jb.metallicRoughness;return sa&&0<=sa.baseColorTextureId||
sa&&0<=sa.metallicRoughnessTextureId||0<=jb.normalTextureId||0<=jb.emissiveTextureId||0<=jb.occlusionTextureId}function ya(jb){return null!=jb&&q.isArrayBuffer(jb.data)}function Da(jb,sa){jb=1024+jb.interleavedVertexData.byteLength+(jb.indices?jb.indices.byteLength:0)+jb.positionData.data.byteLength+jb.positionData.indices.byteLength;if(null!=sa)for(const Ha of sa)null!=Ha&&q.isArrayBuffer(Ha.data)&&(jb+=Ha.data.byteLength);return jb}function Oa(jb,sa){return sa.byteSize>lb?(l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Node is too big to store in IndexedDB cache: ${jb.id} (${sa.byteSize} bytes)`),
!1):0<sa.byteSize}function Wa(jb){if(0!==jb.length){var sa=new Float64Array(10*jb.length),Ha=0;jb.forAll(Qa=>{let Ta=Qa.serviceObbInIndexSR;null==Ta&&(Ta=Lb,Ta.center=Q.getCenter(Qa.serviceMbsInIndexSR),Ta.halfSize=[Qa.serviceMbsInIndexSR[3],Qa.serviceMbsInIndexSR[3],Qa.serviceMbsInIndexSR[3]]);Qa=Ta.data;sa[Ha++]=Qa[0];sa[Ha++]=Qa[1];sa[Ha++]=Qa[2];sa[Ha++]=Qa[3];sa[Ha++]=Qa[4];sa[Ha++]=Qa[5];sa[Ha++]=Qa[6];sa[Ha++]=Qa[7];sa[Ha++]=Qa[8];sa[Ha++]=Qa[9]});return sa}}function ab(jb,sa){jb.forEach(Ha=>
Ha.opacity=sa)}function Ja(jb,sa,Ha){let Qa=jb.elevationRangeMin,Ta=jb.elevationRangeMax;if(0<Ha){sa.getCorners(Ub);for(const hb of Ub){var Za=I.len(hb)-Ha;Qa=Math.min(Qa,Za);Ta=Math.max(Ta,Za)}}else{sa.getCorners(Ub);for(Za of Ub)Ha=Za[2],Qa=Math.min(Qa,Ha),Ta=Math.max(Ta,Ha)}jb.expandElevationRangeValues(Qa,Ta)}function Ra(jb,sa,Ha){const Qa=Q.getCenter(sa);Ha=0<Ha?I.len(Qa)-Ha:Qa[2];sa=Q.getRadius(sa);jb.expandElevationRangeValues(Ha-sa,Ha+sa)}const Sa=[1,1,1,1];class db extends ma.NodeCrossfadeMetaData{constructor(jb,
sa,Ha,Qa,Ta,Za,hb,ib,pb){super();this.node=jb;this.featureIds=sa;this.objectHandle=Ha;this.cachedRendererVersion=Qa;this.attributeInfo=Ta;this.material=Za;this.textures=hb;this.anchorIds=ib;this.anchors=pb;this.cachedElevationAnchors=null;this.cachedEdgeMaterials=[];this.edgeMemoryUsage=0}}var eb;(function(jb){jb[jb.CastShadows=4]="CastShadows";jb[jb.Pickable=5]="Pickable"})(eb||={});const lb=100*g.ByteSizeUnit.MEGABYTES;var sb;(function(jb){jb[jb.ADD=0]="ADD";jb[jb.REMOVE=1]="REMOVE";jb[jb.UPDATE=
2]="UPDATE"})(sb||={});const vb=N.create(),rb=P.create(),Eb=P.create(),Lb=new gb.Obb,Yb=[0,0,0,0],bc=new h([0,0,0,0]),fc=Q.fromValues(0,0,0,0);class kc{constructor(jb,sa){this.mode=jb;this.offset=sa}}const Cb=H.create(),Ib=N.create(),Ub=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Sb=new Pa.ElevationRange;b.I3SMeshView3D=jb=>{jb=class extends jb{constructor(...sa){super(sa);this._needsNormals=!0;this._updatingHandles=new z.UpdatingHandles;this._nodeId2Meta=new Map;this._nodeId2MetaReloading=
new Map;this._i3sWasmLoaded=!1;this._snappingSourcesTrackers=[];this._hasLoadedPBRTextures=!1;this._asyncModuleLoading=0;this._addTasks=new Map;this._currentRenderer=null;this._rendererVersion=0;this._symbologyOverrideFields=this._symbologyOverride=this._symbologyFields=this._rendererFields=this._opacityVariable=this._colorVariable=null;this._symbolInfos=new Map;this._visibleGeometryChangedSchedulerHandle=null;this._hasVertexColors=this._hasComponentData=!1;this._nodeColorOverride=null;this.updating=
!0;this.holeFilling="auto";this.slicePlaneEnabled=this._hasData=this._hasTextures=this._hasColors=!1;this._modifications=[];this.ignoresMemoryFactor=!1;this._layerUrl="";this._cacheKeySuffix=null;this._planetRadiusInGlobalMode=0;this._elevationTask=null;this._filters=[];this._arcade=null;this._tmpAttributeOnlyGraphic=new k(null,null,{});this._crossfadeHelper=new ma.I3SCrossfadeHelper(this)}get lodCrossfadeoutDuration(){return 0}get lodCrossfadeinDuration(){return 0}get lodCrossfadeUncoveredDuration(){return 0}get layerUid(){return this.i3slayer&&
this.i3slayer.uid}get sublayerUid(){return null}get layerId(){return this.i3slayer&&this.i3slayer.id}get sublayerId(){return null}get contentVisible(){return!this.suspended&&this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}get updatingProgressValue(){return this._controller?.updatingProgress??0}get hasTexturesOrVertexColors(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}get rendererTextureUsage(){return Ea.rendererNeedsTextures(this._currentRenderer)?
this._usePBR||this._hasLoadedPBRTextures?ta.TextureUsage.AllTexturesPBR:ta.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?ta.TextureUsage.GeometryTexturesPBR:ta.TextureUsage.GeometryTextures}get elevationOffset(){const sa=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=sa&&"absolute-height"===sa.mode){const Ha=u.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Qa=aa.getMetersPerUnit(sa.unit);return(sa.offset??0)*Qa/Ha}return 0}get elevationInfo(){const sa=
null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==sa)return new kc(Z.ElevationMode.Absolute,0);var Ha=u.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Qa=aa.getMetersPerUnit(sa.unit);Ha=(sa.offset??0)*Qa/Ha;switch(sa.mode){case "absolute-height":return new kc(Z.ElevationMode.Absolute,Ha);case "relative-to-ground":return new kc(Z.ElevationMode.RelativeToGround,Ha);case "on-the-ground":return new kc(Z.ElevationMode.OnTheGround,0);default:return new kc(Z.ElevationMode.Absolute,
0)}}get supportedTextureEncodings(){return pa.getSupportedEncodings(this.view._stage.renderView.capabilities)}get uncompressedTextureDownsamplingEnabled(){const sa=0===(this.supportedTextureEncodings&ta.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&sa}get clientGeometry(){return this.i3sOverrides.geometryOverrides}get elevationRange(){var sa=this._nodeId2Meta;const Ha=new Pa.ElevationRange;for(const Qa of sa.values()){if(null==Qa)continue;
({node:{serviceMbsInIndexSR:sa}}=Qa);const [,,Ta,Za]=sa;Ha.expandElevationRangeValues(Ta-Za,Ta+Za)}return Ha.elevationRangeValid?Ha:null}get fullExtent(){return this.i3slayer.fullExtent}initialize(){var sa=c("enable-feature:idb-mock-cache");this._idbCache=sa?new Ma.IDBMockCache(this.view,sa):new Ka.IDBCache("esri-scenelayer-cache","geometries");this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);sa=this.view.resourceController;this.i3sOverrides=new ra.I3SOverrides({view:this.view,
layer:this.i3slayer,memoryController:sa.memoryController});this._worker=new Y.I3SMeshWorkerHandle(Na.makeScheduleFunction(sa));this.addResolvingPromise(this._worker.promise);sa=this.i3slayer.store;this._worker.setLegacySchema(this.uid,sa.defaultGeometrySchema);Ea.checkSceneLayerValid(this.i3slayer);Ea.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new W({layerView:this,worker:this._worker});this._geoMemoryEstimate=this._texMemoryEstimate=
this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();sa=sa.defaultGeometrySchema;if(this._isIntegratedMesh||!sa)this._hasComponentData=!1;else{const ib=sa.featureAttributes;this._hasComponentData=!!(ib&&ib.faceRange&&ib.id)}this._hasVertexColors=null!=(sa?.vertexAttributes.color??null)&&!this.i3slayer.cachedDrawingInfo?.color;this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=
this.view.resourceController.memoryController.newCache(`sl-${this.uid}`,ib=>this._deleteComponentObject(ib));const Ha=this._controller,Qa=this._nodeId2Meta,Ta=this._nodeId2MetaReloading;this._intersectionHandler=new Ba.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:ib=>{const pb=Ha.index;if(pb){var ob=pb.rootNode;ob&&pb.traverse(ob,yb=>{var wb=yb.index;
wb=Qa.get(wb)||Ta.get(wb);return ib(yb,wb?.objectHandle??null)})}}});this._updatingHandles.add(()=>this.layerUid,ib=>this._intersectionHandler.layerUid=ib);this._updatingHandles.add(()=>this.sublayerUid,ib=>this._intersectionHandler.sublayerUid=ib);this._elevationProvider=new Ua.LayerElevationProvider({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this._updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),
p.initial);this._updatingHandles.add(()=>this.fullOpacity,ib=>this._opacityChange(ib));this._updatingHandles.add(()=>this.slicePlaneEnabled,ib=>this._slicePlaneEnabledChange(ib));this._updatingHandles.add(()=>this.elevationOffset,(ib,pb)=>{this._reloadAll(pb);this._controller.invalidateVisibilityObbs()});this._updatingHandles.add(()=>this.elevationInfo,(ib,pb)=>this._elevationInfoChanged(ib,pb),p.initial);this._updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==Z.ElevationMode.Absolute,
(ib,pb)=>{ib?this.addHandles(this.view.basemapTerrain.on("elevation-change",({extent:ob})=>this._ensureElevationTask().addExtent(ob)),"elevation-change"):pb&&this.removeHandles("elevation-change")},p.initial);this._updatingHandles.add(()=>this._usePBR,ib=>this._updatePBR(ib));sa=()=>{this._reloadAll();this.clearMemCache()};this._updatingHandles.add(()=>this.rendererTextureUsage,sa);this._updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,sa);this._updatingHandles.add(()=>this.contentVisible,
ib=>this._contentVisibleChanged(ib),p.initial);this._updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),p.initial);this._updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),p.initial);this._updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),p.initial);this.addHandles([p.watch(()=>Xa.debugFlags.I3S_TREE_SHOW_TILES,ib=>{if(ib&&!this._treeDebugger){const pb=this._controller.crsIndex;(new Promise((ob,yb)=>a(["./support/I3STreeDebugger"],
ob,yb))).then(({I3STreeDebugger:ob})=>{!this._treeDebugger&&Xa.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ob({lv:this,view:this.view,nodeSR:pb}))})}else ib||Xa.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger=r.destroyMaybe(this._treeDebugger))},p.initial),p.watch(()=>Xa.debugFlags.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),p.initial)]);this._cacheKeySuffix=Ea.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(ib=>
l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to initialize IndexedDB cache: ${ib}`));({view:sa}=this);const {viewingMode:Za,renderCoordsHelper:hb}=sa;this._planetRadiusInGlobalMode="local"===Za?0:hb.referenceEllipsoid.radius}destroy(){this._clearAddTasks();this._elevationTask=r.destroyMaybe(this._elevationTask);this.i3sOverrides=r.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.objectsChanged(this.getVisibleObbs()),this.view.elevationProvider.unregister(this._elevationProvider),
this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const sa=this._worker;sa&&(sa.destroyContext(this.uid).then(()=>sa.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=r.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=r.destroyMaybe(this._labeler);this._treeDebugger=r.destroyMaybe(this._treeDebugger);
this._controller=r.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this._crossfadeHelper=r.destroyMaybe(this._crossfadeHelper);this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null);this._updatingHandles=r.destroyMaybe(this._updatingHandles)}_memEstimateTextureAdded(sa){sa=sa.memoryEstimate;this._gpuMemoryEstimate+=
sa;this._texMemoryEstimate+=sa;return sa}_memEstimateTextureRemoved(sa){null!=sa&&(sa=sa.memoryEstimate,this._gpuMemoryEstimate-=sa,this._texMemoryEstimate-=sa)}_memEstimateGeometryAdded(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);this._gpuMemoryEstimate+=sa;this._geoMemoryEstimate+=sa;return sa}_memEstimateGeometryRemoved(sa){sa=this._collection.getObjectGPUMemoryUsage(sa);this._gpuMemoryEstimate-=sa;this._geoMemoryEstimate-=sa}isNodeLoaded(sa){return this._nodeId2Meta.has(sa)}isNodeReloading(sa){return this._nodeId2MetaReloading.has(sa)}get usedMemory(){let sa=
null!=this._labeler?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Ha=>sa+=null!=Ha?Ha.node.memory:0);this._nodeId2MetaReloading.forEach(Ha=>sa+=null!=Ha?Ha.node.memory:0);return sa}get unloadedMemory(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}_labelingChanged(){if(!qa.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)null!=this._labeler&&(this._labeler.destroy(),this._labeler=null);else if(null==
this._labeler){var sa=new ea({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach(Ha=>null!=Ha&&this._addMetaToLabeler(sa,Ha));this._labeler=sa}}_loadAsyncModule(sa){++this._asyncModuleLoading;return sa.then(Ha=>{--this._asyncModuleLoading;return Ha},Ha=>{--this._asyncModuleLoading;throw Ha;})}_modificationsChanged(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=ja.initialize().then(()=>{this._i3sWasmLoaded=!0;
this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var sa=this.uid,Ha=this.i3slayer.spatialReference;this._worker.setModifications(sa,this._layerClippingArea,this._modifications,Ha);var Qa=Y.toWasmModification(this._layerClippingArea,this._modifications,Ha);ja.setModificationsSync({context:sa,modifications:Qa,isGeodetic:Ha.isGeographic});this._controller.modificationsChanged();var Ta=this.hasModifications?new x:null;this._nodeId2Meta.forEach((Za,
hb)=>{null==Za?(this._nodeId2Meta.delete(hb),this._controller.updateLoadStatus(hb,!1)):Za.node.hasModifications?(this._nodeId2Meta.delete(hb),this._nodeId2MetaReloading.set(hb,Za)):null!=Ta&&Ta.push(Za.node)});this.notifyChange("elevationRange");null!=Ta&&this._nodeId2MetaReloading.forEach(Za=>Ta.push(Za.node));null!=Ta&&0<Ta.length&&(this.updateNodeModificationStatus(Ta),Ta.forAll(Za=>{if(Za.imModificationImpact!==Aa.NodeIMModificationImpact.Culled){const hb=this._nodeId2Meta.get(Za.index);this._controller.invalidateGeometryVisibility(Za.index);
null!=hb?(this._nodeId2Meta.delete(Za.index),this._nodeId2MetaReloading.set(Za.index,hb),this.notifyChange("elevationRange")):this._nodeId2Meta.has(Za.index)&&(this._nodeId2Meta.delete(Za.index),this._controller.updateLoadStatus(Za.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}}_showModifications(){null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(Xa.debugFlags.I3S_SHOW_MODIFICATIONS&&
0!==this._modifications.length){var sa={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Ha={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Qa of this._modifications){const Ta=Qa.geometry;Ta.spatialReference=this.i3slayer.spatialReference;this._modificationGraphics.push(new k({geometry:Ta,symbol:{...Ha,color:sa[Qa.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}}_addMetaToLabeler(sa,Ha){sa.addNodeMeta(Ha,(Qa,Ta)=>
this._createAttributes(Qa,Ta))}_contentVisibleChanged(sa){sa?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))}getLoadedAttributes(sa){sa=this._nodeId2Meta.get(sa);
if(null!=sa?.attributeInfo)return sa.attributeInfo.loadedAttributes}getAttributeData(sa){sa=this._nodeId2Meta.get(sa);if(null!=sa?.attributeInfo)return sa.attributeInfo.attributeData}setAttributeData(sa,Ha){sa=this._nodeId2Meta.get(sa);null!=sa?.attributeInfo&&(sa.attributeInfo.attributeData=Ha,this._attributeValuesChanged(sa))}async updateAttributes(sa,Ha,Qa){const Ta=this._nodeId2Meta.get(sa);null!=Ta&&(await this.i3sOverrides.applyAttributeOverrides(Ta.featureIds,Ha,Qa,this._controller.requiredAttributes),
Ta.attributeInfo=Ha,this._controller.reschedule(()=>this._attributeValuesChanged(Ta),Qa).catch(Za=>{w.isAbortError(Za)||l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn("Error while updating attribute values. Layer might not display correctly.",Za)}))}_attributeValuesChanged(sa){sa.cachedRendererVersion=this._getInvalidRendererVersion();sa.filteredIds=null;null!=this._labeler&&this._labeler.setNodeMetaAttributes(sa,(Ha,Qa)=>this._createAttributes(Ha,Qa));this._updateEngineObject(sa)}clearMemCache(){null!=
this._memCache&&this._memCache.clear()}getVisibleNodes(){const sa=[];this._nodeId2Meta.forEach(Ha=>null!=Ha&&sa.push(Ha.node));return sa}getVisibleObbs(){const sa=[];this._nodeId2Meta.forEach(Ha=>{null!=Ha&&(Ha=this.getNodeComponentObb(Ha.node),null!=Ha&&sa.push(Ha))});return sa}getNodeComponentObb(sa){sa=this._nodeId2Meta.get(sa.index)??this._nodeId2MetaReloading.get(sa.index);return null!=sa?this._collection.getComponentObb(sa.objectHandle):null}getLoadedNodeIndices(sa){this._nodeId2Meta.forEach((Ha,
Qa)=>sa.push(Qa));this._nodeId2MetaReloading.forEach((Ha,Qa)=>sa.push(Qa))}_preLoadBasis(){!c("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ta.TextureEncoding.Basis)&&this.i3slayer.textureSetDefinitions?.some(sa=>sa.formats.some(Ha=>"basis"===Ha.format||"ktx2"===Ha.format))&&tb.loadBasis()}_getVertexBufferLayout(sa,Ha){sa={hasTexture:na(sa.params.material),hasNormals:Ha.normal,hasRegions:Ha.uvRegion};return ka.glLayout(mb.createVertexBufferLayout(this._getGeometryParameters(sa)))}_getObjectIdField(){return this.i3slayer.objectIdField||
U.fallbackObjectIDAttribute}_getGlobalIdField(){return this.i3slayer.associatedLayer?.globalIdField}_findGraphicNodeAndIndex(sa){const Ha=Ga.attributeLookup(this.i3slayer.fieldsIndex,sa.attributes,this._getObjectIdField());let Qa=null;f.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;const Za=Ta.featureIds.indexOf(Ha);if(-1===Za)return!1;Qa={node:Ta.node,index:Za};return!0});return Qa}_getGraphicIndices(sa,Ha){sa=this._nodeId2Meta.get(sa.index);if(null==sa)return[];const Qa=[],Ta=this._getObjectIdField(),
Za=this.i3slayer.fieldsIndex;for(const hb of Ha)Ha=Ga.attributeLookup(Za,hb.attributes,Ta),Ha=sa.featureIds.indexOf(Ha),-1!==Ha&&Qa.push(Ha);return Qa}whenGraphicBounds(sa){sa=this._findGraphicNodeAndIndex(sa);if(!sa)return Promise.reject();sa=this._getAABB(sa.node.index,sa.index);return null==sa?Promise.reject():Promise.resolve({boundingBox:sa,screenSpaceObjects:[]})}getAABBFromIntersectorTarget(sa){return null==sa.nodeIndex||null==sa.componentIndex?null:this._getAABB(sa.nodeIndex,sa.componentIndex)}_getAABB(sa,
Ha){sa=this._nodeId2Meta.get(sa);if(null==sa?.featureIds||Ha>=sa.featureIds.length)return null;Ha=wa.boundingBoxCornerPoints(Ha,this._collection,sa.objectHandle,R.newDoubleArray(24),0);if(!F.projectBuffer(Ha,this.view.renderSpatialReference,0,Ha,this.view.spatialReference,0,8))return null;sa=N.empty();N.expandWithBuffer(sa,Ha,0,8);return sa}whenGraphicAttributes(sa,Ha){return Ea.whenGraphicAttributes(this.i3slayer,sa,this._getObjectIdField(),Ha,()=>[...this._nodeId2Meta.values()].filter(m.isSome))}getGraphicFromIntersectorTarget(sa){if(null==
sa.nodeIndex||null==sa.componentIndex)return null;const Ha=this._nodeId2Meta.get(sa.nodeIndex);return null==Ha?.featureIds||sa.componentIndex>=Ha.featureIds.length?null:this._createGraphic(sa.componentIndex,Ha)}_getCacheKey(sa){return`${this._layerUrl}/v${23}/${sa}${this._cacheKeySuffix}`}_getMemCacheKey(sa,Ha=this.elevationOffset){return sa+"#"+Ha}get _idbCacheEnabled(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}loadCachedGPUData(sa){return null!=
this._memCache?this._memCache.pop(this._getMemCacheKey(sa)):null}deleteCachedGPUData(sa){null!=sa&&this._deleteComponentObject(sa)}_cacheGPUData(sa,Ha=this.elevationOffset){if(null==this._memCache)this._deleteComponentObject(sa);else{var Qa=this._controller.indexDepth-sa.node.level;this._memCache.put(this._getMemCacheKey(sa.node.index,Ha),sa,sa.node.memory,Qa)}}loadMissingTextures(sa,Ha,Qa,Ta){const Za=sa?.filter((hb,ib)=>{if(0===(hb.usage&this.rendererTextureUsage))return!1;if(null==Ha)return!0;
hb=pa.selectEncoding(hb.encodings,this.supportedTextureEncodings);ib=Ha[ib];return null==ib?.data||hb&&ib.encoding!==hb.encoding?!0:!1})??[];return 0===Za.length?Promise.resolve(!1):Qa(Za,Ta).then(hb=>{let ib=0;for(let pb=0;pb<sa.length;pb++)ib<hb.length&&hb[ib].id===sa[pb].id&&(Ha[pb]=hb[ib],ib++);return!0})}loadCachedNodeData(sa,Ha,Qa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(sa.id),Ha).then(Ta=>{if(null==Ta)return null;if(Ta.nodeVersion!==sa.version)return this._idbCache.remove(this._getCacheKey(sa.id)),
null;this.elevationInfo.mode===Z.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=gb.Obb.fromData(Ta.geometryObbData));return this.loadMissingTextures(Ta.requiredTextures,Ta.textureData,Qa,Ha).then(Za=>{Za&&this._idbCache.initialized&&null!=Ta.textureData&&(Ta.byteSize=Da(Ta.transformedGeometry,Ta.textureData),Ta.textureData.every(ya)&&Oa(sa,Ta)&&this._idbCache.put(this._getCacheKey(sa.id),Ta).catch(hb=>l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to update node with textures in IndexedDB cache: ${sa.id}: ${hb}`)));
w.throwIfAborted(Ha);return Ta})}):Promise.resolve(null)}addNode(sa,Ha,Qa){return"geometryData"in Ha?null==Ha.geometryBuffer?(this._addNodeMeta(sa.index,null),Promise.resolve()):this._addData(sa,Ha.attributeDataInfo,()=>this._transformNode(sa,Ha,Qa).then(Ta=>this._safeReschedule(()=>{if(null==Ta)return sa.hasModifications=!1,this._addCachedNodeData(sa,null,Qa);sa.hasModifications=Ta.transformedGeometry.hasModifications;const {obb:Za,componentOffsets:hb,featureIds:ib,anchorIds:pb,anchors:ob,transformedGeometry:yb}=
Ta;var wb=ua.computeGlobalTransformation(sa.serviceMbsInIndexSR,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),Fb=I.set(Cb,Za.center.x,Za.center.y,Za.center.z);I.transformMat4(Fb,Fb,wb);Fb=new gb.Obb(Fb,[Za.extents.x,Za.extents.y,Za.extents.z],E.fromValues(Za.orientation.x,Za.orientation.y,Za.orientation.z,Za.orientation.w));this.elevationInfo.mode===Z.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=Fb);Ha.geometryData.componentOffsets=hb;ib&&(Ha.geometryData.featureIds=
Array.from(ib));Ha.geometryData.anchorIds=pb;Ha.geometryData.anchors=ob;wb={nodeVersion:sa.version,geometryData:Ha.geometryData,requiredTextures:Ha.requiredTextures,textureData:Ha.textureData,transformedGeometry:yb,globalTrafo:wb,geometryObbData:Fb.data,byteSize:Da(yb,Ha.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&Oa(sa,wb)&&(Fb=null!=wb.textureData?wb.textureData.map(zb=>ya(zb)?zb:null):null,this._idbCache.put(this._getCacheKey(sa.id),{...wb,textureData:Fb}).catch(zb=>l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Failed to store node in IndexedDB cache: ${sa.id}: ${zb}`)));
return this._addCachedNodeData(sa,wb,Qa)},Qa))):Promise.reject()}getElevationRange(sa){const Ha=new Pa.ElevationRange;var Qa=this._controller;const {index:Ta}=Qa;if(!Ta)return Ha;const {rootNode:Za}=Ta;if(!Za)return Ha;const hb=this._nodeId2Meta,ib=sa[3],pb=Qa.viewportQueries,ob=this._planetRadiusInGlobalMode;({view:Qa}=this);const {renderCoordsHelper:yb}=Qa,wb=yb.referenceEllipsoid.radius,Fb=this._collection;Ta.traverse(Za,zb=>{const {childrenLoaded:Tb}=zb;if(0===Tb)return!1;var nb=pb.getAndUpdateVisibilityObbInRenderSR(zb),
xb=null;let Ab=-1;if(nb){if(Ab=nb.radius,!nb.intersectSphereWithMBS(sa,Ab))return!1}else(xb=pb.getServiceMbsInRenderSR(zb))&&(Ab=xb[3]);if(0<=Ab&&ib>=1*Ab)return null!=nb?Ja(Ha,nb,ob):null!=xb&&0<=xb[3]&&Ra(Ha,xb,ob),!1;Sb.elevationRangeMin=Infinity;Sb.elevationRangeMax=-Infinity;if(null!=nb||null!=xb)if(null!=nb?Ja(Sb,nb,ob):null!=xb&&Ra(Sb,xb,ob),Sb.elevationRangeMin>=Ha.elevationRangeMin&&Sb.elevationRangeMax<=Ha.elevationRangeMax)return!1;if(nb=hb.get(zb.index))if({geometryObbInRenderSR:zb}=zb,
!zb||zb.intersectSphereWithMBS(sa)){if(zb&&ib>0*zb.radius)return Ja(Ha,zb,ob),!1;({objectHandle:zb}=nb);xb=Fb.getObjectTransform(zb);xb=yb.getAltitude(xb.position);Fb.expandRangeWithComponentObjectElevationRange(zb,xb,wb,Ha)}return 0<Tb-(nb?1:0)});return Ha}computeVisibilityObb(sa){return Ea.computeVisibilityObb(sa,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications,this.view.renderCoordsHelper.sphericalPCPF)}_transformNode(sa,
Ha,Qa){var Ta=Ha.geometryData.geometries??[];const Za=Array(Ta.length);for(var hb=0;hb<Ta.length;++hb)Za[hb]=this._getVertexBufferLayout(Ta[hb],Ha.geometryDescriptor);Ta=sa.serviceMbsInIndexSR;hb=this.elevationOffset;var ib=this._controller.crsIndex,pb=this._controller.crsVertex,ob=this.view.renderSpatialReference;const yb=ua.getLocalOrigin(Ta,hb,ib),wb=ua.computeGlobalTransformation(Ta,hb,ib,ob);ib=M.getProjectorName(ib,pb);pb=M.getProjectorName(pb,ob);if(null==ib||null==pb)return Promise.resolve(null);
ob=this.i3slayer.normalReferenceFrame;return this._worker.invoke({context:this.uid,geometryBuffer:Ha.geometryBuffer,geometryData:Ha.geometryData,geometryDescriptor:Ha.geometryDescriptor,layouts:Za,localOrigin:yb,globalTrafo:wb,mbs:Ta,obbData:sa.serviceObbInIndexSR?.data,elevationOffset:hb,needNormals:this._needsNormals&&this._controller.isMeshPyramid,normalReferenceFrame:Ha.normalReferenceFrame??ob??"none",indexToVertexProjector:ib,vertexToRenderProjector:pb},Qa)}get _supportsNodeCrossFading(){return!this.view?._stage?.renderer.shadowsEnabled}get nodeCrossfadingEnabled(){return this._supportsNodeCrossFading&&
(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}get nodeFadeoutEnabled(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}_setNewNodeOpacity(sa){this._setNodeOpacity(sa,this.nodeCrossfadingEnabled?0:this.fullOpacity)}addCachedGPUData(sa,Ha,Qa){this.elevationInfo.mode===Z.ElevationMode.Absolute&&(sa.geometryObbInRenderSR=this._collection.getComponentObb(Ha.objectHandle).clone());this._controller.isGeometryVisible(sa)?(null!=
this._labeler&&this._addMetaToLabeler(this._labeler,Ha),sa=sa.index,this._addNodeMeta(sa,Ha),this.updateNodeState(sa,Qa),this._collection.setObjectVisibility(Ha.objectHandle,!0),this._updateMaterial(Ha),this._setNewNodeOpacity(Ha),this.elevationInfo.mode!==Z.ElevationMode.Absolute&&this._ensureElevationTask().schedule(sa),this._updateEngineObject(Ha),this._highlights.objectCreated(Ha),null!=this._treeDebugger&&this._treeDebugger.update()):this._cacheGPUData(Ha)}addCachedNodeData(sa,Ha,Qa,Ta){return this._addData(sa,
Qa,()=>this._addCachedNodeData(sa,Ha,Ta))}async deleteCachedNodeData(sa){if(this._idbCacheEnabled)return this._idbCache.remove(this._getCacheKey(sa))}async _addCachedNodeData(sa,Ha,Qa){if(this.contentVisible&&this._controller.isGeometryVisible(sa))if(null==Ha)this._addNodeMeta(sa.index,null);else{var Ta=this._addTasks.get(sa.index),{geometryData:Za,transformedGeometry:hb,globalTrafo:ib}=Ha;await this.i3sOverrides.applyAttributeOverrides(Za.featureIds,Ta.attributeInfo,Qa,this._controller.requiredAttributes);
var pb=null!=Ha.textureData?Ha.textureData.filter(Rb=>null!=Rb&&0!==(Rb.usage&this.rendererTextureUsage)):[];!c("disable-feature:i3s-basis")&&pb.some(Rb=>null!=Rb&&(Rb.encoding===ta.TextureEncoding.Basis||Rb.encoding===ta.TextureEncoding.KTX2))&&await tb.loadBasis();sa.memory=0;var {componentOffsets:ob,geometries:yb,featureIds:wb,anchorIds:Fb,anchors:zb}=Za,Tb=this._collection,nb=yb[0],{layout:xb,indices:Ab,interleavedVertexData:Mb,positionData:gc,hasColors:Vb}=hb,{material:Zb,geometryParameters:hc}=
this._materialParameters(nb,xb),Qb=ob||new Uint32Array([0,Ab?Ab.length:Mb.byteLength/xb[0].stride]);Qb={vertices:{data:Mb,count:Mb.byteLength/xb[0].stride,layoutParameters:hc},positionData:{positions:O.compactFloatArray(gc.data),indices:T.compactIndices(gc.indices)},indices:Ab,componentOffsets:Qb};var Nb=nb.transformation?C.clone(nb.transformation):C.create();A.multiply(Nb,ib,Nb);nb=A.getTranslation(H.create(),Nb);Nb=D.fromMat4(G.create(),Nb);var Wb=this.view.renderSpatialReference,Hb=this.view.basemapTerrain.spatialReference,
Gb=gb.Obb.fromData(Ha.geometryObbData).center,Xb=[1,1,1];K.localLinearScaleFactors(Gb,Wb,Xb,Hb)||l.getLogger("esri.views.3d.layers.I3SMeshView3D").errorOnce("Unsupported coordinate system for IM overlay");var $b=H.create();S.projectVectorToVector(Gb,Wb,$b,Hb);Wb=G.create();D.invert(Wb,Nb);Hb=H.create();I.transformMat3(Hb,I.sub(Hb,Gb,nb),Wb);var Db=Tb.createObject({toMapSpace:B.fromValues($b[0]-Hb[0]*Xb[0],$b[1]-Hb[1]*Xb[1],Xb[0],Xb[1]),geometry:Qb,obb:gb.Obb.fromData(Ha.geometryObbData),transform:{position:nb,
rotationScale:Nb}}),{textures:Jb,texturePromise:ic}=this._initMaterialAndTextures(Db,Zb,pb,hc.textureCoordinates===qb.TextureCoordinateAttributeType.Atlas);sa.memory+=this._memEstimateGeometryAdded(Db);sa.memory+=Jb.reduce((Rb,cc)=>Rb+(null!=cc?this._memEstimateTextureAdded(cc):0),0);pb=!!Zb.hasParametersFromSource;Qb="blend"!==Zb.alphaMode&&1<=Zb.metallicRoughness.baseColorFactor[3];var ac=new db(sa,wb,Db,this._getInvalidRendererVersion(),Ta.attributeInfo,{hasParametersFromSource:pb,isOpaque:Qb},
Jb,Fb,zb);Ta.meta=ac;!this._hasTextures&&Ha.requiredTextures?.some(({usage:Rb})=>0!==(Rb&ta.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Vb;this._hasTextures=this._hasTextures||!!sa.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var mc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(ac),ic]).then(([Rb])=>{null!=Rb&&Rb.updateObjectVisibility(ac.objectHandle,!1).catch(cc=>Ia(cc,this.i3slayer.title));
return this._safeReschedule(()=>{var cc=this._addTasks.get(sa.index);if(cc)if(this._addNodeMeta(sa.index,ac),cc.meta=null,this.contentVisible){Tb.setObjectVisibility(Db,!0);null!=Rb&&Rb.updateObjectVisibility(ac.objectHandle,!0).catch(Cc=>Ia(Cc,this.i3slayer.title));ac.attributeInfo=cc.attributeInfo;cc=ac.cachedRendererVersion!==this._rendererVersion;var rc=mc!==this.slicePlaneEnabled;this._updateElevationOffsets(ac);var oc=ac.elevationOffsets;this._updateComponentData(ac);var Bc=this._applyFiltersToNode(ac);
(cc||null!=Rb&&(rc||Bc||oc))&&this._addOrUpdateEdgeRendering(ac);null!=this._labeler&&this._addMetaToLabeler(this._labeler,ac);this._visibleGeometryChanged(ac,sb.ADD);this._highlights.objectCreated(ac);this._updateMaterial(ac);this._setNewNodeOpacity(ac);null!=this._treeDebugger&&this._treeDebugger.update()}else this._removeNodeStageData(sa.index,this.elevationOffset)},Qa)}).catch(Rb=>{null!=Ta.meta&&(this._cacheGPUData(Ta.meta),Ta.meta=null);throw Rb;})}else this._removeNodeStageData(sa.index,this.elevationOffset,
this._nodeId2MetaReloading)}_addNodeMeta(sa,Ha){this._removeNodeStageData(sa,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(sa)){l.getLogger("esri.views.3d.layers.I3SMeshView3D").error("Removing duplicated node");const Qa=this._nodeId2Meta.get(sa);null!=Qa&&this._deleteComponentObject(Qa)}else this._controller.updateLoadStatus(sa,!0);null!=Ha&&(Ha.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&ab(Ha.cachedEdgeMaterials,0));this._nodeId2Meta.set(sa,Ha);this.notifyChange("elevationRange")}_updateElevationOffsets(sa){const Ha=
this.view.renderSpatialReference,Qa=this._controller.crsIndex,Ta=this.elevationInfo,Za=this.view.basemapTerrain,hb=Za.spatialReference,ib=Ta.mode;if(null==Ha||null==hb||ib===Z.ElevationMode.Absolute)sa.elevationOffsets=null;else{var pb=this._collection.getObjectTransform(sa.objectHandle);sa.elevationOffsets=sa.elevationOffsets??[];var ob=ib===Z.ElevationMode.OnTheGround,yb=this.view.renderCoordsHelper,wb=sa.featureIds.length,Fb=(()=>{if(sa.cachedElevationAnchors)return sa.cachedElevationAnchors;const nb=
R.newDoubleArray(3*wb);sa.cachedElevationAnchors=nb;for(let xb=0;xb<wb;xb++){const Ab=3*xb,Mb=sa.anchorIds?.indexOf(xb)??-1;sa.anchors&&0<=Mb?(I.set(Cb,sa.anchors[3*Mb],sa.anchors[3*Mb+1],sa.anchors[3*Mb+2]),I.add(Cb,Cb,Q.getCenter(sa.node.serviceMbsInIndexSR)),S.projectVectorToVector(Cb,Qa,Cb,hb),nb[Ab]=Cb[0],nb[Ab+1]=Cb[1],nb[Ab+2]=yb.getAltitude(Cb)):(this._collection.getComponentAabb(sa.objectHandle,xb,Ib,!0),I.set(Cb,(Ib[0]+Ib[3])/2,(Ib[1]+Ib[4])/2,Ib[2]),I.transformMat3(Cb,Cb,pb.rotationScale),
I.add(Cb,Cb,pb.position),nb[Ab+2]=yb.getAltitude(Cb),S.projectVectorToVector(Cb,Ha,Cb,hb),nb[Ab]=Cb[0],nb[Ab+1]=Cb[1])}return nb})(),zb=Ta.offset,Tb=sa.elevationOffsets;Za.getElevations(Fb,wb,(nb,xb)=>{const Ab=ob?Fb[3*nb+2]:0;Tb[nb]=zb+(null!=xb?xb-Ab:0)})}}_ensureElevationTask(){return null!=this._elevationTask?this._elevationTask:this._elevationTask=new Ca.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,sa=>{sa=this._controller.updateElevationChanged(sa,this.view.basemapTerrain.spatialReference);
return null!=sa?sa.filterInPlace(Ha=>null!=this._nodeId2Meta.get(Ha)):null},sa=>{sa=this._nodeId2Meta.get(sa);this._nodeElevationAlignmentChanged(sa)},()=>this.elevationInfo?.mode)}_elevationInfoChanged(sa,Ha){const Qa=sa.mode!==Z.ElevationMode.Absolute;sa=!!Ha&&Ha!==sa&&Ha.mode!==Z.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Qa,this.view.state.viewingMode);Qa&&!sa&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Ta=>this._nodeElevationAlignmentChanged(Ta))}_nodeElevationAlignmentChanged(sa){null!=
sa&&(this._updateElevationOffsets(sa),this._updateComponentData(sa),this._updateEdgeRendering(sa),null!=this._labeler&&this._labeler.updateLabelPositions(sa),this._updateSnappingSources(sa,sb.UPDATE))}_safeReschedule(sa,Ha){w.throwIfAborted(Ha);return this._controller.reschedule(sa,Ha)}_materialParameters(sa,Ha){sa=null!=sa.params.material?sa.params.material:pa.defaultMaterial();const Qa=Ha.some(Za=>"uvRegion"===Za.name);Ha=Ha.some(Za=>"normalCompressed"===Za.name);const Ta=na(sa);return{geometryParameters:this._getGeometryParameters({hasTexture:Ta,
hasNormals:Ha,hasRegions:Qa}),material:sa}}_initMaterialAndTextures(sa,Ha,Qa,Ta){const Za=this._stage.renderView,hb=Qa.map(pb=>pa.createTexture(pb,Ha,Ta,Za));this._stage.addMany(hb);let ib=null;this._collection.updateMaterial(sa,pb=>{ib=pa.configureMaterial(pb,Ha,hb,Qa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});
this._updateMaterialOverlay(pb)});return{textures:hb,texturePromise:ib}}_getGeometryParameters(sa){return{textureCoordinates:sa.hasTexture?sa.hasRegions?qb.TextureCoordinateAttributeType.Atlas:qb.TextureCoordinateAttributeType.Default:qb.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,hasNormals:sa.hasNormals&&this._needsNormals,needsNormals:this._needsNormals}}_addData(sa,Ha,Qa){let Ta=this._addTasks.get(sa.index);Ta?Ta.attributeInfo=Ha:(Ta={...w.createResolver(),attributeInfo:Ha,
meta:null},this._addTasks.set(sa.index,Ta),Qa().then(Ta.resolve,Ta.reject).then(()=>this._addTasks.delete(sa.index)).catch(Za=>{this._addTasks.delete(sa.index);throw Za;}));return Ta.promise}_clearAddTasks(){this._addTasks.forEach(sa=>{null!=sa.meta&&(this._cacheGPUData(sa.meta),sa.meta=null)});this._addTasks.clear()}_clippingAreaChanged(){var sa=this.view.renderSpatialReference;const Ha=this.i3slayer.spatialReference,Qa=P.create();this._renderClippingArea=bb.toBoundingRect(this.view.clippingArea,
Qa,sa)?Qa:null;sa=P.create();this._layerClippingArea=bb.toBoundingRect(this.view.clippingArea,sa,Ha)?sa:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()}get hasGeometryFilter(){return!1}_geometryFilterChange(){const sa=this.hasGeometryFilter;this._controller.geometryFilterChanged(sa);this._applyFilters(sa)}_filterChange(){this._applyFilters(this.hasGeometryFilter)}_applyFilters(sa){this._filters=
this.getFilters();sa?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Ha=>{null!=Ha&&this._applyFiltersToNode(Ha)&&(this._addOrUpdateEdgeRendering(Ha),this._visibleGeometryChanged(Ha,sb.UPDATE))})}getFilters(){const sa=[],Ha=this._renderClippingArea;null!=Ha&&sa.push((Qa,Ta)=>this._boundingRectFilter(Qa,Ta,Ha));return sa}addSqlFilter(sa,Ha,Qa){if(null!=Ha){const Ta=Ha.fieldNames;sa.push((Za,hb)=>this._sqlFilter(Za,hb,Ha,Ta,Qa))}}_sqlFilter(sa,Ha,Qa,Ta,Za){const hb={},ib=
this._createLayerGraphic(hb),pb=this.i3slayer.objectIdField,ob=Ha.featureIds,yb=Ha.attributeInfo?.attributeData;Ta.every(wb=>wb===pb||null!=yb?.[wb])&&Ea.filterInPlace(sa,ob,wb=>{hb[pb]=ob[wb];for(const Fb of Ta)Fb!==pb&&(hb[Fb]=yb?Ea.getCachedAttributeValue(yb[Fb],wb):null);try{return Qa.testFeature(ib)}catch(Fb){return Za(Fb),!1}})}_boundingRectNodeTest(sa,Ha){L.projectBoundingSphere(sa.node.serviceMbsInIndexSR,this._controller.crsIndex,fc,this.view.renderSpatialReference);return Ea.intersectBoundingRectWithMbs(Ha,
fc)}_boundingRectFeatureTest(sa,Ha,Qa){this._collection.getComponentAabb(sa.objectHandle,Ha,vb);N.toRect(vb,rb);return P.intersects(Qa,rb)}_boundingRectFilter(sa,Ha,Qa){var Ta=this._collection;const Za=this._boundingRectNodeTest(Ha,Qa);if(Za!==Ea.MbsIntersectResult.INSIDE)if(Za===Ea.MbsIntersectResult.OUTSIDE)sa.length=0;else if(Ta=Ta.getComponentCount(Ha.objectHandle),Ta.invisible+Ta.visible===Ha.featureIds.length){var hb=this._transformClippingArea(Eb,Qa,Ha.objectHandle);Ea.filterInPlace(sa,Ha.featureIds,
ib=>this._boundingRectFeatureTest(Ha,ib,hb))}}_transformClippingArea(sa,Ha,Qa){var Ta=this._collection.getObjectTransform(Qa);Qa=Ta.position;Ta=Ta.rotationScale;sa[0]=(Ha[0]-Qa[0])/Ta[0];sa[1]=(Ha[1]-Qa[1])/Ta[4];sa[2]=(Ha[2]-Qa[0])/Ta[0];sa[3]=(Ha[3]-Qa[1])/Ta[4];return sa}_addOrUpdateEdgeRendering(sa,Ha=!0){const Qa=this._edgeView;if(null==Qa)return Promise.resolve(null);const Ta=sa.objectHandle;var Za=Qa.hasObject(Ta);const {hasEdges:hb,perFeatureEdgeMaterials:ib}=this._getFilteredEdgeMaterials(sa),
pb={hasSlicePlane:this.slicePlaneEnabled};if(hb&&Za)return this.nodeCrossfadingEnabled&&(Za=this.getNodeOpacity(sa),ab(ib,Za)),Qa.updateAllComponentMaterials(Ta,ib,pb,Ha).catch(ob=>Ia(ob,this.i3slayer.title)),Qa.updateObjectVisibility(Ta,!0).catch(ob=>Ia(ob,this.i3slayer.title)),Qa.updateAllVerticalOffsets(Ta,sa.elevationOffsets).catch(ob=>Ia(ob,this.i3slayer.title)),Promise.resolve(Qa);if(hb&&!Za)return this._collection.addEdges(Ta,Qa,ib,pb).then(ob=>{sa.edgeMemoryUsage=ob;sa.node.memory+=ob;Qa.updateAllVerticalOffsets(Ta,
sa.elevationOffsets).catch(yb=>Ia(yb,this.i3slayer.title));return Qa});!hb&&Za&&(sa.node.memory-=sa.edgeMemoryUsage,sa.edgeMemoryUsage=0,Qa.removeObject(Ta));return Promise.resolve(null)}_applyFiltersToNode(sa){return this._applyFiltersToNodeComponents(sa)?(null!=this._labeler&&this._labeler.applyFilterChange(sa),!0):!1}_applyFiltersToNodeComponents(sa){const Ha=this._collection;var Qa=Ha.getComponentCount(sa.objectHandle),Ta=null!=sa.filteredIds;Qa=0===Qa.invisible;Ha.setAllComponentVisibilities(sa.objectHandle,
"all");if(0===this._filters.length)return sa.filteredIds=null,!Qa;this._updateCachedFilteredIds(sa);if(Ta&&sa.filteredIds===sa.featureIds)return!Qa;Ta=this._computeFilteredComponentIndices(sa);Ha.setAllComponentVisibilities(sa.objectHandle,Ta);return!0}_updateCachedFilteredIds(sa){if(null==sa.filteredIds||sa.appliedFilters!==this._filters)sa.filteredIds=this._computeFilteredIds(sa),sa.appliedFilters=this._filters}_computeFilteredIds(sa){const Ha=sa.featureIds.slice();for(const Qa of this._filters)if(Qa(Ha,
sa),0===Ha.length)break;return Ha.length===sa.featureIds.length?sa.featureIds:Ha}_computeFilteredComponentIndices(sa){const Ha=[],Qa=sa.filteredIds;null!=Qa&&sa.featureIds.forEach((Ta,Za)=>{Qa[Ha.length]===Ta&&Ha.push(Za)});return Ha}_removeAllNodeDataFromStage(sa=this.elevationOffset){this._nodeId2Meta.forEach((Ha,Qa)=>this._removeNodeStageData(Qa,sa));this._nodeId2MetaReloading.forEach((Ha,Qa)=>this._removeNodeStageData(Qa,sa,this._nodeId2MetaReloading));this._elevationTask=r.destroyMaybe(this._elevationTask)}removeNode(sa){const Ha=
this.elevationOffset;this._removeNodeStageData(sa,Ha);this._removeNodeStageData(sa,Ha,this._nodeId2MetaReloading);null!=this._elevationTask&&this._elevationTask.remove(sa)}_removeNodeStageData(sa,Ha,Qa=this._nodeId2Meta){Qa.has(sa)&&this._controller.updateLoadStatus(sa,!1);const Ta=Qa.get(sa);null==Ta?Qa.delete(sa):(this._collection.setObjectVisibility(Ta.objectHandle,!1),null!=this._edgeView&&this._edgeView.hasObject(Ta.objectHandle)&&this._edgeView.updateObjectVisibility(Ta.objectHandle,!1).catch(Za=>
Ia(Za,this.i3slayer.title)),this._visibleGeometryChanged(Ta,sb.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(Ta),Qa.delete(sa),this._highlights.objectDeleted(Ta),Qa===this._nodeId2Meta?(this._cacheGPUData(Ta,Ha),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Ta)):this._deleteComponentObject(Ta),null!=this._treeDebugger&&this._treeDebugger.update())}_deleteComponentObject(sa){null!=this._edgeView&&this._edgeView.removeObject(sa.objectHandle);this._memEstimateGeometryRemoved(sa.objectHandle);
this._collection.destroyObject(sa.objectHandle);if(sa.textures)for(const Ha of sa.textures)this._memEstimateTextureRemoved(Ha),this._stage.remove(Ha)}updateNodeState(sa,Ha){sa=this._nodeId2Meta.get(sa);null!=sa&&this._collection.updateMaterial(sa.objectHandle,Qa=>Qa.polygonOffsetEnabled=Ha===Aa.NodeState.Hole)}updateNodeIndex(sa,Ha){if(this._nodeId2Meta.has(sa)){var Qa=this._nodeId2Meta.get(sa);this._nodeId2Meta.delete(sa);this._nodeId2Meta.set(Ha,Qa);this.notifyChange("elevationRange")}if(Qa=this._nodeId2MetaReloading.get(sa))this._nodeId2MetaReloading.delete(sa),
this._nodeId2MetaReloading.set(Ha,Qa)}_invalidateAllSymbols(){this._rendererVersion=Ea.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()}_getInvalidRendererVersion(){return Ea.addWraparound(this._rendererVersion,-1)}async _rendererChange(sa){this._currentRenderer=sa;this.notifyChange("rendererTextureUsage");this._rendererVersion=Ea.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();
sa&&(this._rendererFields=await sa.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&sa&&"arcadeRequired"in sa&&sa.arcadeRequired&&(this._arcade=await ia.loadArcade());if(sa&&"visualVariables"in sa&&sa.visualVariables)for(const Ha of sa.visualVariables)"color"===Ha.type?this._colorVariable=Ha:"opacity"===Ha.type?this._opacityVariable=Ha:l.getLogger("esri.views.3d.layers.I3SMeshView3D").warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ha.type}`);
if(sa)for(const Ha of sa.getSymbols())"mesh-3d"!==Ha.type&&l.getLogger("esri.views.3d.layers.I3SMeshView3D").error(`Symbols of type '${Ha.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()}_getCachedEdgeMaterials(sa){this._hasComponentData&&sa.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(sa);return sa.cachedEdgeMaterials}_getComponentParameters(sa){this._hasComponentData&&sa.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(sa);const Ha=sa.cachedSymbology;return(Qa,Ta)=>{const Za=5*Qa;J.set(Ta.externalColor,Ha[Za]/255,Ha[Za+1]/255,Ha[Za+2]/255,Ha[Za+3]/255);if(null!=this._stage.renderView.objectAndLayerIdRenderHelper){const hb=sa.featureIds[Qa],ib=fa.isBasemapLayer(this.view.map,this.layerUid);this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(hb,hb,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabledAndHasTemplate&&!ib,sa.node.resources.attributes,
Qa,this.sublayerId);Ta.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:hb,layerUid:this.layerUid+"_"+this.sublayerId})}Ta.externalColorMixMode=Ha[Za+4]&(1<<eb.CastShadows)-1;Ta.castShadows=0!==(Ha[Za+4]&1<<eb.CastShadows);Ta.pickable=0!==(Ha[Za+4]&1<<eb.Pickable);Ta.elevationOffset=sa.elevationOffsets?.[Qa]??0}}_getSymbolInfo(sa,Ha){Ha=sa?.getSymbol(Ha,{arcade:this._arcade});if(!(Ha instanceof da))return null;sa=Ha.id;if(this._symbolInfos.has(sa))return this._symbolInfos.get(sa);
Ha=Ea.getSymbolInfo(Ha);this._symbolInfos.set(sa,Ha);return Ha}_setSymbologyOverride(sa,Ha){this._symbologyOverride!==sa&&(this._symbologyOverride=sa,this._symbologyOverrideFields=Ha,this._invalidateAllSymbols(),this._updateSymbologyFields())}_updateSymbologyFields(){this._symbologyFields=null!=this._symbologyOverrideFields&&0<this._symbologyOverrideFields.length?null!=this._rendererFields&&0<this._rendererFields.length?ca.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):
this._symbologyOverrideFields:this._rendererFields}_updateCachedRendererData(sa){sa.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Ha=this._tmpAttributeOnlyGraphic,Qa={};Ha.attributes=Qa;var Ta=this._currentRenderer,Za=sa.attributeInfo?.attributeData,hb=null!=sa.featureIds?this.i3slayer.objectIdField:null,ib=null!=Za&&null!=this._symbologyFields&&0<this._symbologyFields.length,pb=null,ob=null;if(ib&&null!=this._symbologyFields){pb=[];ob=[];for(var yb of this._symbologyFields){var wb=
Za[yb];wb&&(pb.push(yb),ob.push(wb))}}sa.cachedSymbology||(sa.cachedSymbology=V.newUByteArray(5*sa.featureIds.length));Za={color:Yb,castShadows:!0,pickable:!0,colorMixMode:Va.ColorMixModeEnum.Multiply,edgeMaterial:null};yb=this.fullOpacity;yb=this.nodeCrossfadingEnabled?this.getNodeOpacity(sa):yb;wb=null;var Fb=xa.Transparency.OPAQUE,zb=Ea.transparentEdgeMaterial,Tb=0;for(let Mb=0;Mb<sa.featureIds.length;Mb++){null!=hb&&(Qa[hb]=sa.featureIds[Mb]);if(ib&&pb)for(var nb=0;nb<pb.length;nb++)Qa[pb[nb]]=
Ea.getCachedAttributeValue(ob[nb],Mb);var xb=Ta?this._getSymbolInfo(Ta,Ha):null;let gc=nb=null;if(Ta&&"visualVariables"in Ta){if(this._colorVariable){var Ab=ba.getColor(this._colorVariable,Ha,{color:bc,arcade:this._arcade});Ab&&(nb=Yb,nb[0]=Ab.r/255,nb[1]=Ab.g/255,nb[2]=Ab.b/255,this._opacityVariable||null===Ab.a||(gc=Ab.a))}this._opacityVariable&&(gc=ba.getOpacity(this._opacityVariable,Ha,{arcade:this._arcade}))}xb?.material&&(Ab=xb.material,nb=null==nb||null==gc?oa.overrideColor(nb,gc,Ab.color,
Ab.alpha,Sa,Yb):oa.overrideColor(nb,gc,null,null,Sa,Yb));null==nb&&(nb=Yb,nb[0]=1,nb[1]=1,nb[2]=1,nb[3]=1);Za.pickable=!0;Za.castShadows=xb?xb.castShadows:!0;Za.colorMixMode=xb?.material?xb.material.colorMixMode:Va.ColorMixModeEnum.Multiply;Za.edgeMaterial=xb?xb.edgeMaterial:null;null!=this._symbologyOverride&&(Za.color=nb,this._symbologyOverride(Ha,Za),nb=Za.color);null!=this._nodeColorOverride&&(this._nodeColorOverride(sa.node,nb),Za.colorMixMode=Va.ColorMixModeEnum.Replace);if(null!=Za.edgeMaterial){xb=
0>=nb[3]?xa.Transparency.INVISIBLE:1<=nb[3]&&(sa.material.isOpaque||Za.colorMixMode===Va.ColorMixModeEnum.Replace)?xa.Transparency.OPAQUE:xa.Transparency.TRANSPARENT;if(Za.edgeMaterial!==wb||xb!==Fb)zb={...Za.edgeMaterial,opacity:yb,objectTransparency:xb},wb=Za.edgeMaterial,Fb=xb;sa.cachedEdgeMaterials[Mb]=zb}else sa.cachedEdgeMaterials[Mb]=Ea.transparentEdgeMaterial;sa.cachedSymbology[Tb++]=Math.round(255*nb[0]);sa.cachedSymbology[Tb++]=Math.round(255*nb[1]);sa.cachedSymbology[Tb++]=Math.round(255*
nb[2]);sa.cachedSymbology[Tb++]=Math.round(255*nb[3]);sa.cachedSymbology[Tb++]=Za.colorMixMode|+Za.castShadows<<eb.CastShadows|+Za.pickable<<eb.Pickable}}}_getFilteredEdgeMaterials(sa){var Ha=this._getCachedEdgeMaterials(sa);this.nodeCrossfadingEnabled||ab(Ha,this.fullOpacity);const Qa=sa.filteredIds;if(null==Qa)return{hasEdges:Ha.some(hb=>hb!==Ea.transparentEdgeMaterial),perFeatureEdgeMaterials:Ha};let Ta=0,Za=!1;Ha=Ha.map((hb,ib)=>{if(sa.featureIds[ib]!==Qa[Ta])return Ea.transparentEdgeMaterial;
Za=Za||hb!==Ea.transparentEdgeMaterial;Ta++;return hb});return{hasEdges:Za,perFeatureEdgeMaterials:Ha}}_updateComponentData(sa){if(this._hasComponentData){var Ha=sa.objectHandle;sa=this._getComponentParameters(sa);this._collection.setComponentData(Ha,sa);this._stage.renderView.requestRender()}}_reloadAll(sa=this.elevationOffset){this._removeAllNodeDataFromStage(sa);null!=this._controller&&this._controller.restartNodeLoading()}_opacityChange(sa){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();
this._nodeId2Meta.forEach(Ha=>{null!=Ha&&(this._collection.updateMaterial(Ha.objectHandle,Qa=>Qa.objectOpacity=sa),ab(Ha.cachedEdgeMaterials,sa),this._updateEdgeRendering(Ha))})}_updateMaterial(sa){this._collection.updateMaterial(sa.objectHandle,Ha=>{Ha.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Ha.usePBR=this._usePBR;this._updateMaterialOverlay(Ha)})}_updateMaterialOverlay(sa){}_updateEngineObject(sa){this._updateComponentData(sa);this._applyFiltersToNode(sa);this._addOrUpdateEdgeRendering(sa);
this._visibleGeometryChanged(sa,sb.UPDATE)}_slicePlaneEnabledChange(sa){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=sa);null!=this._labeler&&(this._labeler.slicePlaneEnabled=sa);this._nodeId2Meta.forEach(Ha=>{null!=Ha&&(this._collection.updateMaterial(Ha.objectHandle,Qa=>Qa.commonMaterialParameters.hasSlicePlane=sa),this._updateEdgeRendering(Ha,!1))})}_updatePBR(sa){this._nodeId2Meta.forEach(Ha=>{null!=Ha&&this._collection.updateMaterial(Ha.objectHandle,Qa=>Qa.usePBR=sa)});
this._hasLoadedPBRTextures=!0}get _usePBR(){return this._needsNormals&&this.view.qualitySettings.physicallyBasedRenderingEnabled}_updateEdgeRendering(sa,Ha=!0){null!=this._edgeView&&this._edgeView.hasObject(sa.objectHandle)&&this._addOrUpdateEdgeRendering(sa,Ha)}_forAllNodes(sa){this._nodeId2Meta.forEach(sa)}_ignoreClientNodeOverriddenFeatures(sa){return this.i3sOverrides.hasGeometryChanges?(Ha,Qa,Ta)=>0<=Ta.node.index&&this.i3sOverrides.featureHasGeometryChanges(Ha)?Z.ForAllFeaturesReturnType.CONTINUE:
sa(Ha,Qa,Ta):sa}_forAllFeatures(sa,Ha,Qa){f.someMap(this._nodeId2Meta,Ta=>{if(null==Ta)return!1;if(null!=Ha)switch(Ha(Ta)){case Z.ForAllFeaturesReturnType.EXIT:return!0;case Z.ForAllFeaturesReturnType.SKIP:return!1}let Za=Z.ForAllFeaturesReturnType.CONTINUE;switch(Qa){case Z.ForAllFeaturesMode.ALL:Za=this._forAllFeaturesOfNode(Ta,sa);break;case Z.ForAllFeaturesMode.VISIBLE_ONLY:Za=this._forAllVisibleFeaturesOfNode(Ta,sa);break;case Z.ForAllFeaturesMode.QUERYABLE:Za=this._forAllQueryableFeaturesOfNode(Ta,
sa)}return Za===Z.ForAllFeaturesReturnType.EXIT})}_forAllFeaturesOfNode(sa,Ha){let Qa=Z.ForAllFeaturesReturnType.CONTINUE;const Ta=sa.featureIds;for(let Za=0;Za<Ta.length&&(Qa=Ha(Ta[Za],Za,sa),Qa!==Z.ForAllFeaturesReturnType.EXIT);Za++);return Qa}_forAllVisibleFeaturesOfNode(sa,Ha){let Qa=Z.ForAllFeaturesReturnType.CONTINUE;const Ta=sa.featureIds;this._collection.forEachVisibleComponent(sa.objectHandle,Za=>{Qa=Ha(Ta[Za],Za,sa);return Qa===Z.ForAllFeaturesReturnType.CONTINUE});return Qa}_forAllQueryableFeaturesOfNode(sa,
Ha){Ha=this._ignoreClientNodeOverriddenFeatures(Ha);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(sa,Ha);var Qa=this._boundingRectNodeTest(sa,this._renderClippingArea);if(Qa===Ea.MbsIntersectResult.OUTSIDE)return Z.ForAllFeaturesReturnType.CONTINUE;if(Qa===Ea.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(sa,Ha);Qa=Z.ForAllFeaturesReturnType.CONTINUE;const Ta=sa.featureIds,Za=Ea.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(sa.objectHandle));
for(let hb=0;hb<Ta.length;hb++){if(!this._boundingRectFeatureTest(sa,hb,Za))continue;const ib=Ha(Ta[hb],hb,sa);if(ib===Z.ForAllFeaturesReturnType.EXIT)return ib}return Qa}_createAttributes(sa,Ha){const Qa={};null!=Ha.featureIds&&(Qa[this._getObjectIdField()]=Ha.featureIds[sa]);Ha=Ha.attributeInfo?.attributeData;if(null!=Ha)for(const Ta of Object.keys(Ha))Qa[Ta]=Ea.getCachedAttributeValue(Ha[Ta],sa);return Qa}_createGraphic(sa,Ha){return this._createLayerGraphic(this._createAttributes(sa,Ha))}highlight(sa){"number"===
typeof sa?sa=[sa]:sa instanceof k?sa=[sa]:sa instanceof e&&(sa=sa.toArray());if(Array.isArray(sa)&&0<sa.length){if(sa[0]instanceof k){const Ha=this.i3slayer.fieldsIndex,Qa=this._getObjectIdField();sa=sa.map(hb=>Ga.attributeLookup(Ha,hb.attributes,Qa));const {set:Ta,handle:Za}=this._highlights.acquireSet();this._highlights.setFeatureIds(Ta,sa);return Za}if("number"===typeof sa[0]){const {set:Ha,handle:Qa}=this._highlights.acquireSet();this._highlights.setFeatureIds(Ha,sa);return Qa}}return d.makeHandle()}resetHighlights(){r.destroyMaybe(this._highlights);
this._highlights=new va({collection:this._collection,forAllFeatures:sa=>this._forAllFeatures(sa,null,Z.ForAllFeaturesMode.ALL),forAllFeaturesOfNode:(sa,Ha)=>this._forAllFeaturesOfNode(sa,Ha)})}_visibleGeometryChanged(sa,Ha){if(this._elevationProvider){var Qa=this.getNodeComponentObb(sa.node);Qa&&this._elevationProvider.objectChanged(Qa);null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=t.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=
null}));this._updateSnappingSources(sa,Ha)}}get performanceInfo(){return new ha.I3SMeshViewPerformanceInfo(this.usedMemory,this._nodeId2Meta.size,Math.round(this._gpuMemoryEstimate/1048576),Math.round(this._geoMemoryEstimate/1048576),Math.round(this._texMemoryEstimate/1048576),Math.round(this.unloadedMemory/1048576),this._idbCacheEnabled?Math.round(100*this._idbCache.getHitRate()):0)}get test(){const sa=this,Ha=Qa=>{this._nodeColorOverride=Qa;this._invalidateAllSymbols()};return{controller:this._controller,
labeler:this._labeler,get visibleObjectIds(){const Qa=[];sa._forAllFeatures(Ta=>{Qa.push(Ta);return Z.ForAllFeaturesReturnType.CONTINUE},null,Z.ForAllFeaturesMode.VISIBLE_ONLY);Qa.sort((Ta,Za)=>Ta-Za);return Qa},get numNodes(){return sa._nodeId2Meta.size},get loadedNodes(){return Array.from(sa._nodeId2Meta.keys()).sort((Qa,Ta)=>Qa-Ta)},setNodeColorOverride:Ha,setNodeColoring:Qa=>{switch(Qa){case "client-nodes":Ha((Ta,Za)=>{0>Ta.index?(Za[0]=1,Za[1]=0,Za[2]=0):(Za[0]=1,Za[1]=1,Za[2]=1)});break;default:Ha(null)}}}}getNodeOpacityByIndex(sa){sa=
this._nodeId2Meta.get(sa);return this.getNodeOpacity(sa)}getNodeOpacity(sa){return null!=sa?this._collection.getMaterial(sa.objectHandle).objectOpacity:0}isNodeFullyFadedIn(sa){return this._crossfadeHelper.isNodeFullyFadedIn(sa)}getNodeCrossfadeMetaData(sa){return this._nodeId2Meta.get(sa)}markNodeToRemove(sa){this._controller&&this._controller.markNodeToRemove(sa)}removeMarkedNodes(){this._controller&&this._controller.removeMarkedNodes()}foreachCrossfadeNode(sa){this._nodeId2Meta.forEach(sa)}fadeNode(sa,
Ha,Qa){if(this.nodeCrossfadingEnabled){var Ta=this._nodeId2Meta.get(sa);null!=Ta&&this._crossfadeHelper.fadeNode(sa,Ta,Ha,Qa)}}setNodeOpacityByIndex(sa,Ha){sa=this._nodeId2Meta.get(sa);null!=sa&&this._setNodeOpacity(sa,Ha)}_setNodeOpacity(sa,Ha){this._collection.updateMaterial(sa.objectHandle,Qa=>Qa.objectOpacity=Ha);this._setNodeEdgeOpacity(sa,Ha)}_setNodeEdgeOpacity(sa,Ha){null!=this._edgeView&&sa.cachedEdgeMaterials&&(ab(sa.cachedEdgeMaterials,Ha),sa=sa.objectHandle,this._edgeView.hasObject(sa)&&
this._edgeView.updateAllComponentOpacities(sa,Ha).catch(Qa=>Ia(Qa,this.i3slayer.title)))}get hasModifications(){return this._isIntegratedMesh&&null!=this._layerClippingArea||this._modifications&&0<this._modifications.length}updateNodeModificationStatus(sa){var Ha=sa.length;if(this.hasModifications&&!(0>=Ha)&&!0===this._i3sWasmLoaded){Ha=this.uid;var Qa=Wa(sa);if(Qa){ja.filterObbsForModificationsSync({context:Ha,buffer:Qa.buffer});const Ta=new Float64Array(Qa.buffer);sa.forAll((Za,hb)=>{hb=ja.interpretObbModificationResults(Ta[hb]);
Za.imModificationImpact=hb;hb!==Aa.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Za.index)})}}}notifyUpdate(){this.notifyChange("updating")}notifyLODUpdate(){this._controller.notifyLODUpdate()}isUpdating(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||this._crossfadeHelper?.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||null!=this._elevationTask&&
this._elevationTask.running}trackSnappingSources(sa){const Ha={events:sa,fetchEdgeLocations:async(Qa,Ta,Za)=>{Qa=this._nodeId2Meta.get(Qa);if(null==Qa)throw Error("invalid-node");const {origin:hb,buffer:ib}=await this._collection.extractEdgeInformation(Qa.objectHandle,Ta,Za);this._snappingLocationsApplyElevation(Qa,ib,hb);return{type:"components",objectIds:Qa.featureIds,locations:ib,origin:hb}},remove:()=>m.removeUnordered(this._snappingSourcesTrackers,Ha)};this._snappingSourcesTrackers.push(Ha);
this._nodeId2Meta.forEach((Qa,Ta)=>{null!=Qa&&(Qa=this._controller.getRenderMbs(Qa.node))&&sa.add(Ta,Qa)});return Ha}_snappingLocationsApplyElevation(sa,Ha,Qa){if(sa.elevationOffsets&&this.elevationInfo.mode!==Z.ElevationMode.Absolute){var Ta=Ha.position0,Za=Ha.position1;Ha=Ha.componentIndex;var hb=H.create(),ib=H.create(),pb=(ob,yb)=>{I.add(ob,ob,Qa);this.view.renderCoordsHelper.worldUpAtPosition(ob,ib);I.add(ob,ob,I.scale(ib,ib,yb));I.subtract(ob,ob,Qa)};for(let ob=0;ob<Ta.count;ob++){const yb=
sa.elevationOffsets[Ha.get(ob)];Ta.getVec(ob,hb);pb(hb,yb);Ta.setVec(ob,hb);Za.getVec(ob,hb);pb(hb,yb);Za.setVec(ob,hb)}}}_updateSnappingSources(sa,Ha){const {index:Qa}=sa.node;sa=this._controller.getRenderMbs(sa.node);if(null!=sa)for(const Ta of this._snappingSourcesTrackers)Ha!==sb.REMOVE&&Ha!==sb.UPDATE||Ta.events.remove(Qa),Ha!==sb.ADD&&Ha!==sb.UPDATE||Ta.events.add(Qa,sa)}};n.__decorate([v.property()],jb.prototype,"_hasLoadedPBRTextures",void 0);n.__decorate([v.property()],jb.prototype,"_asyncModuleLoading",
void 0);n.__decorate([v.property()],jb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);n.__decorate([v.property()],jb.prototype,"view",void 0);n.__decorate([v.property()],jb.prototype,"i3slayer",void 0);n.__decorate([v.property()],jb.prototype,"_controller",void 0);n.__decorate([v.property()],jb.prototype,"_labeler",void 0);n.__decorate([v.property()],jb.prototype,"updating",void 0);n.__decorate([v.property()],jb.prototype,"suspended",void 0);n.__decorate([v.property()],jb.prototype,"contentVisible",
null);n.__decorate([v.property({readOnly:!0})],jb.prototype,"legendEnabled",null);n.__decorate([v.property()],jb.prototype,"holeFilling",void 0);n.__decorate([v.property(cb.updatingProgress)],jb.prototype,"updatingProgress",void 0);n.__decorate([v.property()],jb.prototype,"updatingProgressValue",null);n.__decorate([v.property()],jb.prototype,"hasTexturesOrVertexColors",null);n.__decorate([v.property()],jb.prototype,"rendererTextureUsage",null);n.__decorate([v.property()],jb.prototype,"elevationOffset",
null);n.__decorate([v.property()],jb.prototype,"elevationInfo",null);n.__decorate([v.property({type:Boolean})],jb.prototype,"slicePlaneEnabled",void 0);n.__decorate([v.property()],jb.prototype,"supportedTextureEncodings",null);n.__decorate([v.property()],jb.prototype,"uncompressedTextureDownsamplingEnabled",null);n.__decorate([v.property({type:[X]})],jb.prototype,"_modifications",void 0);n.__decorate([v.property({readOnly:!0})],jb.prototype,"clientGeometry",null);n.__decorate([v.property()],jb.prototype,
"elevationRange",null);n.__decorate([v.property()],jb.prototype,"fullExtent",null);n.__decorate([v.property()],jb.prototype,"_elevationTask",void 0);n.__decorate([v.property({readOnly:!0})],jb.prototype,"_usePBR",null);return jb=n.__decorate([y.subclass("esri.views.3d.layers.I3SMeshView3D")],jb)};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localLinearScaleFactors":function(){define(["exports","../../chunks/vec32","./projectors","../support/Ellipsoid",
"../support/spatialReferenceUtils"],function(a,b,n,h,k){a.localLinearScaleFactors=function(m,g,e,d){if(null==g||null==d)return!1;const c=n.classifySpatialReference(g,n.sourceClassificationCache);var l=n.classifySpatialReference(d,n.destClassificationCache);if(c===l&&c!==n.ProjectionID.UNKNOWN||k.equals(g,d))return e[0]=1,e[1]=1,e[2]=1,!0;if(c===n.ProjectionID.SPHERICAL_ECEF){g=b.length(m);m=g/Math.sqrt(m[0]*m[0]+m[1]*m[1]);g/=h.earth.radius;if(l===n.ProjectionID.WEB_MERCATOR)return e[0]=m*g,e[1]=
m*g,e[2]=1,!0;if(l===n.ProjectionID.WGS84||l===n.ProjectionID.CGCS2000)return l=n.invPlateCarreeScale,e[0]=l*m*g,e[1]=l*g,e[2]=1,!0}else if(c===n.ProjectionID.PLATE_CARREE){if(l===n.ProjectionID.WGS84||l===n.ProjectionID.CGCS2000)return e[0]=n.invPlateCarreeScale,e[1]=n.invPlateCarreeScale,e[2]=1,!0;if(l===n.ProjectionID.WEB_MERCATOR)return l=m[1]/h.earth.radius,e[0]=1,e[1]=1/Math.cos(l),e[2]=1,!0}return!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectBoundingSphere":function(){define(["exports",
"../../core/mathUtils","../../core/libs/gl-matrix-2/factories/vec3f64","./projectors","../support/Ellipsoid"],function(a,b,n,h,k){function m(c,l,f,r){l=r+l;if(l<r/2||f>l)return Number.MAX_VALUE;c=Math.abs(d*c)+Math.asin(f/l);return c>=Math.PI/2?Number.MAX_VALUE:f/Math.cos(c)}const g=n.create(),e=h.createEmptyProjectorCache(),d=b.deg2rad(1);a.projectBoundingSphere=function(c,l,f,r){if(null==l||null==r)return!1;l=h.populateProjectorCache(l,r,e);if(l.projector===h.copy3)return f[0]=c[0],f[1]=c[1],f[2]=
c[2],f[3]=c[3],!0;if(null==l.projector)return!1;const {source:x,dest:w}=l;if(w.spatialReferenceId===h.ProjectionID.WEB_MERCATOR){l=h.projectionTable[x.spatialReferenceId][h.ProjectionID.WGS84];if(null==l)return!1;l(c,0,g,0);h.wgs84ToWebMercator(g,0,f,0);f[3]=m(g[1],c[2],c[3],k.earth.radius);return!0}if(x.spatialReferenceId!==h.ProjectionID.WGS84&&x.spatialReferenceId!==h.ProjectionID.CGCS2000||w.spatialReferenceId!==h.ProjectionID.PLATE_CARREE)l.projector(c,0,f,0),f[3]=c[3]*(x.metersPerUnit??1)/(w.metersPerUnit??
1);else{r=h.projectionTable[h.ProjectionID.SPHERICAL_ECEF][h.ProjectionID.PLATE_CARREE];let p=c[3];null!=h.projectionTable[x.spatialReferenceId][h.ProjectionID.SPHERICAL_ECEF]&&null!=r&&(p=m(c[1],c[2],c[3],k.earth.radius));l.projector(c,0,f,0);f[3]=p}return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UByteArray":function(){define(["exports","../../core/typedArrayUtil"],function(a,b){a.newUByteArray=function(n,h=!1){return n<=b.nativeArrayMaxSize?h?Array(n).fill(0):
Array(n):new Uint8Array(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection/projectBoundingRect ../../../geometry/support/aaBoundingRect ../dehydratedPoint ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SClientNodeLoader ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/3d/support/MemoryController ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){function K(R,O){return null!=R&&R.length===O.length&&R.every(T=>0<=L(O,T.name))}function L(R,O){O=O.toLowerCase();for(let T=0;T<R.length;T++)if(R[T].name.toLowerCase()===O)return T;return-1}b=class extends m.EsriPromiseMixin(b){get isMeshPyramid(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}get isGraphics3D(){return"points"===this.layer.profile}get useMaximumNumberOfFeatures(){return!this.isMeshPyramid&&
(null==this.layer.priority||"High"===this.layer.priority)}get indexStreamController(){const R=this.layerView.view.resourceController.createStreamDataRequester(H.ClientType.I3S_INDEX);return new G.I3SStreamDataController(R,this.layer.customParameters,this.layer.apiKey)}get dataStreamController(){const R=this.layerView.view.resourceController.createStreamDataRequester(H.ClientType.I3S_DATA);return new G.I3SStreamDataController(R,this.layer.customParameters,this.layer.apiKey)}get crsVertex(){return A.getVertexCrs(this.layer)}get crsIndex(){return A.getIndexCrs(this.layer)}get layer(){return this.layerView.i3slayer}get running(){return this.updating}get rootNodeVisible(){if(this._index){const R=
this._index.rootNode;if(R)return this._updateViewData(),this._index.isNodeVisible(R.index)}return!0}get index(){return this._index}get requiredAttributes(){return this._requiredAttributes}constructor(R){super(R);this.screenSizeFactor=0;this.featureTarget=5E4;this.fixedFeatureTarget=!1;this.updating=!0;this.updatingProgress=1;this.leavesReached=!1;this.scaleVisibilityEnabled=!0;this.worker=null;this._featureLOD=1;this._isIdle=this._stableFeatureLOD=!1;this._cameraDirty=!0;this._invisibleDirty=!1;this._idleStateCallbacks=
null;this._newLoadingNodes=new k({deallocator:null});this._loadedNodeScales=new Map;this._modificationsNodeFilteringArray=new k;this._downloadingCount=0;this._loadingNodes=new Map;this._updatingNodes=new Map;this._progressMaxNumNodes=1;this._requiredAttributes=[];this._requiredAttributesDirty=!0;this._restartNodeLoading=this._disableMemCache=this.disableIDBCache=this._updatesDisabled=!1;this._attributeStorageInfo=this._fields=null;this._idleQueue=new w.PromiseQueue;this._elevationUpdateNodes=new k({deallocator:null});
this._errorCount=0}initialize(){const {layerView:R,layer:O}=this;this._disableMemCache=!R.loadCachedGPUData||!R.addCachedGPUData;this._lodHandling=new v(R);this._defaultGeometrySchema=O.store.defaultGeometrySchema;this.disableIDBCache=n("disable-feature:idb-cache");"fields"in O&&(this._fields=O.fields,this._attributeStorageInfo=O.attributeStorageInfo);this.addResolvingPromise(Promise.all([O.indexInfo,O.when(),R.when()]).then(([T])=>{if(!this.destroyed&&R&&!R.destroyed&&T){var {view:Q,clientGeometry:V}=
R,{resourceController:U}=Q;this._setClippingArea(Q.clippingArea);this.addHandles([e.watch(()=>Q?.pointsOfInterest?.focus?.renderLocation,W=>this._pointOfInterestChanged(W),e.initial),e.watch(()=>Q.quality,()=>this._setCameraDirty(),e.sync),e.watch(()=>R.contentVisible,W=>{const ca=W?()=>this._updateIdleState(!0):()=>this._updateViewData(),X=W?()=>this._updateIdleState(!1):()=>{};W&&null!=this._index&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(W||this.cancelNodeLoading(),
this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ca,this._idleStateCallbacks.idleEnd=X):this._idleStateCallbacks=U.scheduler.registerIdleStateCallbacks(ca,X)},e.initial),q.addCallback(R.view.resourceController.scheduler,this),e.watch(()=>R.uncompressedTextureDownsamplingEnabled,()=>this.restartNodeLoading()),e.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),e.watch(()=>Q.state?.contentCamera,()=>this._setCameraDirty()),e.watch(()=>
O.elevationInfo,W=>this._elevationInfoChanged(W)),e.watch(()=>O.effectiveScaleRange,()=>this._scaleBoundsChanged()),e.watch(()=>R.lodFactor,()=>this._setCameraDirty()),e.watch(()=>R.availableFields,()=>this._requiredFieldsChange()),e.watch(()=>R.holeFilling,W=>null!=this._index&&(this._index.holeFilling=W))]);this._updateScaleHandles();this._viewportQueries=new C(this.crsIndex,Q.renderCoordsHelper,Q.state.contentCamera,!Q.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?
Q.basemapTerrain:Q.elevationProvider,p.viewingModeFromString(Q.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._clientNodeLoader=new t.I3SClientNodeLoader(this.layer.uid,{indexSR:this.crsIndex,vertexSR:this.crsVertex,renderSR:Q.renderCoordsHelper.spatialReference,localMode:"local"===Q.viewingMode},Q.resourceController.memoryController,this.worker);this._index=new u.I3SIndex(p.viewingModeFromString(Q.viewingMode),
O,T,this.indexStreamController,this._clientNodeLoader,this._viewportQueries,h.getLogger(this),R.holeFilling,W=>R.isNodeLoaded(W),W=>R.isNodeReloading(W),W=>this._shouldLoadNode(W),W=>this._enableFromGPUCache(W,y.NodeState.Leaf),W=>this._needsUpdate(W),()=>!this.indexStreamController.busy,W=>R.computeVisibilityObb?.(W)??null,R?.computeNodeFiltering?W=>R.computeNodeFiltering(W):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid||this.isGraphics3D);this._index.imModificationsChanged(!!R.hasModifications);
this._index.layerFilterChanged(!!R.hasGeometryFilter);if(null!=V){for(const W of V)this._addMesh(W.mesh,W.oid);this.addHandles(V.on("change",W=>{for(const ca of W.removed)this._removeMesh(ca.oid);for(const ca of W.added)this._addMesh(ca.mesh,ca.oid)}))}this._startNodeLoading()}}));this._tmpPoint=x.makeDehydratedPoint(0,0,0,this.crsIndex)}updateNodeModificationStatus(R){const O=this._index,T=this.layerView;null!=O&&T?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),R.forAll(Q=>
{Q=O.getNode(Q);null!=Q&&this._modificationsNodeFilteringArray.push(Q)}),T.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)}destroy(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._nodeLoader=null;F.prune();null!=M&&(M.hide(),M=null)}get viewportQueries(){return this._viewportQueries}_getRequiredAttributes(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];
const R=this._attributeStorageInfo,O=this._fields,T=this.layer.objectIdField;return this.layerView.availableFields.map(Q=>{const V=L(R,Q);Q=L(O,Q);return 0<=V&&0<=Q?{index:V,name:O[Q].name,field:O[Q],attributeStorageInfo:R[V]}:null}).filter(Q=>null!=Q&&Q.name!==T)}_requiredFieldsChange(){const R=this._getRequiredAttributes();K(this._requiredAttributes,R)||(this._requiredAttributes=R,this._requiredAttributesDirty=!1,this.restartNodeLoading())}requestUpdate(){this._requiredAttributesDirty=!0;this.restartNodeLoading()}_setClippingArea(R){const O=
r.create();I.toBoundingRect(R,O,this.layerView.view.renderSpatialReference)?this._clippingArea=O:this._clippingArea=null}_pointOfInterestChanged(R){null!=this._viewportQueries&&(this._viewportQueries.setPointOfInterest(R),null!=this._index&&(this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))}updateClippingArea(R){this._setClippingArea(R);null!=this._viewportQueries&&null!=this._index&&(this._viewportQueries.updateClippingArea(this._clippingArea),
this._index.invalidateVisibilityCache());this._setCameraDirty()}_setCameraDirty(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}_addMesh(R,O){null!=this._index&&(R=this._clientNodeLoader.createMeshNodeInfo(R,O),O=this._index.addClientNodeToIndex(R.id,R.mbs),this._clientNodeLoader.addMeshNode(O,R),this._evaluateUpdating(),this.notifyChange("rootNodeVisible"))}_removeMesh(R){R=this._clientNodeLoader.getMeshNodeIndex(R);if(null!=R)if(null!=this._index)this._index.removeClientNodeFromIndex(R,
(O,T)=>{this.layerView.removeNode(T);this._loadedNodeScales.delete(T);this._clientNodeLoader.removeNode(O);this.layerView.deleteCachedNodeData&&null!=O&&this.layerView.deleteCachedNodeData(O);this.layerView.deleteCachedGPUData?.(this.layerView.loadCachedGPUData?.(T))},(O,T,Q)=>{this._clientNodeLoader.updateNodeIndex(O,T,Q);this.layerView.updateNodeIndex&&this.layerView.updateNodeIndex(T,Q)}),this.notifyChange("rootNodeVisible");else throw Error("delayed removal of client side i3s node geometry not supported yet.");
}updateElevationChanged(R,O){const T=this._index;if(null==T?.rootNode||null==O)return null;this.crsIndex.equals(O)||(f.projectBoundingRect(R,O,N,this.crsIndex),R=N);const Q=this._elevationUpdateNodes;Q.clear();A.findIntersectingNodes(R,T.rootNode,T,V=>Q.push(V.index));Q.length&&(Q.forAll(V=>T.updateElevationChanged(V)),this._setCameraDirty());return Q}removeAllGeometryObbs(){null!=this._index&&this._index.removeAllGeometryObbs()}getRenderMbs(R){return null!=this._viewportQueries?this._viewportQueries.getServiceMbsInRenderSR(R):
null}_elevationInfoChanged(R){null!=this._index&&(this._index.updateElevationInfo(R,this.isMeshPyramid||this.isGraphics3D),this._setCameraDirty())}_updateScaleHandles(){this.removeHandles("scale-bounds");this._areScaleBoundsActive&&this.addHandles(this.layerView.view.basemapTerrain.on("scale-change",R=>this._scaleUpdateHandler(R)),"scale-bounds")}_scaleBoundsChanged(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()}_scaleUpdateHandler(R){this._updateScaleInBoundingRect(R.extent,
R.spatialReference);this._setCameraDirty()}_updateScaleInBoundingRect(R,O){const T=this._index;null!=T&&null!=T.rootNode&&f.projectBoundingRect(R,O,N,this.crsIndex)&&this._loadedNodeScales.forEach((Q,V)=>{Q=T.getNode(V);null!=Q&&r.intersectsSphere(N,Q.serviceMbsInIndexSR)&&this._loadedNodeScales.set(V,this._computeScale(Q))})}restartNodeLoading(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()}schedule(R,O){return this._idleQueue.push(R,O)}reschedule(R,O){return this._idleQueue.unshift(R,
O)}get _isIntegratedMesh(){return"integrated-mesh"===this.layer.type}get _areScaleBoundsActive(){const {minScale:R,maxScale:O}=B.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<R||0<O)}get unloadedMemoryEstimate(){return null!=this._index&&this.layerView.contentVisible?this._index.unloadedMemoryEstimate*this._lodDropFactor:0}async _loadNodeData(R,O){return 0>R.index?this._clientNodeLoader.loadNodeData(R.id,O):this._nodeLoader.loadNodeData(R,O)}async _loadAttributes(R,O,T){return(0>
R.index?this._clientNodeLoader:this._nodeLoader).loadAttributes(R,O,T)}get indexDepth(){return null!=this._index?this._index.maxLevel:0}set disableMemCache(R){this._disableMemCache=this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData?R:!0}runTask(R,O){if(!this.layerView.contentVisible)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||null==this._index)return-Infinity;this._processWithErrorLogging(R,O);return this._index.maxPriority}_processWithErrorLogging(R,
O){try{this._process(R,O)}catch(T){50>this._errorCount?h.getLogger(this).error(`Error during processing: ${T} at ${T.stack}`):50===this._errorCount&&h.getLogger(this).error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}}_process(R,O){this._restartNodeLoading&&this._startNodeLoading();null!=this._nodeLoader&&null!=this._index&&(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(R)&&(this._invisibleDirty=!1),this._isIntegratedMesh&&
(R.enabled=!1),R.run(()=>this._processIndex(R)),this._updateFeatureLOD(),R.run(()=>this._processCache(R)),this._isIntegratedMesh&&(R.enabled=!0),R.run(()=>this._processNodes(R,O)),this._idleQueue.runTask(R),R.run(()=>this._prefetchIndex()),O.numIndexLoading+=this._index.indexLoading,O.numNodesLoading+=this._downloadingCount,R.run(()=>this._lodHandling.lodGlobalHandling(R)),this._evaluateUpdating())}_processIndex(R){if(null==this._index)return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),
R,O=>this.updateNodeModificationStatus(O)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),R=this._index.featureEstimate.leavesReached,this._index.isLoading||R===this._get("leavesReached")||this._set("leavesReached",R));return this._index.load()}_prefetchIndex(){return null==this._index||0<this._loadingNodes.size||0<this._index.updates.add.length?
!1:this._index.prefetch()}_updateFeatureLOD(){if(this.useMaximumNumberOfFeatures&&null!=this._index&&null!=this._viewportQueries){var R=!this._index.isLoading,O=this.featureTarget*this._baseLOD,T=this._index.featureEstimate;T.estimate=T.estimate||O/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(R&&T.estimate<O){if(T.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(O/
T.estimate,1.001));R=this._lod;O=this._index.checkFeatureTarget(O,R);O!==R&&(this._featureLOD=O/this._baseLOD,this._stableFeatureLOD=!0)}else if(T.estimate>1.2*O||R&&T.estimate>O){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(T.estimate/O-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.requestUpdate()}}_processCache(R){const O=this._index;if(null==O)return!1;
for(;0<this._newLoadingNodes.length&&!R.done;){var T=this._newLoadingNodes.pop();for(T=O.getParent(T);null!=T&&!this.layerView.isNodeLoaded(T.index)&&this._isNodeInScaleBounds(T);T=O.getParent(T.index))if(this._enableFromGPUCache(T,y.NodeState.Hole)){R.madeProgress();break}}return R.hasProgressed}_processNodes(R,O){if(null==this._index)return!1;let T=(this._isIdle?100:2)-this._loadingNodes.size;const Q=this._index.updates;Q.cancel.forEach(this._cancelNode,this);for(Q.cancel=[];0<Q.remove.length&&
!R.done;)this.layerView.removeNode(Q.remove.pop()),R.madeProgress();for(;0<Q.update.length&&!R.done;){var V=this._index.getNode(Q.update.pop());null!=V&&(this._updateLoadedNode(V),R.madeProgress())}for(;0<Q.add.length&&!R.done&&0<T;){--T;V=this._index.getNode(Q.add.back());if(null==V||V.cacheState!==y.CacheState.Cached&&!this._hasNodeLoadToken(O))break;Q.add.pop();this._loadNode(V);R.madeProgress()}return R.hasProgressed}_cancelAllNodes(){this._loadingNodes.forEach(R=>R.abort());this._loadingNodes.clear();
this._updatingNodes.forEach(R=>R.abort());this._updatingNodes.clear()}_cancelNode(R){const O=this._loadingNodes.get(R);O&&(O.abort(),this._loadingNodes.delete(R))}_hasNodeLoadToken(R){return!this._isIdle&&2<=R.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<H.maxDownloadSlots&&!this.dataStreamController.busy}_evaluateUpdating(){let R=!1;var O=0;this.layerView&&(this.layerView.contentVisible?(O=(null!=this._index?this._index.indexMissing:0)+3*(null!=this._index?this._index.updates.add.length:
0)+2*this._loadingNodes.size,R=!!(0<O||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||null!=this._index&&this._index.isPrefetching),0===O&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(O,this._progressMaxNumNodes),O=1-O/this._progressMaxNumNodes):O=(R=this._cameraDirty)?0:1,this.updating=R,this.updatingProgress=O)}_updateViewData(){if(this._cameraDirty&&null!=this._index&&
null!=this._viewportQueries){var R=this.layerView.view,{contentCamera:O,fixedContentCamera:T}=R.state;this.screenSizeFactor=1/(O.perScreenPixelRatio/2);this._viewportQueries.updateCamera(O,!T||this.isGraphics3D);this._viewportQueries.setPointOfInterest(R.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();
this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}}_getProgressiveLoadFactor(){return 1>this.layerView.view.quality?1:this.layerView.progressiveLoadFactor}get _lod(){return this._featureLOD*this._baseLOD}get _baseLOD(){const R=this.layerView.lodFactor;return this.fixedFeatureTarget?1:(0<R?R:1)*this.layerView.view.quality}get _lodDropFactor(){return this.fixedFeatureTarget?1:(Math.min(this.layerView.view.quality,.5)-J.minQuality)/(.5-J.minQuality)}isGeometryVisible(R){return!!this._index?.isGeometryVisible(R.index)}updateVisibility(R){this._index?.invalidateNodeVisibilityCache(R)}invalidateGeometryVisibility(R){this._index?.invalidateGeometryVisibility(R)}invalidateVisibilityObbs(){this._index?.invalidateVisibilityObbs()}modificationsChanged(){this._index?.imModificationsChanged(!!this.layerView.hasModifications);
this._invisibleDirty=!0}_shouldLoadNode(R){return this._lodHandling.shouldLoadNode(R)&&!this._shouldDropNode(R)&&null!=this._index&&this._index.isGeometryVisible(R.index)?this._isNodeInScaleBounds(R):!1}_shouldDropNode(R){if(null==this._viewportQueries)return!1;const O=this._lodDropFactor;return 1<=O||!this._lodHandling.hasNoVisibleChildren(R)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(R))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*
O}_startNodeLoading(){this._restartNodeLoading=!1;const R=this._index;if(!this._updatesDisabled&&null!=R&&null!=this._viewportQueries){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var O={textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures};
this._nodeLoader=new D(this.layer,this.dataStreamController,h.getLogger(this),this._defaultGeometrySchema,this._requiredAttributes,O);R.requestUpdate();this._lodHandling.startNodeLoading(T=>this._isNodeInScaleBounds(T),(T,Q)=>this._removeNodes(T,Q,P.fadeout),R,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}}isNodeLoading(){return null!=this._nodeLoader&&null!=this._index}cancelNodeLoading(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())}_removeInvisibleNodes(R){const O=this._index;if(null==O||null==this._viewportQueries)return!1;F.clear();this.layerView.getLoadedNodeIndices(F);const T=0===this._viewportQueries.maxDistance,Q=T?()=>!1:V=>this._shouldDropNode(V);F.filterInPlace(V=>{const U=O.getNode(V);return null==U||!O.isGeometryVisible(V)||Q(U)||!this._isNodeInScaleBounds(U)});0<F.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(F,
R,P.pop);if(T&&1>this._lodDropFactor)return!1;if(0===F.length)return!0;F.clear();return!1}markNodeToRemove(R){F.push(R)}removeMarkedNodes(){this._removeNodes(F,z.noBudget,P.pop)}_removeNodes(R,O,T){const Q=R.length;if(0!==Q&&!O.done){for(null!=this._index&&this._index.requestUpdate();0<R.length&&!O.done;){const V=R.pop(),U=this._index;T===P.fadeout&&this.layerView.nodeFadeoutEnabled&&null!=U&&U.isGeometryVisible(V)?this.layerView.fadeNode(V,E.FadeDirection.FadeOut,!0):this.layerView.removeNode(V);
O.madeProgress()}if(0<this._loadedNodeScales.size)for(O=R.length;O<Q;O++)this._loadedNodeScales.delete(R.data[O])}}_needsUpdate(R){if(R.resources.isEmpty||this._updatingNodes.has(R.index))return!1;R=this.layerView.getLoadedAttributes(R.index);return null!=R&&R!==this._requiredAttributes}async _updateLoadedNode(R){const O=new AbortController;this._updatingNodes.set(R.index,O);this._evaluateUpdating();try{const T=this.layerView.getLoadedAttributes(R.index);let Q=null;Q=K(T,this._requiredAttributes)?
this.layerView.getAttributeData(R.index):await this._loadAttributes(R,this._requiredAttributes,O.signal);await this.schedule(()=>this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:Q},O.signal),O.signal)}catch(T){if(!g.isAbortError(T))return this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},O.signal)}this._updatingNodes.delete(R.index);this._evaluateUpdating()}_loadNode(R){if(this._loadingNodes.has(R.index))h.getLogger(this).error("already loading node "+
R.index);else{var O=new AbortController;this._loadingNodes.set(R.index,O);this._evaluateUpdating();this._loadAndAddNode(R,O.signal).then(T=>{T&&null!=this._index&&this._loadingNodes.get(R.index)===O&&(this._loadingNodes.delete(R.index),this._index.requestUpdate())}).catch(T=>{if(!g.isAbortError(T))throw T;}).finally(()=>{this._loadingNodes.get(R.index)===O&&this._loadingNodes.delete(R.index);this._evaluateUpdating()})}}_loadAndAddNode(R,O){return R.cacheState===y.CacheState.Uncached?this._loadUncached(R,
O).then(()=>!1):this._loadCached(R,O).then(T=>{if(T)return!1;R.cacheState=y.CacheState.Uncached;return!0}).catch(T=>g.isAbortError(T)?!1:(R.cacheState=y.CacheState.Uncached,!0))}_enableFromGPUCache(R,O){if(this._disableMemCache||null==this._index)return!1;if(O===y.NodeState.Hole&&!this._index.useNodeAsHole(R.index))return!0;const T=this._loadCachedGPUData(R);if(!T)return!1;this.layerView.addCachedGPUData(R,T,O);this._nodeAdded();return!0}_loadCachedGPUData(R){R=this.layerView.loadCachedGPUData(R.index);
if(null!=R?.attributeInfo&&K(R.attributeInfo.loadedAttributes,this._requiredAttributes))return R;this.layerView.deleteCachedGPUData(R);return null}_nodeAdded(){null!=this._index&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()}updateLoadStatus(R,O){const T=this._index;null!=T&&T.updateChildrenLoaded(R,O?1:-1)}async _loadCached(R,O){if(this._enableFromGPUCache(R,y.NodeState.Leaf))return!0;const T=this.layerView;if(this.disableIDBCache||!T.loadCachedNodeData||
!T.addCachedNodeData)return!1;const Q=(ba,ia)=>this._nodeLoader.loadTextures(R,ba,ia),V=(ba,ia)=>this._clientNodeLoader.loadTextures(R,ba,ia),U=0<=R.index?Q:V,W=await this.schedule(()=>T.loadCachedNodeData(R,O,U),O);if(null==W)return!1;const ca=this._requiredAttributes,X=await this.reschedule(()=>this._loadAttributes(R,ca,O),O);await this.reschedule(()=>T.addCachedNodeData(R,W,{loadedAttributes:ca,attributeData:X},O),O);this._nodeAdded();return!0}_loadUncached(R,O){this._downloadingCount++;return this._loadNodeData(R,
O).catch(T=>{this._downloadingCount--;throw T;}).then(T=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(R,T,O),O)}).then(()=>{this._nodeAdded();R.cacheState=y.CacheState.Cached}).catch(T=>{if(!g.isAbortError(T))throw h.getLogger(this).error("#loadNodeData()",this.layer,`Failed to load node '${R.id}'`,T),R.failed=!0,null!=this._index&&this._index.requestUpdate(),T;})}_updateIdleState(R){R!==this._isIdle&&(this._isIdle=R,this._evaluateUpdating(),R&&this._index&&null!=this._index&&
this._index.resetFailedNodes())}_getScale(R){if(this._loadedNodeScales.has(R.index))return this._loadedNodeScales.get(R.index);const O=this._computeScale(R);this.layerView.isNodeLoaded(R.index)&&this._loadedNodeScales.set(R.index,O);return O}_computeScale(R){this._tmpPoint.x=R.serviceMbsInIndexSR[0];this._tmpPoint.y=R.serviceMbsInIndexSR[1];this._tmpPoint.z=R.serviceMbsInIndexSR[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,R.serviceMbsInIndexSR[3])}_isNodeInScaleBounds(R){if(!this._areScaleBoundsActive)return!0;
R=this._getScale(R);const {minScale:O,maxScale:T}=B.extractSafeScaleBounds(this.layer);return B.scaleBoundsPredicate(R,O,T)}get test(){const R=this;return{index:this._index,set disableUpdates(O){(R._updatesDisabled=O)?R.cancelNodeLoading():R.requestUpdate()},set disableIDBCache(O){R.disableIDBCache=O},set ignoreServiceObb(O){null!=R._index&&(R._index.ignoreServiceObb=O)},shouldLoadNode:O=>R._shouldLoadNode(O)}}notifyLODUpdate(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();null!=
this._index&&this._index.requestUpdate()}geometryFilterChanged(R){const O=this._index;null!=O&&O.layerFilterChanged(R);this._setCameraDirty()}};a.__decorate([d.property({readOnly:!0})],b.prototype,"isMeshPyramid",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"isGraphics3D",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"useMaximumNumberOfFeatures",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"indexStreamController",null);a.__decorate([d.property({readOnly:!0})],
b.prototype,"dataStreamController",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"crsVertex",null);a.__decorate([d.property({readOnly:!0})],b.prototype,"crsIndex",null);a.__decorate([d.property()],b.prototype,"screenSizeFactor",void 0);a.__decorate([d.property()],b.prototype,"featureTarget",void 0);a.__decorate([d.property()],b.prototype,"fixedFeatureTarget",void 0);a.__decorate([d.property()],b.prototype,"layerView",void 0);a.__decorate([d.property()],b.prototype,"layer",null);a.__decorate([d.property()],
b.prototype,"updating",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"running",null);a.__decorate([d.property()],b.prototype,"updatingProgress",void 0);a.__decorate([d.property({readOnly:!0})],b.prototype,"leavesReached",void 0);a.__decorate([d.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);a.__decorate([d.property({constructOnly:!0})],b.prototype,"worker",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",null);b=
a.__decorate([l.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b);const F=new k({deallocator:null});let M;const S={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=r.create();var P;(function(R){R[R.pop=0]="pop";R[R.fadeout=1]="fadeout"})(P||={});return b})},"esri/views/3d/layers/i3s/I3SClientNodeLoader":function(){define("exports ../../../../core/Error ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/uuid ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/meshVertexSpaceUtils ../../../../chunks/sphere ./I3SClientMaterialUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){function w(u,v){var {spatialReference:y}=u;const D=[1,-1],G=[.5*u.width,.5*u.height,u.hasZ?.5*(u.zmax-u.zmin):0];y=y.isGeographic?y.metersPerUnit:1;const A=u.center;let C=0;if(u.hasZ)for(u=0;2>u;++u)for(var E=0;2>E;++E)for(var I=0;2>I;++I){var H=(A.x+D[u]*G[0]-v.x)*y;const J=(A.y+D[E]*G[1]-v.y)*y,B=A.z+D[I]*G[2]-v.z;C=Math.max(H*H+J*J+B*B,C)}else for(u=0;2>u;++u)for(E=0;2>E;++E)I=(A.x+D[u]*G[0]-v.x)*y,H=(A.y+D[E]*G[1]-v.y)*y,C=Math.max(I*I+H*H,C);return r.fromCenterAndRadius([v.x,
v.y,v.z],Math.sqrt(C))}async function p(u,v,y,D){const {transform:G,vertexAttributes:A}=v.loadedMesh;u="source"===u.shading?A.normal:null;if(null==u||null==G||0===G.rotationAngle&&d.exactEquals(G.scale,c.ONES))return{transformed:u,original:A.normal};if(!v.normalsTransformPromise){n.assertIsSome(y,"SceneLayerWorker is needed to transform mesh normals");const C=e.create();g.normalFromMat4(C,G.localMatrix);v.normalsTransformPromise=y.transformNormals({normalMatrix:C,normals:u},D)}return v.normalsTransformPromise}
function t(u,v,y){u[v]=255&y;u[v+1]=255&y>>8;u[v+2]=255&y>>16;u[v+3]=255&y>>24}class q{constructor(u,v,y,D){this._uid=u;this._worker=D;this._id2Meta=new Map;this._oid2Meta=new Map;this._indexSR=v.indexSR;this._vertexSR=v.vertexSR;this._renderSR=v.renderSR;this._localMode=v.localMode;this._memCache=y.newCache(`sl-client-mesh-data-${this._uid}`)}get uid(){return this._uid}get worker(){return this._worker}get indexSR(){return this._indexSR}get renderSR(){return this._renderSR}createMeshNodeInfo(u,v){const y=
`mesh${v}`;var D=u.extent,G=D.spatialReference,A=this._indexSR;D=w(D,u.origin);l.projectBoundingSphere(D,G,D,A);A=u.metadata.displaySource?.source;if(null==A||!Array.isArray(A)||!A.length||A[0]instanceof File)var C=m.generateUUID();else{G="";for(C of A)G+=C.makeHash();C=JSON.stringify(null!=u.transform?u.transform.toJSON():"");A=f.isRelativeVertexSpace(u.vertexSpace)?JSON.stringify(u.vertexSpace.origin):"";C=G+C+A}return{type:"mesh",id:y,version:C,oid:v,mbs:D,componentNodeIds:[],unloadedMesh:u,nodeIndex:null,
loadMeshPromise:null}}addMeshNode(u,v){if(null!=this.getMeshNodeIndex(v.oid))throw new b(`I3SClientNodeLoader: client side mesh for feature oid=${v.oid} already exists`);v.nodeIndex=u;this._id2Meta.set(v.id,v);this._oid2Meta.set(v.oid,v)}getMeshNodeIndex(u){u=this._oid2Meta.get(u);return null==u||"mesh"!==u.type?null:u.nodeIndex}removeNode(u){const v=this._id2Meta.get(u);null!=v&&(this._id2Meta.delete(u),"mesh"===v.type&&this._oid2Meta.delete(v.oid))}async loadNodeJSON(u){const v=this._id2Meta.get(u);
if(null==v)throw new b(`I3SClientNodeLoader::loadNodeJSON unable to find node ${u}`);switch(v.type){case "mesh":return this._loadMeshNodeJSON(v);case "mesh-component":return this._loadMeshComponentNodeJSON(v);default:throw new b(`I3SClientNodeLoader::loadNodeJSON unable to handle node ${u}`);}}async _loadMeshNodeJSON(u){const v=u.id;var y=(await this._getMeshData(u)).loadedMesh;if(null==y.components||0===y.components.length)return{id:v,version:null,mbs:u.mbs,obb:null,sharedResource:null,geometryData:null,
attributeData:null,featureData:null,children:null};const D=[];y=y.components;for(let G=0;G<y.length;++G){const A=`${v}-component${G}`,C={type:"mesh-component",id:A,mbs:u.mbs,componentIndex:G,meshNodeInfo:u,textureData:new Map};this._id2Meta.set(C.id,C);u.componentNodeIds.push(A);D.push({id:C.id,href:null,mbs:C.mbs,obb:null})}return{id:v,version:null,mbs:u.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:D}}updateNodeIndex(u,v,y){(u=this._id2Meta.get(u))&&
"mesh"===u.type&&(u.nodeIndex=y)}async _loadMeshComponentNodeJSON(u){return{id:u.id,version:u.meshNodeInfo.version,mbs:u.mbs,obb:null,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:null,isEmpty:!1}}async loadNodeData(u,v){var y=this._id2Meta.get(u);if(null==y||"mesh-component"!==y.type)throw new b(`Failed to load client node data for node ${u} (unexpected node info)`);var D=y.meshNodeInfo,G=await this._getMeshData(D),A=G.loadedMesh;D=D.oid;if(null==A.components)throw new b(`Failed to load client node data for node ${u} (unexpected null reference)`);
u=A.components[y.componentIndex];const {material:C,requiredTextures:E,textureData:I}=await x.convertMeshMaterialToPBRMaterial(u.material);if(null!=I)for(var H of I)null!=H&&y.textureData.set(H.id,H);y={params:{material:C},type:"ArrayBufferView"};const {vertexSpace:J,origin:B,transform:z}=A;H=[B.x,B.y,B.z??0];y={featureDataPosition:H,featureIds:[],geometries:[y]};G.projectionPromise||(n.assertIsSome(this._worker,"SceneLayerWorker is needed to project mesh"),G.projectionPromise=this._worker.project({positions:A.vertexAttributes.position,
localMatrix:z?.localMatrix,vertexSpace:J.toJSON(),origin:H,inSpatialReference:A.spatialReference.toJSON(),outSpatialReference:this._vertexSR.toJSON(),localMode:this._localMode},v));const {projected:K,original:L}=await G.projectionPromise;A.vertexAttributes.position=L;const {transformed:F,original:M}=await p(u,G,this._worker,v);A.vertexAttributes.normal=M;k.throwIfAborted(v);v=u.faces;G=A.vertexAttributes.uv;A=A.vertexAttributes.color;u=v.length/3;var S=3*u,N,P=0;H=!1;var R=0;let O=!1;var T=0;let Q=
!1;var V=0;let U=0,W=0;P=N=8;N+=12*S;null!=F&&(H=!0,R=N,N+=12*S);null!=G&&(O=!0,T=N,N+=8*S);null!=A&&(Q=!0,V=N,N+=4*S);U=N;W=N+=8;N=new ArrayBuffer(N+8);const ca=new Uint8Array(N);t(ca,0,S);t(ca,4,1);S=new Float32Array(N,P);R=null!=F?new Float32Array(N,R):null;T=null!=G?new Float32Array(N,T):null;V=null!=A?new Uint8Array(N,V):null;for(P=0;P<u;++P){const aa=3*P;for(let ea=0;3>ea;++ea){var X=v[aa+ea],ba=3*X,ia=9*P+3*ea;S[ia]=K[ba];S[ia+1]=K[ba+1];S[ia+2]=K[ba+2];null!=R&&(R[ia]=F[ba],R[ia+1]=F[ba+1],
R[ia+2]=F[ba+2]);null!=T&&(ba=2*X,ia=6*P+2*ea,T[ia]=G[ba],T[ia+1]=G[ba+1]);null!=V&&(X*=4,ba=12*P+4*ea,V[ba]=A[X],V[ba+1]=A[X+1],V[ba+2]=A[X+2],V[ba+3]=A[X+3])}}t(ca,U,D);t(ca,U+4,D/2**32);t(ca,W,0);t(ca,W+4,u-1);const {geometryBuffer:fa,geometryDescriptor:da}={geometryBuffer:N,geometryDescriptor:{isDraco:!1,isLegacy:!0,color:Q,normal:H,uv0:O,uvRegion:!1,featureIndex:!0}};return{geometryData:y,attributeDataInfo:{attributeData:{},loadedAttributes:[]},geometryBuffer:fa,geometryDescriptor:da,requiredTextures:E,
textureData:I,normalReferenceFrame:this._vertexSR.isGeographic?"east-north-up":"vertex-reference-frame"}}async loadAttributes(u,v,y){u=u.numFeatures;y={};for(const {field:{name:D}}of v)y[D]=Array(u);return y}async loadTextures(u,v,y){y=this._id2Meta.get(u.id);if(null==y||"mesh-component"!==y.type)throw Error(`Failed to load textures for node ${u.id} (unexpected node info)`);u=[];for(const D of v)u.push(y.textureData.get(D.id)||null);return u}async _getMeshData(u){const v=u.version,y=this._memCache.get(v);
if(null==y){if(null!=u.loadMeshPromise)return u.loadMeshPromise;const D=async(G,A)=>{var C=u.unloadedMesh.clone();try{await C.load()}catch(E){A(E)}A=C.memoryUsage;C={loadedMesh:C,projectionPromise:null,normalsTransformPromise:null,usedMemoryInBytes:A};this._memCache.put(v,C,A,h.MinPriority);u.loadMeshPromise=null;G(C)};u.loadMeshPromise=new Promise((G,A)=>D(G,A));return u.loadMeshPromise}return y}}a.I3SClientNodeLoader=q;a.createSphereFromExtent=w;a.sizeOfFloat32=4;a.sizeOfInt32=4;a.sizeOfUInt64=
8;a.sizeOfUInt8=1;a.transformNormals=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SClientMaterialUtil":function(){define("exports ../../../../Color ../../../../core/Error ../../../../support/requestUtils ../../glTF/internal/resourceUtils ./enums ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/textureUtils ../../webgl-engine/materials/pbrUtils".split(" "),function(a,b,n,h,k,m,g,e,d){async function c(l,f,r,x){if(null==l)return-1;const w=
r.length;var p=l.data;l=l.url;if(null!=p){if(p instanceof HTMLImageElement||p instanceof HTMLCanvasElement)return p=e.downsampleImage(p),r.push({id:w,usage:x,data:p,encoding:m.TextureEncoding.PNG,downsampled:!1}),f.push({id:w,usage:x,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),w;if(!(p instanceof HTMLVideoElement)){if(p instanceof ImageData)throw new n("ImageData textures not supported yet for client side I3S nodes");if(p instanceof k.EncodedMeshTexture)throw new n("EncodedMeshTexture textures not supported yet for client side I3S nodes");
}}else if(null!=l)return p=new Image,p.src=l,p=await h.loadImageAsync(p,p.src,!1,void 0),p=e.downsampleImage(p),r.push({id:w,usage:x,data:p,encoding:m.TextureEncoding.PNG,downsampled:!1}),f.push({id:w,usage:x,encodings:[{name:void 0,encoding:m.TextureEncoding.PNG}]}),w;return-1}a.convertMeshMaterialToPBRMaterial=async function(l){const f=[],r=[];if(null==l)return{material:{alphaMode:"opaque",alphaCutoff:.1,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,
0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:f,textureData:r};const x=l.hasOwnProperty("metallicRoughnessTexture");"auto"===l.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const w=d.useSchematicPBR({normalTexture:l.normalTexture,emissiveTexture:x?l.emissiveTexture:null,emissiveFactor:x?
b.toUnitRGB(l.emissiveColor):null,occlusionTexture:x?l.occlusionTexture:null,metallicRoughnessTexture:x?l.metallicRoughnessTexture:null,metallicFactor:x?l.metallic:null,roughnessFactor:x?l.roughness:null}),p=w?d.defaultSchematicMRRFactors[0]:x?l.metallic:0,t=w?d.defaultSchematicMRRFactors[1]:x?l.roughness:0;return{material:{alphaMode:"auto"===l.alphaMode?"blend":l.alphaMode,alphaCutoff:l.alphaCutoff,doubleSided:l.doubleSided,cullFace:l.doubleSided?g.CullFaceOptions.None:g.CullFaceOptions.Back,normalTextureId:await c(l.normalTexture,
f,r,m.TextureUsage.Normal),emissiveTextureId:x?await c(l.emissiveTexture,f,r,m.TextureUsage.Emissive):-1,occlusionTextureId:x?await c(l.occlusionTexture,f,r,m.TextureUsage.Occlusion):-1,emissiveFactor:x&&null!=l.emissiveColor?b.toUnitRGB(l.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=l.color?b.toUnitRGBA(l.color):[1,1,1,1],baseColorTextureId:await c(l.colorTexture,f,r,m.TextureUsage.Color),metallicRoughnessTextureId:x?await c(l.metallicRoughnessTexture,f,r,m.TextureUsage.MetallicRoughness):
-1,metallicFactor:p,roughnessFactor:t},wrapTextures:!0,hasParametersFromSource:w},requiredTextures:f,textureData:r}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(b){b[b.None=
0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/handleUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c){let l=class extends n{constructor(){super();this.referenceCount=0;this.callbacks=[];this.runIndex=0}get running(){return this.callbacks.some(x=>x.running)}runTask(x){this._sort();const w=this.callbacks,p={numIndexLoading:0,numNodesLoading:0};for(let t=0;t<w.length&&!x.done;++t)w[t].priority=w[t].runTask(x,p),this.runIndex=t}_sort(){const x=this.callbacks;let w=x.length;for(let p=this.runIndex;0<p;p--){const t=x[p-1];let q=p;for(;q<x.length&&t.priority<=x[q].priority&&
(q!==w||t.priority<x[q].priority);)x[q-1]=x[q],q++;x[q-1]=t;w=q-1}this.runIndex=0}add(x){this._sort();x.priority=Infinity;this.callbacks.unshift(x);this.notifyChange("running")}remove(x){h.removeUnordered(this.callbacks,x);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")}};b.__decorate([m.property({readOnly:!0})],l.prototype,"running",null);l=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],l);class f{constructor(x,w){this.task=x;this.handle=w}}const r=
new Map;a.addCallback=function(x,w){let p=r.get(x);if(null==p){const t=new l,q=x.registerTask(c.TaskPriority.I3S_CONTROLLER,t);p=new f(t,q);r.set(x,p)}p.task.add(w);return k.makeHandle(()=>{null!=p&&(p.task.remove(w),0<p.task.callbacks.length||(r.delete(x),p.handle.remove(),p.task.destroy()),p=null)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../core/has ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../geometry/projection/projectBoundingSphere ../../../../chunks/sphere ../../../../support/featureFlags ./I3SNode ./I3SUtil ./ValidatedNode ../../support/ElevationRange ../../support/orientedBoundingBox".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f){function r(B,z){return 0>B?-1:0<z?B/z|0:0}function x(B,z){return 0>B?-B-1:0===z?B:B%z}function w(B,z,K){return-1===z?-(B+1):0===K?B:z*K+B}function p(B){if(B)for(let z=0;z<B.length;z++)for(const K of G)if(K[0]===B[z].metricType)return{lodMetric:K[1],maxError:B[z].maxError};return{lodMetric:e.LodMetric.None,maxError:0}}function t(B){return Math.sqrt(4/Math.PI*B)}class q{constructor(B,z,K,L,F){this.childOffset=B;this.childCount=z;this.visibilityCache=K;this.ref=L;this.node=
F;this.useAsHole=0;this.filterImpact=e.NodeFilterImpact.NotChecked;this.traversalState=null;this.parent=-1}}class u{constructor(B=[],z=[]){this.nodes=B;this.children=z;this.numNodesWithLoadedChildren=this.lastTraversed=0}}class v{get _useNodePages(){return 0<this._pageSize}constructor(B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W){this.viewingMode=B;this._layer=z;this._streamDataController=L;this._clientNodeLoader=F;this._viewportQueries=M;this._logger=S;this.holeFilling=N;this._isLoaded=P;this._isReloading=R;
this._isSelected=O;this._enable=T;this._needsUpdate=Q;this._canRequest=V;this._computeVisibilityObb=U;this._computeNodeFiltering=W;this._dirty=!0;this._nodePages=new Map;this._clientNodePage=null;this._rootIndex=this._pageSize=0;this._lodMetric=e.LodMetric.None;this._lodConversion=ca=>ca;this._isEditable=!1;this._urlPrefix="";this._loadingNodes=new Set;this._loadingPages=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;
this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._version=d.addWraparound(0,2);this._visibilityCacheVersion=d.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;this._missingPagesAndNodes=new n({deallocator:null});this._prefetchNodes=new n({deallocator:null});this._updates=new D(this._missingPagesAndNodes);this._imModificationUncategorized=new n({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=
[];this._newPages=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._frameNumber=0;this._traverseDescendantsQueue=[0];this._traverseDescendantsNestingLevel=0;this._isEditable=g.i3sPatchingEnabled()&&null!=z.associatedLayer?.infoFor3D;z.serviceUpdateTimeStamp?.lastUpdate&&(this._lastUpdate=`${z.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(K)}_init(B){if("page"===B.type){var z=B.rootPage;
this._urlPrefix=B.urlPrefix;this._pageSize=B.pageSize;switch(B.lodMetric){case "maxScreenThreshold":this._lodMetric=e.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=e.LodMetric.MaxScreenThreshold,this._lodConversion=t}if(this._isEditable){this._rootIndex=-1;var K=x(B.rootIndex,B.pageSize);K=z.nodes[K];K={nodes:[{index:this._rootIndex,children:[B.rootIndex],mesh:void 0,obb:K.obb,lodThreshold:K.lodThreshold}]};this._addPage(r(this._rootIndex,this._pageSize),K);this.getNode(-1).serviceObbInIndexSR=
void 0}else this._rootIndex=B.rootIndex;this._addPage(r(B.rootIndex,this._pageSize),z);this._updateParentsAndLevel()}else"node"===B.type&&(this._urlPrefix=B.urlPrefix,z=new u,this._nodePages.set(0,z),this._isEditable?(this._clientNodePage=new u,z={id:"-1",version:null,mbs:B.rootNode.mbs,obb:B.rootNode.obb,sharedResource:null,geometryData:null,attributeData:null,featureData:null,children:[{id:"root",href:"../root",mbs:B.rootNode.mbs,obb:B.rootNode.obb}]},this._rootIndex=this._makeClientRefNode(new e.NodeBase(z.id,
null),-1),(z=this._validateNode(z.id,z))&&this._addNode(z,this._rootIndex)):this._rootIndex=this._makeRefNode(new e.NodeBase(B.rootNode.id,null),-1),(B=this._validateNode(B.rootNode.id,B.rootNode))&&this._addNode(B,0))}addClientNodeToIndex(B,z){B=new e.NodeBase(B,z);B=this._makeClientRefNode(B,-1);this._linkChildToParentNode(-1,B);this.requestUpdate();return B}removeClientNodeFromIndex(B,z,K){this._destroyClientRefNode(B,z,K);this.requestUpdate()}_loadPage(B){this._loadingPages.add(B);this._streamDataController.request(this._urlPrefix+
B,"json").then(z=>{this._pageQueue.push({pageIndex:B,page:z})}).catch(z=>{this._loadingPages.delete(B);h.isAbortError(z)||(this._failedPages.add(B),this._logger.error("#loadPage()",this._layer,`Error when loading page ${B}`,z))})}_addQueuedPages(B){for(;0<this._pageQueue.length&&!B.done;){const {pageIndex:z,page:K}=this._pageQueue.shift();this._addPage(z,K);this._loadingPages.delete(z);B.madeProgress();this.needNodeElevationRange&&this._newPages.push(z)}this._updateParentsAndLevel()}_invalidateElevationRangeForNewPages(B){if(this.needNodeElevationRange)for(;0<
this._newPages.length&&!B.done;)this._nodePages.get(this._newPages.shift())?.nodes.forEach(z=>{for(z=z.parent;null!=z&&z!==this._rootIndex;){const K=this.getNode(z);K&&!Number.isNaN(K?.elevationRangeMin)&&(K.invalidateElevationRange(),this.invalidateBoundingVolumeCache(z));z=this.getParentIndex(z)}})}_addPage(B,z){const K=[],L=[];z=z.nodes.map((F,M)=>{const S=K.length,N=F.children?F.children.length:0;L.push(this._rootIndex);for(var P=0;P<N;P++)K.push(F.children[P]);const R=`${F.index}`;P=f.Obb.fromJSON(F.obb);
const O=m.fromCenterAndRadius(P.center,P.radius);var T=F.mesh?.attribute;const Q=F.mesh?.geometry,V=F.mesh?.material;T={hasSharedResource:!1,isEmpty:null==Q,attributes:null!=T?.resource?`${T.resource}`:void 0,geometry:null!=Q?.resource?`${Q.resource}`:void 0,texture:null!=V?.resource?`${V.resource}`:void 0,geometryDefinition:Q?Q.definition:-1,materialDefinition:V?V.definition:-1};F=new e.Node(R,w(M,B,this._pageSize),O,N,0,T,this._lastUpdate,this._lodMetric,this._lodConversion(F.lodThreshold),Q?Q.featureCount:
null);F.serviceObbInIndexSR=P;F.visibilityObbInRenderSR=this._computeVisibilityObb(F);F.vertexCount=Q?Q.vertexCount:0;return new q(S,N,d.addWraparound(this._visibilityCacheVersion,-2),null,F)});z=new u(z,K);-1===B?this._clientNodePage=z:this._nodePages.set(B,z)}_updateParentsAndLevel(){const B=[],z=(K,L,F)=>{var M=this._getPage(K);if(null!=M){const S=x(K,this._pageSize);M=M.nodes[S];M.parent=null!=L?L:-1;L=M.node;null!=L&&(L.level=F,B.push(K))}};for(z(this._rootIndex,null,0);B.length;){const K=B.pop(),
L=this.getNode(K);if(null!=L)for(let F=0;F<L.childCount;F++){const M=this.getChildIndex(L.index,F);z(M,K,L.level+1);this._maxLevel=Math.max(this._maxLevel,L.level+1)}}}_getPage(B){B=r(B,this._pageSize);return this._getPageFromPageIndex(B)}_getPageFromPageIndex(B){return 0>B?this._clientNodePage:this._nodePages.get(B)}_getNodeInternal(B){const z=this._getPage(B);if(null==z)return null;z.lastTraversed=this._frameNumber;return z.nodes[x(B,this._pageSize)]}_addNode(B,z){B.children&&this.populateChildren(z,
B.children);var K=this.getParent(z);const L=null!=K?K.level+1:0;this._maxLevel=Math.max(this._maxLevel,B.children?L+1:L);const {lodMetric:F,maxError:M}=p(B.lodSelection);K=this._getNodeInternal(z);z=new e.Node(B.id,z,B.mbs,K.childCount,L,B.resources,B.version,F,M,B.numFeatures);K.node=z;B.obb&&(z.serviceObbInIndexSR=f.Obb.fromJSON(B.obb));z.visibilityObbInRenderSR=this._computeVisibilityObb(z);K=K.ref;null!=K&&(null==K.serviceMbsInIndexSR&&(K.serviceMbsInIndexSR=B.mbs),z.shareServiceBVsInRenderSRWith(K),
K.visibilityObbInRenderSR=z.visibilityObbInRenderSR);return z}_makeRefNode(B,z){const K=this._nodePages.get(0);if(-1>z)return this._makeClientRefNode(B,z);if(null==K)return-1;const L=K.nodes.length,F=new q(0,0,d.addWraparound(this._visibilityCacheVersion,-2),B,null);K.nodes.push(F);F.parent=z;B.invalidateServiceBVsInRenderSR();return L}_makeClientRefNode(B,z){const K=this._clientNodePage;if(null==K)return-1;if(0<=z)throw Error("I3SIndex::client side nodes can not be made children of service side nodes.");
const L=-(K.nodes.length+1),F=new q(0,0,d.addWraparound(this._visibilityCacheVersion,-2),B,null);K.nodes.push(F);F.parent=z;B.invalidateServiceBVsInRenderSR();return L}_linkChildToParentNode(B,z){const K=this._clientNodePage;if(!(null==K||0<=B)){var L=x(B,this._pageSize),F=x(z,this._pageSize);L=K.nodes[L];var M=L.childOffset;K.children.splice(L.childOffset+L.childCount,0,z);L.childCount+=1;null!=L.node&&(L.node.childCount+=1);for(const S of K.nodes)S.childOffset>M&&(S.childOffset+=1);K.nodes[F].parent=
B;this._updateParentBoundingInformation(B)}}_destroyClientRefNode(B,z,K){const L=this._clientNodePage;if(null!=L){var F=this.getParentIndex(B);if(null!=F){var M=new Set,S=new Map,N=ca=>{var X=x(ca,this._pageSize);X=L.nodes[X];if(0<X.childCount)for(var ba=X.childOffset;ba<X.childOffset+X.childCount;++ba)N(L.children[ba]);ba=X.node?.id??X.ref?.id;if(null==ba)throw Error("Node has no id");z(ba,ca);M.add(X)};N(B);B=L.nodes;var P=L.children,R=L.nodes.map(()=>-1),O=[],T=[];for(var Q=0;Q<B.length;++Q){var V=
B[Q];if(!M.has(V)){var U=O.length,W=w(Q,-1,this._pageSize);U=w(U,-1,this._pageSize);V.node&&(V.node.index=U);R[Q]=U;O.push(V);if(W!==U){V=V.node?.id??V.ref?.id;if(null==V)throw Error("Node has no id");K(V,W,U);S.set(W,U)}}}for(K=0;K<O.length;++K){S=w(K,-1,this._pageSize);Q=O[K];W=T.length;for(V=Q.childOffset;V<Q.childOffset+Q.childCount;++V)if(U=P[V],0<=U)T.push(U);else{U=x(U,this._pageSize);const ca=B[U];M.has(ca)||(T.push(R[U]),ca.parent=S)}Q.childOffset=W;Q.childCount=T.length-W;Q.node&&(Q.node.childCount=
Q.childCount)}L.nodes=O;L.children=T;this._updateParentBoundingInformation(R[x(F,this._pageSize)])}}}_updateParentBoundingInformation(B){do{let L=null;var z=this._clientNodeLoader.indexSR;const F=this._clientNodeLoader.renderSR,M=this._getNodeInternal(B);if(null==M)break;for(let S=0;S<M.childCount;S++){var K=this.getChildIndex(B,S);K=this._getNodeInternal(K);K=null!=K?K.ref||K.node:null;if(null!=K&&0<K.serviceMbsInIndexSR[3])if(null==L)L=m.copy(K.serviceMbsInIndexSR,C);else{const N=E,P=I,R=H;k.projectBoundingSphere(K.serviceMbsInIndexSR,
z,N,F);k.projectBoundingSphere(L,z,P,F);m.union(N,P,R);k.projectBoundingSphere(R,F,L,z)}}z=M.ref||M.node;if(null!=z){if(null!=L){let S;(S=z).serviceMbsInIndexSR??(S.serviceMbsInIndexSR=m.create());m.copy(L,z.serviceMbsInIndexSR)}else d.invalidateMbs(z.serviceMbsInIndexSR);z.invalidateServiceBVsInRenderSR();z.geometryObbInRenderSR=null}this.invalidateNodeVisibilityCacheInternal(M);B=this.getParentIndex(B)}while(null!=B)}populateChildren(B,z){var K=this._getNodeInternal(B);const L=this._getPage(B);
K.childOffset=L.children.length;K.childCount=z.length;for(K=0;K<z.length;K++){const F=this._makeRefNode(z[K],B);L.children.push(F)}}getNode(B){B=this._getNodeInternal(B);return null!=B?B.node:null}getIndexById(B){let z;this._forAllNodes((K,L)=>{null!=K.node&&K.node.id===B?z=L:null!=K.ref&&K.ref.id===B&&(z=L)});return z}getNodeById(B){B=this.getIndexById(B);return null!=B&&0<=B?this.getNode(B):null}getChildIndex(B,z){const K=this._getPage(B);if(null==K)return-1;B=K.nodes[x(B,this._pageSize)];return K.children[B.childOffset+
z]}getParentIndex(B){const z=this._getPage(B);return null!=z&&B!==this._rootIndex?z.nodes[x(B,this._pageSize)].parent:null}getParent(B){B=this.getParentIndex(B);return null!=B?this.getNode(B):null}isLeaf(B){B=this._getNodeInternal(B);return null!=B&&0===B.childCount}get rootNode(){return this.getNode(this._rootIndex)}get isEditable(){return this._isEditable}removeAllGeometryObbs(){this._forAllNodes(B=>{null!=B.node&&(B.node.geometryObbInRenderSR=null)})}invalidateVisibilityCache(){this._visibilityCacheVersion=
d.addWraparound(this._visibilityCacheVersion,2)}invalidateNodeVisibilityCache(B){B=this._getNodeInternal(B);null!=B&&this.invalidateNodeVisibilityCacheInternal(B)}invalidateNodeVisibilityCacheInternal(B){B.visibilityCache=d.addWraparound(this._visibilityCacheVersion,-2)}invalidateBoundingVolumeCache(B){B=this._getNodeInternal(B);null!=B&&(B.node?.invalidateServiceBVsInRenderSR(),B.ref?.invalidateServiceBVsInRenderSR(),this.invalidateNodeVisibilityCacheInternal(B))}updateElevationChanged(B){const z=
this._getNodeInternal(B);null!=z&&(this.needNodeElevationRange?(B=null!=z.node?z.node:z.ref,null!=B&&B.invalidateElevationRange()):this.invalidateBoundingVolumeCache(B))}invalidateGeometryVisibility(B){if(B=this._getNodeInternal(B)?.node)B.geometryObbInRenderSR=null,B.invalidateServiceBVsInRenderSR()}invalidateVisibilityObbs(){null!=this.rootNode&&this.traverse(this.rootNode,B=>{B.visibilityObbInRenderSR=this._computeVisibilityObb(B);B.geometryObbInRenderSR=null;return!0})}_updateElevationRange(B){this._updateElevationRangeInternal(B,
null)}_updateElevationRangeInternal(B,z){const K=this._getNodeInternal(B);if(!K)return!1;const L=K?.node??K?.ref;if(!L)return!1;if(L.elevationRangeValid)return z?.expandElevationRange(L),!0;const F=new l.ElevationRange;var M=!1;for(let N=0;N<K.childCount;N++){var S=this.getChildIndex(B,N);S=this._updateElevationRangeInternal(S,F);M=M||!S}(0===K.childCount||M)&&this._viewportQueries.expandElevationRange(L,!K.node?.resources.isEmpty,F);M=L.elevationRangeMax;if(L.elevationRangeMin===F.elevationRangeMin&&
M===F.elevationRangeMax)return z?.expandElevationRange(L),!0;K.node?.setElevationRange(F);K.ref?.setElevationRange(F);this.invalidateBoundingVolumeCache(B);z?.expandElevationRange(L);return!0}isNodeVisible(B){const z=this._getNodeInternal(B);if(null==z)return!0;var K=z.ref;if(null!=K&&!K.serviceMbsInIndexSR)return!0;if(!this.needNodeElevationRange&&(z.visibilityCache&-2)===this._visibilityCacheVersion)return 1===(z.visibilityCache&1);var L=z.node;const F=this._viewportQueries;if(L&&0<L.level&&(F.ensureElevationAgnosticBoundingVolume(L,
this.viewingMode),!F.isElevationAgnosticBoundingVolumeVisible(this.viewingMode,L.elevationAgnosticBoundingVolume)))return z.visibilityCache=this._visibilityCacheVersion+0,!1;this.needNodeElevationRange&&this._updateElevationRange(B);return(z.visibilityCache&-2)!==this._visibilityCacheVersion?(this._layerHasFilter&&this._computeNodeFiltering&&(null!=L||null!=K)&&z.filterImpact===e.NodeFilterImpact.NotChecked&&(B=null!=L?L.serviceMbsInIndexSR:null!=K?K.serviceMbsInIndexSR:null,z.filterImpact=null!=
B?this._computeNodeFiltering(B):e.NodeFilterImpact.Unmodified),B=null!=L&&z.filterImpact===e.NodeFilterImpact.Culled,K=!L||K&&!L.visibilityObbInRenderSR?K??null:L,L=!(null!=L&&L.imModificationImpact===e.NodeIMModificationImpact.Culled)&&(!K||F.isNodeVisible(K))&&!B,z.visibilityCache=this._visibilityCacheVersion+(L?1:0),L):1===(z.visibilityCache&1)}isGeometryVisible(B){if(!this.isNodeVisible(B))return!1;B=this._getNodeInternal(B);return null==B?.node?.geometryObbInRenderSR||this.layerHasModifications&&
B.node.imModificationImpact===e.NodeIMModificationImpact.NotChecked?!0:this._viewportQueries.isGeometryVisible(B.node)}_traverseCoverage(B,z,K,L,F){B=this._getPage(B);if(null!=B&&0!==z.childCount){var M=z.childOffset+z.childCount,S=[];for(z=z.childOffset;z<M;++z){const N=B.children[z],P=this._getNodeInternal(N);null!=P?.node&&this.isGeometryVisible(N)&&S.push(P)}L/=S.length;for(const N of S)B=N.node.index,this._isLoaded(B)||this._isReloading(B)?(F.delta=Math.max(F.delta,K),F.coverage+=L):this._traverseCoverage(B,
N,K+1,L,F)}}useNodeAsHole(B){if("off"===this.holeFilling)return!1;const z=this._getNodeInternal(B);if(null==z)return!1;if("always"===this.holeFilling)return!0;if((z.useAsHole&-2)===this._version)return 1===(z.useAsHole&1);const K={delta:0,coverage:0};this._traverseCoverage(B,z,0,1,K);B=.5>=K.delta*K.coverage;z.useAsHole=this._version+(B?1:0);return B}get maxLevel(){return this._maxLevel}get dirty(){return this._dirty}destroy(){this._updates.add.prune();this._updates.update.prune()}requestUpdate(){this._dirty=
!0;this._indexMissing=1;this._version=d.addWraparound(this._version,2)}imModificationsChanged(B){this.layerHasModifications=B;this._forAllNodes(({node:z})=>{null!=z&&(z.imModificationImpact=e.NodeIMModificationImpact.NotChecked,z.visibilityObbInRenderSR=this._computeVisibilityObb(z),z.hasModifications&&this.invalidateGeometryVisibility(z.index))});this.invalidateVisibilityCache()}layerFilterChanged(B){this._layerHasFilter=B;this._forAllNodes(z=>{null!=z&&(z.filterImpact=e.NodeFilterImpact.NotChecked,
z=z.node,null!=z&&this.invalidateNodeVisibilityCache(z.index))});this.invalidateVisibilityCache()}update(B,z,K){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(z);this._invalidateElevationRangeForNewPages(z);this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missingPagesAndNodes.clear();this._prefetchNodes.clear();this._updates.reset(B);y.clear();var L=!0,F=new A,M=new A,S=this._imModificationUncategorized;S.clear();var N=new Set,P=0;this.traverseVisible((R,
O,T)=>{var Q=r(R,this._pageSize);if(null==O)R=this._entryPriority(R),Infinity===R&&(R=this._entryPriority(T)),y.set(Q,Math.max(R,y.get(Q)||0)),this._loadingPages.has(Q)||this._failedPages.has(Q)||(this._missingPagesAndNodes.push(Q),++P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,R);else{var V=O.node;this._updateNodeFeatureEstimate(V,M);if(null==V)O=this._entryPriority(R),this._loadingNodes.has(R)||this._failedNodes.has(R)||(this._missingPagesAndNodes.push(R),y.set(R,O)),this._maxProcessingPrio=
Math.max(this._maxProcessingPrio,O);else{T=this._getPage(R);if(0===this._missingPagesAndNodes.length&&!this._useNodePages)for(Q=0;Q<O.childCount;Q++){const U=T.children[O.childOffset+Q],W=this._getNodeInternal(U);null==W||W.node||this._loadingNodes.has(U)||this._failedNodes.has(U)||(y.set(U,this._entryPriority(U)),this._prefetchNodes.push(U))}V.failed||V.resources.isEmpty?L&&0<O.childCount&&this._isSelected(V)&&(L=!1):this._isLoaded(R)?(F.known+=V.memory,++F.knownNodes,this._isSelected(V)?0<O.childCount&&
(L=!1):(F.unremoved+=V.memory,L=!1),this._needsUpdate(V)&&(O=this._entryPriority(R),y.set(R,O),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,O),this._updates.update.push(R))):(V.memory&&(F.known+=V.memory,++F.knownNodes),this._isSelected(V)?(0<O.childCount&&(L=!1),V.memory?(F.missing+=V.memory,F.known+=V.memory,++F.knownNodes):++F.missingNodes,B.includes(V.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(R)),this._updates.cancel=this._updates.cancel.filter(U=>
U!==V.index)):!z.done&&this._enable(V)?z.madeProgress():(O=this._entryPriority(R),y.set(R,O),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,O),this._updates.add.push(R),this.layerHasModifications&&K&&null!=V&&V.imModificationImpact===e.NodeIMModificationImpact.NotChecked&&S.push(R))):this._isReloading(R)&&this._updates.remove.push(R))}}},N);this._frameNumber++;this._missingPagesAndNodes.sort((R,O)=>R-O);this._missingPagesAndNodes.filterInPlace((R,O)=>1>O||this._missingPagesAndNodes.data[O-
1]!==R);this._missingPagesAndNodes.sort((R,O)=>y.get(R)-y.get(O));0<this._missingPagesAndNodes.length&&(this._maxUnloadedPrio=y.get(this._missingPagesAndNodes.back()),this._prefetchNodes.clear());this._removeUnusedNodePages(N,P);N=this._updates.add;0<N.length&&this.layerHasModifications&&(0<S.length&&K?.(S),N.filterInPlace(R=>{var O=this._getNodeInternal(R);(O=null==O?.node||O.node.imModificationImpact!==e.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(R);return O}));this._unloadedMemoryEstimate=
F.missing-F.unremoved;3<F.knownNodes&&0<F.missingNodes&&(this._unloadedMemoryEstimate+=F.known/F.knownNodes*F.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(M);this._featureEstimate.leavesReached=L;this._updates.add.filterInPlace(R=>y.get(R)>=this._maxUnloadedPrio).sort((R,O)=>y.get(R)-y.get(O));this._updates.update.sort((R,O)=>y.get(R)-y.get(O));this._indexMissing=this._loadingPages.size+this._loadingNodes.size+
this._missingPagesAndNodes.length;this._dirty=0<this._indexMissing;y.clear()}}checkFeatureTarget(B,z){const K=this._viewportQueries.updateScreenSpaceErrorBias(z);let L=z,F=z,M=K,S=10;for(;S--;){const N=new A;this._updateFeatureEstimate(L,N);if(this._computeFeatureEstimate(N)<=B){if(L>=z||0<N.missingNodes||0===S)break;M=L;L=.5*(L+F)}else F=L,L=.5*(L+M)}this._version=d.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(K);return Math.min(z,L)}_removeUnusedNodePages(B,z){if(this._useNodePages){var K=
B.size,L=this._nodePages;z=L.size+this._loadingPages.size+z;if(z>J&&z>K){K=[];for(const [F,M]of L)0!==M.numNodesWithLoadedChildren||B.has(F)||K.push([M.lastTraversed,F]);K.sort((F,M)=>F[0]-M[0]).some(F=>{this._deleteNodePage(F[1]);return L.size<=J})}}}_updateFeatureEstimate(B,z){this._version=d.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(B);this.traverseVisible((K,L)=>this._updateNodeFeatureEstimate(null!=L?L.node:void 0,z))}_updateNodeFeatureEstimate(B,z){null!=
B&&!B.failed&&null!=B.numFeatures&&this._isSelected(B)&&(null!=B.numFeatures?(z.missing+=B.numFeatures,z.known+=B.numFeatures,++z.knownNodes):++z.missingNodes)}_computeFeatureEstimate(B){let z=B.known-B.unremoved;3<B.knownNodes&&0<B.missingNodes&&(z+=B.known/B.knownNodes*B.missingNodes);return Math.max(0,z)}load(){return this._load(this._missingPagesAndNodes)}prefetch(){this._prefetchNodes.sort((B,z)=>y.get(B)-y.get(z));return this._load(this._prefetchNodes)}_load(B){if(0===B.length||!this._canRequest())return!1;
for(;0<B.length&&this._canRequest();){const z=B.pop();this._useNodePages?0<=z?this._loadPage(z):this._loadNode(z):this._loadNode(z)}return!0}get isLoading(){return 0<this._indexMissing}get isPrefetching(){return 0<this._prefetchNodes.length}get indexLoading(){return this._loadingPages.size+this._loadingNodes.size}get indexMissing(){return this._indexMissing}get unloadedMemoryEstimate(){return this._unloadedMemoryEstimate}get updates(){return this._updates}get featureEstimate(){return this._featureEstimate}get maxPriority(){return Math.max(this._maxProcessingPrio,
this._maxUnloadedPrio)}nodeTraversalState(B){if(null==B)return null;const z=B.index,K=this._getNodeInternal(z);if(!K)return null;let L=K?.traversalState;if(L&&(L.version&-2)===this._version)return L;const F=this._viewportQueries.getLodLevel(B),M=this._viewportQueries.hasLOD(B);let S=!0;M?(B=this.getParentIndex(z),null!=B?(B=this._getNodeInternal(B)?.traversalState,S=!!B&&F>B.lodLevel):S=0<F):S=0===B.childCount;if(L)return L.lodLevel=F,L.isChosen=S,L.version=this._version+1,L;L=new e.NodeTraversalState(M,
S,F,this._version+1);return K.traversalState=L}async _loadNode(B){this._loadingNodes.add(B);var z=this._getNodeInternal(B).ref;if(null==z)this._failedNodes.add(B);else{z=z.id;var K=this._urlPrefix+z,L=()=>{this._loadingNodes.delete(B);0===this._missingPagesAndNodes.length&&0===this._loadingNodes.size&&this.requestUpdate()},F=null;try{F=0<=B?await this._streamDataController.request(K,"json"):await this._clientNodeLoader.loadNodeJSON(z)}catch(M){L();h.isAbortError(M)||(this._logger.error("#loadNode()",
this._layer,"Error loading node: "+K),this._failedNodes.add(B));return}L();z=this._validateNode(z,F);null!=z&&(z.obb&&this.invalidateNodeVisibilityCache(B),z=this._addNode(z,B),this.nodeTraversalState(z))}}_validateNode(B,z){if(null==z||"object"!==typeof z||z.id!==B)return this._logger.error("#validateNode()",this._layer,`Invalid node. Wrong type or wrong id "${B}"`),null;if(!Array.isArray(z.mbs))return this._logger.error("#validateNode()",this._layer,`Invalid bounding volume on node ${B}.`),null;
z.sharedResource&&"./shared"!==z.sharedResource.href&&"./shared/"!==z.sharedResource.href&&this._logger.warn("#validateNode()",this._layer,`Invalid shared resource href on node "${B}"`);var K=z.geometryData;null==K||Array.isArray(K)&&0===K.length||Array.isArray(K)&&1===K.length&&"./geometries/0"===K[0].href||this._logger.warn("#validateNode()",this._layer,`Invalid geometry data on node "${B}"`);K=z.attributeData;const L=this._layer.attributeStorageInfo;null==K||Array.isArray(K)&&!K.some((N,P)=>N.href!==
`./attributes/${L?.[P]?.key??`f_${P}`}/0`)||this._logger.warn("#validateNode()",this._layer,`Invalid attribute data on node "${B}"`);z.featureData&&1<z.featureData.length&&this._logger.warn("#validateNode()",this._layer,`Node ${B} has ${z.featureData.length} bundles. Only the first bundle will be loaded.`);K=z.hasOwnProperty("obb")&&!this.ignoreServiceObb?z.obb:void 0;const F=z.featureData&&1===z.featureData.length&&z.featureData[0].featureRange?z.featureData[0].featureRange[1]-z.featureData[0].featureRange[0]+
1:void 0;var M=N=>{if(null==N)return null;var P=R=>this._logger.error("#validateNode()",this._layer,`Invalid node reference on node ${B}: ${R}`);if("number"===typeof N.id)P(`id ${N.id} is a number instead of a string.`);else if("string"!==typeof N.id||!Array.isArray(N.mbs))return P("Missing or invalid id."),null;if(!Array.isArray(N.mbs))return P(`Invalid bounding volume on reference ${N.id}.`),null;N.href&&N.href!=="../"+N.id&&this._logger.error("#validateNode()",this._layer,`Invalid node href on node "${B}"`);
P=new e.NodeBase(`${N.id}`,N.mbs);P.serviceObbInIndexSR=!this.ignoreServiceObb&&N.hasOwnProperty("obb")&&N.obb?f.Obb.fromJSON(N.obb):null;P.visibilityObbInRenderSR=this._computeVisibilityObb(P);return P};M=Array.isArray(z.children)?z.children.map(M).filter(N=>null!=N):null;const S=!0===z.isEmpty;return new c.ValidatedNode(B,z.mbs,K,"string"===typeof z.version?z.version:null,{isEmpty:!(z.featureData?.length??!1)&&S,hasSharedResource:null!=z.sharedResource,attributes:z.attributeData?B:void 0,texture:z.textureData&&
0<z.textureData.length?B:void 0,geometry:null!=z.geometryData?B:void 0},M,Array.isArray(z.lodSelection)?z.lodSelection:null,F)}resetFailedNodes(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(B=>{null!=B.node&&(B.node.failed=!1)})}_entryPriority(B){var z=this._getNodeInternal(B),K=this.getParentIndex(B);if(null==z||null==K&&null==z.node)return null==K?Infinity:this._entryPriority(K);let L=0;z.node&&null!=K&&(K=this._getNodeInternal(K).traversalState,null!=K&&(L=K.lodLevel));
for(K=this.progressiveLoadPenalty;null!=B;B=this.getParentIndex(B))if(this._isLoaded(B)){K=0;break}z=null!=z.ref?this._viewportQueries.distToPOI(z.ref):null!=z.node?this._viewportQueries.distToPOI(z.node):0;return-z-L*(z+this.progressiveLoadPenalty)+K}traverseVisible(B,z){const K=this._getNodeInternal(this._rootIndex);null==K?B(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,null,K,B,z)}_traverseVisible(B,z,K,L,F){var M=r(B,this._pageSize);F&&F.add(M);if(K.node&&0===K.childCount)this.isGeometryVisible(B)&&
L(B,K,z);else if(this.isNodeVisible(B)&&(L(B,K,z),null!=K.node&&(z=this.nodeTraversalState(K.node),!z?.nodeHasLOD||z.lodLevel!==this._maxLodLevel)))for(M=this._getPageFromPageIndex(M),z=0;z<K.childCount;z++){const N=M.children[K.childOffset+z];var S=this._getNodeInternal(N);S?this._traverseVisible(N,B,S,L,F):(F&&(S=r(N,this._pageSize),F.add(S)),L(N,null,B))}}traverse(B,z){z(B)&&this.traverseDescendants(B,z)}traverseDescendants(B,z){++this._traverseDescendantsNestingLevel;B=B.index;var K=this._pageSize,
L=r(B,K),F=this._getPageFromPageIndex(L);if(null!=F){var M=this._frameNumber,S=this._nodePages;F.lastTraversed=M;B=x(B,K);var N=F.nodes[B];({childCount:B}=N);if(0!==B){B=1===this._traverseDescendantsNestingLevel?this._traverseDescendantsQueue:[0];var P=0,R=[],{childOffset:O,childCount:T}=N;({children:N}=F);B.length=2**Math.ceil(Math.log2(P+T));for(var Q=O;Q<O+T;++Q){var V=N[Q];0<=V?(B[P]=V,++P):R.push(V)}if(0<R.length&&(N=this._clientNodePage))for(Q=N.children,V=0;V<R.length;){var U=R[V];++V;U=N.nodes[-U-
1];var W=U.node;if(W&&z(W)&&({childCount:W}=U,0!==W))for({childOffset:U}=U,W=U+W;U<W;++U)R.push(Q[U])}if(0<P)if(R=0,0<K)for(L*=K,N=F.nodes;R<P;){V=B[R];++R;if(L<=V&&V<L+K)Q=F;else{U=V/K|0;Q=S.get(U);if(void 0===Q)continue;Q.lastTraversed=M;F=Q;N=F.nodes;L=K*U}V=N[V-L];U=V.node;if(null!=U&&!1!==z(U)&&({childCount:U}=V,0!==U)){B.length<P+U&&(B.length=2**Math.ceil(Math.log2(P+U)));for(;B.length<P+U;)B.length+=B.length;Q=Q.children;({childOffset:V}=V);for(U=V+U;V<U;++V)B[P]=Q[V],++P}}else if(K=S.get(0))for(;R<
P;)if(M=B[R],++R,S=K.nodes[M],(M=S.node)&&z(M)&&({childCount:F}=S,0!==F))for(B.length=Math.max(B.length,2**Math.ceil(Math.log2(P+F))),M=K.children,{childOffset:S}=S,F=S+F;S<F;++S)B[P]=M[S],++P;--this._traverseDescendantsNestingLevel}}}updateChildrenLoaded(B,z){for(B=this.getNode(B);null!=B;){var K=B.childrenLoaded;const L=K+z;B.childrenLoaded=L;K=0===K?1:0===L?-1:0;B=B.index;0!==K&&(this._getPage(B).numNodesWithLoadedChildren+=K);B=this.getParent(B)}}checkChildrenLoadedInvariant(){if(null==this.rootNode)return!0;
const B=[],z=K=>{let L=this._isLoaded(K.index)||this._isReloading(K.index)?1:0;this.traverseDescendants(K,F=>{L+=z(F);return!1});K.childrenLoaded!==L&&B.push(K.index);return L};z(this.rootNode);B.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+B.join(","));return 0<B.length}updateElevationInfo(B,z){this.needNodeElevationRange=z&&!!B&&("relative-to-ground"===B.mode||"on-the-ground"===B.mode);this._viewportQueries.updateElevationInfo(B);this.invalidateAllElevationRanges()}invalidateAllElevationRanges(){this._forAllNodes(B=>
{B.node?.invalidateServiceBVsInRenderSR();B.ref?.invalidateServiceBVsInRenderSR();null!=B.node&&B.node.invalidateElevationRange();null!=B.ref&&B.ref.invalidateElevationRange()})}_forAllNodes(B){if(null!=this._clientNodePage){var z=this._clientNodePage;for(var K=0;K<z.nodes.length;K++)B(z.nodes[K],-(K+1))}for(const [L,F]of this._nodePages)for(z=L*this._pageSize,K=0;K<F.nodes.length;K++)B(F.nodes[K],z+K)}clearCaches(){if(this._useNodePages){const B=this._nodePages,z=new Set;this.traverseVisible(K=>
z.add(r(K,this._pageSize)));for(const [K,L]of B)if(0!==L.numNodesWithLoadedChildren||z.has(K))for(const F of L.nodes)F.traversalState=null;else this._deleteNodePage(K)}}_deleteNodePage(B){this._nodePages.delete(B)}get test(){return{addNode:(B,z)=>this._addNode(this._validateNode(B.id,B),z),getNodeInternal:B=>this._getNodeInternal(B),getPageIndex:B=>r(B,this._pageSize),getIndexWithinPage:B=>x(B,this._pageSize),getNodePage:B=>0>B?this._clientNodePage:this._nodePages.get(B),getChildIndices:B=>{const z=
this._getNodeInternal(B);B=this._getPage(B);if(null==z||null==B)return[];const K=[];for(let L=z.childOffset;L<z.childOffset+z.childCount;++L)K.push(B.children[L]);return K},rootIndex:this._rootIndex,clientNodePage:this._clientNodePage,nodePages:this._nodePages}}}const y=new Map;class D{constructor(B){this.missing=B;this.update=new n({deallocator:null});this.add=new n({deallocator:null});this.remove=new n({deallocator:null});this.cancel=[]}reset(B){this.add.clear();this.update.clear();this.cancel=
B}}const G=[["maxScreenThreshold",e.LodMetric.MaxScreenThreshold],["screenSpaceRelative",e.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",e.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",e.LodMetric.DistanceRangeFromDefaultCamera]];class A{constructor(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}const C=m.create(),E=m.create(),I=m.create(),H=m.create(),J=b("esri-mobile")?100:300;a.I3SIndex=v;a.selectErrorMetric=p;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../chunks/sphere","./I3SUtil","../../support/ElevationRange"],function(a,b,n,h,k){class m extends k.ElevationRange{constructor(d,c){super(NaN,NaN);this.id=d;this.serviceMbsInIndexSR=c;this.serviceMbsInRenderSR=n.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){h.invalidateMbs(this.serviceMbsInRenderSR);this.serviceObbInRenderSR?.invalidate()}shareServiceBVsInRenderSRWith(d){this.serviceObbInRenderSR=
d.serviceObbInRenderSR;this.serviceMbsInRenderSR=d.serviceMbsInRenderSR}}a.NodeFilterImpact=void 0;(function(d){d[d.Unmodified=0]="Unmodified";d[d.Culled=1]="Culled";d[d.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(d){d[d.Unmodified=0]="Unmodified";d[d.PotentiallyModified=1]="PotentiallyModified";d[d.Culled=2]="Culled";d[d.Unknown=3]="Unknown";d[d.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact=
{}));class g extends m{constructor(d,c,l,f,r,x,w,p,t,q){super(d,l);this.index=c;this.childCount=f;this.level=r;this.resources=x;this.version=w;this.lodMetric=p;this.maxError=t;this.numFeatures=q;this.failed=!1;this.cacheState=a.CacheState.Unknown;this.childrenLoaded=this.memory=this.vertexCount=0;this.hasModifications=!1;this.imModificationImpact=a.NodeIMModificationImpact.NotChecked;this.elevationAgnosticBoundingVolume=b.fromValues(0,0,0,-1)}invalidateServiceBVsInRenderSR(){super.invalidateServiceBVsInRenderSR();
this.elevationAgnosticBoundingVolume[3]=-1}}a.CacheState=void 0;(function(d){d[d.Unknown=0]="Unknown";d[d.Uncached=1]="Uncached";d[d.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(d){d[d.None=0]="None";d[d.MaxScreenThreshold=1]="MaxScreenThreshold";d[d.ScreenSpaceRelative=2]="ScreenSpaceRelative";d[d.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";d[d.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=
void 0;(function(d){d[d.Hole=0]="Hole";d[d.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));class e{constructor(d,c,l,f){this.nodeHasLOD=d;this.isChosen=c;this.lodLevel=l;this.version=f}}a.Node=g;a.NodeBase=m;a.NodeTraversalState=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/ValidatedNode":function(){define(["exports"],function(a){class b{constructor(n,h,k,m,g,e,d,c){this.id=n;this.mbs=h;this.obb=k;this.version=m;this.resources=g;this.children=e;this.lodSelection=
d;this.numFeatures=c}}a.ValidatedNode=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,b,n){class h{constructor(m){this._layerView=m;this._lodGlobalDirty=!1}startNodeLoading(m,g,e,d){this._maxLodLevel=d.maxLodLevel;this._index=e;this._isNodeInScaleBounds=m;this._removeNodes=g}shouldLoadNode(m){if(null==m)return!1;const g=this._index.nodeTraversalState(m);
return this._isChosenMaxLOD(g)?!0:g.isChosen?this._childrenRequireLoading(m):!1}setLodGlobalDirty(){this._lodGlobalDirty=!0}get requiresLODGlobalHandling(){return null!=this._index&&!0===this._lodGlobalDirty}lodGlobalHandling(m){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var g=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-1)));k.clear();this._lodGlobalHandling(this._index.rootNode,g,!1,!!this._layerView.nodeCrossfadingEnabled);
g=k.length;this._removeNodes(k,m);m=k.length<g;0!==k.length&&(this._lodGlobalDirty=!0);k.clear();return m}_lodGlobalHandling(m,g,e,d){if(null==m)return!1;const c=m.index,l=this._index,f=this._layerView;var r=l.nodeTraversalState(m);r=this._isChosenMaxLOD(r);var x=m.resources.isEmpty;if(r&&x)return 0<m.childrenLoaded&&this._removeChildrenRecursive(m),!0;x=f.isNodeLoaded(c);if(d&&x&&r){var w=!e&&this.hasNoVisibleChildren(m);f.fadeNode(c,n.FadeDirection.FadeIn,!w)}w=x&&(!f.isNodeFullyFadedIn||f.isNodeFullyFadedIn(c));
if(x&&(f.updateNodeState(c,r?b.NodeState.Leaf:b.NodeState.Hole),r))return w&&this._removeChildrenRecursive(m),w;var p=0<m.childCount;let t=p;if(p)for(p=0;p<m.childCount;p++){const q=l.getChildIndex(c,p),u=l.getNode(q);null!=u?l.isGeometryVisible(q)&&!this._lodGlobalHandling(u,g,e||w,d)&&this._isNodeInScaleBounds(u)&&(t=!1):l.isNodeVisible(q)&&(t=!1)}(g=x&&!r&&(t||k.length<g))&&k.push(c);!d||g||!x||e||t||f.fadeNode(c,n.FadeDirection.FadeIn,!1);m=m.resources.isEmpty;return t||w&&!g||m}_removeChildrenRecursive(m){this._index.traverseDescendants(m,
g=>{(this._layerView.isNodeLoaded(g.index)||this._layerView.isNodeReloading(g.index))&&k.push(g.index);return 0<g.childrenLoaded})}hasNoVisibleChildren(m){let g=!0;this._index.traverseDescendants(m,e=>g&&this._index.isNodeVisible(e.index)?this._layerView.isNodeLoaded(e.index)?g=!1:0<e.childrenLoaded:!1);return g}_childrenRequireLoading(m){let g=!1,e=!0;this._index.traverseDescendants(m,d=>{if(!e||!this._index.isNodeVisible(d.index))return!1;const c=this._index.nodeTraversalState(d);this._isChosenMaxLOD(c)&&
this._index.isGeometryVisible(d.index)&&(g=!0);return this._layerView.isNodeLoaded(d.index)?e=!1:0<d.childrenLoaded});return e&&g}_isChosenMaxLOD(m){return m.isChosen&&(!m.nodeHasLOD||m.lodLevel===this._maxLodLevel)}}const k=new a({deallocator:null});return h})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,b,n,h,k,m,g,e){class d{constructor(c,l,f,r,x,w){this._streamDataController=l;this._logger=f;this._defaultGeometrySchema=r;this._requiredAttributes=x;this._options=w;this._logLayer=c;this._layerUrl=c.parsedUrl.path;this._geometryDefinitions=
c.geometryDefinitions;if(c.materialDefinitions){const p=c.textureSetDefinitions;this._materialAndTextures=c.materialDefinitions.map(t=>e.getMaterialAndTextures(p,t,"integrated-mesh"===c.type))}}_load(c,l,f){return this._streamDataController.request(c,l,f)}_loadAttribute(c,l,f){return this._load(`${this._layerUrl}/nodes/${c.resources.attributes}/attributes/${l.key}/0`,"binary",f).then(r=>g.readBinaryAttribute(l,r))}async loadAttributes(c,l,f){const r=await Promise.allSettled(l.map(p=>this._loadAttribute(c,
p.attributeStorageInfo,f))),x={};for(let p=0;p<l.length;++p){var w=r[p];const t=l[p];"fulfilled"===w.status?x[t.name]=w.value:(w=w.reason,h.throwIfAbortError(w),this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${t.name}' on node '${c.id}'`,w))}return x}async loadNodeData(c,l){var f=null!=this._requiredAttributes&&c.resources.attributes?a.result(this.loadAttributes(c,this._requiredAttributes,l)):null;var r=this._geometryDefinitions;var x={bufferDefinition:null,
bufferIndex:0};var w=c.resources.geometryDefinition;if(!(null==r||null==w||0>w)&&(r=0<=w?r[w].geometryBuffers:null,null!=r))for(w=0;w<r.length;w++){var p=r[w];if(null!=p.compressedAttributes){if("draco"===p.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){x.bufferIndex=w;x.bufferDefinition=p;break}}else x.bufferIndex=w,x.bufferDefinition=r[w]}const {bufferDefinition:t,bufferIndex:q}=x;w=(p=!!c.resources.geometry)?a.result(this._loadGeometry(c.resources.geometry,q,l)):null;r=c.resources.hasSharedResource?
await this._loadShared(c,l):null;x=c.resources.materialDefinition;x=this._materialAndTextures&&null!=x&&0<=x?this._materialAndTextures[x]:null!=r?e.getMaterialAndTexturesFromShared(r):null;var u=x?.material;x=x?.textures??[];const v=`${c.id}`,y=!p&&this._options.loadFeatureData;p=y?await this._loadFeatureData(v,l):null;if(y)a:{if(p)for(G of p.featureData)if(u=G.geometries,null!=u)for(var D of u){var G={featureIds:[G.id],featureDataPosition:G.position,geometries:[D]};break a}G=null}else G={featureIds:[],
geometries:[{type:"ArrayBufferView",params:{material:u}}],featureDataPosition:[0,0,0]};if(null==G)if(p){D=[];for(A of p.featureData)null!=A.position&&D.push({featureIds:[A.id],featureDataPosition:A.position,geometries:[]});var A=D}else A=null;else A=null;D=0<x.length?a.result(this.loadTextures(c,x,l)):null;l=c=null;w&&(c=a.assertResult(await w),(l=this._defaultGeometrySchema)&&r?.materialDefinitions&&(w=Object.keys(r.materialDefinitions)[0],!r.materialDefinitions[w].params.vertexRegions&&l.vertexAttributes.region&&
(l=n.clone(l),delete l.vertexAttributes.region)),l=g.createGeometryDescriptor(t,l));r=D?a.assertResult(await D):null;f=(f=f?a.assertResult(await f):{})?{attributeData:f,loadedAttributes:this._requiredAttributes}:null;if(null!=G)return{geometryData:G,attributeDataInfo:f,geometryBuffer:c,geometryDescriptor:l,requiredTextures:x,textureData:r};if(null!=A)return{pointData:A,attributeDataInfo:f,geometryBuffer:c,geometryDescriptor:l,requiredTextures:x,textureData:r};throw Error();}static _addAbsoluteHrefTexture(c,
l){c=c.textureDefinitions;if(null!=c)for(const f of Object.keys(c))for(const r of c[f].images)Array.isArray(r.href)?r.hrefConcat=r.href.map(x=>k.makeAbsolute(x,l)):r.hrefConcat=k.makeAbsolute(r.href,l)}static _fixTextureEncodings(c){c=c.textureDefinitions;if(null!=c)for(const f in c){const r=c[f];if(Array.isArray(r.encoding))for(var l=0;l<r.encoding.length;l++){const x=r.encoding[l];"data:"===x.substring(0,5)&&(r.encoding[l]=x.substring(5))}else l=r.encoding,"data:"===l.substring(0,5)&&(r.encoding=
l.substring(5))}}async _loadShared(c,l){if(null==c.resources.geometry)return{};c=`${this._layerUrl}/nodes/${c.resources.geometry}/shared`;l=await this._load(c,"json",l);d._fixTextureEncodings(l);d._addAbsoluteHrefTexture(l,c);return l}_loadTexture(c,l,f,r,x,w){let p=!1;return x===m.TextureEncoding.DDS_S3TC||x===m.TextureEncoding.KTX2||x===m.TextureEncoding.Basis?this._load(c,"binary",w).then(t=>({id:l,usage:f,data:t,encoding:x,downsampled:p})):this._load(c,"image",w).then(t=>{var q=t;if(r&&4096<=
t.width*t.height){q=Math.ceil(t.width/2);const u=Math.ceil(t.height/2),v=document.createElement("canvas");v.width=q;v.height=u;v.getContext("2d").drawImage(t,0,0,q,u);q=v;p=!0}return{id:l,usage:f,data:q,encoding:x,downsampled:p}})}loadTextures(c,l,f){const r=!!this._options.uncompressedTextureDownsamplingEnabled,x=this._options.textureUsageMask;return Promise.all(l.map(w=>{if(0===(w.usage&x))return null;const p=e.selectEncoding(w.encodings,this._options.textureEncodings);return null==p?(this._logger.error("#loadTextures",
this._logLayer,`No known encoding for texture found on node ${c.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${c.resources.texture||c.id}/textures/${p.name}`,w.id,w.usage,r,p.encoding,f)}))}_loadFeatureData(c,l){return this._load(`${this._layerUrl}/nodes/${c}/features/0`,"json",l)}_loadGeometry(c,l,f){return this._load(`${this._layerUrl}/nodes/${c}/geometries/${l}`,"binary",f)}}return d})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../webgl-engine/materials/pbrUtils ../../../webgl/enums".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){function f(v){return v.sort((y,D)=>y.encoding-D.encoding)}function r(v,y,D){if(null==v||D===h.TextureUsage.None)return null;for(let G=0;G<v.length;G++){const A=v[G];if(null!=A&&0!==(A.usage&D))return v=y[G],null!=v?v.id:null}return null}function x(v){switch(v){case h.TextureEncoding.KTX2:return e.TextureEncodingMimeType.KTX2_ENCODING;case h.TextureEncoding.Basis:return e.TextureEncodingMimeType.BASIS_ENCODING;case h.TextureEncoding.DDS_S3TC:return e.TextureEncodingMimeType.DDS_ENCODING;
case h.TextureEncoding.PNG:return"image/png";case h.TextureEncoding.JPG:return"image/jpeg";case h.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const w={ktx2:h.TextureEncoding.KTX2,basis:h.TextureEncoding.Basis,dds:h.TextureEncoding.DDS_S3TC,png:h.TextureEncoding.PNG,jpg:h.TextureEncoding.JPG,"ktx-etc2":h.TextureEncoding.KTX_ETC2},p={[e.TextureEncodingMimeType.KTX2_ENCODING]:h.TextureEncoding.Basis,[e.TextureEncodingMimeType.BASIS_ENCODING]:h.TextureEncoding.Basis,[e.TextureEncodingMimeType.DDS_ENCODING]:h.TextureEncoding.DDS_S3TC,
"image/png":h.TextureEncoding.PNG,"image/jpg":h.TextureEncoding.JPG,"image/jpeg":h.TextureEncoding.JPG,"image/ktx":h.TextureEncoding.KTX_ETC2},t=()=>({alphaMode:"opaque",alphaCutoff:m.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:e.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
q={s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},u={s:l.TextureWrapMode.REPEAT,t:l.TextureWrapMode.REPEAT};a.configureMaterial=function(v,y,D,G,A,C){const E=C.rendererTextureUsage;var I=y.metallicRoughness.baseColorFactor,H=n.clamp(y.metallicRoughness.baseColorFactor[3],0,1);v.baseColor=[I[0],I[1],I[2],H];v.hasParametersFromSource=!!y.hasParametersFromSource;v.usePBR=C.usePBR;v.mrrFactors=[y.metallicRoughness.metallicFactor,y.metallicRoughness.roughnessFactor,y.hasParametersFromSource?
c.defaultSchematicMRRFactors[2]:c.defaultAdvancedMRRFactors[2]];v.emissiveFactor=y.emissiveFactor;v.isIntegratedMesh=C.isIntegratedMesh;v.textureAlphaCutoff="mask"===y.alphaMode?y.alphaCutoff:m.defaultMaskAlphaCutoff;v.alphaDiscardMode="opaque"===y.alphaMode?e.AlphaDiscardMode.Opaque:"mask"===y.alphaMode?e.AlphaDiscardMode.Mask:e.AlphaDiscardMode.MaskBlend;I=[];H=r(G,D,(h.TextureUsage.Color|h.TextureUsage.AlphaMask)&E);null!=H&&(v.baseColorTexture=new k.RenderTexture(A,H),I.push(v.baseColorTexture.loadPromise));
H=r(G,D,h.TextureUsage.MetallicRoughness&E);null!=H&&(v.metallicRoughnessTexture=new k.RenderTexture(A,H),I.push(v.metallicRoughnessTexture.loadPromise));H=r(G,D,h.TextureUsage.Emissive&E);null!=H&&(v.emissionTexture=new k.RenderTexture(A,H),I.push(v.emissionTexture.loadPromise));H=r(G,D,h.TextureUsage.Occlusion&E);null!=H&&(v.occlusionTexture=new k.RenderTexture(A,H),I.push(v.occlusionTexture.loadPromise));D=r(G,D,h.TextureUsage.Normal&E);null!=D&&(v.normalTexture=new k.RenderTexture(A,D),I.push(v.normalTexture.loadPromise));
v.commonMaterialParameters.hasSlicePlane=C.slicePlaneEnabled;v.commonMaterialParameters.doubleSided=y.doubleSided;v.commonMaterialParameters.cullFace=y.cullFace;v.ellipsoidMode=g.getEllipsoidMode(C.viewSpatialReference);return Promise.all(I)};a.createTexture=function(v,y,D,G){if(null==v?.data)return null;const A=v.data;G=G.renderingContext.parameters.maxMaxAnisotropy;const C=1<G;D=D||!y.wrapTextures?q:u;const E=x(v.encoding);return new d.Texture(A,{mipmap:C,maxAnisotropy:G,encoding:E,wrap:D,components:v.usage&
h.TextureUsage.Color?"opaque"===y.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=t;a.getMaterialAndTextures=function(v,y,D){const G=new Map,A=(z,K)=>{if(null==z)return-1;var L=G.get(z.id);if(L)return L.usage|=K,L.id;L=G.size;G.set(z.id,{id:L,usage:K});return L};var C=y.pbrMetallicRoughness;const E=C?.baseColorFactor,I=y.emissiveFactor,H=(D=b("disable-feature:diffuse-rendering-i3s")||D?c.useSchematicPBRI3S({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,
occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:C?.metallicRoughnessTexture,metallicFactor:C?.metallicFactor,roughnessFactor:C?.roughnessFactor}):c.useSchematicPBR({normalTexture:y.normalTexture,emissiveTexture:y.emissiveTexture,emissiveFactor:y.emissiveFactor,occlusionTexture:y.occlusionTexture,metallicRoughnessTexture:C?.metallicRoughnessTexture,metallicFactor:C?.metallicFactor,roughnessFactor:C?.roughnessFactor}))?c.defaultSchematicMRRFactors[0]:C?.metallicFactor??c.defaultAdvancedMRRFactors[0],
J=D?c.defaultSchematicMRRFactors[1]:C?.roughnessFactor??c.defaultAdvancedMRRFactors[1];C={baseColorFactor:E?[E[0],E[1],E[2],E[3]]:[1,1,1,1],baseColorTextureId:A(C?.baseColorTexture,"mask"===y.alphaMode?h.TextureUsage.Color|h.TextureUsage.AlphaMask:h.TextureUsage.Color),metallicRoughnessTextureId:A(C?.metallicRoughnessTexture,h.TextureUsage.MetallicRoughness),metallicFactor:H,roughnessFactor:J};y={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,doubleSided:y.doubleSided,cullFace:"none"===y.cullFace?
e.CullFaceOptions.None:"back"===y.cullFace?e.CullFaceOptions.Back:"front"===y.cullFace?e.CullFaceOptions.Front:e.CullFaceOptions.None,normalTextureId:A(y.normalTexture,h.TextureUsage.Normal),emissiveTextureId:A(y.emissiveTexture,h.TextureUsage.Emissive),occlusionTextureId:A(y.occlusionTexture,h.TextureUsage.Occlusion),emissiveFactor:I?[I[0],I[1],I[2]]:[0,0,0],metallicRoughness:C,wrapTextures:!1,hasParametersFromSource:D};const B=[];G.forEach(({usage:z},K)=>{var L=null!=v&&v[K]&&v[K].formats;L=L?f(L.map(({name:F,
format:M})=>({name:F,encoding:w[M]}))):[];B.push({id:K,usage:z,encodings:L})});return{material:y,textures:B}};a.getMaterialAndTexturesFromShared=function(v){var y=v?.materialDefinitions?Object.keys(v.materialDefinitions)[0]:null,D=v?.textureDefinitions?Object.keys(v.textureDefinitions)[0]:null;y=y?v.materialDefinitions?.[y]:null;D=D?v.textureDefinitions?.[D]:null;v=t();if(null!=y){y=y.params;y.diffuse&&(v.metallicRoughness.baseColorFactor=[y.diffuse[0],y.diffuse[1],y.diffuse[2],1]);null!=y.doubleSided&&
(v.doubleSided=y.doubleSided,v.cullFace=y.doubleSided?e.CullFaceOptions.None:e.CullFaceOptions.Back);if("none"===y.cullFace||"front"===y.cullFace||"back"===y.cullFace)v.cullFace="none"===y.cullFace?e.CullFaceOptions.None:"back"===y.cullFace?e.CullFaceOptions.Back:e.CullFaceOptions.Front;y.transparency&&(v.metallicRoughness.baseColorFactor[3]=n.clamp(1-y.transparency,0,1));if(y.useVertexColorAlpha||1>v.metallicRoughness.baseColorFactor[3])v.alphaMode="blend"}y=[];if(null!=D){!D.wrap||"repeat"!==D.wrap[0]&&
"repeat"!==D.wrap[1]||(v.wrapTextures=!0);let G=h.TextureUsage.Color;"rgba"===D.channels&&(v.alphaMode="blend",G|=h.TextureUsage.AlphaMask);const A=D.images[D.images.length-1];D=Array.isArray(D.encoding)?f(D.encoding.map((C,E)=>({name:A.href[E]?.split("/").pop(),encoding:p[C]||0}))):[{name:A.href?.split("/").pop(),encoding:p[D.encoding]||0}];y.push({id:0,usage:G,encodings:D});v.metallicRoughness.baseColorTextureId=0}return{material:v,textures:y}};a.getSupportedEncodings=function(v){const y=!!v.compressedTextureS3TC;
v=!!v.compressedTextureETC;const D=b("disable-feature:i3s-basis")?0:h.TextureEncoding.Basis|h.TextureEncoding.KTX2,G=D|h.TextureEncoding.DDS_S3TC;return h.TextureEncoding.JPG|h.TextureEncoding.PNG|(y?G:0)|(v?D:0)};a.selectEncoding=function(v,y){if(null!=y)return v.find(D=>0!==(D.encoding&y))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe","../../../../../core/promiseUtils"],
function(a,b,n){class h{constructor(k,m){this._textureRep=k;this.loadPromise=null;this._disposed=!1;k=this._textureRep.acquire(m);n.isPromiseLike(k)?(k.then(g=>{this._disposed?b.releaseMaybe(g):this._textureRef=g}),this.loadPromise=k):this._textureRef=k}dispose(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0}get glTexture(){return null!=this._textureRef?this._textureRef.glTexture:null}}a.RenderTexture=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports",
"../../../../core/promiseUtils"],function(a,b){class n{constructor(h,k,m){this._requester=h;this._customParameters=k;this._apiKey=m;this._activeRequests=new Set}get busy(){return this._requester.busy}request(h,k,m){const g=new AbortController;m=b.onAbortOrThrow(m,()=>g.abort());h=this._requester.request(h,k,{signal:g.signal,query:{...this._customParameters,token:this._apiKey}});const e={response:h,abortController:g,abortHandle:m};this._activeRequests.add(e);b.always(h,()=>{e.abortController=null;
e.abortHandle?.remove();e.abortHandle=null;this._activeRequests.delete(e)});return h}cancelAll(){this._activeRequests.forEach(h=>{h.abortController?.abort();h.abortController=null;h.abortHandle?.remove()});this._activeRequests.clear()}}a.I3SStreamDataController=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../chunks/vec42 ../../../../core/libs/gl-matrix-2/factories/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectors ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedPoint ../../../ViewingMode ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u){class v{constructor(J,B,z,K,L,F,M,S,N={}){this._indexSR=J;this._renderCoordsHelper=B;this._clippingArea=L;this._elevationProvider=F;this._viewingMode=M;this._options=N;this._frustum=d.create();this._frustumMbs=h.create();this._useFrustumCulling=!1;this._poi=b.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=new u.Obb;this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=
b.create();this._screenspaceErrorBias=N.screenspaceErrorBias||1;this._progressiveLoadFactor=N.progressiveLoadFactor||1;this.updateCamera(z,K);this._renderSR=B=this._renderCoordsHelper.spatialReference;this._renderSRSphericalPCPF=m.getSphericalPCPF(B);this._isGlobalMode=B===this._renderSRSphericalPCPF;this.updateElevationInfo(S);this._tmpPoint=f.makeDehydratedPoint(0,0,0,J);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(B.isWebMercator||c.isPlateCarree(B));this._indexSREllipsoidRadius=k.getReferenceEllipsoid(this._indexSR).radius;
this._indexSRSphericalPCPF=m.getSphericalPCPF(J);this._projectorIndexSRToIndexSRSphericalPCPF=e.getProjector(this._indexSR,this._indexSRSphericalPCPF)}updateElevationInfo(J){null==J?this._elevationContext=null:(this._elevationContext=w.ElevationContext.fromElevationInfo(J),this._elevationContext.updateFeatureExpressionInfoContext(p.createContextWithoutExpressionSupport(p.extractExpressionInfo(J,!1))))}updateCamera(J,B){if(this._useFrustumCulling=B){d.fromMatrix(J.viewMatrix,J.projectionMatrix,this._frustum,
D);B=J.eye;const L=y;a.normalize(L,J.viewForward);var z=G;a.sub(z,D[4],B);var K=a.dot(z,z);z=a.dot(L,z);K=.5*K/z;z=this._frustumMbs;a.scaleAndAdd(z,B,L,K);z[3]=1+K}this._screenSizeFactor=1/(J.perScreenPixelRatio/2);this._camPos=J.eye;this.minDistance=Infinity;this.maxDistance=0}setPointOfInterest(J){this._poi=J}updateScreenSpaceErrorBias(J){const B=this._screenspaceErrorBias;this._screenspaceErrorBias=J;return B}updateClippingArea(J){this._clippingArea=J}expandElevationRange(J,B,z){if(null!=this._elevationContext&&
(J=J.serviceMbsInIndexSR)){var K="relative-to-scene"===this._elevationContext.mode?"scene":"ground";this._elevationProvider.getSphereElevationBounds?(B=this._elevationProvider.getSphereElevationBounds(J,this._indexSR,K))&&z.expandElevationRange(B):((J=this._elevationProvider.getElevation(J[0],J[1],J[2],this._indexSR,K))&&z.expandElevationRangeValues(J,J),(B=B?null:this._elevationProvider.getRootElevationBounds?.())&&z.expandElevationRange(B))}}getServiceMbsInRenderSR(J){const B=J.serviceMbsInRenderSR;
if(q.isValidMbs(B))return B;J.serviceMbsInIndexSR&&n.copy(B,J.serviceMbsInIndexSR);const z=J.elevationRangeMin;if(this._elevationContext&&Number.isFinite(z)){let K=0,L=0;J=J.elevationRangeMax;switch(this._elevationContext.mode){case "relative-to-ground":K=this._elevationContext.geometryZWithOffset(B[2],this._renderCoordsHelper)+z-B[2];L=J-z;break;case "on-the-ground":K=z-B[2],L=J-z}B[2]+=K+.5*L;B[3]+=.5*L}else this._elevationContext&&1E5>B[3]&&(this._tmpPoint.x=B[0],this._tmpPoint.y=B[1],this._tmpPoint.z=
B[2],B[2]=x.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));g.projectBoundingSphere(B,this._indexSR,B,this._renderSR);return B}getAndUpdateVisibilityObbInRenderSR(J){var B=J.visibilityObbInRenderSR;if(B)return B;B=.01*this._indexSREllipsoidRadius;const {serviceMbsInIndexSR:z,serviceObbInIndexSR:K}=J;if(null==K||!z||!K.isValid||this._isECEFOBBInLocalMode&&(K.halfSizeX>B||K.halfSizeY>B||K.halfSizeZ>B))return null;B=J.serviceObbInRenderSR;
if(null==B)B=new u.Obb,J.serviceObbInRenderSR=B;else if(B.isValid)return B;var L=z[3],F=0;let M=0;var S=K.centerZ;const N=this._renderCoordsHelper,P=this._elevationContext;if(P&&J.elevationRangeValid)switch(L=J.elevationRangeMin,J=J.elevationRangeMax,P.mode){case "relative-to-ground":F=P.geometryZWithOffset(S,N)+L-S;M=J-L;break;case "on-the-ground":F=L-S,M=J-L}else P&&1E5>L&&(F=this._tmpPoint,F.x=K.centerX,F.y=K.centerY,F.z=S,F=x.evaluateElevationAlignmentAtPoint(F,this._elevationProvider,P,N)-S);
S=(J=0<M)?this._tmpObb:B;K.transform(S,this._indexSR,this._renderSR,F,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,this._projectorIndexSRToIndexSRSphericalPCPF);J&&u.computeOffsetObb(S,0,M,this._viewingMode,B);return B}getNodeObbInRenderSRIndependentOfElevationOffset(J){const B=J.visibilityObbInRenderSR??J.serviceObbInRenderSR??null;if(B?.isValid)return B;J=J.serviceObbInIndexSR;if(!J)return null;J.transform(C,this._indexSR,this._renderSR,void 0,this._renderSRSphericalPCPF,this._indexSRSphericalPCPF,
this._projectorIndexSRToIndexSRSphericalPCPF);return C}ensureElevationAgnosticBoundingVolume(J,B){-1===J.elevationAgnosticBoundingVolume[3]&&(B===r.ViewingMode.Global?this._updateElevationAgnosticBoundingVolumeGlobal(J):this._updateElevationAgnosticBoundingVolumeLocal(J))}_updateElevationAgnosticBoundingVolumeGlobal(J){const B=this.getNodeObbInRenderSRIndependentOfElevationOffset(J),z=J.elevationAgnosticBoundingVolume,K=E;var L=-1;if(B){B.getCenter(K);a.normalize(K,K);B.getCorners(I);for(var F of I){a.normalize(F,
F);J=a.dot(F,K);if(0>=J){z[3]=-1;return}L=Math.max(L,Math.sqrt(1-J*J))}}else if(L=J.serviceMbsInRenderSR,q.isValidMbs(L))F=a.copy(E,l.getCenter(L)),L=L[3],J=a.len(F),L=0===L?0:J<L?-1:L/J,a.normalize(F,F);else{z[3]=-1;return}n.copyVec3(z,K);z[3]=L+.001}_updateElevationAgnosticBoundingVolumeLocal(J){const B=J.elevationAgnosticBoundingVolume;var z=this.getNodeObbInRenderSRIndependentOfElevationOffset(J);if(z){J=z.getCenter(E);J[2]=0;n.copyVec3(B,J);J=0;const L=H;z.getCorners(I);for(var K of I)K[2]=0,
z=a.sqrDist(L,K),J=Math.max(J,z);B[3]=Math.sqrt(J)}else K=J.serviceMbsInRenderSR,q.isValidMbs(K)&&(z=a.copy(E,l.getCenter(K)),z[2]=0,n.copyVec3(B,z),B[3]=K[3])}isNodeVisible(J){const B=this.getServiceMbsInRenderSR(J);return this._isMBSinClippingArea(B)?this._useFrustumCulling?(J=this.getAndUpdateVisibilityObbInRenderSR(J))?J.isVisible(this._frustum):d.intersectsSphere(this._frustum,l.wrap(B)):!0:!1}isElevationAgnosticBoundingVolumeVisible(J,B){return this._useFrustumCulling&&-1!==B[3]?J===r.ViewingMode.Global?
this._isConeVisibleInFrustum(B):this._isCylinderVisibleInFrustum(B):!0}_isConeVisibleInFrustum(J){var B=this._frustumMbs,z=a.len(B);const K=B[3];var L=a.dot(J,B);const F=J[3];if(.9<F||z<=K)return!0;J=a.scale(A,J,L);if(a.dist(J,B)<K)return!0;B=L/z;if(0>=L)return-B<K;L=Math.sqrt(1-B*B);if(L<F)return!0;z=K/z;return L*Math.sqrt(1-z*z)-z*B<F}_isCylinderVisibleInFrustum(J){var B=this._frustumMbs;const z=B[3];B=a.copy(A,B);B[2]=0;const K=J[3];return a.dist(B,J)<=K+z}isGeometryVisible(J){return this._useFrustumCulling?
J.geometryObbInRenderSR?.isVisible(this._frustum)??this.isNodeVisible(J):!0}_isMBSinClippingArea(J){return null==this._clippingArea?!0:q.intersectBoundingRectWithMbs(this._clippingArea,J)!==q.MbsIntersectResult.OUTSIDE}_screenSpaceDiameterMbs(J,B){var z=this.getServiceMbsInRenderSR(J);J=Math.sqrt(a.squaredDistance(l.getCenter(z),this._camPos));z=J-z[3];this._updateMinMaxDistance(J);return 0>z?.5*Number.MAX_VALUE:B/z*this._screenSizeFactor}calcCameraDistance(J){return this.calcCameraDistanceToCenter(J)-
this.getServiceMbsInRenderSR(J)[3]}calcCameraDistanceToCenter(J){J=this.getServiceMbsInRenderSR(J);J=a.distance(l.getCenter(J),this._camPos);this._updateMinMaxDistance(J);return J}calcAngleDependentLoD(J){J=this.getServiceMbsInRenderSR(J);const B=J[3];J=(Math.abs(J[0]*(J[0]-this._camPos[0])+J[1]*(J[1]-this._camPos[1])+J[2]*(J[2]-this._camPos[2]))/a.length(l.getCenter(J))+B)/a.distance(l.getCenter(J),this._camPos);return Math.min(1,J)}hasLOD(J){return J.lodMetric!==t.LodMetric.None}_getDistancePlanarMode(J,
B){var z=J[0]-B[0];const K=J[1]-B[1];J=J[2]-B[2];z=z*z+K*K;B=B[3];if(z<=B*B)return Math.abs(J);B=Math.sqrt(z)-B;return Math.sqrt(J*J+B*B)}_getDistanceGlobeMode(J,B){var z=a.length(l.getCenter(B));const K=a.length(J)-z;a.scale(this._tmp0,J,a.dot(J,l.getCenter(B))/a.squaredLength(J));var L=a.squaredDistance(l.getCenter(B),this._tmp0),F=B[3];if(L<=F*F)return Math.abs(K);B=a.scale(this._tmp0,l.getCenter(B),1/z);z=a.scale(this._tmp1,B,z-F*F/2/z);L=a.subtract(this._tmp2,J,z);L=a.subtract(this._tmp2,L,a.scale(this._tmp3,
B,a.dot(B,L)));z=a.add(this._tmp2,z,a.scale(this._tmp2,L,F/a.length(L)));F=a.distance(J,z);2E5<=K&&(J=a.subtract(this._tmp1,J,z),J=a.dot(J,B)/a.length(J),.08>J&&(J=1E-4),F/=J);return F}_getDistance(J,B){return this._isGlobalMode?this._getDistanceGlobeMode(J,B):this._getDistancePlanarMode(J,B)}_updateMinMaxDistance(J){0<J?(this.minDistance=Math.min(this.minDistance,J),this.maxDistance=Math.max(this.maxDistance,J)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-J))}getLodLevel(J){if(J.lodMetric===
t.LodMetric.None)return 0;if(0===J.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const B=this._screenspaceErrorBias;return this.evaluateLODmetric(J,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(J,B)?2:1:0}return this.evaluateLODmetric(J,this._screenspaceErrorBias)?this.maxLodLevel:0}evaluateLODmetric(J,B){switch(J.lodMetric){case t.LodMetric.ScreenSpaceRelative:const z=this.getServiceMbsInRenderSR(J),K=this._getDistance(this._camPos,
z),L=2*K/this._screenSizeFactor;this._updateMinMaxDistance(K+z[3]);return J.maxError*B<=L;case t.LodMetric.MaxScreenThreshold:return B=this._screenSpaceDiameterMbs(J,J.serviceMbsInIndexSR[3]*B),this._options.angleDependentLoD&&(B*=this.calcAngleDependentLoD(J)),B<J.maxError;case t.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(J,J.maxError)*B;case t.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(J)>J.maxError*B}return!1}distToPOI(J){J=this.getServiceMbsInRenderSR(J);
return a.distance(l.getCenter(J),this._poi)-J[3]}distCameraToPOI(){return a.distance(this._camPos,this._poi)}}const y=b.create(),D=d.createPoints(),G=b.create(),A=b.create(),C=new u.Obb,E=b.create(),I=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create(),b.create()],H=b.create();return v})},"esri/layers/support/SceneModification":function(){define("../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){var x;b=x=class extends n.JSONSupport{constructor(w){super(w);this.geometry=null;this.type="clip"}writeGeometry(w,p,t,q){if(q.layer?.spatialReference&&!q.layer.spatialReference.equals(this.geometry.spatialReference)){if(!f.canProjectWithoutEngine(w.spatialReference,q.layer.spatialReference)){q?.messages&&q.messages.push(new k("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:q.layer.spatialReference,
context:q}));return}const u=new r;f.projectPolygon(w,u,q.layer.spatialReference);p[t]=u.toJSON(q)}else p[t]=w.toJSON(q);delete p[t].spatialReference}clone(){return new x({geometry:h.clone(this.geometry),type:this.type})}};a.__decorate([m.property({type:r}),l.persistable()],b.prototype,"geometry",void 0);a.__decorate([c.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);a.__decorate([m.property({type:["clip","mask","replace"],nonNullable:!0}),l.persistable()],b.prototype,
"type",void 0);return b=x=a.__decorate([d.subclass("esri.layers.support.SceneModification")],b)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/tslib.es6 ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/lang ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/uid ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/projection/projectBuffer ../../../geometry/support/aaBoundingBox ../../../geometry/support/DoubleArray ../../../layers/graphics/dehydratedPoint ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A){class C{constructor(B,z){this.meta=B;this.index=z}}class E{constructor(B,z){this.graphic=B;this.geometry=z;this.components=[];this.overridesDirty=!1}}b=class extends n{get updating(){return this._graphicsCore?.updating??!1}constructor(B){super(B);this.loadedGraphics=new D.LimitGraphicsMap(5E4);this.slicePlaneEnabled=!1;this._renderingInfo={symbol:new A};this._featuresMap=new Map}initialize(){const B=this.view.basemapTerrain;this._graphicsCore=
new u.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:G.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:z=>this.view.deconflictor.addGraphicsOwner(z),labeler:(z,K)=>this.view.labeler.addGraphicsOwner(z,K,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),
scaleVisibility:(z,K)=>new v.Graphics3DScaleVisibility({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:K,graphicsCore:z,basemapTerrain:B,layerScaleEnabled:!1})}});this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this.addHandles(e.watch(()=>this.layer.labelingInfo,(z,K)=>{x.diff(z,K)&&this._graphicsCore.updateLabelingInfo()}))}destroy(){this._graphicsCore=g.destroyMaybe(this._graphicsCore);this.loadedGraphics=g.destroyMaybe(this.loadedGraphics);
this.view=null}addNodeMeta(B,z){let K=0;const L=B.filteredIds,F=this.view.spatialReference,M=[];for(let P=0;P<B.featureIds.length;P++){const R=B.featureIds[P];var S=null==L;L&&K<L.length&&R===L[K]&&(S=!0,K++);if(!this._enabledForFeatureInNode(B,P))continue;var N=this._featuresMap.get(R);if(N){N.components.push(new C(B,P));this._updateLabelPosition(R);continue}const O=z(P,B);N=q.makeDehydratedPoint(0,0,0,F);S={objectId:R,uid:d.generateUID(),attributes:O,visible:S,geometry:N};N=new E(S,N);N.components.push(new C(B,
P));this._featuresMap.set(R,N);this._updateLabelGeometry(R);M.push(S)}this.loadedGraphics.addMany(M)}updateLabelPositions(B){const z=this.view.renderCoordsHelper;this._forEachGraphic(B,(K,L,F)=>{L=this._graphicsCore.getGraphics3DGraphicById(L.uid);null!=L&&this._updateLabelGeometry(B.featureIds[K])&&L.alignWithAbsoluteElevation(F.z??0,z,!1)})}setNodeMetaAttributes(B,z){const K=[];this._forEachGraphic(B,(L,F)=>{L=z(L,B);k.equalsShallow(F.attributes,L)||(F.attributes=L,K.push(F.uid))});this._graphicsCore.updateLabelingInfo(K)}applyFilterChange(B){this._forEachFeature(B,
(z,K,L)=>{if(this._enabledForFeatureInNode(B,z))z=K.graphic,K=z.visible,K!==L&&(z.visible=L,I.graphic=z,I.property="visible",I.oldValue=K,I.newValue=L,this._graphicsCore.graphicUpdateHandler(I));else switch(L=B.featureIds[z],this._removeFeature(K,B,z)){case H.REMOVED:this.loadedGraphics.removeManyByObjectId([L]);break;case H.MODIFIED:this._updateLabelPosition(L)}})}removeNodeMeta(B){const z=[];this._forEachGraphic(B,K=>{const L=B.featureIds[K],F=this._featuresMap.get(L);if(F)switch(this._removeFeature(F,
B,K)){case H.MODIFIED:this._updateLabelPosition(L);break;case H.REMOVED:z.push(L)}});this.loadedGraphics.removeManyByObjectId(z)}_removeFeature(B,z,K){const L=B.components.length;h.filterInPlace(B.components,F=>!(F.meta===z&&F.index===K));return 0===B.components.length?(this._featuresMap.delete(z.featureIds[K]),H.REMOVED):L!==B.components.length?H.MODIFIED:H.UNMODIFIED}getRenderingInfo(){return this._renderingInfo}notifyGraphicGeometryChanged(){}notifyGraphicVisibilityChanged(){}_updateLabelPosition(B){const z=
this._featuresMap.get(B);z&&this._updateLabelGeometry(B)&&(this.loadedGraphics.removeManyByObjectId([B]),this.loadedGraphics.addMany([z.graphic]))}_updateLabelGeometry(B){B=this._featuresMap.get(B);if(!B)return!1;const z=B.geometry,K=this.view.spatialReference,L=this.view.renderCoordsHelper,F=z.x,M=z.y,S=z.z??0,N=t.newDoubleArray(B.components.length*y.boundingBoxCornersPointsStride);let P=0;for(const {meta:R,index:O}of B.components)y.boundingBoxCornerPoints(O,this.collection,R.objectHandle,N,P),P+=
y.boundingBoxCornersPointsStride;w.projectBuffer(N,L.spatialReference,0,N,K,0,N.length/3);p.set(J,p.negativeInfinity);p.expandWithBuffer(J,N);z.x=(J[0]+J[3])/2;z.y=(J[1]+J[4])/2;z.z=J[5];return!m.floatEqualUlp(z.x,F)||!m.floatEqualUlp(z.y,M)||!m.floatEqualUlp(z.z,S)}_forEachGraphic(B,z){this._forEachFeature(B,(K,{graphic:L,geometry:F},M)=>{this._enabledForFeatureInNode(B,K)&&z(K,L,F,M)})}_forEachFeature(B,z){let K=0;for(let L=0;L<B.featureIds.length;L++){const F=this._featuresMap.get(B.featureIds[L]);
let M=null==B.filteredIds;B.filteredIds&&B.filteredIds[K]===B.featureIds[L]&&(M=!0,K++);F&&z(L,F,M)}}_enabledForFeatureInNode(B,z){return 0>B.node.index||!this.overrides?.featureHasGeometryChanges(B.featureIds[z])}get updatePolicy(){return this._graphicsCore.effectiveUpdatePolicy}get usedMemory(){return this._graphicsCore.usedMemory}get unloadedMemoryEstimate(){return this._graphicsCore.unprocessedMemoryEstimate}get test(){return{graphicsCore:this._graphicsCore}}};a.__decorate([c.property()],b.prototype,
"view",void 0);a.__decorate([c.property()],b.prototype,"layer",void 0);a.__decorate([c.property()],b.prototype,"collection",void 0);a.__decorate([c.property()],b.prototype,"loadedGraphics",void 0);a.__decorate([c.property()],b.prototype,"overrides",void 0);a.__decorate([c.property()],b.prototype,"updating",null);a.__decorate([c.property()],b.prototype,"slicePlaneEnabled",void 0);a.__decorate([c.property()],b.prototype,"_graphicsCore",void 0);b=a.__decorate([r.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],
b);const I={graphic:null,property:null,oldValue:null,newValue:null};var H;(function(B){B[B.UNMODIFIED=0]="UNMODIFIED";B[B.MODIFIED=1]="MODIFIED";B[B.REMOVED=2]="REMOVED"})(H||={});const J=p.create();return b})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBuffer ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/DoubleArray".split(" "),function(a,
b,n,h,k,m){function g(c,l,f,r,x){c=l.getComponentAabb(f,c,e);l=l.getObjectTransform(f);for(f=0;8>f;++f)d[0]=f&1?c[0]:c[3],d[1]=f&2?c[1]:c[4],d[2]=f&4?c[2]:c[5],b.transformMat3(d,d,l.rotationScale),b.add(d,d,l.position),r[x++]=d[0],r[x++]=d[1],r[x++]=d[2];return r}const e=k.create(),d=n.create();a.boundingBoxCornerPoints=g;a.boundingBoxCornersPointsStride=24;a.createGetFeatureExtent=function(c,l,f){const r=m.newDoubleArray(24);return x=>{var w=x.meta.featureExtents;if(null==w){w=new Float64Array(6*
x.meta.featureIds.length);x.meta.featureExtents=w;for(let p=0;p<w.length;p+=6)w[p]=Number.POSITIVE_INFINITY}w=new Float64Array(w.buffer,6*x.index*Float64Array.BYTES_PER_ELEMENT,6);w[0]===Number.POSITIVE_INFINITY&&(g(x.index,f,x.meta.objectHandle,r,0),h.projectBuffer(r,l,0,r,c,0,8)?(k.set(w,k.negativeInfinity),k.expandWithBuffer(w,r,0,8)):k.set(w,k.zero));return w}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports",
"../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,n,h){class k extends b{constructor(d){super();this._limit=d;this._all=new h.GraphicsMap;this._active=new e(this);this._pending=new Map;this._handle=this._all.on("change",c=>this._handleChanges(c))}destroy(){this._handle.remove()}get length(){return this._active.length}toArray(){return this._active.toArray()}find(d){return this._active.find(d)}forEach(d){this._active.forEach(d)}addMany(d){this._all.addMany(d)}removeManyByObjectId(d){this._all.removeManyByObjectId(d)}_handleChanges(d){let c=
d.removed;if(0<this._pending.size){c=[];for(var l of d.removed)this._pending.delete(l.objectId)||c.push(l)}l=this._limit-this._active.length+c.length;l<d.added.length&&(this._active.removeMany(c),c=[],g.reset(1-this._limit/(this._active.length+d.added.length)),this._active.forEach(r=>{g.sample()&&(c.push(r),this._pending.set(r.objectId,r))}),l=this._limit-this._active.length+c.length);let f=d.added;if(l<d.added.length){f=[];g.reset(l/d.added.length);for(const r of d.added)g.sample()?f.push(r):this._pending.set(r.objectId,
r)}d=l-f.length;0<d&&0<this._pending.size&&(g.reset(d/this._pending.size),this._pending.forEach(r=>{g.sample()&&(f.push(r),this._pending.delete(r.objectId))}));this._active.addAndRemove(f,c)}}class m{constructor(){this._percentage=1;this._last=-1;this._index=0}reset(d){this._percentage=d;this._last=-1}sample(){const d=Math.floor(this._index*this._percentage);++this._index;if(d===this._last)return!1;this._last=d;return!0}}const g=new m;class e{constructor(d){this._parent=d;this._map=new Map}get length(){return this._map.size}forEach(d){this._map.forEach(c=>
d(c))}find(d){let c=void 0;n.someMap(this._map,l=>d(l)?(c=l,!0):!1);return c}toArray(){return[...this._map.values()]}addAndRemove(d,c){for(const l of d)this._map.set(l.objectId,l);for(const l of c)this._map.delete(l.objectId);(0<d.length||0<c.length)&&this._parent.emit("change",{added:d,removed:c})}removeMany(d){for(const c of d)this._map.delete(c.objectId);0<d.length&&this._parent.emit("change",{added:[],removed:d})}}a.LimitGraphicsMap=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../core/Evented","../../../core/MapUtils"],function(a,b,n){class h extends b{constructor(){super(...arguments);this._map=new Map}clear(){if(0<this._map.size){const k=this.toArray();this._map.clear();this.emit("change",{added:[],removed:k})}}get length(){return this._map.size}get(k){return this._map.get(k)}addMany(k){if(0!==k.length){var m=new Set;for(let g=0;g<k.length;g++){const e=k[g],d=e.objectId,c=this._map.get(d);c?(m.add(d),
e!==c&&(k[g]=c),c.refCount||(c.refCount=0),++c.refCount):(e.refCount=1,this._map.set(d,e))}k=0<m.size?k.filter(g=>!m.has(g.objectId)):k;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeMany(k){const m=[];for(const g of k){k=g.objectId;const e=this._map.get(k);null!=e&&(!e.refCount||0>=--e.refCount)&&(this._map.delete(k),m.push(g))}0<m.length&&this.emit("change",{added:[],removed:m})}removeManyByObjectId(k){const m=[];for(const g of k)k=this._map.get(g),null!=k&&(!k.refCount||0>=--k.refCount)&&
(this._map.delete(g),m.push(k));0<m.length&&this.emit("change",{added:[],removed:m})}toArray(){return[...this._map.values()]}find(k){let m;n.someMap(this._map,g=>k(g)?(m=g,!0):!1);return m}forEach(k){this._map.forEach(m=>k(m))}}a.GraphicsMap=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshViewPerformanceInfo":function(){define(["exports","./support/LayerViewPerformanceInfo"],function(a,b){class n extends b.LayerViewPerformanceInfo{constructor(h,k,m,g,
e,d,c){super(h,0,0,0,k);this.gpuMB=m;this.geometryMB=g;this.textureMB=e;this.unloadedMB=d;this.idbHitRate=c}}a.I3SMeshViewPerformanceInfo=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../core/Logger ../../../core/PooledArray ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../geometry/projection/projectVectorToVector ../../../libs/i3s/enums".split(" "),
function(a,b,n,h,k,m,g,e){function d(r,x,w){l.clear();var p=Infinity;let t=Infinity,q=-Infinity,u=-Infinity,v=!1;for(const D of x){var y="clip"===D.type?e.ModificationType.Inside:"mask"===D.type?e.ModificationType.Outside:e.ModificationType.Replace;const G=D.geometry;x=A=>A;if(G.spatialReference){if(!m.canProjectWithoutEngine(G.spatialReference,w)){b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}x=A=>{g.projectVectorToVector(A,G.spatialReference,f,w);return f}}else G.hasZ||(f[2]=0,x=A=>{f[0]=A[0];f[1]=A[1];return f});v=v||y===e.ModificationType.Outside;l.push(y);l.push(G.rings.length);for(const A of G.rings){l.push(A.length);for(const C of A)y=x(C),l.push(y[0]),l.push(y[1]),l.push(y[2]),p=Math.min(p,y[0]),t=Math.min(t,y[1]),q=Math.max(q,y[0]),u=Math.max(u,y[1])}}null!=r&&(v?(l.push(e.ModificationType.Inside),l.push(2),l.push(4),l.push(p-1E-4),l.push(t-1E-4),l.push(0),l.push(q+1E-4),
l.push(t-1E-4),l.push(0),l.push(q+1E-4),l.push(u+1E-4),l.push(0),l.push(p-1E-4),l.push(u+1E-4),l.push(0)):(l.push(e.ModificationType.Outside),l.push(1)),l.push(4),l.push(r[0]),l.push(r[1]),l.push(0),l.push(r[2]),l.push(r[1]),l.push(0),l.push(r[2]),l.push(r[3]),l.push(0),l.push(r[0]),l.push(r[3]),l.push(0));l.push(e.ModificationType.Finished);r=new Float64Array(l.length);for(p=0;p<l.length;++p)r[p]=l.at(p);return r}class c extends k.WorkerHandle{constructor(r){super("SceneLayerWorker","process",{process:x=>
[x.geometryBuffer],project:x=>[x.positions.buffer],transformNormals:x=>[x.normals.buffer]},r,{hasInitialize:!0})}setModifications(r,x,w,p){r={context:r,modifications:d(x,w,p),isGeodetic:p.isGeographic};this.broadcast(r,"setModifications")}setLegacySchema(r,x){x=JSON.stringify(x);return this.broadcast({context:r,jsonSchema:x},"setLegacySchema")}destroyContext(r){return this.broadcast(r,"destroyContext")}project(r,x){return this.invokeMethod("project",r,x)}transformNormals(r,x){return this.invokeMethod("transformNormals",
r,x)}}const l=new n({deallocator:null}),f=h.create();a.I3SMeshWorkerHandle=c;a.toWasmModification=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||
(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesMode=void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.QUERYABLE=2]="QUERYABLE"})(a.ForAllFeaturesMode||(a.ForAllFeaturesMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType=
{}));a.ElevationMode=void 0;(function(b){b[b.Absolute=0]="Absolute";b[b.RelativeToGround=1]="RelativeToGround";b[b.OnTheGround=2]="OnTheGround"})(a.ElevationMode||(a.ElevationMode={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../geometry/SpatialReference ../../../geometry/support/DoubleArray ../../../geometry/support/MeshGeoreferencedVertexSpace ../../../geometry/support/MeshLocalVertexSpace ../../../chunks/vec3 ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),
function(a,b,n,h,k,m,g,e,d,c){function l(v){if(q){var y=v.modifications,D=q._malloc(8*y.length),G=new Float64Array(q.HEAPU8.buffer,D,y.length);for(let A=0;A<y.length;++A)G[A]=y[A];q.setModifications(v.context,D,y.length,v.isGeodetic);q._free(D)}}function f(v,y,D){const {context:G,localOrigin:A,globalTrafo:C,mbs:E,obbData:I,elevationOffset:H,geometryBuffer:J,geometryDescriptor:B,indexToVertexProjector:z,vertexToRenderProjector:K}=y;var L=v._malloc(J.byteLength),F=v._malloc(33*Float64Array.BYTES_PER_ELEMENT),
M=new Uint8Array(v.HEAPU8.buffer,L,J.byteLength);M.set(new Uint8Array(J));var S=new Float64Array(v.HEAPU8.buffer,F,33);w(S,A);var N=S.byteOffset+3*S.BYTES_PER_ELEMENT,P=new Float64Array(S.buffer,N);w(P,C);N+=16*S.BYTES_PER_ELEMENT;P=new Float64Array(S.buffer,N);w(P,E);N+=4*S.BYTES_PER_ELEMENT;I&&(P=new Float64Array(S.buffer,N),w(P,I));S={isDraco:!1,isLegacy:!1,color:y.layouts.some(T=>T.some(Q=>"color"===Q.name)),normal:y.needNormals&&y.layouts.some(T=>T.some(Q=>"normalCompressed"===Q.name)),uv0:y.layouts.some(T=>
T.some(Q=>"uv0"===Q.name)),uvRegion:y.layouts.some(T=>T.some(Q=>"uvRegion"===Q.name)),featureIndex:B.featureIndex};M=v.process(G,!!y.obbData,L,M.byteLength,B,S,F,H,z,K,y.normalReferenceFrame);v._free(F);v._free(L);if(0<M.error.length)throw Error(`i3s.wasm: ${M.error}`);if(M.discarded)return null;v=0<M.componentOffsets.length?M.componentOffsets.slice():null;L=0<M.featureIds.length?M.featureIds.slice():null;F=0<M.anchorIds.length?Array.from(M.anchorIds):null;S=0<M.anchors.length?Array.from(M.anchors):
null;N=M.interleavedVertedData.slice().buffer;P=M.indicesType===e.IndexType.Int16?(new Uint16Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/2)).slice():(new Uint32Array(M.indices.buffer,M.indices.byteOffset,M.indices.byteLength/4)).slice();const R=M.positions.slice(),O=M.positionIndicesType===e.IndexType.Int16?(new Uint16Array(M.positionIndices.buffer,M.positionIndices.byteOffset,M.positionIndices.byteLength/2)).slice():(new Uint32Array(M.positionIndices.buffer,M.positionIndices.byteOffset,
M.positionIndices.byteLength/4)).slice();y={layout:y.layouts[0],interleavedVertexData:N,indices:P,hasColors:M.hasColors,hasModifications:M.hasModifications,positionData:{data:R,indices:O}};L&&D.push(L.buffer);v&&D.push(v.buffer);D.push(N);D.push(P.buffer);D.push(R.buffer);D.push(O.buffer);return{componentOffsets:v,featureIds:L,anchorIds:F,anchors:S,transformedGeometry:y,obb:M.obb}}function r(v){if(q){var {context:y,buffer:D}=v;v=q._malloc(D.byteLength);var G=D.byteLength/Float64Array.BYTES_PER_ELEMENT,
A=new Float64Array(q.HEAPU8.buffer,v,G),C=new Float64Array(D);A.set(C);q.filterOBBs(y,v,G);C.set(A);q._free(v)}}function x(v){q&&0===q.destroy(v)&&(q=null)}function w(v,y){for(let D=0;D<y.length;++D)v[D]=y[D]}function p(){if(q)return Promise.resolve(q);t||=d.get().then(v=>{q=v;t=null;return q});return t}let t,q;const u={transform:(v,y)=>q&&f(q,v,y),destroy:x};b.destroyContext=function(v){x(v)};b.dracoDecompressPointCloudData=async function(v){q=await p();const y=[v.geometryBuffer];var {geometryBuffer:D}=
v,G=D.byteLength;v=q._malloc(G);G=new Uint8Array(q.HEAPU8.buffer,v,G);G.set(new Uint8Array(D));D=q.dracoDecompressPointCloudData(v,G.byteLength);q._free(v);if(0<D.error.length)throw Error(`i3s.wasm: ${D.error}`);v=0<D.featureIds?.length?D.featureIds.slice():null;D=D.positions.slice();v&&y.push(v.buffer);y.push(D.buffer);return{result:{positions:D,featureIds:v},transferList:y}};b.filterObbsForModifications=async function(v){await p();r(v);v={buffer:v.buffer};return{result:v,transferList:[v.buffer]}};
b.filterObbsForModificationsSync=r;b.initialize=async function(){q||await p()};b.interpretObbModificationResults=function(v){return 0===v?c.NodeIMModificationImpact.Unmodified:1===v?c.NodeIMModificationImpact.PotentiallyModified:2===v?c.NodeIMModificationImpact.Culled:c.NodeIMModificationImpact.Unknown};b.process=async function(v){q=await p();const y=[v.geometryBuffer];return{result:f(q,v,y),transferList:y}};b.project=async function(v){const {localMatrix:y,origin:D,positions:G,vertexSpace:A,localMode:C}=
v;var E=n.fromJSON(v.inSpatialReference);v=n.fromJSON(v.outSpatialReference);if("georeferenced"===A.type&&null==A.origin){const [{projectBuffer:z},{initializeProjection:K}]=await Promise.all([new Promise((L,F)=>a(["../../../geometry/projection/projectBuffer"],L,F)),new Promise((L,F)=>a(["../../../geometry/projection"],L,F))]);await K(E,v);var I=new Float64Array(G.length);z(G,E,0,I,v,0,I.length/3)}else{I="georeferenced"===A.type?k.fromJSON(A):m.fromJSON(A);const {project:z}=await new Promise((K,L)=>
a(["../../../geometry/support/meshUtils/georeference"],K,L));I=h.toFloat64Array(z({positions:G,transform:y?{localMatrix:y}:void 0,vertexSpace:I,inSpatialReference:E,outSpatialReference:v,localMode:C}))}E=I.length;const [H,J,B]=D;for(v=0;v<E;v+=3)I[v]-=H,I[v+1]-=J,I[v+2]-=B;return{result:{projected:I,original:G},transferList:[I.buffer,G.buffer]}};b.setLegacySchema=async function(v){q=await p();q.setLegacySchema(v.context,v.jsonSchema)};b.setModifications=async function(v){await p();l(v)};b.setModificationsSync=
l;b.test=u;b.transformNormals=async function({normalMatrix:v,normals:y}){const D=new Float32Array(y.length);g.transformMat3(D,y,v);g.normalize(D,D);return{result:{transformed:D,original:y},transferList:[D.buffer,y.buffer]}};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,n){function h(m){return n.getAssetUrl(`esri/libs/i3s/${m}`)}let k;b.get=function(){k||=(new Promise(m=>(new Promise((g,
e)=>a(["../../chunks/i3s"],g,e))).then(g=>g.i3s).then(({default:g})=>{const e=g({locateFile:h,onRuntimeInitialized:()=>m(e)});delete e.then}))).catch(m=>{throw m;});return k};Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../../../../core/handleUtils","../II3SMeshView3D"],function(a,b,n){class h{constructor(){this.ids=new Set}}class k{constructor({collection:m,forAllFeatures:g,forAllFeaturesOfNode:e}){this._highlights=
[];this._collection=m;this._forAllFeatures=g;this._forAllFeaturesOfNode=e}destroy(){this._highlights.forEach(m=>this._releaseSet(m));this._highlights=null}acquireSet(){const m=new h;this._highlights.push(m);const g=b.makeHandle(()=>{this._highlights&&(this._releaseSet(m),a.removeUnordered(this._highlights,m))});return{set:m,handle:g}}setFeatureIds(m,g){g.forEach(e=>m.ids.add(e));this._initializeSet(m)}_initializeSet(m){this._forAllFeatures((g,e,d)=>{m.ids.has(g)&&this._collection.addComponentHighlight(d.objectHandle,
e);return n.ForAllFeaturesReturnType.CONTINUE})}_releaseSet(m){this._forAllFeatures((g,e,d)=>{m.ids.has(g)&&this._collection.removeComponentHighlight(d.objectHandle,e);return n.ForAllFeaturesReturnType.CONTINUE})}objectCreated(m){this._highlights.forEach(g=>{this._forAllFeaturesOfNode(m,(e,d)=>{g.ids.has(e)&&this._collection.addComponentHighlight(m.objectHandle,d);return n.ForAllFeaturesReturnType.CONTINUE})})}objectDeleted(m){this._collection.clearHighlights(m.objectHandle)}}return k})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../II3SMeshView3D ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){a.I3SAsyncElevationUpdater=class extends n{constructor(f,r,x,w){super({});this._updateExtent=r;this._updateNode=x;this._getElevationMode=w;this.running=!1;this._extentSet=new c.ExtentSet;this._nodeSet=new Set;r=this._taskPriority;f=f.registerTask(this._taskPriority,this);this.addHandles(f);this._task=f;this._lastTaskPriority=r}get _taskPriority(){const f=this._getElevationMode();return f?f===d.ElevationMode.RelativeToGround?l.TaskPriority.ELEVATION_ALIGNMENT_SCENE:
l.TaskPriority.ELEVATION_ALIGNMENT:l.TaskPriority.ELEVATION_ALIGNMENT}_updateTaskPriority(){const f=this._taskPriority;f!==this._lastTaskPriority&&(this._lastTaskPriority=this._task.priority=f)}normalizeCtorArgs(){return{}}addExtent(f){this._extentSet.add(f);this._updateTaskPriority();this.running=!0}schedule(f){this._nodeSet.add(f);this._updateTaskPriority();this.running=!0}remove(f){this._nodeSet.delete(f);this._updateRunning()}runTask(f){const r=this._extentSet;for(f.run(()=>r.merge(f));!r.empty&&
!f.done;){var x=this._updateExtent(r.pop());null!=x&&x.forAll(w=>this.schedule(w));f.madeProgress()}if(!f.done){x=this._nodeSet;for(const w of x)if(x.delete(w),this._updateNode(w),f.madeProgress(),f.done)break;this._updateRunning()}}_updateRunning(){this.running=0<this._nodeSet.size||0<this._extentSet.size}};b.__decorate([h.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=b.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],
a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,n,h){class k{constructor(){this.lodCrossfadeSignedDuration=0}}class m{constructor(g){this._view=g;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}destroy(){this._preRenderFrameTaskHandle?.remove();this._view=
this._preRenderFrameTaskHandle=null}get updating(){return 0<this._numFadingNodes}stopNodeFading(g){null!=g.lodCrossfadeProgress&&(this._numFadingNodes--,g.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))}_startNodeFading(g,e,d){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=n.addFrameTask({preRender:c=>this._updateAllNodeFading(c)}),
this._view.notifyLODUpdate());null==g.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());g.lodCrossfadeSignedDuration=d;g.lodCrossfadeProgress=e}_updateAllNodeFading(g){const e=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((d,c)=>{if(null!=d?.lodCrossfadeProgress){const l=d.lodCrossfadeSignedDuration,f=d.lodCrossfadeProgress+Math.abs(g.deltaTime/l),r=!e||1<=f||0===l,x=(0<l?this._view.fullOpacity:0)-(r?0:0<l?1:-1)*(1-f);r?(this.stopNodeFading(d),0>l&&this._view.markNodeToRemove(c)):
d.lodCrossfadeProgress=f;this._view.setNodeOpacityByIndex(c,x)}});this._view.removeMarkedNodes()}stopAllNodeFading(){this._view.foreachCrossfadeNode((g,e)=>{null!=g?.lodCrossfadeProgress&&(this.stopNodeFading(g),g=g.lodCrossfadeSignedDuration,0>g&&this._view.markNodeToRemove(e),this._view.setNodeOpacityByIndex(e,0<g?this._view.fullOpacity:0))});this._view.removeMarkedNodes()}fadeNode(g,e,d,c){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var l=this._view;const f=l.nodeCrossfadingEnabled,
r=d===h.FadeDirection.FadeIn?l.fullOpacity:0;c=f?c?d===h.FadeDirection.FadeIn?l.lodCrossfadeinDuration:l.lodCrossfadeoutDuration:l.lodCrossfadeUncoveredDuration:0;l=this._view.getNodeOpacityByIndex(g);f&&l!==r&&0<c?this._startNodeFading(e,1-Math.abs(r-l),(d===h.FadeDirection.FadeIn?1:-1)*c):(this.stopNodeFading(e),this._view.setNodeOpacityByIndex(g,r),d===h.FadeDirection.FadeOut&&this._view.removeNode(g))}isNodeFullyFadedIn(g){const e=this._view.getNodeCrossfadeMetaData(g);return null==e||null==e.lodCrossfadeProgress&&
this._view.getNodeOpacityByIndex(g)===this._view.fullOpacity}}a.I3SCrossfadeHelper=m;a.NodeCrossfadeMetaData=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../ViewingMode ./I3SUtil ./Intersector ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(a,b,n,h,k,m,g){function e(c,l,f,r=0){r=c[3]+r;const x=l[0]-c[0],
w=l[1]-c[1];c=l[2]-c[2];l=f[0];const p=f[1];f=f[2];const t=l*x+p*w+f*c;return 0<=t*t-(l*l+p*p+f*f)*(x*x+w*w+c*c-r*r)}class d{constructor(c){this.type=m.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=c.layerUid;this.sublayerUid=c.sublayerUid;this._collection=c.collection;this._traverseNodeHierarchy=c.traverseNodeHierarchy;this.slicePlaneEnabled=c.slicePlaneEnabled;this.isGround=c.isGround}updateElevationAlignState(c,l){this._needVerticalOffset=c&&l===b.ViewingMode.Global}intersect(c,
l,f,r,x,w){const p=w??!1,t=c.results,q=c.options.store===m.StoreResults.ALL,u=c.ray.direction,v=c.tolerance;let y=A=>A,D=A=>A;const G=g.getVerticalOffsetI3S(c.verticalOffset??(this._needVerticalOffset?0:null));null!=c.verticalOffset&&null!=G&&(y=A=>G.applyToMbs(A),D=A=>G.applyToObb(A));this._traverseNodeHierarchy((A,C)=>{if(0===A.childrenLoaded)return!1;const E=A.serviceObbInRenderSR?.isValid?A.serviceObbInRenderSR:null;if(E&&!D(E).intersectRay(f,u,v))return!1;!C||!E&&n.isValidMbs(A.serviceMbsInRenderSR)&&
!e(y(A.serviceMbsInRenderSR),f,u,v)||null!=A.geometryObbInRenderSR&&!D(A.geometryObbInRenderSR).intersectRay(f,u,v)||this._collection.intersect(C,f,r,v,G,(I,H,J,B)=>{if(!(0>H||null!=l&&!l(f,r,H))){var z=K=>{const L=new h.I3sTarget(this.layerUid,this.sublayerUid,A.index,I,B);K.set(this.type,L,H,J)};this.isGround&&(null==t.ground.dist||H<t.ground.dist)&&z(t.ground);if(!c.options.isFiltered&&((null==t.min.dist||H<t.min.dist)&&z(t.min),(null==t.max.dist||H>t.max.dist)&&z(t.max),q)){const K=k.newIntersectorResult(c.ray);
z(K);c.results.all.push(K)}}},p);return!0})}}a.I3SIntersectionHandler=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Collection ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/ReactiveSet ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/spatialReferenceUtils ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../rest/support/meshFeatureSet ../../../../support/featureFlags ../../../../support/requestUtils ../../../ViewingMode ../FeatureLayerView3D".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C){function E(J,B,z,K){return`Displaying the edits of a SceneLayer with a${K===H.Mode?J.isGeographic?" geographic ":" projected ":" "}spatial reference (wkid:${J.wkid}) in ${z} viewing mode${K===H.SpatialReference?` with spatial reference (wkid:${B.wkid}) `:" "}is not supported. No geometry edits will be displayed for this layer.\nPlease consider re-caching the scene service or changing the ${K===H.Mode?"viewing mode":"view spatial reference"} to display edits.`}
a.I3SOverrides=class extends h{constructor(J){super(J);this._warnMaximumChangedObjectsExceeded=!1;this._maximumNumberOfEditOVerrides=5E4;this._original3DOFLDefinitionExpression=null;this._interactiveEditingSessions=new e;this.geometryOverrides=new e;this._clientGeometryCache=new Map;this._associatedLayerView=null;this._attributeChangedObjectIds=new r;this._geometryChangedObjectIds=new r;this._pendingFetchChangedObjectIds=null;this._pendingFetchAbortController=new AbortController;this._featureIdLocks=
new Map}initialize(){this._memCache=this.memoryController.newCache(`i3s-attribute-overrides-${this.layer.uid}`);this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.finally(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&null!=this._associatedLayer&&(D.direct3DObjectFeatureLayerDisplayEnabled()?this._associatedLayer.load().then(J=>{this.destroyed||(this._original3DOFLDefinitionExpression=
J.definitionExpression,this.addHandles(x.watch(()=>this._definitionExpression,B=>J.definitionExpression=B,x.initial)),this._associatedLayerView=new C({layer:this._associatedLayer,view:this.view}))}):D.i3sPatchingEnabled())}destroy(){this.is3DOFL&&null!=this._associatedLayer&&(D.direct3DObjectFeatureLayerDisplayEnabled()?null!=this._associatedLayerView&&(this._associatedLayer.definitionExpression=this._original3DOFLDefinitionExpression):D.i3sPatchingEnabled());this._set("layer",null);this._memCache=
l.destroyMaybe(this._memCache);this._pendingFetchAbortController=l.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=null;this._featureIdLocks.clear()}get is3DOFL(){return D.sceneLayerEditingEnabled()&&null!=this._associatedLayer?.infoFor3D}get sortedGeometryChangedObjectIds(){return this.is3DOFL?[...this._geometryChangedObjectIds].sort((J,B)=>J-B):[]}get _associatedLayer(){return null==this.layer?null:this.layer.associatedLayer}get hasGeometryChanges(){return 0<this._geometryChangedObjectIds.size}get _definitionExpression(){const J=
this.sortedGeometryChangedObjectIds;return 0===J.length?"1 \x3d 0":`OBJECTID IN (${J.join(",")})`}get updating(){return this.is3DOFL?this._pendingFetchChangedObjectIds?!0:D.direct3DObjectFeatureLayerDisplayEnabled()?null==this._associatedLayerView||null!=this._associatedLayerView&&this._associatedLayerView.updating:!1:!1}get isEmpty(){return null==this._pendingFetchChangedObjectIds&&0===this._attributeChangedObjectIds.size&&0===this._geometryChangedObjectIds.size}featureHasGeometryChanges(J){return this._geometryChangedObjectIds.has(J)}featureHasAttributeChanges(J){return this._attributeChangedObjectIds.has(J)}createInteractiveEditSession(J){this._attributeChangedObjectIds.add(J);
const B=this._interactiveEditingSessions,z=new I(J,()=>{B.remove(z)});B.unshift(z);return z}async applyAttributeOverrides(J,B,z,K=[]){this._pendingFetchChangedObjectIds&&await f.whenOrAbort(this._pendingFetchChangedObjectIds,z);if(null!=B){var {attributeData:L,loadedAttributes:F}=B;if(null!=F&&null!=L&&0!==this._attributeChangedObjectIds.size){B=new Set;for(var M of F)B.add(M.index);for(const N of K)B.has(N.index)||(F.push(N),L[N.name]=Array(J.length));K=await this._lockFeatureIds(J);try{M={attributeData:L,
loadedAttributes:F};const N=this._getOverridesFromCache(J,M,this._attributeChangedObjectIds),{objectIds:P,fieldNames:R}=N;if(0!==P.length&&0!==R.length){var S=await this._queryAttributeOverridesFromAssociatedLayer(P,R,z);null!=S&&this._processOverridesFromAssociatedLayer(J,S,R,M)}}finally{K.remove()}}}}updateGeometry(J,B){this._geometryChangedObjectIds.add(J);const z=this._clientGeometryCache.get(J);null!=z&&(this.geometryOverrides.remove(z),this._clientGeometryCache.delete(J));null!=B&&(B={oid:J,
mesh:B},this.geometryOverrides.add(B),this._clientGeometryCache.set(J,B))}updateAttributeValue(J,B,z){this._attributeChangedObjectIds.add(J);this._cacheAttributeValue(J,B,z)}featureAdded(J){this.is3DOFL&&D.i3sPatchingEnabled()&&this._geometryChangedObjectIds.add(J);this._attributeChangedObjectIds.add(J)}_cacheAttributeValue(J,B,z){this._memCache.put(this._getAttributeCacheKey(J,B),z,this._memCacheAttributeValueSize(z))}_getOverridesFromCache(J,{loadedAttributes:B,attributeData:z},K){const L=new Set,
F=[];for(var M of B)F[M.index]=z[M.name];z=new Set;for(M=0;M<J.length;M++){const S=J[M];if(K.has(S))for(const N of B){const P=this._attributeFromCache(S,N.index);void 0!==P?F[N.index][M]=P:(L.add(S),z.add(N.name))}}return{objectIds:Array.from(L),fieldNames:Array.from(z)}}_attributeFromCache(J,B){const z=this._fromInteractiveEditingSession(J,B);if(void 0!==z)return z;J=this._getAttributeCacheKey(J,B);return this._memCache.get(J)}_fromInteractiveEditingSession(J,B){if(null!=this._interactiveEditingSessions)for(const z of this._interactiveEditingSessions){if(z.objectId!==
J)continue;const K=z.getAttribute(B);if(void 0!==K)return K}}_getAttributeCacheKey(J,B){return`${J}-${B}`}async _queryAttributeOverridesFromAssociatedLayer(J,B,z){if(0===J.length)return null;this._logWarningIfMaximumObjectsExceeded();const {associatedLayer:K}=this.layer;if(null==K)return null;const L=K.createQuery(),{objectIdField:F}=K;B=[F,...B];L.where="1\x3d1";L.returnGeometry=!1;L.outFields=B;L.cacheHint=!0;J=await this._executeBatchQuery(K,J,L,z);z=[];for(const M of J)if(M.ok)for(const S of M.value.features)z.push(S);
return z}async _queryGeometryOverridesFromAssociatedLayer(J,B){if(0===J.length||!this.is3DOFL||!D.i3sPatchingEnabled())return null;var z=this.layer.associatedLayer;const K=z.infoFor3D,{spatialReference:L}=z,{state:{viewingMode:F},spatialReference:M}=this.view;var S=F===A.ViewingMode.Global,N=L.isGeographic;if(S&&!N)return c.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("unsupported-pcs-edits-in-global-view",this.layer.title,E(L,M,this.view.viewingMode,H.Mode)),null;if(!S&&N)return c.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("unsupported-gcs-edits-in-local-view",
this.layer.title,E(L,M,this.view.viewingMode,H.Mode)),null;if(!(q.equals(L,M)||S&&M.isWebMercator&&L.isWGS84))return c.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("unsupported-mismatched-spatial-reference-edits",this.layer.title,E(L,M,this.view.viewingMode,H.SpatialReference)),null;this._logWarningIfMaximumObjectsExceeded();const {objectIdField:P,globalIdField:R}=z;S=[P,...(null!=R?[R]:[])];N=z.createQuery();N.where="1\x3d1";N.returnGeometry=!0;N.outFields=S;N.cacheHint=!0;N.returnZ=z.hasZ;
N.returnM=z.hasM;B=await this._executeBatchQuery(z,J,N,B);J=[];for(const O of B){if(!O.ok)continue;const {assetMaps:T,features:Q,globalIdFieldName:V}=O.value;if(null!=T){B=y.assetMapFromAssetMapsJSON(K,T);for(const U of Q)z=y.extractMesh(U,V,L,K,B),S=U,null==z?S.geometry=null:(S.geometry=z,J.push(S))}}return J}_logWarningIfMaximumObjectsExceeded(){if(this._warnMaximumChangedObjectsExceeded){this._warnMaximumChangedObjectsExceeded=!1;var J=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${u.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`,
B=this.layer.portalItem;J=B&&B.loaded?J+` (${B.portal.url}/home/item.html?id=${B.id}#settings)`:J+` (${this.layer.parsedUrl.path})`;c.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,`${J}.`)}}async _executeBatchQuery(J,B,z,K){if(0===B.length)return[];const L=v.getMaximumQuerySize(J);B=[...B].sort((F,M)=>F-M);B=k.splitIntoChunks(B,L).map(F=>{const M=z.clone();M.objectIds=F;return m.resultOrAbort(v.queryAllJSON(J,M,{signal:K}))});return Promise.all(B)}_processOverridesFromAssociatedLayer(J,
B,z,{loadedAttributes:K,attributeData:L}){var F=this._associatedLayer;if(null!=F){F=F.objectIdField;var M=z.map(P=>{P in L||(L[P]=Array(J.length));return L[P]}),S=new Map(K.map(P=>[P.name,P.index]));K=z.map(P=>S.get(P));var N=new Map(Array.from(J,(P,R)=>[P,R]));for(const P of B){B=P.attributes[F];for(let R=0;R<z.length;R++){const O=K[R],T=N.get(B),Q=P.attributes[z[R]];M[R][T]=Q;this._cacheAttributeValue(B,O,Q)}}}}_memCacheAttributeValueSize(J){return"string"===typeof J?g.estimateStringByteSize(J):
g.estimateNumberByteSize()}async _fetchChangedObjectIds(J){var B=this.layer;await B.load({signal:J});this._geometryChangedObjectIds.clear();this._attributeChangedObjectIds.clear();({associatedLayer:B}=B);if(null!=B&&B.capabilities?.operations?.supportsChangeTracking){var z=this._getFetchChangedObjectIdsServerGen();if(null!=z){var K=B.layerId,L=this.is3DOFL;z={f:"json",returnIdsOnly:!0,layers:`[${K}]`,returnUpdates:!0,returnDeletes:L,returnInserts:L,layerServerGens:JSON.stringify([{id:K,serverGen:z}])};
L&&(K=B.infoFor3D,z.fieldsToCompare=JSON.stringify({fields:[...Object.values(K.transformFieldRoles),K.sourceHashField]}));z=await m.result(n(`${B.url}/extractChanges`,{method:"post",query:z,timeout:1E4,signal:J}));!z.ok&&G.isTimeoutError(z.error)&&(K=this.layer.title,c.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("extractChanges:timeout",K,`${K} could not obtain edited features that are not cached in the scene service. Display of features may not be up to date with the latest edits. Consider re-caching the scene service.`));
if(z.ok&&1===z.value.data?.edits?.length){K=z.value.data.edits[0];z=K?.objectIds;var F=z?.adds??[];const M=z?.updates??[],S=z?.deletes??[];z=[...F,...M,...S];L=L?[...F,...(K?.fieldUpdates??M),...S]:[];K=Math.min(this._maximumNumberOfEditOVerrides,z.length);K<z.length&&(this._warnMaximumChangedObjectsExceeded=!0);z=z.sort((N,P)=>N-P);for(F=0;F<K;++F)this._attributeChangedObjectIds.add(z[F]);for(const N of L)this._geometryChangedObjectIds.add(N);if(this.is3DOFL&&D.i3sPatchingEnabled()&&0<this._geometryChangedObjectIds.size&&
(J=await this._queryGeometryOverridesFromAssociatedLayer(Array.from(this._geometryChangedObjectIds),J),null!=J))for(const N of J)null!=N.geometry&&this.updateGeometry(N.attributes[B.objectIdField],N.geometry)}}}}_getFetchChangedObjectIdsServerGen(){var J=this.layer;if(null!=J.serviceUpdateTimeStamp?.lastUpdate)return J.serviceUpdateTimeStamp.lastUpdate;J=J.associatedLayer;return null!=J?.serverGens?.minServerGen?J.serverGens.minServerGen:null}async _lockFeatureIds(J){const B=this._featureIdLocks;
for(var z=!0;z;){const L=[];for(const F of J){const M=B.get(F);M&&L.push(M)}0===L.length?z=!1:await Promise.all(L)}const K=f.createResolver();z=K.promise;for(const L of J)B.set(L,z);return d.makeHandle(()=>{for(const L of J)B.delete(L);K.resolve()})}get test(){const J=this;return{changedObjectIds:Array.from(this._attributeChangedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return J._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(B){J._maximumNumberOfEditOVerrides=
B}}}};b.__decorate([w.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);b.__decorate([w.property({constructOnly:!0})],a.I3SOverrides.prototype,"layer",void 0);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"_interactiveEditingSessions",void 0);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,"sortedGeometryChangedObjectIds",null);b.__decorate([w.property({readOnly:!0})],a.I3SOverrides.prototype,
"geometryOverrides",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_clientGeometryCache",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_associatedLayer",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);b.__decorate([w.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_attributeChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,
"_geometryChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"hasGeometryChanges",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_pendingFetchAbortController",void 0);b.__decorate([w.property()],a.I3SOverrides.prototype,"_definitionExpression",null);b.__decorate([w.property()],a.I3SOverrides.prototype,"updating",null);b.__decorate([w.property()],a.I3SOverrides.prototype,
"isEmpty",null);a.I3SOverrides=b.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);class I{constructor(J,B){this.objectId=J;this._remove=B;this._updates=new Map;this._isActive=!0}getAttribute(J){return this._updates.get(J)}setAttribute(J,B){this.isActive&&this._updates.set(J,B)}remove(){this.isActive&&(this._isActive=!1,this._remove())}get isActive(){return this._isActive}}var H;(function(J){J[J.Mode=0]="Mode";J[J.SpatialReference=1]="SpatialReference"})(H||={});Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/meshFeatureSet":function(){define("exports ../../Graphic ../../core/Logger ../../core/MapUtils ../../geometry/Extent ../../geometry/Mesh ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/MeshTransform ../../geometry/support/meshUtils/External ../../layers/support/infoFor3D ./FeatureSet".split(" "),function(a,b,n,h,k,m,g,e,d,c,l,f){function r(v){return({attributes:y})=>{if(!y)return{};if(!v)return y;for(const D in y)v.has(D)||
delete y[D];return y}}function x(v,y,D,G,A){var C=A.get(v.attributes[y]);if(null==C)return q().error("mesh-feature-set:asset-not-found","Service returned a feature which was not found in the asset map",v),null;if(!v.geometry)return q().error("mesh-feature-set:no-geometry","Service returned a feature without geometry",v),null;y=w(v,D,G);A=k.fromJSON(v.geometry);A.spatialReference=D;v=p(v.attributes,G);D=D.isGeographic?"local":"georeferenced";a:{C=Array.from(C.files.values());G=[];for(E of C){if(E.status!==
u.COMPLETED){var E=null;break a}C=[];for(const I of E.parts){if(!I){E=null;break a}C.push(new c.ServiceAssetPart(I.url,I.hash))}G.push(new c.ServiceAsset(E.name,E.mimeType,C))}E=G}return E?m.createWithExternalSource(y,E,{extent:A,transform:v,vertexSpace:D}):m.createIncomplete(y,{extent:A,transform:v,vertexSpace:D})}function w({attributes:v},y,{transformFieldRoles:D}){return new g({x:v[D.originX],y:v[D.originY],z:v[D.originZ],spatialReference:y})}function p(v,{transformFieldRoles:y}){return new d({translation:[v[y.translationX],
-v[y.translationZ],v[y.translationY]],rotationAxis:[v[y.rotationX],-v[y.rotationZ],v[y.rotationY]],rotationAngle:v[y.rotationDeg],scale:[v[y.scaleX],v[y.scaleZ],v[y.scaleY]]})}function t(v,y){const D=new Map;for(const A of y){var G=A.parentGlobalId;if(null==G)continue;const C=A.assetName,E=A.assetType;y=A.assetHash;const I=A.assetURL,H=A.conversionStatus,J=A.seqNo,B=l.getFormatIdMimeType(E,v.supportedFormats);B?(G=h.getOrCreateMapValue(D,G,()=>({files:new Map})),h.getOrCreateMapValue(G.files,C,()=>
{a:switch(H){case "COMPLETED":case "SUBMITTED":var z=u.COMPLETED;break a;case "INPROGRESS":z=u.PENDING;break a;default:z=u.FAILED}return{name:C,type:E,mimeType:B,status:z,parts:[]}}).parts[J]={hash:y,url:I}):q().error("mesh-feature-set:unknown-format",`Service returned an asset of type ${E}, but it does not list it as a supported type`)}return D}const q=()=>n.getLogger("esri.rest.support.meshFeatureSet");var u;(function(v){v[v.FAILED=0]="FAILED";v[v.PENDING=1]="PENDING";v[v.COMPLETED=2]="COMPLETED"})(u||=
{});a.assetMapFromAssetMapsJSON=t;a.extractMesh=x;a.meshFeatureSetFromJSON=function(v,y,D){var G=D.features;D.features=[];delete D.geometryType;const A=f.fromJSON(D);A.geometryType="mesh";if(!D.assetMaps)return A;const C=t(y,D.assetMaps),E=v.sourceSpatialReference??e.WGS84;D=D.globalIdFieldName;({outFields:v}=v);v=null!=v&&0<v.length?r(v.includes("*")?null:new Set(v)):()=>({});for(const I of G)G=x(I,D,E,y,C),null!=G&&A.features.push(new b({geometry:G,attributes:v(I)}));return A};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../core/ByteSizeUnit","../../../../core/Error","../../../../core/promiseUtils"],function(a,b,n,h){function k(e){return new Promise((d,c)=>{e.oncomplete=()=>d();e.onerror=()=>c(e.error);e.onabort=()=>c(e.error)})}function m(e){return new Promise((d,c)=>{"done"===e.readyState?null!=e.error?c(e.error):d(e.result):(e.onsuccess=()=>d(e.result),e.onerror=()=>c(e.error))})}class g{constructor(e,
d,c=14){this._version=c;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=b.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=e;this._storeName=d}init(){return Promise.resolve().then(()=>{const e=indexedDB.open(this._dbName,this._version);e.onupgradeneeded=d=>{var c=e.result;const l=e.transaction,f=c.objectStoreNames.contains(this._storeName)?l.objectStore(this._storeName):c.createObjectStore(this._storeName);
c=c.objectStoreNames.contains("last_access")?l.objectStore("last_access"):c.createObjectStore("last_access");c.indexNames.contains("date")||c.createIndex("date","date",{unique:!1});c.indexNames.contains("byteSize")||c.createIndex("byteSize","byteSize",{unique:!1});d.oldVersion<this._version&&(f.clear(),c.clear())};return m(e)}).then(e=>{this._destroyed?e.close():this._db=e})}destroy(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0}get initialized(){return null!=this._db}getHitRate(){return this._hit/
(this._hit+this._miss)}put(e,d){return null==this._db?Promise.reject(new n("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>this._put(e,d)).catch(c=>{if(c&&"QuotaExceededError"===c.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(l=>this._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(l*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>
this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(e,d));throw c;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(c=>this._removeLeastRecentlyAccessed(c-this.maxByteSize)))})}get(e,d){const c=this._db;if(null==c)return Promise.resolve(void 0);let l=null;return Promise.resolve().then(()=>{const f=c.transaction(this._storeName,"readonly");l=h.onAbort(d,()=>
{f.abort()});const r=f.objectStore(this._storeName).get(e);return m(r)}).then(f=>{null==f?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:f.byteSize},e));null!=l&&l.remove();return f}).catch(()=>{++this._miss;h.throwIfAborted(d);null!=l&&l.remove()})}remove(e){const d=this._db;return null==d?Promise.resolve():Promise.resolve().then(async()=>{const c=d.transaction([this._storeName,"last_access"],"readwrite");
var l=c.objectStore(this._storeName),f=c.objectStore("last_access");l=l.delete(e);f=f.delete(e);await Promise.all([m(l),m(f),k(c)])})}_put(e,d){var c=this._db;if(null==c)return Promise.resolve();c=c.transaction([this._storeName,"last_access"],"readwrite");var l=c.objectStore(this._storeName);const f=c.objectStore("last_access");l=l.put(d,e);e=f.put({date:Date.now(),byteSize:d.byteSize},e);return Promise.all([m(l),m(e),k(c)])}_removeLeastRecentlyAccessed(e){if(0>=e||!this._db)return Promise.resolve();
const d=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=d.objectStore(this._storeName),l=d.objectStore("last_access");let f=0;const r=l.index("date").openCursor(null,"next");r.onsuccess=()=>{const x=r.result;null!=x&&(null!=x.value.byteSize&&(f+=x.value.byteSize),c.delete(x.primaryKey),l.delete(x.primaryKey),f<e&&x.continue())};return k(d)}_getCacheSize(){var e=this._db;if(null==e)return Promise.resolve(0);e=e.transaction("last_access");let d=0;const c=e.objectStore("last_access").index("byteSize").openKeyCursor();
c.onsuccess=()=>{const l=c.result;if(l){var f=l.key;null!=f&&(d+=f);l.continue()}};return k(e).then(()=>d)}}a.IDBCache=g;a.whenRequest=m;a.whenTransaction=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports"],function(a){const b=new WeakMap;class n{constructor(h,k){this._hit=this._miss=0;this.initialized=!0;switch(k){case "layer":this._data=new Map;break;case "view":(k=b.get(h))?this._data=k:(this._data=k=new Map,b.set(h,
k))}}init(){return Promise.resolve()}async get(h,k){if(this._data.has(h))return this._hit++,this._data.get(h)??void 0;this._miss++}destroy(){}put(h,k){this._data.set(h,k);return Promise.resolve()}remove(h){this._data.delete(h);return Promise.resolve()}getHitRate(){return this._hit/(this._hit+this._miss)}}a.IDBMockCache=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LayerElevationProvider":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/gl-matrix-2/math/mat4 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../support/ElevationRange ../../support/ElevationUpdateEvent ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v){a.LayerElevationProvider=class extends h.EventedMixin(n){constructor(E){super(E);this._tmpEvent=new q.ElevationUpdateEvent;this._renderCoordsHelper=E.view.renderCoordsHelper;this._renderSR=this._renderCoordsHelper.spatialReference;this._layerElevationSource=E.layerElevationSource}initialize(){this._intersector=u.newIntersector(this.view.state.viewingMode);this._intersector.options.store=v.StoreResults.MIN;this._tmpEvent.context=this.intersectionHandler.isGround?
"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(E,I,H,J){const B=this._renderCoordsHelper;E=f.set(G,E,I,H);if(!B.toRenderCoords(E,J,E))return k.getLogger(this).error("could not project point to compute elevation"),null;const {layerElevationSource:z,_intersector:K,intersectionHandler:L}=this;J=z.fullExtent;I=null!=J&&Number.isFinite(J.xmin)&&Number.isFinite(J.xmax)&&Number.isFinite(J.ymin)&&Number.isFinite(J.ymax)&&Number.isFinite(J.zmin)&&
Number.isFinite(J.zmax)?new t.ElevationRange(J.zmin,J.zmax):z.elevationRange;if(null==I)return null;H=z.elevationOffset;J=I.elevationRangeMin+H;I=B.setAltitude(A,I.elevationRangeMax+H,E);J=B.setAltitude(C,J,E);K.reset(I,J,null);L.intersect(K,null,I,J,null,!0);return K.results.min.getIntersectionPoint(E)?B.getAltitude(E):null}getSphereElevationBounds(E,I){x.projectBoundingSphere(E,I,D,this._renderSR);return this._layerElevationSource.getElevationRange(D)}getRootElevationBounds(){const E=this.layerElevationSource.fullExtent;
return E?.hasZ?new t.ElevationRange(E.zmin,E.zmax):null}objectsChanged(E){this.spatialReference&&(this._computeLayerExtent(E,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(E){this.spatialReference&&(this._computeObjectExtent(E,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(E,I){w.empty(I);this._expandExtent(E,I)}_computeLayerExtent(E,
I){w.empty(I);for(const H of E)this._expandExtent(H,I)}_expandExtent(E,I){const H=this.spatialReference;if(null!=H&&null!=E){c.fromQuat(y,E.quaternion);y[12]=E.center[0];y[13]=E.center[1];y[14]=E.center[2];E=E.halfSize;for(let J=0;8>J;++J)G[0]=J&1?E[0]:-E[0],G[1]=J&2?E[1]:-E[1],G[2]=J&4?E[2]:-E[2],f.transformMat4(G,G,y),this._renderCoordsHelper.fromRenderCoords(G,G,H),w.expand(I,G,I)}}};b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"layerElevationSource",void 0);
b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"intersectionHandler",void 0);b.__decorate([m.property({constructOnly:!0})],a.LayerElevationProvider.prototype,"view",void 0);b.__decorate([m.property()],a.LayerElevationProvider.prototype,"spatialReference",null);a.LayerElevationProvider=b.__decorate([d.subclass("esri.views.3d.layers.i3s.LayerElevationProvider")],a.LayerElevationProvider);const y=l.create(),D=p.fromValues(0,0,0,0),G=r.create(),A=r.create(),C=r.create();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/makeScheduleFunction":function(){define(["exports"],function(a){a.makeScheduleFunction=function(b){return n=>{if(b.immediate)return b.immediate.schedule(n);console.error("No immediate scheduler");throw Error("No immediate scheduler");}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/featureEditing":function(){define(["exports","../../../../core/asyncUtils","../../../../core/lang",
"../../../../layers/support/featureQueryAll"],function(a,b,n,h){function k(r,x,w,p,t=null,q=!0){const u=[];r={gidToFeatureInfo:new Map,oidToFeatureInfo:new Map,featuresResolved:null==w,fieldsIndex:r.fieldsIndex,objectIdField:r.objectIdField,globalIdField:r.globalIdField,featureOrIdentifierList:w};for(const G of x)if(null==G.error){x=G.objectId??-1;w=G.globalId;if(-1===x||q){var v=x;var y=w,D=r;const {gidToFeatureInfo:A,oidToFeatureInfo:C,fieldsIndex:E,objectIdField:I,globalIdField:H,featureOrIdentifierList:J}=
D;if(!D.featuresResolved&&null!=J){for(const B of J){const z={feature:null,oid:-1,gid:null};if("attributes"in B){z.feature=B;const K=B.attributes;if(null!=K)for(const L in K){if(-1!==z.oid&&null!=z.gid)break;const F=E.normalizeFieldName(L);F===I&&(z.oid=K[L]??-1);F===H&&(z.gid=K[L])}}else z.oid=B.objectId??-1,z.gid=B.globalId;null!=z.gid&&A.set(z.gid,z);-1!==z.oid&&C.set(z.oid,z)}D.featuresResolved=!0}v=(-1!==v?C.get(v):null)??(null!=y?A.get(y):null)}else v=null;v=v??{feature:null,oid:x,gid:w};x=
{oid:-1===x?v.oid:x,gid:w??v.gid,feature:v.feature,result:G};u.push(x);-1===x.oid&&null!=x.gid&&null!=t&&(x.oid=t.get(x.gid)??-1);-1===x.oid&&null!=x.gid&&(w=p.get(x.gid),null==w&&(w=[],p.set(x.gid,w)),w.push(x))}return u}async function m(r,x){r=r.i3sOverrides.layer.associatedLayer;if(null!=r?.globalIdField){var w=r.createQuery(),{objectIdField:p,globalIdField:t}=r;w.where=Array.from(x.keys()).map(q=>`${t}='${q}'`).join(" OR ");w.returnGeometry=!1;w.outFields=[p,t];w.cacheHint=!1;r=await b.resultOrAbort(h.queryAllJSON(r,
w));if(r.ok){r=r.value.features;for(const q of r)if(w=q.attributes[t],r=q.attributes[p],null!=w&&null!=r&&-1!==r&&(w=x.get(w),null!=w))for(const u of w)u.oid=r}}}function g(r,x){const w=new Map;x=x.adds;if(!x||0===x.length||null==r.globalIdField)return w;for(const p of x)r=p.oid,x=p.feature,"mesh"===x?.geometry?.type&&w.set(r,x);return w}function e(r,x){const w=x.updates;if(!w||0===w.length)return new f;const p=new f;x=new Map;for(let t=0;t<r.attributeStorageInfo.length;t++)x.set(r.attributeStorageInfo[t].name,
t);r.forEachNode((t,q)=>{for(const G of w){if(null==G.feature)continue;const A=G.feature,C=G.oid,E=q.indexOf(C);for(const I in A.attributes){var u=r.fieldsIndex.normalizeFieldName(I);var v=p;var y=t.index,D=v.get(y);D?v=D:(D=new l,v.set(y,D),v=D);(y=null!=u&&v.get(u))?u=y:(y=[],v.set(u,y),u=y);u.push({featureIndex:E,featureId:C,value:A.attributes[I]})}}});return p}const d={setAttribute(){},rollback(){},commit(){}};var c;(function(r){r[r.EDITING=0]="EDITING";r[r.ROLLED_BACK=1]="ROLLED_BACK";r[r.COMMITTED=
2]="COMMITTED"})(c||={});const l=Map,f=Map;a.createInteractiveEditSession=function(r,x){const w=x.attributes[r.objectIdField];if(null==w)return d;var p=r.sessions.get(w);if(p)return p;const t=n.clone(x.attributes),q=new Set,u=r.i3sOverrides.createInteractiveEditSession(w),v=new Map;let y=c.EDITING;p={setAttribute(D,G){if(y===c.EDITING){var A=r.fieldsIndex.get(D);if(A){var C=r.attributeStorageInfo.findIndex(H=>H.name===A.name);if(!(0>C)){if(!(D in t))throw Error(`Attribute "${D}" is not an attribute of the edited feature.`);
u.setAttribute(C,G);var E=r.attributeStorageInfo[C],I=!1;q.add(D);r.forEachNode((H,J)=>{var B=v.get(H);null==B?(J=J.indexOf(w),v.set(H,J)):J=B;if(-1!==J&&(B=r.getAttributeData(H.index))){const z=B[E.name];z&&(z[J]=G,r.setAttributeData(H.index,B,x),I=!0)}});I&&r.clearMemCache()}}}},rollback(){if(y===c.EDITING){for(const D of q)this.setAttribute(D,t[D]);u.remove();y=c.ROLLED_BACK;r.sessions.delete(w)}},commit(){y===c.EDITING&&(u.remove(),y=c.COMMITTED,r.sessions.delete(w))}};r.sessions.set(w,p);return p};
a.normalizeEditResultsEvent=async function(r,x){const w=new Map,p=k(r,x.addedFeatures,x.edits?.addFeatures,w),t=k(r,x.updatedFeatures,x.edits?.updateFeatures,w);x=k(r,x.deletedFeatures,x.edits?.deleteFeatures,w,x.globalIdToObjectId,!1);0<w.size&&await m(r,w);return{adds:p.filter(q=>-1!==q.oid),updates:t.filter(q=>-1!==q.oid),deletes:x.filter(q=>-1!==q.oid)}};a.processAttributeEdits=function(r,x){var w=e(r,x);x=g(r,x);if(0!==w.size||0!==x.size){var p=new Map;for(var t=0;t<r.attributeStorageInfo.length;t++)p.set(r.attributeStorageInfo[t].name,
t);var q=!1;w.forEach((G,A)=>{const C=r.getAttributeData(A);let E=!1;G.forEach((I,H)=>{const J=null!=C?C[H]:null;H=p.get(H);for(const {featureIndex:B,value:z,featureId:K}of I)J&&(J[B]=z,q=E=!0),r.i3sOverrides.updateAttributeValue(K,H,z)});E&&r.setAttributeData(A,C,null)});q&&r.clearMemCache();var {fieldsIndex:u,i3sOverrides:v,objectIdField:y,globalIdField:D}=r;w=v.layer.associatedLayer?.infoFor3D;w=new Set(w?[...Object.values(w.assetMapFieldRoles),...Object.values(w.transformFieldRoles)]:[]);for(const [G,
A]of x){v.featureAdded(G);({attributes:x}=A);for(const C in x)C!==y&&C!==D&&w.has(C)||(t=u.normalizeFieldName(C),t=null!=t?p.get(t):null,null!=t&&v.updateAttributeValue(G,t,x[C]))}}};a.processGeometryEdits=function(r,x){const w=new Map;var p=x.adds,t=x.updates;x=x.deletes;if(0<p.length)for(var q of p){p=q.oid;const u=q.feature;"mesh"===u?.geometry?.type&&w.set(p,u.geometry)}if(0<t.length)for(const u of t)t=u.oid,q=u.feature,"mesh"===q?.geometry?.type&&w.set(t,q.geometry);if(0<x.length)for(const u of x)w.set(u.oid,
null);for(const [u,v]of w)r.i3sOverrides.updateGeometry(u,v)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec32 ../../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../../core/sql/WhereClause ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/projection/projectVectorToVector ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/DoubleArray ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z){function K(W,ca,X){if(null==ca)return null;if("disjoint"===X&&"polygon"===ca.type){X=ca.rings.length;const ba=ca.spatialReference,ia=Array(X);for(let aa=0;aa<X;++aa){const ea=G.fromValues(Infinity,Infinity,-Infinity,-Infinity);G.expandWithNestedArray(ea,ca.rings[aa]);ia[aa]={type:"polygon",rings:[ca.rings[aa]],spatialReference:ba,cache:{},aabr:ea}}ia.sort((aa,ea)=>aa.aabr[0]-ea.aabr[0]);const fa=new Set,da=new m.PositionHint;
for(ca=0;ca<ia.length;++ca){const aa=ia[ca],ea=aa.aabr[0];fa.forEach(ha=>{ea>=ha.aabr[2]?fa.delete(ha):aa.aabr[1]>ha.aabr[3]||aa.aabr[3]<ha.aabr[1]||!W.intersects(aa,ha)||(aa.rings=aa.rings.concat(ha.rings),G.expand(aa.aabr,ha.aabr,aa.aabr),aa.cache={},fa.delete(ha),ha=m.indexOf(ia,ha,ia.length,da),ia.splice(ha,1))});fa.add(aa)}for(const aa of ia)aa.aabr=void 0;return ia}return[ca]}function L(W,ca,X,ba,ia){if(ca[3]>=.5*(ca[2]+q.getReferenceEllipsoid(ba).radius))return!0;const fa=S(W,ca,ba);return X.every(da=>
N(W,da,fa,ia)!==Q.DISCARD)}function F(W,ca,X,ba,ia,fa,da,aa){const ea=da[0].spatialReference||ia.spatialReference;if(v.projectBoundingSphere(X.node.serviceMbsInIndexSR,fa,V,ea)){fa=S(W,V,ea);var ha=M(aa,ia,ea,ba,X.objectHandle);for(const Y of da){if(0===ca.length)break;switch(N(W,Y,fa,aa)){case Q.DISCARD:ca.length=0;return;case Q.KEEP:continue}B.filterInPlace(ca,X.featureIds,Z=>O(W,Y,Z,ha))}}else g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}
function M(W,ca,X,ba,ia){ca=ca.renderSpatialReference;const fa=new Map,da={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:X};da.rings[0][3]=da.rings[0][0];let aa,ea;switch(W){case "intersects":aa=(ha,Y,Z)=>ha.intersects(Y,Z)?Q.KEEP:Q.TEST;ea=P;break;case "contains":aa=(ha,Y,Z)=>ha.contains(Y,Z)?Q.TEST:Q.DISCARD;ea=P;break;default:aa=(ha,Y,Z)=>ha.disjoint(Y,Z)?Q.TEST:Q.DISCARD,ea=R}return{collection:ba,object:ia,type:W,maskSR:X,renderSR:ca,aabbCache:fa,triangle:da,positions:{indices:null,
data:null,stride:0,startIndex:0,endIndex:0},triangleTest:aa,geometryTest:ea}}function S(W,ca,X){const ba={type:"point",x:ca[0],y:ca[1],hasZ:!1,hasM:!1,spatialReference:X};X=!E.isWGS84(X)&&!E.isWebMercator(X);ca=Number.isNaN(ca[3])?0:e.clamp(ca[3],0,2*C.earth.radius);W=X?W.buffer(ba,ca,1):W.geodesicBuffer(ba,ca,1);W.type="polygon";return W}function N(W,ca,X,ba){switch(ba){case "intersects":case "contains":return P(W,ca,X);case "disjoint":return R(W,ca,X)}}function P(W,ca,X){return W.intersects(ca,
X)?W.contains(ca,X)?Q.KEEP:Q.TEST:Q.DISCARD}function R(W,ca,X){return W.intersects(ca,X)?W.contains(ca,X)?Q.DISCARD:Q.TEST:Q.KEEP}function O(W,ca,X,ba){const {collection:ia,object:fa,renderSR:da,maskSR:aa,geometryTest:ea,aabbCache:ha}=ba;var Y=ha.get(X);if(!Y){Y=ia.getObjectTransform(fa);ia.getComponentAabb(fa,X,U);var Z=[p.fromValues(U[0],U[1],0),p.fromValues(U[0],U[4],0),p.fromValues(U[3],U[4],0),p.fromValues(U[3],U[1],0)];for(var ja=0;4>ja;++ja)w.transformMat3(Z[ja],Z[ja],Y.rotationScale),w.add(Z[ja],
Z[ja],Y.position),y.projectVectorToVector(Z[ja],da,Z[ja],aa);Y={type:"polygon",rings:[Z],spatialReference:aa,cache:{}};Y.rings[0][4]=Y.rings[0][0];ha.set(X,Y)}switch(ea(W,ca,Y)){case Q.DISCARD:return!1;case Q.KEEP:return!0}const {triangle:oa,triangleTest:qa,positions:ta}=ba;Y=oa.rings[0][0];Z=oa.rings[0][1];ja=oa.rings[0][2];const va=ia.getObjectTransform(fa);ia.getComponentPositions(fa,X,ta);const {indices:Ca,data:ma,stride:wa,startIndex:Ba,endIndex:pa}=ta;for(X=Ba;X<pa;X+=3){const Aa=wa*Ca[X],ra=
wa*Ca[X+1],ua=wa*Ca[X+2];w.set(Y,ma[Aa],ma[Aa+1],ma[Aa+2]);w.set(Z,ma[ra],ma[ra+1],ma[ra+2]);w.set(ja,ma[ua],ma[ua+1],ma[ua+2]);w.transformMat3(Y,Y,va.rotationScale);w.transformMat3(Z,Z,va.rotationScale);w.transformMat3(ja,ja,va.rotationScale);w.add(Y,Y,va.position);w.add(Z,Z,va.position);w.add(ja,ja,va.position);y.projectVectorToVector(Y,da,Y,aa);y.projectVectorToVector(Z,da,Z,aa);y.projectVectorToVector(ja,da,ja,aa);switch(qa(W,ca,oa)){case Q.DISCARD:return!1;case Q.KEEP:return!0}}switch(ba.type){case "intersects":return!1;
default:return!0}}b.I3SMeshViewFilter=class extends k{constructor(W){super(W);this._projectionEngineLoaded=!1}initialize(){c.whenOnce(()=>this.viewFilter?.geometry||null!=this.layerFilter).then(()=>this.loadAsyncModule((new Promise((W,ca)=>a(["../../../../geometry/geometryEngine"],W,ca))).then(W=>{this.destroyed||(this._geometryEngine=W)})))}get sortedObjectIds(){if(null==this.viewFilter?.objectIds)return null;const W=A.doubleArrayFrom(this.viewFilter.objectIds);W.sort();return W}get parsedWhereClause(){const W=
this.viewFilter?.where;if(null==W||!W)return null;try{return t.WhereClause.create(W,this.layerFieldsIndex)}catch(ca){g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Failed to parse filter where clause: ${ca}`)}return null}addFilters(W,ca,X,ba){const ia=this.sortedObjectIds;null!=ia&&W.push(ea=>B.objectIdFilter(ia,!0,ea));this.addSqlFilter(W,this.parsedWhereClause);this.addTimeFilter(W,this.viewFilter?.timeExtent);const fa=d.unwrapUpdating(this._layerMaskGeometries),da=this._geometryEngine;
if(null!=fa&&null!=this.layerFilter&&null!=da){const ea=this.layerFilter.spatialRelationship;W.push((ha,Y)=>F(da,ha,Y,ba,ca,X,fa,ea))}const aa=d.unwrapUpdating(this._viewMaskGeometries);if(null!=aa&&null!=this.viewFilter&&null!=da){const ea=this.viewFilter.spatialRelationship;W.push((ha,Y)=>F(da,ha,Y,ba,ca,X,aa,ea))}}isMBSGeometryVisible(W,ca,X){var ba=d.unwrapUpdating(this._layerMaskGeometries);const ia=this._geometryEngine;if(null!=ba&&null!=this.layerFilter&&null!=ia){var fa=this.layerFilter.spatialRelationship;
ca=ba[0].spatialReference||ca;return v.projectBoundingSphere(W,X,V,ca)?L(ia,V,ba,ca,fa):(g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}ba=d.unwrapUpdating(this._viewMaskGeometries);return null!=ba&&null!=this.viewFilter&&null!=ia?(fa=this.viewFilter.spatialRelationship,ca=ba[0].spatialReference||ca,v.projectBoundingSphere(W,X,V,ca)?L(ia,V,ba,ca,fa):(g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),
!0)):!0}get parsedGeometry(){const W=d.unwrapUpdating(this._viewMaskGeometries),ca=d.unwrapUpdating(this._layerMaskGeometries);return null==W||null==ca?W||ca:ca.concat(W)}get _layerMaskGeometries(){const W=this.layerFilter;return null==W?null:null==this._geometryEngine?d.updating:"disjoint"===W.spatialRelationship?W.geometries.map(ca=>({type:"polygon",rings:ca.rings,spatialReference:ca.spatialReference,cache:{}})):[W.geometries.reduce((ca,X)=>{ca.rings=[...ca.rings,...X.rings];return ca},{type:"polygon",
rings:[],spatialReference:W.geometries[0].spatialReference,cache:{}})]}get _viewMaskGeometries(){if(null==this.viewFilter)return null;var {geometry:W}=this.viewFilter;if(null==W)return null;if(null==this.viewFilter||null==this._geometryEngine)return d.updating;const {distance:ca,units:X}=this.viewFilter,ba=this.viewFilter.spatialRelationship;W="mesh"===W.type?W.extent:W;if(null==ca||0===ca)return K(this._geometryEngine,W,ba);const ia=X||l.getUnitString(W.spatialReference);if(W.spatialReference.isWGS84)return W=
this._geometryEngine.geodesicBuffer(W,ca,ia),K(this._geometryEngine,W,ba);var fa=H.project(W,z.WGS84);if(null!=fa)return W=H.project(this._geometryEngine.geodesicBuffer(fa,ca,ia),W.spatialReference),K(this._geometryEngine,W,ba);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(u.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;fa=null;try{fa=u.project(W,z.WGS84)}catch(da){}if(fa)try{fa=u.project(this._geometryEngine.geodesicBuffer(fa,ca,ia),W.spatialReference)}catch(da){fa=
null}fa||g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${W.spatialReference.wkid}) to WGS84.`);return K(this._geometryEngine,fa,ba)}get updating(){return d.isUpdating(this._layerMaskGeometries)||d.isUpdating(this._viewMaskGeometries)}static checkSupport(W){if(null==W)return!1;W=W.spatialRelationship;return null!=W&&T.includes(W)?!0:(g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter").warn(`Filters with spatialRelationship other than ${T.join(", ")} are not supported for mesh scene layers`),
!1)}};n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);n.__decorate([f.property({type:J})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"addTimeFilter",void 0);
n.__decorate([f.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",null);n.__decorate([f.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);n.__decorate([f.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);n.__decorate([f.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);n.__decorate([f.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);n.__decorate([f.property()],
b.I3SMeshViewFilter.prototype,"updating",null);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);n.__decorate([f.property()],b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=n.__decorate([x.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const T=["contains","intersects","disjoint"];var Q;(function(W){W[W.KEEP=0]="KEEP";W[W.DISCARD=1]="DISCARD";W[W.TEST=2]="TEST"})(Q||={});const V=I.fromValues(0,0,0,0),
U=D.create();Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(b){return"updating"===b};a.unwrapUpdating=function(b){return"updating"===b?null:b};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../layers/support/FieldsIndex ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p){const t=r.QueryEngine;a.I3SQueryEngine=class extends n{get spatialReference(){return this.layerView.view.spatialReference}get layer(){return this.layerView.i3slayer}get defaultQueryJSON(){return(new p({outSpatialReference:this.spatialReference})).toJSON()}get _dataQueryEngine(){return this._ensureDataQueryEngine()}constructor(q){super(q)}initialize(){this.addHandles(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))}destroy(){this._dataQueryEngineInstance=
k.destroyMaybe(this._dataQueryEngineInstance);this._set("layerView",null)}async executeQueryForCount(q,u){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(q),u)}async executeQueryForExtent(q,u){const {count:v,extent:y}=await this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(q),u);q=l.fromJSON(y);return{count:v,extent:q}}async executeQueryForIds(q,u){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(q),u)}async executeQuery(q,u){q=this._ensureQueryJSON(q);
if(q.returnGeometry)throw new h("unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(q.returnCentroid)throw new h("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");u=await this._dataQueryEngine.executeQuery(q,u);u=w.fromJSON(u);u.features.forEach(v=>v.geometry=null);return u}_ensureQueryJSON(q){return null==q?this.defaultQueryJSON:q.toJSON()}_ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;
const q=this.layer.objectIdField||f.fallbackObjectIDAttribute,u=this.layer.fieldsIndex?.toJSON()||new x([]),v=this.layerView.view.resourceController.scheduler,y=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new t({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:u,timeInfo:null,spatialReference:y,objectIdField:q,featureStore:this.spatialIndex,scheduler:v,priority:this.priority})}};b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",
void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([m.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"spatialReference",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"layer",null);b.__decorate([m.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([c.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define(["exports","../../../../geometry/support/aaBoundingBox","../../../../layers/graphics/centroid","../../../../layers/graphics/OptimizedGeometry","./I3SUtil"],function(a,b,n,h,k){class m{constructor(e){this._objectIdField=e.objectIdField;this._getFeatureExtent=e.getFeatureExtent}getObjectId(e){return e.id}getAttributes(e){const {meta:d,index:c}=e,l={};
this._objectIdField&&(l[this._objectIdField]=e.id);e=d.attributeInfo?.attributeData;if(null!=e)for(const f of Object.keys(e))l[f]=k.getCachedAttributeValue(e[f],c);return l}getAttribute(e,d){if(d===this._objectIdField)return e.id;const {meta:c,index:l}=e;e=c.attributeInfo?.attributeData;return null!=e?k.getCachedAttributeValue(e[d],l):null}getGeometry(e){if(e.geometry)return e.geometry;const [d,c,l,f,r]=this._getFeatureExtent(e,g);return new h([5],[d,c,l,f,c,l,f,r,l,d,r,l,d,c,l])}getCentroid(e,d){if(e.geometry)return n.getCentroidOptimizedGeometry(new h,
e.geometry,d.hasZ,d.hasM);const [c,l,f,r,x,w]=this._getFeatureExtent(e,g);return new h([0],[(c+r)/2,(l+x)/2,(f+w)/2])}cloneWithGeometry(e,d){const {id:c,index:l,meta:f}=e;return{id:c,index:l,meta:f,geometry:d}}}const g=b.create();a.I3SQueryFeatureAdapter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection/projectBoundingSphere ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../II3SMeshView3D".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x){const w=l.create();a.I3SQueryFeatureStore=class extends n{constructor(u){super(u);this.events=new h}forEach(u){this.forAllFeatures(v=>{u(v);return x.ForAllFeaturesReturnType.CONTINUE})}forEachBounds(u,v){const y=this.getFeatureExtent;for(const D of u)v(y(D,w))}forEachInBounds(u,v){this.forAllFeatures(y=>{const D=this.getFeatureExtent(y,t);f.intersects(u,l.toRect(D,q))&&v(y);return x.ForAllFeaturesReturnType.CONTINUE},y=>{c.projectBoundingSphere(y.node.serviceMbsInIndexSR,
this.sourceSpatialReference,p,this.viewSpatialReference);if(p[0]>=u[0]&&p[2]<=u[2]&&p[1]>=u[1]&&p[3]<=u[3])return x.ForAllFeaturesReturnType.CONTINUE;y=p[0]-Math.max(u[0],Math.min(p[0],u[2]));const D=p[1]-Math.max(u[1],Math.min(p[1],u[3]));return y*y+D*D<=p[3]*p[3]?x.ForAllFeaturesReturnType.CONTINUE:x.ForAllFeaturesReturnType.SKIP})}};b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,
"forAllFeatures",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([k.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const p=r.fromValues(0,0,0,
0),t=l.create(),q=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),function(a,b,n,h,k,m,g,e,d){a.DefinitionExpressionSceneLayerView=
c=>{c=class extends c{constructor(){super(...arguments);this._definitionExpressionErrors=0;this._maxDefinitionExpressionErrors=20;this.logError=l=>{this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&n.getLogger(this).error("Error while evaluating definitionExpression: "+l);this._definitionExpressionErrors++;this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&n.getLogger(this).error("Further errors are ignored")}}get parsedDefinitionExpression(){if(!this.i3slayer?.definitionExpression)return null;
try{const l=e.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!l.isStandardized)return n.getLogger(this).error("definitionExpression is using non standard function"),null;const f=[];d.findFieldsCaseInsensitive(l.fieldNames,this.i3slayer.fields,{missingFields:f});if(0<f.length)return n.getLogger(this).error(`definitionExpression references unknown fields: ${f.join(", ")}`),null;this._definitionExpressionErrors=0;return l}catch(l){return n.getLogger(this).error("Failed to parse definitionExpression: "+
l),null}}get definitionExpressionFields(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}_evaluateClause(l,f){try{return l.testFeature(f)}catch(r){return this.logError(r),!1}}_addDefinitionExpressionToQuery(l){if(!this.parsedDefinitionExpression)return l;const f=this.i3slayer.definitionExpression;l=l.clone();l.where=l.where?`(${f}) AND (${l.where})`:f;return l}};b.__decorate([h.property({readOnly:!0})],c.prototype,"parsedDefinitionExpression",null);b.__decorate([h.property({readOnly:!0})],
c.prototype,"definitionExpressionFields",null);return c=b.__decorate([g.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],c)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:n,
layer:{fieldsIndex:h},requiredFields:k}=this;return n.outFields?b.fixFields(h,[...b.unpackFieldNames(h,n.outFields),...k]):b.fixFields(h,k)}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/AsyncUpdate ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,n,h,k,m,g,e,d,c){async function l(f){const r=new Set;try{return await f(r),Array.from(r).sort()}catch(x){return k.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(x),null}}a.SceneLayerViewRequiredFields=class extends h.AsyncUpdateMixin(n){get layer(){return this.layerView.layer}get requiredFields(){const {layerView:{layer:{fieldsIndex:f},definitionExpressionFields:r},rendererFields:x,labelingFields:w,viewFilterFields:p}=this;return c.fixFields(f,[...(r??[]),
...(x??[]),...(w??[]),...(p??[])])}constructor(f){super(f)}initialize(){this.addHandles([this.autoUpdateAsync("rendererFields",async()=>{const {fieldsIndex:f,renderer:r}=this.layer;return r?l(x=>r.collectRequiredFields(x,f)):null}),this.autoUpdateAsync("labelingFields",async()=>{const {layer:f}=this;return f.labelsVisible?l(r=>c.collectLabelingFields(r,f)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:f,mergedFilter:r}=this.layerView;return l(x=>c.collectFilterFields(x,f,r))})])}};
b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",null);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([m.property()],a.SceneLayerViewRequiredFields.prototype,
"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([d.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/AsyncUpdate":function(){define("exports ../chunks/tslib.es6 ./Accessor ./Logger ./promiseUtils ./reactiveUtils ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass".split(" "),function(a,b,n,h,k,m,g,e){const d=c=>{c=class extends c{constructor(){super(...arguments);
this._numUpdating=0}get updating(){return 0<this._numUpdating}autoUpdateAsync(l,f){const r=k.debounce(async x=>{++this._numUpdating;try{const w=await x;this.destroyed||this._set(l,w)}catch(w){h.getLogger(this).warn(`Async update of "${String(l)}" failed. Async update functions should not throw exceptions.`)}--this._numUpdating});return m.watch(f,r,m.initial)}};b.__decorate([g.property({readOnly:!0})],c.prototype,"updating",null);b.__decorate([g.property()],c.prototype,"_numUpdating",void 0);return c=
b.__decorate([e.subclass("esri.core.AsyncUpdate")],c)};a.AsyncUpdate=class extends d(n){};a.AsyncUpdate=b.__decorate([e.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/TemporalSceneLayerView":function(){define("exports ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/Logger ../../../../core/RandomLCG ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/data/timeSupport ../../../../layers/support/commonProperties ../../../../layers/support/FeatureFilter ../i3s/I3SUtil".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l){class f{constructor(r){this.attributeData=r}getAttribute(r,x){return l.getCachedAttributeValue(this.attributeData[x],r)}getAttributeAsTimestamp(r,x){r=this.getAttribute(r,x);return"string"===typeof r?(new Date(r)).getTime():"number"===typeof r||null==r?r:null}}a.TemporalSceneLayerView=r=>{r=class extends r{constructor(){super(...arguments);this.timeExtent=null}get mergedFilter(){const {filter:x,timeExtent:w}=this;if(null==w)return x;const p=x?.clone()??new c;null!=
w&&(p.timeExtent=p.timeExtent?.intersection(w)??w);return p}getTimeFilterDependencies(){const {timeInfo:x}=this.i3slayer;if(null==x)return[];const {startField:w,endField:p}=x;return[w,p]}addTimeFilter(x,w){if(null!=w){var {timeInfo:p}=this.i3slayer;if(null!=p){var {startField:t,endField:q,useTime:u}=p;if(u&&(null!=t||null!=q)){var v=p.toJSON(),y=w.toJSON();x.push((D,G)=>this._timeFilter(D,G,v,y))}}}}_timeFilter(x,w,p,t){const q=w.attributeInfo?.attributeData;if(null!=q){var {startTimeField:u,endTimeField:v}=
p;null!=u&&null==q[u]||null!=v&&null==q[v]||(p=e.getTimeOperator(p,t,new f(q)),null!=p&&({featureIds:w}=w,l.filterInPlace(x,w,p)))}}};b.__decorate([n.property(d.combinedViewLayerTimeExtentProperty)],r.prototype,"timeExtent",void 0);b.__decorate([n.property()],r.prototype,"mergedFilter",null);return r=b.__decorate([g.subclass("esri.views.3d.layers.support.TemporalSceneLayerView")],r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/tslib.es6 ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r){c=class extends r{constructor(){super(...arguments);this._geometryEngine=this.filter=this.layer=null;this._projectionEngineLoaded=!1;this._abortController=new AbortController}get availableFields(){return[]}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(x){throw Error("Not implemented");}get maximumNumberOfFeaturesExceeded(){return!1}get layerFilter(){return m.unwrapUpdating(this._layerFilter)}get _layerFilter(){const x=this.layer?.filter;if(null==
x||1>x.geometries.length)return null;const w=this._geometryEngine;if(null==w||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return m.updating;const p=x.geometries.at(0).spatialReference,t=x.geometries.toArray().map(y=>{try{y=w.simplify(y)}catch(D){return h.getLogger(this).warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==y)return null;if(y.spatialReference.equals(p))return y;try{return f.project(y,p)}catch(D){return h.getLogger(this).warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(n.isSome).sort((y,D)=>y.extent.xmin-D.extent.xmin),q=new Set,u=[],v=[];for(let y of t){const D=y.extent.xmin;u.length=0;q.forEach(G=>{D>=G.extent.xmax?(v.push(G),q.delete(G)):y.extent.ymin<=G.extent.ymax&&y.extent.ymax>=G.extent.ymin&&w.intersects(y,G)&&u.push(G)});if(0<u.length){u.push(y);try{y=w.union(u)}catch(G){h.getLogger(this).warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}u.pop();u.forEach(G=>q.delete(G))}q.add(y)}q.forEach(y=>v.push(y));
return 0<v.length?{spatialRelationship:x.spatialRelationship,geometries:v}:null}get _filterNeedsProjectionEngine(){const x=this.layer.filter;if(null==x||1>=x.geometries.length)return!1;const w=x.geometries.at(0).spatialReference;return x.geometries.some(({spatialReference:p})=>!p.equals(w)&&!f.canProjectWithoutEngine(p,w))}get layerFilterUpdating(){return m.isUpdating(this._layerFilter)}initialize(){const {signal:x}=this._abortController;e.whenOnce(()=>this.destroyed||!this._geometryEngine&&this.layer?.filter?.geometries?.length,
x).then(async()=>{g.throwIfAbortError(x);this._geometryEngine=await new Promise((w,p)=>a(["../../geometry/geometryEngine"],w,p))}).catch(g.throwIfNotAbortError);this._projectionEngineLoaded=f.isLoaded();e.whenOnce(()=>this.destroyed||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine,x).then(async()=>{g.throwIfAbortError(x);await f.load();this._projectionEngineLoaded=!0}).catch(g.throwIfNotAbortError)}destroy(){this._abortController=k.abortMaybe(this._abortController)}highlight(x){throw Error("Not implemented");
}queryFeatures(x,w){throw Error("Not implemented");}queryObjectIds(x,w){throw Error("Not implemented");}queryFeatureCount(x,w){throw Error("Not implemented");}createQuery(){throw Error("Not implemented");}queryExtent(x,w){throw Error("Not implemented");}};b.__decorate([d.property()],c.prototype,"layer",void 0);b.__decorate([d.property()],c.prototype,"availableFields",null);b.__decorate([d.property()],c.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],c.prototype,
"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property()],c.prototype,"filter",void 0);b.__decorate([d.property({readOnly:!0})],c.prototype,"layerFilter",null);b.__decorate([d.property({readOnly:!0})],c.prototype,"_layerFilter",null);b.__decorate([d.property()],c.prototype,"_geometryEngine",void 0);b.__decorate([d.property()],c.prototype,"_projectionEngineLoaded",void 0);b.__decorate([d.property()],c.prototype,"_filterNeedsProjectionEngine",null);b.__decorate([d.property()],c.prototype,
"layerFilterUpdating",null);return c=b.__decorate([l.subclass("esri.views.layers.SceneLayerView")],c)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/typedArrayUtil ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec32 ../../../core/libs/gl-matrix-2/factories/vec3f64 ../../../geometry/projection/projectBuffer ../../../geometry/projection/projectVectorToVector ../../../geometry/support/contains ../../../geometry/support/DoubleArray ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/dehydratedPoint ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ../../../support/basemapUtils ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/featureEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/LayerViewPerformanceInfo ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ./support/TemporalSceneLayerView ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../layers/support/popupUtils ../../support/Scheduler".split(" "),
function(a,b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba){function ia(Y){return"geometryBuffer"in Y&&null!==Y.geometryBuffer}function fa(Y){const Z=Y.attributeInfo,ja=Y.node.index;if(null!=Z?.loadedAttributes&&null!=Z.attributeData)for(let oa=0;oa<Y.graphics.length;oa++){const qa=Y.graphics[oa];if(qa.nodeIndex===ja){qa.attributes||(qa.attributes={});for(const {name:ta}of Z.loadedAttributes)Z.attributeData[ta]&&(qa.attributes[ta]=F.getCachedAttributeValue(Z.attributeData[ta],
oa))}}}c=S.defineFieldProperties();class da{constructor(Y,Z,ja,oa){this.graphics=Y;this.featureIds=Z;this.attributeInfo=ja;this.node=oa}}H=class extends O.TemporalSceneLayerView(M.DefinitionExpressionSceneLayerView(P.PopupSceneLayerView(H.LayerView3D(ca)))){constructor(){super(...arguments);this.type="scene-layer-graphics-3d";this._memCache=this._queryEngine=null;this._interactiveEditingSessions=new Map;this._pendingEditsQueue=Promise.resolve();this.loadedGraphics=new K.I3SGraphicsMap((Y,Z,ja)=>{{const oa=
Z.attributeInfo;if(null==oa?.loadedAttributes||null==oa.attributeData)Y=!1;else{Z=!1;for(const {name:qa}of oa.loadedAttributes)if(oa.attributeData[qa]){const ta=F.getCachedAttributeValue(oa.attributeData[qa],ja);ta!==Y.attributes[qa]&&(Y.attributes[qa]=ta,Z=!0)}Y=Z}}return Y},Y=>this.processor.graphicsCore.recreateGraphics(Y));this.holeFilling="always";this.progressiveLoadFactor=1;this.supportsHeightUnitConversion=!0;this._coordinatesOutsideExtentErrors=0;this._maxCoordinatesOutsideExtentErrors=20}tryRecycleWith(Y,
Z){return Y.url===this.layer.url&&this._i3sOverrides.isEmpty?Y.load(Z).then(()=>{F.checkRecyclable(this.layer,Y,this._i3sOverrides);this.layer=Y;this._i3sOverrides.destroy();this._i3sOverrides=new L.I3SOverrides({view:this.view,layer:Y,memoryController:this.view.resourceController?.memoryController});m.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null}initialize(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new L.I3SOverrides({view:this.view,
layer:this.layer,memoryController:this.view.resourceController?.memoryController});F.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new R.SceneLayerViewRequiredFields({layerView:this});this._updatingHandles.add(()=>this.layer.rangeInfos,Y=>this._rangeInfosChanged(Y),g.initial);this._updatingHandles.add(()=>this.layer.renderer,(Y,Z)=>this._rendererChange(Y,Z));this._updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],
()=>this._filterChange());this.addHandles(g.watch(()=>T.debugFlags.I3S_TREE_SHOW_TILES,Y=>{if(Y&&!this._treeDebugger){const Z=this._controller.crsIndex;(new Promise((ja,oa)=>a(["./support/I3STreeDebugger"],ja,oa))).then(({I3STreeDebugger:ja})=>{!this._treeDebugger&&T.debugFlags.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ja({lv:this,view:this.view,nodeSR:Z}))})}else Y||!this._treeDebugger||T.debugFlags.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},g.initial));this._set("processor",
new J.Graphics3DFeatureProcessor({owner:this,preferredUpdatePolicy:W.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:Y=>this._updateClippingExtent(Y)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",({extent:Y,spatialReference:Z})=>this._controller.updateElevationChanged(Y,
Z));this.supportsHeightUnitConversion&&(this._verticalScale=q.getGeometryZScaler("point",this.layer.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);this._memCache=this.view.resourceController.memoryController.newCache(`psl-${this.uid}`);this._controller=new G({layerView:this,scaleVisibilityEnabled:!1});F.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new I.I3SPointsWorkerHandle(Y=>this.view.resourceController.immediate.schedule(Y)));
this.addHandles(this.layer.on("apply-edits",Y=>this._updatingHandles.addPromise(Y.result)));this.addHandles(this.layer.on("edits",Y=>{const Z=this._pendingEditsQueue.then(()=>this._handleEdits(Y)).then();this._pendingEditsQueue=Z;this._updatingHandles.addPromise(Z)}));this.when(()=>{this._setupQueryEngine();this._updatingHandles.add(()=>this.maximumNumberOfFeatures,Y=>this._controller.featureTarget=Y,g.initial);this._updatingHandles.add(()=>this.suspended,Y=>{Y&&this._removeAllNodeData()})})}destroy(){this._treeDebugger=
m.destroyMaybe(this._treeDebugger);this._i3sOverrides=m.destroyMaybe(this._i3sOverrides);this._set("processor",m.destroyMaybe(this.processor));this._controller=m.destroyMaybe(this._controller);this._queryEngine=m.destroyMaybe(this._queryEngine);this._worker=m.destroyMaybe(this._worker);this._memCache=m.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)}get i3slayer(){return this.layer}get updatingProgressValue(){return this._controller?.updatingProgress??
1}get requiredFields(){return this._fieldsHelper?.requiredFields??[]}get maximumNumberOfFeatures(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0}set maximumNumberOfFeatures(Y){null!=Y?(this._override("maximumNumberOfFeatures",Y),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}get maximumNumberOfFeaturesExceeded(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&
!this._controller.leavesReached}get _excludeObjectIdsSorted(){const Y=this.layer.excludeObjectIds;return Y.length?Y.toArray().sort((Z,ja)=>Z-ja):null}get lodFactor(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}get hasM(){return!1}get hasZ(){return!0}get contentVisible(){return!this.suspended&&!!this._controller?.rootNodeVisible}get legendEnabled(){return this.contentVisible&&!0===this.i3slayer?.legendEnabled}async whenGraphicAttributes(Y,Z){return F.whenGraphicAttributes(this.layer,
Y,this._getObjectIdField(),Z,()=>[...this.loadedGraphics.nodes()])}getHit(Y){if(!this.loadedGraphics)return null;const Z=D.hydrateGraphic(this.loadedGraphics.find(oa=>oa.uid===Y),this.layer),ja=this._getObjectIdField();if(!Z?.attributes?.[ja])return null;Z.layer=this.layer;Z.sourceLayer=this.layer;return{type:"graphic",graphic:Z,layer:Z.layer}}whenGraphicBounds(Y,Z){return this.processor.whenGraphicBounds(Y,Z)}computeAttachmentOrigin(Y,Z){return this.processor.computeAttachmentOrigin(Y,Z)}isUpdating(){return!!(this._controller?.updating||
this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)}highlight(Y){return this.processor.highlight(Y,this.layer.objectIdField)}get updatePolicy(){return this.processor.graphicsCore.effectiveUpdatePolicy}createInteractiveEditSession(Y){return z.createInteractiveEditSession(this._attributeEditingContext,Y)}async _decompressBinaryPointData(Y,Z){Y={geometryBuffer:Y.geometryBuffer};null==this._worker&&(this._worker=new I.I3SPointsWorkerHandle(ja=>this.view.resourceController.immediate.schedule(ja)));
Z=await this._worker.invoke(Y,Z);if(null==Z)throw Error("Failed to decompress Draco point data");return{positionData:Z.positions,featureIds:Z.featureIds}}async addNode(Y,Z,ja){if(!(ia(Z)||"pointData"in Z))throw Error();if(this.loadedGraphics.hasNode(Y.index))k.getLogger(this).error("I3S node "+Y.id+" already added");else{if(null!=this.layer.fullExtent){var oa=this.layer.fullExtent.clone();oa.xmin-=.5;oa.ymin-=.5;oa.xmax+=.5;oa.ymax+=.5;null!=oa.zmin&&null!=oa.zmax&&(oa.zmin-=.5,oa.zmax+=.5);null!=
oa.mmin&&null!=oa.mmax&&(oa.mmin-=.5,oa.mmax+=.5)}else oa=null;var qa=oa,{featureIds:ta,pointPositions:va}=ia(Z)?await this._extractBinaryPointPositions(Y,Z,ja):this._extractLegacyPointPositions(Z);oa=[];this._validatePositions(Y,ta,va,qa,oa);var Ca=this._controller.crsVertex;x.projectBuffer(va,Ca,0,va,this.view.spatialReference,0,ta.length);qa=ia(Z)?Y.level:0;qa=this._createGraphics(ta,va,Y.index,qa);qa=new da(qa,ta,Z.attributeDataInfo,Y);await this._i3sOverrides.applyAttributeOverrides(qa.featureIds,
Z.attributeDataInfo,ja);Y.numFeatures=qa.graphics.length;this._updateNodeMemory(Y);fa(qa);0<oa.length&&(this._computeObb(Y,oa,Ca),this._controller.updateVisibility(Y.index));if(this._controller.isGeometryVisible(Y)){if(null!=this._verticalScale)for(var ma of qa.graphics)this._verticalScale(ma.geometry);Z=this.view._stage.renderView.objectAndLayerIdRenderHelper;if(null!=Z)for(ja=E.isBasemapLayer(this.view.map,this.layer.uid),ma=0;ma<qa.featureIds.length;ma++)Z.setUidToObjectAndLayerId(qa.featureIds[ma],
qa.graphics[ma].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!ja&&X.hasPopupTemplate(this.layer,this.view.popup?.defaultPopupTemplateEnabled),qa.node.resources.attributes,ma);this.loadedGraphics.addNode(Y.index,qa);this._controller.updateLoadStatus(Y.index,!0);this._filterNode(qa);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(qa)}}_computeObb(Y,Z,ja){const oa=this._controller.crsIndex,qa=oa.isGeographic?this.view.renderSpatialReference:oa;x.projectBuffer(Z,
ja,0,Z,qa,0,Z.length/3);Y.serviceObbInIndexSR=Q.compute(new U.Vertices(Z,3));oa.isGeographic&&(w.projectVectorToVector(Y.serviceObbInIndexSR.center,qa,ea,oa),Y.serviceObbInIndexSR.center=ea)}isNodeLoaded(Y){return this.loadedGraphics.hasNode(Y)}isNodeReloading(){return!1}updateNodeState(){}async _extractBinaryPointPositions(Y,Z,ja){Z=await this._decompressBinaryPointData(Z,ja);ja=Z.positionData;const oa=ja.length/3,qa=t.newDoubleArray(3*oa);Y=null!=Y.serviceObbInIndexSR?Y.serviceObbInIndexSR.center:
r.ZEROS;const ta=Math.abs(Y[2])*2**-20;for(let va=0;va<oa;va++){const Ca=3*va;qa[Ca]=ja[Ca]+Y[0];qa[Ca+1]=ja[Ca+1]+Y[1];qa[Ca+2]=ja[Ca+2]+Y[2];Math.abs(qa[Ca+2])<ta&&(qa[Ca+2]=0)}return{featureIds:Z.featureIds?t.doubleArrayFrom(Z.featureIds):[],pointPositions:qa}}_extractLegacyPointPositions(Y){const Z=Y.pointData.length,ja=t.newDoubleArray(3*Z),oa=[];for(let va=0;va<Z;va++){var qa=Y.pointData[va];const Ca=qa.featureDataPosition,ma=Ca.length;var ta=qa.geometries?.[0]??aa[ma];qa=qa.featureIds[0];if("Embedded"!==
ta.type||"points"!==ta.params.type||2>ma||3<ma)continue;ta=ta.params.vertexAttributes?.position??[0,0,0];const wa=3*oa.length;ja[wa]=Ca[0]+ta[0];ja[wa+1]=Ca[1]+ta[1];ja[wa+2]=3===ma?Ca[2]+ta[2]:NaN;oa.push(qa)}return{featureIds:oa,pointPositions:ja}}_validatePositions(Y,Z,ja,oa,qa){if(null!=oa||!Y.serviceObbInIndexSR){Z=Z.length;for(let va=0;va<Z;va++){var ta=3*va;f.set(ea,ja[ta],ja[ta+1],ja[ta+2]);ta=!Number.isNaN(ja[2]);null==oa||(ta?p.extentContainsCoords3D(oa,ea):p.extentContainsCoords2D(oa,ea))||
(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&k.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);Y.serviceObbInIndexSR||qa.push(ea[0],ea[1],ea[2])}}}_createGraphics(Y,Z,ja,oa){const qa=Y.length,ta=this._getObjectIdField(),va=this.processor.graphicsCore,
Ca=[],ma=this.view.spatialReference;for(let Aa=0;Aa<qa;Aa++){var wa=Y[Aa];const ra={};null!=wa&&(ra[ta]=wa);wa=null==wa?n.generateUID():wa;var Ba=3*Aa,pa=isNaN(Z[Ba+2])?void 0:Z[Ba+2];Ba=y.makeDehydratedPoint(Z[Ba],Z[Ba+1],pa,ma);pa=this.loadedGraphics.get(wa);if(null!=pa){if(null==pa.level||pa.level<oa)ha.property="geometry",ha.graphic=pa,ha.oldValue=pa.geometry,ha.newValue=Ba,pa.geometry=Ba,pa.level=oa,va.graphicUpdateHandler(ha);Ca.push(pa)}else pa=n.generateUID(),Ca.push({objectId:wa,uid:pa,geometry:Ba,
attributes:ra,visible:!0,nodeIndex:ja,level:oa})}return Ca}_updateNodeMemory(Y){Y.memory=4096+(null!=Y.numFeatures?Y.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}_cacheNodeData(Y){const Z=Y.graphics.reduce((ja,oa)=>v.estimateSize(oa)+ja,e.estimateSize(Y.featureIds)+1024);this._memCache.put(this._getMemCacheKey(Y.node),Y,Z)}_getMemCacheKey(Y){return`${Y.index}`}_removeAllNodeData(){this.loadedGraphics.forEachNode((Y,Z)=>{Y&&(this._updateNodeMemory(Y.node),this._cacheNodeData(Y));
this._controller.updateLoadStatus(Z,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()}removeNode(Y){if(Y=this._removeNodeStageData(Y))this._updateNodeMemory(Y.node),this._cacheNodeData(Y)}_removeNodeStageData(Y){const Z=this.loadedGraphics.getNode(Y);if(null==Z)return null;this._controller.updateLoadStatus(Y,!1);this.loadedGraphics.removeNode(Y);this._treeDebugger&&this._treeDebugger.update();return Z}async loadCachedNodeData(Y){return this._memCache?.pop(this._getMemCacheKey(Y))}async addCachedNodeData(Y,
Z,ja,oa){this.loadedGraphics.hasNode(Y.index)?k.getLogger(this).error("I3S node "+Y.id+" already added"):(await this._i3sOverrides.applyAttributeOverrides(Z.featureIds,ja,oa),this.loadedGraphics.addNode(Y.index,Z),this._controller.updateLoadStatus(Y.index,!0),this._updateNodeMemory(Y),Z.attributeInfo=ja,this._attributeValuesChanged(Z),this._filterNode(Z),this._treeDebugger&&this._treeDebugger.update())}getLoadedNodeIds(){const Y=[];this.loadedGraphics.forEachNode(Z=>Y.push(Z.node.id));return Y.sort()}getVisibleNodes(){const Y=
[];this.loadedGraphics.forEachNode(Z=>Y.push(Z.node));return Y}getLoadedNodeIndices(Y){this.loadedGraphics.forEachNode((Z,ja)=>Y.push(ja))}getLoadedAttributes(Y){Y=this.loadedGraphics.getNode(Y);if(null!=Y?.attributeInfo)return Y.attributeInfo.loadedAttributes}getAttributeData(Y){Y=this.loadedGraphics.getNode(Y);if(null!=Y?.attributeInfo)return Y.attributeInfo.attributeData}_setAttributeData(Y,Z){Y=this.loadedGraphics.getNode(Y);null!=Y?.attributeInfo&&(Y.attributeInfo.attributeData=Z,this._attributeValuesChanged(Y))}async updateAttributes(Y,
Z,ja){Y=this.loadedGraphics.getNode(Y);null!=Y&&(await this._i3sOverrides.applyAttributeOverrides(Y.featureIds,Z,ja),Y.attributeInfo=Z,this._attributeValuesChanged(Y))}_attributeValuesChanged(Y){fa(Y);this._filterNode(Y);this.processor.graphicsCore.labelsEnabled&&(Y=Y.graphics.map(Z=>Z.uid),this.processor.graphicsCore.updateLabelingInfo(Y))}_updateClippingExtent(Y){this._controller&&this._controller.updateClippingArea(Y);return!1}_getObjectIdField(){return this.layer.objectIdField||u.fallbackObjectIDAttribute}_getGlobalIdField(){return this.layer.associatedLayer?.globalIdField}async _rendererChange(Y,
Z){const {layer:{fieldsIndex:ja}}=this,oa=new Set;let qa;Y?(await Y.collectRequiredFields(oa,ja),qa=Array.from(oa).sort()):qa=[];oa.clear();let ta;Z?(await Z.collectRequiredFields(oa,ja),ta=Array.from(oa).sort()):ta=[];qa.length===ta.length&&qa.every((va,Ca)=>qa[Ca]===ta[Ca])||this._reloadAllNodes()}_rangeInfosChanged(Y){null!=Y&&0<Y.length&&k.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}_filterChange(){this.loadedGraphics.forEachNode(Y=>
this._filterNode(Y))}_reloadAllNodes(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()}_filterNode(Y){const Z=this.parsedDefinitionExpression,ja=this._excludeObjectIdsSorted,oa=this._getObjectIdField();for(const qa of Y.graphics){Y=qa.visible;const ta=!Z||this._evaluateClause(Z,qa),va=null==ja||0>h.binaryIndexOf(ja,qa.attributes[oa]);qa.visible=ta&&va;Y!==qa.visible&&(ha.graphic=qa,ha.property="visible",ha.oldValue=Y,ha.newValue=qa.visible,this.processor.graphicsCore.graphicUpdateHandler(ha))}}createQuery(){const Y=
{outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(Y):new C(Y)}queryFeatures(Y,Z){return this._queryEngine.executeQuery(this._ensureQuery(Y),Z?.signal)}queryObjectIds(Y,Z){return this._queryEngine.executeQueryForIds(this._ensureQuery(Y),Z?.signal)}queryFeatureCount(Y,Z){return this._queryEngine.executeQueryForCount(this._ensureQuery(Y),Z?.signal)}queryExtent(Y,Z){return this._queryEngine.executeQueryForExtent(this._ensureQuery(Y),
Z?.signal)}_ensureQuery(Y){return this._addDefinitionExpressionToQuery(null==Y?this.createQuery():C.from(Y))}_setupQueryEngine(){const Y=()=>this.processor.featureStore;this._queryEngine=new B.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return Y()},hasZ:this.hasZ,hasM:this.hasM},priority:ba.TaskPriority.FEATURE_QUERY_ENGINE})}get usedMemory(){return this.processor?.graphicsCore?.usedMemory??
0}get unloadedMemory(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))}get ignoresMemoryFactor(){return this._controller&&this._controller.fixedFeatureTarget}async _handleEdits(Y){const Z=this._attributeEditingContext;Y=await z.normalizeEditResultsEvent(Z,Y);z.processAttributeEdits(Z,Y)}get _attributeEditingContext(){const Y=this._getObjectIdField(),Z=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,
objectIdField:Y,globalIdField:Z,forEachNode:ja=>this.loadedGraphics.forEachNode(oa=>ja(oa.node,oa.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this._i3sOverrides,getAttributeData:ja=>this.getAttributeData(ja),setAttributeData:(ja,oa,qa)=>{this._setAttributeData(ja,oa);ja=this.loadedGraphics.getNode(ja);null!=qa?(qa=this.loadedGraphics.get(qa.attributes[Y]),null!=qa&&this.processor.graphicsCore.recreateGraphics([qa])):null!=ja&&this.processor.graphicsCore.recreateGraphics(ja.graphics)},
clearMemCache:()=>{}}}get performanceInfo(){return new N.LayerViewPerformanceInfo(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}get test(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}};b.__decorate([d.property()],H.prototype,"processor",void 0);b.__decorate([d.property({type:A})],H.prototype,"filter",void 0);b.__decorate([d.property()],
H.prototype,"loadedGraphics",void 0);b.__decorate([d.property()],H.prototype,"i3slayer",null);b.__decorate([d.property()],H.prototype,"_controller",void 0);b.__decorate([d.property()],H.prototype,"updating",void 0);b.__decorate([d.property()],H.prototype,"suspended",void 0);b.__decorate([d.property()],H.prototype,"holeFilling",void 0);b.__decorate([d.property(V.updatingProgress)],H.prototype,"updatingProgress",void 0);b.__decorate([d.property()],H.prototype,"updatingProgressValue",null);b.__decorate([d.property(c.requiredFields)],
H.prototype,"requiredFields",null);b.__decorate([d.property(c.availableFields)],H.prototype,"availableFields",void 0);b.__decorate([d.property()],H.prototype,"_fieldsHelper",void 0);b.__decorate([d.property({type:Number})],H.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],H.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property()],H.prototype,"_excludeObjectIdsSorted",null);b.__decorate([d.property({readOnly:!0})],H.prototype,"lodFactor",null);
b.__decorate([d.property({readOnly:!0})],H.prototype,"hasM",null);b.__decorate([d.property({readOnly:!0})],H.prototype,"hasZ",null);b.__decorate([d.property()],H.prototype,"contentVisible",null);b.__decorate([d.property({readOnly:!0})],H.prototype,"legendEnabled",null);b=H=b.__decorate([l.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],H);const aa={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,
0,0]}}}},ea=r.create(),ha={graphic:null,property:null,oldValue:null,newValue:null};return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../core/workers/WorkerHandle"],function(a,b){class n extends b.WorkerHandle{constructor(h){super("SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:k=>[k.geometryBuffer]},h,{hasInitialize:!0})}}a.I3SPointsWorkerHandle=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports",
"../../../../core/Evented","../../../../core/MapUtils"],function(a,b,n){class h extends b{constructor(k,m){super();this._updateAndCompare=k;this._notifyUpdated=m;this._nodes=new Map;this._graphics=new Map;this._duplicates=new Map}clear(){if(0<this._graphics.size){const k=this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:k})}this._nodes.clear()}get length(){return this._graphics.size}get(k){return this._graphics.get(k)}getNode(k){return this._nodes.get(k)}hasNode(k){return this._nodes.has(k)}nodes(){return this._nodes.values()}addNode(k,
m){this._nodes.set(k,m);const g=m.graphics;if(0!==g.length){var e=new Set;for(let c=0;c<g.length;c++){var d=g[c];const l=d.objectId,f=this._graphics.get(l);f?(e.add(l),d!==f&&(g[c]=f),(d=this._duplicates.get(l))?d.push(k):this._duplicates.set(l,[f.nodeIndex,k])):(d.nodeIndex=k,this._graphics.set(l,d))}e.size&&this._updateForeignGraphics(m);k=0<e.size?g.filter(c=>!e.has(c.objectId)):g;0<k.length&&this.emit("change",{added:k,removed:[]})}}removeNode(k){var m=this._nodes.get(k);if(m){this._nodes.delete(k);
var g=new Set,e=[];for(const l of m.graphics){m=l.objectId;var d=this._graphics.get(m);if(!d)continue;const f=this._duplicates.get(m);if(f){var c=f.indexOf(k);if(-1===c)console.error("error: removing graphic from node that should not reference it.");else{f.splice(c,1);if(d.nodeIndex===k){d=this.getNode(f[0]);for(c=1;c<f.length;c++){const r=this.getNode(f[c]);if(null==d||null!=r&&r.node.level>d.node.level)d=r}null!=d&&g.add(d)}1===f.length&&this._duplicates.delete(m)}}else this._graphics.delete(m),
e.push(l)}0<e.length&&this.emit("change",{added:[],removed:e});g.forEach(l=>this._updateForeignGraphics(l))}else console.error("Removing unknown node")}_updateForeignGraphics(k){const m=[],g=k.node.index,e=k.node.level;let d=0;for(;d<k.graphics.length;){var c=k.graphics[d].nodeIndex;if(c===g){d++;continue}let l=1;for(;d+l<k.graphics.length&&k.graphics[d+l].nodeIndex===c;)l++;c=this.getNode(c);if(!(null!=c&&c.node.level>e))for(c=d;c<d+l;c++){const f=k.graphics[c];f.nodeIndex=g;this._updateAndCompare(f,
k,c)&&m.push(f)}d+=l}this._notifyUpdated(m)}toArray(){return Array.from(this._graphics.values())}find(k){let m=void 0;n.someMap(this._graphics,g=>k(g)?(m=g,!0):!1);return m}forEach(k){this._graphics.forEach(m=>k(m))}forEachNode(k){this._nodes.forEach((m,g)=>k(m,g))}get nodeCount(){return this._nodes.size}_checkInvariants(){const k=new Map;this._nodes.forEach((g,e)=>{e!==g.node.index&&console.error("Mismatched node index");g.graphics.forEach(d=>{k.set(d.objectId,1+(k.get(d.objectId)??0));const c=this._duplicates.get(d.objectId);
c&&!c.includes(e)&&console.error("Node not listed in duplicate list");c||d.nodeIndex===e||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==k.size&&console.error("Mismatch between actual and expected number of graphics");let m=0;k.forEach((g,e)=>{m+=1<g?1:0;const d=this._graphics.get(e);if(d){var c=this._nodes.get(d.nodeIndex);c?(e=this._duplicates.get(e))?(e.length!==g&&console.error("Wrong number of entries in duplicate list"),e.forEach(l=>{(l=this._nodes.get(l))?
l.node.level>c.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<g&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});this._duplicates.size!==m&&console.error("Mismatch between expected and actual number of duplicate entries")}}a.I3SGraphicsMap=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/tslib.es6 ../Camera ../geometry ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/RandomLCG ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../core/accessorSupport/overrideDefaultsFrom ../core/libs/gl-matrix-2/factories/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/projection/projectBoundingRect ../geometry/projection/projectPointToVector ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/hitTest ./3d/support/MapCoordsHelper ./3d/support/popupHitTest ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/TextureCollection ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/basicInterfaces ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/verticalOffsetUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/DefaultUI ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/Extent ../geometry/SpatialReference ../geometry/Point".split(" "),function(a,
b,n,h,k,m,g,e,d,c,l,f,r,x,w,p,t,q,u,v,y,D,G,A,C,E,I,H,J,B,z,K,L,F,M,S,N,P,R,O,T,Q,V,U,W,ca,X,ba,ia,fa,da,aa,ea,ha,Y,Z,ja,oa,qa,ta,va,Ca,ma,wa,Ba,pa,Aa,ra,ua,Ea,Ka,Ma,Ua,Ga,Na,Va,Xa,Pa,bb,gb,cb,ka,mb,qb,tb,xa,Ia,na,ya){function Da(Ja,Ra){return null!=Ja&&J.canProjectWithoutEngine(Ja.spatialReference,Ra)?J.project(Ja,Ra):null}h=class extends P.BreakpointsOwner(T.PopupView(R.DOMContainer(Q))){constructor(Ja){super(Ja);this._createGraphicsViewController=this._initialDefaultSpatialReference=this._clippingArea=
this._userClippingArea=null;this._resolveWhenReady=[];this._propertiesPool=new Ba.PropertiesPool({slicePlane:L.BoundedPlaneClass},this);this._resourceController=ra.newResourceController(this);this._defaultToMapOptions={include:new Set};this._defaultHitTestOptions={exclude:new Set};this.deconflictor=new da.GraphicsDeconflictor({view:this});this.labeler=new aa.Labeler({view:this,deconflictor:this.deconflictor.labels});this.sharedSymbolResources=null;this.analyses=new N.AnalysesCollection;this.canvas=
this.elevationProvider=this.basemapTerrain=null;this.constraints=new X.Constraints;this.environment=new ba;this.environmentManager=new ia.SceneViewEnvironmentManager;this.floors=new m;this.fullOpacity=1;this.graphicsView=null;this.analysisViewManager=new ca({view:this});this.map=this.groundView=null;this.screenSizePerspectiveEnabled=!0;this.state=new ha;this.spatialReference=null;this.preserveDrawingBufferEnabled=this.alphaCompositingEnabled=!1;this.supersampleScreenshotsEnabled=!0;this.type="3d";
this.ui=new tb;this._lastUpdateTime=this._numUpdating=0;this.updatingProgress=.5;this.highlightOptions=new va;u.initialize();const Ra=(Sa=null)=>{if(null==Sa||Sa.type!==x.ObservableChangesType.MOVE)this._updatingChanged(),this.map&&this.map.allLayers.forEach(async db=>{try{await db.when()}catch{}this._updatingChanged()})};this.addHandles([p.on(()=>this.map?.allLayers,"after-changes",Sa=>Ra(Sa),{onListenerAdd:()=>Ra(),onListenerRemove:()=>Ra(),sync:!0}),this.allLayerViews.on("after-changes",Sa=>this._updateUpdatingMonitors(Sa)),
p.watch(()=>this.map,Sa=>{Sa&&"load"in Sa&&Sa.load&&Sa.load().catch(()=>{})})]);this.inputManager=new fa({view:this});this.stateManager=new Y.ViewStateManager({view:this})}initialize(){this.groundView=new O({view:this});this._updateUpdatingMonitors();const Ja=()=>this._updateDefaultToMapOptions();this.addHandles(p.on(()=>this.map?.allLayers,"after-changes",Ja,{onListenerAdd:Ja,onListenerRemove:Ja}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ra=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=
Ra)},p.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ra=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Ra)},p.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Ra=>t.setFrameDuration(0<Ra?1E3/Math.ceil(Ra):0),p.initial);this.updatingHandles.add(()=>this.map?.ground,Ja,p.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),p.syncAndInitial);
this.addHandles(p.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),p.sync))}destroy(){this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=r.destroyMaybe(this.sharedSymbolResources),this._set("labeler",r.destroyMaybe(this.labeler)),this._set("deconflictor",r.destroyMaybe(this.deconflictor)),this._resourceController=r.destroyMaybe(this._resourceController),
this._set("stateManager",r.destroyMaybe(this.stateManager)),this._set("inputManager",r.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",r.destroyMaybe(this.environmentManager)),this._set("environment",r.destroyMaybe(this.environment)),this.groundView=r.destroyMaybe(this.groundView),this._exitBasemapTerrain(),this._stage?.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&
this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain?.spatialReference}get animation(){return this.state?.animation}get camera(){return this.stateManager?.camera}set camera(Ja){this.stateManager&&(this.stateManager.camera=Ja)}get contentCamera(){return this.stateManager?.contentCamera}set contentCamera(Ja){this.stateManager&&(this.stateManager.contentCamera=Ja)}installContentCameraReset(Ja={sticky:!1}){return this.stateManager.installContentCameraReset(Ja)}get center(){return this.stateManager?.center}set center(Ja){this.stateManager&&
(this.stateManager.center=Ja)}get clippingArea(){if("global"===this.viewingMode)return null;const Ja=this.map;let Ra=this._userClippingArea||r.maybeProperty(Ja,"clippingArea");if(!this._userClippingArea&&!r.maybeProperty(Ja,"clippingEnabled")||null==Ra)return this._clippingArea=null;if(!(Ra instanceof Ia))return f.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Ra=Da(Ra,this.spatialReference),null==Ra))return f.getLogger(this).error("#clippingArea",
"setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ra=Ra.clone();null==Ra.intersection(this._groundAndLayersExtent)&&(Ra.xmin=Ra.xmax,Ra.ymin=Ra.ymax);Ra.zmin=void 0;Ra.zmax=void 0;Ra.equals(this._clippingArea)||(this._clippingArea=Ra);return this._clippingArea}set clippingArea(Ja){this.ready&&"global"===this.viewingMode&&null!=Ja?f.getLogger(this).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Ja}get renderDataExtent(){if(this.state.viewingMode===
U.ViewingMode.Global)return null;const Ja=this.renderSpatialReference,Ra=this.dataExtent;return null==Ra||null==Ja||Ra.spatialReference.equals(Ja)?Ra:Da(Ra,Ja)}get dataExtent(){let Ja=this._groundAndLayersExtent;var Ra=Da(this.clippingArea,this.spatialReference||na.WGS84);null!=Ra&&(Ja=null!=Ja?Ja.intersection(Ra):Ra);Ra=this._get("dataExtent");return null!=Ja&&Ja.equals(Ra)?Ra:Ja}get _groundAndLayersExtent(){const Ja=this.spatialReference||na.WGS84;let Ra;const Sa=eb=>{eb=Da(eb,Ja);null!=eb&&(null!=
Ra?Ra.union(eb):Ra=eb.clone())};var db=this.basemapTerrain;if(db?.spatialReference){const eb=db.groundExtent;Sa(new Ia({xmin:eb[0],ymin:eb[1],zmin:0,xmax:eb[2],ymax:eb[3],zmax:0,spatialReference:db.spatialReference}))}this.map&&this.map.allLayers.forEach(eb=>{null==eb.fullExtent||"graphics"===eb.type&&eb.internal||Sa(eb.fullExtent)});if(null==Ra)return null;Ra.hasZ?(Ra.zmin=Math.min(0,Ra.zmin??0),Ra.zmax=Math.max(0,Ra.zmax??0)):(Ra.zmin=0,Ra.zmax=0);db=this._get("_groundAndLayersExtent");return Ra.equals(db)?
db:Ra}castEnvironment(Ja){return Ja?Ja instanceof ba?Ja:Ja instanceof xa?this.environment?.cloneWithWebsceneEnvironment(Ja)??ba.fromWebsceneEnvironment(Ja):A.ensureType(ba,Ja):new ba}get extent(){return this.stateManager?.extent}set extent(Ja){this.stateManager&&(this.stateManager.extent=Ja)}get screenCenter(){return this.stateManager?.screenCenter}get frustum(){return this.stateManager?.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,
heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(this.toolViewManager?.interacting??!1)}get stationary(){return!this.animation&&!this.resizing&&(null==this.state||this.state.stationary)}get navigating(){return this.state?.navigating??!1}get padding(){return this.stateManager?.padding}set padding(Ja){this.stateManager&&(this.stateManager.padding=Ja)}set qualityProfile(Ja){qa.isValidProfile(Ja)&&(qa.apply(Ja,this.qualitySettings),this._set("qualityProfile",Ja))}get qualityProfile(){return this._get("qualityProfile")||
qa.getDefaultProfile()}set slicePlane(Ja){null!=this._stage&&this._stage.renderer.setParameters({slicePlane:Ja});if(null==Ja)this._set("slicePlane",null);else{var Ra=this._propertiesPool.get("slicePlane");L.copy(Ja,Ra);this._set("slicePlane",Ra)}}get typeSpecificPreconditionsReady(){return this.viewingMode?this.stateManager.preinit(this.spatialReference):!1}get resolution(){return null!=this.spatialReference?M.getResolutionForScale(this.scale,this.spatialReference):0}get scale(){return this.stateManager?.scale}set scale(Ja){this.stateManager&&
(this.stateManager.scale=Ja)}get heightModelInfo(){const Ja=this.getDefaultHeightModelInfo();return null!=Ja?H.deriveUnitFromSR(Ja,this.spatialReference):null}get updating(){if(this.destroyed)return!1;let Ja=0,Ra=this.layerViewManager.updating,Sa=Ra?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(lb=>{lb.isFulfilled()?lb.updating&&(Ra=!0,lb.suspended||Ga.isSurfaceLayerView(lb)||(++Sa,Ja+=lb.updatingProgress)):++Sa});for(var db of this._updatingObjects)null!=db&&db.updating&&(Sa+=
.1,Ja+=.05);for(var eb of this._updatingObjectsWithProgress)null!=eb&&eb.updating&&(++Sa,Ja+=eb.updatingProgress);db=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;(Ra=!!(Ra||0<Sa||this.updatingHandles.updating||!this.ready||!this.stationary||db||this._createGraphicsViewController||this.inputManager?.updating||this.map?.allLayers?.some(lb=>!lb.isFulfilled())||this.textures?.updating))?(this._numUpdating=Math.max(Sa,this._numUpdating),Ja+=this._numUpdating-Sa):this._numUpdating=
0;Ja=0<this._numUpdating?Ja/this._numUpdating:Ra?0:1;this._get("updatingProgress")!==Ja&&(db=performance.now(),1>Ja&&(eb=Math.min((db-this._lastUpdateTime)/2E3,1),Ja=this.updatingProgress*(1-eb)+Ja*eb),this._set("updatingProgress",Ja),this._lastUpdateTime=Ra&&1>Ja?db:0);return Ra}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,
this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var Ja=this._predeterminedViewingMode;return null!=Ja?U.stringFromViewingMode(Ja):(Ja=this.spatialReference)?null!=this.defaultsFromMap?.viewingMode&&Ja.equals(this.defaultsFromMap.spatialReference)?U.stringFromViewingMode(this.defaultsFromMap.viewingMode):ka.isSpatialReferenceSupported(Ja,U.ViewingMode.Global)?"global":"local":"global"}set viewingMode(Ja){this.ready?
f.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",Ja)}get viewpoint(){return this.stateManager?.viewpoint}set viewpoint(Ja){this.stateManager&&(this.stateManager.viewpoint=Ja)}get zoom(){return this.stateManager.zoom}set zoom(Ja){this.stateManager&&(this.stateManager.zoom=Ja)}get resourceController(){return this._resourceController}get quality(){return this._resourceController?.memoryController?.memoryFactor??1}get resolutionScale(){return Math.sqrt(Math.min(1,
this.quality/.75))}get performanceInfo(){return new ua(this)}on(Ja,Ra,Sa,db){return(Sa=this.viewEvents.on(Ja,Ra,Sa,db))?Sa:super.on(Ja,Ra)}hasEventListener(Ja){return super.hasEventListener(Ja)||this.viewEvents.hasHandler(Ja)}toMap(Ja,Ra){if(!this.ready)return f.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;Ja=cb.isSupportedScreenPointEvent(Ja)?cb.createScreenPointFromSupportedEvent(this,Ja):Ja;return Ca.toMap(this,Ja,Ra,this._defaultToMapOptions)}toScreen(Ja){if(!this.ready)return f.getLogger(this).error("#toScreen()",
"Scene view cannot be used before it is ready"),null;const Ra=(null==Ja.z?ta.getElevationAtPoint(this.elevationProvider,Ja):null)??0;z.projectPointToVector(Ja,Oa,this.renderSpatialReference,Ra);this.state.camera.projectToScreen(Oa,Wa);return q.createScreenPoint(Wa[0],Wa[1])}pixelSizeAt(Ja){if(!this.ready)return f.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ja)return 0;z.projectPointToVector(Ja,Oa,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Oa)}overlayPixelSizeInMapUnits(Ja){const Ra=
this.basemapTerrain.overlayManager;return Ra?Ra.overlayPixelSizeInMapUnits(Ja,()=>this.pixelSizeAt(Ja)):1}hitTest(Ja,Ra){if(!this.ready)return f.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;Ja=cb.isSupportedScreenPointEvent(Ja)?cb.createScreenPointFromSupportedEvent(this,Ja):Ja;return Ca.hitTest(this,Ja,Ra,this._defaultHitTestOptions)}async popupHitTest(Ja){return wa.popupHitTest(this,Ja)}goTo(Ja,Ra){return this.updatingHandles.addPromise(this.stateManager.goTo(Ja,
Ra))}async whenAnalysisView(Ja){if(null==Ja.parent)throw new e("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ja});switch(Ja.parent.type){case "line-of-sight":case "dimension":return(await this.whenLayerView(Ja.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Ja)}}whenLayerView(Ja){return super.whenLayerView(Ja)}async takeScreenshot(Ja){Ja=this._completeSettings(Ja);await this.whenReady();const Ra=await this._stage.renderView.takeScreenshot(Ja);
return gb.encode(Ra,Ja,this._pixelFormat())}async _takeScreenshot(Ja){Ja=this._completeSettings(Ja);await this.whenReady();Ja=await this._stage.renderView.takeScreenshot(Ja);return gb.encodeData(Ja,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(Ja){Ja=this._completeSettings(Ja);await this.whenReady();Ja=await this._stage.renderView.takeScreenshotWithOID(Ja);return[gb.encodeData(Ja[0],this._pixelFormat()),gb.encodeData(Ja[1],this._pixelFormat())]}_completeSettings(Ja){Ja=gb.toRenderSettings(Ja,
this);Ja.pixelRatio/=this.state.pixelRatio;return gb.screenshotSuperSampleSettings(Ja,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:Ja=>this._takeScreenshot(Ja),takeScreenshotWithObjectAndLayerId:Ja=>this._takeScreenshotWithObjectAndLayerId(Ja)}}async takeScreenshotWithObjectAndLayerId(Ja){if(!l("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");
var Ra=this._completeSettings(Ja);await this.whenReady();var Sa=await this._stage.renderView.takeScreenshotWithOID(Ra);Ra=gb.encode(Sa[0],Ra,this._pixelFormat());Ja=this._completeSettings(Ja);Ja.format="png";Sa=gb.encode(Sa[1],Ja,this._pixelFormat());return[Ra,Sa]}getColorToObjectAndLayerIdMapping(){if(null==this._stage.renderView.objectAndLayerIdRenderHelper)throw Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(Ja){return this.updatingHandles.addPromise(Ja)}importLayerView(Ja){return W.layerView3DImporter.importLayerView(Ja)}hasLayerViewModule(Ja){return W.layerView3DImporter.hasLayerViewModule(Ja)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){return this.map&&
"initialViewProperties"in this.map&&this.map.initialViewProperties?.spatialReference||this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null}async validate(){let Ja=mb.check(this.type);const Ra=l("safari");Ra&&9>Ra&&(Ja=new e("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:Ra}));if(null!=Ja)throw f.getLogger(this).warn("#validate()",Ja.message),Ja;
}get _predeterminedViewingMode(){const Ja=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return null!=Ja?U.viewingModeFromString(Ja):null}getSpatialReferenceSupport({spatialReference:Ja,layer:Ra}){var Sa=this._predeterminedViewingMode;if(null!=Sa)return this._validateSpatialReferenceForViewingMode(Ja,Ra,Sa)?{constraints:this._makeSpatialReferenceConstraints(Ja,Ra,Sa)}:null;Sa=this._validateSpatialReferenceForViewingMode(Ja,
Ra,U.ViewingMode.Local);const db=this._validateSpatialReferenceForViewingMode(Ja,Ra,U.ViewingMode.Global);return Sa||db?Sa&&db?{constraints:this._makeSpatialReferenceConstraints(Ja,Ra,null)}:Sa?{constraints:this._makeSpatialReferenceConstraints(Ja,Ra,U.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ja,Ra,U.ViewingMode.Global)}:null}_validateSpatialReferenceForViewingMode(Ja,Ra,Sa){return ka.isSpatialReferenceSupported(Ja,Sa)?null==Ra||S.isImageryTileLayer(Ra)?!0:S.isTiledLayer(Ra)&&
null==Ga.getTiledLayerInfo(Ra,Ja,Sa)||S.isVoxelLayer(Ra)&&Sa===U.ViewingMode.Global?!1:!0:!1}_makeSpatialReferenceConstraints(Ja,Ra,Sa){if(null==Ra)return[{spatialReference:Ja,viewingMode:Sa}];const db=Ja.isWebMercator,eb=Ja.isWGS84;return S.isImageryTileLayer(Ra)&&(db||eb)?(eb&&Sa!==U.ViewingMode.Local?null===Ga.checkIfTileInfoSupportedForView(Ra.tileInfo,Ra.fullExtent,Ja,U.ViewingMode.Global):1)?[{spatialReference:Ja,viewingMode:Sa},{spatialReference:na.WebMercator,viewingMode:Sa}]:[{spatialReference:db?
na.WGS84:na.WebMercator,viewingMode:Sa}]:S.isTiledLayer(Ra)||S.isVoxelLayer(Ra)||!db&&!eb?S.isTiledLayer(Ra)&&db&&Sa!==U.ViewingMode.Global?[{spatialReference:Ja,viewingMode:Sa},{spatialReference:na.WGS84,viewingMode:U.ViewingMode.Local}]:[{spatialReference:Ja,viewingMode:Sa}]:[{spatialReference:Ja,viewingMode:Sa},{spatialReference:db?na.WGS84:na.WebMercator,viewingMode:Sa}]}_validateSpatialReference(Ja){const Ra=null!=this.getSpatialReferenceSupport({spatialReference:Ja}),Sa=this._predeterminedViewingMode;
Ra||(null!=Sa?f.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${U.stringFromViewingMode(Sa)} viewing mode.`):Ja.isGeographic&&f.getLogger(this).warnOnce("Spatial reference is geographic but not supported."));return Ra}whenReady(){return new Promise(Ja=>{this.ready?Ja(this):this._resolveWhenReady.push(Ja)})}trackGraphicState(Ja){if(!Ja.graphic)return f.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;
const Ra=this.getViewForGraphic(Ja.graphic);let Sa=null,db=!1;const eb=lb=>{!db&&null!=lb&&"processor"in lb&&"graphics-3d"===lb.processor?.type&&lb.processor.graphicsCore&&(Sa=lb.processor.graphicsCore.trackGraphicState(Ja))};null!=Ra?eb(Ra):this.whenViewForGraphic(Ja.graphic,{waitForLayer:!0}).then(lb=>eb(lb),()=>{}).catch(()=>{});return c.makeHandle(()=>{db=!0;null!=Sa&&(Sa.remove(),Sa=null)})}highlight(Ja){if(Array.isArray(Ja))return c.handlesGroup(Ja.map(Sa=>this.highlight(Sa)));if(m.isCollection(Ja))return c.handlesGroup(Ja.toArray().map(Sa=>
this.highlight(Sa)));const Ra=this.getViewForGraphic(Ja);return Ra&&"highlight"in Ra?Ra.highlight(Ja):c.makeHandle()}maskOccludee(Ja){if(!Ja)return f.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ra=this.getViewForGraphic(Ja);let Sa=null,db=!1;const eb=lb=>{!db&&null!=lb&&bb.occludeesSupported(lb)&&(Sa=lb.maskOccludee(Ja))};null!=Ra?eb(Ra):this.whenViewForGraphic(Ja,{waitForLayer:!0}).then(lb=>eb(lb),()=>{}).catch(()=>{});
return c.makeHandle(()=>{db=!0;null!=Sa&&(Sa.remove(),Sa=null)})}getViewForGraphic(Ja){return Ja.layer===this.graphics?this.graphicsView:Ja.layer?this.allLayerViews.find(Ra=>Ra.layer===Ja.layer):null}graphicChanged(Ja){null!=this.graphicsView&&this.graphicsView.graphicChanged(Ja)}async whenViewForGraphic(Ja,Ra){if(Ja.layer===this)return await p.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ja.layer||!this.map)throw new e("no-view-for-graphic");return Ra&&Ra.waitForLayer&&!this.map.allLayers.includes(Ja.layer)?
new Promise((Sa,db)=>{const eb=this.map.allLayers.on("change",lb=>{lb.added.includes(Ja.layer)&&(eb.remove(),this.whenLayerView(Ja.layer).then(Sa,db))})}):this.whenLayerView(Ja.layer)}_initBasemapTerrain(){this._set("basemapTerrain",new Ua({view:this}));this._set("elevationProvider",new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),
this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ma.PointsOfInterest({view:this}));this._set("featureTiles",new ea.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,
scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ja=()=>{var Ra=this.basemapTerrain?.extent;this.clippingArea||Ra?Ra&&this.basemapTerrain.spatialReference?(Ra=null!=this.basemapTerrain.extent&&null!=this.basemapTerrain.spatialReference?J.project(K.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,this.featureTiles.filterExtent=null!=this.clippingArea?this.clippingArea.intersection(Ra):Ra):this.featureTiles.filterExtent=
this.clippingArea:this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES,Ra=>{Ra&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((Sa,db)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Sa,db))).then(({FeatureTileTree3DDebugger:Sa})=>{!this._featureTreeDebugger&&oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new Sa({view:this}))}):Ra||!this._featureTreeDebugger||
oa.debugFlags.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},p.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ja,p.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ja,p.syncAndInitial)],"feature-tiles");this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",
null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){var Ja=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ja)||this._set("mapCoordsHelper",new ma.MapCoordsHelper(this.map,Ja));const Ra=this.state.isGlobal;Ja=F.renderSRFromViewSR(Ra,Ja);Ja!==this.renderSpatialReference&&(this._set("renderCoordsHelper",Aa.RenderCoordsHelper.create(this.state.viewingMode,
Ja)),Ra||this.addHandles(p.watch(()=>this.basemapTerrain?.extent,Sa=>{const db=this.renderCoordsHelper.spatialReference;null==Sa||0===Sa[0]&&0===Sa[1]&&0===Sa[2]&&0===Sa[3]||!B.projectBoundingRect(Sa,this.basemapTerrain.spatialReference,ab,db)||(this.renderCoordsHelper.extent=ab)},p.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Xa.defaultTolerance/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",
null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(Ja=null){if(null==Ja||Ja.type!==x.ObservableChangesType.MOVE)this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(Ra=>{Ra.destroyed||(this.addHandles(p.watch(()=>[Ra.updating,Ra.updatingProgress],()=>this._updatingChanged(),p.sync),"updatingMonitors"),
Ra.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged()}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(Ja,Ra,Sa){if(!this.overlay||!this.overlay.hasVisibleItems)return Sa;const db=Ja.getContext("2d");db.putImageData(Sa,0,0);this.overlay.renderCanvas(Ja,{disableDecorations:Ra===Va.Decorations.OFF});return db.getImageData(0,0,Sa.width,Sa.height)}_initStage(){const Ja={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,
debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(Sa,db,eb)=>this._renderScreenshotOverlay(Sa,db,eb)}};var Ra=new Z.SceneIntersectionHelper(this.state.viewingMode,Sa=>this._stage.layers.forAll(Sa),this);this._set("sceneIntersectionHelper",Ra);Ra=g.byId(this.surface);this._stage=new Na.Stage({view:this,options:Ja,
container:Ra});this._stage.renderer.setParameters({slicePlane:this.slicePlane});this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,Sa=>this._stage.renderer.setParameters({highQualityTransparency:Sa}),p.initial),p.watch(()=>this.magnifier,Sa=>this._stage.renderView.magnifier=Sa,p.syncAndInitial),this.on("pointer-move",()=>this._stage?.renderer.resetAnimation()),d.on(this._stage.renderView.canvas,"webglcontextlost",Sa=>{this.fatalError=new e("webgl-context-lost",
Sa.statusMessage)})],"stage");this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Xa.defaultTolerance/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null);this._stage=r.destroyMaybe(this._stage);this.removeHandles("stage");this._set("canvas",null)}_initSurface(Ja){this._exitSurface();this.state.init(Ja,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ea.SharedSymbolResources({view:this,
viewingMode:Ja,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.removeHandles("graphics-view");this._createGraphicsViewController=
new AbortController;var Ja=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ja,Ja);this._updatingChanged()}}async _createGraphicsViewAsync(Ja){const Ra=(await new Promise((Sa,db)=>a(["./3d/layers/GraphicsView3D"],eb=>Sa(Object.freeze(Object.defineProperty({__proto__:null,default:eb},Symbol.toStringTag,{value:"Module"}))),db))).default;w.throwIfAborted(Ja);await p.whenOnce(()=>this.basemapTerrain?.ready,
Ja);this._set("graphicsView",new Ra({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.removeHandles("graphics-view");null!=this.graphicsView&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var Ja=U.viewingModeFromString(this.viewingMode);Ja===U.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ja);
this._set("ready",!0);this.addHandles(p.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();(Ja=this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.environment:void 0)&&C.overrideDefaultsFrom(this.environment,Ja);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();this._set("textures",new Ka.TextureCollection(this._stage,this.resourceController.scheduler));Ja=
this._resolveWhenReady;this._resolveWhenReady=[];Ja.forEach(Ra=>Ra(this))}_teardown(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.removeHandles("graphics-view");this._set("textures",r.destroyMaybe(this.textures));this._exitSurface();this._set("ready",!1)}_updateDefaultToMapOptions(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Pa.terrainId);
for(const Ja of this.map.allLayers.items)S.isIntegratedMeshLayer(Ja.type)&&this._defaultToMapOptions.include.add(Ja.uid)}}_updateDefaultHitTestOptions(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Pa.terrainId);for(const Ja of this.map.allLayers.items)S.isIntegratedMeshLayer(Ja.type)&&1>Ja.opacity&&this._defaultHitTestOptions.exclude.add(Ja.uid)}}};h.type="3d";b.__decorate([v.property()],h.prototype,"_userClippingArea",
void 0);b.__decorate([v.property()],h.prototype,"_resourceController",void 0);b.__decorate([v.property()],h.prototype,"_stage",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"deconflictor",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"labeler",void 0);b.__decorate([v.property(I.owningCollectionProperty(N.AnalysesCollection,"analyses"))],h.prototype,"analyses",void 0);b.__decorate([v.property({type:V,readOnly:!0})],h.prototype,"animation",null);b.__decorate([v.property({readOnly:!0})],
h.prototype,"basemapTerrain",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"elevationProvider",void 0);b.__decorate([v.property()],h.prototype,"camera",null);b.__decorate([v.property({type:n})],h.prototype,"contentCamera",null);b.__decorate([v.property({readOnly:!0})],h.prototype,"canvas",void 0);b.__decorate([v.property({type:ya})],h.prototype,"center",null);b.__decorate([v.property({type:Ia})],h.prototype,"clippingArea",null);b.__decorate([v.property({type:X.Constraints})],h.prototype,
"constraints",void 0);b.__decorate([v.property({type:Ia,readOnly:!0})],h.prototype,"renderDataExtent",null);b.__decorate([v.property({type:Ia,readOnly:!0})],h.prototype,"dataExtent",null);b.__decorate([v.property({type:Ia,readOnly:!0})],h.prototype,"_groundAndLayersExtent",null);b.__decorate([v.property({type:ba})],h.prototype,"environment",void 0);b.__decorate([y.cast("environment")],h.prototype,"castEnvironment",null);b.__decorate([v.property({readOnly:!0})],h.prototype,"environmentManager",void 0);
b.__decorate([v.property({type:Ia})],h.prototype,"extent",null);b.__decorate([v.property()],h.prototype,"floors",void 0);b.__decorate([v.property()],h.prototype,"screenCenter",null);b.__decorate([v.property()],h.prototype,"frustum",null);b.__decorate([v.property({type:Number,readOnly:!0})],h.prototype,"fullOpacity",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"graphicsView",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"analysisViewManager",void 0);b.__decorate([v.property()],
h.prototype,"groundView",void 0);b.__decorate([v.property({type:Boolean})],h.prototype,"initialExtentRequired",null);b.__decorate([v.property()],h.prototype,"_defaultsFromMapSettings",null);b.__decorate([v.property()],h.prototype,"interacting",null);b.__decorate([v.property()],h.prototype,"stationary",null);b.__decorate([v.property()],h.prototype,"navigating",null);b.__decorate([v.property()],h.prototype,"map",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"mapCoordsHelper",void 0);
b.__decorate([v.property()],h.prototype,"padding",null);b.__decorate([v.property({type:Ma.PointsOfInterest,readOnly:!0})],h.prototype,"pointsOfInterest",void 0);b.__decorate([v.property({type:ea.FeatureTileTree3D,readOnly:!0})],h.prototype,"featureTiles",void 0);b.__decorate([v.property()],h.prototype,"_featureTreeDebugger",void 0);b.__decorate([v.property({type:Boolean})],h.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([v.property({constructOnly:!0})],h.prototype,"deactivatedWebGLExtensions",
void 0);b.__decorate([v.property({constructOnly:!0})],h.prototype,"debugWebGLExtensions",void 0);b.__decorate([v.property({constructOnly:!0})],h.prototype,"renderCanvas",void 0);b.__decorate([v.property({constructOnly:!0})],h.prototype,"state",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"inputManager",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"stateManager",void 0);b.__decorate([v.property({type:["low","medium","high"]})],h.prototype,"qualityProfile",null);b.__decorate([v.property({type:pa,
get(){let Ja=this._get("qualitySettings");Ja||(Ja=new pa,qa.apply(this.qualityProfile,Ja));return Ja}})],h.prototype,"qualitySettings",void 0);b.__decorate([v.property()],h.prototype,"slicePlane",null);b.__decorate([v.property({readOnly:!0})],h.prototype,"typeSpecificPreconditionsReady",null);b.__decorate([v.property({readOnly:!0})],h.prototype,"renderCoordsHelper",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);b.__decorate([v.property({type:Number,
dependsOn:["scale","spatialReference"],readOnly:!0})],h.prototype,"resolution",null);b.__decorate([v.property({type:Number})],h.prototype,"scale",null);b.__decorate([v.property()],h.prototype,"heightModelInfo",null);b.__decorate([v.property()],h.prototype,"spatialReference",void 0);b.__decorate([v.property({type:Boolean,constructOnly:!0})],h.prototype,"alphaCompositingEnabled",void 0);b.__decorate([v.property({constructOnly:!0})],h.prototype,"preserveDrawingBufferEnabled",void 0);b.__decorate([v.property({type:Boolean})],
h.prototype,"supersampleScreenshotsEnabled",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"type",void 0);b.__decorate([v.property(),y.cast(Ja=>Ja instanceof qb?Ja:A.ensureClass(tb,Ja))],h.prototype,"ui",void 0);b.__decorate([v.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.updating toolViewManager.updating analysisViewManager.updating state.updating textures.updating".split(" ")})],
h.prototype,"updating",null);b.__decorate([v.property()],h.prototype,"_updatingObjects",null);b.__decorate([v.property()],h.prototype,"_updatingObjectsWithProgress",null);b.__decorate([v.property({type:Number,readOnly:!0,dependsOn:["updating"]})],h.prototype,"updatingProgress",void 0);b.__decorate([v.property({type:["global","local"]})],h.prototype,"viewingMode",null);b.__decorate([v.property({type:k})],h.prototype,"viewpoint",null);b.__decorate([v.property({type:Number})],h.prototype,"zoom",null);
b.__decorate([v.property({type:va})],h.prototype,"highlightOptions",void 0);b.__decorate([v.property({readOnly:!0})],h.prototype,"quality",null);b.__decorate([v.property({readOnly:!0})],h.prototype,"resolutionScale",null);b.__decorate([v.property()],h.prototype,"textures",void 0);h=b.__decorate([G.subclass("esri.views.SceneView")],h);const Oa=E.create(),Wa=q.createScreenPointArray(),ab=K.create();return h});