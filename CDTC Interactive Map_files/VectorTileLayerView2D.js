// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.29/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ../../tiling/TileKey".split(" "),function(y,z,C,d,e,f,c,b,g){function k(t){return()=>t.abort()}class m{constructor(t,q,p,r){this._layer=t;this._styleRepository=q;this.devicePixelRatio=p;this._sourceDataMaxLOD=r;this._inputSignalEventListener=this._startOptionsInputSignal=
this._spriteSourceAbortController=this._connection=this._glyphMosaic=this._spriteMosaic=null}destroy(){this._connection?.close();this._layer=this._styleRepository=this._connection=null;this._spriteMosaic?.destroy();this._glyphMosaic=this._spriteMosaic=null;this._spriteSourceAbortController=z.abortMaybe(this._spriteSourceAbortController);this._spriteSourcePromise=null;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);this._inputSignalEventListener=
this._startOptionsInputSignal=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(t){this._requestSprite(t);var q=this._layer.currentStyleInfo.glyphsUrl;q=new c(q?d.addQueryParameters(q,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,1024,q);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then(p=>{this._layer&&
(this._connection?.close(),this._connection=p,this._layer&&!this._connection.closed&&(p=p.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},t),Promise.all(p).catch(r=>C.throwIfNotAbortError(r))))})}_requestSprite(t){this._spriteSourceAbortController?.abort();const q=new AbortController;this._spriteSourceAbortController=q;const p=t?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener);
this._startOptionsInputSignal=null;p&&(this._inputSignalEventListener=k(q),p.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const {signal:r}=q;this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,{...t,signal:r});this._spriteSourcePromise.then(B=>{C.throwIfAbortError(r);this._spriteMosaic=new b(1024,1024,250);this._spriteMosaic.setSpriteSource(B)})}async updateStyle(t){await this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",
t))}setSpriteSource(t){const q=new b(1024,1024,250);q.setSpriteSource(t);this._spriteMosaic=q;this._spriteSourcePromise=Promise.resolve(t);this._spriteSourceAbortController=null;return q}async setStyle(t,q,p){await this._broadcastPromise;this._styleRepository=t;this._sourceDataMaxLOD=p;this._requestSprite();t=new c(this._layer.currentStyleInfo.glyphsUrl?d.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new f(1024,
1024,t);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:q,sourceDataMaxLOD:this._sourceDataMaxLOD}))}async fetchTileData(t,q){t=await this._getRefKeys(t,q);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),t,q)}async fetchTilePBFs(t){const q=Object.keys(this._layer.sourceNameToSource),p={};t=await this._getRefKeys(t,p);const r=[],B=[];for(let F=0;F<t.length;F++)if(null==t[F].value||null==q[F])B.push(null);else{const w=t[F].value,D=this._getTilePayload(w,
q[F],p);D.then(E=>{r.push({...E,key:w})});B.push(D)}return Promise.all(B).then(()=>r)}async parseTileData(t,q){const p=t&&t.data;if(!p)return null;const {sourceName2DataAndRefKey:r,transferList:B}=p;return 0===Object.keys(r).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:t.styleLayerUIDs},{...q,transferList:B}))}async getSprites(t){await this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(t)}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,
t.codePoints)}async _getTilePayload(t,q,p){t=g.pool.acquire(t.id);const r=this._layer.sourceNameToSource[q],{level:B,row:F,col:w}=t;g.pool.release(t);try{return{protobuff:await r.requestTile(B,F,w,p),sourceName:q}}catch(D){if(C.isAbortError(D))throw D;return{protobuff:null,sourceName:q}}}async _getRefKeys(t,q){const p=this._layer.sourceNameToSource,r=[];for(const B in p){const F=p[B].getRefKey(t,q);r.push(F)}return C.eachAlways(r)}_getSourcesData(t,q,p){const r=[];for(let B=0;B<q.length;B++)if(null==
q[B].value||null==t[B])r.push(null);else{const F=this._getTilePayload(q[B].value,t[B],p);r.push(F)}return C.eachAlways(r).then(B=>{const F={},w=[];for(let D=0;D<B.length;D++){const E=B[D].value;E&&E.protobuff&&0<E.protobuff.byteLength&&(F[E.sourceName]={refKey:q[D].value.id,protobuff:E.protobuff},w.push(E.protobuff))}return{sourceName2DataAndRefKey:F,transferList:w}})}}y.TileHandler=m;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack",
"../webgl/Rect","../../../webgl/enums","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(y,z,C,d,e){class f{constructor(c,b,g){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=c;this.height=b;this._glyphSource=g;this._binPack=new y(c-4,b-4);this._glyphData.push(new Uint8Array(c*b));this._dirties.push(!0);this._textures.push(void 0)}getGlyphItems(c,b){const g=[],k=this._glyphSource,
m=new Set,t=1/256;for(const p of b)m.add(Math.floor(p*t));const q=[];m.forEach(p=>{const r=c+p;this._rangePromises.has(r)?q.push(this._rangePromises.get(r)):(p=k.getRange(c,p).then(()=>{this._rangePromises["delete"](r)},()=>{this._rangePromises["delete"](r)}),this._rangePromises.set(r,p),q.push(p))});return Promise.all(q).then(()=>{let p=this._glyphIndex[c];p||(p={},this._glyphIndex[c]=p);for(const D of b){var r=p[D];if(r){g[D]={sdf:!0,rect:r.rect,metrics:r.metrics,page:r.page,code:D};continue}var B=
k.getGlyph(c,D);if(!B?.metrics)continue;r=B.metrics;let E;if(0===r.width)E=new z(0,0,0,0);else{const H=r.width+6,K=r.height+6;var F=H%4?4-H%4:4,w=K%4?4-K%4:4;1===F&&(F=5);1===w&&(w=5);E=this._binPack.allocate(H+F,K+w);E.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new y(this.width-4,this.height-
4),E=this._binPack.allocate(H+F,K+w));F=this._glyphData[this._currentPage];B=B.bitmap;let O;if(B)for(let h=0;h<K;h++){w=H*h;O=this.width*(E.y+h+1)+E.x;for(let n=0;n<H;n++)F[O+n+1]=B.at(w+n)}}p[D]={rect:E,metrics:r,tileIDs:null,page:this._currentPage};g[D]={sdf:!0,rect:E,metrics:r,page:this._currentPage,code:D};this._dirties[this._currentPage]=!0}return g})}removeGlyphs(c){for(const b in this._glyphIndex){const g=this._glyphIndex[b];if(!g)continue;let k;for(const m in g)if(k=g[m],k.tileIDs["delete"](c),
0===k.tileIDs.size){const t=this._glyphData[k.page],q=k.rect;let p,r;for(let B=0;B<q.height;B++)for(p=this.width*(q.y+B)+q.x,r=0;r<q.width;r++)t[p+r]=0;delete g[m];this._dirties[k.page]=!0}}}bind(c,b,g,k=0){if(!this._textures[g]){var m=new e.TextureDescriptor;m.pixelFormat=C.PixelFormat.ALPHA;m.wrapMode=C.TextureWrapMode.CLAMP_TO_EDGE;m.width=this.width;m.height=this.height;this._textures[g]=new d.Texture(c,m,new Uint8Array(this.width*this.height))}m=this._textures[g];m.setSamplingMode(b);this._dirties[g]&&
m.setData(this._glyphData[g]);c.bindTexture(m,k);this._dirties[g]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0;this._binPack=null;for(const c of this._textures)c&&c.dispose();this._textures.length=0}}return f})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(y){class z{constructor(C,d){this._height=this._width=0;this._free=[];this._width=C;this._height=d;this._free.push(new y(0,0,C,d))}get width(){return this._width}get height(){return this._height}allocate(C,
d){if(C>this._width||d>this._height)return new y;let e=null,f=-1;for(let c=0;c<this._free.length;++c){const b=this._free[c];C<=b.width&&d<=b.height&&(null===e||b.y<=e.y&&b.x<=e.x)&&(e=b,f=c)}if(null===e)return new y;this._free.splice(f,1);e.width<e.height?(e.width>C&&this._free.push(new y(e.x+C,e.y,e.width-C,d)),e.height>d&&this._free.push(new y(e.x,e.y+d,e.width,e.height-d))):(e.width>C&&this._free.push(new y(e.x+C,e.y,e.width-C,e.height)),e.height>d&&this._free.push(new y(e.x,e.y+d,C,e.height-d)));
return new y(e.x,e.y,C,d)}release(C){for(let d=0;d<this._free.length;++d){const e=this._free[d];if(e.y===C.y&&e.height===C.height&&e.x+e.width===C.x)e.width+=C.width;else if(e.x===C.x&&e.width===C.width&&e.y+e.height===C.y)e.height+=C.height;else if(C.y===e.y&&C.height===e.height&&C.x+C.width===e.x)e.x=C.x,e.width+=C.width;else if(C.x===e.x&&C.width===e.width&&C.y+C.height===e.y)e.y=C.y,e.height+=C.height;else continue;this._free.splice(d,1);this.release(C)}this._free.push(C)}}return z})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request",
"../../../../core/pbf"],function(y,z){class C{constructor(c){this._metrics=[];if(c){for(var b=new Map,g=0;c.next();)switch(c.tag()){case 1:const m=c.getMessage();for(;m.next();)switch(m.tag()){case 3:var k=m.getMessage();let t,q,p,r,B,F,w;for(;k.next();)switch(k.tag()){case 1:t=k.getUInt32();break;case 2:q=k.getBytes();break;case 3:p=k.getUInt32();break;case 4:r=k.getUInt32();break;case 5:B=k.getSInt32();break;case 6:F=k.getSInt32();break;case 7:w=k.getUInt32();break;default:k.skip()}k.release();
t&&(k=q?.length??0,this._metrics[t]={width:p,height:r,left:B,top:F,advance:w,startOffset:g,length:k},b.set(t,q),g+=k);break;default:m.skip()}m.release();break;default:c.skip()}c=new Uint8Array(g);g=this._metrics;for(const [m,t]of b){const {startOffset:q,length:p}=g[m];if(t)for(b=0;b<p;++b)c[q+b]=t[b]}this._allBitmaps=c}else this._allBitmaps=null}getMetrics(c){return this._metrics[c]}getBitmap(c){if(this._allBitmaps&&(c=this._metrics[c],void 0!==c)){var {startOffset:b,length:g}=c;if(0!==g)return new f(this._allBitmaps,
b,g)}}}class d{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(c){return this._ranges[c]}addRange(c,b){this._ranges[c]=b}}class e{constructor(c){this._glyphInfo={};this._baseURL=c}getRange(c,b){const g=this._getFontStack(c);if(g.getRange(b))return Promise.resolve();const k=256*b,m=k+255;if(this._baseURL)return c=this._baseURL.replace("{fontstack}",c).replace("{range}",k+"-"+m),y(c,{responseType:"array-buffer"}).then(t=>{g.addRange(b,new C(new z(new Uint8Array(t.data),new DataView(t.data))))}).catch(()=>
{g.addRange(b,new C)});g.addRange(b,new C);return Promise.resolve()}getGlyph(c,b){if(c=this._getFontStack(c))if(c=c.getRange(Math.floor(b/256)))return{metrics:c.getMetrics(b),bitmap:c.getBitmap(b)}}_getFontStack(c){let b=this._glyphInfo[c];b||=this._glyphInfo[c]=new d;return b}}class f{constructor(c,b,g){this._array=c;this._start=b;this.length=g}at(c){return 0<=c&&c<this.length?this._array[this._start+c]:void 0}}return e})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define("../../../../symbols/cim/rasterizingUtils ./RectangleBinPack ../webgl/Rect ../../../webgl/enums ../../../webgl/Texture ../../../webgl/TextureDescriptor".split(" "),
function(y,z,C,d,e,f){class c{constructor(b,g,k=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=b||0>=g)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=b;this._pageHeight=g;0<k&&(this._maxItemSize=k);this._binPack=new z(b-4,g-4)}destroy(){this.dispose()}dispose(){this._binPack=null;this._mosaicsData.length=
0;this._mosaicRects={};for(const b of this._textures)b&&b.dispose();this._textures.length=0}getWidth(b){return b>=this._size.length?-1:this._size[b][0]}getHeight(b){return b>=this._size.length?-1:this._size[b][1]}getPageSize(b){return b>=this._size.length?null:this._size[b]}setSpriteSource(b){this.dispose();this.pixelRatio=b.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new z(this._pageWidth-4,this._pageHeight-4);const g=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=g;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=b}getSpriteItem(b,g=!1){var k=this._mosaicRects[b];if(k)return k;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let m;b&&b.startsWith("dasharray-")?([k,m]=this._rasterizeDash(b),g=!0):k=this._sprites.getSpriteInfo(b);if(!k?.width||!k.height||0>k.width||0>k.height)return null;const t=k.width,q=k.height,[p,r,B]=this._allocateImage(t,q);if(0>=
p.width)return null;this._copy(p,k,r,B,g,m);k={type:"sprite",rect:p,width:t,height:q,sdf:k.sdf,simplePattern:!1,rasterizationScale:k.pixelRatio,page:r};return this._mosaicRects[b]=k}getSpriteItems(b){const g={};for(const k of b)g[k.name]=this.getSpriteItem(k.name,k.repeat);return g}getMosaicItemPosition(b,g){g=(b=this.getSpriteItem(b,g))&&b.rect;if(!g)return null;g.width=b.width;g.height=b.height;return{tl:[g.x+2,g.y+2],br:[g.x+2+b.width,g.y+2+b.height],page:b.page}}bind(b,g,k=0,m=0){if(!(k>=this._size.length||
k>=this._mosaicsData.length)){if(!this._textures[k]){var t=new f.TextureDescriptor;t.wrapMode=d.TextureWrapMode.CLAMP_TO_EDGE;t.width=this._size[k][0];t.height=this._size[k][1];this._textures[k]=new e.Texture(b,t,new Uint8Array(this._mosaicsData[k].buffer))}t=this._textures[k];t.setSamplingMode(g);this._dirties[k]&&t.setData(new Uint8Array(this._mosaicsData[k].buffer));b.bindTexture(t,m);this._dirties[k]=!1}}static _copyBits(b,g,k,m,t,q,p,r,B,F,w){let D=m*g+k;p=r*q+p;if(w)for(p-=q,w=-1;w<=F;w++,D=
((w+F)%F+m)*g+k,p+=q)for(r=-1;r<=B;r++)t[p+r]=b[D+(r+B)%B];else for(k=0;k<F;k++){for(m=0;m<B;m++)t[p+m]=b[D+m];D+=g;p+=q}}_copy(b,g,k,m,t,q){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(k>=this._mosaicsData.length)){var p=new Uint32Array(q?q.buffer:this._sprites.image.buffer),r=this._mosaicsData[k];r&&p||console.error("Source or target images are uninitialized!");c._copyBits(p,q?g.width:this._sprites.width,g.x,g.y,r,m[0],b.x+2,b.y+2,g.width,g.height,t);this._dirties[k]=!0}}_allocateImage(b,
g){b+=2;g+=2;var k=Math.max(b,g);if(this._maxItemSize&&this._maxItemSize<k)return k=new C(0,0,b,g),this._mosaicsData.push(new Uint32Array(b*g)),this._dirties.push(!0),this._size.push([b,g]),this._textures.push(void 0),[k,this._mosaicsData.length-1,[b,g]];k=b%4?4-b%4:4;let m=g%4?4-g%4:4;1===k&&(k=5);1===m&&(m=5);k=this._binPack.allocate(b+k,g+m);return 0>=k.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*
this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new z(this._pageWidth-4,this._pageHeight-4),this._allocateImage(b,g)):[k,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(b){var g=b.match(/\[(.*?)\]/);if(!g)return null;g=g[1].split(",").map(Number);b=b.slice(b.lastIndexOf("-")+1);const [k,m,t]=y.rasterizeDash(g,b);b=new Uint8Array(k.buffer);return[{x:0,y:0,width:m,height:t,sdf:!0,pixelRatio:1},
b]}}return c})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../geometry/support/aaBoundingRect","../../tiling/TileCoverage","../../tiling/TileKey"],function(y,z,C,d,e){const f=(b,g)=>b+1/(1<<2*g);class c{constructor(b,g){this._tiles=new Map;this._tileCache=new z.LRUCache(40,k=>k.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=b.acquireTile;this.releaseTile=b.releaseTile;this.tileInfoView=b.tileInfoView;
this._container=g}destroy(){for(const [,b]of this._tiles)b.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null}update(b){this._updateCacheSize(b);const g=this.tileInfoView;b=g.getTileCoverage(b.state,0,!0,"smallest");if(!b)return!0;const {spans:k,lodInfo:m}=b,{level:t}=m,q=this._tiles,p=new Set,r=new Set;for(const {row:F,colFrom:w,colTo:D}of k)for(let E=w;E<=D;E++){const H=e.getId(t,F,m.normalizeCol(E),m.getWorldForColumn(E)),K=this._getOrAcquireTile(H);p.add(H);K.processed()?
this._addToContainer(K):r.add(new e(H))}for(const [F,w]of q)w.isCoverage=p.has(F);for(var B of r)this._findPlaceholdersForMissingTiles(B,p);B=!1;for(const [F,w]of q)w.neededForCoverage=p.has(F),w.neededForCoverage||w.isHoldingForFade&&g.intersects(b,w.key)&&p.add(F),w.isFading&&(B=!0);for(const [F]of this._tiles)p.has(F)||this._releaseTile(F);d.pool.release(b);return!B}clear(){this._tiles.clear();this._tileCache.clear();this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(b,
g,k,m,t){const q=[0,0],p=[0,0];m.toMap(q,b-k,g+k);m.toMap(p,b+k,g-k);g=C.fromValues(Math.min(q[0],p[0]),Math.min(q[1],p[1]),Math.max(q[0],p[0]),Math.max(q[1],p[1]));k=C.create();b=[];for(const [,r]of this._visibleTiles)this.tileInfoView.getTileBounds(k,r.key),C.intersects(g,k)&&b.push(r);if(null!=t&&0<t.length){const r=new Set(b.map(B=>B.id));t=t.filter(B=>!r.has(B.tileKey.id)).map(B=>this._visibleTiles.get(B.tileKey.id)).filter(B=>void 0!==B);b.push(...t)}return b}_findPlaceholdersForMissingTiles(b,
g){var k=[];for(const [,m]of this._tiles)this._addPlaceholderChild(k,m,b,g);k=k.reduce(f,0);1E-6>Math.abs(1-k)||this._addPlaceholderParent(b.id,g)}_addPlaceholderChild(b,g,k,m){if(!(g.key.level<=k.level)&&g.hasData()){var t=g.key,q=t.level-k.level;k.row===t.row>>q&&k.col===t.col>>q&&k.world===t.world&&(this._addToContainer(g),m.add(g.id),b.push(g.key.level-k.level))}}_addPlaceholderParent(b,g){const k=this._tiles;for(;;){{const [t,q,p,r]=b.split("/");b=parseInt(t,10);b=0===b?null:`${b-1}/${parseInt(q,
10)>>1}/${parseInt(p,10)>>1}/${parseInt(r,10)}`}if(!b||g.has(b))break;const m=k.get(b);if(m&&m.hasData()){this._addToContainer(m);g.add(m.id);break}}}_getOrAcquireTile(b){let g=this._tiles.get(b);if(g)return g;(g=this._tileCache.pop(b))||(g=this.acquireTile(new e(b)));this._tiles.set(b,g);return g}_releaseTile(b){const g=this._tiles.get(b);this.releaseTile(g);this._removeFromContainer(g);this._tiles.delete(b);g.hasData()?this._tileCache.put(b,g,1):g.dispose()}_addToContainer(b){let g;const k=[],m=
this._container;if(!m.contains(b)){var t=this._visibleTiles;for(const [,q]of t)this._canConnectDirectly(b,q)&&k.push(q),null==g&&this._canConnectDirectly(q,b)&&(g=q);if(null!=g){for(const q of k)g.childrenTiles.delete(q),b.childrenTiles.add(q),q.parentTile=b;g.childrenTiles.add(b);b.parentTile=g}else for(const q of k)b.childrenTiles.add(q),q.parentTile=b;t.set(b.id,b);m.addChild(b)}}_removeFromContainer(b){this._visibleTiles.delete(b.id);this._container.removeChild(b);if(null!=b.parentTile){b.parentTile.childrenTiles.delete(b);
for(const g of b.childrenTiles)null!=b.parentTile&&b.parentTile.childrenTiles.add(g)}for(const g of b.childrenTiles)g.parentTile=b.parentTile;b.parentTile=null;b.childrenTiles.clear()}_canConnectDirectly(b,g){b=b.key;let {level:k,row:m,col:t,world:q}=g.key;for(g=this._visibleTiles;0<k;){k--;m>>=1;t>>=1;if(b.level===k&&b.row===m&&b.col===t&&b.world===q)return!0;if(g.has(`${k}/${m}/${t}/${q}`))break}return!1}_updateCacheSize(b){b=b.state.size;if(b[0]!==this._viewSize[0]||b[1]!==this._viewSize[1]){var g=
Math.ceil(b[0]/512)+1,k=Math.ceil(b[1]/512)+1;this._viewSize[0]=b[0];this._viewSize[1]=b[1];this._tileCache.maxSize=5*g*k}}}y.TileManager=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../core/has ../../../../core/libs/gl-matrix-2/math/mat3 ../../../../core/libs/gl-matrix-2/factories/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(y,z,C,d,e,f,c,
b){class g extends b.TiledDisplayObject{constructor(m,t,q,p,r,B,F,w=null){super(m,t,q,p,r,B,4096,4096);this.styleRepository=F;this._memCache=w;this.type="vector-tile";this._referenced=0;this._hasSymbolBuckets=!1;this._memoryUsedByLayerData=0;this.layerData=new Map;this.status="loading";this.allSymbolsFadingOut=!1;this.lastOpacityUpdate=0;this.symbols=new Map;this.decluttered=this.neededForCoverage=this.isCoverage=!1;this.parentTile=null;this.childrenTiles=new Set;this.featureIndex=null;this.triangleCount=
0;this._processed=!1;this._referenced=1;this.id=m.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<c.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(m){this.changeDataImpl(m);this.requestRender();
this.ready();this._processed=!0}deleteLayerData(m){let t=!1;for(const q of m)if(m=this.layerData.get(q))this._memoryUsedByLayerData-=m.memoryUsed,m.type===e.BucketType.SYMBOL&&this.symbols.delete(q)&&(t=!0),m.destroy(),this.layerData.delete(q);this._memCache?.updateSize(this.key.id,this,this._memoryUsedByLayerData);t&&(this.featureIndex?.clear(),this.emit("symbols-changed"));this.requestRender()}processed(){return this._processed}hasData(){return 0<this.layerData.size}dispose(){"unloaded"!==this.status&&
(this.featureIndex=null,k.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(m){this.featureIndex?.clear();let t=!1;if(m){const {bucketsWithData:q,emptyBuckets:p}=m;m=this._createRenderBuckets(q);
if(p&&0<p.byteLength){const r=new Uint32Array(p);for(const B of r)this._deleteLayerData(B)}for(const [r,B]of m)this._deleteLayerData(r),B.type===e.BucketType.SYMBOL&&(this.symbols.set(r,B.symbols),t=!0),this._memoryUsedByLayerData+=B.memoryUsed,this.layerData.set(r,B);this._memCache?.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const [,q]of this.layerData)q.type===e.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(m){this.stage=
{context:m,trashDisplayObject(t){t.processDetach()},untrashDisplayObject(){return!1}}}setTransform(m){super.setTransform(m);var t=this.resolution/(m.resolution*m.pixelRatio);const q=this.width/this.rangeX*t;t*=this.height/this.rangeY;const p=[0,0];m.toScreen(p,[this.x,this.y]);const r=this.transforms.tileUnitsToPixels;C.identity(r);C.translate(r,r,p);C.rotate(r,r,Math.PI*m.rotation/180);C.scale(r,r,[q,t,1])}_createTransforms(){return{displayViewScreenMat3:d.create(),tileMat3:d.create(),tileUnitsToPixels:d.create()}}static _destroyRenderBuckets(m){if(m){var t=
new Set;for(const q of m.values())t.has(q)||(q.destroy(),t.add(q));m.clear()}}_createRenderBuckets(m){const t=new Map,q=new Map;for(const p of m){m=this._deserializeBucket(p,q);for(const r of m.layerUIDs)t.set(r,m)}return t}_deserializeBucket(m,t){let q=t.get(m);if(q)return q;switch((new Uint32Array(m))[0]){case e.BucketType.FILL:q=new f.FillRenderBucket(m,this.styleRepository);break;case e.BucketType.LINE:q=new f.LineRenderBucket(m,this.styleRepository);break;case e.BucketType.SYMBOL:q=new f.SymbolRenderBucket(m,
this.styleRepository,this);break;case e.BucketType.CIRCLE:q=new f.CircleRenderBucket(m,this.styleRepository)}t.set(m,q);return q}_deleteLayerData(m){if(this.layerData.has(m)){var t=this.layerData.get(m);this._memoryUsedByLayerData-=t.memoryUsed;t.destroy();this.layerData.delete(m)}}}const k=new Map;y.VectorTile=g;y.printAllocations=function(){k.forEach((m,t)=>{console.log(`\n${t.key}:`);m[0].forEach(q=>console.log(q));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");m[1].forEach(q=>console.log(q))})};
Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../core/maybe ../../../../core/typedArrayUtil ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(y,z,C,d,e,f,c,b,g,k,m,t){class q{constructor(w,D){this.layerUIDs=[];this.isDestroyed=
!1;this._data=w;let E=1;w=new Uint32Array(w);this.layerUIDs=[];const H=w[E++];for(let K=0;K<H;K++)this.layerUIDs[K]=w[E++];this.bufferDataOffset=E;D&&(this.layer=D.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(w){null!=this._data&&(this.doPrepareForRendering(w,this._data,this.bufferDataOffset),
this._data=null)}}class p extends q{constructor(w,D){super(w,D);this.type=b.BucketType.LINE;this.lineIndexCount=this.lineIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.lineIndexStart=w[D++];this.lineIndexCount=w[D++];const E=w[D++];if(0<E){this.patternMap=new Map;for(let H=0;H<E;H++){const K=w[D++],O=w[D++],h=w[D++];this.patternMap.set(K,[O,h])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.lineIndexCount}triangleCount(){return this.lineIndexCount/
3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D);D=new Int32Array(H.buffer);var K=H[E++];D=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,K));E+=K;K=H[E++];H=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,K));E+=K;E=this.layer.lineMaterial;this.vao=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},H)}}class r extends q{constructor(w,D){super(w,D);this.type=
b.BucketType.FILL;this.outlineIndexCount=this.outlineIndexStart=this.fillIndexCount=this.fillIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.fillIndexStart=w[D++];this.fillIndexCount=w[D++];this.outlineIndexStart=w[D++];this.outlineIndexCount=w[D++];const E=w[D++];if(0<E){this.patternMap=new Map;for(let H=0;H<E;H++){const K=w[D++],O=w[D++],h=w[D++];this.patternMap.set(K,[O,h])}}this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.fillVAO?.usedMemory??0)+(this.outlineVAO?.usedMemory??
0)}hasData(){return 0<this.fillIndexCount||0<this.outlineIndexCount}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=z.disposeMaybe(this.fillVAO);this.outlineVAO=z.disposeMaybe(this.outlineVAO)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D),K=new Int32Array(H.buffer),O=H[E++];D=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,new Int32Array(K.buffer,4*E,O));E+=O;var h=H[E++];O=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,
4*E,h));E+=h;h=H[E++];K=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,new Int32Array(K.buffer,4*E,h));E+=h;h=H[E++];H=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));E+=h;h=this.layer;E=h.fillMaterial;h=h.outlineMaterial;this.fillVAO=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},O);this.outlineVAO=new t.VertexArrayObject(w,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:K},H)}}class B extends q{constructor(w,D,E){super(w,
D);this.type=b.BucketType.SYMBOL;this.iconPerPageElementsMap=new Map;this.glyphPerPageElementsMap=new Map;this.symbolInstances=[];this.opacityChanged=this.isIconSDF=!1;this.lastOpacityUpdate=0;this.symbols=[];D=new Uint32Array(w);const H=new Int32Array(w);w=new Float32Array(w);let K=this.bufferDataOffset;this.isIconSDF=!!D[K++];var O=D[K++],h=D[K++],n=D[K++];O=new e(O,h,n,0);h=D[K++];for(n=0;n<h;n++){var l=D[K++],u=D[K++],A=D[K++];this.iconPerPageElementsMap.set(l,[u,A])}h=D[K++];for(n=0;n<h;n++)l=
D[K++],u=D[K++],A=D[K++],this.glyphPerPageElementsMap.set(l,[u,A]);h=D[K++];n=D[K++];this.iconOpacity=new Int32Array(h);this.textOpacity=new Int32Array(n);this.bufferDataOffset=K=g.deserializeSymbols(D,H,w,K,this.symbols,E,O)}get memoryUsed(){return(this.data?.byteLength??0)+(this.iconVAO?.usedMemory??0)+(this.textVAO?.usedMemory??0)+C.estimateSize(this.iconOpacity)+C.estimateSize(this.textOpacity)}hasData(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size}triangleCount(){let w=
0;for(const [,D]of this.iconPerPageElementsMap)w+=D[1];for(const [,D]of this.glyphPerPageElementsMap)w+=D[1];return w/3}doDestroy(){this.iconVAO=z.disposeMaybe(this.iconVAO);this.textVAO=z.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var w=this.iconOpacity,D=this.iconVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===D.usedMemory&&D.setSubData(w,0,0,w.length);w=this.textOpacity;D=this.textVAO.vertexBuffers.opacity;0<w.length&&w.byteLength===D.usedMemory&&
D.setSubData(w,0,0,w.length)}}doPrepareForRendering(w,D,E){var H=new Uint32Array(D),K=new Int32Array(H.buffer),O=H[E++];D=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,new Int32Array(K.buffer,4*E,O));E+=O;var h=H[E++];O=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));E+=h;h=H[E++];K=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,new Int32Array(K.buffer,4*E,h));E+=h;h=H[E++];H=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,h));
E+=h;E=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,this.iconOpacity.buffer);h=k.BufferObject.createVertex(w,m.Usage.STATIC_DRAW,this.textOpacity.buffer);var n=this.layer;const l=n.iconMaterial;n=n.textMaterial;this.iconVAO=new t.VertexArrayObject(w,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:D,opacity:E},O);this.textVAO=new t.VertexArrayObject(w,n.getAttributeLocations(),n.getLayoutInfo(),{geometry:K,opacity:h},H)}}class F extends q{constructor(w,D){super(w,D);this.type=b.BucketType.CIRCLE;
this.circleIndexCount=this.circleIndexStart=0;w=new Uint32Array(w);D=this.bufferDataOffset;this.circleIndexStart=w[D++];this.circleIndexCount=w[D++];this.bufferDataOffset=D}get memoryUsed(){return(this.data?.byteLength??0)+(this.vao?.usedMemory??0)}hasData(){return 0<this.circleIndexCount}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=z.disposeMaybe(this.vao)}doPrepareForRendering(w,D,E){var H=new Uint32Array(D);D=new Int32Array(H.buffer);var K=H[E++];D=k.BufferObject.createVertex(w,
m.Usage.STATIC_DRAW,new Int32Array(D.buffer,4*E,K));E+=K;K=H[E++];H=k.BufferObject.createIndex(w,m.Usage.STATIC_DRAW,new Uint32Array(H.buffer,4*E,K));E+=K;E=this.layer.circleMaterial;this.vao=new t.VertexArrayObject(w,E.getAttributeLocations(),E.getLayoutInfo(),{geometry:D},H)}}y.CircleRenderBucket=F;y.FillRenderBucket=r;y.LineRenderBucket=p;y.RenderBucketBase=q;y.SymbolRenderBucket=B;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports",
"../enums","../GeometryUtils","./core"],function(y,z,C,d){class e{constructor(f,c,b){this._rows=Math.ceil(c/b);this._columns=Math.ceil(f/b);this._cellSize=b;this.cells=Array(this._rows);for(f=0;f<this._rows;f++)for(this.cells[f]=Array(this._columns),c=0;c<this._columns;c++)this.cells[f][c]=[]}getCell(f,c){c=Math.min(Math.max(Math.floor(c/this._cellSize),0),this._rows-1);f=Math.min(Math.max(Math.floor(f/this._cellSize),0),this._columns-1);return this.cells[c]&&this.cells[c][f]||null}getCellSpan(f,
c,b,g){return[Math.min(Math.max(Math.floor(f/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(c/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(b/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}y.GridIndex=e;y.deserializeSymbols=function(f,c,b,g,k,m,t){const q=c[g++];for(let B=0;B<q;B++){const F=new d.VTLSymbol(m,t);F.xTile=
c[g++];F.yTile=c[g++];F.hash=c[g++];F.priority=c[g++];F.featureIndex=c[g++];var p=c[g++];for(var r=0;r<p;r++){const w=c[g++],D=c[g++],E=c[g++],H=c[g++],K=!!c[g++],O=c[g++],h=b[g++],n=b[g++],l=c[g++],u=c[g++];F.colliders.push({xTile:w,yTile:D,dxPixels:E,dyPixels:H,hard:K,partIndex:O,width:l,height:u,minLod:h,maxLod:n})}p=f[g++];for(r=0;r<p;r++)F.textVertexRanges.push([f[g++],f[g++]]);p=f[g++];for(r=0;r<p;r++)F.iconVertexRanges.push([f[g++],f[g++]]);k.push(F)}return g};y.isSearchCircleOverlapingSymbol=
function(f,c,b,g){var k=f.colliders;let m,t,q;for(const p of k)if(f.unique.show&&f.unique.parts[p.partIndex].show&&(k=p.xScreen-g[0]+p.dxScreen,m=p.yScreen-g[1]+p.dyScreen,t=k+p.width,q=m+p.height,C.isCircleOverlapingRect(b,c.x,c.y,k,m,t,q)))return!0;return!1};y.tileCoordChange=function(f,c,b,g,k,m){b-=k;if(0<=b)return(c>>b)+(g-(m<<b))*(f>>b);b=-b;return c-(m-(g<<b))*(f>>b)<<b};y.writeOpacityToBuffers=function(f,c,b){for(const [r,B]of f.symbols){{var g=f,k=c,m=b,t=B;const F=g.layerData.get(r);if(F.type===
z.BucketType.SYMBOL){for(const w of t){t=w.unique;var q=void 0;if(w.selectedForRendering){var p=t.parts[0];q=p.startOpacity;p=p.targetOpacity;g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===p;q=m?Math.floor(127*q)|p<<7:p?255:0;q|=q<<24|q<<16|q<<8}else q=0;for(const [D,E]of w.iconVertexRanges)for(p=D;p<D+E;p+=4)F.iconOpacity[p/4]=q;w.selectedForRendering?(q=t.parts[1],t=q.startOpacity,q=q.targetOpacity,g.allSymbolsFadingOut=g.allSymbolsFadingOut&&0===q,t=m?Math.floor(127*t)|q<<7:q?255:0,q=t<<24|t<<
16|t<<8|t):q=0;for(const [D,E]of w.textVertexRanges)for(t=D;t<D+E;t+=4)F.textOpacity[t/4]=q}F.lastOpacityUpdate=k;F.opacityChanged=!0}}}};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(y){class z{constructor(d,e){this.sourceTile=e;this.hash=this.yTile=this.xTile=0;this.priority=1;this.featureIndex=0;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=d}}class C{constructor(){this.tileSymbols=
[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1}}y.VTLSymbol=z;y.VTLUniqueSymbol=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../geometry/support/aaBoundingRect ../../../../layers/support/TileInfo ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(y,z,C,d,e,f,c,b,g,k,m){function t(p,r){if(p){const B=p.getLayoutProperty("visibility");if(!B||B.getValue()!==e.Visibility.NONE&&(void 0===p.minzoom||p.minzoom<r+1E-6)&&(void 0===p.maxzoom||p.maxzoom>=r-1E-6))return!0}return!1}class q extends b{constructor(p){super(p);this._backgroundTiles=[];this._computeDisplayInfoView(p)}destroy(){this.removeAllChildren();this._spriteMosaic?.dispose();this._spriteMosaic=null;this._glyphMosaic?.dispose();this._glyphMosaic=null;null!=this._symbolFader&&(this._symbolFader.clear(),
this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(p,r,B,F){this._spriteMosaic=p;this._glyphMosaic=r;this._styleRepository=B;this._tileInfoView=F;this._computeDisplayInfoView(F);null==this._symbolFader&&(this._symbolFader=new d.SymbolFader(this._styleRepository,this.children));this._symbolFader.styleRepository=
B}setSpriteMosaic(p){this._spriteMosaic?.dispose();this._spriteMosaic=p}deleteStyleLayers(p){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(p)}createRenderParams(p){return{...super.createRenderParams(p),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(p){!this.visible||p.drawPhase!==f.WGLDrawPhase.MAP&&p.drawPhase!==f.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||super.doRender(p)}addChild(p){super.addChild(p);
null!=this._symbolFader?this._symbolFader.addTile(p):p.decluttered=!0;this.requestRender();return p}removeChild(p){null!=this._symbolFader&&this._symbolFader.removeTile(p);this.requestRender();return super.removeChild(p)}renderChildren(p){const {drawPhase:r}=p;r===f.WGLDrawPhase.DEBUG?super.renderChildren(p):this._doRender(p)}removeAllChildren(){for(let p=0;p<this.children.length;p++){const r=this.children[p];null!=this._symbolFader&&this._symbolFader.removeTile(r);r.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(p=>
p.neededForCoverage&&p.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(p){const {context:r,state:B}=p;var F=this._styleRepository;if(F){var w=F.layers,D=this._displayInfo.scaleToZoom(B.scale);0<F.backgroundBucketIds.length&&(p.renderPass="background",this._renderBackgroundLayers(p,F.backgroundBucketIds,D));super.renderChildren(p);p.drawPhase===f.WGLDrawPhase.MAP&&this._fade(D,B);if((F=this.children.filter(H=>H.visible&&H.hasData()))&&0!==F.length){for(var E of F)E.triangleCount=
0;r.setStencilWriteMask(0);r.setColorMask(!0,!0,!0,!0);r.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE);r.setStencilTestEnabled(!0);r.setBlendingEnabled(!1);r.setDepthTestEnabled(!0);r.setDepthWriteEnabled(!0);r.setDepthFunction(m.CompareFunction.LEQUAL);r.setClearDepth(1);r.clear(r.gl.DEPTH_BUFFER_BIT);p.renderPass="opaque";for(E=w.length-1;0<=E;E--)this._renderStyleLayer(w[E],p,F);r.setDepthWriteEnabled(!1);r.setBlendingEnabled(!0);r.setBlendFunctionSeparate(m.BlendFactor.ONE,
m.BlendFactor.ONE_MINUS_SRC_ALPHA,m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA);p.renderPass="translucent";for(E=0;E<w.length;E++)this._renderStyleLayer(w[E],p,F);r.bindVAO();r.setStencilTestEnabled(!0);r.setBlendingEnabled(!0);for(const H of F)H.debugInfo.display.triangleCount=H.triangleCount}else r.bindVAO(),r.setStencilTestEnabled(!0),r.setBlendingEnabled(!0)}}_fade(p,r){null!=this._symbolFader&&(this._symbolFader.update(p,r)||this.requestRender())}_renderStyleLayer(p,r,B){const {displayLevel:F,
painter:w,renderPass:D}=r;if(void 0!==p){var E=p.getLayoutProperty("visibility");if(!E||E.getValue()!==e.Visibility.NONE){switch(p.type){case e.StyleLayerType.BACKGROUND:return;case e.StyleLayerType.FILL:if("opaque"!==D&&"translucent"!==r.renderPass)return;var H="vtlFill";break;case e.StyleLayerType.LINE:if("translucent"!==D)return;H="vtlLine";break;case e.StyleLayerType.CIRCLE:if("translucent"!==D)return;H="vtlCircle";break;case e.StyleLayerType.SYMBOL:if("translucent"!==D)return;H="vtlSymbol"}B=
p.type===e.StyleLayerType.SYMBOL?B.filter(K=>K.decluttered):B.filter(K=>K.neededForCoverage);if("vtlSymbol"===H||!(0===B.length||void 0!==p.minzoom&&p.minzoom>=F+1E-6||void 0!==p.maxzoom&&p.maxzoom<F-1E-6)){E=p.uid;r.styleLayerUID=E;r.styleLayer=p;for(const K of B)if(K.layerData.has(E)){w.renderObjects(r,B,H);break}}}}}_renderBackgroundLayers(p,r,B){const {context:F,painter:w,state:D}=p,E=this._styleRepository;var H=!1;for(var K of r)if(E.getLayerById(K).type===e.StyleLayerType.BACKGROUND&&t(E.getLayerById(K),
B)){H=!0;break}if(H){var O=this._tileInfoView;H=O.getTileCoverage(p.state,0,!0,"smallest");var {spans:h,lodInfo:n}=H,{level:l}=n,u=z.create();K=[];if(this._renderPasses){var A=this._renderPasses[0];null!=this._clippingInfos&&(A.brushes[0].prepareState(p),A.brushes[0].drawMany(p,this._clippingInfos))}A=this._backgroundTiles;var I=0;for(const {row:M,colFrom:L,colTo:Q}of h)for(let R=L;R<=Q;R++){if(I<A.length){var J=A[I];J.key.set(l,M,n.normalizeCol(R),n.getWorldForColumn(R));O.getTileBounds(u,J.key,
!1);J.x=u[0];J.y=u[3];J.resolution=O.getTileResolution(l)}else{J=new k(l,M,n.normalizeCol(R),n.getWorldForColumn(R));const V=O.getTileBounds(z.create(),J),Y=O.getTileResolution(l);J=new c.RenderableTile(J,Y,V[0],V[3],512,512,4096,4096);A.push(J)}J.setTransform(D);K.push(J);I++}F.setStencilWriteMask(0);F.setColorMask(!0,!0,!0,!0);F.setStencilOp(m.StencilOperation.KEEP,m.StencilOperation.KEEP,m.StencilOperation.REPLACE);F.setStencilFunction(m.CompareFunction.EQUAL,0,255);F.setStencilTestEnabled(!0);
for(const M of r)r=E.getLayerById(M),r.type===e.StyleLayerType.BACKGROUND&&t(r,B)&&(p.styleLayerUID=r.uid,p.styleLayer=r,w.renderObjects(p,K,"vtlBackground"));g.pool.release(H)}}_computeDisplayInfoView(p){let r=p.tileInfo.lods[0].scale;const B=Math.max(25,p.tileInfo.lods.length),F=[];for(let w=0;w<=B;w++)F.push(r),r/=2;this._displayInfo=C.create({scales:F,size:512,spatialReference:p.spatialReference,numLODs:B})}}y.VectorTileContainer=q;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../core/signal ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),function(y,z,C,d,e,f,c,b,g){class k{constructor(m,t){this.styleRepository=m;this._tileToHandle=new Map;this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};this._offsetFromScreenCenter=[0,0];this._completed=
!1;this._fading=z.signal(!1);this._symbolRepository=new c.SymbolRepository(4096,t,()=>new d.VTLUniqueSymbol);this._symbolDeclutterer=new f.SymbolDeclutterer(t,this._symbolRepository,(q,p,r)=>this._createCollisionJob(q,p,r),(q,p)=>{q.allSymbolsFadingOut=!0;q.lastOpacityUpdate=p;b.writeOpacityToBuffers(q,p,!0);q.decluttered=!0;q.requestRender()},(q,p)=>this.styleRepository.getStyleLayerByUID(q.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(p.styleLayerUID).z,q=>{q=this.styleRepository.getStyleLayerByUID(q);
return this._zoom+1E-6<q.minzoom||this._zoom-1E-6>=q.maxzoom?!1:(q=q.getLayoutProperty("visibility"))&&q.getValue()===g.Visibility.NONE?!1:!0})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(m,t,q){this.updateDecluttererViewState();return new e.CollisionJob(m,t,q,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}addTile(m){m.decluttered=!1;this._tileToHandle.set(m,m.on("symbols-changed",
()=>{this._symbolRepository.add(m);this.restartDeclutter()}));this._symbolRepository.add(m);this.restartDeclutter()}removeTile(m){const t=this._tileToHandle.get(m);t&&(this._symbolRepository.removeTile(m),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(m))}update(m,t){this._zoom=m;this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};m=[0,0];t.toScreen(m,t.center);const q=[0,0];t.toScreen(q,this._declutterViewState.center);this._offsetFromScreenCenter[0]=
m[0]-q[0];this._offsetFromScreenCenter[1]=m[1]-q[1];this._continueDeclutter();return this._completed}restartDeclutter(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()}clear(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(m=>m.remove());this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||
this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(m){this._symbolRepository.deleteStyleLayers(m)}_continueDeclutter(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(C.declutterBudget))&&this._scheduleNotifyStable()}_scheduleNotifyStable(){null!=
this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this._fading.value=!1},1.5*C.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom;this._declutterViewState.center[0]=this._viewState.center[0];this._declutterViewState.center[1]=
this._viewState.center[1];this._declutterViewState.rotation=this._viewState.rotation;this._declutterViewState.scale=this._viewState.scale;this._declutterViewState.size[0]=this._viewState.size[0];this._declutterViewState.size[1]=this._viewState.size[1];this._offsetFromScreenCenter[0]=0;this._offsetFromScreenCenter[1]=0}}y.SymbolFader=k;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32",
"./config","./util","../style/StyleDefinition"],function(y,z,C,d,e){class f{constructor(c,b,g,k,m,t){this._symbols=c;this._styleRepository=k;this._zoom=m;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new d.GridIndex(b,g,C.collisionGridCellSize);this._si=Math.sin(Math.PI*t/180);this._co=Math.cos(Math.PI*t/180);for(const q of c)for(const p of q.symbols)this._allNeededMatrices.has(p.tile)||this._allNeededMatrices.set(p.tile,
z.clone(p.tile.transforms.tileUnitsToPixels))}work(c){const b=this._gridIndex,g=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const E=this._symbols[this._currentLayerCursor],H=this._getProperties(E.styleLayerUID);for(;this._currentSymbolCursor<E.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-g>c)return!1;var k=E.symbols[this._currentSymbolCursor];if(!k.unique.show)continue;
var m=k,t=this._si,q=this._co,p=this._allNeededMatrices.get(k.tile),r=this._zoom;const {iconRotationAlignment:K,textRotationAlignment:O,iconTranslate:h,iconTranslateAnchor:n,textTranslate:l,textTranslateAnchor:u}=H;var B=0;for(const L of m.colliders){const [Q,R]=0===L.partIndex?h:l;var F=0===L.partIndex?n:u,w=L.minLod<=r&&r<=L.maxLod;B+=w?0:1;L.enabled=w;L.xScreen=L.xTile*p[0]+L.yTile*p[3]+p[6];L.yScreen=L.xTile*p[1]+L.yTile*p[4]+p[7];F===e.TranslateAnchor.MAP?(L.xScreen+=q*Q-t*R,L.yScreen+=t*Q+q*
R):(L.xScreen+=Q,L.yScreen+=R);e.RotationAlignment.VIEWPORT===(0===L.partIndex?K:O)?(L.dxScreen=L.dxPixels,L.dyScreen=L.dyPixels):(L.dxScreen=q*(L.dxPixels+L.width/2)-t*(L.dyPixels+L.height/2)-L.width/2,L.dyScreen=t*(L.dxPixels+L.width/2)+q*(L.dyPixels+L.height/2)-L.height/2)}0<m.colliders.length&&B===m.colliders.length&&(m.unique.show=!1);m=k.unique;if(!m.show)continue;const {iconAllowOverlap:A,iconIgnorePlacement:I,textAllowOverlap:J,textIgnorePlacement:M}=H;for(const L of k.colliders)if(L.enabled&&
(t=m.parts[L.partIndex],t.show)){if(q=!(L.partIndex?J:A))a:{q=L.xScreen+L.dxScreen;p=L.yScreen+L.dyScreen;r=q+L.width;B=p+L.height;const [Q,R,V,Y]=b.getCellSpan(q,p,r,B);for(F=R;F<=Y;F++)for(w=Q;w<=V;w++){var D=b.cells[F][w];for(const Z of D){D=Z.xScreen+Z.dxScreen;const ba=Z.yScreen+Z.dyScreen,ea=D+Z.width,W=ba+Z.height;if(!(r<D||q>ea||B<ba||p>W)){q=!0;break a}}}q=!1}q&&(L.hard?m.show=!1:t.show=!1)}if(m.show)for(const L of k.colliders){if(!L.enabled)continue;if(L.partIndex?M:I)continue;if(!m.parts[L.partIndex].show)continue;
k=L.xScreen+L.dxScreen;t=L.yScreen+L.dyScreen;const [Q,R,V,Y]=this._gridIndex.getCellSpan(k,t,k+L.width,t+L.height);for(k=R;k<=Y;k++)for(t=Q;t<=V;t++)this._gridIndex.cells[k][t].push(L)}}}return!0}_getProperties(c){var b=this._styleProps.get(c);if(b)return b;b=this._zoom;const g=this._styleRepository.getStyleLayerByUID(c);var k=g.getLayoutValue("symbol-placement",b)!==e.SymbolPlacement.POINT;let m=g.getLayoutValue("icon-rotation-alignment",b);m===e.RotationAlignment.AUTO&&(m=k?e.RotationAlignment.MAP:
e.RotationAlignment.VIEWPORT);let t=g.getLayoutValue("text-rotation-alignment",b);t===e.RotationAlignment.AUTO&&(t=k?e.RotationAlignment.MAP:e.RotationAlignment.VIEWPORT);k=g.getPaintValue("icon-translate",b);const q=g.getPaintValue("icon-translate-anchor",b),p=g.getPaintValue("text-translate",b),r=g.getPaintValue("text-translate-anchor",b);b={iconAllowOverlap:g.getLayoutValue("icon-allow-overlap",b),iconIgnorePlacement:g.getLayoutValue("icon-ignore-placement",b),textAllowOverlap:g.getLayoutValue("text-allow-overlap",
b),textIgnorePlacement:g.getLayoutValue("text-ignore-placement",b),iconRotationAlignment:m,textRotationAlignment:t,iconTranslateAnchor:q,iconTranslate:k,textTranslateAnchor:r,textTranslate:p};this._styleProps.set(c,b);return b}}y.CollisionJob=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","./config"],function(y,z){function C(e,f){if(e.priority-f.priority)return e.priority-f.priority;const c=
e.tile.key,b=f.tile.key;return c.world-b.world?c.world-b.world:c.level-b.level?c.level-b.level:c.row-b.row?c.row-b.row:c.col-b.col?c.col-b.col:e.xTile-f.xTile?e.xTile-f.xTile:e.yTile-f.yTile}class d{get running(){return this._running}constructor(e,f,c,b,g,k){this._visibleTiles=e;this._symbolRepository=f;this._createCollisionJob=c;this._assignTileSymbolsOpacity=b;this._symbolLayerSorter=g;this._isLayerVisible=k;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=
!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}setScreenSize(e,f){this._screenWidth===e&&this._screenHeight===f||this.restart();this._screenWidth=e;this._screenHeight=f}restart(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}continue(e){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var f=performance.now();
if(!this._selectionJob.work(e))return!1;this._selectionJobCompleted=!0;e=Math.max(0,e-(performance.now()-f));if(0===e)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){f=performance.now();if(!this._collisionJob.work(e))return!1;this._collisionJobCompleted=!0;e=Math.max(0,e-(performance.now()-f));if(0===e)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());
if(!this._opacityJobCompleted){f=performance.now();if(!this._opacityJob.work(e))return!1;this._opacityJobCompleted=!0;e=Math.max(0,e-(performance.now()-f));if(0===e)return!1}this._running=!1;return!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let m=0;m<e.length;m++){const t=e[m];for(let q=0;q<t.uniqueSymbols.length;q++){const p=t.uniqueSymbols[q];for(const r of p.tileSymbols)r.selectedForRendering=!1}}const f=[];let c=0,b=0;const g=this._isLayerVisible,k=this._symbolLayerSorter;
return{work:function(m){const t=performance.now();for(;b<e.length;b++,c=0){const p=e[b];var q=p.styleLayerUID;if(!g(q)){f[b]||(f[b]={styleLayerUID:q,symbols:[]});continue}f[b]=f[b]||{styleLayerUID:q,symbols:[]};const r=f[b];for(;c<p.uniqueSymbols.length;c++){q=p.uniqueSymbols[c];if(99===c%100&&performance.now()-t>m)return!1;let B=null,F=!1,w=!1;for(const D of q.tileSymbols)if(!w||!F){const E=D.tile;if(!B||E.isCoverage||E.neededForCoverage&&!F){B=D;if(E.neededForCoverage||E.isCoverage)w=!0;E.isCoverage&&
(F=!0)}}B.selectedForRendering=!0;if(w){r.symbols.push(B);q.show=!0;for(const D of q.parts)D.show=!0}else q.show=!1}}for(const p of f)p.symbols.sort(C);return!0},get sortedSymbols(){return f.sort(k)}}}_createOpacityJob(){function e(g,k){var m=g.symbols;for(const [,q]of m){var t=q;m=k;for(const p of t){t=p.unique;for(const r of t.parts)r.startOpacity+=(m-r.startTime)/z.fadeDuration*(.5<r.targetOpacity?1:-1),r.startOpacity=Math.min(Math.max(r.startOpacity,0),1),r.startTime=m,r.targetOpacity=t.show&&
r.show?1:0}}f(g,k);for(const q of g.childrenTiles)e(q,k)}const f=this._assignTileSymbolsOpacity,c=this._visibleTiles;let b=0;return{work(g){const k=performance.now();for(;b<c.length;b++){if(performance.now()-k>g)return!1;const m=c[b];if(null!=m.parentTile)continue;const t=performance.now();e(m,t)}return!0}}}}y.SymbolDeclutterer=d;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./util"],function(y,
z){class C{constructor(d,e,f){this.tileCoordRange=d;this._visibleTiles=e;this._createUnique=f;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(d,e){this._uniqueSymbolLayerArray=null;let f=this._tiles.get(d.id);f||(f={symbols:new Map},this._tiles.set(d.id,f));var c=
new Map;if(e)for(var b of e)f.symbols.has(b)&&(c.set(b,f.symbols.get(b)),f.symbols.delete(b));else for(var [g]of d.layerData)f.symbols.has(g)&&(c.set(g,f.symbols.get(g)),f.symbols.delete(g));this._removeSymbols(c);e=d.symbols;c=new Map;for(const [k,m]of e)if(b=m.length,32<=b){g=this.tileCoordRange;do g/=2,b/=4;while(8<b&&64<g);b=new z.GridIndex(this.tileCoordRange,this.tileCoordRange,g);c.set(k,{flat:m,index:b});f.symbols.set(k,{flat:m,index:b});for(const t of m)b.getCell(t.xTile,t.yTile).push(t)}else c.set(k,
{flat:m}),f.symbols.set(k,{flat:m});this._addSymbols(d.key,e)}deleteStyleLayers(d){this._uniqueSymbolLayerArray=null;for(const [e,f]of this._tiles){const c=new Map;for(const b of d)f.symbols.has(b)&&(c.set(b,f.symbols.get(b)),f.symbols.delete(b));this._removeSymbols(c);0===f.symbols.size&&this._tiles.delete(e)}}removeTile(d){this._uniqueSymbolLayerArray=null;const e=this._tiles.get(d.id);if(e){var f=new Map;for(const [c]of d.symbols)e.symbols.has(c)&&(f.set(c,e.symbols.get(c)),e.symbols.delete(c));
this._removeSymbols(f);0===e.symbols.size&&this._tiles.delete(d.id)}}querySymbols(d,e,f,c){c=[];var b=this.uniqueSymbols;for(const k of b){b=k.styleLayerUID;var g=k.uniqueSymbols;for(const m of g)(g=m.tileSymbols.find(t=>t.selectedForRendering))&&z.isSearchCircleOverlapingSymbol(g,d,e*(window.devicePixelRatio||1),f)&&c.push({vtlSymbol:g,styleLayerUID:b,tileKey:g.tile.key})}return c}_removeSymbols(d){for(const [f,{flat:c}]of d)for(const b of c){d=b.unique;var e=d.tileSymbols;const g=e.length-1;for(let k=
0;k<g;k++)if(e[k]===b){e[k]=e[g];break}e.length=g;0===g&&(e=this._uniqueSymbolsReferences.get(f),e.delete(d),0===e.size&&this._uniqueSymbolsReferences.delete(f));b.unique=null}}_addSymbols(d,e){if(0!==e.size){var f=this._visibleTiles;for(const c of f)c.parentTile||c.key.world!==d.world||c.key.level===d.level&&!c.key.equals(d)||this._matchSymbols(c,d,e);for(const [c,b]of e)for(const g of b)null==g.unique&&(d=this._createUnique(),g.unique=d,d.tileSymbols.push(g),e=this._uniqueSymbolsReferences.get(c),
e||(e=new Set,this._uniqueSymbolsReferences.set(c,e)),e.add(d))}}_matchSymbols(d,e,f){if(d.key.level>e.level){var c=d.key.level-e.level;if(d.key.row>>c!==e.row||d.key.col>>c!==e.col)return}if(e.level>d.key.level&&(c=e.level-d.key.level,e.row>>c!==d.key.row||e.col>>c!==d.key.col))return;if(e.equals(d.key))for(var b of d.childrenTiles)this._matchSymbols(b,e,f);else{b=new Map;for(const [m,t]of f){var g=[];for(const p of t)f=z.tileCoordChange(this.tileCoordRange,p.xTile,e.level,e.col,d.key.level,d.key.col),
c=z.tileCoordChange(this.tileCoordRange,p.yTile,e.level,e.row,d.key.level,d.key.row),0<=f&&f<this.tileCoordRange&&0<=c&&c<this.tileCoordRange&&g.push({symbol:p,xTransformed:f,yTransformed:c});f=[];c=d.key.level<e.level?1:1<<d.key.level-e.level;const q=this._tiles.get(d.id).symbols.get(m);if(q){const p=q.flat;for(const r of g){var k=!1;let B;const F=r.xTransformed,w=r.yTransformed;B=null!=q.index?q.index.getCell(F,w):p;g=r.symbol;const D=g.hash;for(const E of B)if(D===E.hash&&Math.abs(F-E.xTile)<=
c&&Math.abs(w-E.yTile)<=c){k=E.unique;g.unique=k;k.tileSymbols.push(g);k=!0;break}k||f.push(g)}}0<f.length&&b.set(m,f)}for(const m of d.childrenTiles)this._matchSymbols(m,e,b)}}_createUniqueSymbolLayerArray(){var d=this._uniqueSymbolsReferences;const e=Array(d.size);let f=0;for(const [c,b]of d){const g=Array(b.size);d=0;for(const k of b)g[d++]=k;e[f]={styleLayerUID:c,uniqueSymbols:g};f++}return e}}y.SymbolRepository=C;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports",
"../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(y,z,C){class d extends C.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:z.create(),tileMat3:z.create()}}}y.RenderableTile=d;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileFeatureIndex":function(){define("../../../../Graphic ../../../../core/MapUtils ../../../../core/pbf ../../../../core/libs/rbush/PooledRBush ./enums ./Feature ./GeometryUtils ./SourceLayerData ./style/StyleLayer".split(" "),
function(y,z,C,d,e,f,c,b,g){const k=(q,p)=>{const r=q.vtlSymbol.sourceTile,B=p.vtlSymbol.sourceTile;return r.level!==B.level?r.level-B.level:r.row!==B.row?r.row-B.row:r.col!==B.col?r.col-B.col:q.styleLayerUID-p.styleLayerUID};class m{constructor(q,p,r,B,F){this.tileKey=q;this._tileHandler=this._styleRepository=this._index=null;this._tileKeyToPBF=new Map;this._tileLayerData=p;this._styleRepository=r;this._tileHandler=B;this._parentLayer=F}static create(q,p,r,B,F){return new m(q,p,r,B,F)}clear(){this._index?.clear();
this._tileKeyToPBF.clear()}async queryAttributes(q,p,r,B,F){if(0===this._tileLayerData.size||!this._styleRepository||!this._tileHandler)return[];null===this._index&&(this._index=new d.PooledRBush(100,t),await this._indexLayers());const w=[];this._queryIndex(w,q,p,r,this.tileKey.level,B);F&&0<F?.length&&await this._getSymbolsAttributes(w,F);return w}async _indexLayers(){const q=this.tileKey,p=this._styleRepository.layers,r=await this._getTilePayload(q);for(const [F,w]of this._tileLayerData){const D=
p[F];var B=r.find(K=>K.sourceName===D.source);if(!B)continue;const {protobuff:E,key:H}=B;w.type!==e.BucketType.SYMBOL&&(B=1<<q.level-H.level,this._indexLayer(D,E,q.level,B,q.row-H.row*B,q.col-H.col*B))}}_indexLayer(q,p,r,B,F,w){const D=q.sourceLayer,E=q.getFeatureFilter(),H=r+1,K=c.getTileMargins(r);for(p=new C(new Uint8Array(p),new DataView(p));p.next();)switch(p.tag()){case 3:var O=p.getMessage();const u=new b(O);O.release();if(u.name!==D)continue;O=u.getData();var h=u.extent/B;const A=h*w-K,I=
h*F-K,J=A+h+2*K,M=I+h+2*K,L=h/512,Q=4096/h,R=h*w;for(h*=F;O.nextTag(2);){var n=O.getMessage();const V=new f(n,u);n.release();if(!E||E.filter(V,r)){var l=V.values||{};n=l._minzoom;l=l._maxzoom;n&&n>=10*H||l&&l<=10*r||(n=q.getFeatureInflatedBounds(V,r,u.extent,L),null==n||n[0]>J||n[1]>M||n[2]<A||n[3]<I||(n[0]=(n[0]-R)*Q,n[1]=(n[1]-h)*Q,n[2]=(n[2]-R)*Q,n[3]=(n[3]-h)*Q,this._index.insert(new g.IndexItem(q,V,n,Q,R,h))))}}break;default:p.skip()}}async _getSymbolsAttributes(q,p){if(!p||0===p.length)return q;
var r=[];p.sort(k);let B=p[0].styleLayerUID;var F=0;for(var w=0;w<p.length;w++)B!==p[w].styleLayerUID&&(r.push({from:F,to:w,styleLayerUID:B,sourceTileKey:p[w].vtlSymbol.sourceTile}),F=w,B=p[w].styleLayerUID);r.push({from:F,to:p.length,styleLayerUID:B,sourceTileKey:p[p.length-1].vtlSymbol.sourceTile});F=this._styleRepository.layers;w=null;let D;for(const E of r)r=await this._getTilePayload(E.sourceTileKey),D=F[E.styleLayerUID],(w=!!D&&r.find(H=>H.sourceName===D.source))&&this._addSymbolsAttributes(q,
p.slice(E.from,E.to).map(H=>H.vtlSymbol),B,w);return q}_addSymbolsAttributes(q,p,r,B){const F=this._styleRepository.layers,w=B.key,D=this.tileKey,E=1<<D.level-w.level;this._getSymbolAttributes(B.protobuff,p,r,E,D.row-w.row*E,D.col-w.col*E).forEach(H=>{const {attributes:K,tilePoint:O}=H;q.push({layerId:F[r].id,layerIndex:r,graphic:new y({attributes:K,origin:{type:"vector-tile",layerId:F[r].id,layerIndex:r,layer:this._parentLayer}}),tilePoint:O})})}_getSymbolAttributes(q,p,r,B,F,w){const D=[],E=this._styleRepository.layers;
let H=0;p.sort((n,l)=>n.featureIndex-l.featureIndex);for(q=new C(new Uint8Array(q),new DataView(q));q.next();)switch(q.tag()){case 3:var K=q.getMessage();const n=new b(K);K.release();if(n.name!==E[r].sourceLayer)continue;K=n.getData();var O=n.extent/B;const l=4096/O,u=O*w;O*=F;let A=0;for(;K.nextTag(2);){const I=K.getMessage();if(A++===p[H].featureIndex){var h=new f(I,n);const J=h.values;h=h.getGeometry();D.push({attributes:J,tilePoint:null!=h?[l*(h[0][0].x-u),l*(h[0][0].y-O)]:null});H++}I.release();
if(H===p.length)return D}break;default:q.skip()}return D}_queryIndex(q,p,r,B,F,w){const D=8*B*(window.devicePixelRatio||1);this._index?.search({minX:p-D,minY:r-D,maxX:p+D,maxY:r+D},E=>{const {layer:H,feature:K}=E;H.isIntersectingFeature(p,r,B,K,F,w,E)&&q.push({layerId:H.id,layerIndex:H.uid,tilePoint:null,graphic:new y({attributes:K.values,origin:{type:"vector-tile",layerId:E.layer.id,layerIndex:E.layer.uid,layer:this._parentLayer}})})});return q}async _getTilePayload(q){return z.getOrCreateMapValue(this._tileKeyToPBF,
q.id,()=>this._tileHandler.fetchTilePBFs(q)).then(p=>p)}}const t=q=>({minX:q.bounds[0],minY:q.bounds[1],maxX:q.bounds[2],maxY:q.bounds[3]});return m})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../PooledArray","../../../chunks/quickselect"],function(y,z,C,d){function e(h,n){f(h,0,h.children.length,n,h)}function f(h,n,l,u,A){A||=new K([]);A.minX=Infinity;A.minY=Infinity;A.maxX=-Infinity;A.maxY=-Infinity;for(let I=n,J;I<l;I++)J=h.children[I],c(A,h.leaf?u(J):
J);return A}function c(h,n){h.minX=Math.min(h.minX,n.minX);h.minY=Math.min(h.minY,n.minY);h.maxX=Math.max(h.maxX,n.maxX);h.maxY=Math.max(h.maxY,n.maxY)}function b(h,n){return h.minX-n.minX}function g(h,n){return h.minY-n.minY}function k(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function m(h){return h.maxX-h.minX+(h.maxY-h.minY)}function t(h,n){return h.minX<=n.minX&&h.minY<=n.minY&&n.maxX<=h.maxX&&n.maxY<=h.maxY}function q(h,n){return n.minX<=h.maxX&&n.minY<=h.maxY&&n.maxX>=h.minX&&n.maxY>=h.minY}
function p(h,n,l,u,A){for(n=[n,l];n.length;){l=n.pop();const I=n.pop();if(l-I<=u)continue;const J=I+Math.ceil((l-I)/u/2)*u;d.quickselect(h,J,I,l,A);n.push(I,J,J,l)}}class r{constructor(h=9,n){this._compareMinX=b;this._compareMinY=g;this._toBBox=l=>l;this._maxEntries=Math.max(4,h||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));n&&("function"===typeof n?this._toBBox=n:this._initFormat(n));this.clear()}destroy(){this.clear();B.prune();F.prune();w.prune();D.prune()}all(h){this._all(this._data,
h)}search(h,n){let l=this._data;const u=this._toBBox;if(q(h,l))for(B.clear();l;){for(let A=0,I=l.children.length;A<I;A++){const J=l.children[A],M=l.leaf?u(J):J;q(h,M)&&(l.leaf?n(J):t(h,M)?this._all(J,n):B.push(J))}l=B.pop()}}collides(h){let n=this._data;const l=this._toBBox;if(!q(h,n))return!1;for(B.clear();n;){for(let u=0,A=n.children.length;u<A;u++){const I=n.children[u],J=n.leaf?l(I):I;if(q(h,J)){if(n.leaf||t(h,J))return!0;B.push(I)}}n=B.pop()}return!1}load(h){if(!h.length)return this;if(h.length<
this._minEntries){for(let n=0,l=h.length;n<l;n++)this.insert(h[n]);return this}h=this._build(h.slice(0,h.length),0,h.length-1,0);if(this._data.children.length)if(this._data.height===h.height)this._splitRoot(this._data,h);else{if(this._data.height<h.height){const n=this._data;this._data=h;h=n}this._insert(h,this._data.height-h.height-1,!0)}else this._data=h;return this}insert(h){h&&this._insert(h,this._data.height-1);return this}clear(){this._data=new K([]);return this}remove(h){if(!h)return this;
let n=this._data,l=null,u=0,A=!1,I;const J=this._toBBox(h);w.clear();for(D.clear();n||0<w.length;){n||(n=w.pop(),l=w.data[w.length-1],u=D.pop()??0,A=!0);if(n.leaf&&(I=z.indexOf(n.children,h,n.children.length,n.indexHint),-1!==I)){n.children.splice(I,1);w.push(n);this._condense(w);break}A||n.leaf||!t(n,J)?l?(u++,n=l.children[u],A=!1):n=null:(w.push(n),D.push(u),u=0,l=n,n=n.children[0])}return this}toJSON(){return this._data}fromJSON(h){this._data=h;return this}_all(h,n){for(F.clear();h;){if(!0===h.leaf)for(const l of h.children)n(l);
else F.pushArray(h.children);h=F.pop()??null}}_build(h,n,l,u){var A=l-n+1,I=this._maxEntries;if(A<=I)return h=new K(h.slice(n,l+1)),e(h,this._toBBox),h;u||(u=Math.ceil(Math.log(A)/Math.log(I)),I=Math.ceil(A/I**(u-1)));const J=new O([]);J.height=u;A=Math.ceil(A/I);I=A*Math.ceil(Math.sqrt(I));for(p(h,n,l,I,this._compareMinX);n<=l;n+=I){const M=Math.min(n+I-1,l);p(h,n,M,A,this._compareMinY);for(let L=n;L<=M;L+=A)J.children.push(this._build(h,L,Math.min(L+A-1,M),u-1))}e(J,this._toBBox);return J}_chooseSubtree(h,
n,l,u){for(;;){u.push(n);if(!0===n.leaf||u.length-1===l)break;let A=Infinity,I=Infinity,J=void 0;for(let M=0,L=n.children.length;M<L;M++){const Q=n.children[M],R=k(Q),V=(Math.max(Q.maxX,h.maxX)-Math.min(Q.minX,h.minX))*(Math.max(Q.maxY,h.maxY)-Math.min(Q.minY,h.minY))-R;V<I?(I=V,A=R<A?R:A,J=Q):V===I&&R<A&&(A=R,J=Q)}n=J||n.children[0]}return n}_insert(h,n,l){var u=this._toBBox;l=l?h:u(h);w.clear();u=this._chooseSubtree(l,this._data,n,w);u.children.push(h);for(c(u,l);0<=n;)if(w.data[n].children.length>
this._maxEntries)this._split(w,n),n--;else break;this._adjustParentBBoxes(l,w,n)}_split(h,n){const l=h.data[n];var u=l.children.length;const A=this._minEntries;this._chooseSplitAxis(l,A,u);(u=this._chooseSplitIndex(l,A,u))?(u=l.children.splice(u,l.children.length-u),u=l.leaf?new K(u):new O(u),u.height=l.height,e(l,this._toBBox),e(u,this._toBBox),n?h.data[n-1].children.push(u):this._splitRoot(l,u)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(h,n){this._data=
new O([h,n]);this._data.height=h.height+1;e(this._data,this._toBBox)}_chooseSplitIndex(h,n,l){let u,A,I=void 0;u=A=Infinity;for(let M=n;M<=l-n;M++){var J=f(h,0,M,this._toBBox);const L=f(h,M,l,this._toBBox),Q=Math.max(0,Math.min(J.maxX,L.maxX)-Math.max(J.minX,L.minX))*Math.max(0,Math.min(J.maxY,L.maxY)-Math.max(J.minY,L.minY));J=k(J)+k(L);Q<u?(u=Q,I=M,A=J<A?J:A):Q===u&&J<A&&(A=J,I=M)}return I}_chooseSplitAxis(h,n,l){const u=h.leaf?this._compareMinX:b,A=h.leaf?this._compareMinY:g,I=this._allDistMargin(h,
n,l,u);n=this._allDistMargin(h,n,l,A);I<n&&h.children.sort(u)}_allDistMargin(h,n,l,u){h.children.sort(u);u=this._toBBox;var A=f(h,0,n,u);const I=f(h,l-n,l,u);let J=m(A)+m(I);for(let M=n;M<l-n;M++){const L=h.children[M];c(A,h.leaf?u(L):L);J+=m(A)}for(l=l-n-1;l>=n;l--)A=h.children[l],c(I,h.leaf?u(A):A),J+=m(I);return J}_adjustParentBBoxes(h,n,l){for(;0<=l;l--)c(n.data[l],h)}_condense(h){for(let n=h.length-1;0<=n;n--){const l=h.data[n];if(0===l.children.length)if(0<n){const u=h.data[n-1],A=u.children;
A.splice(z.indexOf(A,l,A.length,u.indexHint),1)}else this.clear();else e(l,this._toBBox)}}_initFormat(h){const n=["return a"," - b",";"];this._compareMinX=new Function("a","b",n.join(h[0]));this._compareMinY=new Function("a","b",n.join(h[1]));this._toBBox=new Function("a","return {minX: a"+h[0]+", minY: a"+h[1]+", maxX: a"+h[2]+", maxY: a"+h[3]+"};")}}const B=new C,F=new C,w=new C,D=new C({deallocator:void 0});class E{constructor(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity}}class H extends E{constructor(){super(...arguments);
this.height=1;this.indexHint=new z.PositionHint}}class K extends H{constructor(h){super();this.children=h;this.leaf=!0}}class O extends H{constructor(h){super();this.children=h;this.leaf=!1}}y.BBox=E;y.PooledRBush=r;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/Feature":function(){define(["../../../../geometry/support/TileClipper"],function(y){var z;(function(d){d[d.moveTo=1]="moveTo";d[d.lineTo=2]="lineTo";d[d.close=7]="close"})(z||={});class C{constructor(d,
e,f=0){this.values={};this._geometry=void 0;this._pbfGeometry=null;this.featureIndex=f;f=e.keys;e=e.values;for(d=d.asUnsafe();d.next();)switch(d.tag()){case 1:this.id=d.getUInt64();break;case 2:const c=d.getMessage().asUnsafe(),b=this.values;for(;!c.empty();){const g=c.getUInt32(),k=c.getUInt32();b[f[g]]=e[k]}c.release();break;case 3:this.type=d.getUInt32();break;case 4:this._pbfGeometry=d.getMessage();break;default:d.skip()}}getGeometry(d){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;
const e=this._pbfGeometry.asUnsafe();this._pbfGeometry=null;let f,c;d?d.reset(this.type):f=[];let b=z.moveTo;var g=0;let k=0,m=0;for(;!e.empty();)switch(0===g&&(g=e.getUInt32(),b=g&7,g>>=3),g--,b){case z.moveTo:k+=e.getSInt32();m+=e.getSInt32();d?d.moveTo(k,m):f&&(c&&f.push(c),c=[],c.push(new y.Point(k,m)));break;case z.lineTo:k+=e.getSInt32();m+=e.getSInt32();d?d.lineTo(k,m):c&&c.push(new y.Point(k,m));break;case z.close:d?d.close():c&&!c[0].equals(k,m)&&c.push(c[0].clone());break;default:throw e.release(),
Error("Invalid path operation");}let t;d?t=d.result():f&&(c&&f.push(c),t=f);e.release();return this._geometry=t}}return C})},"esri/views/2d/engine/vectorTiles/SourceLayerData":function(){define(function(){class y{constructor(z){this.extent=4096;this.keys=[];this.values=[];this._pbfLayer=z.clone();for(z=z.asUnsafe();z.next();)switch(z.tag()){case 1:this.name=z.getString();break;case 3:this.keys.push(z.getString());break;case 4:this.values.push(z.processMessage(y._parseValue));break;case 5:this.extent=
z.getUInt32();break;default:z.skip()}}getData(){return this._pbfLayer}static _parseValue(z){for(;z.next();)switch(z.tag()){case 1:return z.getString();case 2:return z.getFloat();case 3:return z.getDouble();case 4:return z.getInt64();case 5:return z.getUInt64();case 6:return z.getSInt64();case 7:return z.getBool();default:z.skip()}return null}}return y})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../geometry/support/aaBoundingRect ../enums ../GeometryUtils ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(y,z,C,d,e,f,c,b,g,k,m,t,q){function p(h){h=h?.getGeometry();if(null==h)return null;let n=Infinity,l=Infinity,u=-Infinity,A=-Infinity;for(const I of h)if(I)for(const J of I)n=Math.min(n,J.x),l=Math.min(l,J.y),u=Math.max(u,J.x),A=Math.max(A,J.y);return z.fromValues(n,l,u,A)}y.CapType=void 0;(function(h){h[h.BUTT=0]="BUTT";h[h.ROUND=1]="ROUND";h[h.SQUARE=2]="SQUARE";h[h.UNKNOWN=4]="UNKNOWN"})(y.CapType||(y.CapType={}));class r{constructor(h,n,l,u,A,I){this.layer=h;this.feature=n;this.bounds=
l;this.normalizationRatio=u;this.normalizationOffsetX=A;this.normalizationOffsetY=I}}class B{constructor(h,n,l,u){this.type=h;this.typeName=n.type;this.id=n.id;this.source=n.source;this.sourceLayer=n["source-layer"];this.minzoom=n.minzoom;this.maxzoom=n.maxzoom;this.filter=n.filter;this.layout=n.layout;this.paint=n.paint;this.z=l;this.uid=u;switch(h){case m.StyleLayerType.BACKGROUND:this._layoutDefinition=m.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=m.StyleDefinition.backgroundPaintDefinition;
break;case m.StyleLayerType.FILL:this._layoutDefinition=m.StyleDefinition.fillLayoutDefinition;this._paintDefinition=m.StyleDefinition.fillPaintDefinition;break;case m.StyleLayerType.LINE:this._layoutDefinition=m.StyleDefinition.lineLayoutDefinition;this._paintDefinition=m.StyleDefinition.linePaintDefinition;break;case m.StyleLayerType.SYMBOL:this._layoutDefinition=m.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=m.StyleDefinition.symbolPaintDefinition;break;case m.StyleLayerType.CIRCLE:this._layoutDefinition=
m.StyleDefinition.circleLayoutDefinition,this._paintDefinition=m.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=k.createFilter(this.filter)}getLayoutProperty(h){return this._layoutProperties[h]}getPaintProperty(h){return this._paintProperties[h]}getLayoutValue(h,n,l){let u;const A=this._layoutProperties[h];A&&
(u=A.getValue(n,l));void 0===u&&(u=this._layoutDefinition[h]["default"]);return u}getPaintValue(h,n,l){let u;const A=this._paintProperties[h];A&&(u=A.getValue(n,l));void 0===u&&(u=this._paintDefinition[h]["default"]);return u}isPainterDataDriven(){const h=this._paintProperties;if(h)for(const n in h)if(h[n].isDataDriven)return!0;return!1}isIntersectingFeature(h,n,l,u,A,I,J){return!1}getFeatureInflatedBounds(h,n,l,u){return null}_parseLayout(h){const n={};for(const l in h){const u=this._layoutDefinition[l];
u&&(n[l]=new t(u,h[l]))}return n}_parsePaint(h){const n={};for(const l in h){const u=this._paintDefinition[l];u&&(n[l]=new t(u,h[l]))}return n}computeAttributesKey(h,n,l,u){let A=0,I=0;for(const J of n){n=3;if(!J||J!==u){const {isLayout:M,isOptional:L}=l[J];n=M?this.getLayoutProperty(J):this.getPaintProperty(J);n=n?.interpolator?2:n?.isDataDriven?1:L&&!n?3:0}I|=n<<A;A+=2}return I<<3|h}}class F extends B{constructor(h,n,l,u){super(h,n,l,u);this.backgroundMaterial=new e.VTLBackgroundMaterial(this.computeAttributesKey(C.ShaderProgramType.BACKGROUND,
e.VTLBackgroundMaterial.ATTRIBUTES,e.VTLBackgroundMaterial.ATTRIBUTES_INFO))}}class w extends B{constructor(h,n,l,u){super(h,n,l,u);h=this.getPaintProperty("fill-color");n=this.getPaintProperty("fill-opacity");l=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=h?.isDataDriven;this.hasDataDrivenOpacity=n?.isDataDriven;this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||l?.isDataDriven;n=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!n;this.hasDataDrivenOutlineColor=
n?.isDataDriven;this.hasDataDrivenOutline=n?n.isDataDriven:h?h.isDataDriven:!1;this.hasDataDrivenOutline=(n?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity;this.fillMaterial=new c.VTLFillMaterial(this.computeAttributesKey(C.ShaderProgramType.FILL,c.VTLFillMaterial.ATTRIBUTES,c.VTLFillMaterial.ATTRIBUTES_INFO));this.outlineMaterial=new c.VTLOutlineMaterial(this.computeAttributesKey(C.ShaderProgramType.OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_FILL:
c.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?c.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:c.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(h,n,l,u){l=p(h);if(!l)return null;h=this.getPaintValue("fill-translate",n,h);u*=Math.max(h[0],h[1]);l[0]-=u;l[2]-=u;l[1]+=u;l[3]+=u;return l}isIntersectingFeature(h,n,l,u,A,I,J){const M=u.getGeometry();if(!M)return!1;const L=8/J.normalizationRatio;h=h/J.normalizationRatio+J.normalizationOffsetX;
n=n/J.normalizationRatio+J.normalizationOffsetY;u=d.translateAnchor(this.getPaintValue("fill-translate",A,u),this.getPaintValue("fill-translate-anchor",A,u),I,8);h-=L*u.x;n-=L*u.y;return d.pointInPolygon(h,n,M)?!0:d.distanceFromToPolylineWithinThreshold(h,n,M,L*l)}}class D extends B{constructor(h,n,l,u){super(h,n,l,u);h=this.getPaintProperty("line-pattern");this.lineMaterial=new b.VTLLineMaterial(this.computeAttributesKey(C.ShaderProgramType.LINE,b.VTLLineMaterial.ATTRIBUTES,b.VTLLineMaterial.ATTRIBUTES_INFO,
h?"line-dasharray":""));this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven;
this.canUseThinTessellation=!1;!this.hasDataDrivenLine&&(h=this.getPaintProperty("line-width"),!h||"number"===typeof h&&.5*h<q.thinLineHalfWidthThreshold)&&(h=this.getPaintProperty("line-offset"),!h||"number"===typeof h&&0===h)&&(this.canUseThinTessellation=!0)}getDashKey(h,n){switch(n){case y.CapType.BUTT:n="Butt";break;case y.CapType.ROUND:n="Round";break;case y.CapType.SQUARE:n="Square";break;default:n="Butt"}return`dasharray-[${h.toString()}]-${n}`}getFeatureInflatedBounds(h,n,l,u){l=p(h);if(!l)return null;
var A=this.getPaintValue("line-translate",n,h);A=u*Math.max(A[0],A[1]);l[0]-=A;l[2]-=A;l[1]+=A;l[3]+=A;A=u*Math.abs(this.getPaintValue("line-offset",n,h)||0);h=this.getPaintValue("line-width",n,h);u*=h/2;l[0]-=A+u;l[1]-=A+u;l[2]+=A+u;l[3]+=A+u;return l}isIntersectingFeature(h,n,l,u,A,I,J){let M=u.getGeometry();if(!M)return!1;const L=8/J.normalizationRatio;h=h/J.normalizationRatio+J.normalizationOffsetX;n=n/J.normalizationRatio+J.normalizationOffsetY;I=d.translateAnchor(this.getPaintValue("line-translate",
A,u),this.getPaintValue("line-translate-anchor",A,u),I,8);h-=L*I.x;n-=L*I.y;I=L*this.getPaintValue("line-offset",A,u)||0;0!==I&&(M=d.offsetLine(M,-I));u=this.getPaintValue("line-width",A,u);return d.distanceFromToPolylineWithinThreshold(h,n,M,L*(l+u/2))}}class E extends B{constructor(h,n,l,u){super(h,n,l,u);this.iconMaterial=new g.VTLIconMaterial(this.computeAttributesKey(C.ShaderProgramType.ICON,g.VTLIconMaterial.ATTRIBUTES,g.VTLIconMaterial.ATTRIBUTES_INFO));this.textMaterial=new g.VTLTextMaterial(this.computeAttributesKey(C.ShaderProgramType.TEXT,
g.VTLTextMaterial.ATTRIBUTES,g.VTLTextMaterial.ATTRIBUTES_INFO));this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven;this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||
this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}}class H extends B{constructor(h,n,l,u){super(h,n,l,u);this.circleMaterial=new f.VTLCircleMaterial(this.computeAttributesKey(C.ShaderProgramType.CIRCLE,f.VTLCircleMaterial.ATTRIBUTES,f.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(h,n,l,u){l=p(h);if(!l)return null;var A=
this.getPaintValue("circle-translate",n,h);A=Math.max(A[0],A[1]);l[0]-=A;l[2]-=A;l[1]+=A;l[3]+=A;h=8*(this.getPaintValue("circle-radius",n,h)+this.getPaintValue("circle-stroke-width",n,h));u*=h/2;l[0]-=u;l[1]-=u;l[2]+=u;l[3]+=u;return l}isIntersectingFeature(h,n,l,u,A,I,J){var M=u.getGeometry();if(!M)return!1;const L=8/J.normalizationRatio;h=h/J.normalizationRatio+J.normalizationOffsetX;n=n/J.normalizationRatio+J.normalizationOffsetY;l*=L;I=d.translateAnchor(this.getPaintValue("circle-translate",
A,u),this.getPaintValue("circle-translate-anchor",A,u),I,L);u=L*(this.getPaintValue("circle-radius",A,u)+this.getPaintValue("circle-stroke-width",A,u));for(const Q of M)if(Q)for(const R of Q)if(M=R.x+I.x,A=R.y+I.y,Math.sqrt((h-M)*(h-M)+(n-A)*(n-A))-l<=u)return!0;return!1}}class K{constructor(h,n,l){this.allowOverlap=h.getLayoutValue("icon-allow-overlap",n);this.ignorePlacement=h.getLayoutValue("icon-ignore-placement",n);this.keepUpright=h.getLayoutValue("icon-keep-upright",n);this.optional=h.getLayoutValue("icon-optional",
n);this.rotationAlignment=h.getLayoutValue("icon-rotation-alignment",n);this.rotationAlignment===m.RotationAlignment.AUTO&&(this.rotationAlignment=l?m.RotationAlignment.MAP:m.RotationAlignment.VIEWPORT);l=h.getLayoutProperty("icon-anchor");l?.isDataDriven?this._anchorProp=l:this.anchor=h.getLayoutValue("icon-anchor",n);l=h.getLayoutProperty("icon-offset");l?.isDataDriven?this._offsetProp=l:this.offset=h.getLayoutValue("icon-offset",n);l=h.getLayoutProperty("icon-padding");l?.isDataDriven?this._paddingProp=
l:this.padding=h.getLayoutValue("icon-padding",n);l=h.getLayoutProperty("icon-rotate");l?.isDataDriven?this._rotateProp=l:this.rotate=h.getLayoutValue("icon-rotate",n);l=h.getLayoutProperty("icon-size");l?.isDataDriven?this._sizeProp=l:this.size=h.getLayoutValue("icon-size",n)}update(h,n){this._anchorProp&&(this.anchor=this._anchorProp.getValue(h,n));this._offsetProp&&(this.offset=this._offsetProp.getValue(h,n));this._paddingProp&&(this.padding=this._paddingProp.getValue(h,n));this._rotateProp&&(this.rotate=
this._rotateProp.getValue(h,n));this._sizeProp&&(this.size=this._sizeProp.getValue(h,n))}}class O{constructor(h,n,l){this.allowOverlap=h.getLayoutValue("text-allow-overlap",n);this.ignorePlacement=h.getLayoutValue("text-ignore-placement",n);this.keepUpright=h.getLayoutValue("text-keep-upright",n);this.optional=h.getLayoutValue("text-optional",n);this.rotationAlignment=h.getLayoutValue("text-rotation-alignment",n);this.rotationAlignment===m.RotationAlignment.AUTO&&(this.rotationAlignment=l?m.RotationAlignment.MAP:
m.RotationAlignment.VIEWPORT);l=h.getLayoutProperty("text-anchor");l?.isDataDriven?this._anchorProp=l:this.anchor=h.getLayoutValue("text-anchor",n);l=h.getLayoutProperty("text-justify");l?.isDataDriven?this._justifyProp=l:this.justify=h.getLayoutValue("text-justify",n);l=h.getLayoutProperty("text-letter-spacing");l?.isDataDriven?this._letterSpacingProp=l:this.letterSpacing=h.getLayoutValue("text-letter-spacing",n);l=h.getLayoutProperty("text-line-height");l?.isDataDriven?this._lineHeightProp=l:this.lineHeight=
h.getLayoutValue("text-line-height",n);l=h.getLayoutProperty("text-max-angle");l?.isDataDriven?this._maxAngleProp=l:this.maxAngle=h.getLayoutValue("text-max-angle",n);l=h.getLayoutProperty("text-max-width");l?.isDataDriven?this._maxWidthProp=l:this.maxWidth=h.getLayoutValue("text-max-width",n);l=h.getLayoutProperty("text-offset");l?.isDataDriven?this._offsetProp=l:this.offset=h.getLayoutValue("text-offset",n);l=h.getLayoutProperty("text-padding");l?.isDataDriven?this._paddingProp=l:this.padding=h.getLayoutValue("text-padding",
n);l=h.getLayoutProperty("text-rotate");l?.isDataDriven?this._rotateProp=l:this.rotate=h.getLayoutValue("text-rotate",n);l=h.getLayoutProperty("text-size");l?.isDataDriven?this._sizeProp=l:this.size=h.getLayoutValue("text-size",n);l=h.getLayoutProperty("text-writing-mode");l?.isDataDriven?this._writingModeProp=l:this.writingMode=h.getLayoutValue("text-writing-mode",n)}update(h,n){this._anchorProp&&(this.anchor=this._anchorProp.getValue(h,n));this._justifyProp&&(this.justify=this._justifyProp.getValue(h,
n));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(h,n));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(h,n));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(h,n));this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(h,n));this._offsetProp&&(this.offset=this._offsetProp.getValue(h,n));this._paddingProp&&(this.padding=this._paddingProp.getValue(h,n));this._rotateProp&&(this.rotate=this._rotateProp.getValue(h,n));this._sizeProp&&
(this.size=this._sizeProp.getValue(h,n));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(h,n))}}y.BackgroundStyleLayer=F;y.CircleStyleLayer=H;y.FillStyleLayer=w;y.IconLayout=K;y.IndexItem=r;y.LineStyleLayer=D;y.StyleLayer=B;y.SymbolStyleLayer=E;y.TextLayout=O;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],
function(y,z,C,d){class e extends z.VTLMaterial{constructor(f){super(f)}geometryInfo(){return e.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return e.ATTRIBUTES}attributesInfo(){return e.ATTRIBUTES_INFO}}e.ATTRIBUTES=[];e.GEOMETRY_LAYOUT=[new d.VertexElementDescriptor("a_pos",2,C.DataType.BYTE,0,2)];e.ATTRIBUTES_INFO={};y.VTLBackgroundMaterial=e;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports",
"../MemoryBuffer","./enums","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,d,e){class f{constructor(g){this._locations=new Map;this._key=g}get key(){return this._key}get type(){return this._key&7}defines(){return[]}getStride(){this._layoutInfo||this._buildAttributesInfo();return this._stride}getAttributeLocations(){0===this._locations.size&&this._buildAttributesInfo();return this._locations}getLayoutInfo(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo}getEncodingInfos(){this._propertyEncodingInfo||
this._buildAttributesInfo();return this._propertyEncodingInfo}getUniforms(){this._uniforms||this._buildAttributesInfo();return this._uniforms}getShaderHeader(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader}getShaderMain(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain}setDataUniforms(g,k,m,t,q){var p=this.getUniforms();for(const r of p){const {name:B,type:F,getValue:w}=r;p=w(m,k,t,q);if(null!==p)switch(F){case "float":g.setUniform1f(B,p);break;case "vec2":g.setUniform2fv(B,
p);break;case "vec4":g.setUniform4fv(B,p)}}}encodeAttributes(g,k,m,t){const q=this.attributesInfo(),p=this.getEncodingInfos(),r=[];let B=0,F=0;for(const D of Object.keys(p)){var w=p[D];const {type:E,precisionFactor:H,isLayout:K}=q[D],O=K?m.getLayoutProperty(D):m.getPaintProperty(D),h=O.interpolator?.getInterpolationRange(k);let n=0;for(const l of w){const {offset:u,bufferElementsToAdd:A}=l;if(0<A){for(w=0;w<A;w++)r.push(0);B+=F;F=l.bufferElementsToAdd}w=t??O.getValue(h?h[n]:k,g);switch(E){case C.EncodingType.R8_SIGNED:case C.EncodingType.R8_UNSIGNED:r[B]|=
this._encodeByte(w*(H||1),8*u);break;case C.EncodingType.R16_SIGNED:case C.EncodingType.R16_UNSIGNED:r[B]|=this._encodeShort(w*(H||1),8*u);break;case C.EncodingType.R8G8_SIGNED:case C.EncodingType.R8G8_UNSIGNED:r[B]|=this._encodeByte(w*(H||1),8*u);r[B]|=this._encodeByte(w*(H||1),8*u+8);break;case C.EncodingType.R16G16_SIGNED:case C.EncodingType.R16G16_UNSIGNED:r[B]|=this._encodeShort(w*(H||1),8*u);r[B]|=this._encodeShort(w*(H||1),8*u+16);break;case C.EncodingType.R8G8B8A8_SIGNED:case C.EncodingType.R8G8B8A8_UNSIGNED:r[B]|=
this._encodeByte(w*(H||1),8*u);r[B]|=this._encodeByte(w*(H||1),8*u+8);r[B]|=this._encodeByte(w*(H||1),8*u+16);r[B]|=this._encodeByte(w*(H||1),8*u+24);break;case C.EncodingType.R8G8B8A8_COLOR:r[B]=this._encodeColor(w);break;case C.EncodingType.R16G16B16A16_DASHARRAY:case C.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(B,r,w);break;default:throw Error("Unsupported encoding type");}n++}}return r}getAtributeState(g){const k=3+2*g;g=0|this._bit(k);return g|=this._bit(k+1)<<1}_buildAttributesInfo(){const g=
[],k={};var m={},t=-1;const q=this.attributesInfo();var p=this.attributes();let r=-1;for(const D of p){r++;p=this.getAtributeState(r);if(p===C.AttributeStatus.UNIFORM||p===C.AttributeStatus.UNUSED)continue;var B=q[D];const E=[];k[D]=E;B=B.type;for(let H=0;H<p;H++){const {dataType:K,bytesPerElement:O,count:h,normalized:n}=f._encodingInfo[B],l=O*h;var F=`${K}-${!0===n}`;let u=m[F],A=0;!u||4<u.count+h?(t++,u={dataIndex:t,count:0,offset:0},4!==h&&(m[F]=u),g.push({location:-1,name:"a_data_"+t,count:h,
type:K,normalized:n}),A=Math.ceil(Math.max(l/4,1))):(F=g[u.dataIndex],F.count+=h,A=Math.ceil(Math.max(F.count*O/4,1))-Math.ceil(Math.max(u.offset/4,1)));E.push({dataIndex:u.dataIndex,offset:u.offset,bufferElementsToAdd:A});u.offset+=l;u.count+=h}}for(const D of g)switch(D.type){case d.DataType.BYTE:case d.DataType.UNSIGNED_BYTE:D.count=4;break;case d.DataType.SHORT:case d.DataType.UNSIGNED_SHORT:D.count+=D.count%2}this._buildVertexBufferLayout(g);m=0;t=this._layoutInfo.geometry;for(var w of t)this._locations.set(w.name,
m++);if(w=this._layoutInfo.opacity)for(const D of w)this._locations.set(D.name,m++);this._buildShaderInfo(g,k);this._propertyEncodingInfo=k}_buildVertexBufferLayout(g){const k={},m=this.geometryInfo();let t=m[0].stride;if(0===g.length)k.geometry=m;else{const q=[];let p=t;for(const r of g)t+=c(r.type)*r.count;for(const r of m)q.push(new e.VertexElementDescriptor(r.name,r.count,r.type,r.offset,t,r.normalized));for(const r of g)q.push(new e.VertexElementDescriptor(r.name,r.count,r.type,p,t,r.normalized)),
p+=c(r.type)*r.count;k.geometry=q}this.opacityInfo()&&(k.opacity=this.opacityInfo());this._layoutInfo=k;this._stride=t}_buildShaderInfo(g,k){let m="\n",t="\n";const q=[];for(var p of g)m+=`attribute ${this._getType(p.count)} ${p.name};\n`;var r=this.attributes();g=this.attributesInfo();p=-1;for(const w of r){p++;const {name:D,type:E,precisionFactor:H,isLayout:K}=g[w];r=H&&1!==H?` * ${1/H}`:"";const {bytesPerElement:O,count:h}=f._encodingInfo[E];var B=n=>`a_data_${n.dataIndex}${b(h,n.offset,O)}`;switch(this.getAtributeState(p)){case C.AttributeStatus.UNIFORM:r=
this._getType(h);var F=`u_${D}`;q.push({name:F,type:r,getValue:(l,u,A,I)=>{A=K?l.getLayoutValue(w,u):l.getPaintValue(w,u);if(E===C.EncodingType.R16G16B16A16_DASHARRAY){l=l.getDashKey(A,l.getLayoutValue("line-cap",u));I=I.getMosaicItemPosition(l,!1);if(null==I)return null;const {tl:J,br:M}=I;return[J[0],M[1],M[0],J[1]]}if(E===C.EncodingType.R16G16B16A16_PATTERN){I=I.getMosaicItemPosition(A,!w.includes("line-"));if(null==I)return null;const {tl:J,br:M}=I;return[J[0],M[1],M[0],J[1]]}return E===C.EncodingType.R8G8B8A8_COLOR?
(I=A[3],[I*A[0],I*A[1],I*A[2],I]):A}});m+=`uniform ${r} ${F};\n`;t+=`${r} ${D} = ${F};\n`;break;case C.AttributeStatus.DATA_DRIVEN:F=B(k[w][0]);t+=`${this._getType(h)} ${D} = ${F}${r};\n`;break;case C.AttributeStatus.INTERPOLATED_DATA_DRIVEN:F=`u_t_${D}`;q.push({name:F,type:"float",getValue:(l,u,A,I)=>(K?l.getLayoutProperty(w):l.getPaintProperty(w)).interpolator.interpolationUniformValue(A,u)});m+=`uniform float ${F};\n`;const n=B(k[w][0]);B=B(k[w][1]);t+=`${this._getType(h)} ${D} = mix(${n}${r}, ${B}${r}, ${F});\n`}}this._shaderHeader=
m;this._shaderMain=t;this._uniforms=q}_bit(g){return(this._key&1<<g)>>g}_getType(g){switch(g){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");}_encodeColor(g){const k=255*g[3];return z.i8888to32(g[0]*k,g[1]*k,g[2]*k,k)}_encodePattern(g,k,m){if(m?.rect){var t=m.rect,q=m.width;m=m.height;k[g]=this._encodeShort(t.x+2,0);k[g]|=this._encodeShort(t.y+2+m,16);k[g+1]=this._encodeShort(t.x+2+q,0);k[g+1]|=this._encodeShort(t.y+2,16)}}_encodeByte(g,
k){return(g&255)<<k}_encodeShort(g,k){return(g&65535)<<k}}f._encodingInfo={[C.EncodingType.R8_SIGNED]:{dataType:d.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[C.EncodingType.R8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[C.EncodingType.R16_SIGNED]:{dataType:d.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[C.EncodingType.R16_UNSIGNED]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[C.EncodingType.R8G8_SIGNED]:{dataType:d.DataType.BYTE,
bytesPerElement:1,count:2,normalized:!1},[C.EncodingType.R8G8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[C.EncodingType.R16G16_SIGNED]:{dataType:d.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[C.EncodingType.R16G16_UNSIGNED]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[C.EncodingType.R8G8B8A8_SIGNED]:{dataType:d.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[C.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:d.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[C.EncodingType.R8G8B8A8_COLOR]:{dataType:d.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[C.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[C.EncodingType.R16G16B16A16_PATTERN]:{dataType:d.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const c=g=>{switch(g){case d.DataType.FLOAT:return 4;case d.DataType.INT:return 4;case d.DataType.UNSIGNED_INT:return 4;
case d.DataType.SHORT:return 2;case d.DataType.UNSIGNED_SHORT:return 2;case d.DataType.BYTE:return 1;case d.DataType.UNSIGNED_BYTE:return 1}},b=(g,k,m)=>{k/=m;if(1===g)switch(k){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===g)switch(k){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===g)switch(k){case 0:return".xyz";case 1:return".yzw"}return""};y.VTLMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(function(){class y{constructor(z){this._array=
[];0>=z&&console.error("strideInBytes must be positive!");this._stride=z}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return(new Uint32Array(this._array)).buffer}static i1616to32(z,C){return 65535&z|C<<16}static i8888to32(z,C,d,e){return z&255|(C&255)<<8|(d&255)<<16|e<<24}static i8816to32(z,C,d){return z&255|(C&255)<<8|d<<16}}return y})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],
function(y){y.EncodingType=void 0;(function(z){z[z.R8_SIGNED=0]="R8_SIGNED";z[z.R8_UNSIGNED=1]="R8_UNSIGNED";z[z.R16_SIGNED=2]="R16_SIGNED";z[z.R16_UNSIGNED=3]="R16_UNSIGNED";z[z.R8G8_SIGNED=4]="R8G8_SIGNED";z[z.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";z[z.R16G16_SIGNED=6]="R16G16_SIGNED";z[z.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";z[z.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";z[z.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";z[z.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";z[z.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";
z[z.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(y.EncodingType||(y.EncodingType={}));y.AttributeStatus=void 0;(function(z){z[z.UNIFORM=0]="UNIFORM";z[z.DATA_DRIVEN=1]="DATA_DRIVEN";z[z.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";z[z.UNUSED=3]="UNUSED"})(y.AttributeStatus||(y.AttributeStatus={}));Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums",
"../../../../webgl/VertexElementDescriptor"],function(y,z,C,d,e){class f extends C.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO=
{"circle-radius":{name:"radius",type:z.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:z.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-blur":{name:"blur",
type:z.EncodingType.R8_UNSIGNED,precisionFactor:32}};y.VTLCircleMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,d,e){class f extends C.VTLMaterial{constructor(b){super(b)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}
f.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,4)];f.ATTRIBUTES_INFO={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};class c extends C.VTLMaterial{constructor(b,g){super(b);this._usefillColor=g}geometryInfo(){return c.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this._usefillColor?
c.ATTRIBUTES_FILL:c.ATTRIBUTES_OUTLINE}attributesInfo(){return this._usefillColor?c.ATTRIBUTES_INFO_FILL:c.ATTRIBUTES_INFO_OUTLINE}}c.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];c.ATTRIBUTES_FILL=["fill-color","fill-opacity"];c.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,8),new e.VertexElementDescriptor("a_offset",2,d.DataType.BYTE,4,8),new e.VertexElementDescriptor("a_xnormal",2,d.DataType.BYTE,6,8)];c.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",
type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};c.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100}};y.VTLFillMaterial=f;y.VTLOutlineMaterial=c;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./enums","./VTLMaterial",
"../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,d,e){class f extends C.VTLMaterial{constructor(c){super(c)}geometryInfo(){return f.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");f.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_extrude_offset",
4,d.DataType.BYTE,4,16),new e.VertexElementDescriptor("a_dir_normal",4,d.DataType.BYTE,8,16),new e.VertexElementDescriptor("a_accumulatedDistance",2,d.DataType.UNSIGNED_SHORT,12,16)];f.ATTRIBUTES_INFO={"line-width":{name:"width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:z.EncodingType.R8_SIGNED,precisionFactor:2},"line-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},
"line-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:z.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:z.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};y.VTLLineMaterial=f;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports",
"./enums","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(y,z,C,d,e){const f=[new e.VertexElementDescriptor("a_pos",2,d.DataType.SHORT,0,16),new e.VertexElementDescriptor("a_vertexOffset",2,d.DataType.SHORT,4,16),new e.VertexElementDescriptor("a_texAngleRange",4,d.DataType.UNSIGNED_BYTE,8,16),new e.VertexElementDescriptor("a_levelInfo",4,d.DataType.UNSIGNED_BYTE,12,16)],c=[new e.VertexElementDescriptor("a_opacityInfo",1,d.DataType.UNSIGNED_BYTE,0,1)];
class b extends C.VTLMaterial{constructor(k){super(k)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return b.ATTRIBUTES}attributesInfo(){return b.ATTRIBUTES_INFO}}b.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");b.ATTRIBUTES_INFO={"icon-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},
"icon-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};class g extends C.VTLMaterial{constructor(k){super(k)}geometryInfo(){return f}opacityInfo(){return c}attributes(){return g.ATTRIBUTES}attributesInfo(){return g.ATTRIBUTES_INFO}}g.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");
g.ATTRIBUTES_INFO={"text-color":{name:"color",type:z.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",type:z.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:z.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:z.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:z.EncodingType.R8_UNSIGNED,isLayout:!0}};y.VTLIconMaterial=
b;y.VTLTextMaterial=g;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(y,z){class C{constructor(d){this._expression=d}filter(d,e){if(!this._expression)return!0;try{return this._expression.evaluate(d,e)}catch(f){return console.log(f.message),!0}}static createFilter(d){if(!d)return null;this.isLegacyFilter(d)&&(d=this.convertLegacyFilter(d));try{const e=y.createExpression(d,
null,z.booleanType);return new C(e)}catch(e){return console.log(e.message),null}}static isLegacyFilter(d){if(!Array.isArray(d)||0===d.length)return!0;switch(d[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===d.length&&"string"===typeof d[1]&&!Array.isArray(d[2]);case "in":return 3<=d.length&&"string"===typeof d[1]&&!Array.isArray(d[2]);case "!in":return!0;case "any":case "all":for(let e=1;e<d.length;e++)if(this.isLegacyFilter(d[e]))return!0;return!1;
case "none":return!0;case "has":return 2===d.length&&("$id"===d[1]||"$type"===d[1]);case "!has":return!0;default:return!1}}static convertLegacyFilter(d){if(!Array.isArray(d)||0===d.length)return!0;const e=d[0];if(1===d.length)return"any"!==e;switch(e){case "\x3d\x3d":return C.convertComparison("\x3d\x3d",d[1],d[2]);case "!\x3d":return C.negate(C.convertComparison("\x3d\x3d",d[1],d[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return C.convertComparison(e,d[1],d[2]);case "in":return C.convertIn(d[1],
d.slice(2));case "!in":return C.negate(C.convertIn(d[1],d.slice(2)));case "any":case "all":case "none":return C.convertCombining(e,d.slice(1));case "has":return C.convertHas(d[1]);case "!has":return C.negate(C.convertHas(d[1]));default:throw Error("Unexpected legacy filter.");}}static convertComparison(d,e,f){switch(e){case "$type":return[d,["geometry-type"],f];case "$id":return[d,["id"],f];default:return[d,["get",e],f]}}static convertIn(d,e){switch(d){case "$type":return["in",["geometry-type"],["literal",
e]];case "$id":return["in",["id"],["literal",e]];default:return["in",["get",d],["literal",e]]}}static convertHas(d){switch(d){case "$type":return!0;case "$id":return["has-id"];default:return["has",d]}}static convertCombining(d,e){return[d].concat(e.map(this.convertLegacyFilter))}static negate(d){return["!",d]}}return C})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../Color ../../../../../core/colorUtils ../../../../../geometry/support/TileClipper ../../../unitBezier ../GeometryUtils ./types".split(" "),
function(y,z,C,d,e,f,c){function b(a,v,x){var G=typeof a;if("string"===G||"boolean"===G||"number"===G||null===a){if(x)switch(x.kind){case "string":"string"!==G&&(a=X.toString(a));break;case "number":"number"!==G&&(a=X.toNumber(a));break;case "color":a=X.toColor(a)}a=["literal",a]}if(!Array.isArray(a)||0===a.length)throw Error("Expression must be a non empty array");G=a[0];if("string"!==typeof G)throw Error("First element of expression must be a string");const N=na[G];if(void 0===N)throw Error(`Invalid expression operator "${G}"`);
if(!N)throw Error(`Unimplemented expression operator "${G}"`);return N.parse(a,v,x)}class g{constructor(a){this._parent=a;this._vars={}}add(a,v){this._vars[a]=v}get(a){return this._vars[a]?this._vars[a]:this._parent?this._parent.get(a):null}}class k{constructor(){this.type=c.valueType}static parse(a){if(1<a.length)throw Error('"id" does not expect arguments');return new k}evaluate(a,v){return a?.id}}class m{constructor(){this.type=c.stringType}static parse(a){if(1<a.length)throw Error('"geometry-type" does not expect arguments');
return new m}evaluate(a,v){if(!a)return null;switch(a.type){case d.GeometryType.Point:return"Point";case d.GeometryType.LineString:return"LineString";case d.GeometryType.Polygon:return"Polygon";default:return null}}}class t{constructor(){this.type=c.objectType}static parse(a){if(1<a.length)throw Error('"properties" does not expect arguments');return new t}evaluate(a,v){return a?.values}}class q{constructor(){this.type=c.numberType}static parse(a){if(1<a.length)throw Error('"zoom" does not expect arguments');
return new q}evaluate(a,v){return v}}class p{constructor(a,v,x){this._lhs=a;this._rhs=v;this._compare=x;this.type=c.booleanType}static parse(a,v,x){if(3!==a.length&&4!==a.length)throw Error(`"${a[0]}" expects 2 or 3 arguments`);if(4===a.length)throw Error(`"${a[0]}" collator not supported`);return new p(b(a[1],v),b(a[2],v),x)}evaluate(a,v){return this._compare(this._lhs.evaluate(a,v),this._rhs.evaluate(a,v))}}class r extends p{static parse(a,v){return p.parse(a,v,(x,G)=>x===G)}}class B extends p{static parse(a,
v){return p.parse(a,v,(x,G)=>x!==G)}}class F extends p{static parse(a,v){return p.parse(a,v,(x,G)=>x<G)}}class w extends p{static parse(a,v){return p.parse(a,v,(x,G)=>x<=G)}}class D extends p{static parse(a,v){return p.parse(a,v,(x,G)=>x>G)}}class E extends p{static parse(a,v){return p.parse(a,v,(x,G)=>x>=G)}}class H{constructor(a){this._arg=a;this.type=c.booleanType}static parse(a,v){if(2!==a.length)throw Error('"!" expects 1 argument');return new H(b(a[1],v))}evaluate(a,v){return!this._arg.evaluate(a,
v)}}class K{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,v){const x=[];for(let G=1;G<a.length;G++)x.push(b(a[G],v));return new K(x)}evaluate(a,v){for(const x of this._args)if(!x.evaluate(a,v))return!1;return!0}}class O{constructor(a){this._args=a;this.type=c.booleanType}static parse(a,v){const x=[];for(let G=1;G<a.length;G++)x.push(b(a[G],v));return new O(x)}evaluate(a,v){for(const x of this._args)if(x.evaluate(a,v))return!0;return!1}}class h{constructor(a){this._args=a;this.type=
c.booleanType}static parse(a,v){const x=[];for(let G=1;G<a.length;G++)x.push(b(a[G],v));return new h(x)}evaluate(a,v){for(const x of this._args)if(x.evaluate(a,v))return!1;return!0}}class n{constructor(a,v,x){this.type=a;this._args=v;this._fallback=x}static parse(a,v,x){if(4>a.length)throw Error('"case" expects at least 3 arguments');if(1===a.length%2)throw Error('"case" expects an odd number of arguments');let G;const N=[];for(let P=1;P<a.length-1;P+=2){const T=b(a[P],v),S=b(a[P+1],v,x);G||(G=S.type);
N.push({condition:T,output:S})}a=b(a[a.length-1],v,x);G||(G=a.type);return new n(G,N,a)}evaluate(a,v){for(const x of this._args)if(x.condition.evaluate(a,v))return x.output.evaluate(a,v);return this._fallback.evaluate(a,v)}}class l{constructor(a,v){this.type=a;this._args=v}static parse(a,v){if(2>a.length)throw Error('"coalesce" expects at least 1 argument');let x;const G=[];for(let N=1;N<a.length;N++){const P=b(a[N],v);x||(x=P.type);G.push(P)}return new l(x,G)}evaluate(a,v){for(const x of this._args){const G=
x.evaluate(a,v);if(null!==G)return G}return null}}class u{constructor(a,v,x,G,N){this.type=a;this._input=v;this._labels=x;this._outputs=G;this._fallback=N}static parse(a,v){if(3>a.length)throw Error('"match" expects at least 3 arguments');if(0===a.length%2)throw Error('"case" expects an even number of arguments');let x;const G=b(a[1],v),N=[],P={};let T;for(let aa=2;aa<a.length-1;aa+=2){var S=a[aa];Array.isArray(S)||(S=[S]);for(const fa of S){S=typeof fa;if("string"!==S&&"number"!==S)throw Error('"match" requires string or number literal as labels');
if(!T)T=S;else if(S!==T)throw Error('"match" requires labels to have the same type');P[fa]=N.length}S=b(a[aa+1],v);x||(x=S.type);N.push(S)}return new u(x,G,P,N,b(a[a.length-1],v))}evaluate(a,v){const x=this._input.evaluate(a,v);return(this._outputs[this._labels[x]]||this._fallback).evaluate(a,v)}}class A{constructor(a,v,x,G,N){this._operator=a;this.type=v;this.interpolation=x;this.input=G;this._stops=N}static parse(a,v,x){const G=a[0];if(5>a.length)throw Error(`"${G}" expects at least 4 arguments`);
const N=a[1];if(!Array.isArray(N)||0===N.length)throw Error(`"${N}" is not a valid interpolation`);switch(N[0]){case "linear":if(1!==N.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==N.length||"number"!==typeof N[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==N.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var P=1;5>P;P++){var T=
N[P];if("number"!==typeof T||0>T||1<T)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");}break;default:throw Error(`"${a[0]}" unknown interpolation type "${N[0]}"`);}if(1!==a.length%2)throw Error(`"${G}" expects an even number of arguments`);P=b(a[2],v,c.numberType);let S;"interpolate-hcl"===G||"interpolate-lab"===G?S=c.colorType:x&&"value"!==x.kind&&(S=x);x=[];for(T=3;T<a.length;T+=2){const aa=a[T];if("number"!==typeof aa)throw Error(`"${G}" requires stop inputs as literal numbers`);
if(x.length&&x[x.length-1][0]>=aa)throw Error(`"${G}" requires strictly ascending stop inputs`);const fa=b(a[T+1],v,S);S||(S=fa.type);x.push([aa,fa])}if(S&&S!==c.colorType&&S!==c.numberType&&("array"!==S.kind||S.itemType!==c.numberType))throw Error(`"${G}" cannot interpolate type ${c.typeToString(S)}`);return new A(G,S,N,P,x)}evaluate(a,v){var x=this._stops;if(1===x.length)return x[0][1].evaluate(a,v);var G=this.input.evaluate(a,v);if(G<=x[0][0])return x[0][1].evaluate(a,v);if(G>=x[x.length-1][0])return x[x.length-
1][1].evaluate(a,v);let N=0;for(;++N<x.length&&!(G<x[N][0]););const P=A.interpolationRatio(this.interpolation,G,x[N-1][0],x[N][0]);G=x[N-1][1].evaluate(a,v);const T=x[N][1].evaluate(a,v);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(G)&&Array.isArray(T))return G.map((S,aa)=>f.interpolate(S,T[aa],P));if("color"===this.type.kind&&G instanceof z&&T instanceof z)return G=new z(G),a=new z(T),new z([f.interpolate(G.r,a.r,P),f.interpolate(G.g,a.g,P),f.interpolate(G.b,a.b,
P),f.interpolate(G.a,a.a,P)]);if("number"===this.type.kind&&"number"===typeof G&&"number"===typeof T)return f.interpolate(G,T,P);throw Error(`"${this._operator}" cannot interpolate type ${c.typeToString(this.type)}`);}if("interpolate-hcl"===this._operator)return a=C.toLCH(G),v=C.toLCH(T),x=v.h-a.h,a=C.toRGB({h:a.h+P*(180<x||-180>x?x-360*Math.round(x/360):x),c:f.interpolate(a.c,v.c,P),l:f.interpolate(a.l,v.l,P)}),new z({a:f.interpolate(G.a,T.a,P),...a});if("interpolate-lab"===this._operator)return a=
C.toLAB(G),v=C.toLAB(T),a=C.toRGB({l:f.interpolate(a.l,v.l,P),a:f.interpolate(a.a,v.a,P),b:f.interpolate(a.b,v.b,P)}),new z({a:f.interpolate(G.a,T.a,P),...a});throw Error(`Unexpected operator "${this._operator}"`);}interpolationUniformValue(a,v){const x=this._stops;if(1===x.length||a>=x[x.length-1][0])return 0;let G=0;for(;++G<x.length&&!(a<x[G][0]););return A.interpolationRatio(this.interpolation,v,x[G-1][0],x[G][0])}getInterpolationRange(a){const v=this._stops;if(1===v.length)return a=v[0][0],[a,
a];var x=v[v.length-1][0];if(a>=x)return[x,x];for(x=0;++x<v.length&&!(a<v[x][0]););return[v[x-1][0],v[x][0]]}static interpolationRatio(a,v,x,G){let N=0;"linear"===a[0]?N=A._exponentialInterpolationRatio(v,1,x,G):"exponential"===a[0]?N=A._exponentialInterpolationRatio(v,a[1],x,G):"cubic-bezier"===a[0]&&(N=e.unitBezier(a[1],a[2],a[3],a[4])(A._exponentialInterpolationRatio(v,1,x,G),1E-5));0>N?N=0:1<N&&(N=1);return N}static _exponentialInterpolationRatio(a,v,x,G){G-=x;if(0===G)return 0;a-=x;return 1===
v?a/G:(v**a-1)/(v**G-1)}}class I{constructor(a,v,x){this.type=a;this._input=v;this._stops=x}static parse(a,v){if(5>a.length)throw Error('"step" expects at least 4 arguments');if(1!==a.length%2)throw Error('"step" expects an even number of arguments');const x=b(a[1],v,c.numberType);let G;const N=[];N.push([-Infinity,b(a[2],v)]);for(let P=3;P<a.length;P+=2){const T=a[P];if("number"!==typeof T)throw Error('"step" requires stop inputs as literal numbers');if(N.length&&N[N.length-1][0]>=T)throw Error('"step" requires strictly ascending stop inputs');
const S=b(a[P+1],v);G||(G=S.type);N.push([T,S])}return new I(G,x,N)}evaluate(a,v){const x=this._stops;if(1===x.length)return x[0][1].evaluate(a,v);const G=this._input.evaluate(a,v);let N=0;for(;++N<x.length&&!(G<x[N][0]););return this._stops[N-1][1].evaluate(a,v)}}class J{constructor(a,v){this.type=a;this._output=v}static parse(a,v,x){if(4>a.length)throw Error('"let" expects at least 3 arguments');if(1===a.length%2)throw Error('"let" expects an odd number of arguments');const G=new g(v);for(let N=
1;N<a.length-1;N+=2){const P=a[N];if("string"!==typeof P)throw Error(`"let" requires a string to define variable names - found ${P}`);G.add(P,b(a[N+1],v))}a=b(a[a.length-1],G,x);return new J(a.type,a)}evaluate(a,v){return this._output.evaluate(a,v)}}class M{constructor(a,v){this.type=a;this.output=v}static parse(a,v,x){if(2!==a.length||"string"!==typeof a[1])throw Error('"var" requires just one literal string argument');v=v.get(a[1]);if(!v)throw Error(`${a[1]} must be defined before being used in a "var" expression`);
return new M(x||c.valueType,v)}evaluate(a,v){return this.output.evaluate(a,v)}}class L{constructor(a,v,x){this.type=a;this._index=v;this._array=x}static parse(a,v){if(3!==a.length)throw Error('"at" expects 2 arguments');const x=b(a[1],v,c.numberType);a=b(a[2],v);return new L(a.type.itemType,x,a)}evaluate(a,v){const x=this._index.evaluate(a,v);a=this._array.evaluate(a,v);if(0>x||x>=a.length)throw Error('"at" index out of bounds');if(x!==Math.floor(x))throw Error('"at" index must be an integer');return a[x]}}
class Q{constructor(a,v){this._key=a;this._obj=v;this.type=c.valueType}static parse(a,v){let x;switch(a.length){case 2:return x=b(a[1],v),new Q(x);case 3:return x=b(a[1],v),a=b(a[2],v),new Q(x,a);default:throw Error('"get" expects 1 or 2 arguments');}}evaluate(a,v){const x=this._key.evaluate(a,v);return this._obj?this._obj.evaluate(a,v)[x]:a?.values[x]}}class R{constructor(a,v){this._key=a;this._obj=v;this.type=c.booleanType}static parse(a,v){let x;switch(a.length){case 2:return x=b(a[1],v),new R(x);
case 3:return x=b(a[1],v),a=b(a[2],v),new R(x,a);default:throw Error('"has" expects 1 or 2 arguments');}}evaluate(a,v){const x=this._key.evaluate(a,v);return this._obj?(a=this._obj.evaluate(a,v),x in a):!!a?.values[x]}}class V{constructor(a,v){this._key=a;this._vals=v;this.type=c.booleanType}static parse(a,v){if(3!==a.length)throw Error('"in" expects 2 arguments');return new V(b(a[1],v),b(a[2],v))}evaluate(a,v){const x=this._key.evaluate(a,v);return this._vals.evaluate(a,v).includes(x)}}class Y{constructor(a,
v,x){this._item=a;this._array=v;this._from=x;this.type=c.numberType}static parse(a,v){if(3>a.length||4<a.length)throw Error('"index-of" expects 3 or 4 arguments');const x=b(a[1],v),G=b(a[2],v);return 4===a.length?(a=b(a[3],v,c.numberType),new Y(x,G,a)):new Y(x,G)}evaluate(a,v){const x=this._item.evaluate(a,v),G=this._array.evaluate(a,v);if(this._from){a=this._from.evaluate(a,v);if(a!==Math.floor(a))throw Error('"index-of" index must be an integer');return G.indexOf(x,a)}return G.indexOf(x)}}class Z{constructor(a){this._arg=
a;this.type=c.numberType}static parse(a,v){if(2!==a.length)throw Error('"length" expects 2 arguments');a=b(a[1],v);return new Z(a)}evaluate(a,v){a=this._arg.evaluate(a,v);if("string"===typeof a||Array.isArray(a))return a.length;throw Error('"length" expects string or array');}}class ba{constructor(a,v,x,G){this.type=a;this._array=v;this._from=x;this._to=G}static parse(a,v){if(3>a.length||4<a.length)throw Error('"slice" expects 2 or 3 arguments');const x=b(a[1],v),G=b(a[2],v,c.numberType);if(G.type!==
c.numberType)throw Error('"slice" index must return a number');if(4===a.length){a=b(a[3],v,c.numberType);if(a.type!==c.numberType)throw Error('"slice" index must return a number');return new ba(x.type,x,G,a)}return new ba(x.type,x,G)}evaluate(a,v){const x=this._array.evaluate(a,v);if(!Array.isArray(x)&&"string"!==typeof x)throw Error('"slice" input must be an array or a string');const G=this._from.evaluate(a,v);if(0>G||G>=x.length)throw Error('"slice" index out of bounds');if(G!==Math.floor(G))throw Error('"slice" index must be an integer');
if(this._to){a=this._to.evaluate(a,v);if(0>a||a>=x.length)throw Error('"slice" index out of bounds');if(a!==Math.floor(a))throw Error('"slice" index must be an integer');return x.slice(G,a)}return x.slice(G)}}class ea{constructor(){this.type=c.booleanType}static parse(a){if(1!==a.length)throw Error('"has-id" expects no arguments');return new ea}evaluate(a,v){return void 0!==a?.id}}class W{constructor(a,v){this._args=a;this._calculate=v;this.type=c.numberType}static parse(a,v,x){a=a.slice(1).map(G=>
b(G,v));return new W(a,x)}evaluate(a,v){let x;this._args&&(x=this._args.map(G=>G.evaluate(a,v)));return this._calculate(x)}}class oa extends W{static parse(a,v){switch(a.length){case 2:return W.parse(a,v,x=>-x[0]);case 3:return W.parse(a,v,x=>x[0]-x[1]);default:throw Error('"-" expects 1 or 2 arguments');}}}class pa extends W{static parse(a,v){return W.parse(a,v,x=>{let G=1;for(const N of x)G*=N;return G})}}class qa extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]/x[1]);throw Error('"/" expects 2 arguments');
}}class ra extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]%x[1]);throw Error('"%" expects 2 arguments');}}class sa extends W{static parse(a,v){if(3===a.length)return W.parse(a,v,x=>x[0]**x[1]);throw Error('"^" expects 1 or 2 arguments');}}class ta extends W{static parse(a,v){return W.parse(a,v,x=>{let G=0;for(const N of x)G+=N;return G})}}class U{constructor(a,v){this._args=a;this._calculate=v;this.type=c.numberType}static parse(a,v){const x=a.slice(1).map(G=>b(G,v));return new U(x,
U.ops[a[0]])}evaluate(a,v){let x;this._args&&(x=this._args.map(G=>G.evaluate(a,v)));return this._calculate(x)}}U.ops={abs:a=>Math.abs(a[0]),acos:a=>Math.acos(a[0]),asin:a=>Math.asin(a[0]),atan:a=>Math.atan(a[0]),ceil:a=>Math.ceil(a[0]),cos:a=>Math.cos(a[0]),e:()=>Math.E,floor:a=>Math.floor(a[0]),ln:a=>Math.log(a[0]),ln2:()=>Math.LN2,log10:a=>Math.log(a[0])/Math.LN10,log2:a=>Math.log(a[0])/Math.LN2,max:a=>Math.max(...a),min:a=>Math.min(...a),pi:()=>Math.PI,round:a=>Math.round(a[0]),sin:a=>Math.sin(a[0]),
sqrt:a=>Math.sqrt(a[0]),tan:a=>Math.tan(a[0])};class ha{constructor(a){this._args=a;this.type=c.stringType}static parse(a,v){return new ha(a.slice(1).map(x=>b(x,v)))}evaluate(a,v){return this._args.map(x=>x.evaluate(a,v)).join("")}}class da{constructor(a,v){this._arg=a;this._calculate=v;this.type=c.stringType}static parse(a,v){if(2!==a.length)throw Error(`${a[0]} expects 1 argument`);v=b(a[1],v);return new da(v,da.ops[a[0]])}evaluate(a,v){return this._calculate(this._arg.evaluate(a,v))}}da.ops={downcase:a=>
a.toLowerCase(),upcase:a=>a.toUpperCase()};class ia{constructor(a){this._args=a;this.type=c.colorType}static parse(a,v){if(4!==a.length)throw Error('"rgb" expects 3 arguments');a=a.slice(1).map(x=>b(x,v));return new ia(a)}evaluate(a,v){const x=this._validate(this._args[0].evaluate(a,v)),G=this._validate(this._args[1].evaluate(a,v));a=this._validate(this._args[2].evaluate(a,v));return new z({r:x,g:G,b:a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}}class ja{constructor(a){this._args=a;this.type=c.colorType}static parse(a,v){if(5!==a.length)throw Error('"rgba" expects 4 arguments');a=a.slice(1).map(x=>b(x,v));return new ja(a)}evaluate(a,v){const x=this._validate(this._args[0].evaluate(a,v)),G=this._validate(this._args[1].evaluate(a,v)),N=this._validate(this._args[2].evaluate(a,v));a=this._validateAlpha(this._args[3].evaluate(a,v));return new z({r:x,g:G,b:N,a})}_validate(a){if("number"!==typeof a||0>a||255<a)throw Error(`${a}: invalid color component`);
return Math.round(a)}_validateAlpha(a){if("number"!==typeof a||0>a||1<a)throw Error(`${a}: invalid alpha color component`);return a}}class ka{constructor(a){this._color=a;this.type=c.arrayType(c.numberType,4)}static parse(a,v){if(2!==a.length)throw Error('"to-rgba" expects 1 argument');a=b(a[1],v);return new ka(a)}evaluate(a,v){return(new z(this._color.evaluate(a,v))).toRgba()}}class ca{constructor(a,v){this.type=a;this._args=v}static parse(a,v){var x=a[0];if(2>a.length)throw Error(`${x} expects at least one argument`);
let G=1,N;if("array"===x){if(2<a.length){switch(a[1]){case "string":N=c.stringType;break;case "number":N=c.numberType;break;case "boolean":N=c.booleanType;break;default:throw Error('"array" type argument must be string, number or boolean');}G++}else N=c.valueType;if(3<a.length){var P=a[2];if(null!==P&&("number"!==typeof P||0>P||P!==Math.floor(P)))throw Error('"array" length argument must be a positive integer literal');G++}N=c.arrayType(N,P)}else switch(x){case "string":N=c.stringType;break;case "number":N=
c.numberType;break;case "boolean":N=c.booleanType;break;case "object":N=c.objectType}for(x=[];G<a.length;G++)P=b(a[G],v),x.push(P);return new ca(N,x)}evaluate(a,v){let x;for(const G of this._args){const N=G.evaluate(a,v);x=c.getType(N);if(c.matchType(x,this.type))return N}throw Error(`Expected ${c.typeToString(this.type)} but got ${c.typeToString(x)}`);}}class X{constructor(a,v){this.type=a;this._args=v}static parse(a,v){var x=a[0];const G=X.types[x];if(G===c.booleanType||G===c.stringType){if(2!==
a.length)throw Error(`${x} expects one argument`);}else if(2>a.length)throw Error(`${x} expects at least one argument`);x=[];for(let N=1;N<a.length;N++){const P=b(a[N],v);x.push(P)}return new X(G,x)}evaluate(a,v){if(this.type===c.booleanType)return!!this._args[0].evaluate(a,v);if(this.type===c.stringType)return c.valueToString(this._args[0].evaluate(a,v));if(this.type===c.numberType){for(const G of this._args){var x=Number(G.evaluate(a,v));if(!isNaN(x))return x}return null}if(this.type===c.colorType){for(x of this._args)try{const G=
X.toColor(x.evaluate(a,v));if(G instanceof z)return G}catch{}return null}}static toBoolean(a){return!!a}static toString(a){return c.valueToString(a)}static toNumber(a){const v=Number(a);if(isNaN(v))throw Error(`"${a}" is not a number`);return v}static toColor(a){if(a instanceof z)return a;if("string"===typeof a){const v=z.fromString(a);if(v)return v;throw Error(`"${a}" is not a color`);}if(Array.isArray(a))return z.fromArray(a);throw Error(`"${a}" is not a color`);}}X.types={"to-boolean":c.booleanType,
"to-color":c.colorType,"to-number":c.numberType,"to-string":c.stringType};class la{constructor(a){this._val=a;this.type=c.getType(a)}static parse(a){if(2!==a.length)throw Error('"literal" expects 1 argument');return new la(a[1])}evaluate(a,v){return this._val}}class ma{constructor(a){this._arg=a;this.type=c.stringType}static parse(a,v){if(2!==a.length)throw Error('"typeof" expects 1 argument');return new ma(b(a[1],v))}evaluate(a,v){return c.typeToString(c.getType(this._arg.evaluate(a,v)))}}const na=
{array:ca,boolean:ca,collator:null,format:null,image:null,literal:la,number:ca,"number-format":null,object:ca,string:ca,"to-boolean":X,"to-color":X,"to-number":X,"to-string":X,typeof:ma,accumulated:null,"feature-state":null,"geometry-type":m,id:k,"line-progress":null,properties:t,at:L,get:Q,has:R,in:V,"index-of":Y,length:Z,slice:ba,"!":H,"!\x3d":B,"\x3c":F,"\x3c\x3d":w,"\x3d\x3d":r,"\x3e":D,"\x3e\x3d":E,all:K,any:O,case:n,coalesce:l,match:u,within:null,interpolate:A,"interpolate-hcl":A,"interpolate-lab":A,
step:I,let:J,var:M,concat:ha,downcase:da,"is-supported-script":null,"resolved-locale":null,upcase:da,rgb:ia,rgba:ja,"to-rgba":ka,"-":oa,"*":pa,"/":qa,"%":ra,"^":sa,"+":ta,abs:U,acos:U,asin:U,atan:U,ceil:U,cos:U,e:U,floor:U,ln:U,ln2:U,log10:U,log2:U,max:U,min:U,pi:U,round:U,sin:U,sqrt:U,tan:U,zoom:q,"heatmap-density":null,"has-id":ea,none:h};y.ALL=K;y.ANY=O;y.Add=ta;y.Assert=ca;y.At=L;y.Calculate=U;y.Case=n;y.Coalesce=l;y.Coerce=X;y.Concat=ha;y.Div=qa;y.EQ=r;y.GE=E;y.GT=D;y.GeomType=m;y.Get=Q;y.Has=
R;y.HasID=ea;y.ID=k;y.In=V;y.IndexOf=Y;y.Interpolate=A;y.LE=w;y.LT=F;y.Length=Z;y.Let=J;y.Literal=la;y.Match=u;y.Mod=ra;y.Mul=pa;y.NE=B;y.NONE=h;y.NOT=H;y.Pow=sa;y.Properties=t;y.Rgb=ia;y.Rgba=ja;y.Slice=ba;y.Step=I;y.String=da;y.Sub=oa;y.ToRgba=ka;y.TypeOf=ma;y.Var=M;y.Zoom=q;y.createExpression=b;y.ops=na;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(y,z){function C(r,
B){return{kind:"array",itemType:r,n:B}}function d(r){if("array"===r.kind){const B=d(r.itemType);return"number"===typeof r.n?`array<${B}, ${r.n}>`:"value"===r.itemType.kind?"array":`array<${B}>`}return r.kind}function e(r){if(null===r)return c;if("string"===typeof r)return g;if("boolean"===typeof r)return k;if("number"===typeof r)return b;if(r instanceof z)return m;if(Array.isArray(r)){let B;for(const F of r){const w=e(F);if(!B)B=w;else if(B!==w){B=q;break}}return C(B||q,r.length)}return"object"===
typeof r?t:q}function f(r,B){if("array"===B.kind)return"array"===r.kind&&(0===r.n&&"value"===r.itemType.kind||f(r.itemType,B.itemType))&&("number"!==typeof B.n||B.n===r.n);if("value"===B.kind)for(const F of p)if(f(r,F))return!0;return B.kind===r.kind}const c={kind:"null"},b={kind:"number"},g={kind:"string"},k={kind:"boolean"},m={kind:"color"},t={kind:"object"},q={kind:"value"},p=[c,b,g,k,m,t,C(q)];y.arrayType=C;y.booleanType=k;y.colorType=m;y.getType=e;y.matchType=f;y.nullType=c;y.numberType=b;y.objectType=
t;y.stringType=g;y.typeToString=d;y.valueToString=function(r){if(null===r)return"";const B=typeof r;return"string"===B?r:"number"===B||"boolean"===B?String(r):r instanceof z?r.toString():JSON.stringify(r)};y.valueType=q;Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(y,z,C,d){class e{constructor(f,c){this.isDataDriven=
!1;this.interpolator=null;switch(f.type){case "number":var b=!0;break;case "color":b=!0;break;case "array":b="number"===f.value;break;default:b=!1}null==c&&(c=f.default);if(Array.isArray(c)&&0<c.length&&C.ops[c[0]]){b={number:d.numberType,color:d.colorType,string:d.stringType,boolean:d.booleanType,enum:d.stringType};try{var g="array"===f.type?d.arrayType(b[f.value]||d.valueType,f.length):b[f.type];const k=C.createExpression(c,null,g);this.getValue=this._buildExpression(k,f);this.isDataDriven=!0;k instanceof
C.Interpolate&&k.input instanceof C.Zoom&&(this.interpolator=k)}catch(k){console.log(k.message),this.getValue=this._buildSimple(f.default)}}else{b&&"interval"===c.type&&(b=!1);if(g=c?.stops&&0<c.stops.length)for(const k of c.stops)k[1]=this._validate(k[1],f);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,f)),g)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,f);break;case "categorical":this.getValue=this._buildCategorical(c,f);break;
default:this.getValue=b?this._buildInterpolate(c,f):this._buildInterval(c,f)}else this.getValue=this._buildIdentity(c,f);else g?this.getValue=b?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,f),this.getValue=this._buildSimple(c))}}_validate(f,c){if("number"===c.type){if(null!=c.minimum&&f<c.minimum)return c.minimum;if(null!=c.maximum&&f>c.maximum)return c.maximum}else"color"===c.type?f=e._parseColor(f):"enum"===c.type?"string"===typeof f&&(f=c.values.indexOf(f)):"array"===
c.type&&"enum"===c.value?f=f.map(b=>"string"===typeof b?c.values.indexOf(b):b):"string"===c.type&&(f=d.valueToString(f));return f}_buildSimple(f){return()=>f}_buildExpression(f,c){return(b,g)=>{try{const k=f.evaluate(g,b);return void 0===k?c.default:this._validate(k,c)}catch(k){return console.log(k.message),c.default}}}_buildIdentity(f,c){return(b,g)=>{let k;g&&(k=g.values[f.property]);void 0!==k&&(k=this._validate(k,c));return null!=k?k:void 0!==f.default?f.default:c.default}}_buildCategorical(f,
c){return(b,g)=>{let k;g&&(k=g.values[f.property]);k=this._categorical(k,f.stops);return void 0!==k?k:void 0!==f.default?f.default:c.default}}_buildInterval(f,c){return(b,g)=>{let k;g&&(k=g.values[f.property]);return"number"===typeof k?this._interval(k,f.stops):void 0!==f.default?f.default:c.default}}_buildInterpolate(f,c){return(b,g)=>{let k;g&&(k=g.values[f.property]);return"number"===typeof k?this._interpolate(k,f.stops,f.base||1):void 0!==f.default?f.default:c.default}}_buildZoomInterpolate(f){return c=>
this._interpolate(c,f.stops,f.base||1)}_buildZoomInterval(f){return c=>this._interval(c,f.stops)}_categorical(f,c){const b=c.length;for(let g=0;g<b;g++)if(c[g][0]===f)return c[g][1]}_interval(f,c){const b=c.length;let g=0;for(let k=0;k<b;k++)if(c[k][0]<=f)g=k;else break;return c[g][1]}_interpolate(f,c,b){const g=c.length;for(let t=0;t<g;t++){const q=c[t];if(q[0]<=f)var k=q;else{var m=q;break}}if(k&&m){c=m[0]-k[0];f-=k[0];b=1===b?f/c:(b**f-1)/(b**c-1);if(Array.isArray(k[1])){k=k[1];m=m[1];f=[];for(c=
0;c<k.length;c++)f.push(z.interpolate(k[c],m[c],b));return f}return z.interpolate(k[1],m[1],b)}if(k)return k[1];if(m)return m[1]}static _isEmpty(f){for(const c in f)if(f.hasOwnProperty(c))return!1;return!0}static _parseColor(f){if(Array.isArray(f))return f;"string"===typeof f&&(f=new y(f));if(f instanceof y&&!this._isEmpty(f))return y.toUnitRGBA(f)}}return e})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(y,z){class C{constructor(d){this._style=
d;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;d.layers||(d.layers=[]);this.version=parseFloat(d.version);if(this.layers=d.layers.map((e,f,c)=>this._create(e,f,c)).filter(e=>!!e))for(d=0;d<this.layers.length;d++){const e=this.layers[d];this._layerByName[e.id]=e;this._uidToLayer.set(e.uid,e);e.type===y.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(d){return(d=this._layerByName[d])?d.isPainterDataDriven():
!1}getStyleLayerId(d){return d>=this.layers.length?null:this.layers[d].id}getStyleLayerByUID(d){return this._uidToLayer.get(d)??null}getStyleLayerIndex(d){return(d=this._layerByName[d])?this.layers.indexOf(d):-1}setStyleLayer(d,e){if(d?.id){var f=this._style;null!=e&&e>=this.layers.length&&(e=this.layers.length-1);var c=!0,b;if(b=this._layerByName[d.id]){const g=this.layers.indexOf(b);e||=g;e===g?(c=!1,b=C._recreateLayer(d,b),this.layers[e]=b,f.layers[e]=d):(this.layers.splice(g,1),f.layers.splice(g,
1),b=this._create(d,e,this.layers),this.layers.splice(e,0,b),f.layers.splice(e,0,d))}else b=this._create(d,e,this.layers),!e||e>=this.layers.length?(this.layers.push(b),f.layers.push(d)):(this.layers.splice(e,0,b),f.layers.splice(e,0,d));this._layerByName[d.id]=b;this._uidToLayer.set(b.uid,b);c&&this._recomputeZValues();this._identifyRefLayers()}}getStyleLayer(d){return(d=this._layerByName[d])?{type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,
filter:d.filter,layout:d.layout,paint:d.paint}:null}deleteStyleLayer(d){const e=this._layerByName[d];e&&(delete this._layerByName[d],this._uidToLayer.delete(e.uid),d=this.layers.indexOf(e),this.layers.splice(d,1),this._style.layers.splice(d,1),this._recomputeZValues(),this._identifyRefLayers())}getLayerById(d){return this._layerByName[d]}getLayoutProperties(d){return(d=this._layerByName[d])?d.layout:null}getPaintProperties(d){return(d=this._layerByName[d])?d.paint:null}setPaintProperties(d,e){if(d=
this._layerByName[d]){var f=C._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:d.layout,paint:e},d),c=this.layers.indexOf(d);this.layers[c]=f;this._style.layers[c].paint=e;this._layerByName[d.id]=f;this._uidToLayer.set(d.uid,f)}}setLayoutProperties(d,e){if(d=this._layerByName[d]){var f=C._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,
filter:d.filter,layout:e,paint:d.paint},d),c=this.layers.indexOf(d);this.layers[c]=f;this._style.layers[c].layout=e;this._layerByName[d.id]=f;this._uidToLayer.set(d.uid,f)}}setStyleLayerVisibility(d,e){if(d=this._layerByName[d]){var f=d.layout||{};f.visibility=e;e=C._recreateLayer({type:d.typeName,id:d.id,source:d.source,"source-layer":d.sourceLayer,minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:f,paint:d.paint},d);var c=this.layers.indexOf(d);this.layers[c]=e;this._style.layers[c].layout=
f;this._layerByName[d.id]=e;this._uidToLayer.set(d.uid,e)}}getStyleLayerVisibility(d){return(d=this._layerByName[d])?d.layout?.visibility??"visible":"none"}_recomputeZValues(){const d=this.layers,e=1/(d.length+1);for(let f=0;f<d.length;f++)d[f].z=1-(1+f)*e}_identifyRefLayers(){const d=[],e=[];let f=0;for(const g of this.layers){const k=g.layout;if(g.type===y.StyleLayerType.FILL){var c=g,b=g.source+"|"+g.sourceLayer;b+="|"+(k?.visibility??"");b+="|"+g.minzoom;b+="|"+g.maxzoom;b+="|"+JSON.stringify(g.filter);
if(c.hasDataDrivenFill||c.hasDataDrivenOutline)b+="|"+f;d.push({key:b,layer:g})}else if(g.type===y.StyleLayerType.LINE){c=g;b=g.paint;b=null!=b&&(null!=b["line-pattern"]||null!=b["line-dasharray"]);let m=g.source+"|"+g.sourceLayer;m+="|"+(k?.visibility??"");m+="|"+g.minzoom;m+="|"+g.maxzoom;m+="|"+JSON.stringify(g.filter);m+="|"+(void 0!==k?k["line-cap"]:"");m+="|"+(void 0!==k?k["line-join"]:"");if(c.hasDataDrivenLine||b)m+="|"+f;e.push({key:m,layer:g})}++f}this._assignRefLayers(d);this._assignRefLayers(e)}_assignRefLayers(d){d.sort((k,
m)=>k.key<m.key?-1:k.key>m.key?1:0);let e,f;const c=d.length;for(let k=0;k<c;k++){const m=d[k];if(m.key===e)m.layer.refLayerId=f;else if(e=m.key,f=m.layer.id,m.layer.type===y.StyleLayerType.FILL){if(!m.layer.getPaintProperty("fill-outline-color"))for(var b=k+1;b<c;b++){var g=d[b];if(g.key===e){if(g.layer.getPaintProperty("fill-outline-color")){d[k]=g;d[b]=m;f=g.layer.id;break}}else break}}else if(m.layer.type===y.StyleLayerType.LINE)for(b=m.layer,g=k+1;g<c;g++){const t=d[g];if(t.key!==e)break;const q=
t.layer;if(b.canUseThinTessellation&&!q.canUseThinTessellation||!b.canUseThinTessellation&&(q.getPaintProperty("line-pattern")||q.getPaintProperty("line-dasharray")))b=q,d[k]=t,d[g]=m,f=t.layer.id}}}_create(d,e,f){e=1-1/(f.length+1)*(1+e);f=this._runningId++;switch(d.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,d,e,f);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,d,e,f);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,d,e,f);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
d,e,f);case "raster":console.warn(`Unsupported vector tile raster layer ${d.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,d,e,f)}return null}static _recreateLayer(d,e){switch(d.type){case "background":return new z.BackgroundStyleLayer(y.StyleLayerType.BACKGROUND,d,e.z,e.uid);case "fill":return new z.FillStyleLayer(y.StyleLayerType.FILL,d,e.z,e.uid);case "line":return new z.LineStyleLayer(y.StyleLayerType.LINE,d,e.z,e.uid);case "symbol":return new z.SymbolStyleLayer(y.StyleLayerType.SYMBOL,
d,e.z,e.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${d.id}`);break;case "circle":return new z.CircleStyleLayer(y.StyleLayerType.CIRCLE,d,e.z,e.uid)}return null}}return C})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/scaleUtils ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(y,z,C,d,e,f,c,b,g,k,m,t,q,p,r,B,F){const w=C.ofType({key:"type",base:null,typeMap:{rect:r,path:F,geometry:B}});y.LayerView2DMixin=D=>{D=class extends D{constructor(){super(...arguments);this.attached=!1;this.clips=new w;this.lastUpdateId=-1;this.visibleAtCurrentScale=this.updateRequested=this.moving=!1;this.highlightOptions=null}initialize(){const E=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&E&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new e("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new q.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([f.watch(()=>this.suspended,H=>{this.container&&(this.container.visible=!H)},f.syncAndInitial),f.watch(()=>this.updateSuspended,H=>{this.view&&!H&&this.updateRequested&&this.view.requestUpdate()},f.syncAndInitial),f.watch(()=>this.layer?.opacity??
1,H=>{this.container&&(this.container.opacity=H)},f.syncAndInitial),f.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",H=>{this.container&&(this.container.blendMode=H)},f.syncAndInitial),f.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,H=>{this.container&&(this.container.effect=H)},f.syncAndInitial),f.watch(()=>this.highlightOptions,H=>this.container.highlightOptions=H,f.syncAndInitial),f.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=
this.clips)},f.syncAndInitial),f.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:H})=>{H=null!=H?this.isVisibleAtScale(H):!1;H!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",H)},f.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(H=>{H===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach();
this.updateRequested=!1}get spatialReferenceSupported(){const E=this.view?.spatialReference;return null==E||this.supportsSpatialReference(E)}get updateSuspended(){return this.suspended}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&
(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}isVisibleAtScale(E){const H=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!H)return!0;const {minScale:K,maxScale:O}=H;return t.isInScaleRange(E,K,O)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(E){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",
E),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(E)))}hitTest(E,H){return Promise.resolve(null)}supportsSpatialReference(E){return!0}canResume(){return this.spatialReferenceSupported?super.canResume()?this.visibleAtCurrentScale:!1:!1}getSuspendInfo(){const E=super.getSuspendInfo(),H=!this.spatialReferenceSupported,K=this.visibleAtCurrentScale;H&&(E.spatialReferenceNotSupported=H);K&&(E.outsideScaleRange=K);return E}addAttachHandles(E){this.addHandles(E,"attach")}};
z.__decorate([c.property()],D.prototype,"attached",void 0);z.__decorate([c.property({type:w,set(E){E=d.referenceSetter(E,this._get("clips"),w);this._set("clips",E)}})],D.prototype,"clips",void 0);z.__decorate([c.property()],D.prototype,"container",void 0);z.__decorate([c.property()],D.prototype,"moving",void 0);z.__decorate([c.property({readOnly:!0})],D.prototype,"spatialReferenceSupported",null);z.__decorate([c.property({readOnly:!0})],D.prototype,"updateParameters",void 0);z.__decorate([c.property()],
D.prototype,"updateRequested",void 0);z.__decorate([c.property()],D.prototype,"updateSuspended",null);z.__decorate([c.property()],D.prototype,"updating",null);z.__decorate([c.property()],D.prototype,"view",void 0);z.__decorate([c.property({readOnly:!0})],D.prototype,"visibleAtCurrentScale",void 0);z.__decorate([c.property({type:p})],D.prototype,"highlightOptions",void 0);return D=z.__decorate([m.subclass("esri.views.2d.layers.LayerView2D")],D)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/mathUtils","../../core/unitUtils"],function(y,z,C){function d(e,f){f=C.getMetersPerUnitForSR(f);return e/(f*C.inchesPerMeter*96)}y.getExtentForScale=function(e,f){const c=e.extent;e=e.width-(e.padding?e.padding.left+e.padding.right:0);f=d(f,c.spatialReference);return c.clone().expand(f*e/c.width)};y.getResolutionForScale=d;y.getResolutionInMetersForScale=function(e){return e/(96*C.inchesPerMeter)};y.getScale=function(e,f){f=
f||e.extent;e=e.width;const c=C.getMetersPerUnitForSR(f?.spatialReference);return f&&e?f.width/e*c*C.inchesPerMeter*96:0};y.getScaleForResolution=function(e,f){f=C.getMetersPerUnitForSR(f);return e*f*C.inchesPerMeter*96};y.isInScaleRange=function(e,f,c){if(f=0===f||z.floatEqualAbsolute(e,f)||e<f)f=0===c||z.floatEqualAbsolute(e,c)||e>c;return f};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,C,d,e,f,c){var b;C=b=class extends c{constructor(g){super(g);this.type="rect";this.bottom=this.top=this.right=this.left=null}clone(){return new b({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")}};y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"left",void 0);y.__decorate([z.property({type:[Number,String],
json:{write:!0}})],C.prototype,"right",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"top",void 0);y.__decorate([z.property({type:[Number,String],json:{write:!0}})],C.prototype,"bottom",void 0);return C=b=y.__decorate([f.subclass("esri.views.layers.support.ClipRect")],C)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass".split(" "),
function(y,z,C,d,e,f,c){z=class extends z.JSONSupport{get version(){this.commitVersionProperties();return(this._get("version")||0)+1}};y.__decorate([C.property({readOnly:!0})],z.prototype,"version",null);return z=y.__decorate([c.subclass("esri.views.layers.support.ClipArea")],z)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(y,z,C,d,e,f,c,b,g,k,m,t){var q;z={base:b,key:"type",typeMap:{extent:m,polygon:t}};k=q=class extends k{constructor(p){super(p);this.type="geometry";this.geometry=null}clone(){return new q({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};y.__decorate([C.property({types:z,json:{read:g.fromJSON,write:!0}})],k.prototype,"geometry",void 0);return k=q=y.__decorate([c.subclass("esri.views.layers.support.Geometry")],k)})},"esri/views/layers/support/Path":function(){define("../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/Logger ../../../core/RandomLCG ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(y,z,C,d,e,f,c){C=class extends c{constructor(b){super(b);this.type="path";this.path=[]}commitVersionProperties(){this.commitProperty("path")}};y.__decorate([z.property({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0);return C=y.__decorate([f.subclass("esri.views.layers.support.Path")],C)})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(y,z,C){class d extends z{constructor(){super(...arguments);
this._fullCacheLodInfos=null;this._levelByScale={}}getTileParentId(e){e=C.pool.acquire(e);const f=0===e.level?null:C.getId(e.level-1,e.row>>1,e.col>>1,e.world);C.pool.release(e);return f}getTileCoverage(e,f,c=!0,b){e=super.getTileCoverage(e,f,c,b);if(!e)return e;const g=1<<e.lodInfo.level;e.spans=e.spans.filter(k=>0<=k.row&&k.row<g);return e}scaleToLevel(e){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[e])return this._levelByScale[e];var f=this._fullCacheLodInfos;
if(e>f[0].scale)return f[0].level;let c;for(let b=0;b<f.length-1;b++)if(c=f[b+1],e>c.scale)return f=f[b],f.level+(f.scale-e)/(f.scale-c.scale);return f[f.length-1].level}_initializeFullCacheLODs(e){e=0===e[0].level?e.map(f=>({level:f.level,resolution:f.resolution,scale:f.scale})):y.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(f=>({level:f.level,resolution:f.resolution,scale:f.scale}));for(let f=0;f<e.length;f++)this._levelByScale[e[f].scale]=e[f].level;
this._fullCacheLodInfos=e}}return d})},"*noref":1}});
define("../../../chunks/tslib.es6 ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/VectorTileFeatureIndex ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(y,
z,C,d,e,f,c,b,g,k,m,t,q,p,r,B,F,w,D,E,H,K,O,h){function n(l){if(null==l)return 0;switch(l.type){case "partial":return Object.keys(l.diff).length;case "complete":return Math.max(Object.keys(l.oldValue).length,Object.keys(l.newValue).length);case "collection":return Object.keys(l.added).length+Object.keys(l.changed).length+Object.keys(l.removed).length}}c=class extends H.LayerView2DMixin(h){constructor(){super(...arguments);this._styleChanges=[];this._tileHandlerPromise=this._parseQueue=this._fetchQueue=
null;this._isTileHandlerReady=!1}get fading(){return this._vectorTileContainer?.fading??!1}async hitTest(l,u){var A=this._tileHandlerPromise,I=this._vectorTileContainer?.symbolFader;if(A&&this._isTileHandlerReady&&I){await A;A=null;var J=this._vectorTileContainer?.symbolRepository;J&&(A=J.querySymbols(u,2,I.decluttererOffset,{}));u=this._tileManager.getIntersectingTiles(u.x,u.y,2,this.view.state,A);if((!u||0===u.length)&&0===A?.length)return null;l=l.clone().normalize();I=[];J=[];for(const M of u)I.push(this._queryTile(J,
l,2,this.view.state.rotation,M,A?.filter(L=>L.tileKey.id===M.id)));await Promise.all(I);return J}}update(l){this._tileHandlerPromise&&this._isTileHandlerReady&&(l.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=l.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=l.state,this._parseQueue.state=l.state,this._tileManager.update(l)||this.requestUpdate(),
this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){const {style:l}=this.layer.currentStyleInfo;this._styleRepository=new E(l);this._tileInfoView=new K(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new F.VectorTileContainer(this._tileInfoView);this._tileHandler=new p.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1);this.container.addChild(this._vectorTileContainer);this._start();this.addAttachHandles([this.layer.on("paint-change",
u=>{if(u.isDataDriven)this._styleChanges.push({type:q.StyleUpdateType.PAINTER_CHANGED,data:u}),this.requestUpdate();else{const I=this._styleRepository;var A=I.getLayerById(u.layer);A&&(A=A.type===D.StyleLayerType.SYMBOL,I.setPaintProperties(u.layer,u.paint),A&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}}),this.layer.on("layout-change",u=>{const A=this._styleRepository,I=A.getLayerById(u.layer);if(I){var J=g.diff(I.layout,u.layout);null!=J&&(g.hasDiff(J,
"visibility")&&1===n(J)?(A.setLayoutProperties(u.layer,u.layout),I.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()):(this._styleChanges.push({type:q.StyleUpdateType.LAYOUT_CHANGED,data:u}),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",u=>{const A=this._styleRepository,I=A.getLayerById(u.layer);I&&(A.setStyleLayerVisibility(u.layer,u.visibility),I.type===D.StyleLayerType.SYMBOL&&this._vectorTileContainer?.restartDeclutter(),
this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",u=>{this._styleChanges.push({type:q.StyleUpdateType.LAYER_CHANGED,data:u});this.requestUpdate()}),this.layer.on("delete-style-layer",u=>{this._styleChanges.push({type:q.StyleUpdateType.LAYER_REMOVED,data:u});this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",u=>{this._styleChanges.push({type:q.StyleUpdateType.SPRITES_CHANGED,data:u});u=this._styleRepository.layers;
for(const A of u)switch(A.type){case D.StyleLayerType.SYMBOL:A.getLayoutProperty("icon-image")&&this._styleChanges.push({type:q.StyleUpdateType.LAYOUT_CHANGED,data:{layer:A.id,layout:A.layout}});break;case D.StyleLayerType.LINE:A.getPaintProperty("line-pattern")&&this._styleChanges.push({type:q.StyleUpdateType.PAINTER_CHANGED,data:{layer:A.id,paint:A.paint,isDataDriven:A.isPainterDataDriven()}});break;case D.StyleLayerType.FILL:A.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:q.StyleUpdateType.PAINTER_CHANGED,
data:{layer:A.id,paint:A.paint,isDataDriven:A.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop();this.container.removeAllChildren();this._vectorTileContainer=d.destroyMaybe(this._vectorTileContainer);this._tileHandler=d.destroyMaybe(this._tileHandler)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(l){return t.equals(this.layer.tileInfo?.spatialReference,l)}canResume(){let l=super.canResume();const {currentStyleInfo:u}=
this.layer;if(l&&u?.layerDefinition){const A=this.view.scale,{minScale:I,maxScale:J}=u.layerDefinition;u?.layerDefinition&&(I&&I<A&&(l=!1),J&&J>A&&(l=!1))}return l}isUpdating(){return this.fading}acquireTile(l){const u=this._createVectorTile(l);this._updatingHandles.addPromise(this._fetchQueue.push(u.key).then(A=>this._parseQueue.push({key:u.key,data:A})).then(A=>{u.once("attach",()=>this.requestUpdate());u.setData(A);this.requestUpdate()}).catch(A=>{e.isAbortError(A)||C.getLogger(this).error(A)}));
return u}releaseTile(l){l=l.key.id;this._fetchQueue.abort(l);this._parseQueue.abort(l);this.requestUpdate()}_start(){this._stop();this._tileManager=new r.TileManager({acquireTile:A=>this.acquireTile(A),releaseTile:A=>this.releaseTile(A),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var l=new AbortController,u=this._tileHandler.start({signal:l.signal}).then(()=>{this._fetchQueue=new O({tileInfoView:this._tileInfoView,process:(A,I)=>this._getTileData(A,
I),concurrency:15});this._parseQueue=new O({tileInfoView:this._tileInfoView,process:(A,I)=>this._parseTileData(A,I),concurrency:8});this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(A=>{this._vectorTileContainer.setStyleResources(A,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView);this.requestUpdate()});this._tileHandlerAbortController=l;this._tileHandlerPromise=u}}_stop(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var l=
this._tileHandlerAbortController;l&&l.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue=d.destroyMaybe(this._fetchQueue);this._parseQueue=d.destroyMaybe(this._parseQueue);this._tileManager=d.destroyMaybe(this._tileManager);this._vectorTileContainer.removeAllChildren()}}async _getTileData(l,u){return this._tileHandler.fetchTileData(l,u)}async _parseTileData(l,u){return this._tileHandler.parseTileData(l,u)}async _applyStyleChanges(){this._isTileHandlerReady=!1;this._fetchQueue.pause();
this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var l=this._styleChanges;try{await this._tileHandler.updateStyle(l)}catch(M){C.getLogger(this).error("error applying vector-tiles style update",M.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0}const u=this._styleRepository,A=new Set;l.forEach(M=>{M.type===q.StyleUpdateType.LAYER_REMOVED&&(M=u.getLayerById(M.data.layer))&&A.add(M.uid)});const I=new Set;
l.forEach(M=>{let L;switch(M.type){case q.StyleUpdateType.PAINTER_CHANGED:u.setPaintProperties(M.data.layer,M.data.paint);L=M.data.layer;break;case q.StyleUpdateType.LAYOUT_CHANGED:u.setLayoutProperties(M.data.layer,M.data.layout);L=M.data.layer;break;case q.StyleUpdateType.LAYER_REMOVED:u.deleteStyleLayer(M.data.layer);return;case q.StyleUpdateType.LAYER_CHANGED:u.setStyleLayer(M.data.layer,M.data.index);L=M.data.layer.id;break;case q.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(M.data.spriteSource))}L&&
(M=u.getLayerById(L))&&I.add(M.uid)});l=this._vectorTileContainer.children;if(0<A.size){const M=Array.from(A);this._vectorTileContainer.deleteStyleLayers(M);for(var J of l)J.deleteLayerData(M)}this._fetchQueue.resume();this._parseQueue.resume();if(0<I.size){const M=Array.from(I);J=[];for(const L of l)l=this._updatingHandles.addPromise(this._fetchQueue.push(L.key).then(Q=>this._parseQueue.push({key:L.key,data:Q,styleLayerUIDs:M})).then(Q=>L.setData(Q))),J.push(l);await Promise.all(J)}this._styleChanges=
[];this._isTileHandlerReady=!0;this.requestUpdate()}async _loadStyle(){var {style:l}=this.layer.currentStyleInfo;l=z.clone(l);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._styleRepository=new E(l);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;var {signal:u}=this._tileHandlerAbortController;try{this._tileHandlerPromise=
this._tileHandler.setStyle(this._styleRepository,l,this.layer.tileInfo.lods.length-1),await this._tileHandlerPromise}catch(A){if(!e.isAbortError(A))throw A;}u.aborted||(l=await this._tileHandler.spriteMosaic,u=this._vectorTileContainer,this._tileInfoView=new K(this.layer.tileInfo,this.layer.fullExtent),u.setStyleResources(l,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new r.TileManager({acquireTile:A=>this.acquireTile(A),releaseTile:A=>this.releaseTile(A),
tileInfoView:this._tileInfoView},this._vectorTileContainer));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.requestUpdate()}_createVectorTile(l){const u=this._tileInfoView.getTileBounds(m.create(),l),A=this._tileInfoView.getTileResolution(l.level);return new B.VectorTile(l,A,u[0],u[3],512,512,this._styleRepository)}async _queryTile(l,u,A,I,J,M){if(0!==J.layerData.size){var L=this._ensureTileIndex(J),Q=this._tileInfoView.getTileBounds(m.create(),J.key,!0);A=await L.queryAttributes((u.x-
Q[0])/(Q[2]-Q[0])*4096,4096*(1-(u.y-Q[1])/(Q[3]-Q[1])),A,I,M);for(const R of A)R.graphic.geometry=this._tileToMapPoint(R.tilePoint,J.transforms.tileUnitsToPixels),l.push({type:"graphic",layer:this.layer,graphic:R.graphic,mapPoint:u.clone()});l.sort((R,V)=>V.graphic.origin.layerIndex-R.graphic.origin.layerIndex)}}_tileToMapPoint(l,u){if(!l)return null;const A=this.view.state,I=[0,0];A.toMap(I,[l[0]*u[0]+l[1]*u[3]+u[6],l[0]*u[1]+l[1]*u[4]+u[7]]);return new k({x:I[0],y:I[1],spatialReference:A.spatialReference})}_ensureTileIndex(l){let u=
l.featureIndex;u||(u=w.create(l.key,l.layerData,this._styleRepository,this._tileHandler,this.layer),l.featureIndex=u);return u}};y.__decorate([f.property()],c.prototype,"_isTileHandlerReady",void 0);return c=y.__decorate([b.subclass("esri.views.2d.layers.VectorTileLayerView2D")],c)});